[
  {
    "sha": "9f3bc556c6b1fbe30d8ac65cdb5c1e932db99c75",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5ZjNiYzU1NmM2YjFmYmUzMGQ4YWM2NWNkYjVjMWU5MzJkYjk5Yzc1",
    "commit": {
      "author": {
        "name": "mruddy",
        "email": "mruddy@users.noreply.github.com",
        "date": "2016-11-17T04:36:58Z"
      },
      "committer": {
        "name": "mruddy",
        "email": "mruddy@users.noreply.github.com",
        "date": "2016-11-17T12:04:38Z"
      },
      "message": "remove script checking dependency on checkpoints",
      "tree": {
        "sha": "9f2cfd0407f2ae0155d1af4795fda755d21c5811",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9f2cfd0407f2ae0155d1af4795fda755d21c5811"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9f3bc556c6b1fbe30d8ac65cdb5c1e932db99c75",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9f3bc556c6b1fbe30d8ac65cdb5c1e932db99c75",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/9f3bc556c6b1fbe30d8ac65cdb5c1e932db99c75",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9f3bc556c6b1fbe30d8ac65cdb5c1e932db99c75/comments",
    "author": {
      "login": "mruddy",
      "id": 6440430,
      "node_id": "MDQ6VXNlcjY0NDA0MzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6440430?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mruddy",
      "html_url": "https://github.com/mruddy",
      "followers_url": "https://api.github.com/users/mruddy/followers",
      "following_url": "https://api.github.com/users/mruddy/following{/other_user}",
      "gists_url": "https://api.github.com/users/mruddy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mruddy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mruddy/subscriptions",
      "organizations_url": "https://api.github.com/users/mruddy/orgs",
      "repos_url": "https://api.github.com/users/mruddy/repos",
      "events_url": "https://api.github.com/users/mruddy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mruddy/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "mruddy",
      "id": 6440430,
      "node_id": "MDQ6VXNlcjY0NDA0MzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6440430?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mruddy",
      "html_url": "https://github.com/mruddy",
      "followers_url": "https://api.github.com/users/mruddy/followers",
      "following_url": "https://api.github.com/users/mruddy/following{/other_user}",
      "gists_url": "https://api.github.com/users/mruddy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mruddy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mruddy/subscriptions",
      "organizations_url": "https://api.github.com/users/mruddy/orgs",
      "repos_url": "https://api.github.com/users/mruddy/repos",
      "events_url": "https://api.github.com/users/mruddy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mruddy/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "cb2ed300a89ebf9f0654da869ced665ed8b2abe7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/cb2ed300a89ebf9f0654da869ced665ed8b2abe7",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/cb2ed300a89ebf9f0654da869ced665ed8b2abe7"
      }
    ],
    "stats": {
      "total": 12,
      "additions": 4,
      "deletions": 8
    },
    "files": [
      {
        "sha": "d9faa093af9afb4d0dc54e8b32e1fd9b355fa38d",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9f3bc556c6b1fbe30d8ac65cdb5c1e932db99c75/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9f3bc556c6b1fbe30d8ac65cdb5c1e932db99c75/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=9f3bc556c6b1fbe30d8ac65cdb5c1e932db99c75",
        "patch": "@@ -325,6 +325,7 @@ std::string HelpMessage(HelpMessageMode mode)\n         strUsage += HelpMessageOpt(\"-blocksonly\", strprintf(_(\"Whether to operate in a blocks only mode (default: %u)\"), DEFAULT_BLOCKSONLY));\n     strUsage += HelpMessageOpt(\"-checkblocks=<n>\", strprintf(_(\"How many blocks to check at startup (default: %u, 0 = all)\"), DEFAULT_CHECKBLOCKS));\n     strUsage += HelpMessageOpt(\"-checklevel=<n>\", strprintf(_(\"How thorough the block verification of -checkblocks is (0-4, default: %u)\"), DEFAULT_CHECKLEVEL));\n+    strUsage += HelpMessageOpt(\"-checkscriptnewer=<n>\", strprintf(_(\"Only check scripts in blocks having a time within this many seconds of the current time. (default: %u seconds)\"), DEFAULT_CHECK_SCRIPT_NEWER));\n     strUsage += HelpMessageOpt(\"-conf=<file>\", strprintf(_(\"Specify configuration file (default: %s)\"), BITCOIN_CONF_FILENAME));\n     if (mode == HMM_BITCOIND)\n     {"
      },
      {
        "sha": "35a7d198d056d428cac55d75eca9338517ae4e6b",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 8,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9f3bc556c6b1fbe30d8ac65cdb5c1e932db99c75/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9f3bc556c6b1fbe30d8ac65cdb5c1e932db99c75/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=9f3bc556c6b1fbe30d8ac65cdb5c1e932db99c75",
        "patch": "@@ -2378,14 +2378,8 @@ bool ConnectBlock(const CBlock& block, CValidationState& state, CBlockIndex* pin\n         return true;\n     }\n \n-    bool fScriptChecks = true;\n-    if (fCheckpointsEnabled) {\n-        CBlockIndex *pindexLastCheckpoint = Checkpoints::GetLastCheckpoint(chainparams.Checkpoints());\n-        if (pindexLastCheckpoint && pindexLastCheckpoint->GetAncestor(pindex->nHeight) == pindex) {\n-            // This block is an ancestor of a checkpoint: disable script checks\n-            fScriptChecks = false;\n-        }\n-    }\n+    const int64_t cutoffTime = GetAdjustedTime() - std::max<int64_t>(0, GetArg(\"-checkscriptnewer\", DEFAULT_CHECK_SCRIPT_NEWER));\n+    const bool fScriptChecks = !fCheckpointsEnabled || block.GetBlockTime() > cutoffTime;\n \n     int64_t nTime1 = GetTimeMicros(); nTimeCheck += nTime1 - nTimeStart;\n     LogPrint(\"bench\", \"    - Sanity checks: %.2fms [%.2fs]\\n\", 0.001 * (nTime1 - nTimeStart), nTimeCheck * 0.000001);"
      },
      {
        "sha": "c524b38e5a4442b9270757fdb5f3cb45dfbc62ec",
        "filename": "src/main.h",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9f3bc556c6b1fbe30d8ac65cdb5c1e932db99c75/src/main.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9f3bc556c6b1fbe30d8ac65cdb5c1e932db99c75/src/main.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.h?ref=9f3bc556c6b1fbe30d8ac65cdb5c1e932db99c75",
        "patch": "@@ -128,6 +128,7 @@ static const int64_t BLOCK_DOWNLOAD_TIMEOUT_PER_PEER = 500000;\n static const unsigned int DEFAULT_LIMITFREERELAY = 15;\n static const bool DEFAULT_RELAYPRIORITY = true;\n static const int64_t DEFAULT_MAX_TIP_AGE = 24 * 60 * 60;\n+static const int64_t DEFAULT_CHECK_SCRIPT_NEWER = 30 * 24 * 60 * 60;\n \n /** Default for -permitbaremultisig */\n static const bool DEFAULT_PERMIT_BAREMULTISIG = true;"
      }
    ]
  },
  {
    "sha": "9bee2baedcf02726a928f8bc0aca9d52e93dd931",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5YmVlMmJhZWRjZjAyNzI2YTkyOGY4YmMwYWNhOWQ1MmU5M2RkOTMx",
    "commit": {
      "author": {
        "name": "mruddy",
        "email": "mruddy@users.noreply.github.com",
        "date": "2016-11-17T15:10:55Z"
      },
      "committer": {
        "name": "mruddy",
        "email": "mruddy@users.noreply.github.com",
        "date": "2016-11-17T15:10:55Z"
      },
      "message": "alternate version using block height",
      "tree": {
        "sha": "0ff5b4a5e65d18fa9658f5ddf9ff3194d7da75f8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0ff5b4a5e65d18fa9658f5ddf9ff3194d7da75f8"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9bee2baedcf02726a928f8bc0aca9d52e93dd931",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9bee2baedcf02726a928f8bc0aca9d52e93dd931",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/9bee2baedcf02726a928f8bc0aca9d52e93dd931",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9bee2baedcf02726a928f8bc0aca9d52e93dd931/comments",
    "author": {
      "login": "mruddy",
      "id": 6440430,
      "node_id": "MDQ6VXNlcjY0NDA0MzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6440430?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mruddy",
      "html_url": "https://github.com/mruddy",
      "followers_url": "https://api.github.com/users/mruddy/followers",
      "following_url": "https://api.github.com/users/mruddy/following{/other_user}",
      "gists_url": "https://api.github.com/users/mruddy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mruddy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mruddy/subscriptions",
      "organizations_url": "https://api.github.com/users/mruddy/orgs",
      "repos_url": "https://api.github.com/users/mruddy/repos",
      "events_url": "https://api.github.com/users/mruddy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mruddy/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "mruddy",
      "id": 6440430,
      "node_id": "MDQ6VXNlcjY0NDA0MzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6440430?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mruddy",
      "html_url": "https://github.com/mruddy",
      "followers_url": "https://api.github.com/users/mruddy/followers",
      "following_url": "https://api.github.com/users/mruddy/following{/other_user}",
      "gists_url": "https://api.github.com/users/mruddy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mruddy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mruddy/subscriptions",
      "organizations_url": "https://api.github.com/users/mruddy/orgs",
      "repos_url": "https://api.github.com/users/mruddy/repos",
      "events_url": "https://api.github.com/users/mruddy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mruddy/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "9f3bc556c6b1fbe30d8ac65cdb5c1e932db99c75",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9f3bc556c6b1fbe30d8ac65cdb5c1e932db99c75",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/9f3bc556c6b1fbe30d8ac65cdb5c1e932db99c75"
      }
    ],
    "stats": {
      "total": 9,
      "additions": 5,
      "deletions": 4
    },
    "files": [
      {
        "sha": "2471f4cb9f01810c9d695cd146223dbdcc2199e7",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9bee2baedcf02726a928f8bc0aca9d52e93dd931/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9bee2baedcf02726a928f8bc0aca9d52e93dd931/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=9bee2baedcf02726a928f8bc0aca9d52e93dd931",
        "patch": "@@ -325,7 +325,7 @@ std::string HelpMessage(HelpMessageMode mode)\n         strUsage += HelpMessageOpt(\"-blocksonly\", strprintf(_(\"Whether to operate in a blocks only mode (default: %u)\"), DEFAULT_BLOCKSONLY));\n     strUsage += HelpMessageOpt(\"-checkblocks=<n>\", strprintf(_(\"How many blocks to check at startup (default: %u, 0 = all)\"), DEFAULT_CHECKBLOCKS));\n     strUsage += HelpMessageOpt(\"-checklevel=<n>\", strprintf(_(\"How thorough the block verification of -checkblocks is (0-4, default: %u)\"), DEFAULT_CHECKLEVEL));\n-    strUsage += HelpMessageOpt(\"-checkscriptnewer=<n>\", strprintf(_(\"Only check scripts in blocks having a time within this many seconds of the current time. (default: %u seconds)\"), DEFAULT_CHECK_SCRIPT_NEWER));\n+    strUsage += HelpMessageOpt(\"-checkscriptdepth=<n>\", strprintf(_(\"Do not check scripts in blocks that are buried under this number of blocks. (default: %u blocks)\"), DEFAULT_CHECK_SCRIPT_DEPTH));\n     strUsage += HelpMessageOpt(\"-conf=<file>\", strprintf(_(\"Specify configuration file (default: %s)\"), BITCOIN_CONF_FILENAME));\n     if (mode == HMM_BITCOIND)\n     {"
      },
      {
        "sha": "14e57a6057ea97c19147c057e3d464ad3ebd784f",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9bee2baedcf02726a928f8bc0aca9d52e93dd931/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9bee2baedcf02726a928f8bc0aca9d52e93dd931/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=9bee2baedcf02726a928f8bc0aca9d52e93dd931",
        "patch": "@@ -2378,8 +2378,8 @@ bool ConnectBlock(const CBlock& block, CValidationState& state, CBlockIndex* pin\n         return true;\n     }\n \n-    const int64_t cutoffTime = GetAdjustedTime() - std::max<int64_t>(0, GetArg(\"-checkscriptnewer\", DEFAULT_CHECK_SCRIPT_NEWER));\n-    const bool fScriptChecks = !fCheckpointsEnabled || block.GetBlockTime() > cutoffTime;\n+    const bool deepEnough = (chainActive.Height() - pindex->nHeight) >= std::max<int64_t>(0, GetArg(\"-checkscriptdepth\", DEFAULT_CHECK_SCRIPT_DEPTH));\n+    const bool fScriptChecks = !fCheckpointsEnabled || !deepEnough;\n \n     int64_t nTime1 = GetTimeMicros(); nTimeCheck += nTime1 - nTimeStart;\n     LogPrint(\"bench\", \"    - Sanity checks: %.2fms [%.2fs]\\n\", 0.001 * (nTime1 - nTimeStart), nTimeCheck * 0.000001);"
      },
      {
        "sha": "87595049ffea3f43a7ea0e7e17b71b09a118a9f8",
        "filename": "src/main.h",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9bee2baedcf02726a928f8bc0aca9d52e93dd931/src/main.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9bee2baedcf02726a928f8bc0aca9d52e93dd931/src/main.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.h?ref=9bee2baedcf02726a928f8bc0aca9d52e93dd931",
        "patch": "@@ -128,7 +128,8 @@ static const int64_t BLOCK_DOWNLOAD_TIMEOUT_PER_PEER = 500000;\n static const unsigned int DEFAULT_LIMITFREERELAY = 15;\n static const bool DEFAULT_RELAYPRIORITY = true;\n static const int64_t DEFAULT_MAX_TIP_AGE = 24 * 60 * 60;\n-static const int64_t DEFAULT_CHECK_SCRIPT_NEWER = 30 * 24 * 60 * 60;\n+/** Block depth from the tip that is subject to script checking (i.e. 30 days worth of blocks assuming 144 blocks a day) */\n+static const int64_t DEFAULT_CHECK_SCRIPT_DEPTH = 6 * 24 * 30;\n \n /** Default for -permitbaremultisig */\n static const bool DEFAULT_PERMIT_BAREMULTISIG = true;"
      }
    ]
  }
]