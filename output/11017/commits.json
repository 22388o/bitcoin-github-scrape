[
  {
    "sha": "03bc719a85cb4928cb4b43d0bc4142f72cb01b23",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzowM2JjNzE5YTg1Y2I0OTI4Y2I0YjQzZDBiYzQxNDJmNzJjYjAxYjIz",
    "commit": {
      "author": {
        "name": "Karl-Johan Alm",
        "email": "karljohan-alm@garage.co.jp",
        "date": "2017-08-09T08:24:15Z"
      },
      "committer": {
        "name": "Karl-Johan Alm",
        "email": "karljohan-alm@garage.co.jp",
        "date": "2017-08-09T08:28:29Z"
      },
      "message": "[wallet] Close DB on error.",
      "tree": {
        "sha": "ac270ee7086d79acfd041d44dd6ef847a3f0960e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ac270ee7086d79acfd041d44dd6ef847a3f0960e"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/03bc719a85cb4928cb4b43d0bc4142f72cb01b23",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEExCr/fGGz5EoUVM01V692LbM1MyIFAlmKx60ACgkQV692LbM1\nMyJhgA/+IjHKnJps0nmFHgVLgojzF0khfPXimxUkohyFC4HoUkmctpLcj6P7fyZs\niFi0Q9Cn4oBMpB/8F0VYOWfQkMlqUFQTmd/tUmb0kHb8rKOSNiXkciCrZxPaaNqs\naf71Q8yLm0xnUSVH4VBHOQMqD4yxiunaiZru+VzGQm3oERX0ehNnIsV7WzKmgfch\nn61XPu5Ue13zr2fqql3yuMe5EkQdpSRpO9OPOMDps7rZHyfC4ajDngoXcKVCZu5/\nx8IS3Pb11UMZl1uSTNEDQpedma5f+ajGalDv5khAV9qEK1YpU48Ye6XjIpnLxpM0\nICcq4+RrkdMpBZ4ALpgXv19Sr8/ZWDjlDwD1a8H34G1h4i+/dhfnmFKnzTbEM2zs\n5UXv1UMichtRIFkg10v0E3hOvJIWAidYaDAqmYk6KAaA4Lp45r0CwyUd47T2l77G\nB7vcw6Bgut+Mm7GN0fA/8QYPVBmdlLZ7ieZDdwWu0gU/JDROqCcC0v//VfBNKwfJ\nqC5kgOCNhh9WjDjKPvNt8kfLNHYq7Js3T5pdcB28Z8XTZlN43tCO10nfpx0iKTOq\nhr4AqCPEndhj3CL7KjVbZCJsIKi9SXP6XbG6dDsCkqKCDiRM50K0M6gsNGv0iiMM\nnrKIEDz79siEGqB9VS61AIYXnlIR3rxRUtwuk2ZPL+CN0tfNjFM=\n=eih9\n-----END PGP SIGNATURE-----",
        "payload": "tree ac270ee7086d79acfd041d44dd6ef847a3f0960e\nparent 929fd7276c0f0c30b9416f61a6f5f35d763d81e4\nauthor Karl-Johan Alm <karljohan-alm@garage.co.jp> 1502267055 +0900\ncommitter Karl-Johan Alm <karljohan-alm@garage.co.jp> 1502267309 +0900\n\n[wallet] Close DB on error.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/03bc719a85cb4928cb4b43d0bc4142f72cb01b23",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/03bc719a85cb4928cb4b43d0bc4142f72cb01b23",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/03bc719a85cb4928cb4b43d0bc4142f72cb01b23/comments",
    "author": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "929fd7276c0f0c30b9416f61a6f5f35d763d81e4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/929fd7276c0f0c30b9416f61a6f5f35d763d81e4",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/929fd7276c0f0c30b9416f61a6f5f35d763d81e4"
      }
    ],
    "stats": {
      "total": 12,
      "additions": 8,
      "deletions": 4
    },
    "files": [
      {
        "sha": "5bf944ec8d57584b102afddea05ee95e3a38e22a",
        "filename": "src/wallet/db.cpp",
        "status": "modified",
        "additions": 8,
        "deletions": 4,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/03bc719a85cb4928cb4b43d0bc4142f72cb01b23/src/wallet/db.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/03bc719a85cb4928cb4b43d0bc4142f72cb01b23/src/wallet/db.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/db.cpp?ref=03bc719a85cb4928cb4b43d0bc4142f72cb01b23",
        "patch": "@@ -101,8 +101,10 @@ bool CDBEnv::Open(const fs::path& pathIn)\n                              DB_RECOVER |\n                              nEnvFlags,\n                          S_IRUSR | S_IWUSR);\n-    if (ret != 0)\n+    if (ret != 0) {\n+        dbenv->close(0);\n         return error(\"CDBEnv::Open: Error %d opening database environment: %s\\n\", ret, DbEnv::strerror(ret));\n+    }\n \n     fDbEnvInit = true;\n     fMockDb = false;\n@@ -196,9 +198,9 @@ bool CDB::Recover(const std::string& filename, void *callbackDataIn, bool (*reco\n                             DB_BTREE,           // Database type\n                             DB_CREATE,          // Flags\n                             0);\n-    if (ret > 0)\n-    {\n+    if (ret > 0) {\n         LogPrintf(\"Cannot create database file %s\\n\", filename);\n+        pdbCopy->close(0);\n         return false;\n     }\n \n@@ -536,8 +538,10 @@ bool CDB::Rewrite(CWalletDBWrapper& dbw, const char* pszSkip)\n                         env->CloseDb(strFile);\n                         if (pdbCopy->close(0))\n                             fSuccess = false;\n-                        delete pdbCopy;\n+                    } else {\n+                        pdbCopy->close(0);\n                     }\n+                    delete pdbCopy;\n                 }\n                 if (fSuccess) {\n                     Db dbA(env->dbenv, 0);"
      }
    ]
  }
]