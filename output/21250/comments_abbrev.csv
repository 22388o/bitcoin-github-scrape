fanquake,2021-02-21 07:15:56,"Both of the macOS builds are failing with:\n```bash\n  CXX      libbitcoin_server_a-shutdown.o\nshutdown.cpp:38:9: error: use of undeclared identifier 'pipe2'\n    if (pipe2(g_shutdown_pipe, O_CLOEXEC) != 0) {\n        ^\n1 error generated.\nmake[2]: *** [Makefile:8763: libbitcoin_server_a-shutdown.o] Error 1\n```\n\nLooks like it has `O_CLOEXEC` but not pipe2.",https://github.com/bitcoin/bitcoin/pull/21250#issuecomment-782812730,782812730,
theStack,2021-02-21 14:19:23,"Added a commit to change the preprocessor condition to only use popen2 if O_CLOEXEC is available _and_ MacOS is not used.\nAlso, re-opened the PR to start Cirrus again (the failure was unrelated to this PR, see #21216).",https://github.com/bitcoin/bitcoin/pull/21250#issuecomment-782865337,782865337,
DrahtBot,2021-02-21 17:51:54,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #21007 (bitcoind: Add -daemonwait option to wait for initialization by laanwj)\n\nIf you consider this pull request import",https://github.com/bitcoin/bitcoin/pull/21250#issuecomment-782896830,782896830,
laanwj,2021-02-22 13:07:49,"Concept ACK\n\n> This means that code within the preprocessor conditional #if HAVE_O_CLOEXEC was actually never compiled\n\nI'm confused—how does that compile at all if the preprocessor flag is mot set? Our reason for using `#if X` insteadof `#ifdef X` is to prevent issues like this. But apparently that doesn't work?\n\nEdit: OK, that works differently than I thought apparently. I was under ",https://github.com/bitcoin/bitcoin/pull/21250#issuecomment-783361274,783361274,
theStack,2021-02-22 13:34:03,"@laanwj: Yes, I would have also expected `#if` to fail if a symbol wasn't declared at all, but apparently that's not the case :/\n\nForce-pushed now with a much simpler pipe2 detection in configure, [as suggested by luke-jr](https://github.com/bitcoin/bitcoin/pull/21250#discussion_r579890630).",https://github.com/bitcoin/bitcoin/pull/21250#issuecomment-783377305,783377305,
laanwj,2021-02-23 14:49:04,"Code review ACK 9bac71350d98580cc7441957fc7c3fa2f4158553\n\n> @laanwj: Yes, I would have also expected #if to fail if a symbol wasn't declared at all, but apparently that's not the case :/\n\nI feel kind of ashamed for not realizing this for so long. I wonder if we can come up with some new convention that does ensure this! (anything I can think of inside `#if` would become kind of long…) and ",https://github.com/bitcoin/bitcoin/pull/21250#issuecomment-784255021,784255021,
DrahtBot,2021-02-25 18:59:48,<!--9cd9c72976c961c55c7acef8f6ba82cd-->\n### Guix builds\n\n| File | commit c263c3d7d2a4b85fe133c5d8018c6ec53b8c942a<br>(master) | commit da2bfcaed32837e085a4a9c708b9721bf2b479ee<br>(master and this pull) |\n|--|--|--|\n| *-aarch64-linux-gnu-debug.tar.gz | [`f70493c5704d6edd...`](https://drahtbot.space/guix/bitcoin/bitcoin/c263c3d7d2a4b85fe133c5d8018c6ec53b8c942a/bitcoin-c263c3d7d2a4-aarch64-linux,https://github.com/bitcoin/bitcoin/pull/21250#issuecomment-786128797,786128797,
luke-jr,2021-02-22 00:14:36,"```suggestion\nAC_CHECK_DECLS([pipe2])\n```",https://github.com/bitcoin/bitcoin/pull/21250#discussion_r579890630,579890630,configure.ac
theStack,2021-02-22 13:28:02,"Heh, nice that sometimes the solution can be so simple, thanks. Any reason why the same approach is not used for also e.g. `fdatasync`? (That's what I used as template in the previous version).",https://github.com/bitcoin/bitcoin/pull/21250#discussion_r580248285,580248285,configure.ac
