[
  {
    "sha": "1c8fe0bf90253f316af138ac8c088ae708ced357",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxYzhmZTBiZjkwMjUzZjMxNmFmMTM4YWM4YzA4OGFlNzA4Y2VkMzU3",
    "commit": {
      "author": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2018-04-26T16:55:07Z"
      },
      "committer": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2018-05-16T19:48:48Z"
      },
      "message": "ui: Remove unnecessary variable fFirstWallet",
      "tree": {
        "sha": "6ed9adadee9d89f9dbb69b589de7589f52bc86a5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6ed9adadee9d89f9dbb69b589de7589f52bc86a5"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1c8fe0bf90253f316af138ac8c088ae708ced357",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1c8fe0bf90253f316af138ac8c088ae708ced357",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/1c8fe0bf90253f316af138ac8c088ae708ced357",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1c8fe0bf90253f316af138ac8c088ae708ced357/comments",
    "author": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "4cfe17c3382ba750131cdc8703b2978132822070",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4cfe17c3382ba750131cdc8703b2978132822070",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/4cfe17c3382ba750131cdc8703b2978132822070"
      }
    ],
    "stats": {
      "total": 4,
      "additions": 1,
      "deletions": 3
    },
    "files": [
      {
        "sha": "a0f2702d396ae59474a12540726c24551abfef44",
        "filename": "src/qt/bitcoin.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 3,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1c8fe0bf90253f316af138ac8c088ae708ced357/src/qt/bitcoin.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1c8fe0bf90253f316af138ac8c088ae708ced357/src/qt/bitcoin.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/bitcoin.cpp?ref=1c8fe0bf90253f316af138ac8c088ae708ced357",
        "patch": "@@ -465,15 +465,13 @@ void BitcoinApplication::initializeResult(bool success)\n         window->setClientModel(clientModel);\n \n #ifdef ENABLE_WALLET\n-        bool fFirstWallet = true;\n         auto wallets = m_node.getWallets();\n         for (auto& wallet : wallets) {\n             WalletModel * const walletModel = new WalletModel(std::move(wallet), m_node, platformStyle, optionsModel);\n \n             window->addWallet(walletModel);\n-            if (fFirstWallet) {\n+            if (m_wallet_models.empty()) {\n                 window->setCurrentWallet(walletModel->getWalletName());\n-                fFirstWallet = false;\n             }\n \n             connect(walletModel, SIGNAL(coinsSent(WalletModel*,SendCoinsRecipient,QByteArray)),"
      }
    ]
  },
  {
    "sha": "0e674ba5572275bcc1eb8f91c6292f871925f965",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzowZTY3NGJhNTU3MjI3NWJjYzFlYjhmOTFjNjI5MmY4NzE5MjVmOTY1",
    "commit": {
      "author": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2018-04-26T17:28:41Z"
      },
      "committer": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2018-05-16T19:48:48Z"
      },
      "message": "ui: Support wallets loaded dynamically",
      "tree": {
        "sha": "1a33d074541a5b427c4697d164f9262e71f8a762",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1a33d074541a5b427c4697d164f9262e71f8a762"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0e674ba5572275bcc1eb8f91c6292f871925f965",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0e674ba5572275bcc1eb8f91c6292f871925f965",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/0e674ba5572275bcc1eb8f91c6292f871925f965",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0e674ba5572275bcc1eb8f91c6292f871925f965/comments",
    "author": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "1c8fe0bf90253f316af138ac8c088ae708ced357",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1c8fe0bf90253f316af138ac8c088ae708ced357",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/1c8fe0bf90253f316af138ac8c088ae708ced357"
      }
    ],
    "stats": {
      "total": 41,
      "additions": 28,
      "deletions": 13
    },
    "files": [
      {
        "sha": "f286216b6e30edd7745ce439f5ca24ddf49a120d",
        "filename": "doc/release-notes-pr10740.md",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/0e674ba5572275bcc1eb8f91c6292f871925f965/doc/release-notes-pr10740.md",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/0e674ba5572275bcc1eb8f91c6292f871925f965/doc/release-notes-pr10740.md",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/doc/release-notes-pr10740.md?ref=0e674ba5572275bcc1eb8f91c6292f871925f965",
        "patch": "@@ -5,4 +5,4 @@ Previously, wallets could only be loaded at startup, by specifying `-wallet` par\n \n The wallet can be specified as file/directory basename (which must be located in the `walletdir` directory), or as an absolute path to a file/directory.\n \n-This feature is currently only available through the RPC interface. Wallets loaded in this way will not display in the bitcoin-qt GUI.\n+This feature is currently only available through the RPC interface. Wallets loaded in this way will display in the bitcoin-qt GUI."
      },
      {
        "sha": "d317070e91569f9b09bb0ca53ec9c17e2cbfc950",
        "filename": "src/qt/bitcoin.cpp",
        "status": "modified",
        "additions": 27,
        "deletions": 12,
        "changes": 39,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/0e674ba5572275bcc1eb8f91c6292f871925f965/src/qt/bitcoin.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/0e674ba5572275bcc1eb8f91c6292f871925f965/src/qt/bitcoin.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/bitcoin.cpp?ref=0e674ba5572275bcc1eb8f91c6292f871925f965",
        "patch": "@@ -234,6 +234,7 @@ public Q_SLOTS:\n     void shutdownResult();\n     /// Handle runaway exceptions. Shows a message box with the problem and quits the program.\n     void handleRunawayException(const QString &message);\n+    void addWallet(WalletModel* walletModel);\n \n Q_SIGNALS:\n     void requestedInitialize();\n@@ -251,6 +252,7 @@ public Q_SLOTS:\n #ifdef ENABLE_WALLET\n     PaymentServer* paymentServer;\n     std::vector<WalletModel*> m_wallet_models;\n+    std::unique_ptr<interfaces::Handler> m_handler_load_wallet;\n #endif\n     int returnValue;\n     const PlatformStyle *platformStyle;\n@@ -447,6 +449,22 @@ void BitcoinApplication::requestShutdown()\n     Q_EMIT requestedShutdown();\n }\n \n+void BitcoinApplication::addWallet(WalletModel* walletModel)\n+{\n+#ifdef ENABLE_WALLET\n+    window->addWallet(walletModel);\n+\n+    if (m_wallet_models.empty()) {\n+        window->setCurrentWallet(walletModel->getWalletName());\n+    }\n+\n+    connect(walletModel, SIGNAL(coinsSent(WalletModel*, SendCoinsRecipient, QByteArray)),\n+        paymentServer, SLOT(fetchPaymentACK(WalletModel*, const SendCoinsRecipient&, QByteArray)));\n+\n+    m_wallet_models.push_back(walletModel);\n+#endif\n+}\n+\n void BitcoinApplication::initializeResult(bool success)\n {\n     qDebug() << __func__ << \": Initialization result: \" << success;\n@@ -465,19 +483,13 @@ void BitcoinApplication::initializeResult(bool success)\n         window->setClientModel(clientModel);\n \n #ifdef ENABLE_WALLET\n-        auto wallets = m_node.getWallets();\n-        for (auto& wallet : wallets) {\n-            WalletModel * const walletModel = new WalletModel(std::move(wallet), m_node, platformStyle, optionsModel);\n-\n-            window->addWallet(walletModel);\n-            if (m_wallet_models.empty()) {\n-                window->setCurrentWallet(walletModel->getWalletName());\n-            }\n+        m_handler_load_wallet = m_node.handleLoadWallet([this](std::unique_ptr<interfaces::Wallet> wallet) {\n+            QMetaObject::invokeMethod(this, \"addWallet\", Qt::QueuedConnection,\n+                Q_ARG(WalletModel*, new WalletModel(std::move(wallet), m_node, platformStyle, optionsModel)));\n+        });\n \n-            connect(walletModel, SIGNAL(coinsSent(WalletModel*,SendCoinsRecipient,QByteArray)),\n-                             paymentServer, SLOT(fetchPaymentACK(WalletModel*,const SendCoinsRecipient&,QByteArray)));\n-\n-            m_wallet_models.push_back(walletModel);\n+        for (auto& wallet : m_node.getWallets()) {\n+            addWallet(new WalletModel(std::move(wallet), m_node, platformStyle, optionsModel));\n         }\n #endif\n \n@@ -593,6 +605,9 @@ int main(int argc, char *argv[])\n     //   IMPORTANT if it is no longer a typedef use the normal variant above\n     qRegisterMetaType< CAmount >(\"CAmount\");\n     qRegisterMetaType< std::function<void(void)> >(\"std::function<void(void)>\");\n+#ifdef ENABLE_WALLET\n+    qRegisterMetaType<WalletModel*>(\"WalletModel*\");\n+#endif\n \n     /// 3. Application identification\n     // must be set before OptionsModel is initialized or translations are loaded,"
      }
    ]
  },
  {
    "sha": "2e751347190049ac1b7fb8378db004956700aaa1",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyZTc1MTM0NzE5MDA0OWFjMWI3ZmI4Mzc4ZGIwMDQ5NTY3MDBhYWEx",
    "commit": {
      "author": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2018-05-17T23:46:44Z"
      },
      "committer": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2018-05-17T23:46:44Z"
      },
      "message": "fixup! ui: Support wallets loaded dynamically",
      "tree": {
        "sha": "cee6b15ee75c34fea82e1f40b43dbf8925e2725c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/cee6b15ee75c34fea82e1f40b43dbf8925e2725c"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2e751347190049ac1b7fb8378db004956700aaa1",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2e751347190049ac1b7fb8378db004956700aaa1",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/2e751347190049ac1b7fb8378db004956700aaa1",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2e751347190049ac1b7fb8378db004956700aaa1/comments",
    "author": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "0e674ba5572275bcc1eb8f91c6292f871925f965",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0e674ba5572275bcc1eb8f91c6292f871925f965",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/0e674ba5572275bcc1eb8f91c6292f871925f965"
      }
    ],
    "stats": {
      "total": 9,
      "additions": 7,
      "deletions": 2
    },
    "files": [
      {
        "sha": "eb0eba21ef73d389fcacc3faa4a39ae7d19e426e",
        "filename": "src/qt/walletframe.cpp",
        "status": "modified",
        "additions": 7,
        "deletions": 2,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2e751347190049ac1b7fb8378db004956700aaa1/src/qt/walletframe.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2e751347190049ac1b7fb8378db004956700aaa1/src/qt/walletframe.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/walletframe.cpp?ref=2e751347190049ac1b7fb8378db004956700aaa1",
        "patch": "@@ -57,8 +57,13 @@ bool WalletFrame::addWallet(WalletModel *walletModel)\n     walletView->setWalletModel(walletModel);\n     walletView->showOutOfSyncWarning(bOutOfSync);\n \n-     /* TODO we should goto the currently selected page once dynamically adding wallets is supported */\n-    walletView->gotoOverviewPage();\n+    WalletView* current_wallet_view = currentWalletView();\n+    if (current_wallet_view) {\n+        walletView->setCurrentIndex(current_wallet_view->currentIndex());\n+    } else {\n+        walletView->gotoOverviewPage();\n+    }\n+\n     walletStack->addWidget(walletView);\n     mapWalletViews[name] = walletView;\n "
      }
    ]
  }
]