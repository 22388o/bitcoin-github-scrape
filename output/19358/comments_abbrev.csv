DrahtBot,2020-06-23 09:51:35,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#23077](https://github.com/bitcoin/bitcoin/pull/23077) (Full CJDNS support by vasild)\n* [#22651](https://github.com/bitc",https://github.com/bitcoin/bitcoin/pull/19358#issuecomment-648036330,648036330,
laanwj,2020-06-29 14:12:27,"Concept ACK, good catch.\n\nConcept ACK on the doc change as well. Though I'd suggest not refering to ""nameproxy"" as that's an internal implementation detail. I think the gist is:\n```patch\n+                       Note: Only the -proxy option will set the proxy used for DNS requests.\n+                       With this option these will not route over Tor.\n+                       So please ",https://github.com/bitcoin/bitcoin/pull/19358#issuecomment-651148819,651148819,
Saibato,2020-06-30 16:09:53,"> Last time I checked, `onlynet=onion` still works, in combination with `proxy=127.0.0.1:9050`, to only make outgoing connections to onion peers.\n\nthx, hmm, lets put it that way. Suppose a user selects -onlynet=ipv4 selects -listen  and  -proxy or none. I guess the least thing a human would expect in that case, is that the node would use a forgotten open existing tor port, to kindly out and in",https://github.com/bitcoin/bitcoin/pull/19358#issuecomment-651894425,651894425,
Saibato,2020-07-24 14:28:13,"> Concept NACK, I think... If we're using -torcontrol, it makes sense to override -proxy (which is primarily for non-onion connections, and only used as a default for onions if no other is specified).\n> \n> Perhaps a better alternative would be to disable -torcontrol (parameter interaction) if -proxy or -onion are set?\n\nI thought also about your suggestion, but dismissed that, since we have",https://github.com/bitcoin/bitcoin/pull/19358#issuecomment-663566338,663566338,
Saibato,2020-08-15 12:42:09,changed hidden to onion and rebased https://github.com/bitcoin/bitcoin/pull/19358/commits/468c60c5ed908ca8029db241b75aa8f893866c74 https://github.com/bitcoin/bitcoin/pull/19358/commits/654dc04b67a44199352a1b25494c9d617cd090bc,https://github.com/bitcoin/bitcoin/pull/19358#issuecomment-674392034,674392034,
qubenix,2020-09-29 01:27:40,"Tested 654dc04b67a44199352a1b25494c9d617cd090bc, does indeed fix #14722. This is obviously a better fix than #14729.",https://github.com/bitcoin/bitcoin/pull/19358#issuecomment-700369920,700369920,
fanquake,2020-09-29 06:38:42,"> This is obviously a better fix than #14729.\n\nThanks for testing @qubenix. I'll close #14729.",https://github.com/bitcoin/bitcoin/pull/19358#issuecomment-700484010,700484010,
fanquake,2020-09-29 06:44:28,"@Saibato note that you also need to [remove any @ mentions from your commit messages](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#committing-patches), 654dc04b67a44199352a1b25494c9d617cd090bc in this case. Otherwise those users will likely be spammed with mentions on GitHub.",https://github.com/bitcoin/bitcoin/pull/19358#issuecomment-700486460,700486460,
Saibato,2020-09-30 08:51:11,"Rebased  and changed the commit messages of c40a121 and   https://github.com/bitcoin/bitcoin/pull/19358/commits/efacd5f4f921e46652c4ef0ae83cadd782395793\nlike @fanquake suggested.\n\nBtw; the more ""correct"" PR description should be.\n**torcontrol :do not override silent behind the back of the user with default proxy settings in hidden service, if the user has chosen other settings according wi",https://github.com/bitcoin/bitcoin/pull/19358#issuecomment-701256073,701256073,
Saibato,2020-10-04 16:54:35,"> t leads to behavior like ...\n\n@hebasto  U right, only at first glance it seams the right and only possible place since you can not know in **init** if the async call fails or succeeds\nMight also be the reason no one saw that for a long time at first glance when reviewing ie. `src/init.cpp` that setting the proxy would be overruled later.\nits a real mess and we should assume shit happens.",https://github.com/bitcoin/bitcoin/pull/19358#issuecomment-703283782,703283782,
Saibato,2020-10-06 08:58:07,Rebased https://github.com/bitcoin/bitcoin/pull/19358/commits/2b9572bf298ca9d4307ec7fe3f5ab8aba4f15e7f and renamed the PR and changed the pr commit message and stripped the doc https://github.com/bitcoin/bitcoin/commit/efacd5f4f921e46652c4ef0ae83cadd782395793 from the PR in favor of a new tor doc PR,https://github.com/bitcoin/bitcoin/pull/19358#issuecomment-704131231,704131231,
Saibato,2020-10-06 11:59:07,"Rebased fixup commit https://github.com/bitcoin/bitcoin/commit/2b9572bf298ca9d4307ec7fe3f5ab8aba4f15e7f we now init the outbound proxy in` init.cpp` \nAddressed also review comment from @hebasto \nIt leaves torcontrol to solely do inbound stuff and init;s the outbound stuff in ` init.cpp`\n\n\nIts also now a replacement for #14425 and fixes #13378\n\nThe PR differs now much from the origina",https://github.com/bitcoin/bitcoin/pull/19358#issuecomment-704219927,704219927,
Saibato,2020-10-07 12:21:41,Rebased addressed review and added the detrimental followup -onlynet fixup.commit https://github.com/bitcoin/bitcoin/pull/19358/commits/e9452a1a8f673de1b310e918ae80c31b7be6f171,https://github.com/bitcoin/bitcoin/pull/19358#issuecomment-704897888,704897888,
Saibato,2020-10-08 18:17:16,Rebased https://github.com/bitcoin/bitcoin/commit/901ac08bdb400aece7a8d910da977acea65fa6af fixed the -onlynet settings for proxy use  ready to review.,https://github.com/bitcoin/bitcoin/pull/19358#issuecomment-705740840,705740840,
Willtech,2020-10-15 19:48:05,Please note this should possibly resolve Issue #12641 when validating? -DA.,https://github.com/bitcoin/bitcoin/pull/19358#issuecomment-709553075,709553075,
Saibato,2020-10-16 06:02:11,"> Please note this should possibly resolve Issue #12641 when validating? -DA.\n\nI guess what u observe is that Tor can for sure over ip4/6 Tor exit nodes connect to nodes in the ip4/6 clearnet. if the address given to the socks5 proxy is not an onion address like from your seed.dat or address learned from other nodes.. Did u expect with -proxy just Tor onion address outbound connections?\nIf s",https://github.com/bitcoin/bitcoin/pull/19358#issuecomment-709815857,709815857,
Willtech,2020-10-17 14:32:39,"Good Afternoon,\nReply via email.\n> I guess what u observe is that Tor can for sure over ip4/6 Tor exit\n> nodes connect to nodes in the ip4/6 clearnet. \nWell, yes if it is not set `onlynet=onion`\n> Did u expect with -proxy just Tor onion address outbound connections?\nBoth onion and proxy are set to the tor proxy.\n> -onlynet=onion\nonlynet=onion is fine and connections to pure onion a",https://github.com/bitcoin/bitcoin/pull/19358#issuecomment-711021128,711021128,
DrahtBot,2021-11-08 13:51:29,"<!--cf906140f33d8803c4a75a2196329ecb-->\nüêô This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a ""draft"".</sub>",https://github.com/bitcoin/bitcoin/pull/19358#issuecomment-963168849,963168849,
laanwj,2020-06-29 13:59:52,"I think this should also log when `SetProxy` fails, as It means there is a bug in the software. After all it tries to set a hardcoded value which *should* never fail.",https://github.com/bitcoin/bitcoin/pull/19358#discussion_r446993600,446993600,src/torcontrol.cpp
laanwj,2020-06-29 14:01:11,"Please log to the right category:\n```c++\nLogPrint(BCLog::TOR, ""tor: Default outbound tor .onion address proxy is set to 127.0.0.1:9050\n"");\n```",https://github.com/bitcoin/bitcoin/pull/19358#discussion_r446994541,446994541,src/torcontrol.cpp
jonatack,2020-07-20 04:34:15,"s/,ipv6/, ipv6/",https://github.com/bitcoin/bitcoin/pull/19358#discussion_r457040394,457040394,doc/tor.md
jonatack,2020-07-20 04:35:42,"nit: while here, can you please touch this up to add a missing comma and fix ""setup"", which is a noun but not a verb:\n\n`s/running setup/running, set up/`",https://github.com/bitcoin/bitcoin/pull/19358#discussion_r457040991,457040991,src/torcontrol.cpp
jonatack,2020-07-20 04:39:10,"```suggestion\n        // Or if an outbound proxy is already defined, we can skip this gracefully.\n```",https://github.com/bitcoin/bitcoin/pull/19358#discussion_r457042473,457042473,src/torcontrol.cpp
jonatack,2020-07-20 04:53:59,"```suggestion\n            } else {\n                LogPrint(BCLog::TOR, ""tor: Failed to create default outbound tor .onion address proxy for 127.0.0.1:9050\n"");\n            }\n```",https://github.com/bitcoin/bitcoin/pull/19358#discussion_r457048910,457048910,src/torcontrol.cpp
Saibato,2020-07-21 08:54:07,"thx, had run it trough clang-format-diff and it also re-formated the net enum,  will come up with test and clang-diff fixup push that we that can autosquash ... , if you want to be co, i could commit the suggest as is, since i see it the same way, my while dev sarcasm comments must not be merged in the final version?",https://github.com/bitcoin/bitcoin/pull/19358#discussion_r457941757,457941757,src/torcontrol.cpp
Saibato,2020-07-21 08:57:56,"Also i think about, split the tor.md from this PR since wording yields always to intensive discussion. ",https://github.com/bitcoin/bitcoin/pull/19358#discussion_r457944217,457944217,src/torcontrol.cpp
vasild,2020-10-06 12:45:22,Isn't this removal sufficient to fix https://github.com/bitcoin/bitcoin/issues/14722?,https://github.com/bitcoin/bitcoin/pull/19358#discussion_r500245277,500245277,src/torcontrol.cpp
Saibato,2020-10-06 13:02:52,"in some sense yes, i would also feel better to just remove this since something like this was anyway somehow without the users explicit consent.\nBut i guess the main concern was to leak ip, if there is no proxy, but the implementation we had now for years was sub optimal at best.\n\nIf we can find there common ground to have by default no outbound Tor socks proxy, i am fine with this to just r",https://github.com/bitcoin/bitcoin/pull/19358#discussion_r500257017,500257017,src/torcontrol.cpp
Saibato,2020-10-06 13:20:04,"@vasild  thx for also looking at this. u might also notice that since -listenonion is the default, i am thinking right now, why not just create the service if we have a proxy in first place?\n\nBitcoin's net is now big enough and we no longer need to create random onions to grow the net, so if -listenonion is removed as default we would have a bit more privacy and a clear torcontrol api.",https://github.com/bitcoin/bitcoin/pull/19358#discussion_r500269343,500269343,src/torcontrol.cpp
vasild,2020-10-06 13:34:20,"Correct me if I am wrong, if only the above code snippet is removed (no other changes), then the behavior will be:\n\n`-proxy=` provided | `-onion=` provided | outcome\n---|---|---\nno | no | outgoing tor connections are not possible\nno | yes | outgoing tor connections will be made via the proxy provided in `-onion=`\nyes | no | outgoing tor connections will be made via the proxy provided i",https://github.com/bitcoin/bitcoin/pull/19358#discussion_r500280721,500280721,src/torcontrol.cpp
Saibato,2020-10-06 16:23:16,"Makes sense and i addressed ur suggestion.\n\nWe now will not create the default outbound proxy and fix by that also the issue and dump a reminder in log  that the user might leak his ip when no proxy is defined and the service call succeeds later somehow on purpose or i.e. when he enables Tor and the node runs already with listenonion, so at least better than the old footgun.\n\nAnd since we ",https://github.com/bitcoin/bitcoin/pull/19358#discussion_r500431792,500431792,src/torcontrol.cpp
vasild,2020-10-07 09:35:35,"I think just `!GetProxy(NET_ONION, addrOnion)` is enough. If the second expression is `true` then for sure the first one is `true` too.\n\nBut more importantly, I think this log message is unnecessary - the fact that a node is running a tor onion service does not mean they want to hide their IP address from the world. I guess `-onlynet=onion` implies that.\n\nAnd even if we want to log a messa",https://github.com/bitcoin/bitcoin/pull/19358#discussion_r500873589,500873589,src/init.cpp
Saibato,2020-10-07 10:31:07,"In my view Its the other way around , the first might be false like u noticed and the user wants to leak his ip with -onion? \nSince -onion is always without nameproxy and the user must know that that leaks anyway.\nSo i thought we should not warn him when he wish for that.\n\nTo have no -proxy set is in my view more concerning.\nAt least with deleting the nameproxy leaking  version by defaul",https://github.com/bitcoin/bitcoin/pull/19358#discussion_r500906678,500906678,src/init.cpp
Saibato,2020-10-07 11:24:22,"@vasild could u imagine that we define a flag -privacynode=maximum,medium,low.\nThat is by default on maximum?\n\ni.e. maximum no listenonion if no proxy with nameproxy no seeding no dns no uunp onlynet respected everywhere just v3 no persistent keystore bind only to unrouteable addr if Tor etc.\nor low just as is.\n\nThat would really make things more easy to craft in the different modules ",https://github.com/bitcoin/bitcoin/pull/19358#discussion_r500934965,500934965,src/init.cpp
wodry,2020-12-06 17:01:14,"> Correct me if I am wrong, if only the above code snippet is removed (no other changes), then the behavior will be:\n\nThank you for the work of analyzing the behavior, @vasild and creating the overview table, this is very good.\n\nPlease see laanwj's destinction of when using names ""Tor"" and when using ""Onion"" here:\nhttps://github.com/bitcoin/bitcoin/pull/13575#issuecomment-402427844\n\n",https://github.com/bitcoin/bitcoin/pull/19358#discussion_r537080526,537080526,src/torcontrol.cpp
