[
  {
    "sha": "fa4cac574187e69d31ac8c8c4597fe5bfafcd13c",
    "node_id": "C_kwDOABII59oAKGZhNGNhYzU3NDE4N2U2OWQzMWFjOGM4YzQ1OTdmZTViZmFmY2QxM2M",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2021-11-23T10:30:55Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2021-11-24T16:59:15Z"
      },
      "message": "fuzz: Avoid negative NodeId in ConsumeNode",
      "tree": {
        "sha": "48ea720c4e97c7efd6291d162cfcddc50010c16f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/48ea720c4e97c7efd6291d162cfcddc50010c16f"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fa4cac574187e69d31ac8c8c4597fe5bfafcd13c",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\npUgbTgv+O9/n5ifbby6crLsvAKruLDaGdJX6D+Jh4i73LbobSxbgckKLRiz9dvjs\nTE7nkC9D16u2ZwSmmVgHdZ0Vx4iwjt1prnGJsbS7hST4Bry8nORMcK6C+BSRzyDl\nmgAX5BwaBjlAwOIz2Zp0cSU/BNprgoP3/Hat4S2MRUE8z0uzx0PB+PnmUxavn4L1\nMRimnvmZbiISdfH8bhgL/zm6fN/iKdq8jRGFVVN8Bhip3lFXDIWbGd4CSvkpLPC9\nfAk6XvvOOagvpFX0FBtze1sPXAdjwnP4owpjRr25M9+VJ8jcW5z1aj1BethgXLs9\nq9N1oP/MZnG6I2AKhGRm5ppVG4C27PRVdHo5lu+g8ZVRf0AGFOSRKQGEPoJmPiZB\nUDH6cGImDB9tHxkACQyrDNQliArW4M2i7oMc0KQ7Rfu64e07KSiKpaRUFAcCeNE+\n94D+lWsnB3TwC1jGamc/EDY0fAMeDgKFHO4C4paz9GQY10aYROq5I3Sni2w/L0IO\nm5wcT7P0\n=dBM5\n-----END PGP SIGNATURE-----",
        "payload": "tree 48ea720c4e97c7efd6291d162cfcddc50010c16f\nparent 9394964f6b9d1cf1220a4eca17ba18dc49ae876d\nauthor MarcoFalke <falke.marco@gmail.com> 1637663455 +0100\ncommitter MarcoFalke <falke.marco@gmail.com> 1637773155 +0100\n\nfuzz: Avoid negative NodeId in ConsumeNode\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa4cac574187e69d31ac8c8c4597fe5bfafcd13c",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fa4cac574187e69d31ac8c8c4597fe5bfafcd13c",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa4cac574187e69d31ac8c8c4597fe5bfafcd13c/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "9394964f6b9d1cf1220a4eca17ba18dc49ae876d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9394964f6b9d1cf1220a4eca17ba18dc49ae876d",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/9394964f6b9d1cf1220a4eca17ba18dc49ae876d"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 1,
      "deletions": 1
    },
    "files": [
      {
        "sha": "e6edaa7aded0c005316133f73834288e2ae7e2ea",
        "filename": "src/test/fuzz/util.h",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa4cac574187e69d31ac8c8c4597fe5bfafcd13c/src/test/fuzz/util.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa4cac574187e69d31ac8c8c4597fe5bfafcd13c/src/test/fuzz/util.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/fuzz/util.h?ref=fa4cac574187e69d31ac8c8c4597fe5bfafcd13c",
        "patch": "@@ -257,7 +257,7 @@ inline CAddress ConsumeAddress(FuzzedDataProvider& fuzzed_data_provider) noexcep\n template <bool ReturnUniquePtr = false>\n auto ConsumeNode(FuzzedDataProvider& fuzzed_data_provider, const std::optional<NodeId>& node_id_in = std::nullopt) noexcept\n {\n-    const NodeId node_id = node_id_in.value_or(fuzzed_data_provider.ConsumeIntegral<NodeId>());\n+    const NodeId node_id = node_id_in.value_or(fuzzed_data_provider.ConsumeIntegralInRange<NodeId>(0, std::numeric_limits<NodeId>::max()));\n     const ServiceFlags local_services = ConsumeWeakEnum(fuzzed_data_provider, ALL_SERVICE_FLAGS);\n     const SOCKET socket = INVALID_SOCKET;\n     const CAddress address = ConsumeAddress(fuzzed_data_provider);"
      }
    ]
  },
  {
    "sha": "fa6a4b4829b960f8f875edced951ce6a2c7c07d4",
    "node_id": "C_kwDOABII59oAKGZhNmE0YjQ4MjliOTYwZjhmODc1ZWRjZWQ5NTFjZTZhMmM3YzA3ZDQ",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2021-11-22T15:05:31Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2021-11-24T17:00:25Z"
      },
      "message": "refactor: Set fSuccessfullyConnected in FillNode\n\nAlso, pass ConnmanTestMsg& and PeerManager& (needed for later commits).",
      "tree": {
        "sha": "dc463c176aeab44bf8e441f39b5f7fa7b928d046",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/dc463c176aeab44bf8e441f39b5f7fa7b928d046"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fa6a4b4829b960f8f875edced951ce6a2c7c07d4",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\npUjS3AwAgqC9CPr3UkbJnbYoZnH76iaRcu+VmB9kbOxxeo557/1qnhip1V1mHJ1D\n5Xcnboh6/gYqUSGfVAbOEZjWPZ8zgKfp0jdkimA6VmaRaR0g3FkhUJXI8+DbdLIv\n7vQnffZ4P08rINr3chI9U/NIi/QENnbbbw7rMEmwVk6ke5gru0exPXCYQe06/lUq\nB0mGnPpD9rSaHhaMeQXHkohVHzxegbfs6U8UjeHJhQW8lW5uTx6XgSmI8fOcVyZE\nhBaKMqaKLrkmNxQJTAeXWO/YrCSvMHnjlGZTusCFxpAEWbiFkSkJJDwGl2JMvOre\nmwgdKo61RNXwf0KvUpaUtBpwo2f2EinVtQmNdgZ3dscowRBVNUxtVMTtLuovox3h\nbopXB+Qqk2+8lhv4BbMGzZ3ygyjJinePuZ8FMqpmXUonccGyrMx98y1ynyuEOKKi\nBd/NwnJOtDvVanFU6O3BOtEc/aH47b7sL6ZtM7svkgDKrgPucUvetWc1ry8tkpGK\nHkmrR5W7\n=cNkz\n-----END PGP SIGNATURE-----",
        "payload": "tree dc463c176aeab44bf8e441f39b5f7fa7b928d046\nparent fa4cac574187e69d31ac8c8c4597fe5bfafcd13c\nauthor MarcoFalke <falke.marco@gmail.com> 1637593531 +0100\ncommitter MarcoFalke <falke.marco@gmail.com> 1637773225 +0100\n\nrefactor: Set fSuccessfullyConnected in FillNode\n\nAlso, pass ConnmanTestMsg& and PeerManager& (needed for later commits).\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa6a4b4829b960f8f875edced951ce6a2c7c07d4",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fa6a4b4829b960f8f875edced951ce6a2c7c07d4",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa6a4b4829b960f8f875edced951ce6a2c7c07d4/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "fa4cac574187e69d31ac8c8c4597fe5bfafcd13c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa4cac574187e69d31ac8c8c4597fe5bfafcd13c",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/fa4cac574187e69d31ac8c8c4597fe5bfafcd13c"
      }
    ],
    "stats": {
      "total": 20,
      "additions": 10,
      "deletions": 10
    },
    "files": [
      {
        "sha": "1763cd8af3411d0134e7d24047bac5f3a9b35331",
        "filename": "src/test/fuzz/process_message.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 3,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa6a4b4829b960f8f875edced951ce6a2c7c07d4/src/test/fuzz/process_message.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa6a4b4829b960f8f875edced951ce6a2c7c07d4/src/test/fuzz/process_message.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/fuzz/process_message.cpp?ref=fa6a4b4829b960f8f875edced951ce6a2c7c07d4",
        "patch": "@@ -79,11 +79,9 @@ void fuzz_target(FuzzBufferType buffer, const std::string& LIMIT_TO_MESSAGE_TYPE\n     }\n     CNode& p2p_node = *ConsumeNodeAsUniquePtr(fuzzed_data_provider).release();\n \n-    const bool successfully_connected{fuzzed_data_provider.ConsumeBool()};\n-    p2p_node.fSuccessfullyConnected = successfully_connected;\n     connman.AddTestNode(p2p_node);\n     g_setup->m_node.peerman->InitializeNode(&p2p_node);\n-    FillNode(fuzzed_data_provider, p2p_node, /* init_version */ successfully_connected);\n+    FillNode(fuzzed_data_provider, connman, *g_setup->m_node.peerman, p2p_node);\n \n     const auto mock_time = ConsumeTime(fuzzed_data_provider);\n     SetMockTime(mock_time);"
      },
      {
        "sha": "e1c11e1afdcd563a0979d6c0d437a6fd89aa1bc7",
        "filename": "src/test/fuzz/process_messages.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 4,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa6a4b4829b960f8f875edced951ce6a2c7c07d4/src/test/fuzz/process_messages.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa6a4b4829b960f8f875edced951ce6a2c7c07d4/src/test/fuzz/process_messages.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/fuzz/process_messages.cpp?ref=fa6a4b4829b960f8f875edced951ce6a2c7c07d4",
        "patch": "@@ -46,11 +46,8 @@ FUZZ_TARGET_INIT(process_messages, initialize_process_messages)\n         peers.push_back(ConsumeNodeAsUniquePtr(fuzzed_data_provider, i).release());\n         CNode& p2p_node = *peers.back();\n \n-        const bool successfully_connected{fuzzed_data_provider.ConsumeBool()};\n-        p2p_node.fSuccessfullyConnected = successfully_connected;\n-        p2p_node.fPauseSend = false;\n         g_setup->m_node.peerman->InitializeNode(&p2p_node);\n-        FillNode(fuzzed_data_provider, p2p_node, /* init_version */ successfully_connected);\n+        FillNode(fuzzed_data_provider, connman, *g_setup->m_node.peerman, p2p_node);\n \n         connman.AddTestNode(p2p_node);\n     }"
      },
      {
        "sha": "59a76a425b5fe8af34310377a5b72e091dab3f19",
        "filename": "src/test/fuzz/util.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 2,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa6a4b4829b960f8f875edced951ce6a2c7c07d4/src/test/fuzz/util.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa6a4b4829b960f8f875edced951ce6a2c7c07d4/src/test/fuzz/util.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/fuzz/util.cpp?ref=fa6a4b4829b960f8f875edced951ce6a2c7c07d4",
        "patch": "@@ -200,16 +200,19 @@ bool FuzzedSock::IsConnected(std::string& errmsg) const\n     return false;\n }\n \n-void FillNode(FuzzedDataProvider& fuzzed_data_provider, CNode& node, bool init_version) noexcept\n+void FillNode(FuzzedDataProvider& fuzzed_data_provider, ConnmanTestMsg& connman, PeerManager& peerman, CNode& node) noexcept\n {\n+    const bool successfully_connected{fuzzed_data_provider.ConsumeBool()};\n+    node.fSuccessfullyConnected = successfully_connected;\n     const ServiceFlags remote_services = ConsumeWeakEnum(fuzzed_data_provider, ALL_SERVICE_FLAGS);\n     const NetPermissionFlags permission_flags = ConsumeWeakEnum(fuzzed_data_provider, ALL_NET_PERMISSION_FLAGS);\n     const int32_t version = fuzzed_data_provider.ConsumeIntegralInRange<int32_t>(MIN_PEER_PROTO_VERSION, std::numeric_limits<int32_t>::max());\n     const bool filter_txs = fuzzed_data_provider.ConsumeBool();\n \n+    node.fPauseSend = false;\n     node.nServices = remote_services;\n     node.m_permissionFlags = permission_flags;\n-    if (init_version) {\n+    if (successfully_connected) {\n         node.nVersion = version;\n         node.SetCommonVersion(std::min(version, PROTOCOL_VERSION));\n     }"
      },
      {
        "sha": "79373158223cd04e6994658fcd1f0e7c8c10cc68",
        "filename": "src/test/fuzz/util.h",
        "status": "modified",
        "additions": 3,
        "deletions": 1,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa6a4b4829b960f8f875edced951ce6a2c7c07d4/src/test/fuzz/util.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa6a4b4829b960f8f875edced951ce6a2c7c07d4/src/test/fuzz/util.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/fuzz/util.h?ref=fa6a4b4829b960f8f875edced951ce6a2c7c07d4",
        "patch": "@@ -36,6 +36,8 @@\n #include <string>\n #include <vector>\n \n+class PeerManager;\n+\n template <typename... Callables>\n size_t CallOneOf(FuzzedDataProvider& fuzzed_data_provider, Callables... callables)\n {\n@@ -275,7 +277,7 @@ auto ConsumeNode(FuzzedDataProvider& fuzzed_data_provider, const std::optional<N\n }\n inline std::unique_ptr<CNode> ConsumeNodeAsUniquePtr(FuzzedDataProvider& fdp, const std::optional<NodeId>& node_id_in = std::nullopt) { return ConsumeNode<true>(fdp, node_id_in); }\n \n-void FillNode(FuzzedDataProvider& fuzzed_data_provider, CNode& node, bool init_version) noexcept;\n+void FillNode(FuzzedDataProvider& fuzzed_data_provider, ConnmanTestMsg& connman, PeerManager& peerman, CNode& node) noexcept;\n \n class FuzzedFileProvider\n {"
      }
    ]
  },
  {
    "sha": "faaf33a114d299c94d554b89b08ff09e8072e2db",
    "node_id": "C_kwDOABII59oAKGZhYWYzM2ExMTRkMjk5Yzk0ZDU1NGI4OWIwOGZmMDllODA3MmUyZGI",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2021-11-22T16:42:38Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2021-11-24T17:02:20Z"
      },
      "message": "fuzz: Rework FillNode",
      "tree": {
        "sha": "cecf85bc57baa5d9395dca1fc181ed553f098134",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/cecf85bc57baa5d9395dca1fc181ed553f098134"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/faaf33a114d299c94d554b89b08ff09e8072e2db",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\npUj8ygv/c8kqYW2MdOfrt9Hqg56l7a5ugbDEVqbJLqOOtlkIf55XG6BAeb+u0Rho\nQOhjL0gYg6fo3QxCePAZ2ptkc3ZT6IZNwRh+MbQPJe8voYomEuxczPARtq6K7/T9\nnQsj+CjBvo4/ROy17grw9FOPFm1R7goCtJGcs3IRy6PCod6UYqhvRkw6aY8b50II\nAbJN2koUM9KDyB49zsnfpQ3d8qVMpCvC3D44FjBvZtTOazyVkHqqx4visogHrlv7\nRUniduIE0ME2K0vgLCtYRtdW//oqtsFyWRxv0QaE5qLJaUoW6WnvRI4r2ybBvIpr\neuFf97aGCp4Nfltkgx6LviWexlvRHxoUGX8UQnr6Yqfd95ZQFXdIGMErODVUYRSB\noo9G0GCoCMHvr7Bn3MwJ5oAwU6XPMerar679KJ6aZ2OpiLVlTTwe9F88C4eyqa8J\nCImdn2tg/H0xTmu6tPMG0biVOsV+0w/aonB9jw+i3yS8bOublw9xHMgISBgUVlBR\nY2gGuH2M\n=QTaR\n-----END PGP SIGNATURE-----",
        "payload": "tree cecf85bc57baa5d9395dca1fc181ed553f098134\nparent fa6a4b4829b960f8f875edced951ce6a2c7c07d4\nauthor MarcoFalke <falke.marco@gmail.com> 1637599358 +0100\ncommitter MarcoFalke <falke.marco@gmail.com> 1637773340 +0100\n\nfuzz: Rework FillNode\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/faaf33a114d299c94d554b89b08ff09e8072e2db",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/faaf33a114d299c94d554b89b08ff09e8072e2db",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/faaf33a114d299c94d554b89b08ff09e8072e2db/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "fa6a4b4829b960f8f875edced951ce6a2c7c07d4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa6a4b4829b960f8f875edced951ce6a2c7c07d4",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/fa6a4b4829b960f8f875edced951ce6a2c7c07d4"
      }
    ],
    "stats": {
      "total": 48,
      "additions": 41,
      "deletions": 7
    },
    "files": [
      {
        "sha": "843b29b911c84e912a885263503d4213abc5257b",
        "filename": "src/test/fuzz/util.cpp",
        "status": "modified",
        "additions": 41,
        "deletions": 7,
        "changes": 48,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/faaf33a114d299c94d554b89b08ff09e8072e2db/src/test/fuzz/util.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/faaf33a114d299c94d554b89b08ff09e8072e2db/src/test/fuzz/util.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/fuzz/util.cpp?ref=faaf33a114d299c94d554b89b08ff09e8072e2db",
        "patch": "@@ -3,6 +3,8 @@\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n #include <consensus/amount.h>\n+#include <net_processing.h>\n+#include <netmessagemaker.h>\n #include <pubkey.h>\n #include <test/fuzz/util.h>\n #include <test/util/script.h>\n@@ -203,22 +205,54 @@ bool FuzzedSock::IsConnected(std::string& errmsg) const\n void FillNode(FuzzedDataProvider& fuzzed_data_provider, ConnmanTestMsg& connman, PeerManager& peerman, CNode& node) noexcept\n {\n     const bool successfully_connected{fuzzed_data_provider.ConsumeBool()};\n-    node.fSuccessfullyConnected = successfully_connected;\n     const ServiceFlags remote_services = ConsumeWeakEnum(fuzzed_data_provider, ALL_SERVICE_FLAGS);\n     const NetPermissionFlags permission_flags = ConsumeWeakEnum(fuzzed_data_provider, ALL_NET_PERMISSION_FLAGS);\n     const int32_t version = fuzzed_data_provider.ConsumeIntegralInRange<int32_t>(MIN_PEER_PROTO_VERSION, std::numeric_limits<int32_t>::max());\n     const bool filter_txs = fuzzed_data_provider.ConsumeBool();\n \n+    const CNetMsgMaker mm{0};\n+\n+    CSerializedNetMsg msg_version{\n+        mm.Make(NetMsgType::VERSION,\n+                version,                                        //\n+                Using<CustomUintFormatter<8>>(remote_services), //\n+                int64_t{},                                      // dummy time\n+                int64_t{},                                      // ignored service bits\n+                CService{},                                     // dummy\n+                int64_t{},                                      // ignored service bits\n+                CService{},                                     // ignored\n+                uint64_t{1},                                    // dummy nonce\n+                std::string{},                                  // dummy subver\n+                int32_t{},                                      // dummy starting_height\n+                filter_txs),\n+    };\n+\n+    (void)connman.ReceiveMsgFrom(node, msg_version);\n     node.fPauseSend = false;\n-    node.nServices = remote_services;\n-    node.m_permissionFlags = permission_flags;\n-    if (successfully_connected) {\n-        node.nVersion = version;\n-        node.SetCommonVersion(std::min(version, PROTOCOL_VERSION));\n+    connman.ProcessMessagesOnce(node);\n+    {\n+        LOCK(node.cs_sendProcessing);\n+        peerman.SendMessages(&node);\n     }\n+    if (node.fDisconnect) return;\n+    assert(node.nVersion == version);\n+    assert(node.GetCommonVersion() == std::min(version, PROTOCOL_VERSION));\n+    assert(node.nServices == remote_services);\n     if (node.m_tx_relay != nullptr) {\n         LOCK(node.m_tx_relay->cs_filter);\n-        node.m_tx_relay->fRelayTxes = filter_txs;\n+        assert(node.m_tx_relay->fRelayTxes == filter_txs);\n+    }\n+    node.m_permissionFlags = permission_flags;\n+    if (successfully_connected) {\n+        CSerializedNetMsg msg_verack{mm.Make(NetMsgType::VERACK)};\n+        (void)connman.ReceiveMsgFrom(node, msg_verack);\n+        node.fPauseSend = false;\n+        connman.ProcessMessagesOnce(node);\n+        {\n+            LOCK(node.cs_sendProcessing);\n+            peerman.SendMessages(&node);\n+        }\n+        assert(node.fSuccessfullyConnected == true);\n     }\n }\n "
      }
    ]
  }
]