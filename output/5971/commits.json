[
  {
    "sha": "351593b9c8687b4da2e86769899b8b61ea44b630",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozNTE1OTNiOWM4Njg3YjRkYTJlODY3Njk4OTliOGI2MWVhNDRiNjMw",
    "commit": {
      "author": {
        "name": "pstratem",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-04-05T09:35:37Z"
      },
      "committer": {
        "name": "pstratem",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-04-27T18:48:31Z"
      },
      "message": "replace absolute sleep with conditional wait",
      "tree": {
        "sha": "e8aac87cb66467e37f7dc6dece0202b26168f79e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e8aac87cb66467e37f7dc6dece0202b26168f79e"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/351593b9c8687b4da2e86769899b8b61ea44b630",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/351593b9c8687b4da2e86769899b8b61ea44b630",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/351593b9c8687b4da2e86769899b8b61ea44b630",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/351593b9c8687b4da2e86769899b8b61ea44b630/comments",
    "author": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "1d9d314573ee48f6f51107265f1cf1fa9e36c998",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1d9d314573ee48f6f51107265f1cf1fa9e36c998",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/1d9d314573ee48f6f51107265f1cf1fa9e36c998"
      }
    ],
    "stats": {
      "total": 10,
      "additions": 8,
      "deletions": 2
    },
    "files": [
      {
        "sha": "45a06a105f86d78eb68e58176cb6c6a1fe616811",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 8,
        "deletions": 2,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/351593b9c8687b4da2e86769899b8b61ea44b630/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/351593b9c8687b4da2e86769899b8b61ea44b630/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=351593b9c8687b4da2e86769899b8b61ea44b630",
        "patch": "@@ -100,6 +100,7 @@ NodeId nLastNodeId = 0;\n CCriticalSection cs_nLastNodeId;\n \n static CSemaphore *semOutbound = NULL;\n+boost::condition_variable messageHandlerCondition;\n \n // Signals for message handling\n static CNodeSignals g_signals;\n@@ -532,8 +533,10 @@ bool CNode::ReceiveMsgBytes(const char *pch, unsigned int nBytes)\n         pch += handled;\n         nBytes -= handled;\n \n-        if (msg.complete())\n+        if (msg.complete()) {\n             msg.nTime = GetTimeMicros();\n+            messageHandlerCondition.notify_one();\n+        }\n     }\n \n     return true;\n@@ -1358,6 +1361,9 @@ bool OpenNetworkConnection(const CAddress& addrConnect, CSemaphoreGrant *grantOu\n \n void ThreadMessageHandler()\n {\n+    boost::mutex condition_mutex;\n+    boost::unique_lock<boost::mutex> lock(condition_mutex);\n+    \n     SetThreadPriority(THREAD_PRIORITY_BELOW_NORMAL);\n     while (true)\n     {\n@@ -1417,7 +1423,7 @@ void ThreadMessageHandler()\n         }\n \n         if (fSleep)\n-            MilliSleep(100);\n+            messageHandlerCondition.timed_wait(lock, boost::posix_time::microsec_clock::universal_time() + boost::posix_time::milliseconds(100));\n     }\n }\n "
      }
    ]
  }
]