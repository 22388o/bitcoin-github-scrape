MarcoFalke,2021-04-22 09:34:02,Concept ACK. Wanted to do the same,https://github.com/bitcoin/bitcoin/pull/21750#issuecomment-824690644,824690644,
vasild,2021-04-22 09:34:10,"https://github.com/bitcoin/bitcoin/pull/19347 removed a similar check of `CNode::cs_inventory`. Maybe removing also the `cs_vSend` check was out of scope there or was overlooked? Or I am overlooking something with this PR?\n\ncc @jnewbery ",https://github.com/bitcoin/bitcoin/pull/21750#issuecomment-824690730,824690730,
MarcoFalke,2021-04-22 09:58:25,"Checked that cs_vSend is only locked when the node is in vNodes, so any node in the disconnect pool can't fail to take the lock.\n\nreview ACK 9096b13a4764873511b65f32a005ce4738b0d81c üèß\n\n<details><summary>Show signature and timestamp</summary>\n\nSignature:\n\n```\n-----BEGIN PGP SIGNED MESSAGE-----\nHash: SHA512\n\nreview ACK 9096b13a4764873511b65f32a005ce4738b0d81c üèß\n-----BEGIN P",https://github.com/bitcoin/bitcoin/pull/21750#issuecomment-824706158,824706158,
MarcoFalke,2021-04-22 10:05:23,"tested with \n\n```diff\ndiff --git a/src/net.cpp b/src/net.cpp\nindex 5aa267f0d7..5bcc508bff 100644\n--- a/src/net.cpp\n+++ b/src/net.cpp\n@@ -1233,7 +1233,7 @@ void CConnman::DisconnectNodes()\n                         fDelete = true;\n                     }\n                 }\n-                if (fDelete) {\n+                Assert(fDelete); {\n                     vNodesDisconne",https://github.com/bitcoin/bitcoin/pull/21750#issuecomment-824710776,824710776,
jnewbery,2021-04-22 11:09:55,"utACK 9096b13a4764873511b65f32a005ce4738b0d81c\n\nLogic in commit message is sound. No other thread can be holding this lock if refcount is zero.\n\nCopying the list and then iterating through the copy seems unnecessary. Perhaps for a follow up:\n\n<details>\n<summary>Details</summary>\n\n```diff\ndiff --git a/src/net.cpp b/src/net.cpp\nindex f7d102a4df..8d53afa7f8 100644\n--- a/src/ne",https://github.com/bitcoin/bitcoin/pull/21750#issuecomment-824747630,824747630,
jnewbery,2021-04-22 11:11:07,"@vasild if you're interested in cleaning up locking for these objects, then you may wish to review #21563.",https://github.com/bitcoin/bitcoin/pull/21750#issuecomment-824748307,824748307,
