MarcoFalke,2020-08-29 14:28:00," noban, addnode and local peers are still unconditionally logged (as they should), but this one can go into a category, so cr-ACK 1816327e533d359c237c53eb6440b2f3a7cbf4fa",https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-683298344,683298344,
jonatack,2020-08-29 16:30:09,"Tend to NACK, the `NET` log category is much too noisy for this message and I appreciate being able to see it unconditionally logged.",https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-683312379,683312379,
jonatack,2020-08-29 16:33:13,"> ```\n> $ cat debug.log | wc -l\n> 28529\n> $ cat debug.log | grep ""Disconnecting and discouraging peer"" | wc -l\n> 10177\n> ```\n\nThese figures are very far from representative? I have 154230 and 116, e.g. less than one line in one thousand, and with no banning, just one seednode and a few addnodes in the config file.\n",https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-683312814,683312814,
hebasto,2020-08-29 16:35:38,"> > ```\n> > $ cat debug.log | wc -l\n> > 28529\n> > $ cat debug.log | grep ""Disconnecting and discouraging peer"" | wc -l\n> > 10177\n> > ```\n> \n> These figures are very far from representative? I have 154230 and 116.\n\nInteresting, what factors affect this?\n\nFWIW, that is the node the log was grepped from:\nhttps://bitnodes.io/nodes/leaderboard/?q=95.164.65.194",https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-683313114,683313114,
hebasto,2020-08-29 16:38:31,"@jonatack \n> Tend to NACK, the `NET` log category is much too noisy for this message and I appreciate being able to see it unconditionally logged.\n\nThis PR does _not_ change the logging output amount with the `debug=net` option.\n",https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-683313462,683313462,
jonatack,2020-08-29 16:41:51,"I think it should stay unconditionally logged. If one-third of a node's debug log is this message, ISTM the node has issues and this should be visibly logged. ",https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-683313897,683313897,
hebasto,2020-08-29 16:44:34,"> I think it should stay unconditionally logged. If one-third of a node's debug log is this message, ISTM the node has issues and this should be visibly logged.\n\nWhat kind of the node's issues could force it to discourage and disconnect peers?",https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-683314250,683314250,
jonatack,2020-08-29 17:10:44,Misbehaving peers; look at the callers of `net_processing.cpp::Misbehaving`.,https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-683317321,683317321,
hebasto,2020-08-29 17:20:57,"> I think it should stay unconditionally logged. If one-third of a node's debug log is this message, ISTM the node has issues and this should be visibly logged.\n\n> Misbehaving peers; look at the callers of `net_processing.cpp::Misbehaving`.\n\nI mean ""peers do misbehave"", not ""the node has issues"".",https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-683318555,683318555,
jonatack,2020-08-29 17:28:54,"The node having issues because it's seeing a pathological amount of misbehavior. Best to fix the issue, not hide the logs.",https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-683319497,683319497,
practicalswift,2020-08-30 17:57:34,"@jonatack What if the peer is doing this deliberately to try to fill our logs with crap? Either to cause disk usage, or to bury warnings about potential real issues (such as ""Potential stale tip detected …"") by increasing signal to noise.\n\nGenerally I don't think misbehaving peers should be able to cause us to write to disk unless the user is explicitly opting in to debug logging.\n",https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-683450484,683450484,
jonatack,2020-08-30 18:23:43,"I'd argue that this is a real issue. One-third of all logging for misbehavior should not be happening, and if the case is truly as extreme as described at the top, then alarms should be going off; better to know about it ASAP and take useful measures (setban, addnode, seednode, etc). The net logging is far too noisy to be useful unless you are specifically searching it for this or have some kind o",https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-683453394,683453394,
jonatack,2020-08-30 18:29:49,"(If people don't want to see peer misbehavior unconditionally logged, maybe we should add a distinct category of `NET` logging dedicated to signals of healthy node operation, but ISTM that is what the unconditional log is for.)",https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-683454026,683454026,
practicalswift,2020-08-30 19:29:08,"@jonatack \n\n> if the case is truly as extreme as described at the top, then alarms should be going off […]\n\nIf so then I think it is better is we log when the ""alarm should go off"" condition is fulfilled: not unconditionally log totally normal events, hope that the user notices that these normal events are ""more normal than normally"" and that he/she draws the conclusion that something coul",https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-683460450,683460450,
jonatack,2020-08-30 19:45:19,"This PR is made based on only only one data point, and afaict an extremely unusual one. Is anyone else really seeing this much misbehavior logging?",https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-683462133,683462133,
jnewbery,2020-08-31 09:20:30,"Logging here was added way back in https://github.com/bitcoin/bitcoin/commit/b2864d2fb35fa85e32c76e111f8900598e0bb69d, shortly after logging categories were added (#3009). That commit also added unconditional logging to `Misbehaving()`, which has now moved to the `NET` category. I don't have a very strong opinion, but I think that these logs should probably also go in the `NET` category.\n\n> no",https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-683667624,683667624,
practicalswift,2020-08-31 09:34:04,ACK 1816327e533d359c237c53eb6440b2f3a7cbf4fa -- I think these logs belong in the `NET` category :),https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-683673802,683673802,
jonatack,2020-08-31 09:44:40,I think there is something dramatically wrong with a node that has this message as one-third of its logging. It shouldn't be a motivation for this change.,https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-683678444,683678444,
jonatack,2020-08-31 09:46:55,"On my nodes these logs are less than one line in a thousand, and I'm not banning anything.",https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-683679474,683679474,
MarcoFalke,2020-08-31 13:51:38,"> @MarcoFalke: I don't understand. Can you explain why they're different?\n\nI assume that noban peers are ""trusted"" peers hand-picked by the node operator, so they should be assumed to not misbehave. If they do and fill your disk, then it is user error and not Bitcoin Core error.",https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-683791828,683791828,
MarcoFalke,2020-08-31 15:25:53,"Generally, it should be possible to run Bitcoin Core with well-defined resource usage in an unsupervised setting. Ideally, the resource usage depends on command line settings and user behaviour, not on remote peer (mis)behaviour. And with ""unsupervised"" I mean that the users doesn't check the debug log unless there is a local software malfunction or other issue that needs manual debugging.\n\nPo",https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-683849565,683849565,
jonatack,2020-09-02 08:06:42,"There are 17 other `LogPrintf` lines in the same file (`net_processing.cpp`) alone, many of which are also related to peer connection and disconnection. And just as many more in `net.cpp`. \n\nI'd propose to have a global policy on connection/disconnection logging rather than PRing changes to each of them one-by-one.\n\nIf peer connection messages are displayed unconditionally, disconnections ",https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-685429720,685429720,
practicalswift,2020-09-02 08:19:55,"@jonatack \n\n> There are 17 other LogPrintf lines in the same file (net_processing.cpp) alone, many of which are also related to peer connection and disconnection. And just as many more in net.cpp.\n\nIf you know of any scenario where a peer connecting to my node can cause my node to write to the default log (cheaply) then I'd be very interested to know about them so that I can fix them.\n\",https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-685437051,685437051,
jonatack,2020-09-02 09:13:48,"@practicalswift I understand your concern. Reconnecting from different IP addresses and re-misbehaving may be trivial, but misbehavior leading to discouragement does not automatically lead to immediate disconnection; see `src/banman.h::L36-55`. If an attacker is wasting our resources in this way, which #19219 aimed to reduce, a line in the log per disconnection seems the least of our worries. This",https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-685470934,685470934,
practicalswift,2020-09-02 13:34:39,"@jonatack \n\nI think @MarcoFalke summarized the current policy quite nicely:\n\n> Generally, it should be possible to run Bitcoin Core with well-defined resource usage in an unsupervised setting. Ideally, the resource usage depends on command line settings and user behaviour, not on remote peer (mis)behaviour. And with ""unsupervised"" I mean that the users doesn't check the debug log unless th",https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-685740842,685740842,
jonatack,2020-09-02 13:54:14,"@practicalswift ISTM better solutions have been proposed in this discussion already, this unconditional logging is no oversight, and this can be closed.",https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-685753031,685753031,
hebasto,2020-11-26 12:09:38,"Closing for now, as [ill behavior](https://github.com/bitcoin/bitcoin/pull/19832#issue-475783605) is no longer observed, at least for me :)",https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-734262182,734262182,
ajtowns,2020-12-04 02:00:27,"> On my nodes these logs are less than one line in a thousand, and I'm not banning anything.\n\nAre you accepting inbound connections or hidden behind tor or something? That seems really low. FWIW, I'm seeing ~50% of log lines being ""Disconnecting and discouraging"" without NET enabled (11.8k out of 22.4k); though that node is a chunk behind current master.",https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-738506428,738506428,
jonatack,2020-12-04 22:23:33,"```\n$ ~/.bitcoin$ cat debug.log | wc -l\n9156971\n$ cat debug.log | grep ""Disconnecting and discouraging peer"" | wc -l\n2\n$ cat debug.log | grep ""discouraging"" | wc -l\n2\n$ grep -i ""discourag"" ~/.bitcoin/debug.log \n2020-10-08T19:45:15Z Disconnecting and discouraging peer 604!\n2020-10-09T17:23:27Z Disconnecting and discouraging peer 288!\n```\nYeah, down to less than one in a millio",https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-739055612,739055612,
ajtowns,2020-12-05 01:35:50,"Yeah; it is a lot -- but it's triggerable by any badly written fake node software that does something stupid and also reconnects to your node sometime after being disconnected. I restarted that node after updating to current master and am back up to 378 lines of debug.log with 161 of them being Disconnecting and discouraging. (no debug logging enabled, which also means I can't tell what IPs those ",https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-739102260,739102260,
practicalswift,2020-12-05 10:03:28,"Judging from the discussions in this PR is seems to me that the consensus opinion is that ""Disconnecting and discouraging peer"" is too noisy. Consider re-opening this PR :)",https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-739155227,739155227,
jonatack,2020-12-05 10:18:22,"> Judging from the discussions in this PR is seems to me that the consensus opinion is that ""Disconnecting and discouraging peer"" is too noisy. Consider re-opening this PR :)\n\nI suspect that re-proposing to hide the symptoms for all users every time one person has a situation with their node might not be the optimal way to address this. ""Let's sweep it under the rug.""\n\nThat said, since thi",https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-739170233,739170233,
hebasto,2020-12-05 10:18:24,"> Judging from the discussions in this PR is seems to me that the consensus opinion is that ""Disconnecting and discouraging peer"" is too noisy. Consider re-opening this PR :)\n\nRe-opened.",https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-739170279,739170279,
practicalswift,2020-12-05 15:52:06,"ACK 1816327e533d359c237c53eb6440b2f3a7cbf4fa for the reasons MarcoFalke gave above.\n\nIt shouldn't be easy for an attacker to add noise to our logs. `-debug` can be used in troubleshooting scenarios.",https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-739313243,739313243,
ajtowns,2020-12-07 07:39:34,"Having left the restarted node running for a couple of days now, I've broken my logs up by how frequently each message appears.\n\nStandard ""everything's going fine"" logs:\n\n```\n91 x Bitcoin Core version v0.20.99.0-e21b82438 (release build)  [introductory logs]\n387 x UpdateTip: new best=....\n49 x New outbound peer connected: ...\n```\n\nBlockchain warnings about people sending me BCH",https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-739733571,739733571,
MarcoFalke,2020-12-07 08:07:47,"I've edited one review (https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-739313243) to remove an `@` mention, which would be included in the merge commit",https://github.com/bitcoin/bitcoin/pull/19832#issuecomment-739748289,739748289,
jonatack,2020-08-30 20:04:47,"> I don't think that is good usability: evidently also long term Core contributors don't follow the described pattern as proven by this PR :)\n\nThis line was written by @sipa in b691f2df5f7d443c0c9ee056ab94aa0fc19566d5 and last touched by @jnewbery in 655b1957470c39b.",https://github.com/bitcoin/bitcoin/pull/19832#discussion_r479809973,479809973,src/net_processing.cpp
practicalswift,2020-08-31 08:28:33,"> > If so then I think it is better is we log when the ""alarm should go off"" condition is fulfilled: not unconditionally log totally normal events, hope that the user notices that these normal events are ""more normal than normally"" and that he/she draws the conclusion that something could be wrong.\n> >\n> > I don't think that is good usability: evidently also long term Core contributors don't f",https://github.com/bitcoin/bitcoin/pull/19832#discussion_r479976765,479976765,src/net_processing.cpp
jonatack,2020-08-31 08:41:21,"Ok. It's hard to know--I *think* I'd be more worried about network topology here than a peer causing lots of logging, but I'm not sure if that POV is correct or shared.\n\nI'm thinking of looking at the `NET` logging to see if we should consider creating a ""high level"" net logging category (or a ""user level"" one) as opposed to the low-level one with all of the invs and other hundreds/thousands o",https://github.com/bitcoin/bitcoin/pull/19832#discussion_r479983339,479983339,src/net_processing.cpp
