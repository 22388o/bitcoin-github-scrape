BitcoinPullTester,2012-09-24T13:22:33Z,"Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/bd5f5de6b8ab13ec34c96fa7376da329a07c1105 for binaries and test log.\n",https://github.com/bitcoin/bitcoin/pull/1859#issuecomment-8818475,8818475,
laanwj,2012-09-24T16:28:46Z,ACK\n,https://github.com/bitcoin/bitcoin/pull/1859#issuecomment-8825088,8825088,
Diapolo,2012-09-28T06:40:54Z,I'm going to update this until early next week :).\n,https://github.com/bitcoin/bitcoin/pull/1859#issuecomment-8965975,8965975,
Diapolo,2012-09-28T11:56:06Z,"Updated to include 2 new functions to use local copies of the proxyInfo and nameproxyInfo objects in the time-critical functions, which removes the bad practise of holding the lock all through ConnectSocket and it's subroutines, as Gavin suggested.\n\nI chose to add these 2 function (currently not exposed to netbase.h), because I think I need those when updating the GUI with extended proxy setting",https://github.com/bitcoin/bitcoin/pull/1859#issuecomment-8974222,8974222,
Diapolo,2012-09-29T09:43:56Z,"@sipa I updated GetProxy() to fill a proxyType object and make that usable outsite of netbase.cpp (moved the typedef to netbase.h).\n@laanwj Can you have a in depth look at the changes to optionsmodel.cpp, I included the use of GetProxy() for the SOCKS version, too, which was not in before (was read from the settings only).\n",https://github.com/bitcoin/bitcoin/pull/1859#issuecomment-9002422,9002422,
sipa,2012-09-30T13:08:26Z,ACK on changes to core.\n,https://github.com/bitcoin/bitcoin/pull/1859#issuecomment-9013504,9013504,
BitcoinPullTester,2012-09-30T21:13:05Z,"Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/fd31870d2820d7e1d0f8f3253f081aa71c0b2dca for binaries and test log.\n",https://github.com/bitcoin/bitcoin/pull/1859#issuecomment-9018021,9018021,
Diapolo,2012-09-30T21:17:49Z,@laanwj Anything left for the Qt changes? I trie to not include feature-changes and will do that after this got merged.\n,https://github.com/bitcoin/bitcoin/pull/1859#issuecomment-9018066,9018066,
laanwj,2012-10-02T05:50:16Z,ACK\n,https://github.com/bitcoin/bitcoin/pull/1859#issuecomment-9059652,9059652,
Diapolo,2012-10-02T22:14:43Z,"No code changes, only updated some code-layout in optionsmodel.cpp.\n",https://github.com/bitcoin/bitcoin/pull/1859#issuecomment-9089160,9089160,
Diapolo,2012-10-05T07:43:44Z,Can we get this fix into 0.7.1?\n,https://github.com/bitcoin/bitcoin/pull/1859#issuecomment-9167912,9167912,
laanwj,2012-10-05T08:26:12Z,"Yes as I said on the mailing list, that's the goal.\n\nAvoiding corner-case random crashes is always good.\n",https://github.com/bitcoin/bitcoin/pull/1859#issuecomment-9168694,9168694,
laanwj,2012-09-23T12:38:11Z,"Using one ""proxy info"" lock would be enough, no need for a separate one for the nameproxy.\n",https://github.com/bitcoin/bitcoin/pull/1859#discussion_r1668884,1668884,src/netbase.cpp
Diapolo,2012-09-23T16:24:35Z,"Indeed, fixed!\n",https://github.com/bitcoin/bitcoin/pull/1859#discussion_r1669104,1669104,src/netbase.cpp
gavinandresen,2012-09-25T20:31:16Z,"Holding the cs_proxyInfos lock all through ConnectSocket and it's subroutines is bad practice.\n\nHow about something like:\n`proxyType proxy;\n    {\n        LOCK(cs_proxyInfos);\n        proxy = proxyInfo[addrDest.GetNetwork()];\n    }`\n    ... proceed, with local copy of proxy...\n",https://github.com/bitcoin/bitcoin/pull/1859#discussion_r1689266,1689266,src/netbase.cpp
gavinandresen,2012-09-25T20:32:29Z,"Same comment here, maybe:\n    proxyType npInfo;\n    {\n          LOCK(); npInfo = nameproxyInfo;\n    }\n    ... then proceed to use npInfo instead of the static nameproxyInfo.\n",https://github.com/bitcoin/bitcoin/pull/1859#discussion_r1689282,1689282,src/netbase.cpp
laanwj,2012-09-26T10:26:44Z,"Or... We already have a GetProxy function to encapsulate getting values from proxyInfo, why not use it here?\n",https://github.com/bitcoin/bitcoin/pull/1859#discussion_r1693775,1693775,src/netbase.cpp
Diapolo,2012-09-26T14:04:35Z,"Just to understand, a lock is persistent in a function scope, right? So when I have a lock in a sub-function used in ConnectSocket it is released, when returning back to ConnectSocket.\n",https://github.com/bitcoin/bitcoin/pull/1859#discussion_r1695546,1695546,src/netbase.cpp
laanwj,2012-09-27T06:54:45Z,"A scoped lock is acquired where you define it with LOCK(), and it is released immediately at the end of the block (`}`) in which you define it. So, yes.\n",https://github.com/bitcoin/bitcoin/pull/1859#discussion_r1703575,1703575,src/netbase.cpp
sipa,2012-09-28T14:23:07Z,"What ""is"" a name proxy? I agree GetNameProxy() currently doesn't make sense either, but I'd go for HaveNameProxy().\n",https://github.com/bitcoin/bitcoin/pull/1859#discussion_r1717763,1717763,src/netbase.h
Diapolo,2012-09-28T14:35:12Z,"Seems better suited, yes.\n",https://github.com/bitcoin/bitcoin/pull/1859#discussion_r1717885,1717885,src/netbase.h
laanwj,2012-09-28T15:56:33Z,"<i>Edit: never mind, it does exactly what it says, I misunderstood the function.</i>\n",https://github.com/bitcoin/bitcoin/pull/1859#discussion_r1718836,1718836,src/netbase.cpp
laanwj,2012-09-28T15:59:27Z,"GetProxy already returns the same information (addrProxy, used), although in a slightly different form. Either keep this function or GetProxy, but we don't need both.\n",https://github.com/bitcoin/bitcoin/pull/1859#discussion_r1718876,1718876,src/netbase.cpp
Diapolo,2012-09-28T16:32:57Z,"GetProxy() returns a CService, but I need the CService AND SOCKS version for the requested net, see ConnectSocket().\nPerhaps you need to explain a little more :).\n\nEdit: ConnectSocket() uses both values of the pair .first and .second.\n",https://github.com/bitcoin/bitcoin/pull/1859#discussion_r1719282,1719282,src/netbase.cpp
laanwj,2012-09-28T16:52:02Z,"Yeah, so replace GetProxy to return a proxyType and use that. Returning all the information is better IMO. I just don't see the need for two functions, one which returns a subset of the information that the other does.\n",https://github.com/bitcoin/bitcoin/pull/1859#discussion_r1719459,1719459,src/netbase.cpp
sipa,2012-09-28T16:52:57Z,Agree with @laanwj \n,https://github.com/bitcoin/bitcoin/pull/1859#discussion_r1719468,1719468,src/netbase.cpp
Diapolo,2012-09-28T16:57:15Z,"I simply didn't understand what you wanted me to do ^^, now it's clear @laanwj.\nI'll update tomorrow!\n",https://github.com/bitcoin/bitcoin/pull/1859#discussion_r1719512,1719512,src/netbase.cpp
Diapolo,2012-09-29T09:46:20Z,"@laanwj I was asking myself, if this should be changed into, as data() returns active state for IP, port and SOCKS version, too.\n\n<pre>\n        case ProxyUse: {\n            proxyType proxy;\n            return QVariant(GetProxy(NET_IPV4, proxy));\n        }\n</pre>\n",https://github.com/bitcoin/bitcoin/pull/1859#discussion_r1723313,1723313,src/qt/optionsmodel.cpp
laanwj,2012-09-29T09:51:00Z,"Could be better because that better represents the current configuration, but leave that for a later pull. Aim to keep functionality precisely the same in these commits.\n",https://github.com/bitcoin/bitcoin/pull/1859#discussion_r1723318,1723318,src/qt/optionsmodel.cpp
laanwj,2012-09-29T09:54:22Z,This is new behavior -- I don't think you want to exit here with an error if there is no proxy\n,https://github.com/bitcoin/bitcoin/pull/1859#discussion_r1723320,1723320,src/netbase.cpp
laanwj,2012-09-29T09:54:44Z,Same here?\n,https://github.com/bitcoin/bitcoin/pull/1859#discussion_r1723321,1723321,src/netbase.cpp
Diapolo,2012-09-29T10:00:09Z,"Indeed, that's a fault, same for the below occurance!\nShould I memset the proxyType var to 0 or is this done by the compiler here?\n\nEdit: Should be safe to leave it, because of default constructors used, right :)?\n",https://github.com/bitcoin/bitcoin/pull/1859#discussion_r1723324,1723324,src/netbase.cpp
laanwj,2012-09-29T10:04:21Z,"No need to zero it explicitly. It's an object with constructor (std::pair) and not a POD (""Plain Old Data"") type. See  http://stackoverflow.com/questions/9025792/does-the-default-constructor-of-stdpair-set-basic-types-int-etc-to-zero\n",https://github.com/bitcoin/bitcoin/pull/1859#discussion_r1723327,1723327,src/netbase.cpp
Diapolo,2012-09-29T10:10:00Z,"Understood :), thanks for your valuable input master!\n",https://github.com/bitcoin/bitcoin/pull/1859#discussion_r1723337,1723337,src/qt/optionsmodel.cpp
laanwj,2012-10-04T02:21:37Z,"I'd suggest using the return value of GetProxy here, instead of querying proxy.second later on. It's a little bit more readable.\n",https://github.com/bitcoin/bitcoin/pull/1859#discussion_r1757736,1757736,src/netbase.cpp
Diapolo,2012-10-04T07:32:56Z,"Yes, good idea ... and updated :).\n",https://github.com/bitcoin/bitcoin/pull/1859#discussion_r1759006,1759006,src/netbase.cpp
