[
  {
    "sha": "970de70bdd3542e75b73c79b06f143168c361494",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5NzBkZTcwYmRkMzU0MmU3NWI3M2M3OWIwNmYxNDMxNjhjMzYxNDk0",
    "commit": {
      "author": {
        "name": "Matt Corallo",
        "email": "git@bluematt.me",
        "date": "2019-08-01T21:54:48Z"
      },
      "committer": {
        "name": "Matt Corallo",
        "email": "git@bluematt.me",
        "date": "2019-08-02T19:37:13Z"
      },
      "message": "Dump transaction version as an unsigned integer in RPC/TxToUniv\n\nConsensus-wise we already treat it as an unsigned integer (the\nonly rules around it are in CSV/locktime handling), but changing\nthe underlying data type means touching consensus code for a\nsimple cleanup change, which isn't really worth it.\n\nSee-also, https://github.com/rust-bitcoin/rust-bitcoin/pull/299",
      "tree": {
        "sha": "727c0319bc969dea20689051dcb7999b3fb1c0b0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/727c0319bc969dea20689051dcb7999b3fb1c0b0"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/970de70bdd3542e75b73c79b06f143168c361494",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/970de70bdd3542e75b73c79b06f143168c361494",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/970de70bdd3542e75b73c79b06f143168c361494",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/970de70bdd3542e75b73c79b06f143168c361494/comments",
    "author": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "e653eeff7651d823407e2e31a89176cc0b240c62",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e653eeff7651d823407e2e31a89176cc0b240c62",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/e653eeff7651d823407e2e31a89176cc0b240c62"
      }
    ],
    "stats": {
      "total": 14,
      "additions": 12,
      "deletions": 2
    },
    "files": [
      {
        "sha": "f042c875f892984da7b1af3cd683e2de3a476bc7",
        "filename": "doc/release-notes-16525.md",
        "status": "added",
        "additions": 7,
        "deletions": 0,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/970de70bdd3542e75b73c79b06f143168c361494/doc/release-notes-16525.md",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/970de70bdd3542e75b73c79b06f143168c361494/doc/release-notes-16525.md",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/doc/release-notes-16525.md?ref=970de70bdd3542e75b73c79b06f143168c361494",
        "patch": "@@ -0,0 +1,7 @@\n+RPC changes\n+-----------\n+\n+Exposed transaction version numbers are now treated as unsigned 32-bit integers\n+instead of signed 32-bit integers. This matches their treatment in consensus\n+logic. Versions greater than 2 continue to be non-standard (matching previous\n+behavior of smaller than 1 or greater than 2 being non-standard)."
      },
      {
        "sha": "c7049eb16ca0adc065fb5961c74950dc738efdf2",
        "filename": "src/core_write.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 1,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/970de70bdd3542e75b73c79b06f143168c361494/src/core_write.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/970de70bdd3542e75b73c79b06f143168c361494/src/core_write.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/core_write.cpp?ref=970de70bdd3542e75b73c79b06f143168c361494",
        "patch": "@@ -179,7 +179,9 @@ void TxToUniv(const CTransaction& tx, const uint256& hashBlock, UniValue& entry,\n {\n     entry.pushKV(\"txid\", tx.GetHash().GetHex());\n     entry.pushKV(\"hash\", tx.GetWitnessHash().GetHex());\n-    entry.pushKV(\"version\", tx.nVersion);\n+    // Transaction version is actually unsigned in consensus checks, just signed in memory,\n+    // so cast to unsigned before giving it to the user.\n+    entry.pushKV(\"version\", static_cast<int64_t>(static_cast<uint32_t>(tx.nVersion)));\n     entry.pushKV(\"size\", (int)::GetSerializeSize(tx, PROTOCOL_VERSION));\n     entry.pushKV(\"vsize\", (GetTransactionWeight(tx) + WITNESS_SCALE_FACTOR - 1) / WITNESS_SCALE_FACTOR);\n     entry.pushKV(\"weight\", GetTransactionWeight(tx));"
      },
      {
        "sha": "c2b80bc3dd44cc02b0d2545707442e1cee34ef96",
        "filename": "test/functional/rpc_rawtransaction.py",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/970de70bdd3542e75b73c79b06f143168c361494/test/functional/rpc_rawtransaction.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/970de70bdd3542e75b73c79b06f143168c361494/test/functional/rpc_rawtransaction.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/rpc_rawtransaction.py?ref=970de70bdd3542e75b73c79b06f143168c361494",
        "patch": "@@ -417,11 +417,12 @@ def run_test(self):\n         ####################################\n \n         # Test the minimum transaction version number that fits in a signed 32-bit integer.\n+        # As transaction version is unsigned, this should convert to its unsigned equivalent.\n         tx = CTransaction()\n         tx.nVersion = -0x80000000\n         rawtx = ToHex(tx)\n         decrawtx = self.nodes[0].decoderawtransaction(rawtx)\n-        assert_equal(decrawtx['version'], -0x80000000)\n+        assert_equal(decrawtx['version'], 0x80000000)\n \n         # Test the maximum transaction version number that fits in a signed 32-bit integer.\n         tx = CTransaction()"
      }
    ]
  },
  {
    "sha": "e80259f1976545e4f1ab6a420644be0c32261773",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzplODAyNTlmMTk3NjU0NWU0ZjFhYjZhNDIwNjQ0YmUwYzMyMjYxNzcz",
    "commit": {
      "author": {
        "name": "Matt Corallo",
        "email": "git@bluematt.me",
        "date": "2019-09-03T14:53:45Z"
      },
      "committer": {
        "name": "Matt Corallo",
        "email": "git@bluematt.me",
        "date": "2019-09-03T14:53:45Z"
      },
      "message": "Additionally treat Tx.nVersion as unsigned in joinpsbts\n\nThis gets its own release note callout, though doesn't appear to\nviolate the BIP as the BIP appears to be underspecified. We\nprobably want to update BIP 174 to mention how version numbers are\ncombined.",
      "tree": {
        "sha": "a4733981df0b7e7cfad3b08c5d87eaff611a320d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a4733981df0b7e7cfad3b08c5d87eaff611a320d"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e80259f1976545e4f1ab6a420644be0c32261773",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e80259f1976545e4f1ab6a420644be0c32261773",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/e80259f1976545e4f1ab6a420644be0c32261773",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e80259f1976545e4f1ab6a420644be0c32261773/comments",
    "author": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "970de70bdd3542e75b73c79b06f143168c361494",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/970de70bdd3542e75b73c79b06f143168c361494",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/970de70bdd3542e75b73c79b06f143168c361494"
      }
    ],
    "stats": {
      "total": 12,
      "additions": 7,
      "deletions": 5
    },
    "files": [
      {
        "sha": "220cb78de422ee927b6cbf0df3120cda0cb4c802",
        "filename": "doc/release-notes-16525.md",
        "status": "modified",
        "additions": 3,
        "deletions": 1,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e80259f1976545e4f1ab6a420644be0c32261773/doc/release-notes-16525.md",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e80259f1976545e4f1ab6a420644be0c32261773/doc/release-notes-16525.md",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/doc/release-notes-16525.md?ref=e80259f1976545e4f1ab6a420644be0c32261773",
        "patch": "@@ -4,4 +4,6 @@ RPC changes\n Exposed transaction version numbers are now treated as unsigned 32-bit integers\n instead of signed 32-bit integers. This matches their treatment in consensus\n logic. Versions greater than 2 continue to be non-standard (matching previous\n-behavior of smaller than 1 or greater than 2 being non-standard).\n+behavior of smaller than 1 or greater than 2 being non-standard). Note that\n+this includes the joinpsbt command, which combines partially-signed\n+transactions by selecting the highest version number."
      },
      {
        "sha": "0abc2d26b961d5b0145a9ae2b9ef8d9a5d69b2d4",
        "filename": "src/rpc/rawtransaction.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 4,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e80259f1976545e4f1ab6a420644be0c32261773/src/rpc/rawtransaction.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e80259f1976545e4f1ab6a420644be0c32261773/src/rpc/rawtransaction.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpc/rawtransaction.cpp?ref=e80259f1976545e4f1ab6a420644be0c32261773",
        "patch": "@@ -1566,7 +1566,7 @@ UniValue joinpsbts(const JSONRPCRequest& request)\n         throw JSONRPCError(RPC_INVALID_PARAMETER, \"At least two PSBTs are required to join PSBTs.\");\n     }\n \n-    int32_t best_version = 1;\n+    uint32_t best_version = 1;\n     uint32_t best_locktime = 0xffffffff;\n     for (unsigned int i = 0; i < txs.size(); ++i) {\n         PartiallySignedTransaction psbtx;\n@@ -1576,8 +1576,8 @@ UniValue joinpsbts(const JSONRPCRequest& request)\n         }\n         psbtxs.push_back(psbtx);\n         // Choose the highest version number\n-        if (psbtx.tx->nVersion > best_version) {\n-            best_version = psbtx.tx->nVersion;\n+        if (static_cast<uint32_t>(psbtx.tx->nVersion) > best_version) {\n+            best_version = static_cast<uint32_t>(psbtx.tx->nVersion);\n         }\n         // Choose the lowest lock time\n         if (psbtx.tx->nLockTime < best_locktime) {\n@@ -1588,7 +1588,7 @@ UniValue joinpsbts(const JSONRPCRequest& request)\n     // Create a blank psbt where everything will be added\n     PartiallySignedTransaction merged_psbt;\n     merged_psbt.tx = CMutableTransaction();\n-    merged_psbt.tx->nVersion = best_version;\n+    merged_psbt.tx->nVersion = static_cast<int32_t>(best_version);\n     merged_psbt.tx->nLockTime = best_locktime;\n \n     // Merge"
      }
    ]
  }
]