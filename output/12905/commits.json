[
  {
    "sha": "662d19ff7217d0e6c7975ca311933f640955a53e",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo2NjJkMTlmZjcyMTdkMGU2Yzc5NzVjYTMxMTkzM2Y2NDA5NTVhNTNl",
    "commit": {
      "author": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@gmail.com",
        "date": "2018-04-06T15:54:52Z"
      },
      "committer": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@gmail.com",
        "date": "2018-04-08T14:44:40Z"
      },
      "message": "[rpcwallet] Clamp walletpassphrase value at 100M seconds\n\nLarger values seem to trigger a bug on macos+libevent (resulting in the\nrpc server stopping).",
      "tree": {
        "sha": "7fc68d02f388490c3a2b6d03d5ebbf3b2f3e0409",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7fc68d02f388490c3a2b6d03d5ebbf3b2f3e0409"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/662d19ff7217d0e6c7975ca311933f640955a53e",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/662d19ff7217d0e6c7975ca311933f640955a53e",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/662d19ff7217d0e6c7975ca311933f640955a53e",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/662d19ff7217d0e6c7975ca311933f640955a53e/comments",
    "author": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "1d540046fe47eb7b6062c55ebebd801ece96231c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1d540046fe47eb7b6062c55ebebd801ece96231c",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/1d540046fe47eb7b6062c55ebebd801ece96231c"
      }
    ],
    "stats": {
      "total": 19,
      "additions": 10,
      "deletions": 9
    },
    "files": [
      {
        "sha": "09e8a3fbabab838ab8762fdcd4e1f6a7596dd875",
        "filename": "src/wallet/rpcwallet.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 5,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/662d19ff7217d0e6c7975ca311933f640955a53e/src/wallet/rpcwallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/662d19ff7217d0e6c7975ca311933f640955a53e/src/wallet/rpcwallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcwallet.cpp?ref=662d19ff7217d0e6c7975ca311933f640955a53e",
        "patch": "@@ -2349,8 +2349,7 @@ UniValue walletpassphrase(const JSONRPCRequest& request)\n             \"This is needed prior to performing transactions related to private keys such as sending bitcoins\\n\"\n             \"\\nArguments:\\n\"\n             \"1. \\\"passphrase\\\"     (string, required) The wallet passphrase\\n\"\n-            \"2. timeout            (numeric, required) The time to keep the decryption key in seconds. Limited to at most 1073741824 (2^30) seconds.\\n\"\n-            \"                                          Any value greater than 1073741824 seconds will be set to 1073741824 seconds.\\n\"\n+            \"2. timeout            (numeric, required) The time to keep the decryption key in seconds; capped at 100000000 (~3 years).\\n\"\n             \"\\nNote:\\n\"\n             \"Issuing the walletpassphrase command while the wallet is already unlocked will set a new unlock\\n\"\n             \"time that overrides the old one.\\n\"\n@@ -2383,9 +2382,10 @@ UniValue walletpassphrase(const JSONRPCRequest& request)\n     if (nSleepTime < 0) {\n         throw JSONRPCError(RPC_INVALID_PARAMETER, \"Timeout cannot be negative.\");\n     }\n-    // Clamp timeout to 2^30 seconds\n-    if (nSleepTime > (int64_t)1 << 30) {\n-        nSleepTime = (int64_t)1 << 30;\n+    // Clamp timeout\n+    constexpr int64_t MAX_SLEEP_TIME = 100000000; // larger values trigger a macos/libevent bug?\n+    if (nSleepTime > MAX_SLEEP_TIME) {\n+        nSleepTime = MAX_SLEEP_TIME;\n     }\n \n     if (strWalletPass.length() > 0)"
      },
      {
        "sha": "64ee6787449c346530e2a9dc081e9a8948c9fc80",
        "filename": "test/functional/wallet_encryption.py",
        "status": "modified",
        "additions": 5,
        "deletions": 4,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/662d19ff7217d0e6c7975ca311933f640955a53e/test/functional/wallet_encryption.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/662d19ff7217d0e6c7975ca311933f640955a53e/test/functional/wallet_encryption.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/wallet_encryption.py?ref=662d19ff7217d0e6c7975ca311933f640955a53e",
        "patch": "@@ -64,14 +64,15 @@ def run_test(self):\n         assert_raises_rpc_error(-8, \"Timeout cannot be negative.\", self.nodes[0].walletpassphrase, passphrase2, -10)\n         # Check the timeout\n         # Check a time less than the limit\n-        expected_time = int(time.time()) + (1 << 30) - 600\n-        self.nodes[0].walletpassphrase(passphrase2, (1 << 30) - 600)\n+        MAX_VALUE = 100000000\n+        expected_time = int(time.time()) + MAX_VALUE - 600\n+        self.nodes[0].walletpassphrase(passphrase2, MAX_VALUE - 600)\n         actual_time = self.nodes[0].getwalletinfo()['unlocked_until']\n         assert_greater_than_or_equal(actual_time, expected_time)\n         assert_greater_than(expected_time + 5, actual_time) # 5 second buffer\n         # Check a time greater than the limit\n-        expected_time = int(time.time()) + (1 << 30) - 1\n-        self.nodes[0].walletpassphrase(passphrase2, (1 << 33))\n+        expected_time = int(time.time()) + MAX_VALUE - 1\n+        self.nodes[0].walletpassphrase(passphrase2, MAX_VALUE + 1000)\n         actual_time = self.nodes[0].getwalletinfo()['unlocked_until']\n         assert_greater_than_or_equal(actual_time, expected_time)\n         assert_greater_than(expected_time + 5, actual_time) # 5 second buffer"
      }
    ]
  },
  {
    "sha": "2b2b96cd452bd08537310ce78bee9cbf6f43c10e",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyYjJiOTZjZDQ1MmJkMDg1MzczMTBjZTc4YmVlOWNiZjZmNDNjMTBl",
    "commit": {
      "author": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@gmail.com",
        "date": "2018-04-06T19:05:32Z"
      },
      "committer": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@gmail.com",
        "date": "2018-04-08T14:44:40Z"
      },
      "message": "Use std::bind instead of boost::bind to re-lock the wallet\n\nChange suggested by Marco Falke.",
      "tree": {
        "sha": "51db752a5c539d75e6e050ebe839ed8aa30191f9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/51db752a5c539d75e6e050ebe839ed8aa30191f9"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2b2b96cd452bd08537310ce78bee9cbf6f43c10e",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2b2b96cd452bd08537310ce78bee9cbf6f43c10e",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/2b2b96cd452bd08537310ce78bee9cbf6f43c10e",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2b2b96cd452bd08537310ce78bee9cbf6f43c10e/comments",
    "author": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "662d19ff7217d0e6c7975ca311933f640955a53e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/662d19ff7217d0e6c7975ca311933f640955a53e",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/662d19ff7217d0e6c7975ca311933f640955a53e"
      }
    ],
    "stats": {
      "total": 4,
      "additions": 3,
      "deletions": 1
    },
    "files": [
      {
        "sha": "29760a7092f71eda1a419906273b4e624e5aaa9d",
        "filename": "src/wallet/rpcwallet.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 1,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2b2b96cd452bd08537310ce78bee9cbf6f43c10e/src/wallet/rpcwallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2b2b96cd452bd08537310ce78bee9cbf6f43c10e/src/wallet/rpcwallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcwallet.cpp?ref=2b2b96cd452bd08537310ce78bee9cbf6f43c10e",
        "patch": "@@ -37,6 +37,8 @@\n \n #include <univalue.h>\n \n+#include <functional>\n+\n static const std::string WALLET_ENDPOINT_BASE = \"/wallet/\";\n \n CWallet *GetWalletForJSONRPCRequest(const JSONRPCRequest& request)\n@@ -2402,7 +2404,7 @@ UniValue walletpassphrase(const JSONRPCRequest& request)\n     pwallet->TopUpKeyPool();\n \n     pwallet->nRelockTime = GetTime() + nSleepTime;\n-    RPCRunLater(strprintf(\"lockwallet(%s)\", pwallet->GetName()), boost::bind(LockWallet, pwallet), nSleepTime);\n+    RPCRunLater(strprintf(\"lockwallet(%s)\", pwallet->GetName()), std::bind(LockWallet, pwallet), nSleepTime);\n \n     return NullUniValue;\n }"
      }
    ]
  }
]