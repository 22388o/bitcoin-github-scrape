[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/360673845",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12273#issuecomment-360673845",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12273",
    "id": 360673845,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MDY3Mzg0NQ==",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-26T03:22:20Z",
    "updated_at": "2018-01-26T03:22:20Z",
    "author_association": "MEMBER",
    "body": "This was hit twice on travis, you might find one of the logs here https://travis-ci.org/bitcoin/bitcoin/jobs/332197296 (might disappear soon, on reset)",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/360673845/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/360994681",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12273#issuecomment-360994681",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12273",
    "id": 360994681,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MDk5NDY4MQ==",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?u=4a9af998e1a560b3f49c3827f453e1bcbe6a5cfb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-27T16:07:21Z",
    "updated_at": "2018-01-27T16:07:21Z",
    "author_association": "MEMBER",
    "body": "> A bit more background - we (essentially) use mempool.cs as a read lock and cs_main as a write lock for the mempool.\r\n\r\nWhy not just use `mempool.cs` for both read and write? Stopping a lot of stuff just to dump the mempool sounds bad.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/360994681/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/360998784",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12273#issuecomment-360998784",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12273",
    "id": 360998784,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MDk5ODc4NA==",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-27T17:09:30Z",
    "updated_at": "2018-01-27T17:09:30Z",
    "author_association": "MEMBER",
    "body": "@promag Pull request welcome, but I'd prefer not to do major refactoring in a bug-fix pull request.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/360998784/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/361019806",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12273#issuecomment-361019806",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12273",
    "id": 361019806,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MTAxOTgwNg==",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?u=4a9af998e1a560b3f49c3827f453e1bcbe6a5cfb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-27T22:17:26Z",
    "updated_at": "2018-01-27T22:17:26Z",
    "author_association": "MEMBER",
    "body": "Thanks for the explanation @MarcoFalke.\r\n\r\nIMHO, and to cover other possible cases, `cs_main` could be locked right before returning in `SyncWithValidationInterfaceQueue`:\r\n```cpp\r\nvoid SyncWithValidationInterfaceQueue() {\r\n    AssertLockNotHeld(cs_main);\r\n    // Block until the validation queue drains\r\n    std::promise<void> promise;\r\n    CallFunctionInValidationInterfaceQueue([&promise] {\r\n        promise.set_value();\r\n    });\r\n    promise.get_future().wait();\r\n    // Block until other tasks holding cs_main finish\r\n    LOCK(cs_main);\r\n}\r\n```\r\nOr in `syncwithvalidationinterface` RPC after `SyncWithValidationInterfaceQueue()`.\r\n\r\nThis alternative acknowledges it's not a `getrawmempool` bug.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/361019806/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/361072650",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12273#issuecomment-361072650",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12273",
    "id": 361072650,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MTA3MjY1MA==",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-28T15:50:01Z",
    "updated_at": "2018-01-28T15:50:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "No, we should not take a cs_main in SyncWithValidationInterface. The bug here is mempool.cs - we're using it as a read lock but not holding cs_main during the whole \"write\" in ATMP. The fix here is fine - sync getrawmempool with ATMP (as it should be). Alternatively we could hold cs_main for longer in ATMP, but adding a cs_main to validationinterface to fix a mempool-specific bug is way overkill.\n\nMedium-term (ie post-0.16) we should look into making cs_main a read/write/upgrade lock for real and then this should fall out.\n\nOn January 27, 2018 10:17:34 PM UTC, \"Jo\u00e3o Barbosa\" <notifications@github.com> wrote:\n>Thanks for the explanation @MarcoFalke.\n>\n>IMHO, and to cover other possible cases, `cs_main` could be locked\n>right before returning in `SyncWithValidationInterfaceQueue`:\n>```cpp\n>void SyncWithValidationInterfaceQueue() {\n>    AssertLockNotHeld(cs_main);\n>    // Block until the validation queue drains\n>    std::promise<void> promise;\n>    CallFunctionInValidationInterfaceQueue([&promise] {\n>        promise.set_value();\n>    });\n>    promise.get_future().wait();\n>    // Block until other tasks holding cs_main finish\n>    LOCK(cs_main);\n>}\n>```\n>Or in `syncwithvalidationinterface` RPC after\n>`SyncWithValidationInterfaceQueue()`.\n>\n>This alternative acknowledges it's not a `getrawmempool` bug.\n>\n>-- \n>You are receiving this because you commented.\n>Reply to this email directly or view it on GitHub:\n>https://github.com/bitcoin/bitcoin/pull/12273#issuecomment-361019806\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/361072650/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/362854566",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12273#issuecomment-362854566",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12273",
    "id": 362854566,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2Mjg1NDU2Ng==",
    "user": {
      "login": "devrandom",
      "id": 107096,
      "node_id": "MDQ6VXNlcjEwNzA5Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/107096?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/devrandom",
      "html_url": "https://github.com/devrandom",
      "followers_url": "https://api.github.com/users/devrandom/followers",
      "following_url": "https://api.github.com/users/devrandom/following{/other_user}",
      "gists_url": "https://api.github.com/users/devrandom/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/devrandom/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/devrandom/subscriptions",
      "organizations_url": "https://api.github.com/users/devrandom/orgs",
      "repos_url": "https://api.github.com/users/devrandom/repos",
      "events_url": "https://api.github.com/users/devrandom/events{/privacy}",
      "received_events_url": "https://api.github.com/users/devrandom/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-03T21:10:16Z",
    "updated_at": "2018-02-03T21:10:16Z",
    "author_association": "NONE",
    "body": "The question for me is whether the production (i.e. non-test) use of `getrawmempool` benefits from the added synchronization.  If taking the lock is only to synchronize against the test-only `syncwithvalidationinterface`, then it doesn't seem right to pay the lock cost in a production path. \r\n\r\nAlso, looking at the code, it does seem like cs_main is held for all of ATMP, so I don't understand the comment from @TheBlueMatt.\r\n\r\nIt seems to me that `{ LOCK(cs_main); }` at the start of `syncwithvalidationinterface` should work fine (i.e. lock and immediate release).",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/362854566/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/362855145",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12273#issuecomment-362855145",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12273",
    "id": 362855145,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2Mjg1NTE0NQ==",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?u=4a9af998e1a560b3f49c3827f453e1bcbe6a5cfb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-03T21:19:13Z",
    "updated_at": "2018-02-03T21:19:13Z",
    "author_association": "MEMBER",
    "body": "The idea is to guarantee the result has transactions already processed and are not in the queue to be processed. Once the lock is acquired before returning means that ATMP finished.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/362855145/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/362855882",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12273#issuecomment-362855882",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12273",
    "id": 362855882,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2Mjg1NTg4Mg==",
    "user": {
      "login": "devrandom",
      "id": 107096,
      "node_id": "MDQ6VXNlcjEwNzA5Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/107096?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/devrandom",
      "html_url": "https://github.com/devrandom",
      "followers_url": "https://api.github.com/users/devrandom/followers",
      "following_url": "https://api.github.com/users/devrandom/following{/other_user}",
      "gists_url": "https://api.github.com/users/devrandom/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/devrandom/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/devrandom/subscriptions",
      "organizations_url": "https://api.github.com/users/devrandom/orgs",
      "repos_url": "https://api.github.com/users/devrandom/repos",
      "events_url": "https://api.github.com/users/devrandom/events{/privacy}",
      "received_events_url": "https://api.github.com/users/devrandom/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-03T21:29:43Z",
    "updated_at": "2018-02-03T21:29:43Z",
    "author_association": "NONE",
    "body": "How does the user of `getrawmempool` use that synchronization guarantee?  i.e. what followup would be invalid if the tx is not completely processed?\r\n\r\n(we can move to IRC if this is too much back and forth)",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/362855882/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/362857442",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12273#issuecomment-362857442",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12273",
    "id": 362857442,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2Mjg1NzQ0Mg==",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?u=4a9af998e1a560b3f49c3827f453e1bcbe6a5cfb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-03T21:52:10Z",
    "updated_at": "2018-02-03T21:52:10Z",
    "author_association": "MEMBER",
    "body": "@TheBlueMatt explains above https://github.com/bitcoin/bitcoin/pull/12273#pullrequestreview-91735276.\r\n\r\nI don't think this is a production/mainnet concern.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/362857442/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/362860617",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12273#issuecomment-362860617",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12273",
    "id": 362860617,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2Mjg2MDYxNw==",
    "user": {
      "login": "devrandom",
      "id": 107096,
      "node_id": "MDQ6VXNlcjEwNzA5Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/107096?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/devrandom",
      "html_url": "https://github.com/devrandom",
      "followers_url": "https://api.github.com/users/devrandom/followers",
      "following_url": "https://api.github.com/users/devrandom/following{/other_user}",
      "gists_url": "https://api.github.com/users/devrandom/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/devrandom/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/devrandom/subscriptions",
      "organizations_url": "https://api.github.com/users/devrandom/orgs",
      "repos_url": "https://api.github.com/users/devrandom/repos",
      "events_url": "https://api.github.com/users/devrandom/events{/privacy}",
      "received_events_url": "https://api.github.com/users/devrandom/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-03T22:32:49Z",
    "updated_at": "2018-02-03T22:32:49Z",
    "author_association": "NONE",
    "body": "I understand the comment you linked.  It still seems a bit better to solve the test issue by synchronizing an RPC call that is never used in production rather than `getrawmempool`, which could be used in production.  But the performance difference is likely very small, so it's not a strong concern.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/362860617/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/363474029",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12273#issuecomment-363474029",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12273",
    "id": 363474029,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MzQ3NDAyOQ==",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-06T16:14:05Z",
    "updated_at": "2018-02-06T16:14:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "I disagree wholly that this is not a \"production concern\" - we could absolutely have users who are doing a getrawmempool and then calling wallet functions based on the result, introducing a new race for them. I believe we should be marking this 0.16 as a regression.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/363474029/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/363475766",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12273#issuecomment-363475766",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12273",
    "id": 363475766,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MzQ3NTc2Ng==",
    "user": {
      "login": "devrandom",
      "id": 107096,
      "node_id": "MDQ6VXNlcjEwNzA5Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/107096?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/devrandom",
      "html_url": "https://github.com/devrandom",
      "followers_url": "https://api.github.com/users/devrandom/followers",
      "following_url": "https://api.github.com/users/devrandom/following{/other_user}",
      "gists_url": "https://api.github.com/users/devrandom/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/devrandom/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/devrandom/subscriptions",
      "organizations_url": "https://api.github.com/users/devrandom/orgs",
      "repos_url": "https://api.github.com/users/devrandom/repos",
      "events_url": "https://api.github.com/users/devrandom/events{/privacy}",
      "received_events_url": "https://api.github.com/users/devrandom/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-06T16:18:29Z",
    "updated_at": "2018-02-06T16:18:29Z",
    "author_association": "NONE",
    "body": "Wouldn't all such followup actions take `cs_main`, so would be safe?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/363475766/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/363476365",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12273#issuecomment-363476365",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12273",
    "id": 363476365,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MzQ3NjM2NQ==",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-06T16:19:55Z",
    "updated_at": "2018-02-06T16:19:55Z",
    "author_association": "CONTRIBUTOR",
    "body": "Err, sorry, not wallet calls, sendrawtransaction followed by a getrawmempool to verify its there - if we can hit a realistic race in testing we probably should consider it a potentially-production-issue.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/363476365/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/363478702",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12273#issuecomment-363478702",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12273",
    "id": 363478702,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MzQ3ODcwMg==",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?u=4a9af998e1a560b3f49c3827f453e1bcbe6a5cfb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-06T16:26:26Z",
    "updated_at": "2018-02-06T16:26:26Z",
    "author_association": "MEMBER",
    "body": "> Err, sorry, not wallet calls, sendrawtransaction followed by a getrawmempool to verify its there\r\n\r\n`sendrawtransaction` fails if rejected by mempool. But it's a regression like you said.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/363478702/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/363480637",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12273#issuecomment-363480637",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12273",
    "id": 363480637,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MzQ4MDYzNw==",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-06T16:32:30Z",
    "updated_at": "2018-02-06T16:32:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "One naive usage (which is already at least somewhat racy, but...) would be to do a getrawmempool to cheaply look up a transaction you just sent's fee. Not a massive deal, but definitely a regression worth fixing.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/363480637/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/363490673",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12273#issuecomment-363490673",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12273",
    "id": 363490673,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MzQ5MDY3Mw==",
    "user": {
      "login": "devrandom",
      "id": 107096,
      "node_id": "MDQ6VXNlcjEwNzA5Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/107096?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/devrandom",
      "html_url": "https://github.com/devrandom",
      "followers_url": "https://api.github.com/users/devrandom/followers",
      "following_url": "https://api.github.com/users/devrandom/following{/other_user}",
      "gists_url": "https://api.github.com/users/devrandom/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/devrandom/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/devrandom/subscriptions",
      "organizations_url": "https://api.github.com/users/devrandom/orgs",
      "repos_url": "https://api.github.com/users/devrandom/repos",
      "events_url": "https://api.github.com/users/devrandom/events{/privacy}",
      "received_events_url": "https://api.github.com/users/devrandom/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-06T16:59:51Z",
    "updated_at": "2018-02-06T16:59:51Z",
    "author_association": "NONE",
    "body": "With the proposed fix, `sendrawtransaction` followed by a `getrawmempool` is *not* guaranteed to return the sent transaction, since the lock is taken after the results are computed.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/363490673/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/363507269",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12273#issuecomment-363507269",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12273",
    "id": 363507269,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MzUwNzI2OQ==",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-06T17:51:20Z",
    "updated_at": "2018-02-06T17:51:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "Oh, I seem to have confused myself an mis-remembered the issue here - you cannot hit this purely from RPC, but can hit wallet errors:\r\nIf you're polling getrawmempool to wait for a transaction to appear in your mempool, you can then race ATMP and, thus, see a balance that is as-of an old mempool and not the one you just got out of getrawmempool",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/363507269/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/363525368",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12273#issuecomment-363525368",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12273",
    "id": 363525368,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MzUyNTM2OA==",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-06T18:50:26Z",
    "updated_at": "2018-02-06T18:50:26Z",
    "author_association": "MEMBER",
    "body": "Changed milestone to 0.16",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/363525368/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/363526810",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12273#issuecomment-363526810",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12273",
    "id": 363526810,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MzUyNjgxMA==",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-06T18:55:11Z",
    "updated_at": "2018-02-06T18:55:11Z",
    "author_association": "MEMBER",
    "body": "There has been too much discussion around this simple fix.\r\n\r\nClosing in favor of  #12368",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/363526810/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/164023957",
    "pull_request_review_id": 91735276,
    "id": 164023957,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2NDAyMzk1Nw==",
    "diff_hunk": "@@ -444,12 +444,18 @@ UniValue getrawmempool(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawmempool\", \"true\")\n             + HelpExampleRpc(\"getrawmempool\", \"true\")\n         );\n+    }\n \n     bool fVerbose = false;\n-    if (!request.params[0].isNull())\n+    if (!request.params[0].isNull()) {\n         fVerbose = request.params[0].get_bool();\n+    }\n+\n+    const UniValue txpool_json{mempoolToJSON(fVerbose)};\n \n-    return mempoolToJSON(fVerbose);\n+    // Wait for ATMP calling thread to release the write lock:\n+    LOCK(cs_main);",
    "path": "src/rpc/blockchain.cpp",
    "position": 25,
    "original_position": 25,
    "commit_id": "fabac46d05c05cde244ef08b13c9f8f17c428eea",
    "original_commit_id": "fabac46d05c05cde244ef08b13c9f8f17c428eea",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This needs to go before mempoolToJONS, no? ie just do a { LOCK(cs_main); }.",
    "created_at": "2018-01-26T02:39:34Z",
    "updated_at": "2018-01-26T02:48:05Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12273#discussion_r164023957",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12273",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/164023957"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12273#discussion_r164023957"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12273"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/164023957/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 457,
    "original_line": 457,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/164026429",
    "pull_request_review_id": 91738047,
    "id": 164026429,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2NDAyNjQyOQ==",
    "diff_hunk": "@@ -444,12 +444,18 @@ UniValue getrawmempool(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawmempool\", \"true\")\n             + HelpExampleRpc(\"getrawmempool\", \"true\")\n         );\n+    }\n \n     bool fVerbose = false;\n-    if (!request.params[0].isNull())\n+    if (!request.params[0].isNull()) {\n         fVerbose = request.params[0].get_bool();\n+    }\n+\n+    const UniValue txpool_json{mempoolToJSON(fVerbose)};\n \n-    return mempoolToJSON(fVerbose);\n+    // Wait for ATMP calling thread to release the write lock:\n+    LOCK(cs_main);",
    "path": "src/rpc/blockchain.cpp",
    "position": 25,
    "original_position": 25,
    "commit_id": "fabac46d05c05cde244ef08b13c9f8f17c428eea",
    "original_commit_id": "fabac46d05c05cde244ef08b13c9f8f17c428eea",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Acquiring the lock and immediately giving it back to the ATMP calling thread will not solve any races. (At least on my machine I can still see them.)\r\n\r\nI guess, I could hold it for the whole duration of getrawmempool, if that is what you like.",
    "created_at": "2018-01-26T03:05:50Z",
    "updated_at": "2018-01-26T03:05:50Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12273#discussion_r164026429",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12273",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/164026429"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12273#discussion_r164026429"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12273"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/164026429/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 457,
    "original_line": 457,
    "side": "RIGHT",
    "in_reply_to_id": 164023957
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/164026988",
    "pull_request_review_id": 91738647,
    "id": 164026988,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2NDAyNjk4OA==",
    "diff_hunk": "@@ -444,12 +444,18 @@ UniValue getrawmempool(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawmempool\", \"true\")\n             + HelpExampleRpc(\"getrawmempool\", \"true\")\n         );\n+    }\n \n     bool fVerbose = false;\n-    if (!request.params[0].isNull())\n+    if (!request.params[0].isNull()) {\n         fVerbose = request.params[0].get_bool();\n+    }\n+\n+    const UniValue txpool_json{mempoolToJSON(fVerbose)};\n \n-    return mempoolToJSON(fVerbose);\n+    // Wait for ATMP calling thread to release the write lock:\n+    LOCK(cs_main);",
    "path": "src/rpc/blockchain.cpp",
    "position": 25,
    "original_position": 25,
    "commit_id": "fabac46d05c05cde244ef08b13c9f8f17c428eea",
    "original_commit_id": "fabac46d05c05cde244ef08b13c9f8f17c428eea",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Ah, oops, yes, sorry, indeed, wrong direction. I guess this is fine for now, but we really need to kill the mempool.cs/cs_main garbage.",
    "created_at": "2018-01-26T03:12:07Z",
    "updated_at": "2018-01-26T03:12:07Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12273#discussion_r164026988",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12273",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/164026988"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12273#discussion_r164026988"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12273"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/164026988/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 457,
    "original_line": 457,
    "side": "RIGHT",
    "in_reply_to_id": 164023957
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/164274736",
    "pull_request_review_id": 92028591,
    "id": 164274736,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2NDI3NDczNg==",
    "diff_hunk": "@@ -444,12 +444,18 @@ UniValue getrawmempool(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawmempool\", \"true\")\n             + HelpExampleRpc(\"getrawmempool\", \"true\")\n         );\n+    }\n \n     bool fVerbose = false;\n-    if (!request.params[0].isNull())\n+    if (!request.params[0].isNull()) {\n         fVerbose = request.params[0].get_bool();\n+    }\n+\n+    const UniValue txpool_json{mempoolToJSON(fVerbose)};\n \n-    return mempoolToJSON(fVerbose);\n+    // Wait for ATMP calling thread to release the write lock:\n+    LOCK(cs_main);",
    "path": "src/rpc/blockchain.cpp",
    "position": 25,
    "original_position": 25,
    "commit_id": "fabac46d05c05cde244ef08b13c9f8f17c428eea",
    "original_commit_id": "fabac46d05c05cde244ef08b13c9f8f17c428eea",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I don't understand why does it matter waiting for `cs_main` when the result is already determined. ",
    "created_at": "2018-01-27T16:03:39Z",
    "updated_at": "2018-01-27T16:03:39Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12273#discussion_r164274736",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12273",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/164274736"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12273#discussion_r164274736"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12273"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/164274736/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 457,
    "original_line": 457,
    "side": "RIGHT",
    "in_reply_to_id": 164023957
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/164276208",
    "pull_request_review_id": 92030114,
    "id": 164276208,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2NDI3NjIwOA==",
    "diff_hunk": "@@ -444,12 +444,18 @@ UniValue getrawmempool(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawmempool\", \"true\")\n             + HelpExampleRpc(\"getrawmempool\", \"true\")\n         );\n+    }\n \n     bool fVerbose = false;\n-    if (!request.params[0].isNull())\n+    if (!request.params[0].isNull()) {\n         fVerbose = request.params[0].get_bool();\n+    }\n+\n+    const UniValue txpool_json{mempoolToJSON(fVerbose)};\n \n-    return mempoolToJSON(fVerbose);\n+    // Wait for ATMP calling thread to release the write lock:\n+    LOCK(cs_main);",
    "path": "src/rpc/blockchain.cpp",
    "position": 25,
    "original_position": 25,
    "commit_id": "fabac46d05c05cde244ef08b13c9f8f17c428eea",
    "original_commit_id": "fabac46d05c05cde244ef08b13c9f8f17c428eea",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "We want to wait for https://github.com/bitcoin/bitcoin/blob/8470e64724cb4a668079e7516dc61ec230346618/src/validation.cpp#L974\r\nwhich happens under `cs_main`, not `pool.cs`.",
    "created_at": "2018-01-27T17:07:35Z",
    "updated_at": "2018-01-27T17:07:35Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12273#discussion_r164276208",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12273",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/164276208"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12273#discussion_r164276208"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12273"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/164276208/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 457,
    "original_line": 457,
    "side": "RIGHT",
    "in_reply_to_id": 164023957
  }
]