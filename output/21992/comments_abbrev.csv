DrahtBot,2021-05-19 02:38:09,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #21841 (Send fewer feefilter messages (avoid the wobbling number issue) by rebroad)\n\nIf you consider this pull request i",https://github.com/bitcoin/bitcoin/pull/21992#issuecomment-843699362,843699362,
laanwj,2021-05-19 14:46:43,"> net: Remove -feefilter option, as it is debug only and isn't used in any tests\n\nNot a NACK by any means (I don't know the entire history here) but fwiw, ""debug only"" doesn't necessarily mean test-only. Sometimes obscure options that only make sense in relatively rare conditions, or during development, are labeled as such as well.",https://github.com/bitcoin/bitcoin/pull/21992#issuecomment-844176885,844176885,
jonatack,2021-05-19 14:59:37,"It looks like this configuration option was added by @morcos in 9e072a6e66ef: *""Implement ""feefilter"" P2P message. The ""feefilter"" p2p message is used to inform other nodes of your mempool min fee which is the feerate that any new transaction must meet to be accepted to your mempool.  This will allow them to filter invs to you according to this feerate.""*\n\nPer https://lists.linuxfoundation.org",https://github.com/bitcoin/bitcoin/pull/21992#issuecomment-844189161,844189161,
jonatack,2021-05-20 09:22:44,"As a follow-up to my message above, I was curious why `-feefilter` was turned into a debug message and found https://github.com/bitcoin/bitcoin/issues/8150. IIUC, a translator found the help message too difficult to translate.",https://github.com/bitcoin/bitcoin/pull/21992#issuecomment-844904494,844904494,
jnewbery,2021-05-20 15:14:55,Code review ACK b0b62138b7b9e27ced562fe4859184f4d9bb94c5,https://github.com/bitcoin/bitcoin/pull/21992#issuecomment-845210553,845210553,
jnewbery,2021-05-24 13:05:54,Code review ACK a7a43e8fe85f6247c35d7ff99f36448574f3e34a,https://github.com/bitcoin/bitcoin/pull/21992#issuecomment-847029336,847029336,
jonatack,2021-05-24 13:17:57,"Given https://github.com/bitcoin/bitcoin/pull/21992#issuecomment-844189161 and https://github.com/bitcoin/bitcoin/pull/21992#issuecomment-844904494 (@amadeuszpawlik, I think that information should have been in the PR description and could still be added), are we certain that this option is unused, unneeded, and should be removed?",https://github.com/bitcoin/bitcoin/pull/21992#issuecomment-847036605,847036605,
jnewbery,2021-05-24 13:25:12,"I agree with @sipa's comment (https://github.com/bitcoin/bitcoin/issues/8150#issuecomment-223967868):\n\n> I don't think there are good reasons for disabling this in production\n\nThis debug only option was added with the original implementation for feefilter, and was used for debugging and testing. It's not used in any of our functional tests, so I'm pretty sure that it's safe to remove.",https://github.com/bitcoin/bitcoin/pull/21992#issuecomment-847040866,847040866,
jonatack,2021-05-24 14:18:50,"Yes, grepping for DEBUG_ONLY there seem to be some that aren't used in tests but are intended for users, so I'm not sure about ""as it is debug only and isn't used in any tests"" as a rationale, but it's more of a question than an assertion and I was hoping to hear discussion about it. My informal understanding was more along the lines of https://github.com/bitcoin/bitcoin/pull/21992#issuecomment-84",https://github.com/bitcoin/bitcoin/pull/21992#issuecomment-847074776,847074776,
MarcoFalke,2021-05-25 06:35:17,"Maybe this was added as an emergency switch to turn off feefilter, should an unexpected integration bug arise in production? Though, now that the `feefilter` message is being used for years already without such an observed issue, it seems fine to remove.\n\nGenerally I am not a fan of undocumented non-self-documenting code. And absent anyone speaking up with a use case (or documentation or test ",https://github.com/bitcoin/bitcoin/pull/21992#issuecomment-847583978,847583978,
jnewbery,2021-05-19 08:54:43,"I'd suggest also moving the conditional logic into the `MaybeSendFeeFilter()` function. The compiler will inline the function anyway, so there's no difference in the compiled code, and keeping all the feefilter logic together makes it easier to understand. Suggested diff:\n\n```diff\ndiff --git a/src/net_processing.cpp b/src/net_processing.cpp\nindex cc9e38afbb..2acf4c2d62 100644\n--- a/src/n",https://github.com/bitcoin/bitcoin/pull/21992#discussion_r635043699,635043699,src/net_processing.cpp
amadeuszpawlik,2021-05-19 14:24:40,"Many thanks!\nI agree, it's much cleaner. I applied your suggestion (after rebase, `PF_FORCERELAY` is now `NetPermissionFlags::ForceRelay`).",https://github.com/bitcoin/bitcoin/pull/21992#discussion_r635292608,635292608,src/net_processing.cpp
jonatack,2021-05-19 15:06:13,"`static const MAX_FILTER` seems to only be used in the following line; maybe use it directly in the conditional.\n\n```diff\n-        static const CAmount MAX_FILTER{g_filter_rounder.round(MAX_MONEY)};\n-        if (pto.m_tx_relay->lastSentFeeFilter == MAX_FILTER) {\n-            // Send the current filter if we sent MAX_FILTER previously\n+        if (pto.m_tx_relay->lastSentFeeFilter == g_",https://github.com/bitcoin/bitcoin/pull/21992#discussion_r635333530,635333530,src/net_processing.cpp
amadeuszpawlik,2021-05-19 16:12:40,Thanks for the input - this further improves the readability 8741245857b588d73a3f21489470f04bae31e67b,https://github.com/bitcoin/bitcoin/pull/21992#discussion_r635391366,635391366,src/net_processing.cpp
jnewbery,2021-05-20 08:37:52,"`FeeFilterRounder::round()` is not a pure function - it calls to `FastRandomContext::rand32()` and so will return different values even when called with the same input. Therefore this is a change in behaviour.\n\nIn general, we shouldn't mix behaviour changes with refactors in the same PR. It may be the right change, but it should be left for a separate PR, leaving this PR as a pure refactor.",https://github.com/bitcoin/bitcoin/pull/21992#discussion_r635893873,635893873,src/net_processing.cpp
jonatack,2021-05-20 09:27:04,Interesting -- thanks @jnewbery (I don't know how I missed that it was being memoized but thanks for catching my oversight!),https://github.com/bitcoin/bitcoin/pull/21992#discussion_r635931470,635931470,src/net_processing.cpp
amadeuszpawlik,2021-05-20 11:34:21,Thanks @jnewbery for catching that. Removed that commit.,https://github.com/bitcoin/bitcoin/pull/21992#discussion_r636018314,636018314,src/net_processing.cpp
ccdle12,2021-05-24 11:43:23,minor nit: extra semi-colon at the end of method declaration,https://github.com/bitcoin/bitcoin/pull/21992#discussion_r637885734,637885734,src/net_processing.cpp
amadeuszpawlik,2021-05-24 13:00:28,fixed; thanks for catching that,https://github.com/bitcoin/bitcoin/pull/21992#discussion_r637927214,637927214,src/net_processing.cpp
