[
  {
    "sha": "228a8c975a15a8dd1a132da5f145089b4f907163",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyMjhhOGM5NzVhMTVhOGRkMWExMzJkYTVmMTQ1MDg5YjRmOTA3MTYz",
    "commit": {
      "author": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2021-07-27T14:28:34Z"
      },
      "committer": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2021-07-27T14:33:13Z"
      },
      "message": "addrman: treat Tor/I2P/CJDNS as a single group\n\nSub-netting does not exist in Tor/I2P/CJDNS. Obtaining such addresses\nis easier compared to obtaining IP addresses. Also, obtaining\nTor/I2P/CJDNS addresses that do not have a common prefix is not harder\nthan obtaining ones with common prefix.",
      "tree": {
        "sha": "530ae997b517c1b974369a578338f7c40a2363d1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/530ae997b517c1b974369a578338f7c40a2363d1"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/228a8c975a15a8dd1a132da5f145089b4f907163",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQQzBAABCAAdFiEE5k2NRWFNsHVF2czBVN8G9ktVy78FAmEAGSsACgkQVN8G9ktV\ny78K7iAAiWBH7/GlNddi/bbREbY51afI0hDGFJRrAyDT0KdTT/f+8YccihbYc8No\njUdMQfqXOhsnOD5B4Qmf4mZigxhRw7+e+xqmq2eQE29SQehXMPkJ/tOOI/JE3qbL\nnr773AaOEFuO+5LgFRzA9vRnhw9/1zPtOk9YsChLDVPm5o5Eh133sUlQ6WYGn+1S\noCqZuor2bQDDyrA+sR2xwcQ+16QxI5aU+tWFci++OncVIRaBQ2Dn399JCJee8N1E\nbB+Rc7MS12gctXLs7RHiZprN7X+dTqUcD2XkWtk221oWy8mIcgzGUkDh3jHY13/K\ngfQikVeaGP1aDmp2hWNsJvkeJsQKstfJ/a+vK91rymBj/gg/2R483xahLOCSgSgJ\nbSwpSl7paktJsN0cZ8slf0O0hANXbQUKNx/JpjwT3n85iSt0nM513AcUXVQ/2L/B\nHIC+rI/83A1FVffb2jS4zt6ve6htBJv9OqvQYyXhh7i9QQmmpFhj46lQcNWfRIv6\n+91uafBeEjChLeojcWQHrHmFZPjawxMOLmnaCJn4mzxovLZOH/l7f7axizhBHreO\np80q6zDt0R6nwzS2m/u9BoIyHZdUWKh3tqxpMx55qz07GDXY7B/Acvo91rOpOjd4\nUYJt938+TEvKzeeq15YsUpNpwmpj3ZmKF7ZF5KKKcFS6CS12SfGaMpwl7hbDYT6j\nfeBf5FwtHFdv1VjkTT0t4AYZBRMASW+HPjjCfZ56VB4Q6sTjOqP7XYzKmJDruQgy\n2IoRlOi/v5M2leUQpoRUH9jtSdrGQQ0MEiG8F/WZ1Up7GPk80FdNryQVA9H6jFSY\nPvlStUVQzFOQ+sRyGig5mlDKCZVgn7/Dpb1Qq4RWIkXThepb5N1p1Y5e2LdiJYFB\nkOrCK6PTOdFEXkCRVfNjidhsuowsciDaQbse8W4qJiCGeoLd5TshoNdZDXzkOFRo\n3sTU8U1TBNzxPsDx/ZKVWMK0bnyh9D0wXZ5VmIPUD5GZuETdudoLXlmf1Cc+4W7s\nwZDvO6vWNV0X/gALhcWuosPFf5D9l4J+XbHU3TcqyUet6LyUaSxA8mfAO8Nz0yzp\n3Sz4vOXuDkxCowW9GNLTO+zEA3rIUTkVEFHyWJhpxzywKXRX7iOaHn2mB49dMIm+\nzeyn6FD6ljcaBvQEG7KLDyd0SWT7HevQsalCrDopHSLv6cPjNiMIIJAXF57W3adL\nVUDu3rwHVXtsTh9dPlYv+qohvFeG+KVVRsM85SAq/xNpOh5hSXJqN2ls39Rgrb2S\n2ECqi6OA7eLIvQVqqMYQRIdBh9tX165IwaPVNV/GS27F4ognTkFafFyLfrJzxrsz\nj15zqXO9lv7d73qh3Lq0bZWHUMOU4g==\n=vH4T\n-----END PGP SIGNATURE-----",
        "payload": "tree 530ae997b517c1b974369a578338f7c40a2363d1\nparent 1488f55fa57a1400a57be837b574183f019c7855\nauthor Vasil Dimov <vd@FreeBSD.org> 1627396114 +0200\ncommitter Vasil Dimov <vd@FreeBSD.org> 1627396393 +0200\n\naddrman: treat Tor/I2P/CJDNS as a single group\n\nSub-netting does not exist in Tor/I2P/CJDNS. Obtaining such addresses\nis easier compared to obtaining IP addresses. Also, obtaining\nTor/I2P/CJDNS addresses that do not have a common prefix is not harder\nthan obtaining ones with common prefix.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/228a8c975a15a8dd1a132da5f145089b4f907163",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/228a8c975a15a8dd1a132da5f145089b4f907163",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/228a8c975a15a8dd1a132da5f145089b4f907163/comments",
    "author": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasild/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasild/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "1488f55fa57a1400a57be837b574183f019c7855",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1488f55fa57a1400a57be837b574183f019c7855",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/1488f55fa57a1400a57be837b574183f019c7855"
      }
    ],
    "stats": {
      "total": 5,
      "additions": 5,
      "deletions": 0
    },
    "files": [
      {
        "sha": "15c6952718bdbe7aefb6718163d851822d8768a1",
        "filename": "src/addrman.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 0,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/228a8c975a15a8dd1a132da5f145089b4f907163/src/addrman.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/228a8c975a15a8dd1a132da5f145089b4f907163/src/addrman.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrman.cpp?ref=228a8c975a15a8dd1a132da5f145089b4f907163",
        "patch": "@@ -28,6 +28,11 @@ int CAddrInfo::GetTriedBucket(const uint256& nKey, const std::vector<bool> &asma\n int CAddrInfo::GetNewBucket(const uint256& nKey, const CNetAddr& src, const std::vector<bool> &asmap) const\n {\n     std::vector<unsigned char> vchSourceGroupKey = src.GetGroup(asmap);\n+    if (src.IsTor() || src.IsI2P() || src.IsCJDNS()) {\n+        // For the purposes of new-bucketing, treat the entire Tor network as a single source (same\n+        // for I2P and CJDNS).\n+        vchSourceGroupKey.resize(1);\n+    }\n     uint64_t hash1 = (CHashWriter(SER_GETHASH, 0) << nKey << GetGroup(asmap) << vchSourceGroupKey).GetCheapHash();\n     uint64_t hash2 = (CHashWriter(SER_GETHASH, 0) << nKey << vchSourceGroupKey << (hash1 % ADDRMAN_NEW_BUCKETS_PER_SOURCE_GROUP)).GetCheapHash();\n     int new_bucket = hash2 % ADDRMAN_NEW_BUCKET_COUNT;"
      }
    ]
  }
]