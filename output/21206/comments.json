[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/780457746",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#issuecomment-780457746",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21206",
    "id": 780457746,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4MDQ1Nzc0Ng==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-17T10:25:53Z",
    "updated_at": "2021-11-23T01:17:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#23497](https://github.com/bitcoin/bitcoin/pull/23497) (Add `src/node/` and `src/wallet/` code to `node::` and `wallet::` namespaces by ryanofsky)\n* [#23411](https://github.com/bitcoin/bitcoin/pull/23411) (refactor: Avoid integer overflow in ApplyStats when activating snapshot by MarcoFalke)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/780457746/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/912397934",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#issuecomment-912397934",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21206",
    "id": 912397934,
    "node_id": "IC_kwDOABII5842YhZu",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?u=4a9af998e1a560b3f49c3827f453e1bcbe6a5cfb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-03T09:28:18Z",
    "updated_at": "2021-09-03T09:28:18Z",
    "author_association": "MEMBER",
    "body": "Base PR is merged, could update OP and rebase to move this change forward.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/912397934/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/912732776",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#issuecomment-912732776",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21206",
    "id": 912732776,
    "node_id": "IC_kwDOABII5842ZzJo",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-03T18:34:38Z",
    "updated_at": "2021-10-02T03:12:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Base PR is merged, could update OP and rebase to move this change forward.\r\n\r\nThanks, rebased and removed references to base PR in the OP.\r\n\r\nRebased b17ba1c752a65d2f8b3d1485074d08d48c1ffd3e -> 2896ad570523842245d2de77de531776cfcc08d8 ([`pr/txstate.20`](https://github.com/ryanofsky/bitcoin/commits/pr/txstate.20) -> [`pr/txstate.21`](https://github.com/ryanofsky/bitcoin/commits/pr/txstate.21), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/txstate.20-rebase..pr/txstate.21)) after base PR #22100 merge.\r\nRebased 2896ad570523842245d2de77de531776cfcc08d8 -> 541d5f5c775a9aa884c1a8b37fc123933fdbd98e ([`pr/txstate.21`](https://github.com/ryanofsky/bitcoin/commits/pr/txstate.21) -> [`pr/txstate.22`](https://github.com/ryanofsky/bitcoin/commits/pr/txstate.22), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/txstate.21-rebase..pr/txstate.22)) due to conflict with #20591\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/912732776/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/951088733",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#issuecomment-951088733",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21206",
    "id": 951088733,
    "node_id": "IC_kwDOABII5844sHZd",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-25T16:18:29Z",
    "updated_at": "2021-10-29T17:17:27Z",
    "author_association": "CONTRIBUTOR",
    "body": "Rebased 541d5f5c775a9aa884c1a8b37fc123933fdbd98e -> bb16e10149c4e1bf2e3d0ee027e9025cd48dd65f ([`pr/txstate.22`](https://github.com/ryanofsky/bitcoin/commits/pr/txstate.22) -> [`pr/txstate.23`](https://github.com/ryanofsky/bitcoin/commits/pr/txstate.23), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/txstate.22-rebase..pr/txstate.23)) due to conflicts with #23288 and #23338\r\nRebased bb16e10149c4e1bf2e3d0ee027e9025cd48dd65f -> 3c6fdae6ed67426bd9ddb2949a9e66934f71bf0b ([`pr/txstate.23`](https://github.com/ryanofsky/bitcoin/commits/pr/txstate.23) -> [`pr/txstate.24`](https://github.com/ryanofsky/bitcoin/commits/pr/txstate.24), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/txstate.23-rebase..pr/txstate.24)) due to conflict with #23332",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/951088733/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/969011069",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#issuecomment-969011069",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21206",
    "id": 969011069,
    "node_id": "IC_kwDOABII5845we99",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-15T15:15:25Z",
    "updated_at": "2021-11-15T15:15:25Z",
    "author_association": "CONTRIBUTOR",
    "body": "Rebased 3c6fdae6ed67426bd9ddb2949a9e66934f71bf0b -> 78c8ac87e2f585772f296b943c733bd26f255ba0 ([`pr/txstate.24`](https://github.com/ryanofsky/bitcoin/commits/pr/txstate.24) -> [`pr/txstate.25`](https://github.com/ryanofsky/bitcoin/commits/pr/txstate.25), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/txstate.24-rebase..pr/txstate.25)) due to conflict with #22928, also making minor `MakeWalletTxStatus` cleanup",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/969011069/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/975573226",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#issuecomment-975573226",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21206",
    "id": 975573226,
    "node_id": "IC_kwDOABII5846JhDq",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-22T14:16:37Z",
    "updated_at": "2021-11-22T14:16:37Z",
    "author_association": "MEMBER",
    "body": "Concept ACK, wil review today.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/975573226/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/976579335",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#issuecomment-976579335",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21206",
    "id": 976579335,
    "node_id": "IC_kwDOABII5846NWsH",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-23T14:01:56Z",
    "updated_at": "2021-11-25T18:23:10Z",
    "author_association": "MEMBER",
    "body": "I like this refactor, it abstracts the transaction state much better than the boolean-radio-buttons, and agree it makes some kinds of mistake harder to make.\r\n\r\nConcept and code review ACK 78c8ac87e2f585772f296b943c733bd26f255ba0\r\nre-ACK d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/976579335/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/579802970",
    "pull_request_review_id": 594838453,
    "id": 579802970,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3OTgwMjk3MA==",
    "diff_hunk": "@@ -140,8 +134,7 @@ class CWalletTx\n     mutable CAmount nChangeCached;\n \n     CWalletTx(const CWallet* wallet, CTransactionRef arg)",
    "path": "src/wallet/transaction.h",
    "position": null,
    "original_position": 41,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "7bc16a0b421380a1682ca9d97b7f7fc140fb1c5e",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "7bc16a0b421380a1682ca9d97b7f7fc140fb1c5e\r\n\r\nnit, `CWalletTx(const CWallet*, CTransactionRef arg)` to make it clear wallet is unused.",
    "created_at": "2021-02-21T12:52:18Z",
    "updated_at": "2021-04-30T18:05:29Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r579802970",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/579802970"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r579802970"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/579802970/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 136,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/586915707",
    "pull_request_review_id": 603528118,
    "id": 586915707,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NjkxNTcwNw==",
    "diff_hunk": "@@ -140,8 +134,7 @@ class CWalletTx\n     mutable CAmount nChangeCached;\n \n     CWalletTx(const CWallet* wallet, CTransactionRef arg)",
    "path": "src/wallet/transaction.h",
    "position": null,
    "original_position": 41,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "7bc16a0b421380a1682ca9d97b7f7fc140fb1c5e",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "re: https://github.com/bitcoin/bitcoin/pull/21206#discussion_r579802970\r\n\r\n> nit, `CWalletTx(const CWallet*, CTransactionRef arg)` to make it clear wallet is unused.\r\n\r\nGood catch! Removed unused argument in this commit instead of later commit",
    "created_at": "2021-03-04T00:26:46Z",
    "updated_at": "2021-04-30T18:05:29Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r586915707",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/586915707"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r586915707"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/586915707/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 136,
    "side": "RIGHT",
    "in_reply_to_id": 579802970
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620282305",
    "pull_request_review_id": 644653488,
    "id": 620282305,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMDI4MjMwNQ==",
    "diff_hunk": "@@ -81,7 +81,9 @@ WalletTx MakeWalletTx(CWallet& wallet, const CWalletTx& wtx)\n WalletTxStatus MakeWalletTxStatus(const CWallet& wallet, const CWalletTx& wtx)\n {\n     WalletTxStatus result;\n-    result.block_height = wtx.m_confirm.block_height > 0 ? wtx.m_confirm.block_height : std::numeric_limits<int>::max();\n+    int height = wtx.state<TxStateConfirmed>() ? wtx.state<TxStateConfirmed>()->confirmed_block_height :",
    "path": "src/wallet/interfaces.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "4e11f88320b644b67db55fe737815451ca7d0681",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "4e11f88320b644b67db55fe737815451ca7d0681\r\n\r\nnit, refactor to `wtx.GetBlockHeight()` or similar.",
    "created_at": "2021-04-26T13:12:19Z",
    "updated_at": "2021-04-30T18:05:29Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620282305",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620282305"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620282305"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620282305/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 85,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620285572",
    "pull_request_review_id": 644653488,
    "id": 620285572,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMDI4NTU3Mg==",
    "diff_hunk": "@@ -788,7 +788,9 @@ bool CWallet::MarkReplaced(const uint256& originalHash, const uint256& newHash)\n     // notification so the wallet is in an internally consistent state and\n     // immediately knows the old transaction should not be considered trusted\n     // and is eligible to be abandoned\n-    wtx.fInMempool = chain().isInMempool(originalHash);\n+    if (wtx.state<TxStateInMempool>() && !chain().isInMempool(originalHash)) {",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "4e11f88320b644b67db55fe737815451ca7d0681",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "4e11f88320b644b67db55fe737815451ca7d0681\r\n\r\nWhy the first check?",
    "created_at": "2021-04-26T13:16:11Z",
    "updated_at": "2021-04-30T18:05:29Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620285572",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620285572"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620285572"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620285572/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 809,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620333051",
    "pull_request_review_id": 644653488,
    "id": 620333051,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMDMzMzA1MQ==",
    "diff_hunk": "@@ -963,30 +960,29 @@ CWalletTx* CWallet::AddToWallet(CTransactionRef tx, const CWalletTx::Confirmatio\n \n bool CWallet::LoadToWallet(const uint256& hash, const UpdateWalletTxFn& fill_wtx)\n {\n-    const auto& ins = mapWallet.emplace(std::piecewise_construct, std::forward_as_tuple(hash), std::forward_as_tuple(nullptr));\n+    const auto& ins = mapWallet.emplace(std::piecewise_construct, std::forward_as_tuple(hash), std::forward_as_tuple(nullptr, TxStateInactive{}));\n     CWalletTx& wtx = ins.first->second;\n     if (!fill_wtx(wtx, ins.second)) {\n         return false;\n     }\n     // If wallet doesn't have a chain (e.g wallet-tool), don't bother to update txn.\n     if (HaveChain()) {\n         bool active;\n-        int height;\n-        if (chain().findBlock(wtx.m_confirm.hashBlock, FoundBlock().inActiveChain(active).height(height)) && active) {\n-            // Update cached block height variable since it not stored in the\n-            // serialized transaction.\n-            wtx.m_confirm.block_height = height;\n-        } else if (wtx.isConflicted() || wtx.isConfirmed()) {\n+        auto lookup_block = [&](const uint256& hash, int& height, TxState& state) {",
    "path": "src/wallet/wallet.cpp",
    "position": 90,
    "original_position": 88,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "4e11f88320b644b67db55fe737815451ca7d0681",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "4e11f88320b644b67db55fe737815451ca7d0681\r\n\r\nnit, `lookup_block` seems misleading, maybe `update_tx_state` or `mark_inactive`.",
    "created_at": "2021-04-26T14:09:17Z",
    "updated_at": "2021-04-30T18:05:29Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620333051",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620333051"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620333051"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620333051/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1000,
    "original_line": 1000,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620339834",
    "pull_request_review_id": 644653488,
    "id": 620339834,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMDMzOTgzNA==",
    "diff_hunk": "@@ -0,0 +1,21 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_UTIL_OVERLOADED_H\n+#define BITCOIN_UTIL_OVERLOADED_H\n+\n+#include <optional>\n+#include <utility>\n+\n+//! Overloaded helper for std::visit, useful to write code that switches on a\n+//! variant type and triggers a compile error if there are any unhandled cases.",
    "path": "src/util/overloaded.h",
    "position": null,
    "original_position": 12,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "4e11f88320b644b67db55fe737815451ca7d0681",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "4e11f88320b644b67db55fe737815451ca7d0681\r\n\r\nI've tested this removing one case in `TxStateSerializedBlockHash` and it failed to compile.",
    "created_at": "2021-04-26T14:16:46Z",
    "updated_at": "2021-04-30T18:05:29Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620339834",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620339834"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620339834"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620339834/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 12,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620346512",
    "pull_request_review_id": 644653488,
    "id": 620346512,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMDM0NjUxMg==",
    "diff_hunk": "@@ -11,12 +11,99 @@\n #include <wallet/ismine.h>\n #include <threadsafety.h>\n #include <tinyformat.h>\n+#include <util/overloaded.h>\n #include <util/strencodings.h>\n #include <util/string.h>\n \n #include <list>\n+#include <variant>\n #include <vector>\n \n+//! State of transaction confirmed in a block.\n+struct TxStateConfirmed {\n+    uint256 confirmed_block_hash;\n+    int confirmed_block_height;\n+    int position_in_block;\n+\n+    explicit TxStateConfirmed(const uint256& block_hash, int height, int index) : confirmed_block_hash(block_hash), confirmed_block_height(height), position_in_block(index) {}\n+};\n+\n+//! State of transaction added to mempool.\n+struct TxStateInMempool {\n+};\n+\n+//! State of rejected transaction that conflicts with a confirmed block.\n+struct TxStateConflicted {\n+    uint256 conflicting_block_hash;\n+    int conflicting_block_height;\n+\n+    explicit TxStateConflicted(const uint256& block_hash, int height) : conflicting_block_hash(block_hash), conflicting_block_height(height) {}\n+};\n+\n+//! State of transaction not confirmed or conflicting with a known block and\n+//! not in the mempool. May conflict with the mempool, or with an unknown block,\n+//! or be abandoned, never broadcast, or rejected from the mempool for another\n+//! reason.\n+struct TxStateInactive {\n+    bool abandoned;\n+\n+    explicit TxStateInactive(bool abandoned=false) : abandoned(abandoned) {}",
    "path": "src/wallet/transaction.h",
    "position": null,
    "original_position": 40,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "4e11f88320b644b67db55fe737815451ca7d0681",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "4e11f88320b644b67db55fe737815451ca7d0681\r\n\r\nnit, space around `=`.",
    "created_at": "2021-04-26T14:23:43Z",
    "updated_at": "2021-04-30T18:05:29Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620346512",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620346512"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620346512"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620346512/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 50,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620348104",
    "pull_request_review_id": 644653488,
    "id": 620348104,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMDM0ODEwNA==",
    "diff_hunk": "@@ -963,30 +960,29 @@ CWalletTx* CWallet::AddToWallet(CTransactionRef tx, const CWalletTx::Confirmatio\n \n bool CWallet::LoadToWallet(const uint256& hash, const UpdateWalletTxFn& fill_wtx)\n {\n-    const auto& ins = mapWallet.emplace(std::piecewise_construct, std::forward_as_tuple(hash), std::forward_as_tuple(nullptr));\n+    const auto& ins = mapWallet.emplace(std::piecewise_construct, std::forward_as_tuple(hash), std::forward_as_tuple(nullptr, TxStateInactive{}));\n     CWalletTx& wtx = ins.first->second;\n     if (!fill_wtx(wtx, ins.second)) {\n         return false;\n     }\n     // If wallet doesn't have a chain (e.g wallet-tool), don't bother to update txn.\n     if (HaveChain()) {\n         bool active;",
    "path": "src/wallet/wallet.cpp",
    "position": 83,
    "original_position": 81,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "4e11f88320b644b67db55fe737815451ca7d0681",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "4e11f88320b644b67db55fe737815451ca7d0681\r\n\r\nMake local in lambda below?",
    "created_at": "2021-04-26T14:25:24Z",
    "updated_at": "2021-04-30T18:05:29Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620348104",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620348104"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620348104"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620348104/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 999,
    "original_line": 999,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623958342",
    "pull_request_review_id": 649322365,
    "id": 623958342,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzk1ODM0Mg==",
    "diff_hunk": "@@ -0,0 +1,21 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_UTIL_OVERLOADED_H\n+#define BITCOIN_UTIL_OVERLOADED_H\n+\n+#include <optional>\n+#include <utility>\n+\n+//! Overloaded helper for std::visit, useful to write code that switches on a\n+//! variant type and triggers a compile error if there are any unhandled cases.",
    "path": "src/util/overloaded.h",
    "position": null,
    "original_position": 12,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "4e11f88320b644b67db55fe737815451ca7d0681",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "re: https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620339834\r\n\r\n> [4e11f88](https://github.com/bitcoin/bitcoin/commit/4e11f88320b644b67db55fe737815451ca7d0681)\r\n> \r\n> I've tested this removing one case in `TxStateSerializedBlockHash` and it failed to compile.\r\n\r\nThanks for testing!",
    "created_at": "2021-04-30T15:12:48Z",
    "updated_at": "2021-04-30T18:15:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r623958342",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623958342"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r623958342"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623958342/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 12,
    "side": "RIGHT",
    "in_reply_to_id": 620339834
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623964770",
    "pull_request_review_id": 649322365,
    "id": 623964770,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzk2NDc3MA==",
    "diff_hunk": "@@ -81,7 +81,9 @@ WalletTx MakeWalletTx(CWallet& wallet, const CWalletTx& wtx)\n WalletTxStatus MakeWalletTxStatus(const CWallet& wallet, const CWalletTx& wtx)\n {\n     WalletTxStatus result;\n-    result.block_height = wtx.m_confirm.block_height > 0 ? wtx.m_confirm.block_height : std::numeric_limits<int>::max();\n+    int height = wtx.state<TxStateConfirmed>() ? wtx.state<TxStateConfirmed>()->confirmed_block_height :",
    "path": "src/wallet/interfaces.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "4e11f88320b644b67db55fe737815451ca7d0681",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "re: https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620282305\r\n\r\n> [4e11f88](https://github.com/bitcoin/bitcoin/commit/4e11f88320b644b67db55fe737815451ca7d0681)\r\n> \r\n> nit, refactor to `wtx.GetBlockHeight()` or similar.\r\n\r\nThe code does repeat  a few places but I think I'd still rather not have this. I think all these positive and negative height and magic height and depth values are bad and we should just pass the actual state information around. It would be good to clean up this code later (would avoid it for now to avoid expanding scope of pr), but I think the cleanup should more try to get rid of the magic height values than to try to construct them quietly.",
    "created_at": "2021-04-30T15:22:14Z",
    "updated_at": "2021-04-30T18:15:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r623964770",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623964770"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r623964770"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623964770/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 85,
    "side": "RIGHT",
    "in_reply_to_id": 620282305
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623977153",
    "pull_request_review_id": 649322365,
    "id": 623977153,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzk3NzE1Mw==",
    "diff_hunk": "@@ -11,12 +11,99 @@\n #include <wallet/ismine.h>\n #include <threadsafety.h>\n #include <tinyformat.h>\n+#include <util/overloaded.h>\n #include <util/strencodings.h>\n #include <util/string.h>\n \n #include <list>\n+#include <variant>\n #include <vector>\n \n+//! State of transaction confirmed in a block.\n+struct TxStateConfirmed {\n+    uint256 confirmed_block_hash;\n+    int confirmed_block_height;\n+    int position_in_block;\n+\n+    explicit TxStateConfirmed(const uint256& block_hash, int height, int index) : confirmed_block_hash(block_hash), confirmed_block_height(height), position_in_block(index) {}\n+};\n+\n+//! State of transaction added to mempool.\n+struct TxStateInMempool {\n+};\n+\n+//! State of rejected transaction that conflicts with a confirmed block.\n+struct TxStateConflicted {\n+    uint256 conflicting_block_hash;\n+    int conflicting_block_height;\n+\n+    explicit TxStateConflicted(const uint256& block_hash, int height) : conflicting_block_hash(block_hash), conflicting_block_height(height) {}\n+};\n+\n+//! State of transaction not confirmed or conflicting with a known block and\n+//! not in the mempool. May conflict with the mempool, or with an unknown block,\n+//! or be abandoned, never broadcast, or rejected from the mempool for another\n+//! reason.\n+struct TxStateInactive {\n+    bool abandoned;\n+\n+    explicit TxStateInactive(bool abandoned=false) : abandoned(abandoned) {}",
    "path": "src/wallet/transaction.h",
    "position": null,
    "original_position": 40,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "4e11f88320b644b67db55fe737815451ca7d0681",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "re: https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620346512\r\n\r\n> [4e11f88](https://github.com/bitcoin/bitcoin/commit/4e11f88320b644b67db55fe737815451ca7d0681)\r\n> \r\n> nit, space around `=`.\r\n\r\nThanks, ran clang-format-diff",
    "created_at": "2021-04-30T15:40:46Z",
    "updated_at": "2021-04-30T18:15:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r623977153",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623977153"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r623977153"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623977153/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 50,
    "side": "RIGHT",
    "in_reply_to_id": 620346512
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623987385",
    "pull_request_review_id": 649322365,
    "id": 623987385,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzk4NzM4NQ==",
    "diff_hunk": "@@ -788,7 +788,9 @@ bool CWallet::MarkReplaced(const uint256& originalHash, const uint256& newHash)\n     // notification so the wallet is in an internally consistent state and\n     // immediately knows the old transaction should not be considered trusted\n     // and is eligible to be abandoned\n-    wtx.fInMempool = chain().isInMempool(originalHash);\n+    if (wtx.state<TxStateInMempool>() && !chain().isInMempool(originalHash)) {",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "4e11f88320b644b67db55fe737815451ca7d0681",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "re: https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620285572\r\n\r\n> [4e11f88](https://github.com/bitcoin/bitcoin/commit/4e11f88320b644b67db55fe737815451ca7d0681)\r\n> \r\n> Why the first check?\r\n\r\nThe main reason is to be equivalent as possible to previous code. Previous code didn't change the transactions abandon/unconfirmed/conflicted state and this code isn't trying to do that either. Also, I think it makes the code more closely match the comment above. Maybe we can make the comment more clear though. It seems like it could be a little more specific but I'm not sure what extra explanation or details might be good to add.",
    "created_at": "2021-04-30T15:55:59Z",
    "updated_at": "2021-04-30T18:15:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r623987385",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623987385"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r623987385"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623987385/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 809,
    "side": "RIGHT",
    "in_reply_to_id": 620285572
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623989031",
    "pull_request_review_id": 649322365,
    "id": 623989031,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzk4OTAzMQ==",
    "diff_hunk": "@@ -963,30 +960,29 @@ CWalletTx* CWallet::AddToWallet(CTransactionRef tx, const CWalletTx::Confirmatio\n \n bool CWallet::LoadToWallet(const uint256& hash, const UpdateWalletTxFn& fill_wtx)\n {\n-    const auto& ins = mapWallet.emplace(std::piecewise_construct, std::forward_as_tuple(hash), std::forward_as_tuple(nullptr));\n+    const auto& ins = mapWallet.emplace(std::piecewise_construct, std::forward_as_tuple(hash), std::forward_as_tuple(nullptr, TxStateInactive{}));\n     CWalletTx& wtx = ins.first->second;\n     if (!fill_wtx(wtx, ins.second)) {\n         return false;\n     }\n     // If wallet doesn't have a chain (e.g wallet-tool), don't bother to update txn.\n     if (HaveChain()) {\n         bool active;",
    "path": "src/wallet/wallet.cpp",
    "position": 83,
    "original_position": 81,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "4e11f88320b644b67db55fe737815451ca7d0681",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "re: https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620348104\r\n\r\n> [4e11f88](https://github.com/bitcoin/bitcoin/commit/4e11f88320b644b67db55fe737815451ca7d0681)\r\n> \r\n> Make local in lambda below?\r\n\r\nCan do if another change is required. This line isn't changing, and I'm trying to minimize the diff. The variable scope is pretty small already too.",
    "created_at": "2021-04-30T15:58:29Z",
    "updated_at": "2021-04-30T18:15:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r623989031",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623989031"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r623989031"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623989031/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 999,
    "original_line": 999,
    "side": "RIGHT",
    "in_reply_to_id": 620348104
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/624001448",
    "pull_request_review_id": 649322365,
    "id": 624001448,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNDAwMTQ0OA==",
    "diff_hunk": "@@ -963,30 +960,29 @@ CWalletTx* CWallet::AddToWallet(CTransactionRef tx, const CWalletTx::Confirmatio\n \n bool CWallet::LoadToWallet(const uint256& hash, const UpdateWalletTxFn& fill_wtx)\n {\n-    const auto& ins = mapWallet.emplace(std::piecewise_construct, std::forward_as_tuple(hash), std::forward_as_tuple(nullptr));\n+    const auto& ins = mapWallet.emplace(std::piecewise_construct, std::forward_as_tuple(hash), std::forward_as_tuple(nullptr, TxStateInactive{}));\n     CWalletTx& wtx = ins.first->second;\n     if (!fill_wtx(wtx, ins.second)) {\n         return false;\n     }\n     // If wallet doesn't have a chain (e.g wallet-tool), don't bother to update txn.\n     if (HaveChain()) {\n         bool active;\n-        int height;\n-        if (chain().findBlock(wtx.m_confirm.hashBlock, FoundBlock().inActiveChain(active).height(height)) && active) {\n-            // Update cached block height variable since it not stored in the\n-            // serialized transaction.\n-            wtx.m_confirm.block_height = height;\n-        } else if (wtx.isConflicted() || wtx.isConfirmed()) {\n+        auto lookup_block = [&](const uint256& hash, int& height, TxState& state) {",
    "path": "src/wallet/wallet.cpp",
    "position": 90,
    "original_position": 88,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "4e11f88320b644b67db55fe737815451ca7d0681",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "re: https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620333051\r\n\r\n> [4e11f88](https://github.com/bitcoin/bitcoin/commit/4e11f88320b644b67db55fe737815451ca7d0681)\r\n> \r\n> nit, `lookup_block` seems misleading, maybe `update_tx_state` or `mark_inactive`.\r\n\r\nI guess it's not too important because the definition is a few lines away from the usage, but those names seem more misleading to me. The lambda is looking up a block hash and returning the block height in an output parameter. In the error case it also returns a txstate. I think it's reasonable to name a function after the main thing it does, even if the name doesn't encompass everything it does in all cases, especially in a local context like this where it's not going to be called by faraway code.\r\n\r\nThis code definitely sucks and there will be a lot of opportunities to improve it later (see\r\nhttps://github.com/bitcoin-core/bitcoin-devwiki/wiki/Wallet-Transaction-Conflict-Tracking). This commit is just trying to make a simple-as-possible global change to the state representation in order to be able to make local improvements in places like this more easy in the future.",
    "created_at": "2021-04-30T16:18:14Z",
    "updated_at": "2021-04-30T18:15:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r624001448",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/624001448"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r624001448"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/624001448/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1000,
    "original_line": 1000,
    "side": "RIGHT",
    "in_reply_to_id": 620333051
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625576746",
    "pull_request_review_id": 650967747,
    "id": 625576746,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNTU3Njc0Ng==",
    "diff_hunk": "@@ -10,11 +10,55 @@\n #include <wallet/transaction.h>\n #include <wallet/wallet.h>\n \n+isminetype InputIsMine(const CWallet& wallet, const CTxIn& txin) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet);\n+\n+/** Returns whether all of the inputs match the filter */\n+bool AllInputsMine(const CWallet& wallet, const CTransaction& tx, const isminefilter& filter);\n+\n+CAmount OutputGetCredit(const CWallet& wallet, const CTxOut& txout, const isminefilter& filter);\n+CAmount TxGetCredit(const CWallet& wallet, const CTransaction& tx, const isminefilter& filter);\n+\n+bool ScriptIsChange(const CWallet& wallet, const CScript& script) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet);\n+bool OutputIsChange(const CWallet& wallet, const CTxOut& txout) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet);\n+CAmount OutputGetChange(const CWallet& wallet, const CTxOut& txout) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet);\n+CAmount TxGetChange(const CWallet& wallet, const CTransaction& tx);",
    "path": "src/wallet/receive.h",
    "position": null,
    "original_position": 15,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "d1582cdc4e2312c213cf49131b4cd3e74636ae56",
    "user": {
      "login": "S3RK",
      "id": 1466284,
      "node_id": "MDQ6VXNlcjE0NjYyODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/S3RK",
      "html_url": "https://github.com/S3RK",
      "followers_url": "https://api.github.com/users/S3RK/followers",
      "following_url": "https://api.github.com/users/S3RK/following{/other_user}",
      "gists_url": "https://api.github.com/users/S3RK/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
      "organizations_url": "https://api.github.com/users/S3RK/orgs",
      "repos_url": "https://api.github.com/users/S3RK/repos",
      "events_url": "https://api.github.com/users/S3RK/events{/privacy}",
      "received_events_url": "https://api.github.com/users/S3RK/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "No need to export `OutputGetChange` and `TxGetChange`  as they are not used outside of `receive.cpp`",
    "created_at": "2021-05-04T07:50:36Z",
    "updated_at": "2021-05-19T06:33:29Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r625576746",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625576746"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r625576746"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625576746/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 23,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 24,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/636513974",
    "pull_request_review_id": 664950916,
    "id": 636513974,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNjUxMzk3NA==",
    "diff_hunk": "@@ -10,11 +10,55 @@\n #include <wallet/transaction.h>\n #include <wallet/wallet.h>\n \n+isminetype InputIsMine(const CWallet& wallet, const CTxIn& txin) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet);\n+\n+/** Returns whether all of the inputs match the filter */\n+bool AllInputsMine(const CWallet& wallet, const CTransaction& tx, const isminefilter& filter);\n+\n+CAmount OutputGetCredit(const CWallet& wallet, const CTxOut& txout, const isminefilter& filter);\n+CAmount TxGetCredit(const CWallet& wallet, const CTransaction& tx, const isminefilter& filter);\n+\n+bool ScriptIsChange(const CWallet& wallet, const CScript& script) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet);\n+bool OutputIsChange(const CWallet& wallet, const CTxOut& txout) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet);\n+CAmount OutputGetChange(const CWallet& wallet, const CTxOut& txout) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet);\n+CAmount TxGetChange(const CWallet& wallet, const CTransaction& tx);",
    "path": "src/wallet/receive.h",
    "position": null,
    "original_position": 15,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "d1582cdc4e2312c213cf49131b4cd3e74636ae56",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "re: https://github.com/bitcoin/bitcoin/pull/21206#discussion_r625576746\r\n\r\n> No need to export `OutputGetChange` and `TxGetChange` as they are not used outside of `receive.cpp`\r\n\r\nI think in the future it might be good to move low-level code using `IsChange` logic inside `receive.cpp` so `IsChange` functions could be private. But for `GetChange` it seems most consistent to try to keeping exposing `Get{Credit,Debit,Change}` functions as a group. The fact that these two `GetChange` functions don't have callers I think is more a reflection of poor unit test coverage than that change amounts should be a private part of transaction accounting.",
    "created_at": "2021-05-20T22:22:24Z",
    "updated_at": "2021-05-20T22:27:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r636513974",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/636513974"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r636513974"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/636513974/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 23,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 24,
    "side": "RIGHT",
    "in_reply_to_id": 625576746
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/659817279",
    "pull_request_review_id": 693998400,
    "id": 659817279,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1OTgxNzI3OQ==",
    "diff_hunk": "@@ -11,18 +11,104 @@\n #include <wallet/ismine.h>\n #include <threadsafety.h>\n #include <tinyformat.h>\n+#include <util/overloaded.h>\n #include <util/strencodings.h>\n #include <util/string.h>\n \n #include <list>\n+#include <variant>\n #include <vector>\n \n-struct COutputEntry;\n+//! State of transaction confirmed in a block.\n+struct TxStateConfirmed {\n+    uint256 confirmed_block_hash;\n+    int confirmed_block_height;\n+    int position_in_block;\n+\n+    explicit TxStateConfirmed(const uint256& block_hash, int height, int index) : confirmed_block_hash(block_hash), confirmed_block_height(height), position_in_block(index) {}\n+};\n+\n+//! State of transaction added to mempool.\n+struct TxStateInMempool {\n+};\n+\n+//! State of rejected transaction that conflicts with a confirmed block.\n+struct TxStateConflicted {\n+    uint256 conflicting_block_hash;\n+    int conflicting_block_height;\n+\n+    explicit TxStateConflicted(const uint256& block_hash, int height) : conflicting_block_hash(block_hash), conflicting_block_height(height) {}\n+};\n+\n+//! State of transaction not confirmed or conflicting with a known block and\n+//! not in the mempool. May conflict with the mempool, or with an unknown block,\n+//! or be abandoned, never broadcast, or rejected from the mempool for another\n+//! reason.\n+struct TxStateInactive {\n+    bool abandoned;\n+\n+    explicit TxStateInactive(bool abandoned = false) : abandoned(abandoned) {}\n+};\n+\n+//! State of transaction loaded in an unrecognized state with unexpected hash or\n+//! index values. Treated as inactive (with serialized hash and index values\n+//! preserved) by default, but may enter another state if transaction is added\n+//! to the mempool, or confirmed, or abandoned, or found conflicting.\n+struct TxStateUnrecognized {\n+    uint256 block_hash;\n+    int index;\n+\n+    TxStateUnrecognized(const uint256& block_hash, int index) : block_hash(block_hash), index(index) {}\n+};\n+\n+//! All possible CWalletTx states\n+using TxState = std::variant<TxStateConfirmed, TxStateInMempool, TxStateConflicted, TxStateInactive, TxStateUnrecognized>;\n+\n+//! Subset of states transaction sync logic is implemented to handle.\n+using SyncTxState = std::variant<TxStateConfirmed, TxStateInMempool, TxStateInactive>;\n+\n+//! Interpret TxState serialized fields as a recognized state.\n+static TxState TxStateInterpretSerialized(TxStateUnrecognized data)\n+{\n+    if (data.block_hash == uint256::ZERO) {\n+        if (data.index == 0) return TxStateInactive{};\n+    } else if (data.block_hash == uint256::ONE) {\n+        if (data.index == -1) return TxStateInactive{/* abandoned= */ true};\n+    } else if (data.index >= 0) {\n+        return TxStateConfirmed{data.block_hash, /* height= */ -1, data.index};\n+    } else if (data.index == -1) {\n+        return TxStateConflicted{data.block_hash, /* height= */ -1};\n+    }\n+    return data;\n+}\n+\n+//! Get TxState serialized block hash. Inverse of TxStateInterpretSerialized.\n+static uint256 TxStateSerializedBlockHash(const TxState& state)",
    "path": "src/wallet/transaction.h",
    "position": null,
    "original_position": 77,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "730df28e00822f06c9fc11c86a74f764a2f5136c",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "730df28e0082 seeing the following warnings when debug-building with debian clang 11\r\n\r\n```rake\r\n./wallet/transaction.h:221:59: warning: field 'tx' will be initialized after field 'm_state' [-Wreorder-ctor]\r\n    CWalletTx(CTransactionRef tx, const TxState& state) : tx(std::move(tx)), m_state(state)\r\n                                                          ^\r\n./wallet/transaction.h:71:16: warning: 'static' function 'TxStateInterpretSerialized' declared in header file should be declared 'static inline' [-Wunneeded-internal-declaration]\r\nstatic TxState TxStateInterpretSerialized(TxStateUnrecognized data)\r\n               ^\r\n./wallet/transaction.h:86:16: warning: 'static' function 'TxStateSerializedBlockHash' declared in header file should be declared 'static inline' [-Wunneeded-internal-declaration]\r\nstatic uint256 TxStateSerializedBlockHash(const TxState& state)\r\n               ^\r\n./wallet/transaction.h:98:12: warning: 'static' function 'TxStateSerializedIndex' declared in header file should be declared 'static inline' [-Wunneeded-internal-declaration]\r\nstatic int TxStateSerializedIndex(const TxState& state)\r\n           ^\r\n4 warnings generated.\r\n```\r\n",
    "created_at": "2021-06-28T14:04:44Z",
    "updated_at": "2021-06-28T14:04:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r659817279",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/659817279"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r659817279"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/659817279/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 86,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662084736",
    "pull_request_review_id": 696960717,
    "id": 662084736,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MjA4NDczNg==",
    "diff_hunk": "@@ -0,0 +1,21 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_UTIL_OVERLOADED_H\n+#define BITCOIN_UTIL_OVERLOADED_H\n+\n+#include <optional>\n+#include <utility>\n+\n+//! Overloaded helper for std::visit, useful to write code that switches on a\n+//! variant type and triggers a compile error if there are any unhandled cases.",
    "path": "src/util/overloaded.h",
    "position": null,
    "original_position": 12,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "4e11f88320b644b67db55fe737815451ca7d0681",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Just for reference, our existing use of `std::visit` will also throw compile errors even without this helper. I guess the goal of the helper is to having to write less code in the switch itself?",
    "created_at": "2021-07-01T08:23:03Z",
    "updated_at": "2021-07-01T08:23:03Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r662084736",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662084736"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r662084736"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662084736/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 12,
    "side": "RIGHT",
    "in_reply_to_id": 620339834
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662112681",
    "pull_request_review_id": 696998254,
    "id": 662112681,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MjExMjY4MQ==",
    "diff_hunk": "@@ -0,0 +1,21 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_UTIL_OVERLOADED_H\n+#define BITCOIN_UTIL_OVERLOADED_H\n+\n+#include <optional>\n+#include <utility>\n+\n+//! Overloaded helper for std::visit, useful to write code that switches on a\n+//! variant type and triggers a compile error if there are any unhandled cases.",
    "path": "src/util/overloaded.h",
    "position": null,
    "original_position": 12,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "4e11f88320b644b67db55fe737815451ca7d0681",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> Just for reference, our existing use of `std::visit` will also throw compile errors even without this helper. I guess the goal of the helper is to having to write less code in the switch itself?\r\n\r\nI think all existing uses of uses of `std::visit` use custom visitor classes which don't have access to local variables or anything. Or at least they did at the time this was written which was shortly after we enabled c++17. If it makes sense to define visitor classes for a particular variant type, this isn't really meant to be an alternative to that. This is just meant to be an alternative to using `if`/`else if` statements or a `switch` statement. I can update the comment to make it more clear, unless you're suggesting there might be a better way to use `std::visit` without this helper. In that case we could get rid of this.\r\n\r\n\r\n",
    "created_at": "2021-07-01T09:00:54Z",
    "updated_at": "2021-07-01T09:00:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r662112681",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662112681"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r662112681"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662112681/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 12,
    "side": "RIGHT",
    "in_reply_to_id": 620339834
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662620720",
    "pull_request_review_id": 697690678,
    "id": 662620720,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MjYyMDcyMA==",
    "diff_hunk": "@@ -11,18 +11,104 @@\n #include <wallet/ismine.h>\n #include <threadsafety.h>\n #include <tinyformat.h>\n+#include <util/overloaded.h>\n #include <util/strencodings.h>\n #include <util/string.h>\n \n #include <list>\n+#include <variant>\n #include <vector>\n \n-struct COutputEntry;\n+//! State of transaction confirmed in a block.\n+struct TxStateConfirmed {\n+    uint256 confirmed_block_hash;\n+    int confirmed_block_height;\n+    int position_in_block;\n+\n+    explicit TxStateConfirmed(const uint256& block_hash, int height, int index) : confirmed_block_hash(block_hash), confirmed_block_height(height), position_in_block(index) {}\n+};\n+\n+//! State of transaction added to mempool.\n+struct TxStateInMempool {\n+};\n+\n+//! State of rejected transaction that conflicts with a confirmed block.\n+struct TxStateConflicted {\n+    uint256 conflicting_block_hash;\n+    int conflicting_block_height;\n+\n+    explicit TxStateConflicted(const uint256& block_hash, int height) : conflicting_block_hash(block_hash), conflicting_block_height(height) {}\n+};\n+\n+//! State of transaction not confirmed or conflicting with a known block and\n+//! not in the mempool. May conflict with the mempool, or with an unknown block,\n+//! or be abandoned, never broadcast, or rejected from the mempool for another\n+//! reason.\n+struct TxStateInactive {\n+    bool abandoned;\n+\n+    explicit TxStateInactive(bool abandoned = false) : abandoned(abandoned) {}\n+};\n+\n+//! State of transaction loaded in an unrecognized state with unexpected hash or\n+//! index values. Treated as inactive (with serialized hash and index values\n+//! preserved) by default, but may enter another state if transaction is added\n+//! to the mempool, or confirmed, or abandoned, or found conflicting.\n+struct TxStateUnrecognized {\n+    uint256 block_hash;\n+    int index;\n+\n+    TxStateUnrecognized(const uint256& block_hash, int index) : block_hash(block_hash), index(index) {}\n+};\n+\n+//! All possible CWalletTx states\n+using TxState = std::variant<TxStateConfirmed, TxStateInMempool, TxStateConflicted, TxStateInactive, TxStateUnrecognized>;\n+\n+//! Subset of states transaction sync logic is implemented to handle.\n+using SyncTxState = std::variant<TxStateConfirmed, TxStateInMempool, TxStateInactive>;\n+\n+//! Interpret TxState serialized fields as a recognized state.\n+static TxState TxStateInterpretSerialized(TxStateUnrecognized data)\n+{\n+    if (data.block_hash == uint256::ZERO) {\n+        if (data.index == 0) return TxStateInactive{};\n+    } else if (data.block_hash == uint256::ONE) {\n+        if (data.index == -1) return TxStateInactive{/* abandoned= */ true};\n+    } else if (data.index >= 0) {\n+        return TxStateConfirmed{data.block_hash, /* height= */ -1, data.index};\n+    } else if (data.index == -1) {\n+        return TxStateConflicted{data.block_hash, /* height= */ -1};\n+    }\n+    return data;\n+}\n+\n+//! Get TxState serialized block hash. Inverse of TxStateInterpretSerialized.\n+static uint256 TxStateSerializedBlockHash(const TxState& state)",
    "path": "src/wallet/transaction.h",
    "position": null,
    "original_position": 77,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "730df28e00822f06c9fc11c86a74f764a2f5136c",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> [730df28](https://github.com/bitcoin/bitcoin/commit/730df28e00822f06c9fc11c86a74f764a2f5136c) seeing the following warnings when debug-building with debian clang 11\r\n\r\nThanks! Should be fixed in new push",
    "created_at": "2021-07-01T22:10:59Z",
    "updated_at": "2021-07-01T22:13:10Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r662620720",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662620720"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r662620720"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662620720/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 86,
    "side": "RIGHT",
    "in_reply_to_id": 659817279
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662907496",
    "pull_request_review_id": 698044839,
    "id": 662907496,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MjkwNzQ5Ng==",
    "diff_hunk": "@@ -0,0 +1,21 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_UTIL_OVERLOADED_H\n+#define BITCOIN_UTIL_OVERLOADED_H\n+\n+#include <optional>\n+#include <utility>\n+\n+//! Overloaded helper for std::visit, useful to write code that switches on a\n+//! variant type and triggers a compile error if there are any unhandled cases.",
    "path": "src/util/overloaded.h",
    "position": null,
    "original_position": 12,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "4e11f88320b644b67db55fe737815451ca7d0681",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Not saying that this way is better, just saying that it will also emit compile errors even without the helper:\r\n\r\n```diff\r\ndiff --git a/src/wallet/transaction.h b/src/wallet/transaction.h\r\nindex 7dc91bebd8..5a717e498c 100644\r\n--- a/src/wallet/transaction.h\r\n+++ b/src/wallet/transaction.h\r\n@@ -8,12 +8,11 @@\r\n #include <amount.h>\r\n #include <primitives/transaction.h>\r\n #include <serialize.h>\r\n-#include <wallet/ismine.h>\r\n #include <threadsafety.h>\r\n #include <tinyformat.h>\r\n-#include <util/overloaded.h>\r\n #include <util/strencodings.h>\r\n #include <util/string.h>\r\n+#include <wallet/ismine.h>\r\n \r\n #include <list>\r\n #include <variant>\r\n@@ -85,25 +84,27 @@ static inline TxState TxStateInterpretSerialized(TxStateUnrecognized data)\r\n //! Get TxState serialized block hash. Inverse of TxStateInterpretSerialized.\r\n static inline uint256 TxStateSerializedBlockHash(const TxState& state)\r\n {\r\n-    return std::visit(Overloaded{\r\n-        [](const TxStateConfirmed& confirmed) { return confirmed.confirmed_block_hash; },\r\n-        [](const TxStateConflicted& conflicted) { return conflicted.conflicting_block_hash; },\r\n-        [](const TxStateInMempool& in_mempool) { return uint256::ZERO; },\r\n-        [](const TxStateInactive& inactive) { return inactive.abandoned ? uint256::ONE : uint256::ZERO; },\r\n-        [](const TxStateUnrecognized& unrecognized) { return unrecognized.block_hash; }\r\n-    }, state);\r\n+    struct Overloaded {\r\n+        uint256 operator()(const TxStateConfirmed& confirmed) { return confirmed.confirmed_block_hash; }\r\n+        uint256 operator()(const TxStateConflicted& conflicted) { return conflicted.conflicting_block_hash; }\r\n+        uint256 operator()(const TxStateInMempool& in_mempool) { return uint256::ZERO; }\r\n+        uint256 operator()(const TxStateInactive& inactive) { return inactive.abandoned ? uint256::ONE : uint256::ZERO; }\r\n+        uint256 operator()(const TxStateUnrecognized& unrecognized) { return unrecognized.block_hash; }\r\n+    };\r\n+    return std::visit(Overloaded{}, state);\r\n }\r\n \r\n //! Get TxState serialized block index. Inverse of TxStateInterpretSerialized.\r\n static inline int TxStateSerializedIndex(const TxState& state)\r\n {\r\n-    return std::visit(Overloaded{\r\n-        [](const TxStateConfirmed& confirmed) { return confirmed.position_in_block; },\r\n-        [](const TxStateConflicted& conflicted) { return -1; },\r\n-        [](const TxStateInMempool& in_mempool) { return 0; },\r\n-        [](const TxStateInactive& inactive) { return inactive.abandoned ? -1 : 0; },\r\n-        [](const TxStateUnrecognized& unrecognized) { return unrecognized.index; }\r\n-    }, state);\r\n+    struct Overloaded {\r\n+        int operator()(const TxStateConfirmed& confirmed) { return confirmed.position_in_block; }\r\n+        int operator()(const TxStateConflicted& conflicted) { return -1; }\r\n+        int operator()(const TxStateInMempool& in_mempool) { return 0; }\r\n+        int operator()(const TxStateInactive& inactive) { return inactive.abandoned ? -1 : 0; }\r\n+        int operator()(const TxStateUnrecognized& unrecognized) { return unrecognized.index; }\r\n+    };\r\n+    return std::visit(Overloaded{}, state);\r\n }\r\n \r\n \r\n",
    "created_at": "2021-07-02T10:21:12Z",
    "updated_at": "2021-07-02T10:21:13Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r662907496",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662907496"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r662907496"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662907496/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 12,
    "side": "RIGHT",
    "in_reply_to_id": 620339834
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/754538897",
    "pull_request_review_id": 812890287,
    "id": 754538897,
    "node_id": "PRRC_kwDOABII584s-VmR",
    "diff_hunk": "@@ -369,11 +369,9 @@ RPCHelpMan importprunedfunds()\n \n     unsigned int txnIndex = vIndex[it - vMatch.begin()];\n \n-    CWalletTx::Confirmation confirm(CWalletTx::Status::CONFIRMED, height, merkleBlock.header.GetHash(), txnIndex);\n-\n     CTransactionRef tx_ref = MakeTransactionRef(tx);\n     if (pwallet->IsMine(*tx_ref)) {\n-        pwallet->AddToWallet(std::move(tx_ref), confirm);\n+        pwallet->AddToWallet(std::move(tx_ref), TxStateConfirmed{merkleBlock.header.GetHash(), height, (int)txnIndex});",
    "path": "src/wallet/rpcdump.cpp",
    "position": null,
    "original_position": 9,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "78c8ac87e2f585772f296b943c733bd26f255ba0",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "if you retouch, per https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-casts-named (unless there is a reason to not follow the guideline)\r\n\r\n```suggestion\r\n        pwallet->AddToWallet(std::move(tx_ref), TxStateConfirmed{merkleBlock.header.GetHash(), height, static_cast<int>(txnIndex)});\r\n```\r\n\r\n(this is also the change suggested by clang)\r\n```\r\nwallet/rpcdump.cpp:374:104: error: non-constant-expression cannot be narrowed from type 'unsigned int' to 'int' in initializer list [-Wc++11-narrowing]\r\n        pwallet->AddToWallet(std::move(tx_ref), TxStateConfirmed{merkleBlock.header.GetHash(), height, txnIndex});\r\n                                                                                                       ^~~~~~~~\r\nwallet/rpcdump.cpp:374:104: note: insert an explicit cast to silence this issue\r\n        pwallet->AddToWallet(std::move(tx_ref), TxStateConfirmed{merkleBlock.header.GetHash(), height, txnIndex});\r\n                                                                                                       ^~~~~~~~\r\n                                                                                                       static_cast<int>( )\r\n1 error generated.\r\n```\r\n",
    "created_at": "2021-11-22T18:33:20Z",
    "updated_at": "2021-11-23T21:26:59Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r754538897",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/754538897"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r754538897"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/754538897/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 374,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/754553318",
    "pull_request_review_id": 812890287,
    "id": 754553318,
    "node_id": "PRRC_kwDOABII584s-ZHm",
    "diff_hunk": "@@ -576,7 +576,7 @@ class CWallet final : public WalletStorage, public interfaces::Chain::Notificati\n     void CommitTransaction(CTransactionRef tx, mapValue_t mapValue, std::vector<std::pair<std::string, std::string>> orderForm);\n \n     /** Pass this transaction to node for mempool insertion and relay to peers if flag set to true */\n-    bool SubmitTxMemoryPoolAndRelay(const CWalletTx& wtx, std::string& err_string, bool relay) const;\n+    bool SubmitTxMemoryPoolAndRelay(CWalletTx& wtx, std::string& err_string, bool relay) const;",
    "path": "src/wallet/wallet.h",
    "position": 32,
    "original_position": 32,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "78c8ac87e2f585772f296b943c733bd26f255ba0",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Perhaps update the Doxygen documentation in the previous line to explain why `wtx` is after this change mutable / an out-param.",
    "created_at": "2021-11-22T18:55:07Z",
    "updated_at": "2021-11-23T21:26:59Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r754553318",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/754553318"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r754553318"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/754553318/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 579,
    "original_line": 579,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/754559310",
    "pull_request_review_id": 812890287,
    "id": 754559310,
    "node_id": "PRRC_kwDOABII584s-alO",
    "diff_hunk": "@@ -1645,7 +1641,7 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n                 break;\n             }\n             for (size_t posInBlock = 0; posInBlock < block.vtx.size(); ++posInBlock) {\n-                SyncTransaction(block.vtx[posInBlock], {CWalletTx::Status::CONFIRMED, block_height, block_hash, (int)posInBlock}, fUpdate, /* rescanning_old_block */ true);\n+                SyncTransaction(block.vtx[posInBlock], TxStateConfirmed{block_hash, block_height, (int)posInBlock}, fUpdate, /* rescanning_old_block */ true);",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 230,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "78c8ac87e2f585772f296b943c733bd26f255ba0",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Here and elsewhere in this commit, maybe format the named args to be compatible with clang-tidy in a way consistent with current changes in the codebase (see #23546 and #23545).\r\n```suggestion\r\n                SyncTransaction(block.vtx[posInBlock], TxStateConfirmed{block_hash, block_height, static_cast<int>(posInBlock)}, fUpdate, /*rescanning_old_block=*/true);\r\n```\r\nalso, use a named cast for `posInBlock`",
    "created_at": "2021-11-22T19:04:17Z",
    "updated_at": "2021-11-23T21:26:59Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r754559310",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/754559310"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r754559310"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/754559310/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1644,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755390201",
    "pull_request_review_id": 812890287,
    "id": 755390201,
    "node_id": "PRRC_kwDOABII584tBlb5",
    "diff_hunk": "@@ -11,12 +11,102 @@\n #include <wallet/ismine.h>\n #include <threadsafety.h>\n #include <tinyformat.h>\n+#include <util/overloaded.h>\n #include <util/strencodings.h>\n #include <util/string.h>\n \n #include <list>\n+#include <variant>\n #include <vector>\n \n+//! State of transaction confirmed in a block.\n+struct TxStateConfirmed {\n+    uint256 confirmed_block_hash;\n+    int confirmed_block_height;\n+    int position_in_block;\n+\n+    explicit TxStateConfirmed(const uint256& block_hash, int height, int index) : confirmed_block_hash(block_hash), confirmed_block_height(height), position_in_block(index) {}\n+};\n+\n+//! State of transaction added to mempool.\n+struct TxStateInMempool {\n+};\n+\n+//! State of rejected transaction that conflicts with a confirmed block.\n+struct TxStateConflicted {\n+    uint256 conflicting_block_hash;\n+    int conflicting_block_height;\n+\n+    explicit TxStateConflicted(const uint256& block_hash, int height) : conflicting_block_hash(block_hash), conflicting_block_height(height) {}\n+};\n+\n+//! State of transaction not confirmed or conflicting with a known block and\n+//! not in the mempool. May conflict with the mempool, or with an unknown block,\n+//! or be abandoned, never broadcast, or rejected from the mempool for another\n+//! reason.\n+struct TxStateInactive {\n+    bool abandoned;\n+\n+    explicit TxStateInactive(bool abandoned = false) : abandoned(abandoned) {}\n+};\n+\n+//! State of transaction loaded in an unrecognized state with unexpected hash or\n+//! index values. Treated as inactive (with serialized hash and index values\n+//! preserved) by default, but may enter another state if transaction is added\n+//! to the mempool, or confirmed, or abandoned, or found conflicting.\n+struct TxStateUnrecognized {\n+    uint256 block_hash;\n+    int index;\n+\n+    TxStateUnrecognized(const uint256& block_hash, int index) : block_hash(block_hash), index(index) {}\n+};\n+\n+//! All possible CWalletTx states\n+using TxState = std::variant<TxStateConfirmed, TxStateInMempool, TxStateConflicted, TxStateInactive, TxStateUnrecognized>;\n+\n+//! Subset of states transaction sync logic is implemented to handle.\n+using SyncTxState = std::variant<TxStateConfirmed, TxStateInMempool, TxStateInactive>;\n+\n+//! Interpret TxState serialized fields as a recognized state.\n+static inline TxState TxStateInterpretSerialized(TxStateUnrecognized data)",
    "path": "src/wallet/transaction.h",
    "position": 61,
    "original_position": 61,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "78c8ac87e2f585772f296b943c733bd26f255ba0",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Seems odd to pass a `TxStateUnrecognized` data type for `a recognized state`. Edit: maybe suggest the fields are \"converted from an unrecognized to recognized state.\"",
    "created_at": "2021-11-23T18:09:27Z",
    "updated_at": "2021-11-23T21:39:07Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755390201",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755390201"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755390201"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755390201/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 71,
    "original_line": 71,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755391363",
    "pull_request_review_id": 812890287,
    "id": 755391363,
    "node_id": "PRRC_kwDOABII584tBluD",
    "diff_hunk": "@@ -11,12 +11,102 @@\n #include <wallet/ismine.h>\n #include <threadsafety.h>\n #include <tinyformat.h>\n+#include <util/overloaded.h>\n #include <util/strencodings.h>\n #include <util/string.h>\n \n #include <list>\n+#include <variant>\n #include <vector>\n \n+//! State of transaction confirmed in a block.\n+struct TxStateConfirmed {\n+    uint256 confirmed_block_hash;\n+    int confirmed_block_height;\n+    int position_in_block;\n+\n+    explicit TxStateConfirmed(const uint256& block_hash, int height, int index) : confirmed_block_hash(block_hash), confirmed_block_height(height), position_in_block(index) {}\n+};\n+\n+//! State of transaction added to mempool.\n+struct TxStateInMempool {\n+};\n+\n+//! State of rejected transaction that conflicts with a confirmed block.\n+struct TxStateConflicted {\n+    uint256 conflicting_block_hash;\n+    int conflicting_block_height;\n+\n+    explicit TxStateConflicted(const uint256& block_hash, int height) : conflicting_block_hash(block_hash), conflicting_block_height(height) {}\n+};\n+\n+//! State of transaction not confirmed or conflicting with a known block and\n+//! not in the mempool. May conflict with the mempool, or with an unknown block,\n+//! or be abandoned, never broadcast, or rejected from the mempool for another\n+//! reason.\n+struct TxStateInactive {\n+    bool abandoned;\n+\n+    explicit TxStateInactive(bool abandoned = false) : abandoned(abandoned) {}\n+};\n+\n+//! State of transaction loaded in an unrecognized state with unexpected hash or\n+//! index values. Treated as inactive (with serialized hash and index values\n+//! preserved) by default, but may enter another state if transaction is added\n+//! to the mempool, or confirmed, or abandoned, or found conflicting.\n+struct TxStateUnrecognized {\n+    uint256 block_hash;\n+    int index;\n+\n+    TxStateUnrecognized(const uint256& block_hash, int index) : block_hash(block_hash), index(index) {}\n+};\n+\n+//! All possible CWalletTx states\n+using TxState = std::variant<TxStateConfirmed, TxStateInMempool, TxStateConflicted, TxStateInactive, TxStateUnrecognized>;\n+\n+//! Subset of states transaction sync logic is implemented to handle.\n+using SyncTxState = std::variant<TxStateConfirmed, TxStateInMempool, TxStateInactive>;\n+\n+//! Interpret TxState serialized fields as a recognized state.\n+static inline TxState TxStateInterpretSerialized(TxStateUnrecognized data)\n+{\n+    if (data.block_hash == uint256::ZERO) {\n+        if (data.index == 0) return TxStateInactive{};\n+    } else if (data.block_hash == uint256::ONE) {\n+        if (data.index == -1) return TxStateInactive{/* abandoned= */ true};\n+    } else if (data.index >= 0) {\n+        return TxStateConfirmed{data.block_hash, /* height= */ -1, data.index};\n+    } else if (data.index == -1) {\n+        return TxStateConflicted{data.block_hash, /* height= */ -1};\n+    }\n+    return data;\n+}\n+\n+//! Get TxState serialized block hash. Inverse of TxStateInterpretSerialized.\n+static inline uint256 TxStateSerializedBlockHash(const TxState& state)\n+{\n+    return std::visit(Overloaded{\n+        [](const TxStateConfirmed& confirmed) { return confirmed.confirmed_block_hash; },\n+        [](const TxStateConflicted& conflicted) { return conflicted.conflicting_block_hash; },\n+        [](const TxStateInMempool& in_mempool) { return uint256::ZERO; },\n+        [](const TxStateInactive& inactive) { return inactive.abandoned ? uint256::ONE : uint256::ZERO; },\n+        [](const TxStateUnrecognized& unrecognized) { return unrecognized.block_hash; }",
    "path": "src/wallet/transaction.h",
    "position": 83,
    "original_position": 83,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "78c8ac87e2f585772f296b943c733bd26f255ba0",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit, perhaps order the state methods above in the order used here and in the next function, or vice versa.",
    "created_at": "2021-11-23T18:11:07Z",
    "updated_at": "2021-11-23T21:26:59Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755391363",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755391363"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755391363"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755391363/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 93,
    "original_line": 93,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755510636",
    "pull_request_review_id": 812890287,
    "id": 755510636,
    "node_id": "PRRC_kwDOABII584tCC1s",
    "diff_hunk": "@@ -129,44 +211,12 @@ class CWalletTx\n         nTimeSmart = 0;\n         fFromMe = false;\n         fChangeCached = false;\n-        fInMempool = false;",
    "path": "src/wallet/transaction.h",
    "position": 133,
    "original_position": 133,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "78c8ac87e2f585772f296b943c733bd26f255ba0",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "There appear to be remaining `fInMempool` comments that may need updating.\r\n\r\n```cpp\r\nsrc/wallet/wallet.cpp:1733:    // We must set fInMempool here - while it will be re-set to true by the\r\nsrc/wallet/wallet.cpp-1734-    // entered-mempool callback, if we did not there would be a race where a\r\nsrc/wallet/wallet.cpp-1735-    // user could call sendmoney in a loop and hit spurious out of funds errors\r\nsrc/wallet/wallet.cpp-1736-    // because we think that this newly generated transaction's change is\r\nsrc/wallet/wallet.cpp-1737-    // unavailable as we're not yet aware that it is in the mempool.\r\nsrc/wallet/wallet.cpp-1738-    //\r\nsrc/wallet/wallet.cpp:1739:    // Irrespective of the failure reason, un-marking fInMempool\r\nsrc/wallet/wallet.cpp-1740-    // out-of-order is incorrect - it should be unmarked when\r\nsrc/wallet/wallet.cpp-1741-    // TransactionRemovedFromMempool fires.\r\n--\r\nsrc/wallet/wallet.cpp:1973    // Get the inserted-CWalletTx from mapWallet so that the\r\nsrc/wallet/wallet.cpp:1974    // fInMempool flag is cached properly\r\n```\r\n",
    "created_at": "2021-11-23T21:19:39Z",
    "updated_at": "2021-11-23T21:26:59Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755510636",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755510636"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755510636"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755510636/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 132,
    "original_line": 132,
    "side": "LEFT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755512157",
    "pull_request_review_id": 812890287,
    "id": 755512157,
    "node_id": "PRRC_kwDOABII584tCDNd",
    "diff_hunk": "@@ -0,0 +1,23 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_UTIL_OVERLOADED_H\n+#define BITCOIN_UTIL_OVERLOADED_H\n+\n+#include <optional>\n+#include <utility>",
    "path": "src/util/overloaded.h",
    "position": null,
    "original_position": 9,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "78c8ac87e2f585772f296b943c733bd26f255ba0",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Should these two includes be replaced by `#include <variant>`?",
    "created_at": "2021-11-23T21:22:19Z",
    "updated_at": "2021-11-23T21:26:59Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755512157",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755512157"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755512157"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755512157/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 9,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755518787",
    "pull_request_review_id": 814194058,
    "id": 755518787,
    "node_id": "PRRC_kwDOABII584tCE1D",
    "diff_hunk": "@@ -990,30 +989,29 @@ CWalletTx* CWallet::AddToWallet(CTransactionRef tx, const CWalletTx::Confirmatio\n \n bool CWallet::LoadToWallet(const uint256& hash, const UpdateWalletTxFn& fill_wtx)\n {\n-    const auto& ins = mapWallet.emplace(std::piecewise_construct, std::forward_as_tuple(hash), std::forward_as_tuple(nullptr));\n+    const auto& ins = mapWallet.emplace(std::piecewise_construct, std::forward_as_tuple(hash), std::forward_as_tuple(nullptr, TxStateInactive{}));\n     CWalletTx& wtx = ins.first->second;\n     if (!fill_wtx(wtx, ins.second)) {\n         return false;\n     }\n     // If wallet doesn't have a chain (e.g wallet-tool), don't bother to update txn.\n     if (HaveChain()) {\n         bool active;\n-        int height;\n-        if (chain().findBlock(wtx.m_confirm.hashBlock, FoundBlock().inActiveChain(active).height(height)) && active) {\n-            // Update cached block height variable since it not stored in the\n-            // serialized transaction.\n-            wtx.m_confirm.block_height = height;\n-        } else if (wtx.isConflicted() || wtx.isConfirmed()) {\n+        auto lookup_block = [&](const uint256& hash, int& height, TxState& state) {",
    "path": "src/wallet/wallet.cpp",
    "position": 90,
    "original_position": 90,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "78c8ac87e2f585772f296b943c733bd26f255ba0",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\n        auto lookup_block = [&](const uint256& hash, int height, TxState& state) {\r\n```",
    "created_at": "2021-11-23T21:33:20Z",
    "updated_at": "2021-11-23T21:33:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755518787",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755518787"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755518787"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755518787/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1000,
    "original_line": 1000,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755586561",
    "pull_request_review_id": 814286600,
    "id": 755586561,
    "node_id": "PRRC_kwDOABII584tCVYB",
    "diff_hunk": "@@ -0,0 +1,23 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_UTIL_OVERLOADED_H\n+#define BITCOIN_UTIL_OVERLOADED_H\n+\n+#include <optional>\n+#include <utility>",
    "path": "src/util/overloaded.h",
    "position": null,
    "original_position": 9,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "78c8ac87e2f585772f296b943c733bd26f255ba0",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "re: https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755512157\r\n\r\n> Should these two includes be replaced by `#include <variant>`?\r\n\r\nGood catch. I think these were just copied and pasted from another header. The variant type is not actually referenced so I believe no includes are necessary.",
    "created_at": "2021-11-23T23:34:34Z",
    "updated_at": "2021-11-24T01:26:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755586561",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755586561"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755586561"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755586561/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 9,
    "side": "RIGHT",
    "in_reply_to_id": 755512157
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755593727",
    "pull_request_review_id": 814286600,
    "id": 755593727,
    "node_id": "PRRC_kwDOABII584tCXH_",
    "diff_hunk": "@@ -369,11 +369,9 @@ RPCHelpMan importprunedfunds()\n \n     unsigned int txnIndex = vIndex[it - vMatch.begin()];\n \n-    CWalletTx::Confirmation confirm(CWalletTx::Status::CONFIRMED, height, merkleBlock.header.GetHash(), txnIndex);\n-\n     CTransactionRef tx_ref = MakeTransactionRef(tx);\n     if (pwallet->IsMine(*tx_ref)) {\n-        pwallet->AddToWallet(std::move(tx_ref), confirm);\n+        pwallet->AddToWallet(std::move(tx_ref), TxStateConfirmed{merkleBlock.header.GetHash(), height, (int)txnIndex});",
    "path": "src/wallet/rpcdump.cpp",
    "position": null,
    "original_position": 9,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "78c8ac87e2f585772f296b943c733bd26f255ba0",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "re: https://github.com/bitcoin/bitcoin/pull/21206#discussion_r754538897\r\n\r\nOk. I don't see how this helps readability or could help catching errors here, but I guess I'll give benefit of the doubt and change.\r\n\r\n>```\r\n>wallet/rpcdump.cpp:374:104: error: non-constant-expression cannot be narrowed from type 'unsigned int' to 'int' in initializer list [-Wc++11-narrowing]\r\n>```\r\n\r\nThis warning doesn't happen with either cast, so it doesn't seem like a good reason to chose the more verbose cast.\r\n\r\nI think when you have a specific point to make, it's good to cite an external guideline to help make the point. But I don't think it's good to just parrot a guideline without saying what problem it's addressing in the relevant context.",
    "created_at": "2021-11-23T23:51:09Z",
    "updated_at": "2021-11-24T01:26:13Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755593727",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755593727"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755593727"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755593727/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 374,
    "side": "RIGHT",
    "in_reply_to_id": 754538897
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755599419",
    "pull_request_review_id": 814286600,
    "id": 755599419,
    "node_id": "PRRC_kwDOABII584tCYg7",
    "diff_hunk": "@@ -11,12 +11,102 @@\n #include <wallet/ismine.h>\n #include <threadsafety.h>\n #include <tinyformat.h>\n+#include <util/overloaded.h>\n #include <util/strencodings.h>\n #include <util/string.h>\n \n #include <list>\n+#include <variant>\n #include <vector>\n \n+//! State of transaction confirmed in a block.\n+struct TxStateConfirmed {\n+    uint256 confirmed_block_hash;\n+    int confirmed_block_height;\n+    int position_in_block;\n+\n+    explicit TxStateConfirmed(const uint256& block_hash, int height, int index) : confirmed_block_hash(block_hash), confirmed_block_height(height), position_in_block(index) {}\n+};\n+\n+//! State of transaction added to mempool.\n+struct TxStateInMempool {\n+};\n+\n+//! State of rejected transaction that conflicts with a confirmed block.\n+struct TxStateConflicted {\n+    uint256 conflicting_block_hash;\n+    int conflicting_block_height;\n+\n+    explicit TxStateConflicted(const uint256& block_hash, int height) : conflicting_block_hash(block_hash), conflicting_block_height(height) {}\n+};\n+\n+//! State of transaction not confirmed or conflicting with a known block and\n+//! not in the mempool. May conflict with the mempool, or with an unknown block,\n+//! or be abandoned, never broadcast, or rejected from the mempool for another\n+//! reason.\n+struct TxStateInactive {\n+    bool abandoned;\n+\n+    explicit TxStateInactive(bool abandoned = false) : abandoned(abandoned) {}\n+};\n+\n+//! State of transaction loaded in an unrecognized state with unexpected hash or\n+//! index values. Treated as inactive (with serialized hash and index values\n+//! preserved) by default, but may enter another state if transaction is added\n+//! to the mempool, or confirmed, or abandoned, or found conflicting.\n+struct TxStateUnrecognized {\n+    uint256 block_hash;\n+    int index;\n+\n+    TxStateUnrecognized(const uint256& block_hash, int index) : block_hash(block_hash), index(index) {}\n+};\n+\n+//! All possible CWalletTx states\n+using TxState = std::variant<TxStateConfirmed, TxStateInMempool, TxStateConflicted, TxStateInactive, TxStateUnrecognized>;\n+\n+//! Subset of states transaction sync logic is implemented to handle.\n+using SyncTxState = std::variant<TxStateConfirmed, TxStateInMempool, TxStateInactive>;\n+\n+//! Interpret TxState serialized fields as a recognized state.\n+static inline TxState TxStateInterpretSerialized(TxStateUnrecognized data)",
    "path": "src/wallet/transaction.h",
    "position": 61,
    "original_position": 61,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "78c8ac87e2f585772f296b943c733bd26f255ba0",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "re: https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755390201\r\n\r\n> Seems odd to pass a `TxStateUnrecognized` data type for `a recognized state`. Edit: maybe suggest the fields are \"converted from an unrecognized to recognized state.\"\r\n\r\nThanks, rephrased now.\r\n\r\nJust to explain the previous version: \"Interpret TxState serialized fields as a recognized state\" was supposed to be read like \"Interpret serialized bytes as an integer\"",
    "created_at": "2021-11-24T00:05:28Z",
    "updated_at": "2021-11-24T01:26:13Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755599419",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755599419"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755599419"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755599419/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 71,
    "original_line": 71,
    "side": "RIGHT",
    "in_reply_to_id": 755390201
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755600701",
    "pull_request_review_id": 814286600,
    "id": 755600701,
    "node_id": "PRRC_kwDOABII584tCY09",
    "diff_hunk": "@@ -11,12 +11,102 @@\n #include <wallet/ismine.h>\n #include <threadsafety.h>\n #include <tinyformat.h>\n+#include <util/overloaded.h>\n #include <util/strencodings.h>\n #include <util/string.h>\n \n #include <list>\n+#include <variant>\n #include <vector>\n \n+//! State of transaction confirmed in a block.\n+struct TxStateConfirmed {\n+    uint256 confirmed_block_hash;\n+    int confirmed_block_height;\n+    int position_in_block;\n+\n+    explicit TxStateConfirmed(const uint256& block_hash, int height, int index) : confirmed_block_hash(block_hash), confirmed_block_height(height), position_in_block(index) {}\n+};\n+\n+//! State of transaction added to mempool.\n+struct TxStateInMempool {\n+};\n+\n+//! State of rejected transaction that conflicts with a confirmed block.\n+struct TxStateConflicted {\n+    uint256 conflicting_block_hash;\n+    int conflicting_block_height;\n+\n+    explicit TxStateConflicted(const uint256& block_hash, int height) : conflicting_block_hash(block_hash), conflicting_block_height(height) {}\n+};\n+\n+//! State of transaction not confirmed or conflicting with a known block and\n+//! not in the mempool. May conflict with the mempool, or with an unknown block,\n+//! or be abandoned, never broadcast, or rejected from the mempool for another\n+//! reason.\n+struct TxStateInactive {\n+    bool abandoned;\n+\n+    explicit TxStateInactive(bool abandoned = false) : abandoned(abandoned) {}\n+};\n+\n+//! State of transaction loaded in an unrecognized state with unexpected hash or\n+//! index values. Treated as inactive (with serialized hash and index values\n+//! preserved) by default, but may enter another state if transaction is added\n+//! to the mempool, or confirmed, or abandoned, or found conflicting.\n+struct TxStateUnrecognized {\n+    uint256 block_hash;\n+    int index;\n+\n+    TxStateUnrecognized(const uint256& block_hash, int index) : block_hash(block_hash), index(index) {}\n+};\n+\n+//! All possible CWalletTx states\n+using TxState = std::variant<TxStateConfirmed, TxStateInMempool, TxStateConflicted, TxStateInactive, TxStateUnrecognized>;\n+\n+//! Subset of states transaction sync logic is implemented to handle.\n+using SyncTxState = std::variant<TxStateConfirmed, TxStateInMempool, TxStateInactive>;\n+\n+//! Interpret TxState serialized fields as a recognized state.\n+static inline TxState TxStateInterpretSerialized(TxStateUnrecognized data)\n+{\n+    if (data.block_hash == uint256::ZERO) {\n+        if (data.index == 0) return TxStateInactive{};\n+    } else if (data.block_hash == uint256::ONE) {\n+        if (data.index == -1) return TxStateInactive{/* abandoned= */ true};\n+    } else if (data.index >= 0) {\n+        return TxStateConfirmed{data.block_hash, /* height= */ -1, data.index};\n+    } else if (data.index == -1) {\n+        return TxStateConflicted{data.block_hash, /* height= */ -1};\n+    }\n+    return data;\n+}\n+\n+//! Get TxState serialized block hash. Inverse of TxStateInterpretSerialized.\n+static inline uint256 TxStateSerializedBlockHash(const TxState& state)\n+{\n+    return std::visit(Overloaded{\n+        [](const TxStateConfirmed& confirmed) { return confirmed.confirmed_block_hash; },\n+        [](const TxStateConflicted& conflicted) { return conflicted.conflicting_block_hash; },\n+        [](const TxStateInMempool& in_mempool) { return uint256::ZERO; },\n+        [](const TxStateInactive& inactive) { return inactive.abandoned ? uint256::ONE : uint256::ZERO; },\n+        [](const TxStateUnrecognized& unrecognized) { return unrecognized.block_hash; }",
    "path": "src/wallet/transaction.h",
    "position": 83,
    "original_position": 83,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "78c8ac87e2f585772f296b943c733bd26f255ba0",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "re: https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755391363\r\n\r\n> nit, perhaps order the state methods above in the order used here and in the next function, or vice versa.\r\n\r\nGood suggestion. Fixed!\r\n\r\n(Assuming you meant \"previous function\" instead of \"next function\" since next function already used the same order)\r\n\r\n",
    "created_at": "2021-11-24T00:09:08Z",
    "updated_at": "2021-11-24T01:26:13Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755600701",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755600701"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755600701"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755600701/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 93,
    "original_line": 93,
    "side": "RIGHT",
    "in_reply_to_id": 755391363
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755601996",
    "pull_request_review_id": 814286600,
    "id": 755601996,
    "node_id": "PRRC_kwDOABII584tCZJM",
    "diff_hunk": "@@ -129,44 +211,12 @@ class CWalletTx\n         nTimeSmart = 0;\n         fFromMe = false;\n         fChangeCached = false;\n-        fInMempool = false;",
    "path": "src/wallet/transaction.h",
    "position": 133,
    "original_position": 133,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "78c8ac87e2f585772f296b943c733bd26f255ba0",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "re: https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755510636\r\n\r\n> There appear to be remaining `fInMempool` comments that may need updating.\r\n\r\nNice catch! Updated these\r\n",
    "created_at": "2021-11-24T00:12:40Z",
    "updated_at": "2021-11-24T01:26:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755601996",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755601996"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755601996"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755601996/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 132,
    "original_line": 132,
    "side": "LEFT",
    "in_reply_to_id": 755510636
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755609277",
    "pull_request_review_id": 814286600,
    "id": 755609277,
    "node_id": "PRRC_kwDOABII584tCa69",
    "diff_hunk": "@@ -990,30 +989,29 @@ CWalletTx* CWallet::AddToWallet(CTransactionRef tx, const CWalletTx::Confirmatio\n \n bool CWallet::LoadToWallet(const uint256& hash, const UpdateWalletTxFn& fill_wtx)\n {\n-    const auto& ins = mapWallet.emplace(std::piecewise_construct, std::forward_as_tuple(hash), std::forward_as_tuple(nullptr));\n+    const auto& ins = mapWallet.emplace(std::piecewise_construct, std::forward_as_tuple(hash), std::forward_as_tuple(nullptr, TxStateInactive{}));\n     CWalletTx& wtx = ins.first->second;\n     if (!fill_wtx(wtx, ins.second)) {\n         return false;\n     }\n     // If wallet doesn't have a chain (e.g wallet-tool), don't bother to update txn.\n     if (HaveChain()) {\n         bool active;\n-        int height;\n-        if (chain().findBlock(wtx.m_confirm.hashBlock, FoundBlock().inActiveChain(active).height(height)) && active) {\n-            // Update cached block height variable since it not stored in the\n-            // serialized transaction.\n-            wtx.m_confirm.block_height = height;\n-        } else if (wtx.isConflicted() || wtx.isConfirmed()) {\n+        auto lookup_block = [&](const uint256& hash, int& height, TxState& state) {",
    "path": "src/wallet/wallet.cpp",
    "position": 90,
    "original_position": 90,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "78c8ac87e2f585772f296b943c733bd26f255ba0",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "re: https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755518787\r\n\r\nSorry, this is an output variable, so making this change would leave heights unset. I want to scrap this code completely after this PR (see previous review comments), but the goal for this PR is to make the smallest possible code changes in the wallet everywhere that switch to a new CWalletTx state representation without changing behavior. Then future PRs can clean up the code and nonsensical behavior in individual places like this.",
    "created_at": "2021-11-24T00:34:18Z",
    "updated_at": "2021-11-24T01:26:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755609277",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755609277"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755609277"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755609277/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1000,
    "original_line": 1000,
    "side": "RIGHT",
    "in_reply_to_id": 755518787
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755609822",
    "pull_request_review_id": 814286600,
    "id": 755609822,
    "node_id": "PRRC_kwDOABII584tCbDe",
    "diff_hunk": "@@ -1645,7 +1641,7 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n                 break;\n             }\n             for (size_t posInBlock = 0; posInBlock < block.vtx.size(); ++posInBlock) {\n-                SyncTransaction(block.vtx[posInBlock], {CWalletTx::Status::CONFIRMED, block_height, block_hash, (int)posInBlock}, fUpdate, /* rescanning_old_block */ true);\n+                SyncTransaction(block.vtx[posInBlock], TxStateConfirmed{block_hash, block_height, (int)posInBlock}, fUpdate, /* rescanning_old_block */ true);",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 230,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "78c8ac87e2f585772f296b943c733bd26f255ba0",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "re: https://github.com/bitcoin/bitcoin/pull/21206#discussion_r754559310\r\n\r\n> Here and elsewhere in this commit, maybe format the named args to be compatible with clang-tidy in a way consistent with current changes in the codebase (see #23546 and #23545).\r\n> \r\n> also, use a named cast for `posInBlock`\r\n\r\nOk, made these changes",
    "created_at": "2021-11-24T00:35:55Z",
    "updated_at": "2021-11-24T01:26:13Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755609822",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755609822"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755609822"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755609822/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1644,
    "side": "RIGHT",
    "in_reply_to_id": 754559310
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755620182",
    "pull_request_review_id": 814286600,
    "id": 755620182,
    "node_id": "PRRC_kwDOABII584tCdlW",
    "diff_hunk": "@@ -576,7 +576,7 @@ class CWallet final : public WalletStorage, public interfaces::Chain::Notificati\n     void CommitTransaction(CTransactionRef tx, mapValue_t mapValue, std::vector<std::pair<std::string, std::string>> orderForm);\n \n     /** Pass this transaction to node for mempool insertion and relay to peers if flag set to true */\n-    bool SubmitTxMemoryPoolAndRelay(const CWalletTx& wtx, std::string& err_string, bool relay) const;\n+    bool SubmitTxMemoryPoolAndRelay(CWalletTx& wtx, std::string& err_string, bool relay) const;",
    "path": "src/wallet/wallet.h",
    "position": 32,
    "original_position": 32,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "78c8ac87e2f585772f296b943c733bd26f255ba0",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "re: https://github.com/bitcoin/bitcoin/pull/21206#discussion_r754553318\r\n\r\n> Perhaps update the Doxygen documentation in the previous line to explain why `wtx` is after this change mutable / an out-param.\r\n\r\nI'll add your text if you want to make a specific suggestion, but mentioning the wtx state update seems like an unusual detail for this summary comment to focus on when it doesn't going into other details like this, and there are already lots of comments about refreshing the in-mempool state. Just changing this to a mutable reference already seems more straightforward than the previous version which used a const reference and mutable state member.",
    "created_at": "2021-11-24T01:06:27Z",
    "updated_at": "2021-11-24T01:26:13Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755620182",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755620182"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755620182"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755620182/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 579,
    "original_line": 579,
    "side": "RIGHT",
    "in_reply_to_id": 754553318
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755937425",
    "pull_request_review_id": 814739083,
    "id": 755937425,
    "node_id": "PRRC_kwDOABII584tDrCR",
    "diff_hunk": "@@ -367,13 +364,13 @@ static int64_t AddTx(ChainstateManager& chainman, CWallet& wallet, uint32_t lock\n         block = inserted.first->second;\n         block->nTime = blockTime;\n         block->phashBlock = &hash;\n-        confirm = {CWalletTx::Status::CONFIRMED, block->nHeight, hash, 0};\n+        state = TxStateConfirmed{hash, block->nHeight, /*position_in_block=*/0};\n     }\n-\n-    // If transaction is already in map, to avoid inconsistencies, unconfirmation\n-    // is needed before confirm again with different block.\n-    return wallet.AddToWallet(MakeTransactionRef(tx), confirm, [&](CWalletTx& wtx, bool /* new_tx */) {\n-        wtx.setUnconfirmed();\n+    return wallet.AddToWallet(MakeTransactionRef(tx), state, [&](CWalletTx& wtx, bool /* new_tx */) {",
    "path": "src/wallet/test/wallet_tests.cpp",
    "position": 40,
    "original_position": 40,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "(if need to retouch)\r\n```suggestion\r\n    return wallet.AddToWallet(MakeTransactionRef(tx), state, [&](CWalletTx& wtx, /*new_tx=*/bool) {\r\n```",
    "created_at": "2021-11-24T11:03:20Z",
    "updated_at": "2021-11-24T11:45:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755937425",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755937425"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755937425"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755937425/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 369,
    "original_line": 369,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755958300",
    "pull_request_review_id": 814739083,
    "id": 755958300,
    "node_id": "PRRC_kwDOABII584tDwIc",
    "diff_hunk": "@@ -990,30 +989,29 @@ CWalletTx* CWallet::AddToWallet(CTransactionRef tx, const CWalletTx::Confirmatio\n \n bool CWallet::LoadToWallet(const uint256& hash, const UpdateWalletTxFn& fill_wtx)\n {\n-    const auto& ins = mapWallet.emplace(std::piecewise_construct, std::forward_as_tuple(hash), std::forward_as_tuple(nullptr));\n+    const auto& ins = mapWallet.emplace(std::piecewise_construct, std::forward_as_tuple(hash), std::forward_as_tuple(nullptr, TxStateInactive{}));\n     CWalletTx& wtx = ins.first->second;\n     if (!fill_wtx(wtx, ins.second)) {\n         return false;\n     }\n     // If wallet doesn't have a chain (e.g wallet-tool), don't bother to update txn.\n     if (HaveChain()) {\n         bool active;\n-        int height;\n-        if (chain().findBlock(wtx.m_confirm.hashBlock, FoundBlock().inActiveChain(active).height(height)) && active) {\n-            // Update cached block height variable since it not stored in the\n-            // serialized transaction.\n-            wtx.m_confirm.block_height = height;\n-        } else if (wtx.isConflicted() || wtx.isConfirmed()) {\n+        auto lookup_block = [&](const uint256& hash, int& height, TxState& state) {\n             // If tx block (or conflicting block) was reorged out of chain\n             // while the wallet was shutdown, change tx status to UNCONFIRMED\n             // and reset block height, hash, and index. ABANDONED tx don't have",
    "path": "src/wallet/wallet.cpp",
    "position": 93,
    "original_position": 93,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Should the documentation be updated here as well?",
    "created_at": "2021-11-24T11:19:20Z",
    "updated_at": "2021-11-24T11:45:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755958300",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755958300"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755958300"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755958300/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1003,
    "original_line": 1003,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755962759",
    "pull_request_review_id": 814739083,
    "id": 755962759,
    "node_id": "PRRC_kwDOABII584tDxOH",
    "diff_hunk": "@@ -990,30 +989,29 @@ CWalletTx* CWallet::AddToWallet(CTransactionRef tx, const CWalletTx::Confirmatio\n \n bool CWallet::LoadToWallet(const uint256& hash, const UpdateWalletTxFn& fill_wtx)\n {\n-    const auto& ins = mapWallet.emplace(std::piecewise_construct, std::forward_as_tuple(hash), std::forward_as_tuple(nullptr));\n+    const auto& ins = mapWallet.emplace(std::piecewise_construct, std::forward_as_tuple(hash), std::forward_as_tuple(nullptr, TxStateInactive{}));\n     CWalletTx& wtx = ins.first->second;\n     if (!fill_wtx(wtx, ins.second)) {\n         return false;\n     }\n     // If wallet doesn't have a chain (e.g wallet-tool), don't bother to update txn.\n     if (HaveChain()) {\n         bool active;\n-        int height;\n-        if (chain().findBlock(wtx.m_confirm.hashBlock, FoundBlock().inActiveChain(active).height(height)) && active) {\n-            // Update cached block height variable since it not stored in the\n-            // serialized transaction.\n-            wtx.m_confirm.block_height = height;\n-        } else if (wtx.isConflicted() || wtx.isConfirmed()) {\n+        auto lookup_block = [&](const uint256& hash, int& height, TxState& state) {",
    "path": "src/wallet/wallet.cpp",
    "position": 90,
    "original_position": 90,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "78c8ac87e2f585772f296b943c733bd26f255ba0",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Oh ok, thanks. I didn't see that `findBlock()` uses `height` as an out-param, but now had a better look at the `FoundBlock` class.",
    "created_at": "2021-11-24T11:23:01Z",
    "updated_at": "2021-11-24T11:45:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755962759",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755962759"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755962759"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755962759/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1000,
    "original_line": 1000,
    "side": "RIGHT",
    "in_reply_to_id": 755518787
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755980063",
    "pull_request_review_id": 814739083,
    "id": 755980063,
    "node_id": "PRRC_kwDOABII584tD1cf",
    "diff_hunk": "@@ -369,11 +369,9 @@ RPCHelpMan importprunedfunds()\n \n     unsigned int txnIndex = vIndex[it - vMatch.begin()];\n \n-    CWalletTx::Confirmation confirm(CWalletTx::Status::CONFIRMED, height, merkleBlock.header.GetHash(), txnIndex);\n-\n     CTransactionRef tx_ref = MakeTransactionRef(tx);\n     if (pwallet->IsMine(*tx_ref)) {\n-        pwallet->AddToWallet(std::move(tx_ref), confirm);\n+        pwallet->AddToWallet(std::move(tx_ref), TxStateConfirmed{merkleBlock.header.GetHash(), height, (int)txnIndex});",
    "path": "src/wallet/rpcdump.cpp",
    "position": null,
    "original_position": 9,
    "commit_id": "d8ee8f3cd32bbfefec931724f5798cbb088ceb6f",
    "original_commit_id": "78c8ac87e2f585772f296b943c733bd26f255ba0",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yes, the developer-notes mention to follow the CppCoreGuidelines and there are some advantages to named casts (https://github.com/bitcoin/bitcoin/pull/20965#issuecomment-770375623) but I do hesitate to mention them due to the verbosity (though if casts are seen as a code smell, verbosity could be a good thing, I guess). Thanks!",
    "created_at": "2021-11-24T11:45:32Z",
    "updated_at": "2021-11-24T11:45:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755980063",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755980063"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r755980063"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755980063/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 374,
    "side": "RIGHT",
    "in_reply_to_id": 754538897
  }
]