[
  {
    "sha": "23cf377170233fe124701943fb0f89bb1bab9641",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyM2NmMzc3MTcwMjMzZmUxMjQ3MDE5NDNmYjBmODliYjFiYWI5NjQx",
    "commit": {
      "author": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2019-05-17T17:29:36Z"
      },
      "committer": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2019-08-06T15:01:03Z"
      },
      "message": "rpc: Compute nLowestTimestamp on the first iteration in importmulti",
      "tree": {
        "sha": "9e1c28f776f2d6d215e7a3c6ed576620cf525d71",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9e1c28f776f2d6d215e7a3c6ed576620cf525d71"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/23cf377170233fe124701943fb0f89bb1bab9641",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/23cf377170233fe124701943fb0f89bb1bab9641",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/23cf377170233fe124701943fb0f89bb1bab9641",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/23cf377170233fe124701943fb0f89bb1bab9641/comments",
    "author": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "e5fdda68c6d2313edb74443f0d1e6d2ce2d97f5e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e5fdda68c6d2313edb74443f0d1e6d2ce2d97f5e",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/e5fdda68c6d2313edb74443f0d1e6d2ce2d97f5e"
      }
    ],
    "stats": {
      "total": 16,
      "additions": 7,
      "deletions": 9
    },
    "files": [
      {
        "sha": "0f268b5c8c586f665921bf33a787c2619d817745",
        "filename": "src/wallet/rpcdump.cpp",
        "status": "modified",
        "additions": 7,
        "deletions": 9,
        "changes": 16,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/23cf377170233fe124701943fb0f89bb1bab9641/src/wallet/rpcdump.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/23cf377170233fe124701943fb0f89bb1bab9641/src/wallet/rpcdump.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcdump.cpp?ref=23cf377170233fe124701943fb0f89bb1bab9641",
        "patch": "@@ -1370,10 +1370,6 @@ UniValue importmulti(const JSONRPCRequest& mainRequest)\n         // Verify all timestamps are present before importing any keys.\n         const Optional<int> tip_height = locked_chain->getHeight();\n         now = tip_height ? locked_chain->getBlockMedianTimePast(*tip_height) : 0;\n-        for (const UniValue& data : requests.getValues()) {\n-            GetImportTimestamp(data, now);\n-        }\n-\n         const int64_t minimumTimestamp = 1;\n \n         if (fRescan && tip_height) {\n@@ -1382,6 +1378,13 @@ UniValue importmulti(const JSONRPCRequest& mainRequest)\n             fRescan = false;\n         }\n \n+        for (const UniValue& data : requests.getValues()) {\n+            const int64_t timestamp = std::max(GetImportTimestamp(data, now), minimumTimestamp);\n+            // Get the lowest timestamp.\n+            if (timestamp < nLowestTimestamp) {\n+                nLowestTimestamp = timestamp;\n+            }\n+        }\n         for (const UniValue& data : requests.getValues()) {\n             const int64_t timestamp = std::max(GetImportTimestamp(data, now), minimumTimestamp);\n             const UniValue result = ProcessImport(pwallet, data, timestamp);\n@@ -1395,11 +1398,6 @@ UniValue importmulti(const JSONRPCRequest& mainRequest)\n             if (result[\"success\"].get_bool()) {\n                 fRunScan = true;\n             }\n-\n-            // Get the lowest timestamp.\n-            if (timestamp < nLowestTimestamp) {\n-                nLowestTimestamp = timestamp;\n-            }\n         }\n     }\n     if (fRescan && fRunScan && requests.size()) {"
      }
    ]
  },
  {
    "sha": "db3256e35accf6a53367282fb57a9989e51bfa94",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpkYjMyNTZlMzVhY2NmNmE1MzM2NzI4MmZiNTdhOTk4OWU1MWJmYTk0",
    "commit": {
      "author": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2019-05-17T17:31:26Z"
      },
      "committer": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2019-08-06T15:16:30Z"
      },
      "message": "rpc: Compute nTimeBegin on the first iteration in importwallet",
      "tree": {
        "sha": "4f3da735ce35f4424c22b3feffe6f28f1e04e3ec",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4f3da735ce35f4424c22b3feffe6f28f1e04e3ec"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/db3256e35accf6a53367282fb57a9989e51bfa94",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/db3256e35accf6a53367282fb57a9989e51bfa94",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/db3256e35accf6a53367282fb57a9989e51bfa94",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/db3256e35accf6a53367282fb57a9989e51bfa94/comments",
    "author": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "23cf377170233fe124701943fb0f89bb1bab9641",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/23cf377170233fe124701943fb0f89bb1bab9641",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/23cf377170233fe124701943fb0f89bb1bab9641"
      }
    ],
    "stats": {
      "total": 7,
      "additions": 2,
      "deletions": 5
    },
    "files": [
      {
        "sha": "e2cf508b16d897ef74d6fedb8454cf387f32f790",
        "filename": "src/wallet/rpcdump.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 5,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/db3256e35accf6a53367282fb57a9989e51bfa94/src/wallet/rpcdump.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/db3256e35accf6a53367282fb57a9989e51bfa94/src/wallet/rpcdump.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcdump.cpp?ref=db3256e35accf6a53367282fb57a9989e51bfa94",
        "patch": "@@ -615,11 +615,13 @@ UniValue importwallet(const JSONRPCRequest& request)\n                         fLabel = true;\n                     }\n                 }\n+                nTimeBegin = std::min(nTimeBegin, nTime);\n                 keys.push_back(std::make_tuple(key, nTime, fLabel, strLabel));\n             } else if(IsHex(vstr[0])) {\n                 std::vector<unsigned char> vData(ParseHex(vstr[0]));\n                 CScript script = CScript(vData.begin(), vData.end());\n                 int64_t birth_time = DecodeDumpTime(vstr[1]);\n+                if (birth_time > 0) nTimeBegin = std::min(nTimeBegin, birth_time);\n                 scripts.push_back(std::pair<CScript, int64_t>(script, birth_time));\n             }\n         }\n@@ -652,8 +654,6 @@ UniValue importwallet(const JSONRPCRequest& request)\n \n             if (has_label)\n                 pwallet->SetAddressBook(PKHash(keyid), label, \"receive\");\n-\n-            nTimeBegin = std::min(nTimeBegin, time);\n             progress++;\n         }\n         for (const auto& script_pair : scripts) {\n@@ -666,9 +666,6 @@ UniValue importwallet(const JSONRPCRequest& request)\n                 fGood = false;\n                 continue;\n             }\n-            if (time > 0) {\n-                nTimeBegin = std::min(nTimeBegin, time);\n-            }\n \n             progress++;\n         }"
      }
    ]
  },
  {
    "sha": "0791e6488e6aedc79ed5ea433dcdc769325beb7c",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzowNzkxZTY0ODhlNmFlZGM3OWVkNWVhNDMzZGNkYzc2OTMyNWJlYjdj",
    "commit": {
      "author": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2019-05-17T17:33:31Z"
      },
      "committer": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2019-08-06T15:16:33Z"
      },
      "message": "rpc: Add EnsureBlockDataFromTime utility",
      "tree": {
        "sha": "062d4335e6fb39dd568c3fdd510592aaae16f358",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/062d4335e6fb39dd568c3fdd510592aaae16f358"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0791e6488e6aedc79ed5ea433dcdc769325beb7c",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0791e6488e6aedc79ed5ea433dcdc769325beb7c",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/0791e6488e6aedc79ed5ea433dcdc769325beb7c",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0791e6488e6aedc79ed5ea433dcdc769325beb7c/comments",
    "author": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "db3256e35accf6a53367282fb57a9989e51bfa94",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/db3256e35accf6a53367282fb57a9989e51bfa94",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/db3256e35accf6a53367282fb57a9989e51bfa94"
      }
    ],
    "stats": {
      "total": 8,
      "additions": 8,
      "deletions": 0
    },
    "files": [
      {
        "sha": "125e872549a6c4f68aded5ccff6ac5df7c45e801",
        "filename": "src/wallet/rpcdump.cpp",
        "status": "modified",
        "additions": 8,
        "deletions": 0,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/0791e6488e6aedc79ed5ea433dcdc769325beb7c/src/wallet/rpcdump.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/0791e6488e6aedc79ed5ea433dcdc769325beb7c/src/wallet/rpcdump.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcdump.cpp?ref=0791e6488e6aedc79ed5ea433dcdc769325beb7c",
        "patch": "@@ -101,6 +101,14 @@ static void RescanWallet(CWallet& wallet, const WalletRescanReserver& reserver,\n     }\n }\n \n+static void EnsureBlockDataFromTime(interfaces::Chain::Lock& locked_chain, int64_t timestamp)\n+{\n+    const Optional<int> height = locked_chain.findFirstBlockWithTimeAndHeight(timestamp - TIMESTAMP_WINDOW, 0, nullptr);\n+    if (height && !locked_chain.haveBlockOnDisk(*height)) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Pruned blocks required to import keys\");\n+    }\n+}\n+\n UniValue importprivkey(const JSONRPCRequest& request)\n {\n     std::shared_ptr<CWallet> const wallet = GetWalletForJSONRPCRequest(request);"
      }
    ]
  },
  {
    "sha": "cffd615a1b3f8fb0d6412bcd36f1a390529ccf8d",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpjZmZkNjE1YTFiM2Y4ZmIwZDY0MTJiY2QzNmYxYTM5MDUyOWNjZjhk",
    "commit": {
      "author": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2019-05-17T17:34:05Z"
      },
      "committer": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2019-08-06T15:16:33Z"
      },
      "message": "rpc: Enable wallet import on pruned nodes",
      "tree": {
        "sha": "eb7a870c68c3a6d9b9c8c6ba3bf94efb7fc263b2",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/eb7a870c68c3a6d9b9c8c6ba3bf94efb7fc263b2"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/cffd615a1b3f8fb0d6412bcd36f1a390529ccf8d",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/cffd615a1b3f8fb0d6412bcd36f1a390529ccf8d",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/cffd615a1b3f8fb0d6412bcd36f1a390529ccf8d",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/cffd615a1b3f8fb0d6412bcd36f1a390529ccf8d/comments",
    "author": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "0791e6488e6aedc79ed5ea433dcdc769325beb7c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0791e6488e6aedc79ed5ea433dcdc769325beb7c",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/0791e6488e6aedc79ed5ea433dcdc769325beb7c"
      }
    ],
    "stats": {
      "total": 13,
      "additions": 6,
      "deletions": 7
    },
    "files": [
      {
        "sha": "756e8517c82edbdd4196a35b002247e925e5bb24",
        "filename": "src/wallet/rpcdump.cpp",
        "status": "modified",
        "additions": 6,
        "deletions": 7,
        "changes": 13,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/cffd615a1b3f8fb0d6412bcd36f1a390529ccf8d/src/wallet/rpcdump.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/cffd615a1b3f8fb0d6412bcd36f1a390529ccf8d/src/wallet/rpcdump.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcdump.cpp?ref=cffd615a1b3f8fb0d6412bcd36f1a390529ccf8d",
        "patch": "@@ -559,13 +559,6 @@ UniValue importwallet(const JSONRPCRequest& request)\n                 },\n             }.Check(request);\n \n-    if (pwallet->chain().havePruned()) {\n-        // Exit early and print an error.\n-        // If a block is pruned after this check, we will import the key(s),\n-        // but fail the rescan with a generic error.\n-        throw JSONRPCError(RPC_WALLET_ERROR, \"Importing wallets is disabled when blocks are pruned\");\n-    }\n-\n     WalletRescanReserver reserver(pwallet);\n     if (!reserver.reserve()) {\n         throw JSONRPCError(RPC_WALLET_ERROR, \"Wallet is currently rescanning. Abort existing rescan or wait.\");\n@@ -634,6 +627,9 @@ UniValue importwallet(const JSONRPCRequest& request)\n             }\n         }\n         file.close();\n+        if (pwallet->chain().havePruned()) {\n+            EnsureBlockDataFromTime(*locked_chain, nTimeBegin);\n+        }\n         // We now know whether we are importing private keys, so we can error if private keys are disabled\n         if (keys.size() > 0 && pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS)) {\n             pwallet->chain().showProgress(\"\", 100, false); // hide progress dialog in GUI\n@@ -1390,6 +1386,9 @@ UniValue importmulti(const JSONRPCRequest& mainRequest)\n                 nLowestTimestamp = timestamp;\n             }\n         }\n+        if (pwallet->chain().havePruned()) {\n+            EnsureBlockDataFromTime(*locked_chain, nLowestTimestamp);\n+        }\n         for (const UniValue& data : requests.getValues()) {\n             const int64_t timestamp = std::max(GetImportTimestamp(data, now), minimumTimestamp);\n             const UniValue result = ProcessImport(pwallet, data, timestamp);"
      }
    ]
  }
]