[
  {
    "sha": "027dbea66bf96ad2c2842f9b9397d5ec1af2a028",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzowMjdkYmVhNjZiZjk2YWQyYzI4NDJmOWI5Mzk3ZDVlYzFhZjJhMDI4",
    "commit": {
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2017-11-19T17:51:21Z"
      },
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2017-11-19T17:51:21Z"
      },
      "message": "[wallet] method to delete hdChain",
      "tree": {
        "sha": "983f23b1762d4e70fe6627287a65effd13e2d220",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/983f23b1762d4e70fe6627287a65effd13e2d220"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/027dbea66bf96ad2c2842f9b9397d5ec1af2a028",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQJHBAABCgAxFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAloRxJkTHHNqb3JzQHNw\ncm92b29zdC5ubAAKCRBX/5vbzDAQCYegEACnJkH/lMbwnONyNPNcQEUb71TAwxYf\n1YMfnmZcZk5i+8ufTawz0Ja9ExgkHHPm01dM1r11GxQg/gJaxwpb3Ev6xP9Uz91f\nhf3bMdoi4BK5xun/no8rm/1F64OmFYbLKBrc+Xv96Xj/nsWPxeXQ9/QK8ygux0HZ\nDoUTVQCmglZZmsoghZ15FsbxOHeFkFNsjND/NZ/5q/+gV8ONh4+1OsU+QDABOIQH\nFGtoK44cWvzYZhIa5TJXYgOAdNLS6CCtHr6GtPafpYFp+hTTQWxDU2EOhJ270eQ3\nYf7yawDB9Z/Hlxv4I3SbKFb4wkvVRZGSaHUzg6kIgED8cqekJCPjdyLDWUazSn+H\nNfkqte0LuMT46kLd2e5rjZPvzXwRsDPfXAvMwS8Fv4KC3E3NmDohwrWXM1PZyxme\nBDAJIMbpOefBZ25GW44sLK7kFrxc9X/VJWKTLj3xcJWfW12L0kw0jdfS0Zwrk9LD\nmxDVpCXFgZR3v8nv0AVnCvO1mQqQjXB4n/1tpNBFtroSMFPY+48blLGD2kbGYWui\ni+Yhcw7WF0JhP9HHhK875F6Eeckhm6qVOZq9WLUsnVOyxDEiP9ODHz9qSzGJg+/N\n2tD3XZcEcQoPxFzmsP96QcJ0se1cvNHYNcNZ0DWwQ2jLevaoVRRLP5iEt6SYc88o\nMl1bac7lQfXwPw==\n=tFa6\n-----END PGP SIGNATURE-----",
        "payload": "tree 983f23b1762d4e70fe6627287a65effd13e2d220\nparent 7293d064133aeafd9f0ae0bdbb2ed74a44d91ecc\nauthor Sjors Provoost <sjors@sprovoost.nl> 1511113881 +0100\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1511113881 +0100\n\n[wallet] method to delete hdChain\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/027dbea66bf96ad2c2842f9b9397d5ec1af2a028",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/027dbea66bf96ad2c2842f9b9397d5ec1af2a028",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/027dbea66bf96ad2c2842f9b9397d5ec1af2a028/comments",
    "author": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "7293d064133aeafd9f0ae0bdbb2ed74a44d91ecc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7293d064133aeafd9f0ae0bdbb2ed74a44d91ecc",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/7293d064133aeafd9f0ae0bdbb2ed74a44d91ecc"
      }
    ],
    "stats": {
      "total": 15,
      "additions": 15,
      "deletions": 0
    },
    "files": [
      {
        "sha": "b2851b67a452b958e65c0ba08261e426d91f85a1",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 12,
        "deletions": 0,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/027dbea66bf96ad2c2842f9b9397d5ec1af2a028/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/027dbea66bf96ad2c2842f9b9397d5ec1af2a028/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=027dbea66bf96ad2c2842f9b9397d5ec1af2a028",
        "patch": "@@ -1493,6 +1493,18 @@ bool CWallet::SetHDChain(const CHDChain& chain, bool memonly)\n     return true;\n }\n \n+bool CWallet::DeleteHDChain(bool memonly)\n+{\n+    LOCK(cs_wallet);\n+    \n+    hdChain.SetNull();\n+\n+    if (!memonly && !CWalletDB(*dbw).WriteHDChain(hdChain))\n+        throw std::runtime_error(std::string(__func__) + \": deleting chain failed\");\n+\n+    return true;\n+}\n+\n bool CWallet::IsHDEnabled() const\n {\n     return !hdChain.masterKeyID.IsNull();"
      },
      {
        "sha": "21f77cf0a7e97d8ba984f5669639aaaabd1ca6aa",
        "filename": "src/wallet/wallet.h",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/027dbea66bf96ad2c2842f9b9397d5ec1af2a028/src/wallet/wallet.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/027dbea66bf96ad2c2842f9b9397d5ec1af2a028/src/wallet/wallet.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.h?ref=027dbea66bf96ad2c2842f9b9397d5ec1af2a028",
        "patch": "@@ -1106,6 +1106,9 @@ class CWallet final : public CCryptoKeyStore, public CValidationInterface\n     /* Set the HD chain model (chain child index counters) */\n     bool SetHDChain(const CHDChain& chain, bool memonly);\n     const CHDChain& GetHDChain() const { return hdChain; }\n+    \n+    /* Delete the HD chain model */\n+    bool DeleteHDChain(bool memonly);\n \n     /* Returns true if HD is enabled */\n     bool IsHDEnabled() const;"
      }
    ]
  },
  {
    "sha": "500cbb77bc7847431f4e9413ce34de7b7fa5ab01",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1MDBjYmI3N2JjNzg0NzQzMWY0ZTk0MTNjZTM0ZGU3YjdmYTVhYjAx",
    "commit": {
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2017-11-19T17:52:58Z"
      },
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2017-11-19T17:53:03Z"
      },
      "message": "[rpc] downgradewallet: allow downgrade to v0.12\n\nAdd RPC method to downgrade a wallet for compatibilty with earlier versions.\n\nDowngrade to v0.12: removes the hdseed while keeping addresses generated so far.",
      "tree": {
        "sha": "84ec1d3b496e1e7accebdef14a80d463cbe9b490",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/84ec1d3b496e1e7accebdef14a80d463cbe9b490"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/500cbb77bc7847431f4e9413ce34de7b7fa5ab01",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQJHBAABCgAxFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAloRxYITHHNqb3JzQHNw\ncm92b29zdC5ubAAKCRBX/5vbzDAQCRBzD/wOMcMjmW3RNC7Jpn9aHdIHgDhcK/+m\ntAtKpdpiZz3hlL1l2+3sK4vYpZh8XWvCt77mGb1AIhDL7lUBYOKUELZM1LgSGYQp\nrsT0SyZ/YNqcNJ5LYgADtrg/WPb5Pti3v7ktyq9HxCSNPbphwSIeBSTFUDPIM6xh\nIqoEx/IuLX+oi97knX/pkyow9qFhBQpoxRuGLIBGTipYgjk5D5pKagOwpWW86TSV\nEgyDhnW+L8J/NFOgkXB8q1egqFbMdrR2XT94h8y6NcXb+8mAabOHoq5XnvaOaX6n\nUChpobBUK8gAu7p1FuJpMHD+W3k8cREcyh5WduGCg7XhVv+RgoMjQHvmy7NYytIc\n23o6PQ6j66pavv3Ivj37QQAGPcIPOZNi/HpTPCz0c49pcxpKQda/713vYKhAS3GO\n8zl1C3nVRp+ttK3saBVC2QtrD0DTITn0Se7eCpoG++kHtPDvisY8w84K+tFyX8EA\noORar8HjyHuvHKJDFdmFngsAh1M5phEZ59pU99yzBvBO7qEbnihBT9M7wtZqCh45\nWrNagAcmMRi5ddLOmvLCNpj44dF1ZhSzT68zr8cNrm50dbH3QKt/Sf8CX34w4U4+\nlPsZO+r6lvrvY8+iEaaINPkviFrdioiOabnToTzBxAq/bngUi2Uw0sCqR4hmB9+K\naWDDbr8L+EIeqg==\n=lxAj\n-----END PGP SIGNATURE-----",
        "payload": "tree 84ec1d3b496e1e7accebdef14a80d463cbe9b490\nparent 027dbea66bf96ad2c2842f9b9397d5ec1af2a028\nauthor Sjors Provoost <sjors@sprovoost.nl> 1511113978 +0100\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1511113983 +0100\n\n[rpc] downgradewallet: allow downgrade to v0.12\n\nAdd RPC method to downgrade a wallet for compatibilty with earlier versions.\n\nDowngrade to v0.12: removes the hdseed while keeping addresses generated so far.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/500cbb77bc7847431f4e9413ce34de7b7fa5ab01",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/500cbb77bc7847431f4e9413ce34de7b7fa5ab01",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/500cbb77bc7847431f4e9413ce34de7b7fa5ab01/comments",
    "author": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "027dbea66bf96ad2c2842f9b9397d5ec1af2a028",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/027dbea66bf96ad2c2842f9b9397d5ec1af2a028",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/027dbea66bf96ad2c2842f9b9397d5ec1af2a028"
      }
    ],
    "stats": {
      "total": 64,
      "additions": 64,
      "deletions": 0
    },
    "files": [
      {
        "sha": "148c77675021c46c21eca4049fbb09ebb083e32c",
        "filename": "src/wallet/rpcwallet.cpp",
        "status": "modified",
        "additions": 64,
        "deletions": 0,
        "changes": 64,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/500cbb77bc7847431f4e9413ce34de7b7fa5ab01/src/wallet/rpcwallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/500cbb77bc7847431f4e9413ce34de7b7fa5ab01/src/wallet/rpcwallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcwallet.cpp?ref=500cbb77bc7847431f4e9413ce34de7b7fa5ab01",
        "patch": "@@ -30,6 +30,7 @@\n \n #include <init.h>  // For StartShutdown\n \n+#include <regex>\n #include <stdint.h>\n \n #include <univalue.h>\n@@ -3306,6 +3307,68 @@ UniValue bumpfee(const JSONRPCRequest& request)\n     return result;\n }\n \n+UniValue downgradewallet(const JSONRPCRequest& request)\n+{\n+    CWallet * const pwallet = GetWalletForJSONRPCRequest(request);\n+    if (!EnsureWalletIsAvailable(pwallet, request.fHelp)) {\n+        return NullUniValue;\n+    }\n+\n+    if (request.fHelp || request.params.size() != 1) {\n+        std::string msg = \"downgradewallet \\\"version\\\"\\n\"\n+            \"\\nDowngrades wallet for compatibilty with earlier versions. Requires a new wallet backup.\\n\"\n+\n+            \"\\nArguments:\\n\"\n+            \"1. \\\"version\\\"       (string, required) A previous version of Bitcoin Core\\n\"\n+            \n+            \"\\nSupported versions:\\n\"\n+            \"0.12 Removes HD seed. Generated addresses are preserved.\\n\"\n+            \"     Note that non-HD wallets currently can't be upgraded to HD.\\n\"\n+        ;\n+        throw std::runtime_error(msg);\n+    }\n+\n+    // Check version argument\n+    \n+    uint32_t version;\n+    std::string version_s = request.params[0].get_str(); \n+    std::smatch match;\n+    const std::regex regex(\"^(\\\\d+)\\\\.(\\\\d+)$\");\n+    if (std::regex_match (version_s, match, regex)) {\n+        uint32_t version_major = std::stoi(match[1]);\n+        uint32_t version_minor = std::stoi(match[2]);\n+        version = 1000000 * version_major + 10000 * version_minor;\n+    } else {\n+        throw JSONRPCError(RPC_INVALID_PARAMETER, \"Invalid version format, use e.g. 0.12\");\n+    }\n+    \n+    // Check against array of supported downgrade versions\n+    const std::array<uint32_t, 1> supported_versions = {{120000}};\n+    \n+    bool supported_version = std::any_of(supported_versions.begin(), supported_versions.end(), [&](uint32_t i) \n+    {\n+        return i == version;\n+    });\n+    \n+    if (!supported_version) {\n+        throw JSONRPCError(RPC_INVALID_PARAMETER, \"Wallet downgrade to \" + version_s + \" not supported\");\n+    }\n+    \n+    // Future code to downgrade to versions above 0.12 goes here.\n+\n+    if (version <= 120000) { // Downgrade to 0.12 (remove HD)\n+        // Check if HD seed exists\n+        if(pwallet->IsHDEnabled()) {\n+            // Delete hd key\n+            pwallet->DeleteHDChain(false);\n+        }\n+    }\n+    \n+    // Future code to downgrade to versions below 0.12 goes here.\n+\n+    return NullUniValue;\n+}\n+\n UniValue generate(const JSONRPCRequest& request)\n {\n     CWallet * const pwallet = GetWalletForJSONRPCRequest(request);\n@@ -3449,6 +3512,7 @@ static const CRPCCommand commands[] =\n     { \"wallet\",             \"addwitnessaddress\",        &addwitnessaddress,        {\"address\",\"p2sh\"} },\n     { \"wallet\",             \"backupwallet\",             &backupwallet,             {\"destination\"} },\n     { \"wallet\",             \"bumpfee\",                  &bumpfee,                  {\"txid\", \"options\"} },\n+    { \"wallet\",             \"downgradewallet\",          &downgradewallet,          {\"version\"} },\n     { \"wallet\",             \"dumpprivkey\",              &dumpprivkey,              {\"address\"}  },\n     { \"wallet\",             \"dumpwallet\",               &dumpwallet,               {\"filename\"} },\n     { \"wallet\",             \"encryptwallet\",            &encryptwallet,            {\"passphrase\"} },"
      }
    ]
  }
]