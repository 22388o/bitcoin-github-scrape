[
  {
    "sha": "fa5cef0f785705474251faa4b5bf0f94c7100420",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYTVjZWYwZjc4NTcwNTQ3NDI1MWZhYTRiNWJmMGY5NGM3MTAwNDIw",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2018-11-27T21:53:49Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2018-11-27T21:52:56Z"
      },
      "message": "bench: Destroy wallet txs instead of leaking their memory",
      "tree": {
        "sha": "4ef7b55b83d1e466ed03615b3a80f487edea9a9f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4ef7b55b83d1e466ed03615b3a80f487edea9a9f"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fa5cef0f785705474251faa4b5bf0f94c7100420",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGcBAABCgAGBQJb/by4AAoJEM4rdWl+aaVIdaQL/2dF3ksKmeARuI4jtEoIx8Lf\npPsSQPo5hlwf6eWv5S8kQ4VQXG9fB/2rFAL7mfZOBI5DDY45ANArhTpiVXdLTY1j\nx6SCGnonf/Kfn4p6wyXpwrR8HBHchHxSrPTw7O806mdbY8CroBl8kn5EjANbqfp/\nOqFNGofKdFfxxdfsfLgqcKYhzR78QVfuQjsrtjc4xcUBELlvCPqCp/K3fDKMbGow\nZQZYyGTrTC6pSX1BCHz/yhxTifW8Bfo3W4bXDoob18y34tgbdT7G+6e6UCG0glc+\nKn6JEkd2B5elgN0rrF8SRKtxN2xNPD+h8TnYF3VpaCiZtnCiDHJtC1OhOjyqERV8\nO3Thhp3x+gr7OXmY78B8NLmXReXT3mo8UFN/hrUtGlAlSKkQf13T4D/K+j/+Bx8K\nc/9l4ntar23tVB6ZhSpRSKu6MP9xHMFMwv0EPKASoQ8F9+pNk/i3MTz/Ls24vQod\nbGSbrB/b0aa8BNOwr3wETZSszxQGzjEys6Q76e46Cg==\n=WsKV\n-----END PGP SIGNATURE-----",
        "payload": "tree 4ef7b55b83d1e466ed03615b3a80f487edea9a9f\nparent 600b85bb417295f4d9c7d5b9fd8502f3c8f113e3\nauthor MarcoFalke <falke.marco@gmail.com> 1543355629 -0500\ncommitter MarcoFalke <falke.marco@gmail.com> 1543355576 -0500\n\nbench: Destroy wallet txs instead of leaking their memory\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa5cef0f785705474251faa4b5bf0f94c7100420",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fa5cef0f785705474251faa4b5bf0f94c7100420",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa5cef0f785705474251faa4b5bf0f94c7100420/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "600b85bb417295f4d9c7d5b9fd8502f3c8f113e3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/600b85bb417295f4d9c7d5b9fd8502f3c8f113e3",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/600b85bb417295f4d9c7d5b9fd8502f3c8f113e3"
      }
    ],
    "stats": {
      "total": 33,
      "additions": 15,
      "deletions": 18
    },
    "files": [
      {
        "sha": "74641191a12a94373edfc6f0ee44bfbe9f6e57c5",
        "filename": "src/bench/coin_selection.cpp",
        "status": "modified",
        "additions": 15,
        "deletions": 14,
        "changes": 29,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa5cef0f785705474251faa4b5bf0f94c7100420/src/bench/coin_selection.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa5cef0f785705474251faa4b5bf0f94c7100420/src/bench/coin_selection.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bench/coin_selection.cpp?ref=fa5cef0f785705474251faa4b5bf0f94c7100420",
        "patch": "@@ -4,25 +4,19 @@\n \n #include <bench/bench.h>\n #include <interfaces/chain.h>\n-#include <wallet/wallet.h>\n #include <wallet/coinselection.h>\n+#include <wallet/wallet.h>\n \n #include <set>\n \n-static void addCoin(const CAmount& nValue, const CWallet& wallet, std::vector<OutputGroup>& groups)\n+static void addCoin(const CAmount& nValue, const CWallet& wallet, std::vector<std::unique_ptr<CWalletTx>>& wtxs)\n {\n-    int nInput = 0;\n-\n     static int nextLockTime = 0;\n     CMutableTransaction tx;\n     tx.nLockTime = nextLockTime++; // so all transactions get different hashes\n-    tx.vout.resize(nInput + 1);\n-    tx.vout[nInput].nValue = nValue;\n-    CWalletTx* wtx = new CWalletTx(&wallet, MakeTransactionRef(std::move(tx)));\n-\n-    int nAge = 6 * 24;\n-    COutput output(wtx, nInput, nAge, true /* spendable */, true /* solvable */, true /* safe */);\n-    groups.emplace_back(output.GetInputCoin(), 6, false, 0, 0);\n+    tx.vout.resize(1);\n+    tx.vout[0].nValue = nValue;\n+    wtxs.push_back(MakeUnique<CWalletTx>(&wallet, MakeTransactionRef(std::move(tx))));\n }\n \n // Simple benchmark for wallet coin selection. Note that it maybe be necessary\n@@ -36,14 +30,21 @@ static void CoinSelection(benchmark::State& state)\n {\n     auto chain = interfaces::MakeChain();\n     const CWallet wallet(*chain, WalletLocation(), WalletDatabase::CreateDummy());\n+    std::vector<std::unique_ptr<CWalletTx>> wtxs;\n     LOCK(wallet.cs_wallet);\n \n     // Add coins.\n-    std::vector<OutputGroup> groups;\n     for (int i = 0; i < 1000; ++i) {\n-        addCoin(1000 * COIN, wallet, groups);\n+        addCoin(1000 * COIN, wallet, wtxs);\n+    }\n+    addCoin(3 * COIN, wallet, wtxs);\n+\n+    // Create groups\n+    std::vector<OutputGroup> groups;\n+    for (const auto& wtx : wtxs) {\n+        COutput output(wtx.get(), 0 /* iIn */, 6 * 24 /* nDepthIn */, true /* spendable */, true /* solvable */, true /* safe */);\n+        groups.emplace_back(output.GetInputCoin(), 6, false, 0, 0);\n     }\n-    addCoin(3 * COIN, wallet, groups);\n \n     const CoinEligibilityFilter filter_standard(1, 6, 0);\n     const CoinSelectionParams coin_selection_params(true, 34, 148, CFeeRate(0), 0);"
      },
      {
        "sha": "6f15c0f1d43bbe26cfcebf315dd6d8c642a2d3fa",
        "filename": "test/sanitizer_suppressions/lsan",
        "status": "modified",
        "additions": 0,
        "deletions": 4,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa5cef0f785705474251faa4b5bf0f94c7100420/test/sanitizer_suppressions/lsan",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa5cef0f785705474251faa4b5bf0f94c7100420/test/sanitizer_suppressions/lsan",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/sanitizer_suppressions/lsan?ref=fa5cef0f785705474251faa4b5bf0f94c7100420",
        "patch": "@@ -1,7 +1,3 @@\n-# Suppress warnings about addCoin(...) leak in the CoinSelection benchmark\n-leak:addCoin\n-leak:bench_bitcoin\n-\n # Suppress warnings triggered in dependencies\n leak:libcrypto\n leak:libqminimal"
      }
    ]
  }
]