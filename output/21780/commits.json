[
  {
    "sha": "040b280c6613ac81a92a324f356f0b4cc205ef8d",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzowNDBiMjgwYzY2MTNhYzgxYTkyYTMyNGYzNTZmMGI0Y2MyMDVlZjhk",
    "commit": {
      "author": {
        "name": "R E Broadley",
        "email": "rebroad+github@gmail.com",
        "date": "2021-04-25T18:12:33Z"
      },
      "committer": {
        "name": "R E Broadley",
        "email": "rebroad+github@gmail.com",
        "date": "2021-04-25T21:36:04Z"
      },
      "message": "Add maxmempool RPC",
      "tree": {
        "sha": "04d7c43d30bf62c75d9867d81280d999cdb5adc7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/04d7c43d30bf62c75d9867d81280d999cdb5adc7"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/040b280c6613ac81a92a324f356f0b4cc205ef8d",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/040b280c6613ac81a92a324f356f0b4cc205ef8d",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/040b280c6613ac81a92a324f356f0b4cc205ef8d",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/040b280c6613ac81a92a324f356f0b4cc205ef8d/comments",
    "author": {
      "login": "rebroad",
      "id": 1530283,
      "node_id": "MDQ6VXNlcjE1MzAyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rebroad",
      "html_url": "https://github.com/rebroad",
      "followers_url": "https://api.github.com/users/rebroad/followers",
      "following_url": "https://api.github.com/users/rebroad/following{/other_user}",
      "gists_url": "https://api.github.com/users/rebroad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
      "organizations_url": "https://api.github.com/users/rebroad/orgs",
      "repos_url": "https://api.github.com/users/rebroad/repos",
      "events_url": "https://api.github.com/users/rebroad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rebroad/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "rebroad",
      "id": 1530283,
      "node_id": "MDQ6VXNlcjE1MzAyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rebroad",
      "html_url": "https://github.com/rebroad",
      "followers_url": "https://api.github.com/users/rebroad/followers",
      "following_url": "https://api.github.com/users/rebroad/following{/other_user}",
      "gists_url": "https://api.github.com/users/rebroad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
      "organizations_url": "https://api.github.com/users/rebroad/orgs",
      "repos_url": "https://api.github.com/users/rebroad/repos",
      "events_url": "https://api.github.com/users/rebroad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rebroad/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "c4571a0c39e08c7590bd6da5caebf695dfe028fe",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c4571a0c39e08c7590bd6da5caebf695dfe028fe",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/c4571a0c39e08c7590bd6da5caebf695dfe028fe"
      }
    ],
    "stats": {
      "total": 28,
      "additions": 28,
      "deletions": 0
    },
    "files": [
      {
        "sha": "a4b24506c19b67a59a7dfb93c1c99ef9fab0fbe2",
        "filename": "src/rpc/blockchain.cpp",
        "status": "modified",
        "additions": 27,
        "deletions": 0,
        "changes": 27,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/040b280c6613ac81a92a324f356f0b4cc205ef8d/src/rpc/blockchain.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/040b280c6613ac81a92a324f356f0b4cc205ef8d/src/rpc/blockchain.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpc/blockchain.cpp?ref=040b280c6613ac81a92a324f356f0b4cc205ef8d",
        "patch": "@@ -552,6 +552,32 @@ UniValue MempoolToJSON(const CTxMemPool& pool, bool verbose, bool include_mempoo\n     }\n }\n \n+static RPCHelpMan maxmempool()\n+{\n+    return RPCHelpMan{\"maxmempool\",\n+                \"\\nSets the allocated memory for the memory pool.\\n\",\n+                {\n+                    {\"megabytes\", RPCArg::Type::NUM, RPCArg::Optional::NO, \"The memory allocated in MB\"},\n+                },\n+                RPCResult{\n+                    RPCResult::Type::NONE, \"\", \"\"},\n+                RPCExamples{\n+                    HelpExampleCli(\"maxmempool\", \"150\") + HelpExampleRpc(\"maxmempool\", \"150\")\n+                },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    int nSize = request.params[0].get_int();\n+    int64_t nMempoolSizeMax = nSize * 1000000;\n+    int64_t nMempoolSizeMin = gArgs.GetArg(\"-limitdescendantsize\", DEFAULT_DESCENDANT_SIZE_LIMIT) * 1000 * 40;\n+    if (nMempoolSizeMax < 0 || nMempoolSizeMax < nMempoolSizeMin)\n+        throw JSONRPCError(RPC_INVALID_PARAMETER, strprintf(\"MaxMempool size %d is too small\", nSize));\n+    gArgs.ForceSetArg(\"-maxmempool\", strprintf(\"%d\", nSize));\n+\n+    return NullUniValue;\n+}\n+    };\n+}\n+\n static RPCHelpMan getrawmempool()\n {\n     return RPCHelpMan{\"getrawmempool\",\n@@ -2574,6 +2600,7 @@ static const CRPCCommand commands[] =\n     { \"blockchain\",         &gettxoutsetinfo,                    },\n     { \"blockchain\",         &pruneblockchain,                    },\n     { \"blockchain\",         &savemempool,                        },\n+    { \"blockchain\",         &maxmempool,                         },\n     { \"blockchain\",         &verifychain,                        },\n \n     { \"blockchain\",         &preciousblock,                      },"
      },
      {
        "sha": "ce82a894c6f5be04c251636329226a3fad5cf0d9",
        "filename": "src/rpc/client.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/040b280c6613ac81a92a324f356f0b4cc205ef8d/src/rpc/client.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/040b280c6613ac81a92a324f356f0b4cc205ef8d/src/rpc/client.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpc/client.cpp?ref=040b280c6613ac81a92a324f356f0b4cc205ef8d",
        "patch": "@@ -57,6 +57,7 @@ static const CRPCConvertParam vRPCConvertParams[] =\n     { \"getbalance\", 2, \"include_watchonly\" },\n     { \"getbalance\", 3, \"avoid_reuse\" },\n     { \"getblockhash\", 0, \"height\" },\n+    { \"maxmempool\", 0, \"megabytes\" },\n     { \"waitforblockheight\", 0, \"height\" },\n     { \"waitforblockheight\", 1, \"timeout\" },\n     { \"waitforblock\", 1, \"timeout\" },"
      }
    ]
  }
]