[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/293294492",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10178#issuecomment-293294492",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10178",
    "id": 293294492,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5MzI5NDQ5Mg==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-11T15:09:54Z",
    "updated_at": "2017-04-11T15:09:54Z",
    "author_association": "MEMBER",
    "body": "utACK 541ceeb0ef416a87dbd3d07f370950826eca87b9, modulo @ryanofsky's style/comment nits.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/293294492/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/293325333",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10178#issuecomment-293325333",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10178",
    "id": 293325333,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5MzMyNTMzMw==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-11T16:49:41Z",
    "updated_at": "2017-04-11T16:49:41Z",
    "author_association": "MEMBER",
    "body": "utACK eeb2181b3dea071dde0d2aeb2e6a92cb53ee71c6",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/293325333/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/293373006",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10178#issuecomment-293373006",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10178",
    "id": 293373006,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5MzM3MzAwNg==",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-11T19:21:21Z",
    "updated_at": "2017-04-11T19:21:35Z",
    "author_association": "CONTRIBUTOR",
    "body": "utACK eeb2181b3dea071dde0d2aeb2e6a92cb53ee71c6. Would still suggest making some edits to the description to make it clear what exact corner case was broken before and now fixed:\r\n\r\n>UpdatedTransaction was previously ~~~used by~~~ ***called to cause*** the GUI to display\r\ncoinbase transactions ~~~only after they have~~~ ***after having*** a block built on top of\r\nthem. This worked fine ~~~for~~~ in most cases, but ~~~only worked due to a~~~ **not in the**\r\ncorner case if the user received a coinbase payout in a block\r\nimmediately prior to restart ~~~. In that case, the normal process of\r\ncaching the most recent coinbase transaction's hash would not work,\r\nand instead it would only work because of~~~ ***, and then restarted with -checkblocks=0 (which would disable*** the on-load -checkblocks\r\ncalling DisconnectBlock and ConnectBlock on the current tip. ***)***\r\n>\r\n>In order to make this more robust, a full mapWallet loop after the\r\nfirst block which is connected after restart ~~~was~~~ ***is now*** added.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/293373006/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/293925249",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10178#issuecomment-293925249",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10178",
    "id": 293925249,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5MzkyNTI0OQ==",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-13T15:15:19Z",
    "updated_at": "2017-04-13T15:15:19Z",
    "author_association": "MEMBER",
    "body": "re-utACK 9fececb",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/293925249/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/294424833",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10178#issuecomment-294424833",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10178",
    "id": 294424833,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5NDQyNDgzMw==",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-17T07:35:51Z",
    "updated_at": "2017-04-17T07:38:00Z",
    "author_association": "MEMBER",
    "body": "I think it would be good to get rid of the GUI logic that only displays generated transactions at confirmations=2. It is a left-over from the times that it was still realistic to mine locally in the GUI, and needlessly complicates this.\r\n\r\nutACK 9fececb otherwise",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/294424833/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/294460259",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10178#issuecomment-294460259",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10178",
    "id": 294460259,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5NDQ2MDI1OQ==",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?u=7999a16349f0df0fb273fffa18e5a955c9d3f11c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-17T11:22:04Z",
    "updated_at": "2017-04-17T11:22:04Z",
    "author_association": "MEMBER",
    "body": "utACK 9fececb2cbabc52cc375b84bf840fac018cc8121\r\n\r\n> I think it would be good to get rid of the GUI logic that only displays generated transactions at confirmations=2. It is a left-over from the times that it was still realistic to mine locally in the GUI, and needlessly complicates this.\r\n\r\nThat can be done as a follow-up PR?\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/294460259/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/294474819",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10178#issuecomment-294474819",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10178",
    "id": 294474819,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5NDQ3NDgxOQ==",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-17T12:24:53Z",
    "updated_at": "2017-04-17T12:24:53Z",
    "author_association": "CONTRIBUTOR",
    "body": "Indeed, I didn't want to get into a discussion on changing the GUI to simplify internals, so left that to a separate PR. I'd say this is still pretty simple, but I'm happy to take a look at removing the display quirk if you prefer.\n\nOn April 17, 2017 3:35:56 AM EDT, \"Wladimir J. van der Laan\" <notifications@github.com> wrote:\n>I think it would be good to get rid of the GUI logic that only displays\n>generated transactions at confirmations=2. It is a left-over from the\n>times that it was still realistic to mine locally in the GUI, and\n>needlessly complicates this.\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/294474819/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/294479217",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10178#issuecomment-294479217",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10178",
    "id": 294479217,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5NDQ3OTIxNw==",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-17T12:45:23Z",
    "updated_at": "2017-04-17T12:45:23Z",
    "author_association": "MEMBER",
    "body": "> Indeed, I didn't want to get into a discussion on changing the GUI to simplify internals\r\n\r\nNot just to simplify internals, but it's a (virtually) untested code path. Also the core side shouldn't have to be doing this kind of acrobatics specifically to preserve a GUI quirk. If this is worth keeping it should be handled at the side of the GUI.\r\n\r\n> That can be done as a follow-up PR?\r\n\r\nOf course.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/294479217/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110782830",
    "pull_request_review_id": 31980204,
    "id": 110782830,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMDc4MjgzMA==",
    "diff_hunk": "@@ -1155,6 +1155,32 @@ void CWallet::BlockConnected(const std::shared_ptr<const CBlock>& pblock, const\n     for (size_t i = 0; i < pblock->vtx.size(); i++) {\n         SyncTransaction(pblock->vtx[i], pindex, i);\n     }\n+\n+\n+    if (pindex) {\n+        // Only notify UI if this transaction is in this wallet\n+        {\n+            if (hashPrevBestCoinbase.IsNull()) {\n+                // For correctness we scan over the entire wallet, looking for\n+                // the previous block's coinbase, just in case it is ours, so\n+                // that we can notify the UI that it should now be displayed.\n+                if (pindex->pprev) {\n+                    for (const std::pair<uint256, CWalletTx>& p : mapWallet) {\n+                        if (p.second.IsCoinBase() && p.second.hashBlock == pindex->pprev->GetBlockHash()) {\n+                            NotifyTransactionChanged(this, p.first, CT_UPDATED);\n+                            break;\n+                        }\n+                    }\n+                }\n+            } else {\n+                std::map<uint256, CWalletTx>::const_iterator mi = mapWallet.find(hashPrevBestCoinbase);\n+                if (mi != mapWallet.end())\n+                    NotifyTransactionChanged(this, hashPrevBestCoinbase, CT_UPDATED);\n+            }\n+        }",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 26,
    "commit_id": "9fececb2cbabc52cc375b84bf840fac018cc8121",
    "original_commit_id": "b6d4fc27153948b68edc2cd956caac16de2e8c36",
    "user": {
      "login": "dcousens",
      "id": 413395,
      "node_id": "MDQ6VXNlcjQxMzM5NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/413395?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dcousens",
      "html_url": "https://github.com/dcousens",
      "followers_url": "https://api.github.com/users/dcousens/followers",
      "following_url": "https://api.github.com/users/dcousens/following{/other_user}",
      "gists_url": "https://api.github.com/users/dcousens/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dcousens/subscriptions",
      "organizations_url": "https://api.github.com/users/dcousens/orgs",
      "repos_url": "https://api.github.com/users/dcousens/repos",
      "events_url": "https://api.github.com/users/dcousens/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dcousens/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "why is this in an extra block?",
    "created_at": "2017-04-10T23:03:14Z",
    "updated_at": "2017-04-13T14:36:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10178#discussion_r110782830",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10178",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110782830"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10178#discussion_r110782830"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10178"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110782830/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1176,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110783429",
    "pull_request_review_id": 31980853,
    "id": 110783429,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMDc4MzQyOQ==",
    "diff_hunk": "@@ -1155,6 +1155,32 @@ void CWallet::BlockConnected(const std::shared_ptr<const CBlock>& pblock, const\n     for (size_t i = 0; i < pblock->vtx.size(); i++) {\n         SyncTransaction(pblock->vtx[i], pindex, i);\n     }\n+\n+\n+    if (pindex) {\n+        // Only notify UI if this transaction is in this wallet\n+        {\n+            if (hashPrevBestCoinbase.IsNull()) {\n+                // For correctness we scan over the entire wallet, looking for\n+                // the previous block's coinbase, just in case it is ours, so\n+                // that we can notify the UI that it should now be displayed.\n+                if (pindex->pprev) {\n+                    for (const std::pair<uint256, CWalletTx>& p : mapWallet) {\n+                        if (p.second.IsCoinBase() && p.second.hashBlock == pindex->pprev->GetBlockHash()) {\n+                            NotifyTransactionChanged(this, p.first, CT_UPDATED);\n+                            break;\n+                        }\n+                    }\n+                }\n+            } else {\n+                std::map<uint256, CWalletTx>::const_iterator mi = mapWallet.find(hashPrevBestCoinbase);\n+                if (mi != mapWallet.end())\n+                    NotifyTransactionChanged(this, hashPrevBestCoinbase, CT_UPDATED);\n+            }\n+        }",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 26,
    "commit_id": "9fececb2cbabc52cc375b84bf840fac018cc8121",
    "original_commit_id": "b6d4fc27153948b68edc2cd956caac16de2e8c36",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "TBH I have no idea...probably copied and had a lock block, anyway, removed.",
    "created_at": "2017-04-10T23:08:07Z",
    "updated_at": "2017-04-13T14:36:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10178#discussion_r110783429",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10178",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110783429"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10178#discussion_r110783429"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10178"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110783429/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1176,
    "side": "RIGHT",
    "in_reply_to_id": 110782830
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110906249",
    "pull_request_review_id": 32110343,
    "id": 110906249,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMDkwNjI0OQ==",
    "diff_hunk": "@@ -1155,6 +1155,30 @@ void CWallet::BlockConnected(const std::shared_ptr<const CBlock>& pblock, const\n     for (size_t i = 0; i < pblock->vtx.size(); i++) {\n         SyncTransaction(pblock->vtx[i], pindex, i);\n     }\n+\n+\n+    if (pindex) {\n+        // Only notify UI if this transaction is in this wallet\n+        if (hashPrevBestCoinbase.IsNull()) {\n+            // For correctness we scan over the entire wallet, looking for\n+            // the previous block's coinbase, just in case it is ours, so\n+            // that we can notify the UI that it should now be displayed.",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 11,
    "commit_id": "9fececb2cbabc52cc375b84bf840fac018cc8121",
    "original_commit_id": "9f51ad130049fa5cbcd83d5bc5e0d145d6a73cc3",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I found this code and comment, as well as the comment in the commit description really confusing (I think there are some words missing between \"except because\" in the commit description?). I don't get why it's important to call NotifyTransactionChanged on the coinbase transaction of the previous block when a new block is added.\r\n\r\nI would also suggest structuring the code as:\r\n\r\n```\r\nif (hashPrevBestCoinbase.IsNull()) {\r\n   ... loop hunting for hashPrevBestCoinbase in mapWallet ...\r\n}\r\n\r\nif (!hashPrevBestCoinbase.IsNull() && mapWallet.count(hashPrevBestCoinbase)) {\r\n    // Notify UI about coinbase transaction in the previous block when a new block\r\n    // is added because [reason].\r\n    NotifyTransactionChanged(this, hashPrevBestCoinbase, CT_UPDATED);\r\n}\r\n\r\nhashPrevBestCoinbase = pblock->vtx[0]->GetHash();\r\n```\r\n\r\nCode change is just a suggestion, but I think the comment really should be improved.",
    "created_at": "2017-04-11T13:48:57Z",
    "updated_at": "2017-04-13T14:36:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10178#discussion_r110906249",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10178",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110906249"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10178#discussion_r110906249"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10178"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110906249/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1165,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110910123",
    "pull_request_review_id": 32110343,
    "id": 110910123,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMDkxMDEyMw==",
    "diff_hunk": "@@ -1155,6 +1155,30 @@ void CWallet::BlockConnected(const std::shared_ptr<const CBlock>& pblock, const\n     for (size_t i = 0; i < pblock->vtx.size(); i++) {\n         SyncTransaction(pblock->vtx[i], pindex, i);\n     }\n+\n+\n+    if (pindex) {\n+        // Only notify UI if this transaction is in this wallet",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 7,
    "commit_id": "9fececb2cbabc52cc375b84bf840fac018cc8121",
    "original_commit_id": "9f51ad130049fa5cbcd83d5bc5e0d145d6a73cc3",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Copy and paste error? There is no \"this transaction\" at this point.",
    "created_at": "2017-04-11T14:02:47Z",
    "updated_at": "2017-04-13T14:36:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10178#discussion_r110910123",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10178",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110910123"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10178#discussion_r110910123"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10178"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110910123/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1161,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110917487",
    "pull_request_review_id": 32122883,
    "id": 110917487,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMDkxNzQ4Nw==",
    "diff_hunk": "@@ -1155,6 +1155,30 @@ void CWallet::BlockConnected(const std::shared_ptr<const CBlock>& pblock, const\n     for (size_t i = 0; i < pblock->vtx.size(); i++) {\n         SyncTransaction(pblock->vtx[i], pindex, i);\n     }\n+\n+\n+    if (pindex) {\n+        // Only notify UI if this transaction is in this wallet",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 7,
    "commit_id": "9fececb2cbabc52cc375b84bf840fac018cc8121",
    "original_commit_id": "9f51ad130049fa5cbcd83d5bc5e0d145d6a73cc3",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Indeed, updated comment.",
    "created_at": "2017-04-11T14:30:14Z",
    "updated_at": "2017-04-13T14:36:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10178#discussion_r110917487",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10178",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110917487"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10178#discussion_r110917487"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10178"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110917487/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1161,
    "side": "RIGHT",
    "in_reply_to_id": 110910123
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110918042",
    "pull_request_review_id": 32123513,
    "id": 110918042,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMDkxODA0Mg==",
    "diff_hunk": "@@ -1155,6 +1155,30 @@ void CWallet::BlockConnected(const std::shared_ptr<const CBlock>& pblock, const\n     for (size_t i = 0; i < pblock->vtx.size(); i++) {\n         SyncTransaction(pblock->vtx[i], pindex, i);\n     }\n+\n+\n+    if (pindex) {\n+        // Only notify UI if this transaction is in this wallet\n+        if (hashPrevBestCoinbase.IsNull()) {\n+            // For correctness we scan over the entire wallet, looking for\n+            // the previous block's coinbase, just in case it is ours, so\n+            // that we can notify the UI that it should now be displayed.",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 11,
    "commit_id": "9fececb2cbabc52cc375b84bf840fac018cc8121",
    "original_commit_id": "9f51ad130049fa5cbcd83d5bc5e0d145d6a73cc3",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I expanded a bit on the comment. The commit message is correct, if its hard to read, any suggestions for improvements?\r\n\r\nI removed the outer-level if statement, as it is now useless, indeed.",
    "created_at": "2017-04-11T14:32:14Z",
    "updated_at": "2017-04-13T14:36:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10178#discussion_r110918042",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10178",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110918042"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10178#discussion_r110918042"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10178"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110918042/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1165,
    "side": "RIGHT",
    "in_reply_to_id": 110906249
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110920843",
    "pull_request_review_id": 32126684,
    "id": 110920843,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMDkyMDg0Mw==",
    "diff_hunk": "@@ -1155,6 +1155,31 @@ void CWallet::BlockConnected(const std::shared_ptr<const CBlock>& pblock, const\n     for (size_t i = 0; i < pblock->vtx.size(); i++) {\n         SyncTransaction(pblock->vtx[i], pindex, i);\n     }\n+\n+    // The GUI expects a NotifyTransactionChanged when a coinbase tx\n+    // which is in our wallet moves from in-the-best-block to\n+    // 2-confirmations. We do that here.",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 7,
    "commit_id": "9fececb2cbabc52cc375b84bf840fac018cc8121",
    "original_commit_id": "58d40125adfd05f8b5218a3141424821d426a162",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks, this is much better. I still have no idea why the GUI cares specifically about the second confirmation of the coinbase transaction in the previous block. Why not other transactions in the previous block? If you could add another sentence here suggesting a reason, that might be helpful.",
    "created_at": "2017-04-11T14:42:06Z",
    "updated_at": "2017-04-13T14:36:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10178#discussion_r110920843",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10178",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110920843"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10178#discussion_r110920843"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10178"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110920843/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1161,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110924730",
    "pull_request_review_id": 32131060,
    "id": 110924730,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMDkyNDczMA==",
    "diff_hunk": "@@ -1155,6 +1155,30 @@ void CWallet::BlockConnected(const std::shared_ptr<const CBlock>& pblock, const\n     for (size_t i = 0; i < pblock->vtx.size(); i++) {\n         SyncTransaction(pblock->vtx[i], pindex, i);\n     }\n+\n+\n+    if (pindex) {\n+        // Only notify UI if this transaction is in this wallet\n+        if (hashPrevBestCoinbase.IsNull()) {\n+            // For correctness we scan over the entire wallet, looking for\n+            // the previous block's coinbase, just in case it is ours, so\n+            // that we can notify the UI that it should now be displayed.",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 11,
    "commit_id": "9fececb2cbabc52cc375b84bf840fac018cc8121",
    "original_commit_id": "9f51ad130049fa5cbcd83d5bc5e0d145d6a73cc3",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> The commit message is correct, if its hard to read, any suggestions for improvements?\r\n\r\nI still don't understand the commit message so I can't say how to improve it. But here is how it parses to me:\r\n\r\n> Note that this does a full mapWallet loop after the first block\r\n> which is connected after restart.\r\n\r\nFine so far.\r\n\r\n> This is due to a previous bug where a coinbase transaction from the current best tip which existed in wallet immediately prior to restart would not be shown in the GUI\r\n\r\nHow is a previous bug relevant? Was it not fixed? What does \"existed immediately prior to restart\" mean? Does it mean a transaction _added_ immediately prior to restart? When would the transaction not be shown in the GUI, before or after the restart?\r\n\r\n> except because on-load -checkblocks would call DisconnectBlock and ConnectBlock on the current tip.\r\n\r\nAre there words missing between \"except\" and \"because\"? Is this saying the transaction would show up after the restart but not before?\r\n\r\n> To avoid making it worse (ie that such transactions would never be displayed\r\nuntil restart), a scan to find such transactions was added.\r\n\r\nIs this referring to the scan you are adding in this commit, or some other scan?\r\n\r\n",
    "created_at": "2017-04-11T14:56:03Z",
    "updated_at": "2017-04-13T14:36:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10178#discussion_r110924730",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10178",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110924730"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10178#discussion_r110924730"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10178"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110924730/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1165,
    "side": "RIGHT",
    "in_reply_to_id": 110906249
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110925498",
    "pull_request_review_id": 32131905,
    "id": 110925498,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMDkyNTQ5OA==",
    "diff_hunk": "@@ -1155,6 +1155,31 @@ void CWallet::BlockConnected(const std::shared_ptr<const CBlock>& pblock, const\n     for (size_t i = 0; i < pblock->vtx.size(); i++) {\n         SyncTransaction(pblock->vtx[i], pindex, i);\n     }\n+\n+    // The GUI expects a NotifyTransactionChanged when a coinbase tx\n+    // which is in our wallet moves from in-the-best-block to\n+    // 2-confirmations. We do that here.",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 7,
    "commit_id": "9fececb2cbabc52cc375b84bf840fac018cc8121",
    "original_commit_id": "58d40125adfd05f8b5218a3141424821d426a162",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Updated the comment, the GUI simply doesnt display such transactions until they are buried.",
    "created_at": "2017-04-11T14:58:39Z",
    "updated_at": "2017-04-13T14:36:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10178#discussion_r110925498",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10178",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110925498"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10178#discussion_r110925498"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10178"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110925498/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1161,
    "side": "RIGHT",
    "in_reply_to_id": 110920843
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110928559",
    "pull_request_review_id": 32135143,
    "id": 110928559,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMDkyODU1OQ==",
    "diff_hunk": "@@ -1155,6 +1155,30 @@ void CWallet::BlockConnected(const std::shared_ptr<const CBlock>& pblock, const\n     for (size_t i = 0; i < pblock->vtx.size(); i++) {\n         SyncTransaction(pblock->vtx[i], pindex, i);\n     }\n+\n+\n+    if (pindex) {\n+        // Only notify UI if this transaction is in this wallet\n+        if (hashPrevBestCoinbase.IsNull()) {\n+            // For correctness we scan over the entire wallet, looking for\n+            // the previous block's coinbase, just in case it is ours, so\n+            // that we can notify the UI that it should now be displayed.",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 11,
    "commit_id": "9fececb2cbabc52cc375b84bf840fac018cc8121",
    "original_commit_id": "9f51ad130049fa5cbcd83d5bc5e0d145d6a73cc3",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I agree with @ryanofsky's suggested code change. That structure seems clearer to me.\r\n\r\nI think the commit message can be shortened and the reference to the previous bug removed. Something like:\r\n\r\n```\r\nThis does a full mapWallet loop after the first block is connected\r\nafter restart. This is so NotifyTransactionChanged() is called for\r\nthe coinbase transaction of the previous best block if it belongs to us.\r\n```\r\n\r\nseems clearer to me.",
    "created_at": "2017-04-11T15:09:09Z",
    "updated_at": "2017-04-13T14:36:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10178#discussion_r110928559",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10178",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110928559"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10178#discussion_r110928559"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10178"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110928559/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1165,
    "side": "RIGHT",
    "in_reply_to_id": 110906249
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110936104",
    "pull_request_review_id": 32143455,
    "id": 110936104,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMDkzNjEwNA==",
    "diff_hunk": "@@ -1155,6 +1155,30 @@ void CWallet::BlockConnected(const std::shared_ptr<const CBlock>& pblock, const\n     for (size_t i = 0; i < pblock->vtx.size(); i++) {\n         SyncTransaction(pblock->vtx[i], pindex, i);\n     }\n+\n+\n+    if (pindex) {\n+        // Only notify UI if this transaction is in this wallet\n+        if (hashPrevBestCoinbase.IsNull()) {\n+            // For correctness we scan over the entire wallet, looking for\n+            // the previous block's coinbase, just in case it is ours, so\n+            // that we can notify the UI that it should now be displayed.",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 11,
    "commit_id": "9fececb2cbabc52cc375b84bf840fac018cc8121",
    "original_commit_id": "9f51ad130049fa5cbcd83d5bc5e0d145d6a73cc3",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "OK, I completely rewrote the commit message, better now?",
    "created_at": "2017-04-11T15:35:11Z",
    "updated_at": "2017-04-13T14:36:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10178#discussion_r110936104",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10178",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110936104"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10178#discussion_r110936104"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10178"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110936104/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1165,
    "side": "RIGHT",
    "in_reply_to_id": 110906249
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111399306",
    "pull_request_review_id": 32642187,
    "id": 111399306,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMTM5OTMwNg==",
    "diff_hunk": "@@ -1155,6 +1155,32 @@ void CWallet::BlockConnected(const std::shared_ptr<const CBlock>& pblock, const\n     for (size_t i = 0; i < pblock->vtx.size(); i++) {\n         SyncTransaction(pblock->vtx[i], pindex, i);\n     }\n+\n+    // The GUI expects a NotifyTransactionChanged when a coinbase tx\n+    // which is in our wallet moves from in-the-best-block to\n+    // 2-confirmations (as it only displays them at that time).\n+    // We do that here.\n+    if (hashPrevBestCoinbase.IsNull()) {\n+        // Immediately after restart we have no idea what the coinbase\n+        // transaction from the previous block is.\n+        // For correctness we scan over the entire wallet, looking for\n+        // the previous block's coinbase, just in case it is ours, so\n+        // that we can notify the UI that it should now be displayed.\n+        if (pindex->pprev) {\n+            for (const std::pair<uint256, CWalletTx>& p : mapWallet) {\n+                if (p.second.IsCoinBase() && p.second.hashBlock == pindex->pprev->GetBlockHash()) {\n+                    NotifyTransactionChanged(this, p.first, CT_UPDATED);\n+                    break;\n+                }\n+            }\n+        }\n+    } else {\n+        std::map<uint256, CWalletTx>::const_iterator mi = mapWallet.find(hashPrevBestCoinbase);\n+        if (mi != mapWallet.end())",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 25,
    "commit_id": "9fececb2cbabc52cc375b84bf840fac018cc8121",
    "original_commit_id": "eeb2181b3dea071dde0d2aeb2e6a92cb53ee71c6",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "style nit: curly braces for the one-line `if`",
    "created_at": "2017-04-13T14:13:17Z",
    "updated_at": "2017-04-13T14:36:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10178#discussion_r111399306",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10178",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111399306"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10178#discussion_r111399306"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10178"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111399306/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1179,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111404698",
    "pull_request_review_id": 32648496,
    "id": 111404698,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMTQwNDY5OA==",
    "diff_hunk": "@@ -1155,6 +1155,32 @@ void CWallet::BlockConnected(const std::shared_ptr<const CBlock>& pblock, const\n     for (size_t i = 0; i < pblock->vtx.size(); i++) {\n         SyncTransaction(pblock->vtx[i], pindex, i);\n     }\n+\n+    // The GUI expects a NotifyTransactionChanged when a coinbase tx\n+    // which is in our wallet moves from in-the-best-block to\n+    // 2-confirmations (as it only displays them at that time).\n+    // We do that here.\n+    if (hashPrevBestCoinbase.IsNull()) {\n+        // Immediately after restart we have no idea what the coinbase\n+        // transaction from the previous block is.\n+        // For correctness we scan over the entire wallet, looking for\n+        // the previous block's coinbase, just in case it is ours, so\n+        // that we can notify the UI that it should now be displayed.\n+        if (pindex->pprev) {\n+            for (const std::pair<uint256, CWalletTx>& p : mapWallet) {\n+                if (p.second.IsCoinBase() && p.second.hashBlock == pindex->pprev->GetBlockHash()) {\n+                    NotifyTransactionChanged(this, p.first, CT_UPDATED);\n+                    break;\n+                }\n+            }\n+        }\n+    } else {\n+        std::map<uint256, CWalletTx>::const_iterator mi = mapWallet.find(hashPrevBestCoinbase);\n+        if (mi != mapWallet.end())",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 25,
    "commit_id": "9fececb2cbabc52cc375b84bf840fac018cc8121",
    "original_commit_id": "eeb2181b3dea071dde0d2aeb2e6a92cb53ee71c6",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Fixed.",
    "created_at": "2017-04-13T14:36:32Z",
    "updated_at": "2017-04-13T14:36:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10178#discussion_r111404698",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10178",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111404698"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10178#discussion_r111404698"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10178"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111404698/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1179,
    "side": "RIGHT",
    "in_reply_to_id": 111399306
  }
]