[
  {
    "sha": "676b58d82509fe90ec6fb35523df147ef22abe58",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo2NzZiNThkODI1MDlmZTkwZWM2ZmIzNTUyM2RmMTQ3ZWYyMmFiZTU4",
    "commit": {
      "author": {
        "name": "Karl-Johan Alm",
        "email": "karljohan-alm@garage.co.jp",
        "date": "2017-10-12T04:40:35Z"
      },
      "committer": {
        "name": "Karl-Johan Alm",
        "email": "karljohan-alm@garage.co.jp",
        "date": "2018-01-18T04:09:06Z"
      },
      "message": "Support output type argument in sendtoaddress for change address (closes #11134)",
      "tree": {
        "sha": "bd820f3e0491a581deb3e60344cd9a65d64ed5a1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/bd820f3e0491a581deb3e60344cd9a65d64ed5a1"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/676b58d82509fe90ec6fb35523df147ef22abe58",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEExCr/fGGz5EoUVM01V692LbM1MyIFAlpgHeIACgkQV692LbM1\nMyI59Q//WEvp2iwXtskRUiR2PyOHC4xatZIL6EP53SoRsWBkxJPBAXzyseI1g/qe\nGTtEw4+uC261leiGRs8/pcvZFGIpRamzxeQTJeWK0+eZxgU4OVKiBrkSwqdMfGDz\n2tNF/8okEj1j6MRl2V9gcPtTDq3TezbqnBP3CqmRtHJiZIcRt0xeJfSHWBw/pf1N\nRHuEuA3+qxLDbqy+b220jJT3MMMnURacVUFdpsYtLMyL7LLUeZNbi/Q8FUNZvQ1z\nMwAXkarU/fTnW9ZtACxLlrACN4XniokATkS5ggV9iluxrL1FCti4AQ1PkAyQA6yS\nl69Hdq7QChskqdCFpqGKiDusHiUf1p2XwZOAI3HtwJ8DSLCkH5c1SDCC/9jKC5UU\n4TVlmVVbYlI8VMcs8UzEuQ3Y5hLQM0Vka62MI+vw6h/x2hVQSl4reGfWrqzYN3Xr\nZDLyyPvVYgOuJ9heCRDfgcTRK+etapITkfjNdqulnVE6jyUufFT9lATz6ZCbAUp5\nFywxcrmO6+aTJs+0corjo3dVrM11eVMgQqgiDB/5cCV+KX7PfwHNmRfQ5A7LqFiC\n2nU4jsOkfXVnNBX0Cs6L9JH+wa73pUpQIH+VEmwuwx5egsnSBXr/ccQ4dyVoreYw\na7AME6fYRYrWvGNsTc/nDnhjMOKxWzB0JX3lrIWYgUpoRakkz7I=\n=4UYm\n-----END PGP SIGNATURE-----",
        "payload": "tree bd820f3e0491a581deb3e60344cd9a65d64ed5a1\nparent d889c036cd6f683116e6a27e404be2809d1deb76\nauthor Karl-Johan Alm <karljohan-alm@garage.co.jp> 1507783235 +0900\ncommitter Karl-Johan Alm <karljohan-alm@garage.co.jp> 1516248546 +0900\n\nSupport output type argument in sendtoaddress for change address (closes #11134)\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/676b58d82509fe90ec6fb35523df147ef22abe58",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/676b58d82509fe90ec6fb35523df147ef22abe58",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/676b58d82509fe90ec6fb35523df147ef22abe58/comments",
    "author": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "d889c036cd6f683116e6a27e404be2809d1deb76",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d889c036cd6f683116e6a27e404be2809d1deb76",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/d889c036cd6f683116e6a27e404be2809d1deb76"
      }
    ],
    "stats": {
      "total": 19,
      "additions": 15,
      "deletions": 4
    },
    "files": [
      {
        "sha": "c6d39c37873fc02dd73ff6d7714158185d59d3ad",
        "filename": "src/wallet/coincontrol.h",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/676b58d82509fe90ec6fb35523df147ef22abe58/src/wallet/coincontrol.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/676b58d82509fe90ec6fb35523df147ef22abe58/src/wallet/coincontrol.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/coincontrol.h?ref=676b58d82509fe90ec6fb35523df147ef22abe58",
        "patch": "@@ -17,6 +17,8 @@ class CCoinControl\n {\n public:\n     CTxDestination destChange;\n+    //! Style to use for change destination (if destChange unset)\n+    OutputType m_change_type;\n     //! If false, allows unselected inputs, but requires all selected inputs be used\n     bool fAllowOtherInputs;\n     //! Includes watch only addresses which match the ISMINE_WATCH_SOLVABLE criteria\n@@ -40,6 +42,7 @@ class CCoinControl\n     void SetNull()\n     {\n         destChange = CNoDestination();\n+        m_change_type = g_change_type;\n         fAllowOtherInputs = false;\n         fAllowWatchOnly = false;\n         setSelected.clear();"
      },
      {
        "sha": "32852d355d24e480c1979b606b6ad0b21ea6bf12",
        "filename": "src/wallet/rpcwallet.cpp",
        "status": "modified",
        "additions": 10,
        "deletions": 2,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/676b58d82509fe90ec6fb35523df147ef22abe58/src/wallet/rpcwallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/676b58d82509fe90ec6fb35523df147ef22abe58/src/wallet/rpcwallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcwallet.cpp?ref=676b58d82509fe90ec6fb35523df147ef22abe58",
        "patch": "@@ -446,9 +446,10 @@ UniValue sendtoaddress(const JSONRPCRequest& request)\n         return NullUniValue;\n     }\n \n-    if (request.fHelp || request.params.size() < 2 || request.params.size() > 8)\n+    if (request.fHelp || request.params.size() < 2 || request.params.size() > 9)\n         throw std::runtime_error(\n-            \"sendtoaddress \\\"address\\\" amount ( \\\"comment\\\" \\\"comment_to\\\" subtractfeefromamount replaceable conf_target \\\"estimate_mode\\\")\\n\"\n+            std::string() +\n+            \"sendtoaddress \\\"address\\\" amount ( \\\"comment\\\" \\\"comment_to\\\" subtractfeefromamount replaceable conf_target \\\"estimate_mode\\\" \\\"change_type\\\" )\\n\"\n             \"\\nSend an amount to a given address.\\n\"\n             + HelpRequiringPassphrase(pwallet) +\n             \"\\nArguments:\\n\"\n@@ -467,6 +468,7 @@ UniValue sendtoaddress(const JSONRPCRequest& request)\n             \"       \\\"UNSET\\\"\\n\"\n             \"       \\\"ECONOMICAL\\\"\\n\"\n             \"       \\\"CONSERVATIVE\\\"\\n\"\n+            \"9. \\\"change_type\\\"        (string, optional, default=\\\"\" + FormatOutputType(g_change_type) + \"\\\") The address type to use for the change output. Valid options are \\\"p2pkh\\\", \\\"p2sh_p2wpkh\\\", and \\\"p2wpkh\\\"\\n\"\n             \"\\nResult:\\n\"\n             \"\\\"txid\\\"                  (string) The transaction id.\\n\"\n             \"\\nExamples:\\n\"\n@@ -521,6 +523,12 @@ UniValue sendtoaddress(const JSONRPCRequest& request)\n         }\n     }\n \n+    if (!request.params[8].isNull()) {\n+        coin_control.m_change_type = ParseOutputType(request.params[8].get_str());\n+        if (coin_control.m_change_type == OUTPUT_TYPE_NONE) {\n+            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, strprintf(\"Unknown change address type '%s'\", request.params[8].get_str()));\n+        }\n+    }\n \n     EnsureWalletIsUnlocked(pwallet);\n "
      },
      {
        "sha": "874622833843f9ff0298788546c281801f25c1ed",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/676b58d82509fe90ec6fb35523df147ef22abe58/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/676b58d82509fe90ec6fb35523df147ef22abe58/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=676b58d82509fe90ec6fb35523df147ef22abe58",
        "patch": "@@ -2739,8 +2739,8 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CWalletT\n                     return false;\n                 }\n \n-                LearnRelatedScripts(vchPubKey, g_change_type);\n-                scriptChange = GetScriptForDestination(GetDestinationForKey(vchPubKey, g_change_type));\n+                LearnRelatedScripts(vchPubKey, coin_control.m_change_type);\n+                scriptChange = GetScriptForDestination(GetDestinationForKey(vchPubKey, coin_control.m_change_type));\n             }\n             CTxOut change_prototype_txout(0, scriptChange);\n             size_t change_prototype_size = GetSerializeSize(change_prototype_txout, SER_DISK, 0);"
      }
    ]
  }
]