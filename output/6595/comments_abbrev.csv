dcousens,2015-09-07T13:05:41Z,"utACK,  concept ACK.\n",https://github.com/bitcoin/bitcoin/pull/6595#issuecomment-138292825,138292825,
sipa,2015-09-07T15:46:58Z,Untested ACK.\n,https://github.com/bitcoin/bitcoin/pull/6595#issuecomment-138328154,138328154,
sdaftuar,2015-09-08T14:40:29Z,"ACK.\n\nFYI I think that it's worth thinking about this code again if we consider merging #6216, because I believe with the anti-fee sniping use of nlocktime we may end up purging a lot of transactions from the mempool  whenever there is a reorg.\n",https://github.com/bitcoin/bitcoin/pull/6595#issuecomment-138587004,138587004,
sipa,2015-09-08T14:51:12Z,"Longer term, I think it's better to change the invariant for the mempool\nfrom ""Valid for the expected next block"" to ""will be eventually valid"".\nAccepting non-final transactions then becomes a policy question, rather\nthan a consistency requirement. It would also speed up block disconnects,\nwhich is a good thing  as reorganizations are already slower than normal\nblock connects - they shouldn't",https://github.com/bitcoin/bitcoin/pull/6595#issuecomment-138590569,138590569,
TheBlueMatt,2015-09-09T00:53:17Z,"I'm not too worried about changing the mempool invariant...mostly because I think (someone should audit to be sure), that this code would work as-is if it were just called once at the end of a reorg instead of after each bock disconnect.\n",https://github.com/bitcoin/bitcoin/pull/6595#issuecomment-138742155,138742155,
petertodd,2015-09-09T20:46:53Z,"@sipa I was the one who added that invariant in the first place, and I only meant it as a DoS attack defence, not as a true invariant. In fact, IIRC my original proposal was that we'd allow txs into the mempool so long as they'd be valid in the next two or three blocks.\n\nAs for calling it at the end of a reorg, that looks fine to me modulo issues raised in my comments.\n",https://github.com/bitcoin/bitcoin/pull/6595#issuecomment-139041031,139041031,
TheBlueMatt,2015-11-05T19:00:10Z,Rebased at #6915\n,https://github.com/bitcoin/bitcoin/pull/6595#issuecomment-154153649,154153649,
sdaftuar,2015-09-03T20:00:44Z,nit: update this comment?\n,https://github.com/bitcoin/bitcoin/pull/6595#discussion_r38689599,38689599,src/txmempool.cpp
TheBlueMatt,2015-09-06T04:40:35Z,Done\n,https://github.com/bitcoin/bitcoin/pull/6595#discussion_r38817562,38817562,src/txmempool.cpp
petertodd,2015-09-09T20:43:44Z,"To be clear, the reason why you test both !coins and against COINBASE_MATURITY is because AccessCoins() will return a CCoins result for immature coins, right?\n\nI smell a future refactoring, but for now please add a comment describing those two cases and why there are two tests.\n",https://github.com/bitcoin/bitcoin/pull/6595#discussion_r39093631,39093631,src/txmempool.cpp
petertodd,2015-09-09T20:46:16Z,"Oh, and come to think of it your test above doesn't actually test both those cases; you need to do a >COINBASE_MATURITY reorg as well, to a chain that is equally long.\n",https://github.com/bitcoin/bitcoin/pull/6595#discussion_r39093908,39093908,src/txmempool.cpp
TheBlueMatt,2015-09-09T20:54:11Z,"Hmm? I didnt change this code at all, only its indentation. And, yes, I know the test-case is not complete, but creating a testcase that is complete is kinda a PITA (or, which case are you claiming should be implemented?)\n",https://github.com/bitcoin/bitcoin/pull/6595#discussion_r39094889,39094889,src/txmempool.cpp
petertodd,2015-09-09T21:08:03Z,"Sorry, arguably that's not your fault, agreed. :)\n\nI'm really thinking of the case where we change this to be called end-of-reorg; if that isn't the case in theory this !coins check should be redundant.\n\nMight be reasonable to leave this code as-is, and make a separate end-of-reorg function that just removes non-final transactions from the mempool.\n",https://github.com/bitcoin/bitcoin/pull/6595#discussion_r39096664,39096664,src/txmempool.cpp
TheBlueMatt,2015-09-09T21:18:21Z,"No, it would be my fault, I think I wrote that code, too :p.\n",https://github.com/bitcoin/bitcoin/pull/6595#discussion_r39097826,39097826,src/txmempool.cpp
TheBlueMatt,2015-09-09T21:18:55Z,Why are redundant checks to make code more reviewable and more clearly not segfault-y bad?\n,https://github.com/bitcoin/bitcoin/pull/6595#discussion_r39097875,39097875,src/txmempool.cpp
petertodd,2015-09-09T21:26:17Z,They're not bad! I just think it'd help if they were explained with comments. (and testing all ways of invoking them is always good)\n,https://github.com/bitcoin/bitcoin/pull/6595#discussion_r39098630,39098630,src/txmempool.cpp
