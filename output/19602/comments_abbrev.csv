DrahtBot,2020-07-27 23:26:05,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#23497](https://github.com/bitcoin/bitcoin/pull/23497) (Add `src/node/` and `src/wallet/` code to `node::` and `wallet::`",https://github.com/bitcoin/bitcoin/pull/19602#issuecomment-664688852,664688852,
hebasto,2020-07-29 10:55:14,"@achow101 \nIt seems this PR has [problems](https://travis-ci.org/github/bitcoin/bitcoin/jobs/712335127) with linters.",https://github.com/bitcoin/bitcoin/pull/19602#issuecomment-665595010,665595010,
luke-jr,2020-07-31 00:53:06,Why doesn't this extend `upgradewallet`?,https://github.com/bitcoin/bitcoin/pull/19602#issuecomment-666848115,666848115,
achow101,2020-07-31 18:13:33,"> Why doesn't this extend `upgradewallet`?\n\nIt didn't feel like it fit `upgradewallet` as I see that more for changing the wallet version number and using legacy wallet features. But this is changing a legacy wallet to something completely new.\n\nThis is also pretty invasive and fundamentally changes how the wallet is working, so I wanted to keep it separate from something that people might",https://github.com/bitcoin/bitcoin/pull/19602#issuecomment-667273357,667273357,
laanwj,2020-08-12 18:09:29,I think we should only add this functionality after `sqlite` wallets? Otherwise you'd keep migrating.,https://github.com/bitcoin/bitcoin/pull/19602#issuecomment-673029431,673029431,
achow101,2020-08-12 18:41:46,"> I think we should only add this functionality after `sqlite` wallets? Otherwise you'd keep migrating.\n\nI think there's a question of whether we want to keep sqlite separate from descriptors. We might want to allow legacy wallets to migrate to sqlite without migrating to descriptors since they are orthogonal.",https://github.com/bitcoin/bitcoin/pull/19602#issuecomment-673044201,673044201,
meshcollider,2020-08-15 23:49:41,"Do you know what the performance of a wallet would be like, in the case of a non-HD wallet being migrated? ",https://github.com/bitcoin/bitcoin/pull/19602#issuecomment-674458755,674458755,
achow101,2020-08-16 05:05:00,"> Do you know what the performance of a wallet would be like, in the case of a non-HD wallet being migrated?\n\nProbably worse.",https://github.com/bitcoin/bitcoin/pull/19602#issuecomment-674479714,674479714,
meshcollider,2020-08-17 03:19:02,"> Probably worse.\n\nAlmost certainly, that's why I'm asking :) It would be nice to know how much worse it would be",https://github.com/bitcoin/bitcoin/pull/19602#issuecomment-674634247,674634247,
Sjors,2020-08-31 18:18:39,"Concept ACK, but I prefer this to be in the wallet tool.",https://github.com/bitcoin/bitcoin/pull/19602#issuecomment-683946104,683946104,
achow101,2020-08-31 22:58:08,"> but I prefer this to be in the wallet tool.\n\nI would prefer this to be accessible to most users so that more people can move to using descriptor wallets. For most wallets, this should be painless and not result in a horribly bloated wallet.",https://github.com/bitcoin/bitcoin/pull/19602#issuecomment-684085595,684085595,
Sjors,2020-09-01 12:09:20,The wallet tool is just as available as the RPC. We can print the necessary incantation in the help if needed. It does make sense to have an upgrade button in the GUI though.,https://github.com/bitcoin/bitcoin/pull/19602#issuecomment-684805617,684805617,
achow101,2020-09-01 16:10:53,"> The wallet tool is just as available as the RPC.\n\nNot really. The RPC has a dedicated window within the GUI. The wallet tool requires actually using a terminal.",https://github.com/bitcoin/bitcoin/pull/19602#issuecomment-684968120,684968120,
jonatack,2020-09-01 19:09:50,"Concept ACK, a few quick thoughts before reviewing:\n- debug build clean and local tests green\n- the help in `bitcoin-cli help migratewallet` is pretty sparse? -- could benefit from a lot more helpful info to explain what/why/how to users, de-risk wallet migrations a bit and encourage users to move to descriptor wallets\n- agree with @meshcollider that performance info would be good here in th",https://github.com/bitcoin/bitcoin/pull/19602#issuecomment-685075629,685075629,
achow101,2020-09-14 16:48:41,"Hmm, I think the scriptPubKey set we are generating here is incorrect. I'm going to work on a slightly separate thing for LegacyScriptPubKeyMan that ensures we have the correct scriptPubKey set.",https://github.com/bitcoin/bitcoin/pull/19602#issuecomment-692179872,692179872,
achow101,2020-09-14 22:20:38,"Fixed the IsMine issue and added some tests for that. Also rebased onto master as there was a hidden merge conflict.\n\n>     * the help in `bitcoin-cli help migratewallet` is pretty sparse? -- could benefit from a lot more helpful info to explain what/why/how to users, de-risk wallet migrations a bit and encourage users to move to descriptor wallets\n\nAny suggestions?\n\n>     * agree with",https://github.com/bitcoin/bitcoin/pull/19602#issuecomment-692344229,692344229,
jonatack,2020-10-01 19:41:41,"Thanks @achow101, I need to review and test this.",https://github.com/bitcoin/bitcoin/pull/19602#issuecomment-702356461,702356461,
MarcoFalke,2021-01-14 07:51:08,"```\nSUMMARY: ThreadSanitizer: data race /usr/lib/llvm-10/bin/../include/c++/v1/memory:2616:20 in std::__1::unique_ptr<WalletDatabase, std::__1::default_delete<WalletDatabase> >::reset(WalletDatabase*)\n```\n\nhttps://cirrus-ci.com/task/5621550420328448?command=ci#L4781",https://github.com/bitcoin/bitcoin/pull/19602#issuecomment-759992266,759992266,
laanwj,2021-09-09 12:49:22,"Adding to the 23.0 milestone, I think it would be good to have optional migration in as soon as possible.",https://github.com/bitcoin/bitcoin/pull/19602#issuecomment-916061137,916061137,
prayank23,2021-09-10 00:21:26,Concept ACK,https://github.com/bitcoin/bitcoin/pull/19602#issuecomment-916530840,916530840,
katesalazar,2021-09-26 11:12:28,"What's the minimum wallet version this tool will support?\n",https://github.com/bitcoin/bitcoin/pull/19602#issuecomment-927286673,927286673,
achow101,2021-09-27 22:29:17,"> What's the minimum wallet version this tool will support?\n\nThe minimum that can be opened currently.",https://github.com/bitcoin/bitcoin/pull/19602#issuecomment-928369685,928369685,
achow101,2021-11-09 20:42:44,Rebased,https://github.com/bitcoin/bitcoin/pull/19602#issuecomment-964526359,964526359,
sipa,2021-11-23 21:22:59,"> and a single key combo for the seed (the seed is a valid key that we can receive coins at!)\n\nðŸ¤¦\n\nNice catch.",https://github.com/bitcoin/bitcoin/pull/19602#issuecomment-977180488,977180488,
MarcoFalke,2020-08-14 12:17:06,nit: might be good to use the non-deprecated constructor to avoid having to change this again. See e.g. #19528,https://github.com/bitcoin/bitcoin/pull/19602#discussion_r470588563,470588563,src/wallet/rpcwallet.cpp
achow101,2020-08-31 17:53:53,"Getting a build error when I try to do this:\n\n```wallet/rpcwallet.cpp:4280:5: error: no matching constructor for initialization of 'const CRPCCommand'\n    { ""wallet"",             ""migratewallet"",                    &migratewallet,                 {} },\n    ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n./rpc/server.h:120:5: note: candidat",https://github.com/bitcoin/bitcoin/pull/19602#discussion_r480291494,480291494,src/wallet/rpcwallet.cpp
MarcoFalke,2020-08-31 18:27:35,"Not sure why. This diff compiles for me:\n\n```diff\ndiff --git a/src/wallet/rpcwallet.cpp b/src/wallet/rpcwallet.cpp\nindex cc89c4992b..1361955a4b 100644\n--- a/src/wallet/rpcwallet.cpp\n+++ b/src/wallet/rpcwallet.cpp\n@@ -4171,9 +4171,9 @@ static UniValue upgradewallet(const JSONRPCRequest& request)\n     return error.original;\n }\n \n-static UniValue migratewallet(const JSONRPCReque",https://github.com/bitcoin/bitcoin/pull/19602#discussion_r480309374,480309374,src/wallet/rpcwallet.cpp
achow101,2020-08-31 22:57:07,"Ah, I seem to have made a mistake somewhere.",https://github.com/bitcoin/bitcoin/pull/19602#discussion_r480453983,480453983,src/wallet/rpcwallet.cpp
adamjonas,2020-11-10 01:02:33,The linter is complaining this going unused.,https://github.com/bitcoin/bitcoin/pull/19602#discussion_r520218986,520218986,test/functional/wallet_migration.py
achow101,2020-11-10 01:07:49,Fixed.,https://github.com/bitcoin/bitcoin/pull/19602#discussion_r520220823,520220823,test/functional/wallet_migration.py
laanwj,2021-02-18 12:40:27,"This looks scary to me. Let's not delete the old wallet, but rename it. You know, just in case something with the migration didn't go well it's good to have a backup.",https://github.com/bitcoin/bitcoin/pull/19602#discussion_r578385022,578385022,src/wallet/wallet.cpp
achow101,2021-02-18 17:50:19,~20 lines earlier we make a backup of the wallet. So there is still a backup and we're just removing the original after it is backed up.,https://github.com/bitcoin/bitcoin/pull/19602#discussion_r578626248,578626248,src/wallet/wallet.cpp
laanwj,2021-02-18 18:29:56,"Okay, sounds good to me then.",https://github.com/bitcoin/bitcoin/pull/19602#discussion_r578653465,578653465,src/wallet/wallet.cpp
