[
  {
    "sha": "be8e1f8479ff46c99f97ac3e396736d36e5458c6",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiZThlMWY4NDc5ZmY0NmM5OWY5N2FjM2UzOTY3MzZkMzZlNTQ1OGM2",
    "commit": {
      "author": {
        "name": "Philip Kaufmann",
        "email": "phil.kaufmann@t-online.de",
        "date": "2012-11-18T10:58:32Z"
      },
      "committer": {
        "name": "Philip Kaufmann",
        "email": "phil.kaufmann@t-online.de",
        "date": "2012-11-18T13:10:26Z"
      },
      "message": "Bitcoin-Qt: fix crash on Windows caused by CDBEnv::EnvShutdown()\n\n- can be triggerd by just adding -proxy=crashme with 0.7.1\n- crash occured, when AppInit2() was left with return false; after the\n  first call to bitdb.open() (Step 6 in init)\n- this is caused by GetDataDir() or .string() in CDBEnv::EnvShutdown()\n  called via the bitdb global destructor\n- init fDbEnvInit and fMockDb to false in CDBEnv::CDBEnv()",
      "tree": {
        "sha": "a300ef46ace1eeab970fe56b3976ced4e39f1a82",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a300ef46ace1eeab970fe56b3976ced4e39f1a82"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/be8e1f8479ff46c99f97ac3e396736d36e5458c6",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/be8e1f8479ff46c99f97ac3e396736d36e5458c6",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/be8e1f8479ff46c99f97ac3e396736d36e5458c6",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/be8e1f8479ff46c99f97ac3e396736d36e5458c6/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "4725e96a3aaa4dd602bd356390d190c6777c3a60",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4725e96a3aaa4dd602bd356390d190c6777c3a60",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/4725e96a3aaa4dd602bd356390d190c6777c3a60"
      }
    ],
    "stats": {
      "total": 8,
      "additions": 6,
      "deletions": 2
    },
    "files": [
      {
        "sha": "94629f3cadbccc55e586d68917534059794ab2a0",
        "filename": "src/db.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 2,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/be8e1f8479ff46c99f97ac3e396736d36e5458c6/src/db.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/be8e1f8479ff46c99f97ac3e396736d36e5458c6/src/db.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/db.cpp?ref=be8e1f8479ff46c99f97ac3e396736d36e5458c6",
        "patch": "@@ -38,11 +38,13 @@ void CDBEnv::EnvShutdown()\n     if (ret != 0)\n         printf(\"EnvShutdown exception: %s (%d)\\n\", DbEnv::strerror(ret), ret);\n     if (!fMockDb)\n-        DbEnv(0).remove(GetDataDir().string().c_str(), 0);\n+        DbEnv(0).remove(strPath.c_str(), 0);\n }\n \n CDBEnv::CDBEnv() : dbenv(DB_CXX_NO_EXCEPTIONS)\n {\n+    fDbEnvInit = false;\n+    fMockDb = false;\n }\n \n CDBEnv::~CDBEnv()\n@@ -63,6 +65,7 @@ bool CDBEnv::Open(const boost::filesystem::path& path)\n     if (fShutdown)\n         return false;\n \n+    strPath = path.string();\n     filesystem::path pathLogDir = path / \"database\";\n     filesystem::create_directory(pathLogDir);\n     filesystem::path pathErrorFile = path / \"db.log\";\n@@ -83,7 +86,7 @@ bool CDBEnv::Open(const boost::filesystem::path& path)\n     dbenv.set_flags(DB_AUTO_COMMIT, 1);\n     dbenv.set_flags(DB_TXN_WRITE_NOSYNC, 1);\n     dbenv.log_set_config(DB_LOG_AUTO_REMOVE, 1);\n-    int ret = dbenv.open(path.string().c_str(),\n+    int ret = dbenv.open(strPath.c_str(),\n                      DB_CREATE     |\n                      DB_INIT_LOCK  |\n                      DB_INIT_LOG   |"
      },
      {
        "sha": "9c01060a1c9f4f2a920f30690ead0544dadba8a9",
        "filename": "src/db.h",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/be8e1f8479ff46c99f97ac3e396736d36e5458c6/src/db.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/be8e1f8479ff46c99f97ac3e396736d36e5458c6/src/db.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/db.h?ref=be8e1f8479ff46c99f97ac3e396736d36e5458c6",
        "patch": "@@ -33,6 +33,7 @@ class CDBEnv\n private:\n     bool fDbEnvInit;\n     bool fMockDb;\n+    std::string strPath;\n \n     void EnvShutdown();\n "
      }
    ]
  }
]