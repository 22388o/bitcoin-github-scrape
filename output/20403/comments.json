[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/728246886",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#issuecomment-728246886",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20403",
    "id": 728246886,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyODI0Njg4Ng==",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?u=9791e96cd4268d48e3517bac41eaf2b1d09759fd&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-16T18:34:27Z",
    "updated_at": "2020-11-16T18:34:27Z",
    "author_association": "MEMBER",
    "body": "Code review ACK b95925c751fb97a1a17bf5a540ec06f0634ea72e",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/728246886/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/728248066",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#issuecomment-728248066",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20403",
    "id": 728248066,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyODI0ODA2Ng==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-16T18:36:45Z",
    "updated_at": "2020-11-17T20:38:16Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/728248066/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/728253158",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#issuecomment-728253158",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20403",
    "id": 728253158,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyODI1MzE1OA==",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-16T18:46:27Z",
    "updated_at": "2020-11-16T18:46:27Z",
    "author_association": "MEMBER",
    "body": "Removed the cast in UpgradeWallet() per `git diff b95925c 377fa31` (thanks!)\r\n```diff\r\n@@ -4128,7 +4128,7 @@ bool CWallet::UpgradeWallet(int& version, bilingual_str& error, std::vector<bili\r\n     // Permanently upgrade to the version\r\n     const WalletFeature new_version{GetClosestWalletFeature(version)};\r\n     SetMinVersion(new_version);\r\n-    version = static_cast<int>(new_version); // return actual updated version\r\n+    version = new_version; // return actual updated version\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/728253158/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/728255170",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#issuecomment-728255170",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20403",
    "id": 728255170,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyODI1NTE3MA==",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?u=9791e96cd4268d48e3517bac41eaf2b1d09759fd&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-16T18:50:23Z",
    "updated_at": "2020-11-16T18:50:23Z",
    "author_association": "MEMBER",
    "body": "ACK 377fa31",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/728255170/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/729057297",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#issuecomment-729057297",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20403",
    "id": 729057297,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyOTA1NzI5Nw==",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-17T16:50:19Z",
    "updated_at": "2020-11-17T16:50:19Z",
    "author_association": "MEMBER",
    "body": "Rebased after the merge of #20139 and addressed https://github.com/bitcoin/bitcoin/pull/20403#discussion_r524992713 with 877aba836ec48bfa881ec0dd90299015a3c27cce.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/729057297/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/729655687",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#issuecomment-729655687",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20403",
    "id": 729655687,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyOTY1NTY4Nw==",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-18T12:49:06Z",
    "updated_at": "2020-11-18T12:50:01Z",
    "author_association": "MEMBER",
    "body": "Found an edge case bug in the first commit, \"wallet: enable CWallet::UpgradeWallet to return updated version\", and the fix led to a simpler implementation.\r\n\r\nFixed two tests in the third commit, \"wallet: fix and improve upgradewallet result responses\"; thanks @MarcoFalke for catching one of them. The other one led to seeing the edge case bug.\r\n\r\nRe-verified build and the `wallet_upgradewallet.py` test at each commit.\r\n\r\n<details><summary>Diff: <code>git diff dfec0a8 25909e6</code></summary><p>\r\n\r\n```diff\r\njon@purity:~/projects/bitcoin/bitcoin (upgradewallet-improvements)$ git diff dfec0a8 25909e6\r\ndiff --git a/src/wallet/wallet.cpp b/src/wallet/wallet.cpp\r\nindex 17631c58e7..10a7a07ee7 100644\r\n--- a/src/wallet/wallet.cpp\r\n+++ b/src/wallet/wallet.cpp\r\n@@ -4127,15 +4127,15 @@ bool CWallet::UpgradeWallet(int& version, bilingual_str& error)\r\n     }\r\n \r\n     // Permanently upgrade to the version\r\n-    const WalletFeature new_version{GetClosestWalletFeature(version)};\r\n-    SetMinVersion(new_version);\r\n-    version = new_version; // return actual updated version\r\n+    SetMinVersion(GetClosestWalletFeature(version));\r\n \r\n     for (auto spk_man : GetActiveScriptPubKeyMans()) {\r\n         if (!spk_man->Upgrade(prev_version, version, error)) {\r\n             return false;\r\n         }\r\n     }\r\n+\r\n+    version = GetVersion(); // return actual updated version\r\n     return true;\r\n }\r\n \r\ndiff --git a/test/functional/wallet_upgradewallet.py b/test/functional/wallet_upgradewallet.py\r\nindex cec3dd2b6d..7cae913fa1 100755\r\n--- a/test/functional/wallet_upgradewallet.py\r\n+++ b/test/functional/wallet_upgradewallet.py\r\n@@ -90,10 +90,10 @@ class UpgradeWalletTest(BitcoinTestFramework):\r\n             v16_3_node.submitblock(b)\r\n         assert_equal(v16_3_node.getblockcount(), to_height)\r\n \r\n-    def test_upgradewallet(self, wallet, previous_version, requested_version, unchanged=False):\r\n-        new_version = previous_version if unchanged else requested_version\r\n+    def test_upgradewallet(self, wallet, previous_version, requested_version, expected_version=None, no_arg=False, unchanged=False):\r\n+        new_version = previous_version if unchanged else expected_version if expected_version else requested_version\r\n         assert_equal(wallet.getwalletinfo()[\"walletversion\"], previous_version)\r\n-        assert_equal(wallet.upgradewallet(requested_version),\r\n+        assert_equal(wallet.upgradewallet() if no_arg else wallet.upgradewallet(requested_version),\r\n             {\r\n                 \"wallet_name\": \"\",\r\n                 \"previous_version\": previous_version,\r\n@@ -182,7 +182,7 @@ class UpgradeWalletTest(BitcoinTestFramework):\r\n         copy_v16()\r\n         wallet = node_master.get_wallet_rpc(self.default_wallet_name)\r\n         self.log.info(\"Test upgradewallet without version arguments\")\r\n-        self.test_upgradewallet(wallet, previous_version=159900, requested_version=169900)\r\n+        self.test_upgradewallet(wallet, previous_version=159900, requested_version=169900, no_arg=True)\r\n         # wallet should still contain the same balance\r\n         assert_equal(wallet.getbalance(), v16_3_balance)\r\n \r\n@@ -342,7 +342,7 @@ class UpgradeWalletTest(BitcoinTestFramework):\r\n         old_kvs = dump_bdb_kv(node_master_wallet)\r\n         defaultkey = old_kvs[b'\\x0adefaultkey']\r\n         self.log.info(\"Upgrade the wallet. Should still have the same default key.\")\r\n-        self.test_upgradewallet(wallet, previous_version=139900, requested_version=169900)\r\n+        self.test_upgradewallet(wallet, previous_version=139900, requested_version=159900, expected_version=169900)\r\n         new_kvs = dump_bdb_kv(node_master_wallet)\r\n         up_defaultkey = new_kvs[b'\\x0adefaultkey']\r\n         assert_equal(defaultkey, up_defaultkey)\r\n```\r\n</p></details>\r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/729655687/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/729754336",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#issuecomment-729754336",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20403",
    "id": 729754336,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyOTc1NDMzNg==",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-18T15:27:10Z",
    "updated_at": "2020-11-18T15:27:10Z",
    "author_association": "MEMBER",
    "body": "Dropped the first commit to call `GetVersion()` in `RPCHelpMan upgradewallet()`.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/729754336/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/730202907",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#issuecomment-730202907",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20403",
    "id": 730202907,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMDIwMjkwNw==",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-19T08:08:46Z",
    "updated_at": "2020-11-19T08:08:46Z",
    "author_association": "MEMBER",
    "body": "Pulled in #20420.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/730202907/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/730576312",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#issuecomment-730576312",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20403",
    "id": 730576312,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMDU3NjMxMg==",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?u=9791e96cd4268d48e3517bac41eaf2b1d09759fd&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-19T19:05:32Z",
    "updated_at": "2020-11-19T19:05:32Z",
    "author_association": "MEMBER",
    "body": "ACK  3eb6f8b",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/730576312/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/733661230",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#issuecomment-733661230",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20403",
    "id": 733661230,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMzY2MTIzMA==",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-25T11:53:05Z",
    "updated_at": "2020-11-25T11:53:05Z",
    "author_association": "MEMBER",
    "body": "Backported in #20490",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/733661230/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/524486828",
    "pull_request_review_id": 531597413,
    "id": 524486828,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQ4NjgyOA==",
    "diff_hunk": "@@ -4126,7 +4126,9 @@ bool CWallet::UpgradeWallet(int version, bilingual_str& error, std::vector<bilin\n     }\n \n     // Permanently upgrade to the version\n-    SetMinVersion(GetClosestWalletFeature(version));\n+    const WalletFeature new_version{GetClosestWalletFeature(version)};\n+    SetMinVersion(new_version);\n+    version = static_cast<int>(new_version); // return actual updated version",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 16,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "cabea155570ceeae807895a7576b474fdab4e572",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Is `static_cast` necessary here? `WalletFeature` should already be an int.",
    "created_at": "2020-11-16T18:34:01Z",
    "updated_at": "2020-11-19T19:03:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r524486828",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/524486828"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r524486828"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/524486828/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4131,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/524489680",
    "pull_request_review_id": 531600963,
    "id": 524489680,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQ4OTY4MA==",
    "diff_hunk": "@@ -4126,7 +4126,9 @@ bool CWallet::UpgradeWallet(int version, bilingual_str& error, std::vector<bilin\n     }\n \n     // Permanently upgrade to the version\n-    SetMinVersion(GetClosestWalletFeature(version));\n+    const WalletFeature new_version{GetClosestWalletFeature(version)};\n+    SetMinVersion(new_version);\n+    version = static_cast<int>(new_version); // return actual updated version",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 16,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "cabea155570ceeae807895a7576b474fdab4e572",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Oh you're right, looks like we can just do `version = new_version` here. Will test a push without the cast. Thanks!",
    "created_at": "2020-11-16T18:38:51Z",
    "updated_at": "2020-11-19T19:03:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r524489680",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/524489680"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r524489680"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/524489680/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4131,
    "side": "RIGHT",
    "in_reply_to_id": 524486828
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/524992713",
    "pull_request_review_id": 532154490,
    "id": 524992713,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDk5MjcxMw==",
    "diff_hunk": "@@ -4475,12 +4479,26 @@ static RPCHelpMan upgradewallet()\n         version = request.params[0].get_int();\n     }\n \n+    std::string result;\n     bilingual_str error;\n     std::vector<bilingual_str> warnings;\n+    const int previous_version{pwallet->GetVersion()};\n+\n     if (!pwallet->UpgradeWallet(version, error, warnings)) {\n         throw JSONRPCError(RPC_WALLET_ERROR, error.original);\n+    } else if (version == previous_version) {\n+        result = \"wallet version unchanged\";\n+    } else {\n+        result = strprintf(\"wallet upgraded successfully from version %i to version %i\", previous_version, version);\n     }\n+\n     UniValue obj(UniValue::VOBJ);\n+    obj.pushKV(\"wallet_name\", pwallet->GetName());\n+    obj.pushKV(\"previous_version\", previous_version);\n+    obj.pushKV(\"current_version\", version);\n+    if (!result.empty()) {\n+        obj.pushKV(\"result\", result);\n+    }\n     if (!error.empty()) {\n         obj.pushKV(\"error\", error.original);",
    "path": "src/wallet/rpcwallet.cpp",
    "position": 58,
    "original_position": 46,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "377fa31c0e5515350ff3e6917fd7e09653c7ebd2",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "It looks like this is dead code, and always has been.\r\n\r\nIt would be easier to have one way to deal with errors. Either return them as `JSONRPCError` or as `{\"error\":...}`, but not both. Also, the error approach should be documented.",
    "created_at": "2020-11-17T09:08:54Z",
    "updated_at": "2020-11-19T19:03:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r524992713",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/524992713"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r524992713"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/524992713/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 4503,
    "original_line": 4503,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525006514",
    "pull_request_review_id": 532172105,
    "id": 525006514,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTAwNjUxNA==",
    "diff_hunk": "@@ -4475,12 +4479,26 @@ static RPCHelpMan upgradewallet()\n         version = request.params[0].get_int();\n     }\n \n+    std::string result;\n     bilingual_str error;\n     std::vector<bilingual_str> warnings;\n+    const int previous_version{pwallet->GetVersion()};\n+\n     if (!pwallet->UpgradeWallet(version, error, warnings)) {\n         throw JSONRPCError(RPC_WALLET_ERROR, error.original);\n+    } else if (version == previous_version) {\n+        result = \"wallet version unchanged\";\n+    } else {\n+        result = strprintf(\"wallet upgraded successfully from version %i to version %i\", previous_version, version);\n     }\n+\n     UniValue obj(UniValue::VOBJ);\n+    obj.pushKV(\"wallet_name\", pwallet->GetName());\n+    obj.pushKV(\"previous_version\", previous_version);\n+    obj.pushKV(\"current_version\", version);\n+    if (!result.empty()) {\n+        obj.pushKV(\"result\", result);\n+    }\n     if (!error.empty()) {\n         obj.pushKV(\"error\", error.original);",
    "path": "src/wallet/rpcwallet.cpp",
    "position": 58,
    "original_position": 46,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "377fa31c0e5515350ff3e6917fd7e09653c7ebd2",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yes, I plan to have a look at this later today. That's the second part of my review feedback from #20282.\n\nIn #20391 I proposed returning an error field rather than raising an RPC error for this type of errors but wasn't sure which is preferred.",
    "created_at": "2020-11-17T09:29:19Z",
    "updated_at": "2020-11-19T19:03:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525006514",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525006514"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525006514"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525006514/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 4503,
    "original_line": 4503,
    "side": "RIGHT",
    "in_reply_to_id": 524992713
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525025383",
    "pull_request_review_id": 532195734,
    "id": 525025383,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTAyNTM4Mw==",
    "diff_hunk": "@@ -4475,12 +4479,26 @@ static RPCHelpMan upgradewallet()\n         version = request.params[0].get_int();\n     }\n \n+    std::string result;\n     bilingual_str error;\n     std::vector<bilingual_str> warnings;\n+    const int previous_version{pwallet->GetVersion()};\n+\n     if (!pwallet->UpgradeWallet(version, error, warnings)) {\n         throw JSONRPCError(RPC_WALLET_ERROR, error.original);\n+    } else if (version == previous_version) {\n+        result = \"wallet version unchanged\";\n+    } else {\n+        result = strprintf(\"wallet upgraded successfully from version %i to version %i\", previous_version, version);\n     }\n+\n     UniValue obj(UniValue::VOBJ);\n+    obj.pushKV(\"wallet_name\", pwallet->GetName());\n+    obj.pushKV(\"previous_version\", previous_version);\n+    obj.pushKV(\"current_version\", version);\n+    if (!result.empty()) {\n+        obj.pushKV(\"result\", result);\n+    }\n     if (!error.empty()) {\n         obj.pushKV(\"error\", error.original);",
    "path": "src/wallet/rpcwallet.cpp",
    "position": 58,
    "original_position": 46,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "377fa31c0e5515350ff3e6917fd7e09653c7ebd2",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think either is fine as long as it is documented and consistent. An RPCError makes sense when the return object would otherwise be empty and would have to omit a lot of optional fields, except for the error.",
    "created_at": "2020-11-17T09:56:36Z",
    "updated_at": "2020-11-19T19:03:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525025383",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525025383"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525025383"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525025383/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 4503,
    "original_line": 4503,
    "side": "RIGHT",
    "in_reply_to_id": 524992713
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525134613",
    "pull_request_review_id": 532335185,
    "id": 525134613,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTEzNDYxMw==",
    "diff_hunk": "@@ -4475,12 +4479,26 @@ static RPCHelpMan upgradewallet()\n         version = request.params[0].get_int();\n     }\n \n+    std::string result;\n     bilingual_str error;\n     std::vector<bilingual_str> warnings;\n+    const int previous_version{pwallet->GetVersion()};\n+\n     if (!pwallet->UpgradeWallet(version, error, warnings)) {\n         throw JSONRPCError(RPC_WALLET_ERROR, error.original);\n+    } else if (version == previous_version) {\n+        result = \"wallet version unchanged\";\n+    } else {\n+        result = strprintf(\"wallet upgraded successfully from version %i to version %i\", previous_version, version);\n     }\n+\n     UniValue obj(UniValue::VOBJ);\n+    obj.pushKV(\"wallet_name\", pwallet->GetName());\n+    obj.pushKV(\"previous_version\", previous_version);\n+    obj.pushKV(\"current_version\", version);\n+    if (!result.empty()) {\n+        obj.pushKV(\"result\", result);\n+    }\n     if (!error.empty()) {\n         obj.pushKV(\"error\", error.original);",
    "path": "src/wallet/rpcwallet.cpp",
    "position": 58,
    "original_position": 46,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "377fa31c0e5515350ff3e6917fd7e09653c7ebd2",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Proposing this:\r\n```\r\n$ ./src/bitcoin-cli -signet -rpcwallet=\"blank\" upgradewallet 5\r\n{\r\n  \"wallet_name\": \"blank\",\r\n  \"previous_version\": 169900,\r\n  \"current_version\": 169900,\r\n  \"error\": \"Cannot downgrade wallet from version 169900 to version 5\"\r\n}\r\n```\r\n",
    "created_at": "2020-11-17T13:00:02Z",
    "updated_at": "2020-11-19T19:03:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525134613",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525134613"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525134613"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525134613/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 4503,
    "original_line": 4503,
    "side": "RIGHT",
    "in_reply_to_id": 524992713
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525136126",
    "pull_request_review_id": 532337276,
    "id": 525136126,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTEzNjEyNg==",
    "diff_hunk": "@@ -4475,12 +4479,26 @@ static RPCHelpMan upgradewallet()\n         version = request.params[0].get_int();\n     }\n \n+    std::string result;\n     bilingual_str error;\n     std::vector<bilingual_str> warnings;\n+    const int previous_version{pwallet->GetVersion()};\n+\n     if (!pwallet->UpgradeWallet(version, error, warnings)) {\n         throw JSONRPCError(RPC_WALLET_ERROR, error.original);\n+    } else if (version == previous_version) {\n+        result = \"wallet version unchanged\";\n+    } else {\n+        result = strprintf(\"wallet upgraded successfully from version %i to version %i\", previous_version, version);\n     }\n+\n     UniValue obj(UniValue::VOBJ);\n+    obj.pushKV(\"wallet_name\", pwallet->GetName());\n+    obj.pushKV(\"previous_version\", previous_version);\n+    obj.pushKV(\"current_version\", version);\n+    if (!result.empty()) {\n+        obj.pushKV(\"result\", result);\n+    }\n     if (!error.empty()) {\n         obj.pushKV(\"error\", error.original);",
    "path": "src/wallet/rpcwallet.cpp",
    "position": 58,
    "original_position": 46,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "377fa31c0e5515350ff3e6917fd7e09653c7ebd2",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "(currently that returns):\r\n```\r\n$ ./src/bitcoin-cli -signet -rpcwallet=\"blank\" upgradewallet 5\r\nerror code: -4\r\nerror message:\r\nCannot downgrade wallet\r\n```\r\n",
    "created_at": "2020-11-17T13:02:38Z",
    "updated_at": "2020-11-19T19:03:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525136126",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525136126"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525136126"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525136126/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 4503,
    "original_line": 4503,
    "side": "RIGHT",
    "in_reply_to_id": 524992713
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525316759",
    "pull_request_review_id": 532574322,
    "id": 525316759,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMxNjc1OQ==",
    "diff_hunk": "@@ -4475,12 +4479,26 @@ static RPCHelpMan upgradewallet()\n         version = request.params[0].get_int();\n     }\n \n+    std::string result;\n     bilingual_str error;\n     std::vector<bilingual_str> warnings;\n+    const int previous_version{pwallet->GetVersion()};\n+\n     if (!pwallet->UpgradeWallet(version, error, warnings)) {\n         throw JSONRPCError(RPC_WALLET_ERROR, error.original);\n+    } else if (version == previous_version) {\n+        result = \"wallet version unchanged\";\n+    } else {\n+        result = strprintf(\"wallet upgraded successfully from version %i to version %i\", previous_version, version);\n     }\n+\n     UniValue obj(UniValue::VOBJ);\n+    obj.pushKV(\"wallet_name\", pwallet->GetName());\n+    obj.pushKV(\"previous_version\", previous_version);\n+    obj.pushKV(\"current_version\", version);\n+    if (!result.empty()) {\n+        obj.pushKV(\"result\", result);\n+    }\n     if (!error.empty()) {\n         obj.pushKV(\"error\", error.original);",
    "path": "src/wallet/rpcwallet.cpp",
    "position": 58,
    "original_position": 46,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "377fa31c0e5515350ff3e6917fd7e09653c7ebd2",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done",
    "created_at": "2020-11-17T16:48:16Z",
    "updated_at": "2020-11-19T19:03:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525316759",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525316759"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525316759"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525316759/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 4503,
    "original_line": 4503,
    "side": "RIGHT",
    "in_reply_to_id": 524992713
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525319514",
    "pull_request_review_id": 532577949,
    "id": 525319514,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMxOTUxNA==",
    "diff_hunk": "@@ -4475,12 +4479,26 @@ static RPCHelpMan upgradewallet()\n         version = request.params[0].get_int();\n     }\n \n+    std::string result;\n     bilingual_str error;\n     std::vector<bilingual_str> warnings;\n+    const int previous_version{pwallet->GetVersion()};\n+\n     if (!pwallet->UpgradeWallet(version, error, warnings)) {\n         throw JSONRPCError(RPC_WALLET_ERROR, error.original);\n+    } else if (version == previous_version) {\n+        result = \"wallet version unchanged\";\n+    } else {\n+        result = strprintf(\"wallet upgraded successfully from version %i to version %i\", previous_version, version);\n     }\n+\n     UniValue obj(UniValue::VOBJ);\n+    obj.pushKV(\"wallet_name\", pwallet->GetName());\n+    obj.pushKV(\"previous_version\", previous_version);\n+    obj.pushKV(\"current_version\", version);\n+    if (!result.empty()) {\n+        obj.pushKV(\"result\", result);\n+    }\n     if (!error.empty()) {\n         obj.pushKV(\"error\", error.original);",
    "path": "src/wallet/rpcwallet.cpp",
    "position": 58,
    "original_position": 46,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "377fa31c0e5515350ff3e6917fd7e09653c7ebd2",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Let me know if there is anything needed WRT documenting the error approach.",
    "created_at": "2020-11-17T16:51:59Z",
    "updated_at": "2020-11-19T19:03:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525319514",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525319514"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525319514"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525319514/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 4503,
    "original_line": 4503,
    "side": "RIGHT",
    "in_reply_to_id": 524992713
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525328086",
    "pull_request_review_id": 532589316,
    "id": 525328086,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMyODA4Ng==",
    "diff_hunk": "@@ -4474,11 +4478,25 @@ static RPCHelpMan upgradewallet()\n     if (!request.params[0].isNull()) {\n         version = request.params[0].get_int();\n     }\n+    const int previous_version{pwallet->GetVersion()};\n+    std::string result;\n     bilingual_str error;\n-    if (!pwallet->UpgradeWallet(version, error)) {\n-        throw JSONRPCError(RPC_WALLET_ERROR, error.original);\n+\n+    if (pwallet->UpgradeWallet(version, error)) {\n+        if (version == previous_version) {\n+            result = \"Already at latest version. Wallet version unchanged.\";\n+        } else {\n+            result = strprintf(\"Wallet upgraded successfully from version %i to version %i.\", previous_version, version);\n+        }\n     }\n+\n     UniValue obj(UniValue::VOBJ);\n+    obj.pushKV(\"wallet_name\", pwallet->GetName());\n+    obj.pushKV(\"previous_version\", previous_version);\n+    obj.pushKV(\"current_version\", version);\n+    if (!result.empty()) {\n+        obj.pushKV(\"result\", result);\n+    }\n     if (!error.empty()) {",
    "path": "src/wallet/rpcwallet.cpp",
    "position": null,
    "original_position": 46,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "877aba836ec48bfa881ec0dd90299015a3c27cce",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\n    else { CHECK_NONFATAL(!error.empty());\r\n```",
    "created_at": "2020-11-17T17:02:29Z",
    "updated_at": "2020-11-19T19:03:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525328086",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525328086"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525328086"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525328086/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4500,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525329735",
    "pull_request_review_id": 532589316,
    "id": 525329735,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMyOTczNQ==",
    "diff_hunk": "@@ -4113,20 +4113,25 @@ bool CWallet::UpgradeWallet(int version, bilingual_str& error)\n     }\n     if (version < prev_version)\n     {\n-        error = _(\"Cannot downgrade wallet\");\n+        error = strprintf(_(\"Cannot downgrade wallet from version %i to version %i. Wallet version unchanged.\"), prev_version, version);\n+        version = prev_version;\n         return false;\n     }\n \n     LOCK(cs_wallet);\n \n     // Do not upgrade versions to any version between HD_SPLIT and FEATURE_PRE_SPLIT_KEYPOOL unless already supporting HD_SPLIT\n     if (!CanSupportFeature(FEATURE_HD_SPLIT) && version >= FEATURE_HD_SPLIT && version < FEATURE_PRE_SPLIT_KEYPOOL) {\n-        error = _(\"Cannot upgrade a non HD split wallet without upgrading to support pre split keypool. Please use version 169900 or no version specified.\");\n+        error = strprintf(_(\"Cannot upgrade a non HD split wallet from version %i to version %i without upgrading to support pre-split keypool. Please use version %i or no version specified.\"),",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 24,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "877aba836ec48bfa881ec0dd90299015a3c27cce",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "the translation shouldn't be changed here, if you want this to be backported",
    "created_at": "2020-11-17T17:04:29Z",
    "updated_at": "2020-11-19T19:03:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525329735",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525329735"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525329735"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525329735/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4125,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525341964",
    "pull_request_review_id": 532607160,
    "id": 525341964,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM0MTk2NA==",
    "diff_hunk": "@@ -4113,20 +4113,25 @@ bool CWallet::UpgradeWallet(int version, bilingual_str& error)\n     }\n     if (version < prev_version)\n     {\n-        error = _(\"Cannot downgrade wallet\");\n+        error = strprintf(_(\"Cannot downgrade wallet from version %i to version %i. Wallet version unchanged.\"), prev_version, version);\n+        version = prev_version;\n         return false;\n     }\n \n     LOCK(cs_wallet);\n \n     // Do not upgrade versions to any version between HD_SPLIT and FEATURE_PRE_SPLIT_KEYPOOL unless already supporting HD_SPLIT\n     if (!CanSupportFeature(FEATURE_HD_SPLIT) && version >= FEATURE_HD_SPLIT && version < FEATURE_PRE_SPLIT_KEYPOOL) {\n-        error = _(\"Cannot upgrade a non HD split wallet without upgrading to support pre split keypool. Please use version 169900 or no version specified.\");\n+        error = strprintf(_(\"Cannot upgrade a non HD split wallet from version %i to version %i without upgrading to support pre-split keypool. Please use version %i or no version specified.\"),",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 24,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "877aba836ec48bfa881ec0dd90299015a3c27cce",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Oh right (thanks!) and same for the translation just above as well, I suppose\r\n```diff\r\n-        error = _(\"Cannot downgrade wallet\");\r\n+        error = strprintf(_(\"Cannot downgrade wallet from version %i to version %i. Wallet version unchanged.\"), prev_version, version);\r\n```\r\n",
    "created_at": "2020-11-17T17:18:24Z",
    "updated_at": "2020-11-19T19:03:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525341964",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525341964"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525341964"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525341964/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4125,
    "side": "RIGHT",
    "in_reply_to_id": 525329735
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525369168",
    "pull_request_review_id": 532642044,
    "id": 525369168,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM2OTE2OA==",
    "diff_hunk": "@@ -4113,20 +4113,25 @@ bool CWallet::UpgradeWallet(int version, bilingual_str& error)\n     }\n     if (version < prev_version)\n     {\n-        error = _(\"Cannot downgrade wallet\");\n+        error = strprintf(_(\"Cannot downgrade wallet from version %i to version %i. Wallet version unchanged.\"), prev_version, version);\n+        version = prev_version;\n         return false;\n     }\n \n     LOCK(cs_wallet);\n \n     // Do not upgrade versions to any version between HD_SPLIT and FEATURE_PRE_SPLIT_KEYPOOL unless already supporting HD_SPLIT\n     if (!CanSupportFeature(FEATURE_HD_SPLIT) && version >= FEATURE_HD_SPLIT && version < FEATURE_PRE_SPLIT_KEYPOOL) {\n-        error = _(\"Cannot upgrade a non HD split wallet without upgrading to support pre split keypool. Please use version 169900 or no version specified.\");\n+        error = strprintf(_(\"Cannot upgrade a non HD split wallet from version %i to version %i without upgrading to support pre-split keypool. Please use version %i or no version specified.\"),",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 24,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "877aba836ec48bfa881ec0dd90299015a3c27cce",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "If you like the translation changes, you can put them into a separate commit and write \"not for backport\" in the commit body",
    "created_at": "2020-11-17T17:55:28Z",
    "updated_at": "2020-11-19T19:03:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525369168",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525369168"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525369168"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525369168/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4125,
    "side": "RIGHT",
    "in_reply_to_id": 525329735
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525400534",
    "pull_request_review_id": 532681081,
    "id": 525400534,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQwMDUzNA==",
    "diff_hunk": "@@ -4474,11 +4478,25 @@ static RPCHelpMan upgradewallet()\n     if (!request.params[0].isNull()) {\n         version = request.params[0].get_int();\n     }\n+    const int previous_version{pwallet->GetVersion()};\n+    std::string result;\n     bilingual_str error;\n-    if (!pwallet->UpgradeWallet(version, error)) {\n-        throw JSONRPCError(RPC_WALLET_ERROR, error.original);\n+\n+    if (pwallet->UpgradeWallet(version, error)) {\n+        if (version == previous_version) {\n+            result = \"Already at latest version. Wallet version unchanged.\";\n+        } else {\n+            result = strprintf(\"Wallet upgraded successfully from version %i to version %i.\", previous_version, version);\n+        }\n     }\n+\n     UniValue obj(UniValue::VOBJ);\n+    obj.pushKV(\"wallet_name\", pwallet->GetName());\n+    obj.pushKV(\"previous_version\", previous_version);\n+    obj.pushKV(\"current_version\", version);\n+    if (!result.empty()) {\n+        obj.pushKV(\"result\", result);\n+    }\n     if (!error.empty()) {",
    "path": "src/wallet/rpcwallet.cpp",
    "position": null,
    "original_position": 46,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "877aba836ec48bfa881ec0dd90299015a3c27cce",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks--done.",
    "created_at": "2020-11-17T18:43:45Z",
    "updated_at": "2020-11-19T19:03:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525400534",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525400534"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525400534"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525400534/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4500,
    "side": "RIGHT",
    "in_reply_to_id": 525328086
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525424342",
    "pull_request_review_id": 532712485,
    "id": 525424342,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQyNDM0Mg==",
    "diff_hunk": "@@ -4113,20 +4113,25 @@ bool CWallet::UpgradeWallet(int version, bilingual_str& error)\n     }\n     if (version < prev_version)\n     {\n-        error = _(\"Cannot downgrade wallet\");\n+        error = strprintf(_(\"Cannot downgrade wallet from version %i to version %i. Wallet version unchanged.\"), prev_version, version);\n+        version = prev_version;\n         return false;\n     }\n \n     LOCK(cs_wallet);\n \n     // Do not upgrade versions to any version between HD_SPLIT and FEATURE_PRE_SPLIT_KEYPOOL unless already supporting HD_SPLIT\n     if (!CanSupportFeature(FEATURE_HD_SPLIT) && version >= FEATURE_HD_SPLIT && version < FEATURE_PRE_SPLIT_KEYPOOL) {\n-        error = _(\"Cannot upgrade a non HD split wallet without upgrading to support pre split keypool. Please use version 169900 or no version specified.\");\n+        error = strprintf(_(\"Cannot upgrade a non HD split wallet from version %i to version %i without upgrading to support pre-split keypool. Please use version %i or no version specified.\"),",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 24,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "877aba836ec48bfa881ec0dd90299015a3c27cce",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done, thanks",
    "created_at": "2020-11-17T19:19:24Z",
    "updated_at": "2020-11-19T19:03:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525424342",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525424342"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525424342"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525424342/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4125,
    "side": "RIGHT",
    "in_reply_to_id": 525329735
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525884287",
    "pull_request_review_id": 533188211,
    "id": 525884287,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTg4NDI4Nw==",
    "diff_hunk": "@@ -158,40 +170,29 @@ def copy_split_hd():\n         self.restart_node(0)\n         copy_v16()\n         wallet = node_master.get_wallet_rpc(self.default_wallet_name)\n-        old_version = wallet.getwalletinfo()[\"walletversion\"]\n-\n-        # calling upgradewallet without version arguments\n-        # should return nothing if successful\n-        assert_equal(wallet.upgradewallet(), {})\n-        new_version = wallet.getwalletinfo()[\"walletversion\"]\n-        # upgraded wallet version should be greater than older one\n-        assert_greater_than(new_version, old_version)\n+        self.log.info(\"Test upgradewallet without version arguments\")\n+        self.test_upgradewallet(wallet, previous_version=159900, requested_version=169900)",
    "path": "test/functional/wallet_upgradewallet.py",
    "position": null,
    "original_position": 41,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "84efee1aa665d2c92257898aecd6ffcc383d5efe",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This is not testing what the log claims to test",
    "created_at": "2020-11-18T08:09:46Z",
    "updated_at": "2020-11-19T19:03:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525884287",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525884287"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525884287"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525884287/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 174,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525886052",
    "pull_request_review_id": 533191848,
    "id": 525886052,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTg4NjA1Mg==",
    "diff_hunk": "@@ -158,40 +170,29 @@ def copy_split_hd():\n         self.restart_node(0)\n         copy_v16()\n         wallet = node_master.get_wallet_rpc(self.default_wallet_name)\n-        old_version = wallet.getwalletinfo()[\"walletversion\"]\n-\n-        # calling upgradewallet without version arguments\n-        # should return nothing if successful\n-        assert_equal(wallet.upgradewallet(), {})\n-        new_version = wallet.getwalletinfo()[\"walletversion\"]\n-        # upgraded wallet version should be greater than older one\n-        assert_greater_than(new_version, old_version)\n+        self.log.info(\"Test upgradewallet without version arguments\")\n+        self.test_upgradewallet(wallet, previous_version=159900, requested_version=169900)",
    "path": "test/functional/wallet_upgradewallet.py",
    "position": null,
    "original_position": 41,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "84efee1aa665d2c92257898aecd6ffcc383d5efe",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Good catch ",
    "created_at": "2020-11-18T08:12:27Z",
    "updated_at": "2020-11-19T19:03:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525886052",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525886052"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525886052"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525886052/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 174,
    "side": "RIGHT",
    "in_reply_to_id": 525884287
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525887477",
    "pull_request_review_id": 533192579,
    "id": 525887477,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTg4NzQ3Nw==",
    "diff_hunk": "@@ -4113,20 +4113,25 @@ bool CWallet::UpgradeWallet(int version, bilingual_str& error)\n     }\n     if (version < prev_version)\n     {\n-        error = _(\"Cannot downgrade wallet\");\n+        error = strprintf(_(\"Cannot downgrade wallet from version %i to version %i. Wallet version unchanged.\"), prev_version, version);\n+        version = prev_version;\n         return false;\n     }\n \n     LOCK(cs_wallet);\n \n     // Do not upgrade versions to any version between HD_SPLIT and FEATURE_PRE_SPLIT_KEYPOOL unless already supporting HD_SPLIT\n     if (!CanSupportFeature(FEATURE_HD_SPLIT) && version >= FEATURE_HD_SPLIT && version < FEATURE_PRE_SPLIT_KEYPOOL) {\n-        error = _(\"Cannot upgrade a non HD split wallet without upgrading to support pre split keypool. Please use version 169900 or no version specified.\");\n+        error = strprintf(_(\"Cannot upgrade a non HD split wallet from version %i to version %i without upgrading to support pre-split keypool. Please use version %i or no version specified.\"),",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 24,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "877aba836ec48bfa881ec0dd90299015a3c27cce",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thought: do translated strings need to be static? I should look at the implementation.",
    "created_at": "2020-11-18T08:13:30Z",
    "updated_at": "2020-11-19T19:03:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525887477",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525887477"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525887477"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525887477/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4125,
    "side": "RIGHT",
    "in_reply_to_id": 525329735
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525889455",
    "pull_request_review_id": 533193680,
    "id": 525889455,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTg4OTQ1NQ==",
    "diff_hunk": "@@ -4113,20 +4113,25 @@ bool CWallet::UpgradeWallet(int version, bilingual_str& error)\n     }\n     if (version < prev_version)\n     {\n-        error = _(\"Cannot downgrade wallet\");\n+        error = strprintf(_(\"Cannot downgrade wallet from version %i to version %i. Wallet version unchanged.\"), prev_version, version);\n+        version = prev_version;\n         return false;\n     }\n \n     LOCK(cs_wallet);\n \n     // Do not upgrade versions to any version between HD_SPLIT and FEATURE_PRE_SPLIT_KEYPOOL unless already supporting HD_SPLIT\n     if (!CanSupportFeature(FEATURE_HD_SPLIT) && version >= FEATURE_HD_SPLIT && version < FEATURE_PRE_SPLIT_KEYPOOL) {\n-        error = _(\"Cannot upgrade a non HD split wallet without upgrading to support pre split keypool. Please use version 169900 or no version specified.\");\n+        error = strprintf(_(\"Cannot upgrade a non HD split wallet from version %i to version %i without upgrading to support pre-split keypool. Please use version %i or no version specified.\"),",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 24,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "877aba836ec48bfa881ec0dd90299015a3c27cce",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "They can only be literals, but may include format specifiers",
    "created_at": "2020-11-18T08:15:05Z",
    "updated_at": "2020-11-19T19:03:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525889455",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525889455"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525889455"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525889455/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4125,
    "side": "RIGHT",
    "in_reply_to_id": 525329735
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/526059121",
    "pull_request_review_id": 533409240,
    "id": 526059121,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjA1OTEyMQ==",
    "diff_hunk": "@@ -158,40 +170,29 @@ def copy_split_hd():\n         self.restart_node(0)\n         copy_v16()\n         wallet = node_master.get_wallet_rpc(self.default_wallet_name)\n-        old_version = wallet.getwalletinfo()[\"walletversion\"]\n-\n-        # calling upgradewallet without version arguments\n-        # should return nothing if successful\n-        assert_equal(wallet.upgradewallet(), {})\n-        new_version = wallet.getwalletinfo()[\"walletversion\"]\n-        # upgraded wallet version should be greater than older one\n-        assert_greater_than(new_version, old_version)\n+        self.log.info(\"Test upgradewallet without version arguments\")\n+        self.test_upgradewallet(wallet, previous_version=159900, requested_version=169900)",
    "path": "test/functional/wallet_upgradewallet.py",
    "position": null,
    "original_position": 41,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "84efee1aa665d2c92257898aecd6ffcc383d5efe",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Fixed",
    "created_at": "2020-11-18T12:46:24Z",
    "updated_at": "2020-11-19T19:03:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r526059121",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/526059121"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r526059121"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/526059121/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 174,
    "side": "RIGHT",
    "in_reply_to_id": 525884287
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/526063920",
    "pull_request_review_id": 533415587,
    "id": 526063920,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjA2MzkyMA==",
    "diff_hunk": "@@ -333,14 +341,15 @@ def copy_split_hd():\n         # Check the wallet has a default key initially\n         old_kvs = dump_bdb_kv(node_master_wallet)\n         defaultkey = old_kvs[b'\\x0adefaultkey']\n-        # Upgrade the wallet. Should still have the same default key\n-        wallet.upgradewallet(159900)\n+        self.log.info(\"Upgrade the wallet. Should still have the same default key.\")\n+        self.test_upgradewallet(wallet, previous_version=139900, requested_version=159900, expected_version=169900)",
    "path": "test/functional/wallet_upgradewallet.py",
    "position": null,
    "original_position": 148,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "25909e6701ed42ca67b50247727c84bfb5cb1f16",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "@achow101 sanity check, if current version is 139900 `FEATURE_HD`, and upgradewallet 159900 `FEATURE_NO_DEFAULT_KEY` is called, is the wallet actually upgrading to 169900 `FEATURE_PRE_SPLIT_KEYPOOL/FEATURE_LATEST` the expected behavior ?",
    "created_at": "2020-11-18T12:54:41Z",
    "updated_at": "2020-11-19T19:03:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r526063920",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/526063920"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r526063920"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/526063920/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 345,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/526143279",
    "pull_request_review_id": 533518488,
    "id": 526143279,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjE0MzI3OQ==",
    "diff_hunk": "@@ -4133,6 +4133,8 @@ bool CWallet::UpgradeWallet(int version, bilingual_str& error)\n             return false;\n         }\n     }\n+\n+    version = GetVersion(); // return actual updated version",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 14,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "2310fe9685246b0d505495ee98d38c82a1730293",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "in commit 2310fe9685246b0d505495ee98d38c82a1730293: would be a smaller diff and less complexity if this was moved to the caller, no?",
    "created_at": "2020-11-18T14:46:06Z",
    "updated_at": "2020-11-19T19:03:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r526143279",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/526143279"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r526143279"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/526143279/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4137,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/526150676",
    "pull_request_review_id": 533528196,
    "id": 526150676,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjE1MDY3Ng==",
    "diff_hunk": "@@ -4133,6 +4133,8 @@ bool CWallet::UpgradeWallet(int version, bilingual_str& error)\n             return false;\n         }\n     }\n+\n+    version = GetVersion(); // return actual updated version",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 14,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "2310fe9685246b0d505495ee98d38c82a1730293",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yes, I tried removing the first commit and just calling GetVersion() in `RPCHelpMan upgradewallet()` but the last test failed.\r\n\r\nLines 345, 96\r\nAssertionError: not({'wallet_name': '', 'previous_version': 139900, 'current_version': 169900, 'result': 'Wallet upgraded successfully from version 139900 to version 159900.'} == {'wallet_name': '', 'previous_version': 139900, 'current_version': 159900, 'result': 'Wallet upgraded successfully from version 139900 to version 159900.'})\r\n",
    "created_at": "2020-11-18T14:55:39Z",
    "updated_at": "2020-11-19T19:03:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r526150676",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/526150676"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r526150676"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/526150676/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4137,
    "side": "RIGHT",
    "in_reply_to_id": 526143279
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/526156133",
    "pull_request_review_id": 533535360,
    "id": 526156133,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjE1NjEzMw==",
    "diff_hunk": "@@ -4133,6 +4133,8 @@ bool CWallet::UpgradeWallet(int version, bilingual_str& error)\n             return false;\n         }\n     }\n+\n+    version = GetVersion(); // return actual updated version",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 14,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "2310fe9685246b0d505495ee98d38c82a1730293",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Hm, will try again.",
    "created_at": "2020-11-18T15:02:16Z",
    "updated_at": "2020-11-19T19:03:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r526156133",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/526156133"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r526156133"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/526156133/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4137,
    "side": "RIGHT",
    "in_reply_to_id": 526143279
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/526166042",
    "pull_request_review_id": 533548396,
    "id": 526166042,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjE2NjA0Mg==",
    "diff_hunk": "@@ -4133,6 +4133,8 @@ bool CWallet::UpgradeWallet(int version, bilingual_str& error)\n             return false;\n         }\n     }\n+\n+    version = GetVersion(); // return actual updated version",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 14,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "2310fe9685246b0d505495ee98d38c82a1730293",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I didn't update one of the version variables the first time. Seems good.",
    "created_at": "2020-11-18T15:14:41Z",
    "updated_at": "2020-11-19T19:03:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r526166042",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/526166042"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r526166042"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/526166042/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4137,
    "side": "RIGHT",
    "in_reply_to_id": 526143279
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/526218796",
    "pull_request_review_id": 533618348,
    "id": 526218796,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjIxODc5Ng==",
    "diff_hunk": "@@ -333,14 +341,15 @@ def copy_split_hd():\n         # Check the wallet has a default key initially\n         old_kvs = dump_bdb_kv(node_master_wallet)\n         defaultkey = old_kvs[b'\\x0adefaultkey']\n-        # Upgrade the wallet. Should still have the same default key\n-        wallet.upgradewallet(159900)\n+        self.log.info(\"Upgrade the wallet. Should still have the same default key.\")\n+        self.test_upgradewallet(wallet, previous_version=139900, requested_version=159900, expected_version=169900)",
    "path": "test/functional/wallet_upgradewallet.py",
    "position": null,
    "original_position": 148,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "25909e6701ed42ca67b50247727c84bfb5cb1f16",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Versions less than `FEATURE_HD_SPLIT` cannot upgrade to `FEATURE_HD_SPLIT` or `FEATURE_NO_DEFAULT_KEY`. They must upgrade to `FEATURE_PRE_SPLIT_KEYPOOL` at which time both the previous features will also be applied.\r\n\r\nIf a user specifies `FEATURE_NO_DEFAULT_KEY` on ` FEATURE_HD` wallet, we should probably give an error and tell the user they can't do that.\r\n\r\nEdit: This test is `FEATURE_HD_SPLIT`, not `FEATURE_HD`. I'm not sure why it jumps to `FEATURE_LATEST`.",
    "created_at": "2020-11-18T16:18:48Z",
    "updated_at": "2020-11-19T19:03:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r526218796",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/526218796"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r526218796"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/526218796/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 345,
    "side": "RIGHT",
    "in_reply_to_id": 526063920
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/526314740",
    "pull_request_review_id": 533742390,
    "id": 526314740,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjMxNDc0MA==",
    "diff_hunk": "@@ -333,14 +341,15 @@ def copy_split_hd():\n         # Check the wallet has a default key initially\n         old_kvs = dump_bdb_kv(node_master_wallet)\n         defaultkey = old_kvs[b'\\x0adefaultkey']\n-        # Upgrade the wallet. Should still have the same default key\n-        wallet.upgradewallet(159900)\n+        self.log.info(\"Upgrade the wallet. Should still have the same default key.\")\n+        self.test_upgradewallet(wallet, previous_version=139900, requested_version=159900, expected_version=169900)",
    "path": "test/functional/wallet_upgradewallet.py",
    "position": null,
    "original_position": 148,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "25909e6701ed42ca67b50247727c84bfb5cb1f16",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Found it. Here's a fix.\r\n\r\n```diff\r\ndiff --git a/src/wallet/scriptpubkeyman.cpp b/src/wallet/scriptpubkeyman.cpp\r\nindex d2e1be6402..7dbbf17302 100644\r\n--- a/src/wallet/scriptpubkeyman.cpp\r\n+++ b/src/wallet/scriptpubkeyman.cpp\r\n@@ -453,7 +453,7 @@ bool LegacyScriptPubKeyMan::Upgrade(int prev_version, int new_version, bilingual\r\n         hd_upgrade = true;\r\n     }\r\n     // Upgrade to HD chain split if necessary\r\n-    if (IsFeatureSupported(new_version, FEATURE_HD_SPLIT)) {\r\n+    if (!IsFeatureSupported(prev_version, FEATURE_HD_SPLIT) && IsFeatureSupported(new_version, FEATURE_HD_SPLIT)) {\r\n         WalletLogPrintf(\"Upgrading wallet to use HD chain split\\n\");\r\n         m_storage.SetMinVersion(FEATURE_PRE_SPLIT_KEYPOOL);\r\n         split_upgrade = FEATURE_HD_SPLIT > prev_version;\r\ndiff --git a/test/functional/wallet_upgradewallet.py b/test/functional/wallet_upgradewallet.py\r\nindex 7cae913fa1..fdd52ba574 100755\r\n--- a/test/functional/wallet_upgradewallet.py\r\n+++ b/test/functional/wallet_upgradewallet.py\r\n@@ -342,7 +342,7 @@ class UpgradeWalletTest(BitcoinTestFramework):\r\n         old_kvs = dump_bdb_kv(node_master_wallet)\r\n         defaultkey = old_kvs[b'\\x0adefaultkey']\r\n         self.log.info(\"Upgrade the wallet. Should still have the same default key.\")\r\n-        self.test_upgradewallet(wallet, previous_version=139900, requested_version=159900, expected_version=169900)\r\n+        self.test_upgradewallet(wallet, previous_version=139900, requested_version=159900, expected_version=159900)\r\n         new_kvs = dump_bdb_kv(node_master_wallet)\r\n         up_defaultkey = new_kvs[b'\\x0adefaultkey']\r\n         assert_equal(defaultkey, up_defaultkey)\r\n```\r\n\r\nThis particular change probably needs backport to 0.21, so I'll make a separate PR for it.",
    "created_at": "2020-11-18T18:11:50Z",
    "updated_at": "2020-11-19T19:03:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r526314740",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/526314740"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r526314740"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/526314740/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 345,
    "side": "RIGHT",
    "in_reply_to_id": 526063920
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/527077372",
    "pull_request_review_id": 534695605,
    "id": 527077372,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA3NzM3Mg==",
    "diff_hunk": "@@ -158,40 +171,29 @@ def copy_split_hd():\n         self.restart_node(0)\n         copy_v16()\n         wallet = node_master.get_wallet_rpc(self.default_wallet_name)\n-        old_version = wallet.getwalletinfo()[\"walletversion\"]\n-\n-        # calling upgradewallet without version arguments\n-        # should return nothing if successful\n-        assert_equal(wallet.upgradewallet(), {})\n-        new_version = wallet.getwalletinfo()[\"walletversion\"]\n-        # upgraded wallet version should be greater than older one\n-        assert_greater_than(new_version, old_version)\n+        self.log.info(\"Test upgradewallet without a version argument\")\n+        self.test_upgradewallet(wallet, previous_version=159900, expected_version=169900)\n         # wallet should still contain the same balance\n         assert_equal(wallet.getbalance(), v16_3_balance)\n \n         copy_non_hd()\n         wallet = node_master.get_wallet_rpc(self.default_wallet_name)\n         # should have no master key hash before conversion\n         assert_equal('hdseedid' in wallet.getwalletinfo(), False)\n-        # calling upgradewallet with explicit version number\n-        # should return nothing if successful\n-        assert_equal(wallet.upgradewallet(169900), {})\n-        new_version = wallet.getwalletinfo()[\"walletversion\"]\n-        # upgraded wallet should have version 169900\n-        assert_equal(new_version, 169900)\n+        self.log.info(\"Test upgradewallet with explicit version number\")\n+        self.test_upgradewallet(wallet, previous_version=60000, requested_version=169900)\n         # after conversion master key hash should be present\n         assert_is_hex_string(wallet.getwalletinfo()['hdseedid'])\n \n-        self.log.info('Intermediary versions don\\'t effect anything')\n+        self.log.info(\"Intermediary versions don't effect anything\")\n         copy_non_hd()\n         # Wallet starts with 60000\n         assert_equal(60000, wallet.getwalletinfo()['walletversion'])\n         wallet.unloadwallet()\n         before_checksum = sha256sum_file(node_master_wallet)\n         node_master.loadwallet('')\n-        # Can \"upgrade\" to 129999 which should have no effect on the wallet\n-        wallet.upgradewallet(129999)\n-        assert_equal(60000, wallet.getwalletinfo()['walletversion'])\n+        # Test an \"upgrade\" from 60000 to 129999 has no effect, as next version is 130000\n+        self.test_upgradewallet(wallet, previous_version=60000, requested_version=129900, expected_version=60000)",
    "path": "test/functional/wallet_upgradewallet.py",
    "position": null,
    "original_position": 73,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "4dc34408bfe8fa1c229d99a3d0d03a42c83ced69",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit 4dc34408bfe8fa1c229d99a3d0d03a42c83ced69 \"wallet: fix and improve upgradewallet result responses\"\r\n\r\n`requested_version` should be 129999, not 129900",
    "created_at": "2020-11-19T17:42:15Z",
    "updated_at": "2020-11-19T19:03:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r527077372",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/527077372"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r527077372"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/527077372/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 196,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/527079206",
    "pull_request_review_id": 534695605,
    "id": 527079206,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA3OTIwNg==",
    "diff_hunk": "@@ -333,8 +332,8 @@ def copy_split_hd():\n         # Check the wallet has a default key initially\n         old_kvs = dump_bdb_kv(node_master_wallet)\n         defaultkey = old_kvs[b'\\x0adefaultkey']\n-        # Upgrade the wallet. Should still have the same default key\n-        wallet.upgradewallet(159900)\n+        self.log.info(\"Upgrade the wallet. Should still have the same default key.\")\n+        self.test_upgradewallet(wallet, previous_version=139900, requested_version=159900)",
    "path": "test/functional/wallet_upgradewallet.py",
    "position": 149,
    "original_position": 114,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "4dc34408bfe8fa1c229d99a3d0d03a42c83ced69",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit 4dc34408bfe8fa1c229d99a3d0d03a42c83ced69 \"wallet: fix and improve upgradewallet result responses\"\r\n\r\nThe `assert_equal(wallet.getwalletinfo()[\"walletversion\"], 159900)` below can be removed now.",
    "created_at": "2020-11-19T17:45:00Z",
    "updated_at": "2020-11-19T19:03:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r527079206",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/527079206"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r527079206"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/527079206/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 346,
    "original_line": 346,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/527128305",
    "pull_request_review_id": 534760864,
    "id": 527128305,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzEyODMwNQ==",
    "diff_hunk": "@@ -158,40 +171,29 @@ def copy_split_hd():\n         self.restart_node(0)\n         copy_v16()\n         wallet = node_master.get_wallet_rpc(self.default_wallet_name)\n-        old_version = wallet.getwalletinfo()[\"walletversion\"]\n-\n-        # calling upgradewallet without version arguments\n-        # should return nothing if successful\n-        assert_equal(wallet.upgradewallet(), {})\n-        new_version = wallet.getwalletinfo()[\"walletversion\"]\n-        # upgraded wallet version should be greater than older one\n-        assert_greater_than(new_version, old_version)\n+        self.log.info(\"Test upgradewallet without a version argument\")\n+        self.test_upgradewallet(wallet, previous_version=159900, expected_version=169900)\n         # wallet should still contain the same balance\n         assert_equal(wallet.getbalance(), v16_3_balance)\n \n         copy_non_hd()\n         wallet = node_master.get_wallet_rpc(self.default_wallet_name)\n         # should have no master key hash before conversion\n         assert_equal('hdseedid' in wallet.getwalletinfo(), False)\n-        # calling upgradewallet with explicit version number\n-        # should return nothing if successful\n-        assert_equal(wallet.upgradewallet(169900), {})\n-        new_version = wallet.getwalletinfo()[\"walletversion\"]\n-        # upgraded wallet should have version 169900\n-        assert_equal(new_version, 169900)\n+        self.log.info(\"Test upgradewallet with explicit version number\")\n+        self.test_upgradewallet(wallet, previous_version=60000, requested_version=169900)\n         # after conversion master key hash should be present\n         assert_is_hex_string(wallet.getwalletinfo()['hdseedid'])\n \n-        self.log.info('Intermediary versions don\\'t effect anything')\n+        self.log.info(\"Intermediary versions don't effect anything\")\n         copy_non_hd()\n         # Wallet starts with 60000\n         assert_equal(60000, wallet.getwalletinfo()['walletversion'])\n         wallet.unloadwallet()\n         before_checksum = sha256sum_file(node_master_wallet)\n         node_master.loadwallet('')\n-        # Can \"upgrade\" to 129999 which should have no effect on the wallet\n-        wallet.upgradewallet(129999)\n-        assert_equal(60000, wallet.getwalletinfo()['walletversion'])\n+        # Test an \"upgrade\" from 60000 to 129999 has no effect, as next version is 130000\n+        self.test_upgradewallet(wallet, previous_version=60000, requested_version=129900, expected_version=60000)",
    "path": "test/functional/wallet_upgradewallet.py",
    "position": null,
    "original_position": 73,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "4dc34408bfe8fa1c229d99a3d0d03a42c83ced69",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Good catch, thanks. Done.",
    "created_at": "2020-11-19T19:03:50Z",
    "updated_at": "2020-11-19T19:03:50Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r527128305",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/527128305"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r527128305"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/527128305/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 196,
    "side": "RIGHT",
    "in_reply_to_id": 527077372
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/527128481",
    "pull_request_review_id": 534761077,
    "id": 527128481,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzEyODQ4MQ==",
    "diff_hunk": "@@ -333,8 +332,8 @@ def copy_split_hd():\n         # Check the wallet has a default key initially\n         old_kvs = dump_bdb_kv(node_master_wallet)\n         defaultkey = old_kvs[b'\\x0adefaultkey']\n-        # Upgrade the wallet. Should still have the same default key\n-        wallet.upgradewallet(159900)\n+        self.log.info(\"Upgrade the wallet. Should still have the same default key.\")\n+        self.test_upgradewallet(wallet, previous_version=139900, requested_version=159900)",
    "path": "test/functional/wallet_upgradewallet.py",
    "position": 149,
    "original_position": 114,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "4dc34408bfe8fa1c229d99a3d0d03a42c83ced69",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks for confirming that. Done.",
    "created_at": "2020-11-19T19:04:07Z",
    "updated_at": "2020-11-19T19:04:07Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r527128481",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/527128481"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r527128481"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/527128481/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 346,
    "original_line": 346,
    "side": "RIGHT",
    "in_reply_to_id": 527079206
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/529992162",
    "pull_request_review_id": 538043515,
    "id": 529992162,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTk5MjE2Mg==",
    "diff_hunk": "@@ -4214,7 +4214,7 @@ static RPCHelpMan sethdseed()\n \n     // Do not do anything to non-HD wallets\n     if (!pwallet->CanSupportFeature(FEATURE_HD)) {\n-        throw JSONRPCError(RPC_WALLET_ERROR, \"Cannot set a HD seed on a non-HD wallet. Use the upgradewallet RPC in order to upgrade a non-HD wallet to HD\");\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Cannot set an HD seed on a non-HD wallet. Use the upgradewallet RPC in order to upgrade a non-HD wallet to HD\");",
    "path": "src/wallet/rpcwallet.cpp",
    "position": 5,
    "original_position": 5,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "user": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "\"a\" is correct...",
    "created_at": "2020-11-24T23:17:19Z",
    "updated_at": "2020-11-24T23:21:29Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r529992162",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/529992162"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r529992162"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/529992162/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 4217,
    "original_line": 4217,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/530003033",
    "pull_request_review_id": 538048263,
    "id": 530003033,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDAwMzAzMw==",
    "diff_hunk": "@@ -4214,7 +4214,7 @@ static RPCHelpMan sethdseed()\n \n     // Do not do anything to non-HD wallets\n     if (!pwallet->CanSupportFeature(FEATURE_HD)) {\n-        throw JSONRPCError(RPC_WALLET_ERROR, \"Cannot set a HD seed on a non-HD wallet. Use the upgradewallet RPC in order to upgrade a non-HD wallet to HD\");\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Cannot set an HD seed on a non-HD wallet. Use the upgradewallet RPC in order to upgrade a non-HD wallet to HD\");",
    "path": "src/wallet/rpcwallet.cpp",
    "position": 5,
    "original_position": 5,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "https://www.referencepointsoftware.com/a-vs-an-before-an-abbreviation/",
    "created_at": "2020-11-24T23:28:41Z",
    "updated_at": "2020-11-24T23:28:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r530003033",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/530003033"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r530003033"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/530003033/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 4217,
    "original_line": 4217,
    "side": "RIGHT",
    "in_reply_to_id": 529992162
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/530307834",
    "pull_request_review_id": 538408343,
    "id": 530307834,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDMwNzgzNA==",
    "diff_hunk": "@@ -92,6 +90,32 @@ def dumb_sync_blocks(self):\n             v16_3_node.submitblock(b)\n         assert_equal(v16_3_node.getblockcount(), to_height)\n \n+    def test_upgradewallet(self, wallet, previous_version, requested_version=None, expected_version=None):",
    "path": "test/functional/wallet_upgradewallet.py",
    "position": 14,
    "original_position": 14,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit 99d56e357159c7154f69f28cb5587c5ca20d6594:\r\n\r\n```suggestion\r\n    def test_upgradewallet(self, wallet, *, previous_version, requested_version, expected_version=None):\r\n```\r\n\r\nCould force named args and pass requested_version in all cases for clarity. Only one call needs to be adjusted, I think.",
    "created_at": "2020-11-25T11:36:25Z",
    "updated_at": "2020-11-25T11:46:03Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r530307834",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/530307834"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r530307834"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/530307834/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 93,
    "original_line": 93,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/530312324",
    "pull_request_review_id": 538408343,
    "id": 530312324,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDMxMjMyNA==",
    "diff_hunk": "@@ -4475,11 +4479,27 @@ static RPCHelpMan upgradewallet()\n         version = request.params[0].get_int();\n     }\n     bilingual_str error;\n-    if (!pwallet->UpgradeWallet(version, error)) {\n-        throw JSONRPCError(RPC_WALLET_ERROR, error.original);\n+    const int previous_version{pwallet->GetVersion()};\n+    const bool wallet_upgraded{pwallet->UpgradeWallet(version, error)};\n+    const int current_version{pwallet->GetVersion()};\n+    std::string result;\n+\n+    if (wallet_upgraded) {\n+        if (previous_version == current_version) {\n+            result = \"Already at latest version. Wallet version unchanged.\";\n+        } else {\n+            result = strprintf(\"Wallet upgraded successfully from version %i to version %i.\", previous_version, current_version);\n+        }\n     }\n+\n     UniValue obj(UniValue::VOBJ);\n-    if (!error.empty()) {\n+    obj.pushKV(\"wallet_name\", pwallet->GetName());\n+    obj.pushKV(\"previous_version\", previous_version);\n+    obj.pushKV(\"current_version\", current_version);\n+    if (!result.empty()) {\n+        obj.pushKV(\"result\", result);\n+    } else {\n+        CHECK_NONFATAL(!error.empty());",
    "path": "src/wallet/rpcwallet.cpp",
    "position": 57,
    "original_position": 57,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "style nit ca8cd893bb56bf5d455154b0498b1f58f77d20ed:\r\n\r\nThis should check (before the if) that there is either an error or a result, but not both.\r\n\r\n```cpp\r\n\r\nCHECK_NONFATAL(error.empty != result.empty());",
    "created_at": "2020-11-25T11:44:31Z",
    "updated_at": "2020-11-25T11:46:03Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r530312324",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/530312324"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r530312324"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/530312324/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 4502,
    "original_line": 4502,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/530333145",
    "pull_request_review_id": 538440810,
    "id": 530333145,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDMzMzE0NQ==",
    "diff_hunk": "@@ -92,6 +90,32 @@ def dumb_sync_blocks(self):\n             v16_3_node.submitblock(b)\n         assert_equal(v16_3_node.getblockcount(), to_height)\n \n+    def test_upgradewallet(self, wallet, previous_version, requested_version=None, expected_version=None):",
    "path": "test/functional/wallet_upgradewallet.py",
    "position": 14,
    "original_position": 14,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> nit [99d56e3](https://github.com/bitcoin/bitcoin/commit/99d56e357159c7154f69f28cb5587c5ca20d6594):\r\n> \r\n> Could force named args and pass requested_version in all cases for clarity. Only one call needs to be adjusted, I think.\r\n\r\nThanks! Good idea.",
    "created_at": "2020-11-25T12:22:11Z",
    "updated_at": "2020-11-25T12:22:11Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r530333145",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/530333145"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r530333145"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/530333145/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 93,
    "original_line": 93,
    "side": "RIGHT",
    "in_reply_to_id": 530307834
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/530334298",
    "pull_request_review_id": 538442230,
    "id": 530334298,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDMzNDI5OA==",
    "diff_hunk": "@@ -4475,11 +4479,27 @@ static RPCHelpMan upgradewallet()\n         version = request.params[0].get_int();\n     }\n     bilingual_str error;\n-    if (!pwallet->UpgradeWallet(version, error)) {\n-        throw JSONRPCError(RPC_WALLET_ERROR, error.original);\n+    const int previous_version{pwallet->GetVersion()};\n+    const bool wallet_upgraded{pwallet->UpgradeWallet(version, error)};\n+    const int current_version{pwallet->GetVersion()};\n+    std::string result;\n+\n+    if (wallet_upgraded) {\n+        if (previous_version == current_version) {\n+            result = \"Already at latest version. Wallet version unchanged.\";\n+        } else {\n+            result = strprintf(\"Wallet upgraded successfully from version %i to version %i.\", previous_version, current_version);\n+        }\n     }\n+\n     UniValue obj(UniValue::VOBJ);\n-    if (!error.empty()) {\n+    obj.pushKV(\"wallet_name\", pwallet->GetName());\n+    obj.pushKV(\"previous_version\", previous_version);\n+    obj.pushKV(\"current_version\", current_version);\n+    if (!result.empty()) {\n+        obj.pushKV(\"result\", result);\n+    } else {\n+        CHECK_NONFATAL(!error.empty());",
    "path": "src/wallet/rpcwallet.cpp",
    "position": 57,
    "original_position": 57,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> style nit [ca8cd89](https://github.com/bitcoin/bitcoin/commit/ca8cd893bb56bf5d455154b0498b1f58f77d20ed):\r\n> \r\n> This should check (before the if) that there is either an error or a result, but not both.\r\n\r\nGood idea, that would be better.",
    "created_at": "2020-11-25T12:24:05Z",
    "updated_at": "2020-11-25T12:24:05Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r530334298",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/530334298"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r530334298"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/530334298/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 4502,
    "original_line": 4502,
    "side": "RIGHT",
    "in_reply_to_id": 530312324
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/531710908",
    "pull_request_review_id": 540115970,
    "id": 531710908,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTcxMDkwOA==",
    "diff_hunk": "@@ -92,6 +90,32 @@ def dumb_sync_blocks(self):\n             v16_3_node.submitblock(b)\n         assert_equal(v16_3_node.getblockcount(), to_height)\n \n+    def test_upgradewallet(self, wallet, previous_version, requested_version=None, expected_version=None):",
    "path": "test/functional/wallet_upgradewallet.py",
    "position": 14,
    "original_position": 14,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done in e915a2a2c87dad5beb68a175b21a07136bcc21ca",
    "created_at": "2020-11-27T17:32:34Z",
    "updated_at": "2020-11-27T17:32:34Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r531710908",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/531710908"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r531710908"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/531710908/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 93,
    "original_line": 93,
    "side": "RIGHT",
    "in_reply_to_id": 530307834
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/531710951",
    "pull_request_review_id": 540116031,
    "id": 531710951,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTcxMDk1MQ==",
    "diff_hunk": "@@ -4475,11 +4479,27 @@ static RPCHelpMan upgradewallet()\n         version = request.params[0].get_int();\n     }\n     bilingual_str error;\n-    if (!pwallet->UpgradeWallet(version, error)) {\n-        throw JSONRPCError(RPC_WALLET_ERROR, error.original);\n+    const int previous_version{pwallet->GetVersion()};\n+    const bool wallet_upgraded{pwallet->UpgradeWallet(version, error)};\n+    const int current_version{pwallet->GetVersion()};\n+    std::string result;\n+\n+    if (wallet_upgraded) {\n+        if (previous_version == current_version) {\n+            result = \"Already at latest version. Wallet version unchanged.\";\n+        } else {\n+            result = strprintf(\"Wallet upgraded successfully from version %i to version %i.\", previous_version, current_version);\n+        }\n     }\n+\n     UniValue obj(UniValue::VOBJ);\n-    if (!error.empty()) {\n+    obj.pushKV(\"wallet_name\", pwallet->GetName());\n+    obj.pushKV(\"previous_version\", previous_version);\n+    obj.pushKV(\"current_version\", current_version);\n+    if (!result.empty()) {\n+        obj.pushKV(\"result\", result);\n+    } else {\n+        CHECK_NONFATAL(!error.empty());",
    "path": "src/wallet/rpcwallet.cpp",
    "position": 57,
    "original_position": 57,
    "commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "original_commit_id": "3eb6f8b2e61c24a22ea9396d86672307845f35eb",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done in e915a2a2c87dad5beb68a175b21a07136bcc21ca",
    "created_at": "2020-11-27T17:32:42Z",
    "updated_at": "2020-11-27T17:32:43Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r531710951",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/531710951"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r531710951"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/531710951/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 4502,
    "original_line": 4502,
    "side": "RIGHT",
    "in_reply_to_id": 530312324
  }
]