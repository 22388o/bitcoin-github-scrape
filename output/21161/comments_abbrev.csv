ajtowns,2021-02-12 13:21:58,"This is currently giving me somewhat lower feerate estimates on mainnet -- 173sat/vb becomes 142sat/vb for 4 blocks, 82sat/vb becomes 65sat/vb for 25 blocks. Not sure if that's fixing a bug, or introducing a bug though -- I don't *think* it's noise, because I'm also seeing a reduction when running the estimates against the fixed fee_estimates dat I had in #13990.\n\nEDIT: at first glance looks l",https://github.com/bitcoin/bitcoin/pull/21161#issuecomment-778192028,778192028,
morcos,2021-02-12 15:59:22,"Nice find on the bug and I think you've more or less identified the problem (I think I recapped it below)\n\nHowever I believe there are 2 issues with your potential fix.\n1) I think there is a new quadratic behavior now where if there are consistently not enough transactions in the buckets, you'll count up all the buckets to determine that, and then again all the buckets except the top one and",https://github.com/bitcoin/bitcoin/pull/21161#issuecomment-778280467,778280467,
ajtowns,2021-02-13 02:14:03,"@morcos Yes, that makes sense! I think I'm only looking at each bucket once (`bucket` is always what I'm looking at, and it's only decremented never reset/incremented), so there shouldn't be quadratic behaviour -- though it was getting late so what was in my head may not match what was in my editor...\n\nAgree that the new code is ignoring high feerate failures now and that that is wrong; I thin",https://github.com/bitcoin/bitcoin/pull/21161#issuecomment-778546332,778546332,
ajtowns,2021-02-13 07:43:30,Updated -- I traded in my hatchet for a scalpel; think this should exactly fix the problem.,https://github.com/bitcoin/bitcoin/pull/21161#issuecomment-778578214,778578214,
ajtowns,2021-02-13 07:56:19,"> Problem recap:\n> Imagine only 2 buckets and an 85% threshold:\n> feerate: 100 sat/vb has 2/2 transactions confirmed within a target of 3 blocks (same within a target of 4 blocks.)\n> feerate: 150 sat/vb has 84/100 transactions confirmed within a target of 3 blocks and 85/100 transactions within 4 blocks.\n> \n> The estimate for 3-block target fails at 150 sat/vb but passes when you add in ",https://github.com/bitcoin/bitcoin/pull/21161#issuecomment-778579772,778579772,
jonatack,2021-02-15 17:41:58,"Concept ACK on initial, non-expert look and `test/functional/feature_fee_estimation.py --randomseed 108574360997204915` passes with this patch. I need to study this code more.",https://github.com/bitcoin/bitcoin/pull/21161#issuecomment-779369146,779369146,
morcos,2021-02-15 19:55:47,"Ah, perhaps I misread on the quadratic issues.   \n\nNot that it really matters, but I think both of our recaps of the problem were not quite right.  In the first part of your recap, the count for sufficient number of transactions resets when a passing bucket is found so 100 sat/vb would not be passing for a 4-block target.   but you are right that in my version the 3-block target would find the",https://github.com/bitcoin/bitcoin/pull/21161#issuecomment-779422357,779422357,
darosior,2021-02-20 11:56:33,"Don't have historical data but i've been running an `estimatesmartfee` (on 1, 3, 6, 12, 24, 48 and 100) every 15 seconds on both this branch and master for some time (~15 hours).\n\nHere are my findings so far, this branch seems to give constantly increasing and higher estimates and i believe there is definitely something wrong with estimates for large targets.\n\n## 1 block target\n![1_block",https://github.com/bitcoin/bitcoin/pull/21161#issuecomment-782614132,782614132,
meshcollider,2021-10-11 23:37:49,nit: `that meet`,https://github.com/bitcoin/bitcoin/pull/21161#discussion_r726646611,726646611,src/policy/fees.cpp
