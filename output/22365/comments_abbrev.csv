hebasto,2021-06-29 02:26:38,"> * riscv64 -> glibc 2.27\n> \n> * ppc64le -> glibc 2.24\n> \n> * aarch64 -> glibc 2.24\n> \n> * everything else -> glibc 2.17\n\nAs I [noted](https://gnusha.org/bitcoin-builds/2021-06-26.log) on IRC, there is no need to use actual glibc 2.17. The version 2.24 is enough, and it does _not_ introduce 2.17+ symbols in our release binaries.",https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-870177822,870177822,
DrahtBot,2021-06-29 09:30:39,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #21671 by dongcarl\n\nIf you consider this pull request important, please also help to review the conflicting pull request",https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-870436148,870436148,
sipa,2021-06-29 18:45:01,"> As I noted on IRC, there is no need to use actual glibc 2.17. The version 2.24 is enough, and it does not introduce 2.17+ symbols in our release binaries.\n\nI agree this is preferable. My understanding is that we've been using a more recent version than 2.17 for a long time already, and 2.17 is ancient. Sure, there is always a risk that some new function we start using, or a dependency change",https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-870830177,870830177,
dongcarl,2021-06-29 19:02:41,Updated to use `2.24` across the board (except for riscv64),https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-870841198,870841198,
fanquake,2021-06-30 08:55:07,"Concept ACK. As I mentioned on IRC, my preference was to update these together.",https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-871219574,871219574,
DrahtBot,2021-06-30 13:28:33,<!--9cd9c72976c961c55c7acef8f6ba82cd-->\n### Guix builds\n\n| File | commit a000cb013cc1104ddcd6431d5a9b89e90bde2593<br>(master) | commit 039e730f235a53f169b3ddcad96cde03eb9076bc<br>(master and this pull) |\n|--|--|--|\n| SKIPATTEST.TAG | [`e3b0c44298fc1c14...`](https://drahtbot.space/guix/bitcoin/bitcoin/a000cb013cc1104ddcd6431d5a9b89e90bde2593/SKIPATTEST.TAG) | [`e3b0c44298fc1c14...`](https://dr,https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-871405053,871405053,
fanquake,2021-07-01 13:12:25,Also please rebase this so at least #22348 is included. Could even base on top of #20980 if you wanted.,https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-872236002,872236002,
DrahtBot,2021-07-01 15:34:56,<!--9cd9c72976c961c55c7acef8f6ba82cd-->\n### Guix builds\n\n| File | commit 3fc20abab03d71a982d6fe9c47155834b256ab17<br>(master) | commit 1f0dd295d55ccd3d9d632687b965b99167b46c2e<br>(master and this pull) |\n|--|--|--|\n| SKIPATTEST.TAG | [`e3b0c44298fc1c14...`](https://drahtbot.space/guix/bitcoin/bitcoin/3fc20abab03d71a982d6fe9c47155834b256ab17/SKIPATTEST.TAG) | [`e3b0c44298fc1c14...`](https://dr,https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-872346168,872346168,
laanwj,2021-07-01 19:11:28,Concept ACK,https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-872486868,872486868,
sipa,2021-07-01 19:12:56,Concept ACK,https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-872487750,872487750,
dongcarl,2021-07-01 20:21:54,"Pushed ae820d6278...dc4137a60c\n- Made first commit message more descriptive\n- Added comments explaining `make-glibc-without-ssp`",https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-872526136,872526136,
fanquake,2021-07-02 05:21:59,"Guix Builds:\n```bash\nbash-5.1# find guix-build-$(git rev-parse --short=12 HEAD)/output/ -type f -print0 | env LC_ALL=C sort -z | xargs -r0 sha256sum\ne814d772d34b7950e3f455d1e8697692c168b68ed59de8a21d8f0010701abb34  guix-build-dc4137a60c99/output/aarch64-linux-gnu/SHA256SUMS.part\n9b8e8c9086f4e88091ba33896ab39ed6c582be9ea3836a81d273f85891e867c2  guix-build-dc4137a60c99/output/aarch64-linux-g",https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-872723973,872723973,
hebasto,2021-07-02 05:44:19,"#### Guix builds:\n```\n$ find guix-build-$(git rev-parse --short=12 HEAD)/output/ -type f -print0 | env LC_ALL=C sort -z | xargs -r0 sha256sum\ne814d772d34b7950e3f455d1e8697692c168b68ed59de8a21d8f0010701abb34  guix-build-dc4137a60c99/output/aarch64-linux-gnu/SHA256SUMS.part\n9b8e8c9086f4e88091ba33896ab39ed6c582be9ea3836a81d273f85891e867c2  guix-build-dc4137a60c99/output/aarch64-linux-gnu/bitc",https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-872733169,872733169,
hebasto,2021-07-02 05:52:24,"diff https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-872723973 .. https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-872733169\n```diff\n 4cf65bb741e8c0c16bca64369d4a2f1b620dad87b0c822ed42250bb73e98d613  guix-build-dc4137a60c99/output/powerpc64-linux-gnu/SHA256SUMS.part\n 42c51404f9aba0deb753c5f2119f58427a59000972377d541a4a18f42a802b6f  guix-build-dc4137a60c99/output/powerpc6",https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-872736001,872736001,
fanquake,2021-07-02 06:04:24,"> diff #22365 (comment) .. #22365 (comment)\n\nLooks like there is a difference in the ordering of the hashes in the SHA256SUMS.part files. \n\ni.e where `a.txt` is @hebasto's SHASUM part, and `b.txt` is mine:\n```diff\n--- a.txt\n+++ b.txt\n@@ -1,3 +1,3 @@\n fcdfd73f6d9e6411ae14a9c7095b805c4e833bcf8215059afd90e6ddaeae6374  dist-archive/bitcoin-dc4137a60c99.tar.gz\n-ff03008c30bf58db80c30",https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-872740724,872740724,
achow101,2021-07-02 16:43:16,"```\n$ find guix-build-$(git rev-parse --short=12 HEAD)/output/ -type f -print0 | env LC_ALL=C sort -z | xargs -r0 sha256sum\n8e353a7faa7cda974ea256f36af2ed6ea7d26d447ea858aee18073dfc4a5ebf3  guix-build-dc4137a60c99/output/aarch64-linux-gnu/SHA256SUMS.part\n9b8e8c9086f4e88091ba33896ab39ed6c582be9ea3836a81d273f85891e867c2  guix-build-dc4137a60c99/output/aarch64-linux-gnu/bitcoin-dc4137a60c99-aar",https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-873126646,873126646,
achow101,2021-07-02 16:49:07,"ACK dc4137a60c99979b89f75d2bddba96d043f387b8\n\nBuilt and verified using objdump that the binaries have the right symbol versions.",https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-873129737,873129737,
dongcarl,2021-07-02 18:13:07,"Added one new commit 647f7e5f1da1089d451f3c431efc635b8e87b064\n- Sort `SHA256SUMS.part`\n\n-----\n\nNote for followup: Perhaps add a ""print to stdout"" option to `guix-attest` for lightweight attestations/verifications (e.g. over GitHub)",https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-873174581,873174581,
achow101,2021-07-02 19:40:37,"```\nb0cc4097dcb0c7e432b5884868df56fdca12838164765dff6cfca9f46c50c09d  guix-build-647f7e5f1da1/output/aarch64-linux-gnu/SHA256SUMS.part\n6555ea52efaacd5ac62ef62e141cf12e9aab50b901fdf41591758ac2e822359e  guix-build-647f7e5f1da1/output/aarch64-linux-gnu/bitcoin-647f7e5f1da1-aarch64-linux-gnu-debug.tar.gz\n5b9c5e369b53fa02f0e9750f5aede71e989fb2c06537f40844d901db2f1a7b0c  guix-build-647f7e5f1da1/ou",https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-873220954,873220954,
DrahtBot,2021-07-03 04:46:07,<!--9cd9c72976c961c55c7acef8f6ba82cd-->\n### Guix builds\n\n| File | commit 7a49fdc58115845ece3a9890bf9498bee6b559de<br>(master) | commit c9976dc103fd94c7248cf607a45d5947d549da38<br>(master and this pull) |\n|--|--|--|\n| SKIPATTEST.TAG | [`e3b0c44298fc1c14...`](https://drahtbot.space/guix/bitcoin/bitcoin/7a49fdc58115845ece3a9890bf9498bee6b559de/SKIPATTEST.TAG) | [`e3b0c44298fc1c14...`](https://dr,https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-873344907,873344907,
hebasto,2021-07-03 09:14:31,"#### Guix builds:\n```\n$ find guix-build-$(git rev-parse --short=12 HEAD)/output/ -type f -print0 | env LC_ALL=C sort -z | xargs -r0 sha256sum\nb0cc4097dcb0c7e432b5884868df56fdca12838164765dff6cfca9f46c50c09d  guix-build-647f7e5f1da1/output/aarch64-linux-gnu/SHA256SUMS.part\n6555ea52efaacd5ac62ef62e141cf12e9aab50b901fdf41591758ac2e822359e  guix-build-647f7e5f1da1/output/aarch64-linux-gnu/bitc",https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-873375119,873375119,
hebasto,2021-07-03 17:42:23,"My only concern about this change [is](https://www.erisian.com.au/bitcoin-core-dev/log-2021-07-01.html#l-319):\n> \<luke-jr> hebasto: gitian should be fixed even if we use guix\n\nGitian builds on master does not pass symbol check. If both guix and gitian will be kept in 22.0 codebase, the latter must be fixed with [set of fixups](https://github.com/users/hebasto/projects/7). But applying chang",https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-873443374,873443374,
MarcoFalke,2021-07-03 18:07:09,I think we should remove gitian after branch-off. There is no need to maintain a script that isn't used.,https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-873447040,873447040,
fanquake,2021-07-04 04:01:58,"> But applying changes that fix gitian builds will make this PR redundant.\n\nThose changes don't make this PR redundant.\n\n> I think we should remove gitian after branch-off. \n\nIt really needs to be done before branch-off. As well as removing some of the back-compat machinery, and modifying where we run some of your symbol / security checks. There's no point leaving this half-broken for ",https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-873516883,873516883,
hebasto,2021-07-04 07:27:55,"> > But applying changes that fix gitian builds will make this PR redundant.\n> \n> Those changes don't make this PR redundant.\n\nFixing symbol compatibility for gitian fixes it for guix as well.\n\n\n\n> > I think we should remove gitian after branch-off.\n> \n> It really needs to be done before branch-off. As well as removing some of the back-compat machinery, and modifying where we r",https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-873537782,873537782,
fanquake,2021-07-04 07:34:12,"> Fixing symbol compatibility for gitian fixes it for guix as well.\n\nWhen Guix is being built against the correct glibc, which is what should be done, that's irrelevant, there is nothing to ""fix"". This would still be done even if you wanted to fix gitian, you'd just drop the compatibility option.",https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-873538495,873538495,
hebasto,2021-07-04 07:39:25,"> When Guix is being built against the correct glibc, which is what should be done, that's irrelevant, there is nothing to ""fix"".\n\nRight.\n\n> This would still be done even if you wanted to fix gitian, you'd just drop the compatibility option.\n\nUnfortunately, some of ""fixes"" touch dependencies (e.g., #22318), regardless of `--enable-glibc-back-compat` option.\n\n",https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-873539110,873539110,
fanquake,2021-07-05 01:20:41,"> Unfortunately, some of ""fixes"" touch dependencies (e.g., #22318), regardless of --enable-glibc-back-compat option.\n\nThat still doesn't make a difference for Guix, because the dependencies are being built in the same environment.",https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-873714735,873714735,
laanwj,2021-07-05 08:30:43,"I think there is some wisdom to keeping some of the gitian backwards compatibility code until we've successfully done a guix release. Even though it doesn't completely work at the moment, it's easier to fix it up than reintroduce it, in case we do need to do a gitian release for some reason.\nJust my opinion though.\n",https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-873916846,873916846,
fanquake,2021-07-05 12:48:37,"Guix builds:\n```bash\nb0cc4097dcb0c7e432b5884868df56fdca12838164765dff6cfca9f46c50c09d  guix-build-647f7e5f1da1/output/aarch64-linux-gnu/SHA256SUMS.part\n6555ea52efaacd5ac62ef62e141cf12e9aab50b901fdf41591758ac2e822359e  guix-build-647f7e5f1da1/output/aarch64-linux-gnu/bitcoin-647f7e5f1da1-aarch64-linux-gnu-debug.tar.gz\n5b9c5e369b53fa02f0e9750f5aede71e989fb2c06537f40844d901db2f1a7b0c  guix-bu",https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-874086431,874086431,
laanwj,2021-07-05 17:21:28,Posthumous ACK 647f7e5f1da1 (get the same build result as fanquake),https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-874248400,874248400,
Emzy,2021-07-07 10:45:43,"Guix builds:\n```\n$ find guix-build-$(git rev-parse --short=12 HEAD)/output/ -type f -print0 | env LC_ALL=C sort -z | xargs -r0\n sha256sum\nb0cc4097dcb0c7e432b5884868df56fdca12838164765dff6cfca9f46c50c09d  guix-build-647f7e5f1da1/output/aarch64-linux-gnu/SHA256SUMS.part\n6555ea52efaacd5ac62ef62e141cf12e9aab50b901fdf41591758ac2e822359e  guix-build-647f7e5f1da1/output/aarch64-linux-gnu/bitcoi",https://github.com/bitcoin/bitcoin/pull/22365#issuecomment-875499738,875499738,
MarcoFalke,2021-07-05 08:27:47,"Is there a source for this commit?\n\n\nhttps://sourceware.org/git/?p=glibc.git;a=commit;h=6b02af31e9a721bb15a11380cd22d53b621711f8 is a 404",https://github.com/bitcoin/bitcoin/pull/22365#discussion_r663738220,663738220,contrib/guix/patches/glibc-2.24-elfm-loadaddr-dynamic-rewrite.patch
MarcoFalke,2021-07-05 08:28:15,Same,https://github.com/bitcoin/bitcoin/pull/22365#discussion_r663738534,663738534,contrib/guix/patches/glibc-2.24-no-build-time-cxx-header-run.patch
fanquake,2021-07-05 10:04:34,This should be the correct link: https://sourceware.org/git/?p=glibc.git;a=commit;h=fc3e1337be1c6935ab58bd13520f97a535cf70cc,https://github.com/bitcoin/bitcoin/pull/22365#discussion_r663807262,663807262,contrib/guix/patches/glibc-2.24-no-build-time-cxx-header-run.patch
fanquake,2021-07-05 10:08:42,https://sourceware.org/git/?p=glibc.git;a=commit;h=a68ba2f3cd3cbe32c1f31e13c20ed13487727b32,https://github.com/bitcoin/bitcoin/pull/22365#discussion_r663809852,663809852,contrib/guix/patches/glibc-2.24-elfm-loadaddr-dynamic-rewrite.patch
