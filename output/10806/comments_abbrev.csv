sipa,2017-07-12T20:09:38Z,@theuni I'm confused why the old code wouldn't build the sse library with the correct flags?,https://github.com/bitcoin/bitcoin/pull/10806#issuecomment-314882382,314882382,
theuni,2017-07-13T05:28:52Z,"@sipa This addresses 2 things:\n\n1. Disables crc32 on platforms where the assembler can't handle it\n2. Enables crc32 if cflags/cxxflags are overridden but the intrinsics still work.\n\nI think 2 is what you're asking about? If so, it wouldn't work before because, even though the user has specified -msse4.2 (or -march=native, or whatever it takes to get the intrinsics working), our build wou",https://github.com/bitcoin/bitcoin/pull/10806#issuecomment-314974879,314974879,
laanwj,2017-07-13T13:00:41Z,Going to test.,https://github.com/bitcoin/bitcoin/pull/10806#issuecomment-315070681,315070681,
laanwj,2017-07-13T15:32:32Z,"Interesting. On OpenBSD 6.1:\n```\nconfigure:18285: checking whether C++ compiler accepts -msse4.2  \nconfigure:18304: eg++ -std=c++11 -c -g -O2 -Wall -Wextra -Wformat -Wvla -Wformat-security -Wno-unused-parameter -Werror -msse4.2  conftest.cpp >&5\nconfigure:18304: $? = 0\nconfigure:18313: result: yes\nconfigure:18326: checking for assembler crc32 support  \nconfigure:18351: eg++ -std=c++1",https://github.com/bitcoin/bitcoin/pull/10806#issuecomment-315114441,315114441,
theuni,2017-07-13T16:01:45Z,"@laanwj Grr, I checked an asm dump of the test to make sure that the crc32s are actually emitted, but it looks like I forgot to test with -O2. Indeed with optims on, they're optimized out. I'll add something to use the result.",https://github.com/bitcoin/bitcoin/pull/10806#issuecomment-315123369,315123369,
laanwj,2017-07-13T16:10:22Z,"@theuni this solves it:\n```diff\ndiff --git a/configure.ac b/configure.ac\nindex 5c3dac648..6b5d891fa 100644\n--- a/configure.ac\n+++ b/configure.ac\n@@ -262,9 +262,10 @@ AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n     #endif\n   ]],[[\n     uint64_t l = 0;\n-    l = _mm_crc32_u8(0, 0);\n-    l = _mm_crc32_u32(0, 0);\n-    l = _mm_crc32_u64(0, 0);\n+    l = _mm_crc32_u8(l, 0);\n+    l =",https://github.com/bitcoin/bitcoin/pull/10806#issuecomment-315125790,315125790,
theuni,2017-07-13T16:49:15Z,"@laanwj Aha. I was messing with printf to force it to stay around, I didn't realize that the test function was ""int main()"". That makes total sense and is really good to know!\n\nPushed with your fix.",https://github.com/bitcoin/bitcoin/pull/10806#issuecomment-315136422,315136422,
laanwj,2017-07-14T07:22:35Z,Tested ACK d34d77a,https://github.com/bitcoin/bitcoin/pull/10806#issuecomment-315290517,315290517,
