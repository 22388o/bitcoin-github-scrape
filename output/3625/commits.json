[
  {
    "sha": "c43d1e5549f548efd221043bbc8069700ee22183",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpjNDNkMWU1NTQ5ZjU0OGVmZDIyMTA0M2JiYzgwNjk3MDBlZTIyMTgz",
    "commit": {
      "author": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@gmail.com",
        "date": "2014-02-04T14:30:48Z"
      },
      "committer": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@gmail.com",
        "date": "2014-02-08T08:33:05Z"
      },
      "message": "gitian: Make windows dependencies outputs fully deterministic\n\nSort .zip order, and other determinism changes to make sure builds\nare repeatable for windows deps.",
      "tree": {
        "sha": "435b6409e7d9ba49a53126c298eb8cf96e74a1b5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/435b6409e7d9ba49a53126c298eb8cf96e74a1b5"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c43d1e5549f548efd221043bbc8069700ee22183",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c43d1e5549f548efd221043bbc8069700ee22183",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/c43d1e5549f548efd221043bbc8069700ee22183",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c43d1e5549f548efd221043bbc8069700ee22183/comments",
    "author": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "23617fd01de071738e4a0f9f9fb9b19222b2acf4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/23617fd01de071738e4a0f9f9fb9b19222b2acf4",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/23617fd01de071738e4a0f9f9fb9b19222b2acf4"
      }
    ],
    "stats": {
      "total": 39,
      "additions": 16,
      "deletions": 23
    },
    "files": [
      {
        "sha": "420a7ce76002a536784bdb98d1b99cf77575e945",
        "filename": "contrib/gitian-descriptors/boost-win.yml",
        "status": "modified",
        "additions": 4,
        "deletions": 6,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c43d1e5549f548efd221043bbc8069700ee22183/contrib/gitian-descriptors/boost-win.yml",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c43d1e5549f548efd221043bbc8069700ee22183/contrib/gitian-descriptors/boost-win.yml",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/gitian-descriptors/boost-win.yml?ref=c43d1e5549f548efd221043bbc8069700ee22183",
        "patch": "@@ -16,6 +16,8 @@ files:\n - \"boost-mingw-gas-cross-compile-2013-03-03.patch\"\n script: |\n   # Defines\n+  export LD_PRELOAD=/usr/lib/faketime/libfaketime.so.1\n+  export FAKETIME=$REFERENCE_DATETIME\n   export TZ=UTC\n   INDIR=$HOME/build\n   # Input Integrity Check\n@@ -35,7 +37,7 @@ script: |\n     mkdir -p $INSTALLPREFIX $BUILDDIR\n     cd $BUILDDIR\n     #\n-    tar xjf $INDIR/boost_1_55_0.tar.bz2\n+    tar --warning=no-timestamp -xjf $INDIR/boost_1_55_0.tar.bz2\n     cd boost_1_55_0\n     GCCVERSION=$($HOST-g++ -E -dM $(mktemp --suffix=.h) | grep __VERSION__ | cut -d ' ' -f 3 | cut -d '\"' -f 2)\n     echo \"using gcc : $GCCVERSION : $HOST-g++\n@@ -70,10 +72,6 @@ script: |\n     ./bjam toolset=gcc binary-format=pe target-os=windows threadapi=win32 address-model=$BITS threading=multi variant=release link=static runtime-link=static --user-config=user-config.jam --without-mpi --without-python -sNO_BZIP2=1 -sNO_ZLIB=1 --layout=tagged --build-type=complete --prefix=\"$INSTALLPREFIX\" $MAKEOPTS install\n     #\n     cd \"$INSTALLPREFIX\"\n-    export LD_PRELOAD=/usr/lib/faketime/libfaketime.so.1\n-    export FAKETIME=$REFERENCE_DATETIME\n-    zip -r $OUTDIR/boost-win$BITS-1.55.0-gitian-r6.zip *\n-    unset LD_PRELOAD\n-    unset FAKETIME\n+    find | sort | zip -@ $OUTDIR/boost-win$BITS-1.55.0-gitian-r6.zip\n   done # for BITS in\n "
      },
      {
        "sha": "ef0f8f3314df0647772fc24508f7cf6567d7d4db",
        "filename": "contrib/gitian-descriptors/deps-win.yml",
        "status": "modified",
        "additions": 4,
        "deletions": 2,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c43d1e5549f548efd221043bbc8069700ee22183/contrib/gitian-descriptors/deps-win.yml",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c43d1e5549f548efd221043bbc8069700ee22183/contrib/gitian-descriptors/deps-win.yml",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/gitian-descriptors/deps-win.yml?ref=c43d1e5549f548efd221043bbc8069700ee22183",
        "patch": "@@ -107,11 +107,13 @@ script: |\n     #\n     tar xjf $INDIR/qrencode-3.4.3.tar.bz2\n     cd qrencode-3.4.3\n-    png_CFLAGS=\"-I$INSTALLPREFIX/include\" png_LIBS=\"-L$INSTALLPREFIX/lib -lpng\" ./configure --prefix=$INSTALLPREFIX --host=$HOST --enable-static --disable-shared --without-tools --disable-maintainer-mode --disable-dependency-tracking\n+    png_CFLAGS=\"-I$INSTALLPREFIX/include\" png_LIBS=\"-L$INSTALLPREFIX/lib -lpng\" ./configure --prefix=$INSTALLPREFIX --host=$HOST --enable-static --disable-shared --without-tools --disable-dependency-tracking\n+    # Workaround to prevent re-configuring by make (resulting in missing m4 error); make all files have a date in the past\n+    find . -print0 | xargs -r0 touch -t 200001010000\n     make\n     make install\n     cd ..\n     #\n     cd $INSTALLPREFIX\n-    zip -r $OUTDIR/bitcoin-deps-win$BITS-gitian-r10.zip include lib\n+    find include lib | sort | zip -@ $OUTDIR/bitcoin-deps-win$BITS-gitian-r10.zip\n   done # for BITS in"
      },
      {
        "sha": "11dd50de1526c12b0fc5348424219be2c6be204d",
        "filename": "contrib/gitian-descriptors/protobuf-win.yml",
        "status": "modified",
        "additions": 3,
        "deletions": 3,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c43d1e5549f548efd221043bbc8069700ee22183/contrib/gitian-descriptors/protobuf-win.yml",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c43d1e5549f548efd221043bbc8069700ee22183/contrib/gitian-descriptors/protobuf-win.yml",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/gitian-descriptors/protobuf-win.yml?ref=c43d1e5549f548efd221043bbc8069700ee22183",
        "patch": "@@ -44,13 +44,13 @@ script: |\n     # Now recompile with the mingw cross-compiler:\n     make distclean\n     ./configure --prefix=$INSTALLPREFIX --enable-shared=no --disable-dependency-tracking --with-protoc=$INSTALLPREFIX/host/bin/protoc --host=$HOST CXXFLAGS=\"-frandom-seed=11 ${OPTFLAGS}\"\n+    export LD_PRELOAD=/usr/lib/faketime/libfaketime.so.1\n+    export FAKETIME=$REFERENCE_DATETIME\n     make\n     make install\n     #\n     cd $INSTALLPREFIX\n-    export LD_PRELOAD=/usr/lib/faketime/libfaketime.so.1\n-    export FAKETIME=$REFERENCE_DATETIME\n-    zip -r $OUTDIR/protobuf-win$BITS-2.5.0-gitian-r4.zip include lib host\n+    find include lib host | sort | zip -@ $OUTDIR/protobuf-win$BITS-2.5.0-gitian-r4.zip\n     unset LD_PRELOAD\n     unset FAKETIME\n   done # for BITS in"
      },
      {
        "sha": "0352f4ff95245c2604936195a8bcf5c124003edc",
        "filename": "contrib/gitian-descriptors/qt-win.yml",
        "status": "modified",
        "additions": 5,
        "deletions": 12,
        "changes": 17,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c43d1e5549f548efd221043bbc8069700ee22183/contrib/gitian-descriptors/qt-win.yml",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c43d1e5549f548efd221043bbc8069700ee22183/contrib/gitian-descriptors/qt-win.yml",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/gitian-descriptors/qt-win.yml?ref=c43d1e5549f548efd221043bbc8069700ee22183",
        "patch": "@@ -55,18 +55,9 @@ script: |\n     cd qt-everywhere-opensource-src-5.2.0\n     SPECNAME=\"win32-g++\"\n     SPECFILE=\"qtbase/mkspecs/${SPECNAME}/qmake.conf\"\n-    sed 's/$TODAY/2011-01-30/' -i configure\n+    sed 's/qt_instdate=`date +%Y-%m-%d`/qt_instdate=2011-01-30/' -i qtbase/configure\n     sed --posix \"s|QMAKE_CFLAGS            = -pipe -fno-keep-inline-dllexport|QMAKE_CFLAGS\\t\\t= -pipe -fno-keep-inline-dllexport -isystem /usr/$HOST/include/ -frandom-seed=qtbuild -I$DEPSDIR/include|\" -i ${SPECFILE}\n     sed --posix \"s|QMAKE_LFLAGS            =|QMAKE_LFLAGS\\t\\t= -L$DEPSDIR/lib|\" -i ${SPECFILE}\n-    # ar adds timestamps to every object file included in the static library\n-    # providing -D as ar argument is supposed to solve it, but doesn't work as qmake strips off the arguments and adds -M to pass a script...\n-    # which somehow cannot be combined with other flags.\n-    # use faketime only for ar, as it confuses make/qmake into hanging sometimes\n-    sed --posix \"s|QMAKE_LIB               = \\\\\\$\\\\\\${CROSS_COMPILE}ar -ru|QMAKE_LIB\\t\\t= $HOME/ar -Dr|\" -i ${SPECFILE}\n-    echo '#!/bin/bash' > $HOME/ar\n-    echo 'export LD_PRELOAD=/usr/lib/faketime/libfaketime.so.1' >> $HOME/ar\n-    echo \"$HOST-ar \\\"\\$@\\\"\" >> $HOME/ar\n-    chmod +x $HOME/ar\n     # Don't load faketime while compiling Qt, qmake will get stuck in nearly infinite loops\n     #export LD_PRELOAD=/usr/lib/faketime/libfaketime.so.1\n     export FAKETIME=$REFERENCE_DATETIME\n@@ -76,10 +67,12 @@ script: |\n     make $MAKEOPTS install\n     #\n     cd $INSTALLPREFIX\n-\n+    # Remove unused non-deterministic stuff\n+    rm host/bin/qtpaths.exe lib/libQt5Bootstrap.a lib/libQt5Bootstrap.la\n     # as zip stores file timestamps, use faketime to intercept stat calls to set dates for all files to reference date\n     export LD_PRELOAD=/usr/lib/faketime/libfaketime.so.1\n-    zip -r $OUTDIR/qt-win${BITS}-5.2.0-gitian-r2.zip *\n+    find -print0 | xargs -r0 touch # fix up timestamps before packaging\n+    find | sort | zip -@ $OUTDIR/qt-win${BITS}-5.2.0-gitian-r2.zip\n     unset LD_PRELOAD\n     unset FAKETIME\n   done # for BITS in"
      }
    ]
  },
  {
    "sha": "6b55e6b97d333a5252f9516a20414f7204e3363a",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo2YjU1ZTZiOTdkMzMzYTUyNTJmOTUxNmEyMDQxNGY3MjA0ZTMzNjNh",
    "commit": {
      "author": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@gmail.com",
        "date": "2014-02-06T17:47:19Z"
      },
      "committer": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@gmail.com",
        "date": "2014-02-10T16:07:35Z"
      },
      "message": "gitian: Post-process .a libraries for win to be deterministic",
      "tree": {
        "sha": "973ba961c1af0ad3508f53d2ff966b05a2c8d3c8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/973ba961c1af0ad3508f53d2ff966b05a2c8d3c8"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6b55e6b97d333a5252f9516a20414f7204e3363a",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6b55e6b97d333a5252f9516a20414f7204e3363a",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/6b55e6b97d333a5252f9516a20414f7204e3363a",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6b55e6b97d333a5252f9516a20414f7204e3363a/comments",
    "author": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "c43d1e5549f548efd221043bbc8069700ee22183",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c43d1e5549f548efd221043bbc8069700ee22183",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/c43d1e5549f548efd221043bbc8069700ee22183"
      }
    ],
    "stats": {
      "total": 51,
      "additions": 46,
      "deletions": 5
    },
    "files": [
      {
        "sha": "db5d6bab1d92d1280a01d2f345408bc5f64afae6",
        "filename": "contrib/gitian-descriptors/boost-win.yml",
        "status": "modified",
        "additions": 10,
        "deletions": 1,
        "changes": 11,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6b55e6b97d333a5252f9516a20414f7204e3363a/contrib/gitian-descriptors/boost-win.yml",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6b55e6b97d333a5252f9516a20414f7204e3363a/contrib/gitian-descriptors/boost-win.yml",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/gitian-descriptors/boost-win.yml?ref=6b55e6b97d333a5252f9516a20414f7204e3363a",
        "patch": "@@ -20,6 +20,7 @@ script: |\n   export FAKETIME=$REFERENCE_DATETIME\n   export TZ=UTC\n   INDIR=$HOME/build\n+  TEMPDIR=$HOME/tmp\n   # Input Integrity Check\n   echo \"fff00023dd79486d444c8e29922f4072e1d451fc5a4d2b6075852ead7f2b7b52  boost_1_55_0.tar.bz2\" | shasum -c\n   echo \"d2b7f6a1d7051faef3c9cf41a92fa3671d905ef1e1da920d07651a43299f6268  boost-mingw-gas-cross-compile-2013-03-03.patch\" | shasum -c\n@@ -70,8 +71,16 @@ script: |\n     # http://statmt.org/~s0565741/software/boost_1_52_0/libs/context/doc/html/context/requirements.html\n     # \"For cross-compiling the lib you must specify certain additional properties at bjam command line: target-os, abi, binary-format, architecture and address-model.\"\n     ./bjam toolset=gcc binary-format=pe target-os=windows threadapi=win32 address-model=$BITS threading=multi variant=release link=static runtime-link=static --user-config=user-config.jam --without-mpi --without-python -sNO_BZIP2=1 -sNO_ZLIB=1 --layout=tagged --build-type=complete --prefix=\"$INSTALLPREFIX\" $MAKEOPTS install\n+    # post-process all generated libraries to be deterministic\n+    # extract them to a temporary directory then re-build them deterministically\n+    for LIB in $(find $INSTALLPREFIX -name \\*.a); do\n+        rm -rf $TEMPDIR && mkdir $TEMPDIR && cd $TEMPDIR\n+        $HOST-ar xv $LIB | cut -b5- > /tmp/list.txt\n+        rm $LIB\n+        $HOST-ar crsD $LIB $(cat /tmp/list.txt)\n+    done\n     #\n     cd \"$INSTALLPREFIX\"\n-    find | sort | zip -@ $OUTDIR/boost-win$BITS-1.55.0-gitian-r6.zip\n+    find | sort | zip -X@ $OUTDIR/boost-win$BITS-1.55.0-gitian-r6.zip\n   done # for BITS in\n "
      },
      {
        "sha": "87ebf3e87bcfd116233f3abf3dd097fd66cde453",
        "filename": "contrib/gitian-descriptors/deps-win.yml",
        "status": "modified",
        "additions": 10,
        "deletions": 1,
        "changes": 11,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6b55e6b97d333a5252f9516a20414f7204e3363a/contrib/gitian-descriptors/deps-win.yml",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6b55e6b97d333a5252f9516a20414f7204e3363a/contrib/gitian-descriptors/deps-win.yml",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/gitian-descriptors/deps-win.yml?ref=6b55e6b97d333a5252f9516a20414f7204e3363a",
        "patch": "@@ -26,6 +26,7 @@ script: |\n   export FAKETIME=$REFERENCE_DATETIME\n   export TZ=UTC\n   INDIR=$HOME/build\n+  TEMPDIR=$HOME/tmp\n   # Input Integrity Check\n   echo \"f74f15e8c8ff11aa3d5bb5f276d202ec18d7246e95f961db76054199c69c1ae3  openssl-1.0.1e.tar.gz\"  | sha256sum -c\n   echo \"12edc0df75bf9abd7f82f821795bcee50f42cb2e5f76a6a281b85732798364ef  db-4.8.30.NC.tar.gz\"    | sha256sum -c\n@@ -113,7 +114,15 @@ script: |\n     make\n     make install\n     cd ..\n+    # post-process all generated libraries to be deterministic\n+    # extract them to a temporary directory then re-build them deterministically\n+    for LIB in $(find $INSTALLPREFIX -name \\*.a); do\n+        rm -rf $TEMPDIR && mkdir $TEMPDIR && cd $TEMPDIR\n+        $HOST-ar xv $LIB | cut -b5- > /tmp/list.txt\n+        rm $LIB\n+        $HOST-ar crsD $LIB $(cat /tmp/list.txt)\n+    done\n     #\n     cd $INSTALLPREFIX\n-    find include lib | sort | zip -@ $OUTDIR/bitcoin-deps-win$BITS-gitian-r10.zip\n+    find include lib | sort | zip -X@ $OUTDIR/bitcoin-deps-win$BITS-gitian-r10.zip\n   done # for BITS in"
      },
      {
        "sha": "543f20b394575adebd1a999723d3ca7524a9d3a4",
        "filename": "contrib/gitian-descriptors/protobuf-win.yml",
        "status": "modified",
        "additions": 10,
        "deletions": 1,
        "changes": 11,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6b55e6b97d333a5252f9516a20414f7204e3363a/contrib/gitian-descriptors/protobuf-win.yml",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6b55e6b97d333a5252f9516a20414f7204e3363a/contrib/gitian-descriptors/protobuf-win.yml",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/gitian-descriptors/protobuf-win.yml?ref=6b55e6b97d333a5252f9516a20414f7204e3363a",
        "patch": "@@ -17,6 +17,7 @@ script: |\n   #\n   export TZ=UTC\n   INDIR=$HOME/build\n+  TEMPDIR=$HOME/tmp\n   OPTFLAGS=\"-O2\"\n   # Integrity Check\n   echo \"13bfc5ae543cf3aa180ac2485c0bc89495e3ae711fc6fab4f8ffe90dfb4bb677  protobuf-2.5.0.tar.bz2\" | sha256sum -c\n@@ -48,9 +49,17 @@ script: |\n     export FAKETIME=$REFERENCE_DATETIME\n     make\n     make install\n+    # post-process all generated libraries to be deterministic\n+    # extract them to a temporary directory then re-build them deterministically\n+    for LIB in $(find $INSTALLPREFIX -name \\*.a); do\n+        rm -rf $TEMPDIR && mkdir $TEMPDIR && cd $TEMPDIR\n+        $HOST-ar xv $LIB | cut -b5- > /tmp/list.txt\n+        rm $LIB\n+        $HOST-ar crsD $LIB $(cat /tmp/list.txt)\n+    done\n     #\n     cd $INSTALLPREFIX\n-    find include lib host | sort | zip -@ $OUTDIR/protobuf-win$BITS-2.5.0-gitian-r4.zip\n+    find include lib host | sort | zip -X@ $OUTDIR/protobuf-win$BITS-2.5.0-gitian-r4.zip\n     unset LD_PRELOAD\n     unset FAKETIME\n   done # for BITS in"
      },
      {
        "sha": "e3de2c02efc6522695819f9fe86636f67b5b27d9",
        "filename": "contrib/gitian-descriptors/qt-win.yml",
        "status": "modified",
        "additions": 16,
        "deletions": 2,
        "changes": 18,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6b55e6b97d333a5252f9516a20414f7204e3363a/contrib/gitian-descriptors/qt-win.yml",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6b55e6b97d333a5252f9516a20414f7204e3363a/contrib/gitian-descriptors/qt-win.yml",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/gitian-descriptors/qt-win.yml?ref=6b55e6b97d333a5252f9516a20414f7204e3363a",
        "patch": "@@ -21,6 +21,7 @@ script: |\n   # Defines\n   export TZ=UTC\n   INDIR=$HOME/build\n+  TEMPDIR=$HOME/tmp\n   # Qt: workaround for determinism in resource ordering\n   #  Qt5's rcc uses a QHash to store the files for the resource.\n   #  A security fix in QHash makes the ordering of keys to be different on every run\n@@ -58,21 +59,34 @@ script: |\n     sed 's/qt_instdate=`date +%Y-%m-%d`/qt_instdate=2011-01-30/' -i qtbase/configure\n     sed --posix \"s|QMAKE_CFLAGS            = -pipe -fno-keep-inline-dllexport|QMAKE_CFLAGS\\t\\t= -pipe -fno-keep-inline-dllexport -isystem /usr/$HOST/include/ -frandom-seed=qtbuild -I$DEPSDIR/include|\" -i ${SPECFILE}\n     sed --posix \"s|QMAKE_LFLAGS            =|QMAKE_LFLAGS\\t\\t= -L$DEPSDIR/lib|\" -i ${SPECFILE}\n+    # Before we tried to pass arguments to ar (static linking) in using QMAKE_LIB, however\n+    #  qt removes the arguments for ar and provides a script which makes it impossible to pass the determinism flag -\n+    #  so rather than try to replace ar, post-process all libraries and plugins at the end.\n+    #\n     # Don't load faketime while compiling Qt, qmake will get stuck in nearly infinite loops\n     #export LD_PRELOAD=/usr/lib/faketime/libfaketime.so.1\n-    export FAKETIME=$REFERENCE_DATETIME\n+    #export FAKETIME=$REFERENCE_DATETIME\n     #\n     # Compile static libraries, and use statically linked openssl (-openssl-linked):\n     OPENSSL_LIBS=\"-L$DEPSDIR/lib -lssl -lcrypto -lgdi32\" ./configure -prefix $INSTALLPREFIX -bindir $INSTALLPREFIX/host/bin -confirm-license -release -opensource -static -xplatform $SPECNAME -device-option CROSS_COMPILE=\"$HOST-\" -no-audio-backend -no-javascript-jit -no-sql-sqlite -no-sql-odbc -no-nis -no-cups -no-iconv -no-dbus -no-gif -no-opengl -no-compile-examples -no-feature-style-windowsce -no-feature-style-windowsmobile -no-qml-debug -openssl-linked -skip qtsvg -skip qtwebkit -skip qtwebkit-examples -skip qtserialport -skip qtdeclarative -skip qtmultimedia -skip qtimageformats -skip qtlocation -skip qtsensors -skip qtquick1 -skip qtquickcontrols -skip qtactiveqt -skip qtconnectivity -skip qtwinextras -skip qtxmlpatterns -skip qtscript -skip qtdoc -system-libpng -system-zlib\n     make $MAKEOPTS install\n+    # post-process all generated libraries and plugins to be deterministic\n+    # extract them to a temporary directory then re-build them deterministically\n+    for LIB in $(find $INSTALLPREFIX -name *.a); do\n+        rm -rf $TEMPDIR && mkdir $TEMPDIR && cd $TEMPDIR\n+        $HOST-ar xv $LIB | cut -b5- > /tmp/list.txt\n+        rm $LIB\n+        $HOST-ar crsD $LIB $(cat /tmp/list.txt)\n+    done\n     #\n     cd $INSTALLPREFIX\n     # Remove unused non-deterministic stuff\n     rm host/bin/qtpaths.exe lib/libQt5Bootstrap.a lib/libQt5Bootstrap.la\n     # as zip stores file timestamps, use faketime to intercept stat calls to set dates for all files to reference date\n     export LD_PRELOAD=/usr/lib/faketime/libfaketime.so.1\n+    export FAKETIME=$REFERENCE_DATETIME\n     find -print0 | xargs -r0 touch # fix up timestamps before packaging\n-    find | sort | zip -@ $OUTDIR/qt-win${BITS}-5.2.0-gitian-r2.zip\n+    find | sort | zip -X@ $OUTDIR/qt-win${BITS}-5.2.0-gitian-r2.zip\n     unset LD_PRELOAD\n     unset FAKETIME\n   done # for BITS in"
      }
    ]
  },
  {
    "sha": "4ce9106ff8400ee9cd35c51a9859b19e6122c7b1",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0Y2U5MTA2ZmY4NDAwZWU5Y2QzNWM1MWE5ODU5YjE5ZTYxMjJjN2Ix",
    "commit": {
      "author": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@gmail.com",
        "date": "2014-02-10T10:20:37Z"
      },
      "committer": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@gmail.com",
        "date": "2014-02-10T16:07:36Z"
      },
      "message": "gitian: sort generated source distribution archive for windows\n\nMake the bitcoin-X.X.X.tar.gz deterministic.",
      "tree": {
        "sha": "749ccf609172491f9042d36d51fd2fa3f0543af1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/749ccf609172491f9042d36d51fd2fa3f0543af1"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4ce9106ff8400ee9cd35c51a9859b19e6122c7b1",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4ce9106ff8400ee9cd35c51a9859b19e6122c7b1",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/4ce9106ff8400ee9cd35c51a9859b19e6122c7b1",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4ce9106ff8400ee9cd35c51a9859b19e6122c7b1/comments",
    "author": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "6b55e6b97d333a5252f9516a20414f7204e3363a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6b55e6b97d333a5252f9516a20414f7204e3363a",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/6b55e6b97d333a5252f9516a20414f7204e3363a"
      }
    ],
    "stats": {
      "total": 19,
      "additions": 12,
      "deletions": 7
    },
    "files": [
      {
        "sha": "6e43c218234077237b0a4066d3423dd5c3feec6e",
        "filename": "contrib/gitian-descriptors/gitian-win.yml",
        "status": "modified",
        "additions": 12,
        "deletions": 7,
        "changes": 19,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4ce9106ff8400ee9cd35c51a9859b19e6122c7b1/contrib/gitian-descriptors/gitian-win.yml",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4ce9106ff8400ee9cd35c51a9859b19e6122c7b1/contrib/gitian-descriptors/gitian-win.yml",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/gitian-descriptors/gitian-win.yml?ref=4ce9106ff8400ee9cd35c51a9859b19e6122c7b1",
        "patch": "@@ -35,6 +35,7 @@ script: |\n   export TZ=UTC\n   INDIR=$HOME/build\n   OPTFLAGS='-O2'\n+  TEMPDIR=\"$HOME/tempdir\"\n   NEEDDIST=1\n   # Qt: workaround for determinism in resource ordering\n   #  Qt5's rcc uses a QHash to store the files for the resource.\n@@ -54,6 +55,7 @@ script: |\n     else\n       HOST=x86_64-w64-mingw32\n     fi\n+    export PATH=$STAGING/host/bin:$PATH\n     mkdir -p $STAGING $BUILDDIR $BINDIR\n     #\n     cd $STAGING\n@@ -63,22 +65,18 @@ script: |\n     unzip $INDIR/protobuf-win${BITS}-2.5.0-gitian-r4.zip\n     if [ \"$NEEDDIST\" == \"1\" ]; then\n       # Make source code archive which is architecture independent so it only needs to be done once\n-      cd $HOME/build/\n-      cd bitcoin\n-      export PATH=$STAGING/host/bin:$PATH\n-      export TAR_OPTIONS=--mtime=`echo $REFERENCE_DATETIME | awk '{ print $1 }'`\n+      cd $HOME/build/bitcoin\n       ./autogen.sh\n       ./configure --bindir=$OUTDIR --prefix=$STAGING --host=$HOST --with-qt-plugindir=$STAGING/plugins  --with-qt-incdir=$STAGING/include --with-qt-bindir=$STAGING/host/bin --with-boost=$STAGING --disable-maintainer-mode --with-protoc-bindir=$STAGING/host/bin --disable-dependency-tracking CPPFLAGS=\"-I$STAGING/include ${OPTFLAGS}\" LDFLAGS=\"-L$STAGING/lib ${OPTFLAGS}\" CXXFLAGS=\"-frandom-seed=bitcoin ${OPTFLAGS}\"\n       make dist\n-      mkdir -p $OUTDIR/src\n-      cp -f bitcoin-*.tar.* $OUTDIR/src\n+      DISTNAME=`echo bitcoin-*.tar.gz`\n       NEEDDIST=0\n     fi\n     # Build platform-dependent executables from source archive\n     cd $BUILDDIR\n     mkdir -p distsrc\n     cd distsrc\n-    tar --strip-components=1 -xf $HOME/build/bitcoin/bitcoin-*.tar.*\n+    tar --strip-components=1 -xf $HOME/build/bitcoin/$DISTNAME\n     ./configure --bindir=$BINDIR --prefix=$STAGING --host=$HOST --with-qt-plugindir=$STAGING/plugins  --with-qt-incdir=$STAGING/include --with-qt-bindir=$STAGING/host/bin --with-boost=$STAGING --disable-maintainer-mode --with-protoc-bindir=$STAGING/host/bin --disable-dependency-tracking CPPFLAGS=\"-I$STAGING/include ${OPTFLAGS}\" LDFLAGS=\"-L$STAGING/lib ${OPTFLAGS}\" CXXFLAGS=\"-frandom-seed=bitcoin ${OPTFLAGS}\"\n     export LD_PRELOAD=/usr/lib/faketime/libfaketime.so.1\n     export FAKETIME=$REFERENCE_DATETIME\n@@ -90,3 +88,10 @@ script: |\n     unset FAKETIME\n   done # for BITS in\n \n+  # sort distribution tar file and normalize user/group/mtime information for deterministic output\n+  mkdir -p $OUTDIR/src\n+  rm -rf $TEMPDIR\n+  mkdir -p $TEMPDIR\n+  cd $TEMPDIR\n+  tar -xvf $HOME/build/bitcoin/$DISTNAME | sort | tar --no-recursion -cT /dev/stdin --mode='u+rw,go+r-w,a+X' --owner=0 --group=0 --mtime=\"$REFERENCE_DATETIME\" | gzip -n > $OUTDIR/src/$DISTNAME\n+"
      }
    ]
  }
]