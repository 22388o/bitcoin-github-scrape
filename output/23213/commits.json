[
  {
    "sha": "fa8d49289479b8eda7ba7530515c414d1cd566a3",
    "node_id": "C_kwDOABII59oAKGZhOGQ0OTI4OTQ3OWI4ZWRhN2JhNzUzMDUxNWM0MTRkMWNkNTY2YTM",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2021-10-07T09:45:53Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2021-10-12T07:10:19Z"
      },
      "message": "rest: Return error when header count is not integral",
      "tree": {
        "sha": "668eff074be0a10a4290ed495826837172689dfc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/668eff074be0a10a4290ed495826837172689dfc"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fa8d49289479b8eda7ba7530515c414d1cd566a3",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\npUiDvwv/XLEaIUm4P9rmBnoPNiX2xVJ2d3PCQh3e8dvCBD64abqJXJNLjd1LDk3u\nUwmBLE6mscKtwLQ/ueUVj0304ysyrTbGTJhaKzNdXCfpqf2BqfFJCYfTu3Vg677q\n8CuwDAZRxMCRY9ncpOoGucmsUjD5sFP8mCvW+AOUK2xDLIFv5bq0vobnysQz1Sj8\nKBi/LhA+udLgy+dC4Niz5LsUBkb81JdQd2okRwruK35Ey/QcxNealDkF6wJT35u8\njdJyMX72+959rh/4jsKsB4foPvqz1Z3lixqQKd57/3u3aNUryTq8786wB+AcenbC\nYGGPT2eLAZXwLIHyuAYiePW1O74aG3qT3J03bgJRvcjCkws7+3ju0NXGXIzTO6XZ\nbr4RZiJJwr+JnjZiCnmLsKOrzs/5BodOLukNvYYmdQgHbAWzx5Efbh44V8PrJ9Jg\n+529NGlOEhI2ioSkDSC4bRbHXJZFJZnaIP2poAm/Ho+b8aQIy+GWwH0z6FczNSpn\nUHPcRCsz\n=7846\n-----END PGP SIGNATURE-----",
        "payload": "tree 668eff074be0a10a4290ed495826837172689dfc\nparent 8df7eee5e1c8ad6b224aa00bcfd7a04a974362c4\nauthor MarcoFalke <falke.marco@gmail.com> 1633599953 +0200\ncommitter MarcoFalke <falke.marco@gmail.com> 1634022619 +0200\n\nrest: Return error when header count is not integral\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa8d49289479b8eda7ba7530515c414d1cd566a3",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fa8d49289479b8eda7ba7530515c414d1cd566a3",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa8d49289479b8eda7ba7530515c414d1cd566a3/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "8df7eee5e1c8ad6b224aa00bcfd7a04a974362c4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8df7eee5e1c8ad6b224aa00bcfd7a04a974362c4",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/8df7eee5e1c8ad6b224aa00bcfd7a04a974362c4"
      }
    ],
    "stats": {
      "total": 20,
      "additions": 14,
      "deletions": 6
    },
    "files": [
      {
        "sha": "f6e34c2d81d8e432c09fcf22468de2c0b6294ed3",
        "filename": "src/rest.cpp",
        "status": "modified",
        "additions": 7,
        "deletions": 5,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa8d49289479b8eda7ba7530515c414d1cd566a3/src/rest.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa8d49289479b8eda7ba7530515c414d1cd566a3/src/rest.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rest.cpp?ref=fa8d49289479b8eda7ba7530515c414d1cd566a3",
        "patch": "@@ -189,18 +189,19 @@ static bool rest_headers(const std::any& context,\n     if (path.size() != 2)\n         return RESTERR(req, HTTP_BAD_REQUEST, \"No header count specified. Use /rest/headers/<count>/<hash>.<ext>.\");\n \n-    long count = strtol(path[0].c_str(), nullptr, 10);\n-    if (count < 1 || count > 2000)\n+    const auto parsed_count{ToIntegral<size_t>(path[0])};\n+    if (!parsed_count.has_value() || *parsed_count < 1 || *parsed_count > 2000) {\n         return RESTERR(req, HTTP_BAD_REQUEST, \"Header count out of range: \" + path[0]);\n+    }\n \n     std::string hashStr = path[1];\n     uint256 hash;\n     if (!ParseHashStr(hashStr, hash))\n         return RESTERR(req, HTTP_BAD_REQUEST, \"Invalid hash: \" + hashStr);\n \n     const CBlockIndex* tip = nullptr;\n-    std::vector<const CBlockIndex *> headers;\n-    headers.reserve(count);\n+    std::vector<const CBlockIndex*> headers;\n+    headers.reserve(*parsed_count);\n     {\n         ChainstateManager* maybe_chainman = GetChainman(context, req);\n         if (!maybe_chainman) return false;\n@@ -211,8 +212,9 @@ static bool rest_headers(const std::any& context,\n         const CBlockIndex* pindex = chainman.m_blockman.LookupBlockIndex(hash);\n         while (pindex != nullptr && active_chain.Contains(pindex)) {\n             headers.push_back(pindex);\n-            if (headers.size() == (unsigned long)count)\n+            if (headers.size() == *parsed_count) {\n                 break;\n+            }\n             pindex = active_chain.Next(pindex);\n         }\n     }"
      },
      {
        "sha": "adc33bd9df42047ade6543988cbf2353bc6c37b1",
        "filename": "test/functional/interface_rest.py",
        "status": "modified",
        "additions": 7,
        "deletions": 0,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa8d49289479b8eda7ba7530515c414d1cd566a3/test/functional/interface_rest.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa8d49289479b8eda7ba7530515c414d1cd566a3/test/functional/interface_rest.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/interface_rest.py?ref=fa8d49289479b8eda7ba7530515c414d1cd566a3",
        "patch": "@@ -279,6 +279,13 @@ def run_test(self):\n         json_obj = self.test_rest_request(f\"/headers/5/{bb_hash}\")\n         assert_equal(len(json_obj), 5)  # now we should have 5 header objects\n \n+        # Test number parsing\n+        for num in ['5a', '-5', '0', '2001', '99999999999999999999999999999999999']:\n+            assert_equal(\n+                bytes(f'Header count out of range: {num}\\r\\n', 'ascii'),\n+                self.test_rest_request(f\"/headers/{num}/{bb_hash}\", ret_type=RetType.BYTES, status=400),\n+            )\n+\n         self.log.info(\"Test tx inclusion in the /mempool and /block URIs\")\n \n         # Make 3 tx and mine them on node 1"
      },
      {
        "sha": "34022ece354a1e533ddf66bcbbc982dab7e85ab8",
        "filename": "test/lint/lint-locale-dependence.sh",
        "status": "modified",
        "additions": 0,
        "deletions": 1,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa8d49289479b8eda7ba7530515c414d1cd566a3/test/lint/lint-locale-dependence.sh",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa8d49289479b8eda7ba7530515c414d1cd566a3/test/lint/lint-locale-dependence.sh",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/lint/lint-locale-dependence.sh?ref=fa8d49289479b8eda7ba7530515c414d1cd566a3",
        "patch": "@@ -43,7 +43,6 @@ export LC_ALL=C\n KNOWN_VIOLATIONS=(\n     \"src/bitcoin-tx.cpp.*stoul\"\n     \"src/dbwrapper.cpp:.*vsnprintf\"\n-    \"src/rest.cpp:.*strtol\"\n     \"src/test/dbwrapper_tests.cpp:.*snprintf\"\n     \"src/test/fuzz/locale.cpp\"\n     \"src/test/fuzz/string.cpp\""
      }
    ]
  }
]