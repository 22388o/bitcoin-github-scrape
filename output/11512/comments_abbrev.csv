jonasschnelli,2017-10-19T18:53:09Z,Needs rebase.,https://github.com/bitcoin/bitcoin/pull/11512#issuecomment-338003044,338003044,
TheBlueMatt,2017-10-19T21:35:56Z,Rebased.,https://github.com/bitcoin/bitcoin/pull/11512#issuecomment-338045000,338045000,
theuni,2017-10-19T22:04:54Z,"I like this better, concept ACK. The only issue I have with it is that we'll now only create a oneshot to a single resolve result if the subdomain isn't supported, meaning that it's pretty damn important to have subdomain support.\n\nOne alternative to this could be to add the notion of oneshot-only peers to addrman: If the source of an address is a special internal value (NET_INTERNAL), assume ",https://github.com/bitcoin/bitcoin/pull/11512#issuecomment-338051181,338051181,
TheBlueMatt,2017-10-19T22:10:06Z,"OneShot-only seems like it would uneccessarily delay finding your first peer(s). The fact that oneshot-only makes it pretty important that you find a peer on the first IP you try really needs to be fixed for onlynet=onion nodes anyway, though I agree its relatively important to have seeds that support the service bits set.",https://github.com/bitcoin/bitcoin/pull/11512#issuecomment-338052190,338052190,
theuni,2017-10-19T22:17:02Z,"I wasn't implying that we'd _only_ use oneshot-only, just that after a failed subdomain resolve, we'd do the tld resolve and add all results to addrman as oneshot-only. That way worst-case (no subdomain resolves) you'd get a few dozen oneshot-only peers for bootstrapping. But best-case, all subdomains resolve and we add no oneshots.\n\nRegardless, I don't think that's necessary yet. It would be ",https://github.com/bitcoin/bitcoin/pull/11512#issuecomment-338053533,338053533,
TheBlueMatt,2017-10-19T22:19:13Z,"I'd somewhat rather implement logic that allows you to repeatedly connect to the dnsseed as oneshot using a random result from Lookup, this way (I believe) onlynet=onion hosts will get the same improvements, but, indeed, not in this PR.",https://github.com/bitcoin/bitcoin/pull/11512#issuecomment-338053945,338053945,
TheBlueMatt,2017-11-06T21:59:22Z,Needs an 0.16 tag since this fixes a bug currently in master.,https://github.com/bitcoin/bitcoin/pull/11512#issuecomment-342301780,342301780,
TheBlueMatt,2017-11-06T22:25:13Z,Further clarified comment on desirable service flags.,https://github.com/bitcoin/bitcoin/pull/11512#issuecomment-342308546,342308546,
theuni,2017-11-14T22:04:22Z,utACK c7f5f4ef8990c5abdc1f3f2f76771c46b7e08b07,https://github.com/bitcoin/bitcoin/pull/11512#issuecomment-344414483,344414483,
theuni,2017-12-20T23:16:12Z,"Needs rebase. Also, bump for visibility :)",https://github.com/bitcoin/bitcoin/pull/11512#issuecomment-353210811,353210811,
sipa,2018-01-06T10:49:22Z,"Code review ACK 3d097ed3457f9794a6f200522ff18262d44e3d7a\n\nI'm not entirely convinced about the approach. It feels silly to me to do a DNS resolve which we know won't resolve (or, if it happens to be a catch-all for subdomains, we'll even end up adding unfiltered results - possibly with incorrect service flags - to addrman). I'd rather either remove support for unfiltered seeds, or leave the bo",https://github.com/bitcoin/bitcoin/pull/11512#issuecomment-355738981,355738981,
TheBlueMatt,2018-01-09T18:20:46Z,"@theuni suggested that change, so maybe he should chime in, but I tend to like it, especially because it allows a DNS seed operator to add support for a new service bit after the fact. If they lag too long we can remove them, but its nice to not have the service bit selector tied to a constant in a release.",https://github.com/bitcoin/bitcoin/pull/11512#issuecomment-356369936,356369936,
sipa,2018-01-09T18:29:32Z,"@TheBlueMatt I was mostly concerned about @luke-jr's DNS seed not supporting filtering but still responding, resulting in us storing those results with the wrong flags in addrman. He confirmed on IRC that his seed supports filtering, so that concern goes away.",https://github.com/bitcoin/bitcoin/pull/11512#issuecomment-356372351,356372351,
theuni,2018-01-10T00:55:03Z,"@sipa I think it's reasonable to assume that some seeds will update their seeds after releases have been cut.\n\nThat's a good point about getting potential bad responses from the subdomain. I guess we'll want to verify proper filtering before adding new servers. A quick test of the current ones yields no reply for ```xa.foo.bar```.",https://github.com/bitcoin/bitcoin/pull/11512#issuecomment-356463808,356463808,
laanwj,2018-01-17T11:34:49Z,utACK 3d097ed,https://github.com/bitcoin/bitcoin/pull/11512#issuecomment-358278304,358278304,
TheBlueMatt,2018-01-19T22:41:44Z,Changed comments and commit messages as requested.,https://github.com/bitcoin/bitcoin/pull/11512#issuecomment-359110042,359110042,
jonasschnelli,2018-01-21T07:31:55Z,utACK 2b839abd3e78e28748bbef0708fac74b442e2e36,https://github.com/bitcoin/bitcoin/pull/11512#issuecomment-359229624,359229624,
sipa,2017-10-18T08:53:59Z,Typo: **x**GetDesir**e**ableServiceFlags?,https://github.com/bitcoin/bitcoin/pull/11512#discussion_r145352027,145352027,src/chainparams.h
TheBlueMatt,2017-10-18T15:30:50Z,"x was deliberate (as thats the dns prefix), the e is just because i cant spell desirable.",https://github.com/bitcoin/bitcoin/pull/11512#discussion_r145452148,145452148,src/chainparams.h
theuni,2017-10-18T21:23:01Z,"What if we just always tried the desired subdomain, and fell back to the OneShot on the host if the resolve fails? That way seed operators can update for new flags in the future, and we can get rid of the supportsServiceBitsFiltering logic.",https://github.com/bitcoin/bitcoin/pull/11512#discussion_r145547214,145547214,src/net.cpp
TheBlueMatt,2017-10-19T00:48:52Z,Does that not have any annoying interactions with async name lookup changes?,https://github.com/bitcoin/bitcoin/pull/11512#discussion_r145578615,145578615,src/net.cpp
theuni,2017-10-19T03:39:14Z,"Nah, async resolves will just take a functor specifying what to do with the result. In this case, it'll just do ```AddOneShot(seed.host)``` on failure.",https://github.com/bitcoin/bitcoin/pull/11512#discussion_r145594001,145594001,src/net.cpp
jonasschnelli,2017-10-19T18:52:52Z,That would essentially drop @luke-jr DNS seed. @luke-jr: plans to support filtering by service bits soon?,https://github.com/bitcoin/bitcoin/pull/11512#discussion_r145791829,145791829,src/net.cpp
TheBlueMatt,2017-10-19T21:34:46Z,"Using a DNS Seed as a oneshot still provides at least some useful result, and is what we do for Tor nodes anyway, so I'd somewhat prefer to at least do that. Took @theuni's suggestion here.",https://github.com/bitcoin/bitcoin/pull/11512#discussion_r145830401,145830401,src/net.cpp
sipa,2017-12-20T23:25:04Z,"Not all DNS seeds support this naming scheme, I think?",https://github.com/bitcoin/bitcoin/pull/11512#discussion_r158162297,158162297,src/net.cpp
sipa,2017-12-20T23:26:29Z,"This branch triggers based on SetInternal returning false, which means host="""" - it has nothing to do with service filtering.",https://github.com/bitcoin/bitcoin/pull/11512#discussion_r158162552,158162552,src/net.cpp
sipa,2017-12-20T23:26:48Z,I love sate.,https://github.com/bitcoin/bitcoin/pull/11512#discussion_r158162611,158162611,src/protocol.h
TheBlueMatt,2017-12-23T05:03:40Z,"That is, in fact, the point. If we fail to look up the host (eg cause the dns seed doesn't support the x$ prefix or they dont support our new required service bits) we fall back to the same thing we do with tor - simply add the generic responses as oneshots.",https://github.com/bitcoin/bitcoin/pull/11512#discussion_r158576587,158576587,src/net.cpp
TheBlueMatt,2017-12-23T05:04:19Z,I think you reviewed with too little context? Generally -U20 or more is required to get sufficient context in reviews in my experience :p.,https://github.com/bitcoin/bitcoin/pull/11512#discussion_r158576589,158576589,src/net.cpp
TheBlueMatt,2017-12-23T05:04:40Z,"I am very sate-iated...err, no, that doesnt work either...will fix.",https://github.com/bitcoin/bitcoin/pull/11512#discussion_r158576591,158576591,src/protocol.h
TheBlueMatt,2017-12-24T16:48:57Z,Fixed.,https://github.com/bitcoin/bitcoin/pull/11512#discussion_r158606051,158606051,src/protocol.h
sipa,2017-12-25T14:25:32Z,"It seems a bit silly to try to resolve something we know won't resolve (or, even worse, may resolve but have a result with an unintended meaning).",https://github.com/bitcoin/bitcoin/pull/11512#discussion_r158645981,158645981,src/net.cpp
TheBlueMatt,2017-12-26T16:58:48Z,"DNS Seeds should generally resolve to something useful with the service bits fine, and I think we should be phasing out DNS seeds which do not, so I'm not too worried about it. Mostly it just simplifies the code somewhat and lets us add new service bits without worrying about keeping the DNS seed constants up to date (and the DNS seeds can add the new service bits after release).",https://github.com/bitcoin/bitcoin/pull/11512#discussion_r158722445,158722445,src/net.cpp
sipa,2018-01-06T10:42:22Z,"Oops, indeed.",https://github.com/bitcoin/bitcoin/pull/11512#discussion_r160022897,160022897,src/net.cpp
laanwj,2018-01-17T11:33:22Z,comment needs updating: there is no 'service bits flag' anymore,https://github.com/bitcoin/bitcoin/pull/11512#discussion_r162024178,162024178,src/chainparams.cpp
TheBlueMatt,2018-01-17T21:19:15Z,"Done, in a new commit.",https://github.com/bitcoin/bitcoin/pull/11512#discussion_r162182003,162182003,src/chainparams.cpp
ryanofsky,2018-01-17T21:43:27Z,"In commit ""Use GetDesireableServiceFlags in static seeds, document this.""\n\nI'm probably just tired, but I found this commit message confusing. Maybe say:\n\n> broke inserting entries into addrman from static seeds (as well as dnsseeds which did not support service bits)\n\ninstead of:\n\n> broke inserting entries into addrman from dnsseeds which did not support service bits, as well as s",https://github.com/bitcoin/bitcoin/pull/11512#discussion_r162187890,162187890,contrib/seeds/README.md
ryanofsky,2018-01-17T21:58:19Z,"In commit ""Fall back to oneshot for DNS Seeds which don't support filtering.""\n\nPerhaps this is obvious with more context, but I'd think ""ignoring"" is dropping the seed rather than calling AddOneShot. If this said ""fall back to one shot"" instead of ""ignoring"" or said how one shot is the same as ignoring, it might be clearer.",https://github.com/bitcoin/bitcoin/pull/11512#discussion_r162191562,162191562,src/net.cpp
laanwj,2018-01-19T11:20:27Z,"You still mention the ""service bits flag"". This was the boolean argument that you removed.",https://github.com/bitcoin/bitcoin/pull/11512#discussion_r162597492,162597492,src/chainparams.cpp
TheBlueMatt,2018-01-19T22:32:35Z,"Ah, I was thinking of the xXXXX prefix as the ""service bits flag""...",https://github.com/bitcoin/bitcoin/pull/11512#discussion_r162748402,162748402,src/chainparams.cpp
laanwj,2018-01-24T12:02:02Z,"Ah, yes, that's also a possible interpretation. Thanks for clarifying the text.",https://github.com/bitcoin/bitcoin/pull/11512#discussion_r163528295,163528295,src/chainparams.cpp
