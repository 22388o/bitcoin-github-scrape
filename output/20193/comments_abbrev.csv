DrahtBot,2020-10-20 07:44:49,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19972 (tests/net: Add fuzzing harness for node eviction logic. Make node eviction logic testable. by practicalswift)\n\nI",https://github.com/bitcoin/bitcoin/pull/20193#issuecomment-712661633,712661633,
practicalswift,2020-10-20 07:49:42,"Concept ACK, but please add a `AttemptToEvictConnection` unit test for this scenario.\n\nSee #19966 on ideas on how to make `AttemptToEvictConnection` testable, or feel free to cherry-pick in 818dd2a04da1ae7329c58a79a4fade5ec62c549d and df1328fcecc3f359574fa53979402894b4a73a12 from #19972 (""tests/net: Add fuzzing harness for node eviction logic. Make node eviction logic testable."") .",https://github.com/bitcoin/bitcoin/pull/20193#issuecomment-712664280,712664280,
jonatack,2020-10-20 08:01:05,"I agree, but ISTM (a) the code needs refactoring to be unit-testable, (b) refactoring of critical code to make it testable is low priority for reviewers, high risk, and unlikely to be merged (unless someone of v high stature drives it), and (c) ATEC improvements and fixes without tests do see review and have been merged over the years, so I didn't plan to gate this (essentially one-line improvemen",https://github.com/bitcoin/bitcoin/pull/20193#issuecomment-712670373,712670373,
practicalswift,2020-10-20 08:48:56,"@jonatack \n\n> unlikely to be merged (unless someone of v high stature drives it)\n\nI find it very concerning that you're worried that you're not ""high stature""(!) enough to suggest such a change.\n\nEither it is in the best interest of our users to have your PR merged (based on _pure_ code and concept review), or it is not.\n\nWho wrote the code simply doesn't enter that equation.\n\n",https://github.com/bitcoin/bitcoin/pull/20193#issuecomment-712696827,712696827,
jonatack,2020-10-20 09:06:51,"ISTM the bottlenecks to refactoring critical code for testability are risk, expert review, and low review interest. I could refactor ATEC but that doesn't mean people will be eager to review it, and I don't think it's realistic to gate a one-line improvement on a larger technical debt reduction bottleneck like that. I don't believe the previous changes to ATEC have been gated on it either. There a",https://github.com/bitcoin/bitcoin/pull/20193#issuecomment-712707745,712707745,
practicalswift,2020-10-20 09:36:32,"> I could refactor ATEC but that doesn't mean people will be eager to review it, …\n\nFWIW I would be very eager to review a change which made `AttemptToEvictConnection` unit testable. As demonstrated it can be made unit testable with only few lines of code.\n\nI've always been somewhat amazed about how little testing `AttemptToEvictConnection` has considering the importance of that function f",https://github.com/bitcoin/bitcoin/pull/20193#issuecomment-712725393,712725393,
jonatack,2020-10-20 09:41:30,"As the only person until now who reviewed your ATEC refactoring, I'm aware. I do think global refactoring and writing tests for ATEC is orthogonal and out of scope to this one-line change, and far harder to have reviewed and merged, which is why it was not proposed in the parent #19670. Nor, for that matter, in the other parent PR #19991 that had no tests. Both of these were larger changes. 🤷‍♂ ",https://github.com/bitcoin/bitcoin/pull/20193#issuecomment-712728234,712728234,
hebasto,2020-10-20 13:01:58,"> Nor, for that matter, in the other parent PR #19991 that had no tests.\n\nBtw, https://github.com/bitcoin/bitcoin/pull/20172/commits/da8b1092fc2d5fa5ee9da3310dae16d4c919bc1b in #20172 adds a functional test that checks alternative port for Tor onion connections.",https://github.com/bitcoin/bitcoin/pull/20193#issuecomment-712832514,712832514,
jonatack,2020-10-20 13:06:54,Good!,https://github.com/bitcoin/bitcoin/pull/20193#issuecomment-712835724,712835724,
