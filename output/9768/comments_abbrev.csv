laanwj,2017-02-16T08:42:04Z,"If you're working on custom logging stuff anyway: what would be really nice is something that would queue up debug messages, then print them only if the test fails. This lowers the amount of spam in the Travis log in the good case, and gives full troubleshooting information in the bad case (when you need it).\n",https://github.com/bitcoin/bitcoin/pull/9768#issuecomment-280268516,280268516,
jnewbery,2017-02-16T20:15:15Z,@laanwj done: https://github.com/bitcoin/bitcoin/pull/9780,https://github.com/bitcoin/bitcoin/pull/9768#issuecomment-280446044,280446044,
ryanofsky,2017-02-17T11:12:38Z,utACK 3e7ed8c21c3f52a312a538746aebbbb06f67e3a1,https://github.com/bitcoin/bitcoin/pull/9768#issuecomment-280623090,280623090,
jnewbery,2017-02-17T21:45:11Z,@ryanofsky thanks for the great feedback. I'm going to hold back on making any changes until I get some more concept ACKs/NACKs. I want to make sure people are happy going in this direction before I spend any time addressing review comments.,https://github.com/bitcoin/bitcoin/pull/9768#issuecomment-280775055,280775055,
jnewbery,2017-02-22T01:27:49Z,"@MarcoFalke @laanwj @jonasschnelli @sdaftuar you're the most active contributors to the qa directory. Can you have a quick look and give me a concept ACK/NACK so I know whether to continue in this direction.\n\nNo rush. Obviously you're all busy with the 0.14 release.",https://github.com/bitcoin/bitcoin/pull/9768#issuecomment-281538485,281538485,
sdaftuar,2017-02-27T18:16:38Z,"Concept ACK.  \n\nI haven't reviewed this PR in detail yet, but what I'd find useful is if the default behavior when running a single test locally was to print all log messages to the console, and only suppress log messages when running the tests through the `rpc-tests.py` script.",https://github.com/bitcoin/bitcoin/pull/9768#issuecomment-282803195,282803195,
jnewbery,2017-02-28T16:29:02Z,"@sdaftuar the eventual aim will be to add a lot more low-level logging (eg logging when every p2p message is sent or received on the mininode connection). Those low-level logs will always be saved to test_framework.log, but by default are not printed to the console. If the user want low-level logs printed to console, they can specify --loglevel when running the script.",https://github.com/bitcoin/bitcoin/pull/9768#issuecomment-283089586,283089586,
jnewbery,2017-03-06T19:13:00Z,"I've addressed @ryanofsky's review comments and repushed. A few updates since I opened this PR:\n\n- microsecond debug logging is now set by default on all test nodes. I've removed all places in the test code where debugging is set manually, since there's no reason not to use debug logging in these test cases.\n- I've added logging to the test_framework submodules\n- I've replaced print functi",https://github.com/bitcoin/bitcoin/pull/9768#issuecomment-284500285,284500285,
jnewbery,2017-03-07T15:44:18Z,@ryanofsky's comments addressed and repushed: c9755da51a742c0d86572f750e16573e87fdd166 / https://github.com/jnewbery/bitcoin/tree/pr9768.3,https://github.com/bitcoin/bitcoin/pull/9768#issuecomment-284759228,284759228,
jnewbery,2017-03-07T20:19:32Z,rebased: https://github.com/bitcoin/bitcoin/pull/9768/commits/2c9fc0e5f786dd4daa906f20fc322a615bc5b6e2 / https://github.com/jnewbery/bitcoin/tree/pr9768.4,https://github.com/bitcoin/bitcoin/pull/9768#issuecomment-284846410,284846410,
jnewbery,2017-03-08T14:42:28Z,@laanwj @MarcoFalke I think this is a real improvement and helps debugging and fixing test cases when they fail. I've addressed https://github.com/bitcoin/bitcoin/pull/9768#issuecomment-280268516 in #9780 which builds off this PR. Any chance I can convince you to take a look at this?,https://github.com/bitcoin/bitcoin/pull/9768#issuecomment-285058711,285058711,
MarcoFalke,2017-03-08T22:31:07Z,"Concept ACK. Going to give some feedback later tonight.\n\n\nOn Wed, Mar 8, 2017 at 3:42 PM, John Newbery <notifications@github.com> wrote:\n> @laanwj @MarcoFalke I think this is a real improvement and helps debugging\n> and fixing test cases when they fail. I've addressed #9768 (comment) in\n> #9780 which builds off this PR. Any chance I can convince you to take a look\n> at this?\n>\n> —\n> You ",https://github.com/bitcoin/bitcoin/pull/9768#issuecomment-285191197,285191197,
jnewbery,2017-03-09T14:37:11Z,Thanks for the feedback @MarcoFalke . I believe the latest commit should address all your comments.,https://github.com/bitcoin/bitcoin/pull/9768#issuecomment-285368237,285368237,
MarcoFalke,2017-03-09T14:39:10Z,"Ok, will take a quick look later and plan to merge this before the meeting.\n\nOn Thu, Mar 9, 2017 at 3:37 PM, John Newbery <notifications@github.com>\nwrote:\n\n> Thanks for the feedback @MarcoFalke <https://github.com/MarcoFalke> . I\n> believe the latest commit should address all your comments.\n>\n> —\n> You are receiving this because you were mentioned.\n> Reply to this email directly, view i",https://github.com/bitcoin/bitcoin/pull/9768#issuecomment-285368749,285368749,
Sjors,2017-11-27T13:46:19Z,"This works if you call `test/functional/bumpfee.py --loglevel=INFO`, but not if you call `test/functional/test_runner.py --loglevel=INFO bumpfee` (which just shows dots). Not sure if that's intended, but it did [confuse me](https://botbot.me/freenode/bitcoin-core-dev/2017-11-27/?msg=93962703&page=2).",https://github.com/bitcoin/bitcoin/pull/9768#issuecomment-347185666,347185666,
jnewbery,2017-11-27T14:49:52Z,"documentation is here: https://github.com/bitcoin/bitcoin/blob/master/test/README.md#test-logging :\n\n> when run through the test_runner harness, all logs are written to test_framework.log and no logs are output to the console.\n\nFeel free to open a PR if you think the documentation could be improved.",https://github.com/bitcoin/bitcoin/pull/9768#issuecomment-347204725,347204725,
Sjors,2017-11-27T17:10:49Z,@jnewberry it's probably sufficient if `/test_runner.py --help` says that next to the `--loglevel` flag (or if it doesn't show that option).,https://github.com/bitcoin/bitcoin/pull/9768#issuecomment-347252443,347252443,
jnewbery,2017-11-27T17:33:36Z,The help text for `--loglevel` comes from `test_framework.py`. `test_runner.py` grabs that help text and appends it to its own help text. I suppose that test_runner could remove the `--loglevel` help before displaying it. The relevant code is here: https://github.com/bitcoin/bitcoin/blob/a89221873a3ee2451c73b41bbe2d99d36f439d31/test/functional/test_runner.py#L258,https://github.com/bitcoin/bitcoin/pull/9768#issuecomment-347260016,347260016,
Sjors,2017-11-27T18:34:39Z,"Thanks, I'll take a look.",https://github.com/bitcoin/bitcoin/pull/9768#issuecomment-347279952,347279952,
ryanofsky,2017-02-16T21:42:11Z,"Would upgrade this to a warning, since this is leaving files behind. Also this is a really useful print to see on the console when a test fails.",https://github.com/bitcoin/bitcoin/pull/9768#discussion_r101633768,101633768,qa/rpc-tests/test_framework/test_framework.py
ryanofsky,2017-02-16T21:48:47Z,"You should say something about test_framework.log and console logging in the tests' --help output.\n\nWhat you wrote in the commit message is good, but obviously no one is going to see if it is just in this commit message.",https://github.com/bitcoin/bitcoin/pull/9768#discussion_r101635232,101635232,qa/rpc-tests/test_framework/test_framework.py
ryanofsky,2017-02-16T21:50:05Z,Should stop trying to print e here and below because log.exception already formats and prints the exception and stack trace: https://docs.python.org/3/library/logging.html#logging.Logger.exception. It's not helpful to see same information printed multiple times and in inconsistent ways.,https://github.com/bitcoin/bitcoin/pull/9768#discussion_r101635498,101635498,qa/rpc-tests/test_framework/test_framework.py
ryanofsky,2017-02-16T21:53:07Z,Can you list what the log levels are? At least should probably mention that passing --loglevel=0 will show complete log output.,https://github.com/bitcoin/bitcoin/pull/9768#discussion_r101636133,101636133,qa/rpc-tests/test_framework/test_framework.py
ryanofsky,2017-02-16T22:07:13Z,"I think you're better off dropping this call. The default debug level seems to be 0, and the value of DEBUG is 10 so this potentially throws away logs.\n\nAlso would drop the 3 other setLevel(logging.DEBUG) calls below.",https://github.com/bitcoin/bitcoin/pull/9768#discussion_r101638985,101638985,qa/rpc-tests/test_framework/test_framework.py
ryanofsky,2017-02-16T22:08:37Z,"Calling getattr doesn't seem to be necessary, the documentation says setLevel already accepts a string: \nhttps://docs.python.org/3/library/logging.html#logging.Handler.setLevel. Maybe upper() is still useful though.",https://github.com/bitcoin/bitcoin/pull/9768#discussion_r101639295,101639295,qa/rpc-tests/test_framework/test_framework.py
ryanofsky,2017-02-16T22:10:40Z,Junk lines?,https://github.com/bitcoin/bitcoin/pull/9768#discussion_r101639658,101639658,qa/rpc-tests/test_framework/test_framework.py
jnewbery,2017-03-06T18:43:36Z,Thanks. Updated.,https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104489334,104489334,qa/rpc-tests/test_framework/test_framework.py
jnewbery,2017-03-06T18:43:45Z,Updated,https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104489393,104489393,qa/rpc-tests/test_framework/test_framework.py
jnewbery,2017-03-06T18:43:57Z,"Yep, good catch.",https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104489442,104489442,qa/rpc-tests/test_framework/test_framework.py
jnewbery,2017-03-06T18:44:46Z,good point. Fixed.,https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104489635,104489635,qa/rpc-tests/test_framework/test_framework.py
jnewbery,2017-03-06T18:46:31Z,"I think DEBUG is good here. We shouldn't encourage people to log messages at custom levels (ie not one of debug, info, warning, error and critical), and we especially shouldn't encourage people to log at a level lower than DEBUG.",https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104490017,104490017,qa/rpc-tests/test_framework/test_framework.py
jnewbery,2017-03-06T18:50:16Z,"Agree. I was following the Python 'logging how to' guide here: https://docs.python.org/3/howto/logging.html#logging-to-a-file which uses getattr(). I guess that was written before 3.2, which is when setlevel() was updated to take a string argument.\n\nI've tested the logging module and:\n- we do need to use upper() to set the log levels to uppercase\n- calling with an invalid string causes log",https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104490992,104490992,qa/rpc-tests/test_framework/test_framework.py
jnewbery,2017-03-06T18:50:38Z,yes. Junk lines from when I was testing this. Thanks. Removed.,https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104491081,104491081,qa/rpc-tests/test_framework/test_framework.py
ryanofsky,2017-03-06T19:23:11Z,"Should move the os.makedirs, and self.start_logging calls above the `try:` block, so error information won't be lost if these calls fail for some reason.",https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104498952,104498952,qa/rpc-tests/test_framework/test_framework.py
ryanofsky,2017-03-06T19:24:32Z,"This should be changed to error instead of warning, to avoid potential for silent errors slipping through (even though in most cases, an error probably did print previously).\n\nAlso, I think it would be good for this message to mention the temp directory path (or alternately the path to `test_framework.log`), since it is no longer printed by default and is a piece of information you probably ne",https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104499283,104499283,qa/rpc-tests/test_framework/test_framework.py
ryanofsky,2017-03-06T19:46:29Z,"Maybe I missed some discussion, but why is the default level `error` instead of `debug` or `warning`? I can understand disabling debug output by default when running pull-tester. But I run individual tests from the command line every day, and I can't remember a time when I've ever wanted to do this without seeing output.\n\nIf we have make `error` the default, can we at least support abbreviatin",https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104504636,104504636,qa/rpc-tests/test_framework/test_framework.py
ryanofsky,2017-03-06T20:21:53Z,Would be nice to support integer debug levels for less verbose command line usage. Maybe `setLevel(int(self.options.loglevel) if self.options.loglevel.isdigit() else self.options.loglevel.upper())`.,https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104512886,104512886,qa/rpc-tests/test_framework/test_framework.py
ryanofsky,2017-03-06T20:33:46Z,"Why drop mention of previous versions? Also, it seems like without this qualification, maybe the word ""always"" should be dropped too.",https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104515399,104515399,qa/rpc-tests/bip68-sequence.py
ryanofsky,2017-03-06T20:35:13Z,Probably best to remove trailing and prefix \n here and in other logging lines. (There seem to be 4-5 other occurrances in this PR.),https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104515702,104515702,qa/rpc-tests/bip68-sequence.py
ryanofsky,2017-03-06T20:40:50Z,Should be logging.getLogger. This is causing travis errors.,https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104516930,104516930,qa/rpc-tests/test_framework/comptool.py
ryanofsky,2017-03-06T21:17:46Z,"> I think DEBUG is good here. We shouldn't encourage people to log messages at custom levels (ie not one of debug, info, warning, error and critical), and we especially shouldn't encourage people to log at a level lower than DEBUG.\n\nActually setting DEBUG seems to be needed here in order to be able to see debug messages at all, otherwise python seems to fall back to root logger level which is ",https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104524818,104524818,qa/rpc-tests/test_framework/test_framework.py
jnewbery,2017-03-07T15:31:20Z,"You're right. This should be INFO by default. DEBUG emits way too much to the console to be the default.\n\npull-tester diverts stdout from the subtests, so there's no output to console at all.\n\n--loglevel now accepts ints as well as the named strings and can be specified with the short option -l",https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104695430,104695430,qa/rpc-tests/test_framework/test_framework.py
jnewbery,2017-03-07T15:32:10Z,"Good idea. I needed to put start_logging() below the os.makedirs() call, but you're right that this should be outside the large try/except block. I've now moved them both up.",https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104695642,104695642,qa/rpc-tests/test_framework/test_framework.py
jnewbery,2017-03-07T15:32:26Z,Agree. Done both.,https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104695714,104695714,qa/rpc-tests/test_framework/test_framework.py
jnewbery,2017-03-07T15:35:16Z,"I still don't agree. logging at non-standard levels is harder (you need to call `self.log.log(lvl, message`) rather than `self.log.debug(message)` or similar). Why would anyone want do that, and why would we want to allow people to add confusing logging levels to the test cases?",https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104696542,104696542,qa/rpc-tests/test_framework/test_framework.py
jnewbery,2017-03-07T15:35:45Z,Yep. Good idea. Done (although I've split this over two lines for readability).,https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104696682,104696682,qa/rpc-tests/test_framework/test_framework.py
jnewbery,2017-03-07T15:40:00Z,"Because I previously thought that it was a bug that Core v0.13 (and a few earlier versions) always relayed v2 transactions - hence the 'with current versions' comment. See #9739 for the discussion. Whether or not it's a bug is moot now, and I think the 'with current verions' comment doesn't clarify.\n\n'always' here means 'both before and after BIP 68 activation'.",https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104697825,104697825,qa/rpc-tests/bip68-sequence.py
jnewbery,2017-03-07T15:40:07Z,Thanks. Done.,https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104697862,104697862,qa/rpc-tests/bip68-sequence.py
jnewbery,2017-03-07T15:40:31Z,Yep. My mistake. Fixed.,https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104697964,104697964,qa/rpc-tests/test_framework/comptool.py
ryanofsky,2017-03-08T16:49:03Z,"Line 72 `Warning: testing without local IPv6 support` above is now a print again, not sure if this was intentional.",https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104963339,104963339,qa/rpc-tests/proxy_test.py
jnewbery,2017-03-08T18:17:16Z,"yes - proxy_test does a lot of work in the `__init__()` method, which is called before the temp directory is set up. Logging requires the temp directory, so we can't use `self.log` until we're in `main()` and `_start_logging()` has been called.\n\nI left this as a `print()` rather than trying to do anything clever to coerce the test into being log friendly.",https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104984484,104984484,qa/rpc-tests/proxy_test.py
MarcoFalke,2017-03-09T00:35:35Z,"If you remove the prints above, you need to change those to assert_equal to maintain the debug print in case of failure.",https://github.com/bitcoin/bitcoin/pull/9768#discussion_r105061612,105061612,qa/rpc-tests/invalidateblock.py
MarcoFalke,2017-03-09T00:48:40Z,Please don't change indentation here.,https://github.com/bitcoin/bitcoin/pull/9768#discussion_r105063249,105063249,qa/rpc-tests/test_framework/mininode.py
MarcoFalke,2017-03-09T00:54:02Z,Any reason you switched the rpc handler to stderr by falling back to the default value?,https://github.com/bitcoin/bitcoin/pull/9768#discussion_r105063981,105063981,qa/rpc-tests/test_framework/test_framework.py
MarcoFalke,2017-03-09T01:05:41Z,You might need to shutdown (flush) the logs here.,https://github.com/bitcoin/bitcoin/pull/9768#discussion_r105065585,105065585,qa/rpc-tests/test_framework/test_framework.py
MarcoFalke,2017-03-09T01:06:58Z,You don't need the assert(False) when you pass any AssertionError below. Though maybe a fix for an unrelated follow up pr.,https://github.com/bitcoin/bitcoin/pull/9768#discussion_r105065752,105065752,qa/rpc-tests/p2p-segwit.py
MarcoFalke,2017-03-09T01:16:18Z,I think the print to stdout can use a formatter that produces smaller lines. (Maybe without the timestamp?) But no strong  opinion.,https://github.com/bitcoin/bitcoin/pull/9768#discussion_r105066934,105066934,qa/rpc-tests/test_framework/test_framework.py
jnewbery,2017-03-09T14:22:26Z,Done.,https://github.com/bitcoin/bitcoin/pull/9768#discussion_r105173726,105173726,qa/rpc-tests/invalidateblock.py
jnewbery,2017-03-09T14:22:34Z,Oops. Fixed.,https://github.com/bitcoin/bitcoin/pull/9768#discussion_r105173753,105173753,qa/rpc-tests/test_framework/mininode.py
jnewbery,2017-03-09T14:22:40Z,Done.,https://github.com/bitcoin/bitcoin/pull/9768#discussion_r105173776,105173776,qa/rpc-tests/test_framework/test_framework.py
jnewbery,2017-03-09T14:23:14Z,I specifically set the format of the logs to be the same as what bitcoind produces with microsecond logging.,https://github.com/bitcoin/bitcoin/pull/9768#discussion_r105173909,105173909,qa/rpc-tests/test_framework/test_framework.py
jnewbery,2017-03-09T14:23:59Z,"That's pre-existing behaviour, which is unrelated to this PR. I agree it should be fixed in a different PR.",https://github.com/bitcoin/bitcoin/pull/9768#discussion_r105174077,105174077,qa/rpc-tests/p2p-segwit.py
jnewbery,2017-03-09T14:27:08Z,No reason. Just an oversight. Now fixed.,https://github.com/bitcoin/bitcoin/pull/9768#discussion_r105174813,105174813,qa/rpc-tests/test_framework/test_framework.py
