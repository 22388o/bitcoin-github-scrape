[
  {
    "sha": "e272c26374cfb7d38af7569dbfcce12c56c271f1",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzplMjcyYzI2Mzc0Y2ZiN2QzOGFmNzU2OWRiZmNjZTEyYzU2YzI3MWYx",
    "commit": {
      "author": {
        "name": "Peter Todd",
        "email": "pete@petertodd.org",
        "date": "2015-11-30T05:11:18Z"
      },
      "committer": {
        "name": "Peter Todd",
        "email": "pete@petertodd.org",
        "date": "2016-06-15T16:52:43Z"
      },
      "message": "Add option to opt into full-RBF when sending funds",
      "tree": {
        "sha": "addc2e6f13c9acb423e08ccf95d93975afc16da0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/addc2e6f13c9acb423e08ccf95d93975afc16da0"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e272c26374cfb7d38af7569dbfcce12c56c271f1",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQEcBAABCAAGBQJXYYflAAoJEGOZARBE6K+yWfkH/1hr3KUPnlCrBS66HfZryldB\n6mLVSUpAaQt+o47vAy+aANA2yDwwzUXo1TzC2A+TR3o0KDu4b23auqv7OsGTeyTT\nwRyxa48rw1CllBsMJgjdq8D4pA+7wiIfkbDMJqcNTWjXOXC0ofrIFcZiBXwTrNLy\nrv6ObitP5K2zkN/mfCar3a8ENlcWsUIZn4Ebc272WDDVj/bXgd1BwZZQ07FIl9tj\n8hTwiqR2T02BumCgEykW9yTV/+yg/+a1AjbFSArmzovQM6eclhZqGy10VyaXe9/O\nTkVo05qFciDeatmBVyvM74AIyThx6nSg9CCVm80i+JiuzE3r95uIIuBcA+XvQ/U=\n=wbxp\n-----END PGP SIGNATURE-----",
        "payload": "tree addc2e6f13c9acb423e08ccf95d93975afc16da0\nparent fb0ac482eee761ec17ed2c11df11e054347a026d\nauthor Peter Todd <pete@petertodd.org> 1448860278 +0800\ncommitter Peter Todd <pete@petertodd.org> 1466009563 -0400\n\nAdd option to opt into full-RBF when sending funds\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e272c26374cfb7d38af7569dbfcce12c56c271f1",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/e272c26374cfb7d38af7569dbfcce12c56c271f1",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e272c26374cfb7d38af7569dbfcce12c56c271f1/comments",
    "author": {
      "login": "petertodd",
      "id": 7042,
      "node_id": "MDQ6VXNlcjcwNDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7042?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/petertodd",
      "html_url": "https://github.com/petertodd",
      "followers_url": "https://api.github.com/users/petertodd/followers",
      "following_url": "https://api.github.com/users/petertodd/following{/other_user}",
      "gists_url": "https://api.github.com/users/petertodd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/petertodd/subscriptions",
      "organizations_url": "https://api.github.com/users/petertodd/orgs",
      "repos_url": "https://api.github.com/users/petertodd/repos",
      "events_url": "https://api.github.com/users/petertodd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/petertodd/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "petertodd",
      "id": 7042,
      "node_id": "MDQ6VXNlcjcwNDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7042?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/petertodd",
      "html_url": "https://github.com/petertodd",
      "followers_url": "https://api.github.com/users/petertodd/followers",
      "following_url": "https://api.github.com/users/petertodd/following{/other_user}",
      "gists_url": "https://api.github.com/users/petertodd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/petertodd/subscriptions",
      "organizations_url": "https://api.github.com/users/petertodd/orgs",
      "repos_url": "https://api.github.com/users/petertodd/repos",
      "events_url": "https://api.github.com/users/petertodd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/petertodd/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "fb0ac482eee761ec17ed2c11df11e054347a026d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fb0ac482eee761ec17ed2c11df11e054347a026d",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/fb0ac482eee761ec17ed2c11df11e054347a026d"
      }
    ],
    "stats": {
      "total": 12,
      "additions": 9,
      "deletions": 3
    },
    "files": [
      {
        "sha": "6a3da1c276bd2a19f77a79bb4b5e7c05a07dcd37",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 6,
        "deletions": 3,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e272c26374cfb7d38af7569dbfcce12c56c271f1/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e272c26374cfb7d38af7569dbfcce12c56c271f1/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=e272c26374cfb7d38af7569dbfcce12c56c271f1",
        "patch": "@@ -40,6 +40,7 @@ CFeeRate payTxFee(DEFAULT_TRANSACTION_FEE);\n unsigned int nTxConfirmTarget = DEFAULT_TX_CONFIRM_TARGET;\n bool bSpendZeroConfChange = DEFAULT_SPEND_ZEROCONF_CHANGE;\n bool fSendFreeTransactions = DEFAULT_SEND_FREE_TRANSACTIONS;\n+bool fOptIntoFullRbf = DEFAULT_OPT_INTO_FULL_RBF;\n \n const char * DEFAULT_WALLET_DAT = \"wallet.dat\";\n const uint32_t BIP32_HARDENED_KEY_LIMIT = 0x80000000;\n@@ -2321,11 +2322,11 @@ bool CWallet::CreateTransaction(const vector<CRecipient>& vecSend, CWalletTx& wt\n \n                 // Fill vin\n                 //\n-                // Note how the sequence number is set to max()-1 so that the\n-                // nLockTime set above actually works.\n+                // Note how the sequence number is set to non-maxint so that\n+                // the nLockTime set above actually works.\n                 BOOST_FOREACH(const PAIRTYPE(const CWalletTx*,unsigned int)& coin, setCoins)\n                     txNew.vin.push_back(CTxIn(coin.first->GetHash(),coin.second,CScript(),\n-                                              std::numeric_limits<unsigned int>::max()-1));\n+                                              std::numeric_limits<unsigned int>::max() - (fOptIntoFullRbf ? 2 : 1)));\n \n                 // Sign\n                 int nIn = 0;\n@@ -3210,6 +3211,7 @@ std::string CWallet::GetWalletHelpString(bool showDebug)\n     strUsage += HelpMessageOpt(\"-spendzeroconfchange\", strprintf(_(\"Spend unconfirmed change when sending transactions (default: %u)\"), DEFAULT_SPEND_ZEROCONF_CHANGE));\n     strUsage += HelpMessageOpt(\"-txconfirmtarget=<n>\", strprintf(_(\"If paytxfee is not set, include enough fee so transactions begin confirmation on average within n blocks (default: %u)\"), DEFAULT_TX_CONFIRM_TARGET));\n     strUsage += HelpMessageOpt(\"-usehd\", _(\"Use hierarchical deterministic key generation (HD) after bip32. Only has effect during wallet creation/first start\") + \" \" + strprintf(_(\"(default: %u)\"), DEFAULT_USE_HD_WALLET));\n+    strUsage += HelpMessageOpt(\"-optintofullrbf\", strprintf(_(\"Send transactions with full-RBF opt-in enabled (default: %u)\"), DEFAULT_OPT_INTO_FULL_RBF));\n     strUsage += HelpMessageOpt(\"-upgradewallet\", _(\"Upgrade wallet to latest format on startup\"));\n     strUsage += HelpMessageOpt(\"-wallet=<file>\", _(\"Specify wallet file (within data directory)\") + \" \" + strprintf(_(\"(default: %s)\"), DEFAULT_WALLET_DAT));\n     strUsage += HelpMessageOpt(\"-walletbroadcast\", _(\"Make the wallet broadcast transactions\") + \" \" + strprintf(_(\"(default: %u)\"), DEFAULT_WALLETBROADCAST));\n@@ -3441,6 +3443,7 @@ bool CWallet::ParameterInteraction()\n     nTxConfirmTarget = GetArg(\"-txconfirmtarget\", DEFAULT_TX_CONFIRM_TARGET);\n     bSpendZeroConfChange = GetBoolArg(\"-spendzeroconfchange\", DEFAULT_SPEND_ZEROCONF_CHANGE);\n     fSendFreeTransactions = GetBoolArg(\"-sendfreetransactions\", DEFAULT_SEND_FREE_TRANSACTIONS);\n+    fOptIntoFullRbf = GetBoolArg(\"-optintofullrbf\", DEFAULT_OPT_INTO_FULL_RBF);\n \n     return true;\n }"
      },
      {
        "sha": "6f03d96c1fec436b8abe315c3337bde5d504ed65",
        "filename": "src/wallet/wallet.h",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e272c26374cfb7d38af7569dbfcce12c56c271f1/src/wallet/wallet.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e272c26374cfb7d38af7569dbfcce12c56c271f1/src/wallet/wallet.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.h?ref=e272c26374cfb7d38af7569dbfcce12c56c271f1",
        "patch": "@@ -37,6 +37,7 @@ extern CFeeRate payTxFee;\n extern unsigned int nTxConfirmTarget;\n extern bool bSpendZeroConfChange;\n extern bool fSendFreeTransactions;\n+extern bool fOptIntoFullRbf;\n \n static const unsigned int DEFAULT_KEYPOOL_SIZE = 100;\n //! -paytxfee default\n@@ -53,6 +54,8 @@ static const bool DEFAULT_SPEND_ZEROCONF_CHANGE = true;\n static const bool DEFAULT_SEND_FREE_TRANSACTIONS = false;\n //! -txconfirmtarget default\n static const unsigned int DEFAULT_TX_CONFIRM_TARGET = 2;\n+//! -optintofullrbf default\n+static const bool DEFAULT_OPT_INTO_FULL_RBF = false;\n //! Largest (in bytes) free transaction we're willing to create\n static const unsigned int MAX_FREE_TRANSACTION_CREATE_SIZE = 1000;\n static const bool DEFAULT_WALLETBROADCAST = true;"
      }
    ]
  }
]