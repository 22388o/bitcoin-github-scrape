[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/901400935",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#issuecomment-901400935",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22736",
    "id": 901400935,
    "node_id": "IC_kwDOABII5841ukln",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-18T20:15:15Z",
    "updated_at": "2021-08-18T20:15:15Z",
    "author_association": "MEMBER",
    "body": "Moving this out of draft now, ready for review.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/901400935/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/901721006",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#issuecomment-901721006",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22736",
    "id": 901721006,
    "node_id": "IC_kwDOABII5841vyuu",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-19T08:35:27Z",
    "updated_at": "2021-08-19T08:35:27Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#20487](https://github.com/bitcoin/bitcoin/pull/20487) (Add syscall sandboxing using seccomp-bpf (Linux secure computing mode) by practicalswift)\n* [#16365](https://github.com/bitcoin/bitcoin/pull/16365) (Log RPC parameters (arguments) if -debug=rpcparams by LarryRuane)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/901721006/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/901980815",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#issuecomment-901980815",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22736",
    "id": 901980815,
    "node_id": "IC_kwDOABII5841wyKP",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-19T14:50:46Z",
    "updated_at": "2021-08-19T14:50:46Z",
    "author_association": "MEMBER",
    "body": "Code review ACK ccd73de1dd969097d34634c2be2fc32b03fbd09e",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/901980815/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/902262386",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#issuecomment-902262386",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22736",
    "id": 902262386,
    "node_id": "IC_kwDOABII5841x25y",
    "user": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?u=5ff13e375b40ea55ecd3c108337dd6a23f68eddf&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-19T21:32:09Z",
    "updated_at": "2021-08-19T21:32:09Z",
    "author_association": "CONTRIBUTOR",
    "body": "Concept ACK\r\n\r\nNice idea. I've used something similar in my local tree when analysing lock contention locally.\r\n\r\nNon-blocking suggestions:\r\n* In my version I printed the duration too to make it clear from the log entry if the lock contention was significant or not. Perhaps worth adding here too?\r\n* In addition to `__FILE__` and `__LINE__` it would be nice to have `__FUNCTION__` printed as part of the log message too.\r\n\r\nTo rule out any accidental performance regressions: would it be possible to benchmark before vs after this PR (with and without `-debug=lock`) in some intelligent way?\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/902262386/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/902315324",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#issuecomment-902315324",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22736",
    "id": 902315324,
    "node_id": "IC_kwDOABII5841yD08",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-19T23:20:40Z",
    "updated_at": "2021-08-20T10:05:58Z",
    "author_association": "MEMBER",
    "body": "> In my version I printed the duration too to make it clear from the log entry if the lock contention was significant or not. Perhaps worth adding here too?\r\n> \r\n> In addition to `__FILE__` and `__LINE__` it would be nice to have `__FUNCTION__` printed as part of the log message too.\r\n\r\nI think I'd need your help (propose a commit to pull in?) or you could do it as a follow-up.\r\n \r\n> To rule out any accidental performance regressions: would it be possible to benchmark before vs after this PR (with and without `-debug=lock`) in some intelligent way?\r\n\r\nI'll look.  Without `-debug=lock` it should be the same, and I'm not sure anyone besides developers would use the lock logging; it's still fairly verbose. In the worst case I suppose we could add a warning in the RPC logging help.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/902315324/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/902316418",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#issuecomment-902316418",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22736",
    "id": 902316418,
    "node_id": "IC_kwDOABII5841yEGC",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-19T23:23:37Z",
    "updated_at": "2021-08-19T23:23:37Z",
    "author_association": "MEMBER",
    "body": "@laanwj: following up on our IRC convo in `#bitcoin-core-builds`, as a test just pushed a version with the `HAVE_THREAD_LOCAL` conditional compilation directives removed to see what happens...",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/902316418/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/902567823",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#issuecomment-902567823",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22736",
    "id": 902567823,
    "node_id": "IC_kwDOABII5841zBeP",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-20T09:35:57Z",
    "updated_at": "2021-08-22T17:03:32Z",
    "author_association": "MEMBER",
    "body": "To-do:\r\n- <strike>add a smoke test with -debug=lock</strike>\r\n- <strike>do some invocation frequency checks and research</strike>\r\n- try benchmarking Mutex::UniqueLock `lock()` versus `try_lock()` and the overhead of `LogAcceptCategory(BCLog::LOCK)`, which evaluates to `m_categories.load(std::memory_order_relaxed) & category) != 0`",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/902567823/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/902594037",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#issuecomment-902594037",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22736",
    "id": 902594037,
    "node_id": "IC_kwDOABII5841zH31",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-20T10:22:09Z",
    "updated_at": "2021-08-20T10:22:09Z",
    "author_association": "MEMBER",
    "body": "> add a smoke test with -debug=lock\r\n\r\nShouldn't this be enabled in the functional test already by default?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/902594037/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/902672708",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#issuecomment-902672708",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22736",
    "id": 902672708,
    "node_id": "IC_kwDOABII5841zbFE",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-20T12:55:25Z",
    "updated_at": "2021-08-20T12:55:25Z",
    "author_association": "MEMBER",
    "body": "> Shouldn't this be enabled in the functional test already by default?\r\n\r\nYou're right, TIL.  I was thinking of adding something like this assertion but probably not worth it or reliable enough:\r\n\r\n```python3\r\n        with node.assert_debug_log(expected_msgs=[\"Lock contention: cs_main\"]):\r\n            node.generate(COINBASE_MATURITY)\r\n```\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/902672708/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/902815225",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#issuecomment-902815225",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22736",
    "id": 902815225,
    "node_id": "IC_kwDOABII5841z935",
    "user": {
      "login": "theStack",
      "id": 91535,
      "node_id": "MDQ6VXNlcjkxNTM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theStack",
      "html_url": "https://github.com/theStack",
      "followers_url": "https://api.github.com/users/theStack/followers",
      "following_url": "https://api.github.com/users/theStack/following{/other_user}",
      "gists_url": "https://api.github.com/users/theStack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theStack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
      "organizations_url": "https://api.github.com/users/theStack/orgs",
      "repos_url": "https://api.github.com/users/theStack/repos",
      "events_url": "https://api.github.com/users/theStack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theStack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-20T16:33:26Z",
    "updated_at": "2021-08-20T16:33:26Z",
    "author_association": "CONTRIBUTOR",
    "body": "Concept ACK",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/902815225/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/902851054",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#issuecomment-902851054",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22736",
    "id": 902851054,
    "node_id": "IC_kwDOABII58410Gnu",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-20T17:38:09Z",
    "updated_at": "2021-08-20T22:33:20Z",
    "author_association": "MEMBER",
    "body": "Observations\r\n\r\n- `void Mutex::UniqueLock::lock()` acquires the mutex and blocks until it gains access to it\r\n\r\n- `bool Mutex::UniqueLock::try_lock()` doesn't block but instead immediately returns whether it acquired the mutex; it may be used by `lock()` internally as part of the deadlock-avoidance algorithm\r\n\r\n- IIUC the test-and-set logic of these calls is ~constant time, optimised and light/quick if used carefully (i.e. no mutex convoying), compared to system calls, memory/cache coherency and fences, wait queues, lock contentions\r\n\r\n- added the following patch and tested a regular, non-debug clang 13 build of bitcoind synced on mainnet\r\n```diff\r\n        if (LogAcceptCategory(BCLog::LOCK)) {\r\n             if (!Base::try_lock()) {\r\n                 LogPrintf(\"Lock contention: %s, %s:%d\\n\", pszName, pszFile, nLine);\r\n                 Base::lock();\r\n+            } else {\r\n+                LogPrintf(\"No lock contention\\n\");\r\n             }\r\n```\r\n \r\n- with this, I'm seeing `src/sync.h::UniqueLock::Enter()` invoked 2500-5000 times per minute, sampled roughly an hour after startup\r\n\r\n- of those, `try_lock()` returns true 99.26% to 99.91% of the time. In the true case the lock logging should have essentially the same performance as when the lock logging is off\r\n\r\n- thus 0.09% to 0.74% of the time `try_lock()` returns false, the contention is logged and `lock()` is then called, in which case the additional overhead compared to `lock()` alone, if any (~depending on how long the mutex was blocked), is of trying the lock and initially returning false\r\n\r\n- Overall, lock contention seems to be relatively infrequent as a percentage of locks. I'm seeing a few per minute. The most common one I see is `cs_vNodes` in `net.cpp::2242/2277::ThreadMessageHandler`.\r\n\r\nEdit: recalculated the numbers and updated.\r\n\r\nSome resources:\r\n- https://preshing.com/20111118/locks-arent-slow-lock-contention-is/\r\n- https://travisdowns.github.io/blog/2020/07/06/concurrency-costs.html\r\n- https://probablydance.com/2019/12/30/measuring-mutexes-spinlocks-and-how-bad-the-linux-scheduler-really-is/\r\n- https://stackoverflow.com/questions/3652056/how-efficient-is-locking-an-unlocked-mutex-what-is-the-cost-of-a-mutex\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/902851054/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910035766",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#issuecomment-910035766",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22736",
    "id": 910035766,
    "node_id": "IC_kwDOABII5842Pgs2",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-01T07:57:14Z",
    "updated_at": "2021-09-01T07:57:14Z",
    "author_association": "MEMBER",
    "body": "Concept ACK.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910035766/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910063200",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#issuecomment-910063200",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22736",
    "id": 910063200,
    "node_id": "IC_kwDOABII5842PnZg",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-01T08:31:22Z",
    "updated_at": "2021-09-01T08:32:07Z",
    "author_association": "MEMBER",
    "body": ">     * benchmarking ... the overhead of `LogAcceptCategory(BCLog::LOCK)`, which evaluates to `m_categories.load(std::memory_order_relaxed) & category) != 0`\r\n\r\nI think the benchmarking results could depend on a platform.\r\n\r\nCould we sacrifice the ability to turn \"lock\" debugging on/off at runtime, and use just a const?\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910063200/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910102088",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#issuecomment-910102088",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22736",
    "id": 910102088,
    "node_id": "IC_kwDOABII5842Pw5I",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-01T09:23:36Z",
    "updated_at": "2021-09-01T09:23:36Z",
    "author_association": "MEMBER",
    "body": "> Could we sacrifice the ability to turn \"lock\" debugging on/off at runtime, and use just a const?\r\n\r\nI could be wrong, and this goes way beyond my competence, but readings suggest that these options are low-level, fast, and near constant time compared to system calls, memory/cache coherency and fences, wait queues and (particularly) lock contentions.  (Would a difference be apparent in, say, https://bitcoinperf.com? I don't know, but if this helps us reduce contentions, that may be a win. @jamesob, @0xB10C, @martinus thoughts?)",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910102088/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910102353",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#issuecomment-910102353",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22736",
    "id": 910102353,
    "node_id": "IC_kwDOABII5842Pw9R",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-01T09:23:55Z",
    "updated_at": "2021-09-01T09:23:55Z",
    "author_association": "MEMBER",
    "body": "> > Could we sacrifice the ability to turn \"lock\" debugging on/off at runtime, and use just a const?\r\n> \r\n> I could be wrong, and this goes way beyond my competence, but readings suggest that these options are low-level, fast, and near constant time compared to system calls, memory/cache coherency and fences, wait queues and (particularly) lock contentions. Would a difference be apparent in, say, https://bitcoinperf.com? I don't know, but if this helps us reduce contentions, that may be a win.\r\n\r\nAnd `m_categories.load(std::memory_order_relaxed)` could cause cache lines switching, no?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910102353/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910110140",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#issuecomment-910110140",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22736",
    "id": 910110140,
    "node_id": "IC_kwDOABII5842Py28",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-01T09:33:23Z",
    "updated_at": "2021-09-01T09:36:41Z",
    "author_association": "MEMBER",
    "body": "> And `m_categories.load(std::memory_order_relaxed)` could cause cache lines switching, no?\r\n\r\nAlternative version:\r\n```cpp\r\n    void Enter(const char* pszName, const char* pszFile, int nLine)\r\n    {\r\n        EnterCritical(pszName, pszFile, nLine, Base::mutex());\r\n        if (Base::try_lock()) return;\r\n        Base::lock();\r\n        LogPrint(BCLog::LOCK, \"Lock contention: %s, %s:%d\\n\", pszName, pszFile, nLine);\r\n    }\r\n```\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910110140/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910114980",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#issuecomment-910114980",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22736",
    "id": 910114980,
    "node_id": "IC_kwDOABII5842P0Ck",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-01T09:40:20Z",
    "updated_at": "2021-09-01T09:54:35Z",
    "author_association": "MEMBER",
    "body": "> > And `m_categories.load(std::memory_order_relaxed)` could cause cache lines switching, no?\r\n> \r\n> Alternative version:\r\n> \r\n> ```c++\r\n>     void Enter(const char* pszName, const char* pszFile, int nLine)\r\n>     {\r\n>         EnterCritical(pszName, pszFile, nLine, Base::mutex());\r\n>         if (Base::try_lock()) return;\r\n>         Base::lock();\r\n>         LogPrint(BCLog::LOCK, \"Lock contention: %s, %s:%d\\n\", pszName, pszFile, nLine);\r\n>     }\r\n> ```\r\n\r\nNice!\r\n\r\nMaybe put logging before the blocking call `Base::lock();` as it is now? The `LogPrint` call takes some time, and it could increase probability of releasing a mutex by another thread before the `Base::lock()` call.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910114980/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910149515",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#issuecomment-910149515",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22736",
    "id": 910149515,
    "node_id": "IC_kwDOABII5842P8eL",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-01T10:25:50Z",
    "updated_at": "2021-09-01T10:25:50Z",
    "author_association": "MEMBER",
    "body": "> And `m_categories.load(std::memory_order_relaxed)` could cause cache lines switching, no?\r\n\r\nI don't know.\r\n\r\n> Maybe put logging before the blocking call `Base::lock();` as it is now? The `LogPrint` call takes some time, and it could increase probability of releasing a mutex by another thread before the `Base::lock()` call.\r\n\r\nSeems like a good idea--done.\r\n\r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910149515/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910162337",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#issuecomment-910162337",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22736",
    "id": 910162337,
    "node_id": "IC_kwDOABII5842P_mh",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-01T10:46:05Z",
    "updated_at": "2021-09-01T10:46:05Z",
    "author_association": "MEMBER",
    "body": "> as a follow up?\r\n\r\nThanks--was about to re-push to drop the third commit. Will try your suggestion before re-pushing.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910162337/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910163668",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#issuecomment-910163668",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22736",
    "id": 910163668,
    "node_id": "IC_kwDOABII5842P_7U",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-01T10:48:13Z",
    "updated_at": "2021-09-01T10:48:13Z",
    "author_association": "MEMBER",
    "body": "> > as a follow up?\r\n> \r\n> Thanks--was about to re-push to drop the third commit. Will try your suggestion before re-pushing.\r\n\r\nMy only concerns are about wording -- \"Enter: Lock contention: cs_vNodes, net.cpp:2242 completed (0.07ms)\" -- \"contention completed\"?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910163668/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910176459",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#issuecomment-910176459",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22736",
    "id": 910176459,
    "node_id": "IC_kwDOABII5842QDDL",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-01T11:06:42Z",
    "updated_at": "2021-09-01T11:39:26Z",
    "author_association": "MEMBER",
    "body": "> My only concerns are about wording -- \"Enter: Lock contention: cs_vNodes, net.cpp:2242 completed (0.07ms)\" -- \"contention completed\"?\r\n\r\nI'm seeing the following (all of the times are 0.00ms or 0.01ms so far, and seems I should remove \"PrintLockContention\" or \"Lock Contention\" from the log output now)\r\n```\r\n2021-09-01T11:03:59Z PrintLockContention: Lock contention: cs_main, net_processing.cpp:1476 started\r\n2021-09-01T11:03:59Z PrintLockContention: Lock contention: cs_main, net_processing.cpp:1476 completed (0.00ms)\r\n2021-09-01T11:03:59Z PrintLockContention: Lock contention: cs_vNodes, net.cpp:2242 started\r\n2021-09-01T11:03:59Z PrintLockContention: Lock contention: cs_vNodes, net.cpp:2242 completed (0.01ms)\r\n```\r\n\r\n`timer.h::LOG_TIME_MILLIS_WITH_CATEGORY` times the execution of the whole Enter() function, the placement of `Base::lock();` doesn't matter for it?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910176459/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910198774",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#issuecomment-910198774",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22736",
    "id": 910198774,
    "node_id": "IC_kwDOABII5842QIf2",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-01T11:34:29Z",
    "updated_at": "2021-09-01T12:59:19Z",
    "author_association": "MEMBER",
    "body": "<details><summary>How about microseconds?</summary><p>\r\n\r\n```diff\r\ndiff --git a/src/logging/timer.h b/src/logging/timer.h\r\nindex 159920e397..cadfe395ee 100644\r\n--- a/src/logging/timer.h\r\n+++ b/src/logging/timer.h\r\n@@ -93,6 +93,8 @@ private:\r\n } // namespace BCLog\r\n \r\n \r\n+#define LOG_TIME_MICROS_WITH_CATEGORY(end_msg, log_category) \\\r\n+    BCLog::Timer<std::chrono::microseconds> PASTE2(logging_timer, __COUNTER__)(__func__, end_msg, log_category)\r\n #define LOG_TIME_MILLIS_WITH_CATEGORY(end_msg, log_category) \\\r\n     BCLog::Timer<std::chrono::milliseconds> PASTE2(logging_timer, __COUNTER__)(__func__, end_msg, log_category)\r\n #define LOG_TIME_SECONDS(end_msg) \\\r\ndiff --git a/src/sync.cpp b/src/sync.cpp\r\nindex a7b63ea986..eace86d9dd 100644\r\n--- a/src/sync.cpp\r\n+++ b/src/sync.cpp\r\n@@ -24,9 +24,9 @@\r\n #include <utility>\r\n #include <vector>\r\n \r\n-void PrintLockContention(const char* pszName, const char* pszFile, int nLine)\r\n+void LockContention(const char* pszName, const char* pszFile, int nLine)\r\n {\r\n-    LOG_TIME_MILLIS_WITH_CATEGORY(strprintf(\"%s, %s:%d\", pszName, pszFile, nLine), BCLog::LOCK);\r\n+    LOG_TIME_MICROS_WITH_CATEGORY(strprintf(\"%s, %s:%d\", pszName, pszFile, nLine), BCLog::LOCK);\r\n }\r\n \r\n #ifdef DEBUG_LOCKORDER\r\ndiff --git a/src/sync.h b/src/sync.h\r\nindex 252dc95845..0a8ec9e58f 100644\r\n--- a/src/sync.h\r\n+++ b/src/sync.h\r\n@@ -126,7 +126,8 @@ using RecursiveMutex = AnnotatedMixin<std::recursive_mutex>;\r\n /** Wrapped mutex: supports waiting but not recursive locking */\r\n typedef AnnotatedMixin<std::mutex> Mutex;\r\n \r\n-void PrintLockContention(const char* pszName, const char* pszFile, int nLine);\r\n+/** Print a lock contention to the log */\r\n+void LockContention(const char* pszName, const char* pszFile, int nLine);\r\n \r\n /** Wrapper around std::unique_lock style lock for Mutex. */\r\n template <typename Mutex, typename Base = typename Mutex::UniqueLock>\r\n@@ -137,7 +138,7 @@ private:\r\n     {\r\n         EnterCritical(pszName, pszFile, nLine, Base::mutex());\r\n         if (Base::try_lock()) return;\r\n-        PrintLockContention(pszName, pszFile, nLine);\r\n+        LockContention(pszName, pszFile, nLine);\r\n         Base::lock();\r\n     }\r\n```\r\n</p></details>\r\n\r\n```\r\n2021-09-01T11:29:03Z LockContention: cs_vNodes, net.cpp:1251 started\r\n2021-09-01T11:29:03Z LockContention: cs_vNodes, net.cpp:1251 completed (5\u03bcs)\r\n2021-09-01T11:29:03Z LockContention: pnode->cs_vSend, net.cpp:1373 started\r\n2021-09-01T11:29:03Z LockContention: pnode->cs_vSend, net.cpp:1373 completed (31\u03bcs)\r\n2021-09-01T11:29:03Z LockContention: cs_vNodes, net.cpp:2277 started\r\n2021-09-01T11:29:03Z LockContention: cs_vNodes, net.cpp:2277 completed (6\u03bcs)\r\n2021-09-01T11:29:04Z LockContention: cs_vNodes, net.cpp:2242 started\r\n2021-09-01T11:29:04Z LockContention: cs_vNodes, net.cpp:2242 completed (3\u03bcs)\r\n```\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910198774/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910206514",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#issuecomment-910206514",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22736",
    "id": 910206514,
    "node_id": "IC_kwDOABII5842QKYy",
    "user": {
      "login": "martinus",
      "id": 14386,
      "node_id": "MDQ6VXNlcjE0Mzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/14386?u=da89313ed4793f9594c09c23513f49aa4dc1c141&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/martinus",
      "html_url": "https://github.com/martinus",
      "followers_url": "https://api.github.com/users/martinus/followers",
      "following_url": "https://api.github.com/users/martinus/following{/other_user}",
      "gists_url": "https://api.github.com/users/martinus/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/martinus/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/martinus/subscriptions",
      "organizations_url": "https://api.github.com/users/martinus/orgs",
      "repos_url": "https://api.github.com/users/martinus/repos",
      "events_url": "https://api.github.com/users/martinus/events{/privacy}",
      "received_events_url": "https://api.github.com/users/martinus/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-01T11:47:07Z",
    "updated_at": "2021-09-01T11:47:07Z",
    "author_association": "CONTRIBUTOR",
    "body": "> And `m_categories.load(std::memory_order_relaxed)` could cause cache lines switching, no?\r\n\r\nyes, the only guarantee with `memory_order_relaxed` is that the operation itself is atomic, but other operations are allowed to be  shuffled that by the compiler. I personally try to avoid using any of the memory order stuff. It's too easy to get wrong. \r\n\r\nBy the way, I think that in that patch: \r\n\r\n```patch\r\n        if (LogAcceptCategory(BCLog::LOCK)) {\r\n             if (!Base::try_lock()) {\r\n                 LogPrintf(\"Lock contention: %s, %s:%d\\n\", pszName, pszFile, nLine);\r\n                 Base::lock();\r\n+            } else {\r\n+                LogPrintf(\"No lock contention\\n\");\r\n             }\r\n```\r\n\r\nIf `Base::try_lock()` fails strictly speaking that does not necessarily mean that there's a lock contention. `std::mutex`'s `try_lock()` can also spuriously fail even when no other thread is currently holding a lock: https://en.cppreference.com/w/cpp/thread/mutex/try_lock I have no idea though how often that can happen.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910206514/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910280351",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#issuecomment-910280351",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22736",
    "id": 910280351,
    "node_id": "IC_kwDOABII5842Qcaf",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-01T13:21:24Z",
    "updated_at": "2021-09-01T14:51:20Z",
    "author_association": "MEMBER",
    "body": "Thanks for the ideas and feedback. Updates:\r\n\r\n- added a timing macro in microseconds, `LOG_TIME_MICROS_WITH_CATEGORY`\r\n- improved `BCLog::LogMsg()` to omit irrelevant decimals for microseconds and skip unnecessary code/math\r\n- added time duration in microseconds to the lock contention logging\r\n\r\n> If `Base::try_lock()` fails strictly speaking that does not necessarily mean that there's a lock contention. `std::mutex`'s `try_lock()` can also spuriously fail even when no other thread is currently holding a lock: [en.cppreference.com/w/cpp/thread/mutex/try_lock](https://en.cppreference.com/w/cpp/thread/mutex/try_lock). I have no idea though how often that can happen.\r\n\r\nGood point. I read that doc previously and admit to discounting the spurious failures a little, as we don't know the frequency.  It seems to be an additional reason to log the contention duration.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910280351/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/913133555",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#issuecomment-913133555",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22736",
    "id": 913133555,
    "node_id": "IC_kwDOABII5842bU_z",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-05T11:14:24Z",
    "updated_at": "2021-09-05T11:14:24Z",
    "author_association": "MEMBER",
    "body": "Thanks for testing! For me, there seems to be a higher frequency of contention and occuring in more places on mainnet than on signet, presumably as the scale/numbers are larger. Also, a big difference in contention durations between a regular build and a debug build, which makes sense.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/913133555/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691277896",
    "pull_request_review_id": 732919180,
    "id": 691277896,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTI3Nzg5Ng==",
    "diff_hunk": "@@ -138,14 +137,10 @@ class SCOPED_LOCKABLE UniqueLock : public Base\n     void Enter(const char* pszName, const char* pszFile, int nLine)\n     {\n         EnterCritical(pszName, pszFile, nLine, Base::mutex());\n-#ifdef DEBUG_LOCKCONTENTION\n         if (!Base::try_lock()) {",
    "path": "src/sync.h",
    "position": null,
    "original_position": 27,
    "commit_id": "7e698732836121912f179b7c743a72dd6fdffa72",
    "original_commit_id": "6f6abbe7d735b5a2622df9b5c971cccbca93b886",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I am somewhat worried that the extra calls to `Base::try_lock` cause performance overhead in the non-lock contention debugging case. It's unnecessary. We might want to gate *that too* on the log category being enabled.",
    "created_at": "2021-08-18T14:11:34Z",
    "updated_at": "2021-08-18T14:13:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r691277896",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691277896"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r691277896"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691277896/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 140,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691280693",
    "pull_request_review_id": 732923029,
    "id": 691280693,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTI4MDY5Mw==",
    "diff_hunk": "@@ -138,14 +137,10 @@ class SCOPED_LOCKABLE UniqueLock : public Base\n     void Enter(const char* pszName, const char* pszFile, int nLine)\n     {\n         EnterCritical(pszName, pszFile, nLine, Base::mutex());\n-#ifdef DEBUG_LOCKCONTENTION\n         if (!Base::try_lock()) {",
    "path": "src/sync.h",
    "position": null,
    "original_position": 27,
    "commit_id": "7e698732836121912f179b7c743a72dd6fdffa72",
    "original_commit_id": "6f6abbe7d735b5a2622df9b5c971cccbca93b886",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks, wondering that as well (or alternatively, leave the directives in place and just improve the logging experience when `DEBUG_LOCKCONTENTION` is defined).",
    "created_at": "2021-08-18T14:14:42Z",
    "updated_at": "2021-08-18T14:14:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r691280693",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691280693"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r691280693"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691280693/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 140,
    "side": "RIGHT",
    "in_reply_to_id": 691277896
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691487999",
    "pull_request_review_id": 733201598,
    "id": 691487999,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTQ4Nzk5OQ==",
    "diff_hunk": "@@ -138,14 +137,10 @@ class SCOPED_LOCKABLE UniqueLock : public Base\n     void Enter(const char* pszName, const char* pszFile, int nLine)\n     {\n         EnterCritical(pszName, pszFile, nLine, Base::mutex());\n-#ifdef DEBUG_LOCKCONTENTION\n         if (!Base::try_lock()) {",
    "path": "src/sync.h",
    "position": null,
    "original_position": 27,
    "commit_id": "7e698732836121912f179b7c743a72dd6fdffa72",
    "original_commit_id": "6f6abbe7d735b5a2622df9b5c971cccbca93b886",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Implemented your suggestion (thanks!)\r\n\r\n(Behind the gate it could now be just `LogPrintf` if anyone prefers.)",
    "created_at": "2021-08-18T18:03:48Z",
    "updated_at": "2021-08-18T18:18:57Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r691487999",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691487999"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r691487999"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691487999/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 140,
    "side": "RIGHT",
    "in_reply_to_id": 691277896
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/692383717",
    "pull_request_review_id": 734334313,
    "id": 692383717,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MjM4MzcxNw==",
    "diff_hunk": "@@ -6,7 +6,10 @@\n #ifndef BITCOIN_SYNC_H\n #define BITCOIN_SYNC_H\n \n+#include <logging.h>\n #include <threadsafety.h>\n+#include <tinyformat.h>\n+#include <util/strencodings.h>",
    "path": "src/sync.h",
    "position": null,
    "original_position": 7,
    "commit_id": "7e698732836121912f179b7c743a72dd6fdffa72",
    "original_commit_id": "ccd73de1dd969097d34634c2be2fc32b03fbd09e",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "why are those includes needed?",
    "created_at": "2021-08-19T18:29:56Z",
    "updated_at": "2021-08-19T18:37:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r692383717",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/692383717"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r692383717"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/692383717/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 12,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/692388102",
    "pull_request_review_id": 734334313,
    "id": 692388102,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MjM4ODEwMg==",
    "diff_hunk": "@@ -6,7 +6,10 @@\n #ifndef BITCOIN_SYNC_H\n #define BITCOIN_SYNC_H\n \n+#include <logging.h>",
    "path": "src/sync.h",
    "position": null,
    "original_position": 4,
    "commit_id": "7e698732836121912f179b7c743a72dd6fdffa72",
    "original_commit_id": "ccd73de1dd969097d34634c2be2fc32b03fbd09e",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: If `PrintLockContention` stayed in the cpp file, this include can be avoided (it indirectly includes the heavy filesystem header).",
    "created_at": "2021-08-19T18:36:38Z",
    "updated_at": "2021-08-19T18:37:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r692388102",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/692388102"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r692388102"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/692388102/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 9,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/692550022",
    "pull_request_review_id": 734543340,
    "id": 692550022,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MjU1MDAyMg==",
    "diff_hunk": "@@ -6,7 +6,10 @@\n #ifndef BITCOIN_SYNC_H\n #define BITCOIN_SYNC_H\n \n+#include <logging.h>\n #include <threadsafety.h>\n+#include <tinyformat.h>\n+#include <util/strencodings.h>",
    "path": "src/sync.h",
    "position": null,
    "original_position": 7,
    "commit_id": "7e698732836121912f179b7c743a72dd6fdffa72",
    "original_commit_id": "ccd73de1dd969097d34634c2be2fc32b03fbd09e",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "dropped",
    "created_at": "2021-08-19T23:11:47Z",
    "updated_at": "2021-08-19T23:11:47Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r692550022",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/692550022"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r692550022"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/692550022/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 12,
    "side": "RIGHT",
    "in_reply_to_id": 692383717
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/692550796",
    "pull_request_review_id": 734544299,
    "id": 692550796,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MjU1MDc5Ng==",
    "diff_hunk": "@@ -6,7 +6,10 @@\n #ifndef BITCOIN_SYNC_H\n #define BITCOIN_SYNC_H\n \n+#include <logging.h>",
    "path": "src/sync.h",
    "position": null,
    "original_position": 4,
    "commit_id": "7e698732836121912f179b7c743a72dd6fdffa72",
    "original_commit_id": "ccd73de1dd969097d34634c2be2fc32b03fbd09e",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Good point, though we would have to essentially move `UniqueLock::Enter()` to the cpp file, due to calling `LogAcceptCategory(BCLog::LOCK)`. Punting on this for now.",
    "created_at": "2021-08-19T23:14:07Z",
    "updated_at": "2021-08-19T23:14:07Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r692550796",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/692550796"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r692550796"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/692550796/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 9,
    "side": "RIGHT",
    "in_reply_to_id": 692388102
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/699989239",
    "pull_request_review_id": 743622555,
    "id": 699989239,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5OTk4OTIzOQ==",
    "diff_hunk": "@@ -138,14 +135,14 @@ class SCOPED_LOCKABLE UniqueLock : public Base\n     void Enter(const char* pszName, const char* pszFile, int nLine)\n     {\n         EnterCritical(pszName, pszFile, nLine, Base::mutex());\n-#ifdef DEBUG_LOCKCONTENTION\n-        if (!Base::try_lock()) {\n-            PrintLockContention(pszName, pszFile, nLine);\n-#endif\n+        if (LogAcceptCategory(BCLog::LOCK)) {\n+            if (!Base::try_lock()) {\n+                LogPrintf(\"Lock contention: %s, %s:%d\\n\", pszName, pszFile, nLine);\n+                Base::lock();\n+            }\n+        } else {",
    "path": "src/sync.h",
    "position": null,
    "original_position": 32,
    "commit_id": "7e698732836121912f179b7c743a72dd6fdffa72",
    "original_commit_id": "6e7b6bfee377cdb1ea700af8084b08f79cbe5ee5",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\n        if (LogAcceptCategory(BCLog::LOCK) && !Base::try_lock()) {\r\n            LogPrintf(\"Lock contention: %s, %s:%d\\n\", pszName, pszFile, nLine);\r\n        }\r\n```\r\n\r\n?",
    "created_at": "2021-09-01T08:19:05Z",
    "updated_at": "2021-09-01T08:19:06Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r699989239",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/699989239"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r699989239"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/699989239/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 138,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 143,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700028085",
    "pull_request_review_id": 743674807,
    "id": 700028085,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMDAyODA4NQ==",
    "diff_hunk": "@@ -138,14 +135,14 @@ class SCOPED_LOCKABLE UniqueLock : public Base\n     void Enter(const char* pszName, const char* pszFile, int nLine)\n     {\n         EnterCritical(pszName, pszFile, nLine, Base::mutex());\n-#ifdef DEBUG_LOCKCONTENTION\n-        if (!Base::try_lock()) {\n-            PrintLockContention(pszName, pszFile, nLine);\n-#endif\n+        if (LogAcceptCategory(BCLog::LOCK)) {\n+            if (!Base::try_lock()) {\n+                LogPrintf(\"Lock contention: %s, %s:%d\\n\", pszName, pszFile, nLine);\n+                Base::lock();\n+            }\n+        } else {",
    "path": "src/sync.h",
    "position": null,
    "original_position": 32,
    "commit_id": "7e698732836121912f179b7c743a72dd6fdffa72",
    "original_commit_id": "6e7b6bfee377cdb1ea700af8084b08f79cbe5ee5",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks. If I understand the suggestion, this would only lock if the lock logging is on and `try_lock()` succeeds.",
    "created_at": "2021-09-01T09:09:23Z",
    "updated_at": "2021-09-01T09:09:24Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r700028085",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700028085"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r700028085"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700028085/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 138,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 143,
    "side": "RIGHT",
    "in_reply_to_id": 699989239
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700030470",
    "pull_request_review_id": 743677963,
    "id": 700030470,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMDAzMDQ3MA==",
    "diff_hunk": "@@ -138,14 +135,14 @@ class SCOPED_LOCKABLE UniqueLock : public Base\n     void Enter(const char* pszName, const char* pszFile, int nLine)\n     {\n         EnterCritical(pszName, pszFile, nLine, Base::mutex());\n-#ifdef DEBUG_LOCKCONTENTION\n-        if (!Base::try_lock()) {\n-            PrintLockContention(pszName, pszFile, nLine);\n-#endif\n+        if (LogAcceptCategory(BCLog::LOCK)) {\n+            if (!Base::try_lock()) {\n+                LogPrintf(\"Lock contention: %s, %s:%d\\n\", pszName, pszFile, nLine);\n+                Base::lock();\n+            }\n+        } else {",
    "path": "src/sync.h",
    "position": null,
    "original_position": 32,
    "commit_id": "7e698732836121912f179b7c743a72dd6fdffa72",
    "original_commit_id": "6e7b6bfee377cdb1ea700af8084b08f79cbe5ee5",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```cpp\r\n    void Enter(const char* pszName, const char* pszFile, int nLine)\r\n    {\r\n        EnterCritical(pszName, pszFile, nLine, Base::mutex());\r\n        if (LogAcceptCategory(BCLog::LOCK) && !Base::try_lock()) {\r\n            LogPrintf(\"Lock contention: %s, %s:%d\\n\", pszName, pszFile, nLine);\r\n        }\r\n        Base::lock();\r\n    }\r\n```",
    "created_at": "2021-09-01T09:12:27Z",
    "updated_at": "2021-09-01T09:12:27Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r700030470",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700030470"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r700030470"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700030470/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 138,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 143,
    "side": "RIGHT",
    "in_reply_to_id": 699989239
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700035169",
    "pull_request_review_id": 743684310,
    "id": 700035169,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMDAzNTE2OQ==",
    "diff_hunk": "@@ -138,14 +135,14 @@ class SCOPED_LOCKABLE UniqueLock : public Base\n     void Enter(const char* pszName, const char* pszFile, int nLine)\n     {\n         EnterCritical(pszName, pszFile, nLine, Base::mutex());\n-#ifdef DEBUG_LOCKCONTENTION\n-        if (!Base::try_lock()) {\n-            PrintLockContention(pszName, pszFile, nLine);\n-#endif\n+        if (LogAcceptCategory(BCLog::LOCK)) {\n+            if (!Base::try_lock()) {\n+                LogPrintf(\"Lock contention: %s, %s:%d\\n\", pszName, pszFile, nLine);\n+                Base::lock();\n+            }\n+        } else {",
    "path": "src/sync.h",
    "position": null,
    "original_position": 32,
    "commit_id": "7e698732836121912f179b7c743a72dd6fdffa72",
    "original_commit_id": "6e7b6bfee377cdb1ea700af8084b08f79cbe5ee5",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nm, my suggestion is wrong.",
    "created_at": "2021-09-01T09:18:47Z",
    "updated_at": "2021-09-01T09:18:47Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r700035169",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700035169"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r700035169"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700035169/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 138,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 143,
    "side": "RIGHT",
    "in_reply_to_id": 699989239
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700095417",
    "pull_request_review_id": 743766642,
    "id": 700095417,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMDA5NTQxNw==",
    "diff_hunk": "@@ -6,7 +6,10 @@\n #ifndef BITCOIN_SYNC_H\n #define BITCOIN_SYNC_H\n \n+#include <logging.h>",
    "path": "src/sync.h",
    "position": null,
    "original_position": 4,
    "commit_id": "7e698732836121912f179b7c743a72dd6fdffa72",
    "original_commit_id": "ccd73de1dd969097d34634c2be2fc32b03fbd09e",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> nit: If `PrintLockContention` stayed in the cpp file, this include can be avoided (it indirectly includes the heavy filesystem header).\r\n\r\nagree, dropped the commit changing this",
    "created_at": "2021-09-01T10:44:14Z",
    "updated_at": "2021-09-01T10:44:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r700095417",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700095417"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r700095417"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700095417/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 9,
    "side": "RIGHT",
    "in_reply_to_id": 692388102
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702747920",
    "pull_request_review_id": 747015764,
    "id": 702747920,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjc0NzkyMA==",
    "diff_hunk": "@@ -58,12 +58,14 @@ class Timer\n             return strprintf(\"%s: %s\", m_prefix, msg);\n         }\n \n-        std::string units = \"\";\n+        if (std::is_same<TimeType, std::chrono::microseconds>::value) {\n+            return strprintf(\"%s: %s (%i\u03bcs)\", m_prefix, msg, end_time.count());\n+        }\n+\n+        std::string units;\n         float divisor = 1;\n \n-        if (std::is_same<TimeType, std::chrono::microseconds>::value) {\n-            units = \"\u03bcs\";\n-        } else if (std::is_same<TimeType, std::chrono::milliseconds>::value) {\n+        if (std::is_same<TimeType, std::chrono::milliseconds>::value) {\n             units = \"ms\";\n             divisor = 1000.;",
    "path": "src/logging/timer.h",
    "position": 17,
    "original_position": 17,
    "commit_id": "7e698732836121912f179b7c743a72dd6fdffa72",
    "original_commit_id": "7e698732836121912f179b7c743a72dd6fdffa72",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "unrelated: Could make sense to inline those as well to avoid the heterogeneous code flow? ",
    "created_at": "2021-09-06T09:23:30Z",
    "updated_at": "2021-09-06T09:23:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r702747920",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702747920"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r702747920"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702747920/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 70,
    "original_line": 70,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703019629",
    "pull_request_review_id": 747369877,
    "id": 703019629,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMzAxOTYyOQ==",
    "diff_hunk": "@@ -27,10 +28,9 @@\n #if !defined(HAVE_THREAD_LOCAL)\n static_assert(false, \"thread_local is not supported\");\n #endif\n-void PrintLockContention(const char* pszName, const char* pszFile, int nLine)\n+void LockContention(const char* pszName, const char* pszFile, int nLine)\n {\n-    LogPrint(BCLog::LOCK, \"LOCKCONTENTION: %s\\n\", pszName);\n-    LogPrint(BCLog::LOCK, \"Locker: %s:%d\\n\", pszFile, nLine);\n+    LOG_TIME_MICROS_WITH_CATEGORY(strprintf(\"%s, %s:%d\", pszName, pszFile, nLine), BCLog::LOCK);",
    "path": "src/sync.cpp",
    "position": 21,
    "original_position": 17,
    "commit_id": "7e698732836121912f179b7c743a72dd6fdffa72",
    "original_commit_id": "9b08006bc502e67956d6ab518388fad6397cac8d",
    "user": {
      "login": "martinus",
      "id": 14386,
      "node_id": "MDQ6VXNlcjE0Mzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/14386?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/martinus",
      "html_url": "https://github.com/martinus",
      "followers_url": "https://api.github.com/users/martinus/followers",
      "following_url": "https://api.github.com/users/martinus/following{/other_user}",
      "gists_url": "https://api.github.com/users/martinus/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/martinus/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/martinus/subscriptions",
      "organizations_url": "https://api.github.com/users/martinus/orgs",
      "repos_url": "https://api.github.com/users/martinus/repos",
      "events_url": "https://api.github.com/users/martinus/events{/privacy}",
      "received_events_url": "https://api.github.com/users/martinus/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think `LockContention` doesn't do what it is supposed to do. At least it doesn't log the time that the contention actually takes: the macro creates an `BCLog::Timer` instance where constructor measures start time, and destructor prints finished. But since all that is done inside the `LockContention` function, this happens instantly and doesn't measure the actual lock contention.\r\n\r\nI've verified that in https://github.com/bitcoin/bitcoin/pull/21006 because I wanted to see how long the contentions are, but it always prints 0\u00b5s or 1\u00b5s. When I move the macro into `sync.h` and replace \r\n\r\n```cpp\r\nLockContention(pszName, pszFile, nLine); // log the contention\r\n```\r\nwith\r\n```cpp\r\nLOG_TIME_MICROS_WITH_CATEGORY(strprintf(\"%s, %s:%d\", pszName, pszFile, nLine), BCLog::LOCK);\r\n```\r\nI get reasonable contention times, like so:\r\n\r\n```\r\n2021-09-06T17:18:23Z Enter: cs_main, rest.cpp:281 completed (65406\u03bcs)\r\n2021-09-06T17:18:23Z Enter: cs_main, rest.cpp:281 completed (65331\u03bcs)\r\n2021-09-06T17:18:23Z Enter: cs_main, rest.cpp:281 completed (65074\u03bcs)\r\n2021-09-06T17:18:23Z Enter: cs_main, rest.cpp:281 completed (65103\u03bcs)\r\n2021-09-06T17:18:23Z Enter: cs_main, net_processing.cpp:4051 completed (67687\u03bcs)\r\n```",
    "created_at": "2021-09-06T17:21:54Z",
    "updated_at": "2021-09-06T17:22:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r703019629",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703019629"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r703019629"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703019629/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 29,
    "original_line": 33,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703028343",
    "pull_request_review_id": 747378858,
    "id": 703028343,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMzAyODM0Mw==",
    "diff_hunk": "@@ -27,10 +28,9 @@\n #if !defined(HAVE_THREAD_LOCAL)\n static_assert(false, \"thread_local is not supported\");\n #endif\n-void PrintLockContention(const char* pszName, const char* pszFile, int nLine)\n+void LockContention(const char* pszName, const char* pszFile, int nLine)\n {\n-    LogPrint(BCLog::LOCK, \"LOCKCONTENTION: %s\\n\", pszName);\n-    LogPrint(BCLog::LOCK, \"Locker: %s:%d\\n\", pszFile, nLine);\n+    LOG_TIME_MICROS_WITH_CATEGORY(strprintf(\"%s, %s:%d\", pszName, pszFile, nLine), BCLog::LOCK);",
    "path": "src/sync.cpp",
    "position": 21,
    "original_position": 17,
    "commit_id": "7e698732836121912f179b7c743a72dd6fdffa72",
    "original_commit_id": "9b08006bc502e67956d6ab518388fad6397cac8d",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Interesting, makes sense that it would only be timing the `LockContention()` function. Right now on mainnet with a non-debug clang 13 build running since 6 hours (2 cores x 2.50GHz), I see varying durations of 1-50 usec, most often 2-30.  I suspect your machine is much faster than mine (and that I may be only seeing the time of the macro function as you suggest). Will try your suggestion.",
    "created_at": "2021-09-06T17:53:55Z",
    "updated_at": "2021-09-06T18:17:39Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r703028343",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703028343"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r703028343"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703028343/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 29,
    "original_line": 33,
    "side": "RIGHT",
    "in_reply_to_id": 703019629
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703090529",
    "pull_request_review_id": 747441422,
    "id": 703090529,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMzA5MDUyOQ==",
    "diff_hunk": "@@ -27,10 +28,9 @@\n #if !defined(HAVE_THREAD_LOCAL)\n static_assert(false, \"thread_local is not supported\");\n #endif\n-void PrintLockContention(const char* pszName, const char* pszFile, int nLine)\n+void LockContention(const char* pszName, const char* pszFile, int nLine)\n {\n-    LogPrint(BCLog::LOCK, \"LOCKCONTENTION: %s\\n\", pszName);\n-    LogPrint(BCLog::LOCK, \"Locker: %s:%d\\n\", pszFile, nLine);\n+    LOG_TIME_MICROS_WITH_CATEGORY(strprintf(\"%s, %s:%d\", pszName, pszFile, nLine), BCLog::LOCK);",
    "path": "src/sync.cpp",
    "position": 21,
    "original_position": 17,
    "commit_id": "7e698732836121912f179b7c743a72dd6fdffa72",
    "original_commit_id": "9b08006bc502e67956d6ab518388fad6397cac8d",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "@martinus This does seem better, now seeing durations of 1 to several million usec (mainnet, non-debug build). Thanks for reporting. Proposed fix in #22904.\r\n",
    "created_at": "2021-09-06T23:08:46Z",
    "updated_at": "2021-09-06T23:08:46Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r703090529",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703090529"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r703090529"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703090529/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 29,
    "original_line": 33,
    "side": "RIGHT",
    "in_reply_to_id": 703019629
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703090666",
    "pull_request_review_id": 747441534,
    "id": 703090666,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMzA5MDY2Ng==",
    "diff_hunk": "@@ -58,12 +58,14 @@ class Timer\n             return strprintf(\"%s: %s\", m_prefix, msg);\n         }\n \n-        std::string units = \"\";\n+        if (std::is_same<TimeType, std::chrono::microseconds>::value) {\n+            return strprintf(\"%s: %s (%i\u03bcs)\", m_prefix, msg, end_time.count());\n+        }\n+\n+        std::string units;\n         float divisor = 1;\n \n-        if (std::is_same<TimeType, std::chrono::microseconds>::value) {\n-            units = \"\u03bcs\";\n-        } else if (std::is_same<TimeType, std::chrono::milliseconds>::value) {\n+        if (std::is_same<TimeType, std::chrono::milliseconds>::value) {\n             units = \"ms\";\n             divisor = 1000.;",
    "path": "src/logging/timer.h",
    "position": 17,
    "original_position": 17,
    "commit_id": "7e698732836121912f179b7c743a72dd6fdffa72",
    "original_commit_id": "7e698732836121912f179b7c743a72dd6fdffa72",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "good idea, done (and more) in #22904",
    "created_at": "2021-09-06T23:09:29Z",
    "updated_at": "2021-09-06T23:09:29Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r703090666",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703090666"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22736#discussion_r703090666"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22736"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703090666/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 70,
    "original_line": 70,
    "side": "RIGHT",
    "in_reply_to_id": 702747920
  }
]