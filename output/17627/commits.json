[
  {
    "sha": "31408edeffb2e14dd7c25e10ac448d48de7ea4e1",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozMTQwOGVkZWZmYjJlMTRkZDdjMjVlMTBhYzQ0OGQ0OGRlN2VhNGUx",
    "commit": {
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2019-12-04T12:44:00Z"
      },
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2019-12-06T11:05:40Z"
      },
      "message": "build: skip memory sanitizer for SeedSlow\n\nMemory sanitizer cannot see through syscall. This caused a false\npositive use-of-uninitialized-value error for SYS_getrandom.\n\nAfter discussion in #17627 it was decided not to initialize\nthese variables to 0, but instead to suppress the warning.",
      "tree": {
        "sha": "32c4cbdca37b429325140396f8f44f92f0cfb86b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/32c4cbdca37b429325140396f8f44f92f0cfb86b"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/31408edeffb2e14dd7c25e10ac448d48de7ea4e1",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAl3qNgQACgkQV/+b28ww\nEAk8kg//TB/Abvn0dkPa6YOZsNDnnMg4hgxrYDWnLc81RQ4IsmzgZTKcAKo9LELB\nLlfW2RJMdG5qZjuugLePxoLsjvzw5qwASygGvz+g2Y9k+N00gCFJ4L6K5FEOjzac\ndJGAU2Y1lg3zhEfnvsbn44Rri4OEOEsXr84AK90F4JvzOwJgsPJEvUskBAQL3IN9\nzdBX2B8PoU7Q9MQDNRLJtE3frEyv2e5s3dDS8IUvaJcSHwzwvVn8O4B1VeUAo9gP\ntEP8sf1EnwBgiS6t25wwNHHnpeMyJa38zh+AwfutQp7KODktqacIZQiXIvfDWcwW\nD8w0uPEr6G6hh2OuP1+c/IZcciPzxY95wGb4bGQOWAW+PFlNbygqmjZ7A4szJ3Xy\nuYyPKk9mZpt8wkbp7dKPAVLqsL5w4L4nI68t4NlKQfym2fySDCkKybd1ds7KLQsS\nQrVDlCLoAxZT2bqBItymxUKVwy5l7fKnkEpt9r9DgzLUbd4tX/8nggPctKv+w8eR\n91JMKxTAOKQBXd63ibC3s5D1ESN5r5ffwcW9j2xWyRUYnOwgYxKfiglPU4ni9aBw\niG1V5BX/NYdbFDwKOipuObAxatx/C7jvhebHh9PM8z+5ani7yrf2+yLx1AE6rVUv\nAyQdXtyJy24uczi8aW8NnE4a+Y99MB0rEpqlDPy6zH0XUR2Okrk=\n=k30O\n-----END PGP SIGNATURE-----",
        "payload": "tree 32c4cbdca37b429325140396f8f44f92f0cfb86b\nparent cb11324a63ef10475bfc4d8e45148d5ae6f3e71e\nauthor Sjors Provoost <sjors@sprovoost.nl> 1575463440 +0100\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1575630340 +0100\n\nbuild: skip memory sanitizer for SeedSlow\n\nMemory sanitizer cannot see through syscall. This caused a false\npositive use-of-uninitialized-value error for SYS_getrandom.\n\nAfter discussion in #17627 it was decided not to initialize\nthese variables to 0, but instead to suppress the warning.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/31408edeffb2e14dd7c25e10ac448d48de7ea4e1",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/31408edeffb2e14dd7c25e10ac448d48de7ea4e1",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/31408edeffb2e14dd7c25e10ac448d48de7ea4e1/comments",
    "author": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "cb11324a63ef10475bfc4d8e45148d5ae6f3e71e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/cb11324a63ef10475bfc4d8e45148d5ae6f3e71e",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/cb11324a63ef10475bfc4d8e45148d5ae6f3e71e"
      }
    ],
    "stats": {
      "total": 21,
      "additions": 14,
      "deletions": 7
    },
    "files": [
      {
        "sha": "e69e4a9cfc88d4b3395933034dcee423d3dc9eab",
        "filename": "src/random.cpp",
        "status": "modified",
        "additions": 12,
        "deletions": 5,
        "changes": 17,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/31408edeffb2e14dd7c25e10ac448d48de7ea4e1/src/random.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/31408edeffb2e14dd7c25e10ac448d48de7ea4e1/src/random.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/random.cpp?ref=31408edeffb2e14dd7c25e10ac448d48de7ea4e1",
        "patch": "@@ -228,7 +228,7 @@ static void Strengthen(const unsigned char (&seed)[32], int microseconds, CSHA51\n     inner_hasher.Write(seed, sizeof(seed));\n \n     // Hash loop\n-    unsigned char buffer[64];\n+    unsigned char buffer[64]; // intentionally not initialized\n     int64_t stop = GetTimeMicros() + microseconds;\n     do {\n         for (int i = 0; i < 1000; ++i) {\n@@ -393,7 +393,7 @@ class RNGState {\n         // since we want it to be fast as network peers may be able to trigger it repeatedly.\n         LOCK(m_events_mutex);\n \n-        unsigned char events_hash[32];\n+        unsigned char events_hash[32]; // intentionally not initialized\n         m_events_hasher.Finalize(events_hash);\n         hasher.Write(events_hash, 32);\n \n@@ -409,7 +409,7 @@ class RNGState {\n     bool MixExtract(unsigned char* out, size_t num, CSHA512&& hasher, bool strong_seed) noexcept\n     {\n         assert(num <= 32);\n-        unsigned char buf[64];\n+        unsigned char buf[64]; // intentionally not initialized\n         static_assert(sizeof(buf) == CSHA512::OUTPUT_SIZE, \"Buffer needs to have hasher's output size\");\n         bool ret;\n         {\n@@ -459,7 +459,7 @@ static void SeedTimestamp(CSHA512& hasher) noexcept\n \n static void SeedFast(CSHA512& hasher) noexcept\n {\n-    unsigned char buffer[32];\n+    unsigned char buffer[32]; // intentionally not initialized\n \n     // Stack pointer to indirectly commit to thread/callstack\n     const unsigned char* ptr = buffer;\n@@ -472,6 +472,13 @@ static void SeedFast(CSHA512& hasher) noexcept\n     SeedTimestamp(hasher);\n }\n \n+// buffer[32] is intentionally not initialized, see https://github.com/bitcoin/bitcoin/pull/17627\n+// Suppress memory sanitizer because it can't see that syscall initializes this in GetOSRand().\n+#if defined(__has_feature) && defined(HAVE_SYS_GETRANDOM)\n+#  if __has_feature(memory_sanitizer)\n+__attribute__((no_sanitize(\"memory\")))\n+#  endif\n+#endif\n static void SeedSlow(CSHA512& hasher, RNGState& rng) noexcept\n {\n     unsigned char buffer[32];\n@@ -497,7 +504,7 @@ static void SeedSlow(CSHA512& hasher, RNGState& rng) noexcept\n static void SeedStrengthen(CSHA512& hasher, RNGState& rng, int microseconds) noexcept\n {\n     // Generate 32 bytes of entropy from the RNG, and a copy of the entropy already in hasher.\n-    unsigned char strengthen_seed[32];\n+    unsigned char strengthen_seed[32]; // intentionally not initialized\n     rng.MixExtract(strengthen_seed, sizeof(strengthen_seed), CSHA512(hasher), false);\n     // Strengthen the seed, and feed it into hasher.\n     Strengthen(strengthen_seed, microseconds, hasher);"
      },
      {
        "sha": "b20e67d58bf3948ef35aa7bd601ce17c0db2c55e",
        "filename": "src/randomenv.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/31408edeffb2e14dd7c25e10ac448d48de7ea4e1/src/randomenv.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/31408edeffb2e14dd7c25e10ac448d48de7ea4e1/src/randomenv.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/randomenv.cpp?ref=31408edeffb2e14dd7c25e10ac448d48de7ea4e1",
        "patch": "@@ -142,7 +142,7 @@ void AddFile(CSHA512& hasher, const char *path)\n     int f = open(path, O_RDONLY);\n     size_t total = 0;\n     if (f != -1) {\n-        unsigned char fbuf[4096];\n+        unsigned char fbuf[4096]; // intentionally not initialized, see https://github.com/bitcoin/bitcoin/pull/17627\n         int n;\n         hasher.Write((const unsigned char*)&f, sizeof(f));\n         if (fstat(f, &sb) == 0) hasher << sb;\n@@ -171,7 +171,7 @@ template<int... S>\n void AddSysctl(CSHA512& hasher)\n {\n     int CTL[sizeof...(S)] = {S...};\n-    unsigned char buffer[65536];\n+    unsigned char buffer[65536]; // intentionally not initialized\n     size_t siz = 65536;\n     int ret = sysctl(CTL, sizeof...(S), buffer, &siz, nullptr, 0);\n     if (ret == 0 || (ret == -1 && errno == ENOMEM)) {"
      }
    ]
  }
]