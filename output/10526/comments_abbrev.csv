laanwj,2017-06-05T12:47:14Z,utACK https://github.com/bitcoin/bitcoin/pull/10526/commits/fe84334135afa79845d18e472b71536cca72fd0d,https://github.com/bitcoin/bitcoin/pull/10526#issuecomment-306178965,306178965,
gmaxwell,2017-06-06T08:26:02Z,Concept ACK,https://github.com/bitcoin/bitcoin/pull/10526#issuecomment-306417328,306417328,
laanwj,2017-06-07T13:12:08Z,"Original chainstate (up to height=430234).\n```\n2.4G    testbtc.olddb/chainstate\n```\nAfter converting using master (and shutting down immediately):\n```\n2017-06-07 12:54:30 Upgrading database...\n2017-06-07 13:09:39 LoadBlockIndexDB: last block file = 628\n\n4.5G    chainstate\n```\nConverting using this pull (and shutting down immediately):\n```\n2017-06-07 12:29:37 Upgrading dat",https://github.com/bitcoin/bitcoin/pull/10526#issuecomment-306790220,306790220,
sipa,2017-07-17T07:54:21Z,"I wonder what to do here. Without any forced compaction, it's likely that many nodes will remain with a database that still contains table files for the old rows for an extended period of time.",https://github.com/bitcoin/bitcoin/pull/10526#issuecomment-315688560,315688560,
TheBlueMatt,2017-07-17T13:25:29Z,"Looks like this needed a 15 tag... If it's not too late let's call it a bugfix, tag it 15, and try to get it in this week.\n\nOn July 17, 2017 3:54:35 AM EDT, Pieter Wuille <notifications@github.com> wrote:\n>I wonder what to do here. Without any forced compaction, it's likely\n>that many nodes will remain with a database that still contains table\n>files for the old rows for an extended period of",https://github.com/bitcoin/bitcoin/pull/10526#issuecomment-315754585,315754585,
TheBlueMatt,2017-07-17T14:18:39Z,"Also, needs rebase.",https://github.com/bitcoin/bitcoin/pull/10526#issuecomment-315769366,315769366,
laanwj,2017-07-24T10:06:16Z,"After converting up to block height=430234 (same dataset as last time), hardwiring shutdown immediately after the block database processing.\n\nTested with rebased version here: https://github.com/laanwj/bitcoin/tree/2017_07_sipa_onthefly\n```\n2.1G    chainstate/\n```\nWith master:\n```\n4.3G    chainstate/\n```\nSo it seems the negative result last time was a fluke. utACK.\n",https://github.com/bitcoin/bitcoin/pull/10526#issuecomment-317377472,317377472,
laanwj,2017-07-24T12:29:08Z,"I repeated a few times, and it seems that it's like a coin toss. Sometimes it ends up as 4.4G, sometimes as 2.1G. \nWhen the former, *every time* after running bitcoind again, even terminating immediately after chainstate processing, it was at 2.1G after shutting down.\nIt might be that a cleanup is re-triggered when re-opening the database, or when closing it.",https://github.com/bitcoin/bitcoin/pull/10526#issuecomment-317407205,317407205,
sipa,2017-07-24T22:03:40Z,"Rebased. I've changed the final compact request to be for the entire per-tx range of keys, rather than just the last group updated. Maybe that triggers compaction sooner. Or not.",https://github.com/bitcoin/bitcoin/pull/10526#issuecomment-317568197,317568197,
morcos,2017-07-27T17:52:49Z,"If someone was running with master before this commit, how does their database ever get compacted?\n",https://github.com/bitcoin/bitcoin/pull/10526#issuecomment-318437325,318437325,
TheBlueMatt,2017-07-27T17:56:30Z,@morcos leveldb does automatic background compaction.,https://github.com/bitcoin/bitcoin/pull/10526#issuecomment-318438319,318438319,
morcos,2017-07-27T18:22:39Z,">@morcos leveldb does automatic background compaction.\n\nwhen?  I have nodes running for a week that have 5.8G chainstate despite recent repeated stopping and starting.\n",https://github.com/bitcoin/bitcoin/pull/10526#issuecomment-318445541,318445541,
gmaxwell,2017-07-27T19:03:03Z,"@morcos  Yea, I have one two weeks now.   Perhaps we should also have some general compaction thing to clean up existing databases too....",https://github.com/bitcoin/bitcoin/pull/10526#issuecomment-318456549,318456549,
TheBlueMatt,2017-07-27T19:05:10Z,"I got some strange testing results...current master:\n * Convert time 26:30, final chainstate size 3.5G\n * Convert time 28:05, final chainstate size 3.5G\n\nThis PR:\n * Convert time: 16:51, final chainstate size 5.9G (down to 2.7 immediately upon restart)\n * Convert time: 16:11, final chainstate size 5.9G (down to 2.7 immediately upon restart)\n\nEither way, I dont care about the excess",https://github.com/bitcoin/bitcoin/pull/10526#issuecomment-318457112,318457112,
TheBlueMatt,2017-07-27T19:05:48Z,"@morcos hmm, I guess its just done when tables fill up, it should /eventually/ happen, but may take a long time, I suppose.",https://github.com/bitcoin/bitcoin/pull/10526#issuecomment-318457298,318457298,
morcos,2017-07-28T02:34:44Z,"@TheBlueMatt wow, that's some really long convert times\nMy convert times with or without this PR were on the order of between 4 mins and 7 mins with some variation.",https://github.com/bitcoin/bitcoin/pull/10526#issuecomment-318540082,318540082,
TheBlueMatt,2017-07-28T02:36:51Z,"Heh, thats what putting a database on spinning rust on a CoW filesystem\ndoes to you....I've seen it much faster under other conditions.\n\nOn 07/27/17 22:34, Alex Morcos wrote:\n> @TheBlueMatt <https://github.com/thebluematt> wow, that's some really\n> long convert times\n> My convert times with or without this PR were on the order of between 4\n> mins and 7 mins with some variation.\n> \n> â€”\n> ",https://github.com/bitcoin/bitcoin/pull/10526#issuecomment-318540395,318540395,
TheBlueMatt,2017-07-30T13:52:38Z,"utACK efeb273305e3e4d2c42e1e153de83c1cb6f0a28c, I tested an earlier version of the patch which should be equivalent, however.",https://github.com/bitcoin/bitcoin/pull/10526#issuecomment-318903191,318903191,
morcos,2017-07-27T17:25:05Z,Is this meant to be shadowed by the key defined 7 lines down?,https://github.com/bitcoin/bitcoin/pull/10526#discussion_r129904918,129904918,src/txdb.cpp
sipa,2017-07-28T04:08:01Z,Fixed.,https://github.com/bitcoin/bitcoin/pull/10526#discussion_r130009071,130009071,src/txdb.cpp
