[
  {
    "sha": "faff3991a9be0ea7be31685fb46d94c212c5da34",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYWZmMzk5MWE5YmUwZWE3YmUzMTY4NWZiNDZkOTRjMjEyYzVkYTM0",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2021-01-26T09:44:32Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2021-01-26T11:50:43Z"
      },
      "message": "ci: Fuzz with integer sanitizer",
      "tree": {
        "sha": "2e9bccd8e2dad91fccbf9e5f710ca3cbc2cc876e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2e9bccd8e2dad91fccbf9e5f710ca3cbc2cc876e"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/faff3991a9be0ea7be31685fb46d94c212c5da34",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\npUif+wv9HNXhHvqmX2a4q3mx6Dqh68rQ7pQ4Nmfw+r5wniLHHsBnWnqaDjoeZm4Q\nq523URIdj2ybdWs3qgIsEN6nQo3cxBpo9Sh0ioLF4ZdX21n23MtFWdGid2r7iLPO\nCKE65IyTtHEWmc43I7o3BrMvKq7njfFN8Y6AViyO3hzNgVMi1iNPXWvzU70KEyo9\nGks+t57LBKyrDdQdB178LWDRM+p3mIV2fDFIT2Obak9kFSydTfxbVmJ6Ky6ROan0\n0c6fOrfZRApNtl5IpMIKvt4f4tooiK1clZs8+u1aAzCXVVHomqsV1SGA0FbimrX4\nME3fTOSSY6qfSrEXHL8W0If6iMhYUslLPCKS55KnFjBo2s9XjwYWIKQPGesfw/x6\nLKf4Ka43p5EKtl5K9Ki1qbmAt6RyN1E2D4MHVOXZRt1BYKjQHE6eyLppkZH2ibZ8\nmqyiGwHjWoNywnHMgRi2BFEBtA1R8pLy8tx5umh9nfrgyrLJlI/xqoouprB1MKOW\nHMCB/3DD\n=+isE\n-----END PGP SIGNATURE-----",
        "payload": "tree 2e9bccd8e2dad91fccbf9e5f710ca3cbc2cc876e\nparent 32d44d2b1ca3881eeaa8d28d6c411002bc38b154\nauthor MarcoFalke <falke.marco@gmail.com> 1611654272 +0100\ncommitter MarcoFalke <falke.marco@gmail.com> 1611661843 +0100\n\nci: Fuzz with integer sanitizer\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/faff3991a9be0ea7be31685fb46d94c212c5da34",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/faff3991a9be0ea7be31685fb46d94c212c5da34",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/faff3991a9be0ea7be31685fb46d94c212c5da34/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "32d44d2b1ca3881eeaa8d28d6c411002bc38b154",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/32d44d2b1ca3881eeaa8d28d6c411002bc38b154",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/32d44d2b1ca3881eeaa8d28d6c411002bc38b154"
      }
    ],
    "stats": {
      "total": 29,
      "additions": 19,
      "deletions": 10
    },
    "files": [
      {
        "sha": "801164c368213dd6c096a89cba31aa7382693917",
        "filename": ".cirrus.yml",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/faff3991a9be0ea7be31685fb46d94c212c5da34/.cirrus.yml",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/faff3991a9be0ea7be31685fb46d94c212c5da34/.cirrus.yml",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/.cirrus.yml?ref=faff3991a9be0ea7be31685fb46d94c212c5da34",
        "patch": "@@ -136,7 +136,7 @@ task:\n     FILE_ENV: \"./ci/test/00_setup_env_native_asan.sh\"\n \n task:\n-  name: '[no depends, sanitizers: fuzzer,address,undefined] [focal]'\n+  name: '[no depends, sanitizers: fuzzer,address,undefined,integer] [focal]'\n   << : *GLOBAL_TASK_TEMPLATE\n   container:\n     image: ubuntu:focal"
      },
      {
        "sha": "f6b824faaa607a045a4477d836dd601ce7ff8e01",
        "filename": "Makefile.am",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/faff3991a9be0ea7be31685fb46d94c212c5da34/Makefile.am",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/faff3991a9be0ea7be31685fb46d94c212c5da34/Makefile.am",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/Makefile.am?ref=faff3991a9be0ea7be31685fb46d94c212c5da34",
        "patch": "@@ -46,6 +46,9 @@ OSX_INSTALLER_ICONS=$(top_srcdir)/src/qt/res/icons/bitcoin.icns\n OSX_PLIST=$(top_builddir)/share/qt/Info.plist #not installed\n \n DIST_CONTRIB = \\\n+\t       $(top_srcdir)/test/sanitizer_suppressions/lsan \\\n+\t       $(top_srcdir)/test/sanitizer_suppressions/tsan \\\n+\t       $(top_srcdir)/test/sanitizer_suppressions/ubsan \\\n \t       $(top_srcdir)/contrib/linearize/linearize-data.py \\\n \t       $(top_srcdir)/contrib/linearize/linearize-hashes.py\n "
      },
      {
        "sha": "b7157c608d9a5af4c321a6eb0df319e3f626cf29",
        "filename": "ci/test/00_setup_env_native_fuzz.sh",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/faff3991a9be0ea7be31685fb46d94c212c5da34/ci/test/00_setup_env_native_fuzz.sh",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/faff3991a9be0ea7be31685fb46d94c212c5da34/ci/test/00_setup_env_native_fuzz.sh",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/ci/test/00_setup_env_native_fuzz.sh?ref=faff3991a9be0ea7be31685fb46d94c212c5da34",
        "patch": "@@ -14,5 +14,5 @@ export RUN_UNIT_TESTS=false\n export RUN_FUNCTIONAL_TESTS=false\n export RUN_FUZZ_TESTS=true\n export GOAL=\"install\"\n-export BITCOIN_CONFIG=\"--enable-fuzz --with-sanitizers=fuzzer,address,undefined CC=clang CXX=clang++ --with-boost-process\"\n+export BITCOIN_CONFIG=\"--enable-fuzz --with-sanitizers=fuzzer,address,undefined,integer CC=clang CXX=clang++ --with-boost-process\"\n export CCACHE_SIZE=200M"
      },
      {
        "sha": "aa0aa11d150e88de12f1c676520d319adc53e55f",
        "filename": "test/fuzz/test_runner.py",
        "status": "modified",
        "additions": 13,
        "deletions": 8,
        "changes": 21,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/faff3991a9be0ea7be31685fb46d94c212c5da34/test/fuzz/test_runner.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/faff3991a9be0ea7be31685fb46d94c212c5da34/test/fuzz/test_runner.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/fuzz/test_runner.py?ref=faff3991a9be0ea7be31685fb46d94c212c5da34",
        "patch": "@@ -14,9 +14,11 @@\n import sys\n \n \n-def get_fuzz_env(*, target):\n+def get_fuzz_env(*, target, source_dir):\n     return {\n         'FUZZ': target,\n+        'UBSAN_OPTIONS':\n+        f'suppressions={source_dir}/test/sanitizer_suppressions/ubsan:print_stacktrace=1:halt_on_error=1:report_error_type=1',\n         'ASAN_OPTIONS':  # symbolizer disabled due to https://github.com/google/sanitizers/issues/1364#issuecomment-761072085\n         'symbolize=0:detect_stack_use_after_return=1:check_initialization_order=1:strict_init_order=1',\n     }\n@@ -137,7 +139,7 @@ def main():\n                 os.path.join(config[\"environment\"][\"BUILDDIR\"], 'src', 'test', 'fuzz', 'fuzz'),\n                 '-help=1',\n             ],\n-            env=get_fuzz_env(target=test_list_selection[0]),\n+            env=get_fuzz_env(target=test_list_selection[0], source_dir=config['environment']['SRCDIR']),\n             timeout=20,\n             check=True,\n             stderr=subprocess.PIPE,\n@@ -154,6 +156,7 @@ def main():\n         if args.generate:\n             return generate_corpus_seeds(\n                 fuzz_pool=fuzz_pool,\n+                src_dir=config['environment']['SRCDIR'],\n                 build_dir=config[\"environment\"][\"BUILDDIR\"],\n                 seed_dir=args.seed_dir,\n                 targets=test_list_selection,\n@@ -164,6 +167,7 @@ def main():\n                 fuzz_pool=fuzz_pool,\n                 corpus=args.seed_dir,\n                 test_list=test_list_selection,\n+                src_dir=config['environment']['SRCDIR'],\n                 build_dir=config[\"environment\"][\"BUILDDIR\"],\n                 merge_dir=args.m_dir,\n             )\n@@ -173,12 +177,13 @@ def main():\n             fuzz_pool=fuzz_pool,\n             corpus=args.seed_dir,\n             test_list=test_list_selection,\n+            src_dir=config['environment']['SRCDIR'],\n             build_dir=config[\"environment\"][\"BUILDDIR\"],\n             use_valgrind=args.valgrind,\n         )\n \n \n-def generate_corpus_seeds(*, fuzz_pool, build_dir, seed_dir, targets):\n+def generate_corpus_seeds(*, fuzz_pool, src_dir, build_dir, seed_dir, targets):\n     \"\"\"Generates new corpus seeds.\n \n     Run {targets} without input, and outputs the generated corpus seeds to\n@@ -192,7 +197,7 @@ def job(command, t):\n             ' '.join(command),\n             subprocess.run(\n                 command,\n-                env=get_fuzz_env(target=t),\n+                env=get_fuzz_env(target=t, source_dir=src_dir),\n                 check=True,\n                 stderr=subprocess.PIPE,\n                 universal_newlines=True,\n@@ -213,7 +218,7 @@ def job(command, t):\n         future.result()\n \n \n-def merge_inputs(*, fuzz_pool, corpus, test_list, build_dir, merge_dir):\n+def merge_inputs(*, fuzz_pool, corpus, test_list, src_dir, build_dir, merge_dir):\n     logging.info(\"Merge the inputs from the passed dir into the seed_dir. Passed dir {}\".format(merge_dir))\n     jobs = []\n     for t in test_list:\n@@ -231,7 +236,7 @@ def job(t, args):\n             output = 'Run {} with args {}\\n'.format(t, \" \".join(args))\n             output += subprocess.run(\n                 args,\n-                env=get_fuzz_env(target=t),\n+                env=get_fuzz_env(target=t, source_dir=src_dir),\n                 check=True,\n                 stderr=subprocess.PIPE,\n                 universal_newlines=True,\n@@ -244,7 +249,7 @@ def job(t, args):\n         future.result()\n \n \n-def run_once(*, fuzz_pool, corpus, test_list, build_dir, use_valgrind):\n+def run_once(*, fuzz_pool, corpus, test_list, src_dir, build_dir, use_valgrind):\n     jobs = []\n     for t in test_list:\n         corpus_path = os.path.join(corpus, t)\n@@ -261,7 +266,7 @@ def job(t, args):\n             output = 'Run {} with args {}'.format(t, args)\n             result = subprocess.run(\n                 args,\n-                env=get_fuzz_env(target=t),\n+                env=get_fuzz_env(target=t, source_dir=src_dir),\n                 stderr=subprocess.PIPE,\n                 universal_newlines=True,\n             )"
      },
      {
        "sha": "97f0f45e7f832d52035406391066c0bf4feecf87",
        "filename": "test/sanitizer_suppressions/ubsan",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/faff3991a9be0ea7be31685fb46d94c212c5da34/test/sanitizer_suppressions/ubsan",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/faff3991a9be0ea7be31685fb46d94c212c5da34/test/sanitizer_suppressions/ubsan",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/sanitizer_suppressions/ubsan?ref=faff3991a9be0ea7be31685fb46d94c212c5da34",
        "patch": "@@ -87,6 +87,7 @@ implicit-signed-integer-truncation:streams.h\n implicit-signed-integer-truncation:test/arith_uint256_tests.cpp\n implicit-signed-integer-truncation:test/skiplist_tests.cpp\n implicit-signed-integer-truncation:torcontrol.cpp\n+implicit-unsigned-integer-truncation:*/include/c++/\n implicit-unsigned-integer-truncation:crypto/\n implicit-unsigned-integer-truncation:leveldb/\n # std::variant warning fixed in https://github.com/gcc-mirror/gcc/commit/074436cf8cdd2a9ce75cadd36deb8301f00e55b9"
      }
    ]
  }
]