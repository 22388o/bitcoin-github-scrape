jnewbery,2019-09-30 21:46:07,~Builds on #15437. Please review that PR first.~,https://github.com/bitcoin/bitcoin/pull/17004#issuecomment-536766306,536766306,
DrahtBot,2019-10-03 20:41:28,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#17080](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/17080.html) (consensus: Explain why fCheckDuplicateInput",https://github.com/bitcoin/bitcoin/pull/17004#issuecomment-538119581,538119581,
jnewbery,2019-10-08 20:24:53,Thanks for the review @ryanofsky . I've updated the release notes as requested.,https://github.com/bitcoin/bitcoin/pull/17004#issuecomment-539688135,539688135,
laanwj,2019-10-09 10:22:06,Nice cleanup.,https://github.com/bitcoin/bitcoin/pull/17004#issuecomment-539939125,539939125,
jnewbery,2019-10-09 14:12:49,Rebased,https://github.com/bitcoin/bitcoin/pull/17004#issuecomment-540019671,540019671,
ryanofsky,2019-10-09 17:20:30,">  there are cases were `MaybePunishNode()` can get called where it\n> wasn't previously\n\nI didn't see this in my previous reviews, and I'm not really sure what the implications are. It might help for the comment to say what the original reason for not calling MaybePunish was, and why it's no longer applicable or important now",https://github.com/bitcoin/bitcoin/pull/17004#issuecomment-540100982,540100982,
MarcoFalke,2019-10-09 17:31:44,"Was about to ask the same question, thanks @ryanofsky ",https://github.com/bitcoin/bitcoin/pull/17004#issuecomment-540106096,540106096,
jnewbery,2019-10-09 19:22:16,"It looks like the bug was introduced here: https://github.com/bitcoin/bitcoin/pull/10135/files. That PR fixed a bug where we'd send out REJECT messages with a reject code of 0 (not valid in BIP 61), but it also inadvertently stopped us from punishing nodes that sent a block that failed here https://github.com/jnewbery/bitcoin/blob/5d08c9c579ba8cc7b684105c6a08263992b08d52/src/validation.cpp#L3077 a",https://github.com/bitcoin/bitcoin/pull/17004#issuecomment-540151010,540151010,
ryanofsky,2019-10-09 20:22:52,"Code review ACK d938bb4f0208ec629122d0b87f45cad3c8b58089. Only comment and formatting changes since my last review. Thanks for digging up the history!\n\nIIUC, could maybe update the PR description to clarify that the ""minor change in p2p behaviour"" is a bugfix.",https://github.com/bitcoin/bitcoin/pull/17004#issuecomment-540176089,540176089,
jnewbery,2019-10-09 20:27:36,Updated the PR description. Thanks for the review!,https://github.com/bitcoin/bitcoin/pull/17004#issuecomment-540178177,540178177,
jnewbery,2019-10-10 17:32:30,Fixed all @ryanofsky @ariard @fjahr comments. Thanks for the review!,https://github.com/bitcoin/bitcoin/pull/17004#issuecomment-540691306,540691306,
ariard,2019-10-10 20:42:30,"ACK 9075d13, changes since last reviewed are splitting them in separate commits to ease understanding and fix nits",https://github.com/bitcoin/bitcoin/pull/17004#issuecomment-540783587,540783587,
fjahr,2019-10-21 17:53:33,"ACK 9075d13153ce06cd59a45644831ecc43126e1e82, confirmed diff to last review was fixing nits in docs/comments.\n\n",https://github.com/bitcoin/bitcoin/pull/17004#issuecomment-544631547,544631547,
MarcoFalke,2019-10-24 17:14:27,"It looks like the runtime sanity assert\n\n```cpp\nassert (state.GetRejectCode() < REJECT_INTERNAL); // Blocks are never rejected with internal reject codes\n```\n\nwas transformed into a less fatal if check in 5d08c9c579ba8cc7b684105c6a08263992b08d52 and now removed completely. What is the reason for removing it?",https://github.com/bitcoin/bitcoin/pull/17004#issuecomment-546015683,546015683,
MarcoFalke,2019-10-24 17:18:22,"Oh, I see we used to punish peers when the reject code was `0`. Post-merge ACK",https://github.com/bitcoin/bitcoin/pull/17004#issuecomment-546017171,546017171,
laanwj,2019-10-01 10:06:16,"IMO it'd be more clear, for historical context, to add to this line that support was removed, than to remove this line",https://github.com/bitcoin/bitcoin/pull/17004#discussion_r329976844,329976844,doc/bips.md
jnewbery,2019-10-01 13:20:27,This comment is for the base PR (https://github.com/bitcoin/bitcoin/pull/15437). I've copied it there: https://github.com/bitcoin/bitcoin/pull/15437#discussion_r330051814,https://github.com/bitcoin/bitcoin/pull/17004#discussion_r330052135,330052135,doc/bips.md
ryanofsky,2019-10-08 16:01:34,"In commit ""[validation] Remove REJECT code from CValidationState"" (6f8876e155024181a455fc457ae94a38d0da3626)\n\nI don't think it's necessary, but you could potentially mention this change in release notes, in case someone is relying on the RPC string having a certain format.",https://github.com/bitcoin/bitcoin/pull/17004#discussion_r332598573,332598573,src/rpc/rawtransaction.cpp
jnewbery,2019-10-08 20:24:38,Done,https://github.com/bitcoin/bitcoin/pull/17004#discussion_r332715505,332715505,src/rpc/rawtransaction.cpp
ariard,2019-10-10 04:00:21,"Not sure about this statement, at least the reject-reason should be logged for the broadcastTransaction call in SubmitMemoryPoolAndRelay, which ones were you thinking off ?",https://github.com/bitcoin/bitcoin/pull/17004#discussion_r333321537,333321537,doc/release-notes-15437.md
ryanofsky,2019-10-10 12:20:07,"Just a suggestion, but imo it wouldn't be a bad idea to break this commit up to separate the behavior changes from the refactoring changes. It probably says something bad about my own code review practices, but I completely missed this change the first time I first reviewed and ACKed this PR. It seems like this commit could nicely be broken into 3 commits: 1) P2P behavior change 2) RPC and logging",https://github.com/bitcoin/bitcoin/pull/17004#discussion_r333486103,333486103,src/net_processing.cpp
jnewbery,2019-10-10 13:57:37,Good idea. I'll do that. That'll also make it easier to back-port the bugfix if we want to do that.,https://github.com/bitcoin/bitcoin/pull/17004#discussion_r333535287,333535287,src/net_processing.cpp
jnewbery,2019-10-10 13:57:57,"Sorry, this should say REJECT code, not REJECT reason. I'll update the docs.",https://github.com/bitcoin/bitcoin/pull/17004#discussion_r333535472,333535472,doc/release-notes-15437.md
fjahr,2019-10-10 15:31:37,Comment should also be removed,https://github.com/bitcoin/bitcoin/pull/17004#discussion_r333590040,333590040,src/validation.h
jnewbery,2019-10-10 17:32:09,Thanks. Fixed!,https://github.com/bitcoin/bitcoin/pull/17004#discussion_r333646273,333646273,src/validation.h
