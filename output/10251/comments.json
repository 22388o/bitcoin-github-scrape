[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/296218058",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10251#issuecomment-296218058",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10251",
    "id": 296218058,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5NjIxODA1OA==",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-21T15:11:19Z",
    "updated_at": "2017-04-21T15:11:19Z",
    "author_association": "MEMBER",
    "body": "Concept ACK, nice!",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/296218058/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/296234383",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10251#issuecomment-296234383",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10251",
    "id": 296234383,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5NjIzNDM4Mw==",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?u=eab5d0cdbb6cc25087cb61d4ca4a6f85255f42a7&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-21T16:12:19Z",
    "updated_at": "2017-04-21T16:12:19Z",
    "author_association": "CONTRIBUTOR",
    "body": "Force pushed fixes for issues found by @ryanofsky.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/296234383/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/299113394",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10251#issuecomment-299113394",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10251",
    "id": 299113394,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5OTExMzM5NA==",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?u=eab5d0cdbb6cc25087cb61d4ca4a6f85255f42a7&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-05-04T07:20:01Z",
    "updated_at": "2017-05-04T07:20:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "Force push fixed @ryanofsky points.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/299113394/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/299273734",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10251#issuecomment-299273734",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10251",
    "id": 299273734,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5OTI3MzczNA==",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?u=eab5d0cdbb6cc25087cb61d4ca4a6f85255f42a7&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-05-04T18:42:05Z",
    "updated_at": "2017-05-04T18:42:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "Force push fixed @ryanofsky's nit (and also added the \"other balances\" atomics to `SetNull()`).",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/299273734/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/299492327",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10251#issuecomment-299492327",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10251",
    "id": 299492327,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5OTQ5MjMyNw==",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-05-05T15:14:21Z",
    "updated_at": "2017-05-05T15:14:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "ACK 84904a9d8ac5e98558b366bc69338d4ad07dc2f7.\r\n\r\nChanges since last review were those Jonas mentioned. Seeing the missing initializations in SetNull() was a little disconcerting, because I would have expected tests to catch errors they would cause. Actually one test did fail (wallet_tests/rescan) but I guess I didn't notice it.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/299492327/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/308333912",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10251#issuecomment-308333912",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10251",
    "id": 308333912,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwODMzMzkxMg==",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?u=eab5d0cdbb6cc25087cb61d4ca4a6f85255f42a7&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-06-14T06:38:40Z",
    "updated_at": "2017-06-14T06:38:40Z",
    "author_association": "CONTRIBUTOR",
    "body": "Needed a trivial rebase (`BOOST_FOREACH` -> `for` change).",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/308333912/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/308341918",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10251#issuecomment-308341918",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10251",
    "id": 308341918,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwODM0MTkxOA==",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?u=7999a16349f0df0fb273fffa18e5a955c9d3f11c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-06-14T07:18:36Z",
    "updated_at": "2017-06-14T07:18:36Z",
    "author_association": "MEMBER",
    "body": "@kallewoof No, the lock on cs_wallet will happen after MarkBalancesDirty",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/308341918/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/308344209",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10251#issuecomment-308344209",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10251",
    "id": 308344209,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwODM0NDIwOQ==",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?u=7999a16349f0df0fb273fffa18e5a955c9d3f11c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-06-14T07:27:49Z",
    "updated_at": "2017-06-14T07:27:49Z",
    "author_association": "MEMBER",
    "body": "> But maybe I'm wrong\n\nYou're wrong.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/308344209/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/308345329",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10251#issuecomment-308345329",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10251",
    "id": 308345329,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwODM0NTMyOQ==",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?u=eab5d0cdbb6cc25087cb61d4ca4a6f85255f42a7&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-06-14T07:32:14Z",
    "updated_at": "2017-06-14T07:32:14Z",
    "author_association": "CONTRIBUTOR",
    "body": ">> But maybe I'm wrong\r\n\r\n> You're wrong.\r\n\r\nOkay. Then I'll better be quite.\r\nMoved up the `LOCK()`.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/308345329/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/308647720",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10251#issuecomment-308647720",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10251",
    "id": 308647720,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwODY0NzcyMA==",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-06-15T07:06:11Z",
    "updated_at": "2017-06-15T07:07:01Z",
    "author_association": "MEMBER",
    "body": "I'm trying to understand whether this will introduce a hang in the GUI thread in some cases.\r\n\r\nRight now, the recurrent poll timer (not thread! it's a qt timer which runs in the GUI thread) updates the balance *if* it's possible to get the locks using TRY_LOCK. Then it will get them, once, and process all balances.\r\n\r\nAfter this change the locks are no longer TRY, so the `BalancesChanged` signal will always cause the GUI thread to take the wallet locks (through `CWallet::get*Balance()`). Not once, but up to once per type of balance, if they all turn out to be dirty (which is likely).\r\nTaking the `cs_main` and `cs_wallet` lock up to 6 times can take ages when the `cs_main` lock is contended: during initial sync, catching up. This all happens in the GUI thread (at the receiving end of `updateBalance` signal).\r\n\r\nMaybe I'm misunderstanding the code, but if I'm right about this, I'm not convinced that this is an improvement in user experience.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/308647720/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/309009539",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10251#issuecomment-309009539",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10251",
    "id": 309009539,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwOTAwOTUzOQ==",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?u=eab5d0cdbb6cc25087cb61d4ca4a6f85255f42a7&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-06-16T12:05:13Z",
    "updated_at": "2017-06-16T12:05:13Z",
    "author_association": "CONTRIBUTOR",
    "body": "Some of the current heavy \"freezes\" are happening because of the balance poll thread... it seems to be a significant CPU eater.\r\nRight now, we TRY_LOCK every 250ms (which often LOCKS successfully and then iterates (multiple times) through the complete mapWallet).\r\n\r\n<img width=\"1027\" alt=\"bildschirmfoto 2017-06-16 um 14 00 59\" src=\"https://user-images.githubusercontent.com/178464/27225895-8d7eb58e-529c-11e7-95a6-895b9373367d.png\">",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/309009539/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/309010477",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10251#issuecomment-309010477",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10251",
    "id": 309010477,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwOTAxMDQ3Nw==",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?u=eab5d0cdbb6cc25087cb61d4ca4a6f85255f42a7&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-06-16T12:10:35Z",
    "updated_at": "2017-06-16T12:10:35Z",
    "author_association": "CONTRIBUTOR",
    "body": "Here the complete profiling (master):\r\n\r\nIt seems like that the pollBalanceThread took 50% of the complete CPU time for the measured run.\r\n(30 seconds, opening debug window and 10-20 times sendtoaddress)\r\n\r\n<img width=\"1026\" alt=\"bildschirmfoto 2017-06-16 um 14 09 00\" src=\"https://user-images.githubusercontent.com/178464/27226052-6664332e-529d-11e7-9f4b-bd02376c401e.png\">",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/309010477/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/309011605",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10251#issuecomment-309011605",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10251",
    "id": 309011605,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwOTAxMTYwNQ==",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?u=eab5d0cdbb6cc25087cb61d4ca4a6f85255f42a7&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-06-16T12:16:56Z",
    "updated_at": "2017-06-16T12:16:56Z",
    "author_association": "CONTRIBUTOR",
    "body": "I testes again with this PR and the responsiveness is much better. @laanwj points make sense to me.\r\n\r\nCould it be, that the TRY_LOCK every 250ms will result in getting the LOCK very often and then do the heavy balance calculation on the main thread because `QTimer` runs on the Main/GUI thread?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/309011605/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/309012390",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10251#issuecomment-309012390",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10251",
    "id": 309012390,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwOTAxMjM5MA==",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-06-16T12:20:58Z",
    "updated_at": "2017-06-16T12:20:58Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Could it be, that the TRY_LOCK every 250ms will result in getting the LOCK very often and then do the heavy balance calculation on the main thread because QTimer runs on the Main/GUI thread?\r\n\r\nThat's what I would expect. Have you thought about keeping the cache but bringing back the polling and try lock to address laanwj's point?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/309012390/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/309021160",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10251#issuecomment-309021160",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10251",
    "id": 309021160,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwOTAyMTE2MA==",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?u=eab5d0cdbb6cc25087cb61d4ca4a6f85255f42a7&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-06-16T13:05:14Z",
    "updated_at": "2017-06-16T13:05:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "@ryanofsky I profiled this PR with only the first commit (atomic caches, keep the polling).\r\nThe results are better, but not as good as with the signal/non-polling approach:\r\n\r\nTest run: Startup, call `sendtoaddress(getnewaddress(), 1)` 20 times manually\r\n\r\n## Master with only the first commit (pure atomic caches):\r\nThe polling thread gets measured (through significants) in my profiler with ~33% (very high IMO)\r\n<img width=\"1396\" alt=\"bildschirmfoto 2017-06-16 um 14 58 42\" src=\"https://user-images.githubusercontent.com/178464/27227684-c2640fda-52a4-11e7-9396-b111d1c28e13.png\">\r\n\r\n## Master with this PR\r\nThe balance updates seems no longer be significant:\r\n<img width=\"1396\" alt=\"bildschirmfoto 2017-06-16 um 15 04 14\" src=\"https://user-images.githubusercontent.com/178464/27227760-169d1c18-52a5-11e7-8d3a-f359c0f2b21b.png\">",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/309021160/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/310167848",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10251#issuecomment-310167848",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10251",
    "id": 310167848,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxMDE2Nzg0OA==",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-06-21T18:36:53Z",
    "updated_at": "2017-06-21T18:36:53Z",
    "author_association": "CONTRIBUTOR",
    "body": "Unclear to me if @laanwj's concern about losing the try lock is sufficiently addressed with the new testing and discussion at https://botbot.me/freenode/bitcoin-core-dev/msg/87346236/. If it is, maybe this PR is close to ready for merge (so far two utACKs from kallewoof and me). If not, it seems like there is some advantage (50% -> 30% poll thread cpu decrease) and no downside to just merging the first commit for now?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/310167848/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/310168368",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10251#issuecomment-310168368",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10251",
    "id": 310168368,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxMDE2ODM2OA==",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?u=eab5d0cdbb6cc25087cb61d4ca4a6f85255f42a7&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-06-21T18:38:54Z",
    "updated_at": "2017-06-21T18:38:54Z",
    "author_association": "CONTRIBUTOR",
    "body": "I guess it would be great if someone with (g)perf experience on Linux/Ubuntu and maybe on Windows could benchmark this PR against master.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/310168368/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/310187267",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10251#issuecomment-310187267",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10251",
    "id": 310187267,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxMDE4NzI2Nw==",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-06-21T19:54:33Z",
    "updated_at": "2017-06-21T19:54:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "Linux and windows performance tests seem like they would be a good sanity check on the numbers you collected (50% cpu usage spent on balance computation on master, 33% with caching commit, and ~0% with full pr), but is there some reason to think this behavior would be dependent on the platform?\r\n\r\nI guess the main thing I'm not clear on is whether the results you collected (assuming they do hold up on other platforms) address laanwj's concern above, or if there is some kind of different testing that needs to be done, or some other safeguard that should be added to prevent the possibility of new hangs.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/310187267/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/316568639",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10251#issuecomment-316568639",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10251",
    "id": 316568639,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNjU2ODYzOQ==",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?u=4a9af998e1a560b3f49c3827f453e1bcbe6a5cfb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-20T01:19:46Z",
    "updated_at": "2017-07-20T01:20:08Z",
    "author_association": "MEMBER",
    "body": "@jonasschnelli if still relevant I can do it.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/316568639/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/316614446",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10251#issuecomment-316614446",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10251",
    "id": 316614446,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNjYxNDQ0Ng==",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?u=eab5d0cdbb6cc25087cb61d4ca4a6f85255f42a7&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-20T06:57:35Z",
    "updated_at": "2017-07-20T06:57:35Z",
    "author_association": "CONTRIBUTOR",
    "body": "@promag: A benchmark would be very good to have.\r\nIdeally you compare master against this PR **and** against only the first commit in this PR (3 versions).\r\nThanks!",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/316614446/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/334353012",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10251#issuecomment-334353012",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10251",
    "id": 334353012,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzNDM1MzAxMg==",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?u=eab5d0cdbb6cc25087cb61d4ca4a6f85255f42a7&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-10-05T04:05:15Z",
    "updated_at": "2017-10-05T04:05:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "Closing for now... ",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/334353012/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112709836",
    "pull_request_review_id": 34048237,
    "id": 112709836,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMjcwOTgzNg==",
    "diff_hunk": "@@ -1902,95 +1909,123 @@ void CWallet::ResendWalletTransactions(int64_t nBestBlockTime, CConnman* connman\n  * @{\n  */\n \n+void CWallet::MarkBalancesDirty()\n+{\n+    fBalancesDirty = true;\n+    BalancesDidChange();\n+}\n \n CAmount CWallet::GetBalance() const\n {\n-    CAmount nTotal = 0;\n+    if (!fBalancesDirty) {\n+        return nBalanceCache;",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 87,
    "commit_id": "187b3eea4a9da6e589099289632ce0425e269e37",
    "original_commit_id": "69b751bd3635b28bb40815d7e370cc201cb0c6c5",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think think you need to acquire cs_wallet lock here, otherwise this could return a partial sum if `GetBalance` got called from two threads at the same time and one thread returned `nBalanceCache` while the other thread was in the middle of the `nBalanceCache +=` loop.\r\n\r\nAlternately, you could bring back the nTotal local variable and just set `nBalanceCache = nTotal`  atomically.",
    "created_at": "2017-04-21T15:07:29Z",
    "updated_at": "2017-06-16T13:01:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r112709836",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112709836"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r112709836"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112709836/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1879,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112710662",
    "pull_request_review_id": 34048237,
    "id": 112710662,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMjcxMDY2Mg==",
    "diff_hunk": "@@ -1902,95 +1909,123 @@ void CWallet::ResendWalletTransactions(int64_t nBestBlockTime, CConnman* connman\n  * @{\n  */\n \n+void CWallet::MarkBalancesDirty()\n+{\n+    fBalancesDirty = true;\n+    BalancesDidChange();\n+}\n \n CAmount CWallet::GetBalance() const\n {\n-    CAmount nTotal = 0;\n+    if (!fBalancesDirty) {\n+        return nBalanceCache;\n+    }\n+\n+    nBalanceCache = 0;",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 90,
    "commit_id": "187b3eea4a9da6e589099289632ce0425e269e37",
    "original_commit_id": "69b751bd3635b28bb40815d7e370cc201cb0c6c5",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think you need to move this line after the `LOCK2(cs_main, cs_wallet);` line. Otherwise if this method is called from two different threads simultaneously, this line could zero out a balance which is in the middle of being added up by the other thread.\r\n\r\nOr alternately, delete this line and and set nBalanceCache = nTotal atomically after the loop.",
    "created_at": "2017-04-21T15:10:37Z",
    "updated_at": "2017-06-16T13:01:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r112710662",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112710662"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r112710662"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112710662/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1924,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112713347",
    "pull_request_review_id": 34048237,
    "id": 112713347,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMjcxMzM0Nw==",
    "diff_hunk": "@@ -898,13 +899,26 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n     void ReacceptWalletTransactions();\n     void ResendWalletTransactions(int64_t nBestBlockTime, CConnman* connman) override;\n     std::vector<uint256> ResendWalletTransactionsBefore(int64_t nTime, CConnman* connman);\n+\n+    void MarkBalancesDirty();\n     CAmount GetBalance() const;\n     CAmount GetUnconfirmedBalance() const;\n     CAmount GetImmatureBalance() const;\n     CAmount GetWatchOnlyBalance() const;\n     CAmount GetUnconfirmedWatchOnlyBalance() const;\n     CAmount GetImmatureWatchOnlyBalance() const;\n \n+    mutable std::atomic<CAmount> nBalanceCache;\n+    mutable std::atomic<CAmount> nUnconfirmedBalanceCache;\n+    mutable std::atomic<CAmount> nImmatureBalanceCache;\n+    mutable std::atomic<CAmount> nWatchOnlyBalanceCache;\n+    mutable std::atomic<CAmount> nUnconfirmedWatchOnlyBalanceCache;\n+    mutable std::atomic<CAmount> nImmatureWatchOnlyBalanceCache;\n+    std::atomic<bool> fBalancesDirty;\n+\n+    /** Notification for balance changes */\n+    boost::signals2::signal<void ()> BalancesDidChange;",
    "path": "src/wallet/wallet.h",
    "position": null,
    "original_position": 30,
    "commit_id": "187b3eea4a9da6e589099289632ce0425e269e37",
    "original_commit_id": "69b751bd3635b28bb40815d7e370cc201cb0c6c5",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Maybe call it `BalancesChanged` instead of `BalancesDidChange` to be consistent with the naming of other signals (`StatusChanged`, `AddressBookChanged`, etc).",
    "created_at": "2017-04-21T15:21:59Z",
    "updated_at": "2017-06-16T13:01:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r112713347",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112713347"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r112713347"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112713347/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 920,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112721119",
    "pull_request_review_id": 34061013,
    "id": 112721119,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMjcyMTExOQ==",
    "diff_hunk": "@@ -1902,95 +1909,123 @@ void CWallet::ResendWalletTransactions(int64_t nBestBlockTime, CConnman* connman\n  * @{\n  */\n \n+void CWallet::MarkBalancesDirty()\n+{\n+    fBalancesDirty = true;\n+    BalancesDidChange();\n+}\n \n CAmount CWallet::GetBalance() const\n {\n-    CAmount nTotal = 0;\n+    if (!fBalancesDirty) {\n+        return nBalanceCache;",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 87,
    "commit_id": "187b3eea4a9da6e589099289632ce0425e269e37",
    "original_commit_id": "69b751bd3635b28bb40815d7e370cc201cb0c6c5",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Oh.. good point.\r\nI'll re-add the temp variable then.",
    "created_at": "2017-04-21T15:56:43Z",
    "updated_at": "2017-06-16T13:01:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r112721119",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112721119"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r112721119"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112721119/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1879,
    "side": "RIGHT",
    "in_reply_to_id": 112709836
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112721851",
    "pull_request_review_id": 34061812,
    "id": 112721851,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMjcyMTg1MQ==",
    "diff_hunk": "@@ -898,13 +899,26 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n     void ReacceptWalletTransactions();\n     void ResendWalletTransactions(int64_t nBestBlockTime, CConnman* connman) override;\n     std::vector<uint256> ResendWalletTransactionsBefore(int64_t nTime, CConnman* connman);\n+\n+    void MarkBalancesDirty();\n     CAmount GetBalance() const;\n     CAmount GetUnconfirmedBalance() const;\n     CAmount GetImmatureBalance() const;\n     CAmount GetWatchOnlyBalance() const;\n     CAmount GetUnconfirmedWatchOnlyBalance() const;\n     CAmount GetImmatureWatchOnlyBalance() const;\n \n+    mutable std::atomic<CAmount> nBalanceCache;\n+    mutable std::atomic<CAmount> nUnconfirmedBalanceCache;\n+    mutable std::atomic<CAmount> nImmatureBalanceCache;\n+    mutable std::atomic<CAmount> nWatchOnlyBalanceCache;\n+    mutable std::atomic<CAmount> nUnconfirmedWatchOnlyBalanceCache;\n+    mutable std::atomic<CAmount> nImmatureWatchOnlyBalanceCache;\n+    std::atomic<bool> fBalancesDirty;\n+\n+    /** Notification for balance changes */\n+    boost::signals2::signal<void ()> BalancesDidChange;",
    "path": "src/wallet/wallet.h",
    "position": null,
    "original_position": 30,
    "commit_id": "187b3eea4a9da6e589099289632ce0425e269e37",
    "original_commit_id": "69b751bd3635b28bb40815d7e370cc201cb0c6c5",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yes. I can do that. I kinda like the signal naming convention from apple. XYWillChange, XYDidChange, etc.: because it allows the listener to know (without reading to much code) if the event was synchronous or has triggered a process with a later update. But lets not overdo it here,.. will change therefore.",
    "created_at": "2017-04-21T15:59:57Z",
    "updated_at": "2017-06-16T13:01:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r112721851",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112721851"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r112721851"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112721851/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 920,
    "side": "RIGHT",
    "in_reply_to_id": 112713347
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114147182",
    "pull_request_review_id": 35590164,
    "id": 114147182,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNDE0NzE4Mg==",
    "diff_hunk": "@@ -780,6 +780,7 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n         nRelockTime = 0;\n         fAbortRescan = false;\n         fScanningWallet = false;\n+        fBalancesDirty = true;",
    "path": "src/wallet/wallet.h",
    "position": null,
    "original_position": 4,
    "commit_id": "187b3eea4a9da6e589099289632ce0425e269e37",
    "original_commit_id": "b18f6765c5f919de18562253f2f03f83e2ba9dcd",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"Add atomic cache for balances\"\r\n\r\nThe whole caching portion of this PR actually seems broken because `fBalancesDirty` is initialized to true but never set to false anywhere. I think this can be fixed, but maybe simplest thing to do would be to drop the caching, and just keep the signalling part of this PR.",
    "created_at": "2017-05-01T16:09:11Z",
    "updated_at": "2017-06-16T13:01:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r114147182",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114147182"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r114147182"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114147182/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 783,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114156091",
    "pull_request_review_id": 35590164,
    "id": 114156091,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNDE1NjA5MQ==",
    "diff_hunk": "@@ -137,12 +136,6 @@ void WalletModel::updateBalance()\n     }\n }\n \n-void WalletModel::updateTransaction()",
    "path": "src/qt/walletmodel.cpp",
    "position": 64,
    "original_position": 12,
    "commit_id": "187b3eea4a9da6e589099289632ce0425e269e37",
    "original_commit_id": "e63ab9be56827166cc40f890bf252361ef27808b",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"[Qt] remove unused polling code\"\r\n\r\nI think it would be good to squash this commit into \"[Qt] use the BalancesChanged signal instead of a 250ms poll timer.\" It's confusing to see code that checks the `fForceCheckBalanceChanged` variable and some code that sets it removed, while other code that sets it sticks around.",
    "created_at": "2017-05-01T17:05:22Z",
    "updated_at": "2017-06-16T13:01:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r114156091",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114156091"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r114156091"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114156091/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 169,
    "original_line": 169,
    "side": "LEFT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114711533",
    "pull_request_review_id": 36199012,
    "id": 114711533,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNDcxMTUzMw==",
    "diff_hunk": "@@ -780,6 +780,7 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n         nRelockTime = 0;\n         fAbortRescan = false;\n         fScanningWallet = false;\n+        fBalancesDirty = true;",
    "path": "src/wallet/wallet.h",
    "position": null,
    "original_position": 4,
    "commit_id": "187b3eea4a9da6e589099289632ce0425e269e37",
    "original_commit_id": "b18f6765c5f919de18562253f2f03f83e2ba9dcd",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Oh. Yes indeed. I now switched to a cache-invalidation-atomic per balance type and set it to `false` once the cache has been built.",
    "created_at": "2017-05-04T07:19:24Z",
    "updated_at": "2017-06-16T13:01:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r114711533",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114711533"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r114711533"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114711533/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 783,
    "side": "RIGHT",
    "in_reply_to_id": 114147182
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114711567",
    "pull_request_review_id": 36199047,
    "id": 114711567,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNDcxMTU2Nw==",
    "diff_hunk": "@@ -137,12 +136,6 @@ void WalletModel::updateBalance()\n     }\n }\n \n-void WalletModel::updateTransaction()",
    "path": "src/qt/walletmodel.cpp",
    "position": 64,
    "original_position": 12,
    "commit_id": "187b3eea4a9da6e589099289632ce0425e269e37",
    "original_commit_id": "e63ab9be56827166cc40f890bf252361ef27808b",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Good point. Squashed those two commits together.",
    "created_at": "2017-05-04T07:19:39Z",
    "updated_at": "2017-06-16T13:01:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r114711567",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114711567"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r114711567"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114711567/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 169,
    "original_line": 169,
    "side": "LEFT",
    "in_reply_to_id": 114156091
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114810109",
    "pull_request_review_id": 36301148,
    "id": 114810109,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNDgxMDEwOQ==",
    "diff_hunk": "@@ -1914,13 +1935,18 @@ CAmount CWallet::GetBalance() const\n             if (pcoin->IsTrusted())\n                 nTotal += pcoin->GetAvailableCredit();\n         }\n+        nBalanceCache = nTotal;\n+        fBalancesDirty = false;",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 102,
    "commit_id": "187b3eea4a9da6e589099289632ce0425e269e37",
    "original_commit_id": "28637b62546a37bdf8e7502e3247413fb92c6ec3",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"Add atomic cache for balances\"\r\n\r\nMaybe rename `fBalancesDirty` to `fBalanceDirty` since this only applies to the balance returned from CWallet::GetBalance and not the other balances.",
    "created_at": "2017-05-04T15:22:15Z",
    "updated_at": "2017-06-16T13:01:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r114810109",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114810109"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r114810109"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114810109/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1939,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121867835",
    "pull_request_review_id": 43929442,
    "id": 121867835,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMTg2NzgzNQ==",
    "diff_hunk": "@@ -812,11 +813,11 @@ bool CWallet::GetAccountPubkey(CPubKey &pubKey, std::string strAccount, bool bFo\n \n void CWallet::MarkDirty()\n {\n-    {\n-        LOCK(cs_wallet);\n-        for (std::pair<const uint256, CWalletTx>& item : mapWallet)\n-            item.second.MarkDirty();\n-    }\n+    MarkBalancesDirty();\n+\n+    LOCK(cs_wallet);",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 19,
    "commit_id": "187b3eea4a9da6e589099289632ce0425e269e37",
    "original_commit_id": "51a7a33141a0772d154da736d69fc08106d2262d",
    "user": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Am I mistaken when I think that the lock on `cs_wallet` will actually happen before the call to `MarkBalancesDirty()` due to scope? If so I would swap these lines for clarity.",
    "created_at": "2017-06-14T06:58:07Z",
    "updated_at": "2017-06-16T13:01:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r121867835",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121867835"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r121867835"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121867835/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 816,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121872229",
    "pull_request_review_id": 43934262,
    "id": 121872229,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMTg3MjIyOQ==",
    "diff_hunk": "@@ -812,11 +813,11 @@ bool CWallet::GetAccountPubkey(CPubKey &pubKey, std::string strAccount, bool bFo\n \n void CWallet::MarkDirty()\n {\n-    {\n-        LOCK(cs_wallet);\n-        for (std::pair<const uint256, CWalletTx>& item : mapWallet)\n-            item.second.MarkDirty();\n-    }\n+    MarkBalancesDirty();\n+\n+    LOCK(cs_wallet);",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 19,
    "commit_id": "187b3eea4a9da6e589099289632ce0425e269e37",
    "original_commit_id": "51a7a33141a0772d154da736d69fc08106d2262d",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I guess I should move the `LOCK()` up to the top. Because its RAII, I think it doesn't matter in this case (no extra block). The lock should take affect when we enter the function/scope (before `MarkBalancesDirty()`). But maybe I'm wrong.",
    "created_at": "2017-06-14T07:26:42Z",
    "updated_at": "2017-06-16T13:01:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r121872229",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121872229"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r121872229"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121872229/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 816,
    "side": "RIGHT",
    "in_reply_to_id": 121867835
  }
]