[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/456116167",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#issuecomment-456116167",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15218",
    "id": 456116167,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NjExNjE2Nw==",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-21T15:42:25Z",
    "updated_at": "2019-01-21T15:42:25Z",
    "author_association": "MEMBER",
    "body": "Concept ACK, but I think `IsInitialBlockDownload` is the wrong place to implement this, as it's a query function, having it suddenly spawn a thread that flushes is unexpected.\r\n\r\nWould be better to implement it closer to the validation logic and database update logic itself.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/456116167/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/456224773",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#issuecomment-456224773",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15218",
    "id": 456224773,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NjIyNDc3Mw==",
    "user": {
      "login": "andrewtoth",
      "id": 237213,
      "node_id": "MDQ6VXNlcjIzNzIxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewtoth",
      "html_url": "https://github.com/andrewtoth",
      "followers_url": "https://api.github.com/users/andrewtoth/followers",
      "following_url": "https://api.github.com/users/andrewtoth/following{/other_user}",
      "gists_url": "https://api.github.com/users/andrewtoth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
      "repos_url": "https://api.github.com/users/andrewtoth/repos",
      "events_url": "https://api.github.com/users/andrewtoth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-21T23:34:07Z",
    "updated_at": "2019-01-21T23:34:07Z",
    "author_association": "CONTRIBUTOR",
    "body": "@laanwj Good point. I refactored to move this behaviour to `ActivateBestChain` in an area where periodic flushes are already expected.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/456224773/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/456382561",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#issuecomment-456382561",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15218",
    "id": 456382561,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NjM4MjU2MQ==",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-22T12:29:36Z",
    "updated_at": "2019-01-22T12:29:36Z",
    "author_association": "MEMBER",
    "body": "> @laanwj Good point. I refactored to move this behaviour to ActivateBestChain in an area where periodic flushes are already expected.\r\n\r\nThanks, much better!",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/456382561/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/456558815",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#issuecomment-456558815",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15218",
    "id": 456558815,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NjU1ODgxNQ==",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-22T20:52:23Z",
    "updated_at": "2019-01-22T20:52:23Z",
    "author_association": "MEMBER",
    "body": "I'm not really a fan of this change -- the problem described in #11600 is from an unclean shutdown (ie system crash), where our recovery code could take a long time (but typically would be much faster than doing a -reindex to recover, which is how our code used to work).\r\n\r\nThis change doesn't really solve that problem, it just changes the window in which an unclean shutdown could occur (reducing it at most by 24 hours).  But extra flushes, particularly during initial sync, aren't obviously a good idea, since they harm performance.  (Note that we leave IBD before we've synced all the way to the tip, I think once we're within a day or two?)\r\n\r\nBecause we flush every day anyway, it's hard for me to say that this is really that much worse, performance-wise (after all we don't currently support a node configuration where the utxo is kept entirely cached).  But I'm not sure this solves anything either, and a change like this would have to be reverted if, for instance, we wanted to make the cache actually more useful on startup (something I've thought we should do for a while).  So I think I'm a -0 on this change.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/456558815/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/456628736",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#issuecomment-456628736",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15218",
    "id": 456628736,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NjYyODczNg==",
    "user": {
      "login": "andrewtoth",
      "id": 237213,
      "node_id": "MDQ6VXNlcjIzNzIxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewtoth",
      "html_url": "https://github.com/andrewtoth",
      "followers_url": "https://api.github.com/users/andrewtoth/followers",
      "following_url": "https://api.github.com/users/andrewtoth/following{/other_user}",
      "gists_url": "https://api.github.com/users/andrewtoth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
      "repos_url": "https://api.github.com/users/andrewtoth/repos",
      "events_url": "https://api.github.com/users/andrewtoth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-23T01:18:19Z",
    "updated_at": "2019-01-23T01:36:55Z",
    "author_association": "CONTRIBUTOR",
    "body": "@sdaftuar This change also greatly improves the common workflow of spinning up a high performance instance to sync, then immediately shutting it down and using a cheaper one. Currently, you have to enter it and do a clean shutdown instead of just terminating. Similarly, when syncing to an external drive, you can now just unplug the drive or turn off the machine when finished.\r\n\r\nI would argue that moving the window to 0 hours directly after initial sync is an objective improvement. There is a lot of data that will be lost directly after, so why risk another 24 hours? After that, the most they will lose is 24 hours worth of rolling back, instead of 10 years. Also, this change does *not* do any extra flushes during initial sync, only after.\r\n\r\nI can't speak to your last point about changing the way we use the cache, since I don't know what your ideas are.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/456628736/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/456885613",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#issuecomment-456885613",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15218",
    "id": 456885613,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1Njg4NTYxMw==",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-23T17:08:54Z",
    "updated_at": "2019-01-23T17:08:54Z",
    "author_association": "MEMBER",
    "body": "> Currently, you have to enter it and do a clean shutdown instead of just terminating.\r\n\r\n@andrewtoth We already support this (better, I think) with the `-stopatheight` argument, no?\r\n\r\nI don't really view data that is in memory as \"at risk\"; I view it as a massive performance optimization that will allow a node to process new blocks at the fastest possible speed while the data hasn't yet been flushed.  I also don't feel very strongly about this for the reasons I gave above, so if others want this behavior then so be it.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/456885613/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/456935332",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#issuecomment-456935332",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15218",
    "id": 456935332,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NjkzNTMzMg==",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?u=7999a16349f0df0fb273fffa18e5a955c9d3f11c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-23T19:31:04Z",
    "updated_at": "2019-01-23T19:31:04Z",
    "author_association": "MEMBER",
    "body": "@sdaftuar Maybe this is a bit of a different discussion, but there is another option; namely supporting flushing the dirty state to disk, but without wiping it from the cache. Based on our earlier benchmarking, we wouldn't want to do this purely for maximizing IBD performance, but it could be done at specific times to minimize losses in case of crashes (the once per day flush for example, and also this IBD-is-finshed one).",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/456935332/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/456939539",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#issuecomment-456939539",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15218",
    "id": 456939539,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NjkzOTUzOQ==",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-23T19:43:35Z",
    "updated_at": "2019-01-23T19:43:35Z",
    "author_association": "MEMBER",
    "body": "@sipa Agreed, I think that would make a lot more sense as a first pass optimization for the periodic flushes and would also work better for this purpose as well.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/456939539/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/457321738",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#issuecomment-457321738",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15218",
    "id": 457321738,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NzMyMTczOA==",
    "user": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?u=63e5c438c242094837a9deeda775d77988b508bf&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-24T19:18:26Z",
    "updated_at": "2019-01-24T19:18:26Z",
    "author_association": "CONTRIBUTOR",
    "body": "> . Currently, you have to enter it and do a clean shutdown instead of just terminating. \r\n\r\nWell with this, if you \"just terminate\" you're going to end up with a replay of several days blocks at start, which is still ugly, even if less bad via this.\r\n\r\nAside, actually if you actually shut off the computer any time during IBD you'll likely completely corrupt the state and need to reindex because we don't use fsync during IBD for performance reasons.\r\n\r\nWe really need to get background writing going, so that our writes are never more than (say) a week of blocktime behind... but that is a much bigger change, so I don't suggest \"just do that instead\", though it would make the change here completely unnecessary.\r\n\r\nMight it be better to trigger the flush the first time it goes 30 seconds without connecting a block and there are no queued transfers, from the scheduler thread? ",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/457321738/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/457431998",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#issuecomment-457431998",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15218",
    "id": 457431998,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NzQzMTk5OA==",
    "user": {
      "login": "andrewtoth",
      "id": 237213,
      "node_id": "MDQ6VXNlcjIzNzIxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewtoth",
      "html_url": "https://github.com/andrewtoth",
      "followers_url": "https://api.github.com/users/andrewtoth/followers",
      "following_url": "https://api.github.com/users/andrewtoth/following{/other_user}",
      "gists_url": "https://api.github.com/users/andrewtoth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
      "repos_url": "https://api.github.com/users/andrewtoth/repos",
      "events_url": "https://api.github.com/users/andrewtoth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-25T02:22:19Z",
    "updated_at": "2019-01-25T02:23:19Z",
    "author_association": "CONTRIBUTOR",
    "body": "> @andrewtoth We already support this (better, I think) with the `-stopatheight` argument, no?\r\n\r\n@sdaftuar Ahh, I never considered using that for this purpose. Thanks!\r\n\r\n@gmaxwell It might still be ugly to have a replay of a few days, but much better than making everything unusable for hours. \r\n\r\nThere are comments from several people in this PR about adding background writing and writing dirty state to disk without wiping the cache. This change wouldn't affect either of those improvements, and is an improvement by itself in the interim.\r\n\r\nAs for moving this to the scheduler thread, I think this is better since it happens in a place where periodic flushes are already expected Also, checking every 30 seconds for a new block wouldn't work if for instance the network cuts out for a few minutes.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/457431998/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/457434328",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#issuecomment-457434328",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15218",
    "id": 457434328,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NzQzNDMyOA==",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?u=7999a16349f0df0fb273fffa18e5a955c9d3f11c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-25T02:36:04Z",
    "updated_at": "2019-01-25T02:36:04Z",
    "author_association": "MEMBER",
    "body": "@andrewtoth The problem is that right now, causing a flush when exiting IBD will (temporarily) kill your performance right before finishing the sync (because it leaves you with an empty cache). If instead it was a non-clearing flush, there would be no such downside.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/457434328/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/458662734",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#issuecomment-458662734",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15218",
    "id": 458662734,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1ODY2MjczNA==",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-29T18:56:40Z",
    "updated_at": "2019-01-29T18:56:40Z",
    "author_association": "MEMBER",
    "body": "My experiment in #15265 has changed my view on this a bit -- now I think that we might as well make a change like this for now, but should change the approach slightly to do something like @gmaxwell's proposal so that we don't trigger the flush before we are done syncing:\r\n\r\n> Might it be better to trigger the flush the first time it goes 30 seconds without connecting a block and there are no queued transfers, from the scheduler thread?\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/458662734/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/462169529",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#issuecomment-462169529",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15218",
    "id": 462169529,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MjE2OTUyOQ==",
    "user": {
      "login": "andrewtoth",
      "id": 237213,
      "node_id": "MDQ6VXNlcjIzNzIxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewtoth",
      "html_url": "https://github.com/andrewtoth",
      "followers_url": "https://api.github.com/users/andrewtoth/followers",
      "following_url": "https://api.github.com/users/andrewtoth/following{/other_user}",
      "gists_url": "https://api.github.com/users/andrewtoth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
      "repos_url": "https://api.github.com/users/andrewtoth/repos",
      "events_url": "https://api.github.com/users/andrewtoth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-10T20:34:41Z",
    "updated_at": "2019-02-10T20:34:57Z",
    "author_association": "CONTRIBUTOR",
    "body": "@sdaftuar @gmaxwell I've updated this to check every 30 seconds on the scheduler thread if there has been an update to the active chain height. This only actually checks after `IsInitialBlockDownload` is false, which happens if latest block is within a day of the current time. \r\n\r\nI'm not sure how to check if there are queued transfers. If this is not sufficient, some guidance on how to do that would be appreciated.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/462169529/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/462213268",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#issuecomment-462213268",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15218",
    "id": 462213268,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MjIxMzI2OA==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-11T03:49:58Z",
    "updated_at": "2019-10-03T22:46:57Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#16839](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16839.html) (Replace Connman and BanMan globals with Node local by ryanofsky)\n* [#16834](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16834.html) (Fetch Headers over DNS by TheBlueMatt)\n* [#16762](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16762.html) (Rust-based Backup over-REST block downloader by TheBlueMatt)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/462213268/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/485429170",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#issuecomment-485429170",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15218",
    "id": 485429170,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4NTQyOTE3MA==",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-22T14:14:13Z",
    "updated_at": "2019-04-22T14:14:13Z",
    "author_association": "MEMBER",
    "body": "utACK 5d9aa4c6432bd41e8d65717976293e006a6c732a",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/485429170/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/485443155",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#issuecomment-485443155",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15218",
    "id": 485443155,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4NTQ0MzE1NQ==",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-22T15:04:08Z",
    "updated_at": "2019-04-22T15:04:08Z",
    "author_association": "MEMBER",
    "body": "> I'm not sure how to check if there are queued transfers. If this is not sufficient, some guidance on how to do that would be appreciated.\r\n\r\nThere's a variable called `nPeersWithValidatedDownloads` in `net_processing.cpp` which indicates how many peers we are downloading blocks from.  So to implement @gmaxwell's suggestion I think you would just need to expose that variable and then check to see if it equals 0.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/485443155/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/485602817",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#issuecomment-485602817",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15218",
    "id": 485602817,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4NTYwMjgxNw==",
    "user": {
      "login": "andrewtoth",
      "id": 237213,
      "node_id": "MDQ6VXNlcjIzNzIxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewtoth",
      "html_url": "https://github.com/andrewtoth",
      "followers_url": "https://api.github.com/users/andrewtoth/followers",
      "following_url": "https://api.github.com/users/andrewtoth/following{/other_user}",
      "gists_url": "https://api.github.com/users/andrewtoth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
      "repos_url": "https://api.github.com/users/andrewtoth/repos",
      "events_url": "https://api.github.com/users/andrewtoth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-23T00:57:45Z",
    "updated_at": "2019-04-23T00:57:45Z",
    "author_association": "CONTRIBUTOR",
    "body": "@sdaftuar Thanks. Updated.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/485602817/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/523587757",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#issuecomment-523587757",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15218",
    "id": 523587757,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyMzU4Nzc1Nw==",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-21T18:17:26Z",
    "updated_at": "2019-08-21T18:17:26Z",
    "author_association": "CONTRIBUTOR",
    "body": "-0.5. This is really not the right way to go here, I think. Namely, people with high dbcache may also want to use it after IBD completes (ie cause they want to connect blocks quickly), and this breaks that by wiping the cache completely. Coupling it with a change to not drop non-dirty entries while flushing is the easy fix to make it not have a regression, though a more complete cleanup of background flushing would also be nice.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/523587757/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/523609555",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#issuecomment-523609555",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15218",
    "id": 523609555,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyMzYwOTU1NQ==",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-21T19:14:39Z",
    "updated_at": "2019-08-21T19:14:39Z",
    "author_association": "MEMBER",
    "body": "> this breaks that by wiping the cache completely\r\n\r\nOn a sort of related note, I think it's kind of crazy that we couple writing back to disk with emptying the in-memory cache. Feels like those should be separate considerations, especially in a case like this.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/523609555/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/539441272",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#issuecomment-539441272",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15218",
    "id": 539441272,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzOTQ0MTI3Mg==",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-08T09:55:18Z",
    "updated_at": "2019-10-08T09:55:18Z",
    "author_association": "MEMBER",
    "body": "This PR seems to be too controversial to merge in the current state, and discussion has become inactive. Closing as up for grabs. Let me know if you start work on this again and I'll re-open it.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/539441272/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554540031",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#issuecomment-554540031",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15218",
    "id": 554540031,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NDU0MDAzMQ==",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-15T21:42:53Z",
    "updated_at": "2019-11-15T21:42:53Z",
    "author_association": "MEMBER",
    "body": "Could rebase on top of something like: #17487, and then open a new pull request and link to this discussion which is mostly about \"NACK, because this will erase the cache\".",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554540031/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554597640",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#issuecomment-554597640",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15218",
    "id": 554597640,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NDU5NzY0MA==",
    "user": {
      "login": "andrewtoth",
      "id": 237213,
      "node_id": "MDQ6VXNlcjIzNzIxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewtoth",
      "html_url": "https://github.com/andrewtoth",
      "followers_url": "https://api.github.com/users/andrewtoth/followers",
      "following_url": "https://api.github.com/users/andrewtoth/following{/other_user}",
      "gists_url": "https://api.github.com/users/andrewtoth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
      "repos_url": "https://api.github.com/users/andrewtoth/repos",
      "events_url": "https://api.github.com/users/andrewtoth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-16T03:00:11Z",
    "updated_at": "2019-11-16T03:00:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "@MarcoFalke Thanks for bringing that to my attention. What is the benefit of making a new PR instead of reopening this one? Just for visibility?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554597640/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554598794",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#issuecomment-554598794",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15218",
    "id": 554598794,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NDU5ODc5NA==",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-16T03:16:49Z",
    "updated_at": "2019-11-16T03:16:49Z",
    "author_association": "MEMBER",
    "body": "Up to you. Let me know if you want this reopened.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554598794/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554605063",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#issuecomment-554605063",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15218",
    "id": 554605063,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NDYwNTA2Mw==",
    "user": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-16T05:02:30Z",
    "updated_at": "2019-11-16T05:02:30Z",
    "author_association": "MEMBER",
    "body": "The benefit is that the no-longer-applicable criticism is no longer right there at first glance.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554605063/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557525370",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#issuecomment-557525370",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15218",
    "id": 557525370,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NzUyNTM3MA==",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-22T13:09:39Z",
    "updated_at": "2019-11-22T13:09:39Z",
    "author_association": "MEMBER",
    "body": "Given that it was found this does not negatively affect performance, see https://github.com/bitcoin/bitcoin/pull/15265#issuecomment-458657451, I think it should be reconsidered in its current form.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557525370/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557551815",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#issuecomment-557551815",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15218",
    "id": 557551815,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NzU1MTgxNQ==",
    "user": {
      "login": "andrewtoth",
      "id": 237213,
      "node_id": "MDQ6VXNlcjIzNzIxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewtoth",
      "html_url": "https://github.com/andrewtoth",
      "followers_url": "https://api.github.com/users/andrewtoth/followers",
      "following_url": "https://api.github.com/users/andrewtoth/following{/other_user}",
      "gists_url": "https://api.github.com/users/andrewtoth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
      "repos_url": "https://api.github.com/users/andrewtoth/repos",
      "events_url": "https://api.github.com/users/andrewtoth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-22T14:27:09Z",
    "updated_at": "2019-11-22T14:27:09Z",
    "author_association": "CONTRIBUTOR",
    "body": "@MarcoFalke I don't think the takeaway from that comment is that it doesn't affect performance. That was benchmarking IBD for pruned nodes with not emptying the cache on flush. This PR is flushing the dbcache after IBD. I'm sure for a non-pruned node with a high dbcache this will negatively affect performance directly after the flush, as @TheBlueMatt 's comment points out.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557551815/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557553220",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#issuecomment-557553220",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15218",
    "id": 557553220,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NzU1MzIyMA==",
    "user": {
      "login": "andrewtoth",
      "id": 237213,
      "node_id": "MDQ6VXNlcjIzNzIxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewtoth",
      "html_url": "https://github.com/andrewtoth",
      "followers_url": "https://api.github.com/users/andrewtoth/followers",
      "following_url": "https://api.github.com/users/andrewtoth/following{/other_user}",
      "gists_url": "https://api.github.com/users/andrewtoth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
      "repos_url": "https://api.github.com/users/andrewtoth/repos",
      "events_url": "https://api.github.com/users/andrewtoth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-22T14:31:20Z",
    "updated_at": "2019-11-22T14:31:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "If #17487 gets merged I will rebase this, perhaps without checking for active peers since the cache would no longer be affected and it will make the diff smaller.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557553220/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557789811",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#issuecomment-557789811",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15218",
    "id": 557789811,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1Nzc4OTgxMQ==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-23T11:26:42Z",
    "updated_at": "2019-11-23T11:26:42Z",
    "author_association": "MEMBER",
    "body": "Concept ACK on doing a `Flush(erase=false)` at the end of IBD once support for that is merged. It probably still makes sense to wait a little bit (e.g. checking for active peers), otherwise the user might be bothered with this flush right before sync really finishes.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557789811/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/249294009",
    "pull_request_review_id": 194407400,
    "id": 249294009,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0OTI5NDAwOQ==",
    "diff_hunk": "@@ -1190,6 +1190,11 @@ bool IsInitialBlockDownload()\n         return true;\n     if (chainActive.Tip()->GetBlockTime() < (GetTime() - nMaxTipAge))\n         return true;\n+\n+    // Flush state after IBD is finished, but don't block return\n+    void (*flush_ptr)() = &FlushStateToDisk;\n+    std::thread(flush_ptr).detach();",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 7,
    "commit_id": "d2ecb70d6441ae6ff03ccffa64622da56f5c2511",
    "original_commit_id": "c5c5702ffeba817dbe0c1ae6135462e1060fa2f9",
    "user": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Could be written as `std::thread(FlushStateToDisk).detach();`?",
    "created_at": "2019-01-20T20:19:59Z",
    "updated_at": "2019-07-31T16:38:24Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r249294009",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/249294009"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r249294009"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/249294009/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1196,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/249294143",
    "pull_request_review_id": 194407541,
    "id": 249294143,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0OTI5NDE0Mw==",
    "diff_hunk": "@@ -1190,6 +1190,11 @@ bool IsInitialBlockDownload()\n         return true;\n     if (chainActive.Tip()->GetBlockTime() < (GetTime() - nMaxTipAge))\n         return true;\n+\n+    // Flush state after IBD is finished, but don't block return\n+    void (*flush_ptr)() = &FlushStateToDisk;\n+    std::thread(flush_ptr).detach();",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 7,
    "commit_id": "d2ecb70d6441ae6ff03ccffa64622da56f5c2511",
    "original_commit_id": "c5c5702ffeba817dbe0c1ae6135462e1060fa2f9",
    "user": {
      "login": "andrewtoth",
      "id": 237213,
      "node_id": "MDQ6VXNlcjIzNzIxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewtoth",
      "html_url": "https://github.com/andrewtoth",
      "followers_url": "https://api.github.com/users/andrewtoth/followers",
      "following_url": "https://api.github.com/users/andrewtoth/following{/other_user}",
      "gists_url": "https://api.github.com/users/andrewtoth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
      "repos_url": "https://api.github.com/users/andrewtoth/repos",
      "events_url": "https://api.github.com/users/andrewtoth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "No, because `FlushStateToDisk` is overloaded and the compiler can't determine which function to call in that case.",
    "created_at": "2019-01-20T20:23:47Z",
    "updated_at": "2019-07-31T16:38:24Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r249294143",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/249294143"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r249294143"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/249294143/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1196,
    "side": "RIGHT",
    "in_reply_to_id": 249294009
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/249294554",
    "pull_request_review_id": 194407962,
    "id": 249294554,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0OTI5NDU1NA==",
    "diff_hunk": "@@ -1190,6 +1190,11 @@ bool IsInitialBlockDownload()\n         return true;\n     if (chainActive.Tip()->GetBlockTime() < (GetTime() - nMaxTipAge))\n         return true;\n+\n+    // Flush state after IBD is finished, but don't block return\n+    void (*flush_ptr)() = &FlushStateToDisk;\n+    std::thread(flush_ptr).detach();",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 7,
    "commit_id": "d2ecb70d6441ae6ff03ccffa64622da56f5c2511",
    "original_commit_id": "c5c5702ffeba817dbe0c1ae6135462e1060fa2f9",
    "user": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "@andrewtoth Ah, yes! Thanks!\r\n\r\n```\r\n$ git grep ' FlushStateToDisk.*{'\r\nsrc/validation.cpp:bool static FlushStateToDisk(const CChainParams& chainparams, CValidationState &state, FlushStateMode mode, int nManualPruneHeight) {\r\nsrc/validation.cpp:void FlushStateToDisk() {\r\n```",
    "created_at": "2019-01-20T20:35:47Z",
    "updated_at": "2019-07-31T16:38:24Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r249294554",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/249294554"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r249294554"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/249294554/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1196,
    "side": "RIGHT",
    "in_reply_to_id": 249294009
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/249655399",
    "pull_request_review_id": 194853140,
    "id": 249655399,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0OTY1NTM5OQ==",
    "diff_hunk": "@@ -2751,7 +2751,13 @@ bool CChainState::ActivateBestChain(CValidationState &state, const CChainParams&\n     CheckBlockIndex(chainparams.GetConsensus());\n \n     // Write changes periodically to disk, after relay.\n-    if (!FlushStateToDisk(chainparams, state, FlushStateMode::PERIODIC)) {\n+    // Unless we just finished initial sync, then always write to disk\n+    static bool initially_in_ibd = true;\n+    bool finished_ibd = initially_in_ibd && !IsInitialBlockDownload();\n+    if (finished_ibd) {\n+      initially_in_ibd = false;",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 9,
    "commit_id": "d2ecb70d6441ae6ff03ccffa64622da56f5c2511",
    "original_commit_id": "e3e1e7aac49db4133d0c412ad6c82251daff883b",
    "user": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Wrong indentation :-)",
    "created_at": "2019-01-22T06:37:07Z",
    "updated_at": "2019-07-31T16:38:24Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r249655399",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/249655399"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r249655399"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/249655399/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2758,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/249799715",
    "pull_request_review_id": 195030884,
    "id": 249799715,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0OTc5OTcxNQ==",
    "diff_hunk": "@@ -2751,7 +2751,13 @@ bool CChainState::ActivateBestChain(CValidationState &state, const CChainParams&\n     CheckBlockIndex(chainparams.GetConsensus());\n \n     // Write changes periodically to disk, after relay.\n-    if (!FlushStateToDisk(chainparams, state, FlushStateMode::PERIODIC)) {\n+    // Unless we just finished initial sync, then always write to disk\n+    static bool initially_in_ibd = true;\n+    bool finished_ibd = initially_in_ibd && !IsInitialBlockDownload();\n+    if (finished_ibd) {\n+      initially_in_ibd = false;",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 9,
    "commit_id": "d2ecb70d6441ae6ff03ccffa64622da56f5c2511",
    "original_commit_id": "e3e1e7aac49db4133d0c412ad6c82251daff883b",
    "user": {
      "login": "andrewtoth",
      "id": 237213,
      "node_id": "MDQ6VXNlcjIzNzIxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewtoth",
      "html_url": "https://github.com/andrewtoth",
      "followers_url": "https://api.github.com/users/andrewtoth/followers",
      "following_url": "https://api.github.com/users/andrewtoth/following{/other_user}",
      "gists_url": "https://api.github.com/users/andrewtoth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
      "repos_url": "https://api.github.com/users/andrewtoth/repos",
      "events_url": "https://api.github.com/users/andrewtoth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Fixed.",
    "created_at": "2019-01-22T14:25:56Z",
    "updated_at": "2019-07-31T16:38:24Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r249799715",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/249799715"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r249799715"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/249799715/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2758,
    "side": "RIGHT",
    "in_reply_to_id": 249655399
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/249810717",
    "pull_request_review_id": 195044542,
    "id": 249810717,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0OTgxMDcxNw==",
    "diff_hunk": "@@ -2751,7 +2751,13 @@ bool CChainState::ActivateBestChain(CValidationState &state, const CChainParams&\n     CheckBlockIndex(chainparams.GetConsensus());\n \n     // Write changes periodically to disk, after relay.\n-    if (!FlushStateToDisk(chainparams, state, FlushStateMode::PERIODIC)) {\n+    // Unless we just finished initial sync, then always write to disk\n+    static bool initially_in_ibd = true;",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 6,
    "commit_id": "d2ecb70d6441ae6ff03ccffa64622da56f5c2511",
    "original_commit_id": "36628231dc52096f1613e6b85241eadc4df9cb09",
    "user": {
      "login": "ken2812221",
      "id": 11154118,
      "node_id": "MDQ6VXNlcjExMTU0MTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/11154118?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ken2812221",
      "html_url": "https://github.com/ken2812221",
      "followers_url": "https://api.github.com/users/ken2812221/followers",
      "following_url": "https://api.github.com/users/ken2812221/following{/other_user}",
      "gists_url": "https://api.github.com/users/ken2812221/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ken2812221/subscriptions",
      "organizations_url": "https://api.github.com/users/ken2812221/orgs",
      "repos_url": "https://api.github.com/users/ken2812221/repos",
      "events_url": "https://api.github.com/users/ken2812221/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ken2812221/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think that this variable should be the member of CChainState to avoid share same variable if we have two CChainState object in the program.",
    "created_at": "2019-01-22T14:51:15Z",
    "updated_at": "2019-07-31T16:38:24Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r249810717",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/249810717"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r249810717"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/249810717/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2755,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250027236",
    "pull_request_review_id": 195312218,
    "id": 250027236,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MDAyNzIzNg==",
    "diff_hunk": "@@ -2751,7 +2751,13 @@ bool CChainState::ActivateBestChain(CValidationState &state, const CChainParams&\n     CheckBlockIndex(chainparams.GetConsensus());\n \n     // Write changes periodically to disk, after relay.\n-    if (!FlushStateToDisk(chainparams, state, FlushStateMode::PERIODIC)) {\n+    // Unless we just finished initial sync, then always write to disk\n+    static bool initially_in_ibd = true;",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 6,
    "commit_id": "d2ecb70d6441ae6ff03ccffa64622da56f5c2511",
    "original_commit_id": "36628231dc52096f1613e6b85241eadc4df9cb09",
    "user": {
      "login": "andrewtoth",
      "id": 237213,
      "node_id": "MDQ6VXNlcjIzNzIxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewtoth",
      "html_url": "https://github.com/andrewtoth",
      "followers_url": "https://api.github.com/users/andrewtoth/followers",
      "following_url": "https://api.github.com/users/andrewtoth/following{/other_user}",
      "gists_url": "https://api.github.com/users/andrewtoth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
      "repos_url": "https://api.github.com/users/andrewtoth/repos",
      "events_url": "https://api.github.com/users/andrewtoth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done.",
    "created_at": "2019-01-23T01:34:14Z",
    "updated_at": "2019-07-31T16:38:24Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r250027236",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250027236"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r250027236"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250027236/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2755,
    "side": "RIGHT",
    "in_reply_to_id": 249810717
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250746344",
    "pull_request_review_id": 196210013,
    "id": 250746344,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MDc0NjM0NA==",
    "diff_hunk": "@@ -57,6 +57,8 @@ def run_test(self):\n         self.log.info('Start with empty mempool, and 200 blocks')\n         self.mempool_size = 0\n         wait_until(lambda: node.getblockcount() == 200)\n+        # Generate 1 more block to exit IBD\n+        node.generate(1)",
    "path": "test/functional/mempool_accept.py",
    "position": null,
    "original_position": 5,
    "commit_id": "d2ecb70d6441ae6ff03ccffa64622da56f5c2511",
    "original_commit_id": "478705490369bd5718fca6420a45588fa3090f92",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Seems unrelated to the changes?",
    "created_at": "2019-01-24T19:29:07Z",
    "updated_at": "2019-07-31T16:38:24Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r250746344",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250746344"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r250746344"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250746344/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 61,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250842130",
    "pull_request_review_id": 196330089,
    "id": 250842130,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MDg0MjEzMA==",
    "diff_hunk": "@@ -57,6 +57,8 @@ def run_test(self):\n         self.log.info('Start with empty mempool, and 200 blocks')\n         self.mempool_size = 0\n         wait_until(lambda: node.getblockcount() == 200)\n+        # Generate 1 more block to exit IBD\n+        node.generate(1)",
    "path": "test/functional/mempool_accept.py",
    "position": null,
    "original_position": 5,
    "commit_id": "d2ecb70d6441ae6ff03ccffa64622da56f5c2511",
    "original_commit_id": "478705490369bd5718fca6420a45588fa3090f92",
    "user": {
      "login": "andrewtoth",
      "id": 237213,
      "node_id": "MDQ6VXNlcjIzNzIxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewtoth",
      "html_url": "https://github.com/andrewtoth",
      "followers_url": "https://api.github.com/users/andrewtoth/followers",
      "following_url": "https://api.github.com/users/andrewtoth/following{/other_user}",
      "gists_url": "https://api.github.com/users/andrewtoth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
      "repos_url": "https://api.github.com/users/andrewtoth/repos",
      "events_url": "https://api.github.com/users/andrewtoth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "The test below that checks if a mined transaction can be added to the mempool will fail after this flush is triggered when a block is generated. It rejects the transaction with the `missing-inputs` message rather than the expected `tx-already-known`. By triggering the flush here the test passes.",
    "created_at": "2019-01-25T01:44:54Z",
    "updated_at": "2019-07-31T16:38:24Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r250842130",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250842130"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r250842130"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250842130/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 61,
    "side": "RIGHT",
    "in_reply_to_id": 250746344
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255356011",
    "pull_request_review_id": 201922131,
    "id": 255356011,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM1NjAxMQ==",
    "diff_hunk": "@@ -1781,5 +1784,19 @@ bool AppInitMain(InitInterfaces& interfaces)\n         g_banman->DumpBanlist();\n     }, DUMP_BANS_INTERVAL * 1000);\n \n+    // Once initial sync is finished, flush state to protect against data loss\n+    bool did_initial_flush = false;\n+    int last_chain_height = -1;\n+    scheduler.scheduleEvery([&did_initial_flush, &last_chain_height] {",
    "path": "src/init.cpp",
    "position": null,
    "original_position": 17,
    "commit_id": "d2ecb70d6441ae6ff03ccffa64622da56f5c2511",
    "original_commit_id": "442db9d79d8f4e2177000e8e8b98f647424349f8",
    "user": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Lifetime issue with `did_initial_flush` and `last_chain_height` when `AppInitMain` goes out of scope?",
    "created_at": "2019-02-10T21:12:52Z",
    "updated_at": "2019-07-31T16:38:24Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r255356011",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255356011"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r255356011"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255356011/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1790,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255358401",
    "pull_request_review_id": 201924675,
    "id": 255358401,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM1ODQwMQ==",
    "diff_hunk": "@@ -1781,5 +1784,19 @@ bool AppInitMain(InitInterfaces& interfaces)\n         g_banman->DumpBanlist();\n     }, DUMP_BANS_INTERVAL * 1000);\n \n+    // Once initial sync is finished, flush state to protect against data loss\n+    bool did_initial_flush = false;\n+    int last_chain_height = -1;\n+    scheduler.scheduleEvery([&did_initial_flush, &last_chain_height] {",
    "path": "src/init.cpp",
    "position": null,
    "original_position": 17,
    "commit_id": "d2ecb70d6441ae6ff03ccffa64622da56f5c2511",
    "original_commit_id": "442db9d79d8f4e2177000e8e8b98f647424349f8",
    "user": {
      "login": "andrewtoth",
      "id": 237213,
      "node_id": "MDQ6VXNlcjIzNzIxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewtoth",
      "html_url": "https://github.com/andrewtoth",
      "followers_url": "https://api.github.com/users/andrewtoth/followers",
      "following_url": "https://api.github.com/users/andrewtoth/following{/other_user}",
      "gists_url": "https://api.github.com/users/andrewtoth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
      "repos_url": "https://api.github.com/users/andrewtoth/repos",
      "events_url": "https://api.github.com/users/andrewtoth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Moved them inside the lambda as static variables.",
    "created_at": "2019-02-10T22:06:06Z",
    "updated_at": "2019-07-31T16:38:24Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r255358401",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255358401"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r255358401"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255358401/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1790,
    "side": "RIGHT",
    "in_reply_to_id": 255356011
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/276096258",
    "pull_request_review_id": 227570696,
    "id": 276096258,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NjA5NjI1OA==",
    "diff_hunk": "@@ -1812,5 +1815,24 @@ bool AppInitMain(InitInterfaces& interfaces)\n         g_banman->DumpBanlist();\n     }, DUMP_BANS_INTERVAL * 1000);\n \n+    // Once initial sync is finished, flush state to protect against data loss\n+    scheduler.scheduleEvery([]{\n+        static bool did_initial_flush = false;\n+        if (did_initial_flush || IsInitialBlockDownload()) {\n+            return;\n+        }\n+\n+        static int last_chain_height = -1;\n+        LOCK(cs_main);\n+        int current_height = chainActive.Height();\n+        if (last_chain_height == -1 || last_chain_height != current_height) {\n+            last_chain_height = current_height;\n+            return;\n+        }\n+\n+        did_initial_flush = true;",
    "path": "src/init.cpp",
    "position": null,
    "original_position": 29,
    "commit_id": "d2ecb70d6441ae6ff03ccffa64622da56f5c2511",
    "original_commit_id": "8ecd177c3ad522f7748c6ef943ff726ebbfe1016",
    "user": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Can't we just unschedule the task?",
    "created_at": "2019-04-17T06:33:53Z",
    "updated_at": "2019-07-31T16:38:24Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r276096258",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/276096258"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r276096258"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/276096258/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1833,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/276501009",
    "pull_request_review_id": 228080473,
    "id": 276501009,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NjUwMTAwOQ==",
    "diff_hunk": "@@ -1812,5 +1815,24 @@ bool AppInitMain(InitInterfaces& interfaces)\n         g_banman->DumpBanlist();\n     }, DUMP_BANS_INTERVAL * 1000);\n \n+    // Once initial sync is finished, flush state to protect against data loss\n+    scheduler.scheduleEvery([]{\n+        static bool did_initial_flush = false;\n+        if (did_initial_flush || IsInitialBlockDownload()) {\n+            return;\n+        }\n+\n+        static int last_chain_height = -1;\n+        LOCK(cs_main);\n+        int current_height = chainActive.Height();\n+        if (last_chain_height == -1 || last_chain_height != current_height) {\n+            last_chain_height = current_height;\n+            return;\n+        }\n+\n+        did_initial_flush = true;",
    "path": "src/init.cpp",
    "position": null,
    "original_position": 29,
    "commit_id": "d2ecb70d6441ae6ff03ccffa64622da56f5c2511",
    "original_commit_id": "8ecd177c3ad522f7748c6ef943ff726ebbfe1016",
    "user": {
      "login": "andrewtoth",
      "id": 237213,
      "node_id": "MDQ6VXNlcjIzNzIxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewtoth",
      "html_url": "https://github.com/andrewtoth",
      "followers_url": "https://api.github.com/users/andrewtoth/followers",
      "following_url": "https://api.github.com/users/andrewtoth/following{/other_user}",
      "gists_url": "https://api.github.com/users/andrewtoth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
      "repos_url": "https://api.github.com/users/andrewtoth/repos",
      "events_url": "https://api.github.com/users/andrewtoth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Unless I'm missing something, I don't think it's possible to unschedule without making a lot more changes https://github.com/bitcoin/bitcoin/blob/master/src/scheduler.h#L58 ",
    "created_at": "2019-04-18T02:44:00Z",
    "updated_at": "2019-07-31T16:38:24Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r276501009",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/276501009"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r276501009"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/276501009/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1833,
    "side": "RIGHT",
    "in_reply_to_id": 276096258
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/276886513",
    "pull_request_review_id": 228570862,
    "id": 276886513,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3Njg4NjUxMw==",
    "diff_hunk": "@@ -1812,5 +1815,24 @@ bool AppInitMain(InitInterfaces& interfaces)\n         g_banman->DumpBanlist();\n     }, DUMP_BANS_INTERVAL * 1000);\n \n+    // Once initial sync is finished, flush state to protect against data loss\n+    scheduler.scheduleEvery([]{\n+        static bool did_initial_flush = false;\n+        if (did_initial_flush || IsInitialBlockDownload()) {\n+            return;\n+        }\n+\n+        static int last_chain_height = -1;\n+        LOCK(cs_main);\n+        int current_height = chainActive.Height();\n+        if (last_chain_height == -1 || last_chain_height != current_height) {\n+            last_chain_height = current_height;\n+            return;\n+        }\n+\n+        did_initial_flush = true;",
    "path": "src/init.cpp",
    "position": null,
    "original_position": 29,
    "commit_id": "d2ecb70d6441ae6ff03ccffa64622da56f5c2511",
    "original_commit_id": "8ecd177c3ad522f7748c6ef943ff726ebbfe1016",
    "user": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Use `scheduleFromNow` conditionally?",
    "created_at": "2019-04-19T02:17:25Z",
    "updated_at": "2019-07-31T16:38:24Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r276886513",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/276886513"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r276886513"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/276886513/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1833,
    "side": "RIGHT",
    "in_reply_to_id": 276096258
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277030073",
    "pull_request_review_id": 228748211,
    "id": 277030073,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NzAzMDA3Mw==",
    "diff_hunk": "@@ -1812,5 +1815,24 @@ bool AppInitMain(InitInterfaces& interfaces)\n         g_banman->DumpBanlist();\n     }, DUMP_BANS_INTERVAL * 1000);\n \n+    // Once initial sync is finished, flush state to protect against data loss\n+    scheduler.scheduleEvery([]{\n+        static bool did_initial_flush = false;\n+        if (did_initial_flush || IsInitialBlockDownload()) {\n+            return;\n+        }\n+\n+        static int last_chain_height = -1;\n+        LOCK(cs_main);\n+        int current_height = chainActive.Height();\n+        if (last_chain_height == -1 || last_chain_height != current_height) {\n+            last_chain_height = current_height;\n+            return;\n+        }\n+\n+        did_initial_flush = true;",
    "path": "src/init.cpp",
    "position": null,
    "original_position": 29,
    "commit_id": "d2ecb70d6441ae6ff03ccffa64622da56f5c2511",
    "original_commit_id": "8ecd177c3ad522f7748c6ef943ff726ebbfe1016",
    "user": {
      "login": "andrewtoth",
      "id": 237213,
      "node_id": "MDQ6VXNlcjIzNzIxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewtoth",
      "html_url": "https://github.com/andrewtoth",
      "followers_url": "https://api.github.com/users/andrewtoth/followers",
      "following_url": "https://api.github.com/users/andrewtoth/following{/other_user}",
      "gists_url": "https://api.github.com/users/andrewtoth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
      "repos_url": "https://api.github.com/users/andrewtoth/repos",
      "events_url": "https://api.github.com/users/andrewtoth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Updated. How is that?",
    "created_at": "2019-04-19T16:31:17Z",
    "updated_at": "2019-07-31T16:38:24Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r277030073",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277030073"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r277030073"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277030073/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1833,
    "side": "RIGHT",
    "in_reply_to_id": 276096258
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277037222",
    "pull_request_review_id": 228757294,
    "id": 277037222,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NzAzNzIyMg==",
    "diff_hunk": "@@ -1250,6 +1253,26 @@ bool AppInitLockDataDirectory()\n     return true;\n }\n \n+static void FlushAfterSync() ",
    "path": "src/init.cpp",
    "position": null,
    "original_position": 14,
    "commit_id": "d2ecb70d6441ae6ff03ccffa64622da56f5c2511",
    "original_commit_id": "4ff12b7e98dc17c7ce12d34cf97c7182b5a39c16",
    "user": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Nit: extra space on the end",
    "created_at": "2019-04-19T17:01:54Z",
    "updated_at": "2019-07-31T16:38:24Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r277037222",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277037222"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r277037222"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277037222/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1256,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277037329",
    "pull_request_review_id": 228757294,
    "id": 277037329,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NzAzNzMyOQ==",
    "diff_hunk": "@@ -1250,6 +1253,26 @@ bool AppInitLockDataDirectory()\n     return true;\n }\n \n+static void FlushAfterSync() \n+{\n+    // Once initial sync is finished, flush state to protect against data loss\n+    if (IsInitialBlockDownload()) {\n+        scheduler.scheduleFromNow(*FlushAfterSync, SYNC_CHECK_INTERVAL * 1000);",
    "path": "src/init.cpp",
    "position": null,
    "original_position": 18,
    "commit_id": "d2ecb70d6441ae6ff03ccffa64622da56f5c2511",
    "original_commit_id": "4ff12b7e98dc17c7ce12d34cf97c7182b5a39c16",
    "user": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I don't understand the purpose of `*` before `FlushAfterSync`.",
    "created_at": "2019-04-19T17:02:15Z",
    "updated_at": "2019-07-31T16:38:24Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r277037329",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277037329"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r277037329"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277037329/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1260,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277041892",
    "pull_request_review_id": 228763649,
    "id": 277041892,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NzA0MTg5Mg==",
    "diff_hunk": "@@ -1250,6 +1253,26 @@ bool AppInitLockDataDirectory()\n     return true;\n }\n \n+static void FlushAfterSync() ",
    "path": "src/init.cpp",
    "position": null,
    "original_position": 14,
    "commit_id": "d2ecb70d6441ae6ff03ccffa64622da56f5c2511",
    "original_commit_id": "4ff12b7e98dc17c7ce12d34cf97c7182b5a39c16",
    "user": {
      "login": "andrewtoth",
      "id": 237213,
      "node_id": "MDQ6VXNlcjIzNzIxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewtoth",
      "html_url": "https://github.com/andrewtoth",
      "followers_url": "https://api.github.com/users/andrewtoth/followers",
      "following_url": "https://api.github.com/users/andrewtoth/following{/other_user}",
      "gists_url": "https://api.github.com/users/andrewtoth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
      "repos_url": "https://api.github.com/users/andrewtoth/repos",
      "events_url": "https://api.github.com/users/andrewtoth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Removed.",
    "created_at": "2019-04-19T17:23:22Z",
    "updated_at": "2019-07-31T16:38:24Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r277041892",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277041892"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r277041892"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277041892/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1256,
    "side": "RIGHT",
    "in_reply_to_id": 277037222
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277041932",
    "pull_request_review_id": 228763719,
    "id": 277041932,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NzA0MTkzMg==",
    "diff_hunk": "@@ -1250,6 +1253,26 @@ bool AppInitLockDataDirectory()\n     return true;\n }\n \n+static void FlushAfterSync() \n+{\n+    // Once initial sync is finished, flush state to protect against data loss\n+    if (IsInitialBlockDownload()) {\n+        scheduler.scheduleFromNow(*FlushAfterSync, SYNC_CHECK_INTERVAL * 1000);",
    "path": "src/init.cpp",
    "position": null,
    "original_position": 18,
    "commit_id": "d2ecb70d6441ae6ff03ccffa64622da56f5c2511",
    "original_commit_id": "4ff12b7e98dc17c7ce12d34cf97c7182b5a39c16",
    "user": {
      "login": "andrewtoth",
      "id": 237213,
      "node_id": "MDQ6VXNlcjIzNzIxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewtoth",
      "html_url": "https://github.com/andrewtoth",
      "followers_url": "https://api.github.com/users/andrewtoth/followers",
      "following_url": "https://api.github.com/users/andrewtoth/following{/other_user}",
      "gists_url": "https://api.github.com/users/andrewtoth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
      "repos_url": "https://api.github.com/users/andrewtoth/repos",
      "events_url": "https://api.github.com/users/andrewtoth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Removed them.",
    "created_at": "2019-04-19T17:23:35Z",
    "updated_at": "2019-07-31T16:38:24Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r277041932",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277041932"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r277041932"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277041932/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1260,
    "side": "RIGHT",
    "in_reply_to_id": 277037329
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277092602",
    "pull_request_review_id": 228827943,
    "id": 277092602,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NzA5MjYwMg==",
    "diff_hunk": "@@ -1250,6 +1253,26 @@ bool AppInitLockDataDirectory()\n     return true;\n }\n \n+static void FlushAfterSync()\n+{\n+    // Once initial sync is finished, flush state to protect against data loss",
    "path": "src/init.cpp",
    "position": null,
    "original_position": 16,
    "commit_id": "d2ecb70d6441ae6ff03ccffa64622da56f5c2511",
    "original_commit_id": "6471856400f24822d6f0836937b0a6660499418e",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "doc-nit: This comment should be moved down after the `if` or as docstring on top of the method, imo. The condition in the if below is \"initial sync is *not* finished\".",
    "created_at": "2019-04-19T21:10:15Z",
    "updated_at": "2019-07-31T16:38:24Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r277092602",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277092602"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r277092602"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277092602/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1258,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277137392",
    "pull_request_review_id": 228880931,
    "id": 277137392,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NzEzNzM5Mg==",
    "diff_hunk": "@@ -1250,6 +1253,26 @@ bool AppInitLockDataDirectory()\n     return true;\n }\n \n+static void FlushAfterSync()\n+{\n+    // Once initial sync is finished, flush state to protect against data loss",
    "path": "src/init.cpp",
    "position": null,
    "original_position": 16,
    "commit_id": "d2ecb70d6441ae6ff03ccffa64622da56f5c2511",
    "original_commit_id": "6471856400f24822d6f0836937b0a6660499418e",
    "user": {
      "login": "andrewtoth",
      "id": 237213,
      "node_id": "MDQ6VXNlcjIzNzIxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewtoth",
      "html_url": "https://github.com/andrewtoth",
      "followers_url": "https://api.github.com/users/andrewtoth/followers",
      "following_url": "https://api.github.com/users/andrewtoth/following{/other_user}",
      "gists_url": "https://api.github.com/users/andrewtoth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
      "repos_url": "https://api.github.com/users/andrewtoth/repos",
      "events_url": "https://api.github.com/users/andrewtoth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Updated comments to align with coding style.",
    "created_at": "2019-04-20T15:04:52Z",
    "updated_at": "2019-07-31T16:38:24Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r277137392",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277137392"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r277137392"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277137392/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1258,
    "side": "RIGHT",
    "in_reply_to_id": 277092602
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277636926",
    "pull_request_review_id": 229500246,
    "id": 277636926,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NzYzNjkyNg==",
    "diff_hunk": "@@ -803,6 +803,11 @@ bool GetNodeStateStats(NodeId nodeid, CNodeStateStats &stats) {\n     return true;\n }\n \n+int GetNumberOfPeersWithValidatedDownloads() EXCLUSIVE_LOCKS_REQUIRED(cs_main)",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "d2ecb70d6441ae6ff03ccffa64622da56f5c2511",
    "original_commit_id": "6f76c4f97bf71ccd76a665184212d3d0628ddde2",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Annotations in definitions are ignored, they need to be in the declaration\r\n\r\n```suggestion\r\nint GetNumberOfPeersWithValidatedDownloads()\r\n```",
    "created_at": "2019-04-23T11:47:15Z",
    "updated_at": "2019-07-31T16:38:24Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r277636926",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277636926"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r277636926"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277636926/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 806,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277695089",
    "pull_request_review_id": 229573249,
    "id": 277695089,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NzY5NTA4OQ==",
    "diff_hunk": "@@ -803,6 +803,11 @@ bool GetNodeStateStats(NodeId nodeid, CNodeStateStats &stats) {\n     return true;\n }\n \n+int GetNumberOfPeersWithValidatedDownloads() EXCLUSIVE_LOCKS_REQUIRED(cs_main)",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "d2ecb70d6441ae6ff03ccffa64622da56f5c2511",
    "original_commit_id": "6f76c4f97bf71ccd76a665184212d3d0628ddde2",
    "user": {
      "login": "andrewtoth",
      "id": 237213,
      "node_id": "MDQ6VXNlcjIzNzIxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewtoth",
      "html_url": "https://github.com/andrewtoth",
      "followers_url": "https://api.github.com/users/andrewtoth/followers",
      "following_url": "https://api.github.com/users/andrewtoth/following{/other_user}",
      "gists_url": "https://api.github.com/users/andrewtoth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
      "repos_url": "https://api.github.com/users/andrewtoth/repos",
      "events_url": "https://api.github.com/users/andrewtoth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Fixed.",
    "created_at": "2019-04-23T14:05:15Z",
    "updated_at": "2019-07-31T16:38:24Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r277695089",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277695089"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15218#discussion_r277695089"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277695089/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 806,
    "side": "RIGHT",
    "in_reply_to_id": 277636926
  }
]