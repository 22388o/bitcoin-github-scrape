{
  "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22856",
  "id": 724727507,
  "node_id": "MDExOlB1bGxSZXF1ZXN0NzI0NzI3NTA3",
  "html_url": "https://github.com/bitcoin/bitcoin/pull/22856",
  "diff_url": "https://github.com/bitcoin/bitcoin/pull/22856.diff",
  "patch_url": "https://github.com/bitcoin/bitcoin/pull/22856.patch",
  "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22856",
  "number": 22856,
  "state": "open",
  "locked": false,
  "title": "test: Fix bug in transaction generation in ComplexMempool benchmark",
  "user": {
    "login": "shoryak",
    "id": 60062252,
    "node_id": "MDQ6VXNlcjYwMDYyMjUy",
    "avatar_url": "https://avatars.githubusercontent.com/u/60062252?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/shoryak",
    "html_url": "https://github.com/shoryak",
    "followers_url": "https://api.github.com/users/shoryak/followers",
    "following_url": "https://api.github.com/users/shoryak/following{/other_user}",
    "gists_url": "https://api.github.com/users/shoryak/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/shoryak/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/shoryak/subscriptions",
    "organizations_url": "https://api.github.com/users/shoryak/orgs",
    "repos_url": "https://api.github.com/users/shoryak/repos",
    "events_url": "https://api.github.com/users/shoryak/events{/privacy}",
    "received_events_url": "https://api.github.com/users/shoryak/received_events",
    "type": "User",
    "site_admin": false
  },
  "body": "This fixes issues with `ComplexMempool` benchmark introduced in [#17292](https://github.com/bitcoin/bitcoin/pull/17292) , this stress test benchmarks performance of ancestor and descendant tracking of mempool graph algorithms on a complex Mempool. \r\n\r\nThis Benchmark first creates 100 base transactions and stores them in `available_coins` vector. `available_coins` is used for selecting ancestor transactions while creating 800 new transactions. For this a random transaction is picked from `available_coins` and some of its outputs are mapped to the inputs of the new transaction being created. \r\n\r\nNow in case we exhaust all the outputs of an entry in `available_coins` then we need to remove it from `available_coins` before the next iteration of choosing a potential ancestor , it is now implemented with this patch.\r\n\r\n As the index of the entry is randomly chosen from `available_coins` , In order to remove it from the vector , if index of the selected entry is not at the end of `available_coins` vector , it is swapped with the entry at the back of the vector , then the entry at the end of `available_coins` is popped out.\r\n\r\nEarlier the code responsible for constructing outputs of the newly created transaction was inside the loop used for assigning ancestors to the transaction , which does some unnecessary work as it creates outputs of the transaction again and again , now it is moved out of the loop so outputs of the transaction are created just once before adding it to the final list of the transactions created. This one is a minor change to save some computation.\r\n\r\n These changes have changed the `ComplexMempool` benchmark results on `bitcoin:master` as follows : \r\n\r\n**Before** \r\n\r\n>  \r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|      232,881,625.00 |                4.29 |    0.7% |      2.55 | `ComplexMemPool`\r\n\r\n**After**\r\n\r\n>  \r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|      497,275,135.00 |                2.01 |    0.5% |      5.49 | `ComplexMemPool`\r\n\r\n\r\n\r\n<!--\r\n*** Please remove the following help text before submitting: ***\r\n\r\nPull requests without a rationale and clear improvement may be closed\r\nimmediately.\r\n\r\nGUI-related pull requests should be opened against\r\nhttps://github.com/bitcoin-core/gui\r\nfirst. See CONTRIBUTING.md\r\n-->\r\n\r\n<!--\r\nPlease provide clear motivation for your patch and explain how it improves\r\nBitcoin Core user experience or Bitcoin Core developer experience\r\nsignificantly:\r\n\r\n* Any test improvements or new tests that improve coverage are always welcome.\r\n* All other changes should have accompanying unit tests (see `src/test/`) or\r\n  functional tests (see `test/`). Contributors should note which tests cover\r\n  modified code. If no tests exist for a region of modified code, new tests\r\n  should accompany the change.\r\n* Bug fixes are most welcome when they come with steps to reproduce or an\r\n  explanation of the potential issue as well as reasoning for the way the bug\r\n  was fixed.\r\n* Features are welcome, but might be rejected due to design or scope issues.\r\n  If a feature is based on a lot of dependencies, contributors should first\r\n  consider building the system outside of Bitcoin Core, if possible.\r\n* Refactoring changes are only accepted if they are required for a feature or\r\n  bug fix or otherwise improve developer experience significantly. For example,\r\n  most \"code style\" refactoring changes require a thorough explanation why they\r\n  are useful, what downsides they have and why they *significantly* improve\r\n  developer experience or avoid serious programming bugs. Note that code style\r\n  is often a subjective matter. Unless they are explicitly mentioned to be\r\n  preferred in the [developer notes](/doc/developer-notes.md), stylistic code\r\n  changes are usually rejected.\r\n-->\r\n\r\n<!--\r\nBitcoin Core has a thorough review process and even the most trivial change\r\nneeds to pass a lot of eyes and requires non-zero or even substantial time\r\neffort to review. There is a huge lack of active reviewers on the project, so\r\npatches often sit for a long time.\r\n-->\r\n",
  "created_at": "2021-09-01T17:53:34Z",
  "updated_at": "2021-11-26T19:09:16Z",
  "closed_at": null,
  "merged_at": null,
  "merge_commit_sha": "01d8c493ade1d8de81f967696c3755c4abb93ccb",
  "assignee": null,
  "assignees": [],
  "requested_reviewers": [],
  "requested_teams": [],
  "labels": [
    {
      "id": 62963516,
      "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
      "name": "Tests",
      "color": "d4c5f9",
      "default": false,
      "description": null
    }
  ],
  "milestone": null,
  "draft": false,
  "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22856/commits",
  "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22856/comments",
  "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments{/number}",
  "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22856/comments",
  "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/29e983386b0aecf99cdb7d0e08ba6b450bed313e",
  "head": {
    "label": "shoryak:complexmempool",
    "ref": "complexmempool",
    "sha": "29e983386b0aecf99cdb7d0e08ba6b450bed313e",
    "user": {
      "login": "shoryak",
      "id": 60062252,
      "node_id": "MDQ6VXNlcjYwMDYyMjUy",
      "avatar_url": "https://avatars.githubusercontent.com/u/60062252?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shoryak",
      "html_url": "https://github.com/shoryak",
      "followers_url": "https://api.github.com/users/shoryak/followers",
      "following_url": "https://api.github.com/users/shoryak/following{/other_user}",
      "gists_url": "https://api.github.com/users/shoryak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shoryak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shoryak/subscriptions",
      "organizations_url": "https://api.github.com/users/shoryak/orgs",
      "repos_url": "https://api.github.com/users/shoryak/repos",
      "events_url": "https://api.github.com/users/shoryak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shoryak/received_events",
      "type": "User",
      "site_admin": false
    },
    "repo": {
      "id": 390492335,
      "node_id": "MDEwOlJlcG9zaXRvcnkzOTA0OTIzMzU=",
      "name": "bitcoin",
      "full_name": "shoryak/bitcoin",
      "private": false,
      "owner": {
        "login": "shoryak",
        "id": 60062252,
        "node_id": "MDQ6VXNlcjYwMDYyMjUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/60062252?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/shoryak",
        "html_url": "https://github.com/shoryak",
        "followers_url": "https://api.github.com/users/shoryak/followers",
        "following_url": "https://api.github.com/users/shoryak/following{/other_user}",
        "gists_url": "https://api.github.com/users/shoryak/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/shoryak/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/shoryak/subscriptions",
        "organizations_url": "https://api.github.com/users/shoryak/orgs",
        "repos_url": "https://api.github.com/users/shoryak/repos",
        "events_url": "https://api.github.com/users/shoryak/events{/privacy}",
        "received_events_url": "https://api.github.com/users/shoryak/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/shoryak/bitcoin",
      "description": "Bitcoin Core integration/staging tree",
      "fork": true,
      "url": "https://api.github.com/repos/shoryak/bitcoin",
      "forks_url": "https://api.github.com/repos/shoryak/bitcoin/forks",
      "keys_url": "https://api.github.com/repos/shoryak/bitcoin/keys{/key_id}",
      "collaborators_url": "https://api.github.com/repos/shoryak/bitcoin/collaborators{/collaborator}",
      "teams_url": "https://api.github.com/repos/shoryak/bitcoin/teams",
      "hooks_url": "https://api.github.com/repos/shoryak/bitcoin/hooks",
      "issue_events_url": "https://api.github.com/repos/shoryak/bitcoin/issues/events{/number}",
      "events_url": "https://api.github.com/repos/shoryak/bitcoin/events",
      "assignees_url": "https://api.github.com/repos/shoryak/bitcoin/assignees{/user}",
      "branches_url": "https://api.github.com/repos/shoryak/bitcoin/branches{/branch}",
      "tags_url": "https://api.github.com/repos/shoryak/bitcoin/tags",
      "blobs_url": "https://api.github.com/repos/shoryak/bitcoin/git/blobs{/sha}",
      "git_tags_url": "https://api.github.com/repos/shoryak/bitcoin/git/tags{/sha}",
      "git_refs_url": "https://api.github.com/repos/shoryak/bitcoin/git/refs{/sha}",
      "trees_url": "https://api.github.com/repos/shoryak/bitcoin/git/trees{/sha}",
      "statuses_url": "https://api.github.com/repos/shoryak/bitcoin/statuses/{sha}",
      "languages_url": "https://api.github.com/repos/shoryak/bitcoin/languages",
      "stargazers_url": "https://api.github.com/repos/shoryak/bitcoin/stargazers",
      "contributors_url": "https://api.github.com/repos/shoryak/bitcoin/contributors",
      "subscribers_url": "https://api.github.com/repos/shoryak/bitcoin/subscribers",
      "subscription_url": "https://api.github.com/repos/shoryak/bitcoin/subscription",
      "commits_url": "https://api.github.com/repos/shoryak/bitcoin/commits{/sha}",
      "git_commits_url": "https://api.github.com/repos/shoryak/bitcoin/git/commits{/sha}",
      "comments_url": "https://api.github.com/repos/shoryak/bitcoin/comments{/number}",
      "issue_comment_url": "https://api.github.com/repos/shoryak/bitcoin/issues/comments{/number}",
      "contents_url": "https://api.github.com/repos/shoryak/bitcoin/contents/{+path}",
      "compare_url": "https://api.github.com/repos/shoryak/bitcoin/compare/{base}...{head}",
      "merges_url": "https://api.github.com/repos/shoryak/bitcoin/merges",
      "archive_url": "https://api.github.com/repos/shoryak/bitcoin/{archive_format}{/ref}",
      "downloads_url": "https://api.github.com/repos/shoryak/bitcoin/downloads",
      "issues_url": "https://api.github.com/repos/shoryak/bitcoin/issues{/number}",
      "pulls_url": "https://api.github.com/repos/shoryak/bitcoin/pulls{/number}",
      "milestones_url": "https://api.github.com/repos/shoryak/bitcoin/milestones{/number}",
      "notifications_url": "https://api.github.com/repos/shoryak/bitcoin/notifications{?since,all,participating}",
      "labels_url": "https://api.github.com/repos/shoryak/bitcoin/labels{/name}",
      "releases_url": "https://api.github.com/repos/shoryak/bitcoin/releases{/id}",
      "deployments_url": "https://api.github.com/repos/shoryak/bitcoin/deployments",
      "created_at": "2021-07-28T20:16:33Z",
      "updated_at": "2021-08-29T12:53:26Z",
      "pushed_at": "2021-09-28T16:49:07Z",
      "git_url": "git://github.com/shoryak/bitcoin.git",
      "ssh_url": "git@github.com:shoryak/bitcoin.git",
      "clone_url": "https://github.com/shoryak/bitcoin.git",
      "svn_url": "https://github.com/shoryak/bitcoin",
      "homepage": "https://bitcoincore.org/en/download",
      "size": 178042,
      "stargazers_count": 0,
      "watchers_count": 0,
      "language": "C++",
      "has_issues": false,
      "has_projects": true,
      "has_downloads": false,
      "has_wiki": false,
      "has_pages": false,
      "forks_count": 0,
      "mirror_url": null,
      "archived": false,
      "disabled": false,
      "open_issues_count": 0,
      "license": {
        "key": "mit",
        "name": "MIT License",
        "spdx_id": "MIT",
        "url": "https://api.github.com/licenses/mit",
        "node_id": "MDc6TGljZW5zZTEz"
      },
      "allow_forking": true,
      "is_template": false,
      "topics": [],
      "visibility": "public",
      "forks": 0,
      "open_issues": 0,
      "watchers": 0,
      "default_branch": "master"
    }
  },
  "base": {
    "label": "bitcoin:master",
    "ref": "master",
    "sha": "f4e12fd50c23875f4b5f272c94449eb81de43d5d",
    "user": {
      "login": "bitcoin",
      "id": 528860,
      "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bitcoin",
      "html_url": "https://github.com/bitcoin",
      "followers_url": "https://api.github.com/users/bitcoin/followers",
      "following_url": "https://api.github.com/users/bitcoin/following{/other_user}",
      "gists_url": "https://api.github.com/users/bitcoin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bitcoin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
      "organizations_url": "https://api.github.com/users/bitcoin/orgs",
      "repos_url": "https://api.github.com/users/bitcoin/repos",
      "events_url": "https://api.github.com/users/bitcoin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bitcoin/received_events",
      "type": "Organization",
      "site_admin": false
    },
    "repo": {
      "id": 1181927,
      "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
      "name": "bitcoin",
      "full_name": "bitcoin/bitcoin",
      "private": false,
      "owner": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following{/other_user}",
        "gists_url": "https://api.github.com/users/bitcoin/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/bitcoin/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events{/privacy}",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin",
      "description": "Bitcoin Core integration/staging tree",
      "fork": false,
      "url": "https://api.github.com/repos/bitcoin/bitcoin",
      "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
      "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys{/key_id}",
      "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators{/collaborator}",
      "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
      "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
      "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events{/number}",
      "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
      "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees{/user}",
      "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches{/branch}",
      "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
      "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs{/sha}",
      "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags{/sha}",
      "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs{/sha}",
      "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees{/sha}",
      "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/{sha}",
      "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
      "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
      "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
      "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
      "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
      "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits{/sha}",
      "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits{/sha}",
      "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments{/number}",
      "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments{/number}",
      "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/{+path}",
      "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/{base}...{head}",
      "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
      "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/{archive_format}{/ref}",
      "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
      "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues{/number}",
      "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls{/number}",
      "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones{/number}",
      "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications{?since,all,participating}",
      "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels{/name}",
      "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases{/id}",
      "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
      "created_at": "2010-12-19T15:16:43Z",
      "updated_at": "2021-12-01T02:05:19Z",
      "pushed_at": "2021-11-30T22:01:38Z",
      "git_url": "git://github.com/bitcoin/bitcoin.git",
      "ssh_url": "git@github.com:bitcoin/bitcoin.git",
      "clone_url": "https://github.com/bitcoin/bitcoin.git",
      "svn_url": "https://github.com/bitcoin/bitcoin",
      "homepage": "https://bitcoincore.org/en/download",
      "size": 187628,
      "stargazers_count": 59696,
      "watchers_count": 59696,
      "language": "C++",
      "has_issues": true,
      "has_projects": true,
      "has_downloads": false,
      "has_wiki": false,
      "has_pages": false,
      "forks_count": 30697,
      "mirror_url": null,
      "archived": false,
      "disabled": false,
      "open_issues_count": 1024,
      "license": {
        "key": "mit",
        "name": "MIT License",
        "spdx_id": "MIT",
        "url": "https://api.github.com/licenses/mit",
        "node_id": "MDc6TGljZW5zZTEz"
      },
      "allow_forking": true,
      "is_template": false,
      "topics": [
        "bitcoin",
        "c-plus-plus",
        "cryptocurrency",
        "cryptography",
        "p2p"
      ],
      "visibility": "public",
      "forks": 30697,
      "open_issues": 1024,
      "watchers": 59696,
      "default_branch": "master"
    }
  },
  "_links": {
    "self": {
      "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22856"
    },
    "html": {
      "href": "https://github.com/bitcoin/bitcoin/pull/22856"
    },
    "issue": {
      "href": "https://api.github.com/repos/bitcoin/bitcoin/issues/22856"
    },
    "comments": {
      "href": "https://api.github.com/repos/bitcoin/bitcoin/issues/22856/comments"
    },
    "review_comments": {
      "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22856/comments"
    },
    "review_comment": {
      "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments{/number}"
    },
    "commits": {
      "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22856/commits"
    },
    "statuses": {
      "href": "https://api.github.com/repos/bitcoin/bitcoin/statuses/29e983386b0aecf99cdb7d0e08ba6b450bed313e"
    }
  },
  "author_association": "FIRST_TIME_CONTRIBUTOR",
  "auto_merge": null,
  "active_lock_reason": null,
  "merged": false,
  "mergeable": true,
  "rebaseable": true,
  "mergeable_state": "blocked",
  "merged_by": null,
  "comments": 4,
  "review_comments": 3,
  "maintainer_can_modify": true,
  "commits": 1,
  "additions": 10,
  "deletions": 8,
  "changed_files": 1
}