DrahtBot,2020-02-11 05:48:45,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #18410 (Docs: Improve commenting for coins.cpp|h by jnewbery)\n* #16910 (wallet: reduce loading time by using unordered ma",https://github.com/bitcoin/bitcoin/pull/18113#issuecomment-584486715,584486715,
jnewbery,2020-02-11 16:38:12,Fixed a whitespace oops that our linters didn't like.,https://github.com/bitcoin/bitcoin/pull/18113#issuecomment-584726951,584726951,
jonatack,2020-02-19 19:31:11,"Concept ACK, will review (this was discussed in part in the meeting log of https://bitcoincore.reviews/17487.html)",https://github.com/bitcoin/bitcoin/pull/18113#issuecomment-588405436,588405436,
prayank23,2020-03-18 16:19:51,"Reading about it in details now. Not sure if I can suggest anything in next few hours because this looks more complex than I thought.\n\nWill join the Bitcoin Core PR Review Club Meeting on IRC today to understand more and research later in the week : https://bitcoincore.reviews/18113.html",https://github.com/bitcoin/bitcoin/pull/18113#issuecomment-600726713,600726713,
meshcollider,2020-03-18 19:24:58,"Code review ACK 9288d747e849b126930ef9e2f623ce6746555ed4\n\nAgree the terminology between FRESH and DIRTY is a bit confusing as people brought up in the PR review meeting this morning.",https://github.com/bitcoin/bitcoin/pull/18113#issuecomment-600816372,600816372,
fjahr,2020-03-18 20:54:20,Code review ACK 9288d747e849b126930ef9e2f623ce6746555ed4,https://github.com/bitcoin/bitcoin/pull/18113#issuecomment-600853279,600853279,
jkczyz,2020-03-18 22:36:57,"> Agree the terminology between FRESH and DIRTY is a bit confusing as people brought up in the PR review meeting this morning.\n\nGiven that there are four _valid_ states but eight possible combinations (see @amitiuttarwar's [summarization](https://bitcoincore.reviews/18113.html#appendix)), one option is to refactor the code to use an enum with four variants named appropriately. This removes the",https://github.com/bitcoin/bitcoin/pull/18113#issuecomment-600893617,600893617,
fjahr,2020-03-19 00:12:00,"> Given that there are four _valid_ states but eight possible combinations (see @amitiuttarwar's [summarization](https://bitcoincore.reviews/18113.html#appendix)), one option is to refactor the code to use an enum with four variants named appropriately. This removes the possibility of getting into an invalid states. However, I'm not sure how practical this refactor would be or how difficult it wou",https://github.com/bitcoin/bitcoin/pull/18113#issuecomment-600919222,600919222,
andrewtoth,2020-03-19 04:39:04,"Concept ACK\n\nReiterating my comments from the PR review club, I think this PR might benefit from being split up. It's attempting two separate things, one of which is a consensus change. I think review on that important change might be more focused if this was split into a name and comment update, and then just the logic change.",https://github.com/bitcoin/bitcoin/pull/18113#issuecomment-600984698,600984698,
jnewbery,2020-03-23 15:36:55,"I've moved all the comment changes to ~#18113~ #18410, which this PR now builds off. Please review #18113 first.",https://github.com/bitcoin/bitcoin/pull/18113#issuecomment-602679600,602679600,
DrahtBot,2020-04-22 14:13:13,<!--cf906140f33d8803c4a75a2196329ecb-->\n🐙 This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).,https://github.com/bitcoin/bitcoin/pull/18113#issuecomment-617804561,617804561,
jnewbery,2020-04-22 22:30:16,"This PR originally included changes to comments and the change to not fetch spend coins from the cache. The comments changes have been merged in ~#18113~ #18410. Most of the review comments here are about those comments changes, so I'm closing this and using #18746 to PR the code changes.",https://github.com/bitcoin/bitcoin/pull/18113#issuecomment-618073723,618073723,
MarcoFalke,2020-05-24 14:57:00,I think there is a typo in the last two comments `18113` should be `18410`. #18410 ,https://github.com/bitcoin/bitcoin/pull/18113#issuecomment-633243350,633243350,
jnewbery,2020-05-27 21:14:57,Thanks Marco. I fixed those comments.,https://github.com/bitcoin/bitcoin/pull/18113#issuecomment-634944313,634944313,
amitiuttarwar,2020-03-18 05:03:26,"grammar issue- ""which is does exist"" \nmaybe- ""which actually does exist"" \n\nalso, I find this sentence a bit confusing, mostly because of the phrasing of ""will"" vs ""might"". If a coin exists in the parent view & gets incorrectly marked as FRESH, is there a way it could still be deleted from the parent when the cache is flushed? ",https://github.com/bitcoin/bitcoin/pull/18113#discussion_r394108204,394108204,src/coins.h
jkczyz,2020-03-18 05:21:26,"> grammar issue- ""which is does exist""\n> maybe- ""which actually does exist""\n\nOr simply ""exists""?",https://github.com/bitcoin/bitcoin/pull/18113#discussion_r394112049,394112049,src/coins.h
pinheadmz,2020-03-18 15:16:25,"Block 1,983,702 -- about 26 years from now? Is that a timestamp rolling over or something?\nI thought BIP34 (block height in coinbase) will prevent this from ever happening since it was enforced:\n\n> Block number 227,835 (timestamp 2013-03-24 15:49:13 GMT) was the last version 1 block.",https://github.com/bitcoin/bitcoin/pull/18113#discussion_r394425148,394425148,src/coins.cpp
fjahr,2020-03-18 15:18:52,"I think you could clean up and clarify this parameter here as well. First of all, it is sometimes called `possible_overwrite` and sometimes `potential_overwrite` in the code base, making it harder to grep etc. And I think part of the comment below could be moved here or there could be an additional comment here to explain what this does. I still found it confusing at first after reading comments i",https://github.com/bitcoin/bitcoin/pull/18113#discussion_r394427130,394427130,src/coins.cpp
fjahr,2020-03-18 15:25:27,"Or, I should rather say, the combination of the comments confused me more. From `validation.cpp` where `AddCoin` is called: ""The potential_overwrite parameter to AddCoin is only allowed to be false if we know for sure that the coin did not already exist in the cache."" When it is false we end up in this code branch and your comment starts with ""If the coin exists in this cache...""",https://github.com/bitcoin/bitcoin/pull/18113#discussion_r394432175,394432175,src/coins.cpp
pinheadmz,2020-03-18 15:27:47,"What is an ""empty"" coin?",https://github.com/bitcoin/bitcoin/pull/18113#discussion_r394433944,394433944,src/coins.h
fjahr,2020-03-18 16:15:34,I think this references `emptyCoin` (`coins.h:132`) which calls an empty constructor of `Coin` (`coins.h:53`).,https://github.com/bitcoin/bitcoin/pull/18113#discussion_r394470756,394470756,src/coins.h
fjahr,2020-03-18 16:20:58,nit: empty line could be removed,https://github.com/bitcoin/bitcoin/pull/18113#discussion_r394474557,394474557,src/coins.cpp
jkczyz,2020-03-18 16:52:49,"> I think this references `emptyCoin` (`coins.h:132`) which calls an empty contractor of `Coin` (`coins.h:53`).\n\nI think this is suppose to say `coinEmpty` (`coins.cpp:132`).",https://github.com/bitcoin/bitcoin/pull/18113#discussion_r394496432,394496432,src/coins.h
fjahr,2020-03-18 20:52:29,Take a look at the comments here: https://github.com/bitcoin/bitcoin/blob/a421e0a22f1230abd69b4661a019bed39b72205f/src/validation.cpp#L1989,https://github.com/bitcoin/bitcoin/pull/18113#discussion_r394632466,394632466,src/coins.cpp
pinheadmz,2020-03-18 22:02:37,Oh THAT large comment in `connectBlock()` thanks ;-),https://github.com/bitcoin/bitcoin/pull/18113#discussion_r394665143,394665143,src/coins.cpp
jnewbery,2020-03-23 13:38:23,"You're right that this is unclear. Empty here means that the coin has been spent (see Coin.Clear() above which nulls out a coin when it is spent). I've changed this to ""Note that a spent coin MUST be DIRTY"", which I think is much clearer.",https://github.com/bitcoin/bitcoin/pull/18113#discussion_r396456125,396456125,src/coins.h
jnewbery,2020-03-23 13:39:13,fixed,https://github.com/bitcoin/bitcoin/pull/18113#discussion_r396456646,396456646,src/coins.h
