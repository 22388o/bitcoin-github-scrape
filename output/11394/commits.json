[
  {
    "sha": "e1d0cc23a9f09007c716d27874e3296cb81149da",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzplMWQwY2MyM2E5ZjA5MDA3YzcxNmQyNzg3NGUzMjk2Y2I4MTE0OWRh",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2017-09-25T01:28:51Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2017-10-11T18:40:57Z"
      },
      "message": "Improve git-subtree-check.sh\n\nWe have several pieces of information about subtrees:\n1) What their current directory contents is\n2) What their directory contents was at the time of the last subtree merge\n3) What the directory contents of the upstream project is in the commit referred to by the subtree merge.\n\nNormally, all 3 should be identical. git-subtree-check.sh so far only compared (1) with (3) however.\n\nFix this by comparing all three, and give some more useful diff output in the case of mismatch.\n\nThe added benefit is that (1) and (2) can be compared without needing to see the upstream repository.",
      "tree": {
        "sha": "82d8ed1250a4955df6de4db7d003bf6857deb59c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/82d8ed1250a4955df6de4db7d003bf6857deb59c"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e1d0cc23a9f09007c716d27874e3296cb81149da",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e1d0cc23a9f09007c716d27874e3296cb81149da",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/e1d0cc23a9f09007c716d27874e3296cb81149da",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e1d0cc23a9f09007c716d27874e3296cb81149da/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "892809309c1bc370677241a715e57a2744f94323",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/892809309c1bc370677241a715e57a2744f94323",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/892809309c1bc370677241a715e57a2744f94323"
      }
    ],
    "stats": {
      "total": 35,
      "additions": 26,
      "deletions": 9
    },
    "files": [
      {
        "sha": "00ea7fb85198812e26c004006b57a5cdf37eeb15",
        "filename": "contrib/devtools/git-subtree-check.sh",
        "status": "modified",
        "additions": 26,
        "deletions": 9,
        "changes": 35,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e1d0cc23a9f09007c716d27874e3296cb81149da/contrib/devtools/git-subtree-check.sh",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e1d0cc23a9f09007c716d27874e3296cb81149da/contrib/devtools/git-subtree-check.sh",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/devtools/git-subtree-check.sh?ref=e1d0cc23a9f09007c716d27874e3296cb81149da",
        "patch": "@@ -41,21 +41,17 @@ find_latest_squash()\n \tdone\n }\n \n+# find latest subtree update\n latest_squash=\"$(find_latest_squash \"$DIR\")\"\n if [ -z \"$latest_squash\" ]; then\n     echo \"ERROR: $DIR is not a subtree\" >&2\n     exit 2\n fi\n-\n set $latest_squash\n old=$1\n rev=$2\n-if [ \"d$(git cat-file -t $rev 2>/dev/null)\" != dcommit ]; then\n-    echo \"ERROR: subtree commit $rev unavailable. Fetch/update the subtree repository\" >&2\n-    exit 2\n-fi\n-tree_subtree=$(git show -s --format=\"%T\" $rev)\n-echo \"$DIR in $COMMIT was last updated to upstream commit $rev (tree $tree_subtree)\"\n+\n+# get the tree in the current commit\n tree_actual=$(git ls-tree -d \"$COMMIT\" \"$DIR\" | head -n 1)\n if [ -z \"$tree_actual\" ]; then\n     echo \"FAIL: subtree directory $DIR not found in $COMMIT\" >&2\n@@ -69,9 +65,30 @@ if [ \"d$tree_actual_type\" != \"dtree\" ]; then\n     echo \"FAIL: subtree directory $DIR is not a tree in $COMMIT\" >&2\n     exit 1\n fi\n+\n+# get the tree at the time of the last subtree update\n+tree_commit=$(git show -s --format=\"%T\" $old)\n+echo \"$DIR in $COMMIT was last updated in commit $old (tree $tree_commit)\"\n+\n+# ... and compare the actual tree with it\n+if [ \"$tree_actual_tree\" != \"$tree_commit\" ]; then\n+    git diff $tree_commit $tree_actual_tree >&2\n+    echo \"FAIL: subtree directory was touched without subtree merge\" >&2\n+    exit 1\n+fi\n+\n+# get the tree in the subtree commit referred to\n+if [ \"d$(git cat-file -t $rev 2>/dev/null)\" != dcommit ]; then\n+    echo \"subtree commit $rev unavailable: cannot compare\" >&2\n+    exit\n+fi\n+tree_subtree=$(git show -s --format=\"%T\" $rev)\n+echo \"$DIR in $COMMIT was last updated to upstream commit $rev (tree $tree_subtree)\"\n+\n+# ... and compare the actual tree with it\n if [ \"$tree_actual_tree\" != \"$tree_subtree\" ]; then\n-    git diff-tree $tree_actual_tree $tree_subtree >&2\n-    echo \"FAIL: subtree directory tree doesn't match subtree commit tree\" >&2\n+    echo \"FAIL: subtree update commit differs from upstream tree!\" >&2\n     exit 1\n fi\n+\n echo \"GOOD\""
      }
    ]
  },
  {
    "sha": "487aff42184117ae3b8be4381b77587448e297a5",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0ODdhZmY0MjE4NDExN2FlM2I4YmU0MzgxYjc3NTg3NDQ4ZTI5N2E1",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2017-09-25T01:32:57Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2017-10-11T18:40:57Z"
      },
      "message": "Check subtree consistency in Travis",
      "tree": {
        "sha": "24cde883e2d37219d6218817e542acc1e7f7fa3f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/24cde883e2d37219d6218817e542acc1e7f7fa3f"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/487aff42184117ae3b8be4381b77587448e297a5",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/487aff42184117ae3b8be4381b77587448e297a5",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/487aff42184117ae3b8be4381b77587448e297a5",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/487aff42184117ae3b8be4381b77587448e297a5/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "e1d0cc23a9f09007c716d27874e3296cb81149da",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e1d0cc23a9f09007c716d27874e3296cb81149da",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/e1d0cc23a9f09007c716d27874e3296cb81149da"
      }
    ],
    "stats": {
      "total": 4,
      "additions": 4,
      "deletions": 0
    },
    "files": [
      {
        "sha": "2c9f239a9d8a111a85ee1c1003c4c22f88770bc3",
        "filename": ".travis.yml",
        "status": "modified",
        "additions": 4,
        "deletions": 0,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/487aff42184117ae3b8be4381b77587448e297a5/.travis.yml",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/487aff42184117ae3b8be4381b77587448e297a5/.travis.yml",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/.travis.yml?ref=487aff42184117ae3b8be4381b77587448e297a5",
        "patch": "@@ -47,6 +47,10 @@ install:\n     - if [ -n \"$PACKAGES\" ]; then travis_retry sudo apt-get install --no-install-recommends --no-upgrade -qq $PACKAGES; fi\n before_script:\n     - if [ \"$CHECK_DOC\" = 1 -a \"$TRAVIS_EVENT_TYPE\" = \"pull_request\" ]; then contrib/devtools/commit-script-check.sh $TRAVIS_COMMIT_RANGE; fi\n+    - if [ \"$CHECK_DOC\" = 1 ]; then contrib/devtools/git-subtree-check.sh src/crypto/ctaes; fi\n+    - if [ \"$CHECK_DOC\" = 1 ]; then contrib/devtools/git-subtree-check.sh src/secp256k1; fi\n+    - if [ \"$CHECK_DOC\" = 1 ]; then contrib/devtools/git-subtree-check.sh src/univalue; fi\n+    - if [ \"$CHECK_DOC\" = 1 ]; then contrib/devtools/git-subtree-check.sh src/leveldb; fi\n     - if [ \"$CHECK_DOC\" = 1 ]; then contrib/devtools/check-doc.py; fi\n     - if [ \"$CHECK_DOC\" = 1 ]; then contrib/devtools/check-rpc-mappings.py .; fi\n     - if [ \"$CHECK_DOC\" = 1 ]; then contrib/devtools/lint-all.sh; fi"
      }
    ]
  }
]