[
  {
    "sha": "aaa02e7f24a2f7d1d390053e3b5007a304fd5f21",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzphYWEwMmU3ZjI0YTJmN2QxZDM5MDA1M2UzYjUwMDdhMzA0ZmQ1ZjIx",
    "commit": {
      "author": {
        "name": "Jeremy Rubin",
        "email": "jeremy.l.rubin@gmail.com",
        "date": "2017-01-10T19:49:36Z"
      },
      "committer": {
        "name": "Jeremy Rubin",
        "email": "jeremy.l.rubin@gmail.com",
        "date": "2017-01-10T23:23:00Z"
      },
      "message": "Add prevector destructor benchmark",
      "tree": {
        "sha": "3c1138aea93d92a69578e8cb8c31cab95f4f7d88",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3c1138aea93d92a69578e8cb8c31cab95f4f7d88"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/aaa02e7f24a2f7d1d390053e3b5007a304fd5f21",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/aaa02e7f24a2f7d1d390053e3b5007a304fd5f21",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/aaa02e7f24a2f7d1d390053e3b5007a304fd5f21",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/aaa02e7f24a2f7d1d390053e3b5007a304fd5f21/comments",
    "author": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "07fd147b9f12e9205afd66a624edce357977d615",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/07fd147b9f12e9205afd66a624edce357977d615",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/07fd147b9f12e9205afd66a624edce357977d615"
      }
    ],
    "stats": {
      "total": 39,
      "additions": 38,
      "deletions": 1
    },
    "files": [
      {
        "sha": "2dc240e246bd0d12923cafd377bfec074080bd38",
        "filename": "src/Makefile.bench.include",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/aaa02e7f24a2f7d1d390053e3b5007a304fd5f21/src/Makefile.bench.include",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/aaa02e7f24a2f7d1d390053e3b5007a304fd5f21/src/Makefile.bench.include",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/Makefile.bench.include?ref=aaa02e7f24a2f7d1d390053e3b5007a304fd5f21",
        "patch": "@@ -24,7 +24,8 @@ bench_bench_bitcoin_SOURCES = \\\n   bench/base58.cpp \\\n   bench/lockedpool.cpp \\\n   bench/perf.cpp \\\n-  bench/perf.h\n+  bench/perf.h \\\n+  bench/prevector_destructor.cpp\n \n nodist_bench_bench_bitcoin_SOURCES = $(GENERATED_TEST_FILES)\n "
      },
      {
        "sha": "55af3de4fe756ae007b000d247eb4558ae5352f9",
        "filename": "src/bench/prevector_destructor.cpp",
        "status": "added",
        "additions": 36,
        "deletions": 0,
        "changes": 36,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/aaa02e7f24a2f7d1d390053e3b5007a304fd5f21/src/bench/prevector_destructor.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/aaa02e7f24a2f7d1d390053e3b5007a304fd5f21/src/bench/prevector_destructor.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bench/prevector_destructor.cpp?ref=aaa02e7f24a2f7d1d390053e3b5007a304fd5f21",
        "patch": "@@ -0,0 +1,36 @@\n+// Copyright (c) 2015-2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include \"bench.h\"\n+#include \"prevector.h\"\n+\n+static void PrevectorDestructor(benchmark::State& state)\n+{\n+    while (state.KeepRunning()) {\n+        for (auto x = 0; x < 1000; ++x) {\n+            prevector<28, unsigned char> t0;\n+            prevector<28, unsigned char> t1;\n+            t0.resize(28);\n+            t1.resize(29);\n+        }\n+    }\n+}\n+\n+static void PrevectorClear(benchmark::State& state)\n+{\n+\n+    while (state.KeepRunning()) {\n+        for (auto x = 0; x < 1000; ++x) {\n+            prevector<28, unsigned char> t0;\n+            prevector<28, unsigned char> t1;\n+            t0.resize(28);\n+            t0.clear();\n+            t1.resize(29);\n+            t0.clear();\n+        }\n+    }\n+}\n+\n+BENCHMARK(PrevectorDestructor);\n+BENCHMARK(PrevectorClear);"
      }
    ]
  },
  {
    "sha": "45a5aaf147ba65388333a8f40ae01b04a2d4a8c8",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0NWE1YWFmMTQ3YmE2NTM4ODMzM2E4ZjQwYWUwMWIwNGEyZDRhOGM4",
    "commit": {
      "author": {
        "name": "Jeremy Rubin",
        "email": "jeremy.l.rubin@gmail.com",
        "date": "2017-01-10T15:59:48Z"
      },
      "committer": {
        "name": "Jeremy Rubin",
        "email": "jeremy.l.rubin@gmail.com",
        "date": "2017-01-10T23:23:10Z"
      },
      "message": "Only call clear on prevector if it isn't trivially destructible and don't loop in clear",
      "tree": {
        "sha": "219a92c73d3b2e37f6af8c5885014424b6f34c68",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/219a92c73d3b2e37f6af8c5885014424b6f34c68"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/45a5aaf147ba65388333a8f40ae01b04a2d4a8c8",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/45a5aaf147ba65388333a8f40ae01b04a2d4a8c8",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/45a5aaf147ba65388333a8f40ae01b04a2d4a8c8",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/45a5aaf147ba65388333a8f40ae01b04a2d4a8c8/comments",
    "author": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "aaa02e7f24a2f7d1d390053e3b5007a304fd5f21",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/aaa02e7f24a2f7d1d390053e3b5007a304fd5f21",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/aaa02e7f24a2f7d1d390053e3b5007a304fd5f21"
      }
    ],
    "stats": {
      "total": 17,
      "additions": 12,
      "deletions": 5
    },
    "files": [
      {
        "sha": "9eb6f8c68fc95b2a0b79fcb3db1ad0525498595e",
        "filename": "src/prevector.h",
        "status": "modified",
        "additions": 12,
        "deletions": 5,
        "changes": 17,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/45a5aaf147ba65388333a8f40ae01b04a2d4a8c8/src/prevector.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/45a5aaf147ba65388333a8f40ae01b04a2d4a8c8/src/prevector.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/prevector.h?ref=45a5aaf147ba65388333a8f40ae01b04a2d4a8c8",
        "patch": "@@ -10,6 +10,7 @@\n #include <string.h>\n \n #include <iterator>\n+#include <type_traits>\n \n #pragma pack(push, 1)\n /** Implements a drop-in replacement for std::vector<T> which stores up to N\n@@ -382,10 +383,14 @@ class prevector {\n     iterator erase(iterator first, iterator last) {\n         iterator p = first;\n         char* endp = (char*)&(*end());\n-        while (p != last) {\n-            (*p).~T();\n-            _size--;\n-            ++p;\n+        if (!std::is_trivially_destructible<T>::value) {\n+            while (p != last) {\n+                (*p).~T();\n+                _size--;\n+                ++p;\n+            }\n+        } else {\n+            _size -= last - p;\n         }\n         memmove(&(*first), &(*last), endp - ((char*)(&(*last))));\n         return first;\n@@ -426,7 +431,9 @@ class prevector {\n     }\n \n     ~prevector() {\n-        clear();\n+        if (!std::is_trivially_destructible<T>::value) {\n+            clear();\n+        }\n         if (!is_direct()) {\n             free(_union.indirect);\n             _union.indirect = NULL;"
      }
    ]
  }
]