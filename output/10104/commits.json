[
  {
    "sha": "bd41d9831fbd6a612ab7713bee00d0468be5f51a",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiZDQxZDk4MzFmYmQ2YTYxMmFiNzcxM2JlZTAwZDA0NjhiZTVmNTFh",
    "commit": {
      "author": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2017-03-28T04:05:25Z"
      },
      "committer": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2017-03-30T00:12:55Z"
      },
      "message": "Datadir option in linearize scripts\n\nAdds a datadir configuration option to the linearize scripts to allow the script to use the RPC cookie instead of requiring the user to set a rpcuser and rpcpassword for the rpc server.",
      "tree": {
        "sha": "8e217b6f3ca0c3c9afde42211373d9ea1939d2a7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8e217b6f3ca0c3c9afde42211373d9ea1939d2a7"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/bd41d9831fbd6a612ab7713bee00d0468be5f51a",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bd41d9831fbd6a612ab7713bee00d0468be5f51a",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/bd41d9831fbd6a612ab7713bee00d0468be5f51a",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bd41d9831fbd6a612ab7713bee00d0468be5f51a/comments",
    "author": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "5114f8113627791b871c88998bd5a3d36961c241",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5114f8113627791b871c88998bd5a3d36961c241",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/5114f8113627791b871c88998bd5a3d36961c241"
      }
    ],
    "stats": {
      "total": 27,
      "additions": 25,
      "deletions": 2
    },
    "files": [
      {
        "sha": "f2a2ab2768af4af6fe9f83d175864b327b093be7",
        "filename": "contrib/linearize/README.md",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/bd41d9831fbd6a612ab7713bee00d0468be5f51a/contrib/linearize/README.md",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/bd41d9831fbd6a612ab7713bee00d0468be5f51a/contrib/linearize/README.md",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/linearize/README.md?ref=bd41d9831fbd6a612ab7713bee00d0468be5f51a",
        "patch": "@@ -7,7 +7,8 @@ run using Python 3 but are compatible with Python 2.\n     $ ./linearize-hashes.py linearize.cfg > hashlist.txt\n \n Required configuration file settings for linearize-hashes:\n-* RPC: `rpcuser`, `rpcpassword`\n+* RPC: `datadir` (Required if `rpcuser` and `rpcpassword` are not specified)\n+* RPC: `rpcuser`, `rpcpassword` (Required if `datadir` is not specified)\n \n Optional config file setting for linearize-hashes:\n * RPC: `host`  (Default: `127.0.0.1`)"
      },
      {
        "sha": "d019b06b6c0afd7de90e078fa96cabea055b4ddc",
        "filename": "contrib/linearize/example-linearize.cfg",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/bd41d9831fbd6a612ab7713bee00d0468be5f51a/contrib/linearize/example-linearize.cfg",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/bd41d9831fbd6a612ab7713bee00d0468be5f51a/contrib/linearize/example-linearize.cfg",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/linearize/example-linearize.cfg?ref=bd41d9831fbd6a612ab7713bee00d0468be5f51a",
        "patch": "@@ -1,6 +1,7 @@\n # bitcoind RPC settings (linearize-hashes)\n rpcuser=someuser\n rpcpassword=somepassword\n+#datadir=~/.bitcoin\n host=127.0.0.1\n port=8332\n #port=18332"
      },
      {
        "sha": "db8eb7021e160259d798fd6a76a7d970b0a74bf1",
        "filename": "contrib/linearize/linearize-hashes.py",
        "status": "modified",
        "additions": 22,
        "deletions": 1,
        "changes": 23,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/bd41d9831fbd6a612ab7713bee00d0468be5f51a/contrib/linearize/linearize-hashes.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/bd41d9831fbd6a612ab7713bee00d0468be5f51a/contrib/linearize/linearize-hashes.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/linearize/linearize-hashes.py?ref=bd41d9831fbd6a612ab7713bee00d0468be5f51a",
        "patch": "@@ -16,6 +16,8 @@\n import re\n import base64\n import sys\n+import os\n+import os.path\n \n settings = {}\n \n@@ -93,6 +95,14 @@ def get_block_hashes(settings, max_blocks_per_call=10000):\n \n \t\theight += num_blocks\n \n+def get_rpc_cookie():\n+\t# Open the cookie file\n+\twith open(os.path.join(os.path.expanduser(settings['datadir']), '.cookie'), 'r') as f:\n+\t\tcombined = f.readline()\n+\t\tcombined_split = combined.split(\":\")\n+\t\tsettings['rpcuser'] = combined_split[0]\n+\t\tsettings['rpcpassword'] = combined_split[1]\n+\n if __name__ == '__main__':\n \tif len(sys.argv) != 2:\n \t\tprint(\"Usage: linearize-hashes.py CONFIG-FILE\")\n@@ -122,8 +132,15 @@ def get_block_hashes(settings, max_blocks_per_call=10000):\n \t\tsettings['max_height'] = 313000\n \tif 'rev_hash_bytes' not in settings:\n \t\tsettings['rev_hash_bytes'] = 'false'\n+\n+\tuse_userpass = True\n+\tuse_datadir = False\n \tif 'rpcuser' not in settings or 'rpcpassword' not in settings:\n-\t\tprint(\"Missing username and/or password in cfg file\", file=stderr)\n+\t\tuse_userpass = False\n+\tif 'datadir' in settings and not use_userpass:\n+\t\tuse_datadir = True\n+\tif not use_userpass and not use_datadir:\n+\t\tprint(\"Missing datadir or username and/or password in cfg file\", file=stderr)\n \t\tsys.exit(1)\n \n \tsettings['port'] = int(settings['port'])\n@@ -133,4 +150,8 @@ def get_block_hashes(settings, max_blocks_per_call=10000):\n \t# Force hash byte format setting to be lowercase to make comparisons easier.\n \tsettings['rev_hash_bytes'] = settings['rev_hash_bytes'].lower()\n \n+\t# Get the rpc user and pass from the cookie if the datadir is set\n+\tif use_datadir:\n+\t\tget_rpc_cookie()\n+\n \tget_block_hashes(settings)"
      }
    ]
  }
]