theuni,2014-10-21T17:58:23Z,ACK on the scoped_ptr change.\n,https://github.com/bitcoin/bitcoin/pull/5115#issuecomment-59969817,59969817,
sipa,2014-10-21T22:47:17Z,utACK on all changes\n,https://github.com/bitcoin/bitcoin/pull/5115#issuecomment-60011444,60011444,
theuni,2014-10-21T17:23:29Z,Doesn't this somewhat defeat the purpose of the cache? I would expect GetStats() to merge the cached and committed data.\n,https://github.com/bitcoin/bitcoin/pull/5115#discussion_r19163451,19163451,src/rpcblockchain.cpp
laanwj,2014-10-21T17:29:36Z,"GetStats is a very slow call (it iterates over the entire database), so the overhead of an extra flush is negligible in comparison.\n",https://github.com/bitcoin/bitcoin/pull/5115#discussion_r19163844,19163844,src/rpcblockchain.cpp
laanwj,2014-10-21T17:41:15Z,"Anyhow if flushing here is controversial I'll remove it, the point of this pull is really the other fix.\n",https://github.com/bitcoin/bitcoin/pull/5115#discussion_r19164664,19164664,src/rpcblockchain.cpp
theuni,2014-10-21T17:57:59Z,"No controversy, just pointing out that it doesn't do what may be expected. A quick comment would be enough to shut me up :)\n",https://github.com/bitcoin/bitcoin/pull/5115#discussion_r19166092,19166092,src/rpcblockchain.cpp
sipa,2014-10-21T22:46:47Z,"CCoinsView in general has no means of iterating over the entire dataset, so we're necessarily relying on the lowest level view (the database) which does. I agree it would be nicer if some means of getting a combined resulting view and iterating over it would be nice, but just for GetStats that's not worth it. Also, GetStats is already terribly slow, I don't care about a flush before it.\n",https://github.com/bitcoin/bitcoin/pull/5115#discussion_r19184822,19184822,src/rpcblockchain.cpp
laanwj,2014-10-22T07:38:20Z,"As for leveldb, from the documentation: ""An iterator operates on a snapshot of the database taken when the iterator is created"". I think this means that we can mark the `gettxoutsetinfo` RPC call as thread-safe? \n\nOnly the Flush would need the cs_main lock, after that it can just take its time to summarize the snapshot and clean up the iterator, then return the result.\n",https://github.com/bitcoin/bitcoin/pull/5115#discussion_r19198146,19198146,src/rpcblockchain.cpp
sipa,2014-10-24T17:36:38Z,Interesting; we should do that.\n,https://github.com/bitcoin/bitcoin/pull/5115#discussion_r19352504,19352504,src/rpcblockchain.cpp
laanwj,2014-10-25T07:18:07Z,"I've tested that approach over the last few days (on a node where I've set blocknotify to call `gettxoutsetinfo`), and I've had no problems. I'll submit a new pull for that.\n",https://github.com/bitcoin/bitcoin/pull/5115#discussion_r19374373,19374373,src/rpcblockchain.cpp
