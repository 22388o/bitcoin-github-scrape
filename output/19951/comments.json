[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/691656011",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19951#issuecomment-691656011",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19951",
    "id": 691656011,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MTY1NjAxMQ==",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-13T10:56:04Z",
    "updated_at": "2020-09-13T10:56:04Z",
    "author_association": "MEMBER",
    "body": "Thanks to @Saibato for setting me straight on this in #19946 and to @michaelfolkson for looking at that PR.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/691656011/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/691658695",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19951#issuecomment-691658695",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19951",
    "id": 691658695,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MTY1ODY5NQ==",
    "user": {
      "login": "michaelfolkson",
      "id": 16323900,
      "node_id": "MDQ6VXNlcjE2MzIzOTAw",
      "avatar_url": "https://avatars.githubusercontent.com/u/16323900?u=e2201a78ad660e42fd175003d02ad749b855e0a9&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelfolkson",
      "html_url": "https://github.com/michaelfolkson",
      "followers_url": "https://api.github.com/users/michaelfolkson/followers",
      "following_url": "https://api.github.com/users/michaelfolkson/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelfolkson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelfolkson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelfolkson/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelfolkson/orgs",
      "repos_url": "https://api.github.com/users/michaelfolkson/repos",
      "events_url": "https://api.github.com/users/michaelfolkson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelfolkson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-13T11:22:36Z",
    "updated_at": "2020-09-13T11:22:36Z",
    "author_association": "CONTRIBUTOR",
    "body": "Concept ACK. Will follow the above steps before ACKing the commit.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/691658695/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/691662576",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19951#issuecomment-691662576",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19951",
    "id": 691662576,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MTY2MjU3Ng==",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-13T12:01:01Z",
    "updated_at": "2020-09-13T13:18:55Z",
    "author_association": "MEMBER",
    "body": "I don't know why the travis xenial and macOS GUI/no depends are failing. All the other CI jobs pass on travis, cirrus, appveyor ones and bitcoin_builds.org.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/691662576/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/691672777",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19951#issuecomment-691672777",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19951",
    "id": 691672777,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MTY3Mjc3Nw==",
    "user": {
      "login": "Saibato",
      "id": 34917548,
      "node_id": "MDQ6VXNlcjM0OTE3NTQ4",
      "avatar_url": "https://avatars.githubusercontent.com/u/34917548?u=599ab1f4da03ca95d97224c2c2431a52e938d24e&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Saibato",
      "html_url": "https://github.com/Saibato",
      "followers_url": "https://api.github.com/users/Saibato/followers",
      "following_url": "https://api.github.com/users/Saibato/following{/other_user}",
      "gists_url": "https://api.github.com/users/Saibato/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Saibato/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Saibato/subscriptions",
      "organizations_url": "https://api.github.com/users/Saibato/orgs",
      "repos_url": "https://api.github.com/users/Saibato/repos",
      "events_url": "https://api.github.com/users/Saibato/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Saibato/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-13T13:39:43Z",
    "updated_at": "2020-09-13T13:59:39Z",
    "author_association": "CONTRIBUTOR",
    "body": "> I don't know why the travis xenial and macOS GUI/no depends are failing. All the other CI jobs pass on travis, cirrus, appveyor ones and bitcoin_builds.org.\r\n\r\n BOOST_CHECK_EQUAL(addr.ToString(), ipv6_addr); ipv6 with % != ?\r\n```\r\ntest/net_tests.cpp:259: error: in \"net_tests/cnetaddr_basic\": check addr.ToString() == scoped_addr has failed [1122:3344:5566:7788:9900:aabb:ccdd:eeff != 1122:3344:5566:7788:9900:aabb:ccdd:eeff%1]\r\n```\r\ni.e. test, does the stack support scopes at all?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/691672777/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/691674599",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19951#issuecomment-691674599",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19951",
    "id": 691674599,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MTY3NDU5OQ==",
    "user": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?u=5ff13e375b40ea55ecd3c108337dd6a23f68eddf&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-13T13:55:32Z",
    "updated_at": "2020-09-13T13:55:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "Concept ACK\r\n\r\nThanks for adding tests! \u2764\ufe0f ",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/691674599/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/691697651",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19951#issuecomment-691697651",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19951",
    "id": 691697651,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MTY5NzY1MQ==",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?u=7999a16349f0df0fb273fffa18e5a955c9d3f11c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-13T17:09:42Z",
    "updated_at": "2020-09-13T17:09:42Z",
    "author_association": "MEMBER",
    "body": "I don't think scope ids are intended to be portable.\n\nThey're a way for a user, on their local system, to specify what interface to use if you have multiple and are using a link-local address.\n\nBut in the end it's just a string that's passed to the OS for parsing. What interfaces exist, how they're named, and in what situation they're accepted is entirely up to it.\n\nOne idea that may make it more portable is restricting these scopes in tests to link-local addresses (inside fe80::/10), as the OS may refuse them outside that range.\n\nIf that still doesn't work... this is really no different than trying to unit test whether DNS resolving works, and then noticing the test fails on an offline system or so. It's dependent on local configuration, and there is no good cross-platform spec that all OSes adhere to.\n\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/691697651/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/691725611",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19951#issuecomment-691725611",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19951",
    "id": 691725611,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MTcyNTYxMQ==",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-13T21:07:59Z",
    "updated_at": "2020-09-13T21:07:59Z",
    "author_association": "MEMBER",
    "body": "> One idea that may make it more portable is restricting these scopes in tests to link-local addresses (inside fe80::/10), as the OS may refuse them outside that range.\r\n\r\nThis suggestion solved the Travis Xenial job and stabilized the macOS no-depends one enough to enable a workaround. Thank you, @sipa!\r\n\r\nCI is now green; ready for review.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/691725611/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/692145375",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19951#issuecomment-692145375",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19951",
    "id": 692145375,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MjE0NTM3NQ==",
    "user": {
      "login": "eriknylund",
      "id": 20860124,
      "node_id": "MDQ6VXNlcjIwODYwMTI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/20860124?u=3c6feaee866b9056bcd9bfbb046841472318b3de&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eriknylund",
      "html_url": "https://github.com/eriknylund",
      "followers_url": "https://api.github.com/users/eriknylund/followers",
      "following_url": "https://api.github.com/users/eriknylund/following{/other_user}",
      "gists_url": "https://api.github.com/users/eriknylund/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eriknylund/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eriknylund/subscriptions",
      "organizations_url": "https://api.github.com/users/eriknylund/orgs",
      "repos_url": "https://api.github.com/users/eriknylund/repos",
      "events_url": "https://api.github.com/users/eriknylund/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eriknylund/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-14T15:47:29Z",
    "updated_at": "2020-09-14T15:47:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "ACK 88b6f85419b65122d5a4469a8585b276960bbb1e I built the PR on macOS Catalina 10.15.6 and ran both tests and functional tests - all pass. I've reviewed the two commits and I think the changes look good.\r\n\r\nI also repeated the test instructions to verify that the tests break accordingly (a bit different now because of the modified test):\r\n```\r\ntest/net_tests.cpp:258: error: in \"net_tests/cnetaddr_basic\": check addr_str == scoped_addr || addr_str == \"fe80:0:0:0:0:0:0:1\" has failed\r\n*** 1 failure is detected in the test module \"Bitcoin Core Test Suite\"\r\n```\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/692145375/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/692181543",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19951#issuecomment-692181543",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19951",
    "id": 692181543,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MjE4MTU0Mw==",
    "user": {
      "login": "Saibato",
      "id": 34917548,
      "node_id": "MDQ6VXNlcjM0OTE3NTQ4",
      "avatar_url": "https://avatars.githubusercontent.com/u/34917548?u=599ab1f4da03ca95d97224c2c2431a52e938d24e&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Saibato",
      "html_url": "https://github.com/Saibato",
      "followers_url": "https://api.github.com/users/Saibato/followers",
      "following_url": "https://api.github.com/users/Saibato/following{/other_user}",
      "gists_url": "https://api.github.com/users/Saibato/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Saibato/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Saibato/subscriptions",
      "organizations_url": "https://api.github.com/users/Saibato/orgs",
      "repos_url": "https://api.github.com/users/Saibato/repos",
      "events_url": "https://api.github.com/users/Saibato/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Saibato/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-14T16:51:56Z",
    "updated_at": "2020-09-14T16:51:56Z",
    "author_association": "CONTRIBUTOR",
    "body": "btw: That macOS  edge case results from` std::string CNetAddr::ToStringIP() const ` in src/netaddress.cpp\r\nif we can not  GetSockAddr(... and result there in fallback.\r\n \r\nIf we convert the addr boost or https://tools.ietf.org/html/rfc4291 style we do not need the special addr representation string fe80:0:0:0:0:0:0:1\"\r\n\r\nThat patch would do the trick?\r\n\r\n``` Diff\r\ndiff --git a/src/test/net_tests.cpp b/src/test/net_tests.cpp\r\nindex e7156d1d3..108b1ace8 100644\r\n--- a/src/test/net_tests.cpp\r\n+++ b/src/test/net_tests.cpp\r\n@@ -19,6 +19,7 @@\r\n #include <version.h>\r\n \r\n #include <boost/test/unit_test.hpp>\r\n+#include <boost/asio/ip/address.hpp>\r\n \r\n #include <memory>\r\n #include <string>\r\n@@ -251,12 +252,12 @@ BOOST_AUTO_TEST_CASE(cnetaddr_basic)\r\n     const std::string link_local{\"fe80::1\"};\r\n     const std::string scoped_addr{link_local + \"%32\"};\r\n     BOOST_REQUIRE(LookupHost(scoped_addr, addr, false));\r\n+\r\n     BOOST_REQUIRE(addr.IsValid());\r\n     BOOST_REQUIRE(addr.IsIPv6());\r\n     BOOST_CHECK(!addr.IsBindAny());\r\n-    const std::string addr_str{addr.ToString()};\r\n-    BOOST_CHECK(addr_str == scoped_addr || addr_str == \"fe80:0:0:0:0:0:0:1\");\r\n-    // The fallback case \"fe80:0:0:0:0:0:0:1\" is needed for macOS 10.14/10.15.\r\n+    const std::string addr_str{(boost::asio::ip::address::from_string(addr.ToString())).to_string()};\r\n+    BOOST_CHECK(addr_str == scoped_addr);\r\n     // Test that the delimiter \"%\" and default zone id of 0 can be omitted for the default scope.\r\n     BOOST_REQUIRE(LookupHost(link_local + \"%0\", addr, false));\r\n     BOOST_REQUIRE(addr.IsValid());\r\n\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/692181543/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/692473356",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19951#issuecomment-692473356",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19951",
    "id": 692473356,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MjQ3MzM1Ng==",
    "user": {
      "login": "eriknylund",
      "id": 20860124,
      "node_id": "MDQ6VXNlcjIwODYwMTI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/20860124?u=3c6feaee866b9056bcd9bfbb046841472318b3de&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eriknylund",
      "html_url": "https://github.com/eriknylund",
      "followers_url": "https://api.github.com/users/eriknylund/followers",
      "following_url": "https://api.github.com/users/eriknylund/following{/other_user}",
      "gists_url": "https://api.github.com/users/eriknylund/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eriknylund/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eriknylund/subscriptions",
      "organizations_url": "https://api.github.com/users/eriknylund/orgs",
      "repos_url": "https://api.github.com/users/eriknylund/repos",
      "events_url": "https://api.github.com/users/eriknylund/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eriknylund/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-15T05:28:06Z",
    "updated_at": "2020-09-15T05:28:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "> btw: That macOS edge case results from`std::string CNetAddr::ToStringIP() const` in src/netaddress.cpp\r\n> if we can not GetSockAddr(... and result there in fallback.\r\n> \r\n> If we convert the addr boost or https://tools.ietf.org/html/rfc4291 style we do not need the special addr representation string fe80:0:0:0:0:0:0:1\"\r\n> \r\n> That patch would do the trick?\r\n> \r\n> ```diff\r\n> diff --git a/src/test/net_tests.cpp b/src/test/net_tests.cpp\r\n> index e7156d1d3..108b1ace8 100644\r\n> --- a/src/test/net_tests.cpp\r\n> +++ b/src/test/net_tests.cpp\r\n> @@ -19,6 +19,7 @@\r\n>  #include <version.h>\r\n>  \r\n>  #include <boost/test/unit_test.hpp>\r\n> +#include <boost/asio/ip/address.hpp>\r\n>  \r\n>  #include <memory>\r\n>  #include <string>\r\n> @@ -251,12 +252,12 @@ BOOST_AUTO_TEST_CASE(cnetaddr_basic)\r\n>      const std::string link_local{\"fe80::1\"};\r\n>      const std::string scoped_addr{link_local + \"%32\"};\r\n>      BOOST_REQUIRE(LookupHost(scoped_addr, addr, false));\r\n> +\r\n>      BOOST_REQUIRE(addr.IsValid());\r\n>      BOOST_REQUIRE(addr.IsIPv6());\r\n>      BOOST_CHECK(!addr.IsBindAny());\r\n> -    const std::string addr_str{addr.ToString()};\r\n> -    BOOST_CHECK(addr_str == scoped_addr || addr_str == \"fe80:0:0:0:0:0:0:1\");\r\n> -    // The fallback case \"fe80:0:0:0:0:0:0:1\" is needed for macOS 10.14/10.15.\r\n> +    const std::string addr_str{(boost::asio::ip::address::from_string(addr.ToString())).to_string()};\r\n> +    BOOST_CHECK(addr_str == scoped_addr);\r\n>      // Test that the delimiter \"%\" and default zone id of 0 can be omitted for the default scope.\r\n>      BOOST_REQUIRE(LookupHost(link_local + \"%0\", addr, false));\r\n>      BOOST_REQUIRE(addr.IsValid());\r\n> ```\r\n\r\nIt's an interesting thought @Saibato, but I'm unsure if it will work here? I tried the patch by adding more verbose output with the following result:\r\n```\r\n    const std::string addr_str{(boost::asio::ip::address::from_string(addr.ToString())).to_string()};\r\n    BOOST_TEST_MESSAGE(scoped_addr);\r\n    BOOST_TEST_MESSAGE(addr_str);\r\n    BOOST_CHECK(addr_str == scoped_addr);\r\n```\r\n`test/test_bitcoin -t net_tests/cnetaddr_basic -l all` gives me:\r\n```\r\nfe80::1%32\r\nfe80::1\r\ntest/net_tests.cpp:267: error: in \"net_tests/cnetaddr_basic\": check addr_str == scoped_addr has failed\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/692473356/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/692479556",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19951#issuecomment-692479556",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19951",
    "id": 692479556,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MjQ3OTU1Ng==",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-15T05:47:17Z",
    "updated_at": "2020-09-15T05:47:17Z",
    "author_association": "MEMBER",
    "body": "Thanks @Saibato for the idea and @eriknylund for testing. MacOS 10.14+ seems to be a special case either way and I'd rather test what our code in `ToStringIP()` actually returns, so leaving this as-is for now.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/692479556/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/692624944",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19951#issuecomment-692624944",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19951",
    "id": 692624944,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MjYyNDk0NA==",
    "user": {
      "login": "michaelfolkson",
      "id": 16323900,
      "node_id": "MDQ6VXNlcjE2MzIzOTAw",
      "avatar_url": "https://avatars.githubusercontent.com/u/16323900?u=e2201a78ad660e42fd175003d02ad749b855e0a9&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelfolkson",
      "html_url": "https://github.com/michaelfolkson",
      "followers_url": "https://api.github.com/users/michaelfolkson/followers",
      "following_url": "https://api.github.com/users/michaelfolkson/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelfolkson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelfolkson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelfolkson/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelfolkson/orgs",
      "repos_url": "https://api.github.com/users/michaelfolkson/repos",
      "events_url": "https://api.github.com/users/michaelfolkson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelfolkson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-15T10:26:18Z",
    "updated_at": "2020-09-15T10:28:26Z",
    "author_association": "CONTRIBUTOR",
    "body": "Replicated steps @eriknylund followed [here](https://github.com/bitcoin/bitcoin/pull/19951#issuecomment-692145375) and got the same results on Mac OS Catalina 10.15.6. All tests passed and the single test failed with the broken feature.\r\n\r\nCode changes excluding the test changes are clearly fine.\r\n\r\nAnything else one could do before ACKing the commit? Running the old tests (tests before they were updated in this PR) on the broken feature to see that the old tests wouldn't have failed with this change?\r\n\r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/692624944/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/702698354",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19951#issuecomment-702698354",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19951",
    "id": 702698354,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMjY5ODM1NA==",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-02T12:09:06Z",
    "updated_at": "2020-10-02T12:09:06Z",
    "author_association": "MEMBER",
    "body": "Up for grabs.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/702698354/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/702755867",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19951#issuecomment-702755867",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19951",
    "id": 702755867,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMjc1NTg2Nw==",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-02T14:09:24Z",
    "updated_at": "2020-10-02T14:09:24Z",
    "author_association": "MEMBER",
    "body": "FWIW, I still think this is worth doing.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/702755867/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/702770371",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19951#issuecomment-702770371",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19951",
    "id": 702770371,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMjc3MDM3MQ==",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-02T14:35:45Z",
    "updated_at": "2020-10-02T14:48:43Z",
    "author_association": "MEMBER",
    "body": "Rebased for the merged `addrv2` changes, and updated to remove an unneeded include from an earlier push here and update a comment. Diff: `git range-diff df2129a 88b6f85 f36887f`\r\n```diff\r\n/src/test/net_tests.cpp\r\n \r\n #include <string>\r\n-#include <vector>\r\n \r\n@@ -256,7 +255,7 @@ BOOST_AUTO_TEST_CASE(cnetaddr_basic)\r\n     BOOST_CHECK(!addr.IsBindAny());\r\n     const std::string addr_str{addr.ToString()};\r\n     BOOST_CHECK(addr_str == scoped_addr || addr_str == \"fe80:0:0:0:0:0:0:1\");\r\n-    // The fallback case \"fe80:0:0:0:0:0:0:1\" is needed for macOS 10.14/10.15.\r\n+    // The fallback case \"fe80:0:0:0:0:0:0:1\" is needed for macOS 10.14/10.15 and (probably) later.\r\n     // Test that the delimiter \"%\" and default zone id of 0 can be omitted for the default scope.\r\n```\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/702770371/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/702785783",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19951#issuecomment-702785783",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19951",
    "id": 702785783,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMjc4NTc4Mw==",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-02T15:02:25Z",
    "updated_at": "2020-10-02T15:02:25Z",
    "author_association": "MEMBER",
    "body": "ACK f36887fa47b42af60f8a06a3995baca7c73ca310",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/702785783/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487792199",
    "pull_request_review_id": 487598712,
    "id": 487792199,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc5MjE5OQ==",
    "diff_hunk": "@@ -244,6 +245,28 @@ BOOST_AUTO_TEST_CASE(cnetaddr_basic)\n     BOOST_CHECK(!addr.IsBindAny());\n     BOOST_CHECK_EQUAL(addr.ToString(), \"1122:3344:5566:7788:9900:aabb:ccdd:eeff\");\n \n+    // IPv6, scoped/link-local. See https://tools.ietf.org/html/rfc4007\n+    // We support non-negative decimal integers (uint32_t) as zone id indices.\n+    const std::string link_local{\"fe80::1\"};\n+    const std::string link_local_edge_case{\"fe80:0:0:0:0:0:0:1\"}; // macOS no depends travis ci only\n+    const std::string delimiter{\"%\"};\n+    const std::vector<std::string> scopes{\"8\", \"21\", \"32\"};\n+    for (const std::string& scope : scopes) {\n+        const std::string scoped_addr{link_local + delimiter + scope};\n+        BOOST_REQUIRE(LookupHost(scoped_addr, addr, false));\n+        BOOST_REQUIRE(addr.IsValid());\n+        BOOST_REQUIRE(addr.IsIPv6());\n+        BOOST_CHECK(!addr.IsBindAny());\n+        const std::string addr_str{addr.ToString()};\n+        BOOST_CHECK(addr_str == scoped_addr || addr_str == link_local_edge_case);",
    "path": "src/test/net_tests.cpp",
    "position": null,
    "original_position": 25,
    "commit_id": "f36887fa47b42af60f8a06a3995baca7c73ca310",
    "original_commit_id": "431ebcefc633ff53bc71f212fe3a9a252c73d330",
    "user": {
      "login": "eriknylund",
      "id": 20860124,
      "node_id": "MDQ6VXNlcjIwODYwMTI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/20860124?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eriknylund",
      "html_url": "https://github.com/eriknylund",
      "followers_url": "https://api.github.com/users/eriknylund/followers",
      "following_url": "https://api.github.com/users/eriknylund/following{/other_user}",
      "gists_url": "https://api.github.com/users/eriknylund/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eriknylund/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eriknylund/subscriptions",
      "organizations_url": "https://api.github.com/users/eriknylund/orgs",
      "repos_url": "https://api.github.com/users/eriknylund/repos",
      "events_url": "https://api.github.com/users/eriknylund/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eriknylund/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I tested this locally on macOS Catalina 10.15.6 and I get an error on this line:\r\n```\r\ntest/net_tests.cpp:261: error: in \"net_tests/cnetaddr_basic\": check addr_str == scoped_addr || addr_str == link_local_edge_case has failed\r\n```\r\n\r\nUpdate: It fails on scope 8 and 21, but not on 32.",
    "created_at": "2020-09-14T09:56:59Z",
    "updated_at": "2020-10-02T14:43:04Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19951#discussion_r487792199",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19951",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487792199"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19951#discussion_r487792199"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19951"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487792199/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 261,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487815516",
    "pull_request_review_id": 487628219,
    "id": 487815516,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzgxNTUxNg==",
    "diff_hunk": "@@ -244,6 +245,28 @@ BOOST_AUTO_TEST_CASE(cnetaddr_basic)\n     BOOST_CHECK(!addr.IsBindAny());\n     BOOST_CHECK_EQUAL(addr.ToString(), \"1122:3344:5566:7788:9900:aabb:ccdd:eeff\");\n \n+    // IPv6, scoped/link-local. See https://tools.ietf.org/html/rfc4007\n+    // We support non-negative decimal integers (uint32_t) as zone id indices.\n+    const std::string link_local{\"fe80::1\"};\n+    const std::string link_local_edge_case{\"fe80:0:0:0:0:0:0:1\"}; // macOS no depends travis ci only\n+    const std::string delimiter{\"%\"};\n+    const std::vector<std::string> scopes{\"8\", \"21\", \"32\"};\n+    for (const std::string& scope : scopes) {\n+        const std::string scoped_addr{link_local + delimiter + scope};\n+        BOOST_REQUIRE(LookupHost(scoped_addr, addr, false));\n+        BOOST_REQUIRE(addr.IsValid());\n+        BOOST_REQUIRE(addr.IsIPv6());\n+        BOOST_CHECK(!addr.IsBindAny());\n+        const std::string addr_str{addr.ToString()};\n+        BOOST_CHECK(addr_str == scoped_addr || addr_str == link_local_edge_case);",
    "path": "src/test/net_tests.cpp",
    "position": null,
    "original_position": 25,
    "commit_id": "f36887fa47b42af60f8a06a3995baca7c73ca310",
    "original_commit_id": "431ebcefc633ff53bc71f212fe3a9a252c73d330",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks @eriknylund! If you don't mind, can you give the output of rebuilding and running the test after adding these 2 lines?\r\n```diff\r\n         const std::string addr_str{addr.ToString()};\r\n+        BOOST_TEST_MESSAGE(scoped_addr);\r\n+        BOOST_TEST_MESSAGE(addr_str);\r\n         BOOST_CHECK(addr_str == scoped_addr || addr_str == link_local_edge_case);\r\n     }\r\n```",
    "created_at": "2020-09-14T10:38:44Z",
    "updated_at": "2020-10-02T14:43:04Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19951#discussion_r487815516",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19951",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487815516"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19951#discussion_r487815516"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19951"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487815516/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 261,
    "side": "RIGHT",
    "in_reply_to_id": 487792199
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487817788",
    "pull_request_review_id": 487631104,
    "id": 487817788,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzgxNzc4OA==",
    "diff_hunk": "@@ -244,6 +245,28 @@ BOOST_AUTO_TEST_CASE(cnetaddr_basic)\n     BOOST_CHECK(!addr.IsBindAny());\n     BOOST_CHECK_EQUAL(addr.ToString(), \"1122:3344:5566:7788:9900:aabb:ccdd:eeff\");\n \n+    // IPv6, scoped/link-local. See https://tools.ietf.org/html/rfc4007\n+    // We support non-negative decimal integers (uint32_t) as zone id indices.\n+    const std::string link_local{\"fe80::1\"};\n+    const std::string link_local_edge_case{\"fe80:0:0:0:0:0:0:1\"}; // macOS no depends travis ci only\n+    const std::string delimiter{\"%\"};\n+    const std::vector<std::string> scopes{\"8\", \"21\", \"32\"};\n+    for (const std::string& scope : scopes) {\n+        const std::string scoped_addr{link_local + delimiter + scope};\n+        BOOST_REQUIRE(LookupHost(scoped_addr, addr, false));\n+        BOOST_REQUIRE(addr.IsValid());\n+        BOOST_REQUIRE(addr.IsIPv6());\n+        BOOST_CHECK(!addr.IsBindAny());\n+        const std::string addr_str{addr.ToString()};\n+        BOOST_CHECK(addr_str == scoped_addr || addr_str == link_local_edge_case);",
    "path": "src/test/net_tests.cpp",
    "position": null,
    "original_position": 25,
    "commit_id": "f36887fa47b42af60f8a06a3995baca7c73ca310",
    "original_commit_id": "431ebcefc633ff53bc71f212fe3a9a252c73d330",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "(ISTM the lower scope values are often used by the local machine, so higher values may indeed make the test more agnostic.)",
    "created_at": "2020-09-14T10:43:06Z",
    "updated_at": "2020-10-02T14:43:04Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19951#discussion_r487817788",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19951",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487817788"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19951#discussion_r487817788"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19951"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487817788/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 261,
    "side": "RIGHT",
    "in_reply_to_id": 487792199
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487823231",
    "pull_request_review_id": 487638403,
    "id": 487823231,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzgyMzIzMQ==",
    "diff_hunk": "@@ -244,6 +245,28 @@ BOOST_AUTO_TEST_CASE(cnetaddr_basic)\n     BOOST_CHECK(!addr.IsBindAny());\n     BOOST_CHECK_EQUAL(addr.ToString(), \"1122:3344:5566:7788:9900:aabb:ccdd:eeff\");\n \n+    // IPv6, scoped/link-local. See https://tools.ietf.org/html/rfc4007\n+    // We support non-negative decimal integers (uint32_t) as zone id indices.\n+    const std::string link_local{\"fe80::1\"};\n+    const std::string link_local_edge_case{\"fe80:0:0:0:0:0:0:1\"}; // macOS no depends travis ci only\n+    const std::string delimiter{\"%\"};\n+    const std::vector<std::string> scopes{\"8\", \"21\", \"32\"};\n+    for (const std::string& scope : scopes) {\n+        const std::string scoped_addr{link_local + delimiter + scope};\n+        BOOST_REQUIRE(LookupHost(scoped_addr, addr, false));\n+        BOOST_REQUIRE(addr.IsValid());\n+        BOOST_REQUIRE(addr.IsIPv6());\n+        BOOST_CHECK(!addr.IsBindAny());\n+        const std::string addr_str{addr.ToString()};\n+        BOOST_CHECK(addr_str == scoped_addr || addr_str == link_local_edge_case);",
    "path": "src/test/net_tests.cpp",
    "position": null,
    "original_position": 25,
    "commit_id": "f36887fa47b42af60f8a06a3995baca7c73ca310",
    "original_commit_id": "431ebcefc633ff53bc71f212fe3a9a252c73d330",
    "user": {
      "login": "eriknylund",
      "id": 20860124,
      "node_id": "MDQ6VXNlcjIwODYwMTI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/20860124?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eriknylund",
      "html_url": "https://github.com/eriknylund",
      "followers_url": "https://api.github.com/users/eriknylund/followers",
      "following_url": "https://api.github.com/users/eriknylund/following{/other_user}",
      "gists_url": "https://api.github.com/users/eriknylund/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eriknylund/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eriknylund/subscriptions",
      "organizations_url": "https://api.github.com/users/eriknylund/orgs",
      "repos_url": "https://api.github.com/users/eriknylund/repos",
      "events_url": "https://api.github.com/users/eriknylund/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eriknylund/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> (ISTM the lower scope values are often used by the local machine, so higher values may indeed make the test more agnostic.)\r\n\r\nThat seems to be the issue, en2 and vmnet8 are two network interfaces on my local machine:\r\n```\r\nfe80::1%8\r\nfe80::1%en2\r\ntest/net_tests.cpp:264: error: in \"net_tests/cnetaddr_basic\": check addr_str == scoped_addr || addr_str == link_local_edge_case has failed\r\nfe80::1%21\r\nfe80::1%vmnet8\r\ntest/net_tests.cpp:264: error: in \"net_tests/cnetaddr_basic\": check addr_str == scoped_addr || addr_str == link_local_edge_case has failed\r\nfe80::1%32\r\nfe80:0:0:0:0:0:0:1\r\n```",
    "created_at": "2020-09-14T10:53:46Z",
    "updated_at": "2020-10-02T14:43:04Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19951#discussion_r487823231",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19951",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487823231"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19951#discussion_r487823231"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19951"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487823231/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 261,
    "side": "RIGHT",
    "in_reply_to_id": 487792199
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487834588",
    "pull_request_review_id": 487653262,
    "id": 487834588,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzgzNDU4OA==",
    "diff_hunk": "@@ -244,6 +245,28 @@ BOOST_AUTO_TEST_CASE(cnetaddr_basic)\n     BOOST_CHECK(!addr.IsBindAny());\n     BOOST_CHECK_EQUAL(addr.ToString(), \"1122:3344:5566:7788:9900:aabb:ccdd:eeff\");\n \n+    // IPv6, scoped/link-local. See https://tools.ietf.org/html/rfc4007\n+    // We support non-negative decimal integers (uint32_t) as zone id indices.\n+    const std::string link_local{\"fe80::1\"};\n+    const std::string link_local_edge_case{\"fe80:0:0:0:0:0:0:1\"}; // macOS no depends travis ci only\n+    const std::string delimiter{\"%\"};\n+    const std::vector<std::string> scopes{\"8\", \"21\", \"32\"};\n+    for (const std::string& scope : scopes) {\n+        const std::string scoped_addr{link_local + delimiter + scope};\n+        BOOST_REQUIRE(LookupHost(scoped_addr, addr, false));\n+        BOOST_REQUIRE(addr.IsValid());\n+        BOOST_REQUIRE(addr.IsIPv6());\n+        BOOST_CHECK(!addr.IsBindAny());\n+        const std::string addr_str{addr.ToString()};\n+        BOOST_CHECK(addr_str == scoped_addr || addr_str == link_local_edge_case);",
    "path": "src/test/net_tests.cpp",
    "position": null,
    "original_position": 25,
    "commit_id": "f36887fa47b42af60f8a06a3995baca7c73ca310",
    "original_commit_id": "431ebcefc633ff53bc71f212fe3a9a252c73d330",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Perfect, thanks. Simplified the test to only the 32 and 0 values. No need for more than that.",
    "created_at": "2020-09-14T11:16:04Z",
    "updated_at": "2020-10-02T14:43:04Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19951#discussion_r487834588",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19951",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487834588"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19951#discussion_r487834588"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19951"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487834588/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 261,
    "side": "RIGHT",
    "in_reply_to_id": 487792199
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498809387",
    "pull_request_review_id": 501118254,
    "id": 498809387,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODgwOTM4Nw==",
    "diff_hunk": "@@ -22,6 +22,7 @@\n \n #include <memory>\n #include <string>\n+#include <vector>",
    "path": "src/test/net_tests.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "f36887fa47b42af60f8a06a3995baca7c73ca310",
    "original_commit_id": "88b6f85419b65122d5a4469a8585b276960bbb1e",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This line is left over from an earlier push and should be removed.\r\n\r\nOther than that, I think this PR was finished, provided missing coverage+context, and just needed some review begging or sales effort.",
    "created_at": "2020-10-02T13:07:35Z",
    "updated_at": "2020-10-02T14:43:05Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19951#discussion_r498809387",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19951",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498809387"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19951#discussion_r498809387"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19951"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498809387/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 25,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498810471",
    "pull_request_review_id": 501119805,
    "id": 498810471,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODgxMDQ3MQ==",
    "diff_hunk": "@@ -244,6 +245,25 @@ BOOST_AUTO_TEST_CASE(cnetaddr_basic)\n     BOOST_CHECK(!addr.IsBindAny());\n     BOOST_CHECK_EQUAL(addr.ToString(), \"1122:3344:5566:7788:9900:aabb:ccdd:eeff\");\n \n+    // IPv6, scoped/link-local. See https://tools.ietf.org/html/rfc4007\n+    // We support non-negative decimal integers (uint32_t) as zone id indices.\n+    // Test with a fairly-high value, e.g. 32, to avoid locally reserved ids.\n+    const std::string link_local{\"fe80::1\"};\n+    const std::string scoped_addr{link_local + \"%32\"};\n+    BOOST_REQUIRE(LookupHost(scoped_addr, addr, false));\n+    BOOST_REQUIRE(addr.IsValid());\n+    BOOST_REQUIRE(addr.IsIPv6());\n+    BOOST_CHECK(!addr.IsBindAny());\n+    const std::string addr_str{addr.ToString()};\n+    BOOST_CHECK(addr_str == scoped_addr || addr_str == \"fe80:0:0:0:0:0:0:1\");\n+    // The fallback case \"fe80:0:0:0:0:0:0:1\" is needed for macOS 10.14/10.15.",
    "path": "src/test/net_tests.cpp",
    "position": null,
    "original_position": 23,
    "commit_id": "f36887fa47b42af60f8a06a3995baca7c73ca310",
    "original_commit_id": "88b6f85419b65122d5a4469a8585b276960bbb1e",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Maybe \"macOS 10.14/10.15\" -> \"macOS 10.14+\"",
    "created_at": "2020-10-02T13:09:44Z",
    "updated_at": "2020-10-02T14:43:05Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19951#discussion_r498810471",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19951",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498810471"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19951#discussion_r498810471"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19951"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498810471/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 259,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611257547",
    "pull_request_review_id": 633062112,
    "id": 611257547,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTI1NzU0Nw==",
    "diff_hunk": "@@ -246,6 +246,25 @@ BOOST_AUTO_TEST_CASE(cnetaddr_basic)\n     BOOST_CHECK(!addr.IsBindAny());\n     BOOST_CHECK_EQUAL(addr.ToString(), \"1122:3344:5566:7788:9900:aabb:ccdd:eeff\");\n \n+    // IPv6, scoped/link-local. See https://tools.ietf.org/html/rfc4007\n+    // We support non-negative decimal integers (uint32_t) as zone id indices.\n+    // Test with a fairly-high value, e.g. 32, to avoid locally reserved ids.\n+    const std::string link_local{\"fe80::1\"};\n+    const std::string scoped_addr{link_local + \"%32\"};\n+    BOOST_REQUIRE(LookupHost(scoped_addr, addr, false));\n+    BOOST_REQUIRE(addr.IsValid());\n+    BOOST_REQUIRE(addr.IsIPv6());\n+    BOOST_CHECK(!addr.IsBindAny());\n+    const std::string addr_str{addr.ToString()};\n+    BOOST_CHECK(addr_str == scoped_addr || addr_str == \"fe80:0:0:0:0:0:0:1\");\n+    // The fallback case \"fe80:0:0:0:0:0:0:1\" is needed for macOS 10.14/10.15 and (probably) later.\n+    // Test that the delimiter \"%\" and default zone id of 0 can be omitted for the default scope.",
    "path": "src/test/net_tests.cpp",
    "position": 16,
    "original_position": 16,
    "commit_id": "f36887fa47b42af60f8a06a3995baca7c73ca310",
    "original_commit_id": "f36887fa47b42af60f8a06a3995baca7c73ca310",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I saw this check fail in a recent cirrus run `[previous releases, uses qt5 dev package and some depends packages] [unsigned char] [bionic]`:\r\n\r\nhttps://cirrus-ci.com/task/5950587750580224?logs=ci#L4679\r\n\r\nI'm restarting the test, will see if happens again.",
    "created_at": "2021-04-11T22:57:28Z",
    "updated_at": "2021-04-11T22:57:28Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19951#discussion_r611257547",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19951",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611257547"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19951#discussion_r611257547"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19951"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611257547/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 259,
    "original_start_line": 259,
    "start_side": "RIGHT",
    "line": 261,
    "original_line": 261,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611855776",
    "pull_request_review_id": 633840149,
    "id": 611855776,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTg1NTc3Ng==",
    "diff_hunk": "@@ -246,6 +246,25 @@ BOOST_AUTO_TEST_CASE(cnetaddr_basic)\n     BOOST_CHECK(!addr.IsBindAny());\n     BOOST_CHECK_EQUAL(addr.ToString(), \"1122:3344:5566:7788:9900:aabb:ccdd:eeff\");\n \n+    // IPv6, scoped/link-local. See https://tools.ietf.org/html/rfc4007\n+    // We support non-negative decimal integers (uint32_t) as zone id indices.\n+    // Test with a fairly-high value, e.g. 32, to avoid locally reserved ids.\n+    const std::string link_local{\"fe80::1\"};\n+    const std::string scoped_addr{link_local + \"%32\"};\n+    BOOST_REQUIRE(LookupHost(scoped_addr, addr, false));\n+    BOOST_REQUIRE(addr.IsValid());\n+    BOOST_REQUIRE(addr.IsIPv6());\n+    BOOST_CHECK(!addr.IsBindAny());\n+    const std::string addr_str{addr.ToString()};\n+    BOOST_CHECK(addr_str == scoped_addr || addr_str == \"fe80:0:0:0:0:0:0:1\");\n+    // The fallback case \"fe80:0:0:0:0:0:0:1\" is needed for macOS 10.14/10.15 and (probably) later.\n+    // Test that the delimiter \"%\" and default zone id of 0 can be omitted for the default scope.",
    "path": "src/test/net_tests.cpp",
    "position": 16,
    "original_position": 16,
    "commit_id": "f36887fa47b42af60f8a06a3995baca7c73ca310",
    "original_commit_id": "f36887fa47b42af60f8a06a3995baca7c73ca310",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks for reporting. It may be hitting a reserved id; have had it happen on occasion locally and bumping the `32` to a higher value resolved it. What happened after restarting?\r\n```cpp\r\n    // Test with a fairly-high value, e.g. 32, to avoid locally reserved ids.\r\n    const std::string link_local{\"fe80::1\"};\r\n    const std::string scoped_addr{link_local + \"%32\"};\r\n```\r\n",
    "created_at": "2021-04-12T18:22:08Z",
    "updated_at": "2021-04-12T18:22:08Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19951#discussion_r611855776",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19951",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611855776"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19951#discussion_r611855776"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19951"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611855776/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 259,
    "original_start_line": 259,
    "start_side": "RIGHT",
    "line": 261,
    "original_line": 261,
    "side": "RIGHT",
    "in_reply_to_id": 611257547
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611870353",
    "pull_request_review_id": 633859125,
    "id": 611870353,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTg3MDM1Mw==",
    "diff_hunk": "@@ -246,6 +246,25 @@ BOOST_AUTO_TEST_CASE(cnetaddr_basic)\n     BOOST_CHECK(!addr.IsBindAny());\n     BOOST_CHECK_EQUAL(addr.ToString(), \"1122:3344:5566:7788:9900:aabb:ccdd:eeff\");\n \n+    // IPv6, scoped/link-local. See https://tools.ietf.org/html/rfc4007\n+    // We support non-negative decimal integers (uint32_t) as zone id indices.\n+    // Test with a fairly-high value, e.g. 32, to avoid locally reserved ids.\n+    const std::string link_local{\"fe80::1\"};\n+    const std::string scoped_addr{link_local + \"%32\"};\n+    BOOST_REQUIRE(LookupHost(scoped_addr, addr, false));\n+    BOOST_REQUIRE(addr.IsValid());\n+    BOOST_REQUIRE(addr.IsIPv6());\n+    BOOST_CHECK(!addr.IsBindAny());\n+    const std::string addr_str{addr.ToString()};\n+    BOOST_CHECK(addr_str == scoped_addr || addr_str == \"fe80:0:0:0:0:0:0:1\");\n+    // The fallback case \"fe80:0:0:0:0:0:0:1\" is needed for macOS 10.14/10.15 and (probably) later.\n+    // Test that the delimiter \"%\" and default zone id of 0 can be omitted for the default scope.",
    "path": "src/test/net_tests.cpp",
    "position": 16,
    "original_position": 16,
    "commit_id": "f36887fa47b42af60f8a06a3995baca7c73ca310",
    "original_commit_id": "f36887fa47b42af60f8a06a3995baca7c73ca310",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks, interesting! (I don't know what a reserved id is and googling didn't seem to turn up anything helpful, so I'd be curious for any pointers.)\r\n\r\nBut test passed on restart so it is an intermittent issue like you suggested. Maybe the test can be written so the check is less strict and just depends on parsing behavior not OS behavior. But it doesn't seem too urgent if this is a known infrequent issue.",
    "created_at": "2021-04-12T18:45:26Z",
    "updated_at": "2021-04-12T18:45:27Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19951#discussion_r611870353",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19951",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611870353"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19951#discussion_r611870353"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19951"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611870353/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 259,
    "original_start_line": 259,
    "start_side": "RIGHT",
    "line": 261,
    "original_line": 261,
    "side": "RIGHT",
    "in_reply_to_id": 611257547
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613482942",
    "pull_request_review_id": 635955870,
    "id": 613482942,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMzQ4Mjk0Mg==",
    "diff_hunk": "@@ -246,6 +246,25 @@ BOOST_AUTO_TEST_CASE(cnetaddr_basic)\n     BOOST_CHECK(!addr.IsBindAny());\n     BOOST_CHECK_EQUAL(addr.ToString(), \"1122:3344:5566:7788:9900:aabb:ccdd:eeff\");\n \n+    // IPv6, scoped/link-local. See https://tools.ietf.org/html/rfc4007\n+    // We support non-negative decimal integers (uint32_t) as zone id indices.\n+    // Test with a fairly-high value, e.g. 32, to avoid locally reserved ids.\n+    const std::string link_local{\"fe80::1\"};\n+    const std::string scoped_addr{link_local + \"%32\"};\n+    BOOST_REQUIRE(LookupHost(scoped_addr, addr, false));\n+    BOOST_REQUIRE(addr.IsValid());\n+    BOOST_REQUIRE(addr.IsIPv6());\n+    BOOST_CHECK(!addr.IsBindAny());\n+    const std::string addr_str{addr.ToString()};\n+    BOOST_CHECK(addr_str == scoped_addr || addr_str == \"fe80:0:0:0:0:0:0:1\");\n+    // The fallback case \"fe80:0:0:0:0:0:0:1\" is needed for macOS 10.14/10.15 and (probably) later.\n+    // Test that the delimiter \"%\" and default zone id of 0 can be omitted for the default scope.",
    "path": "src/test/net_tests.cpp",
    "position": 16,
    "original_position": 16,
    "commit_id": "f36887fa47b42af60f8a06a3995baca7c73ca310",
    "original_commit_id": "f36887fa47b42af60f8a06a3995baca7c73ca310",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "My bad for ambiguous wording! `s/reserved id/id in use/`...will fix issue and wording.",
    "created_at": "2021-04-14T18:25:39Z",
    "updated_at": "2021-04-14T18:25:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19951#discussion_r613482942",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19951",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613482942"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19951#discussion_r613482942"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19951"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613482942/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 259,
    "original_start_line": 259,
    "start_side": "RIGHT",
    "line": 261,
    "original_line": 261,
    "side": "RIGHT",
    "in_reply_to_id": 611257547
  }
]