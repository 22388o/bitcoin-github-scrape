[
  {
    "sha": "0997019e7681efb00847a7246c15ac8f235128d8",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzowOTk3MDE5ZTc2ODFlZmIwMDg0N2E3MjQ2YzE1YWM4ZjIzNTEyOGQ4",
    "commit": {
      "author": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2021-02-16T18:22:49Z"
      },
      "committer": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2021-02-16T20:49:28Z"
      },
      "message": "Disallow sendtoaddress and sendmany when private keys disabled",
      "tree": {
        "sha": "2d7cd02d2747afa1abb642c8f68b6e58944b0656",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2d7cd02d2747afa1abb642c8f68b6e58944b0656"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0997019e7681efb00847a7246c15ac8f235128d8",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0997019e7681efb00847a7246c15ac8f235128d8",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/0997019e7681efb00847a7246c15ac8f235128d8",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0997019e7681efb00847a7246c15ac8f235128d8/comments",
    "author": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "3c9d9d21e195ccfb28353c14a9f38f5366c98c8e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3c9d9d21e195ccfb28353c14a9f38f5366c98c8e",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/3c9d9d21e195ccfb28353c14a9f38f5366c98c8e"
      }
    ],
    "stats": {
      "total": 8,
      "additions": 7,
      "deletions": 1
    },
    "files": [
      {
        "sha": "e385ccfff2208951e6b1a29aeb6142cdcd094f7b",
        "filename": "src/wallet/rpcwallet.cpp",
        "status": "modified",
        "additions": 7,
        "deletions": 1,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/0997019e7681efb00847a7246c15ac8f235128d8/src/wallet/rpcwallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/0997019e7681efb00847a7246c15ac8f235128d8/src/wallet/rpcwallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcwallet.cpp?ref=0997019e7681efb00847a7246c15ac8f235128d8",
        "patch": "@@ -400,6 +400,12 @@ UniValue SendMoney(CWallet* const pwallet, const CCoinControl &coin_control, std\n {\n     EnsureWalletIsUnlocked(pwallet);\n \n+    // This function is only used by sendtoaddress and sendmany.\n+    // This should always try to sign, if we don't have private keys, don't try to do anything here.\n+    if (pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS)) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error: Private keys are disabled for this wallet\");\n+    }\n+\n     // Shuffle recipient list\n     std::shuffle(recipients.begin(), recipients.end(), FastRandomContext());\n \n@@ -409,7 +415,7 @@ UniValue SendMoney(CWallet* const pwallet, const CCoinControl &coin_control, std\n     bilingual_str error;\n     CTransactionRef tx;\n     FeeCalculation fee_calc_out;\n-    bool fCreated = pwallet->CreateTransaction(recipients, tx, nFeeRequired, nChangePosRet, error, coin_control, fee_calc_out, !pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS));\n+    const bool fCreated = pwallet->CreateTransaction(recipients, tx, nFeeRequired, nChangePosRet, error, coin_control, fee_calc_out, true);\n     if (!fCreated) {\n         throw JSONRPCError(RPC_WALLET_INSUFFICIENT_FUNDS, error.original);\n     }"
      }
    ]
  },
  {
    "sha": "6bfbc97d716faad38c87603ac6049d222236d623",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo2YmZiYzk3ZDcxNmZhYWQzOGM4NzYwM2FjNjA0OWQyMjIyMzZkNjIz",
    "commit": {
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-02-16T19:41:21Z"
      },
      "committer": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2021-02-16T20:49:28Z"
      },
      "message": "test: disallow sendtoaddress/sendmany when private keys disabled",
      "tree": {
        "sha": "a0c88370c59a9c028b451153df352fd30853a3a3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a0c88370c59a9c028b451153df352fd30853a3a3"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6bfbc97d716faad38c87603ac6049d222236d623",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6bfbc97d716faad38c87603ac6049d222236d623",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/6bfbc97d716faad38c87603ac6049d222236d623",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6bfbc97d716faad38c87603ac6049d222236d623/comments",
    "author": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "0997019e7681efb00847a7246c15ac8f235128d8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0997019e7681efb00847a7246c15ac8f235128d8",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/0997019e7681efb00847a7246c15ac8f235128d8"
      }
    ],
    "stats": {
      "total": 7,
      "additions": 6,
      "deletions": 1
    },
    "files": [
      {
        "sha": "c345c382d03f0f75634b8ac47e323d2b0651e540",
        "filename": "test/functional/wallet_watchonly.py",
        "status": "modified",
        "additions": 6,
        "deletions": 1,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6bfbc97d716faad38c87603ac6049d222236d623/test/functional/wallet_watchonly.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6bfbc97d716faad38c87603ac6049d222236d623/test/functional/wallet_watchonly.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/wallet_watchonly.py?ref=6bfbc97d716faad38c87603ac6049d222236d623",
        "patch": "@@ -2,7 +2,7 @@\n # Copyright (c) 2018-2019 The Bitcoin Core developers\n # Distributed under the MIT software license, see the accompanying\n # file COPYING or http://www.opensource.org/licenses/mit-license.php.\n-\"\"\"Test createwallet arguments.\n+\"\"\"Test createwallet watchonly arguments.\n \"\"\"\n \n from test_framework.test_framework import BitcoinTestFramework\n@@ -49,6 +49,11 @@ def run_test(self):\n         assert_equal(len(wo_wallet.listtransactions()), 1)\n         assert_equal(wo_wallet.getbalance(include_watchonly=False), 0)\n \n+        self.log.info('Test sending from a watch-only wallet raises RPC error')\n+        msg = \"Error: Private keys are disabled for this wallet\"\n+        assert_raises_rpc_error(-4, msg, wo_wallet.sendtoaddress, a1, 0.1)\n+        assert_raises_rpc_error(-4, msg, wo_wallet.sendmany, amounts={a1: 0.1})\n+\n         self.log.info('Testing listreceivedbyaddress watch-only defaults')\n         result = wo_wallet.listreceivedbyaddress()\n         assert_equal(len(result), 1)"
      }
    ]
  }
]