meshcollider,2018-03-18T10:08:46Z,"Looks good, thanks for splitting it out. utACK https://github.com/bitcoin/bitcoin/pull/12713/commits/6ad2a13cfdd46899c28f21899e107ee7d4c07877",https://github.com/bitcoin/bitcoin/pull/12713#issuecomment-373986229,373986229,
MarcoFalke,2018-03-18T10:39:01Z,"utACK 6ad2a13cfdd46899c28f21899e107ee7d4c07877 (Also noting that `-a=no` sets a to true, now)",https://github.com/bitcoin/bitcoin/pull/12713#issuecomment-373987818,373987818,
eklitzke,2018-03-18T19:28:15Z,"Yeah I didn't want to add support for strings like ""no"" ""disabled"" etc. because I don't think there was ever an intention to support non-integer parameters in the first place. If we wanted to support that it's easy enough. You can also use `-noa`, both now and before.",https://github.com/bitcoin/bitcoin/pull/12713#issuecomment-374037341,374037341,
donaloconnor,2018-03-18T19:33:36Z,utACK https://github.com/bitcoin/bitcoin/commit/6ad2a13cfdd46899c28f21899e107ee7d4c07877,https://github.com/bitcoin/bitcoin/pull/12713#issuecomment-374037719,374037719,
jimpo,2018-03-18T22:24:24Z,ACK 6ad2a13cfdd46899c28f21899e107ee7d4c07877.,https://github.com/bitcoin/bitcoin/pull/12713#issuecomment-374057837,374057837,
MarcoFalke,2018-03-19T16:02:26Z,"<strike>Added ""refactoring"" label, since it doesn't change behavior</strike>\n\nutACK e944ec998fbd232b05ec9471ae6f19d1d32e0719\n\n\nWould you mind updating the OP, which ends up in the merge commit?",https://github.com/bitcoin/bitcoin/pull/12713#issuecomment-374265678,374265678,
jnewbery,2018-03-19T21:09:32Z,"> since it doesn't change behavior\n\nThis is a change in behaviour. If I take the changes to the unit test, but not the changes to util.cpp, the unit tests fail. If I take the changes to util.cpp, but not the change to wallet_resendwallettransactions.py, then wallet_resendwallettransactions.py fails.\n\nEDIT: the reason for this is that `atoi(""false"")` will return 0, so `-walletbroadcast=fals",https://github.com/bitcoin/bitcoin/pull/12713#issuecomment-374378215,374378215,
eklitzke,2018-03-20T07:55:28Z,"These are all easy to implement. I can make `-debuglogfile=0` log to a file named `0`, I can make it not log at all, I can special case `-nodebuglogfile` and have that not create a file, I can parse `false` as false or parse it as true, I can make a backwards compatible change and I can make a backwards incompatible change.\n\nI'm not really sure what to do, as this has gotten an unusual amount ",https://github.com/bitcoin/bitcoin/pull/12713#issuecomment-374506432,374506432,
ryanofsky,2018-03-20T09:40:48Z,"> I'm not really sure what to do, as this has gotten an unusual amount of debate for something that is frankly quite banal. I got three different suggestions for how to disable the flag in the original PR:\n\nFrom my reading of the feedback, I think if you go with `-nodebuglogfile` to disable logging, `-debuglogfile=<file>` to enable logging to a custom location, and `-debuglogfile` and `-debugl",https://github.com/bitcoin/bitcoin/pull/12713#issuecomment-374533662,374533662,
hkjn,2018-03-20T11:27:26Z,"ACK e944ec9.\n\nThis behavior as well as code seems slightly simpler than before, with more\ntests.\n\nI'll note we accept some pretty wacky combinations even after this change though,\nthat we may want to make errors in the future, at least for boolean options:\n\n```\n$ bitcoind -printtoconsole=0       # false\n$ bitcoind -noprinttoconsole       # false\n$ bitcoind -noprinttoconsole=n",https://github.com/bitcoin/bitcoin/pull/12713#issuecomment-374563792,374563792,
eklitzke,2018-03-20T17:29:46Z,@ryanofsky I will put up another version of this diff with that change.,https://github.com/bitcoin/bitcoin/pull/12713#issuecomment-374686659,374686659,
eklitzke,2018-03-20T19:23:56Z,"Handle arguments like `-nofoo` more explicitly.\n\nThis change keeps track of whether an option was passed with the `-no` semantics. This way in #12689 I can do something like:\n\n```c++\nif (gArgs.IsArgInverted(""-debuglogfile"")) {\n   ....\n}\n```\n\nto see if the debug log file should be disabled.\n\nI also removed some gratuitous boost and string copies.\n\n@jnewbery @MarcoFalke  ",https://github.com/bitcoin/bitcoin/pull/12713#issuecomment-374725138,374725138,
eklitzke,2018-03-21T05:41:54Z,"Updated for more consistent naming -- instead of ""negated"" and ""inverted"" I now always use the negated terminology.",https://github.com/bitcoin/bitcoin/pull/12713#issuecomment-374838690,374838690,
jnewbery,2018-03-21T15:27:16Z,"Concept ACK the behaviour change. Making only the exact string ""0"" evaluate to false seems like better behaviour to me.\n\nTested ACK the negated argument change.\n\nACK the variable name changes.\n\nTested ACK the WIN32 boost::algorithm -> std::transform change on linux (by commenting out the #ifdef WIN32 in `ArgsManager::ParseParameters()` and `IsSwitchChar()`).\n\nThis needs release not",https://github.com/bitcoin/bitcoin/pull/12713#issuecomment-374978703,374978703,
hkjn,2018-03-21T19:52:15Z,"Re-ACK 6b95d6b.\n\n+1 on documenting the change in behavior for flags in release notes.",https://github.com/bitcoin/bitcoin/pull/12713#issuecomment-375074076,375074076,
eklitzke,2018-03-22T01:41:37Z,"Last night I had the same realization that @ryanofsky pointed out here, which is that the change to `InterpretBoolArg()` is no longer necessary at all, as my printtoconsole change now uses the new `IsNegatedArg()` method (also originally suggested by Russ). I am just going to revert all of the unnecessary changes, and then this change won't change any backwards or forwards compatibility expectatio",https://github.com/bitcoin/bitcoin/pull/12713#issuecomment-375150705,375150705,
eklitzke,2018-03-22T02:33:04Z,"This branch has two commits:\n\n * The first is just a change to test_util.cpp with the new tests I added.\n * The second change adds the negated argument tracking, and more tests.\n\nThe reason this is two commits is to prove that the semantics of boolean option parsing is unchanged in this branch. I have tested both commits locally and both pass the test suite.\n\nThere are no longer any ",https://github.com/bitcoin/bitcoin/pull/12713#issuecomment-375159208,375159208,
jnewbery,2018-03-22T14:15:58Z,ugh. Why? The previous branch fixed undesirable behaviour and already had 4 ACKs.,https://github.com/bitcoin/bitcoin/pull/12713#issuecomment-375321566,375321566,
MarcoFalke,2018-03-22T14:42:09Z,"re-utACK ec1e226e33713366410e7d19a287be521169cd5f\n\nNeeds simple rebase, it seems.",https://github.com/bitcoin/bitcoin/pull/12713#issuecomment-375330793,375330793,
ryanofsky,2018-03-22T15:08:10Z,"> ugh. Why? The previous branch fixed undesirable behaviour and already had 4 ACKs.\n\nTo be fair, only 6 lines of code changed between the current and previous versions of this PR. \n3 lines were reverted in InterpretBool, 1 line was reverted in wallet_resendwallettransactions.py, and 2 GetBoolArg checks in the test changed from true to false.\n\nI don't think the previous behavior change wa",https://github.com/bitcoin/bitcoin/pull/12713#issuecomment-375340437,375340437,
jnewbery,2018-03-22T15:17:08Z,"Fine. Re-utACK ec1e226e33713366410e7d19a287be521169cd5f.\n\nAgree that documentation should be added when the `InterpretBool()` behaviour is changed.",https://github.com/bitcoin/bitcoin/pull/12713#issuecomment-375343868,375343868,
hkjn,2018-03-23T15:13:13Z,"ACK ec1e226.\n\nHere's the current interpretation of flags that I showed in my earlier comment (https://github.com/bitcoin/bitcoin/pull/12713#issuecomment-374563792), noting the differences from the earlier reviewed commit 6b95d6b:\n\n```\n$ bitcoind -printtoconsole=0       # false \n$ bitcoind -noprinttoconsole       # false \n$ bitcoind -noprinttoconsole=1     # false \n$ bitcoind -print",https://github.com/bitcoin/bitcoin/pull/12713#issuecomment-375697821,375697821,
MarcoFalke,2018-03-23T15:16:00Z,@eklitzke Mind doing the rebase?,https://github.com/bitcoin/bitcoin/pull/12713#issuecomment-375698827,375698827,
ryanofsky,2018-03-23T15:31:37Z,"@eklitzke, you may want to note in the PR description that this PR doesn't change current behavior, except to now log warnings if double-negative -nofoo=0 options are encountered. The changes that this PR does make are:\n\n- Adding a convenient way to check for disabled, non-boolean option pairs like `-debuglogfile=<path>`, `-nodebuglogfile`.\n- Cleaning up code and variable names\n- Adding lo",https://github.com/bitcoin/bitcoin/pull/12713#issuecomment-375704126,375704126,
jnewbery,2018-03-23T16:05:51Z,"Also:\n\n- removing a boost algorithm #include",https://github.com/bitcoin/bitcoin/pull/12713#issuecomment-375715580,375715580,
eklitzke,2018-03-28T05:48:59Z,"Rebased, tests passed locally for me. Travis has been kind of flaky recently so hopefully it gives me a green build. I've also updated the PR description.",https://github.com/bitcoin/bitcoin/pull/12713#issuecomment-376769277,376769277,
hkjn,2018-03-29T12:27:52Z,Re-utACK f7683cb.,https://github.com/bitcoin/bitcoin/pull/12713#issuecomment-377219361,377219361,
promag,2018-03-29T12:44:44Z,utACK f7683cb.,https://github.com/bitcoin/bitcoin/pull/12713#issuecomment-377223433,377223433,
MarcoFalke,2018-03-29T15:05:14Z,utACK f7683cba7b070b722a2e0641f4d1516112392ed6,https://github.com/bitcoin/bitcoin/pull/12713#issuecomment-377265516,377265516,
promag,2018-03-18T22:51:02Z,"Why not throw an error if it's a stupid value? IMHO, for instance, `-txindex=foo` should fail.",https://github.com/bitcoin/bitcoin/pull/12713#discussion_r175307783,175307783,src/util.cpp
MarcoFalke,2018-03-18T23:27:48Z,"Thinking more about this, with proper argument validation we might as well reject `false` as a value for a boolean argument. This was never supported, so it feels weird to special case it now.",https://github.com/bitcoin/bitcoin/pull/12713#discussion_r175309320,175309320,src/util.cpp
eklitzke,2018-03-19T04:31:50Z,"@promag Two reasons. First, such a change would not be backwards compatible (a minor point, see below). A better reason is that it enables the `-printtoconsole` change to have a way of disabling the debug log file without actually adding new command line arguments. In other words, I first test if `-debuglogfile` boolean parses as ""false"" (i.e. `-nodebuglogfile` or `-debuglogfile=0`), and if it's n",https://github.com/bitcoin/bitcoin/pull/12713#discussion_r175329947,175329947,src/util.cpp
ryanofsky,2018-03-19T14:20:45Z,"> I first test if -debuglogfile boolean parses as ""false"" (i.e. -nodebuglogfile or -debuglogfile=0), and if it's not false I re-parse it as a string.\n\nFeel free to discount this opinion, but if the option is `-debuglogfile=<filename>`, I would hope that `-debuglogfile=0` or `-debuglogfile=false` would just create log debug log files `0` or `false` respectively, instead of disabling logging.\n",https://github.com/bitcoin/bitcoin/pull/12713#discussion_r175450853,175450853,src/util.cpp
hkjn,2018-03-19T15:48:57Z,"+1 to what @ryanofsky says; if backwards-compatability is not a constraint, doing the least clever thing seems most consistent and likely to lead to the most maintainable code, and long term least confusion for users.\n\n(This PR seems like an improvement in readability of the argument parsing code, so any further simplification might be for another changeset.)",https://github.com/bitcoin/bitcoin/pull/12713#discussion_r175484649,175484649,src/util.cpp
MarcoFalke,2018-03-21T12:31:19Z,"I don't think we should expose this in the code base. Historically, `-nofoo` always implied `-foo=0`, so use cases within the code  base should always compare with the string `""0""` to check if foo was unset.\n\nYes, I know that that would forbid use cases, such as `-myfile=0`, but imo that is acceptable and desirable to keep previous behavior.\n\nEdit: This is bike shedding, so feel free to ig",https://github.com/bitcoin/bitcoin/pull/12713#discussion_r176064797,176064797,src/util.h
ryanofsky,2018-03-21T14:56:53Z,"> Historically, -nofoo always implied -foo=0, so use cases within the code base should always compare with the string ""0"" to check if foo was unset.\n\nThis is true for boolean options, and should still be true with this PR. I don't think it was ever historically true that specifying ""0"" or ""false"" for path type options would disable those options. At least this isn't the case currently for `-co",https://github.com/bitcoin/bitcoin/pull/12713#discussion_r176112611,176112611,src/util.h
ryanofsky,2018-03-21T15:38:19Z,"I think would be a little better to not change `InterpretBool` here. This seems making a backwards incompatible change in a PR that would otherwise be backwards compatible. If there is actually a reason to make a change here, it would be good to document it. I think the following table might summarize:\n\n| Argument        | Previous  | Current  |\n| --------------- | --------  | -------  |\n|",https://github.com/bitcoin/bitcoin/pull/12713#discussion_r176128984,176128984,src/util.cpp
ryanofsky,2018-03-21T15:53:43Z,"Instead of munging the string value, it seems like it would be slightly better just to avoid inserting new entries into the arg maps when `bool_val` is true. But this would require updating `Get*Arg` functions to check the `m_negated_args` map in addition to the normal maps, so I understand why you didn't do this here. And it's pretty much an internal implementation detail, so it could be saved fo",https://github.com/bitcoin/bitcoin/pull/12713#discussion_r176135152,176135152,src/util.cpp
MarcoFalke,2018-03-21T15:59:16Z,"I wanted to raise the point that we specifically check for the string ""0"" in some non-bool arguments to see if they are disabled. E.g. `-connect=0` or `-debug=0`. So in case someone were to use `IsArgNegated` for those, it would break it.\n\nAgain, only bike-shedding here, so please ignore.",https://github.com/bitcoin/bitcoin/pull/12713#discussion_r176137609,176137609,src/util.h
ryanofsky,2018-03-21T16:24:48Z,Great tests!,https://github.com/bitcoin/bitcoin/pull/12713#discussion_r176147182,176147182,src/test/util_tests.cpp
eklitzke,2018-03-22T01:03:05Z,"I agree with @ryanofsky that not being able to create a log file named ""0"" (or ""false"") is weird. Tracking negation makes the arguments more strongly typed in a sense. I also felt like it made my printtoconsole change a little easier to understand, because it removes the code that calls `GetBoolArg()` on a non-boolean field.",https://github.com/bitcoin/bitcoin/pull/12713#discussion_r176284555,176284555,src/util.h
