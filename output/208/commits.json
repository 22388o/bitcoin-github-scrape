[
  {
    "sha": "375f74c9d5160bbc49b56d6aefd6b57b32c1d3bc",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozNzVmNzRjOWQ1MTYwYmJjNDliNTZkNmFlZmQ2YjU3YjMyYzFkM2Jj",
    "commit": {
      "author": {
        "name": "Doug Huff",
        "email": "mith@jrbobdobbs.org",
        "date": "2011-05-08T00:32:05Z"
      },
      "committer": {
        "name": "Doug Huff",
        "email": "mith@jrbobdobbs.org",
        "date": "2011-05-08T00:32:05Z"
      },
      "message": "Add linux capabilities bounding set support.",
      "tree": {
        "sha": "48b9e08a420d5780850820f42948d1c65fe9197b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/48b9e08a420d5780850820f42948d1c65fe9197b"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/375f74c9d5160bbc49b56d6aefd6b57b32c1d3bc",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/375f74c9d5160bbc49b56d6aefd6b57b32c1d3bc",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/375f74c9d5160bbc49b56d6aefd6b57b32c1d3bc",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/375f74c9d5160bbc49b56d6aefd6b57b32c1d3bc/comments",
    "author": {
      "login": "jrmithdobbs",
      "id": 48147,
      "node_id": "MDQ6VXNlcjQ4MTQ3",
      "avatar_url": "https://avatars.githubusercontent.com/u/48147?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jrmithdobbs",
      "html_url": "https://github.com/jrmithdobbs",
      "followers_url": "https://api.github.com/users/jrmithdobbs/followers",
      "following_url": "https://api.github.com/users/jrmithdobbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jrmithdobbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jrmithdobbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jrmithdobbs/subscriptions",
      "organizations_url": "https://api.github.com/users/jrmithdobbs/orgs",
      "repos_url": "https://api.github.com/users/jrmithdobbs/repos",
      "events_url": "https://api.github.com/users/jrmithdobbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jrmithdobbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jrmithdobbs",
      "id": 48147,
      "node_id": "MDQ6VXNlcjQ4MTQ3",
      "avatar_url": "https://avatars.githubusercontent.com/u/48147?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jrmithdobbs",
      "html_url": "https://github.com/jrmithdobbs",
      "followers_url": "https://api.github.com/users/jrmithdobbs/followers",
      "following_url": "https://api.github.com/users/jrmithdobbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jrmithdobbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jrmithdobbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jrmithdobbs/subscriptions",
      "organizations_url": "https://api.github.com/users/jrmithdobbs/orgs",
      "repos_url": "https://api.github.com/users/jrmithdobbs/repos",
      "events_url": "https://api.github.com/users/jrmithdobbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jrmithdobbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "2fb1124b0fbbc039307f3697d7d550365c21916c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2fb1124b0fbbc039307f3697d7d550365c21916c",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/2fb1124b0fbbc039307f3697d7d550365c21916c"
      }
    ],
    "stats": {
      "total": 24,
      "additions": 24,
      "deletions": 0
    },
    "files": [
      {
        "sha": "11299ff97d08324d254c10fe093dafc6e33e9138",
        "filename": "init.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 0,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/375f74c9d5160bbc49b56d6aefd6b57b32c1d3bc/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/375f74c9d5160bbc49b56d6aefd6b57b32c1d3bc/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/init.cpp?ref=375f74c9d5160bbc49b56d6aefd6b57b32c1d3bc",
        "patch": "@@ -76,6 +76,11 @@ void HandleSIGTERM(int)\n int main(int argc, char* argv[])\n {\n     bool fRet = false;\n+\n+#ifdef USE_POSIX_CAPABILITIES\n+    cCap_lock();\n+#endif\n+\n     fRet = AppInit(argc, argv);\n \n     if (fRet && fDaemon)"
      },
      {
        "sha": "8528b1d327c386afe8e6f9e4901031e9cd604e1c",
        "filename": "init.h",
        "status": "modified",
        "additions": 7,
        "deletions": 0,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/375f74c9d5160bbc49b56d6aefd6b57b32c1d3bc/init.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/375f74c9d5160bbc49b56d6aefd6b57b32c1d3bc/init.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/init.h?ref=375f74c9d5160bbc49b56d6aefd6b57b32c1d3bc",
        "patch": "@@ -5,3 +5,10 @@\n void Shutdown(void* parg);\n bool AppInit(int argc, char* argv[]);\n bool AppInit2(int argc, char* argv[]);\n+\n+#ifdef USE_POSIX_CAPABILITIES\n+extern \"C\" {\n+    extern int cCap_lock(void);\n+}\n+#endif\n+"
      },
      {
        "sha": "cf347b92ff1d26944a2a40a21c63302f9e9f3d9b",
        "filename": "makefile.unix",
        "status": "modified",
        "additions": 12,
        "deletions": 0,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/375f74c9d5160bbc49b56d6aefd6b57b32c1d3bc/makefile.unix",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/375f74c9d5160bbc49b56d6aefd6b57b32c1d3bc/makefile.unix",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/makefile.unix?ref=375f74c9d5160bbc49b56d6aefd6b57b32c1d3bc",
        "patch": "@@ -12,6 +12,10 @@ USE_UPNP:=0\n \n DEFS=-DNOPCH -DFOURWAYSSE2 -DUSE_SSL\n \n+ifdef USE_POSIX_CAPABILITIES\n+\tDEFS += -DUSE_POSIX_CAPABILITIES\n+endif\n+\n # for boost 1.37, add -mt to the boost libraries\n LIBS= \\\n  -Wl,-Bstatic \\\n@@ -28,6 +32,10 @@ ifdef USE_UPNP\n \tDEFS += -DUSE_UPNP=$(USE_UPNP)\n endif\n \n+ifdef USE_POSIX_CAPABILITIES\n+\tLIBS += -l cap\n+endif\n+\n LIBS+= \\\n  -Wl,-Bdynamic \\\n    -l gthread-2.0 \\\n@@ -53,6 +61,10 @@ OBJS= \\\n     cryptopp/obj/sha.o \\\n     cryptopp/obj/cpu.o\n \n+ifdef USE_POSIX_CAPABILITIES\n+\tOBJS += obj/cap.o\n+endif\n+\n \n all: bitcoin\n "
      }
    ]
  },
  {
    "sha": "9fae10cf6c4eef3b4059d163f2b5c5e775b1e747",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5ZmFlMTBjZjZjNGVlZjNiNDA1OWQxNjNmMmI1YzVlNzc1YjFlNzQ3",
    "commit": {
      "author": {
        "name": "Doug Huff",
        "email": "mith@jrbobdobbs.org",
        "date": "2011-05-08T00:32:23Z"
      },
      "committer": {
        "name": "Doug Huff",
        "email": "mith@jrbobdobbs.org",
        "date": "2011-05-08T00:32:23Z"
      },
      "message": "Add linux capabilities bounding set support.",
      "tree": {
        "sha": "b1b6a655a078329e9980f54140f194692ca88663",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b1b6a655a078329e9980f54140f194692ca88663"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9fae10cf6c4eef3b4059d163f2b5c5e775b1e747",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9fae10cf6c4eef3b4059d163f2b5c5e775b1e747",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/9fae10cf6c4eef3b4059d163f2b5c5e775b1e747",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9fae10cf6c4eef3b4059d163f2b5c5e775b1e747/comments",
    "author": {
      "login": "jrmithdobbs",
      "id": 48147,
      "node_id": "MDQ6VXNlcjQ4MTQ3",
      "avatar_url": "https://avatars.githubusercontent.com/u/48147?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jrmithdobbs",
      "html_url": "https://github.com/jrmithdobbs",
      "followers_url": "https://api.github.com/users/jrmithdobbs/followers",
      "following_url": "https://api.github.com/users/jrmithdobbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jrmithdobbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jrmithdobbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jrmithdobbs/subscriptions",
      "organizations_url": "https://api.github.com/users/jrmithdobbs/orgs",
      "repos_url": "https://api.github.com/users/jrmithdobbs/repos",
      "events_url": "https://api.github.com/users/jrmithdobbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jrmithdobbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jrmithdobbs",
      "id": 48147,
      "node_id": "MDQ6VXNlcjQ4MTQ3",
      "avatar_url": "https://avatars.githubusercontent.com/u/48147?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jrmithdobbs",
      "html_url": "https://github.com/jrmithdobbs",
      "followers_url": "https://api.github.com/users/jrmithdobbs/followers",
      "following_url": "https://api.github.com/users/jrmithdobbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jrmithdobbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jrmithdobbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jrmithdobbs/subscriptions",
      "organizations_url": "https://api.github.com/users/jrmithdobbs/orgs",
      "repos_url": "https://api.github.com/users/jrmithdobbs/repos",
      "events_url": "https://api.github.com/users/jrmithdobbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jrmithdobbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "375f74c9d5160bbc49b56d6aefd6b57b32c1d3bc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/375f74c9d5160bbc49b56d6aefd6b57b32c1d3bc",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/375f74c9d5160bbc49b56d6aefd6b57b32c1d3bc"
      }
    ],
    "stats": {
      "total": 100,
      "additions": 100,
      "deletions": 0
    },
    "files": [
      {
        "sha": "5b6d6aa5fe18a9df73a28756255e362a36443fd1",
        "filename": "cap.cpp",
        "status": "added",
        "additions": 100,
        "deletions": 0,
        "changes": 100,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9fae10cf6c4eef3b4059d163f2b5c5e775b1e747/cap.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9fae10cf6c4eef3b4059d163f2b5c5e775b1e747/cap.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/cap.cpp?ref=9fae10cf6c4eef3b4059d163f2b5c5e775b1e747",
        "patch": "@@ -0,0 +1,100 @@\n+/* This is currently only known to be implemented on linux. *\n+ * enable by defining USE_POSIX_CAPABILITIES at build time. *\n+ * You will then need to either make the bitcoin/bitcoind   *\n+ * binary setuid root (bad) or setcap setpcap=eip; (good)   *\n+ *                                                          *\n+ * Solaris may have an implementation but this may be linux *\n+ * 2.6.32+ specific. Sorry. You will need libcap2.          */\n+\n+#ifdef USE_POSIX_CAPABILITIES\n+\n+#include <sys/capability.h>\n+#include <sys/prctl.h>\n+#include <sys/types.h>\n+\n+// This is current as of linux 2.6.38.5\n+#ifndef CAP_LAST_CAP\n+#define CAP_LAST_CAP CAP_AUDIT_CONTROL\n+#endif\n+\n+// These defines should be removable once there is a working autotools that can\n+// find kernel headers. linux/securebits.h\n+//#include <linux/securebits.h>\n+/* !_LINUX_SECUREBITS_H */\n+#ifndef _LINUX_SECUREBITS_H\n+#define _LINUX_SECUREBITS_H 1\n+#define SECUREBITS_DEFAULT 0x00000000\n+#define SECURE_NOROOT\t\t\t0\n+#define SECURE_NOROOT_LOCKED\t\t1  /* make bit-0 immutable */\n+#define SECURE_NO_SETUID_FIXUP\t\t2\n+#define SECURE_NO_SETUID_FIXUP_LOCKED\t3  /* make bit-2 immutable */\n+#define SECURE_KEEP_CAPS\t\t4\n+#define SECURE_KEEP_CAPS_LOCKED\t\t5  /* make bit-4 immutable */\n+#define issecure_mask(X)\t(1 << (X))\n+#define issecure(X)\t\t(issecure_mask(X) & current_cred_xxx(securebits))\n+#define SECURE_ALL_BITS\t\t(issecure_mask(SECURE_NOROOT) | \\\n+\t\t\t\t issecure_mask(SECURE_NO_SETUID_FIXUP) | \\\n+\t\t\t\t issecure_mask(SECURE_KEEP_CAPS))\n+#define SECURE_ALL_LOCKS\t(SECURE_ALL_BITS << 1)\n+#endif /* !_LINUX_SECUREBITS_H */\n+\n+#ifdef __cplusplus\n+extern \"C\" {\n+#endif\n+\n+extern int cCap_lock(void);\n+int cCap_clear_bnd(__u32 bnd);\n+\n+int cCap_lock(void) {\n+  int error = 0;\n+  cap_flag_value_t check;\n+  cap_t state, newstate;\n+\n+  if ((state = cap_get_proc()) == NULL)\n+    return -1;\n+\n+  if ((newstate = cap_dup(state)) != NULL)\n+    if (cap_clear(newstate) != 0)\n+      return -1;\n+\n+  /* If we have CAP_SETPCAP clear all capabilities and the bounding set. */\n+  if(\n+      (error += cap_get_flag(state,CAP_SETPCAP,CAP_EFFECTIVE,&check) == 0 )\n+      && check == CAP_SET\n+    ) {\n+\n+    error += prctl(PR_SET_SECUREBITS,\n+        SECURE_NO_SETUID_FIXUP|SECURE_NO_SETUID_FIXUP_LOCKED\n+        |SECURE_NOROOT|SECURE_NOROOT_LOCKED\n+        );\n+    error += cCap_clear_bnd(0);\n+    error += cap_set_proc(newstate);\n+  }\n+\n+  cap_free(newstate);\n+  cap_free(state);\n+\n+  return error;\n+}\n+\n+int cCap_clear_bnd(__u32 bnd) {\n+  unsigned j;\n+  int error = 0;\n+\n+  /* Remove all capabilities that are not in\n+   * bnd from bounding set! */\n+  for(j=0;j <= CAP_LAST_CAP; j++) {\n+    if (prctl(PR_CAPBSET_READ, j) >=0) {\n+      if(!(bnd & CAP_TO_MASK(j)))\n+        error += prctl(PR_CAPBSET_DROP,j);\n+    }\n+  }\n+  return error;\n+}\n+\n+#ifdef __cplusplus\n+}\n+#endif\n+\n+#endif\n+"
      }
    ]
  },
  {
    "sha": "d9512a215146de899d7126aac2df285c90eb07fc",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpkOTUxMmEyMTUxNDZkZTg5OWQ3MTI2YWFjMmRmMjg1YzkwZWIwN2Zj",
    "commit": {
      "author": {
        "name": "Doug Huff",
        "email": "mith@jrbobdobbs.org",
        "date": "2011-05-09T09:44:56Z"
      },
      "committer": {
        "name": "Doug Huff",
        "email": "mith@jrbobdobbs.org",
        "date": "2011-05-09T09:44:56Z"
      },
      "message": "If connecting to 127.0.0.1 try to write wallet backup to caller's cwd.",
      "tree": {
        "sha": "1bb4bf2257f67a1f43f659b8fb559edfc4a0c642",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1bb4bf2257f67a1f43f659b8fb559edfc4a0c642"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d9512a215146de899d7126aac2df285c90eb07fc",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d9512a215146de899d7126aac2df285c90eb07fc",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/d9512a215146de899d7126aac2df285c90eb07fc",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d9512a215146de899d7126aac2df285c90eb07fc/comments",
    "author": {
      "login": "jrmithdobbs",
      "id": 48147,
      "node_id": "MDQ6VXNlcjQ4MTQ3",
      "avatar_url": "https://avatars.githubusercontent.com/u/48147?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jrmithdobbs",
      "html_url": "https://github.com/jrmithdobbs",
      "followers_url": "https://api.github.com/users/jrmithdobbs/followers",
      "following_url": "https://api.github.com/users/jrmithdobbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jrmithdobbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jrmithdobbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jrmithdobbs/subscriptions",
      "organizations_url": "https://api.github.com/users/jrmithdobbs/orgs",
      "repos_url": "https://api.github.com/users/jrmithdobbs/repos",
      "events_url": "https://api.github.com/users/jrmithdobbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jrmithdobbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jrmithdobbs",
      "id": 48147,
      "node_id": "MDQ6VXNlcjQ4MTQ3",
      "avatar_url": "https://avatars.githubusercontent.com/u/48147?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jrmithdobbs",
      "html_url": "https://github.com/jrmithdobbs",
      "followers_url": "https://api.github.com/users/jrmithdobbs/followers",
      "following_url": "https://api.github.com/users/jrmithdobbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jrmithdobbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jrmithdobbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jrmithdobbs/subscriptions",
      "organizations_url": "https://api.github.com/users/jrmithdobbs/orgs",
      "repos_url": "https://api.github.com/users/jrmithdobbs/repos",
      "events_url": "https://api.github.com/users/jrmithdobbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jrmithdobbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "9fae10cf6c4eef3b4059d163f2b5c5e775b1e747",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9fae10cf6c4eef3b4059d163f2b5c5e775b1e747",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/9fae10cf6c4eef3b4059d163f2b5c5e775b1e747"
      }
    ],
    "stats": {
      "total": 7,
      "additions": 7,
      "deletions": 0
    },
    "files": [
      {
        "sha": "a3de8814f6b82e9200c7f70b411c32bcd9f33966",
        "filename": "rpc.cpp",
        "status": "modified",
        "additions": 7,
        "deletions": 0,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d9512a215146de899d7126aac2df285c90eb07fc/rpc.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d9512a215146de899d7126aac2df285c90eb07fc/rpc.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/rpc.cpp?ref=d9512a215146de899d7126aac2df285c90eb07fc",
        "patch": "@@ -2097,6 +2097,13 @@ int CommandLineRPC(int argc, char *argv[])\n             params[1] = v.get_obj();\n         }\n         if (strMethod == \"sendmany\"                && n > 2) ConvertTo<boost::int64_t>(params[2]);\n+        // Handle backupwallet special case in caller.\n+        if (strMethod == \"backupwallet\")\n+            if (GetArg(\"-rpcconnect\",\"127.0.0.1\") == \"127.0.0.1\")\n+                if (!(params[0].get_str()[0] == '/')) \n+                {\n+                    params[0] = boost::filesystem::current_path().string() + \"/\" + params[0].get_str();\n+                }\n \n         // Execute\n         Object reply = CallRPC(strMethod, params);"
      }
    ]
  }
]