[
  {
    "sha": "cdf3e03a723b1a0242199672878caf1543ba8124",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpjZGYzZTAzYTcyM2IxYTAyNDIxOTk2NzI4NzhjYWYxNTQzYmE4MTI0",
    "commit": {
      "author": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@gmail.com",
        "date": "2018-01-17T12:20:21Z"
      },
      "committer": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@gmail.com",
        "date": "2018-01-18T09:24:18Z"
      },
      "message": "wallet: Deprecate addwitnessaddress\n\nNow that segwit is natively supported by the wallet, deprecate the hack `addwitnessaddress`.",
      "tree": {
        "sha": "d13952acf9acc384ebf0b89c0beb6e610d4a5556",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d13952acf9acc384ebf0b89c0beb6e610d4a5556"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/cdf3e03a723b1a0242199672878caf1543ba8124",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/cdf3e03a723b1a0242199672878caf1543ba8124",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/cdf3e03a723b1a0242199672878caf1543ba8124",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/cdf3e03a723b1a0242199672878caf1543ba8124/comments",
    "author": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "c7978be899646194b6abc5b34a7f6a3311490033",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c7978be899646194b6abc5b34a7f6a3311490033",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/c7978be899646194b6abc5b34a7f6a3311490033"
      }
    ],
    "stats": {
      "total": 27,
      "additions": 18,
      "deletions": 9
    },
    "files": [
      {
        "sha": "bf4a72557474de2236496e82862b7cd3953e2f74",
        "filename": "doc/release-notes.md",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/cdf3e03a723b1a0242199672878caf1543ba8124/doc/release-notes.md",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/cdf3e03a723b1a0242199672878caf1543ba8124/doc/release-notes.md",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/doc/release-notes.md?ref=cdf3e03a723b1a0242199672878caf1543ba8124",
        "patch": "@@ -97,6 +97,8 @@ Low-level RPC changes\n   * `getwalletinfo`\n   * `getmininginfo`\n - The wallet RPC `getreceivedbyaddress` will return an error if called with an address not in the wallet.\n+- The wallet RPC `addwitnessaddress` was deprecated and will be removed in version 0.17,\n+  set the `address_type` argument of `getnewaddress`, or option `-addresstype=[bech32|p2sh-segwit]` instead.\n \n Changed command-line options\n -----------------------------"
      },
      {
        "sha": "ad0ebcce22d8f168e6ce19e5915639489348ec47",
        "filename": "src/wallet/rpcwallet.cpp",
        "status": "modified",
        "additions": 9,
        "deletions": 2,
        "changes": 11,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/cdf3e03a723b1a0242199672878caf1543ba8124/src/wallet/rpcwallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/cdf3e03a723b1a0242199672878caf1543ba8124/src/wallet/rpcwallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcwallet.cpp?ref=cdf3e03a723b1a0242199672878caf1543ba8124",
        "patch": "@@ -1285,7 +1285,8 @@ UniValue addwitnessaddress(const JSONRPCRequest& request)\n     if (request.fHelp || request.params.size() < 1 || request.params.size() > 2)\n     {\n         std::string msg = \"addwitnessaddress \\\"address\\\" ( p2sh )\\n\"\n-            \"\\nAdd a witness address for a script (with pubkey or redeemscript known). Requires a new wallet backup.\\n\"\n+            \"\\nDEPRECATED: set the address_type argument of getnewaddress, or option -addresstype=[bech32|p2sh-segwit] instead.\\n\"\n+            \"Add a witness address for a script (with pubkey or redeemscript known). Requires a new wallet backup.\\n\"\n             \"It returns the witness script.\\n\"\n \n             \"\\nArguments:\\n\"\n@@ -1299,6 +1300,12 @@ UniValue addwitnessaddress(const JSONRPCRequest& request)\n         throw std::runtime_error(msg);\n     }\n \n+    if (!IsDeprecatedRPCEnabled(\"addwitnessaddress\")) {\n+        throw JSONRPCError(RPC_METHOD_DEPRECATED, \"addwitnessaddress is deprecated and will be fully removed in v0.17. \"\n+            \"To use addwitnessaddress in v0.16, restart bitcoind with -deprecatedrpc=addwitnessaddress.\\n\"\n+            \"Projects should transition to using the address_type argument of getnewaddress, or option -addresstype=[bech32|p2sh-segwit] instead.\\n\");\n+    }\n+\n     {\n         LOCK(cs_main);\n         if (!IsWitnessEnabled(chainActive.Tip(), Params().GetConsensus()) && !gArgs.GetBoolArg(\"-walletprematurewitness\", false)) {\n@@ -3479,7 +3486,7 @@ static const CRPCCommand commands[] =\n     { \"wallet\",             \"abandontransaction\",       &abandontransaction,       {\"txid\"} },\n     { \"wallet\",             \"abortrescan\",              &abortrescan,              {} },\n     { \"wallet\",             \"addmultisigaddress\",       &addmultisigaddress,       {\"nrequired\",\"keys\",\"account\"} },\n-    { \"wallet\",             \"addwitnessaddress\",        &addwitnessaddress,        {\"address\",\"p2sh\"} },\n+    { \"hidden\",             \"addwitnessaddress\",        &addwitnessaddress,        {\"address\",\"p2sh\"} },\n     { \"wallet\",             \"backupwallet\",             &backupwallet,             {\"destination\"} },\n     { \"wallet\",             \"bumpfee\",                  &bumpfee,                  {\"txid\", \"options\"} },\n     { \"wallet\",             \"dumpprivkey\",              &dumpprivkey,              {\"address\"}  },"
      },
      {
        "sha": "2cd4127854ec518b8cbaad24539ad51d092fd75d",
        "filename": "test/functional/bumpfee.py",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/cdf3e03a723b1a0242199672878caf1543ba8124/test/functional/bumpfee.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/cdf3e03a723b1a0242199672878caf1543ba8124/test/functional/bumpfee.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/bumpfee.py?ref=cdf3e03a723b1a0242199672878caf1543ba8124",
        "patch": "@@ -33,7 +33,7 @@ class BumpFeeTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.num_nodes = 2\n         self.setup_clean_chain = True\n-        self.extra_args = [[\"-prematurewitness\", \"-walletprematurewitness\", \"-walletrbf={}\".format(i)]\n+        self.extra_args = [[\"-prematurewitness\", \"-walletprematurewitness\", \"-deprecatedrpc=addwitnessaddress\", \"-walletrbf={}\".format(i)]\n                            for i in range(self.num_nodes)]\n \n     def run_test(self):"
      },
      {
        "sha": "cbdcfdcf5fdd75b491788e23f767a8fbf3cb8b6b",
        "filename": "test/functional/nulldummy.py",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/cdf3e03a723b1a0242199672878caf1543ba8124/test/functional/nulldummy.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/cdf3e03a723b1a0242199672878caf1543ba8124/test/functional/nulldummy.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/nulldummy.py?ref=cdf3e03a723b1a0242199672878caf1543ba8124",
        "patch": "@@ -42,7 +42,7 @@ def set_test_params(self):\n         self.setup_clean_chain = True\n         # This script tests NULLDUMMY activation, which is part of the 'segwit' deployment, so we go through\n         # normal segwit activation here (and don't use the default always-on behaviour).\n-        self.extra_args = [['-whitelist=127.0.0.1', '-walletprematurewitness', '-vbparams=segwit:0:999999999999', '-addresstype=legacy']]\n+        self.extra_args = [['-whitelist=127.0.0.1', '-walletprematurewitness', '-vbparams=segwit:0:999999999999', '-addresstype=legacy', \"-deprecatedrpc=addwitnessaddress\"]]\n \n     def run_test(self):\n         self.address = self.nodes[0].getnewaddress()"
      },
      {
        "sha": "d9f461a0499379cfc92c3701335d69721ca4ab2b",
        "filename": "test/functional/p2p-compactblocks.py",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/cdf3e03a723b1a0242199672878caf1543ba8124/test/functional/p2p-compactblocks.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/cdf3e03a723b1a0242199672878caf1543ba8124/test/functional/p2p-compactblocks.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/p2p-compactblocks.py?ref=cdf3e03a723b1a0242199672878caf1543ba8124",
        "patch": "@@ -95,7 +95,7 @@ def set_test_params(self):\n         self.num_nodes = 2\n         # This test was written assuming SegWit is activated using BIP9 at height 432 (3x confirmation window).\n         # TODO: Rewrite this test to support SegWit being always active.\n-        self.extra_args = [[\"-vbparams=segwit:0:0\"], [\"-vbparams=segwit:0:999999999999\", \"-txindex\"]]\n+        self.extra_args = [[\"-vbparams=segwit:0:0\"], [\"-vbparams=segwit:0:999999999999\", \"-txindex\", \"-deprecatedrpc=addwitnessaddress\"]]\n         self.utxos = []\n \n     def build_block_on_tip(self, node, segwit=False):"
      },
      {
        "sha": "67cca5f1e72798c2ec11962582f700e4a66fb555",
        "filename": "test/functional/segwit.py",
        "status": "modified",
        "additions": 3,
        "deletions": 3,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/cdf3e03a723b1a0242199672878caf1543ba8124/test/functional/segwit.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/cdf3e03a723b1a0242199672878caf1543ba8124/test/functional/segwit.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/segwit.py?ref=cdf3e03a723b1a0242199672878caf1543ba8124",
        "patch": "@@ -40,9 +40,9 @@ def set_test_params(self):\n         self.setup_clean_chain = True\n         self.num_nodes = 3\n         # This test tests SegWit both pre and post-activation, so use the normal BIP9 activation.\n-        self.extra_args = [[\"-walletprematurewitness\", \"-rpcserialversion=0\", \"-vbparams=segwit:0:999999999999\", \"-addresstype=legacy\"],\n-                           [\"-blockversion=4\", \"-promiscuousmempoolflags=517\", \"-prematurewitness\", \"-walletprematurewitness\", \"-rpcserialversion=1\", \"-vbparams=segwit:0:999999999999\", \"-addresstype=legacy\"],\n-                           [\"-blockversion=536870915\", \"-promiscuousmempoolflags=517\", \"-prematurewitness\", \"-walletprematurewitness\", \"-vbparams=segwit:0:999999999999\", \"-addresstype=legacy\"]]\n+        self.extra_args = [[\"-walletprematurewitness\", \"-rpcserialversion=0\", \"-vbparams=segwit:0:999999999999\", \"-addresstype=legacy\", \"-deprecatedrpc=addwitnessaddress\"],\n+                           [\"-blockversion=4\", \"-promiscuousmempoolflags=517\", \"-prematurewitness\", \"-walletprematurewitness\", \"-rpcserialversion=1\", \"-vbparams=segwit:0:999999999999\", \"-addresstype=legacy\", \"-deprecatedrpc=addwitnessaddress\"],\n+                           [\"-blockversion=536870915\", \"-promiscuousmempoolflags=517\", \"-prematurewitness\", \"-walletprematurewitness\", \"-vbparams=segwit:0:999999999999\", \"-addresstype=legacy\", \"-deprecatedrpc=addwitnessaddress\"]]\n \n     def setup_network(self):\n         super().setup_network()"
      },
      {
        "sha": "a1a4f25921de522cd44cb3b9e7ce0781ab110361",
        "filename": "test/functional/wallet-dump.py",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/cdf3e03a723b1a0242199672878caf1543ba8124/test/functional/wallet-dump.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/cdf3e03a723b1a0242199672878caf1543ba8124/test/functional/wallet-dump.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/wallet-dump.py?ref=cdf3e03a723b1a0242199672878caf1543ba8124",
        "patch": "@@ -69,7 +69,7 @@ def read_dump(file_name, addrs, script_addrs, hd_master_addr_old):\n class WalletDumpTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.num_nodes = 1\n-        self.extra_args = [[\"-keypool=90\", \"-addresstype=legacy\"]]\n+        self.extra_args = [[\"-keypool=90\", \"-addresstype=legacy\", \"-deprecatedrpc=addwitnessaddress\"]]\n \n     def setup_network(self, split=False):\n         # Use 1 minute timeout because the initial getnewaddress RPC can take"
      }
    ]
  }
]