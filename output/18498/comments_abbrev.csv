DrahtBot,2020-04-01 17:10:57,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #18726 (test: check misbehavior more independently in p2p_filter.py by robot-visions)\n\nIf you consider this pull request",https://github.com/bitcoin/bitcoin/pull/18498#issuecomment-607376667,607376667,
jonatack,2020-04-21 13:41:56,Rebased.,https://github.com/bitcoin/bitcoin/pull/18498#issuecomment-617187756,617187756,
MarcoFalke,2020-04-23 18:32:56,"Slightly tend to NACK. This is making the tests harder to read (a reader will ask themselves why some calls have the ping disabled explicitly and the call in the very next line does not have it disabled). Also, it is making the tests harder to write or change, because forgetting to update one of the disabled pings to be enabled, when needed, can easily be forgotten. There is no infrastructure in p",https://github.com/bitcoin/bitcoin/pull/18498#issuecomment-618576134,618576134,
jonatack,2020-04-24 11:31:54,"Thanks for the feeback. Below I'll try to summarize the different aspects as I (correctly or not) see them.\n\n#### Full connections by default instead of partial connections\n\n`add_p2p_connection` was added in March 2017 with 5e5725cc2b5, which means that for the past 3 years the functional test suite using this method was running without forcing full p2p connections (which were made by call",https://github.com/bitcoin/bitcoin/pull/18498#issuecomment-618957581,618957581,
jonatack,2020-04-24 11:38:15,"Question: what changed since March 2017? An increasing number of spurious (maddening, to be sure) CI failures?",https://github.com/bitcoin/bitcoin/pull/18498#issuecomment-618959922,618959922,
MarcoFalke,2020-04-24 11:44:29,"Yes, we have a lot of spurious ci failures. No one reports them as bugs or even tries to fix them (except me). Everyone blindly hits the restart button on travis and it is up to me to beat them and save the logs locally. We have bugs reported by travis that crash the whole node, when a miner submits a block: #18742\n\nI don't think making a handful of tests faster by a few microseconds is going ",https://github.com/bitcoin/bitcoin/pull/18498#issuecomment-618962257,618962257,
MarcoFalke,2020-04-24 11:50:47,"Btw, calling it ""partial connection"" implies that this is a different kind of connection or something that the caller can exploit for a test in some way. This is not true. The verack is already in flight and it can't be erased from the wire or changed in any way. If the caller wanted to exploit that intermittent state for a test, the result would be racy. Races are the number one reason that our t",https://github.com/bitcoin/bitcoin/pull/18498#issuecomment-618964519,618964519,
jonatack,2020-04-24 11:55:53,Thanks for the feedback. I empathize with the burden of the CI failures you're dealing with and the need for robust tests and benchmarks. Robust > speed. Will think about this more.,https://github.com/bitcoin/bitcoin/pull/18498#issuecomment-618966386,618966386,
vasild,2020-04-01 15:23:27,"Wouldn't it be confusing to have `add_p2p_connection(..., wait_for_verack=False, sync_with_ping=True)` **not** execute `sync_with_ping()`?",https://github.com/bitcoin/bitcoin/pull/18498#discussion_r401700973,401700973,test/functional/test_framework/test_node.py
jonatack,2020-04-02 14:14:40,"Thanks for reviewing! I see your point, but I don't see when we would want a connection like that and AFAIK the test suite doesn't currently have a use for it.",https://github.com/bitcoin/bitcoin/pull/18498#discussion_r402346525,402346525,test/functional/test_framework/test_node.py
MarcoFalke,2020-04-02 22:37:29,"Instead of explaining how to opt out, it would help to explain *why* someone would want to opt out. Is this a performance improvement? I yes, then it should be quantified.\n\nOtherwise it seem like added code-complexity that makes tests more fragile and harder to read, write and maintain.",https://github.com/bitcoin/bitcoin/pull/18498#discussion_r402635947,402635947,test/functional/test_framework/test_node.py
jonatack,2020-04-03 13:39:19,Good idea. Pushed a new version.,https://github.com/bitcoin/bitcoin/pull/18498#discussion_r403011756,403011756,test/functional/test_framework/test_node.py
robot-visions,2020-04-23 17:48:00,"Nit: As a follow-up to @vasild 's comment, would it make sense to consider one of the following, to prevent possible confusion in the future:\n\n- Raise an assertion error if `wait_for_verack=False, sync_with_ping=True`\n- Instead of passing two boolean parameters, pass a single parameter like `sync_behavior` which can take in three values `NONE`, `VERACK_ONLY`, `VERACK_AND_PING`?",https://github.com/bitcoin/bitcoin/pull/18498#discussion_r413999984,413999984,test/functional/test_framework/test_node.py
