[
  {
    "sha": "cae686d31e18a68826ef61931ae8379fe9461d7b",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpjYWU2ODZkMzFlMThhNjg4MjZlZjYxOTMxYWU4Mzc5ZmU5NDYxZDdi",
    "commit": {
      "author": {
        "name": "kjj2",
        "email": "github@jerviss.org",
        "date": "2012-11-03T14:58:41Z"
      },
      "committer": {
        "name": "kjj2",
        "email": "github@jerviss.org",
        "date": "2012-11-03T15:07:57Z"
      },
      "message": "Add -walletnotify to call an external script on wallet transactions",
      "tree": {
        "sha": "4615748a180ad35155eeb01d5577dc35a2dcf924",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4615748a180ad35155eeb01d5577dc35a2dcf924"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/cae686d31e18a68826ef61931ae8379fe9461d7b",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/cae686d31e18a68826ef61931ae8379fe9461d7b",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/cae686d31e18a68826ef61931ae8379fe9461d7b",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/cae686d31e18a68826ef61931ae8379fe9461d7b/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "6cbae37667f504d9ecd6173e1eff817d2b7aaf0c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6cbae37667f504d9ecd6173e1eff817d2b7aaf0c",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/6cbae37667f504d9ecd6173e1eff817d2b7aaf0c"
      }
    ],
    "stats": {
      "total": 12,
      "additions": 12,
      "deletions": 0
    },
    "files": [
      {
        "sha": "ec32b62098f9f077c9f0e02b56430e840bc9b679",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/cae686d31e18a68826ef61931ae8379fe9461d7b/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/cae686d31e18a68826ef61931ae8379fe9461d7b/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=cae686d31e18a68826ef61931ae8379fe9461d7b",
        "patch": "@@ -276,6 +276,7 @@ std::string HelpMessage()\n         \"  -rpcallowip=<ip>       \" + _(\"Allow JSON-RPC connections from specified IP address\") + \"\\n\" +\n         \"  -rpcconnect=<ip>       \" + _(\"Send commands to node running on <ip> (default: 127.0.0.1)\") + \"\\n\" +\n         \"  -blocknotify=<cmd>     \" + _(\"Execute command when the best block changes (%s in cmd is replaced by block hash)\") + \"\\n\" +\n+        \"  -walletnotify=<cmd>    \" + _(\"Execute command when a wallet transaction changes (%s in cmd is replaced by TxID)\") + \"\\n\" +\n         \"  -upgradewallet         \" + _(\"Upgrade wallet to latest format\") + \"\\n\" +\n         \"  -keypool=<n>           \" + _(\"Set key pool size to <n> (default: 100)\") + \"\\n\" +\n         \"  -rescan                \" + _(\"Rescan the block chain for missing wallet transactions\") + \"\\n\" +"
      },
      {
        "sha": "f9da100e211be035eb3da685564b267f448c2284",
        "filename": "src/wallet.cpp",
        "status": "modified",
        "additions": 11,
        "deletions": 0,
        "changes": 11,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/cae686d31e18a68826ef61931ae8379fe9461d7b/src/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/cae686d31e18a68826ef61931ae8379fe9461d7b/src/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet.cpp?ref=cae686d31e18a68826ef61931ae8379fe9461d7b",
        "patch": "@@ -8,6 +8,7 @@\n #include \"crypter.h\"\n #include \"ui_interface.h\"\n #include \"base58.h\"\n+#include <boost/algorithm/string/replace.hpp>\n \n using namespace std;\n \n@@ -470,6 +471,16 @@ bool CWallet::AddToWallet(const CWalletTx& wtxIn)\n \n         // Notify UI of new or updated transaction\n         NotifyTransactionChanged(this, hash, fInsertedNew ? CT_NEW : CT_UPDATED);\n+\n+        // notify an external script when a wallet transaction comes in or is updated\n+        std::string strCmd = GetArg(\"-walletnotify\", \"\");\n+\n+        if ( !strCmd.empty())\n+        {\n+            boost::replace_all(strCmd, \"%s\", wtxIn.GetHash().GetHex());\n+            boost::thread t(runCommand, strCmd); // thread runs free\n+        }\n+\n     }\n     return true;\n }"
      }
    ]
  }
]