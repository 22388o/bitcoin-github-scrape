[
  {
    "sha": "b43a646b0de0c147d935605bf7e57f7211f631c9",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiNDNhNjQ2YjBkZTBjMTQ3ZDkzNTYwNWJmN2U1N2Y3MjExZjYzMWM5",
    "commit": {
      "author": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2017-06-22T06:54:47Z"
      },
      "committer": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2017-06-22T06:57:40Z"
      },
      "message": "Make sure we only mine via the first wallet",
      "tree": {
        "sha": "814147e6cf83211c97986cdacd71aad6f26ac735",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/814147e6cf83211c97986cdacd71aad6f26ac735"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b43a646b0de0c147d935605bf7e57f7211f631c9",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEyhopCNzi8TB0xizeHrd2uwPHki0FAllLamUACgkQHrd2uwPH\nki29KBAAqEKuGrde/qBNTibjOqNLMV4QAucJlTCTNC+YRg+jlO6i7TZl6JPdzzAN\nDlw/n0nfpmTXy661UCCqcVLnvRSwRMElrGU8P/O47juPR7bg4Irbh6Jny/cxfCMH\nw4wKuL+cIHwo1zchasJOkVUDSVYGIZJpTkrGIBdZBJxaaed9vwAUCPkOscZBSWxf\ntsvkXueQgzNW6QhtIfu/claBJK15W4AAfhX+lqpBdwS16KuoEo99IOEcfTwGfmWR\nhqT3t8uCPnTeNHI5WsBzUGITBhgZ6+uW8KlLoY9nYDS3LJfo3Q2N4L7H+OVev7O+\n0tRw76IhJXKEQPFESN3Wj2FPPO9KRaievSSjreVDsykr3uKKRLUDMouUQ6TYSJAy\nY0dBVZKxm2GHR07JGF1yqhmZw2/B8aHy/GE7N4C0ICWPRuP5oM9PaBWruWKpuQsR\noN6LHIONq/Ue1u6OHnMIxflh1crq3VXl/krXaBvziPRj/vV/F82GeN9pgEjSMRPz\nJ7ENVTcSoG0NGBhpBKTVXQ//dB2x7GwPGiw/4C19vRdMqLOCpxQr/NqZyGObY955\nMEijme+gd4YjPGQ/NR5sevyrVNCRl089ZQPuz7m4HicwGSGcKiyocfRrC98mfqAY\nanNJPM2t//7drnOy5lbAjxjNkyXCvip28fsoqbn70i3wbJrXoDE=\n=40xk\n-----END PGP SIGNATURE-----",
        "payload": "tree 814147e6cf83211c97986cdacd71aad6f26ac735\nparent d083bd9b9c5249f21b8b7e4abd7aee48a25806b1\nauthor Jonas Schnelli <dev@jonasschnelli.ch> 1498114487 +0200\ncommitter Jonas Schnelli <dev@jonasschnelli.ch> 1498114660 +0200\n\nMake sure we only mine via the first wallet\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b43a646b0de0c147d935605bf7e57f7211f631c9",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/b43a646b0de0c147d935605bf7e57f7211f631c9",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b43a646b0de0c147d935605bf7e57f7211f631c9/comments",
    "author": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "d083bd9b9c5249f21b8b7e4abd7aee48a25806b1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d083bd9b9c5249f21b8b7e4abd7aee48a25806b1",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/d083bd9b9c5249f21b8b7e4abd7aee48a25806b1"
      }
    ],
    "stats": {
      "total": 9,
      "additions": 9,
      "deletions": 0
    },
    "files": [
      {
        "sha": "f14a7a5a94fddb91d4e59499abea0b9d01ca69ac",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 9,
        "deletions": 0,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/b43a646b0de0c147d935605bf7e57f7211f631c9/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/b43a646b0de0c147d935605bf7e57f7211f631c9/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=b43a646b0de0c147d935605bf7e57f7211f631c9",
        "patch": "@@ -3476,6 +3476,15 @@ void CWallet::GetAllReserveKeys(std::set<CKeyID>& setAddress) const\n \n void CWallet::GetScriptForMining(std::shared_ptr<CReserveScript> &script)\n {\n+    // make sure we only mine via the first wallet\n+    // otherwise the used wallet is undefined (depends on the signal registration order)\n+    // TODO: allow to pass the via generate/setgenerate used wallet to the signal\n+    {\n+        LOCK2(cs_main, cs_wallet);\n+        if (vpwallets.empty() /* should never be empty at this point */ || vpwallets[0] != this) {\n+            return;\n+        }\n+    }\n     std::shared_ptr<CReserveKey> rKey = std::make_shared<CReserveKey>(this);\n     CPubKey pubkey;\n     if (!rKey->GetReservedKey(pubkey))"
      }
    ]
  }
]