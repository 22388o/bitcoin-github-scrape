[
  {
    "sha": "a6a1b106dcc4350e420c461171c47e4934087175",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzphNmExYjEwNmRjYzQzNTBlNDIwYzQ2MTE3MWM0N2U0OTM0MDg3MTc1",
    "commit": {
      "author": {
        "name": "fanquake",
        "email": "fanquake@gmail.com",
        "date": "2021-02-01T03:54:40Z"
      },
      "committer": {
        "name": "fanquake",
        "email": "fanquake@gmail.com",
        "date": "2021-02-22T02:49:05Z"
      },
      "message": "guix: only download sources for hosts being built\n\nIf a user is only interested in building for Linux, this saves\ndownloading the macOS compiler and additional dependencies.\n\nThis will result in a few additional `make` invocations, for the Linux\nhosts, however this is quite low overhead.\n\nCo-authored-by: Carl Dong <contact@carldong.me>",
      "tree": {
        "sha": "f69bb1663865fd1ecdd44d7f9ef5dddffca5dcac",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f69bb1663865fd1ecdd44d7f9ef5dddffca5dcac"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a6a1b106dcc4350e420c461171c47e4934087175",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEz7FuIclQ9n+pXlWPLuufXMCVJsEFAmAzG6EACgkQLuufXMCV\nJsE44A//WkvrfJy409vBG9KFr4mAChYrcy1MdoTXBm0RdbFZeZd2HXRBD418Hp4I\nN38c1oECemPfGeBx+/PZJ0O4ymUYAH14izTQQkX4r2NRmZToSiMkbMTELyYF5eib\n2fHcpro9DUH9gjNiE0lUUcvXKRwehAnbTtfjMVA7s+QCoWUJ/obJV6MvQxfhrYfE\naaofHChqPkxVlv3DwWxBIgmmT+4msTlsYxezt92aiAwfOrNUiqyJC6X1BTTvf4Rp\nSfnM8agF4QzZQTpQcxS6005KJE7fVSi8Q1AmrLNThJ9dTWeKPytT9gH3d1EguU88\nOxzbo4uXPQaSrrOoA1ZrNFTOkyVUYFzr5woVrDuk6aRg3CNuT6hsoT7wqreLAyTE\nb+cgsZyOIB7nWPs6GMwWVDsSe0exondLFRYjU1GB8j2uLEfFqrnLS3vXALx25yHG\nE2a8s6MPTejAZ79+Mm1uPheD2hsz+4oSbLONdOjPcHjZniughPDPTGEL2g4FgDOL\n1tOfDnsDc2eesb8goYFLF4Ngp80ZJaqV6rtcm22YmxSgVJitsMJNggMQtP6gp9Pk\n883hN3blkHUkxWfylDBFf91v5HXtlIQA0vBcWdgo5NA9SKUFyNzf2MHKzEb4ZAMb\n7Du6Ht/StMSMCcyVJhT3Avt5P73ff00acjA2Vn/k+YY0UuQjadU=\n=wg4T\n-----END PGP SIGNATURE-----",
        "payload": "tree f69bb1663865fd1ecdd44d7f9ef5dddffca5dcac\nparent 5bb64acd9d3ced6e6f95df282a1a0f8b98522cb0\nauthor fanquake <fanquake@gmail.com> 1612151680 +0800\ncommitter fanquake <fanquake@gmail.com> 1613962145 +0800\n\nguix: only download sources for hosts being built\n\nIf a user is only interested in building for Linux, this saves\ndownloading the macOS compiler and additional dependencies.\n\nThis will result in a few additional `make` invocations, for the Linux\nhosts, however this is quite low overhead.\n\nCo-authored-by: Carl Dong <contact@carldong.me>\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a6a1b106dcc4350e420c461171c47e4934087175",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/a6a1b106dcc4350e420c461171c47e4934087175",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a6a1b106dcc4350e420c461171c47e4934087175/comments",
    "author": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "5bb64acd9d3ced6e6f95df282a1a0f8b98522cb0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5bb64acd9d3ced6e6f95df282a1a0f8b98522cb0",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/5bb64acd9d3ced6e6f95df282a1a0f8b98522cb0"
      }
    ],
    "stats": {
      "total": 17,
      "additions": 16,
      "deletions": 1
    },
    "files": [
      {
        "sha": "643541de53629a6e780a31dc62b2b1ec6da0b580",
        "filename": "contrib/guix/guix-build.sh",
        "status": "modified",
        "additions": 16,
        "deletions": 1,
        "changes": 17,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/a6a1b106dcc4350e420c461171c47e4934087175/contrib/guix/guix-build.sh",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/a6a1b106dcc4350e420c461171c47e4934087175/contrib/guix/guix-build.sh",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/guix/guix-build.sh?ref=a6a1b106dcc4350e420c461171c47e4934087175",
        "patch": "@@ -136,9 +136,24 @@ done\n # environment)\n MAX_JOBS=\"${MAX_JOBS:-$(nproc)}\"\n \n+# Usage: host_to_commonname HOST\n+#\n+#   HOST: The current platform triple we're building for\n+#\n+host_to_commonname() {\n+    case \"$1\" in\n+        *darwin*) echo osx ;;\n+        *mingw*)  echo win ;;\n+        *linux*)  echo linux ;;\n+        *)        exit 1 ;;\n+    esac\n+}\n+\n # Download the depends sources now as we won't have internet access in the build\n # container\n-make -C \"${PWD}/depends\" -j\"$MAX_JOBS\" download ${V:+V=1} ${SOURCES_PATH:+SOURCES_PATH=\"$SOURCES_PATH\"}\n+for host in $HOSTS; do\n+  make -C \"${PWD}/depends\" -j\"$MAX_JOBS\" download-\"$(host_to_commonname \"$host\")\" ${V:+V=1} ${SOURCES_PATH:+SOURCES_PATH=\"$SOURCES_PATH\"}\n+done\n \n # Determine the reference time used for determinism (overridable by environment)\n SOURCE_DATE_EPOCH=\"${SOURCE_DATE_EPOCH:-$(git log --format=%at -1)}\""
      }
    ]
  }
]