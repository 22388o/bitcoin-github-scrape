[
  {
    "sha": "9321086af7b75be536767d25abef4d7e02ca416a",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5MzIxMDg2YWY3Yjc1YmU1MzY3NjdkMjVhYmVmNGQ3ZTAyY2E0MTZh",
    "commit": {
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-07-28T15:21:23Z"
      },
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-07-28T16:00:09Z"
      },
      "message": "test: add assert_getpeerinfo method and coverage in p2p_addrfetch.py",
      "tree": {
        "sha": "f77ce1d05f80702d10c913d7d582ddfe1c722622",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f77ce1d05f80702d10c913d7d582ddfe1c722622"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9321086af7b75be536767d25abef4d7e02ca416a",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEd6u7+MhX7zEv6RP5T1chs9Djkh0FAmEBfw8ACgkQT1chs9Dj\nkh2rwA/8Cd6/yqxm4dYTQleRTgx2YV8QPZg0GTAuRNX+ponMCSihYxYcRtnd3VHI\nMVoD2+ew7Ub/lAYPG/IbgpuLLXhbzsp5kc/CJmDbuiirrQ07roCQIGuoxEHXxQbs\nwvrvn7BcGHat4TUM8ZPsR89PC3773bA46xMMFJoek1N7lrMkPYfCEHSJ0Yup31HJ\ndQfpMSgLNoUYacrAvzIePoZZa0ta2b4ypjHwUBkawunF/RMs1CLfFII0TzfxXCMA\nI3j6Ce8O8quBqQMj3/xaPg4MGZRSdnBx7msCFt4YOveTMIUGooFR0XUSa4Lo80BB\nJ5gOrpPbLJWIvLoPBzpukIWCO2LlpPkZFHXJ2l6rEUKlRrTumf7joJpBVnB/Wf+b\na2p0wNGX9y4Rgfjysj8+xGuoJIuD4DBr6DWQvpYiVwXjc790fZwGIJnoS3yi6s7W\n5EvXIbgw6eMH4TMzZnPxoSyMMwqJXMXLtCBzlv8F6Ci9+lGq4Yw2XZzS8SNDrDzu\nvU816HuCP31ujlYgf7ORd3FhU6YgPtidvR+CxhqfkBAhYutnk3k88BUZYBkvDlDp\nMnMAsEShplP0ZPxdauhtQetqfUi/NC03lb++a8YqVXxLXmdPpNWXKuXrdxU2baOP\n5veQH5sWG5+6POV0soHer7mKezLx/6Vl9mVtZ/hV5MGBLcVLjdU=\n=fM9m\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwIGhEp1rt8BiF2ljEaXootxzBHwzrHy88J4M//7Lco0MtCP/wEIU5GZ+IK1zK\nAwjuypWthIgI8CAy0v+Dc94Jf/U9TNORcFSqxMl4bDv4fSkcYOQXliK+IwjwICKf\nZVbiqsrCMk7PnUGlDaJg8w7BtSnBSUhII3TnIYQGCPEEYQF/EfAIZiJmJEZsgGYA\ng9/jDS75DI4jImh0dHBzOi8vYnRjLmNhbGVuZGFyLmNhdGFsbGF4eS5jb23/8BCp\n3FX42lBAepl2/T+xhjWsCPEgEBU8kyYaRmMue39287BwnYYhsSiba5BeLEO6otUt\nlYAI8QRhAX8Q8AhqDJpmwzZAugCD3+MNLvkMjiwraHR0cHM6Ly9ib2IuYnRjLmNh\nbGVuZGFyLm9wZW50aW1lc3RhbXBzLm9yZ//wEL69y/MOAQMJ0Ug5Jbgyb0UI8CBc\nAd8Og9RwT4wslXVsYi3hrJeTh/BO+hlo3ckBr1Z2mQjwIFC9Pt+5YZ5HytRpWdZ8\nAA0R9TVcHO9P8/QtsOe4B2U+CPEEYQF/EfAI+X9W4bxxM6MAg9/jDS75DI4uLWh0\ndHBzOi8vYWxpY2UuYnRjLmNhbGVuZGFyLm9wZW50aW1lc3RhbXBzLm9yZ/AQwfav\nBRR2GcdEXOrjRwj2OAjxILGdn+tWzygsTFZzbM+3/SbZePeeK3TBRoZjr0v8FdVL\nCPEgrv5PUJGSzegIsNxHH0nWRMjRDk8YsTtWBqzjgVMRmD4I8QRhAX8R8AjrgC5V\nPqP8KwCD3+MNLvkMjikoaHR0cHM6Ly9maW5uZXkuY2FsZW5kYXIuZXRlcm5pdHl3\nYWxsLmNvbQ==\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----",
        "payload": "tree f77ce1d05f80702d10c913d7d582ddfe1c722622\nparent 5e213822f86d9fcd19c0af420831bb3079548479\nauthor Jon Atack <jon@atack.com> 1627485683 +0200\ncommitter Jon Atack <jon@atack.com> 1627488009 +0200\n\ntest: add assert_getpeerinfo method and coverage in p2p_addrfetch.py\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9321086af7b75be536767d25abef4d7e02ca416a",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/9321086af7b75be536767d25abef4d7e02ca416a",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9321086af7b75be536767d25abef4d7e02ca416a/comments",
    "author": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "5e213822f86d9fcd19c0af420831bb3079548479",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5e213822f86d9fcd19c0af420831bb3079548479",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/5e213822f86d9fcd19c0af420831bb3079548479"
      }
    ],
    "stats": {
      "total": 18,
      "additions": 12,
      "deletions": 6
    },
    "files": [
      {
        "sha": "4b15c8248914985916753f8b757474e769686e50",
        "filename": "test/functional/p2p_addrfetch.py",
        "status": "modified",
        "additions": 12,
        "deletions": 6,
        "changes": 18,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9321086af7b75be536767d25abef4d7e02ca416a/test/functional/p2p_addrfetch.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9321086af7b75be536767d25abef4d7e02ca416a/test/functional/p2p_addrfetch.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/p2p_addrfetch.py?ref=9321086af7b75be536767d25abef4d7e02ca416a",
        "patch": "@@ -21,18 +21,24 @@\n \n \n class P2PAddrFetch(BitcoinTestFramework):\n-\n     def set_test_params(self):\n         self.setup_clean_chain = True\n         self.num_nodes = 1\n \n+    def assert_getpeerinfo(self, *, peer_ids):\n+        num_peers = len(peer_ids)\n+        info = self.nodes[0].getpeerinfo()\n+        assert_equal(len(info), num_peers)\n+        for n in range(0, num_peers):\n+            assert_equal(info[n]['id'], peer_ids[n])\n+            assert_equal(info[n]['connection_type'], 'addr-fetch')\n+\n     def run_test(self):\n         node = self.nodes[0]\n         self.log.info(\"Connect to an addr-fetch peer\")\n-        peer = node.add_outbound_p2p_connection(P2PInterface(), p2p_idx=0, connection_type=\"addr-fetch\")\n-        info = node.getpeerinfo()\n-        assert_equal(len(info), 1)\n-        assert_equal(info[0]['connection_type'], 'addr-fetch')\n+        peer_id = 0\n+        peer = node.add_outbound_p2p_connection(P2PInterface(), p2p_idx=peer_id, connection_type=\"addr-fetch\")\n+        self.assert_getpeerinfo(peer_ids=[peer_id])\n \n         self.log.info(\"Check that we send getaddr but don't try to sync headers with the addr-fetch peer\")\n         peer.sync_send_with_ping()\n@@ -45,7 +51,7 @@ def run_test(self):\n         msg = msg_addr()\n         msg.addrs = [ADDR]\n         peer.send_and_ping(msg)\n-        assert_equal(len(node.getpeerinfo()), 1)\n+        self.assert_getpeerinfo(peer_ids=[peer_id])\n \n         self.log.info(\"Check that answering with larger addr messages leads to disconnect\")\n         msg.addrs = [ADDR] * 2"
      }
    ]
  },
  {
    "sha": "f8d8eb5fdaa93b6e5b77fd901b94927dc3a0473e",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmOGQ4ZWI1ZmRhYTkzYjZlNWI3N2ZkOTAxYjk0OTI3ZGMzYTA0NzNl",
    "commit": {
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-07-28T15:28:26Z"
      },
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-07-28T16:02:02Z"
      },
      "message": "test: add addr-fetch timeout connection coverage in p2p_addrfetch.py",
      "tree": {
        "sha": "aff4da80c893c6eb910ab6857fcae316aac532ae",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/aff4da80c893c6eb910ab6857fcae316aac532ae"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f8d8eb5fdaa93b6e5b77fd901b94927dc3a0473e",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEd6u7+MhX7zEv6RP5T1chs9Djkh0FAmEBf48ACgkQT1chs9Dj\nkh325hAAit1gmbMNVjSiCOinstcFTHYdoQm12Ky3Bp9MLGCiBFpCvHZ3iANfdrEb\n4YK2y1Z9sVITlZy+JBojvlQhV4TXfZdwCNCFPSBz1uDO2W+Q1H7zRVmtC05/DeUe\nWQTb/HmyJuHknrlPt7TQ8zpUYPt5/o9pxGfQGn5SbubT4DbTqvIAKJXiQmGg4jsf\n07IxJQ2Z4fIq8EqY1yWlRgDLY61pPvXY7/qePLM2DnkuUNRS9jh/o4a190DbVFaK\nmWywLGWtF3v3RW8f9ma9KIGCBdCj5+MrNXZpT2LziRTlE+Vod354A89IDqPL2cDh\ni1wRF2Ci/K5NVUj92pJYLgDsVHB284jonct/5ZgXp0PSntloJhHbSx+QhMDL7cG0\nx4mHdJimFBLbTaxwSCNN7qQ9vKAUTe8HUnD3Q3BzvvQtvRMTQMQwHX2bDn05UCkz\nuKXOTuBD4rMYgLw/S+8wbMcoddRqIPovsceFDsevfO2S3s2Hp+wTA5X2bbapMz8e\nmxNGeCbuaSv5C4kCxAkfNCPgC45AGYXVcxLoXkLH/J7H2kuS4w5JEpTI0heKw80j\nWDGqX1tR9V5OS+NIUkpItV4V5CYbbN/ZBcB43m+R7h0ABLkz8h7dxHJxrE6ZCzsc\nREXmoE+g0pdinhz+gue+cedNmZXJsvBAJu568LlK8zmmm4HUYH0=\n=HiKe\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwIJycZV4WZzF/xg0KbiCvOGHvnGG5JCqzOM8GQJcZkjCACP/wELYwnfQgxlXk\nyySpbxueDe0I8CCcTYX/ZngzyuYzobk2qH5ywWxHgLLWc3YG8jOqzDK+NgjwIPoS\nr8ZORF2Tr/eM8McPxHHg7lel4YJc5F+y4CieptkhCPEEYQF/kPAIgA0tAc0Ia+wA\ng9/jDS75DI4uLWh0dHBzOi8vYWxpY2UuYnRjLmNhbGVuZGFyLm9wZW50aW1lc3Rh\nbXBzLm9yZ//wEMWXBRNSbcBr+xXi8aPyYh4I8CDJqtrkIQIjtQ50LYn5mntfAcEp\nf/Pix90R/zXmOaX0FwjwICq6khCkM9G92YBKSaKQFXHmRIiPsmtBZFm1oq29g3B7\nCPEEYQF/kPAI+vxjEETMWF8Ag9/jDS75DI4pKGh0dHBzOi8vZmlubmV5LmNhbGVu\nZGFyLmV0ZXJuaXR5d2FsbC5jb23/8BDH4/YxgWpvpDDdTVvRGq1GCPEEYQF/kPAI\nw3EaIlg8AI4Ag9/jDS75DI4jImh0dHBzOi8vYnRjLmNhbGVuZGFyLmNhdGFsbGF4\neS5jb23wEMmqyuUEdQv1NuzNp4XialgI8QRhAX+Q8AhDVwmczaJCFwCD3+MNLvkM\njiwraHR0cHM6Ly9ib2IuYnRjLmNhbGVuZGFyLm9wZW50aW1lc3RhbXBzLm9yZw==\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----",
        "payload": "tree aff4da80c893c6eb910ab6857fcae316aac532ae\nparent 9321086af7b75be536767d25abef4d7e02ca416a\nauthor Jon Atack <jon@atack.com> 1627486106 +0200\ncommitter Jon Atack <jon@atack.com> 1627488122 +0200\n\ntest: add addr-fetch timeout connection coverage in p2p_addrfetch.py\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f8d8eb5fdaa93b6e5b77fd901b94927dc3a0473e",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/f8d8eb5fdaa93b6e5b77fd901b94927dc3a0473e",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f8d8eb5fdaa93b6e5b77fd901b94927dc3a0473e/comments",
    "author": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "9321086af7b75be536767d25abef4d7e02ca416a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9321086af7b75be536767d25abef4d7e02ca416a",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/9321086af7b75be536767d25abef4d7e02ca416a"
      }
    ],
    "stats": {
      "total": 15,
      "additions": 13,
      "deletions": 2
    },
    "files": [
      {
        "sha": "2a0f6432a9bd1a9b9b598846fcee0b00bcbe4ebc",
        "filename": "test/functional/p2p_addrfetch.py",
        "status": "modified",
        "additions": 13,
        "deletions": 2,
        "changes": 15,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f8d8eb5fdaa93b6e5b77fd901b94927dc3a0473e/test/functional/p2p_addrfetch.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f8d8eb5fdaa93b6e5b77fd901b94927dc3a0473e/test/functional/p2p_addrfetch.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/p2p_addrfetch.py?ref=f8d8eb5fdaa93b6e5b77fd901b94927dc3a0473e",
        "patch": "@@ -59,9 +59,20 @@ def run_test(self):\n         peer.wait_for_disconnect(timeout=5)\n \n         self.log.info(\"Check timeout for addr-fetch peer that does not send addrs\")\n-        peer = node.add_outbound_p2p_connection(P2PInterface(), p2p_idx=1, connection_type=\"addr-fetch\")\n-        node.setmocktime(int(time.time()) + 301)  # Timeout: 5 minutes\n+        peer_id = 1\n+        peer = node.add_outbound_p2p_connection(P2PInterface(), p2p_idx=peer_id, connection_type=\"addr-fetch\")\n+\n+        time_now = int(time.time())\n+        self.assert_getpeerinfo(peer_ids=[peer_id])\n+\n+        # Expect addr-fetch peer connection to be maintained up to 5 minutes.\n+        node.setmocktime(time_now + 295)\n+        self.assert_getpeerinfo(peer_ids=[peer_id])\n+\n+        # Expect addr-fetch peer connection to be disconnected after 5 minutes.\n+        node.setmocktime(time_now + 301)\n         peer.wait_for_disconnect(timeout=5)\n+        self.assert_getpeerinfo(peer_ids=[])\n \n \n if __name__ == '__main__':"
      }
    ]
  }
]