[
  {
    "sha": "af3b0dfc5463c42fb9bff39f020fc1728ed44bc7",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzphZjNiMGRmYzU0NjNjNDJmYjliZmYzOWYwMjBmYzE3MjhlZDQ0YmM3",
    "commit": {
      "author": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2020-10-21T12:24:42Z"
      },
      "committer": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2020-10-21T12:40:42Z"
      },
      "message": "net: fix output of peer address in version message\n\nIf `-logips -debug=net` is specified then we print the contents of the\nversion message we send to the peer, including his address. Because the\naddresses in the version message use pre-BIP155 encoding they cannot\nrepresent a Tor v3 address and we would actually send 16 `0`s instead (a\ndummy IPv6 address). However we would print the full address in the log\nmessage. Before this fix:\n\n```\n2020-10-21T12:24:17Z send version message: version 70016, blocks=653500, us=[::]:0, them=xwjtp3mj427zdp4tljiiivg2l5ijfvmt5lcsfaygtpp6cw254kykvpyd.onion:8333, peer=0\n```\n\nThis is confusing because we pretend to send one thing while we actually\nsend another. Adjust the printout to reflect what we are sending. After\nthis fix:\n\n```\n2020-10-21T12:26:54Z send version message: version 70016, blocks=653500, us=[::]:0, them=[::]:0, peer=0\n```",
      "tree": {
        "sha": "e47e3de74b2bade25e977725e942387bd432c590",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e47e3de74b2bade25e977725e942387bd432c590"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/af3b0dfc5463c42fb9bff39f020fc1728ed44bc7",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQQzBAABCAAdFiEE5k2NRWFNsHVF2czBVN8G9ktVy78FAl+QLEoACgkQVN8G9ktV\ny7/9Ax//QK0Wy8FUD6AtdraiRwSyYc8j0jAe6nup5x2hA12aBvioJMuOjymSH1Uy\nYAgZNJioAxGUM6HX7yNYqWjodfLFegnmYhBahs5p4O7qpqkkE43OKN6t1wvU1oiE\nXBg/vv3729XMMONOWu5SAd0zsVOqG10IDqdqnlGZ2klSMBNnr/XFj+asQt26jBwz\nEs7DdPq1ZKPzmLkm3OJHZwNa0IjL/uCPQ62x36OKNIotMC9Am7YstTG99PTFbtPQ\ngyOGgBC0rDfyngOELaqxHt/EcYqTuyZPy3eZyx0mm5yyu/5ANFo1j9k4E5zM8k52\n6IuwsmjMf7SAro1ZrZXWNrkK0zmBgF3YpQ6FZ/3A6dms8fBUccovCOdRS4p5WF0n\nv18+MAqFrsjAEjx9rEZyEENY7Yxc6h0JbUmPFpsAHx44UbewfIckoujDrP6Dlevo\nx9R5TBW6GWh9khqVFTbiWO97XzqvYl0eFyMNUOa+S9ctRaJLQ5FKSMsv9wD9WOav\nsdYjx3/e3Cpr+9b/vnqJE7PZdHyVzdE3UDlAPU6n+wRg6wut8K5tkGk0kA3WvPU6\nPhG7T14nKWtneItvPK+WUupFXg5FxuTk+ISg4d4eNn0Mqc/8O9fjWjRGHINGULnw\nM+SGj5E9NST8Ro7RVnr31RtaQZZC7qMwGbnWTv8uodMrSJoxpg2iJXyDx7L49JRR\nMPsVRRw3BlVARnPc9KmZLorT86kLIBzLuq7Xhg+B3DmBzIaA/B6+21z52ACfuIv3\nGzU4drHuvExSvqTPT/D/+Yxg5NDWKbCt2Dd6vyvuTfC7iay8gKBmNdXAOA7rYteD\noq/HGS2tOgiKSAEZa/7tiS1PuowoUzHn1saSbR5Ixye1qG+/+6dcBESjTHWKijf2\nCGMMPab6387mW+L9Mc5AiVNS4vgN40ZP02NFjnMrJmxW+9f9N20GrdYtfy9cel1x\njYjCnO/mgyeHWHKRDV3xykcwRfPgz2z9H5uJjrxATUGRXlSHmV9TTjlrWsPTNIO1\nl6HAooOV2JcZdskn0TSeOfTViC8dC1QCvtnoBPSm6xQi0p3RCfebgBtjwo3LBTJJ\nQEDs1fw7t45BphKmiFz0WHTGGWuabx06uWZOph+DsX2x9tTxPPzgEaerR1fh/DLw\ngX8RuiArXc699NVMdoWSTt00wwj88buZ3bG0b8TTHXm7Y/JI+r9jjCzM8FUVoVKb\nFyHaITmVHshPSB0LiVuCX7i548J5dUKGedUtkSsr5T46oUX4j4wEAQaru4uekCky\nt0uD+wfcd46Abb4SXiIrsd0SBSAysIU7XqKJuPWP7fQUj4p/VyJi3Qx/N+KTSoDg\nagV6fDPgFjTtLPZKVIHgu9mBqFF/BA==\n=SSfw\n-----END PGP SIGNATURE-----",
        "payload": "tree e47e3de74b2bade25e977725e942387bd432c590\nparent 0f86e7f1285c6de697d144a0e68bbd67f4900e19\nauthor Vasil Dimov <vd@FreeBSD.org> 1603283082 +0200\ncommitter Vasil Dimov <vd@FreeBSD.org> 1603284042 +0200\n\nnet: fix output of peer address in version message\n\nIf `-logips -debug=net` is specified then we print the contents of the\nversion message we send to the peer, including his address. Because the\naddresses in the version message use pre-BIP155 encoding they cannot\nrepresent a Tor v3 address and we would actually send 16 `0`s instead (a\ndummy IPv6 address). However we would print the full address in the log\nmessage. Before this fix:\n\n```\n2020-10-21T12:24:17Z send version message: version 70016, blocks=653500, us=[::]:0, them=xwjtp3mj427zdp4tljiiivg2l5ijfvmt5lcsfaygtpp6cw254kykvpyd.onion:8333, peer=0\n```\n\nThis is confusing because we pretend to send one thing while we actually\nsend another. Adjust the printout to reflect what we are sending. After\nthis fix:\n\n```\n2020-10-21T12:26:54Z send version message: version 70016, blocks=653500, us=[::]:0, them=[::]:0, peer=0\n```\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/af3b0dfc5463c42fb9bff39f020fc1728ed44bc7",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/af3b0dfc5463c42fb9bff39f020fc1728ed44bc7",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/af3b0dfc5463c42fb9bff39f020fc1728ed44bc7/comments",
    "author": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasild/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasild/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "0f86e7f1285c6de697d144a0e68bbd67f4900e19",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0f86e7f1285c6de697d144a0e68bbd67f4900e19",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/0f86e7f1285c6de697d144a0e68bbd67f4900e19"
      }
    ],
    "stats": {
      "total": 4,
      "additions": 3,
      "deletions": 1
    },
    "files": [
      {
        "sha": "f0fd63b33c8ae256ee3490ddababa01c579e56c4",
        "filename": "src/net_processing.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 1,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/af3b0dfc5463c42fb9bff39f020fc1728ed44bc7/src/net_processing.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/af3b0dfc5463c42fb9bff39f020fc1728ed44bc7/src/net_processing.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net_processing.cpp?ref=af3b0dfc5463c42fb9bff39f020fc1728ed44bc7",
        "patch": "@@ -498,7 +498,9 @@ static void PushNodeVersion(CNode& pnode, CConnman& connman, int64_t nTime)\n     NodeId nodeid = pnode.GetId();\n     CAddress addr = pnode.addr;\n \n-    CAddress addrYou = (addr.IsRoutable() && !IsProxy(addr) ? addr : CAddress(CService(), addr.nServices));\n+    CAddress addrYou = addr.IsRoutable() && !IsProxy(addr) && addr.IsAddrV1Compatible() ?\n+                           addr :\n+                           CAddress(CService(), addr.nServices);\n     CAddress addrMe = CAddress(CService(), nLocalNodeServices);\n \n     connman.PushMessage(&pnode, CNetMsgMaker(INIT_PROTO_VERSION).Make(NetMsgType::VERSION, PROTOCOL_VERSION, (uint64_t)nLocalNodeServices, nTime, addrYou, addrMe,"
      }
    ]
  }
]