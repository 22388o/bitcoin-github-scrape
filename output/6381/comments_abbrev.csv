rustyrussell,2015-07-07T06:56:17Z,"Seems fairly trivial and clean.  Tested on regtest, testnet and mainnet.\n",https://github.com/bitcoin/bitcoin/pull/6381#issuecomment-119094051,119094051,
sipa,2015-07-09T22:27:31Z,"Sorry for the rant above, @jtimon \n\nIt took me a while to see your point of view. If you think that there is no need for more than 2 base58 styles, I fully agree with the approach you're taking. You see ""use mainnet or testnet style addresses"" as the chain property. I see ""what prefix byte to use"" as the chain property.\n",https://github.com/bitcoin/bitcoin/pull/6381#issuecomment-120165186,120165186,
jtimon,2015-07-12T09:28:31Z,"Needed rebase.\nYes, I don't think there's any need for more than a few styles (ie production, testing). Even just one would be ok IMO.\nAnyway, since it is not essential to achieve its main goal, I've left the polemic static function AssignBase58PrefixStyle() out of this PR (it's still in #6382 for further discussion) .\n",https://github.com/bitcoin/bitcoin/pull/6381#issuecomment-120703406,120703406,
sipa,2015-07-14T21:33:36Z,Untested ACK.\n,https://github.com/bitcoin/bitcoin/pull/6381#issuecomment-121397475,121397475,
laanwj,2015-07-20T16:49:39Z,"utACK.\n\n> As mentioned by @theuni on #6359 , the hierarchy between the different chainparam implementations is not necessary. \n\nThat has always been a gripe of me, too.\nDo we need a class hierarchy at all? There is no network-specific code anymore - only the constructor differs. We could move a step further and make it completely data-driven. \n",https://github.com/bitcoin/bitcoin/pull/6381#issuecomment-122947019,122947019,
jtimon,2015-07-21T09:32:20Z,"Yeah, I tried just using parametrized constructors for the factory in an alternate version of #6382 but the code didn't look better but actually worse (even using https://github.com/jtimon/bitcoin/commit/25e99a045138ba25d21fa028144d729fb94ebaf3 in the unified constructor).\nI think the only next step in ""data-driven-ness"" that it's worth taking is to directly load the values from files (ie main.da",https://github.com/bitcoin/bitcoin/pull/6381#issuecomment-123237913,123237913,
laanwj,2015-07-21T11:13:16Z,"> I think the only next step in ""data-driven-ness"" that it's worth taking is to directly load the values from files (ie main.dat, testnet3.dat, regtest.dat [maybe .json or something instead of .dat]).\n\nAgreed. That could be kind of useful for testing.\n",https://github.com/bitcoin/bitcoin/pull/6381#issuecomment-123265006,123265006,
sipa,2015-07-09T16:21:28Z,"I'd rather not see the 'data' (the actual prefix bytes) move to code. Can you pass them in as parameters instead, and call this function from each of the constructors?\n",https://github.com/bitcoin/bitcoin/pull/6381#discussion_r34273250,34273250,src/chainparams.cpp
jtimon,2015-07-09T19:52:32Z,I think we should only keep a base58PrefixStyle here and move everything else to base58.o in a later PR.\n,https://github.com/bitcoin/bitcoin/pull/6381#discussion_r34295857,34295857,src/chainparams.cpp
sipa,2015-07-09T20:13:59Z,"I don't think that's a good idea. All chain-specific data should be here, IMHO. Minimize the number of places where code needs to be changed to add a new chain.\n",https://github.com/bitcoin/bitcoin/pull/6381#discussion_r34298216,34298216,src/chainparams.cpp
jtimon,2015-07-09T20:24:53Z,"Exactly, that's what I'm doing in #6382.\nTo create a new chain you just choose one of the existing base58Prefix styles and you're good to go.\nUnless you need to create a new base58Prefix style...when is that a good idea anyway?\nIn any case, it seems you're not against anything I'm doing here (which reduces the number of places where code needs to be changed to add a new chain), but you would pr",https://github.com/bitcoin/bitcoin/pull/6381#discussion_r34299528,34299528,src/chainparams.cpp
sipa,2015-07-09T20:27:24Z,"I consider the base58 prefixes to be a property of a chain, and something that should be unique to it. I don't see why a new chain should keep using the base58 style of another chain.\n\nSo, no, I think the actual prefixes should stay right where they are. Moving them to a different function feels like unnecessarily changing data into code, and moving it to a different file is even worse.\n",https://github.com/bitcoin/bitcoin/pull/6381#discussion_r34299773,34299773,src/chainparams.cpp
jtimon,2015-07-09T20:36:20Z,"Then the only way to decouple base58 from the Params globals is passing a CChainParams const reference (not as easy as it may seem either).\n\nBut I still don't understand why a new chain should have new prefixes (doesn't seem to scale to many chains anyway). Neither Freicoin nor Alpha have new prefixes, what can go wrong with that?\nSpecially assuming payment protocol increases in usage.\n",https://github.com/bitcoin/bitcoin/pull/6381#discussion_r34300649,34300649,src/chainparams.cpp
sipa,2015-07-09T20:49:42Z,"Whether they should or not doesn't really matter... the fact is that base58 prefixes are chain-specific property. Moving the base58 prefixes out seems like a hack to avoid the dependency.\n\nYou could create a Base58Prefixes object, defined based base58.h, but constructed and kept inside CChainParams, and retrievable using Params().GetBase58Prefixes(), and pass that to the necessary base58 functio",https://github.com/bitcoin/bitcoin/pull/6381#discussion_r34301983,34301983,src/chainparams.cpp
jtimon,2015-07-09T21:01:13Z,"I'm not insisting on moving them to base58, I just want base58 decoupled from the chainparams' globals, not so important that it's also decoupled from chainparams.\n\n> You could create a Base58Prefixes object, defined based base58.h, but constructed and kept inside CChainParams, and retrievable using Params().GetBase58Prefixes(), and pass that to the necessary base58 functions?\n\nThat sounds goo",https://github.com/bitcoin/bitcoin/pull/6381#discussion_r34303179,34303179,src/chainparams.cpp
sipa,2015-07-09T21:26:06Z,"In my opinion, this PR makes the situation worse. It moves chain-specific data into a shared function. I agree with the goal you're trying to reach, but I don't think we should make the code uglier (even temporarily) in order to achieve a non-urgent goal?\n",https://github.com/bitcoin/bitcoin/pull/6381#discussion_r34305638,34305638,src/chainparams.cpp
jtimon,2015-07-09T21:42:55Z,"I disagree. You need to reuse, at least, the test style for regtest. If you don't have an external function like this you will need CMainBase58Prefixes and CTestBase58Prefixes or something equivalent. I think this is the simplest way to reuse that code and I disagree it's ugly. But if you have another proposal that doesn't involve touching base58 I'm happy to replace this. But remember, being able",https://github.com/bitcoin/bitcoin/pull/6381#discussion_r34307278,34307278,src/chainparams.cpp
sipa,2015-07-09T22:02:50Z,"The fact that regtest and testnet use the same style addresses is historical IMHO. There is nothing wrong with copying the values - they just happen to have the values, for unrelated reasons. Maybe some day we want to change the regtest ones without changing the testnet one.\n",https://github.com/bitcoin/bitcoin/pull/6381#discussion_r34309159,34309159,src/chainparams.cpp
sipa,2015-07-09T22:08:35Z,"I think you're too focussed on DRY to see the bigger picture: the reason you don't want to repeat yourself is because if the same logic is implemented in several places, you don't want to change two things when improving one. But this is not the case here: it's simple data that happens to be the same for both chains.\n",https://github.com/bitcoin/bitcoin/pull/6381#discussion_r34309639,34309639,src/chainparams.cpp
sipa,2015-07-09T22:10:20Z,What I find worse is the fact that chain-specific data used to be nicely grouped per chain. This breaks that for no good reason.\n,https://github.com/bitcoin/bitcoin/pull/6381#discussion_r34309781,34309781,src/chainparams.cpp
jtimon,2015-07-09T22:12:23Z,"There's nothing wrong with not repeating yourself either (or I've failed to\nunderstand what is wrong with it. I think that the fact that testnet and\nregtest is what is historical and there's no need to have different\nprefixes with each chain. In fact, as said, it doesn't scale. For example,\nI'm creating N new chains for sizetest, should they have different\nprefixes? IMO either main or test pr",https://github.com/bitcoin/bitcoin/pull/6381#discussion_r34309954,34309954,src/chainparams.cpp
sipa,2015-07-09T22:25:27Z,That seems odd to me. I think different network should have different prefixes. Otherwise you risk using the wrong address on the wrong chain...\n,https://github.com/bitcoin/bitcoin/pull/6381#discussion_r34311076,34311076,src/chainparams.cpp
jtimon,2015-07-09T22:30:44Z,"If you always use the same prfix there's no such risk. Again, what could go\nwrong with Alpha or Freicoin for not having unique (again, this doesn't\nscale) prefixes?\n\nIn any case, I'm not only focusing on DRY: I just don't understand what's\nwrong with the static function (assuming there's going to be prefixes\nreuse).\nOn Jul 10, 2015 12:26 AM, ""Pieter Wuille"" notifications@github.com wrote:\n",https://github.com/bitcoin/bitcoin/pull/6381#discussion_r34311499,34311499,src/chainparams.cpp
