[
  {
    "sha": "40e7b61835cbe5fd471d0b4b71972526bf0e523c",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0MGU3YjYxODM1Y2JlNWZkNDcxZDBiNGI3MTk3MjUyNmJmMGU1MjNj",
    "commit": {
      "author": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@gmail.com",
        "date": "2016-02-09T19:23:09Z"
      },
      "committer": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@gmail.com",
        "date": "2016-02-09T19:38:31Z"
      },
      "message": "wallet: Ignore MarkConflict if block hash is not known\n\nIf number of conflict confirms cannot be determined, this means\nthat the block is still unknown or not yet part of the main chain,\nfor example during a reindex. Do nothing in that case,\ninstead of crash with an assertion.\n\nFixes #7234.",
      "tree": {
        "sha": "00e6774a72220e01e04412525f17a6508e7f16bf",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/00e6774a72220e01e04412525f17a6508e7f16bf"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/40e7b61835cbe5fd471d0b4b71972526bf0e523c",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/40e7b61835cbe5fd471d0b4b71972526bf0e523c",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/40e7b61835cbe5fd471d0b4b71972526bf0e523c",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/40e7b61835cbe5fd471d0b4b71972526bf0e523c/comments",
    "author": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "b49a62379900762a39c2f00dcad764076426d954",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b49a62379900762a39c2f00dcad764076426d954",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/b49a62379900762a39c2f00dcad764076426d954"
      }
    ],
    "stats": {
      "total": 17,
      "additions": 11,
      "deletions": 6
    },
    "files": [
      {
        "sha": "65defc30aaecb1e9eb2440c8a977df26b596d3be",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 11,
        "deletions": 6,
        "changes": 17,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/40e7b61835cbe5fd471d0b4b71972526bf0e523c/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/40e7b61835cbe5fd471d0b4b71972526bf0e523c/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=40e7b61835cbe5fd471d0b4b71972526bf0e523c",
        "patch": "@@ -846,14 +846,19 @@ void CWallet::MarkConflicted(const uint256& hashBlock, const uint256& hashTx)\n {\n     LOCK2(cs_main, cs_wallet);\n \n-    CBlockIndex* pindex;\n-    assert(mapBlockIndex.count(hashBlock));\n-    pindex = mapBlockIndex[hashBlock];\n     int conflictconfirms = 0;\n-    if (chainActive.Contains(pindex)) {\n-        conflictconfirms = -(chainActive.Height() - pindex->nHeight + 1);\n+    if (mapBlockIndex.count(hashBlock)) {\n+        CBlockIndex* pindex = mapBlockIndex[hashBlock];\n+        if (chainActive.Contains(pindex)) {\n+            conflictconfirms = -(chainActive.Height() - pindex->nHeight + 1);\n+        }\n     }\n-    assert(conflictconfirms < 0);\n+    // If number of conflict confirms cannot be determined, this means\n+    // that the block is still unknown or not yet part of the main chain,\n+    // for example when loading the wallet during a reindex. Do nothing in that\n+    // case.\n+    if (conflictconfirms >= 0)\n+        return;\n \n     // Do not flush the wallet here for performance reasons\n     CWalletDB walletdb(strWalletFile, \"r+\", false);"
      }
    ]
  }
]