[
  {
    "sha": "6a1b0042116c5bbb6d1a3c8f7a9721fa33abc107",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo2YTFiMDA0MjExNmM1YmJiNmQxYTNjOGY3YTk3MjFmYTMzYWJjMTA3",
    "commit": {
      "author": {
        "name": "pstratem",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-04-08T18:20:00Z"
      },
      "committer": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-07-12T22:00:18Z"
      },
      "message": "modify local address broadcast to reduce correlation between peers",
      "tree": {
        "sha": "0daea9691057547150ab30892931456309e39af7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0daea9691057547150ab30892931456309e39af7"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6a1b0042116c5bbb6d1a3c8f7a9721fa33abc107",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6a1b0042116c5bbb6d1a3c8f7a9721fa33abc107",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/6a1b0042116c5bbb6d1a3c8f7a9721fa33abc107",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6a1b0042116c5bbb6d1a3c8f7a9721fa33abc107/comments",
    "author": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "7cdefb927e928780cdbbb3a9b2ffe37716eebae1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7cdefb927e928780cdbbb3a9b2ffe37716eebae1",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/7cdefb927e928780cdbbb3a9b2ffe37716eebae1"
      }
    ],
    "stats": {
      "total": 27,
      "additions": 9,
      "deletions": 18
    },
    "files": [
      {
        "sha": "3b014da122b94f4a299980ceb405cd7afe03ae7a",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 7,
        "deletions": 18,
        "changes": 25,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6a1b0042116c5bbb6d1a3c8f7a9721fa33abc107/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6a1b0042116c5bbb6d1a3c8f7a9721fa33abc107/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=6a1b0042116c5bbb6d1a3c8f7a9721fa33abc107",
        "patch": "@@ -4770,27 +4770,16 @@ bool SendMessages(CNode* pto, bool fSendTrickle)\n         if (!lockMain)\n             return true;\n \n-        // Address refresh broadcast\n-        static int64_t nLastRebroadcast;\n-        if (!IsInitialBlockDownload() && (GetTime() - nLastRebroadcast > 24 * 60 * 60))\n-        {\n-            LOCK(cs_vNodes);\n-            BOOST_FOREACH(CNode* pnode, vNodes)\n-            {\n-                // Periodically clear addrKnown to allow refresh broadcasts\n-                if (nLastRebroadcast)\n-                    pnode->addrKnown.clear();\n-\n-                // Rebroadcast our address\n-                AdvertizeLocal(pnode);\n-            }\n-            if (!vNodes.empty())\n-                nLastRebroadcast = GetTime();\n-        }\n-\n         //\n         // Message: addr\n         //\n+\n+        if (pto->nNextLocalAddrSend < GetTime()) {\n+            AdvertizeLocal(pto);\n+            pto->setAddrKnown.clear();\n+            pto->nNextLocalAddrSend = GetTime() + GetRand(24 * 60 * 60);\n+        }\n+\n         if (fSendTrickle)\n         {\n             vector<CAddress> vAddr;"
      },
      {
        "sha": "6555b5e6c961bc8ebcd3ae39a0416d30b1c24ad6",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6a1b0042116c5bbb6d1a3c8f7a9721fa33abc107/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6a1b0042116c5bbb6d1a3c8f7a9721fa33abc107/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=6a1b0042116c5bbb6d1a3c8f7a9721fa33abc107",
        "patch": "@@ -2069,6 +2069,7 @@ CNode::CNode(SOCKET hSocketIn, const CAddress& addrIn, const std::string& addrNa\n     hashContinue = uint256();\n     nStartingHeight = -1;\n     fGetAddr = false;\n+    nNextLocalAddrSend = GetTime() + GetRand(24 * 60 * 60);\n     fRelayTxes = false;\n     pfilter = new CBloomFilter();\n     nPingNonceSent = 0;"
      },
      {
        "sha": "44815a0b6136ad9365d71a96155885786e2e1fc6",
        "filename": "src/net.h",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6a1b0042116c5bbb6d1a3c8f7a9721fa33abc107/src/net.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6a1b0042116c5bbb6d1a3c8f7a9721fa33abc107/src/net.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.h?ref=6a1b0042116c5bbb6d1a3c8f7a9721fa33abc107",
        "patch": "@@ -377,6 +377,7 @@ class CNode\n     CRollingBloomFilter addrKnown;\n     bool fGetAddr;\n     std::set<uint256> setKnown;\n+    int64_t nNextLocalAddrSend;\n \n     // inventory based relay\n     mruset<CInv> setInventoryKnown;"
      }
    ]
  },
  {
    "sha": "3504948dc54366bd8aaac7d5748b7e73df5ebe51",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozNTA0OTQ4ZGM1NDM2NmJkOGFhYWM3ZDU3NDhiN2U3M2RmNWViZTUx",
    "commit": {
      "author": {
        "name": "pstratem",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-04-08T18:27:18Z"
      },
      "committer": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-07-12T22:00:18Z"
      },
      "message": "switch addr message trickling logic to use timestamps",
      "tree": {
        "sha": "452560b45bd1ffcfdd73918a4f83d1bdd07485e6",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/452560b45bd1ffcfdd73918a4f83d1bdd07485e6"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3504948dc54366bd8aaac7d5748b7e73df5ebe51",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3504948dc54366bd8aaac7d5748b7e73df5ebe51",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/3504948dc54366bd8aaac7d5748b7e73df5ebe51",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3504948dc54366bd8aaac7d5748b7e73df5ebe51/comments",
    "author": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "6a1b0042116c5bbb6d1a3c8f7a9721fa33abc107",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6a1b0042116c5bbb6d1a3c8f7a9721fa33abc107",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/6a1b0042116c5bbb6d1a3c8f7a9721fa33abc107"
      }
    ],
    "stats": {
      "total": 6,
      "additions": 4,
      "deletions": 2
    },
    "files": [
      {
        "sha": "b0163890c406e10bfde815acffb4f00b0b17d3c1",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3504948dc54366bd8aaac7d5748b7e73df5ebe51/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3504948dc54366bd8aaac7d5748b7e73df5ebe51/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=3504948dc54366bd8aaac7d5748b7e73df5ebe51",
        "patch": "@@ -4780,8 +4780,8 @@ bool SendMessages(CNode* pto, bool fSendTrickle)\n             pto->nNextLocalAddrSend = GetTime() + GetRand(24 * 60 * 60);\n         }\n \n-        if (fSendTrickle)\n-        {\n+        if (pto->nNextAddrSend < GetTime()) {\n+            pto->nNextAddrSend = GetTime() + GetRand(30);\n             vector<CAddress> vAddr;\n             vAddr.reserve(pto->vAddrToSend.size());\n             BOOST_FOREACH(const CAddress& addr, pto->vAddrToSend)"
      },
      {
        "sha": "855c0281adace8ebcdf37dc76bb82f562bb56d04",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3504948dc54366bd8aaac7d5748b7e73df5ebe51/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3504948dc54366bd8aaac7d5748b7e73df5ebe51/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=3504948dc54366bd8aaac7d5748b7e73df5ebe51",
        "patch": "@@ -2069,6 +2069,7 @@ CNode::CNode(SOCKET hSocketIn, const CAddress& addrIn, const std::string& addrNa\n     hashContinue = uint256();\n     nStartingHeight = -1;\n     fGetAddr = false;\n+    nNextAddrSend = GetTime() + GetRand(30);\n     nNextLocalAddrSend = GetTime() + GetRand(24 * 60 * 60);\n     fRelayTxes = false;\n     pfilter = new CBloomFilter();"
      },
      {
        "sha": "1510eb32147e2b5ae7b9e0fb7a92218c8f171e34",
        "filename": "src/net.h",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3504948dc54366bd8aaac7d5748b7e73df5ebe51/src/net.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3504948dc54366bd8aaac7d5748b7e73df5ebe51/src/net.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.h?ref=3504948dc54366bd8aaac7d5748b7e73df5ebe51",
        "patch": "@@ -377,6 +377,7 @@ class CNode\n     CRollingBloomFilter addrKnown;\n     bool fGetAddr;\n     std::set<uint256> setKnown;\n+    int64_t nNextAddrSend;\n     int64_t nNextLocalAddrSend;\n \n     // inventory based relay"
      }
    ]
  },
  {
    "sha": "51f6665df97204c02a8a3a48d6b2c930eeec53ab",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1MWY2NjY1ZGY5NzIwNGMwMmE4YTNhNDhkNmIyYzkzMGVlZWM1M2Fi",
    "commit": {
      "author": {
        "name": "pstratem",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-04-08T18:36:53Z"
      },
      "committer": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-07-12T22:00:18Z"
      },
      "message": "put setAddrKnown.clear() on it's own timer to prevent a coorelation",
      "tree": {
        "sha": "f39a2878f4ded5d8e1a2e2a5942d08d2afd0fb22",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f39a2878f4ded5d8e1a2e2a5942d08d2afd0fb22"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/51f6665df97204c02a8a3a48d6b2c930eeec53ab",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/51f6665df97204c02a8a3a48d6b2c930eeec53ab",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/51f6665df97204c02a8a3a48d6b2c930eeec53ab",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/51f6665df97204c02a8a3a48d6b2c930eeec53ab/comments",
    "author": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "3504948dc54366bd8aaac7d5748b7e73df5ebe51",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3504948dc54366bd8aaac7d5748b7e73df5ebe51",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/3504948dc54366bd8aaac7d5748b7e73df5ebe51"
      }
    ],
    "stats": {
      "total": 8,
      "additions": 7,
      "deletions": 1
    },
    "files": [
      {
        "sha": "90b098b464bb15309cc5f51ed2f02586907caa8a",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 1,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/51f6665df97204c02a8a3a48d6b2c930eeec53ab/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/51f6665df97204c02a8a3a48d6b2c930eeec53ab/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=51f6665df97204c02a8a3a48d6b2c930eeec53ab",
        "patch": "@@ -4776,9 +4776,13 @@ bool SendMessages(CNode* pto, bool fSendTrickle)\n \n         if (pto->nNextLocalAddrSend < GetTime()) {\n             AdvertizeLocal(pto);\n-            pto->setAddrKnown.clear();\n             pto->nNextLocalAddrSend = GetTime() + GetRand(24 * 60 * 60);\n         }\n+        \n+        if (pto->nNextClearSetKnown < GetTime()) {\n+            pto->setAddrKnown.clear();\n+            pto->nNextClearSetKnown = GetTime() + GetRand(12 * 60 * 60);\n+        }\n \n         if (pto->nNextAddrSend < GetTime()) {\n             pto->nNextAddrSend = GetTime() + GetRand(30);"
      },
      {
        "sha": "339da5f962bf9560004e0426d09e167f264cda89",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/51f6665df97204c02a8a3a48d6b2c930eeec53ab/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/51f6665df97204c02a8a3a48d6b2c930eeec53ab/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=51f6665df97204c02a8a3a48d6b2c930eeec53ab",
        "patch": "@@ -2071,6 +2071,7 @@ CNode::CNode(SOCKET hSocketIn, const CAddress& addrIn, const std::string& addrNa\n     fGetAddr = false;\n     nNextAddrSend = GetTime() + GetRand(30);\n     nNextLocalAddrSend = GetTime() + GetRand(24 * 60 * 60);\n+    nNextClearSetKnown = GetTime() + GetRand(12 * 60 * 60);\n     fRelayTxes = false;\n     pfilter = new CBloomFilter();\n     nPingNonceSent = 0;"
      },
      {
        "sha": "866126f1da477ca5c206b397abbe0547dc64900b",
        "filename": "src/net.h",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/51f6665df97204c02a8a3a48d6b2c930eeec53ab/src/net.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/51f6665df97204c02a8a3a48d6b2c930eeec53ab/src/net.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.h?ref=51f6665df97204c02a8a3a48d6b2c930eeec53ab",
        "patch": "@@ -379,6 +379,7 @@ class CNode\n     std::set<uint256> setKnown;\n     int64_t nNextAddrSend;\n     int64_t nNextLocalAddrSend;\n+    int64_t nNextClearSetKnown;\n \n     // inventory based relay\n     mruset<CInv> setInventoryKnown;"
      }
    ]
  },
  {
    "sha": "b8dc779e6a3bdacb2977fc96c3d03ff39ed9e6ff",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiOGRjNzc5ZTZhM2JkYWNiMjk3N2ZjOTZjM2QwM2ZmMzllZDllNmZm",
    "commit": {
      "author": {
        "name": "pstratem",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-04-08T18:46:55Z"
      },
      "committer": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-07-12T22:00:18Z"
      },
      "message": "do not broadcast local addr on connect to outbound peers",
      "tree": {
        "sha": "a980f1c3b4b9ef86b648b76771a7e2f432df5ca3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a980f1c3b4b9ef86b648b76771a7e2f432df5ca3"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b8dc779e6a3bdacb2977fc96c3d03ff39ed9e6ff",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b8dc779e6a3bdacb2977fc96c3d03ff39ed9e6ff",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/b8dc779e6a3bdacb2977fc96c3d03ff39ed9e6ff",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b8dc779e6a3bdacb2977fc96c3d03ff39ed9e6ff/comments",
    "author": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "51f6665df97204c02a8a3a48d6b2c930eeec53ab",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/51f6665df97204c02a8a3a48d6b2c930eeec53ab",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/51f6665df97204c02a8a3a48d6b2c930eeec53ab"
      }
    ],
    "stats": {
      "total": 13,
      "additions": 0,
      "deletions": 13
    },
    "files": [
      {
        "sha": "be5b6b9ff7ce77412ba4df893f6b98afec9e390c",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 0,
        "deletions": 13,
        "changes": 13,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/b8dc779e6a3bdacb2977fc96c3d03ff39ed9e6ff/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/b8dc779e6a3bdacb2977fc96c3d03ff39ed9e6ff/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=b8dc779e6a3bdacb2977fc96c3d03ff39ed9e6ff",
        "patch": "@@ -3884,19 +3884,6 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n \n         if (!pfrom->fInbound)\n         {\n-            // Advertise our address\n-            if (fListen && !IsInitialBlockDownload())\n-            {\n-                CAddress addr = GetLocalAddress(&pfrom->addr);\n-                if (addr.IsRoutable())\n-                {\n-                    pfrom->PushAddress(addr);\n-                } else if (IsPeerAddrLocalGood(pfrom)) {\n-                    addr.SetIP(pfrom->addrLocal);\n-                    pfrom->PushAddress(addr);\n-                }\n-            }\n-\n             // Get recent addresses\n             if (pfrom->fOneShot || pfrom->nVersion >= CADDR_TIME_VERSION || addrman.size() < 1000)\n             {"
      }
    ]
  },
  {
    "sha": "57a82dbd31ce61107854ba31a244317adfae86cf",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1N2E4MmRiZDMxY2U2MTEwNzg1NGJhMzFhMjQ0MzE3YWRmYWU4NmNm",
    "commit": {
      "author": {
        "name": "pstratem",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-04-08T19:30:37Z"
      },
      "committer": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-07-12T22:00:18Z"
      },
      "message": "micro memory optimization",
      "tree": {
        "sha": "ae5f36bb25d6ddbaeecc2d50fe900e1f57e59463",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ae5f36bb25d6ddbaeecc2d50fe900e1f57e59463"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/57a82dbd31ce61107854ba31a244317adfae86cf",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/57a82dbd31ce61107854ba31a244317adfae86cf",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/57a82dbd31ce61107854ba31a244317adfae86cf",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/57a82dbd31ce61107854ba31a244317adfae86cf/comments",
    "author": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "b8dc779e6a3bdacb2977fc96c3d03ff39ed9e6ff",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b8dc779e6a3bdacb2977fc96c3d03ff39ed9e6ff",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/b8dc779e6a3bdacb2977fc96c3d03ff39ed9e6ff"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 1,
      "deletions": 1
    },
    "files": [
      {
        "sha": "34a365c62f6d7813c10498044c5a7500f149f025",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/57a82dbd31ce61107854ba31a244317adfae86cf/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/57a82dbd31ce61107854ba31a244317adfae86cf/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=57a82dbd31ce61107854ba31a244317adfae86cf",
        "patch": "@@ -4774,7 +4774,7 @@ bool SendMessages(CNode* pto, bool fSendTrickle)\n         if (pto->nNextAddrSend < GetTime()) {\n             pto->nNextAddrSend = GetTime() + GetRand(30);\n             vector<CAddress> vAddr;\n-            vAddr.reserve(pto->vAddrToSend.size());\n+            vAddr.reserve(std::min(1000, static_cast<int>(pto->vAddrToSend.size())));\n             BOOST_FOREACH(const CAddress& addr, pto->vAddrToSend)\n             {\n                 if (!pto->addrKnown.contains(addr.GetKey()))"
      }
    ]
  },
  {
    "sha": "cc7c8576b07f6295683ab0d9e7dcf416fc533e6a",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpjYzdjODU3NmIwN2Y2Mjk1NjgzYWIwZDllN2RjZjQxNmZjNTMzZTZh",
    "commit": {
      "author": {
        "name": "pstratem",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-04-08T20:24:42Z"
      },
      "committer": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-07-12T22:00:18Z"
      },
      "message": "Modify MSG_TX trickle logic to use timestamps\n\nclarify expression\n\nremove fSendTrickle flag\n\nshuffle inventory list to send (for good measure)\n\nslight peak memory improvement\n\nuser timestamps for transaction trickle logic\n\nalways send MSG_TX to whitelisted nodes",
      "tree": {
        "sha": "74c368a6261e6f69dd6e7ed26d617a864a78c460",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/74c368a6261e6f69dd6e7ed26d617a864a78c460"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/cc7c8576b07f6295683ab0d9e7dcf416fc533e6a",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/cc7c8576b07f6295683ab0d9e7dcf416fc533e6a",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/cc7c8576b07f6295683ab0d9e7dcf416fc533e6a",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/cc7c8576b07f6295683ab0d9e7dcf416fc533e6a/comments",
    "author": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "57a82dbd31ce61107854ba31a244317adfae86cf",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/57a82dbd31ce61107854ba31a244317adfae86cf",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/57a82dbd31ce61107854ba31a244317adfae86cf"
      }
    ],
    "stats": {
      "total": 84,
      "additions": 41,
      "deletions": 43
    },
    "files": [
      {
        "sha": "918d9cdf81dfeefffff2125555cabd506b15bbab",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 29,
        "deletions": 32,
        "changes": 61,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/cc7c8576b07f6295683ab0d9e7dcf416fc533e6a/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/cc7c8576b07f6295683ab0d9e7dcf416fc533e6a/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=cc7c8576b07f6295683ab0d9e7dcf416fc533e6a",
        "patch": "@@ -4716,7 +4716,7 @@ bool ProcessMessages(CNode* pfrom)\n }\n \n \n-bool SendMessages(CNode* pto, bool fSendTrickle)\n+bool SendMessages(CNode* pto)\n {\n     const Consensus::Params& consensusParams = Params().GetConsensus();\n     {\n@@ -4840,48 +4840,45 @@ bool SendMessages(CNode* pto, bool fSendTrickle)\n         //\n         // Message: inventory\n         //\n-        vector<CInv> vInv;\n-        vector<CInv> vInvWait;\n+        vector<CInv> vInv, vInvWait;\n+\n+        vInv.reserve(1000);\n+        vInvWait.reserve(pto->vInventoryToSend.size());\n+\n         {\n             LOCK(pto->cs_inventory);\n-            vInv.reserve(pto->vInventoryToSend.size());\n-            vInvWait.reserve(pto->vInventoryToSend.size());\n-            BOOST_FOREACH(const CInv& inv, pto->vInventoryToSend)\n-            {\n-                if (pto->setInventoryKnown.count(inv))\n-                    continue;\n-\n-                // trickle out tx inv to protect privacy\n-                if (inv.type == MSG_TX && !fSendTrickle)\n-                {\n-                    // 1/4 of tx invs blast to all immediately\n-                    static uint256 hashSalt;\n-                    if (hashSalt.IsNull())\n-                        hashSalt = GetRandHash();\n-                    uint256 hashRand = ArithToUint256(UintToArith256(inv.hash) ^ UintToArith256(hashSalt));\n-                    hashRand = Hash(BEGIN(hashRand), END(hashRand));\n-                    bool fTrickleWait = ((UintToArith256(hashRand) & 3) != 0);\n \n-                    if (fTrickleWait)\n-                    {\n-                        vInvWait.push_back(inv);\n-                        continue;\n+            BOOST_FOREACH(const CInv& inv, pto->vInventoryToSend) {\n+                // Aggressively push MSG_BLOCK/MSG_FILTERED_BLOCK\n+                if (inv.type == MSG_BLOCK || inv.type == MSG_FILTERED_BLOCK) {\n+                    // returns true if wasn't already contained in the set\n+                    if (pto->setInventoryKnown.insert(inv).second) {\n+                        vInv.push_back(inv);\n+                        pto->PushMessage(\"inv\", vInv);\n+                        vInv.clear();\n                     }\n                 }\n \n-                // returns true if wasn't already contained in the set\n-                if (pto->setInventoryKnown.insert(inv).second)\n-                {\n-                    vInv.push_back(inv);\n-                    if (vInv.size() >= 1000)\n-                    {\n-                        pto->PushMessage(\"inv\", vInv);\n-                        vInv.clear();\n+                if (inv.type == MSG_TX && (pto->nNextInvSend < GetTime() || pto->fWhitelisted)) {\n+                    // returns true if wasn't already contained in the set\n+                    if (pto->setInventoryKnown.insert(inv).second) {\n+                        vInv.push_back(inv);\n+                        if (vInv.size() >= 1000) {\n+                            pto->PushMessage(\"inv\", vInv);\n+                            vInv.clear();\n+                        }\n                     }\n                 }\n+                else\n+                    vInvWait.push_back(inv);\n             }\n+\n             pto->vInventoryToSend = vInvWait;\n         }\n+        \n+        if (pto->nNextInvSend < GetTime())\n+            pto->nNextInvSend = GetTime() + GetRand(10);\n+        \n         if (!vInv.empty())\n             pto->PushMessage(\"inv\", vInv);\n "
      },
      {
        "sha": "2cacda644c47832b8702665be316cf54cae466b6",
        "filename": "src/main.h",
        "status": "modified",
        "additions": 1,
        "deletions": 2,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/cc7c8576b07f6295683ab0d9e7dcf416fc533e6a/src/main.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/cc7c8576b07f6295683ab0d9e7dcf416fc533e6a/src/main.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.h?ref=cc7c8576b07f6295683ab0d9e7dcf416fc533e6a",
        "patch": "@@ -172,9 +172,8 @@ bool ProcessMessages(CNode* pfrom);\n  * Send queued protocol messages to be sent to a give node.\n  *\n  * @param[in]   pto             The node which we are sending messages to.\n- * @param[in]   fSendTrickle    When true send the trickled data, otherwise trickle the data until true.\n  */\n-bool SendMessages(CNode* pto, bool fSendTrickle);\n+bool SendMessages(CNode* pto);\n /** Run an instance of the script checking thread */\n void ThreadScriptCheck();\n /** Try to detect Partition (network isolation) attacks against us */"
      },
      {
        "sha": "6cf79fb2d9342d9c634ab62b090e2688e94cb142",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/cc7c8576b07f6295683ab0d9e7dcf416fc533e6a/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/cc7c8576b07f6295683ab0d9e7dcf416fc533e6a/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=cc7c8576b07f6295683ab0d9e7dcf416fc533e6a",
        "patch": "@@ -1554,7 +1554,7 @@ void ThreadMessageHandler()\n             {\n                 TRY_LOCK(pnode->cs_vSend, lockSend);\n                 if (lockSend)\n-                    g_signals.SendMessages(pnode, pnode == pnodeTrickle || pnode->fWhitelisted);\n+                    g_signals.SendMessages(pnode);\n             }\n             boost::this_thread::interruption_point();\n         }\n@@ -2072,6 +2072,7 @@ CNode::CNode(SOCKET hSocketIn, const CAddress& addrIn, const std::string& addrNa\n     nNextAddrSend = GetTime() + GetRand(30);\n     nNextLocalAddrSend = GetTime() + GetRand(24 * 60 * 60);\n     nNextClearSetKnown = GetTime() + GetRand(12 * 60 * 60);\n+    nNextInvSend = GetTime() + GetRand(10);\n     fRelayTxes = false;\n     pfilter = new CBloomFilter();\n     nPingNonceSent = 0;"
      },
      {
        "sha": "2f21e13d49b6e5afad47c274de7f9f98b07518e0",
        "filename": "src/net.h",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/cc7c8576b07f6295683ab0d9e7dcf416fc533e6a/src/net.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/cc7c8576b07f6295683ab0d9e7dcf416fc533e6a/src/net.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.h?ref=cc7c8576b07f6295683ab0d9e7dcf416fc533e6a",
        "patch": "@@ -100,7 +100,7 @@ struct CNodeSignals\n {\n     boost::signals2::signal<int ()> GetHeight;\n     boost::signals2::signal<bool (CNode*), CombinerAll> ProcessMessages;\n-    boost::signals2::signal<bool (CNode*, bool), CombinerAll> SendMessages;\n+    boost::signals2::signal<bool (CNode*), CombinerAll> SendMessages;\n     boost::signals2::signal<void (NodeId, const CNode*)> InitializeNode;\n     boost::signals2::signal<void (NodeId)> FinalizeNode;\n };\n@@ -386,6 +386,7 @@ class CNode\n     std::vector<CInv> vInventoryToSend;\n     CCriticalSection cs_inventory;\n     std::multimap<int64_t, CInv> mapAskFor;\n+    int64_t nNextInvSend;\n \n     // Ping time measurement:\n     // The pong reply we're expecting, or 0 if no pong expected."
      },
      {
        "sha": "11bbcace3d53befe70a8dca46138e9017fbb5a17",
        "filename": "src/test/DoS_tests.cpp",
        "status": "modified",
        "additions": 7,
        "deletions": 7,
        "changes": 14,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/cc7c8576b07f6295683ab0d9e7dcf416fc533e6a/src/test/DoS_tests.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/cc7c8576b07f6295683ab0d9e7dcf416fc533e6a/src/test/DoS_tests.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/DoS_tests.cpp?ref=cc7c8576b07f6295683ab0d9e7dcf416fc533e6a",
        "patch": "@@ -52,19 +52,19 @@ BOOST_AUTO_TEST_CASE(DoS_banning)\n     CNode dummyNode1(INVALID_SOCKET, addr1, \"\", true);\n     dummyNode1.nVersion = 1;\n     Misbehaving(dummyNode1.GetId(), 100); // Should get banned\n-    SendMessages(&dummyNode1, false);\n+    SendMessages(&dummyNode1);\n     BOOST_CHECK(CNode::IsBanned(addr1));\n     BOOST_CHECK(!CNode::IsBanned(ip(0xa0b0c001|0x0000ff00))); // Different IP, not banned\n \n     CAddress addr2(ip(0xa0b0c002));\n     CNode dummyNode2(INVALID_SOCKET, addr2, \"\", true);\n     dummyNode2.nVersion = 1;\n     Misbehaving(dummyNode2.GetId(), 50);\n-    SendMessages(&dummyNode2, false);\n+    SendMessages(&dummyNode2);\n     BOOST_CHECK(!CNode::IsBanned(addr2)); // 2 not banned yet...\n     BOOST_CHECK(CNode::IsBanned(addr1));  // ... but 1 still should be\n     Misbehaving(dummyNode2.GetId(), 50);\n-    SendMessages(&dummyNode2, false);\n+    SendMessages(&dummyNode2);\n     BOOST_CHECK(CNode::IsBanned(addr2));\n }\n \n@@ -76,13 +76,13 @@ BOOST_AUTO_TEST_CASE(DoS_banscore)\n     CNode dummyNode1(INVALID_SOCKET, addr1, \"\", true);\n     dummyNode1.nVersion = 1;\n     Misbehaving(dummyNode1.GetId(), 100);\n-    SendMessages(&dummyNode1, false);\n+    SendMessages(&dummyNode1);\n     BOOST_CHECK(!CNode::IsBanned(addr1));\n     Misbehaving(dummyNode1.GetId(), 10);\n-    SendMessages(&dummyNode1, false);\n+    SendMessages(&dummyNode1);\n     BOOST_CHECK(!CNode::IsBanned(addr1));\n     Misbehaving(dummyNode1.GetId(), 1);\n-    SendMessages(&dummyNode1, false);\n+    SendMessages(&dummyNode1);\n     BOOST_CHECK(CNode::IsBanned(addr1));\n     mapArgs.erase(\"-banscore\");\n }\n@@ -98,7 +98,7 @@ BOOST_AUTO_TEST_CASE(DoS_bantime)\n     dummyNode.nVersion = 1;\n \n     Misbehaving(dummyNode.GetId(), 100);\n-    SendMessages(&dummyNode, false);\n+    SendMessages(&dummyNode);\n     BOOST_CHECK(CNode::IsBanned(addr));\n \n     SetMockTime(nStartTime+60*60);"
      }
    ]
  },
  {
    "sha": "f7cb9b25ce2cefb86c1e46486621c75b12bfdc54",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmN2NiOWIyNWNlMmNlZmI4NmMxZTQ2NDg2NjIxYzc1YjEyYmZkYzU0",
    "commit": {
      "author": {
        "name": "pstratem",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-04-09T21:31:21Z"
      },
      "committer": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-07-12T22:00:18Z"
      },
      "message": "walk vInventoryToSend in random order to further obscure timing information",
      "tree": {
        "sha": "25f867bd67a8cfe374b27799f130c26f5cd96192",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/25f867bd67a8cfe374b27799f130c26f5cd96192"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f7cb9b25ce2cefb86c1e46486621c75b12bfdc54",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f7cb9b25ce2cefb86c1e46486621c75b12bfdc54",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/f7cb9b25ce2cefb86c1e46486621c75b12bfdc54",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f7cb9b25ce2cefb86c1e46486621c75b12bfdc54/comments",
    "author": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "cc7c8576b07f6295683ab0d9e7dcf416fc533e6a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/cc7c8576b07f6295683ab0d9e7dcf416fc533e6a",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/cc7c8576b07f6295683ab0d9e7dcf416fc533e6a"
      }
    ],
    "stats": {
      "total": 3,
      "additions": 3,
      "deletions": 0
    },
    "files": [
      {
        "sha": "2443d594112d16cdec989aa8733bbb7fe4762007",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f7cb9b25ce2cefb86c1e46486621c75b12bfdc54/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f7cb9b25ce2cefb86c1e46486621c75b12bfdc54/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=f7cb9b25ce2cefb86c1e46486621c75b12bfdc54",
        "patch": "@@ -4847,6 +4847,9 @@ bool SendMessages(CNode* pto)\n \n         {\n             LOCK(pto->cs_inventory);\n+            \n+            // TODO it would be sufficient to walk vInventoryToSend randomly, shuffling is relatively inefficient\n+            std::random_shuffle(pto->vInventoryToSend.begin(), pto->vInventoryToSend.end());\n \n             BOOST_FOREACH(const CInv& inv, pto->vInventoryToSend) {\n                 // Aggressively push MSG_BLOCK/MSG_FILTERED_BLOCK"
      }
    ]
  },
  {
    "sha": "61ef89fabfd80844127e8238381652d6925f67b1",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo2MWVmODlmYWJmZDgwODQ0MTI3ZTgyMzgzODE2NTJkNjkyNWY2N2Ix",
    "commit": {
      "author": {
        "name": "pstratem",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-04-09T21:40:16Z"
      },
      "committer": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-07-12T22:00:18Z"
      },
      "message": "restructure as switch statement",
      "tree": {
        "sha": "a400d75968abbb64eaf894858ea27b366f0aa18c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a400d75968abbb64eaf894858ea27b366f0aa18c"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/61ef89fabfd80844127e8238381652d6925f67b1",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/61ef89fabfd80844127e8238381652d6925f67b1",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/61ef89fabfd80844127e8238381652d6925f67b1",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/61ef89fabfd80844127e8238381652d6925f67b1/comments",
    "author": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "f7cb9b25ce2cefb86c1e46486621c75b12bfdc54",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f7cb9b25ce2cefb86c1e46486621c75b12bfdc54",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/f7cb9b25ce2cefb86c1e46486621c75b12bfdc54"
      }
    ],
    "stats": {
      "total": 49,
      "additions": 32,
      "deletions": 17
    },
    "files": [
      {
        "sha": "7aff965220872e74822aa18a9aa862239f1b3487",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 32,
        "deletions": 17,
        "changes": 49,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/61ef89fabfd80844127e8238381652d6925f67b1/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/61ef89fabfd80844127e8238381652d6925f67b1/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=61ef89fabfd80844127e8238381652d6925f67b1",
        "patch": "@@ -4852,39 +4852,54 @@ bool SendMessages(CNode* pto)\n             std::random_shuffle(pto->vInventoryToSend.begin(), pto->vInventoryToSend.end());\n \n             BOOST_FOREACH(const CInv& inv, pto->vInventoryToSend) {\n-                // Aggressively push MSG_BLOCK/MSG_FILTERED_BLOCK\n-                if (inv.type == MSG_BLOCK || inv.type == MSG_FILTERED_BLOCK) {\n-                    // returns true if wasn't already contained in the set\n-                    if (pto->setInventoryKnown.insert(inv).second) {\n-                        vInv.push_back(inv);\n-                        pto->PushMessage(\"inv\", vInv);\n-                        vInv.clear();\n+                switch(inv.type) {\n+                    case MSG_BLOCK:\n+                    case MSG_FILTERED_BLOCK:\n+                    {\n+                        // Aggressively push MSG_BLOCK/MSG_FILTERED_BLOCK\n+                        if (pto->setInventoryKnown.insert(inv).second) {\n+                            vInv.push_back(inv);\n+                            pto->PushMessage(\"inv\", vInv);\n+                            vInv.clear();\n+                        }\n+                        break;\n                     }\n-                }\n+                    case MSG_TX:\n+                    {\n+                        if (pto->nNextInvSend < GetTime() || pto->fWhitelisted) {\n+                            if (pto->setInventoryKnown.insert(inv).second) {\n+                                vInv.push_back(inv);\n+                                if (vInv.size() >= 1000) {\n+                                    pto->PushMessage(\"inv\", vInv);\n+                                    vInv.clear();\n+                                }\n+                            }\n+                        }\n+                        else\n+                            vInvWait.push_back(inv);\n \n-                if (inv.type == MSG_TX && (pto->nNextInvSend < GetTime() || pto->fWhitelisted)) {\n-                    // returns true if wasn't already contained in the set\n-                    if (pto->setInventoryKnown.insert(inv).second) {\n+                        break;\n+                    }\n+                    default:\n+                    {\n                         vInv.push_back(inv);\n                         if (vInv.size() >= 1000) {\n                             pto->PushMessage(\"inv\", vInv);\n                             vInv.clear();\n                         }\n                     }\n                 }\n-                else\n-                    vInvWait.push_back(inv);\n             }\n \n             pto->vInventoryToSend = vInvWait;\n         }\n-        \n-        if (pto->nNextInvSend < GetTime())\n-            pto->nNextInvSend = GetTime() + GetRand(10);\n-        \n+\n         if (!vInv.empty())\n             pto->PushMessage(\"inv\", vInv);\n \n+        if (pto->nNextInvSend < GetTime())\n+            pto->nNextInvSend = GetTime() + GetRand(10);\n+\n         // Detect whether we're stalling\n         int64_t nNow = GetTimeMicros();\n         if (!pto->fDisconnect && state.nStallingSince && state.nStallingSince < nNow - 1000000 * BLOCK_STALLING_TIMEOUT) {"
      }
    ]
  },
  {
    "sha": "875669d177de5840f21b31508fcb92a902ff234a",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4NzU2NjlkMTc3ZGU1ODQwZjIxYjMxNTA4ZmNiOTJhOTAyZmYyMzRh",
    "commit": {
      "author": {
        "name": "pstratem",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-04-09T21:49:56Z"
      },
      "committer": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-07-12T22:00:18Z"
      },
      "message": "call GetTime() once, simplifies reasoning around timestamp based operations",
      "tree": {
        "sha": "6aff971eb0dd507b4b79d2237160afdc76054c8f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6aff971eb0dd507b4b79d2237160afdc76054c8f"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/875669d177de5840f21b31508fcb92a902ff234a",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/875669d177de5840f21b31508fcb92a902ff234a",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/875669d177de5840f21b31508fcb92a902ff234a",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/875669d177de5840f21b31508fcb92a902ff234a/comments",
    "author": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "61ef89fabfd80844127e8238381652d6925f67b1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/61ef89fabfd80844127e8238381652d6925f67b1",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/61ef89fabfd80844127e8238381652d6925f67b1"
      }
    ],
    "stats": {
      "total": 23,
      "additions": 13,
      "deletions": 10
    },
    "files": [
      {
        "sha": "2d8cde9bc5f793e845dabd23adfdf057f04bd3eb",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 13,
        "deletions": 10,
        "changes": 23,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/875669d177de5840f21b31508fcb92a902ff234a/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/875669d177de5840f21b31508fcb92a902ff234a/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=875669d177de5840f21b31508fcb92a902ff234a",
        "patch": "@@ -4841,9 +4841,12 @@ bool SendMessages(CNode* pto)\n         // Message: inventory\n         //\n         vector<CInv> vInv, vInvWait;\n+        int64_t nNow = GetTime();\n \n         vInv.reserve(1000);\n-        vInvWait.reserve(pto->vInventoryToSend.size());\n+        \n+        if (pto->nNextInvSend < nNow)\n+            vInvWait.reserve(pto->vInventoryToSend.size());\n \n         {\n             LOCK(pto->cs_inventory);\n@@ -4866,7 +4869,7 @@ bool SendMessages(CNode* pto)\n                     }\n                     case MSG_TX:\n                     {\n-                        if (pto->nNextInvSend < GetTime() || pto->fWhitelisted) {\n+                        if (pto->nNextInvSend < nNow || pto->fWhitelisted) {\n                             if (pto->setInventoryKnown.insert(inv).second) {\n                                 vInv.push_back(inv);\n                                 if (vInv.size() >= 1000) {\n@@ -4897,12 +4900,12 @@ bool SendMessages(CNode* pto)\n         if (!vInv.empty())\n             pto->PushMessage(\"inv\", vInv);\n \n-        if (pto->nNextInvSend < GetTime())\n-            pto->nNextInvSend = GetTime() + GetRand(10);\n+        if (pto->nNextInvSend < nNow)\n+            pto->nNextInvSend = nNow + GetRand(10);\n \n         // Detect whether we're stalling\n-        int64_t nNow = GetTimeMicros();\n-        if (!pto->fDisconnect && state.nStallingSince && state.nStallingSince < nNow - 1000000 * BLOCK_STALLING_TIMEOUT) {\n+        int64_t nNowMicros = GetTimeMicros();\n+        if (!pto->fDisconnect && state.nStallingSince && state.nStallingSince < nNowMicros - 1000000 * BLOCK_STALLING_TIMEOUT) {\n             // Stalling only triggers when the block download window cannot move. During normal steady state,\n             // the download window should be much larger than the to-be-downloaded set of blocks, so disconnection\n             // should only happen during initial block download.\n@@ -4921,12 +4924,12 @@ bool SendMessages(CNode* pto)\n         // more quickly than once every 5 minutes, then we'll shorten the download window for this block).\n         if (!pto->fDisconnect && state.vBlocksInFlight.size() > 0) {\n             QueuedBlock &queuedBlock = state.vBlocksInFlight.front();\n-            int64_t nTimeoutIfRequestedNow = GetBlockTimeout(nNow, nQueuedValidatedHeaders - state.nBlocksInFlightValidHeaders, consensusParams);\n+            int64_t nTimeoutIfRequestedNow = GetBlockTimeout(nNowMicros, nQueuedValidatedHeaders - state.nBlocksInFlightValidHeaders, consensusParams);\n             if (queuedBlock.nTimeDisconnect > nTimeoutIfRequestedNow) {\n                 LogPrint(\"net\", \"Reducing block download timeout for peer=%d block=%s, orig=%d new=%d\\n\", pto->id, queuedBlock.hash.ToString(), queuedBlock.nTimeDisconnect, nTimeoutIfRequestedNow);\n                 queuedBlock.nTimeDisconnect = nTimeoutIfRequestedNow;\n             }\n-            if (queuedBlock.nTimeDisconnect < nNow) {\n+            if (queuedBlock.nTimeDisconnect < nNowMicros) {\n                 LogPrintf(\"Timeout downloading block %s from peer=%d, disconnecting\\n\", queuedBlock.hash.ToString(), pto->id);\n                 pto->fDisconnect = true;\n             }\n@@ -4948,7 +4951,7 @@ bool SendMessages(CNode* pto)\n             }\n             if (state.nBlocksInFlight == 0 && staller != -1) {\n                 if (State(staller)->nStallingSince == 0) {\n-                    State(staller)->nStallingSince = nNow;\n+                    State(staller)->nStallingSince = nNowMicros;\n                     LogPrint(\"net\", \"Stall started peer=%d\\n\", staller);\n                 }\n             }\n@@ -4957,7 +4960,7 @@ bool SendMessages(CNode* pto)\n         //\n         // Message: getdata (non-blocks)\n         //\n-        while (!pto->fDisconnect && !pto->mapAskFor.empty() && (*pto->mapAskFor.begin()).first <= nNow)\n+        while (!pto->fDisconnect && !pto->mapAskFor.empty() && (*pto->mapAskFor.begin()).first <= nNowMicros)\n         {\n             const CInv& inv = (*pto->mapAskFor.begin()).second;\n             if (!AlreadyHave(inv))"
      }
    ]
  },
  {
    "sha": "35464e45607aee43564d0c560de64beb73c5f728",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozNTQ2NGU0NTYwN2FlZTQzNTY0ZDBjNTYwZGU2NGJlYjczYzVmNzI4",
    "commit": {
      "author": {
        "name": "pstratem",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-04-10T20:29:41Z"
      },
      "committer": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-07-12T22:00:18Z"
      },
      "message": "switch to microseconds\n\nimproves the reoslution to the polling frequency from 1 second",
      "tree": {
        "sha": "31cf34b542f1fd88793b62a07d8cb90a5e335240",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/31cf34b542f1fd88793b62a07d8cb90a5e335240"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/35464e45607aee43564d0c560de64beb73c5f728",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/35464e45607aee43564d0c560de64beb73c5f728",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/35464e45607aee43564d0c560de64beb73c5f728",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/35464e45607aee43564d0c560de64beb73c5f728/comments",
    "author": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "875669d177de5840f21b31508fcb92a902ff234a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/875669d177de5840f21b31508fcb92a902ff234a",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/875669d177de5840f21b31508fcb92a902ff234a"
      }
    ],
    "stats": {
      "total": 35,
      "additions": 18,
      "deletions": 17
    },
    "files": [
      {
        "sha": "265796aebb2eda04b1dc227844e5af6636c9a2f4",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 14,
        "deletions": 13,
        "changes": 27,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/35464e45607aee43564d0c560de64beb73c5f728/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/35464e45607aee43564d0c560de64beb73c5f728/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=35464e45607aee43564d0c560de64beb73c5f728",
        "patch": "@@ -4761,18 +4761,19 @@ bool SendMessages(CNode* pto)\n         // Message: addr\n         //\n \n-        if (pto->nNextLocalAddrSend < GetTime()) {\n+        int64_t nNowMicros = GetTimeMicros();\n+        if (pto->nNextLocalAddrSend < nNowMicros) {\n             AdvertizeLocal(pto);\n-            pto->nNextLocalAddrSend = GetTime() + GetRand(24 * 60 * 60);\n+            pto->nNextLocalAddrSend = nNowMicros + 1000 * (int64_t)GetRand(24 * 60 * 60 * 1000);\n         }\n-        \n-        if (pto->nNextClearSetKnown < GetTime()) {\n+\n+        if (pto->nNextClearSetKnown < nNowMicros) {\n             pto->setAddrKnown.clear();\n-            pto->nNextClearSetKnown = GetTime() + GetRand(12 * 60 * 60);\n+            pto->nNextClearSetKnown = nNowMicros + 1000 * (int64_t)GetRand(12 * 60 * 60 * 1000);\n         }\n \n-        if (pto->nNextAddrSend < GetTime()) {\n-            pto->nNextAddrSend = GetTime() + GetRand(30);\n+        if (pto->nNextAddrSend < nNowMicros) {\n+            pto->nNextAddrSend = nNowMicros + GetRand(30 * 1000000);\n             vector<CAddress> vAddr;\n             vAddr.reserve(std::min(1000, static_cast<int>(pto->vAddrToSend.size())));\n             BOOST_FOREACH(const CAddress& addr, pto->vAddrToSend)\n@@ -4841,11 +4842,11 @@ bool SendMessages(CNode* pto)\n         // Message: inventory\n         //\n         vector<CInv> vInv, vInvWait;\n-        int64_t nNow = GetTime();\n+        nNowMicros = GetTimeMicros();\n \n         vInv.reserve(1000);\n         \n-        if (pto->nNextInvSend < nNow)\n+        if (pto->nNextInvSend < nNowMicros)\n             vInvWait.reserve(pto->vInventoryToSend.size());\n \n         {\n@@ -4869,7 +4870,7 @@ bool SendMessages(CNode* pto)\n                     }\n                     case MSG_TX:\n                     {\n-                        if (pto->nNextInvSend < nNow || pto->fWhitelisted) {\n+                        if (pto->nNextInvSend < nNowMicros || pto->fWhitelisted) {\n                             if (pto->setInventoryKnown.insert(inv).second) {\n                                 vInv.push_back(inv);\n                                 if (vInv.size() >= 1000) {\n@@ -4900,11 +4901,11 @@ bool SendMessages(CNode* pto)\n         if (!vInv.empty())\n             pto->PushMessage(\"inv\", vInv);\n \n-        if (pto->nNextInvSend < nNow)\n-            pto->nNextInvSend = nNow + GetRand(10);\n+        if (pto->nNextInvSend < nNowMicros)\n+            pto->nNextInvSend = nNowMicros + GetRand(10 * 1000000);\n \n         // Detect whether we're stalling\n-        int64_t nNowMicros = GetTimeMicros();\n+        nNowMicros = GetTimeMicros();\n         if (!pto->fDisconnect && state.nStallingSince && state.nStallingSince < nNowMicros - 1000000 * BLOCK_STALLING_TIMEOUT) {\n             // Stalling only triggers when the block download window cannot move. During normal steady state,\n             // the download window should be much larger than the to-be-downloaded set of blocks, so disconnection"
      },
      {
        "sha": "c26317d9220ab9e18674b879189d5ca9ad557f7b",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 4,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/35464e45607aee43564d0c560de64beb73c5f728/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/35464e45607aee43564d0c560de64beb73c5f728/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=35464e45607aee43564d0c560de64beb73c5f728",
        "patch": "@@ -2069,10 +2069,10 @@ CNode::CNode(SOCKET hSocketIn, const CAddress& addrIn, const std::string& addrNa\n     hashContinue = uint256();\n     nStartingHeight = -1;\n     fGetAddr = false;\n-    nNextAddrSend = GetTime() + GetRand(30);\n-    nNextLocalAddrSend = GetTime() + GetRand(24 * 60 * 60);\n-    nNextClearSetKnown = GetTime() + GetRand(12 * 60 * 60);\n-    nNextInvSend = GetTime() + GetRand(10);\n+    nNextAddrSend = GetTimeMicros() + GetRand(30 * 1000000);\n+    nNextLocalAddrSend = GetTimeMicros() + 1000 * (int64_t)GetRand(24 * 60 * 60 * 1000);\n+    nNextClearSetKnown = GetTimeMicros() + 1000 * (int64_t)GetRand(12 * 60 * 60 * 1000);\n+    nNextInvSend = GetTimeMicros() + GetRand(10 * 1000000);\n     fRelayTxes = false;\n     pfilter = new CBloomFilter();\n     nPingNonceSent = 0;"
      }
    ]
  },
  {
    "sha": "2f6308ea34d291d7622eeb769337cdf1272da77f",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyZjYzMDhlYTM0ZDI5MWQ3NjIyZWViNzY5MzM3Y2RmMTI3MmRhNzdm",
    "commit": {
      "author": {
        "name": "pstratem",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-04-11T16:49:31Z"
      },
      "committer": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-07-12T22:00:18Z"
      },
      "message": "remove unused pnodeTrickle",
      "tree": {
        "sha": "522a67ec18bcfa619446a3af571afb7b0feff311",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/522a67ec18bcfa619446a3af571afb7b0feff311"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2f6308ea34d291d7622eeb769337cdf1272da77f",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2f6308ea34d291d7622eeb769337cdf1272da77f",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/2f6308ea34d291d7622eeb769337cdf1272da77f",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2f6308ea34d291d7622eeb769337cdf1272da77f/comments",
    "author": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "35464e45607aee43564d0c560de64beb73c5f728",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/35464e45607aee43564d0c560de64beb73c5f728",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/35464e45607aee43564d0c560de64beb73c5f728"
      }
    ],
    "stats": {
      "total": 5,
      "additions": 0,
      "deletions": 5
    },
    "files": [
      {
        "sha": "9979e988aee45391a1ff88c37ee3f525b27866ce",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 0,
        "deletions": 5,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2f6308ea34d291d7622eeb769337cdf1272da77f/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2f6308ea34d291d7622eeb769337cdf1272da77f/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=2f6308ea34d291d7622eeb769337cdf1272da77f",
        "patch": "@@ -1519,11 +1519,6 @@ void ThreadMessageHandler()\n             }\n         }\n \n-        // Poll the connected nodes for messages\n-        CNode* pnodeTrickle = NULL;\n-        if (!vNodesCopy.empty())\n-            pnodeTrickle = vNodesCopy[GetRand(vNodesCopy.size())];\n-\n         bool fSleep = true;\n \n         BOOST_FOREACH(CNode* pnode, vNodesCopy)"
      }
    ]
  },
  {
    "sha": "59f2b32ec8f7608be5b9d8a64eaae4081c5f242e",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1OWYyYjMyZWM4Zjc2MDhiZTViOWQ4YTY0ZWFhZTQwODFjNWYyNDJl",
    "commit": {
      "author": {
        "name": "pstratem",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-04-11T16:51:06Z"
      },
      "committer": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-07-12T22:00:18Z"
      },
      "message": "separate block inv queue with no trickle",
      "tree": {
        "sha": "a023ee9142f4c647baca9b26050b102d20d9c67e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a023ee9142f4c647baca9b26050b102d20d9c67e"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/59f2b32ec8f7608be5b9d8a64eaae4081c5f242e",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/59f2b32ec8f7608be5b9d8a64eaae4081c5f242e",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/59f2b32ec8f7608be5b9d8a64eaae4081c5f242e",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/59f2b32ec8f7608be5b9d8a64eaae4081c5f242e/comments",
    "author": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "2f6308ea34d291d7622eeb769337cdf1272da77f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2f6308ea34d291d7622eeb769337cdf1272da77f",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/2f6308ea34d291d7622eeb769337cdf1272da77f"
      }
    ],
    "stats": {
      "total": 46,
      "additions": 31,
      "deletions": 15
    },
    "files": [
      {
        "sha": "f2eebda581c51e8c7688a6755da3a09941582b9c",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 14,
        "deletions": 12,
        "changes": 26,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/59f2b32ec8f7608be5b9d8a64eaae4081c5f242e/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/59f2b32ec8f7608be5b9d8a64eaae4081c5f242e/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=59f2b32ec8f7608be5b9d8a64eaae4081c5f242e",
        "patch": "@@ -4845,7 +4845,20 @@ bool SendMessages(CNode* pto)\n         nNowMicros = GetTimeMicros();\n \n         vInv.reserve(1000);\n-        \n+\n+        {\n+            LOCK(pto->cs_inventory);\n+\n+            BOOST_FOREACH(const CInv& inv, pto->vBlockInventoryToSend) {\n+                // Aggressively push MSG_BLOCK/MSG_FILTERED_BLOCK\n+                if (pto->setInventoryKnown.insert(inv).second) {\n+                    vInv.push_back(inv);\n+                    pto->PushMessage(\"inv\", vInv);\n+                    vInv.clear();\n+                }\n+            }\n+        }\n+\n         if (pto->nNextInvSend < nNowMicros)\n             vInvWait.reserve(pto->vInventoryToSend.size());\n \n@@ -4857,17 +4870,6 @@ bool SendMessages(CNode* pto)\n \n             BOOST_FOREACH(const CInv& inv, pto->vInventoryToSend) {\n                 switch(inv.type) {\n-                    case MSG_BLOCK:\n-                    case MSG_FILTERED_BLOCK:\n-                    {\n-                        // Aggressively push MSG_BLOCK/MSG_FILTERED_BLOCK\n-                        if (pto->setInventoryKnown.insert(inv).second) {\n-                            vInv.push_back(inv);\n-                            pto->PushMessage(\"inv\", vInv);\n-                            vInv.clear();\n-                        }\n-                        break;\n-                    }\n                     case MSG_TX:\n                     {\n                         if (pto->nNextInvSend < nNowMicros || pto->fWhitelisted) {"
      },
      {
        "sha": "bd92d494d2e0e7f125da11f71247d62b91f80408",
        "filename": "src/net.h",
        "status": "modified",
        "additions": 17,
        "deletions": 3,
        "changes": 20,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/59f2b32ec8f7608be5b9d8a64eaae4081c5f242e/src/net.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/59f2b32ec8f7608be5b9d8a64eaae4081c5f242e/src/net.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.h?ref=59f2b32ec8f7608be5b9d8a64eaae4081c5f242e",
        "patch": "@@ -384,6 +384,7 @@ class CNode\n     // inventory based relay\n     mruset<CInv> setInventoryKnown;\n     std::vector<CInv> vInventoryToSend;\n+    std::vector<CInv> vBlockInventoryToSend;\n     CCriticalSection cs_inventory;\n     std::multimap<int64_t, CInv> mapAskFor;\n     int64_t nNextInvSend;\n@@ -486,10 +487,23 @@ class CNode\n \n     void PushInventory(const CInv& inv)\n     {\n+        switch(inv.type)\n         {\n-            LOCK(cs_inventory);\n-            if (!setInventoryKnown.count(inv))\n-                vInventoryToSend.push_back(inv);\n+            case MSG_BLOCK:\n+            case MSG_FILTERED_BLOCK:\n+            {\n+                LOCK(cs_inventory);\n+                if (!setInventoryKnown.count(inv))\n+                    vBlockInventoryToSend.push_back(inv);\n+                break;\n+            }\n+            default:\n+            {\n+                LOCK(cs_inventory);\n+                if (!setInventoryKnown.count(inv))\n+                    vInventoryToSend.push_back(inv);\n+                break;\n+            }\n         }\n     }\n "
      }
    ]
  },
  {
    "sha": "507cd8bcaaabf7d916e02b8018b435f31f65f7d0",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1MDdjZDhiY2FhYWJmN2Q5MTZlMDJiODAxOGI0MzVmMzFmNjVmN2Qw",
    "commit": {
      "author": {
        "name": "pstratem",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-04-11T16:51:58Z"
      },
      "committer": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-07-12T22:00:18Z"
      },
      "message": "secure random walk of vInventoryToSend",
      "tree": {
        "sha": "4425be98b4bb678b68ecdf2f4c9eac28dec4eeac",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4425be98b4bb678b68ecdf2f4c9eac28dec4eeac"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/507cd8bcaaabf7d916e02b8018b435f31f65f7d0",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/507cd8bcaaabf7d916e02b8018b435f31f65f7d0",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/507cd8bcaaabf7d916e02b8018b435f31f65f7d0",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/507cd8bcaaabf7d916e02b8018b435f31f65f7d0/comments",
    "author": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "59f2b32ec8f7608be5b9d8a64eaae4081c5f242e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/59f2b32ec8f7608be5b9d8a64eaae4081c5f242e",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/59f2b32ec8f7608be5b9d8a64eaae4081c5f242e"
      }
    ],
    "stats": {
      "total": 16,
      "additions": 12,
      "deletions": 4
    },
    "files": [
      {
        "sha": "6af08cc142bd19243e81f97f45f64e8d46ed315e",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 12,
        "deletions": 4,
        "changes": 16,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/507cd8bcaaabf7d916e02b8018b435f31f65f7d0/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/507cd8bcaaabf7d916e02b8018b435f31f65f7d0/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=507cd8bcaaabf7d916e02b8018b435f31f65f7d0",
        "patch": "@@ -4864,11 +4864,19 @@ bool SendMessages(CNode* pto)\n \n         {\n             LOCK(pto->cs_inventory);\n-            \n-            // TODO it would be sufficient to walk vInventoryToSend randomly, shuffling is relatively inefficient\n-            std::random_shuffle(pto->vInventoryToSend.begin(), pto->vInventoryToSend.end());\n \n-            BOOST_FOREACH(const CInv& inv, pto->vInventoryToSend) {\n+            std::vector<int> vRandInv;\n+            vRandInv.resize(pto->vInventoryToSend.size());\n+\n+            for (size_t i = 0; i < pto->vInventoryToSend.size(); i++)\n+                vRandInv[i] = i;\n+\n+            for (size_t i = 0; i < vRandInv.size(); i++)\n+                std::swap(vRandInv[i], vRandInv[i + GetRand(vRandInv.size() - i)]);\n+\n+            for (size_t i = 0; i < vRandInv.size(); i++) {\n+                const CInv& inv = pto->vInventoryToSend[vRandInv[i]];\n+\n                 switch(inv.type) {\n                     case MSG_TX:\n                     {"
      }
    ]
  },
  {
    "sha": "f2cb99e318a7dfe1630d8500d85fb20cbabd0553",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmMmNiOTllMzE4YTdkZmUxNjMwZDg1MDBkODVmYjIwY2JhYmQwNTUz",
    "commit": {
      "author": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-07-12T22:00:31Z"
      },
      "committer": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-07-12T22:00:31Z"
      },
      "message": "collect block inv messages",
      "tree": {
        "sha": "e9574575608c1d7f2ee30b10f21287a3045c5d30",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e9574575608c1d7f2ee30b10f21287a3045c5d30"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f2cb99e318a7dfe1630d8500d85fb20cbabd0553",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQEcBAABAgAGBQJVouOBAAoJEHfoBoKoPbQOjMsH/1WotMonB4MEooyIE6L14Hcf\nVEni/ZVhRxS1Z1jfO3C57Nrc3ouOWBkVPUaT7viDNOJJC6JqdAXN7uyol0uM94xY\n0q54ayDNtIpE8nIM3Ul9nf7RBPbG/5qppMPpLLxzsWR45HDReZpJiWk18v4bExiA\n1alhYVmHDLCgDPqhnrlPJVD6r+eigUusX57H1L5DFspUM5MRAaVVCxlL68YWReVk\nGRqsvDp3QGwfWqEgpUZWAilRZ7Cva2PNlndt1jBf3rn7u8AVBoe2KGTYRaiTkA5u\nR6cCtgG/Qy8vBrqGOBTQweTMV3mCwlg2eP17OZztbyQifeBbplY3sLMyDHtUw1M=\n=zmqn\n-----END PGP SIGNATURE-----",
        "payload": "tree e9574575608c1d7f2ee30b10f21287a3045c5d30\nparent 507cd8bcaaabf7d916e02b8018b435f31f65f7d0\nauthor Patrick Strateman <patrick.strateman@gmail.com> 1436738431 -0700\ncommitter Patrick Strateman <patrick.strateman@gmail.com> 1436738431 -0700\n\ncollect block inv messages\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f2cb99e318a7dfe1630d8500d85fb20cbabd0553",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/f2cb99e318a7dfe1630d8500d85fb20cbabd0553",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f2cb99e318a7dfe1630d8500d85fb20cbabd0553/comments",
    "author": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "507cd8bcaaabf7d916e02b8018b435f31f65f7d0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/507cd8bcaaabf7d916e02b8018b435f31f65f7d0",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/507cd8bcaaabf7d916e02b8018b435f31f65f7d0"
      }
    ],
    "stats": {
      "total": 17,
      "additions": 13,
      "deletions": 4
    },
    "files": [
      {
        "sha": "9419a7c0113f0c3f072ac3fc20259d3a09551b53",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 13,
        "deletions": 4,
        "changes": 17,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f2cb99e318a7dfe1630d8500d85fb20cbabd0553/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f2cb99e318a7dfe1630d8500d85fb20cbabd0553/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=f2cb99e318a7dfe1630d8500d85fb20cbabd0553",
        "patch": "@@ -4849,14 +4849,21 @@ bool SendMessages(CNode* pto)\n         {\n             LOCK(pto->cs_inventory);\n \n+            // Aggressively push MSG_BLOCK/MSG_FILTERED_BLOCK\n             BOOST_FOREACH(const CInv& inv, pto->vBlockInventoryToSend) {\n-                // Aggressively push MSG_BLOCK/MSG_FILTERED_BLOCK\n                 if (pto->setInventoryKnown.insert(inv).second) {\n                     vInv.push_back(inv);\n-                    pto->PushMessage(\"inv\", vInv);\n-                    vInv.clear();\n+                    if (vInv.size() >= 1000) {\n+                        pto->PushMessage(\"inv\", vInv);\n+                        vInv.clear();\n+                    }\n                 }\n             }\n+            \n+            if (!vInv.empty()) {\n+                pto->PushMessage(\"inv\", vInv);\n+                vInv.clear();\n+            }\n         }\n \n         if (pto->nNextInvSend < nNowMicros)\n@@ -4908,8 +4915,10 @@ bool SendMessages(CNode* pto)\n             pto->vInventoryToSend = vInvWait;\n         }\n \n-        if (!vInv.empty())\n+        if (!vInv.empty()) {\n             pto->PushMessage(\"inv\", vInv);\n+            vInv.clear();\n+        }\n \n         if (pto->nNextInvSend < nNowMicros)\n             pto->nNextInvSend = nNowMicros + GetRand(10 * 1000000);"
      }
    ]
  },
  {
    "sha": "f55c978cd800586f9cad8d008e5bb96f4c8c501e",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmNTVjOTc4Y2Q4MDA1ODZmOWNhZDhkMDA4ZTViYjk2ZjRjOGM1MDFl",
    "commit": {
      "author": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-07-12T22:15:18Z"
      },
      "committer": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-07-12T22:15:18Z"
      },
      "message": "setAddrKnown was replaced with addrKnown",
      "tree": {
        "sha": "b1f8b5a5cb5967147a18978abf72313d6e2cbb74",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b1f8b5a5cb5967147a18978abf72313d6e2cbb74"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f55c978cd800586f9cad8d008e5bb96f4c8c501e",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f55c978cd800586f9cad8d008e5bb96f4c8c501e",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/f55c978cd800586f9cad8d008e5bb96f4c8c501e",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f55c978cd800586f9cad8d008e5bb96f4c8c501e/comments",
    "author": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "f2cb99e318a7dfe1630d8500d85fb20cbabd0553",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f2cb99e318a7dfe1630d8500d85fb20cbabd0553",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/f2cb99e318a7dfe1630d8500d85fb20cbabd0553"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 1,
      "deletions": 1
    },
    "files": [
      {
        "sha": "fea3a6c7196f0368b047ff1cbf4b72e35829b67f",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f55c978cd800586f9cad8d008e5bb96f4c8c501e/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f55c978cd800586f9cad8d008e5bb96f4c8c501e/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=f55c978cd800586f9cad8d008e5bb96f4c8c501e",
        "patch": "@@ -4768,7 +4768,7 @@ bool SendMessages(CNode* pto)\n         }\n \n         if (pto->nNextClearSetKnown < nNowMicros) {\n-            pto->setAddrKnown.clear();\n+            pto->addrKnown.clear();\n             pto->nNextClearSetKnown = nNowMicros + 1000 * (int64_t)GetRand(12 * 60 * 60 * 1000);\n         }\n "
      }
    ]
  }
]