gmaxwell,2018-08-07T21:14:43Z,"Evoskuil is of the belief that some bitcoinj nodes were sending locators of size 100.  If so, I'll probably suggest that we just increase this number to 100 to accommodate them rather than delay putting in a limit just to get a somewhat tighter one.\n\nI'd be thankful if some people with lots of inbound connections could run this with net logging and report back if anyone is getting disconnected",https://github.com/bitcoin/bitcoin/pull/13907#issuecomment-411204921,411204921,
laanwj,2018-08-08T07:56:41Z,"utACK, looks like a good (and straightforward) precaution to me",https://github.com/bitcoin/bitcoin/pull/13907#issuecomment-411320581,411320581,
MarcoFalke,2018-08-08T15:00:22Z,utACK 65d92ad20d153d2525e978dc9622d38b2b6dfa25 beside my question if this should be implemented according to the BIP draft at https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2018-August/016285.html,https://github.com/bitcoin/bitcoin/pull/13907#issuecomment-411437242,411437242,
jnewbery,2018-08-08T17:46:49Z,Seems reasonable. Tested ACK 65d92ad20d153d2525e978dc9622d38b2b6dfa25 (just tested the getheaders logic). Functional test here: https://github.com/jnewbery/bitcoin/tree/pr13907.1 (commit https://github.com/jnewbery/bitcoin/commit/377b1a6af4b1ad7d23e3185930d8fe3d664393dc),https://github.com/bitcoin/bitcoin/pull/13907#issuecomment-411492944,411492944,
MarcoFalke,2018-08-08T19:27:38Z,"@jnewbery FYI I have also written a test this morning, that additionally covers the case of blocks as well as a positive and negative test outcome: 917fb38397",https://github.com/bitcoin/bitcoin/pull/13907#issuecomment-411523763,411523763,
jnewbery,2018-08-08T20:17:30Z,"@MarcoFalke - your test looks great. I've left a few comments on there. Once those are addressed, @gmaxwell should add your commit to this PR.",https://github.com/bitcoin/bitcoin/pull/13907#issuecomment-411538074,411538074,
gmaxwell,2018-08-09T20:59:24Z,"Sipa's observations show that there is software using 101, so I've updated to that size.  The larger locators are stupid and pointless, but the harm in permitting them is negligible. ",https://github.com/bitcoin/bitcoin/pull/13907#issuecomment-411895131,411895131,
achow101,2018-08-09T21:11:47Z,utACK e254ff5d53b79bee29203b965fca572f218bff54,https://github.com/bitcoin/bitcoin/pull/13907#issuecomment-411898634,411898634,
DrahtBot,2018-08-09T22:54:53Z,"<!--e57a25ab6845829454e8d69fc972939a-->Note to reviewers: This pull request conflicts with the following ones:\n\n* #13915 ([qa] Add test for max number of entries in locator by MarcoFalke)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",https://github.com/bitcoin/bitcoin/pull/13907#issuecomment-411923516,411923516,
MarcoFalke,2018-08-10T01:56:04Z,re-utACK e254ff5d53b79bee29203b965fca572f218bff54 (Only change is 64->101),https://github.com/bitcoin/bitcoin/pull/13907#issuecomment-411951677,411951677,
sdaftuar,2018-08-10T17:37:59Z,utACK,https://github.com/bitcoin/bitcoin/pull/13907#issuecomment-412153658,412153658,
laanwj,2018-08-10T17:52:10Z,utACK e254ff5d53b79bee29203b965fca572f218bff54,https://github.com/bitcoin/bitcoin/pull/13907#issuecomment-412157562,412157562,
AliAshrafD,2018-08-12T14:17:31Z,"Actually the maximum number of supplied hashes for the current network height could exceed 190 as the algorithm produces  10*log2(nChainHeight), as it has been discussed earlier in btctalk thread.\n\nPlus, to avoid playing with this constant every few months, a safe_threshold has been suggested to be added, for the main chain height to become two times  larger, like a decade later, this number w",https://github.com/bitcoin/bitcoin/pull/13907#issuecomment-412345953,412345953,
AliAshrafD,2018-08-13T09:18:10Z,"Above 10*log2(n) is an upper bound. The algorithm generates less hashes for smaller heights, e.g. for a chain with 10 blocks we get 10 hashes instead of 34 but for 1,000,000 blocks it is 160 which is much closer to 200.\n\nAny way, for current height we need 150 hashes in block locator to represent the active chain.",https://github.com/bitcoin/bitcoin/pull/13907#issuecomment-412457596,412457596,
gmaxwell,2018-08-13T15:39:37Z,"It does not produce 10*log2(n), https://github.com/bitcoin/bitcoin/blob/master/src/chain.cpp#L30.  Cheers.",https://github.com/bitcoin/bitcoin/pull/13907#issuecomment-412562466,412562466,
AliAshrafD,2018-08-14T16:05:21Z,"I just checked. Right! It is 10+log2(n), Now 101 seems to be TOO large, \nAnyway, I'm trying to establish a  boundary for the actual chain height, as an independent issue. \nGiven it is possible, any Idea about a possible application for such a boundary? \nAfter all this BIP sets a boundary of 2^90 already, I'm thinking of a more accurate, time dependent boundary.",https://github.com/bitcoin/bitcoin/pull/13907#issuecomment-412925615,412925615,
sipa,2018-08-14T16:07:11Z,"@AliAshrafD 101 was chosen here because we observed other implementations producing such large locators, and there is little reason to break compatibility.",https://github.com/bitcoin/bitcoin/pull/13907#issuecomment-412926180,412926180,
AliAshrafD,2018-08-14T16:19:09Z,"@sipa Although I'v not checked how bitcoinj reaches 100, no matter 40 or 101 or even 200 as long we are talking about locator issue. \nI'm just mentioning a more general problem: **How large block chain can be at any given time?** asking about any ideas about the possible applications of a hypothetical solution .",https://github.com/bitcoin/bitcoin/pull/13907#issuecomment-412930156,412930156,
sipa,2018-08-14T16:27:11Z,"@AliAshrafD That's a very interesting theoretical question,  but it seems completely off topic here.",https://github.com/bitcoin/bitcoin/pull/13907#issuecomment-412932750,412932750,
AliAshrafD,2018-08-14T16:34:55Z,"@sipa Well not completely off topic. By setting MAX_LOCATOR_SZ = 101, we are putting a cap on the maximum block height to be 2^90  forever, Aren't we? Still, I admit it is good enough for the problem of interest ;) just asking for other max-chain-height related issues if any. ",https://github.com/bitcoin/bitcoin/pull/13907#issuecomment-412935357,412935357,
achow101,2018-08-14T18:24:43Z,"@AliAshrafD No, this is not a consensus rule, this is only relay. The limit can be changed in the future with some smart behavior as to know how large of locators a node can support (a new protocol version would probably be needed in that case). Perhaps there should be some check to make sure the maximum locator size is not exceeded. If it is, more message can just be sent.",https://github.com/bitcoin/bitcoin/pull/13907#issuecomment-412969661,412969661,
sipa,2018-08-14T18:27:09Z,"Also, 2<sup>90</sup> blocks is enough for 1.8 trillion times the age of the universe. I think we'll be fine.",https://github.com/bitcoin/bitcoin/pull/13907#issuecomment-412970413,412970413,
AliAshrafD,2018-08-16T11:12:41Z,"@ahow101 , @sipa I understand the block locator problem is solved, just curious about other max-chain-height related issues. I just published my work regarding this issue on btctalk, you are welcome to make any comments there. Thank you. \nhttps://bitcointalk.org/index.php?topic=4905698.msg44176636#msg44176636",https://github.com/bitcoin/bitcoin/pull/13907#issuecomment-413509740,413509740,
jnewbery,2018-08-16T11:22:06Z,Locking this since it's wandered off. Thanks to all for your comments!,https://github.com/bitcoin/bitcoin/pull/13907#issuecomment-413511987,413511987,
domob1812,2018-08-08T06:58:33Z,"Is there a specific reason why you use `fDisconnect` here, rather than `Misbehaving` as in many other places around here?  If there is, perhaps adding a comment would be helpful to future readers of the code (it would certainly be useful to me right now).",https://github.com/bitcoin/bitcoin/pull/13907#discussion_r208474136,208474136,src/net_processing.cpp
gmaxwell,2018-08-08T13:39:35Z,"Because I don't see any particular reason to ban the peer. We only need to disconnect rather than just ignoring the message because the peer might be counting on our response and ignoring it could make it get stuck when otherwise it might make progress with someone else.  \n\nWe similarly disconnect for some messges when OutboundTargetReached, when we're limited and someone requests a block befo",https://github.com/bitcoin/bitcoin/pull/13907#discussion_r208583886,208583886,src/net_processing.cpp
MarcoFalke,2018-08-08T14:58:54Z,"Note that your BIP says: ""A locator included in a getblock or getheaders message may include no more\nthan 64 hashes, including the final hash_stop hash"", so unless I am mistaken, the `>` should be replaced with a `>=`?",https://github.com/bitcoin/bitcoin/pull/13907#discussion_r208615587,208615587,src/net_processing.cpp
gmaxwell,2018-08-08T17:51:38Z,"Yes, if we end up following the BIP. I'm giving it about equal odds that we need to use a threshold higher than the BIP for now, after we see whats showing up on the network.",https://github.com/bitcoin/bitcoin/pull/13907#discussion_r208675633,208675633,src/net_processing.cpp
domob1812,2018-08-10T06:08:04Z,"Makes sense, thanks for the clarification!",https://github.com/bitcoin/bitcoin/pull/13907#discussion_r209152713,209152713,src/net_processing.cpp
