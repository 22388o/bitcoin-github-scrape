TheBlueMatt,2015-06-07T19:12:58Z,"Theres probably another way to do it (I know @theuni wanted to build with different flags for release, but it would be good to at least fix build).\n",https://github.com/bitcoin/bitcoin/pull/6248#issuecomment-109789480,109789480,
laanwj,2015-06-09T12:14:36Z,"We discussed this on IRC. I don't think -fPIC should be the default, for executables -fPIE is superior option. See e.g. http://www.openbsd.org/papers/nycbsdcon08-pie/\n\nThough I'm fine with enabling it as a fallback if you can add a check to autoconf that `PIE` is broken on a platform.\n",https://github.com/bitcoin/bitcoin/pull/6248#issuecomment-110335092,110335092,
TheBlueMatt,2015-06-09T20:11:27Z,"Many distros force PIC anyway, so this actually wont change anything for most builds.\n",https://github.com/bitcoin/bitcoin/pull/6248#issuecomment-110489701,110489701,
theuni,2015-06-09T20:16:03Z,"After researching the issue some over the weekend, I agree with @laanwj.\n\nTo clarify, this is an issue with gcc5 and newer clang+lto when qt is built with -reduce-relocations. Upstream GCC discussion is [here](https://gcc.gnu.org/bugzilla/show_bug.cgi?id=65886). \n\nWe have a few options:\n- Do nothing. I think I'd prefer this, reasoning below.\n- use -PIC instead for known-problematic compilers",https://github.com/bitcoin/bitcoin/pull/6248#issuecomment-110491401,110491401,
TheBlueMatt,2015-06-09T20:29:14Z,"OK, @theuni I filed a bug at https://bugs.archlinux.org/task/45283 lets see what the maintainers there say.\n",https://github.com/bitcoin/bitcoin/pull/6248#issuecomment-110495368,110495368,
laanwj,2015-06-10T06:05:52Z,"@cfields I'm ok with all those options, except ""Default to -PIC everywhere and override with -PIE when creating release binaries."" Let's not have everyone suffer because a distro builds libraries with broken options. \nEither we work around this specific case when it happens, or we do nothing and have Arch users provide an extra option as workaround (could be documented in `build_unix.md`).\nWould",https://github.com/bitcoin/bitcoin/pull/6248#issuecomment-110603934,110603934,
TheBlueMatt,2015-06-10T08:41:53Z,"@cfields would you mind discussing with the arch maintainer @ https://bugs.archlinux.org/task/45283#comment136231 ?\n\nOn June 9, 2015 11:06:00 PM PDT, ""Wladimir J. van der Laan"" notifications@github.com wrote:\n\n> @cfields I'm ok with all those options, except ""Default to -PIC\n> everywhere and override with -PIE when creating release binaries.""\n> Let's not have everyone suffer because a distro",https://github.com/bitcoin/bitcoin/pull/6248#issuecomment-110656561,110656561,
dankeder,2015-06-27T13:01:42Z,This issue is present on Fedora 22 as well.\n,https://github.com/bitcoin/bitcoin/pull/6248#issuecomment-116041222,116041222,
theuni,2015-06-27T14:29:06Z,I have a fix for this in the works. I'll try to push it up in the next few days.\n,https://github.com/bitcoin/bitcoin/pull/6248#issuecomment-116068528,116068528,
TheBlueMatt,2015-07-17T23:14:19Z,"Arch changed their build settings and this is no longer an issue there, is it still on Fedora? Can we file a bug there? @dankeder \n",https://github.com/bitcoin/bitcoin/pull/6248#issuecomment-122441727,122441727,
dankeder,2015-07-20T18:32:19Z,"Yes, the problem is still present on F22:\n\nIn my bitcoin repo (checkout tag v0.10.2):\n\n```\n$ ./configure --prefix=/home/dan/programs/bitcoin-0.10.2 --with-gui=qt5 --with-pic --disable-shared --disable-tests\n(...)\n$ make                     \nMaking all in src\nmake[1]: Entering directory '/home/dan/tmp/src/bitcoin/src'\nmake[2]: Entering directory '/home/dan/tmp/src/bitcoin/src'\n  CXX     ",https://github.com/bitcoin/bitcoin/pull/6248#issuecomment-122979235,122979235,
theuni,2015-07-22T22:31:52Z,"I'm unsure what to do here. I have a rather complicated patch that changes around the PIC flags for qt objects if it was built with -reduce-locations, but since Arch elected to quit doing that, I'm somewhat hopeful that we can lobby the other distros to do the same. That really is the correct fix.\n",https://github.com/bitcoin/bitcoin/pull/6248#issuecomment-123890594,123890594,
dankeder,2015-07-23T13:37:47Z,"I asked a friend who is a contributor to the Fedora Project what he thinks about this issue.\n\nHis opinion is that bitcoin build logic shouldn't set compiler options on its own, it should rather make use of qmake to get the flags of the particular platform. Also, it seems that `-fPIC` is set as the default directly in qt build scripts. So if you think that the flags need to be changed, they shoul",https://github.com/bitcoin/bitcoin/pull/6248#issuecomment-124102779,124102779,
laanwj,2015-08-25T09:01:54Z,"We're setting custom compiler options because of `--enable-hardening`, which sets some (relatively) obscure options to improve worst-case security. With `--disable-hardening` this problem it just uses the suggested flags and I don't think this problem exists.\n\nI do like having hardening enabled by default, though. @theuni Can we add a test to configure that detects this problem, and disables or ",https://github.com/bitcoin/bitcoin/pull/6248#issuecomment-134532490,134532490,
jgarzik,2015-09-16T15:12:12Z,"Well, reviewing PIE vs. PIC, no immediate security issue jumps out (via hardening) at the introduction of PIC.  It's just a bit slower.  Capturing the flags from qmake seems reasonable?\n",https://github.com/bitcoin/bitcoin/pull/6248#issuecomment-140772104,140772104,
itoffshore,2015-09-16T16:05:30Z,Building with PIC instead of PIE means the [Address Space Layout Randomization](https://en.wikipedia.org/wiki/Address_space_layout_randomization#Linux) & [features from Grsecurity / PaX are less effective](https://wiki.gentoo.org/wiki/Hardened/Introduction_to_Hardened_Gentoo#PIE_and_SSP).\n,https://github.com/bitcoin/bitcoin/pull/6248#issuecomment-140789229,140789229,
itoffshore,2015-09-18T13:55:36Z,In Alpine Linux `qt5` is built with `-no-reduce-relocations` &`bitcoin` / `bitcoin-qt` are still built with `-fPIE`\n,https://github.com/bitcoin/bitcoin/pull/6248#issuecomment-141457687,141457687,
laanwj,2015-10-06T12:30:57Z,"> Use -PIC instead only when building bitcoin-qt and using a problematic compiler and when qt was built with -reduce-relocations (this can be tested via preprocessor).\n\nRight, detecting this would be the right way to solve this. Although the logic is quite ugly, it's not that much worse than other auto\* checks.\n\nAnd agree it would be even better if `-reduce-relocations` was not provided to th",https://github.com/bitcoin/bitcoin/pull/6248#issuecomment-145842204,145842204,
laanwj,2015-11-02T14:58:56Z,"Bleh, getting the same on Ubuntu 15.10 now.\nSeems a lot of distributions are compiling Qt with that awful option.\nWe do need to detect it somehow in configure.\n\n@theuni can you take a look at this?\n",https://github.com/bitcoin/bitcoin/pull/6248#issuecomment-153043144,153043144,
laanwj,2015-11-10T14:32:15Z,Closing in favor of #6978\n,https://github.com/bitcoin/bitcoin/pull/6248#issuecomment-155435650,155435650,
