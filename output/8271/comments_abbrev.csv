TheBlueMatt,2016-06-27T20:39:06Z,"The BIP specifies you should encode transactions exactly as they would be in ""tx"" messages, so this does not really fix the issue - ultimately we need to inform the compact block stuff whether to include the witnesses (though its probably easier/better to just change the spec to require witness-inclusion).\n",https://github.com/bitcoin/bitcoin/pull/8271#issuecomment-228868075,228868075,
sipa,2016-06-27T23:38:49Z,"I'm working on a spec for making witness + compactblocks work (using\nsendcmpct version 2 to indicate that blocktxn, cmpctblock should include\nwitnesses, and that short ids should be based on wtxids), which seems to\nwork quite well.\n\nThis is just a minimal change to prevent things from breaking when witness\nnodes start talking to older compactblocks-aware nodes.\n",https://github.com/bitcoin/bitcoin/pull/8271#issuecomment-228908022,228908022,
TheBlueMatt,2016-06-27T23:44:07Z,"Correct me if I'm wrong, but transaction encoding/hash with witness for a non-witness transaction and transaction encoding/hash without witness are the same, no? I'd think no one would ship code with compact blocks before we fix the witness/compact combination, so might as well just remove the code for non-witness compact with version 1...it'll only break current master nodes after segwit activate",https://github.com/bitcoin/bitcoin/pull/8271#issuecomment-228908932,228908932,
sipa,2016-06-27T23:49:45Z,"0.13.0 will ship with compact blocks, but very likely without segwit\nactivation. A potential future 0.13.1 with segwit activation can't send\nwitnesses to 0.13.0 nodes, as they would consider those blocks invalid\nand/or the shorttixds would mismatch.\n\nYou need to negotiate which parts of transactions are relevant unless you\nwant relay between old and new nodes to be severely impacted any time",https://github.com/bitcoin/bitcoin/pull/8271#issuecomment-228909846,228909846,
TheBlueMatt,2016-06-28T02:13:03Z,"I mean you can still define version 1 to include witnesses, it doesnt effect the current protocol for non-witness transactions and continues to work fine, no?\n",https://github.com/bitcoin/bitcoin/pull/8271#issuecomment-228929689,228929689,
sipa,2016-06-28T06:39:15Z,"Yes, you could. But it would mean 0.13.1 can't send to 0.13.0 nodes.\n",https://github.com/bitcoin/bitcoin/pull/8271#issuecomment-228962572,228962572,
TheBlueMatt,2016-06-28T06:48:11Z,"Sure they could! 0.13.0 will know how to deserialize with witnesses,\neven if the block-processing-with-witnesses is not enabled. I think you\nmeant to say 0.13.0 wont be able to send to 0.13.1, because it would\ndrop the witnesses from processing, which I'd think is true?\n\nOn 06/28/16 06:39, Pieter Wuille wrote:\n\n> Yes, you could. But it would mean 0.13.1 can't send to 0.13.0 nodes.\n> \n> â€”\",https://github.com/bitcoin/bitcoin/pull/8271#issuecomment-228964898,228964898,
sipa,2016-06-28T08:37:03Z,"To 0.13.0 nodes these blocks should not have witnesses, as there has not been a softfork to define them. Sure it could strip them off before processing when received from a 0.13.1 node, but that is inefficient (especially for a protocol that tries to minimize bandwidth) and does not solve the problem for other potential future data extensions to the serialization.\n\n0.13.1 will never request from",https://github.com/bitcoin/bitcoin/pull/8271#issuecomment-228987080,228987080,
sipa,2016-07-08T13:15:07Z,"The discussion above should probably happen elsewhere.\n\nThe PR here is a pure bugfix, though one that would only occur on testnet, and if there is ever a client on the network which does support BIP152 but not segwit.\n",https://github.com/bitcoin/bitcoin/pull/8271#issuecomment-231356101,231356101,
sdaftuar,2016-07-08T17:10:40Z,utACK.  We should merge this for 0.13.0.\n,https://github.com/bitcoin/bitcoin/pull/8271#issuecomment-231416970,231416970,
laanwj,2016-07-14T06:17:13Z,utACK 252675e\n,https://github.com/bitcoin/bitcoin/pull/8271#issuecomment-232566421,232566421,
