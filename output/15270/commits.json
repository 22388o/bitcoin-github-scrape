[
  {
    "sha": "4f2e6c8b881b7ccda36233332dfd1bd231389a8e",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0ZjJlNmM4Yjg4MWI3Y2NkYTM2MjMzMzMyZGZkMWJkMjMxMzg5YThl",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2019-01-26T17:44:28Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2019-01-26T17:44:28Z"
      },
      "message": "Squashed 'src/leveldb/' changes from 524b7e36a8..f545dfabff\n\nf545dfabff Merge #18: Use utf-8 to decode filename\nf8e797a058 Use utf-8 to decode filename\n2fc114812a Merge #14: Fixes to allow building with msvc.\nd6eab93138 Fixes to allow building with msvc.\n\ngit-subtree-dir: src/leveldb\ngit-subtree-split: f545dfabff4c2e9836efed094dba99a34fbc6b88",
      "tree": {
        "sha": "9a76136301c252c4b6a0ca628381af761f0fba4a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9a76136301c252c4b6a0ca628381af761f0fba4a"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4f2e6c8b881b7ccda36233332dfd1bd231389a8e",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4f2e6c8b881b7ccda36233332dfd1bd231389a8e",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/4f2e6c8b881b7ccda36233332dfd1bd231389a8e",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4f2e6c8b881b7ccda36233332dfd1bd231389a8e/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "ec749b1bcdf2483b642fb51d635800e272c68ba6",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ec749b1bcdf2483b642fb51d635800e272c68ba6",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/ec749b1bcdf2483b642fb51d635800e272c68ba6"
      }
    ],
    "stats": {
      "total": 34,
      "additions": 22,
      "deletions": 12
    },
    "files": [
      {
        "sha": "b23e3dcc9d06a1d854152b245de6918297026072",
        "filename": "db/c.cc",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4f2e6c8b881b7ccda36233332dfd1bd231389a8e/db/c.cc",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4f2e6c8b881b7ccda36233332dfd1bd231389a8e/db/c.cc",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/db/c.cc?ref=4f2e6c8b881b7ccda36233332dfd1bd231389a8e",
        "patch": "@@ -5,7 +5,9 @@\n #include \"leveldb/c.h\"\n \n #include <stdlib.h>\n+#ifndef WIN32\n #include <unistd.h>\n+#endif\n #include \"leveldb/cache.h\"\n #include \"leveldb/comparator.h\"\n #include \"leveldb/db.h\""
      },
      {
        "sha": "989c15cd91d05713a42c22d92c1be0edacb47bb3",
        "filename": "port/port_win.h",
        "status": "modified",
        "additions": 7,
        "deletions": 0,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4f2e6c8b881b7ccda36233332dfd1bd231389a8e/port/port_win.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4f2e6c8b881b7ccda36233332dfd1bd231389a8e/port/port_win.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/port/port_win.h?ref=4f2e6c8b881b7ccda36233332dfd1bd231389a8e",
        "patch": "@@ -32,9 +32,16 @@\n #define STORAGE_LEVELDB_PORT_PORT_WIN_H_\n \n #ifdef _MSC_VER\n+#if !(_MSC_VER >= 1900)\n #define snprintf _snprintf\n+#endif\n #define close _close\n #define fread_unlocked _fread_nolock\n+#ifdef _WIN64\n+#define ssize_t int64_t\n+#else\n+#define ssize_t int32_t\n+#endif\n #endif\n \n #include <string>"
      },
      {
        "sha": "830332abe9b32f2af88f463e26cb5288919a59b1",
        "filename": "util/env_win.cc",
        "status": "modified",
        "additions": 13,
        "deletions": 12,
        "changes": 25,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4f2e6c8b881b7ccda36233332dfd1bd231389a8e/util/env_win.cc",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4f2e6c8b881b7ccda36233332dfd1bd231389a8e/util/env_win.cc",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/util/env_win.cc?ref=4f2e6c8b881b7ccda36233332dfd1bd231389a8e",
        "patch": "@@ -203,24 +203,16 @@ class Win32Env : public Env\n \n void ToWidePath(const std::string& value, std::wstring& target) {\n \twchar_t buffer[MAX_PATH];\n-\tMultiByteToWideChar(CP_ACP, 0, value.c_str(), -1, buffer, MAX_PATH);\n+\tMultiByteToWideChar(CP_UTF8, 0, value.c_str(), -1, buffer, MAX_PATH);\n \ttarget = buffer;\n }\n \n void ToNarrowPath(const std::wstring& value, std::string& target) {\n \tchar buffer[MAX_PATH];\n-\tWideCharToMultiByte(CP_ACP, 0, value.c_str(), -1, buffer, MAX_PATH, NULL, NULL);\n+\tWideCharToMultiByte(CP_UTF8, 0, value.c_str(), -1, buffer, MAX_PATH, NULL, NULL);\n \ttarget = buffer;\n }\n \n-std::string GetCurrentDir()\n-{\n-    CHAR path[MAX_PATH];\n-    ::GetModuleFileNameA(::GetModuleHandleA(NULL),path,MAX_PATH);\n-    *strrchr(path,'\\\\') = 0;\n-    return std::string(path);\n-}\n-\n std::wstring GetCurrentDirW()\n {\n     WCHAR path[MAX_PATH];\n@@ -229,6 +221,13 @@ std::wstring GetCurrentDirW()\n     return std::wstring(path);\n }\n \n+std::string GetCurrentDir()\n+{\n+    std::string path;\n+    ToNarrowPath(GetCurrentDirW(), path);\n+    return path;\n+}\n+\n std::string& ModifyPath(std::string& path)\n {\n     if(path[0] == '/' || path[0] == '\\\\'){\n@@ -764,14 +763,16 @@ uint64_t Win32Env::NowMicros()\n static Status CreateDirInner( const std::string& dirname )\n {\n     Status sRet;\n-    DWORD attr = ::GetFileAttributes(dirname.c_str());\n+    std::wstring dirnameW;\n+    ToWidePath(dirname, dirnameW);\n+    DWORD attr = ::GetFileAttributesW(dirnameW.c_str());\n     if (attr == INVALID_FILE_ATTRIBUTES) { // doesn't exist:\n       std::size_t slash = dirname.find_last_of(\"\\\\\");\n       if (slash != std::string::npos){\n \tsRet = CreateDirInner(dirname.substr(0, slash));\n \tif (!sRet.ok()) return sRet;\n       }\n-      BOOL result = ::CreateDirectory(dirname.c_str(), NULL);\n+      BOOL result = ::CreateDirectoryW(dirnameW.c_str(), NULL);\n       if (result == FALSE) {\n \tsRet = Status::IOError(dirname, \"Could not create directory.\");\n \treturn sRet;"
      }
    ]
  },
  {
    "sha": "fa6180188b8ab89af97860e6497716405a48bab6",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYTYxODAxODhiOGFiODlhZjk3ODYwZTY0OTc3MTY0MDVhNDhiYWI2",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2019-01-26T17:45:45Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2019-01-26T17:45:48Z"
      },
      "message": "Pull leveldb subtree",
      "tree": {
        "sha": "756ec83e655ea10d20bb992d2b1c48b5c3c64c6c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/756ec83e655ea10d20bb992d2b1c48b5c3c64c6c"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fa6180188b8ab89af97860e6497716405a48bab6",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGcBAABCgAGBQJcTJzMAAoJEM4rdWl+aaVIZboMAIuAIfKphKbWasQeypFwgBKC\nPjQYgGroeFITEBxOLG8093ovIFW31iOA8P0yU7WJVgBXpQykY7ZXak/wq2LcII+2\ny3kZw8wexHEO8JKEmfu1j6vbNNZWDyzQHW+B9KorxEe+H8cWup7vB2JpP9/0ocwp\np1g/VpfM0cQ++v5uEgVnbgsyW2zElzvNd/nKspI4c7//Hb1xaM1rTHjNx1Mf5Bv5\nkfY3H6YZeRdgGwLvDdQVj2WzxWIfakqo4VffDcBGEvPVjmwUlCF3yKSO/YZjoqso\nZKlF+BwzsnhwxECqF9k7Zk6DQXrqA3Ii7TgK2nkdyDab6nKb/1B6MHeDObfpQRaw\nr4JZpW3iHZpvaTLcXikR3a05ML6EpcDgy97GlvFTwmzeR0uiFHPJ6wF2RmCq5/tt\nGWTyOPpsp1vcQiFMoNQTVMI9YDAAkvqPuEw8ZJIC2kzjOJQt7wr3ycNlyMHQbq86\nqTa1mVMppdH+laPagSFUi305LEYbSwPwE6r3e344AQ==\n=n4YY\n-----END PGP SIGNATURE-----",
        "payload": "tree 756ec83e655ea10d20bb992d2b1c48b5c3c64c6c\nparent d14ef5721ffcf07321704dc21f1ab9df4952a44d\nparent 4f2e6c8b881b7ccda36233332dfd1bd231389a8e\nauthor MarcoFalke <falke.marco@gmail.com> 1548524745 -0500\ncommitter MarcoFalke <falke.marco@gmail.com> 1548524748 -0500\n\nPull leveldb subtree\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa6180188b8ab89af97860e6497716405a48bab6",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fa6180188b8ab89af97860e6497716405a48bab6",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa6180188b8ab89af97860e6497716405a48bab6/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "d14ef5721ffcf07321704dc21f1ab9df4952a44d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d14ef5721ffcf07321704dc21f1ab9df4952a44d",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/d14ef5721ffcf07321704dc21f1ab9df4952a44d"
      },
      {
        "sha": "4f2e6c8b881b7ccda36233332dfd1bd231389a8e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4f2e6c8b881b7ccda36233332dfd1bd231389a8e",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/4f2e6c8b881b7ccda36233332dfd1bd231389a8e"
      }
    ],
    "stats": {
      "total": 34,
      "additions": 22,
      "deletions": 12
    },
    "files": [
      {
        "sha": "b23e3dcc9d06a1d854152b245de6918297026072",
        "filename": "src/leveldb/db/c.cc",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa6180188b8ab89af97860e6497716405a48bab6/src/leveldb/db/c.cc",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa6180188b8ab89af97860e6497716405a48bab6/src/leveldb/db/c.cc",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/leveldb/db/c.cc?ref=fa6180188b8ab89af97860e6497716405a48bab6",
        "patch": "@@ -5,7 +5,9 @@\n #include \"leveldb/c.h\"\n \n #include <stdlib.h>\n+#ifndef WIN32\n #include <unistd.h>\n+#endif\n #include \"leveldb/cache.h\"\n #include \"leveldb/comparator.h\"\n #include \"leveldb/db.h\""
      },
      {
        "sha": "989c15cd91d05713a42c22d92c1be0edacb47bb3",
        "filename": "src/leveldb/port/port_win.h",
        "status": "modified",
        "additions": 7,
        "deletions": 0,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa6180188b8ab89af97860e6497716405a48bab6/src/leveldb/port/port_win.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa6180188b8ab89af97860e6497716405a48bab6/src/leveldb/port/port_win.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/leveldb/port/port_win.h?ref=fa6180188b8ab89af97860e6497716405a48bab6",
        "patch": "@@ -32,9 +32,16 @@\n #define STORAGE_LEVELDB_PORT_PORT_WIN_H_\n \n #ifdef _MSC_VER\n+#if !(_MSC_VER >= 1900)\n #define snprintf _snprintf\n+#endif\n #define close _close\n #define fread_unlocked _fread_nolock\n+#ifdef _WIN64\n+#define ssize_t int64_t\n+#else\n+#define ssize_t int32_t\n+#endif\n #endif\n \n #include <string>"
      },
      {
        "sha": "830332abe9b32f2af88f463e26cb5288919a59b1",
        "filename": "src/leveldb/util/env_win.cc",
        "status": "modified",
        "additions": 13,
        "deletions": 12,
        "changes": 25,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa6180188b8ab89af97860e6497716405a48bab6/src/leveldb/util/env_win.cc",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa6180188b8ab89af97860e6497716405a48bab6/src/leveldb/util/env_win.cc",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/leveldb/util/env_win.cc?ref=fa6180188b8ab89af97860e6497716405a48bab6",
        "patch": "@@ -203,24 +203,16 @@ class Win32Env : public Env\n \n void ToWidePath(const std::string& value, std::wstring& target) {\n \twchar_t buffer[MAX_PATH];\n-\tMultiByteToWideChar(CP_ACP, 0, value.c_str(), -1, buffer, MAX_PATH);\n+\tMultiByteToWideChar(CP_UTF8, 0, value.c_str(), -1, buffer, MAX_PATH);\n \ttarget = buffer;\n }\n \n void ToNarrowPath(const std::wstring& value, std::string& target) {\n \tchar buffer[MAX_PATH];\n-\tWideCharToMultiByte(CP_ACP, 0, value.c_str(), -1, buffer, MAX_PATH, NULL, NULL);\n+\tWideCharToMultiByte(CP_UTF8, 0, value.c_str(), -1, buffer, MAX_PATH, NULL, NULL);\n \ttarget = buffer;\n }\n \n-std::string GetCurrentDir()\n-{\n-    CHAR path[MAX_PATH];\n-    ::GetModuleFileNameA(::GetModuleHandleA(NULL),path,MAX_PATH);\n-    *strrchr(path,'\\\\') = 0;\n-    return std::string(path);\n-}\n-\n std::wstring GetCurrentDirW()\n {\n     WCHAR path[MAX_PATH];\n@@ -229,6 +221,13 @@ std::wstring GetCurrentDirW()\n     return std::wstring(path);\n }\n \n+std::string GetCurrentDir()\n+{\n+    std::string path;\n+    ToNarrowPath(GetCurrentDirW(), path);\n+    return path;\n+}\n+\n std::string& ModifyPath(std::string& path)\n {\n     if(path[0] == '/' || path[0] == '\\\\'){\n@@ -764,14 +763,16 @@ uint64_t Win32Env::NowMicros()\n static Status CreateDirInner( const std::string& dirname )\n {\n     Status sRet;\n-    DWORD attr = ::GetFileAttributes(dirname.c_str());\n+    std::wstring dirnameW;\n+    ToWidePath(dirname, dirnameW);\n+    DWORD attr = ::GetFileAttributesW(dirnameW.c_str());\n     if (attr == INVALID_FILE_ATTRIBUTES) { // doesn't exist:\n       std::size_t slash = dirname.find_last_of(\"\\\\\");\n       if (slash != std::string::npos){\n \tsRet = CreateDirInner(dirname.substr(0, slash));\n \tif (!sRet.ok()) return sRet;\n       }\n-      BOOL result = ::CreateDirectory(dirname.c_str(), NULL);\n+      BOOL result = ::CreateDirectoryW(dirnameW.c_str(), NULL);\n       if (result == FALSE) {\n \tsRet = Status::IOError(dirname, \"Could not create directory.\");\n \treturn sRet;"
      }
    ]
  }
]