[
  {
    "sha": "fa3999a27e2cabbe808e96ca569f7092ff53b532",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYTM5OTlhMjdlMmNhYmJlODA4ZTk2Y2E1NjlmNzA5MmZmNTNiNTMy",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2021-08-20T10:19:12Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2021-08-20T10:52:46Z"
      },
      "message": "refactor: Fix includes (add missing ones, remove unneeded)",
      "tree": {
        "sha": "b03cd2d5e0f28163f915d25bc9a0b765ae89165b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b03cd2d5e0f28163f915d25bc9a0b765ae89165b"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fa3999a27e2cabbe808e96ca569f7092ff53b532",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\npUjWxwv+ISfCELOhrmTRpxlc9B5U0f9YEj1L294UK+yESA5nLJLXDlVnl6mp/rCV\nnjHAkCUeuZs2dUl6e2XR0wXJqX1AbUhempVKTSEzMXDKep6KC6QgAM5ijsv/wsPq\nheW84wzrm69Gav2nKI1cI9fh+jOaxZlNAOLMJE/N1ZaeL0xzyUpND3PfGndeZwi/\nCcFVTn8N15+SMadJ16c+78+78qXYMQQrs+4wYGHIV0AVMs2vGHOk5fCWqeRbKjbH\nAwMXb7BeILxl0Z9EGWftffFtPRV+z7C3PFUirHmMUO+rXaavMD12NymE0+lu5MXF\nRPTMgLa93issE8eSdBnO9yp0uRaJpcF2VBe+JulKOwZaQqS4oWaeX5v/nxPNNWFy\nWv3j/DpTbm75k0a2oZHzEQ/JF9OiZo3UbmkkfmEMN+8QHo62OT5IwAzi/EzJB3es\nMJGLy8hrcfS9prISa5JooM+zTJZadlX5jZwOJT4tbfWCuU100UiMCoNXbn+MOeuz\nOc5hr0fv\n=drUB\n-----END PGP SIGNATURE-----",
        "payload": "tree b03cd2d5e0f28163f915d25bc9a0b765ae89165b\nparent 192a959b65660ffacedb5a5eb2a0d26736c636d7\nauthor MarcoFalke <falke.marco@gmail.com> 1629454752 +0200\ncommitter MarcoFalke <falke.marco@gmail.com> 1629456766 +0200\n\nrefactor: Fix includes (add missing ones, remove unneeded)\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa3999a27e2cabbe808e96ca569f7092ff53b532",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fa3999a27e2cabbe808e96ca569f7092ff53b532",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa3999a27e2cabbe808e96ca569f7092ff53b532/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "192a959b65660ffacedb5a5eb2a0d26736c636d7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/192a959b65660ffacedb5a5eb2a0d26736c636d7",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/192a959b65660ffacedb5a5eb2a0d26736c636d7"
      }
    ],
    "stats": {
      "total": 10,
      "additions": 8,
      "deletions": 2
    },
    "files": [
      {
        "sha": "67c33f771596b2d7f40c2add9a1cb1198b5f231b",
        "filename": "src/addrman.h",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa3999a27e2cabbe808e96ca569f7092ff53b532/src/addrman.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa3999a27e2cabbe808e96ca569f7092ff53b532/src/addrman.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrman.h?ref=fa3999a27e2cabbe808e96ca569f7092ff53b532",
        "patch": "@@ -10,14 +10,14 @@\n #include <config/bitcoin-config.h>\n #include <fs.h>\n #include <hash.h>\n+#include <logging.h>\n #include <netaddress.h>\n #include <protocol.h>\n #include <random.h>\n #include <streams.h>\n #include <sync.h>\n #include <timedata.h>\n #include <tinyformat.h>\n-#include <util/system.h>\n \n #include <iostream>\n #include <optional>"
      },
      {
        "sha": "f4ae51c1f54437651f99fbae0001022ac1fb8d7d",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa3999a27e2cabbe808e96ca569f7092ff53b532/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa3999a27e2cabbe808e96ca569f7092ff53b532/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=fa3999a27e2cabbe808e96ca569f7092ff53b532",
        "patch": "@@ -9,6 +9,7 @@\n \n #include <net.h>\n \n+#include <addrdb.h>\n #include <banman.h>\n #include <clientversion.h>\n #include <compat.h>\n@@ -24,6 +25,7 @@\n #include <scheduler.h>\n #include <util/sock.h>\n #include <util/strencodings.h>\n+#include <util/system.h>\n #include <util/thread.h>\n #include <util/trace.h>\n #include <util/translation.h>"
      },
      {
        "sha": "7988911f7b345bbba0ae32401fce80432dc0f3fe",
        "filename": "src/net.h",
        "status": "modified",
        "additions": 0,
        "deletions": 1,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa3999a27e2cabbe808e96ca569f7092ff53b532/src/net.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa3999a27e2cabbe808e96ca569f7092ff53b532/src/net.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.h?ref=fa3999a27e2cabbe808e96ca569f7092ff53b532",
        "patch": "@@ -6,7 +6,6 @@\n #ifndef BITCOIN_NET_H\n #define BITCOIN_NET_H\n \n-#include <addrdb.h>\n #include <addrman.h>\n #include <amount.h>\n #include <bloom.h>"
      },
      {
        "sha": "4b5b38e43f887e88264229f6c38c4ae22c15f155",
        "filename": "src/qt/bantablemodel.h",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa3999a27e2cabbe808e96ca569f7092ff53b532/src/qt/bantablemodel.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa3999a27e2cabbe808e96ca569f7092ff53b532/src/qt/bantablemodel.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/bantablemodel.h?ref=fa3999a27e2cabbe808e96ca569f7092ff53b532",
        "patch": "@@ -5,6 +5,7 @@\n #ifndef BITCOIN_QT_BANTABLEMODEL_H\n #define BITCOIN_QT_BANTABLEMODEL_H\n \n+#include <addrdb.h>\n #include <net.h>\n \n #include <memory>"
      },
      {
        "sha": "f54dbc9362cd6984c2177cb1516db00419bed79c",
        "filename": "src/qt/walletframe.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa3999a27e2cabbe808e96ca569f7092ff53b532/src/qt/walletframe.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa3999a27e2cabbe808e96ca569f7092ff53b532/src/qt/walletframe.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/walletframe.cpp?ref=fa3999a27e2cabbe808e96ca569f7092ff53b532",
        "patch": "@@ -11,6 +11,7 @@\n #include <qt/psbtoperationsdialog.h>\n #include <qt/walletmodel.h>\n #include <qt/walletview.h>\n+#include <util/system.h>\n \n #include <cassert>\n "
      },
      {
        "sha": "083ff22c1a66d552db716ae8aa6c84f9b84c0b56",
        "filename": "src/test/fuzz/data_stream.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa3999a27e2cabbe808e96ca569f7092ff53b532/src/test/fuzz/data_stream.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa3999a27e2cabbe808e96ca569f7092ff53b532/src/test/fuzz/data_stream.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/fuzz/data_stream.cpp?ref=fa3999a27e2cabbe808e96ca569f7092ff53b532",
        "patch": "@@ -2,6 +2,7 @@\n // Distributed under the MIT software license, see the accompanying\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n+#include <addrdb.h>\n #include <addrman.h>\n #include <net.h>\n #include <test/fuzz/FuzzedDataProvider.h>"
      },
      {
        "sha": "44e453ce2966c412247aa19b227aefb30b8e98cd",
        "filename": "src/test/fuzz/integer.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa3999a27e2cabbe808e96ca569f7092ff53b532/src/test/fuzz/integer.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa3999a27e2cabbe808e96ca569f7092ff53b532/src/test/fuzz/integer.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/fuzz/integer.cpp?ref=fa3999a27e2cabbe808e96ca569f7092ff53b532",
        "patch": "@@ -23,6 +23,7 @@\n #include <test/fuzz/fuzz.h>\n #include <test/fuzz/util.h>\n #include <uint256.h>\n+#include <univalue.h>\n #include <util/check.h>\n #include <util/moneystr.h>\n #include <util/strencodings.h>"
      },
      {
        "sha": "73a7d24971a4df1a1fd5f379f4dd06442cdfd98f",
        "filename": "src/test/fuzz/versionbits.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa3999a27e2cabbe808e96ca569f7092ff53b532/src/test/fuzz/versionbits.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa3999a27e2cabbe808e96ca569f7092ff53b532/src/test/fuzz/versionbits.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/fuzz/versionbits.cpp?ref=fa3999a27e2cabbe808e96ca569f7092ff53b532",
        "patch": "@@ -6,6 +6,7 @@\n #include <chainparams.h>\n #include <consensus/params.h>\n #include <primitives/block.h>\n+#include <util/system.h>\n #include <versionbits.h>\n \n #include <test/fuzz/FuzzedDataProvider.h>"
      }
    ]
  },
  {
    "sha": "faffb098fdb436d1a0dc48dd98a2ec472de3e2c2",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYWZmYjA5OGZkYjQzNmQxYTBkYzQ4ZGQ5OGEyZWM0NzJkZTNlMmMy",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2021-08-20T11:13:58Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2021-08-20T11:39:11Z"
      },
      "message": "Move LoadAddrman from init to addrdb\n\nInit should only concern itself with the initialization order, not the\ndetailed initialization logic of every module.",
      "tree": {
        "sha": "9221acec019450a1359b9f05825667f7f117ee03",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9221acec019450a1359b9f05825667f7f117ee03"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/faffb098fdb436d1a0dc48dd98a2ec472de3e2c2",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\npUj3lwv/aGkfKh/hlCsAIH7bRotd/TEdHu8kNXgQhBFnMq9iXVqXgeDAZR7qhf31\n7ZcZFlgrcP2+OH/v3Or7hhaJziZLtH3SFZ+YoJIP9OUe4OXZYrVZf2Yx0j1nu7YL\nPZhSBMl7pqW/jaEAmDyVfYmr2L01WLEyCR3CI2H/BRQyG8/BHruVFVrLf8CwJ5Q8\nsPkzCfcjFMjDKSulv0A2kVlebyId60kY99evIOWB0v6uaUAC18vPbEu/2pcOSCgp\nIiAnc7x36qulAT0V4MtKZL4JIL7atm2v4iO0uucYNWcxuHqYEbd5kEJvxbbltNun\n3qMMlyL/EKUVowmEanGZ439TI4D5FX5hU3O0aEJP4VDXDC5aTqiGtJ7TEQSsNGqi\np15j9MDct/wRqtdQmgp+tM46X/thNkCzSC4XEt5B7ujd5Ji6FkZ1ns7n0v1ixjRY\nprVkyY42vU5RqjFGv2lHIoJu6u2WxjRCvApQWcwbZuEDXYcm2j05ETTJLO02bOgi\n0BU7ZiSJ\n=Jmfe\n-----END PGP SIGNATURE-----",
        "payload": "tree 9221acec019450a1359b9f05825667f7f117ee03\nparent fa3999a27e2cabbe808e96ca569f7092ff53b532\nauthor MarcoFalke <falke.marco@gmail.com> 1629458038 +0200\ncommitter MarcoFalke <falke.marco@gmail.com> 1629459551 +0200\n\nMove LoadAddrman from init to addrdb\n\nInit should only concern itself with the initialization order, not the\ndetailed initialization logic of every module.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/faffb098fdb436d1a0dc48dd98a2ec472de3e2c2",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/faffb098fdb436d1a0dc48dd98a2ec472de3e2c2",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/faffb098fdb436d1a0dc48dd98a2ec472de3e2c2/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "fa3999a27e2cabbe808e96ca569f7092ff53b532",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa3999a27e2cabbe808e96ca569f7092ff53b532",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/fa3999a27e2cabbe808e96ca569f7092ff53b532"
      }
    ],
    "stats": {
      "total": 43,
      "additions": 26,
      "deletions": 17
    },
    "files": [
      {
        "sha": "61b675b3e4c555ea89aa165513638e091e18c519",
        "filename": "src/addrdb.cpp",
        "status": "modified",
        "additions": 19,
        "deletions": 0,
        "changes": 19,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/faffb098fdb436d1a0dc48dd98a2ec472de3e2c2/src/addrdb.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/faffb098fdb436d1a0dc48dd98a2ec472de3e2c2/src/addrdb.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrdb.cpp?ref=faffb098fdb436d1a0dc48dd98a2ec472de3e2c2",
        "patch": "@@ -247,6 +247,25 @@ bool CAddrDB::Read(CAddrMan& addr, CDataStream& ssPeers)\n     return DeserializeDB(ssPeers, addr, false);\n }\n \n+std::unique_ptr<CAddrMan> LoadAddrman(const ArgsManager& args)\n+{\n+    auto check_addrman = std::clamp<int32_t>(args.GetArg(\"-checkaddrman\", DEFAULT_ADDRMAN_CONSISTENCY_CHECKS), 0, 1000000);\n+    auto addrman = std::make_unique<CAddrMan>(/* deterministic */ false, /* consistency_check_ratio */ check_addrman);\n+\n+    // Load addresses from peers.dat\n+    const int64_t nStart{GetTimeMillis()};\n+    CAddrDB adb;\n+    if (adb.Read(*addrman)) {\n+        LogPrintf(\"Loaded %i addresses from peers.dat  %dms\\n\", addrman->size(), GetTimeMillis() - nStart);\n+    } else {\n+        // Addrman can be in an inconsistent state after failure, reset it\n+        addrman = std::make_unique<CAddrMan>(/* deterministic */ false, /* consistency_check_ratio */ check_addrman);\n+        LogPrintf(\"Recreating peers.dat\\n\");\n+        adb.Write(*addrman);\n+    }\n+    return addrman;\n+}\n+\n void DumpAnchors(const fs::path& anchors_db_path, const std::vector<CAddress>& anchors)\n {\n     LOG_TIME_SECONDS(strprintf(\"Flush %d outbound block-relay-only peer addresses to anchors.dat\", anchors.size()));"
      },
      {
        "sha": "91837fc52508348726063d79eb67ee6f55daa70b",
        "filename": "src/addrdb.h",
        "status": "modified",
        "additions": 4,
        "deletions": 1,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/faffb098fdb436d1a0dc48dd98a2ec472de3e2c2/src/addrdb.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/faffb098fdb436d1a0dc48dd98a2ec472de3e2c2/src/addrdb.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrdb.h?ref=faffb098fdb436d1a0dc48dd98a2ec472de3e2c2",
        "patch": "@@ -14,8 +14,9 @@\n #include <string>\n #include <vector>\n \n-class CAddress;\n+class ArgsManager;\n class CAddrMan;\n+class CAddress;\n class CDataStream;\n \n class CBanEntry\n@@ -100,6 +101,8 @@ class CBanDB\n     bool Read(banmap_t& banSet);\n };\n \n+std::unique_ptr<CAddrMan> LoadAddrman(const ArgsManager& args);\n+\n /**\n  * Dump the anchor IP address database (anchors.dat)\n  *"
      },
      {
        "sha": "35d758441064aa3a869af975eb924ce8f7c1f759",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 16,
        "changes": 19,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/faffb098fdb436d1a0dc48dd98a2ec472de3e2c2/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/faffb098fdb436d1a0dc48dd98a2ec472de3e2c2/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=faffb098fdb436d1a0dc48dd98a2ec472de3e2c2",
        "patch": "@@ -1165,22 +1165,9 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     const bool ignores_incoming_txs{args.GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY)};\n \n     assert(!node.addrman);\n-    auto check_addrman = std::clamp<int32_t>(args.GetArg(\"-checkaddrman\", DEFAULT_ADDRMAN_CONSISTENCY_CHECKS), 0, 1000000);\n-    node.addrman = std::make_unique<CAddrMan>(/* deterministic */ false, /* consistency_check_ratio */ check_addrman);\n-    {\n-        // Load addresses from peers.dat\n-        uiInterface.InitMessage(_(\"Loading P2P addresses\u2026\").translated);\n-        int64_t nStart = GetTimeMillis();\n-        CAddrDB adb;\n-        if (adb.Read(*node.addrman)) {\n-            LogPrintf(\"Loaded %i addresses from peers.dat  %dms\\n\", node.addrman->size(), GetTimeMillis() - nStart);\n-        } else {\n-            // Addrman can be in an inconsistent state after failure, reset it\n-            node.addrman = std::make_unique<CAddrMan>(/* deterministic */ false, /* consistency_check_ratio */ check_addrman);\n-            LogPrintf(\"Recreating peers.dat\\n\");\n-            adb.Write(*node.addrman);\n-        }\n-    }\n+    uiInterface.InitMessage(_(\"Loading P2P addresses\u2026\").translated);\n+    node.addrman = LoadAddrman(args);\n+\n     assert(!node.banman);\n     node.banman = std::make_unique<BanMan>(gArgs.GetDataDirNet() / \"banlist\", &uiInterface, args.GetArg(\"-bantime\", DEFAULT_MISBEHAVING_BANTIME));\n     assert(!node.connman);"
      }
    ]
  }
]