[
  {
    "sha": "bb6acff07982dda68b5c2ac81c99dbd7255bb9cc",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiYjZhY2ZmMDc5ODJkZGE2OGI1YzJhYzgxYzk5ZGJkNzI1NWJiOWNj",
    "commit": {
      "author": {
        "name": "Cory Fields",
        "email": "cory-nospam-@coryfields.com",
        "date": "2015-03-07T01:26:09Z"
      },
      "committer": {
        "name": "Cory Fields",
        "email": "cory-nospam-@coryfields.com",
        "date": "2015-03-10T17:59:46Z"
      },
      "message": "fix possible block db breakage during re-index\n\nWhen re-indexing, there are a few cases where garbage data may be skipped in\nthe block files. In these cases, the indices are correctly written to the index\ndb, however the pointer to the next position for writing in the current block\nfile is calculated by adding the sizes of the valid blocks found.\n\nAs a result, when the re-index is finished, the index db is correct for all\nexisting blocks, but the next block will be written to an incorrect offset,\nlikely overwriting existing blocks.\n\nRather than using the sum of all valid blocks to determine the next write\nposition, use the end of the last block written to the file. Don't assume that\nthe current block is the last one in the file, since they may be read\nout-of-order.",
      "tree": {
        "sha": "00eb1a97470a5e8d3728c9d00908d5ff5274d285",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/00eb1a97470a5e8d3728c9d00908d5ff5274d285"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/bb6acff07982dda68b5c2ac81c99dbd7255bb9cc",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bb6acff07982dda68b5c2ac81c99dbd7255bb9cc",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/bb6acff07982dda68b5c2ac81c99dbd7255bb9cc",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bb6acff07982dda68b5c2ac81c99dbd7255bb9cc/comments",
    "author": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "7c3fbc34aed578398b3f180a621c671ff3837cec",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7c3fbc34aed578398b3f180a621c671ff3837cec",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/7c3fbc34aed578398b3f180a621c671ff3837cec"
      }
    ],
    "stats": {
      "total": 5,
      "additions": 4,
      "deletions": 1
    },
    "files": [
      {
        "sha": "183dff6d39b5fdfe6c972d2016a0869bc2c151eb",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 1,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/bb6acff07982dda68b5c2ac81c99dbd7255bb9cc/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/bb6acff07982dda68b5c2ac81c99dbd7255bb9cc/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=bb6acff07982dda68b5c2ac81c99dbd7255bb9cc",
        "patch": "@@ -2455,8 +2455,11 @@ bool FindBlockPos(CValidationState &state, CDiskBlockPos &pos, unsigned int nAdd\n     }\n \n     nLastBlockFile = nFile;\n-    vinfoBlockFile[nFile].nSize += nAddSize;\n     vinfoBlockFile[nFile].AddBlock(nHeight, nTime);\n+    if (fKnown)\n+        vinfoBlockFile[nFile].nSize = std::max(pos.nPos + nAddSize, vinfoBlockFile[nFile].nSize);\n+    else\n+        vinfoBlockFile[nFile].nSize += nAddSize;\n \n     if (!fKnown) {\n         unsigned int nOldChunks = (pos.nPos + BLOCKFILE_CHUNK_SIZE - 1) / BLOCKFILE_CHUNK_SIZE;"
      }
    ]
  }
]