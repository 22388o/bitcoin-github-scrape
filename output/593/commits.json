[
  {
    "sha": "9a93c4c02471fea7acb4882efaebaaefc1733466",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5YTkzYzRjMDI0NzFmZWE3YWNiNDg4MmVmYWViYWFlZmMxNzMzNDY2",
    "commit": {
      "author": {
        "name": "Matt Corallo",
        "email": "matt@bluematt.me",
        "date": "2011-12-07T05:00:04Z"
      },
      "committer": {
        "name": "Matt Corallo",
        "email": "matt@bluematt.me",
        "date": "2012-01-05T05:29:28Z"
      },
      "message": "Automatically refocus on new SendCoinsEntrys and scroll to them.",
      "tree": {
        "sha": "05504e635175636408d824e6aeb17bf7a69b8132",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/05504e635175636408d824e6aeb17bf7a69b8132"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9a93c4c02471fea7acb4882efaebaaefc1733466",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9a93c4c02471fea7acb4882efaebaaefc1733466",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/9a93c4c02471fea7acb4882efaebaaefc1733466",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9a93c4c02471fea7acb4882efaebaaefc1733466/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "96d3bcb99690726d4c0e28355cc87c25e14f4c8d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/96d3bcb99690726d4c0e28355cc87c25e14f4c8d",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/96d3bcb99690726d4c0e28355cc87c25e14f4c8d"
      }
    ],
    "stats": {
      "total": 14,
      "additions": 14,
      "deletions": 0
    },
    "files": [
      {
        "sha": "6d32891172fe200c21c6056fb200ecfe8abdf9f2",
        "filename": "src/qt/sendcoinsdialog.cpp",
        "status": "modified",
        "additions": 7,
        "deletions": 0,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9a93c4c02471fea7acb4882efaebaaefc1733466/src/qt/sendcoinsdialog.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9a93c4c02471fea7acb4882efaebaaefc1733466/src/qt/sendcoinsdialog.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/sendcoinsdialog.cpp?ref=9a93c4c02471fea7acb4882efaebaaefc1733466",
        "patch": "@@ -11,6 +11,7 @@\n #include <QMessageBox>\n #include <QLocale>\n #include <QTextDocument>\n+#include <QScrollBar>\n \n SendCoinsDialog::SendCoinsDialog(QWidget *parent) :\n     QDialog(parent),\n@@ -188,6 +189,12 @@ SendCoinsEntry *SendCoinsDialog::addEntry()\n \n     // Focus the field, so that entry can start immediately\n     entry->clear();\n+    entry->setFocus();\n+    ui->scrollAreaWidgetContents->resize(ui->scrollAreaWidgetContents->sizeHint());\n+    QCoreApplication::instance()->processEvents();\n+    QScrollBar* bar = ui->scrollArea->verticalScrollBar();\n+    if (bar)\n+        bar->setSliderPosition(bar->maximum());\n     return entry;\n }\n "
      },
      {
        "sha": "ab5460f8c2c33687b3ad215925651015625dc78e",
        "filename": "src/qt/sendcoinsentry.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 0,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9a93c4c02471fea7acb4882efaebaaefc1733466/src/qt/sendcoinsentry.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9a93c4c02471fea7acb4882efaebaaefc1733466/src/qt/sendcoinsentry.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/sendcoinsentry.cpp?ref=9a93c4c02471fea7acb4882efaebaaefc1733466",
        "patch": "@@ -151,3 +151,8 @@ bool SendCoinsEntry::isClear()\n     return ui->payTo->text().isEmpty();\n }\n \n+void SendCoinsEntry::setFocus()\n+{\n+    ui->payTo->setFocus();\n+}\n+"
      },
      {
        "sha": "cdbf8932646650c0bba0feef8635a5422967a585",
        "filename": "src/qt/sendcoinsentry.h",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9a93c4c02471fea7acb4882efaebaaefc1733466/src/qt/sendcoinsentry.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9a93c4c02471fea7acb4882efaebaaefc1733466/src/qt/sendcoinsentry.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/sendcoinsentry.h?ref=9a93c4c02471fea7acb4882efaebaaefc1733466",
        "patch": "@@ -31,6 +31,8 @@ class SendCoinsEntry : public QFrame\n      */\n     QWidget *setupTabChain(QWidget *prev);\n \n+    void setFocus();\n+\n public slots:\n     void setRemoveEnabled(bool enabled);\n     void clear();"
      }
    ]
  },
  {
    "sha": "7d145a0f591dab109eae9adcfaf59303cce0431a",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo3ZDE0NWEwZjU5MWRhYjEwOWVhZTlhZGNmYWY1OTMwM2NjZTA0MzFh",
    "commit": {
      "author": {
        "name": "Matt Corallo",
        "email": "matt@bluematt.me",
        "date": "2011-12-24T04:27:12Z"
      },
      "committer": {
        "name": "Matt Corallo",
        "email": "matt@bluematt.me",
        "date": "2012-01-05T05:29:28Z"
      },
      "message": "Add support for opening bitcoin: URIs directly.",
      "tree": {
        "sha": "95fbe9a79ca7c5ebf393a7121530c903e37dec38",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/95fbe9a79ca7c5ebf393a7121530c903e37dec38"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7d145a0f591dab109eae9adcfaf59303cce0431a",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7d145a0f591dab109eae9adcfaf59303cce0431a",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/7d145a0f591dab109eae9adcfaf59303cce0431a",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7d145a0f591dab109eae9adcfaf59303cce0431a/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "9a93c4c02471fea7acb4882efaebaaefc1733466",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9a93c4c02471fea7acb4882efaebaaefc1733466",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/9a93c4c02471fea7acb4882efaebaaefc1733466"
      }
    ],
    "stats": {
      "total": 207,
      "additions": 202,
      "deletions": 5
    },
    "files": [
      {
        "sha": "ab5414c04954ce25e9f03626ae80058e6a311578",
        "filename": "bitcoin-qt.pro",
        "status": "modified",
        "additions": 4,
        "deletions": 2,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7d145a0f591dab109eae9adcfaf59303cce0431a/bitcoin-qt.pro",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7d145a0f591dab109eae9adcfaf59303cce0431a/bitcoin-qt.pro",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/bitcoin-qt.pro?ref=7d145a0f591dab109eae9adcfaf59303cce0431a",
        "patch": "@@ -144,7 +144,8 @@ HEADERS += src/qt/bitcoingui.h \\\n     src/qt/qvaluecombobox.h \\\n     src/qt/askpassphrasedialog.h \\\n     src/protocol.h \\\n-    src/qt/notificator.h\n+    src/qt/notificator.h \\\n+    src/qt/qtipcserver.h\n \n SOURCES += src/qt/bitcoin.cpp src/qt/bitcoingui.cpp \\\n     src/qt/transactiontablemodel.cpp \\\n@@ -192,7 +193,8 @@ SOURCES += src/qt/bitcoin.cpp src/qt/bitcoingui.cpp \\\n     src/qt/qvaluecombobox.cpp \\\n     src/qt/askpassphrasedialog.cpp \\\n     src/protocol.cpp \\\n-    src/qt/notificator.cpp\n+    src/qt/notificator.cpp \\\n+    src/qt/qtipcserver.cpp\n \n RESOURCES += \\\n     src/qt/bitcoin.qrc"
      },
      {
        "sha": "ea5a6e4ac44bd762e12b99de39b85cc14896dab8",
        "filename": "contrib/debian/bitcoin-qt.desktop",
        "status": "modified",
        "additions": 1,
        "deletions": 2,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7d145a0f591dab109eae9adcfaf59303cce0431a/contrib/debian/bitcoin-qt.desktop",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7d145a0f591dab109eae9adcfaf59303cce0431a/contrib/debian/bitcoin-qt.desktop",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/debian/bitcoin-qt.desktop?ref=7d145a0f591dab109eae9adcfaf59303cce0431a",
        "patch": "@@ -6,6 +6,5 @@ Exec=/usr/bin/bitcoin-qt\n Terminal=false\n Type=Application\n Icon=/usr/share/pixmaps/bitcoin80.xpm\n-#For when bitcoin (finally) properly handles bitcoin: URLs\n-#MimeType=x-scheme-handler/bitcoin;\n+MimeType=x-scheme-handler/bitcoin;\n Categories=Office;"
      },
      {
        "sha": "6a566f515aa4b3d24026a3b034c2cb73fcba5005",
        "filename": "contrib/debian/bitcoin-qt.install",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7d145a0f591dab109eae9adcfaf59303cce0431a/contrib/debian/bitcoin-qt.install",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7d145a0f591dab109eae9adcfaf59303cce0431a/contrib/debian/bitcoin-qt.install",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/debian/bitcoin-qt.install?ref=7d145a0f591dab109eae9adcfaf59303cce0431a",
        "patch": "@@ -3,3 +3,4 @@ bitcoin-qt usr/lib/bitcoin\n share/pixmaps/bitcoin32.xpm usr/share/pixmaps\n share/pixmaps/bitcoin80.xpm usr/share/pixmaps\n debian/bitcoin-qt.desktop usr/share/applications\n+debian/bitcoin-qt.protocol usr/share/kde4/services/"
      },
      {
        "sha": "014588d53679baf51055d70b8a621a99217eb160",
        "filename": "contrib/debian/bitcoin-qt.protocol",
        "status": "added",
        "additions": 11,
        "deletions": 0,
        "changes": 11,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7d145a0f591dab109eae9adcfaf59303cce0431a/contrib/debian/bitcoin-qt.protocol",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7d145a0f591dab109eae9adcfaf59303cce0431a/contrib/debian/bitcoin-qt.protocol",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/debian/bitcoin-qt.protocol?ref=7d145a0f591dab109eae9adcfaf59303cce0431a",
        "patch": "@@ -0,0 +1,11 @@\n+[Protocol]\n+exec=bitcoin-qt '%u'\n+protocol=bitcoin\n+input=none\n+output=none\n+helper=true\n+listing=\n+reading=false\n+writing=false\n+makedir=false\n+deleting=false"
      },
      {
        "sha": "44aa6836297124f39c33b7afa3aee1fb52ae8ded",
        "filename": "contrib/debian/changelog",
        "status": "modified",
        "additions": 7,
        "deletions": 0,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7d145a0f591dab109eae9adcfaf59303cce0431a/contrib/debian/changelog",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7d145a0f591dab109eae9adcfaf59303cce0431a/contrib/debian/changelog",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/debian/changelog?ref=7d145a0f591dab109eae9adcfaf59303cce0431a",
        "patch": "@@ -1,3 +1,10 @@\n+bitcoin (0.5.1-natty1) natty; urgency=low\n+\n+  * Add GNOME/KDE support for bitcoin-qt's bitcoin: URI support.\n+    Thanks to luke-jr for the KDE .protocol file.\n+\n+ -- Matt Corallo <matt@bluematt.me>  Fri, 23 Dec 2011 20:25:00 -0500\n+\n bitcoin (0.5.1-natty0) natty; urgency=low\n \n   * New upstream release."
      },
      {
        "sha": "dcd192fa5f19f8370a2f154cefa1ab53ba3110d3",
        "filename": "share/setup.nsi",
        "status": "modified",
        "additions": 5,
        "deletions": 0,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7d145a0f591dab109eae9adcfaf59303cce0431a/share/setup.nsi",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7d145a0f591dab109eae9adcfaf59303cce0431a/share/setup.nsi",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/share/setup.nsi?ref=7d145a0f591dab109eae9adcfaf59303cce0431a",
        "patch": "@@ -94,6 +94,10 @@ Section -post SEC0001\n     WriteRegStr HKCU \"SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\$(^Name)\" UninstallString $INSTDIR\\uninstall.exe\r\n     WriteRegDWORD HKCU \"SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\$(^Name)\" NoModify 1\r\n     WriteRegDWORD HKCU \"SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\$(^Name)\" NoRepair 1\r\n+    WriteRegStr HKCR \"bitcoin\" \"URL Protocol\" \"\"\r\n+    WriteRegStr HKCR \"bitcoin\" \"\" \"URL:Bitcoin\"\r\n+    WriteRegStr HKCR \"bitcoin\\DefaultIcon\" \"\" $INSTDIR\\bitcoin.exe\r\n+    WriteRegStr HKCR \"bitcoin\\shell\\open\\command\" \"\" '\"$INSTDIR\\bitcoin.exe\" \"$$1\"'\r\n SectionEnd\r\n \r\n # Macro for selecting uninstaller sections\r\n@@ -131,6 +135,7 @@ Section -un.post UNSEC0001\n     DeleteRegValue HKCU \"${REGKEY}\" Path\r\n     DeleteRegKey /IfEmpty HKCU \"${REGKEY}\\Components\"\r\n     DeleteRegKey /IfEmpty HKCU \"${REGKEY}\"\r\n+    DeleteRegKey HKCR \"bitcoin\"\r\n     RmDir /REBOOTOK $SMPROGRAMS\\$StartMenuGroup\r\n     RmDir /REBOOTOK $INSTDIR\r\n     Push $R0\r"
      },
      {
        "sha": "05ba795381b030e2df44656870755c08a73d2548",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7d145a0f591dab109eae9adcfaf59303cce0431a/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7d145a0f591dab109eae9adcfaf59303cce0431a/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=7d145a0f591dab109eae9adcfaf59303cce0431a",
        "patch": "@@ -272,7 +272,7 @@ bool AppInit2(int argc, char* argv[])\n \n #ifndef QT_GUI\n     for (int i = 1; i < argc; i++)\n-        if (!IsSwitchChar(argv[i][0]))\n+        if (!IsSwitchChar(argv[i][0]) && !(strlen(argv[i]) > 7 && strncasecmp(argv[i], \"bitcoin:\", 8) == 0))\n             fCommandLine = true;\n \n     if (fCommandLine)"
      },
      {
        "sha": "85ece9e2ceb628d6809d4e8b0af95906b4cca308",
        "filename": "src/qt/bitcoin.cpp",
        "status": "modified",
        "additions": 55,
        "deletions": 0,
        "changes": 55,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7d145a0f591dab109eae9adcfaf59303cce0431a/src/qt/bitcoin.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7d145a0f591dab109eae9adcfaf59303cce0431a/src/qt/bitcoin.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/bitcoin.cpp?ref=7d145a0f591dab109eae9adcfaf59303cce0431a",
        "patch": "@@ -8,6 +8,7 @@\n \n #include \"headers.h\"\n #include \"init.h\"\n+#include \"qtipcserver.h\"\n \n #include <QApplication>\n #include <QMessageBox>\n@@ -18,6 +19,8 @@\n #include <QSplashScreen>\n #include <QLibraryInfo>\n \n+#include <boost/interprocess/ipc/message_queue.hpp>\n+\n // Need a global reference for the notifications to find the GUI\n BitcoinGUI *guiref;\n QSplashScreen *splashref;\n@@ -79,6 +82,22 @@ bool ThreadSafeAskFee(int64 nFeeRequired, const std::string& strCaption, wxWindo\n     return payFee;\n }\n \n+void ThreadSafeHandleURL(const std::string& strURL)\n+{\n+    if(!guiref)\n+        return;\n+\n+    // Call slot on GUI thread.\n+    // If called from another thread, use a blocking QueuedConnection.\n+    Qt::ConnectionType connectionType = Qt::DirectConnection;\n+    if(QThread::currentThread() != QCoreApplication::instance()->thread())\n+    {\n+        connectionType = Qt::BlockingQueuedConnection;\n+    }\n+    QMetaObject::invokeMethod(guiref, \"handleURL\", connectionType,\n+                               Q_ARG(QString, QString::fromStdString(strURL)));\n+}\n+\n void CalledSetStatusBar(const std::string& strText, int nField)\n {\n     // Only used for built-in mining, which is disabled, simple ignore\n@@ -114,6 +133,25 @@ std::string _(const char* psz)\n \n int main(int argc, char *argv[])\n {\n+    // Do this early as we don't want to bother initializing if we are just calling IPC\n+    for (int i = 1; i < argc; i++)\n+    {\n+        if (strlen(argv[i]) > 7 && strncasecmp(argv[i], \"bitcoin:\", 8) == 0)\n+        {\n+            const char *strURL = argv[i];\n+            try {\n+                boost::interprocess::message_queue mq(boost::interprocess::open_only, \"BitcoinURL\");\n+                if(mq.try_send(strURL, strlen(strURL), 0))\n+                    exit(0);\n+                else\n+                    break;\n+            }\n+            catch (boost::interprocess::interprocess_exception &ex) {\n+                break;\n+            }\n+        }\n+    }\n+\n     // Internal string conversion is all UTF-8\n     QTextCodec::setCodecForTr(QTextCodec::codecForName(\"UTF-8\"));\n     QTextCodec::setCodecForCStrings(QTextCodec::codecForTr());\n@@ -185,6 +223,23 @@ int main(int argc, char *argv[])\n                     window.show();\n                 }\n \n+                // Place this here as guiref has to be defined if we dont want to lose URLs\n+                ipcInit();\n+                // Check for URL in argv\n+                for (int i = 1; i < argc; i++)\n+                {\n+                    if (strlen(argv[i]) > 7 && strncasecmp(argv[i], \"bitcoin:\", 8) == 0)\n+                    {\n+                        const char *strURL = argv[i];\n+                        try {\n+                            boost::interprocess::message_queue mq(boost::interprocess::open_only, \"BitcoinURL\");\n+                            mq.try_send(strURL, strlen(strURL), 0);\n+                        }\n+                        catch (boost::interprocess::interprocess_exception &ex) {\n+                        }\n+                    }\n+                }\n+\n                 app.exec();\n \n                 guiref = 0;"
      },
      {
        "sha": "c9381a605917f5573f2e735b696273fa25f65945",
        "filename": "src/qt/bitcoingui.cpp",
        "status": "modified",
        "additions": 7,
        "deletions": 0,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7d145a0f591dab109eae9adcfaf59303cce0431a/src/qt/bitcoingui.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7d145a0f591dab109eae9adcfaf59303cce0431a/src/qt/bitcoingui.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/bitcoingui.cpp?ref=7d145a0f591dab109eae9adcfaf59303cce0431a",
        "patch": "@@ -671,6 +671,13 @@ void BitcoinGUI::dropEvent(QDropEvent *event)\n     event->acceptProposedAction();\n }\n \n+void BitcoinGUI::handleURL(QString strURL)\n+{\n+    gotoSendCoinsPage();\n+    QUrl url = QUrl(strURL);\n+    sendCoinsPage->handleURL(&url);\n+}\n+\n void BitcoinGUI::setEncryptionStatus(int status)\n {\n     switch(status)"
      },
      {
        "sha": "d54dc9fcd2e4c874e81da3fa9d186f9ca9df882b",
        "filename": "src/qt/bitcoingui.h",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7d145a0f591dab109eae9adcfaf59303cce0431a/src/qt/bitcoingui.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7d145a0f591dab109eae9adcfaf59303cce0431a/src/qt/bitcoingui.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/bitcoingui.h?ref=7d145a0f591dab109eae9adcfaf59303cce0431a",
        "patch": "@@ -123,6 +123,7 @@ public slots:\n       @param[out] payFee            true to pay the fee, false to not pay the fee\n     */\n     void askFee(qint64 nFeeRequired, bool *payFee);\n+    void handleURL(QString strURL);\n \n private slots:\n     /** Switch to overview (home) page */"
      },
      {
        "sha": "2ed8b915c5cb66b85fbd1a934f044efc2e73ac43",
        "filename": "src/qt/qtipcserver.cpp",
        "status": "added",
        "additions": 95,
        "deletions": 0,
        "changes": 95,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7d145a0f591dab109eae9adcfaf59303cce0431a/src/qt/qtipcserver.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7d145a0f591dab109eae9adcfaf59303cce0431a/src/qt/qtipcserver.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/qtipcserver.cpp?ref=7d145a0f591dab109eae9adcfaf59303cce0431a",
        "patch": "@@ -0,0 +1,95 @@\n+// Copyright (c) 2011 The Bitcoin developers\n+// Distributed under the MIT/X11 software license, see the accompanying\n+// file license.txt or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <boost/algorithm/string.hpp>\n+#include <boost/interprocess/ipc/message_queue.hpp>\n+#include <boost/tokenizer.hpp>\n+#include <boost/date_time/posix_time/posix_time.hpp>\n+\n+#include \"headers.h\"\n+\n+using namespace boost::interprocess;\n+using namespace boost::posix_time;\n+using namespace boost;\n+using namespace std;\n+\n+void ipcShutdown()\n+{\n+    message_queue::remove(\"BitcoinURL\");\n+}\n+\n+void ipcThread(void* parg)\n+{\n+    message_queue* mq = (message_queue*)parg;\n+    char strBuf[257];\n+    size_t nSize;\n+    unsigned int nPriority;\n+    loop\n+    {\n+        ptime d = boost::posix_time::microsec_clock::universal_time() + millisec(100);\n+        if(mq->timed_receive(&strBuf, sizeof(strBuf), nSize, nPriority, d))\n+        {\n+            strBuf[nSize] = '\\0';\n+            // Convert bitcoin:// URLs to bitcoin: URIs\n+            if (strBuf[8] == '/' && strBuf[9] == '/')\n+            {\n+                for (int i = 8; i < 256; i++)\n+                {\n+                    strBuf[i] = strBuf[i+2];\n+                }\n+            }\n+            ThreadSafeHandleURL(strBuf);\n+            Sleep(1000);\n+        }\n+        if (fShutdown)\n+        {\n+            ipcShutdown();\n+            break;\n+        }\n+    }\n+    ipcShutdown();\n+}\n+\n+void ipcInit()\n+{\n+    message_queue* mq;\n+    char strBuf[257];\n+    size_t nSize;\n+    unsigned int nPriority;\n+    try {\n+        mq = new message_queue(open_or_create, \"BitcoinURL\", 2, 256);\n+\n+        // Make sure we don't lose any bitcoin: URIs\n+        for (int i = 0; i < 2; i++)\n+        {\n+            ptime d = boost::posix_time::microsec_clock::universal_time() + millisec(1);\n+            if(mq->timed_receive(&strBuf, sizeof(strBuf), nSize, nPriority, d))\n+            {\n+                strBuf[nSize] = '\\0';\n+                // Convert bitcoin:// URLs to bitcoin: URIs\n+                if (strBuf[8] == '/' && strBuf[9] == '/')\n+                {\n+                    for (int i = 8; i < 256; i++)\n+                    {\n+                        strBuf[i] = strBuf[i+2];\n+                    }\n+                }\n+                ThreadSafeHandleURL(strBuf);\n+            }\n+            else\n+                break;\n+        }\n+\n+        // Make sure only one bitcoin instance is listening\n+        message_queue::remove(\"BitcoinURL\");\n+        mq = new message_queue(open_or_create, \"BitcoinURL\", 2, 256);\n+    }\n+    catch (interprocess_exception &ex) {\n+        return;\n+    }\n+    if (!CreateThread(ipcThread, mq))\n+    {\n+        delete mq;\n+    }\n+}"
      },
      {
        "sha": "1de0334afda66b902801728fb30cae754f6e64f6",
        "filename": "src/qt/qtipcserver.h",
        "status": "added",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7d145a0f591dab109eae9adcfaf59303cce0431a/src/qt/qtipcserver.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7d145a0f591dab109eae9adcfaf59303cce0431a/src/qt/qtipcserver.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/qtipcserver.h?ref=7d145a0f591dab109eae9adcfaf59303cce0431a",
        "patch": "@@ -0,0 +1,2 @@\n+void ipcInit();\n+void ipcShutdown();"
      },
      {
        "sha": "0d9a604d3b1f4658338fef46db980cf2f89ca763",
        "filename": "src/qt/sendcoinsdialog.cpp",
        "status": "modified",
        "additions": 10,
        "deletions": 0,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7d145a0f591dab109eae9adcfaf59303cce0431a/src/qt/sendcoinsdialog.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7d145a0f591dab109eae9adcfaf59303cce0431a/src/qt/sendcoinsdialog.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/sendcoinsdialog.cpp?ref=7d145a0f591dab109eae9adcfaf59303cce0431a",
        "patch": "@@ -30,6 +30,8 @@ SendCoinsDialog::SendCoinsDialog(QWidget *parent) :\n \n     connect(ui->addButton, SIGNAL(clicked()), this, SLOT(addEntry()));\n     connect(ui->clearButton, SIGNAL(clicked()), this, SLOT(clear()));\n+\n+    fNewRecipientAllowed = true;\n }\n \n void SendCoinsDialog::setModel(WalletModel *model)\n@@ -92,20 +94,24 @@ void SendCoinsDialog::on_sendButton_clicked()\n         formatted.append(tr(\"<b>%1</b> to %2 (%3)\").arg(BitcoinUnits::formatWithUnit(BitcoinUnits::BTC, rcp.amount), Qt::escape(rcp.label), rcp.address));\n     }\n \n+    fNewRecipientAllowed = false;\n+\n     QMessageBox::StandardButton retval = QMessageBox::question(this, tr(\"Confirm send coins\"),\n                           tr(\"Are you sure you want to send %1?\").arg(formatted.join(tr(\" and \"))),\n           QMessageBox::Yes|QMessageBox::Cancel,\n           QMessageBox::Cancel);\n \n     if(retval != QMessageBox::Yes)\n     {\n+        fNewRecipientAllowed = true;\n         return;\n     }\n \n     WalletModel::UnlockContext ctx(model->requestUnlock());\n     if(!ctx.isValid())\n     {\n         // Unlock wallet was cancelled\n+        fNewRecipientAllowed = true;\n         return;\n     }\n \n@@ -152,6 +158,7 @@ void SendCoinsDialog::on_sendButton_clicked()\n         accept();\n         break;\n     }\n+    fNewRecipientAllowed = true;\n }\n \n void SendCoinsDialog::clear()\n@@ -236,6 +243,9 @@ QWidget *SendCoinsDialog::setupTabChain(QWidget *prev)\n \n void SendCoinsDialog::pasteEntry(const SendCoinsRecipient &rv)\n {\n+    if (!fNewRecipientAllowed)\n+        return;\n+\n     SendCoinsEntry *entry = 0;\n     // Replace the first entry if it is still unused\n     if(ui->entries->count() == 1)"
      },
      {
        "sha": "847ee8b6976bfe5b5d054515cfc9b2ecd1a2215b",
        "filename": "src/qt/sendcoinsdialog.h",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7d145a0f591dab109eae9adcfaf59303cce0431a/src/qt/sendcoinsdialog.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7d145a0f591dab109eae9adcfaf59303cce0431a/src/qt/sendcoinsdialog.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/sendcoinsdialog.h?ref=7d145a0f591dab109eae9adcfaf59303cce0431a",
        "patch": "@@ -43,6 +43,7 @@ public slots:\n private:\n     Ui::SendCoinsDialog *ui;\n     WalletModel *model;\n+    bool fNewRecipientAllowed;\n \n private slots:\n     void on_sendButton_clicked();"
      },
      {
        "sha": "9791ba544d24d581231d2d7657af01b4dad80c5c",
        "filename": "src/qtui.h",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7d145a0f591dab109eae9adcfaf59303cce0431a/src/qtui.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7d145a0f591dab109eae9adcfaf59303cce0431a/src/qtui.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qtui.h?ref=7d145a0f591dab109eae9adcfaf59303cce0431a",
        "patch": "@@ -40,6 +40,7 @@ extern int MyMessageBox(const std::string& message, const std::string& caption=\"\n #define wxMessageBox  MyMessageBox\n extern int ThreadSafeMessageBox(const std::string& message, const std::string& caption, int style=wxOK, wxWindow* parent=NULL, int x=-1, int y=-1);\n extern bool ThreadSafeAskFee(int64 nFeeRequired, const std::string& strCaption, wxWindow* parent);\n+extern void ThreadSafeHandleURL(const std::string& strURL);\n extern void CalledSetStatusBar(const std::string& strText, int nField);\n extern void UIThreadCall(boost::function0<void> fn);\n extern void MainFrameRepaint();"
      }
    ]
  }
]