[
  {
    "sha": "3560d8cebfc58a9d54cbd64a4ef8ef6ca317b497",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozNTYwZDhjZWJmYzU4YTlkNTRjYmQ2NGE0ZWY4ZWY2Y2EzMTdiNDk3",
    "commit": {
      "author": {
        "name": "Carl Dong",
        "email": "accounts@carldong.me",
        "date": "2019-05-15T17:50:01Z"
      },
      "committer": {
        "name": "Carl Dong",
        "email": "contact@carldong.me",
        "date": "2019-05-29T15:04:31Z"
      },
      "message": "depends: Build secondary deps statically.\n\nSecondary dependencies don't need to be shared.",
      "tree": {
        "sha": "07d5310a0098c11e828e2ba3988fb2d94cc777a1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/07d5310a0098c11e828e2ba3988fb2d94cc777a1"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3560d8cebfc58a9d54cbd64a4ef8ef6ca317b497",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEECc3SW1JEo3Z49u6oDMUhUxl5kaUFAlzun4AACgkQDMUhUxl5\nkaUTaw//ZsDJJr/tP0dxlyOvi2/0ZiZCRcrGgP7IEvbrhEnkmPJs5WtoP4LDVO71\nDZMfFq8j1fY15pNSLD7TezMqpcHS5fwqpT2jSrscytuKPDso7dX6Vbdvzmuvq4Po\nJg8SsL0XCQmCC6IULIjVlcm+BN6yIMM/aJ9I4fMWqq3+wcZos0AnHVxSpvXIOp/U\nhiT1EvpgjXYj0n6amfKiTWkVX8WuZxwgu2iQMagrlmh4uFaJbKVv4bAFXKlN06GF\nIxhvfIwW8qRRBuHuZUZ8DsSydNarNw26ArflykogLMNq8gSiHg+vztxNwzMlnJrf\nn+Fb8MdKuU13RMcucfjWZK+AAtwV3mG2/SKdiD/wMeDkYM2LHUBLy6T5r7YxjYLI\nJGybKnZVkbU6wnczirzzgxblfaSKjlmElCPlOyDIgTTl/Iwoy32ti9omaWG5ZdkM\nlzA8dpWHVNy9tT4REsMA9VD6yXrog0IuSUrt1Er9SOBZDGGZmR+vnx6cnTk/nSt4\n5H1jOQe6Pp1LQLqdmAs/afQSQw6jOsZBhUhg+Co93u0hQWYswrYXn6hWnPBwPIbz\nH+QYRtpVw7luValzysJiCOCaruBlICWqbnlutUdkToo6NX2V/SsyrYAuusc9meld\naS/MjYR8tCdACuyQ1jkAv9EatzqPeij9vdChq8SYnmz9ojEcO14=\n=Zq4o\n-----END PGP SIGNATURE-----",
        "payload": "tree 07d5310a0098c11e828e2ba3988fb2d94cc777a1\nparent 76e2cded477bc483ec610212bdadf21fe35292d4\nauthor Carl Dong <accounts@carldong.me> 1557942601 -0400\ncommitter Carl Dong <contact@carldong.me> 1559142271 -0400\n\ndepends: Build secondary deps statically.\n\nSecondary dependencies don't need to be shared.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3560d8cebfc58a9d54cbd64a4ef8ef6ca317b497",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/3560d8cebfc58a9d54cbd64a4ef8ef6ca317b497",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3560d8cebfc58a9d54cbd64a4ef8ef6ca317b497/comments",
    "author": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "76e2cded477bc483ec610212bdadf21fe35292d4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/76e2cded477bc483ec610212bdadf21fe35292d4",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/76e2cded477bc483ec610212bdadf21fe35292d4"
      }
    ],
    "stats": {
      "total": 32,
      "additions": 28,
      "deletions": 4
    },
    "files": [
      {
        "sha": "b46eff58091da9440d3a77a5d16978434e3313f1",
        "filename": "depends/packages.md",
        "status": "modified",
        "additions": 23,
        "deletions": 0,
        "changes": 23,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3560d8cebfc58a9d54cbd64a4ef8ef6ca317b497/depends/packages.md",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3560d8cebfc58a9d54cbd64a4ef8ef6ca317b497/depends/packages.md",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/depends/packages.md?ref=3560d8cebfc58a9d54cbd64a4ef8ef6ca317b497",
        "patch": "@@ -5,6 +5,10 @@ The package \"mylib\" will be used here as an example\n \n General tips:\n - mylib_foo is written as $(package)_foo in order to make recipes more similar.\n+- Secondary dependency packages relative to the bitcoin binaries/libraries (i.e.\n+  those not in `ALLOWED_LIBRARIES` in `contrib/devtools/symbol-check.py`) don't\n+  need to be shared and should be built statically whenever possible. See\n+  [below](#secondary-dependencies) for more details.\n \n ## Identifiers\n Each package is required to define at least these variables:\n@@ -146,3 +150,22 @@ $($(package)_config_opts) will be appended.\n Most autotools projects can be properly staged using:\n \n     $(MAKE) DESTDIR=$($(package)_staging_dir) install\n+\n+## Secondary dependencies:\n+\n+Secondary dependency packages relative to the bitcoin binaries/libraries (i.e.\n+those not in `ALLOWED_LIBRARIES` in `contrib/devtools/symbol-check.py`) don't\n+need to be shared and should be built statically whenever possible. This\n+improves general build reliability as illustrated by the following example:\n+\n+When linking an executable against a shared library `libprimary` that has its\n+own shared dependency `libsecondary`, we may need to specify the path to\n+`libsecondary` on the link command using the `-rpath/-rpath-link` options, it is\n+not sufficient to just say `libprimary`.\n+\n+For us, it's much easier to just link a static `libsecondary` into a shared\n+`libprimary`. Especially because in our case, we are linking against a dummy\n+`libprimary` anyway that we'll throw away. We don't care if the end-user has a\n+static or dynamic `libsecondary`, that's not our concern. With a static\n+`libsecondary`, when we need to link `libprimary` into our executable, there's\n+no dependency chain to worry about as `libprimary` has all the symbols."
      },
      {
        "sha": "0460a2f2e4ee6b7ead431b13f64833fe52978ea3",
        "filename": "depends/packages/dbus.mk",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3560d8cebfc58a9d54cbd64a4ef8ef6ca317b497/depends/packages/dbus.mk",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3560d8cebfc58a9d54cbd64a4ef8ef6ca317b497/depends/packages/dbus.mk",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/depends/packages/dbus.mk?ref=3560d8cebfc58a9d54cbd64a4ef8ef6ca317b497",
        "patch": "@@ -6,7 +6,7 @@ $(package)_sha256_hash=6049ddd5f3f3e2618f615f1faeda0a115104423a7996b7aa73e2f36e3\n $(package)_dependencies=expat\n \n define $(package)_set_vars\n-  $(package)_config_opts=--disable-tests --disable-doxygen-docs --disable-xml-docs --disable-static --without-x\n+  $(package)_config_opts=--disable-tests --disable-doxygen-docs --disable-xml-docs --disable-shared --without-x\n endef\n \n define $(package)_config_cmds"
      },
      {
        "sha": "531965b28d4356150af5fb47f163691eb76d7184",
        "filename": "depends/packages/expat.mk",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3560d8cebfc58a9d54cbd64a4ef8ef6ca317b497/depends/packages/expat.mk",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3560d8cebfc58a9d54cbd64a4ef8ef6ca317b497/depends/packages/expat.mk",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/depends/packages/expat.mk?ref=3560d8cebfc58a9d54cbd64a4ef8ef6ca317b497",
        "patch": "@@ -5,7 +5,8 @@ $(package)_file_name=$(package)-$($(package)_version).tar.bz2\n $(package)_sha256_hash=17b43c2716d521369f82fc2dc70f359860e90fa440bea65b3b85f0b246ea81f2\n \n define $(package)_set_vars\n-$(package)_config_opts=--disable-static --without-docbook\n+  $(package)_config_opts=--disable-shared --without-docbook\n+  $(package)_config_opts_linux=--with-pic\n endef\n \n define $(package)_config_cmds"
      },
      {
        "sha": "d94f49f3be4748a25523b0e1de1747792ba5f4ca",
        "filename": "depends/packages/libXext.mk",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3560d8cebfc58a9d54cbd64a4ef8ef6ca317b497/depends/packages/libXext.mk",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3560d8cebfc58a9d54cbd64a4ef8ef6ca317b497/depends/packages/libXext.mk",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/depends/packages/libXext.mk?ref=3560d8cebfc58a9d54cbd64a4ef8ef6ca317b497",
        "patch": "@@ -6,7 +6,7 @@ $(package)_sha256_hash=f829075bc646cdc085fa25d98d5885d83b1759ceb355933127c257e8e\n $(package)_dependencies=xproto xextproto libX11 libXau\n \n define $(package)_set_vars\n-  $(package)_config_opts=--disable-static\n+  $(package)_config_opts=--disable-shared\n endef\n \n define $(package)_preprocess_cmds"
      },
      {
        "sha": "1993ff8344cba4e484b7997f6530bdcf8be308e5",
        "filename": "depends/packages/xtrans.mk",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3560d8cebfc58a9d54cbd64a4ef8ef6ca317b497/depends/packages/xtrans.mk",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3560d8cebfc58a9d54cbd64a4ef8ef6ca317b497/depends/packages/xtrans.mk",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/depends/packages/xtrans.mk?ref=3560d8cebfc58a9d54cbd64a4ef8ef6ca317b497",
        "patch": "@@ -6,7 +6,7 @@ $(package)_sha256_hash=054d4ee3efd52508c753e9f7bc655ef185a29bd2850dd9e2fc2ccc335\n $(package)_dependencies=\n \n define $(package)_set_vars\n-$(package)_config_opts_linux=--with-pic --disable-static\n+$(package)_config_opts_linux=--with-pic --disable-shared\n endef\n \n define $(package)_preprocess_cmds"
      }
    ]
  }
]