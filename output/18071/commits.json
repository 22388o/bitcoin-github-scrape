[
  {
    "sha": "97fe971b1147cb80a4ac4f0c56cfd295564f83d3",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5N2ZlOTcxYjExNDdjYjgwYTRhYzRmMGM1NmNmZDI5NTU2NGY4M2Qz",
    "commit": {
      "author": {
        "name": "Jeremy Rubin",
        "email": "j@rubin.io",
        "date": "2019-10-07T20:45:00Z"
      },
      "committer": {
        "name": "Jeremy Rubin",
        "email": "j@rubin.io",
        "date": "2020-08-03T17:13:49Z"
      },
      "message": "Add single sha256 call to CHashWriter",
      "tree": {
        "sha": "354c087c465fa146b4284819cda6960276701772",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/354c087c465fa146b4284819cda6960276701772"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/97fe971b1147cb80a4ac4f0c56cfd295564f83d3",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/97fe971b1147cb80a4ac4f0c56cfd295564f83d3",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/97fe971b1147cb80a4ac4f0c56cfd295564f83d3",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/97fe971b1147cb80a4ac4f0c56cfd295564f83d3/comments",
    "author": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "34eb2362581d4d8f0bfd3baa12ba750afaf85c62",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/34eb2362581d4d8f0bfd3baa12ba750afaf85c62",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/34eb2362581d4d8f0bfd3baa12ba750afaf85c62"
      }
    ],
    "stats": {
      "total": 27,
      "additions": 20,
      "deletions": 7
    },
    "files": [
      {
        "sha": "4f392fa0aa363094f379cab2515650a06a793e29",
        "filename": "src/hash.h",
        "status": "modified",
        "additions": 20,
        "deletions": 7,
        "changes": 27,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/97fe971b1147cb80a4ac4f0c56cfd295564f83d3/src/hash.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/97fe971b1147cb80a4ac4f0c56cfd295564f83d3/src/hash.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/hash.h?ref=97fe971b1147cb80a4ac4f0c56cfd295564f83d3",
        "patch": "@@ -98,7 +98,7 @@ inline uint160 Hash160(const T1& in1)\n class CHashWriter\n {\n private:\n-    CHash256 ctx;\n+    CSHA256 ctx;\n \n     const int nType;\n     const int nVersion;\n@@ -110,23 +110,36 @@ class CHashWriter\n     int GetVersion() const { return nVersion; }\n \n     void write(const char *pch, size_t size) {\n-        ctx.Write({(const unsigned char*)pch, size});\n+        ctx.Write((const unsigned char*)pch, size);\n     }\n \n-    // invalidates the object\n+    /** Compute the double-SHA256 hash of all data written to this object.\n+     *\n+     * Invalidates this object.\n+     */\n     uint256 GetHash() {\n         uint256 result;\n-        ctx.Finalize(result);\n+        ctx.Finalize(result.begin());\n+        ctx.Reset().Write(result.begin(), CSHA256::OUTPUT_SIZE).Finalize(result.begin());\n+        return result;\n+    }\n+\n+    /** Compute the SHA256 hash of all data written to this object.\n+     *\n+     * Invalidates this object.\n+     */\n+    uint256 GetSHA256() {\n+        uint256 result;\n+        ctx.Finalize(result.begin());\n         return result;\n     }\n \n     /**\n      * Returns the first 64 bits from the resulting hash.\n      */\n     inline uint64_t GetCheapHash() {\n-        unsigned char result[CHash256::OUTPUT_SIZE];\n-        ctx.Finalize(result);\n-        return ReadLE64(result);\n+        uint256 result = GetHash();\n+        return ReadLE64(result.begin());\n     }\n \n     template<typename T>"
      }
    ]
  },
  {
    "sha": "425ba916d8c341a85722b6032f8d4cd103267f36",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0MjViYTkxNmQ4YzM0MWE4NTcyMmI2MDMyZjhkNGNkMTAzMjY3ZjM2",
    "commit": {
      "author": {
        "name": "Jeremy Rubin",
        "email": "j@rubin.io",
        "date": "2020-02-05T19:57:32Z"
      },
      "committer": {
        "name": "Jeremy Rubin",
        "email": "j@rubin.io",
        "date": "2020-08-03T17:14:38Z"
      },
      "message": "Add SHA256Uint256 helper functions",
      "tree": {
        "sha": "d8a61bdb7dc0c2916bfd24c871064f555993ed0b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d8a61bdb7dc0c2916bfd24c871064f555993ed0b"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/425ba916d8c341a85722b6032f8d4cd103267f36",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/425ba916d8c341a85722b6032f8d4cd103267f36",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/425ba916d8c341a85722b6032f8d4cd103267f36",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/425ba916d8c341a85722b6032f8d4cd103267f36/comments",
    "author": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "97fe971b1147cb80a4ac4f0c56cfd295564f83d3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/97fe971b1147cb80a4ac4f0c56cfd295564f83d3",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/97fe971b1147cb80a4ac4f0c56cfd295564f83d3"
      }
    ],
    "stats": {
      "total": 17,
      "additions": 17,
      "deletions": 0
    },
    "files": [
      {
        "sha": "02e6f7f9b8b8ac2a9fb8f87a499771198e662cc5",
        "filename": "src/hash.cpp",
        "status": "modified",
        "additions": 11,
        "deletions": 0,
        "changes": 11,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/425ba916d8c341a85722b6032f8d4cd103267f36/src/hash.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/425ba916d8c341a85722b6032f8d4cd103267f36/src/hash.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/hash.cpp?ref=425ba916d8c341a85722b6032f8d4cd103267f36",
        "patch": "@@ -77,3 +77,14 @@ void BIP32Hash(const ChainCode &chainCode, unsigned int nChild, unsigned char he\n     num[3] = (nChild >>  0) & 0xFF;\n     CHMAC_SHA512(chainCode.begin(), chainCode.size()).Write(&header, 1).Write(data, 32).Write(num, 4).Finalize(output);\n }\n+\n+void SHA256Uint256(uint256& hash_io)\n+{\n+    CSHA256().Write(hash_io.begin(), 32).Finalize(hash_io.begin());\n+}\n+\n+uint256 SHA256Uint256(uint256&& hash_io)\n+{\n+    CSHA256().Write(hash_io.begin(), 32).Finalize(hash_io.begin());\n+    return hash_io;\n+}"
      },
      {
        "sha": "83aa6fff2787c3ba70cacbdce9341ba9e2634133",
        "filename": "src/hash.h",
        "status": "modified",
        "additions": 6,
        "deletions": 0,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/425ba916d8c341a85722b6032f8d4cd103267f36/src/hash.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/425ba916d8c341a85722b6032f8d4cd103267f36/src/hash.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/hash.h?ref=425ba916d8c341a85722b6032f8d4cd103267f36",
        "patch": "@@ -194,6 +194,12 @@ uint256 SerializeHash(const T& obj, int nType=SER_GETHASH, int nVersion=PROTOCOL\n     return ss.GetHash();\n }\n \n+/** Single-SHA256 a 32-byte input (represented as uint256).\n+ *  hash_io is read and written over with the result.\n+ */\n+void SHA256Uint256(uint256& hash_io);\n+uint256 SHA256Uint256(uint256&& hash_io);\n+\n unsigned int MurmurHash3(unsigned int nHashSeed, Span<const unsigned char> vDataToHash);\n \n void BIP32Hash(const ChainCode &chainCode, unsigned int nChild, unsigned char header, const unsigned char data[32], unsigned char output[64]);"
      }
    ]
  },
  {
    "sha": "03b1cf8e93137187911df8d04ba5ff4f9f9ddaf3",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzowM2IxY2Y4ZTkzMTM3MTg3OTExZGY4ZDA0YmE1ZmY0ZjlmOWRkYWYz",
    "commit": {
      "author": {
        "name": "Jeremy Rubin",
        "email": "j@rubin.io",
        "date": "2020-02-05T20:31:20Z"
      },
      "committer": {
        "name": "Jeremy Rubin",
        "email": "j@rubin.io",
        "date": "2020-08-03T17:28:11Z"
      },
      "message": "Refactor Get{Prevout,Sequence,Outputs}Hash to Get{Prevouts,Sequences,Outputs}SHA256.\n\nSeveral proposals (Taproot, MuHash, CTV) require access to the single\nhash.",
      "tree": {
        "sha": "0227584cf42ef38471772504e8c7047a1417e78b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0227584cf42ef38471772504e8c7047a1417e78b"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/03b1cf8e93137187911df8d04ba5ff4f9f9ddaf3",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/03b1cf8e93137187911df8d04ba5ff4f9f9ddaf3",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/03b1cf8e93137187911df8d04ba5ff4f9f9ddaf3",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/03b1cf8e93137187911df8d04ba5ff4f9f9ddaf3/comments",
    "author": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "425ba916d8c341a85722b6032f8d4cd103267f36",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/425ba916d8c341a85722b6032f8d4cd103267f36",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/425ba916d8c341a85722b6032f8d4cd103267f36"
      }
    ],
    "stats": {
      "total": 27,
      "additions": 15,
      "deletions": 12
    },
    "files": [
      {
        "sha": "775b3cf49a431484060070b32b2115e6b4b5b8a7",
        "filename": "src/script/interpreter.cpp",
        "status": "modified",
        "additions": 15,
        "deletions": 12,
        "changes": 27,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/03b1cf8e93137187911df8d04ba5ff4f9f9ddaf3/src/script/interpreter.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/03b1cf8e93137187911df8d04ba5ff4f9f9ddaf3/src/script/interpreter.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/script/interpreter.cpp?ref=03b1cf8e93137187911df8d04ba5ff4f9f9ddaf3",
        "patch": "@@ -1259,33 +1259,33 @@ class CTransactionSignatureSerializer\n };\n \n template <class T>\n-uint256 GetPrevoutHash(const T& txTo)\n+uint256 GetPrevoutsSHA256(const T& txTo)\n {\n     CHashWriter ss(SER_GETHASH, 0);\n     for (const auto& txin : txTo.vin) {\n         ss << txin.prevout;\n     }\n-    return ss.GetHash();\n+    return ss.GetSHA256();\n }\n \n template <class T>\n-uint256 GetSequenceHash(const T& txTo)\n+uint256 GetSequencesSHA256(const T& txTo)\n {\n     CHashWriter ss(SER_GETHASH, 0);\n     for (const auto& txin : txTo.vin) {\n         ss << txin.nSequence;\n     }\n-    return ss.GetHash();\n+    return ss.GetSHA256();\n }\n \n template <class T>\n-uint256 GetOutputsHash(const T& txTo)\n+uint256 GetOutputsSHA256(const T& txTo)\n {\n     CHashWriter ss(SER_GETHASH, 0);\n     for (const auto& txout : txTo.vout) {\n         ss << txout;\n     }\n-    return ss.GetHash();\n+    return ss.GetSHA256();\n }\n \n } // namespace\n@@ -1297,9 +1297,12 @@ void PrecomputedTransactionData::Init(const T& txTo)\n \n     // Cache is calculated only for transactions with witness\n     if (txTo.HasWitness()) {\n-        hashPrevouts = GetPrevoutHash(txTo);\n-        hashSequence = GetSequenceHash(txTo);\n-        hashOutputs = GetOutputsHash(txTo);\n+        hashPrevouts = GetPrevoutsSHA256(txTo);\n+        hashSequence = GetSequencesSHA256(txTo);\n+        hashOutputs = GetOutputsSHA256(txTo);\n+        SHA256Uint256(hashPrevouts);\n+        SHA256Uint256(hashSequence);\n+        SHA256Uint256(hashOutputs);\n     }\n \n     m_ready = true;\n@@ -1329,16 +1332,16 @@ uint256 SignatureHash(const CScript& scriptCode, const T& txTo, unsigned int nIn\n         const bool cacheready = cache && cache->m_ready;\n \n         if (!(nHashType & SIGHASH_ANYONECANPAY)) {\n-            hashPrevouts = cacheready ? cache->hashPrevouts : GetPrevoutHash(txTo);\n+            hashPrevouts = cacheready ? cache->hashPrevouts : SHA256Uint256(GetPrevoutsSHA256(txTo));\n         }\n \n         if (!(nHashType & SIGHASH_ANYONECANPAY) && (nHashType & 0x1f) != SIGHASH_SINGLE && (nHashType & 0x1f) != SIGHASH_NONE) {\n-            hashSequence = cacheready ? cache->hashSequence : GetSequenceHash(txTo);\n+            hashSequence = cacheready ? cache->hashSequence : SHA256Uint256(GetSequencesSHA256(txTo));\n         }\n \n \n         if ((nHashType & 0x1f) != SIGHASH_SINGLE && (nHashType & 0x1f) != SIGHASH_NONE) {\n-            hashOutputs = cacheready ? cache->hashOutputs : GetOutputsHash(txTo);\n+            hashOutputs = cacheready ? cache->hashOutputs : SHA256Uint256(GetOutputsSHA256(txTo));\n         } else if ((nHashType & 0x1f) == SIGHASH_SINGLE && nIn < txTo.vout.size()) {\n             CHashWriter ss(SER_GETHASH, 0);\n             ss << txTo.vout[nIn];"
      }
    ]
  }
]