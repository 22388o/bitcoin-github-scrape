[
  {
    "sha": "fa24941c46fe0663efa081326940099313df292f",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYTI0OTQxYzQ2ZmUwNjYzZWZhMDgxMzI2OTQwMDk5MzEzZGYyOTJm",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2015-12-26T21:56:55Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2015-12-26T21:48:37Z"
      },
      "message": "[dbwrapper] Detect obfuscation",
      "tree": {
        "sha": "d107b2d8a2122caa36bf9001e341d3da0570d5b4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d107b2d8a2122caa36bf9001e341d3da0570d5b4"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fa24941c46fe0663efa081326940099313df292f",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa24941c46fe0663efa081326940099313df292f",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fa24941c46fe0663efa081326940099313df292f",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa24941c46fe0663efa081326940099313df292f/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "5f09cda0bf4cddc7d33989717a97ae53e85a7a00",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5f09cda0bf4cddc7d33989717a97ae53e85a7a00",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/5f09cda0bf4cddc7d33989717a97ae53e85a7a00"
      }
    ],
    "stats": {
      "total": 39,
      "additions": 29,
      "deletions": 10
    },
    "files": [
      {
        "sha": "f2a1216a46201fa7d39df507f4f5166388c4730c",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 11,
        "deletions": 2,
        "changes": 13,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa24941c46fe0663efa081326940099313df292f/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa24941c46fe0663efa081326940099313df292f/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=fa24941c46fe0663efa081326940099313df292f",
        "patch": "@@ -1127,8 +1127,12 @@ bool AppInit2(boost::thread_group& threadGroup, CScheduler& scheduler)\n                 delete pcoinscatcher;\n                 delete pblocktree;\n \n-                pblocktree = new CBlockTreeDB(nBlockTreeDBCache, false, fReindex);\n-                pcoinsdbview = new CCoinsViewDB(nCoinDBCache, false, fReindex);\n+                // Detect database obfuscated by future versions of the DBWrapper\n+                bool chainstateScrambled;\n+                bool blockDbScrambled;\n+\n+                pblocktree = new CBlockTreeDB(nBlockTreeDBCache, blockDbScrambled, false, fReindex);\n+                pcoinsdbview = new CCoinsViewDB(nCoinDBCache, chainstateScrambled, false, fReindex);\n                 pcoinscatcher = new CCoinsViewErrorCatcher(pcoinsdbview);\n                 pcoinsTip = new CCoinsViewCache(pcoinscatcher);\n \n@@ -1139,6 +1143,11 @@ bool AppInit2(boost::thread_group& threadGroup, CScheduler& scheduler)\n                         CleanupBlockRevFiles();\n                 }\n \n+                if (chainstateScrambled || blockDbScrambled) {\n+                   strLoadError = _(\"Reindex required as the chainstate or block database is obfuscated\");\n+                   break;\n+                }\n+\n                 if (!LoadBlockIndex()) {\n                     strLoadError = _(\"Error loading block database\");\n                     break;"
      },
      {
        "sha": "1fc3685315f1e2851d4e19969a94a409fe7b2302",
        "filename": "src/leveldbwrapper.cpp",
        "status": "modified",
        "additions": 7,
        "deletions": 1,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa24941c46fe0663efa081326940099313df292f/src/leveldbwrapper.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa24941c46fe0663efa081326940099313df292f/src/leveldbwrapper.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/leveldbwrapper.cpp?ref=fa24941c46fe0663efa081326940099313df292f",
        "patch": "@@ -43,7 +43,7 @@ static leveldb::Options GetOptions(size_t nCacheSize)\n     return options;\n }\n \n-CLevelDBWrapper::CLevelDBWrapper(const boost::filesystem::path& path, size_t nCacheSize, bool fMemory, bool fWipe)\n+CLevelDBWrapper::CLevelDBWrapper(const boost::filesystem::path& path, size_t nCacheSize, bool &isObfuscated, bool fMemory, bool fWipe)\n {\n     penv = NULL;\n     readoptions.verify_checksums = true;\n@@ -67,6 +67,9 @@ CLevelDBWrapper::CLevelDBWrapper(const boost::filesystem::path& path, size_t nCa\n     leveldb::Status status = leveldb::DB::Open(options, path.string(), &pdb);\n     HandleError(status);\n     LogPrintf(\"Opened LevelDB successfully\\n\");\n+\n+    std::vector<unsigned char> obfuscate_key;\n+    isObfuscated = Read(OBFUSCATE_KEY_KEY, obfuscate_key);\n }\n \n CLevelDBWrapper::~CLevelDBWrapper()\n@@ -87,3 +90,6 @@ bool CLevelDBWrapper::WriteBatch(CLevelDBBatch& batch, bool fSync) throw(leveldb\n     HandleError(status);\n     return true;\n }\n+\n+// Taken from future release of DBWrapper\n+const std::string CLevelDBWrapper::OBFUSCATE_KEY_KEY(\"\\000obfuscate_key\", 14);"
      },
      {
        "sha": "a1d6de8e2468a8b6ad677d7cf40b6831658a9f1e",
        "filename": "src/leveldbwrapper.h",
        "status": "modified",
        "additions": 4,
        "deletions": 1,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa24941c46fe0663efa081326940099313df292f/src/leveldbwrapper.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa24941c46fe0663efa081326940099313df292f/src/leveldbwrapper.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/leveldbwrapper.h?ref=fa24941c46fe0663efa081326940099313df292f",
        "patch": "@@ -85,8 +85,11 @@ class CLevelDBWrapper\n     //! the database itself\n     leveldb::DB* pdb;\n \n+    //! the key under which a obfuscation key may be stored by a future version of DBWrapper\n+    static const std::string OBFUSCATE_KEY_KEY;\n+\n public:\n-    CLevelDBWrapper(const boost::filesystem::path& path, size_t nCacheSize, bool fMemory = false, bool fWipe = false);\n+    CLevelDBWrapper(const boost::filesystem::path& path, size_t nCacheSize, bool &isObfuscated, bool fMemory = false, bool fWipe = false);\n     ~CLevelDBWrapper();\n \n     template <typename K, typename V>"
      },
      {
        "sha": "2714ca5eee68cb096d52712a16eaf13558e497e1",
        "filename": "src/test/test_bitcoin.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 2,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa24941c46fe0663efa081326940099313df292f/src/test/test_bitcoin.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa24941c46fe0663efa081326940099313df292f/src/test/test_bitcoin.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/test_bitcoin.cpp?ref=fa24941c46fe0663efa081326940099313df292f",
        "patch": "@@ -49,8 +49,9 @@ TestingSetup::TestingSetup()\n         pathTemp = GetTempPath() / strprintf(\"test_bitcoin_%lu_%i\", (unsigned long)GetTime(), (int)(GetRand(100000)));\n         boost::filesystem::create_directories(pathTemp);\n         mapArgs[\"-datadir\"] = pathTemp.string();\n-        pblocktree = new CBlockTreeDB(1 << 20, true);\n-        pcoinsdbview = new CCoinsViewDB(1 << 23, true);\n+        bool isObfuscated;\n+        pblocktree = new CBlockTreeDB(1 << 20, isObfuscated, true);\n+        pcoinsdbview = new CCoinsViewDB(1 << 23, isObfuscated, true);\n         pcoinsTip = new CCoinsViewCache(pcoinsdbview);\n         InitBlockIndex();\n #ifdef ENABLE_WALLET"
      },
      {
        "sha": "f3e56075f9fcf1d39b396e0062af32c0a820b6ad",
        "filename": "src/txdb.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa24941c46fe0663efa081326940099313df292f/src/txdb.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa24941c46fe0663efa081326940099313df292f/src/txdb.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/txdb.cpp?ref=fa24941c46fe0663efa081326940099313df292f",
        "patch": "@@ -39,7 +39,7 @@ void static BatchWriteHashBestChain(CLevelDBBatch &batch, const uint256 &hash) {\n     batch.Write(DB_BEST_BLOCK, hash);\n }\n \n-CCoinsViewDB::CCoinsViewDB(size_t nCacheSize, bool fMemory, bool fWipe) : db(GetDataDir() / \"chainstate\", nCacheSize, fMemory, fWipe) {\n+CCoinsViewDB::CCoinsViewDB(size_t nCacheSize, bool &isObfuscated, bool fMemory, bool fWipe) : db(GetDataDir() / \"chainstate\", nCacheSize, isObfuscated, fMemory, fWipe) {\n }\n \n bool CCoinsViewDB::GetCoins(const uint256 &txid, CCoins &coins) const {\n@@ -77,7 +77,7 @@ bool CCoinsViewDB::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlock) {\n     return db.WriteBatch(batch);\n }\n \n-CBlockTreeDB::CBlockTreeDB(size_t nCacheSize, bool fMemory, bool fWipe) : CLevelDBWrapper(GetDataDir() / \"blocks\" / \"index\", nCacheSize, fMemory, fWipe) {\n+CBlockTreeDB::CBlockTreeDB(size_t nCacheSize, bool &isObfuscated, bool fMemory, bool fWipe) : CLevelDBWrapper(GetDataDir() / \"blocks\" / \"index\", nCacheSize, isObfuscated, fMemory, fWipe) {\n }\n \n bool CBlockTreeDB::ReadBlockFileInfo(int nFile, CBlockFileInfo &info) {"
      },
      {
        "sha": "c39d7188ded72cb0a6d4d4d1fe5acf0ef5b09cb2",
        "filename": "src/txdb.h",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa24941c46fe0663efa081326940099313df292f/src/txdb.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa24941c46fe0663efa081326940099313df292f/src/txdb.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/txdb.h?ref=fa24941c46fe0663efa081326940099313df292f",
        "patch": "@@ -32,7 +32,7 @@ class CCoinsViewDB : public CCoinsView\n protected:\n     CLevelDBWrapper db;\n public:\n-    CCoinsViewDB(size_t nCacheSize, bool fMemory = false, bool fWipe = false);\n+    CCoinsViewDB(size_t nCacheSize, bool &isObfuscated, bool fMemory = false, bool fWipe = false);\n \n     bool GetCoins(const uint256 &txid, CCoins &coins) const;\n     bool HaveCoins(const uint256 &txid) const;\n@@ -45,7 +45,7 @@ class CCoinsViewDB : public CCoinsView\n class CBlockTreeDB : public CLevelDBWrapper\n {\n public:\n-    CBlockTreeDB(size_t nCacheSize, bool fMemory = false, bool fWipe = false);\n+    CBlockTreeDB(size_t nCacheSize, bool &isObfuscated, bool fMemory = false, bool fWipe = false);\n private:\n     CBlockTreeDB(const CBlockTreeDB&);\n     void operator=(const CBlockTreeDB&);"
      }
    ]
  },
  {
    "sha": "fa3cb4946f917111bd106c5f79a2d614d6e990f4",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYTNjYjQ5NDZmOTE3MTExYmQxMDZjNWY3OWEyZDYxNGQ2ZTk5MGY0",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2015-12-26T22:06:28Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2015-12-26T22:21:09Z"
      },
      "message": "[init] Fix typo",
      "tree": {
        "sha": "750478b822306efc49a01c093931dc409889d8e4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/750478b822306efc49a01c093931dc409889d8e4"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fa3cb4946f917111bd106c5f79a2d614d6e990f4",
      "comment_count": 1,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa3cb4946f917111bd106c5f79a2d614d6e990f4",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fa3cb4946f917111bd106c5f79a2d614d6e990f4",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa3cb4946f917111bd106c5f79a2d614d6e990f4/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "fa24941c46fe0663efa081326940099313df292f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa24941c46fe0663efa081326940099313df292f",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/fa24941c46fe0663efa081326940099313df292f"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 1,
      "deletions": 1
    },
    "files": [
      {
        "sha": "ba751caefb1662f9b855afe6d7d7ecce151328e4",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa3cb4946f917111bd106c5f79a2d614d6e990f4/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa3cb4946f917111bd106c5f79a2d614d6e990f4/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=fa3cb4946f917111bd106c5f79a2d614d6e990f4",
        "patch": "@@ -1127,7 +1127,7 @@ bool AppInit2(boost::thread_group& threadGroup, CScheduler& scheduler)\n                 delete pcoinscatcher;\n                 delete pblocktree;\n \n-                // Detect database obfuscated by future versions of the DBWrapper\n+                // Detect database obfuscation by future versions of the DBWrapper\n                 bool chainstateScrambled;\n                 bool blockDbScrambled;\n "
      }
    ]
  }
]