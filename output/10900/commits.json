[
  {
    "sha": "8651c4ef94271e03927c5b018ecbe7f58f333235",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4NjUxYzRlZjk0MjcxZTAzOTI3YzViMDE4ZWNiZTdmNThmMzMzMjM1",
    "commit": {
      "author": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2017-07-21T20:07:20Z"
      },
      "committer": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2017-07-21T23:56:00Z"
      },
      "message": "Segsignal compatible UASF",
      "tree": {
        "sha": "e8a9a18d6ae32ae198425a7ce68858c03716a506",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e8a9a18d6ae32ae198425a7ce68858c03716a506"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8651c4ef94271e03927c5b018ecbe7f58f333235",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8651c4ef94271e03927c5b018ecbe7f58f333235",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/8651c4ef94271e03927c5b018ecbe7f58f333235",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8651c4ef94271e03927c5b018ecbe7f58f333235/comments",
    "author": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "fc61c8322bd7288f7546d18ad04c36c345be13cd",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fc61c8322bd7288f7546d18ad04c36c345be13cd",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/fc61c8322bd7288f7546d18ad04c36c345be13cd"
      }
    ],
    "stats": {
      "total": 17,
      "additions": 16,
      "deletions": 1
    },
    "files": [
      {
        "sha": "b5c91df8d647f35747629e0d1db40dd7eecad3f9",
        "filename": "src/chainparams.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 1,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/8651c4ef94271e03927c5b018ecbe7f58f333235/src/chainparams.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/8651c4ef94271e03927c5b018ecbe7f58f333235/src/chainparams.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/chainparams.cpp?ref=8651c4ef94271e03927c5b018ecbe7f58f333235",
        "patch": "@@ -75,6 +75,7 @@ class CMainParams : public CChainParams {\n         consensus.BIP34Hash = uint256S(\"0x000000000000024b89b42a942fe0d9fea3bb44ab7bd1b19115dd6a759c0808b8\");\n         consensus.BIP65Height = 388381; // 000000000000000004c2b624ed5d7756c508d90fd0da2c7c679febfa6c4735f0\n         consensus.BIP66Height = 363725; // 00000000000000000379eaa19dce8c9b722d46ae6a57c2f1a988119488b50931\n+        consensus.BIP91Height = 477120;\n         consensus.powLimit = uint256S(\"00000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffff\");\n         consensus.nPowTargetTimespan = 14 * 24 * 60 * 60; // two weeks\n         consensus.nPowTargetSpacing = 10 * 60;\n@@ -179,6 +180,7 @@ class CTestNetParams : public CChainParams {\n         consensus.BIP34Hash = uint256S(\"0x0000000023b3a96d3484e5abb3755c413e7d41500f8e2a5c3f0dd01299cd8ef8\");\n         consensus.BIP65Height = 581885; // 00000000007f6655f22f98e72ed80d8b06dc761d5da09df0fa1dc4be4f861eb6\n         consensus.BIP66Height = 330776; // 000000002104c8c45e99a8853285a3b592602a3ccde2b832481da85e9e4ba182\n+        consensus.BIP91Height = 100000000; // This doesn't matter because segwit has already activated on testnet\n         consensus.powLimit = uint256S(\"00000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffff\");\n         consensus.nPowTargetTimespan = 14 * 24 * 60 * 60; // two weeks\n         consensus.nPowTargetSpacing = 10 * 60;\n@@ -268,6 +270,7 @@ class CRegTestParams : public CChainParams {\n         consensus.BIP34Hash = uint256();\n         consensus.BIP65Height = 1351; // BIP65 activated on regtest (Used in rpc activation tests)\n         consensus.BIP66Height = 1251; // BIP66 activated on regtest (Used in rpc activation tests)\n+        consensus.BIP91Height = 100000000;\n         consensus.powLimit = uint256S(\"7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\");\n         consensus.nPowTargetTimespan = 14 * 24 * 60 * 60; // two weeks\n         consensus.nPowTargetSpacing = 10 * 60;\n@@ -366,4 +369,3 @@ void UpdateRegtestBIP9Parameters(Consensus::DeploymentPos d, int64_t nStartTime,\n {\n     regTestParams.UpdateBIP9Parameters(d, nStartTime, nTimeout);\n }\n- "
      },
      {
        "sha": "282629bc062e0688f1a0a544df73f28a1ed6657c",
        "filename": "src/consensus/params.h",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/8651c4ef94271e03927c5b018ecbe7f58f333235/src/consensus/params.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/8651c4ef94271e03927c5b018ecbe7f58f333235/src/consensus/params.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/consensus/params.h?ref=8651c4ef94271e03927c5b018ecbe7f58f333235",
        "patch": "@@ -46,6 +46,8 @@ struct Params {\n     int BIP65Height;\n     /** Block height at which BIP66 becomes active */\n     int BIP66Height;\n+    /** Block height at which BIP91 becomes active */\n+    int BIP91Height;\n     /**\n      * Minimum blocks including miner confirmation of the total of 2016 blocks in a retargeting period,\n      * (nPowTargetTimespan / nPowTargetSpacing) which is also used for BIP9 deployments."
      },
      {
        "sha": "0c35844fbf3b6bce5b1de8ac0dcad7440487eb11",
        "filename": "src/validation.cpp",
        "status": "modified",
        "additions": 11,
        "deletions": 0,
        "changes": 11,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/8651c4ef94271e03927c5b018ecbe7f58f333235/src/validation.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/8651c4ef94271e03927c5b018ecbe7f58f333235/src/validation.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/validation.cpp?ref=8651c4ef94271e03927c5b018ecbe7f58f333235",
        "patch": "@@ -1851,6 +1851,17 @@ bool ConnectBlock(const CBlock& block, CValidationState& state, CBlockIndex* pin\n         flags |= SCRIPT_VERIFY_NULLDUMMY;\n     }\n \n+    // SEGSIGNAL mandatory segwit signalling.\n+    if (pindex->nHeight >= chainparams.GetConsensus().BIP91Height &&\n+        VersionBitsState(pindex->pprev, chainparams.GetConsensus(), Consensus::DEPLOYMENT_SEGWIT,    versionbitscache) == THRESHOLD_STARTED)\n+    {\n+        bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) == VERSIONBITS_TOP_BITS;\n+        bool fSegbit = (pindex->nVersion & VersionBitsMask(chainparams.GetConsensus(), Consensus::DEPLOYMENT_SEGWIT)) != 0;\n+        if (!(fVersionBits && fSegbit)) {\n+            return state.DoS(0, error(\"ConnectBlock(): relayed block must signal for segwit, please upgrade\"), REJECT_INVALID, \"bad-no-segwit\");\n+        }\n+    }\n+\n     int64_t nTime2 = GetTimeMicros(); nTimeForks += nTime2 - nTime1;\n     LogPrint(\"bench\", \"    - Fork checks: %.2fms [%.2fs]\\n\", 0.001 * (nTime2 - nTime1), nTimeForks * 0.000001);\n "
      }
    ]
  },
  {
    "sha": "b6abab653300da5152d9d9cfa5f8582e0b4b85d4",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiNmFiYWI2NTMzMDBkYTUxNTJkOWQ5Y2ZhNWY4NTgyZTBiNGI4NWQ0",
    "commit": {
      "author": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2017-07-21T22:08:12Z"
      },
      "committer": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2017-07-21T23:56:00Z"
      },
      "message": "Add test for segsignal UASF",
      "tree": {
        "sha": "088a8cde1b3495aeb1d80cc62fc5e4189538e9c1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/088a8cde1b3495aeb1d80cc62fc5e4189538e9c1"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b6abab653300da5152d9d9cfa5f8582e0b4b85d4",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b6abab653300da5152d9d9cfa5f8582e0b4b85d4",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/b6abab653300da5152d9d9cfa5f8582e0b4b85d4",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b6abab653300da5152d9d9cfa5f8582e0b4b85d4/comments",
    "author": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "8651c4ef94271e03927c5b018ecbe7f58f333235",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8651c4ef94271e03927c5b018ecbe7f58f333235",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/8651c4ef94271e03927c5b018ecbe7f58f333235"
      }
    ],
    "stats": {
      "total": 71,
      "additions": 70,
      "deletions": 1
    },
    "files": [
      {
        "sha": "9a58f6506c4a55bc904c52c24445b86e611668f1",
        "filename": "qa/pull-tester/rpc-tests.py",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/b6abab653300da5152d9d9cfa5f8582e0b4b85d4/qa/pull-tester/rpc-tests.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/b6abab653300da5152d9d9cfa5f8582e0b4b85d4/qa/pull-tester/rpc-tests.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/qa/pull-tester/rpc-tests.py?ref=b6abab653300da5152d9d9cfa5f8582e0b4b85d4",
        "patch": "@@ -155,6 +155,7 @@\n     'rpcnamedargs.py',\n     'listsinceblock.py',\n     'p2p-leaktests.py',\n+    'segsignal.py',\n ]\n if ENABLE_ZMQ:\n     testScripts.append('zmq_test.py')"
      },
      {
        "sha": "1018b89707cde0be2e2f04ae1a352269cd7d19d7",
        "filename": "qa/rpc-tests/segsignal.py",
        "status": "added",
        "additions": 68,
        "deletions": 0,
        "changes": 68,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/b6abab653300da5152d9d9cfa5f8582e0b4b85d4/qa/rpc-tests/segsignal.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/b6abab653300da5152d9d9cfa5f8582e0b4b85d4/qa/rpc-tests/segsignal.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/qa/rpc-tests/segsignal.py?ref=b6abab653300da5152d9d9cfa5f8582e0b4b85d4",
        "patch": "@@ -0,0 +1,68 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2015-2016 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from test_framework.test_framework import ComparisonTestFramework\n+from test_framework.util import *\n+from test_framework.blocktools import create_coinbase, create_block\n+\n+class SegsignalUASFTest(ComparisonTestFramework):\n+\n+    def __init__(self):\n+        super().__init__()\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        self.tip = int(\"0x\" + self.nodes[0].getbestblockhash(), 0)\n+        self.height = 1  # height of the next block to build\n+        self.last_block_time = int(time.time())\n+\n+        # Mine 1439 non segwit blocks\n+        self.generate_blocks(1439, 0x20000000)\n+\n+        # Check that segwit is still started\n+        assert_equal(self.get_bip9_status('segwit')['status'], 'started')\n+\n+        # Mine a non-segwit block. this should be rejected\n+        self.generate_blocks(1, 0x20000000, 'bad-no-segwit')\n+\n+        # Now mine a segwit block. this should not be rejected\n+        self.generate_blocks(1, 0x20000002)\n+\n+        # Mine another non-segwit block, this should be rejected\n+        self.generate_blocks(1, 0x20000000, 'bad-no-segwit')\n+\n+        # Mine 143 more blocks. should still be started\n+        print(self.nodes[0].getblockchaininfo())\n+        self.generate_blocks(142, 0x20000002)\n+        assert_equal(self.get_bip9_status('segwit')['status'], 'started')\n+\n+        # Mine 1 more block, should now be locked in\n+        self.generate_blocks(1, 0x20000002)\n+        print(self.nodes[0].getblockchaininfo())\n+        assert_equal(self.get_bip9_status('segwit')['status'], 'locked_in')\n+\n+        # Mine a non-segwit block, should be accepted\n+        self.generate_blocks(1, 0x20000000)\n+\n+    def generate_blocks(self, number, version, error = None):\n+        for i in range(number):\n+            block = create_block(self.tip, create_coinbase(self.height), self.last_block_time + 1)\n+            block.nVersion = version\n+            block.rehash()\n+            block.solve()\n+            assert_equal(self.nodes[0].submitblock(bytes_to_hex_str(block.serialize())), error)\n+            if (error == None):\n+                self.last_block_time += 1\n+                self.tip = block.sha256\n+                self.height += 1\n+\n+    def get_bip9_status(self, key):\n+        info = self.nodes[0].getblockchaininfo()\n+        return info['bip9_softforks'][key]\n+\n+\n+if __name__ == '__main__':\n+    SegsignalUASFTest().main()"
      },
      {
        "sha": "14ce57a2bd270f2ed75332c96b8354d7dcddeaa1",
        "filename": "src/chainparams.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/b6abab653300da5152d9d9cfa5f8582e0b4b85d4/src/chainparams.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/b6abab653300da5152d9d9cfa5f8582e0b4b85d4/src/chainparams.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/chainparams.cpp?ref=b6abab653300da5152d9d9cfa5f8582e0b4b85d4",
        "patch": "@@ -270,7 +270,7 @@ class CRegTestParams : public CChainParams {\n         consensus.BIP34Hash = uint256();\n         consensus.BIP65Height = 1351; // BIP65 activated on regtest (Used in rpc activation tests)\n         consensus.BIP66Height = 1251; // BIP66 activated on regtest (Used in rpc activation tests)\n-        consensus.BIP91Height = 100000000;\n+        consensus.BIP91Height = 1440; // BIP91 Activated on regtest (used in rpc activation tests)\n         consensus.powLimit = uint256S(\"7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\");\n         consensus.nPowTargetTimespan = 14 * 24 * 60 * 60; // two weeks\n         consensus.nPowTargetSpacing = 10 * 60;"
      }
    ]
  }
]