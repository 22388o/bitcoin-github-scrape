fanquake,2020-04-07 02:19:13,I take it this resolves [this comment](https://github.com/bitcoin/bitcoin/pull/18524/files#r404395685)?,https://github.com/bitcoin/bitcoin/pull/18551#issuecomment-610135161,610135161,
sipa,2020-04-07 02:20:51,@fanquake You're too fast. I was just looking to add a link where I made that comment.,https://github.com/bitcoin/bitcoin/pull/18551#issuecomment-610135597,610135597,
promag,2020-04-07 09:45:47,This change is now covered in #18471.,https://github.com/bitcoin/bitcoin/pull/18551#issuecomment-610288399,610288399,
ryanofsky,2020-04-07 12:17:53,"Code review ACK c182fd517db2337f61b0038ca929fcfd01f18f07\n\nI wrote a test for the bug that fails without the fix and passes with it: 4ba1627fb99ea46836e0d73ad1682b4b184124be ([branch](https://github.com/ryanofsky/bitcoin/commits/review.18551.1-edit))\n\nFeel free to use the test here and squash into the fix commit.",https://github.com/bitcoin/bitcoin/pull/18551#issuecomment-610352822,610352822,
ryanofsky,2020-04-07 12:30:37,"Note: This PR fixes a bug in an internal function. The fix doesn't affect behavior of bitcoind, the gui, or any utilities because the function isn't currently called in a way that would trigger the bug",https://github.com/bitcoin/bitcoin/pull/18551#issuecomment-610358449,610358449,
promag,2020-04-07 18:23:42,Code review ACK c182fd517db2337f61b0038ca929fcfd01f18f07.,https://github.com/bitcoin/bitcoin/pull/18551#issuecomment-610546514,610546514,
sipa,2020-04-07 19:58:58,@ryanofsky Cherry-picked. Also updated the PR description to say it's not currently observable.,https://github.com/bitcoin/bitcoin/pull/18551#issuecomment-610590640,610590640,
jonasschnelli,2020-04-08 10:10:04,utACK 2276339a176f83ffe8ceefb3e41ecca8601aa13b - reviewed code and test (thanks @ryanofsky for adding the test).,https://github.com/bitcoin/bitcoin/pull/18551#issuecomment-610872062,610872062,
MarcoFalke,2020-04-08 12:42:04,"ACK 2276339a176f83ffe8ceefb3e41ecca8601aa13b ðŸŽŽ\n\n<details><summary>Show signature and timestamp</summary>\n\nSignature:\n\n```\n-----BEGIN PGP SIGNED MESSAGE-----\nHash: SHA512\n\nACK 2276339a176f83ffe8ceefb3e41ecca8601aa13b ðŸŽŽ\n-----BEGIN PGP SIGNATURE-----\n\niQGzBAEBCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\npUh20Qv+N8PfCJlrF51u9zKcnkK1GBJis/ghaoibar1FJ1i1HSbPRRL+eK",https://github.com/bitcoin/bitcoin/pull/18551#issuecomment-610935923,610935923,
MarcoFalke,2020-04-08 12:45:51,cc @sipsorcery (or anyone else on windows) any idea why this fails appveyor?,https://github.com/bitcoin/bitcoin/pull/18551#issuecomment-610937820,610937820,
ryanofsky,2020-04-08 13:07:52,"> cc @sipsorcery (or anyone else on windows) any idea why this fails appveyor?\n\nAppveyor links\n\nhttps://ci.appveyor.com/project/DrahtBot/bitcoin/builds/32000822 (passed)\nhttps://ci.appveyor.com/project/DrahtBot/bitcoin/builds/32021955 (failed)\nhttps://ci.appveyor.com/project/DrahtBot/bitcoin/builds/32023789 (failed)\nhttps://ci.appveyor.com/project/DrahtBot/bitcoin/builds/32039241 (pe",https://github.com/bitcoin/bitcoin/pull/18551#issuecomment-610948818,610948818,
MarcoFalke,2020-04-08 13:10:30,"Yeah, stuff like this #16976 makes it hard to debug",https://github.com/bitcoin/bitcoin/pull/18551#issuecomment-610950187,610950187,
ryanofsky,2020-04-08 13:16:58,"The PR was rebased between the passing build and failing build https://github.com/bitcoin/bitcoin/compare/c182fd51..2276339a, but I'd guess probably the new `unregister_all_during_call` unit test is crashing and causing the failure\n\nEDIT: Actually that diff link is misleading because appveyor builds branches merged with master. Still it seems pretty likely the new `unregister_all_during_call` ",https://github.com/bitcoin/bitcoin/pull/18551#issuecomment-610953520,610953520,
ryanofsky,2020-04-08 13:29:40,"Could disable this if appveyor failures cause problems for other PRs:\n\n```diff\n--- a/src/test/validationinterface_tests.cpp\n+++ b/src/test/validationinterface_tests.cpp\n@@ -42,6 +42,9 @@ public:\n // https://github.com/bitcoin/bitcoin/pull/18551\n BOOST_AUTO_TEST_CASE(unregister_all_during_call)\n {\n+#ifdef WIN32\n+    return;\n+#endif\n     bool destroyed = false;\n \n     CSc",https://github.com/bitcoin/bitcoin/pull/18551#issuecomment-610960262,610960262,
MarcoFalke,2020-04-08 13:34:15,"appveyor was already failing on pretty much every pull, so I think this is not an issue",https://github.com/bitcoin/bitcoin/pull/18551#issuecomment-610962864,610962864,
fanquake,2020-04-08 13:54:45,"The tests are now failing, and it was caused by this pull. Maybe we can disable as @ryanofsky suggested. I haven't been able to investigate  further:\n\n```\nRunning 370 test cases...\nAssertion failed!\n\nProgram: C:\workspace\bitcoin\bin\test_bitcoin.exe\nFile: validationinterface.cpp, Line 93\n\nExpression: !m_internals\n```",https://github.com/bitcoin/bitcoin/pull/18551#issuecomment-610974251,610974251,
ryanofsky,2020-04-08 14:06:39,"I think I see the problem. The failing assert is in `RegisterBackgroundSignalScheduler` https://github.com/bitcoin/bitcoin/blob/1f70185a809362117a8158e386fdead85728794f/src/validationinterface.cpp#L93\n\nand is probably failing because the test isn't calling `UnregisterBackgroundSignalScheduler` to clean up after itself",https://github.com/bitcoin/bitcoin/pull/18551#issuecomment-610980696,610980696,
ryanofsky,2020-04-08 14:20:46,#18563 should probably fix the test failures,https://github.com/bitcoin/bitcoin/pull/18551#issuecomment-610988307,610988307,
