[
  {
    "sha": "29a86a17350b931c2b46aebd05ab99ada0b8494c",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyOWE4NmExNzM1MGI5MzFjMmI0NmFlYmQwNWFiOTlhZGEwYjg0OTRj",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-05-05T19:30:38Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-05-05T19:32:41Z"
      },
      "message": "Add extra asserts to addrman",
      "tree": {
        "sha": "54c618268f6d348c05354fd539699c49d1231231",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/54c618268f6d348c05354fd539699c49d1231231"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/29a86a17350b931c2b46aebd05ab99ada0b8494c",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/29a86a17350b931c2b46aebd05ab99ada0b8494c",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/29a86a17350b931c2b46aebd05ab99ada0b8494c",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/29a86a17350b931c2b46aebd05ab99ada0b8494c/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "82e6b92b0ac75ed15014e5b1723299fa838ce82e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/82e6b92b0ac75ed15014e5b1723299fa838ce82e",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/82e6b92b0ac75ed15014e5b1723299fa838ce82e"
      }
    ],
    "stats": {
      "total": 19,
      "additions": 19,
      "deletions": 0
    },
    "files": [
      {
        "sha": "c1a0df6a44d4140e9eebdc1cec3dcadd370c4c9d",
        "filename": "src/addrman.cpp",
        "status": "modified",
        "additions": 19,
        "deletions": 0,
        "changes": 19,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/29a86a17350b931c2b46aebd05ab99ada0b8494c/src/addrman.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/29a86a17350b931c2b46aebd05ab99ada0b8494c/src/addrman.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrman.cpp?ref=29a86a17350b931c2b46aebd05ab99ada0b8494c",
        "patch": "@@ -107,9 +107,15 @@ void CAddrMan::SwapRandom(int nRndPos1, int nRndPos2)\n     if (nRndPos1 == nRndPos2)\n         return;\n \n+    assert(nRndPos1 >= 0 && nRndPos2 >= 0);\n+    assert(nRndPos1 < vRandom.size() && nRndPos2 < vRandom.size());\n+\n     int nId1 = vRandom[nRndPos1];\n     int nId2 = vRandom[nRndPos2];\n \n+    assert(mapInfo.count(nId1) == 1);\n+    assert(mapInfo.count(nId2) == 1);\n+\n     mapInfo[nId1].nRandomPos = nRndPos2;\n     mapInfo[nId2].nRandomPos = nRndPos1;\n \n@@ -130,6 +136,7 @@ int CAddrMan::SelectTried(int nKBucket)\n         int nTemp = vTried[nPos];\n         vTried[nPos] = vTried[i];\n         vTried[i] = nTemp;\n+        assert(nOldest == -1 || mapInfo.count(nTemp) == 1);\n         if (nOldest == -1 || mapInfo[nTemp].nLastSuccess < mapInfo[nOldest].nLastSuccess)\n            nOldest = nTemp;\n     }\n@@ -139,11 +146,13 @@ int CAddrMan::SelectTried(int nKBucket)\n \n int CAddrMan::ShrinkNew(int nUBucket)\n {\n+    assert(nUBucket >= 0 && nUBucket < vvNew.size());\n     std::set<int> &vNew = vvNew[nUBucket];\n \n     // first look for deletable items\n     for (std::set<int>::iterator it = vNew.begin(); it != vNew.end(); it++)\n     {\n+        assert(mapInfo.count(*it));\n         CAddrInfo &info = mapInfo[*it];\n         if (info.IsTerrible())\n         {\n@@ -168,11 +177,13 @@ int CAddrMan::ShrinkNew(int nUBucket)\n     {\n         if (nI == n[0] || nI == n[1] || nI == n[2] || nI == n[3])\n         {\n+            assert(nOldest == -1 || mapInfo.count(*it) == 1);\n             if (nOldest == -1 || mapInfo[*it].nTime < mapInfo[nOldest].nTime)\n                 nOldest = *it;\n         }\n         nI++;\n     }\n+    assert(mapInfo.count(nOldest) == 1);\n     CAddrInfo &info = mapInfo[nOldest];\n     if (--info.nRefCount == 0) \n     {\n@@ -189,6 +200,8 @@ int CAddrMan::ShrinkNew(int nUBucket)\n \n void CAddrMan::MakeTried(CAddrInfo& info, int nId, int nOrigin)\n {\n+    assert(vvNew[nOrigin].count(nId) == 1);\n+\n     // remove the entry from all new buckets\n     for (std::vector<std::set<int> >::iterator it = vvNew.begin(); it != vvNew.end(); it++)\n     {\n@@ -197,6 +210,8 @@ void CAddrMan::MakeTried(CAddrInfo& info, int nId, int nOrigin)\n     }\n     nNew--;\n \n+    assert(info.nRefCount == 0);\n+\n     // what tried bucket to move the entry to\n     int nKBucket = info.GetTriedBucket(nKey);\n     std::vector<int> &vTried = vvTried[nKBucket];\n@@ -214,6 +229,7 @@ void CAddrMan::MakeTried(CAddrInfo& info, int nId, int nOrigin)\n     int nPos = SelectTried(nKBucket);\n \n     // find which new bucket it belongs to\n+    assert(mapInfo.count(vTried[nPos]) == 1);\n     int nUBucket = mapInfo[vTried[nPos]].GetNewBucket(nKey);\n     std::set<int> &vNew = vvNew[nUBucket];\n \n@@ -385,6 +401,7 @@ CAddress CAddrMan::Select_(int nUnkBias)\n             std::vector<int> &vTried = vvTried[nKBucket];\n             if (vTried.size() == 0) continue;\n             int nPos = GetRandInt(vTried.size());\n+            assert(mapInfo.count(vTried[nPos]) == 1);\n             CAddrInfo &info = mapInfo[vTried[nPos]];\n             if (GetRandInt(1<<30) < fChanceFactor*info.GetChance()*(1<<30))\n                 return info;\n@@ -402,6 +419,7 @@ CAddress CAddrMan::Select_(int nUnkBias)\n             std::set<int>::iterator it = vNew.begin();\n             while (nPos--)\n                 it++;\n+            assert(mapInfo.count(*it) == 1);\n             CAddrInfo &info = mapInfo[*it];\n             if (GetRandInt(1<<30) < fChanceFactor*info.GetChance()*(1<<30))\n                 return info;\n@@ -481,6 +499,7 @@ void CAddrMan::GetAddr_(std::vector<CAddress> &vAddr)\n     {\n         int nRndPos = GetRandInt(vRandom.size() - n) + n;\n         SwapRandom(n, nRndPos);\n+        assert(mapInfo.count(vRandom[n]) == 1);\n         vAddr.push_back(mapInfo[vRandom[n]]);\n     }\n }"
      }
    ]
  },
  {
    "sha": "56f1e912397de656988cf7898b5457892bce3c30",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1NmYxZTkxMjM5N2RlNjU2OTg4Y2Y3ODk4YjU0NTc4OTJiY2UzYzMw",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-05-05T19:22:55Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-05-05T19:33:26Z"
      },
      "message": "Fix addrman crashes\n\nA function returned the element to remove from a bucket, instead of its\nposition in that bucket. This function was only called when a tried\nbucket overflowed, which only happens after many outgoing connections\nhave been made.\n\nCloses: #1065, #1156",
      "tree": {
        "sha": "b7e4893c5635ee53a24630b6c8211bad9829b51c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b7e4893c5635ee53a24630b6c8211bad9829b51c"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/56f1e912397de656988cf7898b5457892bce3c30",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/56f1e912397de656988cf7898b5457892bce3c30",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/56f1e912397de656988cf7898b5457892bce3c30",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/56f1e912397de656988cf7898b5457892bce3c30/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "29a86a17350b931c2b46aebd05ab99ada0b8494c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/29a86a17350b931c2b46aebd05ab99ada0b8494c",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/29a86a17350b931c2b46aebd05ab99ada0b8494c"
      }
    ],
    "stats": {
      "total": 7,
      "additions": 5,
      "deletions": 2
    },
    "files": [
      {
        "sha": "10d005aae919ee9b2b703a990c87fddc02f9f007",
        "filename": "src/addrman.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 2,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/56f1e912397de656988cf7898b5457892bce3c30/src/addrman.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/56f1e912397de656988cf7898b5457892bce3c30/src/addrman.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrman.cpp?ref=56f1e912397de656988cf7898b5457892bce3c30",
        "patch": "@@ -130,18 +130,21 @@ int CAddrMan::SelectTried(int nKBucket)\n     // random shuffle the first few elements (using the entire list)\n     // find the least recently tried among them\n     int64 nOldest = -1;\n+    int nOldestPos = -1;\n     for (unsigned int i = 0; i < ADDRMAN_TRIED_ENTRIES_INSPECT_ON_EVICT && i < vTried.size(); i++)\n     {\n         int nPos = GetRandInt(vTried.size() - i) + i;\n         int nTemp = vTried[nPos];\n         vTried[nPos] = vTried[i];\n         vTried[i] = nTemp;\n         assert(nOldest == -1 || mapInfo.count(nTemp) == 1);\n-        if (nOldest == -1 || mapInfo[nTemp].nLastSuccess < mapInfo[nOldest].nLastSuccess)\n+        if (nOldest == -1 || mapInfo[nTemp].nLastSuccess < mapInfo[nOldest].nLastSuccess) {\n            nOldest = nTemp;\n+           nOldestPos = nPos;\n+        }\n     }\n \n-    return nOldest;\n+    return nOldestPos;\n }\n \n int CAddrMan::ShrinkNew(int nUBucket)"
      }
    ]
  },
  {
    "sha": "bd1aabe941bb7568e6e4e06356a6e98a8ba78a5d",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiZDFhYWJlOTQxYmI3NTY4ZTZlNGUwNjM1NmE2ZTk4YThiYTc4YTVk",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-05-05T19:27:52Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-05-05T19:33:29Z"
      },
      "message": "Bugfix: store source address in addrman",
      "tree": {
        "sha": "d5e1a582b64226e0cf4cb5a79ba92e882ec4bde6",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d5e1a582b64226e0cf4cb5a79ba92e882ec4bde6"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/bd1aabe941bb7568e6e4e06356a6e98a8ba78a5d",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bd1aabe941bb7568e6e4e06356a6e98a8ba78a5d",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/bd1aabe941bb7568e6e4e06356a6e98a8ba78a5d",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bd1aabe941bb7568e6e4e06356a6e98a8ba78a5d/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "56f1e912397de656988cf7898b5457892bce3c30",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/56f1e912397de656988cf7898b5457892bce3c30",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/56f1e912397de656988cf7898b5457892bce3c30"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 1,
      "deletions": 1
    },
    "files": [
      {
        "sha": "3768614cfe5ef55741a72a33371b2100dd3fbb0d",
        "filename": "src/addrman.h",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/bd1aabe941bb7568e6e4e06356a6e98a8ba78a5d/src/addrman.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/bd1aabe941bb7568e6e4e06356a6e98a8ba78a5d/src/addrman.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrman.h?ref=bd1aabe941bb7568e6e4e06356a6e98a8ba78a5d",
        "patch": "@@ -62,7 +62,7 @@ class CAddrInfo : public CAddress\n         nRandomPos = -1;\n     }\n \n-    CAddrInfo(const CAddress &addrIn, const CNetAddr &addrSource) : CAddress(addrIn)\n+    CAddrInfo(const CAddress &addrIn, const CNetAddr &addrSource) : CAddress(addrIn), source(addrSource)\n     {\n         Init();\n     }"
      }
    ]
  }
]