[
  {
    "sha": "89895773b72275a620951730aef0b52e9437bc13",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4OTg5NTc3M2I3MjI3NWE2MjA5NTE3MzBhZWYwYjUyZTk0MzdiYzEz",
    "commit": {
      "author": {
        "name": "Dmitry Petukhov",
        "email": "dp@simplexum.com",
        "date": "2020-10-26T17:03:41Z"
      },
      "committer": {
        "name": "Dmitry Petukhov",
        "email": "dp@simplexum.com",
        "date": "2020-11-25T13:07:37Z"
      },
      "message": "Fix length of R check in test/key_tests.cpp:key_signature_tests\n\nThe code before the fix only checked the length of R value of the last\nsignature in the loop, and only for equality (but the length can be\nless than 32)\n\nThe fixed code checks that length of the R value is less than or equal\nto 32 on each iteration of the loop\n\nThe BOOST_CHECK(sig.size() <= 70) is merged with sig[3] <= 32 check,\nand BOOST_CHECKs are moved outside the loop, for efficiency",
      "tree": {
        "sha": "8a015cabc9bc9cb9d158a83997a66bc672c7b4c0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8a015cabc9bc9cb9d158a83997a66bc672c7b4c0"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/89895773b72275a620951730aef0b52e9437bc13",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQJFBAABCAAvFiEEsXo1u6GHOVeE4qazIwHSa9wVFg0FAl++VxkRHGRwQHNpbXBs\nZXh1bS5jb20ACgkQIwHSa9wVFg1SBQ/9GsK/C6aEFrmh9ysr9w87rBq37iyGqddc\nhKack0UFrQ/1ueclCGefr/z1zUR/TdRFf8yEL3yf08CbfFfwqkPksg9y06Ob88uV\ntLaVUxkJrpxmC0VFkRm8semXMJoUMCjphFqO+ZxhNaFNk1gXpb+Ra0Qo6jImcnxL\nhqRVxIJkA9R521vswXiqQc36VZ1tpnXZmc7RqzB/bjfQPYsePPDrN+arlQBhjDMH\nzRGU14wllserdunGSPirdXU6M5K+jSzWv5+FKBY4seJHPudAgPAyfA95t2qrkuDY\ncEVpvUCfsuySQmhNjE2LxKF80O59jRdO8iIbJvYMYwhHNXhF6PZMRYe0GPchwZF6\ntXBbkVQROQjMGbhyLUxY81cpWq87rot9qSQXb9CjNrDB0jfBgQYZFcWAOk96VdX1\nJQOP6V04wRNna7zbNa+EYvgvHrk9fgVgz3xjdMo3wGK2Zm/w9GhAH8wv/2zUy6Yq\nobOmz+Fy6S7q6tWwEqHt21fI5tOqyMDDToWVtakPhraTG6AlreG13J3Vjg/L3Cso\nIyuC/lJcwCpCcQExO3gy67RszbbBwhgrkA+qU1ISvze/jaHbRcdNOKAHQS3Ys86P\nrs96UFdh0s8A6SMuUtzC3NyA/JVp9F4pnUdHw3Ds/de0W2YbidSEUQyin7xZ0TO/\nDTz0gkBkzss=\n=hi6B\n-----END PGP SIGNATURE-----",
        "payload": "tree 8a015cabc9bc9cb9d158a83997a66bc672c7b4c0\nparent 1e9e4b68f3cbd1af3de5806aeff952e9bf0ab8fc\nauthor Dmitry Petukhov <dp@simplexum.com> 1603731821 +0500\ncommitter Dmitry Petukhov <dp@simplexum.com> 1606309657 +0500\n\nFix length of R check in test/key_tests.cpp:key_signature_tests\n\nThe code before the fix only checked the length of R value of the last\nsignature in the loop, and only for equality (but the length can be\nless than 32)\n\nThe fixed code checks that length of the R value is less than or equal\nto 32 on each iteration of the loop\n\nThe BOOST_CHECK(sig.size() <= 70) is merged with sig[3] <= 32 check,\nand BOOST_CHECKs are moved outside the loop, for efficiency\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/89895773b72275a620951730aef0b52e9437bc13",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/89895773b72275a620951730aef0b52e9437bc13",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/89895773b72275a620951730aef0b52e9437bc13/comments",
    "author": {
      "login": "dgpv",
      "id": 43240089,
      "node_id": "MDQ6VXNlcjQzMjQwMDg5",
      "avatar_url": "https://avatars.githubusercontent.com/u/43240089?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dgpv",
      "html_url": "https://github.com/dgpv",
      "followers_url": "https://api.github.com/users/dgpv/followers",
      "following_url": "https://api.github.com/users/dgpv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dgpv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dgpv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dgpv/subscriptions",
      "organizations_url": "https://api.github.com/users/dgpv/orgs",
      "repos_url": "https://api.github.com/users/dgpv/repos",
      "events_url": "https://api.github.com/users/dgpv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dgpv/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "dgpv",
      "id": 43240089,
      "node_id": "MDQ6VXNlcjQzMjQwMDg5",
      "avatar_url": "https://avatars.githubusercontent.com/u/43240089?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dgpv",
      "html_url": "https://github.com/dgpv",
      "followers_url": "https://api.github.com/users/dgpv/followers",
      "following_url": "https://api.github.com/users/dgpv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dgpv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dgpv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dgpv/subscriptions",
      "organizations_url": "https://api.github.com/users/dgpv/orgs",
      "repos_url": "https://api.github.com/users/dgpv/repos",
      "events_url": "https://api.github.com/users/dgpv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dgpv/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "1e9e4b68f3cbd1af3de5806aeff952e9bf0ab8fc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1e9e4b68f3cbd1af3de5806aeff952e9bf0ab8fc",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/1e9e4b68f3cbd1af3de5806aeff952e9bf0ab8fc"
      }
    ],
    "stats": {
      "total": 22,
      "additions": 16,
      "deletions": 6
    },
    "files": [
      {
        "sha": "cb66d5164e78a1e872f2c1f25caadf64603d408b",
        "filename": "src/test/key_tests.cpp",
        "status": "modified",
        "additions": 16,
        "deletions": 6,
        "changes": 22,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/89895773b72275a620951730aef0b52e9437bc13/src/test/key_tests.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/89895773b72275a620951730aef0b52e9437bc13/src/test/key_tests.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/key_tests.cpp?ref=89895773b72275a620951730aef0b52e9437bc13",
        "patch": "@@ -172,20 +172,30 @@ BOOST_AUTO_TEST_CASE(key_signature_tests)\n     }\n     BOOST_CHECK(found);\n \n-    // When entropy is not specified, we should always see low R signatures that are less than 70 bytes in 256 tries\n+    // When entropy is not specified, we should always see low R signatures that are less than or equal to 70 bytes in 256 tries\n+    // The low R signatures should always have the value of their \"length of R\" byte less than or equal to 32\n     // We should see at least one signature that is less than 70 bytes.\n-    found = true;\n     bool found_small = false;\n+    bool found_big = false;\n+    bool bad_sign = false;\n     for (int i = 0; i < 256; ++i) {\n         sig.clear();\n         std::string msg = \"A message to be signed\" + ToString(i);\n         msg_hash = Hash(msg);\n-        BOOST_CHECK(key.Sign(msg_hash, sig));\n-        found = sig[3] == 0x20;\n-        BOOST_CHECK(sig.size() <= 70);\n+        if (!key.Sign(msg_hash, sig)) {\n+            bad_sign = true;\n+            break;\n+        }\n+        // sig.size() > 70 implies sig[3] > 32, because S is always low.\n+        // But check both conditions anyway, just in case this implication is broken for some reason\n+        if (sig[3] > 32 || sig.size() > 70) {\n+            found_big = true;\n+            break;\n+        }\n         found_small |= sig.size() < 70;\n     }\n-    BOOST_CHECK(found);\n+    BOOST_CHECK(!bad_sign);\n+    BOOST_CHECK(!found_big);\n     BOOST_CHECK(found_small);\n }\n "
      }
    ]
  }
]