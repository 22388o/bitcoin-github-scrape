[
  {
    "sha": "291af5e931247692f7ce298f2208f25b2c923b0c",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyOTFhZjVlOTMxMjQ3NjkyZjdjZTI5OGYyMjA4ZjI1YjJjOTIzYjBj",
    "commit": {
      "author": {
        "name": "new_m0ray",
        "email": "new_m0ray@linux-uffd.site",
        "date": "2011-05-23T09:32:34Z"
      },
      "committer": {
        "name": "new_m0ray",
        "email": "new_m0ray@linux-uffd.site",
        "date": "2011-05-23T09:32:34Z"
      },
      "message": "Added -purgetx command line option. When used, purges all transactions\nfrom wallet.dat and forces a rescan.\nUseful for solving problems with invalid transactions stored in\nwallet.dat (for example, after wallet.dat manipulations).\n\nCorrected russian translation.",
      "tree": {
        "sha": "23147373de76592cf3a839b002c01be9e9905d1f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/23147373de76592cf3a839b002c01be9e9905d1f"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/291af5e931247692f7ce298f2208f25b2c923b0c",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/291af5e931247692f7ce298f2208f25b2c923b0c",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/291af5e931247692f7ce298f2208f25b2c923b0c",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/291af5e931247692f7ce298f2208f25b2c923b0c/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "69a27a4ec68e7a2ea6e481b950d11f5aea42c814",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/69a27a4ec68e7a2ea6e481b950d11f5aea42c814",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/69a27a4ec68e7a2ea6e481b950d11f5aea42c814"
      }
    ],
    "stats": {
      "total": 36,
      "additions": 30,
      "deletions": 6
    },
    "files": [
      {
        "sha": "8f18bc1666ccec5a22f8ba087a431b530a81e09a",
        "filename": "locale/ru/LC_MESSAGES/bitcoin.mo",
        "status": "modified",
        "additions": 0,
        "deletions": 0,
        "changes": 0,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/291af5e931247692f7ce298f2208f25b2c923b0c/locale/ru/LC_MESSAGES/bitcoin.mo",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/291af5e931247692f7ce298f2208f25b2c923b0c/locale/ru/LC_MESSAGES/bitcoin.mo",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/locale/ru/LC_MESSAGES/bitcoin.mo?ref=291af5e931247692f7ce298f2208f25b2c923b0c"
      },
      {
        "sha": "a89d2ac26fe853824d719a848ba057a3a0f5c1e5",
        "filename": "locale/ru/LC_MESSAGES/bitcoin.po",
        "status": "modified",
        "additions": 4,
        "deletions": 4,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/291af5e931247692f7ce298f2208f25b2c923b0c/locale/ru/LC_MESSAGES/bitcoin.po",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/291af5e931247692f7ce298f2208f25b2c923b0c/locale/ru/LC_MESSAGES/bitcoin.po",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/locale/ru/LC_MESSAGES/bitcoin.po?ref=291af5e931247692f7ce298f2208f25b2c923b0c",
        "patch": "@@ -4,7 +4,7 @@ msgstr \"\"\n \"Report-Msgid-Bugs-To: \\n\"\n \"POT-Creation-Date: 2010-10-05 10:53+0300\\n\"\n \"PO-Revision-Date: 2010-10-05 11:43+0300\\n\"\n-\"Last-Translator: eurekafag\\n\"\n+\"Last-Translator: m0Ray\\n\"\n \"Language-Team: \\n\"\n \"MIME-Version: 1.0\\n\"\n \"Content-Type: text/plain; charset=UTF-8\\n\"\n@@ -187,11 +187,11 @@ msgstr \"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435\"\n \n #: ../../../ui.cpp:304\n msgid \"Debit\"\n-msgstr \"\u0414\u0435\u0431\u0435\u0442\"\n+msgstr \"\u0420\u0430\u0441\u0445\u043e\u0434\"\n \n #: ../../../ui.cpp:305\n msgid \"Credit\"\n-msgstr \"\u041a\u0440\u0435\u0434\u0438\u0442\"\n+msgstr \"\u041f\u0440\u0438\u0445\u043e\u0434\"\n \n #: ../../../ui.cpp:511\n #, c-format\n@@ -355,7 +355,7 @@ msgstr \"<b>\u041a\u043e\u043c\u0438\u0441\u0441\u0438\u044f:</b> \"\n \n #: ../../../ui.cpp:1402\n msgid \"<b>Net amount:</b> \"\n-msgstr \"<b>\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0441\u0435\u0442\u0438:</b> \"\n+msgstr \"<b>\u0427\u0438\u0441\u0442\u0430\u044f \u0441\u0443\u043c\u043c\u0430:</b> \"\n \n #: ../../../ui.cpp:1409\n msgid \"Message:\""
      },
      {
        "sha": "adb851635aa89342175cd61820785ed2a0c4e956",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 10,
        "deletions": 2,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/291af5e931247692f7ce298f2208f25b2c923b0c/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/291af5e931247692f7ce298f2208f25b2c923b0c/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=291af5e931247692f7ce298f2208f25b2c923b0c",
        "patch": "@@ -178,7 +178,8 @@ bool AppInit2(int argc, char* argv[])\n             \"  -rpcallowip=<ip> \\t\\t  \" + _(\"Allow JSON-RPC connections from specified IP address\\n\") +\n             \"  -rpcconnect=<ip> \\t  \"   + _(\"Send commands to node running on <ip> (default: 127.0.0.1)\\n\") +\n             \"  -keypool=<n>     \\t  \"   + _(\"Set key pool size to <n> (default: 100)\\n\") +\n-            \"  -rescan          \\t  \"   + _(\"Rescan the block chain for missing wallet transactions\\n\");\n+            \"  -rescan          \\t  \"   + _(\"Rescan the block chain for missing wallet transactions\\n\") +\n+            \"  -purgetx         \\t  \"   + _(\"Purge all transactions from wallet and rescan\\n\");\n \n #ifdef USE_SSL\n         strUsage += string() +\n@@ -369,8 +370,15 @@ bool AppInit2(int argc, char* argv[])\n         strErrors += _(\"Error loading wallet.dat      \\n\");\n     printf(\" wallet      %15\"PRI64d\"ms\\n\", GetTimeMillis() - nStart);\n \n+    bool fForceRescan=false;\n+    if (GetBoolArg(\"-purgetx\"))\n+    {\n+       PurgeWalletTransactions();\n+       fForceRescan=true;\n+    }\n+\n     CBlockIndex *pindexRescan = pindexBest;\n-    if (GetBoolArg(\"-rescan\"))\n+    if (fForceRescan || GetBoolArg(\"-rescan\"))\n         pindexRescan = pindexGenesisBlock;\n     else\n     {"
      },
      {
        "sha": "b065d28195cf2a590f0dc988e2b60175f73bfe38",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 15,
        "deletions": 0,
        "changes": 15,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/291af5e931247692f7ce298f2208f25b2c923b0c/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/291af5e931247692f7ce298f2208f25b2c923b0c/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=291af5e931247692f7ce298f2208f25b2c923b0c",
        "patch": "@@ -884,6 +884,21 @@ bool CWalletTx::AcceptWalletTransaction(CTxDB& txdb, bool fCheckInputs)\n     return false;\n }\n \n+void PurgeWalletTransactions()\n+{\n+    // Delete all txes stored in wallet\n+    printf(\"PurgeWalletTransactions()\\n\");\n+    CRITICAL_BLOCK(cs_mapWallet)\n+    {\n+        BOOST_FOREACH(PAIRTYPE(const uint256, CWalletTx)& item, mapWallet)\n+        {\n+            CWalletTx& wtx = item.second;\n+            CWalletDB().EraseTx(wtx.GetHash());\n+        }\n+        mapWallet.clear();\n+    }\n+}\n+\n int ScanForWalletTransactions(CBlockIndex* pindexStart)\n {\n     int ret = 0;"
      },
      {
        "sha": "a8469597d2a988e706295df041f175330870aea0",
        "filename": "src/main.h",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/291af5e931247692f7ce298f2208f25b2c923b0c/src/main.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/291af5e931247692f7ce298f2208f25b2c923b0c/src/main.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.h?ref=291af5e931247692f7ce298f2208f25b2c923b0c",
        "patch": "@@ -86,6 +86,7 @@ bool AddKey(const CKey& key);\n std::vector<unsigned char> GenerateNewKey();\n bool AddToWallet(const CWalletTx& wtxIn);\n void WalletUpdateSpent(const COutPoint& prevout);\n+void PurgeWalletTransactions();\n int ScanForWalletTransactions(CBlockIndex* pindexStart);\n void ReacceptWalletTransactions();\n bool LoadBlockIndex(bool fAllowNew=true);"
      }
    ]
  }
]