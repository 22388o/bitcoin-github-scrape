[
  {
    "sha": "98a24a262eceb8fddad363f4bb1459c2dd8608eb",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5OGEyNGEyNjJlY2ViOGZkZGFkMzYzZjRiYjE0NTljMmRkODYwOGVi",
    "commit": {
      "author": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2019-03-17T17:54:35Z"
      },
      "committer": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2019-03-22T10:55:11Z"
      },
      "message": "gui: Defer removeAndDeleteWallet when no modal widget is active",
      "tree": {
        "sha": "c54ecfa82cfd14938200e6a916cf87200b3de643",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c54ecfa82cfd14938200e6a916cf87200b3de643"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/98a24a262eceb8fddad363f4bb1459c2dd8608eb",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEyhopCNzi8TB0xizeHrd2uwPHki0FAlyUvw8ACgkQHrd2uwPH\nki2NJQ//ct1HMFfZ+GVcMPbWU0SRHSV14eu84th6aOnGf6DnQlXTNRn3D2zXXZ0R\ngukwH7Ag7buBIB8IjOnm3nLPIVYlcaS7GKeX2ZIlxlNAa7YxsSwhRWtq9CLx4ekb\nkd0LzRbhwEvB6njAqY0WChZqMXE00Q1b/3ZXTDziG7l4CC31gq31gh/P0ExfLF6o\nC8CLkeAp2lqqutHi9n1Gutgx46bfw/5JAU86Zi/6bbo/Ip4lh+wIGCGfxOfNvHdo\ngk+b2B5TaarEr5+kV4iiPO0Vz5sMuctgxIM+h08ms9xhi8AvRDKVSm92cIoBBpIn\ncZabisem7+0tIelCo7vxWk0PFaNLvohwfBDPjFb68FbETUnxQ7eGM+a1PP7rGIeX\nFi3lDfyBlcKpCZ7TgItYOW9qOPLv5vNoBkOf5INgwm/UN87nA5bbu+laTW8rTQnB\neLmtfQkqsGOqA1NPMtoB5zN7ZrFsBY/HlNPJCNafPBExXyzkp/NXdaxJwWBnYBzh\nFvidEzsKizbc+t76+3K5P6lN6e9klUKIv9rVxfM98mnOg33e1k6zTNsPbMVBCcGP\n7Ml/aHS5DxnMPO85Ou2KYMBH0PEYRt4qn+kjtcyrBrDoifcdPzMDs9oslJ0bZfYv\n8XJQofbiiWl7BsPgxEkRPJqoSo56Dr5RduDnHogg1jggXTa9YR4=\n=Cs8l\n-----END PGP SIGNATURE-----",
        "payload": "tree c54ecfa82cfd14938200e6a916cf87200b3de643\nparent 238ef336929606632f0564e417ee0b6fd649c2a9\nauthor Jo\u00e3o Barbosa <joao.paulo.barbosa@gmail.com> 1552845275 +0000\ncommitter Jonas Schnelli <dev@jonasschnelli.ch> 1553252111 +0100\n\ngui: Defer removeAndDeleteWallet when no modal widget is active\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/98a24a262eceb8fddad363f4bb1459c2dd8608eb",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/98a24a262eceb8fddad363f4bb1459c2dd8608eb",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/98a24a262eceb8fddad363f4bb1459c2dd8608eb/comments",
    "author": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "238ef336929606632f0564e417ee0b6fd649c2a9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/238ef336929606632f0564e417ee0b6fd649c2a9",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/238ef336929606632f0564e417ee0b6fd649c2a9"
      }
    ],
    "stats": {
      "total": 14,
      "additions": 13,
      "deletions": 1
    },
    "files": [
      {
        "sha": "019bd6582348d35523e134b36ce0c7fecec292eb",
        "filename": "src/qt/walletcontroller.cpp",
        "status": "modified",
        "additions": 13,
        "deletions": 1,
        "changes": 14,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/98a24a262eceb8fddad363f4bb1459c2dd8608eb/src/qt/walletcontroller.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/98a24a262eceb8fddad363f4bb1459c2dd8608eb/src/qt/walletcontroller.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/walletcontroller.cpp?ref=98a24a262eceb8fddad363f4bb1459c2dd8608eb",
        "patch": "@@ -9,9 +9,11 @@\n \n #include <algorithm>\n \n+#include <QApplication>\n #include <QMessageBox>\n #include <QMutexLocker>\n #include <QThread>\n+#include <QWindow>\n \n WalletController::WalletController(interfaces::Node& node, const PlatformStyle* platform_style, OptionsModel* options_model, QObject* parent)\n     : QObject(parent)\n@@ -97,7 +99,17 @@ WalletModel* WalletController::getOrCreateWallet(std::unique_ptr<interfaces::Wal\n     m_wallets.push_back(wallet_model);\n \n     connect(wallet_model, &WalletModel::unload, [this, wallet_model] {\n-        removeAndDeleteWallet(wallet_model);\n+        // Defer removeAndDeleteWallet when no modal widget is active.\n+        // TODO: remove this workaround by removing usage of QDiallog::exec.\n+        if (QApplication::activeModalWidget()) {\n+            connect(qApp, &QApplication::focusWindowChanged, wallet_model, [this, wallet_model]() {\n+                if (!QApplication::activeModalWidget()) {\n+                    removeAndDeleteWallet(wallet_model);\n+                }\n+            }, Qt::QueuedConnection);\n+        } else {\n+            removeAndDeleteWallet(wallet_model);\n+        }\n     });\n \n     // Re-emit coinsSent signal from wallet model."
      }
    ]
  }
]