[
  {
    "sha": "671f1ad6642bfd79a3a3f3337674504cb769bbe2",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo2NzFmMWFkNjY0MmJmZDc5YTNhM2YzMzM3Njc0NTA0Y2I3NjliYmUy",
    "commit": {
      "author": {
        "name": "R E Broadley",
        "email": "rebroad+github@gmail.com",
        "date": "2016-08-27T01:04:48Z"
      },
      "committer": {
        "name": "R E Broadley",
        "email": "rebroad+github@gmail.com",
        "date": "2016-09-01T08:57:30Z"
      },
      "message": "Treat node nVersion less significantly\n\nAs recommended by @laanwj in 2014:\n(https://github.com/bitcoin/bitcoin/pull/4351#issuecomment-46287612)",
      "tree": {
        "sha": "4a9f026415615cfcc5137fdef32544a134c36bc9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4a9f026415615cfcc5137fdef32544a134c36bc9"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/671f1ad6642bfd79a3a3f3337674504cb769bbe2",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/671f1ad6642bfd79a3a3f3337674504cb769bbe2",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/671f1ad6642bfd79a3a3f3337674504cb769bbe2",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/671f1ad6642bfd79a3a3f3337674504cb769bbe2/comments",
    "author": {
      "login": "rebroad",
      "id": 1530283,
      "node_id": "MDQ6VXNlcjE1MzAyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rebroad",
      "html_url": "https://github.com/rebroad",
      "followers_url": "https://api.github.com/users/rebroad/followers",
      "following_url": "https://api.github.com/users/rebroad/following{/other_user}",
      "gists_url": "https://api.github.com/users/rebroad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
      "organizations_url": "https://api.github.com/users/rebroad/orgs",
      "repos_url": "https://api.github.com/users/rebroad/repos",
      "events_url": "https://api.github.com/users/rebroad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rebroad/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "rebroad",
      "id": 1530283,
      "node_id": "MDQ6VXNlcjE1MzAyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rebroad",
      "html_url": "https://github.com/rebroad",
      "followers_url": "https://api.github.com/users/rebroad/followers",
      "following_url": "https://api.github.com/users/rebroad/following{/other_user}",
      "gists_url": "https://api.github.com/users/rebroad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
      "organizations_url": "https://api.github.com/users/rebroad/orgs",
      "repos_url": "https://api.github.com/users/rebroad/repos",
      "events_url": "https://api.github.com/users/rebroad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rebroad/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "84decb54f2592d543cb557bf46ce54cbcd2959e8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/84decb54f2592d543cb557bf46ce54cbcd2959e8",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/84decb54f2592d543cb557bf46ce54cbcd2959e8"
      }
    ],
    "stats": {
      "total": 53,
      "additions": 18,
      "deletions": 35
    },
    "files": [
      {
        "sha": "d136023e21fb8025ab763d5b57279666bf5467a5",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 18,
        "deletions": 35,
        "changes": 53,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/671f1ad6642bfd79a3a3f3337674504cb769bbe2/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/671f1ad6642bfd79a3a3f3337674504cb769bbe2/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=671f1ad6642bfd79a3a3f3337674504cb769bbe2",
        "patch": "@@ -4947,15 +4947,9 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n         if (pfrom->nVersion < MIN_PEER_PROTO_VERSION)\n         {\n             // disconnect from peers older than this proto version\n-            LogPrintf(\"peer=%d using obsolete version %i; disconnecting\\n\", pfrom->id, pfrom->nVersion);\n-            pfrom->PushMessage(NetMsgType::REJECT, strCommand, REJECT_OBSOLETE,\n-                               strprintf(\"Version must be %d or greater\", MIN_PEER_PROTO_VERSION));\n-            pfrom->fDisconnect = true;\n-            return false;\n+            LogPrintf(\"peer=%d using obsolete version %i\\n\", pfrom->id, pfrom->nVersion);\n         }\n \n-        if (pfrom->nVersion == 10300)\n-            pfrom->nVersion = 300;\n         if (!vRecv.empty())\n             vRecv >> addrFrom >> nNonce;\n         if (!vRecv.empty()) {\n@@ -5077,23 +5071,19 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n             State(pfrom->GetId())->fCurrentlyConnected = true;\n         }\n \n-        if (pfrom->nVersion >= SENDHEADERS_VERSION) {\n-            // Tell our peer we prefer to receive headers rather than inv's\n-            // We send this to non-NODE NETWORK peers as well, because even\n-            // non-NODE NETWORK peers can announce blocks (such as pruning\n-            // nodes)\n-            pfrom->PushMessage(NetMsgType::SENDHEADERS);\n-        }\n-        if (pfrom->nVersion >= SHORT_IDS_BLOCKS_VERSION) {\n-            // Tell our peer we are willing to provide version-1 cmpctblocks\n-            // However, we do not request new block announcements using\n-            // cmpctblock messages.\n-            // We send this to non-NODE NETWORK peers as well, because\n-            // they may wish to request compact blocks from us\n-            bool fAnnounceUsingCMPCTBLOCK = false;\n-            uint64_t nCMPCTBLOCKVersion = 1;\n-            pfrom->PushMessage(NetMsgType::SENDCMPCT, fAnnounceUsingCMPCTBLOCK, nCMPCTBLOCKVersion);\n-        }\n+        // Tell our peer we prefer to receive headers rather than inv's\n+        // We send this to non-NODE NETWORK peers as well, because even\n+        // non-NODE NETWORK peers can announce blocks (such as pruning\n+        // nodes)\n+        pfrom->PushMessage(NetMsgType::SENDHEADERS);\n+        // Tell our peer we are willing to provide version-1 cmpctblocks\n+        // However, we do not request new block announcements using\n+        // cmpctblock messages.\n+        // We send this to non-NODE NETWORK peers as well, because\n+        // they may wish to request compact blocks from us\n+        bool fAnnounceUsingCMPCTBLOCK = false;\n+        uint64_t nCMPCTBLOCKVersion = 1;\n+        pfrom->PushMessage(NetMsgType::SENDCMPCT, fAnnounceUsingCMPCTBLOCK, nCMPCTBLOCKVersion);\n     }\n \n \n@@ -5102,8 +5092,7 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n         vector<CAddress> vAddr;\n         vRecv >> vAddr;\n \n-        // Don't want addr from older versions unless seeding\n-        if (pfrom->nVersion < CADDR_TIME_VERSION && addrman.size() > 1000)\n+        if (addrman.size() > 1000)\n             return true;\n         if (vAddr.size() > 1000)\n         {\n@@ -6317,7 +6306,7 @@ bool SendMessages(CNode* pto)\n             // RPC ping request by user\n             pingSend = true;\n         }\n-        if (pto->nPingNonceSent == 0 && pto->nPingUsecStart + PING_INTERVAL * 1000000 < GetTimeMicros()) {\n+        if ((pto->nPingNonceSent == 0 || pto->nVersion < BIP0031_VERSION) && pto->nPingUsecStart + PING_INTERVAL * 1000000 < GetTimeMicros()) {\n             // Ping automatically sent as a latency probe & keepalive.\n             pingSend = true;\n         }\n@@ -6328,14 +6317,8 @@ bool SendMessages(CNode* pto)\n             }\n             pto->fPingQueued = false;\n             pto->nPingUsecStart = GetTimeMicros();\n-            if (pto->nVersion > BIP0031_VERSION) {\n-                pto->nPingNonceSent = nonce;\n-                pto->PushMessage(NetMsgType::PING, nonce);\n-            } else {\n-                // Peer is too old to support ping command with nonce, pong will never arrive.\n-                pto->nPingNonceSent = 0;\n-                pto->PushMessage(NetMsgType::PING);\n-            }\n+            pto->nPingNonceSent = nonce;\n+            pto->PushMessage(NetMsgType::PING, nonce);\n         }\n \n         TRY_LOCK(cs_main, lockMain); // Acquire cs_main for IsInitialBlockDownload() and CNodeState()"
      }
    ]
  },
  {
    "sha": "8d6a30f360287737e1c7bd040d0b973e72781124",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4ZDZhMzBmMzYwMjg3NzM3ZTFjN2JkMDQwZDBiOTczZTcyNzgxMTI0",
    "commit": {
      "author": {
        "name": "R E Broadley",
        "email": "rebroad+github@gmail.com",
        "date": "2016-08-27T01:10:05Z"
      },
      "committer": {
        "name": "R E Broadley",
        "email": "rebroad+github@gmail.com",
        "date": "2016-09-01T08:57:30Z"
      },
      "message": "This version was created in 2010. I think we can assume everyone is running it now.",
      "tree": {
        "sha": "9002872a3da7024738a25294ab106269a132eeba",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9002872a3da7024738a25294ab106269a132eeba"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8d6a30f360287737e1c7bd040d0b973e72781124",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8d6a30f360287737e1c7bd040d0b973e72781124",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/8d6a30f360287737e1c7bd040d0b973e72781124",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8d6a30f360287737e1c7bd040d0b973e72781124/comments",
    "author": {
      "login": "rebroad",
      "id": 1530283,
      "node_id": "MDQ6VXNlcjE1MzAyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rebroad",
      "html_url": "https://github.com/rebroad",
      "followers_url": "https://api.github.com/users/rebroad/followers",
      "following_url": "https://api.github.com/users/rebroad/following{/other_user}",
      "gists_url": "https://api.github.com/users/rebroad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
      "organizations_url": "https://api.github.com/users/rebroad/orgs",
      "repos_url": "https://api.github.com/users/rebroad/repos",
      "events_url": "https://api.github.com/users/rebroad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rebroad/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "rebroad",
      "id": 1530283,
      "node_id": "MDQ6VXNlcjE1MzAyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rebroad",
      "html_url": "https://github.com/rebroad",
      "followers_url": "https://api.github.com/users/rebroad/followers",
      "following_url": "https://api.github.com/users/rebroad/following{/other_user}",
      "gists_url": "https://api.github.com/users/rebroad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
      "organizations_url": "https://api.github.com/users/rebroad/orgs",
      "repos_url": "https://api.github.com/users/rebroad/repos",
      "events_url": "https://api.github.com/users/rebroad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rebroad/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "671f1ad6642bfd79a3a3f3337674504cb769bbe2",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/671f1ad6642bfd79a3a3f3337674504cb769bbe2",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/671f1ad6642bfd79a3a3f3337674504cb769bbe2"
      }
    ],
    "stats": {
      "total": 7,
      "additions": 2,
      "deletions": 5
    },
    "files": [
      {
        "sha": "8e4b6392b71670e9a7bb702fbd4eb4a0f8cf9651",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 5,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/8d6a30f360287737e1c7bd040d0b973e72781124/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/8d6a30f360287737e1c7bd040d0b973e72781124/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=8d6a30f360287737e1c7bd040d0b973e72781124",
        "patch": "@@ -5021,11 +5021,8 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n             }\n \n             // Get recent addresses\n-            if (pfrom->fOneShot || pfrom->nVersion >= CADDR_TIME_VERSION || addrman.size() < 1000)\n-            {\n-                pfrom->PushMessage(NetMsgType::GETADDR);\n-                pfrom->fGetAddr = true;\n-            }\n+            pfrom->PushMessage(NetMsgType::GETADDR);\n+            pfrom->fGetAddr = true;\n             addrman.Good(pfrom->addr);\n         } else {\n             if (((CNetAddr)pfrom->addr) == (CNetAddr)addrFrom)"
      }
    ]
  }
]