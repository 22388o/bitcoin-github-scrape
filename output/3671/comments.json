[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/35050736",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/3671#issuecomment-35050736",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/3671",
    "id": 35050736,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MDUwNzM2",
    "user": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?u=63e5c438c242094837a9deeda775d77988b508bf&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2014-02-14T02:44:14Z",
    "updated_at": "2014-02-14T02:44:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "Any reason not to just list any transaction with one or more conflicting intput? e.g. generalize it to all double-spends and not just signature mutants?\n\nThis would make it include things like an identically outputted transaction with ANYONECANPAY inputs that has had additional inputs added for fees, for example.\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/35050736/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/35059984",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/3671#issuecomment-35059984",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/3671",
    "id": 35059984,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MDU5OTg0",
    "user": {
      "login": "apoelstra",
      "id": 1351933,
      "node_id": "MDQ6VXNlcjEzNTE5MzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1351933?u=3493d88a08dce87c183f4213d9d7e23ad2bdf75b&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/apoelstra",
      "html_url": "https://github.com/apoelstra",
      "followers_url": "https://api.github.com/users/apoelstra/followers",
      "following_url": "https://api.github.com/users/apoelstra/following{/other_user}",
      "gists_url": "https://api.github.com/users/apoelstra/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/apoelstra/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/apoelstra/subscriptions",
      "organizations_url": "https://api.github.com/users/apoelstra/orgs",
      "repos_url": "https://api.github.com/users/apoelstra/repos",
      "events_url": "https://api.github.com/users/apoelstra/events{/privacy}",
      "received_events_url": "https://api.github.com/users/apoelstra/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2014-02-14T06:36:32Z",
    "updated_at": "2014-02-14T06:40:47Z",
    "author_association": "CONTRIBUTOR",
    "body": "Just tried this patch. It works successfully. I have four types of unconfirmed transactions in my wallet. The first was a malleability dupe (it was a coinjoin which I signed twice). The patch correctly reports it 'conflicted' and shows the confirmed tx under walletconflicts, while the confirmed transaction is still there (labelled 'send' and 'receive', not 'conflicted') and has the unconfirmed tx under walletconflicts.\n\nThe second one is a double-spend where the txes differ in output size (fee increase). The unconfirmed one is labelled 'conflicted' and has nothing under walletconflicts. The confirmed one is still there (labelled 'send' and 'receive', not 'conflicted') and has nothing under walletconflicts.\n\nThe third and fourth are my mutually-conflicting nonstandard unconfirmed txes, which are both removed from the list by this patch. As I got these into my wallet by disabling the fHave check in rpcsendrawtransactions, and not through any user-accessible use of bitcoind, IMO it's fine that they are lost.\n\n<b>Edit:</b> As with the other patch, 'getunconfirmedbalance' includes the conflicted txes.\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/35059984/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/35085346",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/3671#issuecomment-35085346",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/3671",
    "id": 35085346,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MDg1MzQ2",
    "user": {
      "login": "gavinandresen",
      "id": 331997,
      "node_id": "MDQ6VXNlcjMzMTk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/331997?u=db313a954a318b81f5283d34908397d1ea3aeba3&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gavinandresen",
      "html_url": "https://github.com/gavinandresen",
      "followers_url": "https://api.github.com/users/gavinandresen/followers",
      "following_url": "https://api.github.com/users/gavinandresen/following{/other_user}",
      "gists_url": "https://api.github.com/users/gavinandresen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gavinandresen/subscriptions",
      "organizations_url": "https://api.github.com/users/gavinandresen/orgs",
      "repos_url": "https://api.github.com/users/gavinandresen/repos",
      "events_url": "https://api.github.com/users/gavinandresen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gavinandresen/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2014-02-14T14:00:06Z",
    "updated_at": "2014-02-14T14:00:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "@gmaxwell : generalizing to arbitrary double-spends is tricky. If they are a wallet transaction in an old wallet and the double-spend happened long ago and you're not running with -txindex, then the code can know that an input is spent (is not in the UTXO set) but might have no idea which transaction double-spent (the double-spend might not be a wallet transaction-- it might have inputs and outputs completely unrelated to your wallet, but double-spend an input that was involved in one of your transactions but didn't belong to you).\n\nIn that case, the best we can do is what the code does now: mark it as category : conflicted.\n\nIgnoring old wallets, it would be possible to write code to store the conflicting txid in the wallet, but even then reporting it is probably a bad idea, because you wouldn't necessarily be able to look it up unless you're running with -txindex.\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/35085346/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/35118286",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/3671#issuecomment-35118286",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/3671",
    "id": 35118286,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MTE4Mjg2",
    "user": {
      "login": "gavinandresen",
      "id": 331997,
      "node_id": "MDQ6VXNlcjMzMTk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/331997?u=db313a954a318b81f5283d34908397d1ea3aeba3&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gavinandresen",
      "html_url": "https://github.com/gavinandresen",
      "followers_url": "https://api.github.com/users/gavinandresen/followers",
      "following_url": "https://api.github.com/users/gavinandresen/following{/other_user}",
      "gists_url": "https://api.github.com/users/gavinandresen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gavinandresen/subscriptions",
      "organizations_url": "https://api.github.com/users/gavinandresen/orgs",
      "repos_url": "https://api.github.com/users/gavinandresen/repos",
      "events_url": "https://api.github.com/users/gavinandresen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gavinandresen/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2014-02-14T19:51:51Z",
    "updated_at": "2014-02-14T19:53:12Z",
    "author_association": "CONTRIBUTOR",
    "body": "Reworked to use a multimap&lt;COutpoint, uint256&gt; to keep track of conflicts. I still might change this to be more memory-thrifty and store CWalletTx*'s as the values instead of their hashes.\n\nThis will handle most double-spends (if both spends are wallet transactions) in addition to mutated/malleable transactions.\n\nI fixed the bug in getunconfirmedbalance. The logic for uncofirmed balance is:\n  count non-final transactions (wallet never creates any, so this is harmless)\n  ... and 0-confirmation transactions that are not IsTrusted.\n\nI removed the credit account balances commit, I will create a separate pull for it because There Be Dragons.  With this commit, account balances may be lower than they should be, but will never be higher.\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/35118286/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/35121420",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/3671#issuecomment-35121420",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/3671",
    "id": 35121420,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MTIxNDIw",
    "user": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?u=63e5c438c242094837a9deeda775d77988b508bf&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2014-02-14T20:26:26Z",
    "updated_at": "2014-02-14T20:26:26Z",
    "author_association": "CONTRIBUTOR",
    "body": "It's currently counting all generated coin as a conflict. :)\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/35121420/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/35126695",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/3671#issuecomment-35126695",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/3671",
    "id": 35126695,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MTI2Njk1",
    "user": {
      "login": "apoelstra",
      "id": 1351933,
      "node_id": "MDQ6VXNlcjEzNTE5MzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1351933?u=3493d88a08dce87c183f4213d9d7e23ad2bdf75b&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/apoelstra",
      "html_url": "https://github.com/apoelstra",
      "followers_url": "https://api.github.com/users/apoelstra/followers",
      "following_url": "https://api.github.com/users/apoelstra/following{/other_user}",
      "gists_url": "https://api.github.com/users/apoelstra/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/apoelstra/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/apoelstra/subscriptions",
      "organizations_url": "https://api.github.com/users/apoelstra/orgs",
      "repos_url": "https://api.github.com/users/apoelstra/repos",
      "events_url": "https://api.github.com/users/apoelstra/events{/privacy}",
      "received_events_url": "https://api.github.com/users/apoelstra/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2014-02-14T21:30:50Z",
    "updated_at": "2014-02-14T21:30:50Z",
    "author_association": "CONTRIBUTOR",
    "body": "OK, with the new patch I am seeing the same listtransaction behaviour as before, except: the txpair which conflicted because they differed in fee, now show each others' txids under 'walletconflicts'. So everything is good here.\n\ngetbalance returns my (correct) balance. getunconfirmedbalance returns 0, as it should.\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/35126695/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/35131818",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/3671#issuecomment-35131818",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/3671",
    "id": 35131818,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MTMxODE4",
    "user": {
      "login": "gavinandresen",
      "id": 331997,
      "node_id": "MDQ6VXNlcjMzMTk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/331997?u=db313a954a318b81f5283d34908397d1ea3aeba3&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gavinandresen",
      "html_url": "https://github.com/gavinandresen",
      "followers_url": "https://api.github.com/users/gavinandresen/followers",
      "following_url": "https://api.github.com/users/gavinandresen/following{/other_user}",
      "gists_url": "https://api.github.com/users/gavinandresen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gavinandresen/subscriptions",
      "organizations_url": "https://api.github.com/users/gavinandresen/orgs",
      "repos_url": "https://api.github.com/users/gavinandresen/repos",
      "events_url": "https://api.github.com/users/gavinandresen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gavinandresen/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2014-02-14T22:34:26Z",
    "updated_at": "2014-02-14T22:35:44Z",
    "author_association": "CONTRIBUTOR",
    "body": "Fixed the generated-coins-counted-as-conflict, but gmaxwell found getbalance '*' is counting immature coinbases...\n\nUPDATE: so does 0.9.0rc1, so I don't feel so bad.  I'll fix.\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/35131818/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/35140408",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/3671#issuecomment-35140408",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/3671",
    "id": 35140408,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MTQwNDA4",
    "user": {
      "login": "BitcoinPullTester",
      "id": 2110907,
      "node_id": "MDQ6VXNlcjIxMTA5MDc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2110907?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/BitcoinPullTester",
      "html_url": "https://github.com/BitcoinPullTester",
      "followers_url": "https://api.github.com/users/BitcoinPullTester/followers",
      "following_url": "https://api.github.com/users/BitcoinPullTester/following{/other_user}",
      "gists_url": "https://api.github.com/users/BitcoinPullTester/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/BitcoinPullTester/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/BitcoinPullTester/subscriptions",
      "organizations_url": "https://api.github.com/users/BitcoinPullTester/orgs",
      "repos_url": "https://api.github.com/users/BitcoinPullTester/repos",
      "events_url": "https://api.github.com/users/BitcoinPullTester/events{/privacy}",
      "received_events_url": "https://api.github.com/users/BitcoinPullTester/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2014-02-14T23:58:00Z",
    "updated_at": "2014-02-14T23:58:00Z",
    "author_association": "NONE",
    "body": "Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/731b89b8b53cb2ea4d2d5c8f2875def515766ea1 for binaries and test log.\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.log is moving at http://jenkins.bluematt.me/pull-tester/current/\nContact BlueMatt on freenode if something looks broken.\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/35140408/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/35142509",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/3671#issuecomment-35142509",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/3671",
    "id": 35142509,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MTQyNTA5",
    "user": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?u=63e5c438c242094837a9deeda775d77988b508bf&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2014-02-15T00:50:17Z",
    "updated_at": "2014-02-15T00:50:17Z",
    "author_association": "CONTRIBUTOR",
    "body": "ACK. (immature coins issue fixed too)\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/35142509/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/35149999",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/3671#issuecomment-35149999",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/3671",
    "id": 35149999,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MTQ5OTk5",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2014-02-15T08:09:07Z",
    "updated_at": "2014-02-15T08:09:07Z",
    "author_association": "MEMBER",
    "body": "ACK code changes, works for me (tested with conflicts, mined transactions and unconfirmed transactions, as well as spending unconfirmed change).\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/35149999/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9741072",
    "pull_request_review_id": null,
    "id": 9741072,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDk3NDEwNzI=",
    "diff_hunk": "@@ -445,6 +482,7 @@ bool CWallet::AddToWallet(const CWalletTx& wtxIn)\n                              wtxIn.GetHash().ToString(),\n                              wtxIn.hashBlock.ToString());\n             }\n+            AddToClones(normHash, hash);",
    "path": "src/wallet.cpp",
    "position": null,
    "original_position": 59,
    "commit_id": "731b89b8b53cb2ea4d2d5c8f2875def515766ea1",
    "original_commit_id": "3d9b7e262165da6d24676e79f71a50383484e5f7",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "~~Before this call, we should detect if there is an existing \"clone\" and if so copy the metadata (at least vOrderForm).~~\nEdit: never mind, you already do that _in_ AddToClones...\n",
    "created_at": "2014-02-14T07:32:31Z",
    "updated_at": "2014-02-14T23:13:50Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/3671#discussion_r9741072",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/3671",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9741072"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/3671#discussion_r9741072"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/3671"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9741072/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 485,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9741144",
    "pull_request_review_id": null,
    "id": 9741144,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDk3NDExNDQ=",
    "diff_hunk": "@@ -385,9 +398,33 @@ void CWallet::MarkDirty()\n     }\n }\n \n-bool CWallet::AddToWallet(const CWalletTx& wtxIn)\n+void CWallet::AddToClones(const uint256& normHash, const uint256& hash)\n+{\n+    // Copy metadata from clone, if there is a clone:\n+    if (mapTxClones.count(normHash) > 0)\n+    {\n+        const uint256& otherTxid = mapTxClones.find(normHash)->second;\n+        const CWalletTx& otherTx = mapWallet[otherTxid];\n+        CWalletTx& thisTx = mapWallet[hash];\n+        thisTx.nTimeSmart = otherTx.nTimeSmart;\n+        thisTx.fFromMe = otherTx.fFromMe;\n+        thisTx.strFromAccount = otherTx.strFromAccount;\n+        thisTx.nOrderPos = otherTx.nOrderPos;\n+    }\n+}\n+\n+bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFromLoadWallet)\n {\n     uint256 hash = wtxIn.GetHash();\n+    uint256 normHash = wtxIn.GetNormalizedHash();\n+\n+    if (fFromLoadWallet)\n+    {\n+        mapWallet[hash] = wtxIn;\n+        AddToClones(normHash, hash);",
    "path": "src/wallet.cpp",
    "position": null,
    "original_position": 48,
    "commit_id": "731b89b8b53cb2ea4d2d5c8f2875def515766ea1",
    "original_commit_id": "3d9b7e262165da6d24676e79f71a50383484e5f7",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I'm uncertain about doing the metadata copying while loading from the wallet.\nThe wallet transactions aren't loaded in a specific order, so it will basically judge a random one of them to be the 'original clone' and copy that one's metadata. Every time the wallet loads.\n",
    "created_at": "2014-02-14T07:38:47Z",
    "updated_at": "2014-02-14T23:13:50Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/3671#discussion_r9741144",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/3671",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9741144"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/3671#discussion_r9741144"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/3671"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9741144/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 424,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9741605",
    "pull_request_review_id": null,
    "id": 9741605,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDk3NDE2MDU=",
    "diff_hunk": "@@ -385,9 +398,33 @@ void CWallet::MarkDirty()\n     }\n }\n \n-bool CWallet::AddToWallet(const CWalletTx& wtxIn)\n+void CWallet::AddToClones(const uint256& normHash, const uint256& hash)\n+{\n+    // Copy metadata from clone, if there is a clone:\n+    if (mapTxClones.count(normHash) > 0)\n+    {\n+        const uint256& otherTxid = mapTxClones.find(normHash)->second;\n+        const CWalletTx& otherTx = mapWallet[otherTxid];\n+        CWalletTx& thisTx = mapWallet[hash];\n+        thisTx.nTimeSmart = otherTx.nTimeSmart;\n+        thisTx.fFromMe = otherTx.fFromMe;\n+        thisTx.strFromAccount = otherTx.strFromAccount;\n+        thisTx.nOrderPos = otherTx.nOrderPos;",
    "path": "src/wallet.cpp",
    "position": null,
    "original_position": 36,
    "commit_id": "731b89b8b53cb2ea4d2d5c8f2875def515766ea1",
    "original_commit_id": "3d9b7e262165da6d24676e79f71a50383484e5f7",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Please copy vOrderForm so that we don't lose payment request data and URI 'message' fields\n",
    "created_at": "2014-02-14T08:18:22Z",
    "updated_at": "2014-02-14T23:13:50Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/3671#discussion_r9741605",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/3671",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9741605"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/3671#discussion_r9741605"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/3671"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9741605/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 412,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9741677",
    "pull_request_review_id": null,
    "id": 9741677,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDk3NDE2Nzc=",
    "diff_hunk": "@@ -108,6 +108,10 @@ class CWallet : public CCryptoKeyStore, public CWalletInterface\n     int64_t nNextResend;\n     int64_t nLastResend;\n \n+    // Used to detect and report mutated transactions:\n+    std::multimap<uint256, uint256> mapTxClones;",
    "path": "src/wallet.h",
    "position": null,
    "original_position": 5,
    "commit_id": "731b89b8b53cb2ea4d2d5c8f2875def515766ea1",
    "original_commit_id": "3d9b7e262165da6d24676e79f71a50383484e5f7",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "@sipa Is it safe to use the sipahash(TM) here, or would it be better to use CTxIn.prevout (COutPoint) as you proposed?\n",
    "created_at": "2014-02-14T08:24:06Z",
    "updated_at": "2014-02-14T23:13:50Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/3671#discussion_r9741677",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/3671",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9741677"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/3671#discussion_r9741677"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/3671"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9741677/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 112,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9747092",
    "pull_request_review_id": null,
    "id": 9747092,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDk3NDcwOTI=",
    "diff_hunk": "@@ -108,6 +108,10 @@ class CWallet : public CCryptoKeyStore, public CWalletInterface\n     int64_t nNextResend;\n     int64_t nLastResend;\n \n+    // Used to detect and report mutated transactions:\n+    std::multimap<uint256, uint256> mapTxClones;",
    "path": "src/wallet.h",
    "position": null,
    "original_position": 5,
    "commit_id": "731b89b8b53cb2ea4d2d5c8f2875def515766ea1",
    "original_commit_id": "3d9b7e262165da6d24676e79f71a50383484e5f7",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "No point in using a hash here IMO. I'd just use a multimap from COutPoints to the wallet transacitons they are spent int.\n",
    "created_at": "2014-02-14T12:45:22Z",
    "updated_at": "2014-02-14T23:13:50Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/3671#discussion_r9747092",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/3671",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9747092"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/3671#discussion_r9747092"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/3671"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9747092/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 112,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9748263",
    "pull_request_review_id": null,
    "id": 9748263,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDk3NDgyNjM=",
    "diff_hunk": "@@ -385,9 +398,33 @@ void CWallet::MarkDirty()\n     }\n }\n \n-bool CWallet::AddToWallet(const CWalletTx& wtxIn)\n+void CWallet::AddToClones(const uint256& normHash, const uint256& hash)\n+{\n+    // Copy metadata from clone, if there is a clone:\n+    if (mapTxClones.count(normHash) > 0)\n+    {\n+        const uint256& otherTxid = mapTxClones.find(normHash)->second;\n+        const CWalletTx& otherTx = mapWallet[otherTxid];\n+        CWalletTx& thisTx = mapWallet[hash];\n+        thisTx.nTimeSmart = otherTx.nTimeSmart;\n+        thisTx.fFromMe = otherTx.fFromMe;\n+        thisTx.strFromAccount = otherTx.strFromAccount;\n+        thisTx.nOrderPos = otherTx.nOrderPos;",
    "path": "src/wallet.cpp",
    "position": null,
    "original_position": 36,
    "commit_id": "731b89b8b53cb2ea4d2d5c8f2875def515766ea1",
    "original_commit_id": "3d9b7e262165da6d24676e79f71a50383484e5f7",
    "user": {
      "login": "gavinandresen",
      "id": 331997,
      "node_id": "MDQ6VXNlcjMzMTk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/331997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gavinandresen",
      "html_url": "https://github.com/gavinandresen",
      "followers_url": "https://api.github.com/users/gavinandresen/followers",
      "following_url": "https://api.github.com/users/gavinandresen/following{/other_user}",
      "gists_url": "https://api.github.com/users/gavinandresen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gavinandresen/subscriptions",
      "organizations_url": "https://api.github.com/users/gavinandresen/orgs",
      "repos_url": "https://api.github.com/users/gavinandresen/repos",
      "events_url": "https://api.github.com/users/gavinandresen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gavinandresen/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "ACK\n",
    "created_at": "2014-02-14T13:41:39Z",
    "updated_at": "2014-02-14T23:13:50Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/3671#discussion_r9748263",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/3671",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9748263"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/3671#discussion_r9748263"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/3671"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9748263/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 412,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9748390",
    "pull_request_review_id": null,
    "id": 9748390,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDk3NDgzOTA=",
    "diff_hunk": "@@ -385,9 +398,33 @@ void CWallet::MarkDirty()\n     }\n }\n \n-bool CWallet::AddToWallet(const CWalletTx& wtxIn)\n+void CWallet::AddToClones(const uint256& normHash, const uint256& hash)\n+{\n+    // Copy metadata from clone, if there is a clone:\n+    if (mapTxClones.count(normHash) > 0)\n+    {\n+        const uint256& otherTxid = mapTxClones.find(normHash)->second;\n+        const CWalletTx& otherTx = mapWallet[otherTxid];\n+        CWalletTx& thisTx = mapWallet[hash];\n+        thisTx.nTimeSmart = otherTx.nTimeSmart;\n+        thisTx.fFromMe = otherTx.fFromMe;\n+        thisTx.strFromAccount = otherTx.strFromAccount;\n+        thisTx.nOrderPos = otherTx.nOrderPos;\n+    }\n+}\n+\n+bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFromLoadWallet)\n {\n     uint256 hash = wtxIn.GetHash();\n+    uint256 normHash = wtxIn.GetNormalizedHash();\n+\n+    if (fFromLoadWallet)\n+    {\n+        mapWallet[hash] = wtxIn;\n+        AddToClones(normHash, hash);",
    "path": "src/wallet.cpp",
    "position": null,
    "original_position": 48,
    "commit_id": "731b89b8b53cb2ea4d2d5c8f2875def515766ea1",
    "original_commit_id": "3d9b7e262165da6d24676e79f71a50383484e5f7",
    "user": {
      "login": "gavinandresen",
      "id": 331997,
      "node_id": "MDQ6VXNlcjMzMTk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/331997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gavinandresen",
      "html_url": "https://github.com/gavinandresen",
      "followers_url": "https://api.github.com/users/gavinandresen/followers",
      "following_url": "https://api.github.com/users/gavinandresen/following{/other_user}",
      "gists_url": "https://api.github.com/users/gavinandresen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gavinandresen/subscriptions",
      "organizations_url": "https://api.github.com/users/gavinandresen/orgs",
      "repos_url": "https://api.github.com/users/gavinandresen/repos",
      "events_url": "https://api.github.com/users/gavinandresen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gavinandresen/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Good catch, I made a mental note to myself last night to look into how \"tx\" records are ordered in the wallet. I think nOrderPos might give the ordering we want (metadata should always come from the transaction the wallet created, not the mutated one seen later).\n\nDoing the metadata copying while loading the wallet is important for clean recovery; I could bump the wallet version number and run it as a one-time conversion, but since performance isn't an issue here (metadata is only cloned in the rare case where a mutant gets mined over your original transaction) I don't think that is worth it.\n",
    "created_at": "2014-02-14T13:46:37Z",
    "updated_at": "2014-02-14T23:13:50Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/3671#discussion_r9748390",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/3671",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9748390"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/3671#discussion_r9748390"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/3671"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9748390/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 424,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9748609",
    "pull_request_review_id": null,
    "id": 9748609,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDk3NDg2MDk=",
    "diff_hunk": "@@ -385,9 +398,33 @@ void CWallet::MarkDirty()\n     }\n }\n \n-bool CWallet::AddToWallet(const CWalletTx& wtxIn)\n+void CWallet::AddToClones(const uint256& normHash, const uint256& hash)\n+{\n+    // Copy metadata from clone, if there is a clone:\n+    if (mapTxClones.count(normHash) > 0)\n+    {\n+        const uint256& otherTxid = mapTxClones.find(normHash)->second;\n+        const CWalletTx& otherTx = mapWallet[otherTxid];\n+        CWalletTx& thisTx = mapWallet[hash];\n+        thisTx.nTimeSmart = otherTx.nTimeSmart;\n+        thisTx.fFromMe = otherTx.fFromMe;\n+        thisTx.strFromAccount = otherTx.strFromAccount;\n+        thisTx.nOrderPos = otherTx.nOrderPos;\n+    }\n+}\n+\n+bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFromLoadWallet)\n {\n     uint256 hash = wtxIn.GetHash();\n+    uint256 normHash = wtxIn.GetNormalizedHash();\n+\n+    if (fFromLoadWallet)\n+    {\n+        mapWallet[hash] = wtxIn;\n+        AddToClones(normHash, hash);",
    "path": "src/wallet.cpp",
    "position": null,
    "original_position": 48,
    "commit_id": "731b89b8b53cb2ea4d2d5c8f2875def515766ea1",
    "original_commit_id": "3d9b7e262165da6d24676e79f71a50383484e5f7",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Defining the one with the lowest orderpos as 'original clone' sounds like a sensible resolution. As we create the transactions in increasing orderpos, that will the one created by the client itself.\n\nEdit: agree on not bumping the wallet version for this. When we need to bump the wallet version for another reason  at some time in the future we can always move it to the upgrader there.\n",
    "created_at": "2014-02-14T13:56:38Z",
    "updated_at": "2014-02-14T23:13:50Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/3671#discussion_r9748609",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/3671",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9748609"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/3671#discussion_r9748609"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/3671"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9748609/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 424,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9749351",
    "pull_request_review_id": null,
    "id": 9749351,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDk3NDkzNTE=",
    "diff_hunk": "@@ -108,6 +108,10 @@ class CWallet : public CCryptoKeyStore, public CWalletInterface\n     int64_t nNextResend;\n     int64_t nLastResend;\n \n+    // Used to detect and report mutated transactions:\n+    std::multimap<uint256, uint256> mapTxClones;",
    "path": "src/wallet.h",
    "position": null,
    "original_position": 5,
    "commit_id": "731b89b8b53cb2ea4d2d5c8f2875def515766ea1",
    "original_commit_id": "3d9b7e262165da6d24676e79f71a50383484e5f7",
    "user": {
      "login": "gavinandresen",
      "id": 331997,
      "node_id": "MDQ6VXNlcjMzMTk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/331997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gavinandresen",
      "html_url": "https://github.com/gavinandresen",
      "followers_url": "https://api.github.com/users/gavinandresen/followers",
      "following_url": "https://api.github.com/users/gavinandresen/following{/other_user}",
      "gists_url": "https://api.github.com/users/gavinandresen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gavinandresen/subscriptions",
      "organizations_url": "https://api.github.com/users/gavinandresen/orgs",
      "repos_url": "https://api.github.com/users/gavinandresen/repos",
      "events_url": "https://api.github.com/users/gavinandresen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gavinandresen/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "@sipa: will do. I got stuck yesterday going down the rabbit-hole of COutPoints to possibly-not-a-wallet-transaction....\n",
    "created_at": "2014-02-14T14:26:58Z",
    "updated_at": "2014-02-14T23:13:50Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/3671#discussion_r9749351",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/3671",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9749351"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/3671#discussion_r9749351"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/3671"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9749351/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 112,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9749450",
    "pull_request_review_id": null,
    "id": 9749450,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDk3NDk0NTA=",
    "diff_hunk": "@@ -108,6 +108,10 @@ class CWallet : public CCryptoKeyStore, public CWalletInterface\n     int64_t nNextResend;\n     int64_t nLastResend;\n \n+    // Used to detect and report mutated transactions:\n+    std::multimap<uint256, uint256> mapTxClones;",
    "path": "src/wallet.h",
    "position": null,
    "original_position": 5,
    "commit_id": "731b89b8b53cb2ea4d2d5c8f2875def515766ea1",
    "original_commit_id": "3d9b7e262165da6d24676e79f71a50383484e5f7",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "To detect whether a transaction is viable, and possible conflicts, you can rely on the mempool (aka confirmations < 0). You only need the clone/double spend detection to copy metadata I think.\n",
    "created_at": "2014-02-14T14:30:31Z",
    "updated_at": "2014-02-14T23:13:50Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/3671#discussion_r9749450",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/3671",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9749450"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/3671#discussion_r9749450"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/3671"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9749450/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 112,
    "side": "RIGHT"
  }
]