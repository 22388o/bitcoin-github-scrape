laanwj,2018-04-10T08:57:55Z,"I like using a recent wine. Unlike other kinds, winehq's wine doesn't age well.\n\nThis is their ""wine-stable"" so we don't (as we shouldn't) take upon us the job of testing experimental new wine, either.\n\nWould even more prefer to bump entire test environment to a more recent distribution (ref #12511) but I don't think Travis makes that possible (or easy), so this is a good intermediate step",https://github.com/bitcoin/bitcoin/pull/12931#issuecomment-380026298,380026298,
kallewoof,2018-04-10T09:06:08Z,"`Timeout (15 minutes) reached.` -- I think non-Win jobs occasionally take up to 30 mins (for some reason), so this may be too low. That aside, utACK!",https://github.com/bitcoin/bitcoin/pull/12931#issuecomment-380028592,380028592,
practicalswift,2018-04-10T09:43:44Z,utACK a833fe6df5c86c7cf3bae319a000b70048031e31 module adjustment/removal of timeout change,https://github.com/bitcoin/bitcoin/pull/12931#issuecomment-380039653,380039653,
ajtowns,2018-04-10T12:02:23Z,"@kallewoof Hmm, the timeout was for the x86-64 win32 build, which I left using wine1.6. Anyone have any examples of a non-win32 travis job where ""make check"" took longer than 5 or 10 minutes?",https://github.com/bitcoin/bitcoin/pull/12931#issuecomment-380073935,380073935,
laanwj,2018-04-10T12:18:33Z,"> @kallewoof Hmm, the timeout was for the x86-64 win32 build, which I left using wine1.6. \n\nI think that's confusing - let's switch all the wine builds around for consistency.",https://github.com/bitcoin/bitcoin/pull/12931#issuecomment-380078085,380078085,
MarcoFalke,2018-04-10T13:08:47Z,Needs rebase if still relevant,https://github.com/bitcoin/bitcoin/pull/12931#issuecomment-380091900,380091900,
ajtowns,2018-04-10T14:15:24Z,Rebased post #12926 merge.,https://github.com/bitcoin/bitcoin/pull/12931#issuecomment-380114957,380114957,
MarcoFalke,2018-04-10T15:07:51Z,"Seems `make check` would run twice as fast, now.",https://github.com/bitcoin/bitcoin/pull/12931#issuecomment-380135670,380135670,
laanwj,2018-04-10T15:21:22Z,re-utACK https://github.com/bitcoin/bitcoin/pull/12931/commits/63b19a67610c635385c134a21f71bb771b201c16,https://github.com/bitcoin/bitcoin/pull/12931#issuecomment-380140449,380140449,
jnewbery,2018-04-10T17:26:41Z,"Concept ACK.\n\nThe `apt-get install` step takes ~ 6 minutes (https://travis-ci.org/bitcoin/bitcoin/jobs/364620673#L494). Is it possible to cache the dependency in Travis (perhaps using https://docs.travis-ci.com/user/caching#Arbitrary-directories)?",https://github.com/bitcoin/bitcoin/pull/12931#issuecomment-380182363,380182363,
MarcoFalke,2018-04-10T18:48:13Z,"Ouch. That dwarfs any speedups gained later on. I'd highly suspect the bottleneck is installing the ~200 packages and not fetching them, so caching woulnd't help here.",https://github.com/bitcoin/bitcoin/pull/12931#issuecomment-380207795,380207795,
jamesob,2018-04-10T19:57:46Z,"> I'd highly suspect the bottleneck is installing the ~200 packages and not fetching them, so caching woulnd't help here.\n\nThat seems to somewhat contradict [what Travis' documentation says on what to cache](https://docs.travis-ci.com/user/caching#Things-not-to-cache):\n\n> Large files that are quick to install but slow to download do not benefit from caching, as they take as long to downloa",https://github.com/bitcoin/bitcoin/pull/12931#issuecomment-380227356,380227356,
MarcoFalke,2018-04-10T20:01:30Z,"> Edit: ah, they specifically call out ""Debian packages"" below as something not to cache. Oops :).\n\nYeah, I'd rather not install those. I'd surprised if all of them are actually needed.",https://github.com/bitcoin/bitcoin/pull/12931#issuecomment-380228359,380228359,
kallewoof,2018-04-11T04:49:34Z,Could the `--install-recommends` part be fine tuned (replace with explicit package names) to exclude unnecessary stuff?,https://github.com/bitcoin/bitcoin/pull/12931#issuecomment-380326223,380326223,
laanwj,2018-04-11T05:49:40Z,"> Could the --install-recommends part be fine tuned (replace with explicit package names) to exclude unnecessary stuff?\n\nGood idea. `--install-recommends` is almost always a bad idea (especially in the non-interactive case - it will install documentation and such!). As `test_bitcoin` is a basic console program I wouldn't be surprised if we only need the wine base package.",https://github.com/bitcoin/bitcoin/pull/12931#issuecomment-380335096,380335096,
laanwj,2018-04-11T12:12:50Z,Needs update to commit message and PR title now that all windows tests are performed using the new wine.,https://github.com/bitcoin/bitcoin/pull/12931#issuecomment-380429918,380429918,
jnewbery,2018-04-11T20:31:06Z,Much better! apt-get is now taking 6 seconds on the i686-w64-mingw32 job and 30 seconds on the x86_64-w64-mingw32 job.,https://github.com/bitcoin/bitcoin/pull/12931#issuecomment-380585912,380585912,
ajtowns,2018-04-12T13:39:37Z,"PR title updated, commit message had already been updated. Even with `--no-install-recommends`, it's grabbing a lot of packages (100MB versus 130MB by the looks), and it also seems like travis's download speeds can be wildly inconsistent:\n\n* `Fetched 109 MB in 2s (51.9 MB/s)` -- https://travis-ci.org/bitcoin/bitcoin/jobs/364960356\n* `Fetched 133 MB in 5min 9s (429 kB/s)` -- https://travis-ci",https://github.com/bitcoin/bitcoin/pull/12931#issuecomment-380808464,380808464,
MarcoFalke,2018-04-12T14:04:00Z,"utACK e5997988149b7ecf41e73815c6b161b3c1dff1b4 (Would still be an improvement if it took travis 6 minutes to install winehq)\n\nprevious `make check` times would be between 915 and 1350 and new times between 405 and 530, so as long as we spend less than 6 minutes in `apt-get` it is a net win.",https://github.com/bitcoin/bitcoin/pull/12931#issuecomment-380816495,380816495,
MarcoFalke,2018-04-12T14:04:59Z,Just reset the travis run and it seems the slow fetch was a one-off. Changes look good to me...,https://github.com/bitcoin/bitcoin/pull/12931#issuecomment-380816823,380816823,
jnewbery,2018-04-12T14:14:34Z,"@MarcoFalke \n> I'd highly suspect the bottleneck is installing the ~200 packages and not fetching them\n\n@ajtowns \n>  it also seems like travis's download speeds can be wildly inconsistent:\n\nIt appears that fetching the packages *is* the bottleneck here, which suggests that caching locally would help. That could be investigated in a follow-up PR - no need to solve it here if this is alr",https://github.com/bitcoin/bitcoin/pull/12931#issuecomment-380820274,380820274,
MarcoFalke,2018-04-12T14:23:43Z,"@jnewbery As correctly pointed out by @jamesob above they should *not* be cached according to the documentation: https://docs.travis-ci.com/user/caching#Things-not-to-cache. I suspect the packages are already cached within the travis network, so adding them a second time to the cache (explicitly) wouldn't help.\nI guess this was just a one-off not worth to waste time on.",https://github.com/bitcoin/bitcoin/pull/12931#issuecomment-380823464,380823464,
jnewbery,2018-04-12T14:34:49Z,"one-off is one-too-many-off for my liking (especially in a sample size of three) :)\n\nLike I said, this can be investigated in a future if it turns out to be a regular problem. I can't believe that downloading 133MB from Travis's internal cache can ever take as long as 5 mintues.",https://github.com/bitcoin/bitcoin/pull/12931#issuecomment-380827381,380827381,
MarcoFalke,2018-04-12T15:12:25Z,"Yeah, right. Though, downloading the packages from the mirror shouldn't take 5 minutes either. Note that the cache is not stored internally but on S3 [1], so it might be further away from gce (where our vms run) than the gce mirror of the ubuntu packages.\n\n[1] https://docs.travis-ci.com/user/caching#How-does-the-caching-work%3F",https://github.com/bitcoin/bitcoin/pull/12931#issuecomment-380840575,380840575,
theuni,2018-04-12T19:03:48Z,Has anyone tracked down exactly _what_ is sped up by newer Wine? I'm wondering if there's some one-off test that accounts for the bulk of the difference.,https://github.com/bitcoin/bitcoin/pull/12931#issuecomment-380911889,380911889,
theuni,2018-04-12T21:28:47Z,"See #12970, which may negate some of the gains here.\n\nEdit: Yea, those times are even better than these. It'd be interesting to see if there's an even further speedup with a newer Wine, though I suspect it's no longer worth the hassle.",https://github.com/bitcoin/bitcoin/pull/12931#issuecomment-380950098,380950098,
ajtowns,2018-04-13T02:15:28Z,"Rebased on top of the now-merged #12970. I think at this point it's not worth the added risk/complexity of pulling in out-of-tree packages, but it does seem interesting to see if there's any further improvement. :)",https://github.com/bitcoin/bitcoin/pull/12931#issuecomment-381000180,381000180,
MarcoFalke,2018-04-13T13:54:42Z,"Assuming that you did the rebase correctly, this appears to be running slower even when ignoring the time it takes to install wine-hq, no?",https://github.com/bitcoin/bitcoin/pull/12931#issuecomment-381142866,381142866,
MarcoFalke,2018-04-17T03:28:45Z,Can be closed?,https://github.com/bitcoin/bitcoin/pull/12931#issuecomment-381824289,381824289,
ajtowns,2018-04-17T03:41:04Z,"I think so. I suspect the ""running slower"" is just variance from travis, but either way any gains do seem small enough not to be worthwhile. wine-stable 3.0 is in bionic as well.",https://github.com/bitcoin/bitcoin/pull/12931#issuecomment-381826817,381826817,
practicalswift,2018-04-10T10:32:01Z,"What is the reasoning behind the change from 50 to 15 here?\n\nWhat is the drawback of keeping it at 50 minutes for now and lower it in the future when we've collected more data on the runtime of Windows Travis job after this change?",https://github.com/bitcoin/bitcoin/pull/12931#discussion_r180371192,180371192,.travis.yml
kallewoof,2018-04-10T10:41:57Z,It was raised from 30 to 50. I think it should be dropped to 30 again.,https://github.com/bitcoin/bitcoin/pull/12931#discussion_r180374300,180374300,.travis.yml
practicalswift,2018-04-10T10:56:58Z,30 sounds reasonable.,https://github.com/bitcoin/bitcoin/pull/12931#discussion_r180377869,180377869,.travis.yml
