jonatack,2021-05-24 22:01:06,A recent IRC discussion for more context. http://www.erisian.com.au/bitcoin-core-dev/log-2021-05-20.html#l-401,https://github.com/bitcoin/bitcoin/pull/22050#issuecomment-847370603,847370603,
theStack,2021-05-24 23:05:22,Concept ACK,https://github.com/bitcoin/bitcoin/pull/22050#issuecomment-847410360,847410360,
Rspigler,2021-05-25 02:12:10,Concept ACK,https://github.com/bitcoin/bitcoin/pull/22050#issuecomment-847477564,847477564,
dunxen,2021-05-25 06:53:58,"Concept ACK. (Thank you for your _service_, tor v2)",https://github.com/bitcoin/bitcoin/pull/22050#issuecomment-847596526,847596526,
0xB10C,2021-05-25 07:08:53,Concept ACK,https://github.com/bitcoin/bitcoin/pull/22050#issuecomment-847607252,847607252,
laanwj,2021-05-25 14:53:21,"Concept ACK, adding 22.0 label\nGoing to test this.",https://github.com/bitcoin/bitcoin/pull/22050#issuecomment-847937835,847937835,
DrahtBot,2021-05-25 17:46:15,<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.,https://github.com/bitcoin/bitcoin/pull/22050#issuecomment-848083829,848083829,
jonatack,2021-05-28 08:18:10,This seems to be ready. Updated the PR description. Will propose release documentation in a follow-up.,https://github.com/bitcoin/bitcoin/pull/22050#issuecomment-850241089,850241089,
willcl-ark,2021-05-28 20:01:33,"Light tested ACK, rebased on top of master @ 123b401e0acf3b26f149711bdf06d7f6eced1968\n\nUsed Tor version 0.4.5.7. with manually configured hidden service and a bitcoin.conf with \n\n```\nlistenonion=1\nonlynet=onion\nproxy=127.0.0.1:9050\n```\n\n* Node has not picked up any Tor V2 addresses since startup and has a healthy number of V3 addresses in a short period of time:\n\n<img width",https://github.com/bitcoin/bitcoin/pull/22050#issuecomment-850642519,850642519,
jonatack,2021-05-29 10:10:48,"Changed `generate-seeds.py` to ignore torv2 addresses rather than raise. (Edit: I don't know if using `None` or an optional type would be preferred to -1 or more pythonic, happy to update if so.)\n\n<details><summary><code>git diff 5715134 ef34bda</code></summary><p>\n\n```diff\ndiff --git a/contrib/seeds/generate-seeds.py b/contrib/seeds/generate-seeds.py\nindex aaccefcf6f..ae97240203 10075",https://github.com/bitcoin/bitcoin/pull/22050#issuecomment-850808537,850808537,
benthecarman,2021-05-29 10:20:08,utACK ef34bda6c52d7a59be9cd3451bc3536430410e36,https://github.com/bitcoin/bitcoin/pull/22050#issuecomment-850809576,850809576,
jonatack,2021-05-29 18:38:26,"Tested using `addnode`, `getaddednodeinfo`,`addpeeraddress`, `disconnectnode` and `-addrinfo` that a currently valid, connectable Tor v2 peer can no longer be added:\n\n![Screenshot from 2021-05-30 11-32-05](https://user-images.githubusercontent.com/2415484/120099282-29435d80-c12a-11eb-81b6-5084244d7d2a.png)\n",https://github.com/bitcoin/bitcoin/pull/22050#issuecomment-850880216,850880216,
dunxen,2021-05-29 18:47:30,"tACK ef34bda\n\n* Using Tor v0.4.4.6.\n* Node originally had established connections with Tor v2 peers, now does not connect to v2 peers on patch.\n* After a short while, with `onlynet=onion`, node is connected to 8+ Tor v3 peers exclusively.\n\nNo Tor v2 addresses known\n```\n{\n  ""addresses_known"": {\n    ""ipv4"": 309,\n    ""ipv6"": 33,\n    ""torv2"": 0,\n    ""torv3"": 3563,\n    ""i2p""",https://github.com/bitcoin/bitcoin/pull/22050#issuecomment-850881564,850881564,
Rspigler,2021-05-30 00:45:50,Could we add a more detailed error message for someone who misses or doesn't read the release docs?,https://github.com/bitcoin/bitcoin/pull/22050#issuecomment-850920465,850920465,
Zero-1729,2021-05-30 03:13:01,"tACK ef34bda6c52d7a59be9cd3451bc3536430410e36\n\nUsing Tor v0.4.5.8 on MacOS 11.3.1 (20E241)\n\n> **Note**: Tor v2 seed (`bk7yp6epnmcllq72.onion`) used is from [this article](https://stopanddecrypt.medium.com/running-bitcoin-lightning-nodes-over-the-tor-network-2021-edition-489180297d5).\n>\n> Started `bitcoind` with `-onlynet=onion -listenonion=1 -proxy=127.0.0.1:9050`\n\n#### Before (on m",https://github.com/bitcoin/bitcoin/pull/22050#issuecomment-850932632,850932632,
jonatack,2021-05-30 10:04:27,"Updated https://github.com/bitcoin/bitcoin/pull/22050#issuecomment-850880216 to also mention `getaddednodeinfo`.\n\n> Could we add a more detailed error message for someone who misses or doesn't read the release docs?\n\nGood question. Are you thinking of `addpeeraddress` or `addnode`? The former is a hidden test/debug RPC. The latter can be a valuable anti-Eclipse measure to help ensure a nod",https://github.com/bitcoin/bitcoin/pull/22050#issuecomment-850973817,850973817,
Rspigler,2021-05-30 22:24:17,"> I was kind of hoping that updating doc/tor.md and adding an announcement toward the top of the release notes (both in a follow-up), along with communication on twitter and the fediverse (and by the Tor Project, who propose to communicate together for the transition) and maybe resources like the ML and Bitcoin Optech would be enough.\n\nGood point, I think if we do all that, it should be enough",https://github.com/bitcoin/bitcoin/pull/22050#issuecomment-851070337,851070337,
kiminuo,2021-06-01 09:46:02,"@jonatack `$ ./src/bitcoin-cli -addrinfo` reports `torv2` entry as [mentioned in OP](https://github.com/bitcoin/bitcoin/pull/22050#issue-651655132). The plan is to remove this later, I guess, right?",https://github.com/bitcoin/bitcoin/pull/22050#issuecomment-851988534,851988534,
jonatack,2021-06-01 09:56:47,"> @jonatack `$ ./src/bitcoin-cli -addrinfo` reports `torv2` entry as [mentioned in OP](https://github.com/bitcoin/bitcoin/pull/22050#issue-651655132). The plan is to remove this later, I guess, right?\n\nIndeed yes, the reason for -addrinfo returning torv2 and torv3 is for this transition period so the user can see if their node knows enough torv3 peers. When torv2 peers are gone, we can simplif",https://github.com/bitcoin/bitcoin/pull/22050#issuecomment-851995159,851995159,
reemuru,2021-06-01 19:50:54,"tACK ef34bda. Run on mainnet, Fedora 34 stable.\n\n```bash\n[user@fedora bitcoin]$ tor --version\nJun 01 14:44:30.057 [warn] Tor was compiled with zstd 1.4.9, but is running with zstd 1.5.0. For safety, we'll avoid using advanced zstd functionality.\nTor version 0.4.5.8.\n```\n\n<details hidden><summary>before log</summary>\n\n    [user@fedora ~]$ bitcoin/src/bitcoin-cli -addrinfo\n    ",https://github.com/bitcoin/bitcoin/pull/22050#issuecomment-852402597,852402597,
MarcoFalke,2021-06-02 05:02:10,cc @laanwj from https://github.com/bitcoin/bitcoin/pull/22050#issuecomment-847937835,https://github.com/bitcoin/bitcoin/pull/22050#issuecomment-852723677,852723677,
jonatack,2021-06-03 11:51:05,"Changed the torv2-in-ipv6 case to deserialize explicitly to an invalid address which will be ignored, changed the ignore value in generate-seeds.py from `-1` to `None`, extracted the onion-to-string code to a helper, and updated a Doxygen comment.\n\n<details><summary><code>git diff ef34bda 5d82a57</code></summary><p>\n\n```diff\ndiff --git a/contrib/seeds/generate-seeds.py b/contrib/seeds/ge",https://github.com/bitcoin/bitcoin/pull/22050#issuecomment-853810144,853810144,
laanwj,2021-06-03 13:00:59,"Changes look good to me now.\nCode review ACK 5d82a57db4f67506a4e80d186ba76f3a8665e147\nTested ACK of an earlier commit, which I tested for a while on one of my nodes. I noticed no difference in behavior except for no longer connecting to Tor v2 nodes.",https://github.com/bitcoin/bitcoin/pull/22050#issuecomment-853849768,853849768,
laanwj,2021-05-27 11:23:40,Please also run `cd contrib/seeds && python3 generate-seeds.py . > ../../src/chainparamsseeds.h` to update `chainparamsseeds.h` (in the same commit?).,https://github.com/bitcoin/bitcoin/pull/22050#discussion_r640532351,640532351,contrib/seeds/nodes_main.txt
jonatack,2021-05-27 21:43:55,Thanks! Done.,https://github.com/bitcoin/bitcoin/pull/22050#discussion_r640990310,640990310,contrib/seeds/nodes_main.txt
benthecarman,2021-05-28 20:39:43,I think an error message specific for v2 not being supported would be better than the defualt error message,https://github.com/bitcoin/bitcoin/pull/22050#discussion_r641804773,641804773,contrib/seeds/generate-seeds.py
laanwj,2021-05-28 21:25:53,"I guess `makeseeds.py` is still producing these? It should probably ignore Torv2's from the DNS seeder (all of them, at the moment  sipa/bitcoin-seeder#92) completely.",https://github.com/bitcoin/bitcoin/pull/22050#discussion_r641822102,641822102,contrib/seeds/generate-seeds.py
jonatack,2021-05-29 10:04:44,"Thanks, updated `generate-seeds.py` to ignore torv2 rather than raise.",https://github.com/bitcoin/bitcoin/pull/22050#discussion_r641918890,641918890,contrib/seeds/generate-seeds.py
kiminuo,2021-06-01 09:21:42,Would it be possibly better to return `None` here?,https://github.com/bitcoin/bitcoin/pull/22050#discussion_r642933076,642933076,contrib/seeds/generate-seeds.py
kiminuo,2021-06-01 09:24:59,This re-ordering change looks unnecessary now. The diff would be smaller when you revert this 4 line change. :-),https://github.com/bitcoin/bitcoin/pull/22050#discussion_r642935655,642935655,contrib/seeds/generate-seeds.py
kiminuo,2021-06-01 09:37:42,"L301 mentions that `GetBIP155Network()` *Must not be called for IsInternal() objects.* \n\nWould it make sense to add a note after L301 about Tor v2 not being supported anymore? The reason why it may make sense is simply because [BIP155](https://github.com/bitcoin/bips/blob/master/bip-0155.mediawiki) is written with Tor v2 in mind (and that won't change, or will it?) and the function name is `Ge",https://github.com/bitcoin/bitcoin/pull/22050#discussion_r642945087,642945087,src/netaddress.h
jonatack,2021-06-01 09:51:13,"Yes, I asked this in https://github.com/bitcoin/bitcoin/pull/22050#issuecomment-850808537, happy to update if reviewers think it's worth changing.",https://github.com/bitcoin/bitcoin/pull/22050#discussion_r642954804,642954804,contrib/seeds/generate-seeds.py
jonatack,2021-06-01 09:51:48,Most frequent path first.,https://github.com/bitcoin/bitcoin/pull/22050#discussion_r642955227,642955227,contrib/seeds/generate-seeds.py
jonatack,2021-06-01 09:53:05,"I'm not sure if you're confusing ""addrv2"" and ""torv2"".  What comment would you suggest?",https://github.com/bitcoin/bitcoin/pull/22050#discussion_r642956126,642956126,src/netaddress.h
kiminuo,2021-06-01 16:31:30,"Ah, sorry. `None` +1 from me :)",https://github.com/bitcoin/bitcoin/pull/22050#discussion_r643268279,643268279,contrib/seeds/generate-seeds.py
kiminuo,2021-06-01 18:22:36,"The idea was to change:\n\n```cpp\n/**\n * Get the BIP155 network id of this address.\n * Must not be called for IsInternal() objects.\n * @returns BIP155 network id\n */\nBIP155Network GetBIP155Network() const;\n```\n\nto something like\n\n```cpp\n/**\n * Get the BIP155 network id of this address.\n * Must not be called for IsInternal() objects.\n * @returns BIP155 network id exc",https://github.com/bitcoin/bitcoin/pull/22050#discussion_r643381344,643381344,src/netaddress.h
jonatack,2021-06-01 20:16:46,"Ok, I have a couple minor refactorings ready that aren't essential to removing tor v2 support and propose to insert this change into that commit, unless I need to update this patch for another reason. ",https://github.com/bitcoin/bitcoin/pull/22050#discussion_r643450240,643450240,contrib/seeds/generate-seeds.py
jonatack,2021-06-01 20:19:11,"SGTM, will add to the follow-up refactoring commit unless this patch needs a more substantial update.",https://github.com/bitcoin/bitcoin/pull/22050#discussion_r643451559,643451559,src/netaddress.h
laanwj,2021-06-03 07:18:40,"I would prefer using the sentinel value `None` instead of `-1` then check with `spec is None` (just a small nit though, no need to change if no other changes are necessary).",https://github.com/bitcoin/bitcoin/pull/22050#discussion_r644546768,644546768,contrib/seeds/generate-seeds.py
laanwj,2021-06-03 07:19:38,Don't we need some kind of check here to be able to filter out (ignore) torv2-in-ipv6 in old style `addr` messages?,https://github.com/bitcoin/bitcoin/pull/22050#discussion_r644547316,644547316,src/netaddress.cpp
jonatack,2021-06-03 10:53:19,"Yes, I thought they would be invalid (so ignored) without the removed code, but it may be better to be explicit about it with something like:\n```cpp\n    } else if (HasPrefix(ipv6, TORV2_IN_IPV6_PREFIX)) {\n        // TORv2-in-IPv6 (unsupported). Unserialize as !IsValid(), thus ignoring them.\n        // Mimic a default-constructed CNetAddr object which is !IsValid() and thus\n        // wil",https://github.com/bitcoin/bitcoin/pull/22050#discussion_r644692607,644692607,src/netaddress.cpp
jonatack,2021-06-03 11:29:58,done,https://github.com/bitcoin/bitcoin/pull/22050#discussion_r644714103,644714103,contrib/seeds/generate-seeds.py
jonatack,2021-06-03 11:30:28,done,https://github.com/bitcoin/bitcoin/pull/22050#discussion_r644714379,644714379,contrib/seeds/generate-seeds.py
jonatack,2021-06-03 11:35:33,"Updated\n```diff\n-         * @returns BIP155 network id\n+         * @returns BIP155 network id, except TORV2 which is no longer supported.\n```\n",https://github.com/bitcoin/bitcoin/pull/22050#discussion_r644717392,644717392,src/netaddress.h
jonatack,2021-06-03 11:36:53,done,https://github.com/bitcoin/bitcoin/pull/22050#discussion_r644718135,644718135,src/netaddress.cpp
vasild,2021-06-04 09:31:59,"_(can be ignored)_\n\nThis change in `CNetAddr::SetNetFromBIP155Network()` will now accept and ignore a Tor v2 addresses with bogus length, e.g. 13. whereas we know it should be exactly 10. The comment near the bottom of this function: `// Don't throw on addresses with unknown network ids (maybe from the future).` is somewhat incorrect now.",https://github.com/bitcoin/bitcoin/pull/22050#discussion_r645432156,645432156,src/netaddress.cpp
jonatack,2021-06-19 10:25:54,"Thanks, I'll have a look.",https://github.com/bitcoin/bitcoin/pull/22050#discussion_r654779150,654779150,src/netaddress.cpp
