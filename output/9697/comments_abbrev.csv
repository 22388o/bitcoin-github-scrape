jonasschnelli,2017-02-07T08:12:17Z,"Thanks for the review @ryanofsky. Yes. The current situation with holding cs_main/cs_wallet during the QMessageBox must be avoided. Using `LEAVE_CRITICAL_SECTION` and `ENTER_CRITICAL_SECTION` would be another alternative, but I'd like your idea about splitting bumpFee into a part where we create the tx and a part where we sign and commit.\nThe signing part could potentially be shared with `Create",https://github.com/bitcoin/bitcoin/pull/9697#issuecomment-277929191,277929191,
jonasschnelli,2017-02-14T08:51:01Z,"Rebased on top of #9681.\nFixed the `cs_main` & `cs_wallet` lock problems mentioned by @ryanofsky.",https://github.com/bitcoin/bitcoin/pull/9697#issuecomment-279644561,279644561,
laanwj,2017-03-14T08:12:19Z,Adding milestone for 0.15,https://github.com/bitcoin/bitcoin/pull/9697#issuecomment-286350160,286350160,
jtimon,2017-03-18T19:39:53Z,"utACK individual commits: 8c6316038e8ebb1877d712f29171afc4bb76a159 641c99cb6f96afa166a293917f36f3cf8f28a08a (without fully verifying code movements, but look ok) f0c98b9bfa763fbef87f1d9d37853f28e9451c87\nFast review 65e2e0085a608d9f570bc911349a5953a6ca88ee\nIt seems to me that the history in this PR is unnecessarily complicated and not very clean (and I believe it doesn't compile commit by commi",https://github.com/bitcoin/bitcoin/pull/9697#issuecomment-287569595,287569595,
ryanofsky,2017-03-18T20:31:55Z,"@jtimon, if you are interested in reviewing this PR, the only commit worth looking at is the final one: ""[Qt] simple fee bumper with user verification"" (f7132c3b14cf714f71a2fe59241223fc30520814). The preceding commits which you reviewed were just pulled in from an old version of #9681, and they will disappear after #9681 is merged and this is rebased.\n\nIf you want to review the latest version ",https://github.com/bitcoin/bitcoin/pull/9697#issuecomment-287572727,287572727,
jonasschnelli,2017-04-10T12:07:16Z,"Rebased (since #9681 is now merged) and overhauled.\nThis now also works with encrypted wallets.",https://github.com/bitcoin/bitcoin/pull/9697#issuecomment-292930336,292930336,
flack,2017-04-25T20:47:08Z,"It's kind of hard to see in the confirmation dialog by how much the fee will actually increase. Could you work that somehow into your sentence, or maybe add a table like this:\n\nCurrent fee |  0.00010595\n------ | -------\nincrease |  0.00000960\n**New fee** |  **0.00011555**\n",https://github.com/bitcoin/bitcoin/pull/9697#issuecomment-297159929,297159929,
jonasschnelli,2017-04-26T08:21:36Z,"Implemented @flack's idea.\nNow it looks like:\n\n<img width=""455"" alt=""bildschirmfoto 2017-04-26 um 09 59 11"" src=""https://cloud.githubusercontent.com/assets/178464/25424009/03e651a4-2a67-11e7-849f-017d5ef522c6.png"">\n\n<img width=""332"" alt=""bildschirmfoto 2017-04-26 um 10 20 40"" src=""https://cloud.githubusercontent.com/assets/178464/25424798/0925c462-2a6a-11e7-978d-7b9ec24decb2.png"">\n\n",https://github.com/bitcoin/bitcoin/pull/9697#issuecomment-297286324,297286324,
jtimon,2017-04-26T19:15:32Z,"Perhaps it is too much info for the confirmation form, but what about showing the current feerate and the new feerate as well?",https://github.com/bitcoin/bitcoin/pull/9697#issuecomment-297512960,297512960,
laanwj,2017-05-01T13:29:36Z,@jonasschnelli  that looks good!,https://github.com/bitcoin/bitcoin/pull/9697#issuecomment-298333568,298333568,
laanwj,2017-05-01T14:06:10Z,"I tested this out a bit on testnet; seems to work! one nit. I bumped a single transaction a few times, and it showed it as being sent multiple times:\n![untitled2](https://cloud.githubusercontent.com/assets/126646/25581395/d866a806-2e87-11e7-8bff-9f45f633db35.png)\n\nThis could be scary to users, as it looks like the transaction is sent successfully multiple times, and will possibly be mined mu",https://github.com/bitcoin/bitcoin/pull/9697#issuecomment-298339022,298339022,
jonasschnelli,2017-05-04T07:34:14Z,"What would be the best solution regarding bump conflicts?\n\nAt the moment RPCs `listtransaction` does also list all previous tx in a bump (you can see the `walletconflicts` there).\n\nCompletely hiding the conflicted transactions (only own bump conflicts) would be a solution though I would provide to just ""flagging"" (color or opacity) the conflicts in mempool.\nI once had a PR for that: http",https://github.com/bitcoin/bitcoin/pull/9697#issuecomment-299115652,299115652,
jonasschnelli,2017-05-04T08:27:10Z,"Fixed @laanwj's point.\nAdded a commit that ensures the table model row gets updated correctly after a bump.",https://github.com/bitcoin/bitcoin/pull/9697#issuecomment-299124941,299124941,
jonasschnelli,2017-05-11T07:40:20Z,"Added 3 commits to address @TheBlueMatt findings.\n\n* Make sure to pass `nConfirmTarget` during Qt fee bumps (d9afe0192c9ad83594074661d55a4242f33de462)\n* Re-check the conditions during feebump ""commit"". Because the Qt dialog may stay open for a couple of seconds (or even minutes), we need to re-check the descendants and if the tx has been mined (717495875b995c63e3e4166245e88e8def7f1e47). This",https://github.com/bitcoin/bitcoin/pull/9697#issuecomment-300708721,300708721,
jonasschnelli,2017-05-11T13:27:15Z,Rebased.,https://github.com/bitcoin/bitcoin/pull/9697#issuecomment-300788715,300788715,
paveljanik,2017-05-17T08:56:31Z,"Minor nit: can we gray ""Increase transaction fee"" menu entry when on transaction that was already fee-bumped?\n\nIt has no reason to allow bumping the fee when it already was fee bumped and clicking on the menu entry will show\n\n```\nIncreasing transaction fee failed\n(Cannot bump transaction xyz which was already bumped by transaction abc)\n```\n",https://github.com/bitcoin/bitcoin/pull/9697#issuecomment-302028820,302028820,
paveljanik,2017-05-17T08:59:59Z,"... and now when my tx has been mined, there is no reason to show this menu entry at all (because clicking on it will tell me it is mined already).",https://github.com/bitcoin/bitcoin/pull/9697#issuecomment-302029671,302029671,
laanwj,2017-05-18T08:06:08Z,"utACK a387837\n\nI think this is ready for merging. Sure, it's not perfect yet, but it's usable and can be improved later.\nIt has a reasonable number of ACKs/utACKs and nits have been fixed a few times.\n\nAnyone disagree?",https://github.com/bitcoin/bitcoin/pull/9697#issuecomment-302332000,302332000,
ryanofsky,2017-05-18T09:08:09Z,"utACK a387837. I agree with merging.\n\nChanges since my last review were just rebase on updated master and 3 new commits.",https://github.com/bitcoin/bitcoin/pull/9697#issuecomment-302346533,302346533,
ryanofsky,2017-02-06T21:43:36Z,wtx && SignalsOptInRBF(*wtx),https://github.com/bitcoin/bitcoin/pull/9697#discussion_r99691757,99691757,src/qt/walletmodel.cpp
ryanofsky,2017-02-06T21:52:28Z,"I'm surprised it's ok to be holding onto the cs_main and cs_wallet locks while waiting for user input from a confirmation dialog, since it would seem to grind the whole bitcoin node to a halt. But maybe there are other precedents for doing this.\n\nIf you wanted to avoid it, though, I think you easily could by splitting bumpfee into two functions: one which creates the new transaction, and the o",https://github.com/bitcoin/bitcoin/pull/9697#discussion_r99693542,99693542,src/qt/walletmodel.cpp
ryanofsky,2017-02-24T15:51:56Z,Doesn't look like lock is needed here (GetWalletTx acquires lock internally). ,https://github.com/bitcoin/bitcoin/pull/9697#discussion_r102968464,102968464,src/qt/walletmodel.cpp
ryanofsky,2017-02-24T15:54:03Z,"I'd slightly prefer SignalsOptInRBF(wtx->tx), because the implicit CWalletTx -> CTransaction conversion seems kind of hacky to me.\n\nMaybe also get rid of if statement and just `return wtx && SignalsOptInRBF(wtx->tx)`;",https://github.com/bitcoin/bitcoin/pull/9697#discussion_r102968986,102968986,src/qt/walletmodel.cpp
ryanofsky,2017-02-24T15:57:33Z,Maybe prefer unique_ptr to shared_ptr since pointer isn't being shared.,https://github.com/bitcoin/bitcoin/pull/9697#discussion_r102969834,102969834,src/qt/walletmodel.cpp
ryanofsky,2017-02-24T16:05:29Z,"Are we able to write unit tests to exercise our qt interface code? I don't know very much about qt, but googling around it seems to be possible: http://doc.qt.io/qt-5/qttestlib-tutorial3-example.html\n\nAsking because the logic here isn't totally trivial, and this seems like something we would want automated testing for to ensure it doesn't break in the future, especially if there will be more r",https://github.com/bitcoin/bitcoin/pull/9697#discussion_r102971669,102971669,src/qt/walletmodel.cpp
ryanofsky,2017-02-24T16:18:03Z,"Seems like it would be nice for this code if CFeeBumper constructor, wallet SignTransaction method, and CFeeBumper commit could acquire the locks they need themselves. Not asking for a change, since I don't want to hold up #9697, but curious if there was something that got in the way of doing this.",https://github.com/bitcoin/bitcoin/pull/9697#discussion_r102974487,102974487,src/qt/walletmodel.cpp
ryanofsky,2017-03-09T23:08:34Z,"I started writing unit tests for this change: https://github.com/ryanofsky/bitcoin/commit/9bfbdd88dd0f1e11f06403e81f39fd8df1d047c7\n\nThey are mostly complete, but have a few things I want to fix up. They also required changes to the testing framework which I'm going to split off and make a separate PR.",https://github.com/bitcoin/bitcoin/pull/9697#discussion_r105293825,105293825,src/qt/walletmodel.cpp
jtimon,2017-03-18T19:23:50Z,"The function doesn't seem to return anything and the enum is not used anywhere it seems.\nPerhaps the function could start as void in this code movement and change it afterwards?",https://github.com/bitcoin/bitcoin/pull/9697#discussion_r106788916,106788916,src/wallet/wallet.h
jtimon,2017-03-18T19:29:05Z,"Did the previous commit compile without hash?\nI though we wanted every commit to compile and pass tests (for git bisect but also for general history cleanness).",https://github.com/bitcoin/bitcoin/pull/9697#discussion_r106789031,106789031,src/wallet/wallet.cpp
jtimon,2017-03-18T19:31:37Z,This could be done when making nOldFee a parameter of this function too (ie the function doesn't need to start in his final form).,https://github.com/bitcoin/bitcoin/pull/9697#discussion_r106789092,106789092,src/wallet/wallet.cpp
jtimon,2017-03-18T19:38:09Z,Seems weird and unnecessary to move this to wallet and then move it back here. Perhaps SignTransaction/BumpFeePrepare/BumpFeeCommit should be created before BumpFee (ie BumpFee never being created to just remove it in the same PR) ?,https://github.com/bitcoin/bitcoin/pull/9697#discussion_r106789188,106789188,src/wallet/rpcwallet.cpp
ryanofsky,2017-05-01T13:47:37Z,"In commit ""[Qt] simple fee bumper with user verification""\n\nMaybe get rid of the SEND_CONFIRM_DELAY usage in sendcoinsdialog.cpp now that this is the default. This would make it easier to see that changing the default doesn't actually affect current behavior.",https://github.com/bitcoin/bitcoin/pull/9697#discussion_r114126567,114126567,src/qt/sendcoinsdialog.h
ryanofsky,2017-05-01T15:30:04Z,"Here's an updated version of the tests I wrote previously: https://github.com/ryanofsky/bitcoin/commit/71c0a80fbfe95262be3b81c45474aceaccddfad3\n\nFeel free to cherry-pick or I can submit as a separate PR.",https://github.com/bitcoin/bitcoin/pull/9697#discussion_r114140663,114140663,src/qt/walletmodel.cpp
jonasschnelli,2017-05-04T07:53:23Z,"@ryanofsky: because setting `QWidget *parent = 0` is required, that would either result in swapping `QWidget *parent = 0` with `int secDelay = SEND_CONFIRM_DELAY` or passing `SEND_CONFIRM_DELAY` in `sendcoinsdialog.cpp` (as it is by now), right?\nThe current situation seems to be okay to me.\nOr do I misunderstand something?",https://github.com/bitcoin/bitcoin/pull/9697#discussion_r114716024,114716024,src/qt/sendcoinsdialog.h
ryanofsky,2017-05-04T15:46:47Z,"> Or do I misunderstand something?\n\nNo you're right. I didn't see sendcoinsdialog is also passing a this argument, so there is no way to use the default delay argument.",https://github.com/bitcoin/bitcoin/pull/9697#discussion_r114816793,114816793,src/qt/sendcoinsdialog.h
ryanofsky,2017-05-04T15:53:37Z,"In commit ""Make sure we always update the table row after a bumpfee call""\n\nI was surprised that passing false for the `updateTransaction` `showTransaction` parameter doesn't hide the transaction, though it's good that it doesn't. Do you think this parameter should be removed (separately, not part of this change)? I'm not seeing what it does other than set a temporary state that gets immediatel",https://github.com/bitcoin/bitcoin/pull/9697#discussion_r114818531,114818531,src/qt/transactionview.cpp
jonasschnelli,2017-05-04T19:57:04Z,"Heh. Yes. This is really surprising and yes, I think we should remove it (in a clean follow up PR).",https://github.com/bitcoin/bitcoin/pull/9697#discussion_r114872872,114872872,src/qt/transactionview.cpp
TheBlueMatt,2017-05-09T18:39:50Z,Why not just get rid of the argument entirely? I dont see any callers of the constructor using a non-default value?,https://github.com/bitcoin/bitcoin/pull/9697#discussion_r115568518,115568518,src/qt/sendcoinsdialog.h
TheBlueMatt,2017-05-09T18:45:01Z,"Should probably check that it is also unconfirmed, no? And, if you do keep the cs_main lock, maybe the in-mempool deps check that the CFeeBumper does.",https://github.com/bitcoin/bitcoin/pull/9697#discussion_r115569899,115569899,src/qt/walletmodel.cpp
TheBlueMatt,2017-05-09T18:51:27Z,"I'm confused...looks like this will either use the payTxFee per-wallet global or fall back to fallbackFee (as we call into GetMinimumFee with nConfirmTarget set to 0, which will fail the estimateSmartFee). This will likely normally result in the user always just bumping by walletIncrementalRelayFee, which seems like a strange choice. Was this intentional, or are you just planning on following up w",https://github.com/bitcoin/bitcoin/pull/9697#discussion_r115571471,115571471,src/qt/walletmodel.cpp
TheBlueMatt,2017-05-09T19:05:06Z,"I believe this is the first use of CFeeBumper without holding cs_wallet through the object's entire lifetime, so more thourough review of that is merited. I read through it and /think/ its OK, but it would probably be good to duplicate a few of the checks in the CFeeBumper constructor in commit, specifically the HasWalletSpend/mempool descendant count, wtx.mapValue.count(""replaced_by_txid""), and G",https://github.com/bitcoin/bitcoin/pull/9697#discussion_r115574972,115574972,src/qt/walletmodel.cpp
jonasschnelli,2017-05-11T07:15:31Z,Oh. Right. Here it misses `nTxConfirmTarget`. Will fix.,https://github.com/bitcoin/bitcoin/pull/9697#discussion_r115918784,115918784,src/qt/walletmodel.cpp
paveljanik,2017-05-17T08:50:10Z,"typo ""hasen't""",https://github.com/bitcoin/bitcoin/pull/9697#discussion_r116944045,116944045,src/wallet/feebumper.cpp
