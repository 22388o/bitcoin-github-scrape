[
  {
    "sha": "f692fce8a49e05e25f1c767aae1e50db419caebe",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmNjkyZmNlOGE0OWUwNWUyNWYxYzc2N2FhZTFlNTBkYjQxOWNhZWJl",
    "commit": {
      "author": {
        "name": "Gregory Maxwell",
        "email": "greg@xiph.org",
        "date": "2016-12-06T06:39:14Z"
      },
      "committer": {
        "name": "Gregory Maxwell",
        "email": "greg@xiph.org",
        "date": "2016-12-06T08:01:27Z"
      },
      "message": "Make RelayWalletTransaction attempt to AcceptToMemoryPool.\n\nThis resolves an issue where a wallet transaction which failed to\n relay previously because it couldn't make it into the mempool\n will not try again until restart, even though mempool conditions\n may have changed.\n\nAbandoned and known-conflicted transactions are skipped.\n\nSome concern was expressed that there may be users with many\n unknown conflicts would waste a lot of CPU time trying to\n add them to their memory pools over and over again.  But I am\n doubtful these users exist in any number, if they do exist\n they have worse problems, and they can mitigate any performance\n issue this might have by abandoning the transactions in question.",
      "tree": {
        "sha": "00b64f620bd85a2f47c98eea22a4487748d682be",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/00b64f620bd85a2f47c98eea22a4487748d682be"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f692fce8a49e05e25f1c767aae1e50db419caebe",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f692fce8a49e05e25f1c767aae1e50db419caebe",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/f692fce8a49e05e25f1c767aae1e50db419caebe",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f692fce8a49e05e25f1c767aae1e50db419caebe/comments",
    "author": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "7d5d44969b4ab46a5146a46b4ed1ed7704d71c63",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7d5d44969b4ab46a5146a46b4ed1ed7704d71c63",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/7d5d44969b4ab46a5146a46b4ed1ed7704d71c63"
      }
    ],
    "stats": {
      "total": 6,
      "additions": 4,
      "deletions": 2
    },
    "files": [
      {
        "sha": "43ffb7145792d04f09d794373352085062c05db2",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 2,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f692fce8a49e05e25f1c767aae1e50db419caebe/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f692fce8a49e05e25f1c767aae1e50db419caebe/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=f692fce8a49e05e25f1c767aae1e50db419caebe",
        "patch": "@@ -1542,9 +1542,11 @@ void CWallet::ReacceptWalletTransactions()\n bool CWalletTx::RelayWalletTransaction(CConnman* connman)\n {\n     assert(pwallet->GetBroadcastTransactions());\n-    if (!IsCoinBase())\n+    if (!IsCoinBase() && !isAbandoned() && GetDepthInMainChain() == 0)\n     {\n-        if (GetDepthInMainChain() == 0 && !isAbandoned() && InMempool()) {\n+        CValidationState state;\n+        /* GetDepthInMainChain already catches known conflicts. */\n+        if (InMempool() || AcceptToMemoryPool(maxTxFee, state)) {\n             LogPrintf(\"Relaying wtx %s\\n\", GetHash().ToString());\n             if (connman) {\n                 CInv inv(MSG_TX, GetHash());"
      }
    ]
  }
]