promag,2019-02-07T14:38:15Z,"@sdaftuar regarding #15305, if you cherry pick commit to your branch you'll see the test runs in a couple of seconds.\n\nAlso, with the following patch:\n```diff\n--- a/src/httpserver.cpp\n+++ b/src/httpserver.cpp\n@@ -465,6 +465,7 @@ void StopHTTPServer()\n     boundSockets.clear();\n     if (eventBase) {\n         LogPrint(BCLog::HTTP, ""Waiting for HTTP event thread to exit\n"");\n+    ",https://github.com/bitcoin/bitcoin/pull/15363#issuecomment-461445810,461445810,
promag,2019-02-07T14:47:03Z,Improves #15309.,https://github.com/bitcoin/bitcoin/pull/15363#issuecomment-461449782,461449782,
promag,2019-02-07T15:24:51Z,"#15350 was merged, updated OP.",https://github.com/bitcoin/bitcoin/pull/15363#issuecomment-461467661,461467661,
laanwj,2019-02-08T12:54:10Z,"We just can't keep ""fixing"" this, can we?\n",https://github.com/bitcoin/bitcoin/pull/15363#issuecomment-461793829,461793829,
promag,2019-02-08T13:20:45Z,"This is a different issue, idle connections are stalling shutdown. We could decrease the timeout duration but I don't think that's a fix.\n\nThis is incomplete.",https://github.com/bitcoin/bitcoin/pull/15363#issuecomment-461800411,461800411,
ryanofsky,2019-02-08T19:40:18Z,"> We just can't keep ""fixing"" this, can we?\n\nThe libevent HTTP interface is kind of crazy, so I don't think it's surprising that fixing this requires some trial and error. But it would be good to have tests for each issue that gets fixed to avoid going in circles.\n\nIf it would be possible to specify what should happen on shutdown for connections in different states (close headers? truncate",https://github.com/bitcoin/bitcoin/pull/15363#issuecomment-461921981,461921981,
promag,2019-02-08T19:51:37Z,"@ryanofsky agree, and test/functional/feature_shutdown.py was added with that in mind. I'll add test for this change.\n\nBTW, I think the case introduced by @sdaftuar in #15305 is new because the shutdown isn't triggered by `stop` command.",https://github.com/bitcoin/bitcoin/pull/15363#issuecomment-461925679,461925679,
MarcoFalke,2019-02-18T15:53:24Z,Not sure if we should pull this into 0.18 at this point. Removing for now,https://github.com/bitcoin/bitcoin/pull/15363#issuecomment-464785726,464785726,
promag,2019-02-18T16:21:16Z,@MarcoFalke sure I agree. The issue is on shutdown so it shouldn't bother too much to wait for connections to timeout - beside our functional tests. ,https://github.com/bitcoin/bitcoin/pull/15363#issuecomment-464796725,464796725,
MarcoFalke,2019-07-29T18:13:37Z,"What is the status of this?\n\nIt has nothing to do with #16405, right?",https://github.com/bitcoin/bitcoin/pull/15363#issuecomment-516103306,516103306,
promag,2019-07-31T18:31:38Z,"> It has nothing to do with #16405, right?\n\n@MarcoFalke ~~no~~ I mean right. Now that #15305 is merged, I'll pick this again.\n",https://github.com/bitcoin/bitcoin/pull/15363#issuecomment-516967610,516967610,
promag,2019-08-02T17:35:12Z,"Currently in master 3a3d8b835\n```\ntest/functional/feature_abortnode.py --nocleanup\n\n2019-08-02T17:31:41.878000Z TestFramework (INFO): Initializing test directory /var/folders/dc/zhlby57d0vb9yrw5chl5wx6h0000gn/T/bitcoin_func_test_prjmeyz1\n2019-08-02T17:31:42.898000Z TestFramework (INFO): Waiting for crash\n2019-08-02T17:32:13.050000Z TestFramework (INFO): Node crashed - now verifying res",https://github.com/bitcoin/bitcoin/pull/15363#issuecomment-517785434,517785434,
Sjors,2019-08-14T13:33:17Z,"When I run the functional test suite on a RAM disk it's bottlenecked by the slowest running tests. I looked at some of those tests and saw they were stuck on `Waiting for HTTP event thread to exit`. This also happens without `--use-cli`, e.g. for `wallet_multiwallet.py`.\n\nCherry-picking this commit speeds up `wallet_multiwallet.py --usecli` from 60-120s to 40s on my machine.",https://github.com/bitcoin/bitcoin/pull/15363#issuecomment-521247444,521247444,
DrahtBot,2020-05-18T20:29:23Z,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19420 (http: Track active requests and wait for last to finish by promag)\n\nIf you consider this pull request important,",https://github.com/bitcoin/bitcoin/pull/15363#issuecomment-630418674,630418674,
promag,2020-06-30T10:45:13Z,"Now `test/functional/feature_abortnode.py` runs pretty quick, it doesn't have to wait for timeouts.",https://github.com/bitcoin/bitcoin/pull/15363#issuecomment-651715560,651715560,
promag,2020-07-01T11:13:43Z,For now closing in favor of #19420.,https://github.com/bitcoin/bitcoin/pull/15363#issuecomment-652356717,652356717,
