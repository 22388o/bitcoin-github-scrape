[
  {
    "sha": "d54874d795a523d7cad5f4a9f4270145e56238f8",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpkNTQ4NzRkNzk1YTUyM2Q3Y2FkNWY0YTlmNDI3MDE0NWU1NjIzOGY4",
    "commit": {
      "author": {
        "name": "Evan Klitzke",
        "email": "evan@eklitzke.org",
        "date": "2018-03-06T17:50:20Z"
      },
      "committer": {
        "name": "Evan Klitzke",
        "email": "evan@eklitzke.org",
        "date": "2018-03-26T22:59:41Z"
      },
      "message": "Set SCHED_BATCH priority on the loadblk thread.\n\nWhile reading another PR I saw a mention of #6358. The use case for\nSCHED_BATCH is to hint to the kernel that the thread is running a\nnon-interactive workload that consumes a lot of CPU time. This is\nhelpful on desktop machines where the loadblk thread can interfere with\ninteractive applications. More details can be found in the sched(7) man\npage.",
      "tree": {
        "sha": "f39d91af0b1506f87c94c75aebf8e901530c70bc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f39d91af0b1506f87c94c75aebf8e901530c70bc"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d54874d795a523d7cad5f4a9f4270145e56238f8",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEr5FzGLjELREnIWJdFX78rLxkhCIFAlq5e2EACgkQFX78rLxk\nhCJJ8w//X3kOnPmbhs5zouPAljyX2nAMC9ZMQuVS38mvO/uhMazCYFE/pkZ9uzuU\ngFQ+zwKBLOXzWjcs+QdOD9eqBpg2Uy/+5/g5uEmbDU56KVqXIR24Cu+H/Sx+hg3R\ntCdQ5rg/yiDwsth6TkJymZFVsepTRFDRi+5Yrz3J7gS8s1QgzAyjoOi2PK4IxuH4\nbxdrWB6BtejXsomgHHGPpqsWajdtdtfyTxEhvYOIJbYbLOEQHFq9vmQzkzVdNSbU\nVESGMXRoqP9EoOhPNDyLliwu48LnXhfa/BkVJCdRSlxRE5BBpD4lMq9MEIAbvuXF\nTbIyE7txMXRV8oN0wqkKZq2JaHuWRYWjM3ornJg6vOAI1DeL+xilFYAnw2uLou4s\nz5QPWBfYOiqhR1ISV7xnMxpBszf+ZIUQgF8wqgBD9r+7F0JuHPEGAL0C9NQCqJwg\nwLGl8Q1lTeHMevgzv7v9z8D94hW8JCeIkmk4lDRpQXBmfqNVALxUN/wer+PUw3ii\nT8HMA3ymxnkHwDKMJF/XLadZAzSN9qPXlK6Hto0AMBk7XrAQKowpHNpH4UbBh/k+\nZp5VU9eshrbmJYY7jxLYRrKCYQoh8qAbBBqbToWk6U3scDI22mabqk6Zn2xDBRrB\nlq9HhIhfEMO2O0c/TW2YEGtIpswVX2WrOCh+x8d0dXR1h1B1WnY=\n=Ot4W\n-----END PGP SIGNATURE-----",
        "payload": "tree f39d91af0b1506f87c94c75aebf8e901530c70bc\nparent 0a018431c447bbf18bdaa6a1037aad6a87c1294a\nauthor Evan Klitzke <evan@eklitzke.org> 1520358620 -0500\ncommitter Evan Klitzke <evan@eklitzke.org> 1522105181 -0700\n\nSet SCHED_BATCH priority on the loadblk thread.\n\nWhile reading another PR I saw a mention of #6358. The use case for\nSCHED_BATCH is to hint to the kernel that the thread is running a\nnon-interactive workload that consumes a lot of CPU time. This is\nhelpful on desktop machines where the loadblk thread can interfere with\ninteractive applications. More details can be found in the sched(7) man\npage.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d54874d795a523d7cad5f4a9f4270145e56238f8",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/d54874d795a523d7cad5f4a9f4270145e56238f8",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d54874d795a523d7cad5f4a9f4270145e56238f8/comments",
    "author": {
      "login": "eklitzke",
      "id": 2734,
      "node_id": "MDQ6VXNlcjI3MzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2734?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eklitzke",
      "html_url": "https://github.com/eklitzke",
      "followers_url": "https://api.github.com/users/eklitzke/followers",
      "following_url": "https://api.github.com/users/eklitzke/following{/other_user}",
      "gists_url": "https://api.github.com/users/eklitzke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eklitzke/subscriptions",
      "organizations_url": "https://api.github.com/users/eklitzke/orgs",
      "repos_url": "https://api.github.com/users/eklitzke/repos",
      "events_url": "https://api.github.com/users/eklitzke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eklitzke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "eklitzke",
      "id": 2734,
      "node_id": "MDQ6VXNlcjI3MzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2734?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eklitzke",
      "html_url": "https://github.com/eklitzke",
      "followers_url": "https://api.github.com/users/eklitzke/followers",
      "following_url": "https://api.github.com/users/eklitzke/following{/other_user}",
      "gists_url": "https://api.github.com/users/eklitzke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eklitzke/subscriptions",
      "organizations_url": "https://api.github.com/users/eklitzke/orgs",
      "repos_url": "https://api.github.com/users/eklitzke/repos",
      "events_url": "https://api.github.com/users/eklitzke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eklitzke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "0a018431c447bbf18bdaa6a1037aad6a87c1294a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0a018431c447bbf18bdaa6a1037aad6a87c1294a",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/0a018431c447bbf18bdaa6a1037aad6a87c1294a"
      }
    ],
    "stats": {
      "total": 25,
      "additions": 25,
      "deletions": 0
    },
    "files": [
      {
        "sha": "62767edbf84714bc41ebb70d108b25f8ded1873f",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d54874d795a523d7cad5f4a9f4270145e56238f8/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d54874d795a523d7cad5f4a9f4270145e56238f8/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=d54874d795a523d7cad5f4a9f4270145e56238f8",
        "patch": "@@ -625,6 +625,7 @@ void ThreadImport(std::vector<fs::path> vImportFiles)\n {\n     const CChainParams& chainparams = Params();\n     RenameThread(\"bitcoin-loadblk\");\n+    ScheduleBatchPriority();\n \n     {\n     CImportingNow imp;"
      },
      {
        "sha": "842d4f6e1982ebca121c5adfde971156cbd53c0b",
        "filename": "src/util.cpp",
        "status": "modified",
        "additions": 15,
        "deletions": 0,
        "changes": 15,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d54874d795a523d7cad5f4a9f4270145e56238f8/src/util.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d54874d795a523d7cad5f4a9f4270145e56238f8/src/util.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/util.cpp?ref=d54874d795a523d7cad5f4a9f4270145e56238f8",
        "patch": "@@ -31,6 +31,7 @@\n \n #include <algorithm>\n #include <fcntl.h>\n+#include <sched.h>\n #include <sys/resource.h>\n #include <sys/stat.h>\n \n@@ -966,3 +967,17 @@ fs::path AbsPathForConfigVal(const fs::path& path, bool net_specific)\n {\n     return fs::absolute(path, GetDataDir(net_specific));\n }\n+\n+int ScheduleBatchPriority(void)\n+{\n+#ifdef SCHED_BATCH\n+    const static sched_param param{.sched_priority = 0};\n+    if (int ret = pthread_setschedparam(0, SCHED_BATCH, &param)) {\n+        LogPrintf(\"Failed to pthread_setschedparam: %s\\n\", strerror(errno));\n+        return ret;\n+    }\n+    return 0;\n+#else\n+    return 1;\n+#endif\n+}"
      },
      {
        "sha": "a9f64a0566dfcb5ef906783d8c35b1c2a759cfa0",
        "filename": "src/util.h",
        "status": "modified",
        "additions": 9,
        "deletions": 0,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d54874d795a523d7cad5f4a9f4270145e56238f8/src/util.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d54874d795a523d7cad5f4a9f4270145e56238f8/src/util.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/util.h?ref=d54874d795a523d7cad5f4a9f4270145e56238f8",
        "patch": "@@ -357,4 +357,13 @@ std::unique_ptr<T> MakeUnique(Args&&... args)\n     return std::unique_ptr<T>(new T(std::forward<Args>(args)...));\n }\n \n+/**\n+ * On platforms that support it, tell the kernel the calling thread is\n+ * CPU-intensive and non-interactive. See SCHED_BATCH in sched(7) for details.\n+ *\n+ * @return The return value of sched_setschedule(), or 1 on systems without\n+ * sched_setchedule().\n+ */\n+int ScheduleBatchPriority(void);\n+\n #endif // BITCOIN_UTIL_H"
      }
    ]
  }
]