laanwj,2019-01-18T07:34:57Z,"Concept ACK, it is good to reject an invalid message as soon as possible.\n\nI think this is correct\n- `CNetMessage::readHeader` for every message called before `::ProcessMessages`\n- `CMessageHeader::IsValid` does the following checks, which includes checking the message size\n  - Check message start\n  - Check command string for errors\n  - Check message size\n",https://github.com/bitcoin/bitcoin/pull/15197#issuecomment-455453699,455453699,
laanwj,2019-01-21T16:35:55Z,utACK c749b1347ed1101c2b41211bbbf9dff501bd5927,https://github.com/bitcoin/bitcoin/pull/15197#issuecomment-456133150,456133150,
naumenkogs,2019-01-21T19:46:51Z,"utACK c749b13\n\nPerhaps also replace *24* with ```HEADER_SIZE``` here? (twice)\nhttps://github.com/bitcoin/bitcoin/blob/c749b1347ed1101c2b41211bbbf9dff501bd5927/src/net.cpp#L820",https://github.com/bitcoin/bitcoin/pull/15197#issuecomment-456181865,456181865,
jonasschnelli,2019-01-24T19:32:16Z,"> Perhaps also replace 24 with HEADER_SIZE here? (twice)\n\nIt should be replaced but its irrelevant for this PR and not within the scope of it (will do later).",https://github.com/bitcoin/bitcoin/pull/15197#issuecomment-457326728,457326728,
laanwj,2019-01-31T13:50:15Z,"p2p_invalid_messages is failing locally on this, probably due to something else merged in the meantime?\n```\n$ test/functional/test_runner.py p2p_invalid_messages.py\nTemporary test directory at /tmp/test_runner_‚Çø_üèÉ_20190131_144734\n1/1 - p2p_invalid_messages.py failed, Duration: 1 s\n\nstdout:\n2019-01-31T13:47:34.927000Z TestFramework (INFO): Initializing test directory /tmp/test_runner_",https://github.com/bitcoin/bitcoin/pull/15197#issuecomment-459350547,459350547,
MarcoFalke,2019-01-31T15:42:44Z,Needs rebase,https://github.com/bitcoin/bitcoin/pull/15197#issuecomment-459391752,459391752,
jonasschnelli,2019-01-31T19:35:00Z,Re-added the invalid header log (slightly changed log message) and fixed the new tests.,https://github.com/bitcoin/bitcoin/pull/15197#issuecomment-459476487,459476487,
DrahtBot,2019-03-11T18:59:50Z,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #18764 (refactor: test: replace inv type magic numbers by constants by theStack)\n* #17785 (p2p: Unify Send and Receive pr",https://github.com/bitcoin/bitcoin/pull/15197#issuecomment-471676350,471676350,
jonasschnelli,2019-04-24T12:44:22Z,Rebased.,https://github.com/bitcoin/bitcoin/pull/15197#issuecomment-486212073,486212073,
practicalswift,2019-04-24T13:43:39Z,Concept ACK,https://github.com/bitcoin/bitcoin/pull/15197#issuecomment-486235476,486235476,
dongcarl,2020-01-22T19:47:33Z,Rebased this PR for you: https://github.com/bitcoin/bitcoin/compare/master...dongcarl:2020-01-netmsg_1-rebased,https://github.com/bitcoin/bitcoin/pull/15197#issuecomment-577354872,577354872,
jonasschnelli,2020-05-07T07:35:26Z,Rebased (used @dongcarl's rebase).,https://github.com/bitcoin/bitcoin/pull/15197#issuecomment-625084368,625084368,
DrahtBot,2020-05-20T19:33:09Z,<!--cf906140f33d8803c4a75a2196329ecb-->\nüêô This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).,https://github.com/bitcoin/bitcoin/pull/15197#issuecomment-631680838,631680838,
jnewbery,2020-09-29T10:39:54Z,"This is obsoleted by #19107\n\n@jonasschnelli - if you think that there's anything in here that isn't addressed by 19107, feel free to reopen or open another PR.",https://github.com/bitcoin/bitcoin/pull/15197#issuecomment-700619462,700619462,
laanwj,2019-01-18T07:24:24Z,"nit: I think ""reject"" was a better wording than ""exit""\nAlso please add braces now that this code is touched anyway.\n```\nif (!hdr.IsValid(Params().MessageStart())) {\n    ...\n}\n```",https://github.com/bitcoin/bitcoin/pull/15197#discussion_r248946940,248946940,src/net.cpp
laanwj,2019-01-18T07:24:46Z,nit: `{` on same line as if,https://github.com/bitcoin/bitcoin/pull/15197#discussion_r248946998,248946998,src/protocol.cpp
MarcoFalke,2019-01-31T15:41:48Z,Previously this wouldn't log and now this logs. This is a minor change in behaviour and opens the possibility to fill in the (currently empty) string in `assert_debug_log` in the invalid message functional test.,https://github.com/bitcoin/bitcoin/pull/15197#discussion_r252719065,252719065,src/net.cpp
MarcoFalke,2019-01-31T19:42:55Z,"There is already logging in\n\n```\nLogPrintf(""CMessageHeader::IsValid(): (%s, %u bytes) nMessageSize > MAX_SIZE\n```\n\nI have no opinion on where to do it, but it should suffice to log only one line instead of two for a single error.",https://github.com/bitcoin/bitcoin/pull/15197#discussion_r252812623,252812623,src/net.cpp
jonasschnelli,2019-01-31T20:08:32Z,"Without the log entry in L670, we would only log the invalid message size (**not** invalid magic check and invalid command strings).\nWe could drop the invalid message size but I think this is one we should keep since it smells after DoS/dishonest peers.\n\nAfter this PR, you will get two log entries in case of an message size larger then `MAX_SIZE`.\n1. `LogPrintf(""CMessageHeader::IsValid(): ",https://github.com/bitcoin/bitcoin/pull/15197#discussion_r252821609,252821609,src/net.cpp
jonatack,2020-05-10T10:44:28Z,"Is the msg command and peer id information in the above two `NET` log error messages useful, worth keeping?",https://github.com/bitcoin/bitcoin/pull/15197#discussion_r422625833,422625833,src/net_processing.cpp
