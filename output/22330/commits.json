[
  {
    "sha": "84c874794cc1e1aa48f2edf08c355ec2a5696cb6",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4NGM4NzQ3OTRjYzFlMWFhNDhmMmVkZjA4YzM1NWVjMmE1Njk2Y2I2",
    "commit": {
      "author": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2021-06-23T14:54:39Z"
      },
      "committer": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2021-07-15T19:15:26Z"
      },
      "message": "test: remove unneeded initialization code in feature_rbf.py",
      "tree": {
        "sha": "6a69ed86ef3846afd7a7b84cd1313171c3d1a781",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6a69ed86ef3846afd7a7b84cd1313171c3d1a781"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/84c874794cc1e1aa48f2edf08c355ec2a5696cb6",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/84c874794cc1e1aa48f2edf08c355ec2a5696cb6",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/84c874794cc1e1aa48f2edf08c355ec2a5696cb6",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/84c874794cc1e1aa48f2edf08c355ec2a5696cb6/comments",
    "author": {
      "login": "theStack",
      "id": 91535,
      "node_id": "MDQ6VXNlcjkxNTM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theStack",
      "html_url": "https://github.com/theStack",
      "followers_url": "https://api.github.com/users/theStack/followers",
      "following_url": "https://api.github.com/users/theStack/following{/other_user}",
      "gists_url": "https://api.github.com/users/theStack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theStack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
      "organizations_url": "https://api.github.com/users/theStack/orgs",
      "repos_url": "https://api.github.com/users/theStack/repos",
      "events_url": "https://api.github.com/users/theStack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theStack/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "theStack",
      "id": 91535,
      "node_id": "MDQ6VXNlcjkxNTM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theStack",
      "html_url": "https://github.com/theStack",
      "followers_url": "https://api.github.com/users/theStack/followers",
      "following_url": "https://api.github.com/users/theStack/following{/other_user}",
      "gists_url": "https://api.github.com/users/theStack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theStack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
      "organizations_url": "https://api.github.com/users/theStack/orgs",
      "repos_url": "https://api.github.com/users/theStack/repos",
      "events_url": "https://api.github.com/users/theStack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theStack/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "a88fa1a555195af6543cdc802e8e1c2e1668dd38",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a88fa1a555195af6543cdc802e8e1c2e1668dd38",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/a88fa1a555195af6543cdc802e8e1c2e1668dd38"
      }
    ],
    "stats": {
      "total": 5,
      "additions": 0,
      "deletions": 5
    },
    "files": [
      {
        "sha": "dc6ebcb227315c47df16ef7e3fcefb1508938aab",
        "filename": "test/functional/feature_rbf.py",
        "status": "modified",
        "additions": 0,
        "deletions": 5,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/84c874794cc1e1aa48f2edf08c355ec2a5696cb6/test/functional/feature_rbf.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/84c874794cc1e1aa48f2edf08c355ec2a5696cb6/test/functional/feature_rbf.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/feature_rbf.py?ref=84c874794cc1e1aa48f2edf08c355ec2a5696cb6",
        "patch": "@@ -84,11 +84,6 @@ def skip_test_if_missing_module(self):\n         self.skip_if_no_wallet()\n \n     def run_test(self):\n-        make_utxo(self.nodes[0], 1 * COIN)\n-\n-        # Ensure nodes are synced\n-        self.sync_all()\n-\n         self.log.info(\"Running test simple doublespend...\")\n         self.test_simple_doublespend()\n "
      }
    ]
  },
  {
    "sha": "a3f6397c7390ca033311f2219094ac90f6e582f9",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzphM2Y2Mzk3YzczOTBjYTAzMzMxMWYyMjE5MDk0YWM5MGY2ZTU4MmY5",
    "commit": {
      "author": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2021-06-23T15:05:44Z"
      },
      "committer": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2021-07-27T21:09:48Z"
      },
      "message": "test: feature_rbf.py: make MiniWallet instance available for all sub-tests\n\nalso document on why we start scanning blocks at height 76",
      "tree": {
        "sha": "f77e3b2e3c86b32f0c7164cfbb2002d53a668497",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f77e3b2e3c86b32f0c7164cfbb2002d53a668497"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a3f6397c7390ca033311f2219094ac90f6e582f9",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a3f6397c7390ca033311f2219094ac90f6e582f9",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/a3f6397c7390ca033311f2219094ac90f6e582f9",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a3f6397c7390ca033311f2219094ac90f6e582f9/comments",
    "author": {
      "login": "theStack",
      "id": 91535,
      "node_id": "MDQ6VXNlcjkxNTM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theStack",
      "html_url": "https://github.com/theStack",
      "followers_url": "https://api.github.com/users/theStack/followers",
      "following_url": "https://api.github.com/users/theStack/following{/other_user}",
      "gists_url": "https://api.github.com/users/theStack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theStack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
      "organizations_url": "https://api.github.com/users/theStack/orgs",
      "repos_url": "https://api.github.com/users/theStack/repos",
      "events_url": "https://api.github.com/users/theStack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theStack/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "theStack",
      "id": 91535,
      "node_id": "MDQ6VXNlcjkxNTM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theStack",
      "html_url": "https://github.com/theStack",
      "followers_url": "https://api.github.com/users/theStack/followers",
      "following_url": "https://api.github.com/users/theStack/following{/other_user}",
      "gists_url": "https://api.github.com/users/theStack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theStack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
      "organizations_url": "https://api.github.com/users/theStack/orgs",
      "repos_url": "https://api.github.com/users/theStack/repos",
      "events_url": "https://api.github.com/users/theStack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theStack/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "84c874794cc1e1aa48f2edf08c355ec2a5696cb6",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/84c874794cc1e1aa48f2edf08c355ec2a5696cb6",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/84c874794cc1e1aa48f2edf08c355ec2a5696cb6"
      }
    ],
    "stats": {
      "total": 24,
      "additions": 13,
      "deletions": 11
    },
    "files": [
      {
        "sha": "2db11b26f09ffd1d6a4bbb1749d02f3406f4e77e",
        "filename": "test/functional/feature_rbf.py",
        "status": "modified",
        "additions": 13,
        "deletions": 11,
        "changes": 24,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/a3f6397c7390ca033311f2219094ac90f6e582f9/test/functional/feature_rbf.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/a3f6397c7390ca033311f2219094ac90f6e582f9/test/functional/feature_rbf.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/feature_rbf.py?ref=a3f6397c7390ca033311f2219094ac90f6e582f9",
        "patch": "@@ -84,6 +84,12 @@ def skip_test_if_missing_module(self):\n         self.skip_if_no_wallet()\n \n     def run_test(self):\n+        self.wallet = MiniWallet(self.nodes[0])\n+        # the pre-mined test framework chain contains coinbase outputs to the\n+        # MiniWallet's default address ADDRESS_BCRT1_P2WSH_OP_TRUE in blocks\n+        # 76-100 (see method BitcoinTestFramework._initialize_chain())\n+        self.wallet.scan_blocks(start=76, num=1)\n+\n         self.log.info(\"Running test simple doublespend...\")\n         self.test_simple_doublespend()\n \n@@ -569,20 +575,18 @@ def test_rpc(self):\n         assert_equal(json1[\"vin\"][0][\"sequence\"], 4294967294)\n \n     def test_no_inherited_signaling(self):\n-        wallet = MiniWallet(self.nodes[0])\n-        wallet.scan_blocks(start=76, num=1)\n-        confirmed_utxo = wallet.get_utxo()\n+        confirmed_utxo = self.wallet.get_utxo()\n \n         # Create an explicitly opt-in parent transaction\n-        optin_parent_tx = wallet.send_self_transfer(\n+        optin_parent_tx = self.wallet.send_self_transfer(\n             from_node=self.nodes[0],\n             utxo_to_spend=confirmed_utxo,\n             sequence=BIP125_SEQUENCE_NUMBER,\n             fee_rate=Decimal('0.01'),\n         )\n         assert_equal(True, self.nodes[0].getmempoolentry(optin_parent_tx['txid'])['bip125-replaceable'])\n \n-        replacement_parent_tx = wallet.create_self_transfer(\n+        replacement_parent_tx = self.wallet.create_self_transfer(\n             from_node=self.nodes[0],\n             utxo_to_spend=confirmed_utxo,\n             sequence=BIP125_SEQUENCE_NUMBER,\n@@ -596,8 +600,8 @@ def test_no_inherited_signaling(self):\n         assert_equal(res['allowed'], True)\n \n         # Create an opt-out child tx spending the opt-in parent\n-        parent_utxo = wallet.get_utxo(txid=optin_parent_tx['txid'])\n-        optout_child_tx = wallet.send_self_transfer(\n+        parent_utxo = self.wallet.get_utxo(txid=optin_parent_tx['txid'])\n+        optout_child_tx = self.wallet.send_self_transfer(\n             from_node=self.nodes[0],\n             utxo_to_spend=parent_utxo,\n             sequence=0xffffffff,\n@@ -607,7 +611,7 @@ def test_no_inherited_signaling(self):\n         # Reports true due to inheritance\n         assert_equal(True, self.nodes[0].getmempoolentry(optout_child_tx['txid'])['bip125-replaceable'])\n \n-        replacement_child_tx = wallet.create_self_transfer(\n+        replacement_child_tx = self.wallet.create_self_transfer(\n             from_node=self.nodes[0],\n             utxo_to_spend=parent_utxo,\n             sequence=0xffffffff,\n@@ -626,9 +630,7 @@ def test_no_inherited_signaling(self):\n         assert_raises_rpc_error(-26, 'txn-mempool-conflict', self.nodes[0].sendrawtransaction, replacement_child_tx[\"hex\"], 0)\n \n     def test_replacement_relay_fee(self):\n-        wallet = MiniWallet(self.nodes[0])\n-        wallet.scan_blocks(start=77, num=1)\n-        tx = wallet.send_self_transfer(from_node=self.nodes[0])['tx']\n+        tx = self.wallet.send_self_transfer(from_node=self.nodes[0])['tx']\n \n         # Higher fee, higher feerate, different txid, but the replacement does not provide a relay\n         # fee conforming to node's `incrementalrelayfee` policy of 1000 sat per KB."
      }
    ]
  },
  {
    "sha": "aa02c64540cd77199c2834549786b9bc91fd4bc9",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzphYTAyYzY0NTQwY2Q3NzE5OWMyODM0NTQ5Nzg2YjliYzkxZmQ0YmM5",
    "commit": {
      "author": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2021-06-23T15:38:14Z"
      },
      "committer": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2021-07-28T16:15:53Z"
      },
      "message": "test: use MiniWallet for simple doublespend test in feature_rbf.py",
      "tree": {
        "sha": "cccf9131625f385dd15c74b259cd8480984ce730",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/cccf9131625f385dd15c74b259cd8480984ce730"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/aa02c64540cd77199c2834549786b9bc91fd4bc9",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/aa02c64540cd77199c2834549786b9bc91fd4bc9",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/aa02c64540cd77199c2834549786b9bc91fd4bc9",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/aa02c64540cd77199c2834549786b9bc91fd4bc9/comments",
    "author": {
      "login": "theStack",
      "id": 91535,
      "node_id": "MDQ6VXNlcjkxNTM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theStack",
      "html_url": "https://github.com/theStack",
      "followers_url": "https://api.github.com/users/theStack/followers",
      "following_url": "https://api.github.com/users/theStack/following{/other_user}",
      "gists_url": "https://api.github.com/users/theStack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theStack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
      "organizations_url": "https://api.github.com/users/theStack/orgs",
      "repos_url": "https://api.github.com/users/theStack/repos",
      "events_url": "https://api.github.com/users/theStack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theStack/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "theStack",
      "id": 91535,
      "node_id": "MDQ6VXNlcjkxNTM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theStack",
      "html_url": "https://github.com/theStack",
      "followers_url": "https://api.github.com/users/theStack/followers",
      "following_url": "https://api.github.com/users/theStack/following{/other_user}",
      "gists_url": "https://api.github.com/users/theStack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theStack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
      "organizations_url": "https://api.github.com/users/theStack/orgs",
      "repos_url": "https://api.github.com/users/theStack/repos",
      "events_url": "https://api.github.com/users/theStack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theStack/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "a3f6397c7390ca033311f2219094ac90f6e582f9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a3f6397c7390ca033311f2219094ac90f6e582f9",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/a3f6397c7390ca033311f2219094ac90f6e582f9"
      }
    ],
    "stats": {
      "total": 24,
      "additions": 8,
      "deletions": 16
    },
    "files": [
      {
        "sha": "65929704eb62a55f412b9b4096493623fc34d985",
        "filename": "test/functional/feature_rbf.py",
        "status": "modified",
        "additions": 8,
        "deletions": 16,
        "changes": 24,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/aa02c64540cd77199c2834549786b9bc91fd4bc9/test/functional/feature_rbf.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/aa02c64540cd77199c2834549786b9bc91fd4bc9/test/functional/feature_rbf.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/feature_rbf.py?ref=aa02c64540cd77199c2834549786b9bc91fd4bc9",
        "patch": "@@ -4,6 +4,7 @@\n # file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \"\"\"Test the RBF code.\"\"\"\n \n+from copy import deepcopy\n from decimal import Decimal\n \n from test_framework.blocktools import COINBASE_MATURITY\n@@ -88,7 +89,7 @@ def run_test(self):\n         # the pre-mined test framework chain contains coinbase outputs to the\n         # MiniWallet's default address ADDRESS_BCRT1_P2WSH_OP_TRUE in blocks\n         # 76-100 (see method BitcoinTestFramework._initialize_chain())\n-        self.wallet.scan_blocks(start=76, num=1)\n+        self.wallet.scan_blocks(start=76, num=2)\n \n         self.log.info(\"Running test simple doublespend...\")\n         self.test_simple_doublespend()\n@@ -130,34 +131,25 @@ def run_test(self):\n \n     def test_simple_doublespend(self):\n         \"\"\"Simple doublespend\"\"\"\n-        tx0_outpoint = make_utxo(self.nodes[0], int(1.1 * COIN))\n-\n-        # make_utxo may have generated a bunch of blocks, so we need to sync\n-        # before we can spend the coins generated, or else the resulting\n-        # transactions might not be accepted by our peers.\n-        self.sync_all()\n+        # we use MiniWallet to create a transaction template with inputs correctly set,\n+        # and modify the output (amount, scriptPubKey) according to our needs\n+        tx_template = self.wallet.create_self_transfer(from_node=self.nodes[0])['tx']\n \n-        tx1a = CTransaction()\n-        tx1a.vin = [CTxIn(tx0_outpoint, nSequence=0)]\n+        tx1a = deepcopy(tx_template)\n         tx1a.vout = [CTxOut(1 * COIN, DUMMY_P2WPKH_SCRIPT)]\n         tx1a_hex = tx1a.serialize().hex()\n         tx1a_txid = self.nodes[0].sendrawtransaction(tx1a_hex, 0)\n \n-        self.sync_all()\n-\n         # Should fail because we haven't changed the fee\n-        tx1b = CTransaction()\n-        tx1b.vin = [CTxIn(tx0_outpoint, nSequence=0)]\n+        tx1b = deepcopy(tx_template)\n         tx1b.vout = [CTxOut(1 * COIN, DUMMY_2_P2WPKH_SCRIPT)]\n         tx1b_hex = tx1b.serialize().hex()\n \n         # This will raise an exception due to insufficient fee\n         assert_raises_rpc_error(-26, \"insufficient fee\", self.nodes[0].sendrawtransaction, tx1b_hex, 0)\n \n         # Extra 0.1 BTC fee\n-        tx1b = CTransaction()\n-        tx1b.vin = [CTxIn(tx0_outpoint, nSequence=0)]\n-        tx1b.vout = [CTxOut(int(0.9 * COIN), DUMMY_P2WPKH_SCRIPT)]\n+        tx1b.vout[0].nValue -= int(0.1 * COIN)\n         tx1b_hex = tx1b.serialize().hex()\n         # Works when enabled\n         tx1b_txid = self.nodes[0].sendrawtransaction(tx1b_hex, 0)"
      }
    ]
  }
]