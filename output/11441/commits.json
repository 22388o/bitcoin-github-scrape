[
  {
    "sha": "a4e402c960fb0fbf17afad71fa21dd8f701e9101",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzphNGU0MDJjOTYwZmIwZmJmMTdhZmFkNzFmYTIxZGQ4ZjcwMWU5MTAx",
    "commit": {
      "author": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2017-10-03T02:11:54Z"
      },
      "committer": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2017-10-03T02:32:03Z"
      },
      "message": "rpc/server: Support for specifying options as named parameters",
      "tree": {
        "sha": "a23f5a5f4e93aa619427965e8f5da7ae8d313aae",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a23f5a5f4e93aa619427965e8f5da7ae8d313aae"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a4e402c960fb0fbf17afad71fa21dd8f701e9101",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a4e402c960fb0fbf17afad71fa21dd8f701e9101",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/a4e402c960fb0fbf17afad71fa21dd8f701e9101",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a4e402c960fb0fbf17afad71fa21dd8f701e9101/comments",
    "author": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "12ed800ab870e0fc527a84d6e4584b10c8d239f5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/12ed800ab870e0fc527a84d6e4584b10c8d239f5",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/12ed800ab870e0fc527a84d6e4584b10c8d239f5"
      }
    ],
    "stats": {
      "total": 33,
      "additions": 33,
      "deletions": 0
    },
    "files": [
      {
        "sha": "102a1a3736fc6e1d7acb3f59dd18326d38374559",
        "filename": "src/rpc/server.cpp",
        "status": "modified",
        "additions": 33,
        "deletions": 0,
        "changes": 33,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/a4e402c960fb0fbf17afad71fa21dd8f701e9101/src/rpc/server.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/a4e402c960fb0fbf17afad71fa21dd8f701e9101/src/rpc/server.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpc/server.cpp?ref=a4e402c960fb0fbf17afad71fa21dd8f701e9101",
        "patch": "@@ -431,6 +431,39 @@ static inline JSONRPCRequest transformNamedArguments(const JSONRPCRequest& in, c\n     for (size_t i=0; i<keys.size(); ++i) {\n         argsIn[keys[i]] = &values[i];\n     }\n+    // Move unexpected parameters to options object.\n+    std::set<std::string> all_known_params;\n+    for (const std::string &argNamePattern : argNames) {\n+        std::vector<std::string> vargNames;\n+        boost::algorithm::split(vargNames, argNamePattern, boost::algorithm::is_any_of(\"|\"));\n+        if (std::find(vargNames.begin(), vargNames.end(), \"options\") != vargNames.end()) {\n+            // Aliases to options are always converted into options\n+            all_known_params.insert(\"options\");\n+            continue;\n+        }\n+        all_known_params.insert(vargNames.begin(), vargNames.end());\n+    }\n+    UniValue options;\n+    if (all_known_params.count(\"options\")) {\n+        {\n+            auto provided_options = argsIn.find(\"options\");\n+            if (provided_options != argsIn.end()) {\n+                options = *provided_options->second;\n+            } else {\n+                options = UniValue(UniValue::VOBJ);\n+            }\n+        }\n+        for (auto& key : keys) {\n+            if (!all_known_params.count(key)) {\n+                // Move to options object\n+                options.pushKV(key, *argsIn.at(key));\n+                argsIn.erase(key);\n+            }\n+        }\n+        if (!options.empty()) {\n+            argsIn[\"options\"] = &options;\n+        }\n+    }\n     // Process expected parameters.\n     int hole = 0;\n     for (const std::string &argNamePattern: argNames) {"
      }
    ]
  },
  {
    "sha": "3a2ab53cf9a5c123c6c8f7f184cbf87ca0d656fe",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozYTJhYjUzY2Y5YTVjMTIzYzZjOGY3ZjE4NGNiZjg3Y2EwZDY1NmZl",
    "commit": {
      "author": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2017-10-03T02:32:23Z"
      },
      "committer": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2017-10-03T02:32:23Z"
      },
      "message": "QA: Test named params interaction with RPC options",
      "tree": {
        "sha": "30152add3f8e439cf9a6dfc8a5c3214219217aa3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/30152add3f8e439cf9a6dfc8a5c3214219217aa3"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3a2ab53cf9a5c123c6c8f7f184cbf87ca0d656fe",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3a2ab53cf9a5c123c6c8f7f184cbf87ca0d656fe",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/3a2ab53cf9a5c123c6c8f7f184cbf87ca0d656fe",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3a2ab53cf9a5c123c6c8f7f184cbf87ca0d656fe/comments",
    "author": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "a4e402c960fb0fbf17afad71fa21dd8f701e9101",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a4e402c960fb0fbf17afad71fa21dd8f701e9101",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/a4e402c960fb0fbf17afad71fa21dd8f701e9101"
      }
    ],
    "stats": {
      "total": 17,
      "additions": 17,
      "deletions": 0
    },
    "files": [
      {
        "sha": "70fb7106b248a3726743b3e0a53c7224be81ce22",
        "filename": "test/functional/rpcnamedargs.py",
        "status": "modified",
        "additions": 17,
        "deletions": 0,
        "changes": 17,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3a2ab53cf9a5c123c6c8f7f184cbf87ca0d656fe/test/functional/rpcnamedargs.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3a2ab53cf9a5c123c6c8f7f184cbf87ca0d656fe/test/functional/rpcnamedargs.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/rpcnamedargs.py?ref=3a2ab53cf9a5c123c6c8f7f184cbf87ca0d656fe",
        "patch": "@@ -10,6 +10,9 @@\n     assert_raises_jsonrpc,\n )\n \n+# anyone-can-spend p2sh\n+test_address = '2N9hLwkSqr1cPQAPxbrGVUjxyjD11G2e1he'\n+\n class NamedArgumentTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.num_nodes = 1\n@@ -30,5 +33,19 @@ def run_test(self):\n         assert_equal(node.echo(arg9=None), [None]*10)\n         assert_equal(node.echo(arg0=0,arg3=3,arg9=9), [0] + [None]*2 + [3] + [None]*5 + [9])\n \n+        # Explicit options param\n+        frtout = node.fundrawtransaction(hexstring='01000000000100100000000000000151ffffffff', options={'changeAddress': test_address, 'changePosition': 0})\n+        assert_equal(node.decoderawtransaction(frtout['hex'])['vout'][0]['scriptPubKey']['addresses'], [test_address])\n+\n+        # Passing options as named args\n+        frtout = node.fundrawtransaction(hexstring='01000000000100100000000000000151ffffffff', changeAddress=test_address, changePosition=0)\n+        assert_equal(node.decoderawtransaction(frtout['hex'])['vout'][0]['scriptPubKey']['addresses'], [test_address])\n+\n+        # Passing options as named args + explicit options\n+        frtout = node.fundrawtransaction(hexstring='01000000000100100000000000000151ffffffff', changeAddress=test_address, options={'changePosition': 0})\n+        assert_equal(node.decoderawtransaction(frtout['hex'])['vout'][0]['scriptPubKey']['addresses'], [test_address])\n+        frtout = node.fundrawtransaction(hexstring='01000000000100100000000000000151ffffffff', options={'changeAddress': test_address}, changePosition=0)\n+        assert_equal(node.decoderawtransaction(frtout['hex'])['vout'][0]['scriptPubKey']['addresses'], [test_address])\n+\n if __name__ == '__main__':\n     NamedArgumentTest().main()"
      }
    ]
  }
]