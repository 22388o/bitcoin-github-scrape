jonasschnelli,2016-12-20T08:18:21Z,"General concept ACK on a RAII approach (C++ wrapper) for libevent.\nI think we should avoid `boost::noncopyable` and instead use C++11's `MyClass& operator=(const MyClass&) = delete;` approach.",https://github.com/bitcoin/bitcoin/pull/9387#issuecomment-268182039,268182039,
kallewoof,2016-12-20T08:32:42Z,@jonasschnelli Fixed.,https://github.com/bitcoin/bitcoin/pull/9387#issuecomment-268184790,268184790,
laanwj,2016-12-20T10:20:52Z,"ACK on making things RAII. Thanks.\n\nI'm not so sure about wrapping the entire interface, though. I'm not sure about others but I'd prefer something thinner.\n\nFor example  `evhttp_set_max_headers_size` -> `setMaxHeadersSize`. This makes it fractionally harder for someone that has learned the libevent APIs to understand the code because the functions are named differently.\n\n(also it adds",https://github.com/bitcoin/bitcoin/pull/9387#issuecomment-268207070,268207070,
kallewoof,2016-12-20T10:31:34Z,"@laanwj It felt sensible to make the underlying `ev*` structs private but maybe my intuition was off on that. I'm not entirely convinced that `evhttp_set_max_headers_size` -> `setMaxHeadersSize` is a problem, but if you think it is, it may be better to un-private'ify the structs. That would remove the need for friends as well.",https://github.com/bitcoin/bitcoin/pull/9387#issuecomment-268209325,268209325,
laanwj,2016-12-20T10:38:43Z,"It's not a *problem* but it's one of the little things that I've learned in years developing in open source. If a project makes use of some library which you already know, it's easier to get into it if it is simply using the ""lexicon"" of that library instead of wrapping everything in custom-named calls.\n\nYou could work around this by making the wrapping functions the same as the evhttp calls, ",https://github.com/bitcoin/bitcoin/pull/9387#issuecomment-268210767,268210767,
kallewoof,2016-12-20T10:39:31Z,"There is also a slight issue with the `evhttp_request` which needs to *not* be freed if a call to `evhttp_make_request` has been made. By exposing the internal `evhttp_request`, it's not possible to determine which is the case.",https://github.com/bitcoin/bitcoin/pull/9387#issuecomment-268210929,268210929,
kallewoof,2016-12-20T10:42:12Z,"That (names being same) makes sense. The `unique_ptr` approach looks very nice, but unsure if it can address the above issue adequately.",https://github.com/bitcoin/bitcoin/pull/9387#issuecomment-268211467,268211467,
laanwj,2016-12-20T10:43:30Z,"> There is also a slight issue with the evhttp_request which needs to not be freed if a call to evhttp_make_request has been made. By exposing the internal evhttp_request, it's not possible to determine which is the case.\n\nCouldn't, in that case, the calling code could just `.release()` the pointer? No need to build that intelligence into the pointer object.",https://github.com/bitcoin/bitcoin/pull/9387#issuecomment-268211729,268211729,
kallewoof,2016-12-20T10:46:25Z,"You mean, explicitly tell the wrapper it no longer owns the object whenever you do `evhttp_make_request`? I suppose that is doable. I would have loved to not have to risk developers forgetting to do so though.",https://github.com/bitcoin/bitcoin/pull/9387#issuecomment-268212325,268212325,
laanwj,2016-12-20T10:50:20Z,"True, though hiding behaviour in the wrapper instead of explicit transfer\nof ownership could also cause confusion, as there is a certain expectation\nfrom the API.\n\nOn Dec 20, 2016 11:46 AM, ""kallewoof"" <notifications@github.com> wrote:\n\n> You mean, explicitly tell the wrapper it no longer owns the object\n> whenever you do evhttp_make_request? I suppose that is doable. I would\n> have loved ",https://github.com/bitcoin/bitcoin/pull/9387#issuecomment-268213151,268213151,
kallewoof,2016-12-20T10:51:56Z,"Yeah, that makes sense. Thanks for the feedback, will fix!",https://github.com/bitcoin/bitcoin/pull/9387#issuecomment-268213474,268213474,
kallewoof,2016-12-20T11:53:51Z,"@laanwj I decided to go with the unique pointer + deleter approach. It became awfully verbose, so I did some macroing.",https://github.com/bitcoin/bitcoin/pull/9387#issuecomment-268224948,268224948,
laanwj,2016-12-20T12:22:09Z,"Nice!\nConcept ACK. I think the use of macros is okay in this case, as indeed they all follow the same pattern and it saves a lot of dumb repetition.\n",https://github.com/bitcoin/bitcoin/pull/9387#issuecomment-268230164,268230164,
laanwj,2017-01-04T07:52:27Z,"I tried building this and it fails:\n```\n$ make\nMaking all in src\nmake[1]: Entering directory '/store2/build/bitcoin/bitcoin/src'\nmake[2]: Entering directory '/store2/build/bitcoin/bitcoin/src'\n...\n  CXX      test/test_test_bitcoin-raii_event_tests.o\n/.../bitcoin/src/test/raii_event_tests.cpp:5:10: fatal error: 'event2/event.h' file not found\n#include <event2/event.h>\n         ^",https://github.com/bitcoin/bitcoin/pull/9387#issuecomment-270312780,270312780,
kallewoof,2017-01-04T07:55:17Z,"@laanwj Weird. What does `V=1 make` give as output?\n\nEdit: Did see that `$(EVENT_CFLAGS)` was not added to `test_test_bitcoin_CPPFLAGS` in `Makefile.test.include` (line 113). I'm confused why my machines (1 Mac OS X and 1 Ubuntu inside VirtualBox) and Travis both find the headers. Does it work if you add that?",https://github.com/bitcoin/bitcoin/pull/9387#issuecomment-270313175,270313175,
laanwj,2017-01-04T09:04:47Z,"Sure:\n```\n/usr/bin/ccache /opt/clang40/bin/clang++ -std=c++11 -DHAVE_CONFIG_H -I. -I.../bitcoin/src -I../src/config  -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=2 -I. -I./obj  -pthread -I/usr/include -I.../bitcoin/src/leveldb/include -I.../bitcoin/src/leveldb/helpers/memenv   -I.../bitcoin/src/secp256k1/include -I.../bitcoin/src/univalue/include -I./test/ -DBOOST_TEST_DYN_LINK -Qunused-arguments -ggdb",https://github.com/bitcoin/bitcoin/pull/9387#issuecomment-270324673,270324673,
kallewoof,2017-01-04T09:17:26Z,"On my system, I have event2 symlinked inside `/usr/local/include`, which means I don't have to explicitly include it in the g++ call. Adding $(EVENT_CFLAGS) to `test_test_bitcoin_CPPFLAGS` added explicit references so this should fix it on your end.",https://github.com/bitcoin/bitcoin/pull/9387#issuecomment-270326859,270326859,
laanwj,2017-01-04T11:06:47Z,"Yep, that solved it, thanks! utACK 05a55a6",https://github.com/bitcoin/bitcoin/pull/9387#issuecomment-270347217,270347217,
