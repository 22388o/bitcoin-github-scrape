pstratem,2015-11-30T04:21:37Z,@jtimon as this is literally only used CreateNewBlock can you also add a parameter to override per getblocktemplate call ?\n,https://github.com/bitcoin/bitcoin/pull/7131#issuecomment-160512755,160512755,
jtoomim,2015-11-30T04:59:54Z,"@pstratem RE: per GBT call parameter: Possible, but I don't see the use-case for that being compelling enough to overcome my laziness. I think that runtime blockmaxsize adjustment will usually be done by a human pool operator in order to tweak and optimize block propagation times. This would be easiest to perform as a fire-once-and-forget kind of tweak. The option you're suggesting would be useful",https://github.com/bitcoin/bitcoin/pull/7131#issuecomment-160516124,160516124,
paveljanik,2015-12-01T18:36:39Z,Can you rename to `setmaxblocksize`?\n,https://github.com/bitcoin/bitcoin/pull/7131#issuecomment-161057233,161057233,
jtoomim,2015-12-01T18:41:57Z,"> Can you rename to setmaxblocksize?\n\nOnly if we want to have a different name for the RPC and for the internal variable and command line switch, or if we want to rename the internal variable and command line switch.\n",https://github.com/bitcoin/bitcoin/pull/7131#issuecomment-161058461,161058461,
paveljanik,2015-12-01T18:44:44Z,Hmm forget about renaming. It is messed up in the master already...\n,https://github.com/bitcoin/bitcoin/pull/7131#issuecomment-161059143,161059143,
laanwj,2015-12-04T08:55:46Z,"> @jtimon as this is literally only used CreateNewBlock can you also add a parameter to override per getblocktemplate call ?\n\nI also like that solution more. Especially as `getblocktemplate` is designed to be extended with extra parameters by taking an object, instead of having to tack on another positional argument.\n\nChanging global parameters in RPC calls is something I'd like to avoid, espe",https://github.com/bitcoin/bitcoin/pull/7131#issuecomment-161911540,161911540,
jtoomim,2015-12-05T08:14:35Z,"laanwj if we make it an argument to CreateNewBlock, then it's of no direct use to sysadmins until pool software is rewritten to take advantage of it. Even then, the use-case that I had in mind (being able to change the block size soft limit from the command line without restarting any processes) would only be possible if the pool software implements something basically the same as what I just impl",https://github.com/bitcoin/bitcoin/pull/7131#issuecomment-162160299,162160299,
paveljanik,2015-12-05T10:00:45Z,Rebase needed.\n,https://github.com/bitcoin/bitcoin/pull/7131#issuecomment-162168378,162168378,
paveljanik,2015-12-05T10:04:30Z,"Hmm, isn't better to create one generic interface?\n\n```\n# Bigger blocks...\nsetvariable blockmaxsize 8000000\n# Enlarge mempool 300M -> 2G\nsetvariable maxmempool 2000\n# Allow less connections\nsetvariable maxconnections 4\n```\n\netc.?\n",https://github.com/bitcoin/bitcoin/pull/7131#issuecomment-162168533,162168533,
sipa,2015-12-05T10:14:55Z,"That would be awesome, but would really require a total rewrite of the\nargument parsing code, as it means reevaluation of interaction with other\narguments, constraints, changing global variables (which often were\nimmutable before and thus didn't need a lock but now do...).\n",https://github.com/bitcoin/bitcoin/pull/7131#issuecomment-162168903,162168903,
GIJensen,2015-12-05T23:26:24Z,I'd really like to see the ability to set global variables via RPC calls.\n,https://github.com/bitcoin/bitcoin/pull/7131#issuecomment-162256491,162256491,
laanwj,2016-04-14T15:46:57Z,"Closing due to inactivity, and seems to be disagreement on how to do this.\n\nAs for setting arguments at run time through RPC in general, see #7289\n",https://github.com/bitcoin/bitcoin/pull/7131#issuecomment-210010884,210010884,
dcousens,2015-11-30T04:25:50Z,nit: why the extra parens?\n,https://github.com/bitcoin/bitcoin/pull/7131#discussion_r46107992,46107992,src/rpcmining.cpp
jtoomim,2015-11-30T04:43:38Z,"No good reason. Will fix.\n\nOh, and another thing right next to it: Bitcoin Core uses unsigned ints for nBlockMaxSize, not uint64_t. This shouldn't cause any functional problems as written right now, but it's still probably worth fixing.\n",https://github.com/bitcoin/bitcoin/pull/7131#discussion_r46108480,46108480,src/rpcmining.cpp
instagibbs,2015-12-01T18:25:08Z,This accepts unbounded size? What happens when it's above 1MB?\n,https://github.com/bitcoin/bitcoin/pull/7131#discussion_r46316854,46316854,src/rpcmining.cpp
sipa,2015-12-01T18:27:36Z,I expect it will make CreateNewBlock fail its own sanity check.\n,https://github.com/bitcoin/bitcoin/pull/7131#discussion_r46317186,46317186,src/rpcmining.cpp
jtoomim,2015-12-01T18:33:12Z,"miner.cpp:131:         nBlockMaxSize = std::max((unsigned int)1000, std::min((unsigned int)(MAX_BLOCK_SIZE-1000), nBlockMaxSize));\n\nIf you pass a value larger than 1000000 to setblockmaxsize, then the variable will be set to that large value. However, when it's used, it's clamped to MAX_BLOCK_SIZE-1000, so block creation continues unimpeded with valid values.\n\nThe check against an excessively ",https://github.com/bitcoin/bitcoin/pull/7131#discussion_r46317935,46317935,src/rpcmining.cpp
sipa,2015-12-01T18:35:09Z,"Agree, not really an issue (though the RPC could fail to warn the user that it's not going to do what he requests).\n",https://github.com/bitcoin/bitcoin/pull/7131#discussion_r46318207,46318207,src/rpcmining.cpp
instagibbs,2015-12-01T18:37:49Z,I guess a warning would be useful for clarity about its purpose at least in the help doc.\n,https://github.com/bitcoin/bitcoin/pull/7131#discussion_r46318573,46318573,src/rpcmining.cpp
sipa,2015-12-01T20:11:48Z,This line now mutates a global variable. I think you should make a copy first.\n,https://github.com/bitcoin/bitcoin/pull/7131#discussion_r46331948,46331948,src/miner.cpp
gmaxwell,2015-12-04T05:48:43Z,Make a copy? :-/\n\nhttps://software.intel.com/en-us/blogs/2013/01/06/benign-data-races-what-could-possibly-go-wrong?page=1\n,https://github.com/bitcoin/bitcoin/pull/7131#discussion_r46651229,46651229,src/miner.cpp
sipa,2015-12-05T07:59:17Z,@gmaxwell The RPC changing the global variable and the copy copying it would obviously need a lock.\n,https://github.com/bitcoin/bitcoin/pull/7131#discussion_r46755654,46755654,src/miner.cpp
jtoomim,2015-12-05T08:07:28Z,"It's a ""global"" variable that is used in exactly one function, which is the same function that you're looking at here (just down 100 lines or so), and part of the same critical section. It's locked with the same lock (cs_main) as the code that mutates it in the RPC I created.\n\nAnyway, if you don't like the way it looks, I can take a look at it again in a few days. Kinda busy with other stuff rig",https://github.com/bitcoin/bitcoin/pull/7131#discussion_r46755726,46755726,src/miner.cpp
