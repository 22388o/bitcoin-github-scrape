[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/386153133",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11911#issuecomment-386153133",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11911",
    "id": 386153133,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4NjE1MzEzMw==",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?u=7999a16349f0df0fb273fffa18e5a955c9d3f11c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-05-02T23:35:45Z",
    "updated_at": "2018-05-02T23:35:45Z",
    "author_association": "MEMBER",
    "body": "Concept ACK",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/386153133/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/403320663",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11911#issuecomment-403320663",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11911",
    "id": 403320663,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwMzMyMDY2Mw==",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?u=4a9af998e1a560b3f49c3827f453e1bcbe6a5cfb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-08T22:01:34Z",
    "updated_at": "2018-07-08T22:01:34Z",
    "author_association": "MEMBER",
    "body": "@ryanofsky ping.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/403320663/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/406906797",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11911#issuecomment-406906797",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11911",
    "id": 406906797,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwNjkwNjc5Nw==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-22T23:50:56Z",
    "updated_at": "2018-07-22T23:50:56Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--5d09a71f8925f3f132321140b44b946d-->The last travis run for this pull request was 65 days ago and is thus outdated. To trigger a fresh travis build, this pull request should be closed and re-opened.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/406906797/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/421572625",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11911#issuecomment-421572625",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11911",
    "id": 421572625,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyMTU3MjYyNQ==",
    "user": {
      "login": "PierreRochard",
      "id": 6299681,
      "node_id": "MDQ6VXNlcjYyOTk2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6299681?u=b01d3339e84633808b268c93a82c7af1b4229b7f&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PierreRochard",
      "html_url": "https://github.com/PierreRochard",
      "followers_url": "https://api.github.com/users/PierreRochard/followers",
      "following_url": "https://api.github.com/users/PierreRochard/following{/other_user}",
      "gists_url": "https://api.github.com/users/PierreRochard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PierreRochard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PierreRochard/subscriptions",
      "organizations_url": "https://api.github.com/users/PierreRochard/orgs",
      "repos_url": "https://api.github.com/users/PierreRochard/repos",
      "events_url": "https://api.github.com/users/PierreRochard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PierreRochard/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-15T13:43:31Z",
    "updated_at": "2018-09-15T13:43:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "One more thing: PR title and commit message should be updated to say BerkeleyEnvironment",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/421572625/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/423531114",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11911#issuecomment-423531114",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11911",
    "id": 423531114,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyMzUzMTExNA==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-21T13:29:03Z",
    "updated_at": "2018-12-21T14:35:24Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/423531114/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/438908661",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11911#issuecomment-438908661",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11911",
    "id": 438908661,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzODkwODY2MQ==",
    "user": {
      "login": "meshcollider",
      "id": 3211283,
      "node_id": "MDQ6VXNlcjMyMTEyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3211283?u=447cdc9e2966cbee415545c8ff452954ee1209af&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meshcollider",
      "html_url": "https://github.com/meshcollider",
      "followers_url": "https://api.github.com/users/meshcollider/followers",
      "following_url": "https://api.github.com/users/meshcollider/following{/other_user}",
      "gists_url": "https://api.github.com/users/meshcollider/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
      "organizations_url": "https://api.github.com/users/meshcollider/orgs",
      "repos_url": "https://api.github.com/users/meshcollider/repos",
      "events_url": "https://api.github.com/users/meshcollider/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meshcollider/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-15T03:56:32Z",
    "updated_at": "2018-11-15T03:56:32Z",
    "author_association": "MEMBER",
    "body": "utACK https://github.com/bitcoin/bitcoin/pull/11911/commits/530efe9813fc1fc874c7b612cfd46cc00beb4bf3 modulo @promag's comments above, which need addressing ",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/438908661/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/442341065",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11911#issuecomment-442341065",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11911",
    "id": 442341065,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0MjM0MTA2NQ==",
    "user": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?u=5ff13e375b40ea55ecd3c108337dd6a23f68eddf&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-28T07:00:27Z",
    "updated_at": "2018-11-28T07:00:27Z",
    "author_association": "CONTRIBUTOR",
    "body": "@ryanofsky Can you try without `FUNCTIONAL_TESTS_CONFIG`? :-)",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/442341065/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/454466517",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11911#issuecomment-454466517",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11911",
    "id": 454466517,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NDQ2NjUxNw==",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-15T16:55:30Z",
    "updated_at": "2019-01-15T16:55:30Z",
    "author_association": "MEMBER",
    "body": "@ryanofsky Are you still working on this?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/454466517/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/454828484",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11911#issuecomment-454828484",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11911",
    "id": 454828484,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NDgyODQ4NA==",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-16T15:49:23Z",
    "updated_at": "2019-01-16T15:49:23Z",
    "author_association": "CONTRIBUTOR",
    "body": "> @ryanofsky Are you still working on this?\r\n\r\nYeah, I went back and implemented all the suggestions, but for some reason the assert in https://github.com/bitcoin/bitcoin/pull/11911#discussion_r185654925 is constantly triggering, so I need to debug.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/454828484/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/459167833",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11911#issuecomment-459167833",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11911",
    "id": 459167833,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1OTE2NzgzMw==",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?u=4a9af998e1a560b3f49c3827f453e1bcbe6a5cfb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-31T00:35:41Z",
    "updated_at": "2019-01-31T00:40:29Z",
    "author_association": "MEMBER",
    "body": "Tested ACK 14bc2a17dd while implementing #15297. Also tested with\r\n```diff\r\n--- a/src/wallet/db.cpp\r\n+++ b/src/wallet/db.cpp\r\n@@ -97,8 +97,9 @@ std::shared_ptr<BerkeleyEnvironment> GetWalletEnv(const fs::path& wallet_path, s\r\n     SplitWalletPath(wallet_path, env_directory, database_filename);\r\n     LOCK(cs_db);\r\n     auto inserted = g_dbenvs.emplace(env_directory.string(), std::weak_ptr<BerkeleyEnvironment>());\r\n-    if (inserted.second) {\r\n-        auto env = std::make_shared<BerkeleyEnvironment>(env_directory.string());\r\n+    auto env = inserted.first->second.lock();\r\n+    if (!env) {\r\n+        env = std::make_shared<BerkeleyEnvironment>(env_directory.string());\r\n         inserted.first->second = env;\r\n         return env;\r\n     }\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/459167833/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/459421928",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11911#issuecomment-459421928",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11911",
    "id": 459421928,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1OTQyMTkyOA==",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-31T17:00:00Z",
    "updated_at": "2019-01-31T17:00:00Z",
    "author_association": "MEMBER",
    "body": "utACK 14bc2a17dd03ccd89f65a302328763ff22c710c2",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/459421928/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157393226",
    "pull_request_review_id": 84026038,
    "id": 157393226,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1NzM5MzIyNg==",
    "diff_hunk": "@@ -86,7 +87,7 @@ class CDBEnv\n };\n \n /** Get CDBEnv and database filename given a wallet path. */\n-CDBEnv* GetWalletEnv(const fs::path& wallet_path, std::string& database_filename);\n+std::shared_ptr<CDBEnv> GetWalletEnv(const fs::path& wallet_path, std::string& database_filename);",
    "path": "src/wallet/db.h",
    "position": null,
    "original_position": 25,
    "commit_id": "14bc2a17dd03ccd89f65a302328763ff22c710c2",
    "original_commit_id": "aca8ec0dabb4987a4f73a19e2a7dc09177197adb",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "typedef `std::shared_ptr<CDBEnv>` something? CDBEnvRef for instance.",
    "created_at": "2017-12-18T02:54:32Z",
    "updated_at": "2018-11-27T18:09:46Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11911#discussion_r157393226",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11911",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157393226"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11911#discussion_r157393226"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11911"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157393226/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 90,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157533704",
    "pull_request_review_id": 84191211,
    "id": 157533704,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1NzUzMzcwNA==",
    "diff_hunk": "@@ -86,7 +87,7 @@ class CDBEnv\n };\n \n /** Get CDBEnv and database filename given a wallet path. */\n-CDBEnv* GetWalletEnv(const fs::path& wallet_path, std::string& database_filename);\n+std::shared_ptr<CDBEnv> GetWalletEnv(const fs::path& wallet_path, std::string& database_filename);",
    "path": "src/wallet/db.h",
    "position": null,
    "original_position": 25,
    "commit_id": "14bc2a17dd03ccd89f65a302328763ff22c710c2",
    "original_commit_id": "aca8ec0dabb4987a4f73a19e2a7dc09177197adb",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> typedef std::shared_ptr<CDBEnv> something? CDBEnvRef for instance\r\n\r\nI don't think this is a good idea. I'd be reluctant to introduce yet another wallet database type, especially one that obfuscates what it represents and how it relates to CDBEnv. Use of ref type aliases has been justified in other places on the basis that where types are widely used, having aliases makes it easier to switch implementations without having to update a lot of existing code. But that justification doesn't apply here because CDBEnv is internal to db.h/db.cpp and not widely used.",
    "created_at": "2017-12-18T16:31:15Z",
    "updated_at": "2018-11-27T18:09:46Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11911#discussion_r157533704",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11911",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157533704"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11911#discussion_r157533704"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11911"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157533704/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 90,
    "side": "RIGHT",
    "in_reply_to_id": 157393226
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157590858",
    "pull_request_review_id": 84258052,
    "id": 157590858,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1NzU5MDg1OA==",
    "diff_hunk": "@@ -86,7 +87,7 @@ class CDBEnv\n };\n \n /** Get CDBEnv and database filename given a wallet path. */\n-CDBEnv* GetWalletEnv(const fs::path& wallet_path, std::string& database_filename);\n+std::shared_ptr<CDBEnv> GetWalletEnv(const fs::path& wallet_path, std::string& database_filename);",
    "path": "src/wallet/db.h",
    "position": null,
    "original_position": 25,
    "commit_id": "14bc2a17dd03ccd89f65a302328763ff22c710c2",
    "original_commit_id": "aca8ec0dabb4987a4f73a19e2a7dc09177197adb",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": ":+1:",
    "created_at": "2017-12-18T20:21:12Z",
    "updated_at": "2018-11-27T18:09:46Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11911#discussion_r157590858",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11911",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157590858"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11911#discussion_r157590858"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11911"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157590858/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 90,
    "side": "RIGHT",
    "in_reply_to_id": 157393226
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/185653527",
    "pull_request_review_id": 117087044,
    "id": 185653527,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4NTY1MzUyNw==",
    "diff_hunk": "@@ -121,6 +124,7 @@ BerkeleyEnvironment::BerkeleyEnvironment(const fs::path& dir_path) : strPath(dir\n \n BerkeleyEnvironment::~BerkeleyEnvironment()\n {\n+    g_dbenvs.erase(strPath);",
    "path": "src/wallet/db.cpp",
    "position": 50,
    "original_position": 37,
    "commit_id": "14bc2a17dd03ccd89f65a302328763ff22c710c2",
    "original_commit_id": "e4a5ea35fb151f669144ebb856e4716ae212e569",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Missing `cs_db` lock?",
    "created_at": "2018-05-02T22:08:34Z",
    "updated_at": "2018-11-27T18:09:46Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11911#discussion_r185653527",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11911",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/185653527"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11911#discussion_r185653527"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11911"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/185653527/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 150,
    "original_line": 150,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/185654628",
    "pull_request_review_id": 117087044,
    "id": 185654628,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4NTY1NDYyOA==",
    "diff_hunk": "@@ -121,6 +124,7 @@ BerkeleyEnvironment::BerkeleyEnvironment(const fs::path& dir_path) : strPath(dir\n \n BerkeleyEnvironment::~BerkeleyEnvironment()\n {\n+    g_dbenvs.erase(strPath);",
    "path": "src/wallet/db.cpp",
    "position": 50,
    "original_position": 37,
    "commit_id": "14bc2a17dd03ccd89f65a302328763ff22c710c2",
    "original_commit_id": "e4a5ea35fb151f669144ebb856e4716ae212e569",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Could you change to `std::string const strPath;` in `BerkeleyEnvironment`?",
    "created_at": "2018-05-02T22:13:52Z",
    "updated_at": "2018-11-27T18:09:46Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11911#discussion_r185654628",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11911",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/185654628"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11911#discussion_r185654628"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11911"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/185654628/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 150,
    "original_line": 150,
    "side": "RIGHT",
    "in_reply_to_id": 185653527
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/185654925",
    "pull_request_review_id": 117087044,
    "id": 185654925,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4NTY1NDkyNQ==",
    "diff_hunk": "@@ -121,6 +124,7 @@ BerkeleyEnvironment::BerkeleyEnvironment(const fs::path& dir_path) : strPath(dir\n \n BerkeleyEnvironment::~BerkeleyEnvironment()\n {\n+    g_dbenvs.erase(strPath);",
    "path": "src/wallet/db.cpp",
    "position": 50,
    "original_position": 37,
    "commit_id": "14bc2a17dd03ccd89f65a302328763ff22c710c2",
    "original_commit_id": "e4a5ea35fb151f669144ebb856e4716ae212e569",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Nit:\r\n```\r\nint count = g_dbenvs.erase(strPath);\r\nassert(count == 1);\r\n```",
    "created_at": "2018-05-02T22:15:19Z",
    "updated_at": "2018-11-27T18:09:46Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11911#discussion_r185654925",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11911",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/185654925"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11911#discussion_r185654925"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11911"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/185654925/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 150,
    "original_line": 150,
    "side": "RIGHT",
    "in_reply_to_id": 185653527
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/185664719",
    "pull_request_review_id": 117100235,
    "id": 185664719,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4NTY2NDcxOQ==",
    "diff_hunk": "@@ -72,11 +72,14 @@ BerkeleyEnvironment* GetWalletEnv(const fs::path& wallet_path, std::string& data\n         database_filename = \"wallet.dat\";\n     }\n     LOCK(cs_db);\n-    // Note: An ununsed temporary BerkeleyEnvironment object may be created inside the\n-    // emplace function if the key already exists. This is a little inefficient,\n-    // but not a big concern since the map will be changed in the future to hold\n-    // pointers instead of objects, anyway.\n-    return &g_dbenvs.emplace(std::piecewise_construct, std::forward_as_tuple(env_directory.string()), std::forward_as_tuple(env_directory)).first->second;\n+    auto inserted = g_dbenvs.emplace(env_directory.string(), std::weak_ptr<BerkeleyEnvironment>());\n+    if (inserted.second) {\n+        auto env = std::make_shared<BerkeleyEnvironment>(env_directory.string());\n+        inserted.first->second = env;\n+        return env;\n+    } else {\n+        return inserted.first->second.lock();",
    "path": "src/wallet/db.cpp",
    "position": null,
    "original_position": 28,
    "commit_id": "14bc2a17dd03ccd89f65a302328763ff22c710c2",
    "original_commit_id": "e4a5ea35fb151f669144ebb856e4716ae212e569",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I may be missing the logic here, but how is it guaranteed that the `shared_ptr` hasn't expired yet?",
    "created_at": "2018-05-02T23:11:57Z",
    "updated_at": "2018-11-27T18:09:46Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11911#discussion_r185664719",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11911",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/185664719"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11911#discussion_r185664719"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11911"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/185664719/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 88,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/185665542",
    "pull_request_review_id": 117101231,
    "id": 185665542,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4NTY2NTU0Mg==",
    "diff_hunk": "@@ -72,11 +72,14 @@ BerkeleyEnvironment* GetWalletEnv(const fs::path& wallet_path, std::string& data\n         database_filename = \"wallet.dat\";\n     }\n     LOCK(cs_db);\n-    // Note: An ununsed temporary BerkeleyEnvironment object may be created inside the\n-    // emplace function if the key already exists. This is a little inefficient,\n-    // but not a big concern since the map will be changed in the future to hold\n-    // pointers instead of objects, anyway.\n-    return &g_dbenvs.emplace(std::piecewise_construct, std::forward_as_tuple(env_directory.string()), std::forward_as_tuple(env_directory)).first->second;\n+    auto inserted = g_dbenvs.emplace(env_directory.string(), std::weak_ptr<BerkeleyEnvironment>());\n+    if (inserted.second) {\n+        auto env = std::make_shared<BerkeleyEnvironment>(env_directory.string());\n+        inserted.first->second = env;\n+        return env;\n+    } else {\n+        return inserted.first->second.lock();",
    "path": "src/wallet/db.cpp",
    "position": null,
    "original_position": 28,
    "commit_id": "14bc2a17dd03ccd89f65a302328763ff22c710c2",
    "original_commit_id": "e4a5ea35fb151f669144ebb856e4716ae212e569",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "It's valid until `~BerkeleyEnvironment()` which means `shared_ptr` just expired, and in `~BerkeleyEnvironment()` the map is erased. In other words, when `shared_ptr` releases the instance the entry in `g_dbenvs` is removed.",
    "created_at": "2018-05-02T23:17:31Z",
    "updated_at": "2018-11-27T18:09:46Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11911#discussion_r185665542",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11911",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/185665542"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11911#discussion_r185665542"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11911"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/185665542/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 88,
    "side": "RIGHT",
    "in_reply_to_id": 185664719
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/185667521",
    "pull_request_review_id": 117103479,
    "id": 185667521,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4NTY2NzUyMQ==",
    "diff_hunk": "@@ -72,11 +72,14 @@ BerkeleyEnvironment* GetWalletEnv(const fs::path& wallet_path, std::string& data\n         database_filename = \"wallet.dat\";\n     }\n     LOCK(cs_db);\n-    // Note: An ununsed temporary BerkeleyEnvironment object may be created inside the\n-    // emplace function if the key already exists. This is a little inefficient,\n-    // but not a big concern since the map will be changed in the future to hold\n-    // pointers instead of objects, anyway.\n-    return &g_dbenvs.emplace(std::piecewise_construct, std::forward_as_tuple(env_directory.string()), std::forward_as_tuple(env_directory)).first->second;\n+    auto inserted = g_dbenvs.emplace(env_directory.string(), std::weak_ptr<BerkeleyEnvironment>());\n+    if (inserted.second) {\n+        auto env = std::make_shared<BerkeleyEnvironment>(env_directory.string());\n+        inserted.first->second = env;\n+        return env;\n+    } else {\n+        return inserted.first->second.lock();",
    "path": "src/wallet/db.cpp",
    "position": null,
    "original_position": 28,
    "commit_id": "14bc2a17dd03ccd89f65a302328763ff22c710c2",
    "original_commit_id": "e4a5ea35fb151f669144ebb856e4716ae212e569",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Ah, of course, makes sense.",
    "created_at": "2018-05-02T23:29:38Z",
    "updated_at": "2018-11-27T18:09:46Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11911#discussion_r185667521",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11911",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/185667521"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11911#discussion_r185667521"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11911"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/185667521/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 88,
    "side": "RIGHT",
    "in_reply_to_id": 185664719
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217828788",
    "pull_request_review_id": 155644285,
    "id": 217828788,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNzgyODc4OA==",
    "diff_hunk": "@@ -504,7 +507,7 @@ BerkeleyBatch::BerkeleyBatch(BerkeleyDatabase& database, const char* pszMode, bo\n             // versions of BDB have an set_lk_exclusive method for this\n             // purpose, but the older version we use does not.)\n             for (const auto& env : g_dbenvs) {\n-                CheckUniqueFileid(env.second, strFilename, *pdb_temp);\n+                CheckUniqueFileid(*env.second.lock().get(), strFilename, *pdb_temp);",
    "path": "src/wallet/db.cpp",
    "position": null,
    "original_position": 95,
    "commit_id": "14bc2a17dd03ccd89f65a302328763ff22c710c2",
    "original_commit_id": "a35b4ef797783596dff9ca24fc46789a84e90014",
    "user": {
      "login": "PierreRochard",
      "id": 6299681,
      "node_id": "MDQ6VXNlcjYyOTk2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6299681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PierreRochard",
      "html_url": "https://github.com/PierreRochard",
      "followers_url": "https://api.github.com/users/PierreRochard/followers",
      "following_url": "https://api.github.com/users/PierreRochard/following{/other_user}",
      "gists_url": "https://api.github.com/users/PierreRochard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PierreRochard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PierreRochard/subscriptions",
      "organizations_url": "https://api.github.com/users/PierreRochard/orgs",
      "repos_url": "https://api.github.com/users/PierreRochard/repos",
      "events_url": "https://api.github.com/users/PierreRochard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PierreRochard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Pre-dates this commit, but `env` variable name shadowing here threw me for a loop",
    "created_at": "2018-09-14T20:08:51Z",
    "updated_at": "2018-11-27T18:09:46Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11911#discussion_r217828788",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11911",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217828788"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11911#discussion_r217828788"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11911"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217828788/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 517,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/225069024",
    "pull_request_review_id": 164586598,
    "id": 225069024,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNTA2OTAyNA==",
    "diff_hunk": "@@ -72,11 +79,14 @@ BerkeleyEnvironment* GetWalletEnv(const fs::path& wallet_path, std::string& data\n         database_filename = \"wallet.dat\";\n     }\n     LOCK(cs_db);\n-    // Note: An unused temporary BerkeleyEnvironment object may be created inside the\n-    // emplace function if the key already exists. This is a little inefficient,\n-    // but not a big concern since the map will be changed in the future to hold\n-    // pointers instead of objects, anyway.\n-    return &g_dbenvs.emplace(std::piecewise_construct, std::forward_as_tuple(env_directory.string()), std::forward_as_tuple(env_directory)).first->second;\n+    auto inserted = g_dbenvs.emplace(env_directory.string(), std::weak_ptr<BerkeleyEnvironment>());\n+    if (inserted.second) {\n+        auto env = std::make_shared<BerkeleyEnvironment>(env_directory.string());\n+        inserted.first->second = env;\n+        return env;\n+    } else {",
    "path": "src/wallet/db.cpp",
    "position": null,
    "original_position": 34,
    "commit_id": "14bc2a17dd03ccd89f65a302328763ff22c710c2",
    "original_commit_id": "3fff7065b5ead902a773c889b9fba941abbfeab7",
    "user": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Drop this redundant `else` and move the `return` the outer scope?",
    "created_at": "2018-10-15T07:58:55Z",
    "updated_at": "2018-11-27T18:09:46Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11911#discussion_r225069024",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11911",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/225069024"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11911#discussion_r225069024"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11911"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/225069024/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 87,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/227723624",
    "pull_request_review_id": 167826113,
    "id": 227723624,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNzcyMzYyNA==",
    "diff_hunk": "@@ -72,11 +79,13 @@ BerkeleyEnvironment* GetWalletEnv(const fs::path& wallet_path, std::string& data\n         database_filename = \"wallet.dat\";\n     }\n     LOCK(cs_db);\n-    // Note: An unused temporary BerkeleyEnvironment object may be created inside the\n-    // emplace function if the key already exists. This is a little inefficient,\n-    // but not a big concern since the map will be changed in the future to hold\n-    // pointers instead of objects, anyway.\n-    return &g_dbenvs.emplace(std::piecewise_construct, std::forward_as_tuple(env_directory.string()), std::forward_as_tuple(env_directory)).first->second;\n+    auto inserted = g_dbenvs.emplace(env_directory.string(), std::weak_ptr<BerkeleyEnvironment>());\n+    if (inserted.second) {",
    "path": "src/wallet/db.cpp",
    "position": 37,
    "original_position": 30,
    "commit_id": "14bc2a17dd03ccd89f65a302328763ff22c710c2",
    "original_commit_id": "54d2a8ef1f2f6168db14ecae00eed50b4e7363fd",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think this condition should be replaced with:\r\n```\r\nauto env = inserted.first->second.lock();\r\nif (!env) {\r\n    // ...\r\n```\r\nwhich prevents returning null `std::shared_ptr<BerkeleyEnvironment>`.\r\n\r\nNote that `BerkeleyEnvironment` destructor could be called after the above `LOCK(cs_db)` which means it would returng an invalid env.",
    "created_at": "2018-10-24T10:02:04Z",
    "updated_at": "2018-11-27T18:09:46Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11911#discussion_r227723624",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11911",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/227723624"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11911#discussion_r227723624"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11911"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/227723624/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 100,
    "original_line": 100,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/232930179",
    "pull_request_review_id": 174232133,
    "id": 232930179,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMjkzMDE3OQ==",
    "diff_hunk": "@@ -3851,6 +3851,9 @@ bool CWallet::Verify(std::string wallet_file, bool salvage_wallet, std::string&\n         }\n     }\n \n+    // Keep same database environment instance across Verify/Recover calls below.\n+    std::unique_ptr<WalletDatabase> database = WalletDatabase::Create(wallet_path);",
    "path": "src/wallet/wallet.cpp",
    "position": 5,
    "original_position": 5,
    "commit_id": "14bc2a17dd03ccd89f65a302328763ff22c710c2",
    "original_commit_id": "119ceb458a61d41b21a6130a2cc144adbc5805a3",
    "user": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This declaration hides the member `CWallet::database`. Is that intentional? If not, use another name? :-)",
    "created_at": "2018-11-13T08:07:31Z",
    "updated_at": "2018-11-27T18:09:46Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11911#discussion_r232930179",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11911",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/232930179"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11911#discussion_r232930179"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11911"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/232930179/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 3881,
    "original_line": 3881,
    "side": "RIGHT"
  }
]