[
  {
    "sha": "c5ed6e73d3e18f26558c49fa3ecb1b7b0bb40d12",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpjNWVkNmU3M2QzZTE4ZjI2NTU4YzQ5ZmEzZWNiMWI3YjBiYjQwZDEy",
    "commit": {
      "author": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2018-11-29T11:36:12Z"
      },
      "committer": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2018-11-30T10:40:57Z"
      },
      "message": "Move CheckBlock() call to critical section\n\nThis prevents data race for CBlock::fChecked.",
      "tree": {
        "sha": "10ec3fe50820e371ba6de079d7a56ce091e88663",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/10ec3fe50820e371ba6de079d7a56ce091e88663"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c5ed6e73d3e18f26558c49fa3ecb1b7b0bb40d12",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE0dvyxLlvLev0wWZUQQEIES5+qB8FAlwBE7kACgkQQQEIES5+\nqB9mKA/9FPFio6TUb/YDtNbp9ukFgl2XClDxZL4rR7Nqc32w7uplC2D8s+e9Ow6h\ngiu8+DBJuiiQXbApoQ9NLg8fLWQRMXtrEpQlMFDWLltI98mflCWIHQD4VbEnZu+u\n/+3R32kEVb2UcMsSakomw60sR3ZnFV5xp2k2bj60PXvLIDBVvQVzrUeMOisjz08S\nKj8LDYd7zb/XXGxKignihuRh99FT9d2R/SfgN/0e3UdcbHFAQr3QgsliSxNIzvMZ\nfdhFjK6muzllU/qvYbhHQAY7NvERowBd5ibm6Gk3AeRjmW7QlvERD1fnWRQWjdEn\nUhHxxdtenY43K3JvU2ExdjRKRiFKLvCFPMsO3Q7eT9Ny9eH6GAOKhKHYcAugTT+4\nMZPp0pD2u882mXAjQPVOkcVkoxfXzwqcrQDyFMSVyItt/k1qzHG2NG3MfSc4p7t9\ncQVLD6JiUb03CWXbyY5XJ3EHN5LiefN7iyaGvzGGVaJlvUB+TaVOELsiMmrGWp13\n3bomdO9ZobjeC+7eHyEdt7c3V1LHc+1ry2wVcahcZi0OYjBsr2cWFrBlRlrU8Vzr\novzUA5ygZQO+YuU02pmwb8pmdIchs5K/b/OMvXkiFw8Hlox5+qY0BkvQgZPKYgNL\nSIp5mFNwN4EnrDOeNB8kVBH2dWzz6l5LLeFT9+Qj9YVyDY1bjLo=\n=Dm/m\n-----END PGP SIGNATURE-----",
        "payload": "tree 10ec3fe50820e371ba6de079d7a56ce091e88663\nparent 60b20c869f8df9a81b5080ebcbe8c9cf4e6b9d77\nauthor Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1543491372 +0200\ncommitter Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1543574457 +0200\n\nMove CheckBlock() call to critical section\n\nThis prevents data race for CBlock::fChecked.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c5ed6e73d3e18f26558c49fa3ecb1b7b0bb40d12",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/c5ed6e73d3e18f26558c49fa3ecb1b7b0bb40d12",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c5ed6e73d3e18f26558c49fa3ecb1b7b0bb40d12/comments",
    "author": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "60b20c869f8df9a81b5080ebcbe8c9cf4e6b9d77",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/60b20c869f8df9a81b5080ebcbe8c9cf4e6b9d77",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/60b20c869f8df9a81b5080ebcbe8c9cf4e6b9d77"
      }
    ],
    "stats": {
      "total": 11,
      "additions": 5,
      "deletions": 6
    },
    "files": [
      {
        "sha": "512a3619ca70c2cb5f8507e7f5f2eebcc4650f17",
        "filename": "src/validation.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 3,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c5ed6e73d3e18f26558c49fa3ecb1b7b0bb40d12/src/validation.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c5ed6e73d3e18f26558c49fa3ecb1b7b0bb40d12/src/validation.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/validation.cpp?ref=c5ed6e73d3e18f26558c49fa3ecb1b7b0bb40d12",
        "patch": "@@ -3530,12 +3530,14 @@ bool ProcessNewBlock(const CChainParams& chainparams, const std::shared_ptr<cons\n         CBlockIndex *pindex = nullptr;\n         if (fNewBlock) *fNewBlock = false;\n         CValidationState state;\n-        // Ensure that CheckBlock() passes before calling AcceptBlock, as\n-        // belt-and-suspenders.\n-        bool ret = CheckBlock(*pblock, state, chainparams.GetConsensus());\n \n+        // CheckBlock() does not support multi-threaded block validation because CBlock::fChecked can cause data race.\n+        // Therefore, the following critical section must include the CheckBlock() call as well.\n         LOCK(cs_main);\n \n+        // Ensure that CheckBlock() passes before calling AcceptBlock, as\n+        // belt-and-suspenders.\n+        bool ret = CheckBlock(*pblock, state, chainparams.GetConsensus());\n         if (ret) {\n             // Store to disk\n             ret = g_chainstate.AcceptBlock(pblock, state, chainparams, &pindex, fForceProcessing, nullptr, fNewBlock);"
      },
      {
        "sha": "996f342eb97ddca4c0c1598265da583643fbbe42",
        "filename": "test/sanitizer_suppressions/tsan",
        "status": "modified",
        "additions": 0,
        "deletions": 3,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c5ed6e73d3e18f26558c49fa3ecb1b7b0bb40d12/test/sanitizer_suppressions/tsan",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c5ed6e73d3e18f26558c49fa3ecb1b7b0bb40d12/test/sanitizer_suppressions/tsan",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/sanitizer_suppressions/tsan?ref=c5ed6e73d3e18f26558c49fa3ecb1b7b0bb40d12",
        "patch": "@@ -1,9 +1,6 @@\n # ThreadSanitizer suppressions\n # ============================\n \n-# fChecked is theoretically racy, practically only in unit tests\n-race:CheckBlock\n-\n # WalletBatch (unidentified deadlock)\n deadlock:WalletBatch\n "
      }
    ]
  }
]