[
  {
    "sha": "cce89ead184c6b61a3361e598cc7553512730a72",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpjY2U4OWVhZDE4NGM2YjYxYTMzNjFlNTk4Y2M3NTUzNTEyNzMwYTcy",
    "commit": {
      "author": {
        "name": "Matt Corallo",
        "email": "matt@bluematt.me",
        "date": "2012-02-07T18:46:53Z"
      },
      "committer": {
        "name": "Matt Corallo",
        "email": "matt@bluematt.me",
        "date": "2012-02-10T22:44:52Z"
      },
      "message": "Add -req prefixes to comply with BIP21.",
      "tree": {
        "sha": "5b6cb9a420aafd41cc73951624f6b73030a449aa",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/5b6cb9a420aafd41cc73951624f6b73030a449aa"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/cce89ead184c6b61a3361e598cc7553512730a72",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/cce89ead184c6b61a3361e598cc7553512730a72",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/cce89ead184c6b61a3361e598cc7553512730a72",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/cce89ead184c6b61a3361e598cc7553512730a72/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "328b26d40b2ea046144a487a6b4927a630e91fb9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/328b26d40b2ea046144a487a6b4927a630e91fb9",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/328b26d40b2ea046144a487a6b4927a630e91fb9"
      }
    ],
    "stats": {
      "total": 37,
      "additions": 27,
      "deletions": 10
    },
    "files": [
      {
        "sha": "29ef554ac3de7c5d12796b85c23beb092b01aa1b",
        "filename": "src/qt/guiutil.cpp",
        "status": "modified",
        "additions": 27,
        "deletions": 10,
        "changes": 37,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/cce89ead184c6b61a3361e598cc7553512730a72/src/qt/guiutil.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/cce89ead184c6b61a3361e598cc7553512730a72/src/qt/guiutil.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/guiutil.cpp?ref=cce89ead184c6b61a3361e598cc7553512730a72",
        "patch": "@@ -56,19 +56,36 @@ bool GUIUtil::parseBitcoinURL(const QUrl *url, SendCoinsRecipient *out)\n \n     SendCoinsRecipient rv;\n     rv.address = url->path();\n-    rv.label = url->queryItemValue(\"label\");\n-\n-    QString amount = url->queryItemValue(\"amount\");\n-    if(amount.isEmpty())\n-    {\n-        rv.amount = 0;\n-    }\n-    else // Amount is non-empty\n+    rv.amount = 0;\n+    QList<QPair<QString, QString> > items = url->queryItems();\n+    for (QList<QPair<QString, QString> >::iterator i = items.begin(); i != items.end(); i++)\n     {\n-        if(!BitcoinUnits::parse(BitcoinUnits::BTC, amount, &rv.amount))\n+        bool fShouldReturnFalse = false;\n+        if (i->first.startsWith(\"req-\"))\n         {\n-            return false;\n+            i->first.remove(0, 4);\n+            fShouldReturnFalse = true;\n         }\n+\n+        if (i->first == \"label\")\n+        {\n+            rv.label = i->second;\n+            fShouldReturnFalse = false;\n+        }\n+        else if (i->first == \"amount\")\n+        {\n+            if(!i->second.isEmpty())\n+            {\n+                if(!BitcoinUnits::parse(BitcoinUnits::BTC, i->second, &rv.amount))\n+                {\n+                    return false;\n+                }\n+            }\n+            fShouldReturnFalse = false;\n+        }\n+\n+        if (fShouldReturnFalse)\n+            return false;\n     }\n     if(out)\n     {"
      }
    ]
  },
  {
    "sha": "245484679adbde8df6b0b01baa24393ea20a7aed",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyNDU0ODQ2NzlhZGJkZThkZjZiMGIwMWJhYTI0MzkzZWEyMGE3YWVk",
    "commit": {
      "author": {
        "name": "Matt Corallo",
        "email": "matt@bluematt.me",
        "date": "2012-02-10T22:25:36Z"
      },
      "committer": {
        "name": "Matt Corallo",
        "email": "matt@bluematt.me",
        "date": "2012-02-10T22:47:00Z"
      },
      "message": "Add Bitcoin-Qt test suite with some bitcoin: URL Tests to start.",
      "tree": {
        "sha": "7a8a53463ab47ae2d6d8749212e8fc13199c3e05",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7a8a53463ab47ae2d6d8749212e8fc13199c3e05"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/245484679adbde8df6b0b01baa24393ea20a7aed",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/245484679adbde8df6b0b01baa24393ea20a7aed",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/245484679adbde8df6b0b01baa24393ea20a7aed",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/245484679adbde8df6b0b01baa24393ea20a7aed/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "cce89ead184c6b61a3361e598cc7553512730a72",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/cce89ead184c6b61a3361e598cc7553512730a72",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/cce89ead184c6b61a3361e598cc7553512730a72"
      }
    ],
    "stats": {
      "total": 106,
      "additions": 106,
      "deletions": 0
    },
    "files": [
      {
        "sha": "0eeae86510f4a4abab3debe60b45b092dd5508b9",
        "filename": "bitcoin-qt.pro",
        "status": "modified",
        "additions": 10,
        "deletions": 0,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/245484679adbde8df6b0b01baa24393ea20a7aed/bitcoin-qt.pro",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/245484679adbde8df6b0b01baa24393ea20a7aed/bitcoin-qt.pro",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/bitcoin-qt.pro?ref=245484679adbde8df6b0b01baa24393ea20a7aed",
        "patch": "@@ -226,6 +226,16 @@ SOURCES += src/qt/qrcodedialog.cpp\n FORMS += src/qt/forms/qrcodedialog.ui\n }\n \n+contains(BITCOIN_QT_TEST, 1) {\n+SOURCES += src/qt/test/test_main.cpp \\\n+    src/qt/test/urltests.cpp\n+HEADERS += src/qt/test/urltests.h\n+DEPENDPATH += src/qt/test\n+QT += testlib\n+TARGET = bitcoin-qt_test\n+DEFINES += BITCOIN_QT_TEST\n+}\n+\n CODECFORTR = UTF-8\n \n # for lrelease/lupdate"
      },
      {
        "sha": "8c4b0e6c1053a6d20242d293b435b0da13122c6f",
        "filename": "src/qt/bitcoin.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/245484679adbde8df6b0b01baa24393ea20a7aed/src/qt/bitcoin.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/245484679adbde8df6b0b01baa24393ea20a7aed/src/qt/bitcoin.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/bitcoin.cpp?ref=245484679adbde8df6b0b01baa24393ea20a7aed",
        "patch": "@@ -131,6 +131,7 @@ std::string _(const char* psz)\n     return QCoreApplication::translate(\"bitcoin-core\", psz).toStdString();\n }\n \n+#ifndef BITCOIN_QT_TEST\n int main(int argc, char *argv[])\n {\n     // Do this early as we don't want to bother initializing if we are just calling IPC\n@@ -257,3 +258,4 @@ int main(int argc, char *argv[])\n     }\n     return 0;\n }\n+#endif // BITCOIN_QT_TEST"
      },
      {
        "sha": "0a08eafa1eee3671f7f28ddff2168f80c15f443b",
        "filename": "src/qt/test/test_main.cpp",
        "status": "added",
        "additions": 11,
        "deletions": 0,
        "changes": 11,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/245484679adbde8df6b0b01baa24393ea20a7aed/src/qt/test/test_main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/245484679adbde8df6b0b01baa24393ea20a7aed/src/qt/test/test_main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/test/test_main.cpp?ref=245484679adbde8df6b0b01baa24393ea20a7aed",
        "patch": "@@ -0,0 +1,11 @@\n+#include <QTest>\r\n+#include <QObject>\r\n+\r\n+#include \"urltests.h\"\r\n+\r\n+// This is all you need to run all the tests\r\n+int main(int argc, char *argv[])\r\n+{\r\n+    URLTests test1;\r\n+    QTest::qExec(&test1);\r\n+}\r"
      },
      {
        "sha": "5ecc846203dbb1ceee065edb0251e3c8698025c5",
        "filename": "src/qt/test/urltests.cpp",
        "status": "added",
        "additions": 68,
        "deletions": 0,
        "changes": 68,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/245484679adbde8df6b0b01baa24393ea20a7aed/src/qt/test/urltests.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/245484679adbde8df6b0b01baa24393ea20a7aed/src/qt/test/urltests.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/test/urltests.cpp?ref=245484679adbde8df6b0b01baa24393ea20a7aed",
        "patch": "@@ -0,0 +1,68 @@\n+#include \"urltests.h\"\n+#include \"../guiutil.h\"\n+#include \"../walletmodel.h\"\n+\n+#include <QUrl>\n+\n+/*\n+struct SendCoinsRecipient\n+{\n+    QString address;\n+    QString label;\n+    qint64 amount;\n+};\n+*/\n+\n+void URLTests::urlTests()\n+{\n+    SendCoinsRecipient rv;\n+    QUrl url;\n+    url.setUrl(QString(\"bitcoin:175tWpb8K1S7NmH4Zx6rewF9WQrcZv245W?req-dontexist=\"));\n+    QVERIFY(!GUIUtil::parseBitcoinURL(&url, &rv));\n+\n+    url.setUrl(QString(\"bitcoin:175tWpb8K1S7NmH4Zx6rewF9WQrcZv245W?dontexist=\"));\n+    QVERIFY(GUIUtil::parseBitcoinURL(&url, &rv));\n+    QVERIFY(rv.address == QString(\"175tWpb8K1S7NmH4Zx6rewF9WQrcZv245W\"));\n+    QVERIFY(rv.label == QString());\n+    QVERIFY(rv.amount == 0);\n+\n+    url.setUrl(QString(\"bitcoin:175tWpb8K1S7NmH4Zx6rewF9WQrcZv245W?label=Wikipedia Example Address\"));\n+    QVERIFY(GUIUtil::parseBitcoinURL(&url, &rv));\n+    QVERIFY(rv.address == QString(\"175tWpb8K1S7NmH4Zx6rewF9WQrcZv245W\"));\n+    QVERIFY(rv.label == QString(\"Wikipedia Example Address\"));\n+    QVERIFY(rv.amount == 0);\n+\n+    url.setUrl(QString(\"bitcoin:175tWpb8K1S7NmH4Zx6rewF9WQrcZv245W?amount=0.001\"));\n+    QVERIFY(GUIUtil::parseBitcoinURL(&url, &rv));\n+    QVERIFY(rv.address == QString(\"175tWpb8K1S7NmH4Zx6rewF9WQrcZv245W\"));\n+    QVERIFY(rv.label == QString());\n+    QVERIFY(rv.amount == 100000);\n+\n+    url.setUrl(QString(\"bitcoin:175tWpb8K1S7NmH4Zx6rewF9WQrcZv245W?amount=1.001\"));\n+    QVERIFY(GUIUtil::parseBitcoinURL(&url, &rv));\n+    QVERIFY(rv.address == QString(\"175tWpb8K1S7NmH4Zx6rewF9WQrcZv245W\"));\n+    QVERIFY(rv.label == QString());\n+    QVERIFY(rv.amount == 100100000);\n+\n+    url.setUrl(QString(\"bitcoin:175tWpb8K1S7NmH4Zx6rewF9WQrcZv245W?amount=100&label=Wikipedia Example\"));\n+    QVERIFY(GUIUtil::parseBitcoinURL(&url, &rv));\n+    QVERIFY(rv.address == QString(\"175tWpb8K1S7NmH4Zx6rewF9WQrcZv245W\"));\n+    QVERIFY(rv.amount == 10000000000);\n+    QVERIFY(rv.label == QString(\"Wikipedia Example\"));\n+\n+    url.setUrl(QString(\"bitcoin:175tWpb8K1S7NmH4Zx6rewF9WQrcZv245W?message=Wikipedia Example Address\"));\n+    QVERIFY(GUIUtil::parseBitcoinURL(&url, &rv));\n+    QVERIFY(rv.address == QString(\"175tWpb8K1S7NmH4Zx6rewF9WQrcZv245W\"));\n+    QVERIFY(rv.label == QString());\n+    QVERIFY(rv.label == QString());\n+\n+    // We currently dont implement the message paramenter (ok, yea, we break spec...)\n+    url.setUrl(QString(\"bitcoin:175tWpb8K1S7NmH4Zx6rewF9WQrcZv245W?req-message=Wikipedia Example Address\"));\n+    QVERIFY(!GUIUtil::parseBitcoinURL(&url, &rv));\n+\n+    url.setUrl(QString(\"bitcoin:175tWpb8K1S7NmH4Zx6rewF9WQrcZv245W?amount=1,000&label=Wikipedia Example\"));\n+    QVERIFY(!GUIUtil::parseBitcoinURL(&url, &rv));\n+\n+    url.setUrl(QString(\"bitcoin:175tWpb8K1S7NmH4Zx6rewF9WQrcZv245W?amount=1,000.0&label=Wikipedia Example\"));\n+    QVERIFY(!GUIUtil::parseBitcoinURL(&url, &rv));\n+}"
      },
      {
        "sha": "393c511390974720934a4580ef0445e18e919601",
        "filename": "src/qt/test/urltests.h",
        "status": "added",
        "additions": 15,
        "deletions": 0,
        "changes": 15,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/245484679adbde8df6b0b01baa24393ea20a7aed/src/qt/test/urltests.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/245484679adbde8df6b0b01baa24393ea20a7aed/src/qt/test/urltests.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/test/urltests.h?ref=245484679adbde8df6b0b01baa24393ea20a7aed",
        "patch": "@@ -0,0 +1,15 @@\n+#ifndef URLTESTS_H\n+#define URLTESTS_H\n+\n+#include <QTest>\n+#include <QObject>\n+\n+class URLTests : public QObject\n+{\n+    Q_OBJECT\n+\n+private slots:\n+    void urlTests();\n+};\n+\n+#endif // URLTESTS_H"
      }
    ]
  }
]