[
  {
    "sha": "1fdcbf40c2cfedff85aa344c2a291922ca188266",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxZmRjYmY0MGMyY2ZlZGZmODVhYTM0NGMyYTI5MTkyMmNhMTg4MjY2",
    "commit": {
      "author": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2019-07-29T17:21:50Z"
      },
      "committer": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2019-07-29T17:21:50Z"
      },
      "message": "Replace fScriptChecks in ConnectBlock with fAssumeValid.\n\nWe need this flag to handle masking the BIP34/BIP30 logic.",
      "tree": {
        "sha": "793835b87afacd90bcffa18fa7c452b13dfaffcb",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/793835b87afacd90bcffa18fa7c452b13dfaffcb"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1fdcbf40c2cfedff85aa344c2a291922ca188266",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1fdcbf40c2cfedff85aa344c2a291922ca188266",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/1fdcbf40c2cfedff85aa344c2a291922ca188266",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1fdcbf40c2cfedff85aa344c2a291922ca188266/comments",
    "author": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "68da54987df4d4b76d0696b8139ae2bb32394214",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/68da54987df4d4b76d0696b8139ae2bb32394214",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/68da54987df4d4b76d0696b8139ae2bb32394214"
      }
    ],
    "stats": {
      "total": 8,
      "additions": 4,
      "deletions": 4
    },
    "files": [
      {
        "sha": "220cf3e5ac4342fe43ef9f9d6d10b56281912dc1",
        "filename": "src/validation.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 4,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1fdcbf40c2cfedff85aa344c2a291922ca188266/src/validation.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1fdcbf40c2cfedff85aa344c2a291922ca188266/src/validation.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/validation.cpp?ref=1fdcbf40c2cfedff85aa344c2a291922ca188266",
        "patch": "@@ -1715,7 +1715,7 @@ bool CChainState::ConnectBlock(const CBlock& block, CValidationState& state, CBl\n \n     nBlocksTotal++;\n \n-    bool fScriptChecks = true;\n+    bool fAssumeValid = false;\n     if (!hashAssumeValid.IsNull()) {\n         // We've been configured with the hash of a block which has been externally verified to have a valid history.\n         // A suitable default value is included with the software and updated from time to time.  Because validity\n@@ -1736,7 +1736,7 @@ bool CChainState::ConnectBlock(const CBlock& block, CValidationState& state, CBl\n                 //  artificially set the default assumed verified block further back.\n                 // The test against nMinimumChainWork prevents the skipping when denied access to any chain at\n                 //  least as good as the expected chain.\n-                fScriptChecks = (GetBlockProofEquivalentTime(*pindexBestHeader, *pindex, *pindexBestHeader, chainparams.GetConsensus()) <= 60 * 60 * 24 * 7 * 2);\n+                fAssumeValid = (GetBlockProofEquivalentTime(*pindexBestHeader, *pindex, *pindexBestHeader, chainparams.GetConsensus()) > 60 * 60 * 24 * 7 * 2);\n             }\n         }\n     }\n@@ -1848,7 +1848,7 @@ bool CChainState::ConnectBlock(const CBlock& block, CValidationState& state, CBl\n \n     CBlockUndo blockundo;\n \n-    CCheckQueueControl<CScriptCheck> control(fScriptChecks && nScriptCheckThreads ? &scriptcheckqueue : nullptr);\n+    CCheckQueueControl<CScriptCheck> control(!fAssumeValid && nScriptCheckThreads ? &scriptcheckqueue : nullptr);\n \n     std::vector<int> prevheights;\n     CAmount nFees = 0;\n@@ -1911,7 +1911,7 @@ bool CChainState::ConnectBlock(const CBlock& block, CValidationState& state, CBl\n         {\n             std::vector<CScriptCheck> vChecks;\n             bool fCacheResults = fJustCheck; /* Don't cache results if we're actually connecting blocks (still consult the cache, though) */\n-            if (!CheckInputs(tx, state, view, fScriptChecks, flags, fCacheResults, fCacheResults, txdata[i], nScriptCheckThreads ? &vChecks : nullptr)) {\n+            if (!CheckInputs(tx, state, view, !fAssumeValid, flags, fCacheResults, fCacheResults, txdata[i], nScriptCheckThreads ? &vChecks : nullptr)) {\n                 if (state.GetReason() == ValidationInvalidReason::TX_NOT_STANDARD) {\n                     // CheckInputs may return NOT_STANDARD for extra flags we passed,\n                     // but we can't return that, as it's not defined for a block, so"
      }
    ]
  },
  {
    "sha": "071fd86f0a04d6ea3d260e732fd415da323017c5",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzowNzFmZDg2ZjBhMDRkNmVhM2QyNjBlNzMyZmQ0MTVkYTMyMzAxN2M1",
    "commit": {
      "author": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2019-07-29T17:33:48Z"
      },
      "committer": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2019-07-29T17:33:48Z"
      },
      "message": "Do not enforce BIP30 if the block is assumed to be valid.\n\nThis eliminates the related disk access.",
      "tree": {
        "sha": "349dd097b0487bcaf535b76579cfc4ab28461ea2",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/349dd097b0487bcaf535b76579cfc4ab28461ea2"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/071fd86f0a04d6ea3d260e732fd415da323017c5",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/071fd86f0a04d6ea3d260e732fd415da323017c5",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/071fd86f0a04d6ea3d260e732fd415da323017c5",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/071fd86f0a04d6ea3d260e732fd415da323017c5/comments",
    "author": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "1fdcbf40c2cfedff85aa344c2a291922ca188266",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1fdcbf40c2cfedff85aa344c2a291922ca188266",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/1fdcbf40c2cfedff85aa344c2a291922ca188266"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 2,
      "deletions": 0
    },
    "files": [
      {
        "sha": "c2d7d15e6adda1780a3d56c7dd1662066a3a0637",
        "filename": "src/validation.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/071fd86f0a04d6ea3d260e732fd415da323017c5/src/validation.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/071fd86f0a04d6ea3d260e732fd415da323017c5/src/validation.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/validation.cpp?ref=071fd86f0a04d6ea3d260e732fd415da323017c5",
        "patch": "@@ -1819,6 +1819,8 @@ bool CChainState::ConnectBlock(const CBlock& block, CValidationState& state, CBl\n     CBlockIndex *pindexBIP34height = pindex->pprev->GetAncestor(chainparams.GetConsensus().BIP34Height);\n     //Only continue to enforce if we're below BIP34 activation height or the block hash at that height doesn't correspond.\n     fEnforceBIP30 = fEnforceBIP30 && (!pindexBIP34height || !(pindexBIP34height->GetBlockHash() == chainparams.GetConsensus().BIP34Hash));\n+    // And we're not assuming the block is valid.\n+    fEnforceBIP30 = fEnforceBIP30 && !fAssumeValid;\n \n     // TODO: Remove BIP30 checking from block height 1,983,702 on, once we have a\n     // consensus change that ensures coinbases at those heights can not"
      }
    ]
  }
]