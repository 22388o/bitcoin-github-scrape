{
  "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21102",
  "id": 569000280,
  "node_id": "MDExOlB1bGxSZXF1ZXN0NTY5MDAwMjgw",
  "html_url": "https://github.com/bitcoin/bitcoin/pull/21102",
  "diff_url": "https://github.com/bitcoin/bitcoin/pull/21102.diff",
  "patch_url": "https://github.com/bitcoin/bitcoin/pull/21102.patch",
  "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21102",
  "number": 21102,
  "state": "closed",
  "locked": false,
  "title": "Log: Add debug log category tag",
  "user": {
    "login": "wodry",
    "id": 8447873,
    "node_id": "MDQ6VXNlcjg0NDc4NzM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8447873?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wodry",
    "html_url": "https://github.com/wodry",
    "followers_url": "https://api.github.com/users/wodry/followers",
    "following_url": "https://api.github.com/users/wodry/following{/other_user}",
    "gists_url": "https://api.github.com/users/wodry/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wodry/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wodry/subscriptions",
    "organizations_url": "https://api.github.com/users/wodry/orgs",
    "repos_url": "https://api.github.com/users/wodry/repos",
    "events_url": "https://api.github.com/users/wodry/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wodry/received_events",
    "type": "User",
    "site_admin": false
  },
  "body": "Fixes #21058\r\n\r\nAs the `LogPrint` macro takes the debug log category as parameter, I think it would be nice to have that debug log category also shown together with the according debug log message, to have clear transparency what debug message belongs to what debug category.\r\nIn the past, people inserted the same debug log category name in the message itself, e.g.\r\n`torcontrol.cpp:        LogPrint(BCLog::TOR, \"tor: SAFECOOKIE authentication challenge successful\\n\");`\r\nWith this patch, ~~this would be obsolete, and I would be willing to create a follow-up PR to cleanup that redundancy~~ those then-redundant in-message categories are removed.\r\nHere is a log example how the log looks with this patch and `debug=1`:\r\n```\r\n2021-02-07T15:45:55Z [leveldb] WriteBatch memory usage: db=index, before=0.0MiB, after=0.0MiB\r\n2021-02-07T15:45:55Z [bench] FlushStateToDisk: write block index to disk completed (12.27ms)\r\n2021-02-07T15:45:55Z FlushStateToDisk: write coins cache to disk (69 coins, 11kB) started\r\n2021-02-07T15:45:55Z [coindb] Writing final batch of 0.00 MiB\r\n2021-02-07T15:45:55Z [leveldb] WriteBatch memory usage: db=chainstate, before=0.0MiB, after=0.0MiB\r\n2021-02-07T15:45:55Z [coindb] Committed 0 changed transaction outputs (out of 69) to coin database...\r\n2021-02-07T15:45:55Z FlushStateToDisk: write coins cache to disk (69 coins, 11kB) completed (0.00s)\r\n2021-02-07T15:45:55Z [validation] Enqueuing ChainStateFlushed: block hash=0000000000000025d3499369d144977b6266bac92837748dc452e84cd05bc007\r\n2021-02-07T15:45:55Z [validation] ChainStateFlushed: block hash=0000000000000025d3499369d144977b6266bac92837748dc452e84cd05bc007\r\n2021-02-07T15:45:55Z [bench] FlushStateToDisk: write block and undo data to disk started\r\n2021-02-07T15:45:55Z [bench] FlushStateToDisk: write block and undo data to disk completed (15.44ms)\r\n2021-02-07T15:45:55Z [bench] FlushStateToDisk: write block index to disk started\r\n2021-02-07T15:45:55Z [leveldb] WriteBatch memory usage: db=index, before=0.0MiB, after=0.0MiB\r\n2021-02-07T15:45:55Z [bench] FlushStateToDisk: write block index to disk completed (8.10ms)\r\n2021-02-07T15:45:55Z FlushStateToDisk: write coins cache to disk (0 coins, 0kB) started\r\n2021-02-07T15:45:55Z [coindb] Writing final batch of 0.00 MiB\r\n2021-02-07T15:45:55Z [leveldb] WriteBatch memory usage: db=chainstate, before=0.0MiB, after=0.0MiB\r\n2021-02-07T15:45:55Z [coindb] Committed 0 changed transaction outputs (out of 0) to coin database...\r\n2021-02-07T15:45:55Z FlushStateToDisk: write coins cache to disk (0 coins, 0kB) completed (0.00s)\r\n2021-02-07T15:45:55Z [validation] Enqueuing ChainStateFlushed: block hash=0000000000000025d3499369d144977b6266bac92837748dc452e84cd05bc007\r\n2021-02-07T15:45:55Z Shutdown: done\r\n2021-02-07T15:45:55Z [qt] GUI: shutdown : Shutdown finished\r\n```\r\nI tested also with setting `debug=addrman` and it works, only debug log messages of category `addrman` are logged then, with the prefix.\r\nI think this is a step for the better and there is no drawback. I think there should be a better logging with pairing of log category and log level (e.g. like in Tor log), but that should be out of the scope of this PR.\r\nI have read the developer notes, and because of section \"Source code organization\" I extra included the `#include <map>` in `logging.cpp` allthough it was not needed to successfully compile.\r\n\r\nUnfortunately, I am no C++ expert and I guess there are chances that the places/scope of the definitions may be not optimal.\r\nAny help for doing better is appreciated.\r\nI saw the need to clone the function `LogCategoryPrintf` because I had not seen a way to change `__VA_ARGS__` to insert the log category string in the beginning of the first (format string) parameter.\r\nI have allowed edits by maintainers, too, your are welcome to edit.",
  "created_at": "2021-02-07T16:16:54Z",
  "updated_at": "2021-02-18T18:24:33Z",
  "closed_at": "2021-02-18T18:24:33Z",
  "merged_at": null,
  "merge_commit_sha": "f85c1326a066dd6b8cb0a113c17050706a064d02",
  "assignee": null,
  "assignees": [],
  "requested_reviewers": [],
  "requested_teams": [],
  "labels": [
    {
      "id": 241832923,
      "node_id": "MDU6TGFiZWwyNDE4MzI5MjM=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Utils/log/libs",
      "name": "Utils/log/libs",
      "color": "5319e7",
      "default": false,
      "description": ""
    },
    {
      "id": 955867938,
      "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
      "name": "Needs rebase",
      "color": "cccccc",
      "default": false,
      "description": ""
    }
  ],
  "milestone": null,
  "draft": false,
  "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21102/commits",
  "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21102/comments",
  "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments{/number}",
  "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21102/comments",
  "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/555dbfbfa71ded24cec25bec1755aaa426b52b66",
  "head": {
    "label": "wodry:log-debug-category",
    "ref": "log-debug-category",
    "sha": "555dbfbfa71ded24cec25bec1755aaa426b52b66",
    "user": {
      "login": "wodry",
      "id": 8447873,
      "node_id": "MDQ6VXNlcjg0NDc4NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8447873?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wodry",
      "html_url": "https://github.com/wodry",
      "followers_url": "https://api.github.com/users/wodry/followers",
      "following_url": "https://api.github.com/users/wodry/following{/other_user}",
      "gists_url": "https://api.github.com/users/wodry/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wodry/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wodry/subscriptions",
      "organizations_url": "https://api.github.com/users/wodry/orgs",
      "repos_url": "https://api.github.com/users/wodry/repos",
      "events_url": "https://api.github.com/users/wodry/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wodry/received_events",
      "type": "User",
      "site_admin": false
    },
    "repo": {
      "id": 136525213,
      "node_id": "MDEwOlJlcG9zaXRvcnkxMzY1MjUyMTM=",
      "name": "bitcoin",
      "full_name": "wodry/bitcoin",
      "private": false,
      "owner": {
        "login": "wodry",
        "id": 8447873,
        "node_id": "MDQ6VXNlcjg0NDc4NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8447873?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/wodry",
        "html_url": "https://github.com/wodry",
        "followers_url": "https://api.github.com/users/wodry/followers",
        "following_url": "https://api.github.com/users/wodry/following{/other_user}",
        "gists_url": "https://api.github.com/users/wodry/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/wodry/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/wodry/subscriptions",
        "organizations_url": "https://api.github.com/users/wodry/orgs",
        "repos_url": "https://api.github.com/users/wodry/repos",
        "events_url": "https://api.github.com/users/wodry/events{/privacy}",
        "received_events_url": "https://api.github.com/users/wodry/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/wodry/bitcoin",
      "description": "Bitcoin Core integration/staging tree",
      "fork": true,
      "url": "https://api.github.com/repos/wodry/bitcoin",
      "forks_url": "https://api.github.com/repos/wodry/bitcoin/forks",
      "keys_url": "https://api.github.com/repos/wodry/bitcoin/keys{/key_id}",
      "collaborators_url": "https://api.github.com/repos/wodry/bitcoin/collaborators{/collaborator}",
      "teams_url": "https://api.github.com/repos/wodry/bitcoin/teams",
      "hooks_url": "https://api.github.com/repos/wodry/bitcoin/hooks",
      "issue_events_url": "https://api.github.com/repos/wodry/bitcoin/issues/events{/number}",
      "events_url": "https://api.github.com/repos/wodry/bitcoin/events",
      "assignees_url": "https://api.github.com/repos/wodry/bitcoin/assignees{/user}",
      "branches_url": "https://api.github.com/repos/wodry/bitcoin/branches{/branch}",
      "tags_url": "https://api.github.com/repos/wodry/bitcoin/tags",
      "blobs_url": "https://api.github.com/repos/wodry/bitcoin/git/blobs{/sha}",
      "git_tags_url": "https://api.github.com/repos/wodry/bitcoin/git/tags{/sha}",
      "git_refs_url": "https://api.github.com/repos/wodry/bitcoin/git/refs{/sha}",
      "trees_url": "https://api.github.com/repos/wodry/bitcoin/git/trees{/sha}",
      "statuses_url": "https://api.github.com/repos/wodry/bitcoin/statuses/{sha}",
      "languages_url": "https://api.github.com/repos/wodry/bitcoin/languages",
      "stargazers_url": "https://api.github.com/repos/wodry/bitcoin/stargazers",
      "contributors_url": "https://api.github.com/repos/wodry/bitcoin/contributors",
      "subscribers_url": "https://api.github.com/repos/wodry/bitcoin/subscribers",
      "subscription_url": "https://api.github.com/repos/wodry/bitcoin/subscription",
      "commits_url": "https://api.github.com/repos/wodry/bitcoin/commits{/sha}",
      "git_commits_url": "https://api.github.com/repos/wodry/bitcoin/git/commits{/sha}",
      "comments_url": "https://api.github.com/repos/wodry/bitcoin/comments{/number}",
      "issue_comment_url": "https://api.github.com/repos/wodry/bitcoin/issues/comments{/number}",
      "contents_url": "https://api.github.com/repos/wodry/bitcoin/contents/{+path}",
      "compare_url": "https://api.github.com/repos/wodry/bitcoin/compare/{base}...{head}",
      "merges_url": "https://api.github.com/repos/wodry/bitcoin/merges",
      "archive_url": "https://api.github.com/repos/wodry/bitcoin/{archive_format}{/ref}",
      "downloads_url": "https://api.github.com/repos/wodry/bitcoin/downloads",
      "issues_url": "https://api.github.com/repos/wodry/bitcoin/issues{/number}",
      "pulls_url": "https://api.github.com/repos/wodry/bitcoin/pulls{/number}",
      "milestones_url": "https://api.github.com/repos/wodry/bitcoin/milestones{/number}",
      "notifications_url": "https://api.github.com/repos/wodry/bitcoin/notifications{?since,all,participating}",
      "labels_url": "https://api.github.com/repos/wodry/bitcoin/labels{/name}",
      "releases_url": "https://api.github.com/repos/wodry/bitcoin/releases{/id}",
      "deployments_url": "https://api.github.com/repos/wodry/bitcoin/deployments",
      "created_at": "2018-06-07T20:02:29Z",
      "updated_at": "2021-08-08T04:40:00Z",
      "pushed_at": "2021-08-08T06:54:20Z",
      "git_url": "git://github.com/wodry/bitcoin.git",
      "ssh_url": "git@github.com:wodry/bitcoin.git",
      "clone_url": "https://github.com/wodry/bitcoin.git",
      "svn_url": "https://github.com/wodry/bitcoin",
      "homepage": "https://bitcoin.org/en/download",
      "size": 164742,
      "stargazers_count": 0,
      "watchers_count": 0,
      "language": "C++",
      "has_issues": false,
      "has_projects": true,
      "has_downloads": false,
      "has_wiki": false,
      "has_pages": false,
      "forks_count": 0,
      "mirror_url": null,
      "archived": false,
      "disabled": false,
      "open_issues_count": 0,
      "license": {
        "key": "mit",
        "name": "MIT License",
        "spdx_id": "MIT",
        "url": "https://api.github.com/licenses/mit",
        "node_id": "MDc6TGljZW5zZTEz"
      },
      "allow_forking": true,
      "is_template": false,
      "topics": [],
      "visibility": "public",
      "forks": 0,
      "open_issues": 0,
      "watchers": 0,
      "default_branch": "master"
    }
  },
  "base": {
    "label": "bitcoin:master",
    "ref": "master",
    "sha": "b09ad737eef63ee527083d9a5fafea4c2237470b",
    "user": {
      "login": "bitcoin",
      "id": 528860,
      "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bitcoin",
      "html_url": "https://github.com/bitcoin",
      "followers_url": "https://api.github.com/users/bitcoin/followers",
      "following_url": "https://api.github.com/users/bitcoin/following{/other_user}",
      "gists_url": "https://api.github.com/users/bitcoin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bitcoin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
      "organizations_url": "https://api.github.com/users/bitcoin/orgs",
      "repos_url": "https://api.github.com/users/bitcoin/repos",
      "events_url": "https://api.github.com/users/bitcoin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bitcoin/received_events",
      "type": "Organization",
      "site_admin": false
    },
    "repo": {
      "id": 1181927,
      "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
      "name": "bitcoin",
      "full_name": "bitcoin/bitcoin",
      "private": false,
      "owner": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following{/other_user}",
        "gists_url": "https://api.github.com/users/bitcoin/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/bitcoin/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events{/privacy}",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin",
      "description": "Bitcoin Core integration/staging tree",
      "fork": false,
      "url": "https://api.github.com/repos/bitcoin/bitcoin",
      "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
      "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys{/key_id}",
      "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators{/collaborator}",
      "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
      "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
      "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events{/number}",
      "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
      "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees{/user}",
      "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches{/branch}",
      "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
      "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs{/sha}",
      "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags{/sha}",
      "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs{/sha}",
      "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees{/sha}",
      "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/{sha}",
      "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
      "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
      "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
      "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
      "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
      "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits{/sha}",
      "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits{/sha}",
      "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments{/number}",
      "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments{/number}",
      "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/{+path}",
      "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/{base}...{head}",
      "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
      "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/{archive_format}{/ref}",
      "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
      "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues{/number}",
      "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls{/number}",
      "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones{/number}",
      "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications{?since,all,participating}",
      "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels{/name}",
      "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases{/id}",
      "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
      "created_at": "2010-12-19T15:16:43Z",
      "updated_at": "2021-12-01T19:20:49Z",
      "pushed_at": "2021-12-01T18:09:27Z",
      "git_url": "git://github.com/bitcoin/bitcoin.git",
      "ssh_url": "git@github.com:bitcoin/bitcoin.git",
      "clone_url": "https://github.com/bitcoin/bitcoin.git",
      "svn_url": "https://github.com/bitcoin/bitcoin",
      "homepage": "https://bitcoincore.org/en/download",
      "size": 188184,
      "stargazers_count": 59719,
      "watchers_count": 59719,
      "language": "C++",
      "has_issues": true,
      "has_projects": true,
      "has_downloads": false,
      "has_wiki": false,
      "has_pages": false,
      "forks_count": 30708,
      "mirror_url": null,
      "archived": false,
      "disabled": false,
      "open_issues_count": 1022,
      "license": {
        "key": "mit",
        "name": "MIT License",
        "spdx_id": "MIT",
        "url": "https://api.github.com/licenses/mit",
        "node_id": "MDc6TGljZW5zZTEz"
      },
      "allow_forking": true,
      "is_template": false,
      "topics": [
        "bitcoin",
        "c-plus-plus",
        "cryptocurrency",
        "cryptography",
        "p2p"
      ],
      "visibility": "public",
      "forks": 30708,
      "open_issues": 1022,
      "watchers": 59719,
      "default_branch": "master"
    }
  },
  "_links": {
    "self": {
      "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21102"
    },
    "html": {
      "href": "https://github.com/bitcoin/bitcoin/pull/21102"
    },
    "issue": {
      "href": "https://api.github.com/repos/bitcoin/bitcoin/issues/21102"
    },
    "comments": {
      "href": "https://api.github.com/repos/bitcoin/bitcoin/issues/21102/comments"
    },
    "review_comments": {
      "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21102/comments"
    },
    "review_comment": {
      "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments{/number}"
    },
    "commits": {
      "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21102/commits"
    },
    "statuses": {
      "href": "https://api.github.com/repos/bitcoin/bitcoin/statuses/555dbfbfa71ded24cec25bec1755aaa426b52b66"
    }
  },
  "author_association": "CONTRIBUTOR",
  "auto_merge": null,
  "active_lock_reason": null,
  "merged": false,
  "mergeable": false,
  "rebaseable": false,
  "mergeable_state": "dirty",
  "merged_by": null,
  "comments": 7,
  "review_comments": 0,
  "maintainer_can_modify": false,
  "commits": 3,
  "additions": 82,
  "deletions": 41,
  "changed_files": 10
}