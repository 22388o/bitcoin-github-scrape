[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/682259857",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#issuecomment-682259857",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19825",
    "id": 682259857,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MjI1OTg1Nw==",
    "user": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?u=63e5c438c242094837a9deeda775d77988b508bf&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-28T00:36:27Z",
    "updated_at": "2020-08-28T00:39:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "Because bans have specific durations I'm not sure if this is a good change.  Should a 1 hour ban of foo/16 stop you from adding a 1 year ban of foo/24? \r\n\r\nRight now I already have to undo every ban before adding it to make sure it's not rejected and as a result ends up expiring prematurely.  But if any wider banned blocked every narrower ban, I'm not sure how I could programmatically handle that.  I'd have to have crazy logic interrogated the banlist and broke every larger ban into smaller ones when a smaller one with a different time period was added.\r\n\r\nInstead, I think it should just be consistent in that each ban doesn't interact with an different ban. And when I add a ban for an already existing prefix, it should extend the ban if the new one has a later expiration time.  It would be fine to canonicalize actually equivalent bans (e.g. 1.2.3.4/24 = 1.2.3.0/24).",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/682259857/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/682303669",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#issuecomment-682303669",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19825",
    "id": 682303669,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MjMwMzY2OQ==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-28T03:23:39Z",
    "updated_at": "2021-08-08T18:46:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/682303669/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/682363772",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#issuecomment-682363772",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19825",
    "id": 682363772,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MjM2Mzc3Mg==",
    "user": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?u=65406da0f40524c00b8b647f916d31cbbb449edb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-28T06:59:53Z",
    "updated_at": "2020-08-28T07:00:45Z",
    "author_association": "CONTRIBUTOR",
    "body": "> I'm not sure how I could programmatically handle that. I'd have to have crazy logic interrogated the banlist and broke every larger ban into smaller ones when a smaller one with a different time period was added.\r\n\r\nTotally fair. I can't see either how clients will be able to make tooling with sane logic. I am going to think this through and update the PR with a better solution. Thanks for the feedback and a potential solution, @gmaxwell !",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/682363772/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/682365929",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#issuecomment-682365929",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19825",
    "id": 682365929,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MjM2NTkyOQ==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-28T07:06:04Z",
    "updated_at": "2020-08-28T07:06:04Z",
    "author_association": "MEMBER",
    "body": "Concept ACK on making this consistent. I'll review once you have an updated proposal that addresses gmaxwell's input.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/682365929/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/683187822",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#issuecomment-683187822",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19825",
    "id": 683187822,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MzE4NzgyMg==",
    "user": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?u=65406da0f40524c00b8b647f916d31cbbb449edb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-28T23:24:37Z",
    "updated_at": "2020-09-02T04:38:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "### Potential solution\r\n\r\nLet `(s0, t0)` be an existing ban, where `s0` is a subnet and `t0` is the ban expiration time. The user is now trying to add another ban `(s1, t1)`.\r\n\r\n**Case s1 \u2282 s0:**\r\nIf `t1 <= t0`: return success because the end goal is accomplished - this will minimize client error handling\r\nIf `t1 > t0`: insert `(s1, t1)` into `BanMan`\r\n\r\n**Case s1 \u2287 s0:**\r\nIf `t1 <= t0`: insert `(s1, t1)` into `BanMan`\r\nIf `t1 > t0`: remove `(s0, t0)`, add `(s1, t1)` into `BanMan`\r\n\r\n**Case no overlap:**\r\ninsert `(s1, t1)` into `BanMan`\r\n\r\n**Unban**:\r\nWe will treat unbanning consistent with the semantics of the rpc call: `setban ip remove` i.e. it is the _removal of a ban entry_, not the _addition of an unban entry_. Effectively, unbanning will look for exact matches of ban entries to remove.\r\n\r\nThoughts, @gmaxwell, @jnewbery ?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/683187822/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/683327324",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#issuecomment-683327324",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19825",
    "id": 683327324,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MzMyNzMyNA==",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?u=7999a16349f0df0fb273fffa18e5a955c9d3f11c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-29T18:36:03Z",
    "updated_at": "2020-08-29T18:41:29Z",
    "author_association": "MEMBER",
    "body": "I think that approach makes sense; it's equivalent to treating every ban as a per-IP thing, and remembering the longest-duration ban for each.\r\n\r\nOne question I have is how to make clearbanned consistent with that? This is a bit confusing:\r\n* ban `1.2.3.0/24` for 1h\r\n* ban `1.2.0.0/16` for 2h -> overwrites the previous ban\r\n* unban `1.2.3.0/24` -> failure because no such ban exists\r\n\r\nAnd this:\r\n* ban `1.2.3.0/24` for 1h\r\n* ban `1.2.3.4/32` for 2h -> add a longer ban for smaller range\r\n* unban `1.2.3.0/24` -> works, but leaves 1.2.3.4/32 banned\r\n\r\nWhile:\r\n* ban `1.2.3.0/24` for 2h\r\n* ban `1.2.3.4/32` for 1h -> doesn't do anything\r\n* unban `1.2.3.0/24` -> works, and doesn't leave 1.2.3.4/32 banned\r\n\r\n\r\nI think the most reasonable thing requiring an exact match for *some* ban record when unbanning, but also make it delete all (longer) subranges?\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/683327324/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/683372477",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#issuecomment-683372477",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19825",
    "id": 683372477,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MzM3MjQ3Nw==",
    "user": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?u=63e5c438c242094837a9deeda775d77988b508bf&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-30T03:49:02Z",
    "updated_at": "2020-08-30T03:56:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "I don't really like the banning add removal doing fancy logic.  This will make it extremely hard to have external software add bans, even with the newly proposed behaviour.  It's also unlike access-lists on any networking device I've ever worked with.\r\n\r\nWhat is the downside of the obvious behaviour? There is a list of bans, some of which are shorter-than-maximum-CIDR,  add adds to the list, clear removes from it.  If you have overlapping bans, ... so?  You might expect them to have different durations, or they may come from different sources.\r\n\r\nThe only limitation I'm aware with that approach is that if you want to remove a ban affecting a specific host or subnet more care might be required to remove *all*...  but that could be addressed with a \"removeall\"  e.g.\r\n\r\n```\r\nsetban 1.2/16 add\r\nsetban 1.2.3/24 add\r\nsetban 1.2.3.5/32 remove #does nothing\r\nsetban 1.2.3.5/32 removeall  #removes the 1.2/16 and the 1.2.3/24 ban\r\n```\r\n\r\nThen you can get exact management of the ban list via add/remove,  but also get a \"just make this host work\" removal if that's what you want.  This also doesn't make the resulting banlist depend on the order that you did the insertions, which I believe the logic proposed a few messages up would do (e.g. if you insert less specific then more specific you won't get the same result as more than less (as their times won't match, so in one case you'll just get the less specific and the other case you'll get both).\r\n\r\nI also have a preference for not returning errors when the action the user wants is accomplished, I've had more than a few people using my ban list complain about the wall of errors when they update... though assuming it didn't return an error when it extended the duration, I think that issue would already be eliminated by the changes we've discussed.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/683372477/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/683377943",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#issuecomment-683377943",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19825",
    "id": 683377943,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MzM3Nzk0Mw==",
    "user": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?u=65406da0f40524c00b8b647f916d31cbbb449edb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-30T05:19:46Z",
    "updated_at": "2020-08-30T05:27:10Z",
    "author_association": "CONTRIBUTOR",
    "body": "I agree with the idea that we should interpret `setban ip/mask add time` as \"add a ban entry for this address range\", and not as \"add a ban entry on each single address in the range\". This way of thinking allows for overlapping bans.\r\n\r\nI also agree that unintended side effects like `setban 127.0.0.1/32 remove` removing the ban entry for `127.0.0.1/24` is not good as it means client scripts need to maintain banlist state and execute logic prior to, and after, unbanning.\r\n\r\nFurther agree, on not returning an error when the user intent is accomplished (by a pre-existing ban entry) even if it does not create a new ban entry - I will update the code to reflect that. (Updated the proposal above as well)\r\n\r\n`removeall` is a good idea, perhaps better named `force-remove` and implemented in a follow-up PR? I am open to adding it in here if we believe we need it for atomic commits.\r\n\r\nThe one thing I am unsure about is not consolidating ban entries where possible. In my rookie opinion, `BanEntry{127.0.0.1/32 200}` should be replaced with `{BanEntry 127.0.0.1/24 400}` instead of just having an additional \"dead\" entry. Unnecessary ban entries make every call to `BanMan::IsBanned` a tiny bit more expensive, which makes opening new connections, accepting new connections, and `PeerLogicValidation::ProcessMessage/addr` more expensive. I am new here and don't yet have a good intuitive sense for the frequency of those invocations but it seems like an expense to avoid? \r\n\r\nAfter a couple attempts, I am not able to see how [this proposal](https://github.com/bitcoin/bitcoin/pull/19825#issuecomment-683187822) will mean the banlist will depend on the order of insertions _so long as `banUntil` times are consistent_. I feel sure I'm missing something. Could you please give an example, @gmaxwell ?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/683377943/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/683380125",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#issuecomment-683380125",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19825",
    "id": 683380125,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MzM4MDEyNQ==",
    "user": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?u=63e5c438c242094837a9deeda775d77988b508bf&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-30T05:55:03Z",
    "updated_at": "2020-08-30T05:55:03Z",
    "author_association": "CONTRIBUTOR",
    "body": "The most common usage is a relative time, so the times won't be consistent. :)",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/683380125/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/683383582",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#issuecomment-683383582",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19825",
    "id": 683383582,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MzM4MzU4Mg==",
    "user": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?u=65406da0f40524c00b8b647f916d31cbbb449edb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-30T06:46:09Z",
    "updated_at": "2020-08-30T06:46:09Z",
    "author_association": "CONTRIBUTOR",
    "body": "Ah, I see. So it's safe to say that the banlist would not depend on the order of insertions.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/683383582/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/683396285",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#issuecomment-683396285",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19825",
    "id": 683396285,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MzM5NjI4NQ==",
    "user": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?u=63e5c438c242094837a9deeda775d77988b508bf&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-30T09:13:02Z",
    "updated_at": "2020-08-30T09:13:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "I think it would with what you're suggesting.  You're suggesting that if there is a shorter wider block, and I insert a longer narrower block-- both get added.  But if there is a shorter narrower block and I add a longer wider block the shorter block is removed.\r\n\r\nIf I give both a relative lifetime of 1 day then make the two calls a second apart, then the resulting set of bans depends on the order.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/683396285/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/683449495",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#issuecomment-683449495",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19825",
    "id": 683449495,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MzQ0OTQ5NQ==",
    "user": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?u=65406da0f40524c00b8b647f916d31cbbb449edb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-30T17:48:28Z",
    "updated_at": "2020-08-30T17:48:28Z",
    "author_association": "CONTRIBUTOR",
    "body": "@gmaxwell I still think we are in agreement that _equivalent_ `setban` instructions will produce _identical_ banlists. We seem to be disagreeing as to whether the following two sets of RPC instructions are _equivalent_:\r\n\r\nScript 1:\r\n```\r\nsetban 127.0.0.0/24 add\r\nsleep 1\r\nsetban 127.0.0.0/32 add\r\n```\r\n\r\nScript 2:\r\n```\r\nsetban 127.0.0.0/32 add\r\nsleep 1\r\nsetban 127.0.0.0/24 add\r\n```\r\n\r\nUnless I am missing something, per the current RPC semantics, these are not equivalent instructions and the node will behave differently. In order for the node to behave differently and comply with the instructions, the banlists will have to be different.\r\n\r\nFor the use case you are trying to accomplish (atomic, bulk additions with relative timestamps), I think there are two ways we can be successful:\r\n1. Update the scripts to convert relative times into absolute times\r\n2. Let's scope and work on a new, `addall` rpc which can provide bulk atomic commits to the banlist. I volunteer to take it on if we have consensus.\r\n\r\nI think another interesting thing this conversation highlights is our expectation of where canonical state lives. i.e. Do we expect that `listbanned` will return a cumulative of past `setban` instructions (thereby agreeing with state maintained client-side), or whether `listbanned` is only responsible for painting a canonical picture of the current ban entries. I personally prefer the latter because: (a) Clients should not assume state cannot change as that assumes there are no other clients and (b) Fewer ban entries seems more efficient for the p2p layer.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/683449495/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/687880953",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#issuecomment-687880953",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19825",
    "id": 687880953,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4Nzg4MDk1Mw==",
    "user": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?u=65406da0f40524c00b8b647f916d31cbbb449edb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-06T19:38:43Z",
    "updated_at": "2020-09-06T19:39:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "## Current state of this PR\r\n\r\n### What does the current patch at tip `9cc54bd` do?\r\nIt tries to make `setban` behave consistently whether it is provided with an IP address, or a subnet (IP address range).\r\n\r\nLet `(s0, t0)` be an existing ban, where `s0` is a subnet(a contiguous range of IP addresses) and `t0` is the ban expiration time. The user is now trying to add another ban `(s1, t1)`. If `s1 \u2282 s0 &&  t1 <= t0` the code does nothing because the requested ban is already in place. If `s1 \u2287 s0 && t1 > t0`, we remove `(s0, t0)`, add `(s1, t1)` to consolidate the ban entries. In all other cases we add `(s1, t1)`. More details [here](https://github.com/bitcoin/bitcoin/pull/19825#issue-475008180).\r\n\r\n### What is the unaddressed concern expressed by reviewers?\r\nA reviewer feels that we should not consolidate the ban entries, instead allow redundant ban entries in `BanMan::m_banned`. It is their opinion that this will help keep their existing client scripts simpler. The case they make is that the following scripts should generate identical banlists:\r\n\r\nScript 1:\r\n```\r\nsetban 127.0.0.0/24 add\r\nsleep 1\r\nsetban 127.0.0.0/32 add\r\n```\r\n\r\nScript 2:\r\n```\r\nsetban 127.0.0.0/32 add\r\nsleep 1\r\nsetban 127.0.0.0/24 add\r\n```\r\n\r\nNote: Per current `setban` RPC semantics, `setban ip/subnet add` means, \"ban this ip/subnet for 1 day (86400 seconds)\". i.e. `subnet 127.0.0.0/24 add` == `setban 127.0.0.0/24 add 86400`\r\n\r\n### What is the author's response?\r\nThe author feels that the aforementioned scripts (say, run at t=0) are not equivalent, and therefore produce different banlists. \r\n\r\nScript 1:\r\n```\r\nt=0 \"Ban 127.0.0.0/24 until t=86400\"\r\nt=1 \"Ban 127.0.0.0/32 until t=86401\"\r\n```\r\nAt `t=1`, the node must remember two ban entries `(127.0.0.0/24, 86400)`, `(127.0.0.0/32, 86401)`.\r\n\r\nScript 2:\r\n```\r\nt=0 \"Ban 127.0.0.0/32 until t=86400\"\r\nt=1 \"Ban 127.0.0.0/24 until t=86401\"\r\n```\r\nAt `t=1`, it suffices for the node to only remember `(127.0.0.0/24, 86401)` as `(127.0.0.0/32 \u2282 127.0.0.0/24) && (86400 <= 86401)`.\r\n\r\nThe author also feels that not consolidating ban entries when possible (and cheap) creates expense in looking up `BanMan::IsBanned(subnet)` which is done when new peers are added, or when the `addr` RPC is processed. The author agrees the overhead is seems minimal and infrequent.\r\n\r\n### How can reviewers help?\r\nThe author is new to Bitcoin development and will continue to keep an open mind. Any case that can be made in interest of the node efficiency or the Bitcoin network, or shows that the proposed change violates established RPC semantics/expectations and therefore is backwards incompatible would help make the case to no longer consolidate ban entries.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/687880953/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/699893518",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#issuecomment-699893518",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19825",
    "id": 699893518,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5OTg5MzUxOA==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-28T09:29:51Z",
    "updated_at": "2020-09-28T16:14:51Z",
    "author_association": "MEMBER",
    "body": "I agree with @gmaxwell's suggestion here: https://github.com/bitcoin/bitcoin/pull/19825#issuecomment-683372477 that we shouldn't try to do any clever logic.\r\n\r\nI think the behaviour should be:\r\n\r\n- for `setban add`:\r\n    - Convert the IP address/net into the canonical CIDR subnet representation\r\n    - If that subnet is not already banned, add an entry\r\n    - If that subnet is already banned:\r\n        - if the new expiry is after old expiry, update the entry to the new expiry (i.e. `setban add` can extend an existing ban)\r\n        - if the new expiry is before the old expiry, don't update the entry to the new expiry (i.e. `setban add` can't shorten an existing ban)\r\n- for `setban remove`:\r\n    - Convert the IP address/net into the canonical CIDR subet representation\r\n    - If that subnet is already banned, remove the ban\r\n\r\nand then add two new commands:\r\n\r\n- `setban list` (only accepts a single IP address, not a subnet): lists all current ban entries that contain that IP address\r\n- `setban removeall` (only accepts a single IP address, not a subnet): removes all current ban entries that contain that IP address",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/699893518/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/700088723",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#issuecomment-700088723",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19825",
    "id": 700088723,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMDA4ODcyMw==",
    "user": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?u=65406da0f40524c00b8b647f916d31cbbb449edb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-28T15:30:22Z",
    "updated_at": "2020-09-28T15:30:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thank you for the kind review, @jnewbery. I've heard the same opinion from another casual in-person conversation. It seems like @practicalswift agrees as well. Sounds like there is consensus that simplicity of logic wins over performance in this case, especially given the minimal overhead. I will re-work the PR this week.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/700088723/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/744235473",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#issuecomment-744235473",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19825",
    "id": 744235473,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0NDIzNTQ3Mw==",
    "user": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?u=65406da0f40524c00b8b647f916d31cbbb449edb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-14T07:30:42Z",
    "updated_at": "2020-12-14T07:30:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "@jnewbery @gmaxwell @practicalswift I've changed the code to reflect what we agreed on. \r\n\r\n### Objectives:\r\n1. Consolidate `BanMan` functions\r\n2. Throw fewer RPC errors. If user intent is accomplished, the command is successful even if no change was made.\r\n\r\n### Changes:\r\n- Remove `BanMan::Ban(CNetAddr&)` and use `BanMan::Ban(CSubNet&)` instead (ips are subnets of one)\r\n  - RPC change: `setban subnet/ip add` now allows adding a ban entry for an ip in an already banned subnet. No error will be thrown so long as the user intent is accomplished.\r\n- Remove `BanMan::Unban(CNetAddr&)` and use `BanMan::Unban(CSubNet&)` instead (ips are subnets of one)\r\n  - RPC change: Unbanning a non-banned subnet will no longer raise an rpc error as user intent is accomplished.\r\n- Remove unused `BanMan::IsBanned(CSubNet&)`\r\n- RPC change: Add `setban ip removeall` to remove all ban entries that include an IP address\r\n- RPC change: Add `listbanned ip` to return all ban entries that include an IP address",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/744235473/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/744243806",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#issuecomment-744243806",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19825",
    "id": 744243806,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0NDI0MzgwNg==",
    "user": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?u=65406da0f40524c00b8b647f916d31cbbb449edb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-14T07:44:29Z",
    "updated_at": "2020-12-14T07:44:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "Force pushed again to alter commit messages. Ready for review.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/744243806/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/753829686",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#issuecomment-753829686",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19825",
    "id": 753829686,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1MzgyOTY4Ng==",
    "user": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?u=65406da0f40524c00b8b647f916d31cbbb449edb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-04T08:19:07Z",
    "updated_at": "2021-01-04T08:19:07Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thank you for the reviews, @glozow @jnewbery. Comments addressed. Rebased. Ready for further review.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/753829686/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/759254983",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#issuecomment-759254983",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19825",
    "id": 759254983,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1OTI1NDk4Mw==",
    "user": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?u=65406da0f40524c00b8b647f916d31cbbb449edb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-13T07:13:18Z",
    "updated_at": "2021-01-13T07:13:38Z",
    "author_association": "CONTRIBUTOR",
    "body": "Rebased and addressed https://github.com/bitcoin/bitcoin/pull/19825#discussion_r553899004. Ready for further review.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/759254983/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/766193756",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#issuecomment-766193756",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19825",
    "id": 766193756,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2NjE5Mzc1Ng==",
    "user": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?u=348c27f90b6fff8fd72fa27232272651436a2ff0&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjahr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-23T22:42:37Z",
    "updated_at": "2021-01-23T22:42:37Z",
    "author_association": "CONTRIBUTOR",
    "body": "Concept ACK",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/766193756/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/767924279",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#issuecomment-767924279",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19825",
    "id": 767924279,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2NzkyNDI3OQ==",
    "user": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?u=65406da0f40524c00b8b647f916d31cbbb449edb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-27T00:33:22Z",
    "updated_at": "2021-01-27T00:33:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "Rebased and comments addressed. Ready for review.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/767924279/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/768062803",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#issuecomment-768062803",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19825",
    "id": 768062803,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2ODA2MjgwMw==",
    "user": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?u=65406da0f40524c00b8b647f916d31cbbb449edb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-27T06:23:24Z",
    "updated_at": "2021-01-27T06:23:24Z",
    "author_association": "CONTRIBUTOR",
    "body": "Failing test fixed. Ready for review.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/768062803/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/769317861",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#issuecomment-769317861",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19825",
    "id": 769317861,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2OTMxNzg2MQ==",
    "user": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?u=65406da0f40524c00b8b647f916d31cbbb449edb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-28T19:25:37Z",
    "updated_at": "2021-02-06T02:45:53Z",
    "author_association": "CONTRIBUTOR",
    "body": "Rebased. Ready for further review.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/769317861/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/825927339",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#issuecomment-825927339",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19825",
    "id": 825927339,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyNTkyNzMzOQ==",
    "user": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?u=65406da0f40524c00b8b647f916d31cbbb449edb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-23T21:09:52Z",
    "updated_at": "2021-04-23T21:09:52Z",
    "author_association": "CONTRIBUTOR",
    "body": "Rebased. Ready for further review.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/825927339/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/889849378",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#issuecomment-889849378",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19825",
    "id": 889849378,
    "node_id": "IC_kwDOABII5841CgYi",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-30T12:08:58Z",
    "updated_at": "2021-07-30T12:08:58Z",
    "author_association": "MEMBER",
    "body": "Needs rebase to drop already merged hunks in the fuzz tests",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/889849378/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/929054558",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#issuecomment-929054558",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19825",
    "id": 929054558,
    "node_id": "IC_kwDOABII5843YD9e",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?u=06eb9ae4f9b3f954056098860decccbf1340e40f&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-28T10:18:25Z",
    "updated_at": "2021-09-28T10:18:25Z",
    "author_association": "MEMBER",
    "body": "Okay, a lot of things here:\r\n1. I like the consolidation because it removes code.\r\n2. I don\u2019t see a big difference between a no-op and throwing an error?\r\n3. I think UnbanAll would be better if it affected everything downwards (all bans for subnets of given net), not upwards. For \u201cunban all above-nets of a specific addr\u201d, I don\u2019t see a use-case (maybe you can point out one?). If you really want to connect to a given addr, use white list?\r\n4. Same for listbanned",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/929054558/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550812551",
    "pull_request_review_id": 560608091,
    "id": 550812551,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDgxMjU1MQ==",
    "diff_hunk": "@@ -38,11 +38,6 @@ void test_one_input(const std::vector<uint8_t>& buffer)\n         BanMan ban_man{banlist_file, nullptr, ConsumeBanTimeOffset(fuzzed_data_provider)};\n         while (fuzzed_data_provider.ConsumeBool()) {\n             switch (fuzzed_data_provider.ConsumeIntegralInRange<int>(0, 11)) {",
    "path": "src/test/fuzz/banman.cpp",
    "position": null,
    "original_position": 3,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "a39cca4266813711d3b76a7f31c770e55df1ffd4",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Should this be switching on a range of cases 0 to 8 now?",
    "created_at": "2021-01-01T22:10:14Z",
    "updated_at": "2021-04-23T20:25:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r550812551",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550812551"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r550812551"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550812551/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 40,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550813836",
    "pull_request_review_id": 560608091,
    "id": 550813836,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDgxMzgzNg==",
    "diff_hunk": "@@ -9,6 +9,7 @@\n from test_framework.util import (\n     assert_equal,\n     assert_raises_rpc_error,\n+    assert_approx,",
    "path": "test/functional/p2p_disconnect_ban.py",
    "position": null,
    "original_position": 4,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "a39cca4266813711d3b76a7f31c770e55df1ffd4",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: sort alphabetically",
    "created_at": "2021-01-01T22:24:46Z",
    "updated_at": "2021-04-23T20:25:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r550813836",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550813836"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r550813836"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550813836/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 12,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550820325",
    "pull_request_review_id": 560608091,
    "id": 550820325,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDgyMDMyNQ==",
    "diff_hunk": "@@ -159,12 +135,43 @@ bool BanMan::Unban(const CSubNet& sub_net)\n     return true;\n }\n \n-void BanMan::GetBanned(banmap_t& banmap)\n+void BanMan::UnbanAll(const CNetAddr& net_addr)\n+{\n+    {\n+        LOCK(m_cs_banned);\n+        std::vector<CSubNet> entries_to_delete;\n+        for (const auto& it : m_banned) {\n+            CSubNet sub_net = it.first;\n+            if (sub_net.Match(net_addr)) entries_to_delete.push_back(sub_net);\n+        }\n+\n+        if (!entries_to_delete.empty()) m_is_dirty = true;\n+        for (const auto&it : entries_to_delete) {\n+            m_banned.erase(it);\n+        }",
    "path": "src/banman.cpp",
    "position": null,
    "original_position": 79,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "a39cca4266813711d3b76a7f31c770e55df1ffd4",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Why not erase as you go and use `m_banned.size()` to infer `m_is_dirty`, instead of constructing a whole new vector?",
    "created_at": "2021-01-01T23:37:49Z",
    "updated_at": "2021-04-23T20:25:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r550820325",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550820325"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r550820325"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550820325/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 142,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 150,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550820394",
    "pull_request_review_id": 560608091,
    "id": 550820394,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDgyMDM5NA==",
    "diff_hunk": "@@ -159,12 +135,43 @@ bool BanMan::Unban(const CSubNet& sub_net)\n     return true;\n }\n \n-void BanMan::GetBanned(banmap_t& banmap)\n+void BanMan::UnbanAll(const CNetAddr& net_addr)\n+{\n+    {\n+        LOCK(m_cs_banned);\n+        std::vector<CSubNet> entries_to_delete;\n+        for (const auto& it : m_banned) {\n+            CSubNet sub_net = it.first;\n+            if (sub_net.Match(net_addr)) entries_to_delete.push_back(sub_net);\n+        }\n+\n+        if (!entries_to_delete.empty()) m_is_dirty = true;\n+        for (const auto&it : entries_to_delete) {\n+            m_banned.erase(it);\n+        }\n+    }\n+\n+    if (m_client_interface) m_client_interface->BannedListChanged();\n+    DumpBanlist(); //store banlist to disk immediately\n+}\n+\n+void BanMan::GetBanned(banmap_t& banmap, Optional<const CNetAddr&> filterForIp)\n {\n     LOCK(m_cs_banned);\n     // Sweep the banlist so expired bans are not returned\n     SweepBanned();\n     banmap = m_banned; //create a thread safe copy\n+\n+    if (filterForIp) {",
    "path": "src/banman.cpp",
    "position": null,
    "original_position": 93,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "a39cca4266813711d3b76a7f31c770e55df1ffd4",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "same, I wonder if this could just be a `std::remove_if`",
    "created_at": "2021-01-01T23:38:32Z",
    "updated_at": "2021-04-23T20:25:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r550820394",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550820394"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r550820394"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550820394/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 163,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550820714",
    "pull_request_review_id": 560608091,
    "id": 550820714,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDgyMDcxNA==",
    "diff_hunk": "@@ -702,7 +686,9 @@ static RPCHelpMan listbanned()\n {\n     return RPCHelpMan{\"listbanned\",\n                 \"\\nList all manually banned IPs/Subnets.\\n\",\n-                {},\n+                {\n+                    {\"ip\", RPCArg::Type::STR, \"all ips\", \"If IP is provided, only bans which include the IP will be returned.\"},",
    "path": "src/rpc/net.cpp",
    "position": null,
    "original_position": 97,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "a39cca4266813711d3b76a7f31c770e55df1ffd4",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "`RPCArg::Optional::OMITTED_NAMED_ARG`?",
    "created_at": "2021-01-01T23:43:37Z",
    "updated_at": "2021-04-23T20:25:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r550820714",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550820714"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r550820714"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550820714/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 690,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550885005",
    "pull_request_review_id": 560637706,
    "id": 550885005,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDg4NTAwNQ==",
    "diff_hunk": "@@ -159,12 +135,43 @@ bool BanMan::Unban(const CSubNet& sub_net)\n     return true;\n }\n \n-void BanMan::GetBanned(banmap_t& banmap)\n+void BanMan::UnbanAll(const CNetAddr& net_addr)\n+{\n+    {\n+        LOCK(m_cs_banned);\n+        std::vector<CSubNet> entries_to_delete;\n+        for (const auto& it : m_banned) {\n+            CSubNet sub_net = it.first;\n+            if (sub_net.Match(net_addr)) entries_to_delete.push_back(sub_net);\n+        }\n+\n+        if (!entries_to_delete.empty()) m_is_dirty = true;\n+        for (const auto&it : entries_to_delete) {\n+            m_banned.erase(it);\n+        }",
    "path": "src/banman.cpp",
    "position": null,
    "original_position": 79,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "a39cca4266813711d3b76a7f31c770e55df1ffd4",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Using erase-remove_if is also more efficient - you'll only need to pass over `m_banned` once instead of up to `entries_to_delete.size()` times.",
    "created_at": "2021-01-02T14:06:28Z",
    "updated_at": "2021-04-23T20:25:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r550885005",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550885005"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r550885005"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550885005/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 142,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 150,
    "side": "RIGHT",
    "in_reply_to_id": 550820325
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550914703",
    "pull_request_review_id": 560652507,
    "id": 550914703,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDkxNDcwMw==",
    "diff_hunk": "@@ -159,12 +135,43 @@ bool BanMan::Unban(const CSubNet& sub_net)\n     return true;\n }\n \n-void BanMan::GetBanned(banmap_t& banmap)\n+void BanMan::UnbanAll(const CNetAddr& net_addr)\n+{\n+    {\n+        LOCK(m_cs_banned);\n+        std::vector<CSubNet> entries_to_delete;\n+        for (const auto& it : m_banned) {\n+            CSubNet sub_net = it.first;\n+            if (sub_net.Match(net_addr)) entries_to_delete.push_back(sub_net);\n+        }\n+\n+        if (!entries_to_delete.empty()) m_is_dirty = true;\n+        for (const auto&it : entries_to_delete) {\n+            m_banned.erase(it);\n+        }",
    "path": "src/banman.cpp",
    "position": null,
    "original_position": 79,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "a39cca4266813711d3b76a7f31c770e55df1ffd4",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "yeah `erase_if` would be the best but it's C++20 \ud83d\ude2d ",
    "created_at": "2021-01-02T19:48:45Z",
    "updated_at": "2021-04-23T20:25:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r550914703",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550914703"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r550914703"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550914703/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 142,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 150,
    "side": "RIGHT",
    "in_reply_to_id": 550820325
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/551148954",
    "pull_request_review_id": 560816164,
    "id": 551148954,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTE0ODk1NA==",
    "diff_hunk": "@@ -38,11 +38,6 @@ void test_one_input(const std::vector<uint8_t>& buffer)\n         BanMan ban_man{banlist_file, nullptr, ConsumeBanTimeOffset(fuzzed_data_provider)};\n         while (fuzzed_data_provider.ConsumeBool()) {\n             switch (fuzzed_data_provider.ConsumeIntegralInRange<int>(0, 11)) {",
    "path": "src/test/fuzz/banman.cpp",
    "position": null,
    "original_position": 3,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "a39cca4266813711d3b76a7f31c770e55df1ffd4",
    "user": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yup - could increase test coverage. Done. ",
    "created_at": "2021-01-04T07:16:32Z",
    "updated_at": "2021-04-23T20:25:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r551148954",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/551148954"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r551148954"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/551148954/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 40,
    "side": "RIGHT",
    "in_reply_to_id": 550812551
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/551151768",
    "pull_request_review_id": 560819738,
    "id": 551151768,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTE1MTc2OA==",
    "diff_hunk": "@@ -159,12 +135,43 @@ bool BanMan::Unban(const CSubNet& sub_net)\n     return true;\n }\n \n-void BanMan::GetBanned(banmap_t& banmap)\n+void BanMan::UnbanAll(const CNetAddr& net_addr)\n+{\n+    {\n+        LOCK(m_cs_banned);\n+        std::vector<CSubNet> entries_to_delete;\n+        for (const auto& it : m_banned) {\n+            CSubNet sub_net = it.first;\n+            if (sub_net.Match(net_addr)) entries_to_delete.push_back(sub_net);\n+        }\n+\n+        if (!entries_to_delete.empty()) m_is_dirty = true;\n+        for (const auto&it : entries_to_delete) {\n+            m_banned.erase(it);\n+        }",
    "path": "src/banman.cpp",
    "position": null,
    "original_position": 79,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "a39cca4266813711d3b76a7f31c770e55df1ffd4",
    "user": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Since `map.erase(it)` invalidates `it` I was doing a double-pass to avoid incrementing `it`. However, it turns out `erase` will [return the Iterator](https://en.cppreference.com/w/cpp/container/map/erase) following the last removed element. So I've updated the code to use that.\r\n\r\n@jnewbery I am confused about this:\r\n> you'll only need to pass over m_banned once instead of up to entries_to_delete.size() times.\r\n\r\nI think the code is only passing over `m_banned` once. Am I missing something? I also tried erase-remove_if but it does not seem to work for associative containers. Is there an example I can learn from?",
    "created_at": "2021-01-04T07:26:22Z",
    "updated_at": "2021-04-23T20:25:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r551151768",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/551151768"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r551151768"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/551151768/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 142,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 150,
    "side": "RIGHT",
    "in_reply_to_id": 550820325
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/551151825",
    "pull_request_review_id": 560819808,
    "id": 551151825,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTE1MTgyNQ==",
    "diff_hunk": "@@ -159,12 +135,43 @@ bool BanMan::Unban(const CSubNet& sub_net)\n     return true;\n }\n \n-void BanMan::GetBanned(banmap_t& banmap)\n+void BanMan::UnbanAll(const CNetAddr& net_addr)\n+{\n+    {\n+        LOCK(m_cs_banned);\n+        std::vector<CSubNet> entries_to_delete;\n+        for (const auto& it : m_banned) {\n+            CSubNet sub_net = it.first;\n+            if (sub_net.Match(net_addr)) entries_to_delete.push_back(sub_net);\n+        }\n+\n+        if (!entries_to_delete.empty()) m_is_dirty = true;\n+        for (const auto&it : entries_to_delete) {\n+            m_banned.erase(it);\n+        }\n+    }\n+\n+    if (m_client_interface) m_client_interface->BannedListChanged();\n+    DumpBanlist(); //store banlist to disk immediately\n+}\n+\n+void BanMan::GetBanned(banmap_t& banmap, Optional<const CNetAddr&> filterForIp)\n {\n     LOCK(m_cs_banned);\n     // Sweep the banlist so expired bans are not returned\n     SweepBanned();\n     banmap = m_banned; //create a thread safe copy\n+\n+    if (filterForIp) {",
    "path": "src/banman.cpp",
    "position": null,
    "original_position": 93,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "a39cca4266813711d3b76a7f31c770e55df1ffd4",
    "user": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done.",
    "created_at": "2021-01-04T07:26:33Z",
    "updated_at": "2021-04-23T20:25:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r551151825",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/551151825"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r551151825"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/551151825/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 163,
    "side": "RIGHT",
    "in_reply_to_id": 550820394
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/551152004",
    "pull_request_review_id": 560819942,
    "id": 551152004,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTE1MjAwNA==",
    "diff_hunk": "@@ -702,7 +686,9 @@ static RPCHelpMan listbanned()\n {\n     return RPCHelpMan{\"listbanned\",\n                 \"\\nList all manually banned IPs/Subnets.\\n\",\n-                {},\n+                {\n+                    {\"ip\", RPCArg::Type::STR, \"all ips\", \"If IP is provided, only bans which include the IP will be returned.\"},",
    "path": "src/rpc/net.cpp",
    "position": null,
    "original_position": 97,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "a39cca4266813711d3b76a7f31c770e55df1ffd4",
    "user": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks for showing me that. Much better.",
    "created_at": "2021-01-04T07:26:54Z",
    "updated_at": "2021-04-23T20:25:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r551152004",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/551152004"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r551152004"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/551152004/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 690,
    "side": "RIGHT",
    "in_reply_to_id": 550820714
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/551161796",
    "pull_request_review_id": 560832354,
    "id": 551161796,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTE2MTc5Ng==",
    "diff_hunk": "@@ -77,7 +77,7 @@ class BanMan\n \n     // Removes all ban entries that include net_addr\n     void UnbanAll(const CNetAddr& net_addr);\n-    void GetBanned(banmap_t& banmap);\n+    void GetBanned(banmap_t& banmap, std::optional<const CNetAddr> filterForIp = {});",
    "path": "src/banman.h",
    "position": null,
    "original_position": 29,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "e650bba6fd9bd399ad67a13758189652888bdf04",
    "user": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "#20671 was merged, so I'm now using `std::optional` instead of `boost::optional`. \r\n\r\n`std::optional<T>` is considered ill-formed if `is_reference_v<T>` and also if `!is_destructible_v<T>`. So we can't use `std::optional<const CNetAddr&>` and can't forward declare `CNetAddr` and `CSubNet` in this file (incomplete types are not destructible).",
    "created_at": "2021-01-04T07:57:04Z",
    "updated_at": "2021-04-23T20:25:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r551161796",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/551161796"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r551161796"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/551161796/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 80,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/553899004",
    "pull_request_review_id": 564201100,
    "id": 553899004,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mzg5OTAwNA==",
    "diff_hunk": "@@ -77,7 +77,7 @@ class BanMan\n \n     // Removes all ban entries that include net_addr\n     void UnbanAll(const CNetAddr& net_addr);\n-    void GetBanned(banmap_t& banmap);\n+    void GetBanned(banmap_t& banmap, std::optional<const CNetAddr> filterForIp = {});",
    "path": "src/banman.h",
    "position": null,
    "original_position": 29,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "e650bba6fd9bd399ad67a13758189652888bdf04",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think better than adding this `std::optional<CNetAddr>` would be to just overload the `GetBanned()` function, since most of the logic in the function is now specific to the one case where you pass a filterForIp. Those feel like almost two different functional interfaces.\r\n\r\nI think better yet would be to do the filtering logic inside the RPC `listbanned()` function. It's not required by any other callers, so I don't think there's a need to add it to banman. If other callers need the same filtering logic at some point in the future, the logic can be moved into banman at that point.",
    "created_at": "2021-01-08T11:46:50Z",
    "updated_at": "2021-04-23T20:25:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r553899004",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/553899004"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r553899004"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/553899004/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 80,
    "side": "RIGHT",
    "in_reply_to_id": 551161796
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/556304555",
    "pull_request_review_id": 566942122,
    "id": 556304555,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjMwNDU1NQ==",
    "diff_hunk": "@@ -77,7 +77,7 @@ class BanMan\n \n     // Removes all ban entries that include net_addr\n     void UnbanAll(const CNetAddr& net_addr);\n-    void GetBanned(banmap_t& banmap);\n+    void GetBanned(banmap_t& banmap, std::optional<const CNetAddr> filterForIp = {});",
    "path": "src/banman.h",
    "position": null,
    "original_position": 29,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "e650bba6fd9bd399ad67a13758189652888bdf04",
    "user": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "That sounds good. Updated code accordingly.",
    "created_at": "2021-01-13T07:11:50Z",
    "updated_at": "2021-04-23T20:25:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r556304555",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/556304555"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r556304555"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/556304555/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 80,
    "side": "RIGHT",
    "in_reply_to_id": 551161796
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557294946",
    "pull_request_review_id": 568104145,
    "id": 557294946,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzI5NDk0Ng==",
    "diff_hunk": "@@ -159,12 +135,43 @@ bool BanMan::Unban(const CSubNet& sub_net)\n     return true;\n }\n \n-void BanMan::GetBanned(banmap_t& banmap)\n+void BanMan::UnbanAll(const CNetAddr& net_addr)\n+{\n+    {\n+        LOCK(m_cs_banned);\n+        std::vector<CSubNet> entries_to_delete;\n+        for (const auto& it : m_banned) {\n+            CSubNet sub_net = it.first;\n+            if (sub_net.Match(net_addr)) entries_to_delete.push_back(sub_net);\n+        }\n+\n+        if (!entries_to_delete.empty()) m_is_dirty = true;\n+        for (const auto&it : entries_to_delete) {\n+            m_banned.erase(it);\n+        }",
    "path": "src/banman.cpp",
    "position": null,
    "original_position": 79,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "a39cca4266813711d3b76a7f31c770e55df1ffd4",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Sorry. I mistakenly thought that `m_banned` was a vector.",
    "created_at": "2021-01-14T10:31:10Z",
    "updated_at": "2021-04-23T20:25:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r557294946",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557294946"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r557294946"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557294946/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 142,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 150,
    "side": "RIGHT",
    "in_reply_to_id": 550820325
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557295685",
    "pull_request_review_id": 568105129,
    "id": 557295685,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzI5NTY4NQ==",
    "diff_hunk": "@@ -38,47 +38,34 @@ FUZZ_TARGET_INIT(banman, initialize_banman)\n     {\n         BanMan ban_man{banlist_file, nullptr, ConsumeBanTimeOffset(fuzzed_data_provider)};\n         while (fuzzed_data_provider.ConsumeBool()) {\n-            switch (fuzzed_data_provider.ConsumeIntegralInRange<int>(0, 11)) {\n+            switch (fuzzed_data_provider.ConsumeIntegralInRange<int>(0, 6)) {\n             case 0: {\n-                ban_man.Ban(ConsumeNetAddr(fuzzed_data_provider),\n-                    ConsumeBanTimeOffset(fuzzed_data_provider), fuzzed_data_provider.ConsumeBool());\n-                break;\n-            }\n-            case 1: {",
    "path": "src/test/fuzz/banman.cpp",
    "position": null,
    "original_position": 11,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "38abc322d3c66c59fb9189ac9d2a5c4aadf8b0e9",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "After you rebase, you may want to apply this patch: https://github.com/bitcoin/bitcoin/issues/20837#issuecomment-760097060",
    "created_at": "2021-01-14T10:32:25Z",
    "updated_at": "2021-04-23T20:25:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r557295685",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557295685"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r557295685"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557295685/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 47,
    "side": "LEFT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/563718303",
    "pull_request_review_id": 575389315,
    "id": 563718303,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MzcxODMwMw==",
    "diff_hunk": "@@ -159,6 +135,25 @@ bool BanMan::Unban(const CSubNet& sub_net)\n     return true;\n }\n \n+void BanMan::UnbanAll(const CNetAddr& net_addr)\n+{\n+    {\n+        LOCK(m_cs_banned);\n+        for (auto it = m_banned.begin(); it != m_banned.end();) {\n+            CSubNet sub_net = it->first;\n+            if (sub_net.Match(net_addr)) {\n+                it = m_banned.erase(it);\n+                m_is_dirty = true;\n+            } else {\n+                it++;",
    "path": "src/banman.cpp",
    "position": null,
    "original_position": 75,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "38abc322d3c66c59fb9189ac9d2a5c4aadf8b0e9",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "579eaaa prefer prefix iterator over postfix one (see developer-notes.md)",
    "created_at": "2021-01-25T13:22:31Z",
    "updated_at": "2021-04-23T20:25:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r563718303",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/563718303"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r563718303"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/563718303/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 148,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/563718976",
    "pull_request_review_id": 575389315,
    "id": 563718976,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MzcxODk3Ng==",
    "diff_hunk": "@@ -663,7 +663,7 @@ static RPCHelpMan setban()\n                 \"\\nAttempts to add or remove an IP/Subnet from the banned list.\\n\",\n                 {\n                     {\"subnet\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The IP/Subnet (see getpeerinfo for nodes IP) with an optional netmask (default is /32 = single IP)\"},\n-                    {\"command\", RPCArg::Type::STR, RPCArg::Optional::NO, \"'add' to add an IP/Subnet to the list, 'remove' to remove an IP/Subnet from the list\"},\n+                    {\"command\", RPCArg::Type::STR, RPCArg::Optional::NO, \"'add' to add an IP/Subnet to the list, 'remove' to remove an IP/Subnet from the list, 'removeall' to remove all bans that include the single ip address\"},",
    "path": "src/rpc/net.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "38abc322d3c66c59fb9189ac9d2a5c4aadf8b0e9",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "579eaaa\r\n```suggestion\r\n                    {\"command\", RPCArg::Type::STR, RPCArg::Optional::NO, \"'add' to add an IP/Subnet to the list, 'remove' to remove an IP/Subnet from the list, 'removeall' to remove all bans that include the single IP address\"},\r\n```",
    "created_at": "2021-01-25T13:23:34Z",
    "updated_at": "2021-04-23T20:25:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r563718976",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/563718976"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r563718976"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/563718976/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 666,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/563719416",
    "pull_request_review_id": 575389315,
    "id": 563719416,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MzcxOTQxNg==",
    "diff_hunk": "@@ -678,38 +678,32 @@ static RPCHelpMan setban()\n     std::string strCommand;\n     if (!request.params[1].isNull())\n         strCommand = request.params[1].get_str();\n-    if (strCommand != \"add\" && strCommand != \"remove\") {\n+    if (strCommand != \"add\" && strCommand != \"remove\" && strCommand != \"removeall\") {\n         throw std::runtime_error(help.ToString());\n     }\n     NodeContext& node = EnsureNodeContext(request.context);\n     if (!node.banman) {\n         throw JSONRPCError(RPC_DATABASE_ERROR, \"Error: Ban database not loaded\");\n     }\n \n+    bool isSubnet = (request.params[0].get_str().find('/') != std::string::npos);\n+    if (strCommand == \"removeall\" && isSubnet) {\n+        throw JSONRPCError(RPC_INVALID_PARAMETER, \"Error: setban removeall requires single ip address\");",
    "path": "src/rpc/net.cpp",
    "position": null,
    "original_position": 24,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "38abc322d3c66c59fb9189ac9d2a5c4aadf8b0e9",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "579eaaa\r\n```suggestion\r\n        throw JSONRPCError(RPC_INVALID_PARAMETER, \"Error: setban removeall requires a single IP address\");\r\n```",
    "created_at": "2021-01-25T13:24:14Z",
    "updated_at": "2021-04-23T20:25:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r563719416",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/563719416"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r563719416"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/563719416/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 691,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/563719732",
    "pull_request_review_id": 575389315,
    "id": 563719732,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MzcxOTczMg==",
    "diff_hunk": "@@ -718,23 +712,13 @@ static RPCHelpMan setban()\n         if (request.params[3].isTrue())\n             absolute = true;\n \n-        if (isSubnet) {\n-            node.banman->Ban(subNet, banTime, absolute);\n-            if (node.connman) {\n-                node.connman->DisconnectNode(subNet);\n-            }\n-        } else {\n-            node.banman->Ban(netAddr, banTime, absolute);\n-            if (node.connman) {\n-                node.connman->DisconnectNode(netAddr);\n-            }\n-        }\n-    }\n-    else if(strCommand == \"remove\")\n-    {\n-        if (!( isSubnet ? node.banman->Unban(subNet) : node.banman->Unban(netAddr) )) {\n-            throw JSONRPCError(RPC_CLIENT_INVALID_IP_OR_SUBNET, \"Error: Unban failed. Requested address/subnet was not previously manually banned.\");\n+        if (node.banman->Ban(subNet, banTime, absolute) && node.connman) {\n+            node.connman->DisconnectNode(subNet);\n         }\n+    } else if(strCommand == \"remove\") {",
    "path": "src/rpc/net.cpp",
    "position": null,
    "original_position": 84,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "38abc322d3c66c59fb9189ac9d2a5c4aadf8b0e9",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "579eaaa\r\n```suggestion\r\n    } else if (strCommand == \"remove\") {\r\n```",
    "created_at": "2021-01-25T13:24:50Z",
    "updated_at": "2021-04-23T20:25:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r563719732",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/563719732"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r563719732"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/563719732/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 718,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/563720577",
    "pull_request_review_id": 575389315,
    "id": 563720577,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MzcyMDU3Nw==",
    "diff_hunk": "@@ -768,7 +754,21 @@ static RPCHelpMan listbanned()\n \n     banmap_t banMap;\n     node.banman->GetBanned(banMap);\n-\n+    if (!request.params[0].isNull()) {\n+        CNetAddr netAddr;\n+        LookupHost(request.params[0].get_str(), netAddr, false);\n+        if (!netAddr.IsValid()) {\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Error: Invalid ip address\");",
    "path": "src/rpc/net.cpp",
    "position": null,
    "original_position": 111,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "38abc322d3c66c59fb9189ac9d2a5c4aadf8b0e9",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "38abc322\r\n```suggestion\r\n            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Error: Invalid IP address\");\r\n```",
    "created_at": "2021-01-25T13:26:05Z",
    "updated_at": "2021-04-23T20:25:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r563720577",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/563720577"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r563720577"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/563720577/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 761,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/563720874",
    "pull_request_review_id": 575389315,
    "id": 563720874,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MzcyMDg3NA==",
    "diff_hunk": "@@ -768,7 +754,21 @@ static RPCHelpMan listbanned()\n \n     banmap_t banMap;\n     node.banman->GetBanned(banMap);\n-\n+    if (!request.params[0].isNull()) {\n+        CNetAddr netAddr;\n+        LookupHost(request.params[0].get_str(), netAddr, false);\n+        if (!netAddr.IsValid()) {\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Error: Invalid ip address\");\n+        }\n+        for (auto it = banMap.begin(); it != banMap.end();) {\n+            CSubNet ban_sub_net = it->first;\n+            if (!ban_sub_net.Match(netAddr)) {\n+                it = banMap.erase(it);\n+            } else {\n+                it++;",
    "path": "src/rpc/net.cpp",
    "position": null,
    "original_position": 118,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "38abc322d3c66c59fb9189ac9d2a5c4aadf8b0e9",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "38abc322 prefer prefix iterator\r\n```suggestion\r\n                ++it;\r\n```",
    "created_at": "2021-01-25T13:26:30Z",
    "updated_at": "2021-04-23T20:25:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r563720874",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/563720874"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r563720874"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/563720874/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 768,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/563722213",
    "pull_request_review_id": 575389315,
    "id": 563722213,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MzcyMjIxMw==",
    "diff_hunk": "@@ -129,22 +109,18 @@ void BanMan::Ban(const CSubNet& sub_net, int64_t ban_time_offset, bool since_uni\n \n     {\n         LOCK(m_cs_banned);\n+        // If ban entry is absent, add it. If it's shorter, update it.\n         if (m_banned[sub_net].nBanUntil < ban_entry.nBanUntil) {\n             m_banned[sub_net] = ban_entry;\n             m_is_dirty = true;\n         } else\n-            return;\n+            return false; // nothing to do, longer ban already exists",
    "path": "src/banman.cpp",
    "position": 45,
    "original_position": 45,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "38abc322d3c66c59fb9189ac9d2a5c4aadf8b0e9",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "877b14aaeb ISTM this behavior ought to be documented/clarified in the setban rpc help",
    "created_at": "2021-01-25T13:28:33Z",
    "updated_at": "2021-04-23T20:25:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r563722213",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/563722213"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r563722213"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/563722213/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 117,
    "original_line": 117,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564933926",
    "pull_request_review_id": 576881770,
    "id": 564933926,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDkzMzkyNg==",
    "diff_hunk": "@@ -38,47 +38,34 @@ FUZZ_TARGET_INIT(banman, initialize_banman)\n     {\n         BanMan ban_man{banlist_file, nullptr, ConsumeBanTimeOffset(fuzzed_data_provider)};\n         while (fuzzed_data_provider.ConsumeBool()) {\n-            switch (fuzzed_data_provider.ConsumeIntegralInRange<int>(0, 11)) {\n+            switch (fuzzed_data_provider.ConsumeIntegralInRange<int>(0, 6)) {\n             case 0: {\n-                ban_man.Ban(ConsumeNetAddr(fuzzed_data_provider),\n-                    ConsumeBanTimeOffset(fuzzed_data_provider), fuzzed_data_provider.ConsumeBool());\n-                break;\n-            }\n-            case 1: {",
    "path": "src/test/fuzz/banman.cpp",
    "position": null,
    "original_position": 11,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "38abc322d3c66c59fb9189ac9d2a5c4aadf8b0e9",
    "user": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done in 0dbe88ad3894cd76d52ed196fd2eed39de1296d2",
    "created_at": "2021-01-27T00:31:58Z",
    "updated_at": "2021-04-23T20:25:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r564933926",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564933926"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r564933926"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564933926/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 47,
    "side": "LEFT",
    "in_reply_to_id": 557295685
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564933990",
    "pull_request_review_id": 576881844,
    "id": 564933990,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDkzMzk5MA==",
    "diff_hunk": "@@ -159,6 +135,25 @@ bool BanMan::Unban(const CSubNet& sub_net)\n     return true;\n }\n \n+void BanMan::UnbanAll(const CNetAddr& net_addr)\n+{\n+    {\n+        LOCK(m_cs_banned);\n+        for (auto it = m_banned.begin(); it != m_banned.end();) {\n+            CSubNet sub_net = it->first;\n+            if (sub_net.Match(net_addr)) {\n+                it = m_banned.erase(it);\n+                m_is_dirty = true;\n+            } else {\n+                it++;",
    "path": "src/banman.cpp",
    "position": null,
    "original_position": 75,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "38abc322d3c66c59fb9189ac9d2a5c4aadf8b0e9",
    "user": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done",
    "created_at": "2021-01-27T00:32:08Z",
    "updated_at": "2021-04-23T20:25:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r564933990",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564933990"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r564933990"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564933990/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 148,
    "side": "RIGHT",
    "in_reply_to_id": 563718303
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564934035",
    "pull_request_review_id": 576881906,
    "id": 564934035,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDkzNDAzNQ==",
    "diff_hunk": "@@ -663,7 +663,7 @@ static RPCHelpMan setban()\n                 \"\\nAttempts to add or remove an IP/Subnet from the banned list.\\n\",\n                 {\n                     {\"subnet\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The IP/Subnet (see getpeerinfo for nodes IP) with an optional netmask (default is /32 = single IP)\"},\n-                    {\"command\", RPCArg::Type::STR, RPCArg::Optional::NO, \"'add' to add an IP/Subnet to the list, 'remove' to remove an IP/Subnet from the list\"},\n+                    {\"command\", RPCArg::Type::STR, RPCArg::Optional::NO, \"'add' to add an IP/Subnet to the list, 'remove' to remove an IP/Subnet from the list, 'removeall' to remove all bans that include the single ip address\"},",
    "path": "src/rpc/net.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "38abc322d3c66c59fb9189ac9d2a5c4aadf8b0e9",
    "user": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done",
    "created_at": "2021-01-27T00:32:16Z",
    "updated_at": "2021-04-23T20:25:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r564934035",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564934035"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r564934035"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564934035/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 666,
    "side": "RIGHT",
    "in_reply_to_id": 563718976
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564934164",
    "pull_request_review_id": 576882059,
    "id": 564934164,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDkzNDE2NA==",
    "diff_hunk": "@@ -678,38 +678,32 @@ static RPCHelpMan setban()\n     std::string strCommand;\n     if (!request.params[1].isNull())\n         strCommand = request.params[1].get_str();\n-    if (strCommand != \"add\" && strCommand != \"remove\") {\n+    if (strCommand != \"add\" && strCommand != \"remove\" && strCommand != \"removeall\") {\n         throw std::runtime_error(help.ToString());\n     }\n     NodeContext& node = EnsureNodeContext(request.context);\n     if (!node.banman) {\n         throw JSONRPCError(RPC_DATABASE_ERROR, \"Error: Ban database not loaded\");\n     }\n \n+    bool isSubnet = (request.params[0].get_str().find('/') != std::string::npos);\n+    if (strCommand == \"removeall\" && isSubnet) {\n+        throw JSONRPCError(RPC_INVALID_PARAMETER, \"Error: setban removeall requires single ip address\");",
    "path": "src/rpc/net.cpp",
    "position": null,
    "original_position": 24,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "38abc322d3c66c59fb9189ac9d2a5c4aadf8b0e9",
    "user": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done",
    "created_at": "2021-01-27T00:32:37Z",
    "updated_at": "2021-04-23T20:25:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r564934164",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564934164"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r564934164"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564934164/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 691,
    "side": "RIGHT",
    "in_reply_to_id": 563719416
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564934191",
    "pull_request_review_id": 576882090,
    "id": 564934191,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDkzNDE5MQ==",
    "diff_hunk": "@@ -718,23 +712,13 @@ static RPCHelpMan setban()\n         if (request.params[3].isTrue())\n             absolute = true;\n \n-        if (isSubnet) {\n-            node.banman->Ban(subNet, banTime, absolute);\n-            if (node.connman) {\n-                node.connman->DisconnectNode(subNet);\n-            }\n-        } else {\n-            node.banman->Ban(netAddr, banTime, absolute);\n-            if (node.connman) {\n-                node.connman->DisconnectNode(netAddr);\n-            }\n-        }\n-    }\n-    else if(strCommand == \"remove\")\n-    {\n-        if (!( isSubnet ? node.banman->Unban(subNet) : node.banman->Unban(netAddr) )) {\n-            throw JSONRPCError(RPC_CLIENT_INVALID_IP_OR_SUBNET, \"Error: Unban failed. Requested address/subnet was not previously manually banned.\");\n+        if (node.banman->Ban(subNet, banTime, absolute) && node.connman) {\n+            node.connman->DisconnectNode(subNet);\n         }\n+    } else if(strCommand == \"remove\") {",
    "path": "src/rpc/net.cpp",
    "position": null,
    "original_position": 84,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "38abc322d3c66c59fb9189ac9d2a5c4aadf8b0e9",
    "user": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done",
    "created_at": "2021-01-27T00:32:42Z",
    "updated_at": "2021-04-23T20:25:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r564934191",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564934191"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r564934191"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564934191/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 718,
    "side": "RIGHT",
    "in_reply_to_id": 563719732
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564934231",
    "pull_request_review_id": 576882137,
    "id": 564934231,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDkzNDIzMQ==",
    "diff_hunk": "@@ -768,7 +754,21 @@ static RPCHelpMan listbanned()\n \n     banmap_t banMap;\n     node.banman->GetBanned(banMap);\n-\n+    if (!request.params[0].isNull()) {\n+        CNetAddr netAddr;\n+        LookupHost(request.params[0].get_str(), netAddr, false);\n+        if (!netAddr.IsValid()) {\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Error: Invalid ip address\");",
    "path": "src/rpc/net.cpp",
    "position": null,
    "original_position": 111,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "38abc322d3c66c59fb9189ac9d2a5c4aadf8b0e9",
    "user": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done",
    "created_at": "2021-01-27T00:32:49Z",
    "updated_at": "2021-04-23T20:25:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r564934231",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564934231"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r564934231"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564934231/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 761,
    "side": "RIGHT",
    "in_reply_to_id": 563720577
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564934279",
    "pull_request_review_id": 576882174,
    "id": 564934279,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDkzNDI3OQ==",
    "diff_hunk": "@@ -768,7 +754,21 @@ static RPCHelpMan listbanned()\n \n     banmap_t banMap;\n     node.banman->GetBanned(banMap);\n-\n+    if (!request.params[0].isNull()) {\n+        CNetAddr netAddr;\n+        LookupHost(request.params[0].get_str(), netAddr, false);\n+        if (!netAddr.IsValid()) {\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Error: Invalid ip address\");\n+        }\n+        for (auto it = banMap.begin(); it != banMap.end();) {\n+            CSubNet ban_sub_net = it->first;\n+            if (!ban_sub_net.Match(netAddr)) {\n+                it = banMap.erase(it);\n+            } else {\n+                it++;",
    "path": "src/rpc/net.cpp",
    "position": null,
    "original_position": 118,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "38abc322d3c66c59fb9189ac9d2a5c4aadf8b0e9",
    "user": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done",
    "created_at": "2021-01-27T00:32:55Z",
    "updated_at": "2021-04-23T20:25:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r564934279",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564934279"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r564934279"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564934279/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 768,
    "side": "RIGHT",
    "in_reply_to_id": 563720874
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564934327",
    "pull_request_review_id": 576882224,
    "id": 564934327,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDkzNDMyNw==",
    "diff_hunk": "@@ -129,22 +109,18 @@ void BanMan::Ban(const CSubNet& sub_net, int64_t ban_time_offset, bool since_uni\n \n     {\n         LOCK(m_cs_banned);\n+        // If ban entry is absent, add it. If it's shorter, update it.\n         if (m_banned[sub_net].nBanUntil < ban_entry.nBanUntil) {\n             m_banned[sub_net] = ban_entry;\n             m_is_dirty = true;\n         } else\n-            return;\n+            return false; // nothing to do, longer ban already exists",
    "path": "src/banman.cpp",
    "position": 45,
    "original_position": 45,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "38abc322d3c66c59fb9189ac9d2a5c4aadf8b0e9",
    "user": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done.",
    "created_at": "2021-01-27T00:33:01Z",
    "updated_at": "2021-04-23T20:25:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r564934327",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564934327"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r564934327"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564934327/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 117,
    "original_line": 117,
    "side": "RIGHT",
    "in_reply_to_id": 563722213
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566323809",
    "pull_request_review_id": 578633169,
    "id": 566323809,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjMyMzgwOQ==",
    "diff_hunk": "@@ -952,7 +952,7 @@ static const CRPCCommand commands[] =\n     { \"network\",            \"getnettotals\",           &getnettotals,           {} },\n     { \"network\",            \"getnetworkinfo\",         &getnetworkinfo,         {} },\n     { \"network\",            \"setban\",                 &setban,                 {\"subnet\", \"command\", \"bantime\", \"absolute\"} },\n-    { \"network\",            \"listbanned\",             &listbanned,             {} },\n+    { \"network\",            \"listbanned\",             &listbanned,             {\"ip\"} },",
    "path": "src/rpc/net.cpp",
    "position": null,
    "original_position": 134,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "8ad64d28794f2d91cf6eea7ab15f662ec3e211da",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Can remove this diff, and then rebase",
    "created_at": "2021-01-28T18:40:37Z",
    "updated_at": "2021-04-23T20:25:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r566323809",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566323809"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r566323809"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566323809/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 955,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566350745",
    "pull_request_review_id": 578667595,
    "id": 566350745,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjM1MDc0NQ==",
    "diff_hunk": "@@ -952,7 +952,7 @@ static const CRPCCommand commands[] =\n     { \"network\",            \"getnettotals\",           &getnettotals,           {} },\n     { \"network\",            \"getnetworkinfo\",         &getnetworkinfo,         {} },\n     { \"network\",            \"setban\",                 &setban,                 {\"subnet\", \"command\", \"bantime\", \"absolute\"} },\n-    { \"network\",            \"listbanned\",             &listbanned,             {} },\n+    { \"network\",            \"listbanned\",             &listbanned,             {\"ip\"} },",
    "path": "src/rpc/net.cpp",
    "position": null,
    "original_position": 134,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "8ad64d28794f2d91cf6eea7ab15f662ec3e211da",
    "user": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks for making that easier :)",
    "created_at": "2021-01-28T19:25:25Z",
    "updated_at": "2021-04-23T20:25:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r566350745",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566350745"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r566350745"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566350745/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 955,
    "side": "RIGHT",
    "in_reply_to_id": 566323809
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/717427359",
    "pull_request_review_id": 765239967,
    "id": 717427359,
    "node_id": "PRRC_kwDOABII584qwxKf",
    "diff_hunk": "@@ -1116,7 +1116,7 @@ CSubNet::CSubNet(const CNetAddr& addr) : CSubNet()\n     switch (addr.m_net) {\n     case NET_IPV4:\n     case NET_IPV6:\n-        valid = true;\n+        valid = addr.IsValid();",
    "path": "src/netaddress.cpp",
    "position": 5,
    "original_position": 5,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "80044bd2ed96c391e9e87d77cc876e653b512657",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "what is this change exactly about? Why is it relevant to the given PR?",
    "created_at": "2021-09-28T10:10:03Z",
    "updated_at": "2021-09-28T10:10:03Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r717427359",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/717427359"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r717427359"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/717427359/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1119,
    "original_line": 1119,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/717427911",
    "pull_request_review_id": 765240673,
    "id": 717427911,
    "node_id": "PRRC_kwDOABII584qwxTH",
    "diff_hunk": "@@ -1116,7 +1116,7 @@ CSubNet::CSubNet(const CNetAddr& addr) : CSubNet()\n     switch (addr.m_net) {\n     case NET_IPV4:\n     case NET_IPV6:\n-        valid = true;\n+        valid = addr.IsValid();",
    "path": "src/netaddress.cpp",
    "position": 5,
    "original_position": 5,
    "commit_id": "a2a36f93ff9563d14bf0ba1118d8daa0a969b4c5",
    "original_commit_id": "80044bd2ed96c391e9e87d77cc876e653b512657",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I see it's kinda used below in the same commit 80044bd2ed96c391e9e87d77cc876e653b512657, but splitting this change out (e.g. do it first) would simplify the review.",
    "created_at": "2021-09-28T10:10:42Z",
    "updated_at": "2021-09-28T10:10:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r717427911",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/717427911"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19825#discussion_r717427911"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19825"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/717427911/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1119,
    "original_line": 1119,
    "side": "RIGHT",
    "in_reply_to_id": 717427359
  }
]