[
  {
    "sha": "4a288abc412273a4e17dfbdf8074cb7bd4727795",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0YTI4OGFiYzQxMjI3M2E0ZTE3ZGZiZGY4MDc0Y2I3YmQ0NzI3Nzk1",
    "commit": {
      "author": {
        "name": "practicalswift",
        "email": "practicalswift@users.noreply.github.com",
        "date": "2019-06-13T19:42:28Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2020-04-07T10:54:10Z"
      },
      "message": "Add ASSUME(expr). Set -ABORT_ON_ASSUME_FAIL when configured with --enable-debug or --enable-fuzz.",
      "tree": {
        "sha": "a4b8ab4b198f3546102cd3d375d58e16cbca56de",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a4b8ab4b198f3546102cd3d375d58e16cbca56de"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4a288abc412273a4e17dfbdf8074cb7bd4727795",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4a288abc412273a4e17dfbdf8074cb7bd4727795",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/4a288abc412273a4e17dfbdf8074cb7bd4727795",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4a288abc412273a4e17dfbdf8074cb7bd4727795/comments",
    "author": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "63dad673487d3623f9076721d2a1924263272eb9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/63dad673487d3623f9076721d2a1924263272eb9",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/63dad673487d3623f9076721d2a1924263272eb9"
      }
    ],
    "stats": {
      "total": 55,
      "additions": 55,
      "deletions": 0
    },
    "files": [
      {
        "sha": "5dda33429a99fc313c66c86672aac02ca23bb4ee",
        "filename": "configure.ac",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4a288abc412273a4e17dfbdf8074cb7bd4727795/configure.ac",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4a288abc412273a4e17dfbdf8074cb7bd4727795/configure.ac",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/configure.ac?ref=4a288abc412273a4e17dfbdf8074cb7bd4727795",
        "patch": "@@ -291,6 +291,7 @@ if test \"x$enable_debug\" = xyes; then\n \n   AX_CHECK_PREPROC_FLAG([-DDEBUG],[[DEBUG_CPPFLAGS=\"$DEBUG_CPPFLAGS -DDEBUG\"]],,[[$CXXFLAG_WERROR]])\n   AX_CHECK_PREPROC_FLAG([-DDEBUG_LOCKORDER],[[DEBUG_CPPFLAGS=\"$DEBUG_CPPFLAGS -DDEBUG_LOCKORDER\"]],,[[$CXXFLAG_WERROR]])\n+  AX_CHECK_PREPROC_FLAG([-DABORT_ON_FAILED_ASSUME],[[DEBUG_CPPFLAGS=\"$DEBUG_CPPFLAGS -DABORT_ON_FAILED_ASSUME\"]],,[[$CXXFLAG_WERROR]])\n   AX_CHECK_COMPILE_FLAG([-ftrapv],[DEBUG_CXXFLAGS=\"$DEBUG_CXXFLAGS -ftrapv\"],,[[$CXXFLAG_WERROR]])\n fi\n \n@@ -1090,6 +1091,7 @@ if test \"x$enable_fuzz\" = \"xyes\"; then\n   use_bench=no\n   use_upnp=no\n   use_zmq=no\n+  AX_CHECK_PREPROC_FLAG([-DABORT_ON_FAILED_ASSUME],[[DEBUG_CPPFLAGS=\"$DEBUG_CPPFLAGS -DABORT_ON_FAILED_ASSUME\"]],,[[$CXXFLAG_WERROR]])\n else\n   BITCOIN_QT_INIT\n "
      },
      {
        "sha": "479b048e67c2ccc84d183372fe89cb5028d753d5",
        "filename": "src/util/check.h",
        "status": "modified",
        "additions": 53,
        "deletions": 0,
        "changes": 53,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4a288abc412273a4e17dfbdf8074cb7bd4727795/src/util/check.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4a288abc412273a4e17dfbdf8074cb7bd4727795/src/util/check.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/util/check.h?ref=4a288abc412273a4e17dfbdf8074cb7bd4727795",
        "patch": "@@ -5,6 +5,7 @@\n #ifndef BITCOIN_UTIL_CHECK_H\n #define BITCOIN_UTIL_CHECK_H\n \n+#include <config/bitcoin-config.h>\n #include <tinyformat.h>\n \n #include <stdexcept>\n@@ -38,4 +39,56 @@ class NonFatalCheckError : public std::runtime_error\n         }                                                         \\\n     } while (false)\n \n+/**\n+ * ASSUME(expression)\n+ *\n+ * ASSUME(...) is used to document assumptions.\n+ *\n+ * Bitcoin Core is always compiled with assertions enabled. assert(...)\n+ * is thus only appropriate for documenting critical assumptions\n+ * where a failed assumption should lead to immediate abortion also\n+ * in production environments.\n+ *\n+ * ASSUME(...) works like assert(...) if -DABORT_ON_FAILED_ASSUME\n+ * and is side-effect safe.\n+ *\n+ * More specifically:\n+ *\n+ * * If compiled with -DABORT_ON_FAILED_ASSUME (set by --enable-debug\n+ *   and --enable-fuzz): Evaluate expression and abort if expression is\n+ *   false.\n+ *\n+ * * Otherwise:\n+ *   Evaluate expression and continue execution.\n+ *\n+ * ABORT_ON_FAILED_ASSUME should not be set in production environments.\n+ *\n+ * Example\n+ * =======\n+ * int main(void) {\n+ *     ASSUME(IsFoo());\n+ *     ...\n+ * }\n+ *\n+ * If !IsFoo() and -DABORT_ON_FAILED_ASSUME, then:\n+ *     filename.cpp:123: main: ASSUME(IsFoo()) failed.\n+ *     Aborted\n+ * Otherwise the execution continues.\n+ */\n+\n+#ifdef ABORT_ON_FAILED_ASSUME\n+#define ACTION_ON_FAILED_ASSUME std::abort();\n+#else\n+#define ACTION_ON_FAILED_ASSUME\n+#endif\n+\n+#define ASSUME(expression)                                                                               \\\n+    do {                                                                                                 \\\n+        if (!(expression)) {                                                                             \\\n+            tfm::format(std::cerr, \"%s:%d: %s: ASSUME(%s) failed. You may report this issue here: %s\\n\", \\\n+                __FILE__, __LINE__, __func__, #expression, PACKAGE_BUGREPORT);                           \\\n+            ACTION_ON_FAILED_ASSUME                                                                      \\\n+        }                                                                                                \\\n+    } while (false)\n+\n #endif // BITCOIN_UTIL_CHECK_H"
      }
    ]
  },
  {
    "sha": "fa5166b61adde799a903635fc876d4859d73d628",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYTUxNjZiNjFhZGRlNzk5YTkwMzYzNWZjODc2ZDQ4NTlkNzNkNjI4",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2020-04-07T11:02:02Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2020-04-07T10:59:55Z"
      },
      "message": "wallet: Abort when assumption fails in debug mode",
      "tree": {
        "sha": "fd8e51741713efb227fc28e2cea5e99159e58d28",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/fd8e51741713efb227fc28e2cea5e99159e58d28"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fa5166b61adde799a903635fc876d4859d73d628",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\npUjgbQv7BwihG/WMGa/2iEtB+BoG0QgpeEdcEpbRJ7th1GDLe0XJALZPwtaNeIxS\nOKxOrznx3rPsMtjyqhkdAL2n6clM2rEnMc6Z6rxcMWKVi86GGDOW3rLiTJ+l/rVI\nDWs1VlpZ3D1B+r6ZM9Q8DpZt6FrR6WY14tB7obt6j6dLgGlre85J3V/7iV2UZQIP\nofe+iBhE+4FM6zZBEXUnU3iPSaBPTY7BRYeiTB1IbBPQgp4ivq80HNDJVkaTM0ct\nuQzMQFMNK0a7dTlh/J1sO0kmWkEv9g5c6CIqU4Y8wm2hwyBQAdqckrxyPSsfjH0l\nyv+Wj7cQbPl6ezPBQ1duGN43JiijVi11T0OM0Y1+ovUXHXbyVHlmf8TfvWS5vLyr\n9QIa0FUktbBNKvGE5RSy+N0V55BHoJ6puuLu3u/VbAFEa67GQr6v4OGC6FhA70qW\n1Mlp5jlo+cWybJbVS1MEvvutd+bCbd4D02aer5VUAe/jVep+tXQJ9F7NNjXNoz4A\ntiSHIKw8\n=HK7/\n-----END PGP SIGNATURE-----",
        "payload": "tree fd8e51741713efb227fc28e2cea5e99159e58d28\nparent 4a288abc412273a4e17dfbdf8074cb7bd4727795\nauthor MarcoFalke <falke.marco@gmail.com> 1586257322 +0800\ncommitter MarcoFalke <falke.marco@gmail.com> 1586257195 +0800\n\nwallet: Abort when assumption fails in debug mode\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa5166b61adde799a903635fc876d4859d73d628",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fa5166b61adde799a903635fc876d4859d73d628",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa5166b61adde799a903635fc876d4859d73d628/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "4a288abc412273a4e17dfbdf8074cb7bd4727795",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4a288abc412273a4e17dfbdf8074cb7bd4727795",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/4a288abc412273a4e17dfbdf8074cb7bd4727795"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 2,
      "deletions": 0
    },
    "files": [
      {
        "sha": "2ca5ba465437d84a5be957b8442428d1fee23ec8",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa5166b61adde799a903635fc876d4859d73d628/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa5166b61adde799a903635fc876d4859d73d628/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=fa5166b61adde799a903635fc876d4859d73d628",
        "patch": "@@ -26,6 +26,7 @@\n #include <util/fees.h>\n #include <util/moneystr.h>\n #include <util/rbf.h>\n+#include <util/check.h>\n #include <util/translation.h>\n #include <wallet/coincontrol.h>\n #include <wallet/fees.h>\n@@ -3223,6 +3224,7 @@ bool CWallet::DelAddressBook(const CTxDestination& address)\n     // When adding new DestData, it should be considered here whether to retain or delete it (or move it?).\n     if (IsMine(address)) {\n         WalletLogPrintf(\"%s called with IsMine address, NOT SUPPORTED. Please report this bug! %s\\n\", __func__, PACKAGE_BUGREPORT);\n+        ASSUME(false);\n         return false;\n     }\n "
      }
    ]
  }
]