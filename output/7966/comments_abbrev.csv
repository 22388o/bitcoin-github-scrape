laanwj,2016-05-04T13:33:04Z,"Decided to forget about using std::move to move items conditionally into the queue, the resulting code was too complex, the old code is cleaner.\n",https://github.com/bitcoin/bitcoin/pull/7966#issuecomment-216866129,216866129,
theuni,2016-05-05T05:49:16Z,"ut ACK, other than the little nit\n",https://github.com/bitcoin/bitcoin/pull/7966#issuecomment-217081021,217081021,
laanwj,2016-05-05T10:56:55Z,"Fixed @theuni's nit, thanks\n",https://github.com/bitcoin/bitcoin/pull/7966#issuecomment-217124744,217124744,
sipa,2016-04-28T17:22:08Z,"Also, in C++11, you no longer need to avoid the '>>' in `Template1<Template2<Template3>>`.\n",https://github.com/bitcoin/bitcoin/pull/7966#discussion_r61467339,61467339,src/httpserver.cpp
paveljanik,2016-04-28T17:28:11Z,I was just about to ask why the space is there...\n,https://github.com/bitcoin/bitcoin/pull/7966#discussion_r61468317,61468317,src/httpserver.cpp
laanwj,2016-04-28T19:15:46Z,@paveljanik because `>>` is an operator. But yes with c++11 this is apparently parsed differently so will remove the space.\n,https://github.com/bitcoin/bitcoin/pull/7966#discussion_r61486514,61486514,src/httpserver.cpp
paveljanik,2016-04-28T20:12:13Z,Do we need an empty destructor?\n,https://github.com/bitcoin/bitcoin/pull/7966#discussion_r61494617,61494617,src/httpserver.cpp
kazcw,2016-04-28T21:20:50Z,`item` has been given to the queue here\n,https://github.com/bitcoin/bitcoin/pull/7966#discussion_r61504551,61504551,src/httpserver.cpp
theuni,2016-04-28T21:21:09Z,use after move here\n,https://github.com/bitcoin/bitcoin/pull/7966#discussion_r61504588,61504588,src/httpserver.cpp
laanwj,2016-05-02T11:06:23Z,"@kazcw @theuni Bah, good catch. I suppose there's no such thing as a conditional move?\nMaybe it could return the unique_pointer (""move back"") if it couldn't be pushed into the queue?\nThe other option would be to move the error message into the queue but that'd not be very nice.\n",https://github.com/bitcoin/bitcoin/pull/7966#discussion_r61726526,61726526,src/httpserver.cpp
laanwj,2016-05-02T11:10:48Z,I'll remove it.\n,https://github.com/bitcoin/bitcoin/pull/7966#discussion_r61726770,61726770,src/httpserver.cpp
kazcw,2016-05-02T15:44:47Z,"The actual moving happens in `unique_ptr`'s ctor. The function just needs to accept a `unique_ptr&&`, then it can freely move that into a new `unique_ptr` or not.\n",https://github.com/bitcoin/bitcoin/pull/7966#discussion_r61756912,61756912,src/httpserver.cpp
laanwj,2016-05-04T09:59:01Z,"On second thought, I'm going to keep it, the precondition comment is still relevant.\n",https://github.com/bitcoin/bitcoin/pull/7966#discussion_r62015537,62015537,src/httpserver.cpp
laanwj,2016-05-04T10:01:37Z,@kazcw I've updated to do that. Can you please re-review to see if this was what you meant?\n,https://github.com/bitcoin/bitcoin/pull/7966#discussion_r62015847,62015847,src/httpserver.cpp
laanwj,2016-05-04T12:41:35Z,"It doesn't seem to work. I've tested with a (hacked) work-queue size of 0, and the connection is closed before the error message can be sent.\n",https://github.com/bitcoin/bitcoin/pull/7966#discussion_r62031320,62031320,src/httpserver.cpp
laanwj,2016-05-04T13:01:08Z,Leaving out the std::move in the `->Enqueue` line gives a compile error about pointer conversions:\n\n```\n/home/orion/projects/bitcoin/bitcoin/src/httpserver.cpp:289:33: error: no viable conversion from 'unique_ptr<HTTPWorkItem>' to 'unique_ptr<HTTPClosure>'\n        if (!workQueue->Enqueue(item))\n```\n\nBleh.\n,https://github.com/bitcoin/bitcoin/pull/7966#discussion_r62033874,62033874,src/httpserver.cpp
theuni,2016-05-05T05:49:01Z,nit: `queue.emplace_back(item);`\n,https://github.com/bitcoin/bitcoin/pull/7966#discussion_r62150648,62150648,src/httpserver.cpp
theuni,2016-05-05T15:57:45Z,"Creating the unique_ptr here defeats the purpose of the emplace :)\nPassing it item directly would mean that the unique_ptr would be constructed in-place. As is, it's moved instead.\n\nNot worth worrying about, just pointing it out.\n",https://github.com/bitcoin/bitcoin/pull/7966#discussion_r62208255,62208255,src/httpserver.cpp
laanwj,2016-05-05T17:02:14Z,Yes by all means feel free to improve this further.\n,https://github.com/bitcoin/bitcoin/pull/7966#discussion_r62217806,62217806,src/httpserver.cpp
