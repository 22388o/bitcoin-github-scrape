[
  {
    "sha": "816f29eab296ebec2da8f8606ad618609e3ba228",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4MTZmMjllYWIyOTZlYmVjMmRhOGY4NjA2YWQ2MTg2MDllM2JhMjI4",
    "commit": {
      "author": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2021-07-15T11:04:26Z"
      },
      "committer": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2021-07-15T11:40:29Z"
      },
      "message": "addrman: detect on-disk corrupted nNew and nTried during unserialization\n\nNegative `nNew` or `nTried` are not possible during normal operation.\nSo, if we read such values during unserialize, report addrman\ncorruption.\n\nFixes https://github.com/bitcoin/bitcoin/issues/22450",
      "tree": {
        "sha": "a7d1cbbcb2d0367cda46bccefaf38e76ffe0882f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a7d1cbbcb2d0367cda46bccefaf38e76ffe0882f"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/816f29eab296ebec2da8f8606ad618609e3ba228",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQQzBAABCAAdFiEE5k2NRWFNsHVF2czBVN8G9ktVy78FAmDwHtsACgkQVN8G9ktV\ny79eDCAAhA49NT7GefdhbrCRbjIKKBDeM3YbLmbqIzQLYYR4KrtRyMoPmQBChvtq\noIMyonCikW60lK0wfWwWR2ThGUorqxk2Masot2Ittryo96e87pdIjTbfYPVqV1XD\nsZCQQnOarVrnDqEI95to16/1TmPFn5E724zIXmSCR2Edni17MeyNQhWQ1ZVICaM4\nn0Pg2QaNmcYpasxJ2/I5a5jJcwjTCkSjV7lLV2t6a3LEiSZz/wqnb8yBLNtMLxVQ\nCKKRG7WwSuS+AVtoQf3CRaeC7ISDWA9jfLZKalwyC8MbkUWT3KoTVPGAa1b8mbeV\nLCOGRokA8X6outGVYgnki2XRRr0Dol5fU2hUVh49cDKPVrtjUZP3GewDHXgP/+Be\nTU7xol/feDM+sr7EsfazGGo/ivb78/j+1AACkd3i/+DKMMIRBT8TvE6IlvhlgljP\nAHOYLYEASfOE4Jr2XmL37h06nTk8zXvBM9Rl7msCF0s25kHJI57AauUA3H4Zn0Hg\n1sqsnD4mCYfyVN4yMH1kccLC/9JWPcsIFd4bKMOZvc0Qti80LZfVVXCAthrPFoAU\nVVyw1vsRVpWhTl5r0IsOueGc5HDDSIYoTR60BwEjgUIXyP7Te17hgIA0hIsZFCLH\n1VOECkMycYC7a8JDwNC74raVwNVDFGPoWiFhT9p/QXmlz2WGDaAUZH7Ktq7z7Bro\nf9BkzhzRkTOvk4yFpUrRJxf7Oq9NbTJWmRMZcTSTU5yBEv6xffKneuxHcF/TjIQj\nKY9smPjwC6ioeT4nks0KReyHkRlcusiW5khQpK9xG0AEh0XpKfQbEMQallW3ygZL\nHAvsXRqsq0wcznDttMyfnJlruWDF5Qtx2rdKqHZtZr2/M5WQ/7HY5lLDvoa1IF1V\nCr4qfq2NRSfYv2t4vEDhHUOUhXExn/EBgbqWvXMy4K4LQ/aDaijHzPIdMM8LgqD3\nq+iYrauT/AiVls36VLbZwdTo4ICyDmKx/6h/zpBXOvuLUIDkG45xfMEzEXpaBCgP\n3BiOOjqaN6aHdT/McJ1el16wBbQTCu9QYVmnBDXMk2UkZ10CFRdDtcnKvrdBOoXw\nn2kP+d2kpS3fhLf+nfVnEnsql5zmACtK6MHQ/KUs7RLIHROGRSG5PwUUFua4t56T\n75Yb3g3xri6P3tgufRQUQVnfS3wQHrlWWp6vxMb31jyQof66Uhgzw127rYsShmo3\ntfKq6zABbrZ0c1em9DVkcfg/e8OLbxFKtI3HVFWt2T6pfUCr2FyXxM4dHpHA/q1Q\nPlBXj74jPTsMrU6RI9zyY4Ok2cmGOp3M2iKpxlLIbhgR0MD/2V97s9RtvsV8EFfH\n3qbQg7reZ26cIUc0s+wWeA7984vlOg==\n=HFmQ\n-----END PGP SIGNATURE-----",
        "payload": "tree a7d1cbbcb2d0367cda46bccefaf38e76ffe0882f\nparent 97153a702600430bdaf6af4f6f4eb8593e32819f\nauthor Vasil Dimov <vd@FreeBSD.org> 1626347066 +0200\ncommitter Vasil Dimov <vd@FreeBSD.org> 1626349229 +0200\n\naddrman: detect on-disk corrupted nNew and nTried during unserialization\n\nNegative `nNew` or `nTried` are not possible during normal operation.\nSo, if we read such values during unserialize, report addrman\ncorruption.\n\nFixes https://github.com/bitcoin/bitcoin/issues/22450\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/816f29eab296ebec2da8f8606ad618609e3ba228",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/816f29eab296ebec2da8f8606ad618609e3ba228",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/816f29eab296ebec2da8f8606ad618609e3ba228/comments",
    "author": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasild/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasild/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "97153a702600430bdaf6af4f6f4eb8593e32819f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/97153a702600430bdaf6af4f6f4eb8593e32819f",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/97153a702600430bdaf6af4f6f4eb8593e32819f"
      }
    ],
    "stats": {
      "total": 14,
      "additions": 10,
      "deletions": 4
    },
    "files": [
      {
        "sha": "5de90653c1ba08e7380cde9df24872d3ba45b27d",
        "filename": "src/addrman.h",
        "status": "modified",
        "additions": 10,
        "deletions": 4,
        "changes": 14,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/816f29eab296ebec2da8f8606ad618609e3ba228/src/addrman.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/816f29eab296ebec2da8f8606ad618609e3ba228/src/addrman.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrman.h?ref=816f29eab296ebec2da8f8606ad618609e3ba228",
        "patch": "@@ -334,12 +334,18 @@ class CAddrMan\n             nUBuckets ^= (1 << 30);\n         }\n \n-        if (nNew > ADDRMAN_NEW_BUCKET_COUNT * ADDRMAN_BUCKET_SIZE) {\n-            throw std::ios_base::failure(\"Corrupt CAddrMan serialization, nNew exceeds limit.\");\n+        if (nNew > ADDRMAN_NEW_BUCKET_COUNT * ADDRMAN_BUCKET_SIZE || nNew < 0) {\n+            throw std::ios_base::failure(\n+                strprintf(\"Corrupt CAddrMan serialization: nNew=%d, should be in [0, %u]\",\n+                          nNew,\n+                          ADDRMAN_NEW_BUCKET_COUNT * ADDRMAN_BUCKET_SIZE));\n         }\n \n-        if (nTried > ADDRMAN_TRIED_BUCKET_COUNT * ADDRMAN_BUCKET_SIZE) {\n-            throw std::ios_base::failure(\"Corrupt CAddrMan serialization, nTried exceeds limit.\");\n+        if (nTried > ADDRMAN_TRIED_BUCKET_COUNT * ADDRMAN_BUCKET_SIZE || nTried < 0) {\n+            throw std::ios_base::failure(\n+                strprintf(\"Corrupt CAddrMan serialization: nTried=%d, should be in [0, %u]\",\n+                          nTried,\n+                          ADDRMAN_TRIED_BUCKET_COUNT * ADDRMAN_BUCKET_SIZE));\n         }\n \n         // Deserialize entries from the new table."
      }
    ]
  }
]