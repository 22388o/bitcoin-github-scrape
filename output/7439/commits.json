[
  {
    "sha": "325c725fb6205e38142914acb9ed1733d8482d46",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozMjVjNzI1ZmI2MjA1ZTM4MTQyOTE0YWNiOWVkMTczM2Q4NDgyZDQ2",
    "commit": {
      "author": {
        "name": "Gregory Maxwell",
        "email": "greg@xiph.org",
        "date": "2015-11-25T23:00:23Z"
      },
      "committer": {
        "name": "Gregory Maxwell",
        "email": "greg@xiph.org",
        "date": "2016-01-28T22:26:21Z"
      },
      "message": "Add whitelistforcerelay to control forced relaying.\n\nAlso renames whitelistalwaysrelay.\n\nNodes relay all transactions from whitelisted peers, this\n gets in the way of some useful reasons for whitelisting\n peers-- for example, bypassing bandwidth limitations.\n\nThe purpose of this forced relaying is for specialized gateway\n applications where a node is being used as a P2P connection\n filter and multiplexer, but where you don't want it getting\n in the way of (re-)broadcast.\n\nThis change makes it configurable with whitelistforcerelay.",
      "tree": {
        "sha": "bc56351612aa9c49e1b085e763149faf98cd0e43",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/bc56351612aa9c49e1b085e763149faf98cd0e43"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/325c725fb6205e38142914acb9ed1733d8482d46",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/325c725fb6205e38142914acb9ed1733d8482d46",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/325c725fb6205e38142914acb9ed1733d8482d46",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/325c725fb6205e38142914acb9ed1733d8482d46/comments",
    "author": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "326ffed09bfcc209a2efd6a2ebc69edf6bd200b5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/326ffed09bfcc209a2efd6a2ebc69edf6bd200b5",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/326ffed09bfcc209a2efd6a2ebc69edf6bd200b5"
      }
    ],
    "stats": {
      "total": 29,
      "additions": 19,
      "deletions": 10
    },
    "files": [
      {
        "sha": "e67193b3298accfd7856e82d2c71a77410cc72bc",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 10,
        "deletions": 3,
        "changes": 13,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/325c725fb6205e38142914acb9ed1733d8482d46/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/325c725fb6205e38142914acb9ed1733d8482d46/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=325c725fb6205e38142914acb9ed1733d8482d46",
        "patch": "@@ -388,7 +388,8 @@ std::string HelpMessage(HelpMessageMode mode)\n     strUsage += HelpMessageOpt(\"-whitebind=<addr>\", _(\"Bind to given address and whitelist peers connecting to it. Use [host]:port notation for IPv6\"));\n     strUsage += HelpMessageOpt(\"-whitelist=<netmask>\", _(\"Whitelist peers connecting from the given netmask or IP address. Can be specified multiple times.\") +\n         \" \" + _(\"Whitelisted peers cannot be DoS banned and their transactions are always relayed, even if they are already in the mempool, useful e.g. for a gateway\"));\n-    strUsage += HelpMessageOpt(\"-whitelistalwaysrelay\", strprintf(_(\"Always relay transactions received from whitelisted peers (default: %d)\"), DEFAULT_WHITELISTALWAYSRELAY));\n+    strUsage += HelpMessageOpt(\"-whitelistrelay\", strprintf(_(\"Accept relayed transactions received from whitelisted peers even when not relaying transactions (default: %d)\"), DEFAULT_WHITELISTRELAY));\n+    strUsage += HelpMessageOpt(\"-whitelistforcerelay\", strprintf(_(\"Force relay of transactions from whitelisted peers even they violate local relay policy (default: %d)\"), DEFAULT_WHITELISTFORCERELAY));\n     strUsage += HelpMessageOpt(\"-maxuploadtarget=<n>\", strprintf(_(\"Tries to keep outbound traffic under the given target (in MiB per 24h), 0 = no limit (default: %d)\"), DEFAULT_MAX_UPLOAD_TARGET));\n \n #ifdef ENABLE_WALLET\n@@ -752,13 +753,19 @@ void InitParameterInteraction()\n \n     // disable walletbroadcast and whitelistalwaysrelay in blocksonly mode\n     if (GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY)) {\n-        if (SoftSetBoolArg(\"-whitelistalwaysrelay\", false))\n-            LogPrintf(\"%s: parameter interaction: -blocksonly=1 -> setting -whitelistalwaysrelay=0\\n\", __func__);\n+        if (SoftSetBoolArg(\"-whitelistrelay\", false))\n+            LogPrintf(\"%s: parameter interaction: -blocksonly=1 -> setting -whitelistrelay=0\\n\", __func__);\n #ifdef ENABLE_WALLET\n         if (SoftSetBoolArg(\"-walletbroadcast\", false))\n             LogPrintf(\"%s: parameter interaction: -blocksonly=1 -> setting -walletbroadcast=0\\n\", __func__);\n #endif\n     }\n+\n+    // Forcing relay from whitelisted hosts implies we will accept relays from them in the first place.\n+    if (GetBoolArg(\"-whitelistforcerelay\", DEFAULT_WHITELISTFORCERELAY)) {\n+        if (SoftSetBoolArg(\"-whitelistrelay\", true))\n+            LogPrintf(\"%s: parameter interaction: -whitelistforcerelay=1 -> setting -whitelistrelay=1\\n\", __func__);\n+    }\n }\n \n static std::string ResolveErrMsg(const char * const optname, const std::string& strBind)"
      },
      {
        "sha": "235280784af32a4c50330341b85aa612daf2cb6b",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 5,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/325c725fb6205e38142914acb9ed1733d8482d46/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/325c725fb6205e38142914acb9ed1733d8482d46/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=325c725fb6205e38142914acb9ed1733d8482d46",
        "patch": "@@ -4495,8 +4495,8 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n \n         bool fBlocksOnly = GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY);\n \n-        // Allow whitelisted peers to send data other than blocks in blocks only mode if whitelistalwaysrelay is true\n-        if (pfrom->fWhitelisted && GetBoolArg(\"-whitelistalwaysrelay\", DEFAULT_WHITELISTALWAYSRELAY))\n+        // Allow whitelisted peers to send data other than blocks in blocks only mode if whitelistrelay is true\n+        if (pfrom->fWhitelisted && GetBoolArg(\"-whitelistrelay\", DEFAULT_WHITELISTRELAY))\n             fBlocksOnly = false;\n \n         LOCK(cs_main);\n@@ -4675,8 +4675,8 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n     else if (strCommand == NetMsgType::TX)\n     {\n         // Stop processing the transaction early if\n-        // We are in blocks only mode and peer is either not whitelisted or whitelistalwaysrelay is off\n-        if (GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY) && (!pfrom->fWhitelisted || !GetBoolArg(\"-whitelistalwaysrelay\", DEFAULT_WHITELISTALWAYSRELAY)))\n+        // We are in blocks only mode and peer is either not whitelisted or whitelistrelay is off\n+        if (GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY) && (!pfrom->fWhitelisted || !GetBoolArg(\"-whitelistrelay\", DEFAULT_WHITELISTRELAY)))\n         {\n             LogPrint(\"net\", \"transaction sent in violation of protocol peer=%d\\n\", pfrom->id);\n             return true;\n@@ -4776,7 +4776,7 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n             assert(recentRejects);\n             recentRejects->insert(tx.GetHash());\n \n-            if (pfrom->fWhitelisted && GetBoolArg(\"-whitelistalwaysrelay\", DEFAULT_WHITELISTALWAYSRELAY)) {\n+            if (pfrom->fWhitelisted && GetBoolArg(\"-whitelistforcerelay\", DEFAULT_WHITELISTFORCERELAY)) {\n                 // Always relay transactions received from whitelisted peers, even\n                 // if they were already in the mempool or rejected from it due\n                 // to policy, allowing the node to function as a gateway for"
      },
      {
        "sha": "c4074cda8f6efd43997b5def7bd115828f323ea3",
        "filename": "src/main.h",
        "status": "modified",
        "additions": 4,
        "deletions": 2,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/325c725fb6205e38142914acb9ed1733d8482d46/src/main.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/325c725fb6205e38142914acb9ed1733d8482d46/src/main.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.h?ref=325c725fb6205e38142914acb9ed1733d8482d46",
        "patch": "@@ -42,8 +42,10 @@ struct CNodeStateStats;\n \n /** Default for accepting alerts from the P2P network. */\n static const bool DEFAULT_ALERTS = true;\n-/** Default for DEFAULT_WHITELISTALWAYSRELAY. */\n-static const bool DEFAULT_WHITELISTALWAYSRELAY = true;\n+/** Default for DEFAULT_WHITELISTRELAY. */\n+static const bool DEFAULT_WHITELISTRELAY = true;\n+/** Default for DEFAULT_WHITELISTFORCERELAY. */\n+static const bool DEFAULT_WHITELISTFORCERELAY = true;\n /** Default for -minrelaytxfee, minimum relay fee for transactions */\n static const unsigned int DEFAULT_MIN_RELAY_TX_FEE = 1000;\n /** Default for -maxorphantx, maximum number of orphan transactions kept in memory */"
      }
    ]
  },
  {
    "sha": "89d113e02a83617b4e971c160d47551476dacc71",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4OWQxMTNlMDJhODM2MTdiNGU5NzFjMTYwZDQ3NTUxNDc2ZGFjYzcx",
    "commit": {
      "author": {
        "name": "Gregory Maxwell",
        "email": "greg@xiph.org",
        "date": "2016-01-31T11:59:18Z"
      },
      "committer": {
        "name": "Gregory Maxwell",
        "email": "greg@xiph.org",
        "date": "2016-02-01T12:32:57Z"
      },
      "message": "Blacklist -whitelistalwaysrelay; replaced by -whitelistrelay.",
      "tree": {
        "sha": "730a2ed7f198ccc6a66328c806268814e87208fa",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/730a2ed7f198ccc6a66328c806268814e87208fa"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/89d113e02a83617b4e971c160d47551476dacc71",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/89d113e02a83617b4e971c160d47551476dacc71",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/89d113e02a83617b4e971c160d47551476dacc71",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/89d113e02a83617b4e971c160d47551476dacc71/comments",
    "author": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "325c725fb6205e38142914acb9ed1733d8482d46",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/325c725fb6205e38142914acb9ed1733d8482d46",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/325c725fb6205e38142914acb9ed1733d8482d46"
      }
    ],
    "stats": {
      "total": 7,
      "additions": 5,
      "deletions": 2
    },
    "files": [
      {
        "sha": "8c73cf1e8a735daf9eb1180e86ea164ac224b0f0",
        "filename": "contrib/devtools/check-doc.py",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/89d113e02a83617b4e971c160d47551476dacc71/contrib/devtools/check-doc.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/89d113e02a83617b4e971c160d47551476dacc71/contrib/devtools/check-doc.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/devtools/check-doc.py?ref=89d113e02a83617b4e971c160d47551476dacc71",
        "patch": "@@ -21,7 +21,7 @@\n REGEX_ARG = re.compile(r'(?:map(?:Multi)?Args(?:\\.count\\(|\\[)|Get(?:Bool)?Arg\\()\\\"(\\-[^\\\"]+?)\\\"')\n REGEX_DOC = re.compile(r'HelpMessageOpt\\(\\\"(\\-[^\\\"=]+?)(?:=|\\\")')\n # list unsupported, deprecated and duplicate args as they need no documentation\n-SET_DOC_OPTIONAL = set(['-rpcssl', '-benchmark', '-h', '-help', '-socks', '-tor', '-debugnet'])\n+SET_DOC_OPTIONAL = set(['-rpcssl', '-benchmark', '-h', '-help', '-socks', '-tor', '-debugnet', '-whitelistalwaysrelay'])\n \n def main():\n   used = check_output(CMD_GREP_ARGS, shell=True)"
      },
      {
        "sha": "173570069c07bcb5700a904f40644bb33f3e5682",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 1,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/89d113e02a83617b4e971c160d47551476dacc71/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/89d113e02a83617b4e971c160d47551476dacc71/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=89d113e02a83617b4e971c160d47551476dacc71",
        "patch": "@@ -751,7 +751,7 @@ void InitParameterInteraction()\n             LogPrintf(\"%s: parameter interaction: -zapwallettxes=<mode> -> setting -rescan=1\\n\", __func__);\n     }\n \n-    // disable walletbroadcast and whitelistalwaysrelay in blocksonly mode\n+    // disable walletbroadcast and whitelistrelay in blocksonly mode\n     if (GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY)) {\n         if (SoftSetBoolArg(\"-whitelistrelay\", false))\n             LogPrintf(\"%s: parameter interaction: -blocksonly=1 -> setting -whitelistrelay=0\\n\", __func__);\n@@ -902,6 +902,9 @@ bool AppInit2(boost::thread_group& threadGroup, CScheduler& scheduler)\n     if (GetBoolArg(\"-benchmark\", false))\n         InitWarning(_(\"Unsupported argument -benchmark ignored, use -debug=bench.\"));\n \n+    if (GetBoolArg(\"-whitelistalwaysrelay\", false))\n+        InitWarning(_(\"Unsupported argument -whitelistalwaysrelay ignored, use -whitelistrelay and/or -whitelistforcerelay.\"));\n+\n     // Checkmempool and checkblockindex default to true in regtest mode\n     int ratio = std::min<int>(std::max<int>(GetArg(\"-checkmempool\", chainparams.DefaultConsistencyChecks() ? 1 : 0), 0), 1000000);\n     if (ratio != 0) {"
      }
    ]
  }
]