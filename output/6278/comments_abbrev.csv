dexX7,2015-06-13T14:54:07Z,"Hmmm.. that's interesting. Are you sure this is related to the comparison tool?\n\nI'm asking, because I've never seen timeouts in another project/fork, which is currently based on Bitcoin Core 0.10. There are probably less than 10 builds per day though. But what I actually noticed: after testing a migration to 0.11 (based on [053110d](https://github.com/bitcoin/bitcoin/commit/053110ddcb1cc5a20658",https://github.com/bitcoin/bitcoin/pull/6278#issuecomment-111716924,111716924,
dexX7,2015-06-13T15:00:13Z,"The [current master](https://github.com/bitcoin/bitcoin/commit/ab0ec6790355473e96176ec3c2c2b1564ddb296d) seems to have the same problem. \n\nWhen running `test_bitcoin` in a loop, it stops at some point during the `scheduler_tests`.\n\nTested on Ubuntu 14.04 LTS x64 with:\n\n```\nBitcoin version v0.11.99.0-ab0ec67 (2015-06-12 16:49:53 +0200)\nUsing OpenSSL version OpenSSL 1.0.1f 6 Jan 2014\nUsing ",https://github.com/bitcoin/bitcoin/pull/6278#issuecomment-111717391,111717391,
laanwj,2015-06-15T05:52:07Z,"The scheduler test is another possible source of hangs. It has been fixed a few times, but it's still possible for there to be some race condition that makes it either never finish or really slowly.\n\nAdding timestamps to the test output, as well as more verbose logging to test_bitcoin, may be a good idea.\n",https://github.com/bitcoin/bitcoin/pull/6278#issuecomment-111934313,111934313,
laanwj,2015-06-15T05:54:50Z,"On the other hand I see a lot of false positives in travis end in the comparison tool .e.g. the end usually looks like\n\n```\n11:06:51 15 BitcoindComparisonTool$1.onPreMessageReceived: Got empty header message from bitcoind\n11:06:51 1 BitcoindComparisonTool.main: Block ""b3"" completed processing\n11:06:51 1 BitcoindComparisonTool.main: Testing block b3 499b1ec0ece4c4ef3b123d7498e3a5cfc85685fc9998",https://github.com/bitcoin/bitcoin/pull/6278#issuecomment-111934537,111934537,
theuni,2015-06-15T17:57:57Z,"@laanwj Yes, if you see the NPE, the tests will timeout. In that case, it's 100% related to the comparison tool.\n\nI'm still not sure how to proceed with troubleshooting that issue.\n",https://github.com/bitcoin/bitcoin/pull/6278#issuecomment-112153543,112153543,
laanwj,2015-06-16T12:41:05Z,@theuni I remember your plan was to replace the comparison tool with one built from a known source code. This at least makes the line numbers reliable. Or did problems come up with that?\n,https://github.com/bitcoin/bitcoin/pull/6278#issuecomment-112410473,112410473,
theuni,2015-06-17T03:10:43Z,"Ah right.\n\nNope, it just slipped my mind. Will do.\n",https://github.com/bitcoin/bitcoin/pull/6278#issuecomment-112632894,112632894,
laanwj,2015-06-17T08:21:51Z,"Yippie. I found one build that random-errored on master that didn't involve the comparison tool.\n\n```\nmake[3]: Entering directory `/home/travis/build/bitcoin/bitcoin/bitcoin-x86_64-unknown-linux-gnu/src'\n\nRunning 158 test cases...\n\nNo output has been received in the last 10 minutes, this potentially indicates a stalled build or something wrong with the build itself.\n\nThe build has been te",https://github.com/bitcoin/bitcoin/pull/6278#issuecomment-112714451,112714451,
dexX7,2015-06-17T13:37:48Z,"> although without more diagnostics it's hard to say.\n\nLocally I'm able to pin it down:\n\n``` bash\nSTATUS=0; while [ $STATUS=0 ]; do ./src/test/test_bitcoin --run_test=scheduler_tests/manythreads --log_level=all; STATUS=$?; done\n```\n\nAfter a few rounds it always stops with:\n\n```\nEntering test case ""manythreads""\ntest/scheduler_tests.cpp(70): info: check nTasks == 0 passed\ntest/scheduler",https://github.com/bitcoin/bitcoin/pull/6278#issuecomment-112802113,112802113,
gavinandresen,2015-06-17T13:49:12Z,"@dexX7 what OS and version of boost? (I cannot reproduce a hang using your while loop on OSX 10.10.3 and boost 1.58.0).\n\n@laanwj : if it turns out to be a bug in boost or the OS handling gazillions of threads, perhaps just removing the scheduler stress test would be the right thing to do. We aren't actually using gazillions of threads with the scheduler in Core code, just one.\n",https://github.com/bitcoin/bitcoin/pull/6278#issuecomment-112807408,112807408,
dexX7,2015-06-17T14:04:00Z,"@gavinandresen: locally I'm using Ubuntu 14.04.2 with Boost 1.54. Travis uses Ubuntu 12.04 with Boost 1.55.\n\nDisabling the scheduler test may reduce the number of occurrences, but as this PR indicates, timeouts were also seen during the comparison tool tests. It's not yet shown that this is caused by Boost threads, and it's only my guess.\n",https://github.com/bitcoin/bitcoin/pull/6278#issuecomment-112813031,112813031,
laanwj,2015-06-17T16:39:11Z,"The comparison tool failures and the scheduler tests failures are completely unrelated, the only thing they have in common is that they cause transient travis failures.\n\n@dexX7 Thanks for the extensive report, I'll have a look at the scheduler tests again, and see if I can find the issue. I doubt that it is an issue with boost, just with our usage of it (under load). Disabling the test is also a",https://github.com/bitcoin/bitcoin/pull/6278#issuecomment-112871718,112871718,
laanwj,2015-06-19T15:40:15Z,"Closing this pull for now, let's see how it goes after #6305\n",https://github.com/bitcoin/bitcoin/pull/6278#issuecomment-113552319,113552319,
