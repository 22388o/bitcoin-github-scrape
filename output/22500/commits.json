[
  {
    "sha": "cccc47b0ef5af66c8e6349d7cef60b902b80bc09",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpjY2NjNDdiMGVmNWFmNjZjOGU2MzQ5ZDdjZWY2MGI5MDJiODBiYzA5",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2021-07-19T14:58:55Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2021-07-19T14:47:41Z"
      },
      "message": "Assert in CAddrMan::Check()\n\nThe same is done in CTxMemPool::check() and other debug checks for\ndevelopers, like lock order debugging.",
      "tree": {
        "sha": "2b9f5b6963cbd0c2540036a19072193e70408f97",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2b9f5b6963cbd0c2540036a19072193e70408f97"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/cccc47b0ef5af66c8e6349d7cef60b902b80bc09",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\npUgT+Av/ZVaLRz63c6tVzrFAKJmfihvw4HaAHWBjPwF124ZjdT+9A4qAk308t7P8\nLDvYvjaUw/5xUgCyjfHNTrQjPydAd884l+h6yb90T7nMpFERlthATdtAhQCV6Q6Q\nRmqo1rXNlMb4DsgCbRZBUI/RimpqdaMWQftSW5uyt++Kb80Yg9PijRkyKSCkBMgU\nde7Ep9itkK59g2KLN1++BnYMtoZOnPnnXW5/QIkpXAhjMskFy55Ghv+nA2hPAU2b\nwusBgQvi2dmV4NC0UFY8XMERGDreftXqGL8Agx877tS0qBJTI3aL1R2ZrIFOnSqX\n+npNAES8jQqN3NxIjPLIfRqoZmSc7XvXnUXHrVx1+w55A7FAsuqUJ2/Dd1NRgoO6\nC/75lXqbise43vCBhWqjVLQotqohJrhSz/9fEdmwtYSUebrjs3rMZCsLLoi6jKpU\np10nINCqA9TSMHPkQQbof9I8xcIHq3ATnVxh4+KMpyEdDE0vrg2FMUPyxXuPnlyX\n45pTb3GT\n=dW3Y\n-----END PGP SIGNATURE-----",
        "payload": "tree 2b9f5b6963cbd0c2540036a19072193e70408f97\nparent 7e1ba37b5daceda222b138cbf61bbdeda87d21fd\nauthor MarcoFalke <falke.marco@gmail.com> 1626706735 +0200\ncommitter MarcoFalke <falke.marco@gmail.com> 1626706061 +0200\n\nAssert in CAddrMan::Check()\n\nThe same is done in CTxMemPool::check() and other debug checks for\ndevelopers, like lock order debugging.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/cccc47b0ef5af66c8e6349d7cef60b902b80bc09",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/cccc47b0ef5af66c8e6349d7cef60b902b80bc09",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/cccc47b0ef5af66c8e6349d7cef60b902b80bc09/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "7e1ba37b5daceda222b138cbf61bbdeda87d21fd",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7e1ba37b5daceda222b138cbf61bbdeda87d21fd",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/7e1ba37b5daceda222b138cbf61bbdeda87d21fd"
      }
    ],
    "stats": {
      "total": 83,
      "additions": 24,
      "deletions": 59
    },
    "files": [
      {
        "sha": "340d64410805184e89e58ace46891881e53839a1",
        "filename": "src/addrman.cpp",
        "status": "modified",
        "additions": 23,
        "deletions": 44,
        "changes": 67,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/cccc47b0ef5af66c8e6349d7cef60b902b80bc09/src/addrman.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/cccc47b0ef5af66c8e6349d7cef60b902b80bc09/src/addrman.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrman.cpp?ref=cccc47b0ef5af66c8e6349d7cef60b902b80bc09",
        "patch": "@@ -459,85 +459,64 @@ CAddrInfo CAddrMan::Select_(bool newOnly)\n     }\n }\n \n-#ifdef DEBUG_ADDRMAN\n-int CAddrMan::Check_()\n+void CAddrMan::Check()\n {\n+#ifdef DEBUG_ADDRMAN\n     AssertLockHeld(cs);\n \n     std::unordered_set<int> setTried;\n     std::unordered_map<int, int> mapNew;\n \n-    if (vRandom.size() != (size_t)(nTried + nNew))\n-        return -7;\n+    assert(vRandom.size() == (size_t)(nTried + nNew));\n \n     for (const auto& entry : mapInfo) {\n         int n = entry.first;\n         const CAddrInfo& info = entry.second;\n         if (info.fInTried) {\n-            if (!info.nLastSuccess)\n-                return -1;\n-            if (info.nRefCount)\n-                return -2;\n+            assert(info.nLastSuccess);\n+            assert(!info.nRefCount);\n             setTried.insert(n);\n         } else {\n-            if (info.nRefCount < 0 || info.nRefCount > ADDRMAN_NEW_BUCKETS_PER_ADDRESS)\n-                return -3;\n-            if (!info.nRefCount)\n-                return -4;\n+            assert(info.nRefCount >= 0 && info.nRefCount <= ADDRMAN_NEW_BUCKETS_PER_ADDRESS);\n+            assert(info.nRefCount);\n             mapNew[n] = info.nRefCount;\n         }\n-        if (mapAddr[info] != n)\n-            return -5;\n-        if (info.nRandomPos < 0 || (size_t)info.nRandomPos >= vRandom.size() || vRandom[info.nRandomPos] != n)\n-            return -14;\n-        if (info.nLastTry < 0)\n-            return -6;\n-        if (info.nLastSuccess < 0)\n-            return -8;\n+        assert(mapAddr[info] == n);\n+        assert(info.nRandomPos >= 0 && (size_t)info.nRandomPos < vRandom.size() && vRandom[info.nRandomPos] == n);\n+        assert(info.nLastTry >= 0);\n+        assert(info.nLastSuccess >= 0);\n     }\n \n-    if (setTried.size() != (size_t)nTried)\n-        return -9;\n-    if (mapNew.size() != (size_t)nNew)\n-        return -10;\n+    assert(setTried.size() == (size_t)nTried);\n+    assert(mapNew.size() == (size_t)nNew);\n \n     for (int n = 0; n < ADDRMAN_TRIED_BUCKET_COUNT; n++) {\n         for (int i = 0; i < ADDRMAN_BUCKET_SIZE; i++) {\n              if (vvTried[n][i] != -1) {\n-                 if (!setTried.count(vvTried[n][i]))\n-                     return -11;\n-                 if (mapInfo[vvTried[n][i]].GetTriedBucket(nKey, m_asmap) != n)\n-                     return -17;\n-                 if (mapInfo[vvTried[n][i]].GetBucketPosition(nKey, false, n) != i)\n-                     return -18;\n-                 setTried.erase(vvTried[n][i]);\n+                assert(setTried.count(vvTried[n][i]));\n+                assert(mapInfo[vvTried[n][i]].GetTriedBucket(nKey, m_asmap) == n);\n+                assert(mapInfo[vvTried[n][i]].GetBucketPosition(nKey, false, n) == i);\n+                setTried.erase(vvTried[n][i]);\n              }\n         }\n     }\n \n     for (int n = 0; n < ADDRMAN_NEW_BUCKET_COUNT; n++) {\n         for (int i = 0; i < ADDRMAN_BUCKET_SIZE; i++) {\n             if (vvNew[n][i] != -1) {\n-                if (!mapNew.count(vvNew[n][i]))\n-                    return -12;\n-                if (mapInfo[vvNew[n][i]].GetBucketPosition(nKey, true, n) != i)\n-                    return -19;\n+                assert(mapNew.count(vvNew[n][i]));\n+                assert(mapInfo[vvNew[n][i]].GetBucketPosition(nKey, true, n) == i);\n                 if (--mapNew[vvNew[n][i]] == 0)\n                     mapNew.erase(vvNew[n][i]);\n             }\n         }\n     }\n \n-    if (setTried.size())\n-        return -13;\n-    if (mapNew.size())\n-        return -15;\n-    if (nKey.IsNull())\n-        return -16;\n-\n-    return 0;\n-}\n+    assert(!setTried.size());\n+    assert(!mapNew.size());\n+    assert(!nKey.IsNull());\n #endif\n+}\n \n void CAddrMan::GetAddr_(std::vector<CAddress>& vAddr, size_t max_addresses, size_t max_pct, std::optional<Network> network)\n {"
      },
      {
        "sha": "befc378529c4c5d35187fd30d691e91e304eeaeb",
        "filename": "src/addrman.h",
        "status": "modified",
        "additions": 1,
        "deletions": 15,
        "changes": 16,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/cccc47b0ef5af66c8e6349d7cef60b902b80bc09/src/addrman.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/cccc47b0ef5af66c8e6349d7cef60b902b80bc09/src/addrman.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrman.h?ref=cccc47b0ef5af66c8e6349d7cef60b902b80bc09",
        "patch": "@@ -722,21 +722,7 @@ class CAddrMan\n \n     //! Consistency check\n     void Check()\n-        EXCLUSIVE_LOCKS_REQUIRED(cs)\n-    {\n-#ifdef DEBUG_ADDRMAN\n-        AssertLockHeld(cs);\n-        const int err = Check_();\n-        if (err) {\n-            LogPrintf(\"ADDRMAN CONSISTENCY CHECK FAILED!!! err=%i\\n\", err);\n-        }\n-#endif\n-    }\n-\n-#ifdef DEBUG_ADDRMAN\n-    //! Perform consistency check. Returns an error code or zero.\n-    int Check_() EXCLUSIVE_LOCKS_REQUIRED(cs);\n-#endif\n+        EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n     /**\n      * Return all or many randomly selected addresses, optionally by network."
      }
    ]
  },
  {
    "sha": "fa4bfef4798466e986569baf0d8e3213f17cafc8",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYTRiZmVmNDc5ODQ2NmU5ODY1NjliYWYwZDhlMzIxM2YxN2NhZmM4",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2021-07-19T18:02:37Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2021-07-19T17:47:56Z"
      },
      "message": "Fix whitespace\n\nRequested in https://github.com/bitcoin/bitcoin/pull/22500#discussion_r672440473",
      "tree": {
        "sha": "61989f9b8449f8248eb8fd2a8268292b0e0319e3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/61989f9b8449f8248eb8fd2a8268292b0e0319e3"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fa4bfef4798466e986569baf0d8e3213f17cafc8",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYEACgkQzit1aX5p\npUjyGwwArt6iE9kbbdd40eRv693hzD96BfD2bXUgf3kNuVL/a7Kgw8Dl/Bsdc5/1\n1W8U7asrMW3dWcWlVFNOP4UcR1csTQhP0k1n8BecQQaU8z5ciYy23V2vPTVjKiJS\nrV69Emu+vqarukqlZ56UGujRut5TIk7jDxtnWX8sH18sKiN7uVpMuFnbqV8U9GG6\n9oryOcNUZGvk5bSoDdtAx6aIkfdkJ0lXMYmFtuM1Er2OLWwSZKxEVSPsInI9BSkI\ngsNMnK4OuzUpIoXMa02CrwlJ/gcGtQOQMSvCzqGyDKCc5mtTqCgybfPPY2SWmRwi\nOd/m3xFWikkirNVCPED6dD5ttssmKnSyB8NKud2HNivXh2WmD2IPPzOT7BavwqJc\nTpAeHvmpgQgUL0vG1swZNds9YrsaNbwCJjpAVOd3Ny7gCf4UKEeA2C7LOsbermYA\nlgIRetotOPXnKuVN9vlDF1Bx7qVDa/7xhei3AqJN0OcVTr5ES8qOQi0xKf6iynUr\npSHl5Nly\n=ZRA5\n-----END PGP SIGNATURE-----",
        "payload": "tree 61989f9b8449f8248eb8fd2a8268292b0e0319e3\nparent cccc47b0ef5af66c8e6349d7cef60b902b80bc09\nauthor MarcoFalke <falke.marco@gmail.com> 1626717757 +0200\ncommitter MarcoFalke <falke.marco@gmail.com> 1626716876 +0200\n\nFix whitespace\n\nRequested in https://github.com/bitcoin/bitcoin/pull/22500#discussion_r672440473\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa4bfef4798466e986569baf0d8e3213f17cafc8",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fa4bfef4798466e986569baf0d8e3213f17cafc8",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa4bfef4798466e986569baf0d8e3213f17cafc8/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "cccc47b0ef5af66c8e6349d7cef60b902b80bc09",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/cccc47b0ef5af66c8e6349d7cef60b902b80bc09",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/cccc47b0ef5af66c8e6349d7cef60b902b80bc09"
      }
    ],
    "stats": {
      "total": 4,
      "additions": 2,
      "deletions": 2
    },
    "files": [
      {
        "sha": "8faa1a17b8427bfc49a6e456f0dbcf630db40f9d",
        "filename": "src/addrman.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa4bfef4798466e986569baf0d8e3213f17cafc8/src/addrman.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa4bfef4798466e986569baf0d8e3213f17cafc8/src/addrman.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrman.cpp?ref=fa4bfef4798466e986569baf0d8e3213f17cafc8",
        "patch": "@@ -492,12 +492,12 @@ void CAddrMan::Check()\n \n     for (int n = 0; n < ADDRMAN_TRIED_BUCKET_COUNT; n++) {\n         for (int i = 0; i < ADDRMAN_BUCKET_SIZE; i++) {\n-             if (vvTried[n][i] != -1) {\n+            if (vvTried[n][i] != -1) {\n                 assert(setTried.count(vvTried[n][i]));\n                 assert(mapInfo[vvTried[n][i]].GetTriedBucket(nKey, m_asmap) == n);\n                 assert(mapInfo[vvTried[n][i]].GetBucketPosition(nKey, false, n) == i);\n                 setTried.erase(vvTried[n][i]);\n-             }\n+            }\n         }\n     }\n "
      }
    ]
  }
]