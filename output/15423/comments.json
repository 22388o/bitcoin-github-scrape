[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/464362197",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#issuecomment-464362197",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15423",
    "id": 464362197,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NDM2MjE5Nw==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-16T16:51:33Z",
    "updated_at": "2021-11-09T23:14:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#22834](https://github.com/bitcoin/bitcoin/pull/22834) (net: respect -onlynet= when making outbound connections by vasild)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/464362197/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/492419231",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#issuecomment-492419231",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15423",
    "id": 492419231,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5MjQxOTIzMQ==",
    "user": {
      "login": "kristapsk",
      "id": 4500994,
      "node_id": "MDQ6VXNlcjQ1MDA5OTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4500994?u=85c0215b4144f580341a17fc5af4dad33c2d8123&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kristapsk",
      "html_url": "https://github.com/kristapsk",
      "followers_url": "https://api.github.com/users/kristapsk/followers",
      "following_url": "https://api.github.com/users/kristapsk/following{/other_user}",
      "gists_url": "https://api.github.com/users/kristapsk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kristapsk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kristapsk/subscriptions",
      "organizations_url": "https://api.github.com/users/kristapsk/orgs",
      "repos_url": "https://api.github.com/users/kristapsk/repos",
      "events_url": "https://api.github.com/users/kristapsk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kristapsk/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-05-14T21:36:43Z",
    "updated_at": "2019-05-14T21:36:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "Agree with @practicalswift comments, apart from that tACK 962f168a014af659feea0a7d6153e4c2b57cf2ed (enabled/disabled 9050 and other ports in `torrc`, compared behaviour between 0.18 and this).",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/492419231/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/499120541",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#issuecomment-499120541",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15423",
    "id": 499120541,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5OTEyMDU0MQ==",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-06-05T14:59:26Z",
    "updated_at": "2019-06-05T14:59:26Z",
    "author_association": "MEMBER",
    "body": "Concept ACK, thanks, this makes sense.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/499120541/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/553638092",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#issuecomment-553638092",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15423",
    "id": 553638092,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1MzYzODA5Mg==",
    "user": {
      "login": "kristapsk",
      "id": 4500994,
      "node_id": "MDQ6VXNlcjQ1MDA5OTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4500994?u=85c0215b4144f580341a17fc5af4dad33c2d8123&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kristapsk",
      "html_url": "https://github.com/kristapsk",
      "followers_url": "https://api.github.com/users/kristapsk/followers",
      "following_url": "https://api.github.com/users/kristapsk/following{/other_user}",
      "gists_url": "https://api.github.com/users/kristapsk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kristapsk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kristapsk/subscriptions",
      "organizations_url": "https://api.github.com/users/kristapsk/orgs",
      "repos_url": "https://api.github.com/users/kristapsk/repos",
      "events_url": "https://api.github.com/users/kristapsk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kristapsk/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-13T22:41:31Z",
    "updated_at": "2019-11-13T22:41:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "This came up in a twitter discussion with @luke-jr yesterday. What's blocker here? Or just forgot in a long list of unmerged PRs?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/553638092/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/571073344",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#issuecomment-571073344",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15423",
    "id": 571073344,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3MTA3MzM0NA==",
    "user": {
      "login": "Empact",
      "id": 5470,
      "node_id": "MDQ6VXNlcjU0NzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5470?u=a1574ca2038ff1dfaa9a7764c59ea5ff4f305b5d&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Empact",
      "html_url": "https://github.com/Empact",
      "followers_url": "https://api.github.com/users/Empact/followers",
      "following_url": "https://api.github.com/users/Empact/following{/other_user}",
      "gists_url": "https://api.github.com/users/Empact/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Empact/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Empact/subscriptions",
      "organizations_url": "https://api.github.com/users/Empact/orgs",
      "repos_url": "https://api.github.com/users/Empact/repos",
      "events_url": "https://api.github.com/users/Empact/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Empact/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-06T09:46:00Z",
    "updated_at": "2020-01-06T09:46:00Z",
    "author_association": "MEMBER",
    "body": "Concept ACK",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/571073344/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/596765664",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#issuecomment-596765664",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15423",
    "id": 596765664,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5Njc2NTY2NA==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-09T20:34:49Z",
    "updated_at": "2020-03-09T20:34:49Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--5d09a71f8925f3f132321140b44b946d-->The last travis run for this pull request was 387 days ago and is thus outdated. To trigger a fresh travis build, this pull request should be closed and re-opened.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/596765664/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/876785258",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#issuecomment-876785258",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15423",
    "id": 876785258,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3Njc4NTI1OA==",
    "user": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-08T22:28:18Z",
    "updated_at": "2021-07-08T22:28:18Z",
    "author_association": "MEMBER",
    "body": "Rebased, nits addressed",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/876785258/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/908172014",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#issuecomment-908172014",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15423",
    "id": 908172014,
    "node_id": "IC_kwDOABII5842IZru",
    "user": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?u=d06d2903ce6ad8b9d0c66ef9225fa21adfe22c7f&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasild/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-30T09:02:56Z",
    "updated_at": "2021-08-30T09:02:56Z",
    "author_association": "CONTRIBUTOR",
    "body": "@luke-jr, are you planning to update this PR?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/908172014/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/257479394",
    "pull_request_review_id": 204536661,
    "id": 257479394,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NzQ3OTM5NA==",
    "diff_hunk": "@@ -481,6 +483,53 @@ TorController::~TorController()\n     }\n }\n \n+void TorController::get_socks_cb(TorControlConnection& _conn, const TorControlReply& reply)\n+{\n+    // NOTE: We can only get here if -onion is unset",
    "path": "src/torcontrol.cpp",
    "position": 6,
    "original_position": 15,
    "commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "original_commit_id": "962f168a014af659feea0a7d6153e4c2b57cf2ed",
    "user": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Assert that condition?",
    "created_at": "2019-02-16T22:04:20Z",
    "updated_at": "2019-02-16T22:04:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r257479394",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/257479394"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r257479394"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/257479394/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 331,
    "original_line": 331,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/257497807",
    "pull_request_review_id": 204554635,
    "id": 257497807,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NzQ5NzgwNw==",
    "diff_hunk": "@@ -481,6 +483,53 @@ TorController::~TorController()\n     }\n }\n \n+void TorController::get_socks_cb(TorControlConnection& _conn, const TorControlReply& reply)",
    "path": "src/torcontrol.cpp",
    "position": 4,
    "original_position": 13,
    "commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "original_commit_id": "962f168a014af659feea0a7d6153e4c2b57cf2ed",
    "user": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Make sure parameter names match between declaration and definition :-)",
    "created_at": "2019-02-17T10:20:33Z",
    "updated_at": "2019-02-17T10:20:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r257497807",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/257497807"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r257497807"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/257497807/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 329,
    "original_line": 329,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/257546401",
    "pull_request_review_id": 204607108,
    "id": 257546401,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NzU0NjQwMQ==",
    "diff_hunk": "@@ -481,6 +483,53 @@ TorController::~TorController()\n     }\n }\n \n+void TorController::get_socks_cb(TorControlConnection& _conn, const TorControlReply& reply)",
    "path": "src/torcontrol.cpp",
    "position": 4,
    "original_position": 13,
    "commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "original_commit_id": "962f168a014af659feea0a7d6153e4c2b57cf2ed",
    "user": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I don't agree with that aesthetic.",
    "created_at": "2019-02-18T03:07:35Z",
    "updated_at": "2019-02-18T03:07:35Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r257546401",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/257546401"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r257546401"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/257546401/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 329,
    "original_line": 329,
    "side": "RIGHT",
    "in_reply_to_id": 257497807
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/290785964",
    "pull_request_review_id": 246067109,
    "id": 290785964,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5MDc4NTk2NA==",
    "diff_hunk": "@@ -481,6 +483,53 @@ TorController::~TorController()\n     }\n }\n \n+void TorController::get_socks_cb(TorControlConnection& _conn, const TorControlReply& reply)\n+{\n+    // NOTE: We can only get here if -onion is unset",
    "path": "src/torcontrol.cpp",
    "position": 6,
    "original_position": 15,
    "commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "original_commit_id": "962f168a014af659feea0a7d6153e4c2b57cf2ed",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Not necessary IMO.",
    "created_at": "2019-06-05T15:01:21Z",
    "updated_at": "2019-06-05T15:01:21Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r290785964",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/290785964"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r290785964"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/290785964/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 331,
    "original_line": 331,
    "side": "RIGHT",
    "in_reply_to_id": 257479394
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/291236109",
    "pull_request_review_id": 246639581,
    "id": 291236109,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5MTIzNjEwOQ==",
    "diff_hunk": "@@ -481,6 +483,53 @@ TorController::~TorController()\n     }\n }\n \n+void TorController::get_socks_cb(TorControlConnection& _conn, const TorControlReply& reply)\n+{\n+    // NOTE: We can only get here if -onion is unset\n+    std::string socks_port_str;\n+    if (reply.code == 250) {\n+        for (const auto& line : reply.lines) {\n+            if (0 == line.compare(0, 20, \"net/listeners/socks=\")) {\n+                const std::string port_list_str = line.substr(20);\n+                std::vector<std::string> port_list;\n+                boost::split(port_list, port_list_str, boost::is_any_of(\" \"));\n+                for (auto& portstr : port_list) {\n+                    if (portstr.empty()) continue;\n+                    if ((portstr[0] == '\"' || portstr[0] == '\\'') && (*portstr.rbegin() == '\"' || *portstr.rbegin() == '\\'')) {\n+                        portstr = portstr.substr(1, portstr.size() - 2);\n+                        if (portstr.empty()) continue;\n+                    }\n+                    socks_port_str = portstr;\n+                    if (0 == portstr.compare(0, 10, \"127.0.0.1:\")) {\n+                        // Prefer localhost - ignore other ports\n+                        break;\n+                    }\n+                }\n+            }\n+        }\n+        if (!socks_port_str.empty()) {\n+            LogPrint(BCLog::TOR, \"tor: Get SOCKS port command yielded %s\\n\", socks_port_str);\n+        } else {\n+            LogPrintf(\"tor: Get SOCKS port command returned nothing\\n\");\n+        }\n+    } else if (reply.code == 510) {  // 510 Unrecognized command\n+        LogPrintf(\"tor: Get SOCKS port command failed with unrecognized command (You probably should upgrade Tor)\\n\");",
    "path": "src/torcontrol.cpp",
    "position": 34,
    "original_position": 43,
    "commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "original_commit_id": "962f168a014af659feea0a7d6153e4c2b57cf2ed",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Do you know what is the minimum version of Tor supporting this query? is it newer or older than what we already require?\r\n(not that it matters much, as I se it'll gracefully fall back to the old behavior; but it might be useful for testing)",
    "created_at": "2019-06-06T15:17:28Z",
    "updated_at": "2019-06-06T15:18:38Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r291236109",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/291236109"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r291236109"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/291236109/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 359,
    "original_line": 359,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446106772",
    "pull_request_review_id": 438192562,
    "id": 446106772,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjEwNjc3Mg==",
    "diff_hunk": "@@ -524,10 +573,7 @@ void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply&\n         // Now that we know Tor is running setup the proxy for onion addresses\n         // if -onion isn't set to something else.\n         if (gArgs.GetArg(\"-onion\", \"\") == \"\") {\n-            CService resolved(LookupNumeric(\"127.0.0.1\", 9050));\n-            proxyType addrOnion = proxyType(resolved, true);\n-            SetProxy(NET_ONION, addrOnion);\n-            SetReachable(NET_ONION, true);\n+            _conn.Command(\"GETINFO net/listeners/socks\", std::bind(&TorController::get_socks_cb, this, std::placeholders::_1, std::placeholders::_2));",
    "path": "src/torcontrol.cpp",
    "position": 62,
    "original_position": 71,
    "commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "original_commit_id": "962f168a014af659feea0a7d6153e4c2b57cf2ed",
    "user": {
      "login": "Saibato",
      "id": 34917548,
      "node_id": "MDQ6VXNlcjM0OTE3NTQ4",
      "avatar_url": "https://avatars.githubusercontent.com/u/34917548?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Saibato",
      "html_url": "https://github.com/Saibato",
      "followers_url": "https://api.github.com/users/Saibato/followers",
      "following_url": "https://api.github.com/users/Saibato/following{/other_user}",
      "gists_url": "https://api.github.com/users/Saibato/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Saibato/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Saibato/subscriptions",
      "organizations_url": "https://api.github.com/users/Saibato/orgs",
      "repos_url": "https://api.github.com/users/Saibato/repos",
      "events_url": "https://api.github.com/users/Saibato/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Saibato/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Minor Nit  it does not account for early user -proxy=  settings and would overrule them.\r\n\r\nPlease consider the litle patch ff \r\nThat would also fix finally  #14722 and make #19358  obsolete.\r\n\r\n``` Diff\r\ndiff --git a/src/torcontrol.cpp b/src/torcontrol.cpp\r\nindex 2871f9030..dff873ce9 100644\r\n--- a/src/torcontrol.cpp\r\n+++ b/src/torcontrol.cpp\r\n@@ -573,7 +573,8 @@ void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply&\r\n \r\n         // Now that we know Tor is running setup the proxy for onion addresses\r\n         // if -onion isn't set to something else.\r\n-        if (gArgs.GetArg(\"-onion\", \"\") == \"\") {\r\n+        proxyType addrOnion;\r\n+        if (gArgs.GetArg(\"-onion\", \"\") == \"\" && !GetProxy(NET_ONION, addrOnion)) {\r\n             _conn.Command(\"GETINFO net/listeners/socks\", std::bind(&TorController::get_socks_cb, this, std::placeholders::_1, std::placeholders::_2));\r\n         }\r\n ",
    "created_at": "2020-06-26T10:38:31Z",
    "updated_at": "2020-06-26T10:40:37Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r446106772",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446106772"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r446106772"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446106772/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 416,
    "original_start_line": 573,
    "start_side": "RIGHT",
    "line": 419,
    "original_line": 419,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446117769",
    "pull_request_review_id": 438207227,
    "id": 446117769,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjExNzc2OQ==",
    "diff_hunk": "@@ -481,6 +483,53 @@ TorController::~TorController()\n     }\n }\n \n+void TorController::get_socks_cb(TorControlConnection& _conn, const TorControlReply& reply)\n+{\n+    // NOTE: We can only get here if -onion is unset\n+    std::string socks_port_str;\n+    if (reply.code == 250) {\n+        for (const auto& line : reply.lines) {\n+            if (0 == line.compare(0, 20, \"net/listeners/socks=\")) {\n+                const std::string port_list_str = line.substr(20);\n+                std::vector<std::string> port_list;\n+                boost::split(port_list, port_list_str, boost::is_any_of(\" \"));\n+                for (auto& portstr : port_list) {\n+                    if (portstr.empty()) continue;\n+                    if ((portstr[0] == '\"' || portstr[0] == '\\'') && (*portstr.rbegin() == '\"' || *portstr.rbegin() == '\\'')) {\n+                        portstr = portstr.substr(1, portstr.size() - 2);\n+                        if (portstr.empty()) continue;\n+                    }\n+                    socks_port_str = portstr;\n+                    if (0 == portstr.compare(0, 10, \"127.0.0.1:\")) {\n+                        // Prefer localhost - ignore other ports\n+                        break;\n+                    }\n+                }\n+            }\n+        }\n+        if (!socks_port_str.empty()) {\n+            LogPrint(BCLog::TOR, \"tor: Get SOCKS port command yielded %s\\n\", socks_port_str);\n+        } else {\n+            LogPrintf(\"tor: Get SOCKS port command returned nothing\\n\");\n+        }\n+    } else if (reply.code == 510) {  // 510 Unrecognized command\n+        LogPrintf(\"tor: Get SOCKS port command failed with unrecognized command (You probably should upgrade Tor)\\n\");",
    "path": "src/torcontrol.cpp",
    "position": 34,
    "original_position": 43,
    "commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "original_commit_id": "962f168a014af659feea0a7d6153e4c2b57cf2ed",
    "user": {
      "login": "Saibato",
      "id": 34917548,
      "node_id": "MDQ6VXNlcjM0OTE3NTQ4",
      "avatar_url": "https://avatars.githubusercontent.com/u/34917548?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Saibato",
      "html_url": "https://github.com/Saibato",
      "followers_url": "https://api.github.com/users/Saibato/followers",
      "following_url": "https://api.github.com/users/Saibato/following{/other_user}",
      "gists_url": "https://api.github.com/users/Saibato/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Saibato/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Saibato/subscriptions",
      "organizations_url": "https://api.github.com/users/Saibato/orgs",
      "repos_url": "https://api.github.com/users/Saibato/repos",
      "events_url": "https://api.github.com/users/Saibato/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Saibato/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> Do you know what is the minimum version of Tor supporting this query? is it newer or older than what we already require?\r\n> (not that it matters much, as I se it'll gracefully fall back to the old behavior; but it might be useful for testing)\r\n\r\nTyi: This info call /net/listeners/socks is according to tor doku possible since [ 0.2.2.26-beta.]\r\nI tested with versions 0.2.9.16 and 0.4.3.5\r\n\r\nChanges in tor version 0.2.2.32 - 2011-08-27\r\n\r\n>   o Minor features (controller interface):\r\n    - ****New \"GETINFO net/listeners/(type)\"** controller command to return\r\n      a list of addresses and ports that are bound for listeners for a**\r\n      given connection type. This is useful when the user has configured\r\n      \"SocksPort auto\" and the controller needs to know which port got\r\n      chosen. Resolves another part of ticket 3076.\r\n    - Have the controller interface give a more useful message than\r\n      \"Internal Error\" in response to failed GETINFO requests.\r\n",
    "created_at": "2020-06-26T11:06:01Z",
    "updated_at": "2020-06-26T11:06:10Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r446117769",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446117769"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r446117769"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446117769/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 359,
    "original_line": 359,
    "side": "RIGHT",
    "in_reply_to_id": 291236109
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592079279",
    "pull_request_review_id": 609408690,
    "id": 592079279,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MjA3OTI3OQ==",
    "diff_hunk": "@@ -481,6 +483,53 @@ TorController::~TorController()\n     }\n }\n \n+void TorController::get_socks_cb(TorControlConnection& _conn, const TorControlReply& reply)\n+{\n+    // NOTE: We can only get here if -onion is unset\n+    std::string socks_port_str;\n+    if (reply.code == 250) {\n+        for (const auto& line : reply.lines) {\n+            if (0 == line.compare(0, 20, \"net/listeners/socks=\")) {\n+                const std::string port_list_str = line.substr(20);\n+                std::vector<std::string> port_list;\n+                boost::split(port_list, port_list_str, boost::is_any_of(\" \"));\n+                for (auto& portstr : port_list) {",
    "path": "src/torcontrol.cpp",
    "position": 14,
    "original_position": 23,
    "commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "original_commit_id": "962f168a014af659feea0a7d6153e4c2b57cf2ed",
    "user": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasild/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\n                for (const auto& portstr : spanparsing::Split(port_list_str, ' ')) {\r\n```\r\n",
    "created_at": "2021-03-11T05:38:26Z",
    "updated_at": "2021-03-11T05:50:25Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r592079279",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592079279"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r592079279"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592079279/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 336,
    "original_start_line": 493,
    "start_side": "RIGHT",
    "line": 339,
    "original_line": 339,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592079893",
    "pull_request_review_id": 609408690,
    "id": 592079893,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MjA3OTg5Mw==",
    "diff_hunk": "@@ -481,6 +483,53 @@ TorController::~TorController()\n     }\n }\n \n+void TorController::get_socks_cb(TorControlConnection& _conn, const TorControlReply& reply)\n+{\n+    // NOTE: We can only get here if -onion is unset\n+    std::string socks_port_str;\n+    if (reply.code == 250) {\n+        for (const auto& line : reply.lines) {\n+            if (0 == line.compare(0, 20, \"net/listeners/socks=\")) {\n+                const std::string port_list_str = line.substr(20);\n+                std::vector<std::string> port_list;\n+                boost::split(port_list, port_list_str, boost::is_any_of(\" \"));\n+                for (auto& portstr : port_list) {\n+                    if (portstr.empty()) continue;\n+                    if ((portstr[0] == '\"' || portstr[0] == '\\'') && (*portstr.rbegin() == '\"' || *portstr.rbegin() == '\\'')) {",
    "path": "src/torcontrol.cpp",
    "position": null,
    "original_position": 25,
    "commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "original_commit_id": "962f168a014af659feea0a7d6153e4c2b57cf2ed",
    "user": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasild/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: this would accept `\"123'` and `'456\"`. I guess it is ok, but is also easy to avoid, thus I mention it.",
    "created_at": "2021-03-11T05:40:25Z",
    "updated_at": "2021-03-11T05:50:25Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r592079893",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592079893"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r592079893"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592079893/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 498,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592081880",
    "pull_request_review_id": 609408690,
    "id": 592081880,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MjA4MTg4MA==",
    "diff_hunk": "@@ -481,6 +483,53 @@ TorController::~TorController()\n     }\n }\n \n+void TorController::get_socks_cb(TorControlConnection& _conn, const TorControlReply& reply)\n+{\n+    // NOTE: We can only get here if -onion is unset\n+    std::string socks_port_str;\n+    if (reply.code == 250) {\n+        for (const auto& line : reply.lines) {\n+            if (0 == line.compare(0, 20, \"net/listeners/socks=\")) {\n+                const std::string port_list_str = line.substr(20);\n+                std::vector<std::string> port_list;\n+                boost::split(port_list, port_list_str, boost::is_any_of(\" \"));\n+                for (auto& portstr : port_list) {\n+                    if (portstr.empty()) continue;\n+                    if ((portstr[0] == '\"' || portstr[0] == '\\'') && (*portstr.rbegin() == '\"' || *portstr.rbegin() == '\\'')) {\n+                        portstr = portstr.substr(1, portstr.size() - 2);\n+                        if (portstr.empty()) continue;\n+                    }\n+                    socks_port_str = portstr;\n+                    if (0 == portstr.compare(0, 10, \"127.0.0.1:\")) {\n+                        // Prefer localhost - ignore other ports\n+                        break;\n+                    }\n+                }\n+            }\n+        }\n+        if (!socks_port_str.empty()) {\n+            LogPrint(BCLog::TOR, \"tor: Get SOCKS port command yielded %s\\n\", socks_port_str);\n+        } else {\n+            LogPrintf(\"tor: Get SOCKS port command returned nothing\\n\");\n+        }\n+    } else if (reply.code == 510) {  // 510 Unrecognized command\n+        LogPrintf(\"tor: Get SOCKS port command failed with unrecognized command (You probably should upgrade Tor)\\n\");\n+    } else {\n+        LogPrintf(\"tor: Get SOCKS port command failed; error code %d\\n\", reply.code);\n+    }\n+\n+    if (socks_port_str.empty()) {\n+        // Fallback to old behaviour\n+        socks_port_str = \"127.0.0.1\";",
    "path": "src/torcontrol.cpp",
    "position": null,
    "original_position": 50,
    "commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "original_commit_id": "962f168a014af659feea0a7d6153e4c2b57cf2ed",
    "user": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasild/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: this is somewhat confusing because we assign a `...port....` variable an address, not a port. Maybe `s/socks_port_str/socks_location/`.",
    "created_at": "2021-03-11T05:46:48Z",
    "updated_at": "2021-03-11T05:50:25Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r592081880",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592081880"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r592081880"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592081880/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 523,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666550686",
    "pull_request_review_id": 702541493,
    "id": 666550686,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NjU1MDY4Ng==",
    "diff_hunk": "@@ -524,10 +573,7 @@ void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply&\n         // Now that we know Tor is running setup the proxy for onion addresses\n         // if -onion isn't set to something else.\n         if (gArgs.GetArg(\"-onion\", \"\") == \"\") {\n-            CService resolved(LookupNumeric(\"127.0.0.1\", 9050));\n-            proxyType addrOnion = proxyType(resolved, true);\n-            SetProxy(NET_ONION, addrOnion);\n-            SetReachable(NET_ONION, true);\n+            _conn.Command(\"GETINFO net/listeners/socks\", std::bind(&TorController::get_socks_cb, this, std::placeholders::_1, std::placeholders::_2));",
    "path": "src/torcontrol.cpp",
    "position": 62,
    "original_position": 71,
    "commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "original_commit_id": "962f168a014af659feea0a7d6153e4c2b57cf2ed",
    "user": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "It would be incorrect behaviour.",
    "created_at": "2021-07-08T22:13:19Z",
    "updated_at": "2021-07-08T22:13:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r666550686",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666550686"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r666550686"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666550686/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 416,
    "original_start_line": 573,
    "start_side": "RIGHT",
    "line": 419,
    "original_line": 419,
    "side": "RIGHT",
    "in_reply_to_id": 446106772
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666552523",
    "pull_request_review_id": 702543716,
    "id": 666552523,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NjU1MjUyMw==",
    "diff_hunk": "@@ -481,6 +483,53 @@ TorController::~TorController()\n     }\n }\n \n+void TorController::get_socks_cb(TorControlConnection& _conn, const TorControlReply& reply)\n+{\n+    // NOTE: We can only get here if -onion is unset\n+    std::string socks_port_str;\n+    if (reply.code == 250) {\n+        for (const auto& line : reply.lines) {\n+            if (0 == line.compare(0, 20, \"net/listeners/socks=\")) {\n+                const std::string port_list_str = line.substr(20);\n+                std::vector<std::string> port_list;\n+                boost::split(port_list, port_list_str, boost::is_any_of(\" \"));\n+                for (auto& portstr : port_list) {",
    "path": "src/torcontrol.cpp",
    "position": 14,
    "original_position": 23,
    "commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "original_commit_id": "962f168a014af659feea0a7d6153e4c2b57cf2ed",
    "user": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```\r\ntorcontrol.cpp:340:80: error: no member named 'rbegin' in 'Span<const char>'; did you mean 'begin'?\r\n                    if ((portstr[0] == '\"' || portstr[0] == '\\'') && (*portstr.rbegin() == '\"' || *portstr.rbegin() == '\\'')) {\r\n                                                                               ^~~~~~\r\n```",
    "created_at": "2021-07-08T22:17:53Z",
    "updated_at": "2021-07-08T22:17:53Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r666552523",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666552523"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r666552523"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666552523/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 336,
    "original_start_line": 493,
    "start_side": "RIGHT",
    "line": 339,
    "original_line": 339,
    "side": "RIGHT",
    "in_reply_to_id": 592079279
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666885508",
    "pull_request_review_id": 702963335,
    "id": 666885508,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Njg4NTUwOA==",
    "diff_hunk": "@@ -481,6 +483,53 @@ TorController::~TorController()\n     }\n }\n \n+void TorController::get_socks_cb(TorControlConnection& _conn, const TorControlReply& reply)\n+{\n+    // NOTE: We can only get here if -onion is unset\n+    std::string socks_port_str;\n+    if (reply.code == 250) {\n+        for (const auto& line : reply.lines) {\n+            if (0 == line.compare(0, 20, \"net/listeners/socks=\")) {\n+                const std::string port_list_str = line.substr(20);\n+                std::vector<std::string> port_list;\n+                boost::split(port_list, port_list_str, boost::is_any_of(\" \"));\n+                for (auto& portstr : port_list) {",
    "path": "src/torcontrol.cpp",
    "position": 14,
    "original_position": 23,
    "commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "original_commit_id": "962f168a014af659feea0a7d6153e4c2b57cf2ed",
    "user": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasild/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Ah, `Span` has `begin()`, but no `rbegin()`. It has `back()` to lookup the last element, so `*portstr.rbegin()` can be replaced `portstr.back()` if you like it better.",
    "created_at": "2021-07-09T11:39:38Z",
    "updated_at": "2021-07-09T11:39:39Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r666885508",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666885508"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r666885508"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666885508/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 336,
    "original_start_line": 493,
    "start_side": "RIGHT",
    "line": 339,
    "original_line": 339,
    "side": "RIGHT",
    "in_reply_to_id": 592079279
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/677626301",
    "pull_request_review_id": 716151249,
    "id": 677626301,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3NzYyNjMwMQ==",
    "diff_hunk": "@@ -326,6 +326,53 @@ TorController::~TorController()\n     }\n }\n \n+void TorController::get_socks_cb(TorControlConnection& _conn, const TorControlReply& reply)\n+{\n+    // NOTE: We can only get here if -onion is unset\n+    std::string socks_location;\n+    if (reply.code == 250) {\n+        for (const auto& line : reply.lines) {\n+            if (0 == line.compare(0, 20, \"net/listeners/socks=\")) {\n+                const std::string port_list_str = line.substr(20);\n+                std::vector<std::string> port_list;\n+                boost::split(port_list, port_list_str, boost::is_any_of(\" \"));\n+                for (auto& portstr : port_list) {\n+                    if (portstr.empty()) continue;\n+                    if ((portstr[0] == '\"' || portstr[0] == '\\'') && (*portstr.rbegin() == portstr[0])) {\n+                        portstr = portstr.substr(1, portstr.size() - 2);\n+                        if (portstr.empty()) continue;",
    "path": "src/torcontrol.cpp",
    "position": 18,
    "original_position": 18,
    "commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "original_commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "user": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasild/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "If `portstr` contains just `\"` (it is a string with length 1), then this condition will evaluate to true. On the subsequent line `portstr.size() - 2` will be -1 converted to `size_t` (will cause a warning by the integer sanitizer). Then `substr(1, -1)` will return an empty string and it will work as intended - `continue;` will be executed.\r\n\r\nBut anyway, I think it is better to add one more condition to avoid the above: `&& portstr.size() >= 2`",
    "created_at": "2021-07-27T16:44:57Z",
    "updated_at": "2021-07-27T17:01:27Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r677626301",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/677626301"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r677626301"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/677626301/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 341,
    "original_start_line": 341,
    "start_side": "RIGHT",
    "line": 343,
    "original_line": 343,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/677631878",
    "pull_request_review_id": 716151249,
    "id": 677631878,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3NzYzMTg3OA==",
    "diff_hunk": "@@ -326,6 +326,53 @@ TorController::~TorController()\n     }\n }\n \n+void TorController::get_socks_cb(TorControlConnection& _conn, const TorControlReply& reply)\n+{\n+    // NOTE: We can only get here if -onion is unset\n+    std::string socks_location;\n+    if (reply.code == 250) {\n+        for (const auto& line : reply.lines) {\n+            if (0 == line.compare(0, 20, \"net/listeners/socks=\")) {\n+                const std::string port_list_str = line.substr(20);\n+                std::vector<std::string> port_list;\n+                boost::split(port_list, port_list_str, boost::is_any_of(\" \"));\n+                for (auto& portstr : port_list) {\n+                    if (portstr.empty()) continue;\n+                    if ((portstr[0] == '\"' || portstr[0] == '\\'') && (*portstr.rbegin() == portstr[0])) {\n+                        portstr = portstr.substr(1, portstr.size() - 2);\n+                        if (portstr.empty()) continue;\n+                    }\n+                    socks_location = portstr;\n+                    if (0 == portstr.compare(0, 10, \"127.0.0.1:\")) {\n+                        // Prefer localhost - ignore other ports\n+                        break;\n+                    }\n+                }\n+            }\n+        }\n+        if (!socks_location.empty()) {\n+            LogPrint(BCLog::TOR, \"tor: Get SOCKS port command yielded %s\\n\", socks_location);\n+        } else {\n+            LogPrintf(\"tor: Get SOCKS port command returned nothing\\n\");\n+        }\n+    } else if (reply.code == 510) {  // 510 Unrecognized command\n+        LogPrintf(\"tor: Get SOCKS port command failed with unrecognized command (You probably should upgrade Tor)\\n\");\n+    } else {\n+        LogPrintf(\"tor: Get SOCKS port command failed; error code %d\\n\", reply.code);\n+    }\n+\n+    if (socks_location.empty()) {\n+        // Fallback to old behaviour\n+        socks_location = \"127.0.0.1\";\n+    }\n+\n+    CService resolved(LookupNumeric(socks_location, 9050));",
    "path": "src/torcontrol.cpp",
    "position": 44,
    "original_position": 44,
    "commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "original_commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "user": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasild/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Would be good to check the result of `LookupNumeric()` in case some unexpected string was returned by the Tor server.\r\n\r\n```suggestion\r\n    CService resolved(LookupNumeric(socks_location, 9050));\r\n\r\n    if (!resolved.IsValid()) {\r\n        // Fallback to old behaviour\r\n        resolved = LookupNumeric(\"127.0.0.1\", 9050);\r\n    }\r\n```",
    "created_at": "2021-07-27T16:52:22Z",
    "updated_at": "2021-07-27T17:01:27Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r677631878",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/677631878"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r677631878"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/677631878/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 364,
    "original_start_line": 364,
    "start_side": "RIGHT",
    "line": 369,
    "original_line": 369,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/684585377",
    "pull_request_review_id": 724792747,
    "id": 684585377,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NDU4NTM3Nw==",
    "diff_hunk": "@@ -326,6 +326,53 @@ TorController::~TorController()\n     }\n }\n \n+void TorController::get_socks_cb(TorControlConnection& _conn, const TorControlReply& reply)\n+{\n+    // NOTE: We can only get here if -onion is unset\n+    std::string socks_location;\n+    if (reply.code == 250) {\n+        for (const auto& line : reply.lines) {\n+            if (0 == line.compare(0, 20, \"net/listeners/socks=\")) {\n+                const std::string port_list_str = line.substr(20);\n+                std::vector<std::string> port_list;\n+                boost::split(port_list, port_list_str, boost::is_any_of(\" \"));\n+                for (auto& portstr : port_list) {\n+                    if (portstr.empty()) continue;\n+                    if ((portstr[0] == '\"' || portstr[0] == '\\'') && (*portstr.rbegin() == portstr[0])) {\n+                        portstr = portstr.substr(1, portstr.size() - 2);\n+                        if (portstr.empty()) continue;\n+                    }\n+                    socks_location = portstr;\n+                    if (0 == portstr.compare(0, 10, \"127.0.0.1:\")) {\n+                        // Prefer localhost - ignore other ports\n+                        break;\n+                    }\n+                }\n+            }\n+        }\n+        if (!socks_location.empty()) {\n+            LogPrint(BCLog::TOR, \"tor: Get SOCKS port command yielded %s\\n\", socks_location);\n+        } else {\n+            LogPrintf(\"tor: Get SOCKS port command returned nothing\\n\");\n+        }\n+    } else if (reply.code == 510) {  // 510 Unrecognized command\n+        LogPrintf(\"tor: Get SOCKS port command failed with unrecognized command (You probably should upgrade Tor)\\n\");\n+    } else {\n+        LogPrintf(\"tor: Get SOCKS port command failed; error code %d\\n\", reply.code);\n+    }\n+\n+    if (socks_location.empty()) {\n+        // Fallback to old behaviour\n+        socks_location = \"127.0.0.1\";\n+    }\n+\n+    CService resolved(LookupNumeric(socks_location, 9050));",
    "path": "src/torcontrol.cpp",
    "position": 44,
    "original_position": 44,
    "commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "original_commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "user": {
      "login": "prayank23",
      "id": 13405205,
      "node_id": "MDQ6VXNlcjEzNDA1MjA1",
      "avatar_url": "https://avatars.githubusercontent.com/u/13405205?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prayank23",
      "html_url": "https://github.com/prayank23",
      "followers_url": "https://api.github.com/users/prayank23/followers",
      "following_url": "https://api.github.com/users/prayank23/following{/other_user}",
      "gists_url": "https://api.github.com/users/prayank23/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prayank23/subscriptions",
      "organizations_url": "https://api.github.com/users/prayank23/orgs",
      "repos_url": "https://api.github.com/users/prayank23/repos",
      "events_url": "https://api.github.com/users/prayank23/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prayank23/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Port 9150 for Windows: https://github.com/bitcoin/bitcoin/pull/22651#discussion_r684460683",
    "created_at": "2021-08-07T05:09:50Z",
    "updated_at": "2021-08-07T05:09:50Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r684585377",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/684585377"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r684585377"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/684585377/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 369,
    "original_line": 369,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/698524625",
    "pull_request_review_id": 741698265,
    "id": 698524625,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5ODUyNDYyNQ==",
    "diff_hunk": "@@ -326,6 +326,53 @@ TorController::~TorController()\n     }\n }\n \n+void TorController::get_socks_cb(TorControlConnection& _conn, const TorControlReply& reply)\n+{\n+    // NOTE: We can only get here if -onion is unset\n+    std::string socks_location;\n+    if (reply.code == 250) {\n+        for (const auto& line : reply.lines) {\n+            if (0 == line.compare(0, 20, \"net/listeners/socks=\")) {\n+                const std::string port_list_str = line.substr(20);\n+                std::vector<std::string> port_list;\n+                boost::split(port_list, port_list_str, boost::is_any_of(\" \"));\n+                for (auto& portstr : port_list) {\n+                    if (portstr.empty()) continue;\n+                    if ((portstr[0] == '\"' || portstr[0] == '\\'') && (*portstr.rbegin() == portstr[0])) {\n+                        portstr = portstr.substr(1, portstr.size() - 2);\n+                        if (portstr.empty()) continue;\n+                    }\n+                    socks_location = portstr;\n+                    if (0 == portstr.compare(0, 10, \"127.0.0.1:\")) {\n+                        // Prefer localhost - ignore other ports\n+                        break;\n+                    }\n+                }\n+            }\n+        }\n+        if (!socks_location.empty()) {\n+            LogPrint(BCLog::TOR, \"tor: Get SOCKS port command yielded %s\\n\", socks_location);\n+        } else {\n+            LogPrintf(\"tor: Get SOCKS port command returned nothing\\n\");\n+        }\n+    } else if (reply.code == 510) {  // 510 Unrecognized command\n+        LogPrintf(\"tor: Get SOCKS port command failed with unrecognized command (You probably should upgrade Tor)\\n\");\n+    } else {\n+        LogPrintf(\"tor: Get SOCKS port command failed; error code %d\\n\", reply.code);\n+    }\n+\n+    if (socks_location.empty()) {\n+        // Fallback to old behaviour\n+        socks_location = \"127.0.0.1\";\n+    }\n+\n+    CService resolved(LookupNumeric(socks_location, 9050));",
    "path": "src/torcontrol.cpp",
    "position": 44,
    "original_position": 44,
    "commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "original_commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "user": {
      "login": "kristapsk",
      "id": 4500994,
      "node_id": "MDQ6VXNlcjQ1MDA5OTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4500994?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kristapsk",
      "html_url": "https://github.com/kristapsk",
      "followers_url": "https://api.github.com/users/kristapsk/followers",
      "following_url": "https://api.github.com/users/kristapsk/following{/other_user}",
      "gists_url": "https://api.github.com/users/kristapsk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kristapsk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kristapsk/subscriptions",
      "organizations_url": "https://api.github.com/users/kristapsk/orgs",
      "repos_url": "https://api.github.com/users/kristapsk/repos",
      "events_url": "https://api.github.com/users/kristapsk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kristapsk/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Is it really Windows default? Not confusing with Tor Browser's default, which is 9150?",
    "created_at": "2021-08-30T14:13:50Z",
    "updated_at": "2021-08-30T14:13:50Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r698524625",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/698524625"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r698524625"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/698524625/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 369,
    "original_line": 369,
    "side": "RIGHT",
    "in_reply_to_id": 684585377
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/698565969",
    "pull_request_review_id": 741753775,
    "id": 698565969,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5ODU2NTk2OQ==",
    "diff_hunk": "@@ -326,6 +326,53 @@ TorController::~TorController()\n     }\n }\n \n+void TorController::get_socks_cb(TorControlConnection& _conn, const TorControlReply& reply)\n+{\n+    // NOTE: We can only get here if -onion is unset\n+    std::string socks_location;\n+    if (reply.code == 250) {\n+        for (const auto& line : reply.lines) {\n+            if (0 == line.compare(0, 20, \"net/listeners/socks=\")) {\n+                const std::string port_list_str = line.substr(20);\n+                std::vector<std::string> port_list;\n+                boost::split(port_list, port_list_str, boost::is_any_of(\" \"));\n+                for (auto& portstr : port_list) {\n+                    if (portstr.empty()) continue;\n+                    if ((portstr[0] == '\"' || portstr[0] == '\\'') && (*portstr.rbegin() == portstr[0])) {\n+                        portstr = portstr.substr(1, portstr.size() - 2);\n+                        if (portstr.empty()) continue;\n+                    }\n+                    socks_location = portstr;\n+                    if (0 == portstr.compare(0, 10, \"127.0.0.1:\")) {\n+                        // Prefer localhost - ignore other ports\n+                        break;\n+                    }\n+                }\n+            }\n+        }\n+        if (!socks_location.empty()) {\n+            LogPrint(BCLog::TOR, \"tor: Get SOCKS port command yielded %s\\n\", socks_location);\n+        } else {\n+            LogPrintf(\"tor: Get SOCKS port command returned nothing\\n\");\n+        }\n+    } else if (reply.code == 510) {  // 510 Unrecognized command\n+        LogPrintf(\"tor: Get SOCKS port command failed with unrecognized command (You probably should upgrade Tor)\\n\");\n+    } else {\n+        LogPrintf(\"tor: Get SOCKS port command failed; error code %d\\n\", reply.code);\n+    }\n+\n+    if (socks_location.empty()) {\n+        // Fallback to old behaviour\n+        socks_location = \"127.0.0.1\";\n+    }\n+\n+    CService resolved(LookupNumeric(socks_location, 9050));",
    "path": "src/torcontrol.cpp",
    "position": 44,
    "original_position": 44,
    "commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "original_commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "user": {
      "login": "prayank23",
      "id": 13405205,
      "node_id": "MDQ6VXNlcjEzNDA1MjA1",
      "avatar_url": "https://avatars.githubusercontent.com/u/13405205?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prayank23",
      "html_url": "https://github.com/prayank23",
      "followers_url": "https://api.github.com/users/prayank23/followers",
      "following_url": "https://api.github.com/users/prayank23/following{/other_user}",
      "gists_url": "https://api.github.com/users/prayank23/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prayank23/subscriptions",
      "organizations_url": "https://api.github.com/users/prayank23/orgs",
      "repos_url": "https://api.github.com/users/prayank23/repos",
      "events_url": "https://api.github.com/users/prayank23/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prayank23/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> Not confusing with Tor Browser's default, which is 9150?\r\n\r\nYes this is what I normally follow:\r\n\r\nWindows: Running Tor browser and using it as proxy\r\nLinux: Running Tor after installing with command: `sudo apt install tor`\r\n\r\nRunning Tor as service on Windows involves some workaround which I am not sure many do or maybe I am not aware of other easier ways to do it: https://superuser.com/questions/1631178/how-to-configure-tor-as-service-on-windows",
    "created_at": "2021-08-30T15:02:42Z",
    "updated_at": "2021-08-30T15:02:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r698565969",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/698565969"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r698565969"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/698565969/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 369,
    "original_line": 369,
    "side": "RIGHT",
    "in_reply_to_id": 684585377
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/698571479",
    "pull_request_review_id": 741761269,
    "id": 698571479,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5ODU3MTQ3OQ==",
    "diff_hunk": "@@ -326,6 +326,53 @@ TorController::~TorController()\n     }\n }\n \n+void TorController::get_socks_cb(TorControlConnection& _conn, const TorControlReply& reply)\n+{\n+    // NOTE: We can only get here if -onion is unset\n+    std::string socks_location;\n+    if (reply.code == 250) {\n+        for (const auto& line : reply.lines) {\n+            if (0 == line.compare(0, 20, \"net/listeners/socks=\")) {\n+                const std::string port_list_str = line.substr(20);\n+                std::vector<std::string> port_list;\n+                boost::split(port_list, port_list_str, boost::is_any_of(\" \"));\n+                for (auto& portstr : port_list) {\n+                    if (portstr.empty()) continue;\n+                    if ((portstr[0] == '\"' || portstr[0] == '\\'') && (*portstr.rbegin() == portstr[0])) {\n+                        portstr = portstr.substr(1, portstr.size() - 2);\n+                        if (portstr.empty()) continue;\n+                    }\n+                    socks_location = portstr;\n+                    if (0 == portstr.compare(0, 10, \"127.0.0.1:\")) {\n+                        // Prefer localhost - ignore other ports\n+                        break;\n+                    }\n+                }\n+            }\n+        }\n+        if (!socks_location.empty()) {\n+            LogPrint(BCLog::TOR, \"tor: Get SOCKS port command yielded %s\\n\", socks_location);\n+        } else {\n+            LogPrintf(\"tor: Get SOCKS port command returned nothing\\n\");\n+        }\n+    } else if (reply.code == 510) {  // 510 Unrecognized command\n+        LogPrintf(\"tor: Get SOCKS port command failed with unrecognized command (You probably should upgrade Tor)\\n\");\n+    } else {\n+        LogPrintf(\"tor: Get SOCKS port command failed; error code %d\\n\", reply.code);\n+    }\n+\n+    if (socks_location.empty()) {\n+        // Fallback to old behaviour\n+        socks_location = \"127.0.0.1\";\n+    }\n+\n+    CService resolved(LookupNumeric(socks_location, 9050));",
    "path": "src/torcontrol.cpp",
    "position": 44,
    "original_position": 44,
    "commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "original_commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "user": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "9050 here serves two purposes:\r\n\r\n1. Fallback to old behaviour. This was always 9050.\r\n2. Default port if Tor's API returns just an IP. Is there any reason to think it would ever be anything other than 9050?",
    "created_at": "2021-08-30T15:09:33Z",
    "updated_at": "2021-08-30T15:09:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r698571479",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/698571479"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r698571479"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/698571479/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 369,
    "original_line": 369,
    "side": "RIGHT",
    "in_reply_to_id": 684585377
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/699014147",
    "pull_request_review_id": 742314555,
    "id": 699014147,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5OTAxNDE0Nw==",
    "diff_hunk": "@@ -326,6 +326,53 @@ TorController::~TorController()\n     }\n }\n \n+void TorController::get_socks_cb(TorControlConnection& _conn, const TorControlReply& reply)\n+{\n+    // NOTE: We can only get here if -onion is unset\n+    std::string socks_location;\n+    if (reply.code == 250) {\n+        for (const auto& line : reply.lines) {\n+            if (0 == line.compare(0, 20, \"net/listeners/socks=\")) {\n+                const std::string port_list_str = line.substr(20);\n+                std::vector<std::string> port_list;\n+                boost::split(port_list, port_list_str, boost::is_any_of(\" \"));\n+                for (auto& portstr : port_list) {\n+                    if (portstr.empty()) continue;\n+                    if ((portstr[0] == '\"' || portstr[0] == '\\'') && (*portstr.rbegin() == portstr[0])) {\n+                        portstr = portstr.substr(1, portstr.size() - 2);\n+                        if (portstr.empty()) continue;\n+                    }\n+                    socks_location = portstr;\n+                    if (0 == portstr.compare(0, 10, \"127.0.0.1:\")) {\n+                        // Prefer localhost - ignore other ports\n+                        break;\n+                    }\n+                }\n+            }\n+        }\n+        if (!socks_location.empty()) {\n+            LogPrint(BCLog::TOR, \"tor: Get SOCKS port command yielded %s\\n\", socks_location);\n+        } else {\n+            LogPrintf(\"tor: Get SOCKS port command returned nothing\\n\");\n+        }\n+    } else if (reply.code == 510) {  // 510 Unrecognized command\n+        LogPrintf(\"tor: Get SOCKS port command failed with unrecognized command (You probably should upgrade Tor)\\n\");\n+    } else {\n+        LogPrintf(\"tor: Get SOCKS port command failed; error code %d\\n\", reply.code);\n+    }\n+\n+    if (socks_location.empty()) {\n+        // Fallback to old behaviour\n+        socks_location = \"127.0.0.1\";\n+    }\n+\n+    CService resolved(LookupNumeric(socks_location, 9050));",
    "path": "src/torcontrol.cpp",
    "position": 44,
    "original_position": 44,
    "commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "original_commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "user": {
      "login": "lano1106",
      "id": 4829131,
      "node_id": "MDQ6VXNlcjQ4MjkxMzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4829131?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lano1106",
      "html_url": "https://github.com/lano1106",
      "followers_url": "https://api.github.com/users/lano1106/followers",
      "following_url": "https://api.github.com/users/lano1106/following{/other_user}",
      "gists_url": "https://api.github.com/users/lano1106/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lano1106/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lano1106/subscriptions",
      "organizations_url": "https://api.github.com/users/lano1106/orgs",
      "repos_url": "https://api.github.com/users/lano1106/repos",
      "events_url": "https://api.github.com/users/lano1106/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lano1106/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Here is my torcfg settings\r\n\r\n```\r\n## Tor opens a SOCKS proxy on port 9050 by default -- even if you don't\r\n## configure one below. Set \"SOCKSPort 0\" if you plan to run Tor only\r\n## as a relay, and not make any local application connections yourself.\r\nSOCKSPort 9050 # Default: Bind to localhost:9050 for local connections.\r\nSOCKSPort 192.168.1.2:9050 # Bind to this address:port too.\r\n```\r\n\r\nIf only the port is provided, it is binded implicitly to 127.0.0.1. I need to test this patch to see the actual output but if what is printed by nyx is what is returned as-is by torcontrol, the config above would return:\r\n\r\n`9050, 192.168.1.2:9050`\r\n\r\nYour function wants to favor 127.0.0.1 but I think that it could miss the standalone port value scenario...",
    "created_at": "2021-08-31T06:16:45Z",
    "updated_at": "2021-09-01T04:25:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r699014147",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/699014147"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r699014147"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/699014147/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 369,
    "original_line": 369,
    "side": "RIGHT",
    "in_reply_to_id": 684585377
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/699814748",
    "pull_request_review_id": 743363767,
    "id": 699814748,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5OTgxNDc0OA==",
    "diff_hunk": "@@ -369,10 +416,7 @@ void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply&\n         // Now that we know Tor is running setup the proxy for onion addresses\n         // if -onion isn't set to something else.\n         if (gArgs.GetArg(\"-onion\", \"\") == \"\") {",
    "path": "src/torcontrol.cpp",
    "position": 57,
    "original_position": 57,
    "commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "original_commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "user": {
      "login": "lano1106",
      "id": 4829131,
      "node_id": "MDQ6VXNlcjQ4MjkxMzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4829131?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lano1106",
      "html_url": "https://github.com/lano1106",
      "followers_url": "https://api.github.com/users/lano1106/followers",
      "following_url": "https://api.github.com/users/lano1106/following{/other_user}",
      "gists_url": "https://api.github.com/users/lano1106/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lano1106/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lano1106/subscriptions",
      "organizations_url": "https://api.github.com/users/lano1106/orgs",
      "repos_url": "https://api.github.com/users/lano1106/repos",
      "events_url": "https://api.github.com/users/lano1106/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lano1106/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This line did cause me a problem and this is why I created https://github.com/bitcoin/bitcoin/pull/22830\r\n\r\nIn a nutshell, you could have the  onion proxy set with the following cmdline:\r\n-proxy=192.168.1.2:9050 -torcontrol=127.0.0.1:9050\r\n\r\nI believe that check the presence of the -onion switch is not the right check because the check as-is overwrite the user settings.\r\n\r\nThe code should instead call GetProxy() and only enter the conditional block if function returns false because the onion proxy is not currently valid.",
    "created_at": "2021-09-01T03:22:14Z",
    "updated_at": "2021-09-01T19:13:57Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r699814748",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/699814748"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r699814748"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/699814748/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 418,
    "original_line": 418,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/699818729",
    "pull_request_review_id": 743368564,
    "id": 699818729,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5OTgxODcyOQ==",
    "diff_hunk": "@@ -326,6 +326,53 @@ TorController::~TorController()\n     }\n }\n \n+void TorController::get_socks_cb(TorControlConnection& _conn, const TorControlReply& reply)\n+{\n+    // NOTE: We can only get here if -onion is unset\n+    std::string socks_location;\n+    if (reply.code == 250) {\n+        for (const auto& line : reply.lines) {\n+            if (0 == line.compare(0, 20, \"net/listeners/socks=\")) {\n+                const std::string port_list_str = line.substr(20);\n+                std::vector<std::string> port_list;\n+                boost::split(port_list, port_list_str, boost::is_any_of(\" \"));\n+                for (auto& portstr : port_list) {\n+                    if (portstr.empty()) continue;\n+                    if ((portstr[0] == '\"' || portstr[0] == '\\'') && (*portstr.rbegin() == portstr[0])) {\n+                        portstr = portstr.substr(1, portstr.size() - 2);\n+                        if (portstr.empty()) continue;\n+                    }\n+                    socks_location = portstr;\n+                    if (0 == portstr.compare(0, 10, \"127.0.0.1:\")) {\n+                        // Prefer localhost - ignore other ports\n+                        break;\n+                    }\n+                }\n+            }\n+        }\n+        if (!socks_location.empty()) {\n+            LogPrint(BCLog::TOR, \"tor: Get SOCKS port command yielded %s\\n\", socks_location);\n+        } else {\n+            LogPrintf(\"tor: Get SOCKS port command returned nothing\\n\");\n+        }\n+    } else if (reply.code == 510) {  // 510 Unrecognized command\n+        LogPrintf(\"tor: Get SOCKS port command failed with unrecognized command (You probably should upgrade Tor)\\n\");\n+    } else {\n+        LogPrintf(\"tor: Get SOCKS port command failed; error code %d\\n\", reply.code);\n+    }\n+\n+    if (socks_location.empty()) {\n+        // Fallback to old behaviour\n+        socks_location = \"127.0.0.1\";\n+    }\n+\n+    CService resolved(LookupNumeric(socks_location, 9050));",
    "path": "src/torcontrol.cpp",
    "position": 44,
    "original_position": 44,
    "commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "original_commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "user": {
      "login": "lano1106",
      "id": 4829131,
      "node_id": "MDQ6VXNlcjQ4MjkxMzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4829131?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lano1106",
      "html_url": "https://github.com/lano1106",
      "followers_url": "https://api.github.com/users/lano1106/followers",
      "following_url": "https://api.github.com/users/lano1106/following{/other_user}",
      "gists_url": "https://api.github.com/users/lano1106/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lano1106/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lano1106/subscriptions",
      "organizations_url": "https://api.github.com/users/lano1106/orgs",
      "repos_url": "https://api.github.com/users/lano1106/repos",
      "events_url": "https://api.github.com/users/lano1106/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lano1106/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I have few more thoughts to share to possibly improve further the code of this function. Here is my setup:\r\n\r\nI have 1 tor proxy configured on a single machine in my LAN. It is on 192.168.1.2. This allows me to share a single tor proxy instance among all the trusted machines inside my LAN.\r\n\r\nBitcoind is running on a different machine: 192.168.1.179.\r\n\r\nMy first attempt to make torcontrol available for bitcoind was to bind the control listening socket to 192.168.1.2:9051.\r\nIt works except that tor is complaining big time that this is opening a security risk as the control protocol exchange is in clear text over the network.\r\n\r\nTo fix that, I did create a SSH tunnel between the 2 machines 127.0.0.1:9051.\r\n\r\nWhat that means is that when I start bitcoind from 192.168.1.179 machine with the cmdline:\r\n-proxy 192.168.1.2:9050 -torcontrol 127.0.0.1:9051\r\n\r\nWhen bitcoind connects with torcontrol, despite it is a localhost address, it does actually connect to a remote server.\r\n\r\nWhat all this means for this commit?\r\n\r\nWell, it favors the tor proxy address 127.0.0.1. With my setup, it will fail.\r\n\r\nThe first solution to address this issue that came to my mind is to test that 127.0.0.1:9050 is listening but this is clumsy, there is no simple and portable way to check that beside actually connect a socket to the address...\r\n\r\nThen, I did ask myself the following question:\r\nWhat are exactly the benefits of connecting to the localhost proxy address if present?\r\n\r\nI am not sure if there is any.\r\n\r\nOTOH, if you connect to the first public IP address listed in the reply, it will work with the most common case where the proxy is on the same machine and it will also work on more funky setups like mine...\r\n\r\nHow do you feel toward this suggestion? Does that makes sense to you?",
    "created_at": "2021-09-01T03:35:48Z",
    "updated_at": "2021-09-01T03:37:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r699818729",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/699818729"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r699818729"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/699818729/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 369,
    "original_line": 369,
    "side": "RIGHT",
    "in_reply_to_id": 684585377
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701097810",
    "pull_request_review_id": 745081753,
    "id": 701097810,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMTA5NzgxMA==",
    "diff_hunk": "@@ -326,6 +326,53 @@ TorController::~TorController()\n     }\n }\n \n+void TorController::get_socks_cb(TorControlConnection& _conn, const TorControlReply& reply)\n+{\n+    // NOTE: We can only get here if -onion is unset\n+    std::string socks_location;\n+    if (reply.code == 250) {\n+        for (const auto& line : reply.lines) {\n+            if (0 == line.compare(0, 20, \"net/listeners/socks=\")) {\n+                const std::string port_list_str = line.substr(20);\n+                std::vector<std::string> port_list;\n+                boost::split(port_list, port_list_str, boost::is_any_of(\" \"));\n+                for (auto& portstr : port_list) {\n+                    if (portstr.empty()) continue;\n+                    if ((portstr[0] == '\"' || portstr[0] == '\\'') && (*portstr.rbegin() == portstr[0])) {\n+                        portstr = portstr.substr(1, portstr.size() - 2);\n+                        if (portstr.empty()) continue;\n+                    }\n+                    socks_location = portstr;\n+                    if (0 == portstr.compare(0, 10, \"127.0.0.1:\")) {\n+                        // Prefer localhost - ignore other ports\n+                        break;\n+                    }\n+                }\n+            }\n+        }\n+        if (!socks_location.empty()) {\n+            LogPrint(BCLog::TOR, \"tor: Get SOCKS port command yielded %s\\n\", socks_location);\n+        } else {\n+            LogPrintf(\"tor: Get SOCKS port command returned nothing\\n\");\n+        }\n+    } else if (reply.code == 510) {  // 510 Unrecognized command\n+        LogPrintf(\"tor: Get SOCKS port command failed with unrecognized command (You probably should upgrade Tor)\\n\");\n+    } else {\n+        LogPrintf(\"tor: Get SOCKS port command failed; error code %d\\n\", reply.code);\n+    }\n+\n+    if (socks_location.empty()) {\n+        // Fallback to old behaviour\n+        socks_location = \"127.0.0.1\";\n+    }\n+\n+    CService resolved(LookupNumeric(socks_location, 9050));",
    "path": "src/torcontrol.cpp",
    "position": 44,
    "original_position": 44,
    "commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "original_commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "user": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasild/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I tested with\r\n```\r\nSOCKSPort 10000\r\nSOCKSPort 192.168.0.1:20000\r\nSOCKSPort 0.0.0.0:30000\r\n```\r\n\r\nThe reply from the Tor control daemon is:\r\n```\r\nnet/listeners/socks=\"127.0.0.1:10000\" \"192.168.0.1:20000\" \"0.0.0.0:30000\"\r\n```\r\nso it does not return just port. The spec is here: https://github.com/torproject/torspec/blob/845a4d7213e8e28bb039d6925437b5b1c0d607e7/control-spec.txt#L912.\r\n\r\nMaybe it makes sense to choose the non-`127.0.0.1` address if there are a few:\r\n1. If the Tor daemon is on the same machine as bitcoind, then either one will work and communication will be local anyway\r\n2. If the Tor daemon is on another machine, only the non-`127.0.0.1` address will work.\r\n\r\nBut anyway - we can't expect the automatic configuration to detect and work in all cases. For this we have the manual override. @lano1106, in your case you can set `-onion=192.168.1.2:9050` which will work with `master` and with this PR.",
    "created_at": "2021-09-02T13:44:47Z",
    "updated_at": "2021-09-02T13:44:47Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r701097810",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701097810"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r701097810"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701097810/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 369,
    "original_line": 369,
    "side": "RIGHT",
    "in_reply_to_id": 684585377
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701113329",
    "pull_request_review_id": 745103251,
    "id": 701113329,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMTExMzMyOQ==",
    "diff_hunk": "@@ -326,6 +326,53 @@ TorController::~TorController()\n     }\n }\n \n+void TorController::get_socks_cb(TorControlConnection& _conn, const TorControlReply& reply)\n+{\n+    // NOTE: We can only get here if -onion is unset\n+    std::string socks_location;\n+    if (reply.code == 250) {\n+        for (const auto& line : reply.lines) {\n+            if (0 == line.compare(0, 20, \"net/listeners/socks=\")) {\n+                const std::string port_list_str = line.substr(20);\n+                std::vector<std::string> port_list;\n+                boost::split(port_list, port_list_str, boost::is_any_of(\" \"));\n+                for (auto& portstr : port_list) {\n+                    if (portstr.empty()) continue;\n+                    if ((portstr[0] == '\"' || portstr[0] == '\\'') && (*portstr.rbegin() == portstr[0])) {\n+                        portstr = portstr.substr(1, portstr.size() - 2);\n+                        if (portstr.empty()) continue;\n+                    }\n+                    socks_location = portstr;\n+                    if (0 == portstr.compare(0, 10, \"127.0.0.1:\")) {\n+                        // Prefer localhost - ignore other ports\n+                        break;\n+                    }\n+                }\n+            }\n+        }\n+        if (!socks_location.empty()) {\n+            LogPrint(BCLog::TOR, \"tor: Get SOCKS port command yielded %s\\n\", socks_location);\n+        } else {\n+            LogPrintf(\"tor: Get SOCKS port command returned nothing\\n\");\n+        }\n+    } else if (reply.code == 510) {  // 510 Unrecognized command\n+        LogPrintf(\"tor: Get SOCKS port command failed with unrecognized command (You probably should upgrade Tor)\\n\");\n+    } else {\n+        LogPrintf(\"tor: Get SOCKS port command failed; error code %d\\n\", reply.code);\n+    }\n+\n+    if (socks_location.empty()) {\n+        // Fallback to old behaviour\n+        socks_location = \"127.0.0.1\";\n+    }\n+\n+    CService resolved(LookupNumeric(socks_location, 9050));",
    "path": "src/torcontrol.cpp",
    "position": 44,
    "original_position": 44,
    "commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "original_commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "user": {
      "login": "lano1106",
      "id": 4829131,
      "node_id": "MDQ6VXNlcjQ4MjkxMzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4829131?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lano1106",
      "html_url": "https://github.com/lano1106",
      "followers_url": "https://api.github.com/users/lano1106/followers",
      "following_url": "https://api.github.com/users/lano1106/following{/other_user}",
      "gists_url": "https://api.github.com/users/lano1106/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lano1106/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lano1106/subscriptions",
      "organizations_url": "https://api.github.com/users/lano1106/orgs",
      "repos_url": "https://api.github.com/users/lano1106/repos",
      "events_url": "https://api.github.com/users/lano1106/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lano1106/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Vasil, you have been faster than me... I just tested too this morning:\r\n`2021-09-02T13:51:22Z tor: reply line: net/listeners/socks=\"127.0.0.1:9050\" \"192.168.1.2:9050\"`\r\n\r\nSo overall this pull request works well. I just think non localhost address should be prefered over 127.0.0.1. This would work with my setup and I don't see any extra benefits of picking 127.0.0.1 in any scenario.\r\n",
    "created_at": "2021-09-02T14:00:58Z",
    "updated_at": "2021-09-02T14:04:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r701113329",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701113329"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r701113329"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701113329/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 369,
    "original_line": 369,
    "side": "RIGHT",
    "in_reply_to_id": 684585377
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701149240",
    "pull_request_review_id": 745153524,
    "id": 701149240,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMTE0OTI0MA==",
    "diff_hunk": "@@ -326,6 +326,53 @@ TorController::~TorController()\n     }\n }\n \n+void TorController::get_socks_cb(TorControlConnection& _conn, const TorControlReply& reply)\n+{\n+    // NOTE: We can only get here if -onion is unset\n+    std::string socks_location;\n+    if (reply.code == 250) {\n+        for (const auto& line : reply.lines) {\n+            if (0 == line.compare(0, 20, \"net/listeners/socks=\")) {\n+                const std::string port_list_str = line.substr(20);\n+                std::vector<std::string> port_list;\n+                boost::split(port_list, port_list_str, boost::is_any_of(\" \"));\n+                for (auto& portstr : port_list) {\n+                    if (portstr.empty()) continue;\n+                    if ((portstr[0] == '\"' || portstr[0] == '\\'') && (*portstr.rbegin() == portstr[0])) {\n+                        portstr = portstr.substr(1, portstr.size() - 2);\n+                        if (portstr.empty()) continue;\n+                    }\n+                    socks_location = portstr;\n+                    if (0 == portstr.compare(0, 10, \"127.0.0.1:\")) {\n+                        // Prefer localhost - ignore other ports\n+                        break;\n+                    }\n+                }\n+            }\n+        }\n+        if (!socks_location.empty()) {\n+            LogPrint(BCLog::TOR, \"tor: Get SOCKS port command yielded %s\\n\", socks_location);\n+        } else {\n+            LogPrintf(\"tor: Get SOCKS port command returned nothing\\n\");\n+        }\n+    } else if (reply.code == 510) {  // 510 Unrecognized command\n+        LogPrintf(\"tor: Get SOCKS port command failed with unrecognized command (You probably should upgrade Tor)\\n\");\n+    } else {\n+        LogPrintf(\"tor: Get SOCKS port command failed; error code %d\\n\", reply.code);\n+    }\n+\n+    if (socks_location.empty()) {\n+        // Fallback to old behaviour\n+        socks_location = \"127.0.0.1\";\n+    }\n+\n+    CService resolved(LookupNumeric(socks_location, 9050));",
    "path": "src/torcontrol.cpp",
    "position": 44,
    "original_position": 44,
    "commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "original_commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "user": {
      "login": "lano1106",
      "id": 4829131,
      "node_id": "MDQ6VXNlcjQ4MjkxMzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4829131?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lano1106",
      "html_url": "https://github.com/lano1106",
      "followers_url": "https://api.github.com/users/lano1106/followers",
      "following_url": "https://api.github.com/users/lano1106/following{/other_user}",
      "gists_url": "https://api.github.com/users/lano1106/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lano1106/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lano1106/subscriptions",
      "organizations_url": "https://api.github.com/users/lano1106/orgs",
      "repos_url": "https://api.github.com/users/lano1106/repos",
      "events_url": "https://api.github.com/users/lano1106/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lano1106/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> But anyway - we can't expect the automatic configuration to detect and work in all cases. For this we have the manual override. @lano1106, in your case you can set `-onion=192.168.1.2:9050` which will work with `master` and with this PR.\r\n\r\nyou are correct but see my other suggestion below. I did configure the onion proxy with the following options:\r\n-proxy=192.168.1.2:9050 -torcontrol=127.0.0.1:9151\r\n\r\nI think that the condition:\r\n`gArgs.GetArg(\"-onion\", \"\") == \"\"`\r\n\r\nshould be changed with:\r\n`!GetProxy(NET_ONION, addrOnion)`\r\n\r\nbecause -onion switch is not the only way to configure the onion proxy. This is the root cause of my problem and why I got interested in this issue in the first place...",
    "created_at": "2021-09-02T14:38:52Z",
    "updated_at": "2021-09-02T14:38:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r701149240",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701149240"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r701149240"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701149240/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 369,
    "original_line": 369,
    "side": "RIGHT",
    "in_reply_to_id": 684585377
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701172341",
    "pull_request_review_id": 745185632,
    "id": 701172341,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMTE3MjM0MQ==",
    "diff_hunk": "@@ -326,6 +326,53 @@ TorController::~TorController()\n     }\n }\n \n+void TorController::get_socks_cb(TorControlConnection& _conn, const TorControlReply& reply)\n+{\n+    // NOTE: We can only get here if -onion is unset\n+    std::string socks_location;\n+    if (reply.code == 250) {\n+        for (const auto& line : reply.lines) {\n+            if (0 == line.compare(0, 20, \"net/listeners/socks=\")) {\n+                const std::string port_list_str = line.substr(20);\n+                std::vector<std::string> port_list;\n+                boost::split(port_list, port_list_str, boost::is_any_of(\" \"));\n+                for (auto& portstr : port_list) {\n+                    if (portstr.empty()) continue;\n+                    if ((portstr[0] == '\"' || portstr[0] == '\\'') && (*portstr.rbegin() == portstr[0])) {\n+                        portstr = portstr.substr(1, portstr.size() - 2);\n+                        if (portstr.empty()) continue;\n+                    }\n+                    socks_location = portstr;\n+                    if (0 == portstr.compare(0, 10, \"127.0.0.1:\")) {\n+                        // Prefer localhost - ignore other ports\n+                        break;\n+                    }\n+                }\n+            }\n+        }\n+        if (!socks_location.empty()) {\n+            LogPrint(BCLog::TOR, \"tor: Get SOCKS port command yielded %s\\n\", socks_location);\n+        } else {\n+            LogPrintf(\"tor: Get SOCKS port command returned nothing\\n\");\n+        }\n+    } else if (reply.code == 510) {  // 510 Unrecognized command\n+        LogPrintf(\"tor: Get SOCKS port command failed with unrecognized command (You probably should upgrade Tor)\\n\");\n+    } else {\n+        LogPrintf(\"tor: Get SOCKS port command failed; error code %d\\n\", reply.code);\n+    }\n+\n+    if (socks_location.empty()) {\n+        // Fallback to old behaviour\n+        socks_location = \"127.0.0.1\";\n+    }\n+\n+    CService resolved(LookupNumeric(socks_location, 9050));",
    "path": "src/torcontrol.cpp",
    "position": 44,
    "original_position": 44,
    "commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "original_commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "user": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": ">So overall this pull request works well. I just think non localhost address should be prefered over 127.0.0.1. This would work with my setup and I don't see any extra benefits of picking 127.0.0.1 in any scenario.\r\n\r\nThe non-localhost address may change or cease to be available?\r\n\r\n>because -onion switch is not the only way to configure the onion proxy.\r\n\r\nBut it's the only way that should override `-torcontrol` IMO",
    "created_at": "2021-09-02T15:03:54Z",
    "updated_at": "2021-09-02T15:03:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r701172341",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701172341"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r701172341"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701172341/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 369,
    "original_line": 369,
    "side": "RIGHT",
    "in_reply_to_id": 684585377
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701897608",
    "pull_request_review_id": 746115608,
    "id": 701897608,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMTg5NzYwOA==",
    "diff_hunk": "@@ -326,6 +326,53 @@ TorController::~TorController()\n     }\n }\n \n+void TorController::get_socks_cb(TorControlConnection& _conn, const TorControlReply& reply)\n+{\n+    // NOTE: We can only get here if -onion is unset\n+    std::string socks_location;\n+    if (reply.code == 250) {\n+        for (const auto& line : reply.lines) {\n+            if (0 == line.compare(0, 20, \"net/listeners/socks=\")) {\n+                const std::string port_list_str = line.substr(20);\n+                std::vector<std::string> port_list;\n+                boost::split(port_list, port_list_str, boost::is_any_of(\" \"));\n+                for (auto& portstr : port_list) {\n+                    if (portstr.empty()) continue;\n+                    if ((portstr[0] == '\"' || portstr[0] == '\\'') && (*portstr.rbegin() == portstr[0])) {\n+                        portstr = portstr.substr(1, portstr.size() - 2);\n+                        if (portstr.empty()) continue;\n+                    }\n+                    socks_location = portstr;\n+                    if (0 == portstr.compare(0, 10, \"127.0.0.1:\")) {\n+                        // Prefer localhost - ignore other ports\n+                        break;\n+                    }\n+                }\n+            }\n+        }\n+        if (!socks_location.empty()) {\n+            LogPrint(BCLog::TOR, \"tor: Get SOCKS port command yielded %s\\n\", socks_location);\n+        } else {\n+            LogPrintf(\"tor: Get SOCKS port command returned nothing\\n\");\n+        }\n+    } else if (reply.code == 510) {  // 510 Unrecognized command\n+        LogPrintf(\"tor: Get SOCKS port command failed with unrecognized command (You probably should upgrade Tor)\\n\");\n+    } else {\n+        LogPrintf(\"tor: Get SOCKS port command failed; error code %d\\n\", reply.code);\n+    }\n+\n+    if (socks_location.empty()) {\n+        // Fallback to old behaviour\n+        socks_location = \"127.0.0.1\";\n+    }\n+\n+    CService resolved(LookupNumeric(socks_location, 9050));",
    "path": "src/torcontrol.cpp",
    "position": 44,
    "original_position": 44,
    "commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "original_commit_id": "d37d95a9ea2cd45573aab1b588b9cee06434a30c",
    "user": {
      "login": "lano1106",
      "id": 4829131,
      "node_id": "MDQ6VXNlcjQ4MjkxMzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4829131?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lano1106",
      "html_url": "https://github.com/lano1106",
      "followers_url": "https://api.github.com/users/lano1106/followers",
      "following_url": "https://api.github.com/users/lano1106/following{/other_user}",
      "gists_url": "https://api.github.com/users/lano1106/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lano1106/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lano1106/subscriptions",
      "organizations_url": "https://api.github.com/users/lano1106/orgs",
      "repos_url": "https://api.github.com/users/lano1106/repos",
      "events_url": "https://api.github.com/users/lano1106/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lano1106/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "@luke-jr if the non-localhost address may change or cease to be available is a serious and valid concern for not modifying the code behavior then so be it.\r\n\r\nI have said everything that I have to say on the topic and I'll conclude by saying that without being aware of the initial problem that motivated this pull request, with the reasonable assumption that the vast majority of tor proxy setups will list the localhost address, this pull request, if left as-is, will just be a shinier, more complex method to essentially reach the exact same result than what the current code is doing...",
    "created_at": "2021-09-03T13:36:46Z",
    "updated_at": "2021-09-03T13:36:46Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r701897608",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701897608"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15423#discussion_r701897608"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15423"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701897608/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 369,
    "original_line": 369,
    "side": "RIGHT",
    "in_reply_to_id": 684585377
  }
]