[
  {
    "sha": "92f81bfdf09a0a73a4d23c7ca8fe704e169b009b",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5MmY4MWJmZGYwOWEwYTczYTRkMjNjN2NhOGZlNzA0ZTE2OWIwMDli",
    "commit": {
      "author": {
        "name": "Raw Ol' Dirty",
        "email": "rawodb@users.noreply.github.com",
        "date": "2017-04-14T18:49:49Z"
      },
      "committer": {
        "name": "Raw Ol' Dirty",
        "email": "rawodb@users.noreply.github.com",
        "date": "2017-04-14T18:49:49Z"
      },
      "message": "Add support for abortable rescans\n\nAdd fAbortRescan flag to break out of ScanToWalletTransactions",
      "tree": {
        "sha": "67baad72c07ace3c0c59005880d0118d595408c9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/67baad72c07ace3c0c59005880d0118d595408c9"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/92f81bfdf09a0a73a4d23c7ca8fe704e169b009b",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/92f81bfdf09a0a73a4d23c7ca8fe704e169b009b",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/92f81bfdf09a0a73a4d23c7ca8fe704e169b009b",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/92f81bfdf09a0a73a4d23c7ca8fe704e169b009b/comments",
    "author": {
      "login": "rawodb",
      "id": 20778324,
      "node_id": "MDQ6VXNlcjIwNzc4MzI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/20778324?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rawodb",
      "html_url": "https://github.com/rawodb",
      "followers_url": "https://api.github.com/users/rawodb/followers",
      "following_url": "https://api.github.com/users/rawodb/following{/other_user}",
      "gists_url": "https://api.github.com/users/rawodb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rawodb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rawodb/subscriptions",
      "organizations_url": "https://api.github.com/users/rawodb/orgs",
      "repos_url": "https://api.github.com/users/rawodb/repos",
      "events_url": "https://api.github.com/users/rawodb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rawodb/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "rawodb",
      "id": 20778324,
      "node_id": "MDQ6VXNlcjIwNzc4MzI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/20778324?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rawodb",
      "html_url": "https://github.com/rawodb",
      "followers_url": "https://api.github.com/users/rawodb/followers",
      "following_url": "https://api.github.com/users/rawodb/following{/other_user}",
      "gists_url": "https://api.github.com/users/rawodb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rawodb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rawodb/subscriptions",
      "organizations_url": "https://api.github.com/users/rawodb/orgs",
      "repos_url": "https://api.github.com/users/rawodb/repos",
      "events_url": "https://api.github.com/users/rawodb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rawodb/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "f4db00f9a5482c91ae8a86c6e41e0ba61acf152b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f4db00f9a5482c91ae8a86c6e41e0ba61acf152b",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/f4db00f9a5482c91ae8a86c6e41e0ba61acf152b"
      }
    ],
    "stats": {
      "total": 16,
      "additions": 16,
      "deletions": 0
    },
    "files": [
      {
        "sha": "d1677b4faa6cf460333594989314f68826a9dcc3",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 12,
        "deletions": 0,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/92f81bfdf09a0a73a4d23c7ca8fe704e169b009b/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/92f81bfdf09a0a73a4d23c7ca8fe704e169b009b/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=92f81bfdf09a0a73a4d23c7ca8fe704e169b009b",
        "patch": "@@ -1527,6 +1527,7 @@ CBlockIndex* CWallet::ScanForWalletTransactions(CBlockIndex* pindexStart, bool f\n     CBlockIndex* pindex = pindexStart;\n     {\n         LOCK2(cs_main, cs_wallet);\n+\tfAbortRescan = false;\n \n         // no need to read and scan block, if block was created before\n         // our wallet birthday (as adjusted for block time variability)\n@@ -1557,12 +1558,23 @@ CBlockIndex* CWallet::ScanForWalletTransactions(CBlockIndex* pindexStart, bool f\n                 nNow = GetTime();\n                 LogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", pindex->nHeight, GuessVerificationProgress(chainParams.TxData(), pindex));\n             }\n+\t    if (fAbortRescan) {\n+\t        LogPrintf(\"Aborted rescanning. At block %d. Progress=%f\\n\", pindex->nHeight, GuessVerificationProgress(chainParams.TxData(), pindex));\n+\t        fAbortRescan = false;\n+\t\tbreak;\n+\t    }\n         }\n         ShowProgress(_(\"Rescanning...\"), 100); // hide progress dialog in GUI\n     }\n     return ret;\n }\n \n+bool CWallet::AbortScanForWalletTransactions(bool fAbort)\n+{\n+\tfAbortRescan = fAbort;\n+\treturn fAbortRescan;\n+}\n+\n void CWallet::ReacceptWalletTransactions()\n {\n     // If transactions aren't being broadcasted, don't let them into local mempool either"
      },
      {
        "sha": "698f18e683b539af14be9ae8875099b7bdf14a58",
        "filename": "src/wallet/wallet.h",
        "status": "modified",
        "additions": 4,
        "deletions": 0,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/92f81bfdf09a0a73a4d23c7ca8fe704e169b009b/src/wallet/wallet.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/92f81bfdf09a0a73a4d23c7ca8fe704e169b009b/src/wallet/wallet.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.h?ref=92f81bfdf09a0a73a4d23c7ca8fe704e169b009b",
        "patch": "@@ -671,6 +671,9 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n     int64_t nLastResend;\n     bool fBroadcastTransactions;\n \n+    // Flag used for aborting rescans\n+    bool fAbortRescan;\n+\n     /**\n      * Used to keep track of spent outpoints, and\n      * detect and report conflicts (double-spends or\n@@ -883,6 +886,7 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n     void BlockDisconnected(const std::shared_ptr<const CBlock>& pblock) override;\n     bool AddToWalletIfInvolvingMe(const CTransactionRef& tx, const CBlockIndex* pIndex, int posInBlock, bool fUpdate);\n     CBlockIndex* ScanForWalletTransactions(CBlockIndex* pindexStart, bool fUpdate = false);\n+    bool AbortScanForWalletTransactions(bool fAbort = false);\n     void ReacceptWalletTransactions();\n     void ResendWalletTransactions(int64_t nBestBlockTime, CConnman* connman) override;\n     std::vector<uint256> ResendWalletTransactionsBefore(int64_t nTime, CConnman* connman);"
      }
    ]
  },
  {
    "sha": "cad7f533e0d84a3789dbf1702a0f17ca21b3697e",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpjYWQ3ZjUzM2UwZDg0YTM3ODlkYmYxNzAyYTBmMTdjYTIxYjM2OTdl",
    "commit": {
      "author": {
        "name": "Raw Ol' Dirty",
        "email": "rawodb@users.noreply.github.com",
        "date": "2017-04-14T18:51:41Z"
      },
      "committer": {
        "name": "Raw Ol' Dirty",
        "email": "rawodb@users.noreply.github.com",
        "date": "2017-04-14T18:51:41Z"
      },
      "message": "Add abortrescan rpc command\n\nAdd RPC command to abort rescans",
      "tree": {
        "sha": "b013cd69798fbe041d42c7cb4ad0465da40854fe",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b013cd69798fbe041d42c7cb4ad0465da40854fe"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/cad7f533e0d84a3789dbf1702a0f17ca21b3697e",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/cad7f533e0d84a3789dbf1702a0f17ca21b3697e",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/cad7f533e0d84a3789dbf1702a0f17ca21b3697e",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/cad7f533e0d84a3789dbf1702a0f17ca21b3697e/comments",
    "author": {
      "login": "rawodb",
      "id": 20778324,
      "node_id": "MDQ6VXNlcjIwNzc4MzI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/20778324?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rawodb",
      "html_url": "https://github.com/rawodb",
      "followers_url": "https://api.github.com/users/rawodb/followers",
      "following_url": "https://api.github.com/users/rawodb/following{/other_user}",
      "gists_url": "https://api.github.com/users/rawodb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rawodb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rawodb/subscriptions",
      "organizations_url": "https://api.github.com/users/rawodb/orgs",
      "repos_url": "https://api.github.com/users/rawodb/repos",
      "events_url": "https://api.github.com/users/rawodb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rawodb/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "rawodb",
      "id": 20778324,
      "node_id": "MDQ6VXNlcjIwNzc4MzI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/20778324?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rawodb",
      "html_url": "https://github.com/rawodb",
      "followers_url": "https://api.github.com/users/rawodb/followers",
      "following_url": "https://api.github.com/users/rawodb/following{/other_user}",
      "gists_url": "https://api.github.com/users/rawodb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rawodb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rawodb/subscriptions",
      "organizations_url": "https://api.github.com/users/rawodb/orgs",
      "repos_url": "https://api.github.com/users/rawodb/repos",
      "events_url": "https://api.github.com/users/rawodb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rawodb/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "92f81bfdf09a0a73a4d23c7ca8fe704e169b009b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/92f81bfdf09a0a73a4d23c7ca8fe704e169b009b",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/92f81bfdf09a0a73a4d23c7ca8fe704e169b009b"
      }
    ],
    "stats": {
      "total": 25,
      "additions": 25,
      "deletions": 0
    },
    "files": [
      {
        "sha": "ade2631bbf4f29be6e705454e68e2546d021bcf6",
        "filename": "src/wallet/rpcdump.cpp",
        "status": "modified",
        "additions": 23,
        "deletions": 0,
        "changes": 23,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/cad7f533e0d84a3789dbf1702a0f17ca21b3697e/src/wallet/rpcdump.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/cad7f533e0d84a3789dbf1702a0f17ca21b3697e/src/wallet/rpcdump.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcdump.cpp?ref=cad7f533e0d84a3789dbf1702a0f17ca21b3697e",
        "patch": "@@ -1125,3 +1125,26 @@ UniValue importmulti(const JSONRPCRequest& mainRequest)\n \n     return response;\n }\n+UniValue abortrescan(const JSONRPCRequest& request)\n+{\n+    if (request.fHelp) {\n+        throw std::runtime_error(\"abortrescan\\n\\n\"\n+\t\"Aborts the current running rescan.\\n\\n\"\n+\t\"Examples:\\n\" +\n+\tHelpExampleCli(\"abortrescan\", \"\") +\n+\tHelpExampleRpc(\"abortrescan\", \"\")\n+\t);\n+    }\n+\n+    CWallet * const pwallet = GetWalletForJSONRPCRequest(request);\n+    if (!EnsureWalletIsAvailable(pwallet, request.fHelp)) {\n+        return NullUniValue;\n+    }\n+\n+    pwallet->AbortScanForWalletTransactions(true);\n+    LogPrintf(\"abortrescan command received from rpc\\n\");\n+\n+    LOCK2(cs_main, pwallet->cs_wallet); // Wait for lock to release\n+\n+    return NullUniValue;\n+}"
      },
      {
        "sha": "dc874667a697b92560b908699b30e16b0d38e404",
        "filename": "src/wallet/rpcwallet.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/cad7f533e0d84a3789dbf1702a0f17ca21b3697e/src/wallet/rpcwallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/cad7f533e0d84a3789dbf1702a0f17ca21b3697e/src/wallet/rpcwallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcwallet.cpp?ref=cad7f533e0d84a3789dbf1702a0f17ca21b3697e",
        "patch": "@@ -2923,6 +2923,7 @@ extern UniValue importwallet(const JSONRPCRequest& request);\n extern UniValue importprunedfunds(const JSONRPCRequest& request);\n extern UniValue removeprunedfunds(const JSONRPCRequest& request);\n extern UniValue importmulti(const JSONRPCRequest& request);\n+extern UniValue abortrescan(const JSONRPCRequest& request);\n \n static const CRPCCommand commands[] =\n { //  category              name                        actor (function)           okSafeMode\n@@ -2975,6 +2976,7 @@ static const CRPCCommand commands[] =\n     { \"wallet\",             \"walletpassphrasechange\",   &walletpassphrasechange,   true,   {\"oldpassphrase\",\"newpassphrase\"} },\n     { \"wallet\",             \"walletpassphrase\",         &walletpassphrase,         true,   {\"passphrase\",\"timeout\"} },\n     { \"wallet\",             \"removeprunedfunds\",        &removeprunedfunds,        true,   {\"txid\"} },\n+    { \"wallet\",             \"abortrescan\",              &abortrescan,              true,   {} },\n };\n \n void RegisterWalletRPCCommands(CRPCTable &t)"
      }
    ]
  }
]