laanwj,2012-05-15T07:15:28Z,ACK\n,https://github.com/bitcoin/bitcoin/pull/1305#issuecomment-5709943,5709943,
Diapolo,2012-05-15T12:38:40Z,Why receives HandleSIGTERM an integer? Seems unused in the diff.\n,https://github.com/bitcoin/bitcoin/pull/1305#issuecomment-5714746,5714746,
laanwj,2012-05-15T13:02:04Z,Know your unix  :-) signal handlers receive an integer with the signal\nnumber.\n,https://github.com/bitcoin/bitcoin/pull/1305#issuecomment-5715170,5715170,
sipa,2012-05-15T13:07:25Z,"I'd make it ""SIGTERM received"", but otherwise ACK.\n",https://github.com/bitcoin/bitcoin/pull/1305#issuecomment-5715257,5715257,
Diapolo,2012-05-15T13:10:48Z,Unix != Diapolo :-D\n,https://github.com/bitcoin/bitcoin/pull/1305#issuecomment-5715331,5715331,
rebroad,2012-05-15T14:09:58Z,"@sipa or how about, considering that function will be run with any signal, displaying the signal number received..?\n",https://github.com/bitcoin/bitcoin/pull/1305#issuecomment-5716699,5716699,
rebroad,2012-05-15T15:09:00Z,"@sipa I've just realised this change is also in another pull request. :-s I've avoided saying SIGTERM received, as this is a specific signal (15), so saying that might be misleading, whereas it's true to say the function HandleSIGTERM() is called.\n",https://github.com/bitcoin/bitcoin/pull/1305#issuecomment-5718270,5718270,
rebroad,2012-05-15T15:09:28Z,I'll close this pull request in favour of the other which includes this change and others.\n,https://github.com/bitcoin/bitcoin/pull/1305#issuecomment-5718290,5718290,
sipa,2012-05-15T15:52:14Z,"HandleSIGTERM is apparently used for SIGTERM, SIGINT and SIGHUP.\n",https://github.com/bitcoin/bitcoin/pull/1305#issuecomment-5719415,5719415,
laanwj,2012-05-15T16:02:10Z,"Ah, named according to the principle of most surprise. Interesting :)\n",https://github.com/bitcoin/bitcoin/pull/1305#issuecomment-5719694,5719694,
rebroad,2012-05-15T16:37:44Z,"I suspect HandleSIGTERM would run if SIGUSR1 was sent too. Any signal other than 9, probably.\n",https://github.com/bitcoin/bitcoin/pull/1305#issuecomment-5720644,5720644,
sipa,2012-05-15T16:46:43Z,@rebroad no signal handler is installed for SIGUSR1. See the beginning of AppInit2 in init.cpp.\n,https://github.com/bitcoin/bitcoin/pull/1305#issuecomment-5720868,5720868,
rebroad,2012-05-17T16:43:42Z,"Since this was getting ACKs, I've re-opened it. It's more likely to get pulled than pull #1311, which it's a subset of. I should probably break #1311 into smaller pieces....\n",https://github.com/bitcoin/bitcoin/pull/1305#issuecomment-5768149,5768149,
Diapolo,2012-05-17T17:27:51Z,You should rebase this!\n,https://github.com/bitcoin/bitcoin/pull/1305#issuecomment-5769197,5769197,
rebroad,2012-05-17T17:29:36Z,@Diapolo I can do... does it make much difference? (rebased now)\n,https://github.com/bitcoin/bitcoin/pull/1305#issuecomment-5769248,5769248,
Diapolo,2012-05-17T17:31:25Z,"Yes, just take a look under https://github.com/bitcoin/bitcoin/pull/1305/commits what do you see :)? Use <pre>git fetch upstream</pre> <pre>git rebase upstream</pre> to ensure you have the current master as base.\n",https://github.com/bitcoin/bitcoin/pull/1305#issuecomment-5769298,5769298,
rebroad,2012-05-17T17:34:28Z,@Diapolo I see 1 commit and 1 diff. What do you see? That's also what I saw before I rebased.\n,https://github.com/bitcoin/bitcoin/pull/1305#issuecomment-5769374,5769374,
Diapolo,2012-05-17T17:37:50Z,"I saw 4 commits and 3 of which were not from you ;). Now I see a single one, which is good.\n",https://github.com/bitcoin/bitcoin/pull/1305#issuecomment-5769457,5769457,
luke-jr,2012-05-18T18:47:09Z,"What stops this from creating a deadlock when a signal is received inside the ""printf"" replacement log function?\n",https://github.com/bitcoin/bitcoin/pull/1305#issuecomment-5792838,5792838,
sipa,2012-05-18T19:29:34Z,@luke-jr how exactly?\n,https://github.com/bitcoin/bitcoin/pull/1305#issuecomment-5793722,5793722,
luke-jr,2012-05-18T20:05:20Z,"@sipa printf needs to use a lock to ensure multiple threads aren't writing at the same time, but signals can interrupt writes (while that lock is held). If this happens, the printf in the signal handler will try to lock again, and block. Even if the lock is recursive, there is a risk of the signal printf mixing output with the ongoing one.\n",https://github.com/bitcoin/bitcoin/pull/1305#issuecomment-5794391,5794391,
laanwj,2012-05-18T20:32:45Z,Ouch. I keep forgetting that we redefine printf in a macro :-(\n,https://github.com/bitcoin/bitcoin/pull/1305#issuecomment-5794881,5794881,
Diapolo,2012-05-18T21:27:09Z,@laanwj You were updating the function a few days ago ^^...\n,https://github.com/bitcoin/bitcoin/pull/1305#issuecomment-5796192,5796192,
rebroad,2012-05-21T17:17:58Z,@luke-jr what would be your ideal solution for this (other than removing the prinf)?\n,https://github.com/bitcoin/bitcoin/pull/1305#issuecomment-5828257,5828257,
luke-jr,2012-05-21T17:25:32Z,"I think it might be safe to create a new thread just for the printf. Then the signal returns - locks get released on their normal schedule, etc - while the second thread waits to acquire whatever locks it needs to log.\n",https://github.com/bitcoin/bitcoin/pull/1305#issuecomment-5828454,5828454,
rebroad,2012-05-22T09:51:02Z,"@luke-jr when I get time I'll have a dabble with this. I'm fairly new to the whole thread thing, but I was thinking of moving ProcessBlock() into a thread of it's own so that it doesn't block the reception of messages (which it appears to do currently, based upon the timestamps in debug.log)\n",https://github.com/bitcoin/bitcoin/pull/1305#issuecomment-5843234,5843234,
laanwj,2012-07-17T06:46:44Z,"Creating a thread sounds like a terrible kludge. That the safest way is to save the ""signal status"" to a global variable in the signal handler and let the Shutdown function pick it up and print it. Python, for example, does signal handling in this way. \n\nBtw, instead (or, in addition to) the numeric signal it should probably print the signal name, converted using `strsignal`.\n",https://github.com/bitcoin/bitcoin/pull/1305#issuecomment-7027932,7027932,
rebroad,2012-07-26T10:15:22Z,"@laanwj That does sound like a decent solution. I will update this to do that, when I get time...\n",https://github.com/bitcoin/bitcoin/pull/1305#issuecomment-7273951,7273951,
jgarzik,2012-08-01T15:46:01Z,"NAK, possible deadlock.  printf() obtains a lock, which can get really messy when signals are involved.  You might even be inside the printf lock itself.\n\nMaybe set a 'got_sigterm' boolean that triggers a print elsewhere...\n",https://github.com/bitcoin/bitcoin/pull/1305#issuecomment-7430939,7430939,
