[
  {
    "sha": "059b549dd192b5f55527527c1f474f46139a587f",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzowNTliNTQ5ZGQxOTJiNWY1NTUyNzUyN2MxZjQ3NGY0NjEzOWE1ODdm",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2014-09-15T20:33:00Z"
      },
      "committer": {
        "name": "Cozz Lovan",
        "email": "cozzlovan@yahoo.com",
        "date": "2014-09-18T01:08:47Z"
      },
      "message": "Get rid of stored merkle branches.\n\nDo not store merkle branches inside the wallet. This means removing the check\nthat someone might have inserted an unconfirmed transaction in your wallet and\nmaking it look like a confirmed one.\n\nThis means we don't need to keep the merkle branch in wallets (which takes up to\nhalf a kilobyte per transactions), we don't need to validate it (which requires\na dozen sha256 operation per wallet transaction), remove the need to keep the\nmerkle tree in blocks (the case where it's needed is done separately in\nCPartialMerkleTree), and simplifies the merkle root computation.",
      "tree": {
        "sha": "a03922fadb1841f464bffc3f9106fb57db012e6c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a03922fadb1841f464bffc3f9106fb57db012e6c"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/059b549dd192b5f55527527c1f474f46139a587f",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/059b549dd192b5f55527527c1f474f46139a587f",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/059b549dd192b5f55527527c1f474f46139a587f",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/059b549dd192b5f55527527c1f474f46139a587f/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "cozz",
      "id": 2814559,
      "node_id": "MDQ6VXNlcjI4MTQ1NTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2814559?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cozz",
      "html_url": "https://github.com/cozz",
      "followers_url": "https://api.github.com/users/cozz/followers",
      "following_url": "https://api.github.com/users/cozz/following{/other_user}",
      "gists_url": "https://api.github.com/users/cozz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cozz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cozz/subscriptions",
      "organizations_url": "https://api.github.com/users/cozz/orgs",
      "repos_url": "https://api.github.com/users/cozz/repos",
      "events_url": "https://api.github.com/users/cozz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cozz/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "438c7e4cd2179170aeadb4aa1c902ccd1256dee6",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/438c7e4cd2179170aeadb4aa1c902ccd1256dee6",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/438c7e4cd2179170aeadb4aa1c902ccd1256dee6"
      }
    ],
    "stats": {
      "total": 89,
      "additions": 16,
      "deletions": 73
    },
    "files": [
      {
        "sha": "aa479122b4d84fb2f9ef602ffe9ebe70b06ad2b6",
        "filename": "src/core.cpp",
        "status": "modified",
        "additions": 10,
        "deletions": 46,
        "changes": 56,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/059b549dd192b5f55527527c1f474f46139a587f/src/core.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/059b549dd192b5f55527527c1f474f46139a587f/src/core.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/core.cpp?ref=059b549dd192b5f55527527c1f474f46139a587f",
        "patch": "@@ -226,52 +226,19 @@ uint256 CBlockHeader::GetHash() const\n \n uint256 CBlock::BuildMerkleTree() const\n {\n-    vMerkleTree.clear();\n-    BOOST_FOREACH(const CTransaction& tx, vtx)\n+    std::vector<uint256> vMerkleTree;\n+    vMerkleTree.reserve(vtx.size());\n+    BOOST_FOREACH(const CTransaction& tx, vtx) {\n         vMerkleTree.push_back(tx.GetHash());\n-    int j = 0;\n-    for (int nSize = vtx.size(); nSize > 1; nSize = (nSize + 1) / 2)\n-    {\n-        for (int i = 0; i < nSize; i += 2)\n-        {\n-            int i2 = std::min(i+1, nSize-1);\n-            vMerkleTree.push_back(Hash(BEGIN(vMerkleTree[j+i]),  END(vMerkleTree[j+i]),\n-                                       BEGIN(vMerkleTree[j+i2]), END(vMerkleTree[j+i2])));\n-        }\n-        j += nSize;\n-    }\n-    return (vMerkleTree.empty() ? 0 : vMerkleTree.back());\n-}\n-\n-std::vector<uint256> CBlock::GetMerkleBranch(int nIndex) const\n-{\n-    if (vMerkleTree.empty())\n-        BuildMerkleTree();\n-    std::vector<uint256> vMerkleBranch;\n-    int j = 0;\n-    for (int nSize = vtx.size(); nSize > 1; nSize = (nSize + 1) / 2)\n-    {\n-        int i = std::min(nIndex^1, nSize-1);\n-        vMerkleBranch.push_back(vMerkleTree[j+i]);\n-        nIndex >>= 1;\n-        j += nSize;\n     }\n-    return vMerkleBranch;\n-}\n-\n-uint256 CBlock::CheckMerkleBranch(uint256 hash, const std::vector<uint256>& vMerkleBranch, int nIndex)\n-{\n-    if (nIndex == -1)\n-        return 0;\n-    BOOST_FOREACH(const uint256& otherside, vMerkleBranch)\n-    {\n-        if (nIndex & 1)\n-            hash = Hash(BEGIN(otherside), END(otherside), BEGIN(hash), END(hash));\n-        else\n-            hash = Hash(BEGIN(hash), END(hash), BEGIN(otherside), END(otherside));\n-        nIndex >>= 1;\n+    for (int nSize = vtx.size(); nSize > 1; nSize = (nSize + 1) / 2) {\n+        for (int i = 0; i < nSize; i += 2) {\n+            int i2 = std::min(i + 1, nSize - 1);\n+            vMerkleTree[i / 2] = Hash(BEGIN(vMerkleTree[i]),  END(vMerkleTree[i]),\n+                                      BEGIN(vMerkleTree[i2]), END(vMerkleTree[i2]));\n+        }\n     }\n-    return hash;\n+    return (vMerkleTree.empty() ? 0 : vMerkleTree.front());\n }\n \n std::string CBlock::ToString() const\n@@ -288,9 +255,6 @@ std::string CBlock::ToString() const\n     {\n         s << \"  \" << vtx[i].ToString() << \"\\n\";\n     }\n-    s << \"  vMerkleTree: \";\n-    for (unsigned int i = 0; i < vMerkleTree.size(); i++)\n-        s << \" \" << vMerkleTree[i].ToString();\n     s << \"\\n\";\n     return s.str();\n }"
      },
      {
        "sha": "8c8573c0014cdab97c38827627c7a7f0c24368b6",
        "filename": "src/core.h",
        "status": "modified",
        "additions": 0,
        "deletions": 6,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/059b549dd192b5f55527527c1f474f46139a587f/src/core.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/059b549dd192b5f55527527c1f474f46139a587f/src/core.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/core.h?ref=059b549dd192b5f55527527c1f474f46139a587f",
        "patch": "@@ -487,9 +487,6 @@ class CBlock : public CBlockHeader\n     // network and disk\n     std::vector<CTransaction> vtx;\n \n-    // memory only\n-    mutable std::vector<uint256> vMerkleTree;\n-\n     CBlock()\n     {\n         SetNull();\n@@ -513,7 +510,6 @@ class CBlock : public CBlockHeader\n     {\n         CBlockHeader::SetNull();\n         vtx.clear();\n-        vMerkleTree.clear();\n     }\n \n     CBlockHeader GetBlockHeader() const\n@@ -530,8 +526,6 @@ class CBlock : public CBlockHeader\n \n     uint256 BuildMerkleTree() const;\n \n-    std::vector<uint256> GetMerkleBranch(int nIndex) const;\n-    static uint256 CheckMerkleBranch(uint256 hash, const std::vector<uint256>& vMerkleBranch, int nIndex);\n     std::string ToString() const;\n };\n "
      },
      {
        "sha": "50e28b0907ce33abe4fd34b20487e7152800388c",
        "filename": "src/wallet.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 14,
        "changes": 15,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/059b549dd192b5f55527527c1f474f46139a587f/src/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/059b549dd192b5f55527527c1f474f46139a587f/src/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet.cpp?ref=059b549dd192b5f55527527c1f474f46139a587f",
        "patch": "@@ -592,9 +592,8 @@ bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFromLoadWallet)\n                 wtx.hashBlock = wtxIn.hashBlock;\n                 fUpdated = true;\n             }\n-            if (wtxIn.nIndex != -1 && (wtxIn.vMerkleBranch != wtx.vMerkleBranch || wtxIn.nIndex != wtx.nIndex))\n+            if (wtxIn.nIndex != -1 && wtxIn.nIndex != wtx.nIndex)\n             {\n-                wtx.vMerkleBranch = wtxIn.vMerkleBranch;\n                 wtx.nIndex = wtxIn.nIndex;\n                 fUpdated = true;\n             }\n@@ -2256,14 +2255,10 @@ int CMerkleTx::SetMerkleBranch(const CBlock* pblock)\n                 break;\n         if (nIndex == (int)pblock->vtx.size())\n         {\n-            vMerkleBranch.clear();\n             nIndex = -1;\n             LogPrintf(\"ERROR: SetMerkleBranch() : couldn't find tx in block\\n\");\n             return 0;\n         }\n-\n-        // Fill in merkle branch\n-        vMerkleBranch = pblock->GetMerkleBranch(nIndex);\n     }\n \n     // Is the tx in a block that's in the main chain\n@@ -2291,14 +2286,6 @@ int CMerkleTx::GetDepthInMainChainINTERNAL(CBlockIndex* &pindexRet) const\n     if (!pindex || !chainActive.Contains(pindex))\n         return 0;\n \n-    // Make sure the merkle branch connects to this block\n-    if (!fMerkleVerified)\n-    {\n-        if (CBlock::CheckMerkleBranch(GetHash(), vMerkleBranch, nIndex) != pindex->hashMerkleRoot)\n-            return 0;\n-        fMerkleVerified = true;\n-    }\n-\n     pindexRet = pindex;\n     return chainActive.Height() - pindex->nHeight + 1;\n }"
      },
      {
        "sha": "2646db910bb77fa054e8f558231f1d7e2cf417ba",
        "filename": "src/wallet.h",
        "status": "modified",
        "additions": 5,
        "deletions": 7,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/059b549dd192b5f55527527c1f474f46139a587f/src/wallet.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/059b549dd192b5f55527527c1f474f46139a587f/src/wallet.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet.h?ref=059b549dd192b5f55527527c1f474f46139a587f",
        "patch": "@@ -469,13 +469,8 @@ class CMerkleTx : public CTransaction\n \n public:\n     uint256 hashBlock;\n-    std::vector<uint256> vMerkleBranch;\n     int nIndex;\n \n-    // memory only\n-    mutable bool fMerkleVerified;\n-\n-\n     CMerkleTx()\n     {\n         Init();\n@@ -490,7 +485,6 @@ class CMerkleTx : public CTransaction\n     {\n         hashBlock = 0;\n         nIndex = -1;\n-        fMerkleVerified = false;\n     }\n \n     ADD_SERIALIZE_METHODS;\n@@ -500,7 +494,11 @@ class CMerkleTx : public CTransaction\n         READWRITE(*(CTransaction*)this);\n         nVersion = this->nVersion;\n         READWRITE(hashBlock);\n-        READWRITE(vMerkleBranch);\n+        {\n+            // Ignore merkle branch.\n+            std::vector<uint256> vMerkleBranch;\n+            READWRITE(vMerkleBranch);\n+        }\n         READWRITE(nIndex);\n     }\n "
      }
    ]
  },
  {
    "sha": "4333cc1c86c6164fd78621fb0d23e7e0eaabff79",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0MzMzY2MxYzg2YzYxNjRmZDc4NjIxZmIwZDIzZTdlMGVhYWJmZjc5",
    "commit": {
      "author": {
        "name": "Cozz Lovan",
        "email": "cozzlovan@yahoo.com",
        "date": "2014-09-18T01:13:59Z"
      },
      "committer": {
        "name": "Cozz Lovan",
        "email": "cozzlovan@yahoo.com",
        "date": "2014-09-19T18:25:55Z"
      },
      "message": "[Wallet] Simplify SetMerkleBranch(..) to SetHashBlock(..)",
      "tree": {
        "sha": "881e61f4ed4481655d518193b5c2d8b3e8454b44",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/881e61f4ed4481655d518193b5c2d8b3e8454b44"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4333cc1c86c6164fd78621fb0d23e7e0eaabff79",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4333cc1c86c6164fd78621fb0d23e7e0eaabff79",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/4333cc1c86c6164fd78621fb0d23e7e0eaabff79",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4333cc1c86c6164fd78621fb0d23e7e0eaabff79/comments",
    "author": {
      "login": "cozz",
      "id": 2814559,
      "node_id": "MDQ6VXNlcjI4MTQ1NTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2814559?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cozz",
      "html_url": "https://github.com/cozz",
      "followers_url": "https://api.github.com/users/cozz/followers",
      "following_url": "https://api.github.com/users/cozz/following{/other_user}",
      "gists_url": "https://api.github.com/users/cozz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cozz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cozz/subscriptions",
      "organizations_url": "https://api.github.com/users/cozz/orgs",
      "repos_url": "https://api.github.com/users/cozz/repos",
      "events_url": "https://api.github.com/users/cozz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cozz/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "cozz",
      "id": 2814559,
      "node_id": "MDQ6VXNlcjI4MTQ1NTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2814559?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cozz",
      "html_url": "https://github.com/cozz",
      "followers_url": "https://api.github.com/users/cozz/followers",
      "following_url": "https://api.github.com/users/cozz/following{/other_user}",
      "gists_url": "https://api.github.com/users/cozz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cozz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cozz/subscriptions",
      "organizations_url": "https://api.github.com/users/cozz/orgs",
      "repos_url": "https://api.github.com/users/cozz/repos",
      "events_url": "https://api.github.com/users/cozz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cozz/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "059b549dd192b5f55527527c1f474f46139a587f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/059b549dd192b5f55527527c1f474f46139a587f",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/059b549dd192b5f55527527c1f474f46139a587f"
      }
    ],
    "stats": {
      "total": 55,
      "additions": 13,
      "deletions": 42
    },
    "files": [
      {
        "sha": "028a8ca3112b980f0a97dba557fc87e0fc4161fe",
        "filename": "src/wallet.cpp",
        "status": "modified",
        "additions": 12,
        "deletions": 41,
        "changes": 53,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4333cc1c86c6164fd78621fb0d23e7e0eaabff79/src/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4333cc1c86c6164fd78621fb0d23e7e0eaabff79/src/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet.cpp?ref=4333cc1c86c6164fd78621fb0d23e7e0eaabff79",
        "patch": "@@ -643,9 +643,9 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransaction& tx, const CBlock* pbl\n         if (fExisted || IsMine(tx) || IsFromMe(tx))\n         {\n             CWalletTx wtx(this,tx);\n-            // Get merkle branch if transaction was found in a block\n+\n             if (pblock)\n-                wtx.SetMerkleBranch(pblock);\n+                wtx.SetHashBlock(pblock);\n             return AddToWallet(wtx);\n         }\n     }\n@@ -2228,48 +2228,19 @@ CWalletKey::CWalletKey(int64_t nExpires)\n     nTimeExpires = nExpires;\n }\n \n-int CMerkleTx::SetMerkleBranch(const CBlock* pblock)\n+void CMerkleTx::SetHashBlock(const CBlock* pblock)\n {\n-    AssertLockHeld(cs_main);\n-    CBlock blockTmp;\n-\n-    if (pblock == NULL) {\n-        CCoins coins;\n-        if (pcoinsTip->GetCoins(GetHash(), coins)) {\n-            CBlockIndex *pindex = chainActive[coins.nHeight];\n-            if (pindex) {\n-                if (!ReadBlockFromDisk(blockTmp, pindex))\n-                    return 0;\n-                pblock = &blockTmp;\n-            }\n-        }\n-    }\n+    hashBlock = pblock->GetHash();\n \n-    if (pblock) {\n-        // Update the tx's hashBlock\n-        hashBlock = pblock->GetHash();\n-\n-        // Locate the transaction\n-        for (nIndex = 0; nIndex < (int)pblock->vtx.size(); nIndex++)\n-            if (pblock->vtx[nIndex] == *(CTransaction*)this)\n-                break;\n-        if (nIndex == (int)pblock->vtx.size())\n-        {\n-            nIndex = -1;\n-            LogPrintf(\"ERROR: SetMerkleBranch() : couldn't find tx in block\\n\");\n-            return 0;\n-        }\n+    // Locate the transaction\n+    for (nIndex = 0; nIndex < (int)pblock->vtx.size(); nIndex++)\n+        if (pblock->vtx[nIndex] == *(CTransaction*)this)\n+            break;\n+    if (nIndex == (int)pblock->vtx.size())\n+    {\n+        nIndex = -1;\n+        LogPrintf(\"ERROR: SetHashBlock() : couldn't find tx in block\\n\");\n     }\n-\n-    // Is the tx in a block that's in the main chain\n-    BlockMap::iterator mi = mapBlockIndex.find(hashBlock);\n-    if (mi == mapBlockIndex.end())\n-        return 0;\n-    CBlockIndex* pindex = (*mi).second;\n-    if (!pindex || !chainActive.Contains(pindex))\n-        return 0;\n-\n-    return chainActive.Height() - pindex->nHeight + 1;\n }\n \n int CMerkleTx::GetDepthInMainChainINTERNAL(CBlockIndex* &pindexRet) const"
      },
      {
        "sha": "db30d4fdc425d74f987832c4c4edcfe58303c4dd",
        "filename": "src/wallet.h",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4333cc1c86c6164fd78621fb0d23e7e0eaabff79/src/wallet.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4333cc1c86c6164fd78621fb0d23e7e0eaabff79/src/wallet.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet.h?ref=4333cc1c86c6164fd78621fb0d23e7e0eaabff79",
        "patch": "@@ -502,7 +502,7 @@ class CMerkleTx : public CTransaction\n         READWRITE(nIndex);\n     }\n \n-    int SetMerkleBranch(const CBlock* pblock=NULL);\n+    void SetHashBlock(const CBlock* pblock);\n \n     // Return depth of transaction in blockchain:\n     // -1  : not in blockchain, and not in memory pool (conflicted transaction)"
      }
    ]
  }
]