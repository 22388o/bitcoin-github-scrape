[
  {
    "sha": "1e2c29f2632c378843c5a3c9ad401a7bcacc4de0",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxZTJjMjlmMjYzMmMzNzg4NDNjNWEzYzlhZDQwMWE3YmNhY2M0ZGUw",
    "commit": {
      "author": {
        "name": "Kaz Wesley",
        "email": "keziahw@gmail.com",
        "date": "2016-04-13T17:09:16Z"
      },
      "committer": {
        "name": "Kaz Wesley",
        "email": "keziahw@gmail.com",
        "date": "2016-04-16T15:05:11Z"
      },
      "message": "prevector: destroy elements only via erase()\n\nFixes a bug in which pop_back did not call the deleted item's destructor.\n\nUsing the most general erase() implementation to implement all the others\nprevents similar bugs because the coupling between deallocation and destructor\ninvocation only needs to be maintained in one place.\nAlso reduces duplication of complex memmove logic.",
      "tree": {
        "sha": "7593134b5e9742d04fd7d2b6f8b3dd16cd563754",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7593134b5e9742d04fd7d2b6f8b3dd16cd563754"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1e2c29f2632c378843c5a3c9ad401a7bcacc4de0",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1e2c29f2632c378843c5a3c9ad401a7bcacc4de0",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/1e2c29f2632c378843c5a3c9ad401a7bcacc4de0",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1e2c29f2632c378843c5a3c9ad401a7bcacc4de0/comments",
    "author": {
      "login": "kazcw",
      "id": 1047859,
      "node_id": "MDQ6VXNlcjEwNDc4NTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1047859?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kazcw",
      "html_url": "https://github.com/kazcw",
      "followers_url": "https://api.github.com/users/kazcw/followers",
      "following_url": "https://api.github.com/users/kazcw/following{/other_user}",
      "gists_url": "https://api.github.com/users/kazcw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kazcw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kazcw/subscriptions",
      "organizations_url": "https://api.github.com/users/kazcw/orgs",
      "repos_url": "https://api.github.com/users/kazcw/repos",
      "events_url": "https://api.github.com/users/kazcw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kazcw/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "kazcw",
      "id": 1047859,
      "node_id": "MDQ6VXNlcjEwNDc4NTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1047859?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kazcw",
      "html_url": "https://github.com/kazcw",
      "followers_url": "https://api.github.com/users/kazcw/followers",
      "following_url": "https://api.github.com/users/kazcw/following{/other_user}",
      "gists_url": "https://api.github.com/users/kazcw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kazcw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kazcw/subscriptions",
      "organizations_url": "https://api.github.com/users/kazcw/orgs",
      "repos_url": "https://api.github.com/users/kazcw/repos",
      "events_url": "https://api.github.com/users/kazcw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kazcw/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "73fc922ed64333d45f18d8a448f30cfa2ae0281e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/73fc922ed64333d45f18d8a448f30cfa2ae0281e",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/73fc922ed64333d45f18d8a448f30cfa2ae0281e"
      }
    ],
    "stats": {
      "total": 12,
      "additions": 4,
      "deletions": 8
    },
    "files": [
      {
        "sha": "16b2f8dca7fb6d9f14962f176e559781989351be",
        "filename": "src/prevector.h",
        "status": "modified",
        "additions": 4,
        "deletions": 8,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1e2c29f2632c378843c5a3c9ad401a7bcacc4de0/src/prevector.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1e2c29f2632c378843c5a3c9ad401a7bcacc4de0/src/prevector.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/prevector.h?ref=1e2c29f2632c378843c5a3c9ad401a7bcacc4de0",
        "patch": "@@ -298,9 +298,8 @@ class prevector {\n     }\n \n     void resize(size_type new_size) {\n-        while (size() > new_size) {\n-            item_ptr(size() - 1)->~T();\n-            _size--;\n+        if (size() > new_size) {\n+            erase(item_ptr(new_size), end());\n         }\n         if (new_size > capacity()) {\n             change_capacity(new_size);\n@@ -368,10 +367,7 @@ class prevector {\n     }\n \n     iterator erase(iterator pos) {\n-        (*pos).~T();\n-        memmove(&(*pos), &(*pos) + 1, ((char*)&(*end())) - ((char*)(1 + &(*pos))));\n-        _size--;\n-        return pos;\n+        return erase(pos, pos + 1);\n     }\n \n     iterator erase(iterator first, iterator last) {\n@@ -396,7 +392,7 @@ class prevector {\n     }\n \n     void pop_back() {\n-        _size--;\n+        erase(end() - 1, end());\n     }\n \n     T& front() {"
      }
    ]
  },
  {
    "sha": "4ed41a2b611dfd328fe6f72312d6c596650f03f8",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0ZWQ0MWEyYjYxMWRmZDMyOGZlNmY3MjMxMmQ2YzU5NjY1MGYwM2Y4",
    "commit": {
      "author": {
        "name": "Kaz Wesley",
        "email": "keziahw@gmail.com",
        "date": "2016-04-16T13:49:38Z"
      },
      "committer": {
        "name": "Kaz Wesley",
        "email": "keziahw@gmail.com",
        "date": "2016-04-16T15:05:11Z"
      },
      "message": "test prevector::swap\n\n- add a swap operation to prevector tests (fails due to broken prevector::swap)\n- fix 2 prevector test operation conditions that were impossible",
      "tree": {
        "sha": "392a381898d4975e90da2689bd707d9889ed9593",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/392a381898d4975e90da2689bd707d9889ed9593"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4ed41a2b611dfd328fe6f72312d6c596650f03f8",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4ed41a2b611dfd328fe6f72312d6c596650f03f8",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/4ed41a2b611dfd328fe6f72312d6c596650f03f8",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4ed41a2b611dfd328fe6f72312d6c596650f03f8/comments",
    "author": {
      "login": "kazcw",
      "id": 1047859,
      "node_id": "MDQ6VXNlcjEwNDc4NTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1047859?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kazcw",
      "html_url": "https://github.com/kazcw",
      "followers_url": "https://api.github.com/users/kazcw/followers",
      "following_url": "https://api.github.com/users/kazcw/following{/other_user}",
      "gists_url": "https://api.github.com/users/kazcw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kazcw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kazcw/subscriptions",
      "organizations_url": "https://api.github.com/users/kazcw/orgs",
      "repos_url": "https://api.github.com/users/kazcw/repos",
      "events_url": "https://api.github.com/users/kazcw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kazcw/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "kazcw",
      "id": 1047859,
      "node_id": "MDQ6VXNlcjEwNDc4NTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1047859?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kazcw",
      "html_url": "https://github.com/kazcw",
      "followers_url": "https://api.github.com/users/kazcw/followers",
      "following_url": "https://api.github.com/users/kazcw/following{/other_user}",
      "gists_url": "https://api.github.com/users/kazcw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kazcw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kazcw/subscriptions",
      "organizations_url": "https://api.github.com/users/kazcw/orgs",
      "repos_url": "https://api.github.com/users/kazcw/repos",
      "events_url": "https://api.github.com/users/kazcw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kazcw/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "1e2c29f2632c378843c5a3c9ad401a7bcacc4de0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1e2c29f2632c378843c5a3c9ad401a7bcacc4de0",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/1e2c29f2632c378843c5a3c9ad401a7bcacc4de0"
      }
    ],
    "stats": {
      "total": 15,
      "additions": 13,
      "deletions": 2
    },
    "files": [
      {
        "sha": "b39b90353053cbe3d64e3c5b3ec95ff0f5797e5a",
        "filename": "src/test/prevector_tests.cpp",
        "status": "modified",
        "additions": 13,
        "deletions": 2,
        "changes": 15,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4ed41a2b611dfd328fe6f72312d6c596650f03f8/src/test/prevector_tests.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4ed41a2b611dfd328fe6f72312d6c596650f03f8/src/test/prevector_tests.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/prevector_tests.cpp?ref=4ed41a2b611dfd328fe6f72312d6c596650f03f8",
        "patch": "@@ -19,9 +19,11 @@ template<unsigned int N, typename T>\n class prevector_tester {\n     typedef std::vector<T> realtype;\n     realtype real_vector;\n+    realtype real_vector_alt;\n \n     typedef prevector<N, T> pretype;\n     pretype pre_vector;\n+    pretype pre_vector_alt;\n \n     typedef typename pretype::size_type Size;\n \n@@ -149,6 +151,12 @@ class prevector_tester {\n         pre_vector.shrink_to_fit();\n         test();\n     }\n+\n+    void swap() {\n+        real_vector.swap(real_vector_alt);\n+        pre_vector.swap(pre_vector_alt);\n+        test();\n+    }\n };\n \n BOOST_AUTO_TEST_CASE(PrevectorTestInt)\n@@ -204,12 +212,15 @@ BOOST_AUTO_TEST_CASE(PrevectorTestInt)\n             if (test.size() > 0) {\n                 test.update(insecure_rand() % test.size(), insecure_rand());\n             }\n-            if (((r >> 11) & 1024) == 11) {\n+            if (((r >> 11) % 1024) == 11) {\n                 test.clear();\n             }\n-            if (((r >> 21) & 512) == 12) {\n+            if (((r >> 21) % 512) == 12) {\n                 test.assign(insecure_rand() % 32, insecure_rand());\n             }\n+            if (((r >> 15) % 64) == 3) {\n+                test.swap();\n+            }\n         }\n     }\n }"
      }
    ]
  },
  {
    "sha": "a7af72a697a8decab364792230153f114be3919c",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzphN2FmNzJhNjk3YThkZWNhYjM2NDc5MjIzMDE1M2YxMTRiZTM5MTlj",
    "commit": {
      "author": {
        "name": "Kaz Wesley",
        "email": "keziahw@gmail.com",
        "date": "2016-04-14T16:26:32Z"
      },
      "committer": {
        "name": "Kaz Wesley",
        "email": "keziahw@gmail.com",
        "date": "2016-04-16T15:05:11Z"
      },
      "message": "prevector::swap: fix (unreached) data corruption\n\nswap was using an incorrect condition to determine when to apply an optimization\n(not swapping the full direct[] when swapping two indirect prevectors).\n\nRather than correct the optimization I'm removing it for simplicity. Removing\nthis optimization minutely improves performance in the typical (currently only)\nusage of member swap(), which is swapping with a freshly value-initialized\nobject.",
      "tree": {
        "sha": "086ebada01f780d23b4785212b50bad679ddb1af",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/086ebada01f780d23b4785212b50bad679ddb1af"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a7af72a697a8decab364792230153f114be3919c",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a7af72a697a8decab364792230153f114be3919c",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/a7af72a697a8decab364792230153f114be3919c",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a7af72a697a8decab364792230153f114be3919c/comments",
    "author": {
      "login": "kazcw",
      "id": 1047859,
      "node_id": "MDQ6VXNlcjEwNDc4NTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1047859?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kazcw",
      "html_url": "https://github.com/kazcw",
      "followers_url": "https://api.github.com/users/kazcw/followers",
      "following_url": "https://api.github.com/users/kazcw/following{/other_user}",
      "gists_url": "https://api.github.com/users/kazcw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kazcw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kazcw/subscriptions",
      "organizations_url": "https://api.github.com/users/kazcw/orgs",
      "repos_url": "https://api.github.com/users/kazcw/repos",
      "events_url": "https://api.github.com/users/kazcw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kazcw/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "kazcw",
      "id": 1047859,
      "node_id": "MDQ6VXNlcjEwNDc4NTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1047859?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kazcw",
      "html_url": "https://github.com/kazcw",
      "followers_url": "https://api.github.com/users/kazcw/followers",
      "following_url": "https://api.github.com/users/kazcw/following{/other_user}",
      "gists_url": "https://api.github.com/users/kazcw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kazcw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kazcw/subscriptions",
      "organizations_url": "https://api.github.com/users/kazcw/orgs",
      "repos_url": "https://api.github.com/users/kazcw/repos",
      "events_url": "https://api.github.com/users/kazcw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kazcw/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "4ed41a2b611dfd328fe6f72312d6c596650f03f8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4ed41a2b611dfd328fe6f72312d6c596650f03f8",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/4ed41a2b611dfd328fe6f72312d6c596650f03f8"
      }
    ],
    "stats": {
      "total": 7,
      "additions": 1,
      "deletions": 6
    },
    "files": [
      {
        "sha": "a0e1e140b40131b97a5492f8d2ffab07f6f24d56",
        "filename": "src/prevector.h",
        "status": "modified",
        "additions": 1,
        "deletions": 6,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/a7af72a697a8decab364792230153f114be3919c/src/prevector.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/a7af72a697a8decab364792230153f114be3919c/src/prevector.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/prevector.h?ref=a7af72a697a8decab364792230153f114be3919c",
        "patch": "@@ -412,12 +412,7 @@ class prevector {\n     }\n \n     void swap(prevector<N, T, Size, Diff>& other) {\n-        if (_size & other._size & 1) {\n-            std::swap(_union.capacity, other._union.capacity);\n-            std::swap(_union.indirect, other._union.indirect);\n-        } else {\n-            std::swap(_union, other._union);\n-        }\n+        std::swap(_union, other._union);\n         std::swap(_size, other._size);\n     }\n "
      }
    ]
  }
]