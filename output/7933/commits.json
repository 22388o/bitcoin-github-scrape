[
  {
    "sha": "f8e6fb1800fbac87e76cdddc074d8f4af585f050",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmOGU2ZmIxODAwZmJhYzg3ZTc2Y2RkZGMwNzRkOGY0YWY1ODVmMDUw",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2016-04-25T10:31:45Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2016-04-25T12:22:30Z"
      },
      "message": "Introduce constant for maximum CScript length",
      "tree": {
        "sha": "340d4143f5076cc3d39df54ef3d3f7220e8f9363",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/340d4143f5076cc3d39df54ef3d3f7220e8f9363"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f8e6fb1800fbac87e76cdddc074d8f4af585f050",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f8e6fb1800fbac87e76cdddc074d8f4af585f050",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/f8e6fb1800fbac87e76cdddc074d8f4af585f050",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f8e6fb1800fbac87e76cdddc074d8f4af585f050/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "c4e8390047a1ba14e32ac4f3e3ac425eb5824f21",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c4e8390047a1ba14e32ac4f3e3ac425eb5824f21",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/c4e8390047a1ba14e32ac4f3e3ac425eb5824f21"
      }
    ],
    "stats": {
      "total": 5,
      "additions": 4,
      "deletions": 1
    },
    "files": [
      {
        "sha": "fd4a5674cfea111c56e38921eed4c5623ef6aeac",
        "filename": "src/script/interpreter.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f8e6fb1800fbac87e76cdddc074d8f4af585f050/src/script/interpreter.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f8e6fb1800fbac87e76cdddc074d8f4af585f050/src/script/interpreter.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/script/interpreter.cpp?ref=f8e6fb1800fbac87e76cdddc074d8f4af585f050",
        "patch": "@@ -247,7 +247,7 @@ bool EvalScript(vector<vector<unsigned char> >& stack, const CScript& script, un\n     vector<bool> vfExec;\n     vector<valtype> altstack;\n     set_error(serror, SCRIPT_ERR_UNKNOWN_ERROR);\n-    if (script.size() > 10000)\n+    if (script.size() > MAX_SCRIPT_SIZE)\n         return set_error(serror, SCRIPT_ERR_SCRIPT_SIZE);\n     int nOpCount = 0;\n     bool fRequireMinimal = (flags & SCRIPT_VERIFY_MINIMALDATA) != 0;"
      },
      {
        "sha": "68cde03e34543ad35957cacf0beb4224772ae4bd",
        "filename": "src/script/script.h",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f8e6fb1800fbac87e76cdddc074d8f4af585f050/src/script/script.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f8e6fb1800fbac87e76cdddc074d8f4af585f050/src/script/script.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/script/script.h?ref=f8e6fb1800fbac87e76cdddc074d8f4af585f050",
        "patch": "@@ -27,6 +27,9 @@ static const int MAX_OPS_PER_SCRIPT = 201;\n // Maximum number of public keys per multisig\n static const int MAX_PUBKEYS_PER_MULTISIG = 20;\n \n+// Maximum script length in bytes\n+static const int MAX_SCRIPT_SIZE = 10000;\n+\n // Threshold for nLockTime: below this value it is interpreted as block number,\n // otherwise as UNIX timestamp.\n static const unsigned int LOCKTIME_THRESHOLD = 500000000; // Tue Nov  5 00:53:20 1985 UTC"
      }
    ]
  },
  {
    "sha": "4f87af6fc7580912726f9bf833c21e6e1b478e1d",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0Zjg3YWY2ZmM3NTgwOTEyNzI2ZjliZjgzM2MyMWU2ZTFiNDc4ZTFk",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2016-04-25T10:32:01Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2016-04-25T12:22:30Z"
      },
      "message": "Treat overly long scriptPubKeys as unspendable",
      "tree": {
        "sha": "088a073fa227654bdfc16b28a090dfb23c21b239",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/088a073fa227654bdfc16b28a090dfb23c21b239"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4f87af6fc7580912726f9bf833c21e6e1b478e1d",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4f87af6fc7580912726f9bf833c21e6e1b478e1d",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/4f87af6fc7580912726f9bf833c21e6e1b478e1d",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4f87af6fc7580912726f9bf833c21e6e1b478e1d/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "f8e6fb1800fbac87e76cdddc074d8f4af585f050",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f8e6fb1800fbac87e76cdddc074d8f4af585f050",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/f8e6fb1800fbac87e76cdddc074d8f4af585f050"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 1,
      "deletions": 1
    },
    "files": [
      {
        "sha": "2a338d6f5ccbf10eeda54fc7b8c7ada060d4ab86",
        "filename": "src/script/script.h",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4f87af6fc7580912726f9bf833c21e6e1b478e1d/src/script/script.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4f87af6fc7580912726f9bf833c21e6e1b478e1d/src/script/script.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/script/script.h?ref=4f87af6fc7580912726f9bf833c21e6e1b478e1d",
        "patch": "@@ -624,7 +624,7 @@ class CScript : public CScriptBase\n      */\n     bool IsUnspendable() const\n     {\n-        return (size() > 0 && *begin() == OP_RETURN);\n+        return (size() > 0 && *begin() == OP_RETURN) || (size() > MAX_SCRIPT_SIZE);\n     }\n \n     void clear()"
      }
    ]
  },
  {
    "sha": "4bf631e5e48cd4c14c825cdaf7a1bee81e15493d",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0YmY2MzFlNWU0OGNkNGMxNGM4MjVjZGFmN2ExYmVlODFlMTU0OTNk",
    "commit": {
      "author": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2016-04-25T04:59:46Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2016-04-25T12:42:07Z"
      },
      "message": "CDataStream::ignore Throw exception instead of assert on negative nSize.\n\nPreviously disk corruption would cause an assert instead of an exception.",
      "tree": {
        "sha": "308551a9970037520098890f4d2a01dde2a4822e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/308551a9970037520098890f4d2a01dde2a4822e"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4bf631e5e48cd4c14c825cdaf7a1bee81e15493d",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4bf631e5e48cd4c14c825cdaf7a1bee81e15493d",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/4bf631e5e48cd4c14c825cdaf7a1bee81e15493d",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4bf631e5e48cd4c14c825cdaf7a1bee81e15493d/comments",
    "author": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "4f87af6fc7580912726f9bf833c21e6e1b478e1d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4f87af6fc7580912726f9bf833c21e6e1b478e1d",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/4f87af6fc7580912726f9bf833c21e6e1b478e1d"
      }
    ],
    "stats": {
      "total": 4,
      "additions": 3,
      "deletions": 1
    },
    "files": [
      {
        "sha": "a50fe4e859d7720f675b749e43f37aa8653174ca",
        "filename": "src/streams.h",
        "status": "modified",
        "additions": 3,
        "deletions": 1,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4bf631e5e48cd4c14c825cdaf7a1bee81e15493d/src/streams.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4bf631e5e48cd4c14c825cdaf7a1bee81e15493d/src/streams.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/streams.h?ref=4bf631e5e48cd4c14c825cdaf7a1bee81e15493d",
        "patch": "@@ -240,7 +240,9 @@ class CDataStream\n     CDataStream& ignore(int nSize)\n     {\n         // Ignore from the beginning of the buffer\n-        assert(nSize >= 0);\n+        if (nSize < 0) {\n+            throw std::ios_base::failure(\"CDataStream::ignore(): nSize negative\");\n+        }\n         unsigned int nReadPosNext = nReadPos + nSize;\n         if (nReadPosNext >= vch.size())\n         {"
      }
    ]
  },
  {
    "sha": "5d0434d13d0145a110c0c93e59edfd7d062f8531",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1ZDA0MzRkMTNkMDE0NWExMTBjMGM5M2U1OWVkZmQ3ZDA2MmY4NTMx",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2016-04-24T14:21:44Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2016-04-25T12:42:07Z"
      },
      "message": "Fix OOM bug: UTXO entries with invalid script length",
      "tree": {
        "sha": "7a6629f4f661d2b52b8d5b2304cf42e673caf7e8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7a6629f4f661d2b52b8d5b2304cf42e673caf7e8"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5d0434d13d0145a110c0c93e59edfd7d062f8531",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5d0434d13d0145a110c0c93e59edfd7d062f8531",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/5d0434d13d0145a110c0c93e59edfd7d062f8531",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5d0434d13d0145a110c0c93e59edfd7d062f8531/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "4bf631e5e48cd4c14c825cdaf7a1bee81e15493d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4bf631e5e48cd4c14c825cdaf7a1bee81e15493d",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/4bf631e5e48cd4c14c825cdaf7a1bee81e15493d"
      }
    ],
    "stats": {
      "total": 24,
      "additions": 22,
      "deletions": 2
    },
    "files": [
      {
        "sha": "fa702f0dfa900fb5e695555d911b3ae10479c267",
        "filename": "src/compressor.h",
        "status": "modified",
        "additions": 8,
        "deletions": 2,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5d0434d13d0145a110c0c93e59edfd7d062f8531/src/compressor.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5d0434d13d0145a110c0c93e59edfd7d062f8531/src/compressor.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/compressor.h?ref=5d0434d13d0145a110c0c93e59edfd7d062f8531",
        "patch": "@@ -86,8 +86,14 @@ class CScriptCompressor\n             return;\n         }\n         nSize -= nSpecialScripts;\n-        script.resize(nSize);\n-        s >> REF(CFlatData(script));\n+        if (nSize > MAX_SCRIPT_SIZE) {\n+            // Overly long script, replace with a short invalid one\n+            script << OP_RETURN;\n+            s.ignore(nSize);\n+        } else {\n+            script.resize(nSize);\n+            s >> REF(CFlatData(script));\n+        }\n     }\n };\n "
      },
      {
        "sha": "ed14f3f4121727c57c4ab0f3e6366f20c493d4f5",
        "filename": "src/streams.h",
        "status": "modified",
        "additions": 14,
        "deletions": 0,
        "changes": 14,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5d0434d13d0145a110c0c93e59edfd7d062f8531/src/streams.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5d0434d13d0145a110c0c93e59edfd7d062f8531/src/streams.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/streams.h?ref=5d0434d13d0145a110c0c93e59edfd7d062f8531",
        "patch": "@@ -406,6 +406,20 @@ class CAutoFile\n         return (*this);\n     }\n \n+    CAutoFile& ignore(size_t nSize)\n+    {\n+        if (!file)\n+            throw std::ios_base::failure(\"CAutoFile::ignore: file handle is NULL\");\n+        unsigned char data[4096];\n+        while (nSize > 0) {\n+            size_t nNow = std::min<size_t>(nSize, sizeof(data));\n+            if (fread(data, 1, nNow, file) != nNow)\n+                throw std::ios_base::failure(feof(file) ? \"CAutoFile::ignore: end of file\" : \"CAutoFile::read: fread failed\");\n+            nSize -= nNow;\n+        }\n+        return (*this);\n+    }\n+\n     CAutoFile& write(const char* pch, size_t nSize)\n     {\n         if (!file)"
      }
    ]
  },
  {
    "sha": "1e44169f0e0c334a86b14a22ebc8fec45cec7354",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxZTQ0MTY5ZjBlMGMzMzRhODZiMTRhMjJlYmM4ZmVjNDVjZWM3MzU0",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2016-04-25T12:05:36Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2016-04-25T12:42:07Z"
      },
      "message": "Add tests for CCoins deserialization",
      "tree": {
        "sha": "2b4f72236cc0d61bfbe4d65616cccfa566cdf50b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2b4f72236cc0d61bfbe4d65616cccfa566cdf50b"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1e44169f0e0c334a86b14a22ebc8fec45cec7354",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1e44169f0e0c334a86b14a22ebc8fec45cec7354",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/1e44169f0e0c334a86b14a22ebc8fec45cec7354",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1e44169f0e0c334a86b14a22ebc8fec45cec7354/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "5d0434d13d0145a110c0c93e59edfd7d062f8531",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5d0434d13d0145a110c0c93e59edfd7d062f8531",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/5d0434d13d0145a110c0c93e59edfd7d062f8531"
      }
    ],
    "stats": {
      "total": 71,
      "additions": 71,
      "deletions": 0
    },
    "files": [
      {
        "sha": "129ce04e0bca18cd0c19e65b4c92eec7a30fccc3",
        "filename": "src/test/coins_tests.cpp",
        "status": "modified",
        "additions": 71,
        "deletions": 0,
        "changes": 71,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1e44169f0e0c334a86b14a22ebc8fec45cec7354/src/test/coins_tests.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1e44169f0e0c334a86b14a22ebc8fec45cec7354/src/test/coins_tests.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/coins_tests.cpp?ref=1e44169f0e0c334a86b14a22ebc8fec45cec7354",
        "patch": "@@ -4,7 +4,9 @@\n \n #include \"coins.h\"\n #include \"random.h\"\n+#include \"script/standard.h\"\n #include \"uint256.h\"\n+#include \"utilstrencodings.h\"\n #include \"test/test_bitcoin.h\"\n #include \"main.h\"\n #include \"consensus/validation.h\"\n@@ -345,4 +347,73 @@ BOOST_AUTO_TEST_CASE(updatecoins_simulation_test)\n     BOOST_CHECK(spent_a_duplicate_coinbase);\n }\n \n+BOOST_AUTO_TEST_CASE(ccoins_serialization)\n+{\n+    // Good example\n+    CDataStream ss1(ParseHex(\"0104835800816115944e077fe7c803cfa57f29b36bf87c1d358bb85e\"), SER_DISK, CLIENT_VERSION);\n+    CCoins cc1;\n+    ss1 >> cc1;\n+    BOOST_CHECK_EQUAL(cc1.nVersion, 1);\n+    BOOST_CHECK_EQUAL(cc1.fCoinBase, false);\n+    BOOST_CHECK_EQUAL(cc1.nHeight, 203998);\n+    BOOST_CHECK_EQUAL(cc1.vout.size(), 2);\n+    BOOST_CHECK_EQUAL(cc1.IsAvailable(0), false);\n+    BOOST_CHECK_EQUAL(cc1.IsAvailable(1), true);\n+    BOOST_CHECK_EQUAL(cc1.vout[1].nValue, 60000000000ULL);\n+    BOOST_CHECK_EQUAL(HexStr(cc1.vout[1].scriptPubKey), HexStr(GetScriptForDestination(CKeyID(uint160(ParseHex(\"816115944e077fe7c803cfa57f29b36bf87c1d35\"))))));\n+\n+    // Good example\n+    CDataStream ss2(ParseHex(\"0109044086ef97d5790061b01caab50f1b8e9c50a5057eb43c2d9563a4eebbd123008c988f1a4a4de2161e0f50aac7f17e7f9555caa486af3b\"), SER_DISK, CLIENT_VERSION);\n+    CCoins cc2;\n+    ss2 >> cc2;\n+    BOOST_CHECK_EQUAL(cc2.nVersion, 1);\n+    BOOST_CHECK_EQUAL(cc2.fCoinBase, true);\n+    BOOST_CHECK_EQUAL(cc2.nHeight, 120891);\n+    BOOST_CHECK_EQUAL(cc2.vout.size(), 17);\n+    for (int i = 0; i < 17; i++) {\n+        BOOST_CHECK_EQUAL(cc2.IsAvailable(i), i == 4 || i == 16);\n+    }\n+    BOOST_CHECK_EQUAL(cc2.vout[4].nValue, 234925952);\n+    BOOST_CHECK_EQUAL(HexStr(cc2.vout[4].scriptPubKey), HexStr(GetScriptForDestination(CKeyID(uint160(ParseHex(\"61b01caab50f1b8e9c50a5057eb43c2d9563a4ee\"))))));\n+    BOOST_CHECK_EQUAL(cc2.vout[16].nValue, 110397);\n+    BOOST_CHECK_EQUAL(HexStr(cc2.vout[16].scriptPubKey), HexStr(GetScriptForDestination(CKeyID(uint160(ParseHex(\"8c988f1a4a4de2161e0f50aac7f17e7f9555caa4\"))))));\n+\n+    // Smallest possible example\n+    CDataStream ssx(SER_DISK, CLIENT_VERSION);\n+    BOOST_CHECK_EQUAL(HexStr(ssx.begin(), ssx.end()), \"\");\n+\n+    CDataStream ss3(ParseHex(\"0002000600\"), SER_DISK, CLIENT_VERSION);\n+    CCoins cc3;\n+    ss3 >> cc3;\n+    BOOST_CHECK_EQUAL(cc3.nVersion, 0);\n+    BOOST_CHECK_EQUAL(cc3.fCoinBase, false);\n+    BOOST_CHECK_EQUAL(cc3.nHeight, 0);\n+    BOOST_CHECK_EQUAL(cc3.vout.size(), 1);\n+    BOOST_CHECK_EQUAL(cc3.IsAvailable(0), true);\n+    BOOST_CHECK_EQUAL(cc3.vout[0].nValue, 0);\n+    BOOST_CHECK_EQUAL(cc3.vout[0].scriptPubKey.size(), 0);\n+\n+    // scriptPubKey that ends beyond the end of the stream\n+    CDataStream ss4(ParseHex(\"0002000800\"), SER_DISK, CLIENT_VERSION);\n+    try {\n+        CCoins cc4;\n+        ss4 >> cc4;\n+        BOOST_CHECK_MESSAGE(false, \"We should have thrown\");\n+    } catch (const std::ios_base::failure& e) {\n+    }\n+\n+    // Very large scriptPubKey (3*10^9 bytes) past the end of the stream\n+    CDataStream tmp(SER_DISK, CLIENT_VERSION);\n+    uint64_t x = 3000000000ULL;\n+    tmp << VARINT(x);\n+    BOOST_CHECK_EQUAL(HexStr(tmp.begin(), tmp.end()), \"8a95c0bb00\");\n+    CDataStream ss5(ParseHex(\"0002008a95c0bb0000\"), SER_DISK, CLIENT_VERSION);\n+    try {\n+        CCoins cc5;\n+        ss5 >> cc5;\n+        BOOST_CHECK_MESSAGE(false, \"We should have thrown\");\n+    } catch (const std::ios_base::failure& e) {\n+    }\n+}\n+\n BOOST_AUTO_TEST_SUITE_END()"
      }
    ]
  }
]