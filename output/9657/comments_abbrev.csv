MarcoFalke,2017-01-31T22:32:40Z,Great! Concept ACK on all of those. I will take a detailed look later.\n,https://github.com/bitcoin/bitcoin/pull/9657#issuecomment-276514927,276514927,
jtimon,2017-02-01T01:04:33Z,"Wouldn't f1e8e33 be clearer if https://github.com/bitcoin/bitcoin/blob/master/qa/pull-tester/tests_config.py.in was removed in the same commit?\n\nutACK modulo comments.\n",https://github.com/bitcoin/bitcoin/pull/9657#issuecomment-276543832,276543832,
jnewbery,2017-02-01T02:09:56Z,"@isle2983 @jtimon thanks for the reviews. I've addressed all comments in rebased/squashed commits.\n\n@jtimon - I've removed tests_config.py.in in the first commit (which changes all the commit hashes).",https://github.com/bitcoin/bitcoin/pull/9657#issuecomment-276553878,276553878,
isle2983,2017-02-02T16:20:28Z,"ACK 117e0f2da241e8491b17a80b0acc34ac245d3842\n\nTested on Debian 8 environment with normal `./configure LDFLAGS=""-L$BDB_BUILD/lib"" CPPFLAGS=""-I/$BDB_BUILD/include""`:\n\n- with and without `--coverage`\n- with and without `--extended`\n- with and without `--nozmq`\n- individual tests given as args\n- `-j12` and with default jobs\n\nDid not test:\n\n- `passon_args`\n- `--win`",https://github.com/bitcoin/bitcoin/pull/9657#issuecomment-277004412,277004412,
jtimon,2017-02-02T21:47:33Z,"Bike-shedding history, I would have preferred that ALL_SCRIPTS is declared and used in https://github.com/bitcoin/bitcoin/pull/9657/commits/0eeb09ecaee969c0f9636b893c0c3a7283006459 otherwise the commit is broken. The comprehensive lists in https://github.com/bitcoin/bitcoin/pull/9657/commits/117e0f2da241e8491b17a80b0acc34ac245d3842 could also be squashed there. It makes sense to keep s/parallel/jo",https://github.com/bitcoin/bitcoin/pull/9657#issuecomment-277094673,277094673,
jnewbery,2017-02-02T22:16:23Z,"thanks @jtimon - you're right about that historic commit being broken. I did try to merge back and rebase, but it caused merge conflicts, so I didn't bother continuing.\n\nIf the maintainers really think this is important, I can go back and fix history, but these commits should be merged as a set, so I don't think it matters.",https://github.com/bitcoin/bitcoin/pull/9657#issuecomment-277102222,277102222,
jnewbery,2017-02-02T22:55:24Z,Apologies for the review churn. I've just realised that my last commit introduced a redundant check on the names of the tests to run. I've removed that in commit https://github.com/bitcoin/bitcoin/pull/9657/commits/1bd87a63d36c79e5a019bc44e07a5a34d2bd51ea . Once review is complete I'll squash that into the previous commit.,https://github.com/bitcoin/bitcoin/pull/9657#issuecomment-277111261,277111261,
MarcoFalke,2017-02-03T02:39:53Z,"> so I don't think it matters.\n\nIt will break git bisect. Maybe you squash all commits that are problematic? Though, I won't block the pull based on this.",https://github.com/bitcoin/bitcoin/pull/9657#issuecomment-277149695,277149695,
jnewbery,2017-02-06T14:13:06Z,"> It will break git bisect. \n\nGood point. I've now fixed up the history so rpc-tests.py should run at all commits. Branch is now at 3de3ccdfaaa5edcf4e0924860d960e7e0db5a9b9 . The only difference from the previous branch pointer 117e0f2da241e8491b17a80b0acc34ac245d3842 (ACK'ed by @jtimon and @isle2983 ) is that I've removed a redundant if test, changed a variable name from `run_parallel` to `jo",https://github.com/bitcoin/bitcoin/pull/9657#issuecomment-277692555,277692555,
jtimon,2017-02-09T18:40:27Z,"re-utACK 3de3ccdfaaa5edcf4e0924860d960e7e0db5a9b9\nThanks for cleaning up the history.",https://github.com/bitcoin/bitcoin/pull/9657#issuecomment-278733197,278733197,
ryanofsky,2017-02-17T11:12:33Z,utACK 3de3ccdfaaa5edcf4e0924860d960e7e0db5a9b9,https://github.com/bitcoin/bitcoin/pull/9657#issuecomment-280623071,280623071,
jnewbery,2017-02-17T19:24:54Z,Thanks for the thorough review @ryanofsky . I've applied most of those markups in a new commit. I haven't squashed them into the separate commits since there was quite a lot of code churn within those commits and it'd be tedious to get the history right.,https://github.com/bitcoin/bitcoin/pull/9657#issuecomment-280742893,280742893,
MarcoFalke,2017-02-18T14:28:34Z,"Thanks @ryanofsky for suggesting the `getboolean()` method, this is indeed cleaner code.",https://github.com/bitcoin/bitcoin/pull/9657#issuecomment-280848966,280848966,
jnewbery,2017-02-19T04:34:58Z,Thanks @MarcoFalke . I'll make sure to track that feedback and address it early next week.,https://github.com/bitcoin/bitcoin/pull/9657#issuecomment-280895548,280895548,
jtimon,2017-02-01T00:45:31Z,"One shouldn't be required to pass --extended to be able to run specific tests from the extended set. You can leave the following here:\n```\nfor t in BASE_SCRIPTS + EXTENDED_SCRIPTS:\n```\nMhmm, that would still exclude zmq_test.py because of the other change you made...\n",https://github.com/bitcoin/bitcoin/pull/9657#discussion_r98807460,98807460,qa/pull-tester/rpc-tests.py
isle2983,2017-02-01T00:48:25Z,"If we are considering changing this around, my vote would be for renaming `--parallel` to be `--jobs` and also giving it a '-j' alias. The advantage is that it matches `make` where most people know what `-j3` means at a glance.",https://github.com/bitcoin/bitcoin/pull/9657#discussion_r98807825,98807825,qa/pull-tester/rpc-tests.py
isle2983,2017-02-01T00:48:32Z,"Suggest doing this chunk with list/iterator comprehension like so:\n\n```\ntests = set(arg for arg in unknown_args if arg[:2] != ""--"")\npasson_args = [arg for arg in unknown_args if arg[:2] == ""--""]\n```",https://github.com/bitcoin/bitcoin/pull/9657#discussion_r98807845,98807845,qa/pull-tester/rpc-tests.py
isle2983,2017-02-01T00:48:44Z,"Suggest building test_list with list comprehension:\n```\ntest_list = [t for t in test_scripts if\n             (t in tests or re.sub("".py$"", """", t) in tests)]\n```",https://github.com/bitcoin/bitcoin/pull/9657#discussion_r98807866,98807866,qa/pull-tester/rpc-tests.py
jtimon,2017-02-01T00:49:58Z,""" and that we should run the tests"" sounds weird to me. Are there special tests only for windows? Otherwise we just should run the tests, as always, just taking into account the windows environment.\nIf there's windows specific tests, what about ""signal that this is running in a Windows environment and the windows specific tests sould be run""?",https://github.com/bitcoin/bitcoin/pull/9657#discussion_r98808021,98808021,qa/pull-tester/rpc-tests.py
jtimon,2017-02-01T00:53:44Z,NACK on changing the order and removing the time comments (ie reverting #9276 ),https://github.com/bitcoin/bitcoin/pull/9657#discussion_r98808486,98808486,qa/pull-tester/rpc-tests.py
jtimon,2017-02-01T01:03:37Z,Maybe stupid question...not sure how main() can call runtests() without having declared it yet.,https://github.com/bitcoin/bitcoin/pull/9657#discussion_r98809720,98809720,qa/pull-tester/rpc-tests.py
jnewbery,2017-02-01T02:04:21Z,Agree. I've fixed this by adding a new ALL_SCRIPTS variable which is the concatenation of the three other lists.,https://github.com/bitcoin/bitcoin/pull/9657#discussion_r98816683,98816683,qa/pull-tester/rpc-tests.py
jnewbery,2017-02-01T02:04:28Z,agree. Changed.,https://github.com/bitcoin/bitcoin/pull/9657#discussion_r98816697,98816697,qa/pull-tester/rpc-tests.py
jnewbery,2017-02-01T02:04:38Z,much nicer. Thanks!,https://github.com/bitcoin/bitcoin/pull/9657#discussion_r98816707,98816707,qa/pull-tester/rpc-tests.py
jnewbery,2017-02-01T02:04:46Z,yep. Fixed.,https://github.com/bitcoin/bitcoin/pull/9657#discussion_r98816726,98816726,qa/pull-tester/rpc-tests.py
jnewbery,2017-02-01T02:06:04Z,"I haven't changed the text in this argument (the text was previously in the docstring for the module). There are no windows specific tests - this argument simply means ""I know I'm running on windows and I definitely want to run the tests."" I haven't dug into why this argument was added originally, but feel free to open a new PR if you think it can be removed.",https://github.com/bitcoin/bitcoin/pull/9657#discussion_r98816825,98816825,qa/pull-tester/rpc-tests.py
jnewbery,2017-02-01T02:06:57Z,"Oops. This was a bad manual merge from a old branch.\n\nThanks for catching this. I've fixed this so #9276 is included.",https://github.com/bitcoin/bitcoin/pull/9657#discussion_r98816902,98816902,qa/pull-tester/rpc-tests.py
jnewbery,2017-02-01T02:08:00Z,"Not a stupid question :)\n\n`main()` is called in the final line of the module:\n\n```\nif __name__ == '__main__':\n    main()\n```\n\nby which point all the functions have been declared. I believe this is a fairly common python module structure.",https://github.com/bitcoin/bitcoin/pull/9657#discussion_r98816984,98816984,qa/pull-tester/rpc-tests.py
isle2983,2017-02-01T16:51:48Z,"This is incorrect and it prevents you from running a single test at a time e.g. `$ qa/pull-tester/rpc-tests.py segwit`\n\n`test_scripts` can only be made up of `BASE_SCRIPTS`, `ZMQ_SCRIPTS`, and `EXTENDED_SCRIPTS`. `ALL_SCRIPTS` is all of those, so `test_list` will then always be set to all of `test_scripts`.\n\nI believe it should be:\n```\ntest_list = [t for t in test_scripts if (t in test",https://github.com/bitcoin/bitcoin/pull/9657#discussion_r98939477,98939477,qa/pull-tester/rpc-tests.py
jnewbery,2017-02-02T15:17:02Z,"You're completely right. I put the ALL_SCRIPTS in the wrong place.\n\nShould be fixed now.",https://github.com/bitcoin/bitcoin/pull/9657#discussion_r99140632,99140632,qa/pull-tester/rpc-tests.py
MarcoFalke,2017-02-03T02:13:01Z,"Nit: This should use double dash, if you change it above.",https://github.com/bitcoin/bitcoin/pull/9657#discussion_r99265690,99265690,qa/pull-tester/rpc-tests.py
ryanofsky,2017-02-16T20:44:02Z,"Capitalized ""True""/""False"" seems out of place in an .ini file. Maybe switch to lowercase ""yes""/""no"" as shown in the documentation: https://docs.python.org/3/library/configparser.html. ""yes""/""no"" are also understood by the git config tool (https://git-scm.com/docs/git-config#git-config-true), though the canonical form in git is ""true""/""false"".",https://github.com/bitcoin/bitcoin/pull/9657#discussion_r101621947,101621947,qa/pull-tester/tests_config.ini.in
ryanofsky,2017-02-16T20:53:26Z,"This section is redundant and could mislead someone who is reading this file into thinking these options are false when they aren't. Suggest removing this section and replacing\n\n```\nENABLE_WALLET = config[""components""][""ENABLE_WALLET""] == ""True""\n```\n\nwith\n\n```\nENABLE_WALLET = config[""components""].get(""ENABLE_WALLET"") == ""True""\n```\n\nor similar.",https://github.com/bitcoin/bitcoin/pull/9657#discussion_r101623732,101623732,qa/pull-tester/tests_config.ini.in
ryanofsky,2017-02-16T20:57:24Z,Parentheses unnecessary.,https://github.com/bitcoin/bitcoin/pull/9657#discussion_r101624580,101624580,qa/pull-tester/rpc-tests.py
ryanofsky,2017-02-16T20:59:11Z,Get rid of these? Why have two names for the same thing?,https://github.com/bitcoin/bitcoin/pull/9657#discussion_r101624955,101624955,qa/pull-tester/rpc-tests.py
ryanofsky,2017-02-16T21:03:01Z,"Should avoid if len in python, https://www.python.org/dev/peps/pep-0008/\n\n```\nYes: if not seq:\n     if seq:\n\nNo: if len(seq):\n    if not len(seq):\n```\n\nMore occurrences a few places below, too.",https://github.com/bitcoin/bitcoin/pull/9657#discussion_r101625761,101625761,qa/pull-tester/rpc-tests.py
ryanofsky,2017-02-16T21:04:16Z,"Seems like ""t in tests or "" is redundant.",https://github.com/bitcoin/bitcoin/pull/9657#discussion_r101625992,101625992,qa/pull-tester/rpc-tests.py
ryanofsky,2017-02-16T21:10:26Z,"Maybe just use the config object directly below instead of defining these variables, since they are only used once. This will cut down on the number of global variables in this script, and make it clearer from the context where the settings are used where the settings come from.",https://github.com/bitcoin/bitcoin/pull/9657#discussion_r101627130,101627130,qa/pull-tester/rpc-tests.py
ryanofsky,2017-02-16T21:20:09Z,"Since you're adding a dash to this argument maybe consider renaming it something comprehensible like --force. And changing help text to ""Run tests even on platforms where they are disabled by default (e.g. windows).""\n\nThe ""signal that this is running in a windows environment"" just comes off as strange, since the script obviously knows what environment it is running in.",https://github.com/bitcoin/bitcoin/pull/9657#discussion_r101629158,101629158,qa/pull-tester/rpc-tests.py
ryanofsky,2017-02-16T21:28:05Z,"These two lines look like one sentence, would add punctuation.",https://github.com/bitcoin/bitcoin/pull/9657#discussion_r101630777,101630777,qa/pull-tester/rpc-tests.py
ryanofsky,2017-02-16T21:36:27Z,Maybe call it run_tests for pep8.,https://github.com/bitcoin/bitcoin/pull/9657#discussion_r101632594,101632594,qa/pull-tester/rpc-tests.py
jnewbery,2017-02-17T18:34:26Z,Great! I wasn't aware of the get() method. Agree that removing the defaults section is much better.,https://github.com/bitcoin/bitcoin/pull/9657#discussion_r101818502,101818502,qa/pull-tester/tests_config.ini.in
jnewbery,2017-02-17T18:43:09Z,Good point. I'll change these to `true` and use the `getboolean()` method,https://github.com/bitcoin/bitcoin/pull/9657#discussion_r101820220,101820220,qa/pull-tester/tests_config.ini.in
jnewbery,2017-02-17T18:43:38Z,removed,https://github.com/bitcoin/bitcoin/pull/9657#discussion_r101820313,101820313,qa/pull-tester/rpc-tests.py
jnewbery,2017-02-17T18:47:53Z,"yep - I set this as a global variable to match the existing layout. It's been moved to be a local variable in the subsequent refactor commit.\n\nI could remove the variable entirely and access the config directly in the if test, but I don't think it makes much difference at this point.",https://github.com/bitcoin/bitcoin/pull/9657#discussion_r101821219,101821219,qa/pull-tester/rpc-tests.py
jnewbery,2017-02-17T18:50:10Z,"Yes. @jtimon made the same point that the help text was nonsense. Good point about changing the name of the parameter since I'm already breaking backward compatibility :)\n\nI'll change this to --force and update the help text.",https://github.com/bitcoin/bitcoin/pull/9657#discussion_r101821700,101821700,qa/pull-tester/rpc-tests.py
jnewbery,2017-02-17T18:55:39Z,fixed,https://github.com/bitcoin/bitcoin/pull/9657#discussion_r101822855,101822855,qa/pull-tester/rpc-tests.py
jnewbery,2017-02-17T19:19:19Z,"This is required if the user specifies a test with the .py suffix, eg:\n\n`rpc-tests.py rpcnamedargs.py`",https://github.com/bitcoin/bitcoin/pull/9657#discussion_r101827684,101827684,qa/pull-tester/rpc-tests.py
MarcoFalke,2017-02-18T13:30:38Z,"Even though of local scope, those  still denote global constants, so should be ALL_UPPER_CASE?",https://github.com/bitcoin/bitcoin/pull/9657#discussion_r101893148,101893148,qa/pull-tester/rpc-tests.py
MarcoFalke,2017-02-18T13:48:18Z,"I know this has no effect, but this was build_dir previously and should not be changed in this commit.\n",https://github.com/bitcoin/bitcoin/pull/9657#discussion_r101893410,101893410,qa/pull-tester/rpc-tests.py
MarcoFalke,2017-02-18T13:56:27Z,"If you change the name of the arguments, make sure to update the docs https://github.com/bitcoin/bitcoin/tree/master/qa#running-tests and maybe even put a tiny notice in the release notes that says that some of the arguments to rpc-test.py have changed. Alternatively you could provide aliases for compatibility.",https://github.com/bitcoin/bitcoin/pull/9657#discussion_r101893552,101893552,qa/pull-tester/rpc-tests.py
