petertodd,2014-05-08T05:36:43Z,To save you some time testing: https://github.com/petertodd/tx-flood-attack\n,https://github.com/bitcoin/bitcoin/pull/4150#issuecomment-42514908,42514908,
gmaxwell,2014-05-08T05:39:11Z,"I think we should probably introduce a new term for things which are not invalid but which no sane policy difference should change e.g.:  E.g. version/nops/sane limits on SIGOPS count, canonization of pushes. We need to be careful about ""invalid"" since someone may accidentally incorporate it in a block validity rule.\n",https://github.com/bitcoin/bitcoin/pull/4150#issuecomment-42515011,42515011,
petertodd,2014-05-08T05:40:39Z,"@gmaxwell Agreed, especially given that IsStandard() may very well turn into a very permissive whitelist allowing everything but some carefully controlled edge cases and NOP functionality used for safe soft-forking.\n",https://github.com/bitcoin/bitcoin/pull/4150#issuecomment-42515083,42515083,
sipa,2014-05-09T10:58:57Z,"I have previous suggested using a more generic ""resource usage"" metric, defined as max(bytes / max_block_bytes, sigops / max_block_sigops), and use that for prioritization and fee calculations instead of just size. That would naturally limit standardness of high-sigop transactions, make mining code require appropriate fees for it, and make it compete fairly with others for ""sigop space"" in blocks.",https://github.com/bitcoin/bitcoin/pull/4150#issuecomment-42654575,42654575,
jgarzik,2014-05-09T15:15:15Z,+1 @sipa \n,https://github.com/bitcoin/bitcoin/pull/4150#issuecomment-42677323,42677323,
petertodd,2014-05-09T23:44:28Z,"@jgarzik @sipa Agreed re: sigop space... but remember I deliberately didn't include that in this pull-req to keep it simple and focused on solving the immediate problem of ""don't accept tx's that simply can't be mined""\n",https://github.com/bitcoin/bitcoin/pull/4150#issuecomment-42724544,42724544,
sipa,2014-05-11T11:32:54Z,"@petertodd Right; not a criticism on this pull request. As far as I can tell, it has the exact same effect, but on more than just mempool acceptance.\n",https://github.com/bitcoin/bitcoin/pull/4150#issuecomment-42768278,42768278,
petertodd,2014-05-11T17:43:50Z,"@sipa Belt-and-suspenders; easy to write a resource usage metric that fails to notice a tx uses more resources than a block actually has!\n\nBut anyway, rewriting IsStandard() to IsSoftForkSafe() is on my todo list, and will need a sigops resource usage metric thing.\n",https://github.com/bitcoin/bitcoin/pull/4150#issuecomment-42777464,42777464,
ashleyholman,2014-05-12T15:58:55Z,"I have done the following testing on testnet only.  The patch appears to work as intended.\n- On unpatched master branch:\n  - TX with 39,060 sigops was accepted into the mempool, via RPC as well as via network peer.\n  - TX was not mineable\n- On patched master branch:\n  - TX with 39,060 sigops was rejected (""too many sigops"" error logged, and reject message sent to peer / RPC client)\n  - TX's ",https://github.com/bitcoin/bitcoin/pull/4150#issuecomment-42850880,42850880,
jgarzik,2014-06-07T02:10:26Z,"I like the concept, and we really need to address sigops.\n\nI don't like making an arbitrary limit which is technically below that which could be mined.  Thus it is a soft fork, one likely to escape notice.  mempool accept includes local TXs as well as remote ones.\n\nAs such, leaning towards NAK.  Want to find a better way to do the same thing.\n",https://github.com/bitcoin/bitcoin/pull/4150#issuecomment-45398681,45398681,
petertodd,2014-06-07T02:26:17Z,"Huh? This isn't a soft-fork at all; AcceptToMemoryPool() isn't called in the block validation code.\n\nAnyway, it may be an arbitrary limit, but it's a very high limit. Remember that we're fixing an actual real-world vulnerability that is getting some exploitation attempts; we can create a better fix later with more permissive rules. The only transactions on mainnet that would have actually run in",https://github.com/bitcoin/bitcoin/pull/4150#issuecomment-45398986,45398986,
petertodd,2014-06-07T02:29:44Z,"Note BTW the similarities to the other arbitrary limit on max transaction size. Again it's a limit almost no legit transaction runs into in practice, so essentially zero impact on actual users.\n",https://github.com/bitcoin/bitcoin/pull/4150#issuecomment-45399052,45399052,
laanwj,2014-06-25T10:10:23Z,It is indeed not a softfork or any fork - it doesn't touch the consensus code. It checks transactions before going into the mempool not transactions in blocks.\n\nIMO these kinds of belt-and-suspenders DoS limits make sense.\n\nACK (except from returning INVALID which I think is confusing as it implies that a deeper validation limit is hit).\n,https://github.com/bitcoin/bitcoin/pull/4150#issuecomment-47082951,47082951,
petertodd,2014-06-25T15:36:36Z,"@laanwj I can change the INVALID, although I'm out of the country again for another two weeks. If you want to do it yourself sooner feel free.\n",https://github.com/bitcoin/bitcoin/pull/4150#issuecomment-47118377,47118377,
petertodd,2014-07-13T14:21:15Z,Fixed s/INVALID/NON_STANDARD/ nit.\n\nShould be ready for merging.\n,https://github.com/bitcoin/bitcoin/pull/4150#issuecomment-48841817,48841817,
BitcoinPullTester,2014-07-13T15:13:40Z,"Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/p4150_4fad8e6d831729efa1965fa2034e7e51d3d0a1be/ for binaries and test log.\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.log is moving at http://jenkins.bluematt.me/pull-te",https://github.com/bitcoin/bitcoin/pull/4150#issuecomment-48843184,48843184,
jgarzik,2014-08-12T13:05:08Z,EPROCESS.  This appears to have been merged with only one ACK.\n,https://github.com/bitcoin/bitcoin/pull/4150#issuecomment-51910514,51910514,
laanwj,2014-08-12T13:06:35Z,OK - reverted again\n,https://github.com/bitcoin/bitcoin/pull/4150#issuecomment-51910659,51910659,
jgarzik,2014-08-12T13:11:25Z,"Quickly poking people for ACKs on IRC seems like a reasonable alternative to reverting, if you want to go that route.\n",https://github.com/bitcoin/bitcoin/pull/4150#issuecomment-51911227,51911227,
sipa,2014-08-12T13:12:51Z,posthumous ACK\n,https://github.com/bitcoin/bitcoin/pull/4150#issuecomment-51911391,51911391,
jgarzik,2014-08-12T13:17:18Z,ut ACK\n,https://github.com/bitcoin/bitcoin/pull/4150#issuecomment-51911934,51911934,
luke-jr,2014-05-08T04:52:15Z,How is this considered invalid? This code path is inherently about non-IsStandard.\n,https://github.com/bitcoin/bitcoin/pull/4150#discussion_r12415264,12415264,src/main.cpp
luke-jr,2014-05-08T04:52:49Z,I'm not sure a fixed limit makes sense here?\n,https://github.com/bitcoin/bitcoin/pull/4150#discussion_r12415272,12415272,src/main.cpp
petertodd,2014-05-08T05:09:30Z,"Worrying about the exact difference between ""invalid"" and ""non-standard"" when the boundry is fuzzy seemed like quibbling to me. MAX_TX_SIGOPS is defined as 1/5th of MAX_BLOCK_SIGOPS; it's already about three orders of magnitude greater than a normal transaction, and less than an order of magnitude away from the absolute limit. (which is impractical to actually use anyway - as I say coinbases use u",https://github.com/bitcoin/bitcoin/pull/4150#discussion_r12415554,12415554,src/main.cpp
rebroad,2014-05-08T05:46:28Z,Does this mean someone only needs to create five transactions with the max\noperations to cause the block limit to be reached?\n,https://github.com/bitcoin/bitcoin/pull/4150#discussion_r12415999,12415999,src/main.cpp
gmaxwell,2014-05-08T05:51:39Z,"@rebroad Yes, and what about it?  How transactions are prioritized is a separate matter from what should be considered at all.\n",https://github.com/bitcoin/bitcoin/pull/4150#discussion_r12416068,12416068,src/main.cpp
petertodd,2014-05-08T05:51:45Z,"@rebroad Yup. OTOH the cost difference for the attacker isn't huge, about an order of magnitude better than just buying p2p resources with fees, so it's not an attack I'm very worried about. I actually did write and test up some quick code that just adjusts nSize so the fee calculations end up fair, but there isn't a pressing need for it yet. Creating transactions that simply can't be mined on the",https://github.com/bitcoin/bitcoin/pull/4150#discussion_r12416071,12416071,src/main.cpp
petertodd,2014-05-08T05:55:30Z,"Oh, and that's also why I chose 1/5th of the total block sigops rather than trying to pick a more exact number closer to the absolute limit: Why invite attackers to exploit edge cases I didn't think of? Five transactions is a lot more margin than trying to get exactly one.\n",https://github.com/bitcoin/bitcoin/pull/4150#discussion_r12416137,12416137,src/main.cpp
laanwj,2014-06-24T15:15:11Z,"I agree with @luke-jr here. INVALID is the wrong terminology. It doesn't fail any consensus validation check, we just deny it into the mempool because of DoS risk.\n",https://github.com/bitcoin/bitcoin/pull/4150#discussion_r14134821,14134821,src/main.cpp
