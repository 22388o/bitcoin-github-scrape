[
  {
    "sha": "078697b066503cb1f63c3b37ad30e892121be321",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzowNzg2OTdiMDY2NTAzY2IxZjYzYzNiMzdhZDMwZTg5MjEyMWJlMzIx",
    "commit": {
      "author": {
        "name": "Ben Woosley",
        "email": "ben.woosley@gmail.com",
        "date": "2018-04-12T00:26:53Z"
      },
      "committer": {
        "name": "Ben Woosley",
        "email": "ben.woosley@gmail.com",
        "date": "2018-04-12T00:48:34Z"
      },
      "message": "Drop IsCompressedOrUncompressedPubKey and IsCompressedPubKey\n\nIn favor of CPubKey methods. As of #12460, CPubKey::ValidSize tests relative\nto the header-relevant pubkey sizes, making it an appropriate replacement.\n\nNote that this adds support for 2 new uncompressed header types to the\nIsCompressedOrUncompressedPubKey pathway: values 6 and 7.",
      "tree": {
        "sha": "de5ec8907ae50eb0f1059496a1a86565653cd0fc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/de5ec8907ae50eb0f1059496a1a86565653cd0fc"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/078697b066503cb1f63c3b37ad30e892121be321",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE+XLHXoy4Dim7e8hvTYykuhgECQYFAlrOrR0ACgkQTYykuhgE\nCQbuqw//TiudDsc/vv7btjNP1u7DAmUoqWEXn2b3I84i+1HO1aDOgBhOmkgOEp3T\n1GhtX74Yx1tQLTtRK9HNoMGCd9lbCA5AtDqUvPjCNFEL5JtfMywR3yUbMOJbhJ6p\nP8+Pg9NyEmkCChciA2AMTbtDwd9xb3bawn02BqviaGEyoHU5TGHiX5nmKtFdD0qT\n6F6vrwKIJgFFeYe0EJZR0s5o9fKJR+p4pYDpJ/eg0SE17i6W/Ks/tnQqCHduEN88\n+iR1XSyHIzeDVW6rz3VI+KAzFimcoC0WpTuVFvaybYtbseZ6W5BuONXtcb7IefM7\nzmu1aSaEy1BDgpi/iKeiao2NgaI1KK0aqABaXGP4kvou4Z/Fbl7UquZfy55QE1Uc\nJnwseAgBEWloDGLX1pDXnPqLKGFqiGn56+OgU6llx7/olRmpCk5P/YAdXpEacCjB\nh58BemPp+uIT4VZwJYFi3FrxeSOUTN1yEByjU17YKOA+0I/KRr6uW70aBzXL+c7r\nS4m5VM+PNDRkQfWXPukhtTLvyD+uJBVb7eulzPoBRWKezf7Wh2OHhizjhTOy6SAo\nSXJIRy7zHIF35kPttq+Qp8YolFBMZo4MU4To4Rt2c7udKEO6O4ScveM6GWqqDq66\nWsfpwmjowMAntGja6lFpQlfCEseN9INTd7SFxwkM65CxUPFjtz4=\n=iPZC\n-----END PGP SIGNATURE-----",
        "payload": "tree de5ec8907ae50eb0f1059496a1a86565653cd0fc\nparent 3cf76c23fbfc8500fa494f8cef8068a67a1388c3\nauthor Ben Woosley <ben.woosley@gmail.com> 1523492813 -0700\ncommitter Ben Woosley <ben.woosley@gmail.com> 1523494114 -0700\n\nDrop IsCompressedOrUncompressedPubKey and IsCompressedPubKey\n\nIn favor of CPubKey methods. As of #12460, CPubKey::ValidSize tests relative\nto the header-relevant pubkey sizes, making it an appropriate replacement.\n\nNote that this adds support for 2 new uncompressed header types to the\nIsCompressedOrUncompressedPubKey pathway: values 6 and 7.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/078697b066503cb1f63c3b37ad30e892121be321",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/078697b066503cb1f63c3b37ad30e892121be321",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/078697b066503cb1f63c3b37ad30e892121be321/comments",
    "author": {
      "login": "Empact",
      "id": 5470,
      "node_id": "MDQ6VXNlcjU0NzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5470?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Empact",
      "html_url": "https://github.com/Empact",
      "followers_url": "https://api.github.com/users/Empact/followers",
      "following_url": "https://api.github.com/users/Empact/following{/other_user}",
      "gists_url": "https://api.github.com/users/Empact/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Empact/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Empact/subscriptions",
      "organizations_url": "https://api.github.com/users/Empact/orgs",
      "repos_url": "https://api.github.com/users/Empact/repos",
      "events_url": "https://api.github.com/users/Empact/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Empact/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "Empact",
      "id": 5470,
      "node_id": "MDQ6VXNlcjU0NzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5470?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Empact",
      "html_url": "https://github.com/Empact",
      "followers_url": "https://api.github.com/users/Empact/followers",
      "following_url": "https://api.github.com/users/Empact/following{/other_user}",
      "gists_url": "https://api.github.com/users/Empact/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Empact/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Empact/subscriptions",
      "organizations_url": "https://api.github.com/users/Empact/orgs",
      "repos_url": "https://api.github.com/users/Empact/repos",
      "events_url": "https://api.github.com/users/Empact/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Empact/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "3cf76c23fbfc8500fa494f8cef8068a67a1388c3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3cf76c23fbfc8500fa494f8cef8068a67a1388c3",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/3cf76c23fbfc8500fa494f8cef8068a67a1388c3"
      }
    ],
    "stats": {
      "total": 54,
      "additions": 16,
      "deletions": 38
    },
    "files": [
      {
        "sha": "1ea94459568a6e45d5390799a1dc61a233e9ac7a",
        "filename": "src/pubkey.h",
        "status": "modified",
        "additions": 14,
        "deletions": 2,
        "changes": 16,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/078697b066503cb1f63c3b37ad30e892121be321/src/pubkey.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/078697b066503cb1f63c3b37ad30e892121be321/src/pubkey.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/pubkey.h?ref=078697b066503cb1f63c3b37ad30e892121be321",
        "patch": "@@ -71,8 +71,20 @@ class CPubKey\n \n public:\n \n-    bool static ValidSize(const std::vector<unsigned char> &vch) {\n-      return vch.size() > 0 && GetLen(vch[0]) == vch.size();\n+    /**\n+     *  @return true if the pubkey header and size are valid for a pubkey\n+     */\n+    bool static ValidSize(const std::vector<unsigned char> &vch)\n+    {\n+        return vch.size() > 0 && GetLen(vch[0]) == vch.size();\n+    }\n+\n+    /**\n+     *  @return true if the pubkey header and size match that of a compressed pubkey\n+     */\n+    bool static IsCompressed(const std::vector<unsigned char>& vch)\n+    {\n+        return vch.size() > 0 && GetLen(vch[0]) == COMPRESSED_PUBLIC_KEY_SIZE && vch.size() == COMPRESSED_PUBLIC_KEY_SIZE;\n     }\n \n     //! Construct an invalid public key."
      },
      {
        "sha": "27bc5811d87320e7da960784d35623f6e6bfbd2e",
        "filename": "src/script/interpreter.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 36,
        "changes": 38,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/078697b066503cb1f63c3b37ad30e892121be321/src/script/interpreter.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/078697b066503cb1f63c3b37ad30e892121be321/src/script/interpreter.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/script/interpreter.cpp?ref=078697b066503cb1f63c3b37ad30e892121be321",
        "patch": "@@ -60,40 +60,6 @@ static inline void popstack(std::vector<valtype>& stack)\n     stack.pop_back();\n }\n \n-bool static IsCompressedOrUncompressedPubKey(const valtype &vchPubKey) {\n-    if (vchPubKey.size() < CPubKey::COMPRESSED_PUBLIC_KEY_SIZE) {\n-        //  Non-canonical public key: too short\n-        return false;\n-    }\n-    if (vchPubKey[0] == 0x04) {\n-        if (vchPubKey.size() != CPubKey::PUBLIC_KEY_SIZE) {\n-            //  Non-canonical public key: invalid length for uncompressed key\n-            return false;\n-        }\n-    } else if (vchPubKey[0] == 0x02 || vchPubKey[0] == 0x03) {\n-        if (vchPubKey.size() != CPubKey::COMPRESSED_PUBLIC_KEY_SIZE) {\n-            //  Non-canonical public key: invalid length for compressed key\n-            return false;\n-        }\n-    } else {\n-        //  Non-canonical public key: neither compressed nor uncompressed\n-        return false;\n-    }\n-    return true;\n-}\n-\n-bool static IsCompressedPubKey(const valtype &vchPubKey) {\n-    if (vchPubKey.size() != CPubKey::COMPRESSED_PUBLIC_KEY_SIZE) {\n-        //  Non-canonical public key: invalid length for compressed key\n-        return false;\n-    }\n-    if (vchPubKey[0] != 0x02 && vchPubKey[0] != 0x03) {\n-        //  Non-canonical public key: invalid prefix for compressed key\n-        return false;\n-    }\n-    return true;\n-}\n-\n /**\n  * A canonical signature exists of: <30> <total len> <02> <len R> <R> <02> <len S> <S> <hashtype>\n  * Where R and S are not negative (their first byte has its highest bit not set), and not\n@@ -215,11 +181,11 @@ bool CheckSignatureEncoding(const std::vector<unsigned char> &vchSig, unsigned i\n }\n \n bool static CheckPubKeyEncoding(const valtype &vchPubKey, unsigned int flags, const SigVersion &sigversion, ScriptError* serror) {\n-    if ((flags & SCRIPT_VERIFY_STRICTENC) != 0 && !IsCompressedOrUncompressedPubKey(vchPubKey)) {\n+    if ((flags & SCRIPT_VERIFY_STRICTENC) != 0 && !CPubKey::ValidSize(vchPubKey)) {\n         return set_error(serror, SCRIPT_ERR_PUBKEYTYPE);\n     }\n     // Only compressed keys are accepted in segwit\n-    if ((flags & SCRIPT_VERIFY_WITNESS_PUBKEYTYPE) != 0 && sigversion == SigVersion::WITNESS_V0 && !IsCompressedPubKey(vchPubKey)) {\n+    if ((flags & SCRIPT_VERIFY_WITNESS_PUBKEYTYPE) != 0 && sigversion == SigVersion::WITNESS_V0 && !CPubKey::IsCompressed(vchPubKey)) {\n         return set_error(serror, SCRIPT_ERR_WITNESS_PUBKEYTYPE);\n     }\n     return true;"
      }
    ]
  }
]