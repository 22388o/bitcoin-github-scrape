[
  {
    "sha": "d5d19c74a5f5cbcaad6869dc7d89bd7077b7d175",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpkNWQxOWM3NGE1ZjVjYmNhYWQ2ODY5ZGM3ZDg5YmQ3MDc3YjdkMTc1",
    "commit": {
      "author": {
        "name": "Jeff Garzik",
        "email": "jgarzik@exmulti.com",
        "date": "2012-09-19T02:18:56Z"
      },
      "committer": {
        "name": "Jeff Garzik",
        "email": "jgarzik@redhat.com",
        "date": "2012-09-19T02:18:56Z"
      },
      "message": "P2P: Do not request blocks from peers with fewer blocks than us\n\nIf the remote node has a shorter chain, do not waste our\nspecial getblocks request on them.",
      "tree": {
        "sha": "6ffb665f082da049a2d7be3c3e032ae0dd8496fc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6ffb665f082da049a2d7be3c3e032ae0dd8496fc"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d5d19c74a5f5cbcaad6869dc7d89bd7077b7d175",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d5d19c74a5f5cbcaad6869dc7d89bd7077b7d175",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/d5d19c74a5f5cbcaad6869dc7d89bd7077b7d175",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d5d19c74a5f5cbcaad6869dc7d89bd7077b7d175/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "6cbae37667f504d9ecd6173e1eff817d2b7aaf0c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6cbae37667f504d9ecd6173e1eff817d2b7aaf0c",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/6cbae37667f504d9ecd6173e1eff817d2b7aaf0c"
      }
    ],
    "stats": {
      "total": 1,
      "additions": 1,
      "deletions": 0
    },
    "files": [
      {
        "sha": "989b83de9fc7cf3947f8cb7ba8fb0c7eb2487a47",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d5d19c74a5f5cbcaad6869dc7d89bd7077b7d175/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d5d19c74a5f5cbcaad6869dc7d89bd7077b7d175/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=d5d19c74a5f5cbcaad6869dc7d89bd7077b7d175",
        "patch": "@@ -2513,6 +2513,7 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv)\n         // Ask the first connected node for block updates\n         static int nAskedForBlocks = 0;\n         if (!pfrom->fClient && !pfrom->fOneShot &&\n+            (pfrom->nStartingHeight > nBestHeight) &&\n             (pfrom->nVersion < NOBLKS_VERSION_START ||\n              pfrom->nVersion >= NOBLKS_VERSION_END) &&\n              (nAskedForBlocks < 1 || vNodes.size() <= 1))"
      }
    ]
  },
  {
    "sha": "b23e79938b6aa5bd22389f393abf2d6905df770a",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiMjNlNzk5MzhiNmFhNWJkMjIzODlmMzkzYWJmMmQ2OTA1ZGY3NzBh",
    "commit": {
      "author": {
        "name": "Jeff Garzik",
        "email": "jgarzik@exmulti.com",
        "date": "2012-09-19T17:17:14Z"
      },
      "committer": {
        "name": "Jeff Garzik",
        "email": "jgarzik@redhat.com",
        "date": "2012-09-19T17:17:14Z"
      },
      "message": "P2P: send 'getblocks' to new peers, if the chain has not advanced in a while",
      "tree": {
        "sha": "42c256222cd14a2f4e681827763ce6cc2b6a383f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/42c256222cd14a2f4e681827763ce6cc2b6a383f"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b23e79938b6aa5bd22389f393abf2d6905df770a",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b23e79938b6aa5bd22389f393abf2d6905df770a",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/b23e79938b6aa5bd22389f393abf2d6905df770a",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b23e79938b6aa5bd22389f393abf2d6905df770a/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "d5d19c74a5f5cbcaad6869dc7d89bd7077b7d175",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d5d19c74a5f5cbcaad6869dc7d89bd7077b7d175",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/d5d19c74a5f5cbcaad6869dc7d89bd7077b7d175"
      }
    ],
    "stats": {
      "total": 10,
      "additions": 9,
      "deletions": 1
    },
    "files": [
      {
        "sha": "a8c4e4c95b3053df364ead006c6128f8523c8fbc",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 9,
        "deletions": 1,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/b23e79938b6aa5bd22389f393abf2d6905df770a/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/b23e79938b6aa5bd22389f393abf2d6905df770a/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=b23e79938b6aa5bd22389f393abf2d6905df770a",
        "patch": "@@ -2414,6 +2414,8 @@ unsigned char pchMessageStart[4] = { 0xf9, 0xbe, 0xb4, 0xd9 };\n bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv)\n {\n     static map<CService, CPubKey> mapReuseKey;\n+    static int64 nTimeChainChanged;\n+\n     RandAddSeedPerfmon();\n     if (fDebug)\n         printf(\"received: %s (%d bytes)\\n\", strCommand.c_str(), vRecv.size());\n@@ -2516,7 +2518,8 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv)\n             (pfrom->nStartingHeight > nBestHeight) &&\n             (pfrom->nVersion < NOBLKS_VERSION_START ||\n              pfrom->nVersion >= NOBLKS_VERSION_END) &&\n-             (nAskedForBlocks < 1 || vNodes.size() <= 1))\n+             (nAskedForBlocks < 1 || vNodes.size() <= 1 ||\n+             ((GetTime() - nTimeChainChanged) > (60 * 60))))\n         {\n             nAskedForBlocks++;\n             pfrom->PushGetBlocks(pindexBest, uint256(0));\n@@ -2891,8 +2894,13 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv)\n         CInv inv(MSG_BLOCK, block.GetHash());\n         pfrom->AddInventoryKnown(inv);\n \n+        uint256 hashTmpBest = hashBestChain;\n         if (ProcessBlock(pfrom, &block))\n             mapAlreadyAskedFor.erase(inv);\n+\n+        if (hashTmpBest != hashBestChain)\n+            nTimeChainChanged = GetTime();\n+\n         if (block.nDoS) pfrom->Misbehaving(block.nDoS);\n     }\n "
      }
    ]
  }
]