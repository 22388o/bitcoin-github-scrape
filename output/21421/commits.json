[
  {
    "sha": "7b3434f8002d1a8cf0dbd0a0caef28e783b1efd8",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo3YjM0MzRmODAwMmQxYThjZjBkYmQwYTBjYWVmMjhlNzgzYjFlZmQ4",
    "commit": {
      "author": {
        "name": "fanquake",
        "email": "fanquake@gmail.com",
        "date": "2021-03-12T02:21:21Z"
      },
      "committer": {
        "name": "fanquake",
        "email": "fanquake@gmail.com",
        "date": "2021-03-12T02:21:21Z"
      },
      "message": "build: don't try and use -fstack-clash-protection on Windows\n\nThis has never worked with any of the mingw-w64 compilers we use, and\nthe -O0 is causing issues for builders applying spectre mitigations.\n\nRecent discussion on https://gcc.gnu.org/bugzilla/show_bug.cgi?id=90458\nalso indicates that this should just not be used on Windows.",
      "tree": {
        "sha": "90b33dadbe6658a80d5bcf34fd1885dfb79bfbee",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/90b33dadbe6658a80d5bcf34fd1885dfb79bfbee"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7b3434f8002d1a8cf0dbd0a0caef28e783b1efd8",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEz7FuIclQ9n+pXlWPLuufXMCVJsEFAmBK0JIACgkQLuufXMCV\nJsGEBQ/+KvUEf3QM/AWG1141N78nIda53Yh3ICOcHiyjs6IRdQ+kucsIxeJBW/j+\nOaUi1aqALv97Y66rigy0T2cAzIku20+4CQG+0YEx0QeqNF93kQ0+8HJopVZcO30i\nZ/TiRvJTNllEawgRFRz3987PqNmug8ISz5BINf+/K1qKYT7Pgk1HWfNTBr7f3gnt\nU0ihruitk3K0rtL5Ol+2qvNlLuBFEyeSwRoclAey3AyE3grggmBPnXzXmw5BhRov\nUw6l+MEmXphTOPbYadNDOBrrFlttUPiM6NJdCzGAHSTxhmVoL6z2G0xeaJ2unyk1\neD1cg25WEA3IH2N3yrreAO1bv/zPXjCvJIg0/E6C7YHRCMD5j1DRW7/4d9bYPMPP\nekBHfESU2u2JOPetILYS9d+CG9If693pdPLa3B3uBVRDl7v5H53NvMN67+dZZ4jv\naFSx8esyda91hodkmWHovJdqzxv40XWZU/6msKbxpWOh/3T+hkf1o8h1UXAwoNza\n0abteDjcsdPRqF0v+1r7HW611K15FS3PNuWhWgW+oQ2doGrRuYAdlsVKFms6XvH1\n5x/YwFv6Tp+keC9QBjGLFXCLPjGJVmdYr58Cvn0S/CI73oCiG5tP8KdG/T3Kv08/\nTMdbtrmZBrukiGtQ+r7qgk3yXfiGP7M3hbfW7tQ+WWSxAnblHfQ=\n=tsYH\n-----END PGP SIGNATURE-----",
        "payload": "tree 90b33dadbe6658a80d5bcf34fd1885dfb79bfbee\nparent b972913c330a46811e26221490d3ee042529dfb9\nauthor fanquake <fanquake@gmail.com> 1615515681 +0800\ncommitter fanquake <fanquake@gmail.com> 1615515681 +0800\n\nbuild: don't try and use -fstack-clash-protection on Windows\n\nThis has never worked with any of the mingw-w64 compilers we use, and\nthe -O0 is causing issues for builders applying spectre mitigations.\n\nRecent discussion on https://gcc.gnu.org/bugzilla/show_bug.cgi?id=90458\nalso indicates that this should just not be used on Windows.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7b3434f8002d1a8cf0dbd0a0caef28e783b1efd8",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/7b3434f8002d1a8cf0dbd0a0caef28e783b1efd8",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7b3434f8002d1a8cf0dbd0a0caef28e783b1efd8/comments",
    "author": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "b972913c330a46811e26221490d3ee042529dfb9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b972913c330a46811e26221490d3ee042529dfb9",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/b972913c330a46811e26221490d3ee042529dfb9"
      }
    ],
    "stats": {
      "total": 15,
      "additions": 10,
      "deletions": 5
    },
    "files": [
      {
        "sha": "6815cefdbb55cbf691a9b12a2ecbff00e8ad6a04",
        "filename": "configure.ac",
        "status": "modified",
        "additions": 10,
        "deletions": 5,
        "changes": 15,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7b3434f8002d1a8cf0dbd0a0caef28e783b1efd8/configure.ac",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7b3434f8002d1a8cf0dbd0a0caef28e783b1efd8/configure.ac",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/configure.ac?ref=7b3434f8002d1a8cf0dbd0a0caef28e783b1efd8",
        "patch": "@@ -866,11 +866,16 @@ if test x$use_hardening != xno; then\n   dnl Use CHECK_LINK_FLAG & --fatal-warnings to ensure we won't use the flag in this case.\n   AX_CHECK_LINK_FLAG([-fcf-protection=full],[HARDENED_CXXFLAGS=\"$HARDENED_CXXFLAGS -fcf-protection=full\"],, [[$LDFLAG_WERROR]])\n \n-  dnl stack-clash-protection does not work properly when building for Windows.\n-  dnl We use the test case from https://gcc.gnu.org/bugzilla/show_bug.cgi?id=90458\n-  dnl to determine if it can be enabled.\n-  AX_CHECK_COMPILE_FLAG([-fstack-clash-protection],[HARDENED_CXXFLAGS=\"$HARDENED_CXXFLAGS -fstack-clash-protection\"],[],[\"-O0\"],\n-    [AC_LANG_SOURCE([[class D {public: unsigned char buf[32768];}; int main() {D d; return 0;}]])])\n+  case $host in\n+    *mingw*)\n+      dnl stack-clash-protection doesn't currently work, and likely should just be skipped for Windows.\n+      dnl See https://gcc.gnu.org/bugzilla/show_bug.cgi?id=90458 for more details.\n+      ;;\n+    *)\n+      AX_CHECK_COMPILE_FLAG([-fstack-clash-protection],[HARDENED_CXXFLAGS=\"$HARDENED_CXXFLAGS -fstack-clash-protection\"])\n+      ;;\n+  esac\n+\n \n   dnl When enable_debug is yes, all optimizations are disabled.\n   dnl However, FORTIFY_SOURCE requires that there is some level of optimization, otherwise it does nothing and just creates a compiler warning."
      }
    ]
  }
]