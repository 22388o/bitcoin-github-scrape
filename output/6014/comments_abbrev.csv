sipa,2015-04-15T04:40:41Z,"Have you measured that this improves your propagation time more than just\nconnecting to a few fast peers? By the time you have sent out your block to\n100 well-connected peers, the last ones to get it likely could have already\ngotten it from eachother faster than from you, as more fast peers means you\nsuddenly need to do a lot more work to keep up with the sudden burst of\nnetwork packets to br",https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93185470,93185470,
jameshilliard,2015-04-15T05:13:10Z,"Pool servers typically are run from datacenter grade gigabit connections or better so I don't think bandwidth is that big of an issue most of the time. My pool server with nearly 6000 active miner connections is normally running at under 5% CPU usage total for all applications at nearly any time, this includes bitcoind, stratum server, database, web front end and relay node. I don't really see wha",https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93191485,93191485,
laanwj,2015-04-15T08:08:54Z,"Making it easily possible to increase the default outgoing connections above 8 would put undue load on the network. See the discussion in #4687 as well as many previous discussions.\n\nIf you want lots of connections, raise the maximum number of incoming connections instead. I have no trouble on my longer running nodes to get lots of incoming connections. ""NAT restricted"" doesn't change much, I'd ",https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93253349,93253349,
jameshilliard,2015-04-15T08:35:20Z,Would it really cause an issue if it was only pool servers that were increasing this limit? It seems this option can be beneficial to pool operators but its not being considered because nobody trusts the users. I'm not a fan of crippling software because someone _might_ abuse a feature. The comment in that discussion is only talking about regular users and regular nodes and doesn't seem apply to t,https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93261239,93261239,
sipa,2015-04-15T10:14:42Z,"bitcoind's network code can deal with around 1000 connections, due to the file descriptor limits of select().\n",https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93303190,93303190,
laanwj,2015-04-15T11:43:15Z,"The reason for the default restriction of 125 is to \n- cope with shitty routers that crash with lots of connections\n- bound the memory usage; every active connection will have send/receive buffers and some other associated data\n\nIf these are not concerns for you, you can increase the number of incoming connections up to the select limit (as @sipa mentions).\n",https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93344202,93344202,
laanwj,2015-04-15T11:46:50Z,"Anyhow, if you trust yourself enough to not abuse this feature you can remove the cap in your local builds. This is open source and there's nothing 'we' can do to prevent you from that (although there are some ideas with regard to banning mass connectors*) . But this can not be merged unless you cap the maximum to 8.\n\n*: not because of you, but the other, malicious use case for mass connecting a",https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93346755,93346755,
jameshilliard,2015-04-15T22:35:50Z,"@sipa it is common for pool servers and other servers with lots of connections to override the OS file descriptor limitation, maybe moving to something libevent based for networking would help scalability.\n\n@laanwj so that more or less explains why 125 is set as the default for inbound but I have yet to hear where the number 8 comes from and why it is hard coded.\n\nOne other use case may be for",https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93588268,93588268,
TheBlueMatt,2015-04-15T23:10:39Z,"There was a long discussion on IRC yesterday about why its probably bad even for a pool server to increase the limit significantly. I'm assuming that was you? If not, you should go read it. http://bitcoinstats.com/irc/bitcoin-dev/logs/2015/04/14#l1429040973\n",https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93593735,93593735,
jameshilliard,2015-04-15T23:14:12Z,"@TheBlueMatt Yes that was me, how would you go about calculating the ideal number of connections a pool server should make in cases where manually establishing connections to trusted nodes is not possible?\n",https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93594599,93594599,
TheBlueMatt,2015-04-15T23:19:17Z,"A pool server should run its mining bitcoind behind a firewall with only connections to other bitcoinds, which are making 8 outgoing connections and accepting other connections, as well as a connection to the relay network (and maybe other similar networks...if someone set them up). But, really, this is not the place to discuss pool architecture.\n",https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93595340,93595340,
jameshilliard,2015-04-16T00:12:36Z,@TheBlueMatt In areas with poor internet connectivity such as China where mining sites and operators aren't able to reliably set up their own offsite nodes I think a better solution such as this is often needed. The outbound connection limit of 8 just seems very arbitrary. Your suggestion of running multiple nodes seems to itself be a workaround to getting more than 8 outbound connections to the b,https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93603754,93603754,
gmaxwell,2015-04-16T23:38:14Z,"NAK.\n\nIncreasing the connection count in abusive to the network, it consumes third party resources and without actual reason.  Measurements I performed with p2pool users about a year an a half ago or so showed that cranking the outbound count also _increased_ the propagation time.  (But even if it did decrease it, it wouldn't hold a candle to the improvement from simply better relay systems such",https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93862664,93862664,
jameshilliard,2015-04-17T00:43:04Z,"@gmaxwell I don't really see why increasing outbound connections would increase propagation time unless some sort of resource was being constrained such as CPU RAM, disk IO or network capacity, unless their was some sort of flaw or scalability limitation in the networking code.\n\nThis would seem to only be an issue if there were flaws in bitcoind's networking code more than anything, if someone i",https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93869372,93869372,
sipa,2015-04-17T08:54:38Z,"Even with a 10 Gbit/s connection, when serving 100 connections, at least\none of them will only receive a 1 Mbyte block after 100ms (because it takes\nthat long to pump 100*1 Mbyte through your line). In 100 milliseconds, the\nfirst of your peers could already have relayed it to a dozen peers.\n\nThat's under perfect conditions, where there is no software and operating\nsystem overhead from the su",https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93946854,93946854,
jameshilliard,2015-04-17T09:45:28Z,@sipa In your calculation you are ignoring a lot of real world factors. First of which is that receiving 1 Mbyte of data over 100ms requires a connection with a minimum of about 80 megabits a seconds of bandwidth which the vast majority of connected peers will not have. In addition most of those peers will probably be on residential grade connections where their upload speed is generally significa,https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93954142,93954142,
sipa,2015-04-17T10:01:53Z,"I understand your reasoning, and I agree that in theory, the network topology could be improved by having nodes with better connectivity connect to more nodes (which they already do) and peer preferentially with eachother (which you also already can do, with -addnode). With my numbers I tried to show that there are cases where you're better off relaying to fewer peers; I agree they're overly simpl",https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93956897,93956897,
jameshilliard,2015-04-17T10:33:37Z,@sipa One major issue with the block relay network right now I think is China and their unreliable network topography where you sometimes have to rely exclusively on bitcoind's ability to establish connections automatically. While efforts like IBLT and other similar optimizations may help I think they are just delaying a lot of needed improvements in bitcoind's core p2p networking code. \n\nThe C1,https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93961370,93961370,
gmaxwell,2015-04-17T11:06:56Z,">  I think they are just delaying\n\nWhat is the basis of this belief?\n\n> I'm also really weary of maintaining my own fork of bitcoind\n\nYou should be-- your patch is incomplete.\n\n> One major issue with the block relay network right now I think is China \n\nWhat is the basis of this belief?\n\n> have to rely exclusively on bitcoind's ability to establish connections\n\nNo, they're not limited",https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93965836,93965836,
sipa,2015-04-17T11:29:29Z,"> I think they are just delaying\n\nSee #5307, #5971, #5941, #5976, #5875, #5989, #5820, #5662, #4468 for P2P improvements in the past few months.\n",https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93968850,93968850,
jameshilliard,2015-04-17T11:29:34Z,"> What is the basis of this belief?\n\nThe outbound connection limit hasn't been change from 8 for years and there doesn't seem to have much progress towards enabling nodes to support very large amounts of connections, I think this would be a better area to focus effort rather than just trying to block nodes that establish many connections.\n\n> You should be-- your patch is incomplete.\n\nThis is",https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93968860,93968860,
jameshilliard,2015-04-17T11:35:18Z,"> See #5307, #5971, #5941, #5976, #5875, #5989, #5820, #5662, #4468 for P2P improvements in the past few months.\n\nI meant more along the lines of connection count scalability rather than the protocol scalability improvements.\n",https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93969491,93969491,
sipa,2015-04-17T11:37:29Z,"You keep arguing that the way to optimize propagation is by having more connections. No, we are not working on increasing that, or being able to increase that, because we don't believe it matters in practice - or may matters worse (increase misunderstanding, risk people believing they help while hurting, increase wasted bandwidth and connections).\n\nThere is a lot of work being done to optimize p",https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93969731,93969731,
gmaxwell,2015-04-17T11:41:31Z,"> The outbound connection limit hasn't been change from 8 for years\n\nIncreasing it is undesirable. Doing so would harm throughput, capacity, and cost of the network without any corresponding improvement. The connection count is necessary to reduce the probability of partitioning; which is exponentially related to the count.\n\n> The firewall can be unpredictable \n\nSo you have no basis for your",https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93970259,93970259,
jameshilliard,2015-04-17T11:41:41Z,"> You keep arguing that the way to optimize propagation is by having more connections. No, we are not working on increasing that, or being able to increase that, because we don't believe it matters in practice at this point.\n> \n> There is a lot of work being done to optimize propagation, which does not rely on blowing up resource usage (I consider available network connections as a resource).\n\",https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93970297,93970297,
gmaxwell,2015-04-17T11:44:40Z,"> I don't think its a good idea to completely ignore connection count scalability. Each can benefit the other.\n\nLet me try repeating this with different but technically accurate language.\n\n""I think its a good idea for every link in the network to repeat the same network, so that each peer ends up with as many redundantly transmitted copies as they have connections, and have every peer maintain",https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93970577,93970577,
jameshilliard,2015-04-17T11:57:46Z,"> Let me try repeating this with different but technically accurate language.\n> \n> ""I think its a good idea for every link in the network to repeat the same network, so that each peer ends up with as many redundantly transmitted copies as they have connections, and have every peer maintain a TCP connection to every other, so the whole network has N^2 traffic; and I expect the increase of traffic",https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93972369,93972369,
sipa,2015-04-17T12:22:16Z,"> > I'm not aware of any comparable with similar requirements or mechanisms.\n> > Systems like bittorrent and other file transfer protocols generally don't duplicate data transmissions. \n\nBittorrent is not a flood network, and does not have latency reduction as a goal.\n\nBlock propagation in Bitcoin must reach every node, and must minimize the time to reach a majority. That means that there is ",https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93975453,93975453,
jameshilliard,2015-04-17T16:58:31Z,"@sipa I'm guessing Invs can be considered negligible resource wise since they are just message advertizements, at least in the case of a block announcement where all of them should be roughly uniform. From working with stratum servers it seems there are very little system or network resources needed to transmit small messages if they are all coming from the same in memory data source as it has bee",https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-94027096,94027096,
laanwj,2015-04-24T14:39:27Z,Closing this; there is clear consensus that increasing the number of outgoing connections beyond 8 is not a good idea and should not be supported without patching the code.\n,https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-95951059,95951059,
