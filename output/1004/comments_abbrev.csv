sipa,2012-03-28T22:39:19Z,"Have you tested that this actually works? I've been playing for a few hours now with DB_LOG_REMOVE, DB_LOG_AUTO_REMOVE, closing all db files occasionally, checkpoinging, flushing, stopping and restarting DbEnv, ... but all I've seen are a lot of unexplainable segfauls, and not a single deleted logfile.\n\nEDIT: apparently it does. I'm baffled.\n",https://github.com/bitcoin/bitcoin/pull/1004#issuecomment-4793143,4793143,
gavinandresen,2012-03-28T22:59:10Z,"Nice!  I'm baffled, too.\n\nI don't think this should be a command-line option, though:  I think it should just happen, I can't think of any reason to keep gigabytes of logs around.\n",https://github.com/bitcoin/bitcoin/pull/1004#issuecomment-4793449,4793449,
dooglus,2012-03-28T23:01:55Z,"@sipa: I tested it a lot before making the pull request, yes.  It seems to work well in db5.1.25.  I don't have db4.x.\n\n@gavinandresen: I think the logs are so you can do database recovery in the event of a crash.\n\nIt seems that in the event of a crash we usually manage to clean up the logs before exiting however :)\n\nI'll update my patch so it's not a command line option.\n",https://github.com/bitcoin/bitcoin/pull/1004#issuecomment-4793503,4793503,
sipa,2012-03-28T23:45:05Z,"I'm testing a bit more extensive patch that counts the number of transactions updated or time since last flush as condition for flushing (instead of 5000 blocks), plus a few other changes. I'm benchmarking now.\n\nThanks for showing this was possible at all - I had almost given up (seems there was a bug in my load-blocks-from-file patch that didn't call txn_checkpoint at all, which prevented log c",https://github.com/bitcoin/bitcoin/pull/1004#issuecomment-4794055,4794055,
dooglus,2012-03-29T00:33:56Z,No problem.  I don't care what triggers the deletion so long as it's done occasionally.\n\nTo arrange for rapid blockchain downloading to test this I've been using a second computer on the same LAN with a complete copy of the blockchain and connecting only to it.\n,https://github.com/bitcoin/bitcoin/pull/1004#issuecomment-4794543,4794543,
sipa,2012-03-29T00:43:13Z,"Ok, one full load of the blockchain up to 172000 (from a local file) completed in 35 minutes. That's a few minutes slower than a previous benchmark, but it never needed more than 12 log files (of 10 MiB again). This did a log flush every 200k transactions (which was every 0.5-2 minutes). I'll post the code tomorrow.\n",https://github.com/bitcoin/bitcoin/pull/1004#issuecomment-4794642,4794642,
dooglus,2012-03-29T00:44:54Z,How much of that was spent loading the blocks 168000 to 172000?  The last checkpoint being at 168k makes the last 4k blocks so much slower to load.\n\nHow about adding a new checkpoint before the release of 0.6.0?\n,https://github.com/bitcoin/bitcoin/pull/1004#issuecomment-4794662,4794662,
gavinandresen,2012-03-29T01:59:24Z,"grrr...\n\nSo after WASTING time testing dbenv.set_flags(DB_LOG_AUTO_REMOVE, 1) this afternoon, I discover the correct call is actually log_set_config:\n\ndbenv.log_set_config(DB_LOG_AUTO_REMOVE, 1);\n\nTesting with a 10MB logfile size and the logs are automatically being cleaned up as the blockchain is downloading.\n\n(the set_flags call didn't trigger an error or warning because LOG_AUTO_REMOVE ",https://github.com/bitcoin/bitcoin/pull/1004#issuecomment-4795300,4795300,
sipa,2012-03-29T11:35:18Z,"So there are three options now: a) remove logs at given points b) flush + remove logs at given points c) use auto remove.\n\nI wonder if there is any danger in using auto remove (meaning logs will be removed while transactions/databases are open). I suppose not.\n\nGavin, how many log files were present at most at one given time during the block chain download?\n",https://github.com/bitcoin/bitcoin/pull/1004#issuecomment-4809925,4809925,
gavinandresen,2012-03-29T12:29:45Z,The most log files present at one given time with LOG_AUTO_REMOVE and 10M logfiles was 5.\n\nTypical is 2.\n\nRaw data (ls -l in the database/ dir run every 2 minutes): https://gist.github.com/2236954\n,https://github.com/bitcoin/bitcoin/pull/1004#issuecomment-4813463,4813463,
gavinandresen,2012-03-29T17:25:55Z,"Thanks for the help Chris-- without this pull I think we would have given up hope of finding a good solution.  But I'm going to close, because using AUTO_REMOVE (properly) is fewer lines of code.\n",https://github.com/bitcoin/bitcoin/pull/1004#issuecomment-4826441,4826441,
