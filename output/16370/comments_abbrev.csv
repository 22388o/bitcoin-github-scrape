Sjors,2019-07-11 13:26:05,"Less is more :-) I'm able to build and run QT on macOS 10.14.5 with 9a3e237. `test/functional/interface_zmq.py` passes.\n\nExplicitly passing all `--without` flags seems like a good idea; it means we don't to worry about the upstream default changing and it's also easier to reason about.",https://github.com/bitcoin/bitcoin/pull/16370#issuecomment-510484367,510484367,
dongcarl,2019-07-12 18:37:54,"Concept ACK. Looking at the DrahtBot logs, `xproto` and `xextproto` are both headers-only, so let's remove `--disable-shared` from them!\n\nI think we should explicitly pass all `--without` flags... Silent behavioral changes are the worst kind.",https://github.com/bitcoin/bitcoin/pull/16370#issuecomment-510990303,510990303,
practicalswift,2019-07-13 16:12:56,"Concept ACK\n\nCompilation times before and after would be interesting to see.\n\nNice cleanup regardless of compilation time impact though.",https://github.com/bitcoin/bitcoin/pull/16370#issuecomment-511134146,511134146,
DrahtBot,2019-07-18 00:41:27,<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.,https://github.com/bitcoin/bitcoin/pull/16370#issuecomment-512620045,512620045,
fanquake,2019-07-23 07:15:03,Rebased for #16408.,https://github.com/bitcoin/bitcoin/pull/16370#issuecomment-514084745,514084745,
dongcarl,2019-07-23 17:52:38,"Thinking a little harder about our policy w/re configure flags here... I believe that our approach with these cleanups should be to explicitly disable as many features and packages as possible without changing Bitcoin Core's functionality.\n\nGoing forward, we can keep our builds sane by simply requiring (at review time) a diff of the `configure --help` output for every package version bump. We ",https://github.com/bitcoin/bitcoin/pull/16370#issuecomment-514315845,514315845,
theuni,2019-07-23 18:04:17,"@dongcarl I agree with the spirit of that idea, but I don't think we should actually attempt to automate or codify.\n\nWe need to be a little more surgical about this, imo. Remember that buildsystems are imperfect. An explicit ""--without-foo"" may accidentally produce a different result from an auto-detected missing ""foo"". The most obvious example of this would be configuring Core with an explici",https://github.com/bitcoin/bitcoin/pull/16370#issuecomment-514320072,514320072,
fanquake,2019-07-24 06:19:22,"> tl;dr: Concept ACK, but let's not go around flipping every switch we can find indiscriminately. Will review.\n\nFair call. I've made some of the changes suggested by Carl above, and left some comments inline. I'll leave this until you've done a first pass review.\n\n> Showing a diff of configure --help as part of a depends PR couldn't possibly be a bad thing!\n\nI think configure diffs are",https://github.com/bitcoin/bitcoin/pull/16370#issuecomment-514496322,514496322,
laanwj,2019-08-01 13:00:13,Concept ACK,https://github.com/bitcoin/bitcoin/pull/16370#issuecomment-517277046,517277046,
fanquake,2019-08-02 01:27:50,"I've opened [1 more PR](https://github.com/bitcoin-core/bitcoin-maintainer-tools/pull/24) to the maintainer-tools repo that ensures we get deterministic `bitcoin-qt` builds.\n\n> Disabling this (the current default) sounds like a safety downgrade...\n\nI agree, and have now removed that change.\n\nPassing `--with-militant` to zmqs `./configure` (the default) defines `ZMQ_ACT_MILITANT`. Looki",https://github.com/bitcoin/bitcoin/pull/16370#issuecomment-517513058,517513058,
DrahtBot,2019-08-14 12:09:14,<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase,https://github.com/bitcoin/bitcoin/pull/16370#issuecomment-521219521,521219521,
fanquake,2019-08-14 12:36:01,Rebased for #16533.,https://github.com/bitcoin/bitcoin/pull/16370#issuecomment-521227725,521227725,
dongcarl,2019-08-14 19:00:35,"@fanquake So the patchset as it stands right now does not change add the `--with-militant` flag, and thus the `build-for-compare.py` results are identical? I think this is merge-able, and we should deal with `--with-militant` in another PR/issue.",https://github.com/bitcoin/bitcoin/pull/16370#issuecomment-521375429,521375429,
fanquake,2019-08-15 09:57:19,"@dongcarl Yes I'm seeing identical results. \n\nI've just done another [build-for-compare](https://github.com/bitcoin-core/bitcoin-maintainer-tools/blob/master/build-for-compare.py) using the following (inside a Buster Docker container):\n```bash\ngit fetch upstream pull/16370/head:16370 && git checkout 16370\n\n# build depends for c295cba5a2f934e51a7c8610ab4c58b8e9d56619\ncd depends\nRAPI",https://github.com/bitcoin/bitcoin/pull/16370#issuecomment-521587620,521587620,
DrahtBot,2019-08-16 18:29:08,<!--a722867cd34abeea1fadc8d60700f111-->\nGitian builds for commit a7aa809027633556dd3280c6e29ca98eb3235a3d (master):\n * `d6c6331d5bb8779b29ede40450e09c93...` [bitcoin-0.18.99-aarch64-linux-gnu-debug.tar.gz](https://drahtbot.space/gitian/bitcoin/bitcoin/a7aa809027633556dd3280c6e29ca98eb3235a3d/bitcoin-0.18.99-aarch64-linux-gnu-debug.tar.gz)\n * `9d0aeb3a183854db1894c148684a2967...` [bitcoin-0.18.9,https://github.com/bitcoin/bitcoin/pull/16370#issuecomment-522107475,522107475,
dongcarl,2019-08-20 17:36:36,ACK c295cba5a2f934e51a7c8610ab4c58b8e9d56619,https://github.com/bitcoin/bitcoin/pull/16370#issuecomment-523118532,523118532,
Sjors,2019-08-20 19:07:13,c295cba still builds for me on macOS.,https://github.com/bitcoin/bitcoin/pull/16370#issuecomment-523153615,523153615,
meshcollider,2019-08-24 02:44:25,"Looks good to me, since dongcarl and theuni have both reviewed and the gitian build looks fine",https://github.com/bitcoin/bitcoin/pull/16370#issuecomment-524510065,524510065,
dongcarl,2019-07-23 15:32:21,"After inspecting the autoconf files, it seems that iconv is currently disabled and should probably be in the future as well. \n```suggestion\n  $(package)_config_opts=--disable-docs --disable-static --disable-libxml2 --disable-iconv\n```",https://github.com/bitcoin/bitcoin/pull/16370#discussion_r306387707,306387707,depends/packages/fontconfig.mk
dongcarl,2019-07-23 16:03:43,"```suggestion\n$(package)_config_opts=--disable-shared --without-tools --without-tests --disable-sdltest --disable-gprof --disable-gcov --disable-mudflap --without-libiconv-prefix\n```",https://github.com/bitcoin/bitcoin/pull/16370#discussion_r306404016,306404016,depends/packages/qrencode.mk
dongcarl,2019-07-23 17:11:30,"We can add: `--disable-libunwind` `--disable-radix-tree` `--without-gcov` `--without-militant`\n\n",https://github.com/bitcoin/bitcoin/pull/16370#discussion_r306434012,306434012,depends/packages/zeromq.mk
dongcarl,2019-07-23 17:27:45,Nit: Took a look at `--disable-xthreads` in the autoconf files... It seems that it's currently enabled. I'm not sure what the impact is of disabling it so we'll leave it for now.,https://github.com/bitcoin/bitcoin/pull/16370#discussion_r306441076,306441076,depends/packages/libXau.mk
dongcarl,2019-07-23 17:30:11,"This is a candidate for another issue... It seems that we build all of the default XCB Extensions, but the `-qt-xcb` option we supply to QT might cause it to build them as well. (source: https://doc.qt.io/qt-5.9/linux-requirements.html)",https://github.com/bitcoin/bitcoin/pull/16370#discussion_r306442184,306442184,depends/packages/libxcb.mk
dongcarl,2019-07-23 17:34:08,"Nit: Looking at https://gist.github.com/dongcarl/892d7deda8da3ff72317009ecbb07ffb#file-xproto-configure-help-L80-L90, I'm not sure what the specs and prototypes are... If anyone else knows please say so, otherwise we can leave it.",https://github.com/bitcoin/bitcoin/pull/16370#discussion_r306443891,306443891,depends/packages/xproto.mk
dongcarl,2019-07-23 17:41:39,"Looking at https://gist.github.com/dongcarl/892d7deda8da3ff72317009ecbb07ffb#file-zeromq-configure-help-L114-L120, I'm reminded that after we're able to use Guix for release builds, we will finally be able to, and definitely should specify what the minimal kernel headers are that we target for each architecture. We don't want to target kernel headers that are too new, have the zeromq build auto-as",https://github.com/bitcoin/bitcoin/pull/16370#discussion_r306447252,306447252,depends/packages/zeromq.mk
fanquake,2019-07-24 05:57:10,Done.,https://github.com/bitcoin/bitcoin/pull/16370#discussion_r306637652,306637652,depends/packages/fontconfig.mk
fanquake,2019-07-24 05:58:16,"Did you want to add a comment here somewhere, even just as a reminder in future if this package is updated / defaults change etc.",https://github.com/bitcoin/bitcoin/pull/16370#discussion_r306637877,306637877,depends/packages/libXau.mk
fanquake,2019-07-24 05:59:36,Done.,https://github.com/bitcoin/bitcoin/pull/16370#discussion_r306638146,306638146,depends/packages/qrencode.mk
fanquake,2019-07-24 05:59:43,Done.,https://github.com/bitcoin/bitcoin/pull/16370#discussion_r306638174,306638174,depends/packages/zeromq.mk
fanquake,2019-07-24 06:04:23,"From the looks of this [mailing list post](https://lists.x.org/archives/xorg-announce/2010-February/001249.html) they are probably related to documentation generation?\n\n> Document building enablement macros. This allows a builder to skip\ndocument generation if such documents are not desired. They should not\nbe used to workaround tooling issues, use macros above. By default,\nbuilding is e",https://github.com/bitcoin/bitcoin/pull/16370#discussion_r306639168,306639168,depends/packages/xproto.mk
fanquake,2019-07-24 06:07:08,Opened an issue to track that: https://github.com/bitcoin/bitcoin/issues/16447,https://github.com/bitcoin/bitcoin/pull/16370#discussion_r306639823,306639823,depends/packages/libxcb.mk
fanquake,2019-07-24 06:10:50,"Is this something you'd like to document here, or should we start tracking future Guix related improvements somewhere else? Depends how much there is to keep track of.",https://github.com/bitcoin/bitcoin/pull/16370#discussion_r306640757,306640757,depends/packages/zeromq.mk
dongcarl,2019-07-30 15:14:42,Yeah a comment would be great for the future!,https://github.com/bitcoin/bitcoin/pull/16370#discussion_r308782507,308782507,depends/packages/libXau.mk
dongcarl,2019-07-30 17:51:49,Tracked https://github.com/bitcoin/bitcoin/issues/16496,https://github.com/bitcoin/bitcoin/pull/16370#discussion_r308857261,308857261,depends/packages/zeromq.mk
dongcarl,2019-07-30 17:52:47,"Let's just do `--disable-specs`, I was able to successfully do a guix build even with `--disable-specs`. You can put a comment there for the other flags or don't, either way is fine :-)",https://github.com/bitcoin/bitcoin/pull/16370#discussion_r308857743,308857743,depends/packages/xproto.mk
fanquake,2019-07-31 07:13:00,Added a comment.,https://github.com/bitcoin/bitcoin/pull/16370#discussion_r309068384,309068384,depends/packages/libXau.mk
fanquake,2019-07-31 07:13:34,Updated with `--disable-specs`.,https://github.com/bitcoin/bitcoin/pull/16370#discussion_r309068574,309068574,depends/packages/xproto.mk
theuni,2019-07-31 20:43:38,Looks like we should set --without-launchd as well.,https://github.com/bitcoin/bitcoin/pull/16370#discussion_r309423063,309423063,depends/packages/libxcb.mk
theuni,2019-07-31 20:49:05,"Let's not mix --without-libiconv-prefix into these changes, that's just related to its search path.\niconv is only used for the tests (which aren't compiled) anyway.",https://github.com/bitcoin/bitcoin/pull/16370#discussion_r309425311,309425311,depends/packages/qrencode.mk
theuni,2019-07-31 20:51:58,"Doesn't this install generated spec files? If so, does libXau not need them?",https://github.com/bitcoin/bitcoin/pull/16370#discussion_r309426429,309426429,depends/packages/xproto.mk
theuni,2019-07-31 20:58:58,"```\n--with-militant         enable militant API assertions\n```\nDisabling this (the current default) sounds like a safety downgrade...",https://github.com/bitcoin/bitcoin/pull/16370#discussion_r309429251,309429251,depends/packages/zeromq.mk
fanquake,2019-08-01 03:02:25,"Updated with `--without-launchd`. Docs are:\n```bash\n--with-launchd Build with support for Apple's launchd (default: auto)\n```",https://github.com/bitcoin/bitcoin/pull/16370#discussion_r309507053,309507053,depends/packages/libxcb.mk
fanquake,2019-08-01 03:04:51,"Updated to remove `--without-libiconv-prefix`. Docs:\n```bash\n--with-libiconv-prefix[=DIR]  search for libiconv in DIR/include and DIR/lib\n```",https://github.com/bitcoin/bitcoin/pull/16370#discussion_r309507363,309507363,depends/packages/qrencode.mk
