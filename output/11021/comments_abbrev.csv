promag,2017-08-12T08:49:21Z,Can you improve the test in `bitcoin/test/functional/blockchain.py`?,https://github.com/bitcoin/bitcoin/pull/11021#issuecomment-321967117,321967117,
AkioNak,2017-08-13T14:56:23Z,"Yes, I will add some tests in `bitcoin/test/functional/blockchain.py`.",https://github.com/bitcoin/bitcoin/pull/11021#issuecomment-322046974,322046974,
AkioNak,2017-08-14T07:56:40Z,@promag I avoided the error about low blockheight and added some tests.,https://github.com/bitcoin/bitcoin/pull/11021#issuecomment-322123577,322123577,
AkioNak,2017-08-15T01:43:17Z,"@promag \nI think these convenient commands is more useful that if they avoid errors. \n\n> IMO throw `JSONRPCError(RPC_INVALID_PARAMETER, ""Invalid block count: should be between 1 and the block's height - 1"")` should be only for < 1case. \n\nWhen blockheight = 1, nblocks = 1 does not satisfy this condition. (blockheight> = 2 is required)\nSo, if we need throw JSONRPCError, I think it would ",https://github.com/bitcoin/bitcoin/pull/11021#issuecomment-322354632,322354632,
jnewbery,2017-08-16T13:28:43Z,"I also recommend that you update the commit messages to be a bit more meaningful. I don't think this project has commit message style rules, but there are some general tips here: https://chris.beams.io/posts/git-commit/",https://github.com/bitcoin/bitcoin/pull/11021#issuecomment-322770802,322770802,
AkioNak,2017-08-16T14:25:31Z,@jnewbery Thank you for your suggestion. I agree with them.,https://github.com/bitcoin/bitcoin/pull/11021#issuecomment-322788583,322788583,
promag,2017-08-16T15:15:56Z,"BTW, if `nTimeDiff` is zero then `pindexPast` and `pindex` are the same? If so `nTxDiff` is also zero then `txrate` should be zero too?",https://github.com/bitcoin/bitcoin/pull/11021#issuecomment-322805330,322805330,
AkioNak,2017-08-16T15:32:41Z,"@promag No. Even if `time_diff` is zero, `pindexPast` and `pindex` may be different.\n(For example, `generates 100` on regtest)\nBecause `GetMedianTimePast()` returns mediantime of last 11 block's time (except the block itself),\n",https://github.com/bitcoin/bitcoin/pull/11021#issuecomment-322810311,322810311,
promag,2017-08-16T15:46:30Z,"IMO the response could have both values `txratecount` and `txrateinterval`.\n  ",https://github.com/bitcoin/bitcoin/pull/11021#issuecomment-322814456,322814456,
AkioNak,2017-08-16T16:19:38Z,"@promag  In the edge case (block height <2), since there is no comparison target, its values are both zero. If that is OK then I will add it.",https://github.com/bitcoin/bitcoin/pull/11021#issuecomment-322824251,322824251,
AkioNak,2017-08-16T17:24:50Z,"@jnewbery I have just done followings.\n\n- Add `""block_count""` element to return object.\n- Not to return `""txrate""` if `nTimeDiff` is zero.\n- Rename variable `time_diff`.\n- Fix commit comment.",https://github.com/bitcoin/bitcoin/pull/11021#issuecomment-322841894,322841894,
AkioNak,2017-08-18T16:48:12Z,"@sipa @jnewbery I fixed what `""block_count""` indicates and its description.",https://github.com/bitcoin/bitcoin/pull/11021#issuecomment-323404408,323404408,
AkioNak,2017-08-22T02:00:14Z,@promag I added  both `txratecount` and `txrateinterval` to the return object.,https://github.com/bitcoin/bitcoin/pull/11021#issuecomment-323898182,323898182,
AkioNak,2017-08-23T11:10:27Z,I resolved the conflicts.,https://github.com/bitcoin/bitcoin/pull/11021#issuecomment-324297284,324297284,
AkioNak,2017-08-24T12:03:23Z,@jnewbery Thank you for your various suggestion. I accepted with them and squashed commits for file by file.,https://github.com/bitcoin/bitcoin/pull/11021#issuecomment-324615808,324615808,
jnewbery,2017-08-24T14:05:39Z,@AkioNak thanks for sticking with this. Looks really good now. Just a few more nits.,https://github.com/bitcoin/bitcoin/pull/11021#issuecomment-324645145,324645145,
AkioNak,2017-08-25T10:32:04Z,"@promag @jnewbery @kallewoof I fixed followings.\n1. add unit(seconds) to the help text of `window_interval`.\n2. calculate `blockcount` using `std::max()` rather than if-clause.  ",https://github.com/bitcoin/bitcoin/pull/11021#issuecomment-324881979,324881979,
jnewbery,2017-08-25T18:11:39Z,Looks good to me! tested ACK 07704c1b3768d6c290046c783063644fc7b7d1da.,https://github.com/bitcoin/bitcoin/pull/11021#issuecomment-324997790,324997790,
TheBlueMatt,2017-10-03T22:48:52Z,Postumous utACK non-test parts of 07704c1b3768d6c290046c783063644fc7b7d1da,https://github.com/bitcoin/bitcoin/pull/11021#issuecomment-334001376,334001376,
promag,2017-08-12T00:31:40Z,Edge case: chain has 1 block only - `blockcount` will be 0 - should be a different error?,https://github.com/bitcoin/bitcoin/pull/11021#discussion_r132804721,132804721,src/rpc/blockchain.cpp
AkioNak,2017-08-12T05:40:39Z,"@promag Thank you for you review.\nI added a commit that throws a new RPC_INVALID_PARAMETER if block's height below 2.",https://github.com/bitcoin/bitcoin/pull/11021#discussion_r132810361,132810361,src/rpc/blockchain.cpp
promag,2017-08-12T08:47:29Z,IMO the error should be `RPC_MISC_ERROR` since it's not a parameter. The message should be something like `Chain height should be greater than 1`.,https://github.com/bitcoin/bitcoin/pull/11021#discussion_r132813889,132813889,src/rpc/blockchain.cpp
promag,2017-08-12T08:47:58Z,I wonder if the error could be avoided by making the algorithm compatible with 1 block chain.,https://github.com/bitcoin/bitcoin/pull/11021#discussion_r132813900,132813900,src/rpc/blockchain.cpp
AkioNak,2017-08-13T05:59:28Z,"I think tx-rate for 1st block (and genesis block) can not calculate (or meaningless).\n\n> be avoided by making the algorithm compatible with 1 block chain.\n\nSo, I think we can treat this situation equal to nTimeDiff = 0.\n",https://github.com/bitcoin/bitcoin/pull/11021#discussion_r132832974,132832974,src/rpc/blockchain.cpp
jnewbery,2017-08-15T20:28:32Z,"nit: name the variable `time_diff`. (the `n` prefix in the C++ code is no longer the style we use, and shouldn't be carried over to the python code)",https://github.com/bitcoin/bitcoin/pull/11021#discussion_r133294640,133294640,test/functional/blockchain.py
sipa,2017-08-16T18:16:09Z,"This seems to be a confusing name; I would associate `block_count` with the size of the window over which `txrate` is computed. To denote the block height that ends the window, I would use `height`.",https://github.com/bitcoin/bitcoin/pull/11021#discussion_r133526569,133526569,src/rpc/blockchain.cpp
jnewbery,2017-08-16T21:25:22Z,I agree. My earlier suggestion was for `block_count` to be the size of the window.,https://github.com/bitcoin/bitcoin/pull/11021#discussion_r133571068,133571068,src/rpc/blockchain.cpp
AkioNak,2017-08-17T00:25:56Z,"@sipa Thank you for your review. I made a mistake.\n@jnewbery I misunderstood. Same as your suggestion, I think the size of the window is better than block height as result of this command.",https://github.com/bitcoin/bitcoin/pull/11021#discussion_r133599024,133599024,src/rpc/blockchain.cpp
jnewbery,2017-08-23T14:27:48Z,"I don't love the `txratecount` and `txrateinterval` names (rate and count are fundamentally different things, and `txrateinterval` mentions tx but not time, but the value returned is time).\n\nI suggest:\n- `window_block_count`\n- `window_tx_count`\n- `window_interval`\n\nNote that new RPC arguments and return values should be snake case.",https://github.com/bitcoin/bitcoin/pull/11021#discussion_r134767543,134767543,src/rpc/blockchain.cpp
jnewbery,2017-08-23T14:37:44Z,"Any reason to disallow 0? `blockcount` can be 0 if we run this on a node with just the genesis block, so why not allow it to be set to 0 when running with a longer chain?",https://github.com/bitcoin/bitcoin/pull/11021#discussion_r134770582,134770582,src/rpc/blockchain.cpp
jnewbery,2017-08-23T14:41:13Z,Perhaps move this up into the `if (blockcount > 0)` code block (since `nTimeDiff` can only be non-zero when `blockcount` > 0)? Up to you.,https://github.com/bitcoin/bitcoin/pull/11021#discussion_r134771643,134771643,src/rpc/blockchain.cpp
jnewbery,2017-08-23T14:41:24Z,"Suggestion: improve this help message as part of this PR. Perhaps:\n\n`The timestamp for the final block in the window in UNIX format.`",https://github.com/bitcoin/bitcoin/pull/11021#discussion_r134771701,134771701,src/rpc/blockchain.cpp
jnewbery,2017-08-23T14:43:01Z,Also perhaps add a comment to the help text that these values are only returned if `block_count` is > 0,https://github.com/bitcoin/bitcoin/pull/11021#discussion_r134772248,134772248,src/rpc/blockchain.cpp
jnewbery,2017-08-23T14:44:00Z,Perhaps display `block_count` if it is equal to zero? (but not the other two values since they're meaningless if block_count == 0,https://github.com/bitcoin/bitcoin/pull/11021#discussion_r134772567,134772567,src/rpc/blockchain.cpp
AkioNak,2017-08-24T02:08:16Z,I agree to improve that help message.,https://github.com/bitcoin/bitcoin/pull/11021#discussion_r134912616,134912616,src/rpc/blockchain.cpp
AkioNak,2017-08-24T02:34:23Z,I agree to rename those names and to add condition to the help text.,https://github.com/bitcoin/bitcoin/pull/11021#discussion_r134914950,134914950,src/rpc/blockchain.cpp
AkioNak,2017-08-24T05:58:42Z,"I think the reason to disallow 0 is that this RPC was originally intended to be able to calculate `txrate`.\nTherefore if user specifies 0 by parameter, PRC should returns illegal parameter error.\nSo, for only genesis block and 1st block, I think it can allow 0 internally when user is not specify block count in 1st parameter, and can avoid error to be occured.\n\nBut now, it is easier to unde",https://github.com/bitcoin/bitcoin/pull/11021#discussion_r134932383,134932383,src/rpc/blockchain.cpp
AkioNak,2017-08-24T06:01:40Z,I agree to display `block_count` even if it is equal to zero.,https://github.com/bitcoin/bitcoin/pull/11021#discussion_r134932691,134932691,src/rpc/blockchain.cpp
AkioNak,2017-08-24T08:57:31Z,I agree to move it.,https://github.com/bitcoin/bitcoin/pull/11021#discussion_r134961864,134961864,src/rpc/blockchain.cpp
promag,2017-08-24T12:49:24Z,"Nit, above it's `txcount` so here should be `window_txcount`?",https://github.com/bitcoin/bitcoin/pull/11021#discussion_r135005257,135005257,src/rpc/blockchain.cpp
promag,2017-08-24T12:51:44Z,Include unit (seconds)?,https://github.com/bitcoin/bitcoin/pull/11021#discussion_r135005736,135005736,src/rpc/blockchain.cpp
promag,2017-08-24T12:52:32Z,Remove `blockcount > 0`?,https://github.com/bitcoin/bitcoin/pull/11021#discussion_r135005875,135005875,src/rpc/blockchain.cpp
promag,2017-08-24T12:58:40Z,"Move to `else` like:\n```cpp\nif (!request.params[0].isNull()) {\n    ...\n} else {\n    blockcount = std::max(0, std::min(blockcount, pindex->nHeight - 1));\n}\n```",https://github.com/bitcoin/bitcoin/pull/11021#discussion_r135007133,135007133,src/rpc/blockchain.cpp
jnewbery,2017-08-24T13:32:26Z,I think this is fine. New arguments and return values should use snake_case.,https://github.com/bitcoin/bitcoin/pull/11021#discussion_r135014952,135014952,src/rpc/blockchain.cpp
jnewbery,2017-08-24T14:04:12Z,I agree that this is clearer,https://github.com/bitcoin/bitcoin/pull/11021#discussion_r135023199,135023199,src/rpc/blockchain.cpp
jnewbery,2017-08-24T14:04:17Z,Agree,https://github.com/bitcoin/bitcoin/pull/11021#discussion_r135023224,135023224,src/rpc/blockchain.cpp
AkioNak,2017-08-24T14:48:59Z,"I agree to @jnewbery ,too.",https://github.com/bitcoin/bitcoin/pull/11021#discussion_r135036620,135036620,src/rpc/blockchain.cpp
AkioNak,2017-08-24T14:58:30Z,"@promag Thanks for a good suggestion.\n@promag @jnewbery Is it better to reverse the conditions?\n```c++\nif (request.params[0].isNull()) {\n    blockcount = std::max(0, std::min(blockcount, pindex->nHeight - 1));\n} else {\n    ...\n}\n```",https://github.com/bitcoin/bitcoin/pull/11021#discussion_r135039499,135039499,src/rpc/blockchain.cpp
AkioNak,2017-08-24T15:04:40Z,@promag @jnewbery I think that this condition is necessary if pindex points to `genesis block`.,https://github.com/bitcoin/bitcoin/pull/11021#discussion_r135041278,135041278,src/rpc/blockchain.cpp
AkioNak,2017-08-24T15:36:02Z,I agree to append time unit(seconds),https://github.com/bitcoin/bitcoin/pull/11021#discussion_r135050741,135050741,src/rpc/blockchain.cpp
jnewbery,2017-08-24T16:26:58Z,No preference either way!,https://github.com/bitcoin/bitcoin/pull/11021#discussion_r135064670,135064670,src/rpc/blockchain.cpp
kallewoof,2017-08-25T08:37:13Z,"`blockcount == 0` is not an error so `blockcount > 0` has to remain, I believe, for the case where `pindex` points at genesis block which means `pindex->nHeight == 0`.",https://github.com/bitcoin/bitcoin/pull/11021#discussion_r135209573,135209573,src/rpc/blockchain.cpp
