[
  {
    "sha": "5825b34783545f9470d5ab94b87c918980715675",
    "node_id": "C_kwDOABII59oAKDU4MjViMzQ3ODM1NDVmOTQ3MGQ1YWI5NGI4N2M5MTg5ODA3MTU2NzU",
    "commit": {
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-09-24T10:26:59Z"
      },
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-09-24T20:00:24Z"
      },
      "message": "test: avoid non-determinism in asmap-addrman test\n\nThis is the same approach as for the addpeeraddress test in\n`test/functional/rpc_net.py` in commit 869f1368.\n\nThe probability of collision when adding an addrman entry is\nexpected to be 1/2^16 = 1/65536 for an address from a different /16.\n\nThis change hopes to avoid these collisions by adding 1 tried entry\nbefore adding 1 new table one, instead of 2 tried entries followed\nby 2 new entries, which appears to have caused a collision in the CI.\n\nTo verify the regression test stills fails when expected:\n\n- git checkout 181a120 && git cherry-pick ef242f5\n- recompile bitcoind\n- git checkout this branch and run test/functional/feature_asmap.py. Expected output:\n\n```\nAssertionError: Unexpected stderr bitcoind: ./addrman.h:739: void CAddrMan::Check() const: Assertion `false' failed. !=\n```\n\nCo-authored-by: Martin Zumsande <mzumsande@gmail.com>",
      "tree": {
        "sha": "7d1c605fad90f68a438075214edbeb903a25257f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7d1c605fad90f68a438075214edbeb903a25257f"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5825b34783545f9470d5ab94b87c918980715675",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEd6u7+MhX7zEv6RP5T1chs9Djkh0FAmFOLnoACgkQT1chs9Dj\nkh2UbQ//X6zklmbBoHFEywsKpgWh1FgNe5xRD2mMYhl71/QvbBxoUmgd1zNPHvN9\ngNKGFaXpisNfsuh/x4ZJEP9FSiFkaPatuts5olX8t0g4y09IlldcGnBtALxHlP0L\njFkpjZChJGyYZlKxQFtuVek9KrwFtghw0kfS3mUwFoUMg9HmSwfmkRWFZFxFi5Vh\nTg3b6Q4zIQUFs3fz3xpBP7ql2LKEqgzEGEuQ4v7BqCgJf2g5Jl+Zt031BMhqnLnM\nOFtpokvnjYLl5FdLlOLTKWfrhWVzsODZGBOQPNm/yJg/DrNInbEe9Kyi/+5RSpcb\n7EMfYRxtxx6At90PccYI6S7HQBkegKVTTUq7yHwiiJF71RHbGm/BASwhsjtLozr/\neoJ1NMaJlsuuhh4Gp/axy6m5mfd10Wu1sr6VytFBx/VUk+cU8iD/OL/+vzdVrK1o\n4YFS2i/4ca/rVXd7kcHcEyDZbu96lz6zHnPpymICM3UNYXbD5m1Rliot59dOGaMs\nh5OoTN3bEWG3WCg6RNi13nJVeFd0y2i0kgtEAwmd0uMJWN2uidCxdCAe6BOrn0HZ\nrqhfxT8wjZZFO13Hkv/uPA2S2EftEfQpCVr/DAxOy+hmCZ6Dm/571ONUn3lnJUCA\nIMbN2j8dWlg0VpSvttx5mC5PTR/vv3H8M3JvGA9mLO21YqVvS5w=\n=FkoC\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwIC1ngNYDucQ3+9LOT6jGP3dxVwmfnhFRzK0hWboHY2R3CP/wEBCWeEE8bDRE\nmIc3jmc5UL8I8CBELB1LKAoyIND+mEamcd9B9kikByIt6UViFyzOysLHwQjxIKmP\n1OQQTScx5PG6a20IvsFsoC57ZK+zSr78GuvC2QGcCPAgZY3qIH/z/8SOaFCu0lXp\nOFcX0ILVJ4QlgizQeBBKP/kI8QRhTi598AguRpR27wQPbACD3+MNLvkMjiMiaHR0\ncHM6Ly9idGMuY2FsZW5kYXIuY2F0YWxsYXh5LmNvbf/wEB3hlsgKEOPgqHUcnZOj\nB2oI8CC1buwARmLbKLDPmOIt/UOiOVzxmWnohnjDmNkhJ/RFuAjwIGmRn3wNN6vi\nTDyf8vEjEYu3DOmUG76xesw9uPwRj2MvCPAg72r5mk2Net+D2/Fuzj+QuZWZSXDZ\nx+J8tiYvZaIiUAII8QRhTi5+8Aj1qpW5+07zeQCD3+MNLvkMjikoaHR0cHM6Ly9m\naW5uZXkuY2FsZW5kYXIuZXRlcm5pdHl3YWxsLmNvbf/wEI5Bm9zMh3mdfpH3U6iL\nFe4I8SAi/pKGGGpAFj8mnc65trXFNBh3TRuM5c2NfqcOsCmjUwjxBGFOLn3wCI6D\nIzzkWiXyAIPf4w0u+QyOLi1odHRwczovL2FsaWNlLmJ0Yy5jYWxlbmRhci5vcGVu\ndGltZXN0YW1wcy5vcmfwEKUo4K0GypZuEjP27bIxAlgI8CCA/rqwjUo4L9RrPyPI\nZgfXQSFfDA4Oxs67qQ3vLY7EFAjxBGFOLn7wCOjwWDbXi4T1AIPf4w0u+QyOLCto\ndHRwczovL2JvYi5idGMuY2FsZW5kYXIub3BlbnRpbWVzdGFtcHMub3Jn\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----",
        "payload": "tree 7d1c605fad90f68a438075214edbeb903a25257f\nparent b7e360081506cc646dd86f131df2d01f3c544f0e\nauthor Jon Atack <jon@atack.com> 1632479219 +0200\ncommitter Jon Atack <jon@atack.com> 1632513624 +0200\n\ntest: avoid non-determinism in asmap-addrman test\n\nThis is the same approach as for the addpeeraddress test in\n`test/functional/rpc_net.py` in commit 869f1368.\n\nThe probability of collision when adding an addrman entry is\nexpected to be 1/2^16 = 1/65536 for an address from a different /16.\n\nThis change hopes to avoid these collisions by adding 1 tried entry\nbefore adding 1 new table one, instead of 2 tried entries followed\nby 2 new entries, which appears to have caused a collision in the CI.\n\nTo verify the regression test stills fails when expected:\n\n- git checkout 181a120 && git cherry-pick ef242f5\n- recompile bitcoind\n- git checkout this branch and run test/functional/feature_asmap.py. Expected output:\n\n```\nAssertionError: Unexpected stderr bitcoind: ./addrman.h:739: void CAddrMan::Check() const: Assertion `false' failed. !=\n```\n\nCo-authored-by: Martin Zumsande <mzumsande@gmail.com>\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5825b34783545f9470d5ab94b87c918980715675",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/5825b34783545f9470d5ab94b87c918980715675",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5825b34783545f9470d5ab94b87c918980715675/comments",
    "author": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "b7e360081506cc646dd86f131df2d01f3c544f0e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b7e360081506cc646dd86f131df2d01f3c544f0e",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/b7e360081506cc646dd86f131df2d01f3c544f0e"
      }
    ],
    "stats": {
      "total": 6,
      "additions": 3,
      "deletions": 3
    },
    "files": [
      {
        "sha": "debd87962fd1e553c5c933d5a1fa02df71ae7133",
        "filename": "test/functional/feature_asmap.py",
        "status": "modified",
        "additions": 3,
        "deletions": 3,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5825b34783545f9470d5ab94b87c918980715675/test/functional/feature_asmap.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5825b34783545f9470d5ab94b87c918980715675/test/functional/feature_asmap.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/feature_asmap.py?ref=5825b34783545f9470d5ab94b87c918980715675",
        "patch": "@@ -42,8 +42,8 @@ def set_test_params(self):\n         self.extra_args = [[\"-checkaddrman=1\"]]  # Do addrman checks on all operations.\n \n     def fill_addrman(self, node_id):\n-        \"\"\"Add 2 tried addresses to the addrman, followed by 2 new addresses.\"\"\"\n-        for addr, tried in [[0, True], [1, True], [2, False], [3, False]]:\n+        \"\"\"Add 1 tried address to the addrman, followed by 1 new address.\"\"\"\n+        for addr, tried in [[0, True], [1, False]]:\n             self.nodes[node_id].addpeeraddress(address=f\"101.{addr}.0.0\", tried=tried, port=8333)\n \n     def test_without_asmap_arg(self):\n@@ -89,7 +89,7 @@ def test_asmap_interaction_with_addrman_containing_entries(self):\n         self.restart_node(0, [\"-asmap\", \"-checkaddrman=1\"])\n         with self.node.assert_debug_log(\n             expected_msgs=[\n-                \"Addrman checks started: new 2, tried 2, total 4\",\n+                \"Addrman checks started: new 1, tried 1, total 2\",\n                 \"Addrman checks completed successfully\",\n             ]\n         ):"
      }
    ]
  }
]