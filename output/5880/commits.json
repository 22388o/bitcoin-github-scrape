[
  {
    "sha": "89e70e931d3d320d2dae4c296601aab113b2e508",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4OWU3MGU5MzFkM2QzMjBkMmRhZTRjMjk2NjAxYWFiMTEzYjJlNTA4",
    "commit": {
      "author": {
        "name": "Jonas Schnelli",
        "email": "jonas.schnelli@include7.ch",
        "date": "2015-03-11T23:08:22Z"
      },
      "committer": {
        "name": "Jonas Schnelli",
        "email": "jonas.schnelli@include7.ch",
        "date": "2015-03-11T23:16:23Z"
      },
      "message": "[QT] fix OSX dock icon window reopening\n\nfixes #5878",
      "tree": {
        "sha": "af4ebf6772b6f8e40fef6820b62ca62193e4472c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/af4ebf6772b6f8e40fef6820b62ca62193e4472c"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/89e70e931d3d320d2dae4c296601aab113b2e508",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/89e70e931d3d320d2dae4c296601aab113b2e508",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/89e70e931d3d320d2dae4c296601aab113b2e508",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/89e70e931d3d320d2dae4c296601aab113b2e508/comments",
    "author": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "e564e63ef04e55b1e446f8440d51c611bc41cec6",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e564e63ef04e55b1e446f8440d51c611bc41cec6",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/e564e63ef04e55b1e446f8440d51c611bc41cec6"
      }
    ],
    "stats": {
      "total": 55,
      "additions": 24,
      "deletions": 31
    },
    "files": [
      {
        "sha": "564fd0353e92ec0fe9c3d89b1fa040d1c8c4e2b4",
        "filename": "src/qt/macdockiconhandler.mm",
        "status": "modified",
        "additions": 24,
        "deletions": 31,
        "changes": 55,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/89e70e931d3d320d2dae4c296601aab113b2e508/src/qt/macdockiconhandler.mm",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/89e70e931d3d320d2dae4c296601aab113b2e508/src/qt/macdockiconhandler.mm",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/macdockiconhandler.mm?ref=89e70e931d3d320d2dae4c296601aab113b2e508",
        "patch": "@@ -11,52 +11,46 @@\n \n #undef slots\n #include <Cocoa/Cocoa.h>\n+#include <objc/objc.h>\n+#include <objc/message.h>\n \n #if QT_VERSION < 0x050000\n extern void qt_mac_set_dock_menu(QMenu *);\n #endif\n \n-@interface DockIconClickEventHandler : NSObject\n-{\n-    MacDockIconHandler* dockIconHandler;\n-}\n-\n-@end\n-\n-@implementation DockIconClickEventHandler\n+static MacDockIconHandler *s_instance = NULL;\n \n-- (id)initWithDockIconHandler:(MacDockIconHandler *)aDockIconHandler\n-{\n-    self = [super init];\n-    if (self) {\n-        dockIconHandler = aDockIconHandler;\n-\n-        [[NSAppleEventManager sharedAppleEventManager]\n-            setEventHandler:self\n-                andSelector:@selector(handleDockClickEvent:withReplyEvent:)\n-              forEventClass:kCoreEventClass\n-                 andEventID:kAEReopenApplication];\n-    }\n-    return self;\n+bool dockClickHandler(id self,SEL _cmd,...) {\n+    Q_UNUSED(self)\n+    Q_UNUSED(_cmd)\n+    \n+    s_instance->handleDockIconClickEvent();\n+    \n+    // Return NO (false) to suppress the default OS X actions\n+    return false;\n }\n \n-- (void)handleDockClickEvent:(NSAppleEventDescriptor*)event withReplyEvent:(NSAppleEventDescriptor*)replyEvent\n-{\n-    Q_UNUSED(event)\n-    Q_UNUSED(replyEvent)\n-\n-    if (dockIconHandler) {\n-        dockIconHandler->handleDockIconClickEvent();\n+void setupDockClickHandler() {\n+    Class cls = objc_getClass(\"NSApplication\");\n+    id appInst = objc_msgSend((id)cls, sel_registerName(\"sharedApplication\"));\n+    \n+    if (appInst != NULL) {\n+        id delegate = objc_msgSend(appInst, sel_registerName(\"delegate\"));\n+        Class delClass = (Class)objc_msgSend(delegate,  sel_registerName(\"class\"));\n+        SEL shouldHandle = sel_registerName(\"applicationShouldHandleReopen:hasVisibleWindows:\");\n+        if (class_getInstanceMethod(delClass, shouldHandle))\n+            class_replaceMethod(delClass, shouldHandle, (IMP)dockClickHandler, \"B@:\");\n+        else\n+            class_addMethod(delClass, shouldHandle, (IMP)dockClickHandler,\"B@:\");\n     }\n }\n \n-@end\n \n MacDockIconHandler::MacDockIconHandler() : QObject()\n {\n     NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];\n \n-    this->m_dockIconClickEventHandler = [[DockIconClickEventHandler alloc] initWithDockIconHandler:this];\n+    setupDockClickHandler();\n     this->m_dummyWidget = new QWidget();\n     this->m_dockMenu = new QMenu(this->m_dummyWidget);\n     this->setMainWindow(NULL);\n@@ -119,7 +113,6 @@ - (void)handleDockClickEvent:(NSAppleEventDescriptor*)event withReplyEvent:(NSAp\n \n MacDockIconHandler *MacDockIconHandler::instance()\n {\n-    static MacDockIconHandler *s_instance = NULL;\n     if (!s_instance)\n         s_instance = new MacDockIconHandler();\n     return s_instance;"
      }
    ]
  },
  {
    "sha": "8b60808c1eaddb402a699ba53d865932e08109ec",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4YjYwODA4YzFlYWRkYjQwMmE2OTliYTUzZDg2NTkzMmUwODEwOWVj",
    "commit": {
      "author": {
        "name": "Jonas Schnelli",
        "email": "jonas.schnelli@include7.ch",
        "date": "2015-03-13T14:40:53Z"
      },
      "committer": {
        "name": "Jonas Schnelli",
        "email": "jonas.schnelli@include7.ch",
        "date": "2015-03-13T14:40:53Z"
      },
      "message": "[QT] some mac specifiy cleanup (memory handling, unnecessary code)",
      "tree": {
        "sha": "7b3a4218e9dca79f030d791f6096e28f0e1b3e21",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7b3a4218e9dca79f030d791f6096e28f0e1b3e21"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8b60808c1eaddb402a699ba53d865932e08109ec",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8b60808c1eaddb402a699ba53d865932e08109ec",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/8b60808c1eaddb402a699ba53d865932e08109ec",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8b60808c1eaddb402a699ba53d865932e08109ec/comments",
    "author": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "89e70e931d3d320d2dae4c296601aab113b2e508",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/89e70e931d3d320d2dae4c296601aab113b2e508",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/89e70e931d3d320d2dae4c296601aab113b2e508"
      }
    ],
    "stats": {
      "total": 17,
      "additions": 7,
      "deletions": 10
    },
    "files": [
      {
        "sha": "58c005ae75ba4056c944ecf7da96ec25416b772c",
        "filename": "src/qt/bitcoingui.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/8b60808c1eaddb402a699ba53d865932e08109ec/src/qt/bitcoingui.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/8b60808c1eaddb402a699ba53d865932e08109ec/src/qt/bitcoingui.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/bitcoingui.cpp?ref=8b60808c1eaddb402a699ba53d865932e08109ec",
        "patch": "@@ -237,7 +237,7 @@ BitcoinGUI::~BitcoinGUI()\n         trayIcon->hide();\n #ifdef Q_OS_MAC\n     delete appMenuBar;\n-    MacDockIconHandler::instance()->setMainWindow(NULL);\n+    MacDockIconHandler::cleanup();\n #endif\n \n     delete rpcConsole;"
      },
      {
        "sha": "15a6583ca44c45c26acf66236b8cacbf285f1931",
        "filename": "src/qt/macdockiconhandler.h",
        "status": "modified",
        "additions": 1,
        "deletions": 8,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/8b60808c1eaddb402a699ba53d865932e08109ec/src/qt/macdockiconhandler.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/8b60808c1eaddb402a699ba53d865932e08109ec/src/qt/macdockiconhandler.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/macdockiconhandler.h?ref=8b60808c1eaddb402a699ba53d865932e08109ec",
        "patch": "@@ -14,12 +14,6 @@ class QMenu;\n class QWidget;\n QT_END_NAMESPACE\n \n-#ifdef __OBJC__\n-@class DockIconClickEventHandler;\n-#else\n-class DockIconClickEventHandler;\n-#endif\n-\n /** Macintosh-specific dock icon handler.\n  */\n class MacDockIconHandler : public QObject\n@@ -33,7 +27,7 @@ class MacDockIconHandler : public QObject\n     void setIcon(const QIcon &icon);\n     void setMainWindow(QMainWindow *window);\n     static MacDockIconHandler *instance();\n-\n+    static void cleanup();\n     void handleDockIconClickEvent();\n \n signals:\n@@ -42,7 +36,6 @@ class MacDockIconHandler : public QObject\n private:\n     MacDockIconHandler();\n \n-    DockIconClickEventHandler *m_dockIconClickEventHandler;\n     QWidget *m_dummyWidget;\n     QMenu *m_dockMenu;\n     QMainWindow *mainWindow;"
      },
      {
        "sha": "58a0365d3dca8923b94203ab74912ea7e4544914",
        "filename": "src/qt/macdockiconhandler.mm",
        "status": "modified",
        "additions": 5,
        "deletions": 1,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/8b60808c1eaddb402a699ba53d865932e08109ec/src/qt/macdockiconhandler.mm",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/8b60808c1eaddb402a699ba53d865932e08109ec/src/qt/macdockiconhandler.mm",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/macdockiconhandler.mm?ref=8b60808c1eaddb402a699ba53d865932e08109ec",
        "patch": "@@ -68,7 +68,6 @@ void setupDockClickHandler() {\n \n MacDockIconHandler::~MacDockIconHandler()\n {\n-    [this->m_dockIconClickEventHandler release];\n     delete this->m_dummyWidget;\n     this->setMainWindow(NULL);\n }\n@@ -118,6 +117,11 @@ void setupDockClickHandler() {\n     return s_instance;\n }\n \n+void MacDockIconHandler::cleanup()\n+{\n+    delete s_instance;\n+}\n+\n void MacDockIconHandler::handleDockIconClickEvent()\n {\n     if (this->mainWindow)"
      }
    ]
  }
]