[
  {
    "sha": "c4ddee64c7f80eee05a95116ef1b1dc8a7601183",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpjNGRkZWU2NGM3ZjgwZWVlMDVhOTUxMTZlZjFiMWRjOGE3NjAxMTgz",
    "commit": {
      "author": {
        "name": "Antoine Riard",
        "email": "dev@ariard.me",
        "date": "2021-06-22T17:08:55Z"
      },
      "committer": {
        "name": "Antoine Riard",
        "email": "dev@ariard.me",
        "date": "2021-06-30T22:47:08Z"
      },
      "message": "test: Add test for replacement relay fee check",
      "tree": {
        "sha": "6286b7d772e125a9d0ee9c9cdc282c0133d5b21d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6286b7d772e125a9d0ee9c9cdc282c0133d5b21d"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c4ddee64c7f80eee05a95116ef1b1dc8a7601183",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c4ddee64c7f80eee05a95116ef1b1dc8a7601183",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/c4ddee64c7f80eee05a95116ef1b1dc8a7601183",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c4ddee64c7f80eee05a95116ef1b1dc8a7601183/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "b2f5c38333fd2ec03fd1299a1bce507b25753f45",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b2f5c38333fd2ec03fd1299a1bce507b25753f45",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/b2f5c38333fd2ec03fd1299a1bce507b25753f45"
      }
    ],
    "stats": {
      "total": 12,
      "additions": 12,
      "deletions": 0
    },
    "files": [
      {
        "sha": "ed944274e3bd85a785cccae08dbc2e52564ef253",
        "filename": "test/functional/feature_rbf.py",
        "status": "modified",
        "additions": 12,
        "deletions": 0,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c4ddee64c7f80eee05a95116ef1b1dc8a7601183/test/functional/feature_rbf.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c4ddee64c7f80eee05a95116ef1b1dc8a7601183/test/functional/feature_rbf.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/feature_rbf.py?ref=c4ddee64c7f80eee05a95116ef1b1dc8a7601183",
        "patch": "@@ -122,6 +122,9 @@ def run_test(self):\n         self.log.info(\"Running test no inherited signaling...\")\n         self.test_no_inherited_signaling()\n \n+        self.log.info(\"Running test replacement relay fee...\")\n+        self.test_replacement_relay_fee()\n+\n         self.log.info(\"Passed\")\n \n     def test_simple_doublespend(self):\n@@ -627,6 +630,15 @@ def test_no_inherited_signaling(self):\n         assert_equal(True, self.nodes[0].getmempoolentry(optin_parent_tx['txid'])['bip125-replaceable'])\n         assert_raises_rpc_error(-26, 'txn-mempool-conflict', self.nodes[0].sendrawtransaction, replacement_child_tx[\"hex\"], 0)\n \n+    def test_replacement_relay_fee(self):\n+        wallet = MiniWallet(self.nodes[0])\n+        wallet.scan_blocks(start=77, num=1)\n+        tx = wallet.send_self_transfer(from_node=self.nodes[0])['tx']\n+\n+        # Higher fee, higher feerate, different txid, but the replacement does not provide a relay\n+        # fee conforming to node's `incrementalrelayfee` policy of 1000 sat per KB.\n+        tx.vout[0].nValue -= 1\n+        assert_raises_rpc_error(-26, \"insufficient fee\", self.nodes[0].sendrawtransaction, tx.serialize().hex())\n \n if __name__ == '__main__':\n     ReplaceByFeeTest().main()"
      }
    ]
  }
]