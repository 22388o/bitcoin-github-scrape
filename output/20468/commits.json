[
  {
    "sha": "6690adba08006739da0060eb4937126bdfa1181a",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo2NjkwYWRiYTA4MDA2NzM5ZGEwMDYwZWI0OTM3MTI2YmRmYTExODFh",
    "commit": {
      "author": {
        "name": "Tyler Chambers",
        "email": "tyler@iHeartAPIs.com",
        "date": "2020-11-28T23:43:55Z"
      },
      "committer": {
        "name": "Tyler Chambers",
        "email": "tyler@iHeartAPIs.com",
        "date": "2020-11-28T23:43:55Z"
      },
      "message": "Warn when binaries are built from a dirty branch.\n\nAdjusted version flag behavior in bitcoin-tx, bitcoin-wallet, and\nbitcoind to match. Added functionality in gen-manpages.sh to warning when\nattempting to generate man pages for binaries built from a dirty\nbranch.",
      "tree": {
        "sha": "dbca7183724e614b677825b73311e55df01079cc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/dbca7183724e614b677825b73311e55df01079cc"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6690adba08006739da0060eb4937126bdfa1181a",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "no_user",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEELmnn+18OHA8dYlw2unaXn6qNNuYFAl/C4OoACgkQunaXn6qN\nNuYJchAAnUxaJqWkWmVI8QtpgEA2a8fahZl6w3FFjumeG/A7WFiBIlc8v9YJM9Qu\noZYhBkBGmbq7m/OX+trh6qJpqvuVEasxCB4MVmuItz9URezb0jJLIEXN5sKvZoKw\nm6AIX/Z4kqQ8Q+/3Ki5uCOEfnBvezE3leCzQtwjkT6AIimWMDp42LtZUShw6BkRw\nTvoD0oRwelohDi2Djsc5RHmIkSquJe20J7lzijkofV4B17JLBsPqk2/w66CGYPAC\n7n/WNb7YZeg/ii7YS6qjbkV9s6TK3+u0uGDlf+H6KGtWlxbq+D2zus+cdQwqEoEW\n1dG+tnLW0hWFH8WSZfHQCaSGXQ7PTVBAhwUsORCftjAEq2wUL5FLYzNOBgDH+DME\nHn882u6UzeezHaIEM7yX/+BP4Ol71IbWY2QHkOmVjkG3Y2k9rQ9LNL/uvlejmB6M\n7h27MJ2E0QFkRH+lE3tNHLMXESftKXRl+Mo3GMnmIzopSy/5aXZz7gGFbsPfuM41\nA3eFLj2/TVsereknp9j2fdhnlJu7Zp+kpzD/HSdmcgnd0TrE7Iek7xCH4A7jxtjU\nvOgbPJq2daU6YRH8xZvd9UaSaPjDAuFnkI6LYRX5B4vhThIuinKZbc3uD1VD2Fga\nB2Og4jLrM+5gaNnGMI8cjs+81zGX8KDpsXCZTGllF2NJGkKAykE=\n=2k6p\n-----END PGP SIGNATURE-----",
        "payload": "tree dbca7183724e614b677825b73311e55df01079cc\nparent 555b5d1bf940646a728499cfa1005bcb61383c20\nauthor Tyler Chambers <tyler@iHeartAPIs.com> 1606607035 -0500\ncommitter Tyler Chambers <tyler@iHeartAPIs.com> 1606607035 -0500\n\nWarn when binaries are built from a dirty branch.\n\nAdjusted version flag behavior in bitcoin-tx, bitcoin-wallet, and\nbitcoind to match. Added functionality in gen-manpages.sh to warning when\nattempting to generate man pages for binaries built from a dirty\nbranch.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6690adba08006739da0060eb4937126bdfa1181a",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/6690adba08006739da0060eb4937126bdfa1181a",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6690adba08006739da0060eb4937126bdfa1181a/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "555b5d1bf940646a728499cfa1005bcb61383c20",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/555b5d1bf940646a728499cfa1005bcb61383c20",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/555b5d1bf940646a728499cfa1005bcb61383c20"
      }
    ],
    "stats": {
      "total": 65,
      "additions": 44,
      "deletions": 21
    },
    "files": [
      {
        "sha": "3fdcda4fd47593bcb3b1777a39fb3a9ab1951b06",
        "filename": "contrib/devtools/gen-manpages.sh",
        "status": "modified",
        "additions": 16,
        "deletions": 0,
        "changes": 16,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6690adba08006739da0060eb4937126bdfa1181a/contrib/devtools/gen-manpages.sh",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6690adba08006739da0060eb4937126bdfa1181a/contrib/devtools/gen-manpages.sh",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/devtools/gen-manpages.sh?ref=6690adba08006739da0060eb4937126bdfa1181a",
        "patch": "@@ -18,6 +18,22 @@ BITCOINQT=${BITCOINQT:-$BINDIR/qt/bitcoin-qt}\n \n [ ! -x $BITCOIND ] && echo \"$BITCOIND not found or not executable.\" && exit 1\n \n+# Don't allow man pages to be generated for binaries built from a dirty tree\n+DIRTY=\"\"\n+for cmd in $BITCOIND $BITCOINCLI $BITCOINTX $WALLET_TOOL $BITCOINQT; do\n+  VERSION_OUTPUT=$($cmd --version)\n+  if [[ $VERSION_OUTPUT == *\"dirty\"* ]]; then\n+    DIRTY=\"${DIRTY}${cmd}\\n\"\n+  fi\n+done\n+if [ -n \"$DIRTY\" ]\n+then\n+  echo -e \"WARNING: the following binaries were built from a dirty tree:\\n\"\n+  echo -e $DIRTY\n+  echo \"man pages generated from dirty binaries should NOT be committed.\"\n+  echo \"To properly generate man pages, please commit your changes to the above binaries, rebuild them, then run this script again.\"\n+fi\n+\n # The autodetected version git tag can screw up manpage output a little bit\n read -r -a BTCVER <<< \"$($BITCOINCLI --version | head -n1 | awk -F'[ -]' '{ print $6, $7 }')\"\n "
      },
      {
        "sha": "f87b9c1d161a5d3cb7276568824bc34c38475d12",
        "filename": "src/bitcoin-tx.cpp",
        "status": "modified",
        "additions": 10,
        "deletions": 6,
        "changes": 16,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6690adba08006739da0060eb4937126bdfa1181a/src/bitcoin-tx.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6690adba08006739da0060eb4937126bdfa1181a/src/bitcoin-tx.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bitcoin-tx.cpp?ref=6690adba08006739da0060eb4937126bdfa1181a",
        "patch": "@@ -40,6 +40,7 @@ static void SetupBitcoinTxArgs(ArgsManager &argsman)\n {\n     SetupHelpOptions(argsman);\n \n+    argsman.AddArg(\"-version\", \"Print version and exit\", ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-create\", \"Create new, empty TX.\", ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-json\", \"Select JSON output\", ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-txid\", \"Output only the hex-encoded transaction id of the resultant transaction.\", ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n@@ -95,13 +96,16 @@ static int AppInitRawTx(int argc, char* argv[])\n \n     fCreateBlank = gArgs.GetBoolArg(\"-create\", false);\n \n-    if (argc < 2 || HelpRequested(gArgs)) {\n+    if (argc < 2 || HelpRequested(gArgs) || gArgs.IsArgSet(\"-version\")) {\n         // First part of help message is specific to this utility\n-        std::string strUsage = PACKAGE_NAME \" bitcoin-tx utility version \" + FormatFullVersion() + \"\\n\\n\" +\n-            \"Usage:  bitcoin-tx [options] <hex-tx> [commands]  Update hex-encoded bitcoin transaction\\n\" +\n-            \"or:     bitcoin-tx [options] -create [commands]   Create hex-encoded bitcoin transaction\\n\" +\n-            \"\\n\";\n-        strUsage += gArgs.GetHelpMessage();\n+        std::string strUsage = PACKAGE_NAME \" bitcoin-tx utility version \" + FormatFullVersion() + \"\\n\";\n+        if (!gArgs.IsArgSet(\"-version\")) {\n+            strUsage += \"\\n\"\n+                \"Usage:  bitcoin-tx [options] <hex-tx> [commands]  Update hex-encoded bitcoin transaction\\n\"\n+                \"or:     bitcoin-tx [options] -create [commands]   Create hex-encoded bitcoin transaction\\n\"\n+                \"\\n\";\n+            strUsage += gArgs.GetHelpMessage();\n+        }\n \n         tfm::format(std::cout, \"%s\", strUsage);\n "
      },
      {
        "sha": "d258f9f933471667d593161767acb06f3adf6e6a",
        "filename": "src/bitcoin-wallet.cpp",
        "status": "modified",
        "additions": 13,
        "deletions": 10,
        "changes": 23,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6690adba08006739da0060eb4937126bdfa1181a/src/bitcoin-wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6690adba08006739da0060eb4937126bdfa1181a/src/bitcoin-wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bitcoin-wallet.cpp?ref=6690adba08006739da0060eb4937126bdfa1181a",
        "patch": "@@ -24,6 +24,7 @@ static void SetupWalletToolArgs(ArgsManager& argsman)\n     SetupHelpOptions(argsman);\n     SetupChainParamsBaseOptions(argsman);\n \n+    argsman.AddArg(\"-version\", \"Print version and exit\", ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-datadir=<dir>\", \"Specify data directory\", ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-wallet=<wallet-name>\", \"Specify wallet name\", ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-debug=<category>\", \"Output debugging information (default: 0).\", ArgsManager::ALLOW_ANY, OptionsCategory::DEBUG_TEST);\n@@ -42,16 +43,18 @@ static bool WalletAppInit(int argc, char* argv[])\n         tfm::format(std::cerr, \"Error parsing command line arguments: %s\\n\", error_message);\n         return false;\n     }\n-    if (argc < 2 || HelpRequested(gArgs)) {\n-        std::string usage = strprintf(\"%s bitcoin-wallet version\", PACKAGE_NAME) + \" \" + FormatFullVersion() + \"\\n\\n\" +\n-                                      \"bitcoin-wallet is an offline tool for creating and interacting with \" PACKAGE_NAME \" wallet files.\\n\" +\n-                                      \"By default bitcoin-wallet will act on wallets in the default mainnet wallet directory in the datadir.\\n\" +\n-                                      \"To change the target wallet, use the -datadir, -wallet and -testnet/-regtest arguments.\\n\\n\" +\n-                                      \"Usage:\\n\" +\n-                                     \"  bitcoin-wallet [options] <command>\\n\\n\" +\n-                                     gArgs.GetHelpMessage();\n-\n-        tfm::format(std::cout, \"%s\", usage);\n+    if (argc < 2 || HelpRequested(gArgs) || gArgs.IsArgSet(\"-version\")) {\n+        std::string strUsage = strprintf(\"%s bitcoin-wallet version\", PACKAGE_NAME) + \" \" + FormatFullVersion() + \"\\n\";\n+            if (!gArgs.IsArgSet(\"-version\")) {\n+                strUsage += \"\\n\"\n+                    \"bitcoin-wallet is an offline tool for creating and interacting with \" PACKAGE_NAME \" wallet files.\\n\"\n+                    \"By default bitcoin-wallet will act on wallets in the default mainnet wallet directory in the datadir.\\n\"\n+                    \"To change the target wallet, use the -datadir, -wallet and -testnet/-regtest arguments.\\n\\n\"\n+                    \"Usage:\\n\"\n+                    \"  bitcoin-wallet [options] <command>\\n\";\n+                strUsage += \"\\n\" + gArgs.GetHelpMessage();\n+            }\n+        tfm::format(std::cout, \"%s\", strUsage);\n         return false;\n     }\n "
      },
      {
        "sha": "4c89db54cb942c72962dd8585990693607f9e3be",
        "filename": "src/bitcoind.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 5,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6690adba08006739da0060eb4937126bdfa1181a/src/bitcoind.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6690adba08006739da0060eb4937126bdfa1181a/src/bitcoind.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bitcoind.cpp?ref=6690adba08006739da0060eb4937126bdfa1181a",
        "patch": "@@ -57,11 +57,11 @@ static bool AppInit(int argc, char* argv[])\n     if (HelpRequested(args) || args.IsArgSet(\"-version\")) {\n         std::string strUsage = PACKAGE_NAME \" version \" + FormatFullVersion() + \"\\n\";\n \n-        if (args.IsArgSet(\"-version\")) {\n-            strUsage += FormatParagraph(LicenseInfo()) + \"\\n\";\n-        } else {\n-            strUsage += \"\\nUsage:  bitcoind [options]                     Start \" PACKAGE_NAME \"\\n\";\n-            strUsage += \"\\n\" + args.GetHelpMessage();\n+        if (!args.IsArgSet(\"-version\")) {\n+            strUsage += FormatParagraph(LicenseInfo()) + \"\\n\"\n+                \"\\nUsage:  bitcoind [options]                     Start \" PACKAGE_NAME \"\\n\"\n+                \"\\n\";\n+            strUsage += args.GetHelpMessage();\n         }\n \n         tfm::format(std::cout, \"%s\", strUsage);"
      }
    ]
  }
]