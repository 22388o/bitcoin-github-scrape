[
  {
    "sha": "e01ab15da7ff21f64b14d7970dff5441872c6269",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzplMDFhYjE1ZGE3ZmYyMWY2NGIxNGQ3OTcwZGZmNTQ0MTg3MmM2MjY5",
    "commit": {
      "author": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2021-07-25T15:17:15Z"
      },
      "committer": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2021-09-14T10:39:36Z"
      },
      "message": "build, qt: Align frameworks with macOS codesign tool requirements\n\nCurrently the codesign tool fails to sign copied frameworks.",
      "tree": {
        "sha": "4b53ab664da46e57c49cadc3058288a98f573e7c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4b53ab664da46e57c49cadc3058288a98f573e7c"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e01ab15da7ff21f64b14d7970dff5441872c6269",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE0dvyxLlvLev0wWZUQQEIES5+qB8FAmFAe+gACgkQQQEIES5+\nqB/H3A/9FmbWw0zD/ytpyqW9byqNBgdHgzPPQmwx2HyojeO2dkpoT1MrbwdDyD91\nFQ+/WOYYYnsSp6IDvVID3s2cxkb+oanlYDKYKzRe3gtAuzfPKq5kfztVIeOmXRb2\nqiKiIatFF+81uK8f0obSOC8Al8BvpSUM6D8Pk0H05jycJguuG/IN6kCqmmH2FgqG\nd7NEShZ2ubnsbO6rFkFIpmuHbOwdHZhke3j2MJt/jUcfaTJwPtDIB/T/ampP9NGK\naQLGvM4vAeOZ6ct3Q9EMtgorkZ1t+Wz74mJqTE46ATpVAmsyo0fKIAlD+bmx7jmV\nMsUzXMcxAqr+kf4Tsbhf/m8ZdXhxbuvG5X1nZhNg77wlEJYT3yDZrdqZuzLPOKKA\nXSSwT5GfJh1uwKAAbIVW6hrMD9W5zgV0bDGdQrvANtS/bjsvNacCu9mt/2VY3DQ2\nWkryP3zoviHKal4Wsdmmf7hqNOXAE7OUj/wfamodr5v2jDdwarCG7nCnR79f9pz+\n9KvIPr+THGeq4mD9QVTDIBUZlVWHCScgtqQNAO+foTS8Si0xFPVf8XBhRz2p8A69\nTkyG2yR9nuMhGpAv/0+GcaTAOqDzSiKcnW7VJ8+OZtptPuSTc3L6jiwvTrGMhkBi\nYIMkYddDCTl8H73m1qENC23VP7APwPINkR8bJVv3bxXCdQ0mRao=\n=8t+G\n-----END PGP SIGNATURE-----",
        "payload": "tree 4b53ab664da46e57c49cadc3058288a98f573e7c\nparent b5ede2aa7f083d3d2c75693fa8ddce30aa939a47\nauthor Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1627226235 +0300\ncommitter Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1631615976 +0300\n\nbuild, qt: Align frameworks with macOS codesign tool requirements\n\nCurrently the codesign tool fails to sign copied frameworks.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e01ab15da7ff21f64b14d7970dff5441872c6269",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/e01ab15da7ff21f64b14d7970dff5441872c6269",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e01ab15da7ff21f64b14d7970dff5441872c6269/comments",
    "author": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "b5ede2aa7f083d3d2c75693fa8ddce30aa939a47",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b5ede2aa7f083d3d2c75693fa8ddce30aa939a47",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/b5ede2aa7f083d3d2c75693fa8ddce30aa939a47"
      }
    ],
    "stats": {
      "total": 74,
      "additions": 36,
      "deletions": 38
    },
    "files": [
      {
        "sha": "06a5adbeacdb0996b3dc61519cb034e5bae4b83e",
        "filename": "contrib/macdeploy/macdeployqtplus",
        "status": "modified",
        "additions": 36,
        "deletions": 38,
        "changes": 74,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e01ab15da7ff21f64b14d7970dff5441872c6269/contrib/macdeploy/macdeployqtplus",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e01ab15da7ff21f64b14d7970dff5441872c6269/contrib/macdeploy/macdeployqtplus",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/macdeploy/macdeployqtplus?ref=e01ab15da7ff21f64b14d7970dff5441872c6269",
        "patch": "@@ -244,49 +244,47 @@ def copyFramework(framework: FrameworkInfo, path: str, verbose: int) -> Optional\n         fromPath = framework.sourceFilePath\n     toDir = os.path.join(path, framework.destinationDirectory)\n     toPath = os.path.join(toDir, framework.binaryName)\n-    \n-    if not os.path.exists(fromPath):\n-        raise RuntimeError(f\"No file at {fromPath}\")\n-    \n-    if os.path.exists(toPath):\n-        return None # Already there\n-    \n-    if not os.path.exists(toDir):\n-        os.makedirs(toDir)\n-    \n-    shutil.copy2(fromPath, toPath)\n-    if verbose:\n-        print(\"Copied:\", fromPath)\n-        print(\" to:\", toPath)\n+\n+    if framework.isDylib():\n+        if not os.path.exists(fromPath):\n+            raise RuntimeError(f\"No file at {fromPath}\")\n+\n+        if os.path.exists(toPath):\n+            return None # Already there\n+\n+        if not os.path.exists(toDir):\n+            os.makedirs(toDir)\n+\n+        shutil.copy2(fromPath, toPath)\n+        if verbose:\n+            print(\"Copied:\", fromPath)\n+            print(\" to:\", toPath)\n+    else:\n+        to_dir = os.path.join(path, \"Contents\", \"Frameworks\", framework.frameworkName)\n+        if os.path.exists(to_dir):\n+            return None # Already there\n+\n+        from_dir = framework.frameworkPath\n+        if not os.path.exists(from_dir):\n+            raise RuntimeError(f\"No directory at {from_dir}\")\n+\n+        shutil.copytree(from_dir, to_dir, symlinks=True)\n+        if verbose:\n+            print(\"Copied:\", from_dir)\n+            print(\" to:\", to_dir)\n+\n+        headers_link = os.path.join(to_dir, \"Headers\")\n+        if os.path.exists(headers_link):\n+            os.unlink(headers_link)\n+\n+        headers_dir = os.path.join(to_dir, framework.binaryDirectory, \"Headers\")\n+        if os.path.exists(headers_dir):\n+            shutil.rmtree(headers_dir)\n \n     permissions = os.stat(toPath)\n     if not permissions.st_mode & stat.S_IWRITE:\n       os.chmod(toPath, permissions.st_mode | stat.S_IWRITE)\n \n-    if not framework.isDylib(): # Copy resources for real frameworks\n-\n-        linkfrom = os.path.join(path, \"Contents\",\"Frameworks\", framework.frameworkName, \"Versions\", \"Current\")\n-        linkto = framework.version\n-        if not os.path.exists(linkfrom):\n-            os.symlink(linkto, linkfrom)\n-            print(\"Linked:\", linkfrom, \"->\", linkto)\n-        fromResourcesDir = framework.sourceResourcesDirectory\n-        if os.path.exists(fromResourcesDir):\n-            toResourcesDir = os.path.join(path, framework.destinationResourcesDirectory)\n-            shutil.copytree(fromResourcesDir, toResourcesDir, symlinks=True)\n-            if verbose:\n-                print(\"Copied resources:\", fromResourcesDir)\n-                print(\" to:\", toResourcesDir)\n-        fromContentsDir = framework.sourceVersionContentsDirectory\n-        if not os.path.exists(fromContentsDir):\n-            fromContentsDir = framework.sourceContentsDirectory\n-        if os.path.exists(fromContentsDir):\n-            toContentsDir = os.path.join(path, framework.destinationVersionContentsDirectory)\n-            shutil.copytree(fromContentsDir, toContentsDir, symlinks=True)\n-            if verbose:\n-                print(\"Copied Contents:\", fromContentsDir)\n-                print(\" to:\", toContentsDir)\n-    \n     return toPath\n \n def deployFrameworks(frameworks: List[FrameworkInfo], bundlePath: str, binaryPath: str, strip: bool, verbose: int, deploymentInfo: Optional[DeploymentInfo] = None) -> DeploymentInfo:"
      }
    ]
  },
  {
    "sha": "c206adc4a304c85cfaeb67eeea38dd8c0409ed95",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpjMjA2YWRjNGEzMDRjODVjZmFlYjY3ZWVlYTM4ZGQ4YzA0MDllZDk1",
    "commit": {
      "author": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2021-07-25T15:29:57Z"
      },
      "committer": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2021-09-14T10:39:36Z"
      },
      "message": "build, qt: (Re-)sign package\n\nStarting with macOS 11 on Apple silicon, executables must be signed\nbefore they are allowed to run.",
      "tree": {
        "sha": "d99f4acbac6f9b96366fd4939dd660af920e12b8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d99f4acbac6f9b96366fd4939dd660af920e12b8"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c206adc4a304c85cfaeb67eeea38dd8c0409ed95",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE0dvyxLlvLev0wWZUQQEIES5+qB8FAmFAe+gACgkQQQEIES5+\nqB9Ecw/6A+tqBUwjcrBYVidNc+l+ei7/eIbQul3jhyD9lFGvYV+NWntcxIltqWG7\nlD7QFw8o6/sIAuDLue4o9e/zQyiVXtqrgKJzXKtj85GPK3A170LjUzHBRSjRzKVc\nX0FlXsl/RhIEEnIAWlwt2K3tjBTLs2Lh/5SlgEm8ZEHs7JYP2CrLMaPlu1/chol5\ngv5LGqVtNR2lKHmJtEIG2LeWBGJwIopClPJeBOI1YQ32EliWey6vvvJjwtfmSBsk\nNG5SxhdjqiZ+lrjaD4m7if6q0zsmXhIkYMII2kXyUJgsPaKqlR2rFIYSzG1kQwfF\nj4LexpRKZ2QTPmUPhxY3ud3iRIQRvdjHylUXn6bKr3j5SqGKZRK3ToLL7Rnasull\njwstxc6+6Smo9oR13AIbCR89xoE/pFNed2k11Ag7A6KyuKZzrt9Yyer7fG8fcT5s\njCmRiikzdJHdxDKa1OvHzueH7jUNC+pnsOZT2jT2WagAs8xYkNJttQb9GjdzpvYp\nNY/Q/9XmoKgJZlnIQjA2EoPsdnCy4PGyXwlF+3W4cktv/ZkklWveQPhdNK7yxKSe\nU8d+qhFhygGOgeHjxXpZdJI8s1ML33S0sAqxeaX7mIwZ2JuGzR14Z/Ot4rsEdTxY\n/gY0XWBFcZXH2jH45yogi/Y0lFdGiFvluOfzc1oANRh1TwxdgLk=\n=bJr5\n-----END PGP SIGNATURE-----",
        "payload": "tree d99f4acbac6f9b96366fd4939dd660af920e12b8\nparent e01ab15da7ff21f64b14d7970dff5441872c6269\nauthor Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1627226997 +0300\ncommitter Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1631615976 +0300\n\nbuild, qt: (Re-)sign package\n\nStarting with macOS 11 on Apple silicon, executables must be signed\nbefore they are allowed to run.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c206adc4a304c85cfaeb67eeea38dd8c0409ed95",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/c206adc4a304c85cfaeb67eeea38dd8c0409ed95",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c206adc4a304c85cfaeb67eeea38dd8c0409ed95/comments",
    "author": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "e01ab15da7ff21f64b14d7970dff5441872c6269",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e01ab15da7ff21f64b14d7970dff5441872c6269",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/e01ab15da7ff21f64b14d7970dff5441872c6269"
      }
    ],
    "stats": {
      "total": 5,
      "additions": 4,
      "deletions": 1
    },
    "files": [
      {
        "sha": "33dbcf8a51890c57b0c66102103ca69a44461326",
        "filename": "contrib/macdeploy/macdeployqtplus",
        "status": "modified",
        "additions": 4,
        "deletions": 1,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c206adc4a304c85cfaeb67eeea38dd8c0409ed95/contrib/macdeploy/macdeployqtplus",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c206adc4a304c85cfaeb67eeea38dd8c0409ed95/contrib/macdeploy/macdeployqtplus",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/macdeploy/macdeployqtplus?ref=c206adc4a304c85cfaeb67eeea38dd8c0409ed95",
        "patch": "@@ -16,7 +16,7 @@\n # along with this program.  If not, see <http://www.gnu.org/licenses/>.\n #\n \n-import sys, re, os, shutil, stat, os.path\n+import sys, re, os, platform, shutil, stat, subprocess, os.path\n from argparse import ArgumentParser\n from ds_store import DSStore\n from mac_alias import Alias\n@@ -541,6 +541,9 @@ ds.close()\n \n # ------------------------------------------------\n \n+if platform.system() == \"Darwin\":\n+    subprocess.check_call(f\"codesign --deep --force --sign - {target}\", shell=True)\n+\n if config.dmg is not None:\n \n     print(\"+ Preparing .dmg disk image +\")"
      }
    ]
  }
]