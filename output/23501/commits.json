[
  {
    "sha": "e1d4a128e8c71a741c2435f949c1427929e151b7",
    "node_id": "C_kwDOABII59oAKGUxZDRhMTI4ZThjNzFhNzQxYzI0MzVmOTQ5YzE0Mjc5MjllMTUxYjc",
    "commit": {
      "author": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2021-11-12T22:32:01Z"
      },
      "committer": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2021-11-12T23:21:37Z"
      },
      "message": "test: simplify and document NULLDUMMY-invalidation helper\n\nThe function `trueDummy` in feature_nulldummy.py is currently more\ncomplicated than it needs to be. Rather than converting the scriptSig to\na CScript and looping through it to build a new scriptSig with the\nmodified push, simply directly replace the push of null (OP_0) with a\npush of one (OP_TRUE/OP_1).\n\nNote that on master, actually an element with the value of 0x51 is\npushed (0x0151...) -- this was very likely not intended, as 0x51 is the\nscript op-code for OP_TRUE, and also the function's name suggests that\nthe \"true\" value shall be pushed.",
      "tree": {
        "sha": "acc90939be25d06f806cf007c32184b8aab22b4c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/acc90939be25d06f806cf007c32184b8aab22b4c"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e1d4a128e8c71a741c2435f949c1427929e151b7",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e1d4a128e8c71a741c2435f949c1427929e151b7",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/e1d4a128e8c71a741c2435f949c1427929e151b7",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e1d4a128e8c71a741c2435f949c1427929e151b7/comments",
    "author": {
      "login": "theStack",
      "id": 91535,
      "node_id": "MDQ6VXNlcjkxNTM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theStack",
      "html_url": "https://github.com/theStack",
      "followers_url": "https://api.github.com/users/theStack/followers",
      "following_url": "https://api.github.com/users/theStack/following{/other_user}",
      "gists_url": "https://api.github.com/users/theStack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theStack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
      "organizations_url": "https://api.github.com/users/theStack/orgs",
      "repos_url": "https://api.github.com/users/theStack/repos",
      "events_url": "https://api.github.com/users/theStack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theStack/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "theStack",
      "id": 91535,
      "node_id": "MDQ6VXNlcjkxNTM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theStack",
      "html_url": "https://github.com/theStack",
      "followers_url": "https://api.github.com/users/theStack/followers",
      "following_url": "https://api.github.com/users/theStack/following{/other_user}",
      "gists_url": "https://api.github.com/users/theStack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theStack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
      "organizations_url": "https://api.github.com/users/theStack/orgs",
      "repos_url": "https://api.github.com/users/theStack/repos",
      "events_url": "https://api.github.com/users/theStack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theStack/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "c9dd5c8d6e59e27af98e99d2844d6ead8eec3162",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c9dd5c8d6e59e27af98e99d2844d6ead8eec3162",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/c9dd5c8d6e59e27af98e99d2844d6ead8eec3162"
      }
    ],
    "stats": {
      "total": 18,
      "additions": 8,
      "deletions": 10
    },
    "files": [
      {
        "sha": "34491ffc1a18cb41ccbd76e10503dbc756d06e26",
        "filename": "test/functional/feature_nulldummy.py",
        "status": "modified",
        "additions": 8,
        "deletions": 10,
        "changes": 18,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e1d4a128e8c71a741c2435f949c1427929e151b7/test/functional/feature_nulldummy.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e1d4a128e8c71a741c2435f949c1427929e151b7/test/functional/feature_nulldummy.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/feature_nulldummy.py?ref=e1d4a128e8c71a741c2435f949c1427929e151b7",
        "patch": "@@ -22,7 +22,10 @@\n     create_transaction,\n )\n from test_framework.messages import CTransaction\n-from test_framework.script import CScript\n+from test_framework.script import (\n+    OP_0,\n+    OP_TRUE,\n+)\n from test_framework.test_framework import BitcoinTestFramework\n from test_framework.util import (\n     assert_equal,\n@@ -33,15 +36,10 @@\n \n \n def trueDummy(tx):\n-    scriptSig = CScript(tx.vin[0].scriptSig)\n-    newscript = []\n-    for i in scriptSig:\n-        if len(newscript) == 0:\n-            assert len(i) == 0\n-            newscript.append(b'\\x51')\n-        else:\n-            newscript.append(i)\n-    tx.vin[0].scriptSig = CScript(newscript)\n+    \"\"\"Transform a NULLDUMMY compliant tx (i.e. scriptSig starts with OP_0)\n+    to be non-NULLDUMMY compliant by replacing the dummy with OP_TRUE\"\"\"\n+    assert_equal(tx.vin[0].scriptSig[0], OP_0)\n+    tx.vin[0].scriptSig = bytes([OP_TRUE]) + tx.vin[0].scriptSig[1:]\n     tx.rehash()\n \n "
      }
    ]
  },
  {
    "sha": "5ba9f1ff598e30a70407f331fabcbe9b4e17315a",
    "node_id": "C_kwDOABII59oAKDViYTlmMWZmNTk4ZTMwYTcwNDA3ZjMzMWZhYmNiZTliNGUxNzMxNWE",
    "commit": {
      "author": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2021-11-12T22:56:05Z"
      },
      "committer": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2021-11-12T23:21:57Z"
      },
      "message": "test: refactor: rename NULLDUMMY-invalidation helper\n\nThe name is changed to match the coding guidelines (snake case) and to\nbe more descriptive.",
      "tree": {
        "sha": "267d996f9d17369282cfae7aa110fd2263f1dc01",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/267d996f9d17369282cfae7aa110fd2263f1dc01"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5ba9f1ff598e30a70407f331fabcbe9b4e17315a",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5ba9f1ff598e30a70407f331fabcbe9b4e17315a",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/5ba9f1ff598e30a70407f331fabcbe9b4e17315a",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5ba9f1ff598e30a70407f331fabcbe9b4e17315a/comments",
    "author": {
      "login": "theStack",
      "id": 91535,
      "node_id": "MDQ6VXNlcjkxNTM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theStack",
      "html_url": "https://github.com/theStack",
      "followers_url": "https://api.github.com/users/theStack/followers",
      "following_url": "https://api.github.com/users/theStack/following{/other_user}",
      "gists_url": "https://api.github.com/users/theStack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theStack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
      "organizations_url": "https://api.github.com/users/theStack/orgs",
      "repos_url": "https://api.github.com/users/theStack/repos",
      "events_url": "https://api.github.com/users/theStack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theStack/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "theStack",
      "id": 91535,
      "node_id": "MDQ6VXNlcjkxNTM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theStack",
      "html_url": "https://github.com/theStack",
      "followers_url": "https://api.github.com/users/theStack/followers",
      "following_url": "https://api.github.com/users/theStack/following{/other_user}",
      "gists_url": "https://api.github.com/users/theStack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theStack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
      "organizations_url": "https://api.github.com/users/theStack/orgs",
      "repos_url": "https://api.github.com/users/theStack/repos",
      "events_url": "https://api.github.com/users/theStack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theStack/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "e1d4a128e8c71a741c2435f949c1427929e151b7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e1d4a128e8c71a741c2435f949c1427929e151b7",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/e1d4a128e8c71a741c2435f949c1427929e151b7"
      }
    ],
    "stats": {
      "total": 6,
      "additions": 3,
      "deletions": 3
    },
    "files": [
      {
        "sha": "2055e04a96f5a458405203890764c397f1f87bfa",
        "filename": "test/functional/feature_nulldummy.py",
        "status": "modified",
        "additions": 3,
        "deletions": 3,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5ba9f1ff598e30a70407f331fabcbe9b4e17315a/test/functional/feature_nulldummy.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5ba9f1ff598e30a70407f331fabcbe9b4e17315a/test/functional/feature_nulldummy.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/feature_nulldummy.py?ref=5ba9f1ff598e30a70407f331fabcbe9b4e17315a",
        "patch": "@@ -35,7 +35,7 @@\n NULLDUMMY_ERROR = \"non-mandatory-script-verify-flag (Dummy CHECKMULTISIG argument must be zero)\"\n \n \n-def trueDummy(tx):\n+def invalidate_nulldummy_tx(tx):\n     \"\"\"Transform a NULLDUMMY compliant tx (i.e. scriptSig starts with OP_0)\n     to be non-NULLDUMMY compliant by replacing the dummy with OP_TRUE\"\"\"\n     assert_equal(tx.vin[0].scriptSig[0], OP_0)\n@@ -92,7 +92,7 @@ def run_test(self):\n \n         self.log.info(\"Test 2: Non-NULLDUMMY base multisig transaction should not be accepted to mempool before activation\")\n         test2tx = create_transaction(self.nodes[0], txid2, self.ms_address, amount=47)\n-        trueDummy(test2tx)\n+        invalidate_nulldummy_tx(test2tx)\n         assert_raises_rpc_error(-26, NULLDUMMY_ERROR, self.nodes[0].sendrawtransaction, test2tx.serialize_with_witness().hex(), 0)\n \n         self.log.info(f\"Test 3: Non-NULLDUMMY base transactions should be accepted in a block before activation [{COINBASE_MATURITY + 4}]\")\n@@ -101,7 +101,7 @@ def run_test(self):\n         self.log.info(\"Test 4: Non-NULLDUMMY base multisig transaction is invalid after activation\")\n         test4tx = create_transaction(self.nodes[0], test2tx.hash, self.address, amount=46)\n         test6txs = [CTransaction(test4tx)]\n-        trueDummy(test4tx)\n+        invalidate_nulldummy_tx(test4tx)\n         assert_raises_rpc_error(-26, NULLDUMMY_ERROR, self.nodes[0].sendrawtransaction, test4tx.serialize_with_witness().hex(), 0)\n         self.block_submit(self.nodes[0], [test4tx], accept=False)\n "
      }
    ]
  },
  {
    "sha": "f1ed30451f04af4b45b6368305722f715dcbf4fb",
    "node_id": "C_kwDOABII59oAKGYxZWQzMDQ1MWYwNGFmNGI0NWI2MzY4MzA1NzIyZjcxNWRjYmY0ZmI",
    "commit": {
      "author": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2021-11-12T23:11:25Z"
      },
      "committer": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2021-11-12T23:21:57Z"
      },
      "message": "test: refactor: simplify `block_submit` in feature_nulldummy.py\n\nThe `create_block` helper accepts a list of txs that it includes in the\ncreated block, hence we don't have to do that manually. Also, rehashing\nbefore solving the block is not needed and can be removed.",
      "tree": {
        "sha": "4e8cba175243f61151d09498c7dbfe9d26d788ff",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4e8cba175243f61151d09498c7dbfe9d26d788ff"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f1ed30451f04af4b45b6368305722f715dcbf4fb",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f1ed30451f04af4b45b6368305722f715dcbf4fb",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/f1ed30451f04af4b45b6368305722f715dcbf4fb",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f1ed30451f04af4b45b6368305722f715dcbf4fb/comments",
    "author": {
      "login": "theStack",
      "id": 91535,
      "node_id": "MDQ6VXNlcjkxNTM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theStack",
      "html_url": "https://github.com/theStack",
      "followers_url": "https://api.github.com/users/theStack/followers",
      "following_url": "https://api.github.com/users/theStack/following{/other_user}",
      "gists_url": "https://api.github.com/users/theStack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theStack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
      "organizations_url": "https://api.github.com/users/theStack/orgs",
      "repos_url": "https://api.github.com/users/theStack/repos",
      "events_url": "https://api.github.com/users/theStack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theStack/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "theStack",
      "id": 91535,
      "node_id": "MDQ6VXNlcjkxNTM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theStack",
      "html_url": "https://github.com/theStack",
      "followers_url": "https://api.github.com/users/theStack/followers",
      "following_url": "https://api.github.com/users/theStack/following{/other_user}",
      "gists_url": "https://api.github.com/users/theStack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theStack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
      "organizations_url": "https://api.github.com/users/theStack/orgs",
      "repos_url": "https://api.github.com/users/theStack/repos",
      "events_url": "https://api.github.com/users/theStack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theStack/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "5ba9f1ff598e30a70407f331fabcbe9b4e17315a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5ba9f1ff598e30a70407f331fabcbe9b4e17315a",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/5ba9f1ff598e30a70407f331fabcbe9b4e17315a"
      }
    ],
    "stats": {
      "total": 7,
      "additions": 1,
      "deletions": 6
    },
    "files": [
      {
        "sha": "9fc19395db01070640132da1203559329e10ab16",
        "filename": "test/functional/feature_nulldummy.py",
        "status": "modified",
        "additions": 1,
        "deletions": 6,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f1ed30451f04af4b45b6368305722f715dcbf4fb/test/functional/feature_nulldummy.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f1ed30451f04af4b45b6368305722f715dcbf4fb/test/functional/feature_nulldummy.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/feature_nulldummy.py?ref=f1ed30451f04af4b45b6368305722f715dcbf4fb",
        "patch": "@@ -121,14 +121,9 @@ def block_submit(self, node, txs, *, with_witness=False, accept):\n         tmpl = node.getblocktemplate(NORMAL_GBT_REQUEST_PARAMS)\n         assert_equal(tmpl['previousblockhash'], self.lastblockhash)\n         assert_equal(tmpl['height'], self.lastblockheight + 1)\n-        block = create_block(tmpl=tmpl, ntime=self.lastblocktime + 1)\n-        for tx in txs:\n-            tx.rehash()\n-            block.vtx.append(tx)\n-        block.hashMerkleRoot = block.calc_merkle_root()\n+        block = create_block(tmpl=tmpl, ntime=self.lastblocktime + 1, txlist=txs)\n         if with_witness:\n             add_witness_commitment(block)\n-        block.rehash()\n         block.solve()\n         assert_equal(None if accept else NULLDUMMY_ERROR, node.submitblock(block.serialize().hex()))\n         if accept:"
      }
    ]
  }
]