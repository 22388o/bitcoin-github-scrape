[
  {
    "sha": "e2a640e0e7bd5153d155b8fcceb7a47c4adb559b",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzplMmE2NDBlMGU3YmQ1MTUzZDE1NWI4ZmNjZWI3YTQ3YzRhZGI1NTli",
    "commit": {
      "author": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2018-08-24T14:47:41Z"
      },
      "committer": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2018-08-27T11:58:09Z"
      },
      "message": "Enable libsecp256k1 ecdh module, add ecdh function to CKey",
      "tree": {
        "sha": "def59a22bf7800367e9b9e60be7cf853c7036054",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/def59a22bf7800367e9b9e60be7cf853c7036054"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e2a640e0e7bd5153d155b8fcceb7a47c4adb559b",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEyhopCNzi8TB0xizeHrd2uwPHki0FAluD51EACgkQHrd2uwPH\nki0DOQ//dsNy4unWomRgHTXWJYSWi3A2Oyz29uRqAHA94aX3RrKT67wR33ONR4by\n3WnjdVx6W4Yqr6rmUz7lX9Nq0gKqay4h70N6wbgi8O5J9tL175680GrFNXBWmdfX\nGNKXMcLrD14inIREeQCcPz9MuWXfoBSElvvd/Yi/66VC2PDauIAq7NQznLlreQnt\n2EfvM2Cu1/Y4VXJbfiqnHzDf+VIiupSJQnjMvOPgKUAxeCf7v5IZ/74AEQ8zFHh4\nLc/91tHOlrpYajjIQS/5gPgrNDnrKKXEievA+nSLmUSOLj9TvKqi/p7fEEVVMGxq\nINdp5RqMZQnmhT5CjJMegYVsePlpY/0DMkk+liUYzze9LsTxcfTBHQgqlUD3Um4j\n3kxB6sjFYlwk1F40qWn67gtCNVNyTVIrYZkhB446WRYxuPe2cM86KI8u5p2BdwbS\njbt5zy/dvsPcvbY3Lfd4KxmbmoUuJ5G7f7t6tk8k66MEmoPBpK5J1+LQ+oaFpDHw\nH6fOlfPVYX/QPJwkSGW00GC8MTGuo5wiXdcfFdh63NPwLXgpq+MhOWLgx3KfJLbZ\nn+dpToUdeOGBFuqNuuYjy73wZWri0FMo4gu2P/AhPag3ObtuCKQrVLeW4A2rDbRZ\nI2Cs9HYBkAsJORl+XsFaEcUO3Q1TyoCq+5uIUlRcsDEuahM4ExU=\n=baWw\n-----END PGP SIGNATURE-----",
        "payload": "tree def59a22bf7800367e9b9e60be7cf853c7036054\nparent 540bf8aacc50aae0ea5beb76511905a7d2a3e15f\nauthor Jonas Schnelli <dev@jonasschnelli.ch> 1535122061 +0200\ncommitter Jonas Schnelli <dev@jonasschnelli.ch> 1535371089 +0200\n\nEnable libsecp256k1 ecdh module, add ecdh function to CKey\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e2a640e0e7bd5153d155b8fcceb7a47c4adb559b",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/e2a640e0e7bd5153d155b8fcceb7a47c4adb559b",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e2a640e0e7bd5153d155b8fcceb7a47c4adb559b/comments",
    "author": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "540bf8aacc50aae0ea5beb76511905a7d2a3e15f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/540bf8aacc50aae0ea5beb76511905a7d2a3e15f",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/540bf8aacc50aae0ea5beb76511905a7d2a3e15f"
      }
    ],
    "stats": {
      "total": 17,
      "additions": 16,
      "deletions": 1
    },
    "files": [
      {
        "sha": "8dd498f8c379e1c5b7e8fa09b31174251b7ff208",
        "filename": "configure.ac",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e2a640e0e7bd5153d155b8fcceb7a47c4adb559b/configure.ac",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e2a640e0e7bd5153d155b8fcceb7a47c4adb559b/configure.ac",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/configure.ac?ref=e2a640e0e7bd5153d155b8fcceb7a47c4adb559b",
        "patch": "@@ -1432,7 +1432,7 @@ if test x$need_bundled_univalue = xyes; then\n   AC_CONFIG_SUBDIRS([src/univalue])\n fi\n \n-ac_configure_args=\"${ac_configure_args} --disable-shared --with-pic --with-bignum=no --enable-module-recovery --disable-jni\"\n+ac_configure_args=\"${ac_configure_args} --disable-shared --with-pic --with-bignum=no --enable-module-recovery --enable-experimental --enable-module-ecdh --disable-jni\"\n AC_CONFIG_SUBDIRS([src/secp256k1])\n \n AC_OUTPUT"
      },
      {
        "sha": "1e5c0eedbd3726017c2de0c5d57712222c0ff257",
        "filename": "src/key.cpp",
        "status": "modified",
        "additions": 12,
        "deletions": 0,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e2a640e0e7bd5153d155b8fcceb7a47c4adb559b/src/key.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e2a640e0e7bd5153d155b8fcceb7a47c4adb559b/src/key.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/key.cpp?ref=e2a640e0e7bd5153d155b8fcceb7a47c4adb559b",
        "patch": "@@ -11,6 +11,7 @@\n #include <random.h>\n \n #include <secp256k1.h>\n+#include <secp256k1_ecdh.h>\n #include <secp256k1_recovery.h>\n \n static secp256k1_context* secp256k1_context_sign = nullptr;\n@@ -285,6 +286,17 @@ bool CKey::Derive(CKey& keyChild, ChainCode &ccChild, unsigned int nChild, const\n     return ret;\n }\n \n+bool CKey::ComputeECDHSecret(const CPubKey& pubkey, CPrivKey& secret_out) const\n+{\n+    secp256k1_pubkey pubkey_internal;\n+    if (!secp256k1_ec_pubkey_parse(secp256k1_context_sign, &pubkey_internal, pubkey.data(), pubkey.size())) {\n+        return false;\n+    }\n+\n+    secret_out.resize(32);\n+    return secp256k1_ecdh(secp256k1_context_sign, &secret_out[0], &pubkey_internal, keydata.data()) == 1;\n+}\n+\n bool CExtKey::Derive(CExtKey &out, unsigned int _nChild) const {\n     out.nDepth = nDepth + 1;\n     CKeyID id = key.GetPubKey().GetID();"
      },
      {
        "sha": "7aade7f8630009e3cc83729a1f0c2f959a759417",
        "filename": "src/key.h",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e2a640e0e7bd5153d155b8fcceb7a47c4adb559b/src/key.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e2a640e0e7bd5153d155b8fcceb7a47c4adb559b/src/key.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/key.h?ref=e2a640e0e7bd5153d155b8fcceb7a47c4adb559b",
        "patch": "@@ -128,6 +128,9 @@ class CKey\n     //! Derive BIP32 child key.\n     bool Derive(CKey& keyChild, ChainCode &ccChild, unsigned int nChild, const ChainCode& cc) const;\n \n+    // computes an EC Diffie-Hellman 256bit secret\n+    bool ComputeECDHSecret(const CPubKey& pubkey, CPrivKey& secret_out) const;\n+\n     /**\n      * Verify thoroughly whether a private key and a public key match.\n      * This is done using a different mechanism than just regenerating it."
      }
    ]
  },
  {
    "sha": "7ab854a23e309474e8548affcd473e44ece4c2dc",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo3YWI4NTRhMjNlMzA5NDc0ZTg1NDhhZmZjZDQ3M2U0NGVjZTRjMmRj",
    "commit": {
      "author": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2018-08-24T14:47:54Z"
      },
      "committer": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2018-08-28T08:30:59Z"
      },
      "message": "QA: Add EC Diffie-Hellman test",
      "tree": {
        "sha": "375de8ccea3751755767370dfa809c60e006d104",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/375de8ccea3751755767370dfa809c60e006d104"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7ab854a23e309474e8548affcd473e44ece4c2dc",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEyhopCNzi8TB0xizeHrd2uwPHki0FAluFCEQACgkQHrd2uwPH\nki1TFw//T/v7CdQ5bsbvLR/xgEdLZcTc3EWPTzR3ZI2EOfkys+rRMae6Dn0AKJLC\n1VdFEU5IR6ufSRdpdJHTkkXHnx0BeH9C/IPRwCiUt6jtdjVFuNWQTXhEQQhiWmiF\ncjkB3zDa1jw9EVLLRIWE6k2u6pV6kx9gEEs7SyCHIs1bSOc8Wj44ru84O6UnaXWz\n+jV5qI56rgP3JTXom7XNE87r1smk0vmcC4Bpr1JZiGiZq27W+aTGlmqAgXpG5Ih+\nh9VeuxVSlOeaCafVOCCU07Jdtc1M2D2VJwktlF4PAan+ND5k1lG/ChWjGCtgPvmN\nx8k9rdYIEDe9RZNwEUBoD8sGxidRamcLfUkVhv6IBQr39NV8LCmIbKi90VXlUOe7\nt0mq483AMD2gmGrj7MAXeYgyzJh6gtvRtFgh82ZdGsTRgnQzWtdOUrXAbnYoD6ZV\nXLcx0JpWUu00H1QAVBB1RJiVNzzsrreNzKFkc32lSUj5EgcDGXbS4Io5F/i8IwzP\nR4Mfkdg+yvEgFgVyji81pstHbt+NS/u+8REK5M+IECN2FfCTjSswb+Q2OQbHe5ZH\nawYiBdd6vwT9qskPx99bO/oeBxvVOl3NK1NsZrqvKDyPqzfy0OC1mmQJs1H5sPjL\nkpyA9/DW1dlxwr1VusO35gKANPaqcrnpVp6WFITCO0UiOt5uHAc=\n=AO3M\n-----END PGP SIGNATURE-----",
        "payload": "tree 375de8ccea3751755767370dfa809c60e006d104\nparent e2a640e0e7bd5153d155b8fcceb7a47c4adb559b\nauthor Jonas Schnelli <dev@jonasschnelli.ch> 1535122074 +0200\ncommitter Jonas Schnelli <dev@jonasschnelli.ch> 1535445059 +0200\n\nQA: Add EC Diffie-Hellman test\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7ab854a23e309474e8548affcd473e44ece4c2dc",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/7ab854a23e309474e8548affcd473e44ece4c2dc",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7ab854a23e309474e8548affcd473e44ece4c2dc/comments",
    "author": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "e2a640e0e7bd5153d155b8fcceb7a47c4adb559b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e2a640e0e7bd5153d155b8fcceb7a47c4adb559b",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/e2a640e0e7bd5153d155b8fcceb7a47c4adb559b"
      }
    ],
    "stats": {
      "total": 20,
      "additions": 20,
      "deletions": 0
    },
    "files": [
      {
        "sha": "49e65f7fbf626b14c3e82a04e491a58a89bdb837",
        "filename": "src/test/key_tests.cpp",
        "status": "modified",
        "additions": 20,
        "deletions": 0,
        "changes": 20,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7ab854a23e309474e8548affcd473e44ece4c2dc/src/test/key_tests.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7ab854a23e309474e8548affcd473e44ece4c2dc/src/test/key_tests.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/key_tests.cpp?ref=7ab854a23e309474e8548affcd473e44ece4c2dc",
        "patch": "@@ -150,6 +150,26 @@ BOOST_AUTO_TEST_CASE(key_test1)\n     BOOST_CHECK(key2C.SignCompact(hashMsg, detsigc));\n     BOOST_CHECK(detsig == ParseHex(\"1c52d8a32079c11e79db95af63bb9600c5b04f21a9ca33dc129c2bfa8ac9dc1cd561d8ae5e0f6c1a16bde3719c64c2fd70e404b6428ab9a69566962e8771b5944d\"));\n     BOOST_CHECK(detsigc == ParseHex(\"2052d8a32079c11e79db95af63bb9600c5b04f21a9ca33dc129c2bfa8ac9dc1cd561d8ae5e0f6c1a16bde3719c64c2fd70e404b6428ab9a69566962e8771b5944d\"));\n+\n+    // test EC Diffie-Hellman secret computation\n+    CPrivKey secret1;\n+    CPrivKey secret2;\n+    BOOST_CHECK(key1C.ComputeECDHSecret(pubkey2, secret1));\n+    BOOST_CHECK(key2C.ComputeECDHSecret(pubkey1, secret2));\n+    BOOST_CHECK(secret1.size() == 32);\n+    BOOST_CHECK(secret1 == secret2);\n+    // invalid pubkey test\n+    std::vector<unsigned char> pubkeydata;\n+    pubkeydata.insert(pubkeydata.end(), pubkey1C.begin(), pubkey1C.end());\n+    pubkeydata[0] = 0xFF;\n+    CPubKey pubkey1_invalid(pubkeydata);\n+    BOOST_CHECK(key2.ComputeECDHSecret(pubkey1_invalid, secret2) == false);\n+    pubkeydata[0] = 0x03;\n+    CPubKey pubkey2_invalid(pubkeydata);\n+    BOOST_CHECK(key2.ComputeECDHSecret(pubkey2_invalid, secret2) == true);\n+    pubkeydata[9] = 0xFF;\n+    CPubKey pubkey3_invalid(pubkeydata);\n+    BOOST_CHECK(key2.ComputeECDHSecret(pubkey3_invalid, secret2) == false);\n }\n \n BOOST_AUTO_TEST_CASE(key_signature_tests)"
      }
    ]
  }
]