[
  {
    "sha": "9f7341b0787e581f7b7b9fec294ca4d3859299b3",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5ZjczNDFiMDc4N2U1ODFmN2I3YjlmZWMyOTRjYTRkMzg1OTI5OWIz",
    "commit": {
      "author": {
        "name": "Gregory Sanders",
        "email": "gsanders87@gmail.com",
        "date": "2016-07-20T18:49:32Z"
      },
      "committer": {
        "name": "Gregory Sanders",
        "email": "gsanders87@gmail.com",
        "date": "2017-05-17T17:30:42Z"
      },
      "message": "Add witness data output to TxInError messages",
      "tree": {
        "sha": "b803c98969b84a2c9b5131224184b8e40997d38d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b803c98969b84a2c9b5131224184b8e40997d38d"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9f7341b0787e581f7b7b9fec294ca4d3859299b3",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9f7341b0787e581f7b7b9fec294ca4d3859299b3",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/9f7341b0787e581f7b7b9fec294ca4d3859299b3",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9f7341b0787e581f7b7b9fec294ca4d3859299b3/comments",
    "author": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "776ba233e939fe41a74c6b2632b93a0679a32c71",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/776ba233e939fe41a74c6b2632b93a0679a32c71",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/776ba233e939fe41a74c6b2632b93a0679a32c71"
      }
    ],
    "stats": {
      "total": 5,
      "additions": 5,
      "deletions": 0
    },
    "files": [
      {
        "sha": "683bb25246780b9c209940f4d7f8596b9e34a99f",
        "filename": "src/rpc/rawtransaction.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 0,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9f7341b0787e581f7b7b9fec294ca4d3859299b3/src/rpc/rawtransaction.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9f7341b0787e581f7b7b9fec294ca4d3859299b3/src/rpc/rawtransaction.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpc/rawtransaction.cpp?ref=9f7341b0787e581f7b7b9fec294ca4d3859299b3",
        "patch": "@@ -523,6 +523,11 @@ static void TxInErrorToJSON(const CTxIn& txin, UniValue& vErrorsRet, const std::\n     UniValue entry(UniValue::VOBJ);\n     entry.push_back(Pair(\"txid\", txin.prevout.hash.ToString()));\n     entry.push_back(Pair(\"vout\", (uint64_t)txin.prevout.n));\n+    UniValue witness(UniValue::VARR);\n+    for (unsigned int i = 0; i < txin.scriptWitness.stack.size(); i++) {\n+        witness.push_back(HexStr(txin.scriptWitness.stack[i].begin(), txin.scriptWitness.stack[i].end()));\n+    }\n+    entry.push_back(Pair(\"witness\", witness));\n     entry.push_back(Pair(\"scriptSig\", HexStr(txin.scriptSig.begin(), txin.scriptSig.end())));\n     entry.push_back(Pair(\"sequence\", (uint64_t)txin.nSequence));\n     entry.push_back(Pair(\"error\", strMessage));"
      }
    ]
  },
  {
    "sha": "6e9e02665674209b0b43f2aebecc7bb71e527054",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo2ZTllMDI2NjU2NzQyMDliMGI0M2YyYWViZWNjN2JiNzFlNTI3MDU0",
    "commit": {
      "author": {
        "name": "Gregory Sanders",
        "email": "gsanders87@gmail.com",
        "date": "2016-08-03T13:04:50Z"
      },
      "committer": {
        "name": "Gregory Sanders",
        "email": "gsanders87@gmail.com",
        "date": "2017-05-17T17:30:42Z"
      },
      "message": "Expand signrawtransaction.py to cover error witness checking",
      "tree": {
        "sha": "7a786c138dfbcff248c90cfc2a41459402956173",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7a786c138dfbcff248c90cfc2a41459402956173"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6e9e02665674209b0b43f2aebecc7bb71e527054",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6e9e02665674209b0b43f2aebecc7bb71e527054",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/6e9e02665674209b0b43f2aebecc7bb71e527054",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6e9e02665674209b0b43f2aebecc7bb71e527054/comments",
    "author": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "9f7341b0787e581f7b7b9fec294ca4d3859299b3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9f7341b0787e581f7b7b9fec294ca4d3859299b3",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/9f7341b0787e581f7b7b9fec294ca4d3859299b3"
      }
    ],
    "stats": {
      "total": 27,
      "additions": 27,
      "deletions": 0
    },
    "files": [
      {
        "sha": "437905e764fbf236f6472d2d2d65730880ac1704",
        "filename": "test/functional/signrawtransactions.py",
        "status": "modified",
        "additions": 27,
        "deletions": 0,
        "changes": 27,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6e9e02665674209b0b43f2aebecc7bb71e527054/test/functional/signrawtransactions.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6e9e02665674209b0b43f2aebecc7bb71e527054/test/functional/signrawtransactions.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/signrawtransactions.py?ref=6e9e02665674209b0b43f2aebecc7bb71e527054",
        "patch": "@@ -114,6 +114,7 @@ def script_verification_error_test(self):\n         # 5) Script verification errors have certain properties\n         assert 'txid' in rawTxSigned['errors'][0]\n         assert 'vout' in rawTxSigned['errors'][0]\n+        assert 'witness' in rawTxSigned['errors'][0]\n         assert 'scriptSig' in rawTxSigned['errors'][0]\n         assert 'sequence' in rawTxSigned['errors'][0]\n         assert 'error' in rawTxSigned['errors'][0]\n@@ -123,6 +124,32 @@ def script_verification_error_test(self):\n         assert_equal(rawTxSigned['errors'][0]['vout'], inputs[1]['vout'])\n         assert_equal(rawTxSigned['errors'][1]['txid'], inputs[2]['txid'])\n         assert_equal(rawTxSigned['errors'][1]['vout'], inputs[2]['vout'])\n+        assert not rawTxSigned['errors'][0]['witness']\n+\n+        # Now test signing failure for transaction with input witnesses\n+        p2wpkh_raw_tx = \"01000000000102fff7f7881a8099afa6940d42d1e7f6362bec38171ea3edf433541db4e4ad969f00000000494830450221008b9d1dc26ba6a9cb62127b02742fa9d754cd3bebf337f7a55d114c8e5cdd30be022040529b194ba3f9281a99f2b1c0a19c0489bc22ede944ccf4ecbab4cc618ef3ed01eeffffffef51e1b804cc89d182d279655c3aa89e815b1b309fe287d9b2b55d57b90ec68a0100000000ffffffff02202cb206000000001976a9148280b37df378db99f66f85c95a783a76ac7a6d5988ac9093510d000000001976a9143bde42dbee7e4dbe6a21b2d50ce2f0167faa815988ac000247304402203609e17b84f6a7d30c80bfa610b5b4542f32a8a0d5447a12fb1366d7f01cc44a0220573a954c4518331561406f90300e8f3358f51928d43c212a8caed02de67eebee0121025476c2e83188368da1ff3e292e7acafcdb3566bb0ad253f62fc70f07aeee635711000000\"\n+\n+        rawTxSigned = self.nodes[0].signrawtransaction(p2wpkh_raw_tx)\n+\n+        # 7) The transaction has no complete set of signatures\n+        assert 'complete' in rawTxSigned\n+        assert_equal(rawTxSigned['complete'], False)\n+\n+        # 8) Two script verification errors occurred\n+        assert 'errors' in rawTxSigned\n+        assert_equal(len(rawTxSigned['errors']), 2)\n+\n+        # 9) Script verification errors have certain properties\n+        assert 'txid' in rawTxSigned['errors'][0]\n+        assert 'vout' in rawTxSigned['errors'][0]\n+        assert 'witness' in rawTxSigned['errors'][0]\n+        assert 'scriptSig' in rawTxSigned['errors'][0]\n+        assert 'sequence' in rawTxSigned['errors'][0]\n+        assert 'error' in rawTxSigned['errors'][0]\n+\n+        # Non-empty witness checked here\n+        assert_equal(rawTxSigned['errors'][1]['witness'], [\"304402203609e17b84f6a7d30c80bfa610b5b4542f32a8a0d5447a12fb1366d7f01cc44a0220573a954c4518331561406f90300e8f3358f51928d43c212a8caed02de67eebee01\", \"025476c2e83188368da1ff3e292e7acafcdb3566bb0ad253f62fc70f07aeee6357\"])\n+        assert not rawTxSigned['errors'][0]['witness']\n \n     def run_test(self):\n         self.successful_signing_test()"
      }
    ]
  }
]