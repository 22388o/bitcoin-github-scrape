makevoid,2016-03-03T11:27:05Z,"That's the preview of the change, the qr image has the bitcoin address label underneath so that when it's saved you can match it:\n![](http://mkvd.s3.amazonaws.com/pics/qr_bc_core_pr.png)\n",https://github.com/bitcoin/bitcoin/pull/7636#issuecomment-191717414,191717414,
laanwj,2016-03-03T11:36:41Z,"Haven't looked at the code, but screenshot looks good to me, nice work.\n",https://github.com/bitcoin/bitcoin/pull/7636#issuecomment-191719546,191719546,
jonasschnelli,2016-03-03T11:42:30Z,"Thanks!\n\nHaving a malicious QRCode can probably only  happen if you system, Bitcoin-Core or at least libqrencode is compromise.\n\nYour PR would only protect from an attack on libqrencode and only if the user uses a self-compiled Bitcoin-Core (official binaries are static linked). Because, if you could tamper Bitcoin-Core, you could change the address at a core point which would also provide a m",https://github.com/bitcoin/bitcoin/pull/7636#issuecomment-191721180,191721180,
laanwj,2016-03-03T11:44:36Z,"> IMO this PR does not hurt, although I don't believe that is increases security.\n\nIf anything at the printer side is compromised, you're out of luck. But what about a malicious QR code _reader_? I think it could help there, comparing the address before accepting the transaction in your wallet.\n",https://github.com/bitcoin/bitcoin/pull/7636#issuecomment-191721856,191721856,
MarcoFalke,2016-03-03T11:47:03Z,"Right, I think it makes sense to have a human readable version of the QR code besides it. Concept ACK.\n",https://github.com/bitcoin/bitcoin/pull/7636#issuecomment-191722303,191722303,
jonasschnelli,2016-03-03T11:49:45Z,Yes. I just thought people could already do this because they have the address below the QRCode already. But this PR makes it more prominent available.\n,https://github.com/bitcoin/bitcoin/pull/7636#issuecomment-191722853,191722853,
paveljanik,2016-03-03T12:47:21Z,Testing on OS X. The image is blurred. Original image is OK:\n\nCurrent master: \n![before](https://cloud.githubusercontent.com/assets/6848764/13494701/2c81a37c-e146-11e5-8cb0-46b445e491db.png)\n\nThis PR:\n![after](https://cloud.githubusercontent.com/assets/6848764/13494704/32154172-e146-11e5-976b-c1773a7283d2.png)\n\nThe Request payment window shows only the top part of the address:\n\n<img widt,https://github.com/bitcoin/bitcoin/pull/7636#issuecomment-191749292,191749292,
makevoid,2016-03-03T13:42:54Z,"I removed the anti-aliasing (I should I've imagined that it was bad for qr code scanning) and now it shouldn't have that blurring problem on OSX as it uses the same size as the size it's using to display it (`300`), anyway I will double-check it in few hours on that OS.\n\nThe only thing that's changed now is the export size, the final image is 44 pixel larger for each dimension. The good thing th",https://github.com/bitcoin/bitcoin/pull/7636#issuecomment-191764749,191764749,
paveljanik,2016-03-03T13:57:36Z,"One new warning generated:\n\n```\n+qt/receiverequestdialog.cpp:184:73: warning: implicit conversion from 'double' to 'int' changes value from 8.5 to 8 [-Wliteral-conversion]\n+            painter.setFont(QFont(GUIUtil::fixedPitchFont().toString(), 8.5));\n+                            ~~~~~                                       ^~~\n+1 warning generated.\n```\n",https://github.com/bitcoin/bitcoin/pull/7636#issuecomment-191770357,191770357,
luke-jr,2016-03-03T13:59:38Z,So now the window displays the address twice? Maybe just add it to the image when it's being saved...?\n,https://github.com/bitcoin/bitcoin/pull/7636#issuecomment-191771738,191771738,
paveljanik,2016-03-03T14:02:40Z,"@luke-jr If displayed properly, the address is displayed four times! Title bar, image, bitcoin: URL and address. 8)\n",https://github.com/bitcoin/bitcoin/pull/7636#issuecomment-191773522,191773522,
jonasschnelli,2016-03-03T16:07:46Z,"Hmm... font feels a bit small on my end (HiDPI/retina OSX):\n\n<img width=""599"" alt=""bildschirmfoto 2016-03-03 um 17 06 04"" src=""https://cloud.githubusercontent.com/assets/178464/13500300/44c1a77c-e162-11e5-94eb-13a8cd99b465.png"">\n",https://github.com/bitcoin/bitcoin/pull/7636#issuecomment-191829133,191829133,
laanwj,2016-03-03T16:40:28Z,"> So now the window displays the address twice? Maybe just add it to the image when it's being saved...?\n\nWell at least people can't complain they're missing the address :-)\nI don't think this is much of a concern, it's not like the window is short on space.\n",https://github.com/bitcoin/bitcoin/pull/7636#issuecomment-191845053,191845053,
laanwj,2016-03-03T16:41:26Z,"One thing I do wonder about though: do QR scanners need an empty (white) border around a QR code? If so, how large should it be?\n",https://github.com/bitcoin/bitcoin/pull/7636#issuecomment-191845514,191845514,
jonasschnelli,2016-03-03T16:45:26Z,"@laanwj: I recently played around with max QR size/bytes, black/white (inverted) and the white-space-border. I could not find any specification about the ""quite zone"" (white border), but I guess ""one square width"" as min border size should be more as sufficient. I guess it depends on the QRCode reader implementation. But I could not read the QRCode with common readers if there where no white borde",https://github.com/bitcoin/bitcoin/pull/7636#issuecomment-191848436,191848436,
sipa,2016-03-03T16:46:06Z,"Scanners don't need a border I believe, but printers may.\n",https://github.com/bitcoin/bitcoin/pull/7636#issuecomment-191849147,191849147,
sipa,2016-03-03T16:52:25Z,"Seems I misremembered. Some googling shows that the spec actually includes\na quiet zone around the QR code, 4 modules wide, with the same color as the\nwhite modules.\n",https://github.com/bitcoin/bitcoin/pull/7636#issuecomment-191854170,191854170,
paveljanik,2016-03-10T12:52:06Z,"Current status:\n\n<img width=""479"" alt=""screen shot 2016-03-10 at 13 50 18"" src=""https://cloud.githubusercontent.com/assets/6848764/13669936/1b7fbb1e-e6c7-11e5-9447-73cd380ddcbb.png"">\n",https://github.com/bitcoin/bitcoin/pull/7636#issuecomment-194829527,194829527,
jonasschnelli,2016-03-13T09:25:25Z,"Still not really readable on retina/HiDPI OSX:\n<img width=""663"" alt=""bildschirmfoto 2016-03-13 um 10 24 24"" src=""https://cloud.githubusercontent.com/assets/178464/13727910/d85aee4e-e905-11e5-8cf3-6a57df683fb8.png"">\n",https://github.com/bitcoin/bitcoin/pull/7636#issuecomment-195920098,195920098,
jonasschnelli,2016-04-05T07:31:44Z,ping @makevoid: I think this PR is almost ready. We just need a way that the font size respects the screen density (HiDPI).\n,https://github.com/bitcoin/bitcoin/pull/7636#issuecomment-205698724,205698724,
jonasschnelli,2016-06-02T09:12:48Z,ping @makevoid\n,https://github.com/bitcoin/bitcoin/pull/7636#issuecomment-223237836,223237836,
laanwj,2016-06-13T09:29:39Z,> We just need a way that the font size respects the screen density (HiDPI).\n\nI'd say no because this is exported to an image file. We don't want the output to be dependent on the user's screen resolution.\n,https://github.com/bitcoin/bitcoin/pull/7636#issuecomment-225531911,225531911,
jonasschnelli,2016-06-13T09:33:07Z,@laanwj: check https://github.com/bitcoin/bitcoin/pull/7636#issuecomment-195920098\nThe font size on HiDPI is different then on non-HiDPI.\n\nI can take care about this and finish this PR.\n,https://github.com/bitcoin/bitcoin/pull/7636#issuecomment-225532705,225532705,
makevoid,2016-06-13T09:35:04Z,"Sorry but I don't have an HiDPI screen to test with yet, is there anything I can do? should I squash the commits?\n",https://github.com/bitcoin/bitcoin/pull/7636#issuecomment-225533134,225533134,
laanwj,2016-06-13T09:40:16Z,"> The font size on HiDPI is different then on non-HiDPI.\n\nJust a matter of misunderstanding / wrong formulation then - what we want here is to use a font size that is fixed in pixel size, just like the QR code itself is.\n",https://github.com/bitcoin/bitcoin/pull/7636#issuecomment-225534326,225534326,
jonasschnelli,2016-06-13T13:43:52Z,"The QRCode is not rendered HiDPI (not required). Setting the font size in pixel works (because the size of the `QImage` is fixed in pixels not in points).\nThe only little downside is the missing HiDPI support for the new address (looks a bit pixled here).\n\n<img width=""599"" alt=""bildschirmfoto 2016-06-13 um 15 41 25"" src=""https://cloud.githubusercontent.com/assets/178464/16009555/859230ee-317d-1",https://github.com/bitcoin/bitcoin/pull/7636#issuecomment-225584450,225584450,
MarcoFalke,2016-06-13T13:57:59Z,> `+            QFont font = QFont(GUIUtil::fixedPitchFont().toString());`\n\nfixedPitchFont() already returns QFont. Is this odd constructor necessary?\n,https://github.com/bitcoin/bitcoin/pull/7636#issuecomment-225588510,225588510,
jonasschnelli,2016-06-13T14:03:58Z,@MarcoFalke: Oh yes.\n@makevoid: please use `QFont font = GUIUtil::fixedPitchFont();`.\n,https://github.com/bitcoin/bitcoin/pull/7636#issuecomment-225590309,225590309,
makevoid,2016-06-13T15:12:54Z,@jonasschnelli done: https://github.com/bitcoin/bitcoin/pull/7636/commits/1c2a1bac0ad6901868c1a4003c7cbddcdf46a29b#diff-23ecec8032dd36794001112346601b6aR186\n,https://github.com/bitcoin/bitcoin/pull/7636#issuecomment-225611396,225611396,
MarcoFalke,2016-06-13T15:51:56Z, utACK 1c2a1ba\n,https://github.com/bitcoin/bitcoin/pull/7636#issuecomment-225623650,225623650,
jonasschnelli,2016-06-14T11:13:18Z,"Tested ACK 1c2a1bac0ad6901868c1a4003c7cbddcdf46a29b.\n\nLooks also good on Win(10).\nHiDPI issues on windows are unrelated to this PR (we need Qt5.6.1).\n\n<img width=""436"" alt=""bildschirmfoto 2016-06-14 um 13 03 32"" src=""https://cloud.githubusercontent.com/assets/178464/16040721/b1c0b92e-3231-11e6-97de-9755a20440f5.png"">\n",https://github.com/bitcoin/bitcoin/pull/7636#issuecomment-225850701,225850701,
jonasschnelli,2016-03-03T12:48:27Z,QRCodes should not use anti-aliasing (QT::SmoothTransformation). I guess this should be removed.\n,https://github.com/bitcoin/bitcoin/pull/7636#discussion_r54874745,54874745,src/qt/receiverequestdialog.cpp
jonasschnelli,2016-03-03T16:10:54Z,Maybe add a [`QFont::setPointSize()`](http://doc.qt.io/qt-5/qfont.html#setPointSize) here to avoid HiDPI differences?\n,https://github.com/bitcoin/bitcoin/pull/7636#discussion_r54902173,54902173,src/qt/receiverequestdialog.cpp
jonasschnelli,2016-03-13T09:31:14Z,Maybe some clever rule to detect the width of the text we want to draw – and make it bigger if there is more horizontal space?\n\nGet width:\n\n``` c++\n QFontMetrics fm(painter.font());\n int pixelsWide = fm.width(info.address);\n```\n,https://github.com/bitcoin/bitcoin/pull/7636#discussion_r55934440,55934440,src/qt/receiverequestdialog.cpp
