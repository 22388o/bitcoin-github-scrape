[
  {
    "sha": "db15805668e923c3493d77122d20926496cf6a1a",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpkYjE1ODA1NjY4ZTkyM2MzNDkzZDc3MTIyZDIwOTI2NDk2Y2Y2YTFh",
    "commit": {
      "author": {
        "name": "gustavonalle",
        "email": "gustavonalle@gmail.com",
        "date": "2018-09-24T15:10:23Z"
      },
      "committer": {
        "name": "gustavonalle",
        "email": "gustavonalle@gmail.com",
        "date": "2018-09-24T17:13:22Z"
      },
      "message": "[wallet] Ensure wallet is unlocked before signing",
      "tree": {
        "sha": "82429ad993cdedecbada746600e82caaf9cd7c99",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/82429ad993cdedecbada746600e82caaf9cd7c99"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/db15805668e923c3493d77122d20926496cf6a1a",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/db15805668e923c3493d77122d20926496cf6a1a",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/db15805668e923c3493d77122d20926496cf6a1a",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/db15805668e923c3493d77122d20926496cf6a1a/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "985d28cc90eda7f637b47cda78e74099d3df8734",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/985d28cc90eda7f637b47cda78e74099d3df8734",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/985d28cc90eda7f637b47cda78e74099d3df8734"
      }
    ],
    "stats": {
      "total": 11,
      "additions": 11,
      "deletions": 0
    },
    "files": [
      {
        "sha": "8a402546a7bf7a99269078df9669166249eecee7",
        "filename": "src/wallet/rpcwallet.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/db15805668e923c3493d77122d20926496cf6a1a/src/wallet/rpcwallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/db15805668e923c3493d77122d20926496cf6a1a/src/wallet/rpcwallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcwallet.cpp?ref=db15805668e923c3493d77122d20926496cf6a1a",
        "patch": "@@ -3116,6 +3116,8 @@ UniValue signrawtransactionwithwallet(const JSONRPCRequest& request)\n \n     // Sign the transaction\n     LOCK2(cs_main, pwallet->cs_wallet);\n+    EnsureWalletIsUnlocked(pwallet);\n+\n     return SignTransaction(mtx, request.params[1], pwallet, false, request.params[2]);\n }\n "
      },
      {
        "sha": "98648dd43674e76e2a86e858161fa38aeae9883e",
        "filename": "test/functional/rpc_signrawtransaction.py",
        "status": "modified",
        "additions": 9,
        "deletions": 0,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/db15805668e923c3493d77122d20926496cf6a1a/test/functional/rpc_signrawtransaction.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/db15805668e923c3493d77122d20926496cf6a1a/test/functional/rpc_signrawtransaction.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/rpc_signrawtransaction.py?ref=db15805668e923c3493d77122d20926496cf6a1a",
        "patch": "@@ -45,6 +45,14 @@ def successful_signing_test(self):\n         # 2) No script verification error occurred\n         assert 'errors' not in rawTxSigned\n \n+    def test_with_lock_outputs(self):\n+        \"\"\"Test correct error reporting when trying to sign a locked output\"\"\"\n+        self.nodes[0].encryptwallet(\"password\")\n+        self.restart_node(0)\n+        rawTx = '020000000156b958f78e3f24e0b2f4e4db1255426b0902027cb37e3ddadb52e37c3557dddb0000000000ffffffff01c0a6b929010000001600149a2ee8c77140a053f36018ac8124a6ececc1668a00000000'\n+\n+        assert_raises_rpc_error(-13, \"Please enter the wallet passphrase with walletpassphrase first\", self.nodes[0].signrawtransactionwithwallet, rawTx)\n+\n     def script_verification_error_test(self):\n         \"\"\"Create and sign a raw transaction with valid (vin 0), invalid (vin 1) and one missing (vin 2) input script.\n \n@@ -138,6 +146,7 @@ def script_verification_error_test(self):\n     def run_test(self):\n         self.successful_signing_test()\n         self.script_verification_error_test()\n+        self.test_with_lock_outputs()\n \n \n if __name__ == '__main__':"
      }
    ]
  },
  {
    "sha": "20442f617f7f86cbdde1c41c1165e2b750f756c7",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyMDQ0MmY2MTdmN2Y4NmNiZGRlMWM0MWMxMTY1ZTJiNzUwZjc1NmM3",
    "commit": {
      "author": {
        "name": "gustavonalle",
        "email": "gustavonalle@gmail.com",
        "date": "2018-09-24T19:30:16Z"
      },
      "committer": {
        "name": "gustavonalle",
        "email": "gustavonalle@gmail.com",
        "date": "2018-09-25T06:00:19Z"
      },
      "message": "[wallet] remove redundand restart node",
      "tree": {
        "sha": "e50a616f4ea41dd8cc2ff9055b0aa50f35d50418",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e50a616f4ea41dd8cc2ff9055b0aa50f35d50418"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/20442f617f7f86cbdde1c41c1165e2b750f756c7",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/20442f617f7f86cbdde1c41c1165e2b750f756c7",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/20442f617f7f86cbdde1c41c1165e2b750f756c7",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/20442f617f7f86cbdde1c41c1165e2b750f756c7/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "db15805668e923c3493d77122d20926496cf6a1a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/db15805668e923c3493d77122d20926496cf6a1a",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/db15805668e923c3493d77122d20926496cf6a1a"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 1,
      "deletions": 1
    },
    "files": [
      {
        "sha": "291538df64863b4443d949702207855c39c1dbbc",
        "filename": "test/functional/rpc_signrawtransaction.py",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/20442f617f7f86cbdde1c41c1165e2b750f756c7/test/functional/rpc_signrawtransaction.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/20442f617f7f86cbdde1c41c1165e2b750f756c7/test/functional/rpc_signrawtransaction.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/rpc_signrawtransaction.py?ref=20442f617f7f86cbdde1c41c1165e2b750f756c7",
        "patch": "@@ -48,7 +48,7 @@ def successful_signing_test(self):\n     def test_with_lock_outputs(self):\n         \"\"\"Test correct error reporting when trying to sign a locked output\"\"\"\n         self.nodes[0].encryptwallet(\"password\")\n-        self.restart_node(0)\n+\n         rawTx = '020000000156b958f78e3f24e0b2f4e4db1255426b0902027cb37e3ddadb52e37c3557dddb0000000000ffffffff01c0a6b929010000001600149a2ee8c77140a053f36018ac8124a6ececc1668a00000000'\n \n         assert_raises_rpc_error(-13, \"Please enter the wallet passphrase with walletpassphrase first\", self.nodes[0].signrawtransactionwithwallet, rawTx)"
      }
    ]
  }
]