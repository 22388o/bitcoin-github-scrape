[
  {
    "sha": "11404af34c5e3d5aa334e1cfd8edee82fb9dc9a4",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxMTQwNGFmMzRjNWUzZDVhYTMzNGUxY2ZkOGVkZWU4MmZiOWRjOWE0",
    "commit": {
      "author": {
        "name": "Cory Fields",
        "email": "cory-nospam-@coryfields.com",
        "date": "2014-06-13T23:18:13Z"
      },
      "committer": {
        "name": "Cory Fields",
        "email": "cory-nospam-@coryfields.com",
        "date": "2014-06-16T21:21:34Z"
      },
      "message": "sanity: autoconf check for sys/select.h",
      "tree": {
        "sha": "277b28abb58411befa447d672235e3467ad78ab2",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/277b28abb58411befa447d672235e3467ad78ab2"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/11404af34c5e3d5aa334e1cfd8edee82fb9dc9a4",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/11404af34c5e3d5aa334e1cfd8edee82fb9dc9a4",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/11404af34c5e3d5aa334e1cfd8edee82fb9dc9a4",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/11404af34c5e3d5aa334e1cfd8edee82fb9dc9a4/comments",
    "author": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "529047fcd18acd1b64dc95d6eb69edeaad75d405",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/529047fcd18acd1b64dc95d6eb69edeaad75d405",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/529047fcd18acd1b64dc95d6eb69edeaad75d405"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 1,
      "deletions": 1
    },
    "files": [
      {
        "sha": "81a32f9fb7594d77954f0e68178ac133d25dc69b",
        "filename": "configure.ac",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/11404af34c5e3d5aa334e1cfd8edee82fb9dc9a4/configure.ac",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/11404af34c5e3d5aa334e1cfd8edee82fb9dc9a4/configure.ac",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/configure.ac?ref=11404af34c5e3d5aa334e1cfd8edee82fb9dc9a4",
        "patch": "@@ -368,7 +368,7 @@ if test x$TARGET_OS = xdarwin; then\n   AX_CHECK_LINK_FLAG([[-Wl,-dead_strip]], [LDFLAGS=\"$LDFLAGS -Wl,-dead_strip\"])\n fi\n \n-AC_CHECK_HEADERS([stdio.h stdlib.h unistd.h strings.h sys/types.h sys/stat.h])\n+AC_CHECK_HEADERS([stdio.h stdlib.h unistd.h strings.h sys/types.h sys/stat.h sys/select.h])\n \n dnl Check for MSG_NOSIGNAL\n AC_MSG_CHECKING(for MSG_NOSIGNAL)"
      }
    ]
  },
  {
    "sha": "679240d0e92f71b38cefd23e3d99e8ebf63c2508",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo2NzkyNDBkMGU5MmY3MWIzOGNlZmQyM2UzZDk5ZThlYmY2M2MyNTA4",
    "commit": {
      "author": {
        "name": "Cory Fields",
        "email": "cory-nospam-@coryfields.com",
        "date": "2014-06-13T23:19:35Z"
      },
      "committer": {
        "name": "Cory Fields",
        "email": "cory-nospam-@coryfields.com",
        "date": "2014-06-16T21:21:34Z"
      },
      "message": "sanity: add libc/stdlib sanity checks\n\nThese are meant to test our back-compat stubs, but they are enabled for all\nbuilds for the sake of consistency.",
      "tree": {
        "sha": "31b055adc3fcd07bb6b58903a590165de90cacce",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/31b055adc3fcd07bb6b58903a590165de90cacce"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/679240d0e92f71b38cefd23e3d99e8ebf63c2508",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/679240d0e92f71b38cefd23e3d99e8ebf63c2508",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/679240d0e92f71b38cefd23e3d99e8ebf63c2508",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/679240d0e92f71b38cefd23e3d99e8ebf63c2508/comments",
    "author": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "11404af34c5e3d5aa334e1cfd8edee82fb9dc9a4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/11404af34c5e3d5aa334e1cfd8edee82fb9dc9a4",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/11404af34c5e3d5aa334e1cfd8edee82fb9dc9a4"
      }
    ],
    "stats": {
      "total": 134,
      "additions": 133,
      "deletions": 1
    },
    "files": [
      {
        "sha": "e1542203f8e7d6d1966683b342501ce2124ed61c",
        "filename": "src/Makefile.am",
        "status": "modified",
        "additions": 4,
        "deletions": 1,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/679240d0e92f71b38cefd23e3d99e8ebf63c2508/src/Makefile.am",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/679240d0e92f71b38cefd23e3d99e8ebf63c2508/src/Makefile.am",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/Makefile.am?ref=679240d0e92f71b38cefd23e3d99e8ebf63c2508",
        "patch": "@@ -85,7 +85,8 @@ BITCOIN_CORE_H = \\\n   util.h \\\n   version.h \\\n   walletdb.h \\\n-  wallet.h\n+  wallet.h \\\n+  compat/sanity.h\n \n JSON_H = \\\n   json/json_spirit.h \\\n@@ -154,6 +155,8 @@ libbitcoin_common_a_SOURCES = \\\n   sync.cpp \\\n   util.cpp \\\n   version.cpp \\\n+  compat/glibc_sanity.cpp \\\n+  compat/glibcxx_sanity.cpp \\\n   $(BITCOIN_CORE_H)\n \n if GLIBC_BACK_COMPAT"
      },
      {
        "sha": "1f64df9e337044f23a5315d7b1ab18c2b057055c",
        "filename": "src/compat/glibc_sanity.cpp",
        "status": "added",
        "additions": 61,
        "deletions": 0,
        "changes": 61,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/679240d0e92f71b38cefd23e3d99e8ebf63c2508/src/compat/glibc_sanity.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/679240d0e92f71b38cefd23e3d99e8ebf63c2508/src/compat/glibc_sanity.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/compat/glibc_sanity.cpp?ref=679240d0e92f71b38cefd23e3d99e8ebf63c2508",
        "patch": "@@ -0,0 +1,61 @@\n+#include \"bitcoin-config.h\"\n+\n+#include <cstddef>\n+#if defined(HAVE_SYS_SELECT_H)\n+#include <sys/select.h>\n+#endif\n+\n+extern \"C\" void* memcpy(void* a, const void* b, size_t c);\n+void* memcpy_int(void* a, const void* b, size_t c)\n+{\n+  return memcpy(a,b,c);\n+}\n+\n+namespace {\n+// trigger: Use the memcpy_int wrapper which calls our internal memcpy.\n+//   A direct call to memcpy may be optimized away by the compiler.\n+// test: Fill an array with a sequence of integers. memcpy to a new empty array.\n+//   Verify that the arrays are equal. Use an odd size to decrease the odds of\n+//   the call being optimized away.\n+template <unsigned int T>\n+bool sanity_test_memcpy()\n+{\n+    unsigned int memcpy_test[T];\n+    unsigned int memcpy_verify[T] = {};\n+    for (unsigned int i = 0; i != T; ++i)\n+        memcpy_test[i] = i;\n+\n+    memcpy_int(memcpy_verify,memcpy_test,sizeof(memcpy_test));\n+\n+    for (unsigned int i = 0; i != T; ++i)\n+    {\n+        if(memcpy_verify[i] != i)\n+            return false;\n+    }\n+    return true;\n+}\n+\n+#if defined(HAVE_SYS_SELECT_H)\n+// trigger: Call FD_SET to trigger __fdelt_chk. FORTIFY_SOURCE must be defined\n+//   as >0 and optimizations must be set to at least -O2.\n+// test: Add a file descriptor to an empty fd_set. Verify that it has been\n+//   correctly added.\n+bool sanity_test_fdelt()\n+{\n+    fd_set fds;\n+    FD_ZERO(&fds);\n+    FD_SET(0, &fds);\n+    return FD_ISSET(0,&fds);\n+}\n+#endif\n+\n+} // anon namespace\n+\n+bool glibc_sanity_test()\n+{\n+#if defined(HAVE_SYS_SELECT_H)\n+    if (!sanity_test_fdelt())\n+        return false;\n+#endif\n+    return sanity_test_memcpy<1025>();\n+}"
      },
      {
        "sha": "2ff70948fd703539994d48943d5690fbc85b84e2",
        "filename": "src/compat/glibcxx_sanity.cpp",
        "status": "added",
        "additions": 61,
        "deletions": 0,
        "changes": 61,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/679240d0e92f71b38cefd23e3d99e8ebf63c2508/src/compat/glibcxx_sanity.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/679240d0e92f71b38cefd23e3d99e8ebf63c2508/src/compat/glibcxx_sanity.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/compat/glibcxx_sanity.cpp?ref=679240d0e92f71b38cefd23e3d99e8ebf63c2508",
        "patch": "@@ -0,0 +1,61 @@\n+#include <locale>\n+#include <list>\n+#include <stdexcept>\n+\n+namespace{\n+\n+// trigger: use ctype<char>::widen to trigger ctype<char>::_M_widen_init().\n+// test: convert a char from narrow to wide and back. Verify that the result\n+//   matches the original.\n+bool sanity_test_widen(char testchar)\n+{\n+    const std::ctype<char>& test(std::use_facet< std::ctype<char> >(std::locale()));\n+    return test.narrow(test.widen(testchar),'b') == testchar;\n+}\n+\n+// trigger: use list::push_back and list::pop_back to trigger _M_hook and\n+//   _M_unhook.\n+// test: Push a sequence of integers into a list. Pop them off and verify that\n+//   they match the original sequence.\n+bool sanity_test_list(unsigned int size)\n+{\n+    std::list<unsigned int> test;\n+    for (unsigned int i = 0; i != size; ++i)\n+        test.push_back(i+1);\n+\n+    if (test.size() != size)\n+        return false;\n+\n+    while (!test.empty())\n+    {\n+        if(test.back() != test.size())\n+            return false;\n+        test.pop_back();\n+    }\n+    return true;\n+}\n+\n+} // anon namespace\n+\n+// trigger: string::at(x) on an empty string to trigger __throw_out_of_range_fmt.\n+// test: force std::string to throw an out_of_range exception. Verify that\n+//   it's caught correctly.\n+bool sanity_test_range_fmt()\n+{\n+    std::string test;\n+    try\n+    {\n+        test.at(1);\n+    }\n+    catch (const std::out_of_range&)\n+    {\n+        return true;\n+    }\n+    catch (...){}\n+    return false;\n+}\n+\n+bool glibcxx_sanity_test()\n+{\n+    return sanity_test_widen('a') && sanity_test_list(100) && sanity_test_range_fmt();\n+}"
      },
      {
        "sha": "a221f69dfcb992cd88ad448284a289da4576d525",
        "filename": "src/compat/sanity.h",
        "status": "added",
        "additions": 7,
        "deletions": 0,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/679240d0e92f71b38cefd23e3d99e8ebf63c2508/src/compat/sanity.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/679240d0e92f71b38cefd23e3d99e8ebf63c2508/src/compat/sanity.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/compat/sanity.h?ref=679240d0e92f71b38cefd23e3d99e8ebf63c2508",
        "patch": "@@ -0,0 +1,7 @@\n+#ifndef BITCON_COMPAT_SANITY_H\n+#define BITCON_COMPAT_SANITY_H\n+\n+bool glibc_sanity_test();\n+bool glibcxx_sanity_test();\n+\n+#endif"
      }
    ]
  },
  {
    "sha": "92a6220711b3f98c3daad8a8dcdf13f09ce484fd",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5MmE2MjIwNzExYjNmOThjM2RhYWQ4YThkY2RmMTNmMDljZTQ4NGZk",
    "commit": {
      "author": {
        "name": "Cory Fields",
        "email": "cory-nospam-@coryfields.com",
        "date": "2014-06-13T23:23:01Z"
      },
      "committer": {
        "name": "Cory Fields",
        "email": "cory-nospam-@coryfields.com",
        "date": "2014-06-16T21:21:34Z"
      },
      "message": "sanity: hook up sanity checks",
      "tree": {
        "sha": "53969cd9f404dbcfb7b7bb944a3a4609b5dae61d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/53969cd9f404dbcfb7b7bb944a3a4609b5dae61d"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/92a6220711b3f98c3daad8a8dcdf13f09ce484fd",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/92a6220711b3f98c3daad8a8dcdf13f09ce484fd",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/92a6220711b3f98c3daad8a8dcdf13f09ce484fd",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/92a6220711b3f98c3daad8a8dcdf13f09ce484fd/comments",
    "author": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "679240d0e92f71b38cefd23e3d99e8ebf63c2508",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/679240d0e92f71b38cefd23e3d99e8ebf63c2508",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/679240d0e92f71b38cefd23e3d99e8ebf63c2508"
      }
    ],
    "stats": {
      "total": 5,
      "additions": 3,
      "deletions": 2
    },
    "files": [
      {
        "sha": "f3df3cb375c671d5db4114eb0ea8e4ba724a1d3a",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 2,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/92a6220711b3f98c3daad8a8dcdf13f09ce484fd/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/92a6220711b3f98c3daad8a8dcdf13f09ce484fd/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=92a6220711b3f98c3daad8a8dcdf13f09ce484fd",
        "patch": "@@ -31,6 +31,7 @@\n #ifndef WIN32\n #include <signal.h>\n #endif\n+#include \"compat/sanity.h\"\n \n #include <boost/algorithm/string/predicate.hpp>\n #include <boost/filesystem.hpp>\n@@ -417,8 +418,8 @@ bool InitSanityCheck(void)\n                   \"information, visit https://en.bitcoin.it/wiki/OpenSSL_and_EC_Libraries\");\n         return false;\n     }\n-\n-    // TODO: remaining sanity checks, see #4081\n+    if (!glibc_sanity_test() || !glibcxx_sanity_test())\n+        return false;\n \n     return true;\n }"
      }
    ]
  }
]