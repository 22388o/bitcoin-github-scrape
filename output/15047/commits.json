[
  {
    "sha": "fad058a79fe6f8d85e408d1c1954de8b86944039",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYWQwNThhNzlmZTZmOGQ4NWU0MDhkMWMxOTU0ZGU4Yjg2OTQ0MDM5",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2018-12-27T14:19:39Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2019-01-05T18:06:03Z"
      },
      "message": "build: Allow to configure --with-sanitizers=fuzzer",
      "tree": {
        "sha": "6e4ff8086d41798a4aadd893e68a6f47fad8cbe2",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6e4ff8086d41798a4aadd893e68a6f47fad8cbe2"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fad058a79fe6f8d85e408d1c1954de8b86944039",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGcBAABCgAGBQJcMPILAAoJEM4rdWl+aaVImSsMAMxE1JalrDqsI1txNYigw4Rf\nNnJDmIAYjijXrzd+C8fXr6T0T5tpnWLVS8SAeAaG8T6xnOzUcqbEpZN47gqdfc2H\nObBhXTXJBSSNXWYl+ItMkCQDLSdiaFUZ4Sttyzkud3iNZ4/5BEs/gYS8W3ffK2S7\ncstY2SdlN23ar2ZW3Cc8+Xt3BKPuvkbRXx+i7VdOlyy5spioxhaRAHfiDedSfVz/\nXwUAGIE6kBbZPOC+bolBgU39fLro4UqEaN/FaDPvc49KHHKpTpYTMHSIFDVTAZFw\nXD7bog8okVOHpjumWCoP3u1oucVx8zey5PESFwYt/u56sMY26ejsyqQ66dl/zH2r\nhCXYrrMLbK+K6ZTKg9sLlAEsaOsp7J6499/FYvNSdZd0RxgLiKPA7tRgjS7XmMJy\nis7xqd34AETZRa1dAUeIB3AkEgsFLocqB/b4det+uz7uzPHxhq4plTYS6/sCTl08\naQW+XlpijONKdYvRAbD3H2omrqRxI0eSENuqCWFUUw==\n=Ctei\n-----END PGP SIGNATURE-----",
        "payload": "tree 6e4ff8086d41798a4aadd893e68a6f47fad8cbe2\nparent fe5a70b9fefa0548f497a749746f53f3d7fd0ebb\nauthor MarcoFalke <falke.marco@gmail.com> 1545920379 +0100\ncommitter MarcoFalke <falke.marco@gmail.com> 1546711563 +0100\n\nbuild: Allow to configure --with-sanitizers=fuzzer\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fad058a79fe6f8d85e408d1c1954de8b86944039",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fad058a79fe6f8d85e408d1c1954de8b86944039",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fad058a79fe6f8d85e408d1c1954de8b86944039/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "fe5a70b9fefa0548f497a749746f53f3d7fd0ebb",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fe5a70b9fefa0548f497a749746f53f3d7fd0ebb",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/fe5a70b9fefa0548f497a749746f53f3d7fd0ebb"
      }
    ],
    "stats": {
      "total": 43,
      "additions": 33,
      "deletions": 10
    },
    "files": [
      {
        "sha": "1319af8c8637f36691b579e9f8399e55db59568b",
        "filename": "configure.ac",
        "status": "modified",
        "additions": 8,
        "deletions": 1,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fad058a79fe6f8d85e408d1c1954de8b86944039/configure.ac",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fad058a79fe6f8d85e408d1c1954de8b86944039/configure.ac",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/configure.ac?ref=fad058a79fe6f8d85e408d1c1954de8b86944039",
        "patch": "@@ -295,7 +295,14 @@ if test x$use_sanitizers != x; then\n   AX_CHECK_LINK_FLAG(\n     [[-fsanitize=$use_sanitizers]],\n     [[SANITIZER_LDFLAGS=-fsanitize=$use_sanitizers]],\n-    [AC_MSG_ERROR([linker did not accept requested flags, you are missing required libraries])])\n+    [AC_MSG_ERROR([linker did not accept requested flags, you are missing required libraries])],\n+    [],\n+    [AC_LANG_PROGRAM([[\n+    #include <cstdint>\n+    #include <cstddef>\n+    extern \"C\" int LLVMFuzzerTestOneInput(const uint8_t *data, size_t size) { return 0; }\n+    __attribute__((weak)) // allow for libFuzzer linking\n+    ]],[[]])])\n fi\n \n ERROR_CXXFLAGS="
      },
      {
        "sha": "dff9e71bbab65dec0ee8dd3d6210da6f7b3d3803",
        "filename": "doc/fuzzing.md",
        "status": "modified",
        "additions": 25,
        "deletions": 9,
        "changes": 34,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fad058a79fe6f8d85e408d1c1954de8b86944039/doc/fuzzing.md",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fad058a79fe6f8d85e408d1c1954de8b86944039/doc/fuzzing.md",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/doc/fuzzing.md?ref=fad058a79fe6f8d85e408d1c1954de8b86944039",
        "patch": "@@ -3,10 +3,11 @@ Fuzz-testing Bitcoin Core\n \n A special test harness `test_bitcoin_fuzzy` is provided to provide an easy\n entry point for fuzzers and the like. In this document we'll describe how to\n-use it with AFL.\n+use it with AFL and libFuzzer.\n \n-Building AFL\n--------------\n+## AFL\n+\n+### Building AFL\n \n It is recommended to always use the latest version of afl:\n ```\n@@ -17,8 +18,7 @@ make\n export AFLPATH=$PWD\n ```\n \n-Instrumentation\n-----------------\n+### Instrumentation\n \n To build Bitcoin Core using AFL instrumentation (this assumes that the\n `AFLPATH` was set as above):\n@@ -39,8 +39,7 @@ compiling using `afl-clang-fast`/`afl-clang-fast++` the resulting\n features \"persistent mode\" and \"deferred forkserver\" can be used. See\n https://github.com/mcarpenter/afl/tree/master/llvm_mode for details.\n \n-Preparing fuzzing\n-------------------\n+### Preparing fuzzing\n \n AFL needs an input directory with examples, and an output directory where it\n will place examples that it found. These can be anywhere in the file system,\n@@ -60,8 +59,7 @@ Example inputs are available from:\n \n Extract these (or other starting inputs) into the `inputs` directory before starting fuzzing.\n \n-Fuzzing\n---------\n+### Fuzzing\n \n To start the actual fuzzing use:\n ```\n@@ -70,3 +68,21 @@ $AFLPATH/afl-fuzz -i ${AFLIN} -o ${AFLOUT} -m52 -- test/test_bitcoin_fuzzy\n \n You may have to change a few kernel parameters to test optimally - `afl-fuzz`\n will print an error and suggestion if so.\n+\n+## libFuzzer\n+\n+A recent version of `clang`, the address sanitizer and libFuzzer is needed (all\n+found in the `compiler-rt` runtime libraries package).\n+\n+To build the `test/test_bitcoin_fuzzy` executable run\n+\n+```\n+./configure --disable-ccache --with-sanitizers=fuzzer,address CC=clang CXX=clang++\n+make\n+```\n+\n+The fuzzer needs some inputs to work on, but the inputs or seeds can be used\n+interchangably between libFuzzer and AFL.\n+\n+See https://llvm.org/docs/LibFuzzer.html#running on how to run the libFuzzer\n+instrumented executable."
      }
    ]
  }
]