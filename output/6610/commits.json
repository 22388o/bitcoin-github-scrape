[
  {
    "sha": "4e2bc875f327b34d16378467235c66bd9693d555",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0ZTJiYzg3NWYzMjdiMzRkMTYzNzg0NjcyMzVjNjZiZDk2OTNkNTU1",
    "commit": {
      "author": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-08-30T08:04:18Z"
      },
      "committer": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-08-30T08:04:18Z"
      },
      "message": "Revert \"Make sure we re-acquire lock if a task throws\"\n\nThis reverts commit fb08d92312312c6c896327d264a8e9915fdafae7.",
      "tree": {
        "sha": "a552ec8c7430b1f6b224c31cb2da39260c08d012",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a552ec8c7430b1f6b224c31cb2da39260c08d012"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4e2bc875f327b34d16378467235c66bd9693d555",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4e2bc875f327b34d16378467235c66bd9693d555",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/4e2bc875f327b34d16378467235c66bd9693d555",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4e2bc875f327b34d16378467235c66bd9693d555/comments",
    "author": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "ea19c2bc3f2281ad319457c6fa518bff96af13e3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ea19c2bc3f2281ad319457c6fa518bff96af13e3",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/ea19c2bc3f2281ad319457c6fa518bff96af13e3"
      }
    ],
    "stats": {
      "total": 12,
      "additions": 5,
      "deletions": 7
    },
    "files": [
      {
        "sha": "d5bb588b712961aa7eb8a1bb4c452ed6452af8b3",
        "filename": "src/scheduler.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 7,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4e2bc875f327b34d16378467235c66bd9693d555/src/scheduler.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4e2bc875f327b34d16378467235c66bd9693d555/src/scheduler.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/scheduler.cpp?ref=4e2bc875f327b34d16378467235c66bd9693d555",
        "patch": "@@ -6,7 +6,6 @@\n \n #include <assert.h>\n #include <boost/bind.hpp>\n-#include <boost/thread/reverse_lock.hpp>\n #include <utility>\n \n CScheduler::CScheduler() : nThreadsServicingQueue(0), stopRequested(false), stopWhenEmpty(false)\n@@ -66,12 +65,11 @@ void CScheduler::serviceQueue()\n             Function f = taskQueue.begin()->second;\n             taskQueue.erase(taskQueue.begin());\n \n-            {\n-                // Unlock before calling f, so it can reschedule itself or another task\n-                // without deadlocking:\n-                boost::reverse_lock<boost::unique_lock<boost::mutex> > rlock(lock);\n-                f();\n-            }\n+            // Unlock before calling f, so it can reschedule itself or another task\n+            // without deadlocking:\n+            lock.unlock();\n+            f();\n+            lock.lock();\n         } catch (...) {\n             --nThreadsServicingQueue;\n             throw;"
      }
    ]
  },
  {
    "sha": "59d1a8bc2f68f420433929b0e2fd30b4cb3974d3",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1OWQxYThiYzJmNjhmNDIwNDMzOTI5YjBlMmZkMzBiNGNiMzk3NGQz",
    "commit": {
      "author": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-08-30T08:07:09Z"
      },
      "committer": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2015-09-01T00:29:00Z"
      },
      "message": "Ensure that CScheduler::newTaskMutex is locked if f() throws an exception.\n\nPrior to this fix there existed a race condition from the failure to re-acquire the lock.",
      "tree": {
        "sha": "af5bbcd0b4929956286a3c246f6ca85f2edf4aae",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/af5bbcd0b4929956286a3c246f6ca85f2edf4aae"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/59d1a8bc2f68f420433929b0e2fd30b4cb3974d3",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQEcBAABAgAGBQJV5PKVAAoJEHfoBoKoPbQODzMH/i/jsXODDh/7XA1L3q6GwY22\nzUmeDM1jGBkW/PL2+isez2OcA5TOVNNFUZvuXSeCkZI8IJ2MSGEM4Mn1rGCFNgbW\nlAmOUjCH751LAYqCXQOAo2X5Umk0WQkSTVDI2y4G7a/XgrHr3flZyuY1n6bSKh7y\n7KKDgrAyngQJtH4/Sq/YQX7e6+Sq0uwGZDD1tFgWxBiXvr+ny2CJtssJPLc7rTcg\njXGFscHjYojdwXe8SGQJ7t5NWSJK6ebekb1yQ0mHmgFARqqVIMy6f1dr1HfVH75m\n2gIatybLPPqDPuy1nHK5I9amtEgrCb+cx4kuAYvIvhVbXQ3PIHfMSCFfSmFaGFU=\n=rltJ\n-----END PGP SIGNATURE-----",
        "payload": "tree af5bbcd0b4929956286a3c246f6ca85f2edf4aae\nparent 4e2bc875f327b34d16378467235c66bd9693d555\nauthor Patrick Strateman <patrick.strateman@gmail.com> 1440922029 -0700\ncommitter Patrick Strateman <patrick.strateman@gmail.com> 1441067340 -0700\n\nEnsure that CScheduler::newTaskMutex is locked if f() throws an exception.\n\nPrior to this fix there existed a race condition from the failure to re-acquire the lock.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/59d1a8bc2f68f420433929b0e2fd30b4cb3974d3",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/59d1a8bc2f68f420433929b0e2fd30b4cb3974d3",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/59d1a8bc2f68f420433929b0e2fd30b4cb3974d3/comments",
    "author": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "4e2bc875f327b34d16378467235c66bd9693d555",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4e2bc875f327b34d16378467235c66bd9693d555",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/4e2bc875f327b34d16378467235c66bd9693d555"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 2,
      "deletions": 0
    },
    "files": [
      {
        "sha": "c9d3f4f26e1602d208e36b351701430568fb2942",
        "filename": "src/scheduler.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/59d1a8bc2f68f420433929b0e2fd30b4cb3974d3/src/scheduler.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/59d1a8bc2f68f420433929b0e2fd30b4cb3974d3/src/scheduler.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/scheduler.cpp?ref=59d1a8bc2f68f420433929b0e2fd30b4cb3974d3",
        "patch": "@@ -71,6 +71,8 @@ void CScheduler::serviceQueue()\n             f();\n             lock.lock();\n         } catch (...) {\n+            if (!lock.owns_lock())\n+                lock.lock();\n             --nThreadsServicingQueue;\n             throw;\n         }"
      }
    ]
  }
]