TheBlueMatt,2017-01-20T15:52:34Z,"Because our p2p protocol defines most messages as completely blocking (ie if you send a block message the remote peer must have processed it before processing any other messages from you), I dont think this is the right approach. I think we're gonna need something more along the lines of multiple ProcessMessages threads (as well as all the lock contention fixes that are going into 0.14).",https://github.com/bitcoin/bitcoin/pull/9599#issuecomment-274105843,274105843,
rebroad,2017-01-21T01:56:20Z,"@TheBlueMatt you are of course correct, given that the protocol is defined by the code, but was this designed intentionally? Is there any advantage in this blocking?\n\nUpon further thought, I don't think this is a concern, as this PR only affects during IBD and not when the chain is synced, so the behaviour is the same, but just means that ping times are not affected (as they are currently) and",https://github.com/bitcoin/bitcoin/pull/9599#issuecomment-274224234,274224234,
TheBlueMatt,2017-01-21T04:30:14Z,"Indeed, this fact developed by accident simply because that's how the\nimplementation worked. However, as time went on, other implementations\n(and even Bitcoin Core, though to a lesser extent) started relying on\nthis part of the protocol, so we can't do much to change it now.\n\nEven still, it isn't such a bad design, in the end, as it both\nsimplifies some stuff and bounds how much work a node ",https://github.com/bitcoin/bitcoin/pull/9599#issuecomment-274234414,274234414,
rebroad,2017-01-21T06:43:42Z,"@TheBlueMatt With this PR it's still only 1 thread that does the work. I'm not sure how the blocking simplifies stuff - it makes ping times fairly unreliable, and it also causes nodes to timeout and become unresponsive, thereby delaying IBD of all nodes, not just the blocking node. It makes it harder to detect misbehaving nodes also by the fact that the base-line behavior is more unreliable. I thi",https://github.com/bitcoin/bitcoin/pull/9599#issuecomment-274241951,274241951,
TheBlueMatt,2017-01-21T15:25:09Z,"Having latency go up when a node is overloaded provides useful information to its peers - anything where it's peers care about the latency to a node they probably care about whether it can respond quickly to messages.\n\nAt least Bitcoinj relies on it in a few places to, eg, send a getdata followed by ping to know whether the getdata will be responded to.\n\nOn January 21, 2017 1:43:46 AM EST, R E",https://github.com/bitcoin/bitcoin/pull/9599#issuecomment-274268082,274268082,
rebroad,2017-01-23T01:19:15Z,"@TheBlueMatt To try to use an analogy to your argument. Which would you rather have? The ebola virus AND useful information about it - or neither? The useful information about poor latency might be useful, but if we can remove the latency - are we really going to miss it because the useful information about it has gone also? Anyway, we'll still have the historical information about it - but I don'",https://github.com/bitcoin/bitcoin/pull/9599#issuecomment-274376530,274376530,
TheBlueMatt,2017-01-23T13:40:01Z,"Even if we were to decide it was useless, we couldn't remove it. As noted, other clients rely on our serialization behavior pretty heavily (and I'm sure we do, to some extent, though I don't recall any specific places where right now).\n\nOn January 22, 2017 8:19:19 PM EST, R E Broadley <notifications@github.com> wrote:\n>@TheBlueMatt To try to use an analogy to your argument. Which would you\n>ra",https://github.com/bitcoin/bitcoin/pull/9599#issuecomment-274490088,274490088,
gmaxwell,2017-01-29T02:48:18Z,It is a bad design to handle protocol messages out of order for a single peer.,https://github.com/bitcoin/bitcoin/pull/9599#issuecomment-275890042,275890042,
rebroad,2017-01-29T13:43:15Z,"@gmaxwell I agree, but, I think the only place that this could happen with this PR is if a node serves a block and then immediately sends either a getblocks or a getheaders. I'm not aware any nodes are currently doing this, and if they are, I could modify this PR to delay responding to the getheaders or getblocks until the chain has been updated quite easily. If this functionality is so important,",https://github.com/bitcoin/bitcoin/pull/9599#issuecomment-275914524,275914524,
sipa,2017-04-09T16:01:07Z,"This seems to break the P2P protocol, closing.",https://github.com/bitcoin/bitcoin/pull/9599#issuecomment-292794556,292794556,
