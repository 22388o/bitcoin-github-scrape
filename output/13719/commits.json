[
  {
    "sha": "84547fa6d408bdda1685f6d5972232bb19d97a7d",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4NDU0N2ZhNmQ0MDhiZGRhMTY4NWY2ZDU5NzIyMzJiYjE5ZDk3YTdk",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2018-07-19T00:52:43Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2018-07-19T23:16:37Z"
      },
      "message": "Avoid creating a temporary vector for size-prefixed elements",
      "tree": {
        "sha": "2ff4d9ba84086f1e1d9fab2206893d6b5cfe25f1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2ff4d9ba84086f1e1d9fab2206893d6b5cfe25f1"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/84547fa6d408bdda1685f6d5972232bb19d97a7d",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/84547fa6d408bdda1685f6d5972232bb19d97a7d",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/84547fa6d408bdda1685f6d5972232bb19d97a7d",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/84547fa6d408bdda1685f6d5972232bb19d97a7d/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "4a3e8c5aa6a5d8dda15a76d644b2a9f0f40cdec7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4a3e8c5aa6a5d8dda15a76d644b2a9f0f40cdec7",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/4a3e8c5aa6a5d8dda15a76d644b2a9f0f40cdec7"
      }
    ],
    "stats": {
      "total": 26,
      "additions": 16,
      "deletions": 10
    },
    "files": [
      {
        "sha": "250b63703566b6acae518c3622a0b890d621ff4e",
        "filename": "src/script/sign.h",
        "status": "modified",
        "additions": 8,
        "deletions": 10,
        "changes": 18,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/84547fa6d408bdda1685f6d5972232bb19d97a7d/src/script/sign.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/84547fa6d408bdda1685f6d5972232bb19d97a7d/src/script/sign.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/script/sign.h?ref=84547fa6d408bdda1685f6d5972232bb19d97a7d",
        "patch": "@@ -116,26 +116,24 @@ static constexpr uint8_t PSBT_OUT_BIP32_DERIVATION = 0x02;\n // as a 0 length key which indicates that this is the separator. The separator has no value.\n static constexpr uint8_t PSBT_SEPARATOR = 0x00;\n \n-// Takes a stream and multiple arguments and serializes them into a vector and then into the stream\n+// Takes a stream and multiple arguments and serializes them as if first serialized into a vector and then into the stream\n // The resulting output into the stream has the total serialized length of all of the objects followed by all objects concatenated with each other.\n template<typename Stream, typename... X>\n void SerializeToVector(Stream& s, const X&... args)\n {\n-    std::vector<unsigned char> ret;\n-    CVectorWriter ss(SER_NETWORK, PROTOCOL_VERSION, ret, 0);\n-    SerializeMany(ss, args...);\n-    s << ret;\n+    WriteCompactSize(s, GetSerializeSizeMany(s, args...));\n+    SerializeMany(s, args...);\n }\n \n // Takes a stream and multiple arguments and unserializes them first as a vector then each object individually in the order provided in the arguments\n template<typename Stream, typename... X>\n void UnserializeFromVector(Stream& s, X&... args)\n {\n-    std::vector<unsigned char> data;\n-    s >> data;\n-    CDataStream ss(data, SER_NETWORK, PROTOCOL_VERSION);\n-    UnserializeMany(ss, args...);\n-    if (!ss.eof()) {\n+    size_t expected_size = ReadCompactSize(s);\n+    size_t remaining_before = s.size();\n+    UnserializeMany(s, args...);\n+    size_t remaining_after = s.size();\n+    if (remaining_after + expected_size != remaining_before) {\n         throw std::ios_base::failure(\"Size of value was not the stated size\");\n     }\n }"
      },
      {
        "sha": "627225b6ef78206e0b3d24a97bccdb503d0f6e28",
        "filename": "src/serialize.h",
        "status": "modified",
        "additions": 8,
        "deletions": 0,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/84547fa6d408bdda1685f6d5972232bb19d97a7d/src/serialize.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/84547fa6d408bdda1685f6d5972232bb19d97a7d/src/serialize.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/serialize.h?ref=84547fa6d408bdda1685f6d5972232bb19d97a7d",
        "patch": "@@ -991,4 +991,12 @@ size_t GetSerializeSize(const S& s, const T& t)\n     return (CSizeComputer(s.GetType(), s.GetVersion()) << t).size();\n }\n \n+template <typename S, typename... T>\n+size_t GetSerializeSizeMany(const S& s, const T&... t)\n+{\n+    CSizeComputer sc(s.GetType(), s.GetVersion());\n+    SerializeMany(sc, t...);\n+    return sc.size();\n+}\n+\n #endif // BITCOIN_SERIALIZE_H"
      }
    ]
  }
]