[
  {
    "sha": "3e957622a85ec81e845ae082172a9be3d7b23087",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozZTk1NzYyMmE4NWVjODFlODQ1YWUwODIxNzJhOWJlM2Q3YjIzMDg3",
    "commit": {
      "author": {
        "name": "R E Broadley",
        "email": "rebroad+github@gmail.com",
        "date": "2016-10-18T15:19:44Z"
      },
      "committer": {
        "name": "R E Broadley",
        "email": "rebroad+github@gmail.com",
        "date": "2016-10-18T15:28:30Z"
      },
      "message": "Additional UpdateBlockAvailability when we send/receive blocks.",
      "tree": {
        "sha": "ff2a837e813b1e1785093668fc1eb08626aa7673",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ff2a837e813b1e1785093668fc1eb08626aa7673"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3e957622a85ec81e845ae082172a9be3d7b23087",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3e957622a85ec81e845ae082172a9be3d7b23087",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/3e957622a85ec81e845ae082172a9be3d7b23087",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3e957622a85ec81e845ae082172a9be3d7b23087/comments",
    "author": {
      "login": "rebroad",
      "id": 1530283,
      "node_id": "MDQ6VXNlcjE1MzAyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rebroad",
      "html_url": "https://github.com/rebroad",
      "followers_url": "https://api.github.com/users/rebroad/followers",
      "following_url": "https://api.github.com/users/rebroad/following{/other_user}",
      "gists_url": "https://api.github.com/users/rebroad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
      "organizations_url": "https://api.github.com/users/rebroad/orgs",
      "repos_url": "https://api.github.com/users/rebroad/repos",
      "events_url": "https://api.github.com/users/rebroad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rebroad/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "rebroad",
      "id": 1530283,
      "node_id": "MDQ6VXNlcjE1MzAyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rebroad",
      "html_url": "https://github.com/rebroad",
      "followers_url": "https://api.github.com/users/rebroad/followers",
      "following_url": "https://api.github.com/users/rebroad/following{/other_user}",
      "gists_url": "https://api.github.com/users/rebroad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
      "organizations_url": "https://api.github.com/users/rebroad/orgs",
      "repos_url": "https://api.github.com/users/rebroad/repos",
      "events_url": "https://api.github.com/users/rebroad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rebroad/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "49c5910372899a365fd6b57b9e227518e24541fa",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/49c5910372899a365fd6b57b9e227518e24541fa",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/49c5910372899a365fd6b57b9e227518e24541fa"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 2,
      "deletions": 0
    },
    "files": [
      {
        "sha": "0c267d553df0a8ea1529ba4d7663944ddc0e8643",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3e957622a85ec81e845ae082172a9be3d7b23087/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3e957622a85ec81e845ae082172a9be3d7b23087/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=3e957622a85ec81e845ae082172a9be3d7b23087",
        "patch": "@@ -3758,6 +3758,7 @@ bool ProcessNewBlock(CValidationState& state, const CChainParams& chainparams, C\n         bool ret = AcceptBlock(*pblock, state, chainparams, &pindex, fRequested, dbp, &fNewBlock);\n         if (pindex && pfrom) {\n             mapBlockSource[pindex->GetBlockHash()] = pfrom->GetId();\n+            UpdateBlockAvailability(pfrom->id, pindex->GetBlockHash());\n             if (fNewBlock) pfrom->nLastBlockTime = GetTime();\n         }\n         CheckBlockIndex(chainparams.GetConsensus());\n@@ -4888,6 +4889,7 @@ void static ProcessGetData(CNode* pfrom, const Consensus::Params& consensusParam\n                         pfrom->PushMessage(NetMsgType::INV, vInv);\n                         pfrom->hashContinue.SetNull();\n                     }\n+                    UpdateBlockAvailability(pfrom->id, inv.hash);\n                 }\n             }\n             else if (inv.type == MSG_TX || inv.type == MSG_WITNESS_TX)"
      }
    ]
  },
  {
    "sha": "a1d706674a903ab6d0637699abffc4b9ef889621",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzphMWQ3MDY2NzRhOTAzYWI2ZDA2Mzc2OTlhYmZmYzRiOWVmODg5NjIx",
    "commit": {
      "author": {
        "name": "R E Broadley",
        "email": "rebroad+github@gmail.com",
        "date": "2016-10-18T06:05:25Z"
      },
      "committer": {
        "name": "R E Broadley",
        "email": "rebroad+github@gmail.com",
        "date": "2016-10-18T15:29:48Z"
      },
      "message": "UpdateBlockAvailability when we broadcast new blocks.",
      "tree": {
        "sha": "02112b85d0fa00eebf29d2ce022ddc12bf7dff7e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/02112b85d0fa00eebf29d2ce022ddc12bf7dff7e"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a1d706674a903ab6d0637699abffc4b9ef889621",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a1d706674a903ab6d0637699abffc4b9ef889621",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/a1d706674a903ab6d0637699abffc4b9ef889621",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a1d706674a903ab6d0637699abffc4b9ef889621/comments",
    "author": {
      "login": "rebroad",
      "id": 1530283,
      "node_id": "MDQ6VXNlcjE1MzAyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rebroad",
      "html_url": "https://github.com/rebroad",
      "followers_url": "https://api.github.com/users/rebroad/followers",
      "following_url": "https://api.github.com/users/rebroad/following{/other_user}",
      "gists_url": "https://api.github.com/users/rebroad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
      "organizations_url": "https://api.github.com/users/rebroad/orgs",
      "repos_url": "https://api.github.com/users/rebroad/repos",
      "events_url": "https://api.github.com/users/rebroad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rebroad/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "rebroad",
      "id": 1530283,
      "node_id": "MDQ6VXNlcjE1MzAyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rebroad",
      "html_url": "https://github.com/rebroad",
      "followers_url": "https://api.github.com/users/rebroad/followers",
      "following_url": "https://api.github.com/users/rebroad/following{/other_user}",
      "gists_url": "https://api.github.com/users/rebroad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
      "organizations_url": "https://api.github.com/users/rebroad/orgs",
      "repos_url": "https://api.github.com/users/rebroad/repos",
      "events_url": "https://api.github.com/users/rebroad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rebroad/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "3e957622a85ec81e845ae082172a9be3d7b23087",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3e957622a85ec81e845ae082172a9be3d7b23087",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/3e957622a85ec81e845ae082172a9be3d7b23087"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 2,
      "deletions": 0
    },
    "files": [
      {
        "sha": "f6194cbad4cf62980a9f3817b05983d4f029fe81",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/a1d706674a903ab6d0637699abffc4b9ef889621/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/a1d706674a903ab6d0637699abffc4b9ef889621/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=a1d706674a903ab6d0637699abffc4b9ef889621",
        "patch": "@@ -6586,6 +6586,7 @@ bool SendMessages(CNode* pto, CConnman& connman)\n                                 vHeaders.front().GetHash().ToString(), pto->id);\n                     }\n                     pto->PushMessage(NetMsgType::HEADERS, vHeaders);\n+                    UpdateBlockAvailability(pto->id, vHeaders.front().GetHash());\n                     state.pindexBestHeaderSent = pBestIndex;\n                 } else\n                     fRevertToInv = true;\n@@ -6611,6 +6612,7 @@ bool SendMessages(CNode* pto, CConnman& connman)\n                     // If the peer's chain has this block, don't inv it back.\n                     if (!PeerHasHeader(&state, pindex)) {\n                         pto->PushInventory(CInv(MSG_BLOCK, hashToAnnounce));\n+                        UpdateBlockAvailability(pto->id, hashToAnnounce);\n                         LogPrint(\"net\", \"%s: sending inv peer=%d hash=%s\\n\", __func__,\n                             pto->id, hashToAnnounce.ToString());\n                     }"
      }
    ]
  }
]