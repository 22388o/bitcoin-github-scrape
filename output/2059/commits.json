[
  {
    "sha": "0ae0712b1c00352d926e0c9a72d97377c472301c",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzowYWUwNzEyYjFjMDAzNTJkOTI2ZTBjOWE3MmQ5NzM3N2M0NzIzMDFj",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-12-01T17:07:55Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-12-05T22:06:01Z"
      },
      "message": "Add GetTimeMicros() for ore accurate benchmarking",
      "tree": {
        "sha": "c762e015eac22701b5be04801e745900f8a50597",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c762e015eac22701b5be04801e745900f8a50597"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0ae0712b1c00352d926e0c9a72d97377c472301c",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0ae0712b1c00352d926e0c9a72d97377c472301c",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/0ae0712b1c00352d926e0c9a72d97377c472301c",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0ae0712b1c00352d926e0c9a72d97377c472301c/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "a485c1b69e282883414dfb387d0aac1cfa21533d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a485c1b69e282883414dfb387d0aac1cfa21533d",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/a485c1b69e282883414dfb387d0aac1cfa21533d"
      }
    ],
    "stats": {
      "total": 6,
      "additions": 6,
      "deletions": 0
    },
    "files": [
      {
        "sha": "1ed5c30aaef753c42195bd1b4919fe95b897e9de",
        "filename": "src/util.h",
        "status": "modified",
        "additions": 6,
        "deletions": 0,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/0ae0712b1c00352d926e0c9a72d97377c472301c/src/util.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/0ae0712b1c00352d926e0c9a72d97377c472301c/src/util.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/util.h?ref=0ae0712b1c00352d926e0c9a72d97377c472301c",
        "patch": "@@ -330,6 +330,12 @@ inline int64 GetTimeMillis()\n             boost::posix_time::ptime(boost::gregorian::date(1970,1,1))).total_milliseconds();\n }\n \n+inline int64 GetTimeMicros()\n+{\n+    return (boost::posix_time::ptime(boost::posix_time::microsec_clock::universal_time()) -\n+            boost::posix_time::ptime(boost::gregorian::date(1970,1,1))).total_microseconds();\n+}\n+\n inline std::string DateTimeStrFormat(const char* pszFormat, int64 nTime)\n {\n     time_t n = nTime;"
      }
    ]
  },
  {
    "sha": "8a28bb6deee2df7dac3288c1bc6db6221e5e43b6",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4YTI4YmI2ZGVlZTJkZjdkYWMzMjg4YzFiYzZkYjYyMjFlNWU0M2I2",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-12-01T19:10:23Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-12-05T22:06:01Z"
      },
      "message": "Add -benchmark for reporting block processing times",
      "tree": {
        "sha": "a9907ac7bf4f0460228f9c35b3c591e98a75467f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a9907ac7bf4f0460228f9c35b3c591e98a75467f"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8a28bb6deee2df7dac3288c1bc6db6221e5e43b6",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8a28bb6deee2df7dac3288c1bc6db6221e5e43b6",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/8a28bb6deee2df7dac3288c1bc6db6221e5e43b6",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8a28bb6deee2df7dac3288c1bc6db6221e5e43b6/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "0ae0712b1c00352d926e0c9a72d97377c472301c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0ae0712b1c00352d926e0c9a72d97377c472301c",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/0ae0712b1c00352d926e0c9a72d97377c472301c"
      }
    ],
    "stats": {
      "total": 22,
      "additions": 22,
      "deletions": 0
    },
    "files": [
      {
        "sha": "ddc9f26254d4dae09423ea514c4bea971a7aaa76",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/8a28bb6deee2df7dac3288c1bc6db6221e5e43b6/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/8a28bb6deee2df7dac3288c1bc6db6221e5e43b6/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=8a28bb6deee2df7dac3288c1bc6db6221e5e43b6",
        "patch": "@@ -481,6 +481,7 @@ bool AppInit2()\n     // ********************************************************* Step 3: parameter-to-internal-flags\n \n     fDebug = GetBoolArg(\"-debug\");\n+    fBenchmark = GetBoolArg(\"-benchmark\");\n \n     // -debug implies fDebug*\n     if (fDebug)"
      },
      {
        "sha": "e4e59874a18984cddc9f623a39ba45eb307f05cc",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 20,
        "deletions": 0,
        "changes": 20,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/8a28bb6deee2df7dac3288c1bc6db6221e5e43b6/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/8a28bb6deee2df7dac3288c1bc6db6221e5e43b6/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=8a28bb6deee2df7dac3288c1bc6db6221e5e43b6",
        "patch": "@@ -42,6 +42,7 @@ set<CBlockIndex*, CBlockIndexWorkComparator> setBlockIndexValid; // may contain\n int64 nTimeBestReceived = 0;\n bool fImporting = false;\n bool fReindex = false;\n+bool fBenchmark = false;\n unsigned int nCoinCacheSize = 5000;\n \n CMedianFilter<int> cPeerBlockCounts(5, 0); // Amount of blocks that other nodes claim to have\n@@ -1586,12 +1587,16 @@ bool CBlock::ConnectBlock(CBlockIndex* pindex, CCoinsViewCache &view, bool fJust\n \n     CBlockUndo blockundo;\n \n+    int64 nStart = GetTimeMicros();\n     int64 nFees = 0;\n+    int nInputs = 0;\n     unsigned int nSigOps = 0;\n     for (unsigned int i=0; i<vtx.size(); i++)\n     {\n+\n         const CTransaction &tx = vtx[i];\n \n+        nInputs += tx.vin.size();\n         nSigOps += tx.GetLegacySigOpCount();\n         if (nSigOps > MAX_BLOCK_SIGOPS)\n             return DoS(100, error(\"ConnectBlock() : too many sigops\"));\n@@ -1622,7 +1627,11 @@ bool CBlock::ConnectBlock(CBlockIndex* pindex, CCoinsViewCache &view, bool fJust\n             return error(\"ConnectBlock() : UpdateInputs failed\");\n         if (!tx.IsCoinBase())\n             blockundo.vtxundo.push_back(txundo);\n+\n     }\n+    int64 nTime = GetTimeMicros() - nStart;\n+    if (fBenchmark)\n+        printf(\"- Connect %u transactions: %.2fms (%.3fms/tx, %.3fms/txin)\\n\", (unsigned)vtx.size(), 0.001 * nTime, 0.001 * nTime / vtx.size(), nInputs <= 1 ? 0 : 0.001 * nTime / (nInputs-1));\n \n     if (vtx[0].GetValueOut() > GetBlockValue(pindex->nHeight, nFees))\n         return error(\"ConnectBlock() : coinbase pays too much (actual=%\"PRI64d\" vs limit=%\"PRI64d\")\", vtx[0].GetValueOut(), GetBlockValue(pindex->nHeight, nFees));\n@@ -1720,8 +1729,11 @@ bool SetBestChain(CBlockIndex* pindexNew)\n         CBlock block;\n         if (!block.ReadFromDisk(pindex))\n             return error(\"SetBestBlock() : ReadFromDisk for disconnect failed\");\n+        int64 nStart = GetTimeMicros();\n         if (!block.DisconnectBlock(pindex, view))\n             return error(\"SetBestBlock() : DisconnectBlock %s failed\", BlockHashStr(pindex->GetBlockHash()).c_str());\n+        if (fBenchmark)\n+            printf(\"- Disconnect: %.2fms\\n\", (GetTimeMicros() - nStart) * 0.001);\n \n         // Queue memory transactions to resurrect\n         BOOST_FOREACH(const CTransaction& tx, block.vtx)\n@@ -1735,20 +1747,28 @@ bool SetBestChain(CBlockIndex* pindexNew)\n         CBlock block;\n         if (!block.ReadFromDisk(pindex))\n             return error(\"SetBestBlock() : ReadFromDisk for connect failed\");\n+        int64 nStart = GetTimeMicros();\n         if (!block.ConnectBlock(pindex, view)) {\n             InvalidChainFound(pindexNew);\n             InvalidBlockFound(pindex);\n             return error(\"SetBestBlock() : ConnectBlock %s failed\", BlockHashStr(pindex->GetBlockHash()).c_str());\n         }\n+        if (fBenchmark)\n+            printf(\"- Connect: %.2fms\\n\", (GetTimeMicros() - nStart) * 0.001); \n \n         // Queue memory transactions to delete\n         BOOST_FOREACH(const CTransaction& tx, block.vtx)\n             vDelete.push_back(tx);\n     }\n \n     // Flush changes to global coin state\n+    int64 nStart = GetTimeMicros();\n+    int nModified = view.GetCacheSize();\n     if (!view.Flush())\n         return error(\"SetBestBlock() : unable to modify coin state\");\n+    int64 nTime = GetTimeMicros() - nStart;\n+    if (fBenchmark)\n+        printf(\"- Flush %i transactions: %.2fms (%.4fms/tx)\\n\", nModified, 0.001 * nTime, 0.001 * nTime / nModified);\n \n     // Make sure it's successfully written to disk before changing memory structure\n     bool fIsInitialDownload = IsInitialBlockDownload();"
      },
      {
        "sha": "fdaec3469ea1b223ebb6de3a64a749feb7f93c55",
        "filename": "src/main.h",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/8a28bb6deee2df7dac3288c1bc6db6221e5e43b6/src/main.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/8a28bb6deee2df7dac3288c1bc6db6221e5e43b6/src/main.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.h?ref=8a28bb6deee2df7dac3288c1bc6db6221e5e43b6",
        "patch": "@@ -89,6 +89,7 @@ extern std::set<CWallet*> setpwalletRegistered;\n extern unsigned char pchMessageStart[4];\n extern bool fImporting;\n extern bool fReindex;\n+extern bool fBenchmark;\n extern unsigned int nCoinCacheSize;\n \n // Settings"
      }
    ]
  }
]