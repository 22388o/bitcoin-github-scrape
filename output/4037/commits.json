[
  {
    "sha": "d20791b0e524bb1834ec7776acf0dec84c24861b",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpkMjA3OTFiMGU1MjRiYjE4MzRlYzc3NzZhY2YwZGVjODRjMjQ4NjFi",
    "commit": {
      "author": {
        "name": "Gregory Maxwell",
        "email": "greg@xiph.org",
        "date": "2014-04-09T16:25:52Z"
      },
      "committer": {
        "name": "Gregory Maxwell",
        "email": "greg@xiph.org",
        "date": "2014-04-09T16:30:36Z"
      },
      "message": "Prevent socket leak in ThreadSocketHandler.\n\nWhen we are over our outbound limit ThreadSocketHandler would try to\n keep the connection if the peer was addnoded.\n\nThis didn't actually work for two reasons: It didn't actually run\n the accept code due to mistaken code flow, and because we have a\n limited number of outbound semaphores it couldn't actually use the\n connection.\n\nInstead it leaked the socket, which might have caused issue #4034.\n\nThis patch just takes out the non-functioning white-listing for now.",
      "tree": {
        "sha": "7486f89c07373927ea652406d0ebefa01c77bb5f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7486f89c07373927ea652406d0ebefa01c77bb5f"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d20791b0e524bb1834ec7776acf0dec84c24861b",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d20791b0e524bb1834ec7776acf0dec84c24861b",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/d20791b0e524bb1834ec7776acf0dec84c24861b",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d20791b0e524bb1834ec7776acf0dec84c24861b/comments",
    "author": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "20ecf5c27d808d5e887fe4b1dfd23a4d60003f8e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/20ecf5c27d808d5e887fe4b1dfd23a4d60003f8e",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/20ecf5c27d808d5e887fe4b1dfd23a4d60003f8e"
      }
    ],
    "stats": {
      "total": 6,
      "additions": 1,
      "deletions": 5
    },
    "files": [
      {
        "sha": "a0208c9605b5924961258653fb2fe85df673ffb1",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 5,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d20791b0e524bb1834ec7776acf0dec84c24861b/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d20791b0e524bb1834ec7776acf0dec84c24861b/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=d20791b0e524bb1834ec7776acf0dec84c24861b",
        "patch": "@@ -946,11 +946,7 @@ void ThreadSocketHandler()\n             }\n             else if (nInbound >= nMaxConnections - MAX_OUTBOUND_CONNECTIONS)\n             {\n-                {\n-                    LOCK(cs_setservAddNodeAddresses);\n-                    if (!setservAddNodeAddresses.count(addr))\n-                        closesocket(hSocket);\n-                }\n+                closesocket(hSocket);\n             }\n             else if (CNode::IsBanned(addr))\n             {"
      }
    ]
  },
  {
    "sha": "0bd05b53b155bc28b6e5dfd967cafaafb44a439f",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzowYmQwNWI1M2IxNTViYzI4YjZlNWRmZDk2N2NhZmFhZmI0NGE0Mzlm",
    "commit": {
      "author": {
        "name": "Gregory Maxwell",
        "email": "greg@xiph.org",
        "date": "2014-04-10T00:09:17Z"
      },
      "committer": {
        "name": "Gregory Maxwell",
        "email": "greg@xiph.org",
        "date": "2014-04-10T00:09:45Z"
      },
      "message": "Correct some proxy related socket leaks.",
      "tree": {
        "sha": "e90d8f3131648bfc2c7ce2187f924b248cb325ac",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e90d8f3131648bfc2c7ce2187f924b248cb325ac"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0bd05b53b155bc28b6e5dfd967cafaafb44a439f",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0bd05b53b155bc28b6e5dfd967cafaafb44a439f",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/0bd05b53b155bc28b6e5dfd967cafaafb44a439f",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0bd05b53b155bc28b6e5dfd967cafaafb44a439f/comments",
    "author": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "d20791b0e524bb1834ec7776acf0dec84c24861b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d20791b0e524bb1834ec7776acf0dec84c24861b",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/d20791b0e524bb1834ec7776acf0dec84c24861b"
      }
    ],
    "stats": {
      "total": 9,
      "additions": 7,
      "deletions": 2
    },
    "files": [
      {
        "sha": "2b300e5dd31046d9faf1c2133647fe0078aeb78b",
        "filename": "src/netbase.cpp",
        "status": "modified",
        "additions": 7,
        "deletions": 2,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/0bd05b53b155bc28b6e5dfd967cafaafb44a439f/src/netbase.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/0bd05b53b155bc28b6e5dfd967cafaafb44a439f/src/netbase.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/netbase.cpp?ref=0bd05b53b155bc28b6e5dfd967cafaafb44a439f",
        "patch": "@@ -293,8 +293,10 @@ bool static Socks5(string strDest, int port, SOCKET& hSocket)\n         case 0x03:\n         {\n             ret = recv(hSocket, pchRet3, 1, 0) != 1;\n-            if (ret)\n+            if (ret) {\n+                closesocket(hSocket);\n                 return error(\"Error reading from proxy\");\n+            }\n             int nRecv = pchRet3[0];\n             ret = recv(hSocket, pchRet3, nRecv, 0) != nRecv;\n             break;\n@@ -501,6 +503,7 @@ bool ConnectSocket(const CService &addrDest, SOCKET& hSocketRet, int nTimeout)\n             return false;\n         break;\n     default:\n+        closesocket(hSocket);\n         return false;\n     }\n \n@@ -532,7 +535,9 @@ bool ConnectSocketByName(CService &addr, SOCKET& hSocketRet, const char *pszDest\n \n     switch(nameproxy.second) {\n         default:\n-        case 4: return false;\n+        case 4:\n+            closesocket(hSocket);\n+            return false;\n         case 5:\n             if (!Socks5(strDest, port, hSocket))\n                 return false;"
      }
    ]
  }
]