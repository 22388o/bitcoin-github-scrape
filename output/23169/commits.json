[
  {
    "sha": "10aeb6e6484048b061620d484dbb10dee0ead386",
    "node_id": "C_kwDOABII59oAKDEwYWViNmU2NDg0MDQ4YjA2MTYyMGQ0ODRkYmIxMGRlZTBlYWQzODY",
    "commit": {
      "author": {
        "name": "Martin Leitner-Ankerl",
        "email": "martin.ankerl@gmail.com",
        "date": "2021-10-04T05:48:23Z"
      },
      "committer": {
        "name": "Martin Leitner-Ankerl",
        "email": "martin.ankerl@gmail.com",
        "date": "2021-11-18T06:12:37Z"
      },
      "message": "Initialize members in FastRandomContext correctly\n\nBuilding with `--enable-lto`in #23152 produced a `-Wmaybe-uninitialized`\nwarning in FastRandomContext. This commit fixes the move constructor:\nThere was undefined behavior due to uninitialized copy, and\nuninitialized reads in bytebuf.\n\nThe `FastRandomContext(const uint256& seed)` constructor did not\ninitialize the `uint64_t bitbuf` member, and in\n`FastRandomContext& operator=(FastRandomContext&& from) noexcept;` the\nuninitialized variable was copied with `bitbuf = from.bitbuf;` which\ntechnically is undefined behavior. This happens in `setup_common.cpp`\nin the line `ctx = FastRandomContext(seed);`.",
      "tree": {
        "sha": "0285f3870df7f91eccc64a3ec275df8e832bd62d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0285f3870df7f91eccc64a3ec275df8e832bd62d"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/10aeb6e6484048b061620d484dbb10dee0ead386",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCAAdFiEEqyQrdqB7R6j2Hv2k++qtf8b//oEFAmGV77MACgkQ++qtf8b/\n/oGHxwv8DINhd3IcPkN7M5XCdHlRLZEDJl6I48UFa7zbN1+g1hHTm0Nbgbt5QpM7\nxUwrC3bvuVF1COusfAOs5tFOuEa7+MPGzgAKxJcPI/tZJ0IAtduf2SnWWgi3ltec\nduOMY5ms29CZGT0dlUyeti3Ly1hKh75A6Fom8RUQMVLQYi3PhlMykiNx/Ppz/cxo\nksTwH0C2iJCNtn62YKzO5tdgH2hDKalc6+IBNqOLTUnfusdw5DtlNwrN6IfC3ttX\n2sb3eSY6bPOAW8b0u0hcvOfqCMsNbEOPBkWvaHfNel3bk6o3sgj4ttCmDM9/dZd0\nNJVDKoD8QnEiGPpg+aRKZQMyk1g7XeXhq+nIWlsJx+IFCAV7Lqx1hlrTRAwqFfC0\n589hSyBrzcLcMIwXRV9Dp0z6pcntwVyaJFVoeQPxeA39qdx/3Krw50fwNTCbRzep\nBFdrBCiHBZAJ4u03c8PLpkqKZbNRpkmIYol4moHz/iTTiY7A9FZ8X8xOe+a44G4/\nZ876Gc6L\n=uIu9\n-----END PGP SIGNATURE-----",
        "payload": "tree 0285f3870df7f91eccc64a3ec275df8e832bd62d\nparent 606e30627742ad86dcdc273f5947943e6f3213da\nauthor Martin Leitner-Ankerl <martin.ankerl@gmail.com> 1633326503 +0200\ncommitter Martin Leitner-Ankerl <martin.ankerl@gmail.com> 1637215957 +0100\n\nInitialize members in FastRandomContext correctly\n\nBuilding with `--enable-lto`in #23152 produced a `-Wmaybe-uninitialized`\nwarning in FastRandomContext. This commit fixes the move constructor:\nThere was undefined behavior due to uninitialized copy, and\nuninitialized reads in bytebuf.\n\nThe `FastRandomContext(const uint256& seed)` constructor did not\ninitialize the `uint64_t bitbuf` member, and in\n`FastRandomContext& operator=(FastRandomContext&& from) noexcept;` the\nuninitialized variable was copied with `bitbuf = from.bitbuf;` which\ntechnically is undefined behavior. This happens in `setup_common.cpp`\nin the line `ctx = FastRandomContext(seed);`.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/10aeb6e6484048b061620d484dbb10dee0ead386",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/10aeb6e6484048b061620d484dbb10dee0ead386",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/10aeb6e6484048b061620d484dbb10dee0ead386/comments",
    "author": {
      "login": "martinus",
      "id": 14386,
      "node_id": "MDQ6VXNlcjE0Mzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/14386?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/martinus",
      "html_url": "https://github.com/martinus",
      "followers_url": "https://api.github.com/users/martinus/followers",
      "following_url": "https://api.github.com/users/martinus/following{/other_user}",
      "gists_url": "https://api.github.com/users/martinus/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/martinus/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/martinus/subscriptions",
      "organizations_url": "https://api.github.com/users/martinus/orgs",
      "repos_url": "https://api.github.com/users/martinus/repos",
      "events_url": "https://api.github.com/users/martinus/events{/privacy}",
      "received_events_url": "https://api.github.com/users/martinus/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "martinus",
      "id": 14386,
      "node_id": "MDQ6VXNlcjE0Mzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/14386?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/martinus",
      "html_url": "https://github.com/martinus",
      "followers_url": "https://api.github.com/users/martinus/followers",
      "following_url": "https://api.github.com/users/martinus/following{/other_user}",
      "gists_url": "https://api.github.com/users/martinus/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/martinus/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/martinus/subscriptions",
      "organizations_url": "https://api.github.com/users/martinus/orgs",
      "repos_url": "https://api.github.com/users/martinus/repos",
      "events_url": "https://api.github.com/users/martinus/events{/privacy}",
      "received_events_url": "https://api.github.com/users/martinus/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "606e30627742ad86dcdc273f5947943e6f3213da",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/606e30627742ad86dcdc273f5947943e6f3213da",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/606e30627742ad86dcdc273f5947943e6f3213da"
      }
    ],
    "stats": {
      "total": 20,
      "additions": 12,
      "deletions": 8
    },
    "files": [
      {
        "sha": "d6cfc4c822938bc255e2b396e13aa119d1c69fe9",
        "filename": "src/random.cpp",
        "status": "modified",
        "additions": 8,
        "deletions": 4,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/10aeb6e6484048b061620d484dbb10dee0ead386/src/random.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/10aeb6e6484048b061620d484dbb10dee0ead386/src/random.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/random.cpp?ref=10aeb6e6484048b061620d484dbb10dee0ead386",
        "patch": "@@ -633,7 +633,7 @@ std::vector<unsigned char> FastRandomContext::randbytes(size_t len)\n     return ret;\n }\n \n-FastRandomContext::FastRandomContext(const uint256& seed) noexcept : requires_seed(false), bytebuf_size(0), bitbuf_size(0)\n+FastRandomContext::FastRandomContext(const uint256& seed) noexcept : requires_seed(false)\n {\n     rng.SetKey(seed.begin(), 32);\n }\n@@ -684,7 +684,7 @@ bool Random_SanityCheck()\n     return true;\n }\n \n-FastRandomContext::FastRandomContext(bool fDeterministic) noexcept : requires_seed(!fDeterministic), bytebuf_size(0), bitbuf_size(0)\n+FastRandomContext::FastRandomContext(bool fDeterministic) noexcept : requires_seed(!fDeterministic)\n {\n     if (!fDeterministic) {\n         return;\n@@ -697,9 +697,13 @@ FastRandomContext& FastRandomContext::operator=(FastRandomContext&& from) noexce\n {\n     requires_seed = from.requires_seed;\n     rng = from.rng;\n-    std::copy(std::begin(from.bytebuf), std::end(from.bytebuf), std::begin(bytebuf));\n+    if (from.bytebuf_size != 0) {\n+        std::copy(std::begin(from.bytebuf), std::end(from.bytebuf), std::begin(bytebuf));\n+    }\n     bytebuf_size = from.bytebuf_size;\n-    bitbuf = from.bitbuf;\n+    if (from.bitbuf_size != 0) {\n+        bitbuf = from.bitbuf;\n+    }\n     bitbuf_size = from.bitbuf_size;\n     from.requires_seed = true;\n     from.bytebuf_size = 0;"
      },
      {
        "sha": "4dc8125826407f0c26716c28c9e214c50c310e28",
        "filename": "src/random.h",
        "status": "modified",
        "additions": 4,
        "deletions": 4,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/10aeb6e6484048b061620d484dbb10dee0ead386/src/random.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/10aeb6e6484048b061620d484dbb10dee0ead386/src/random.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/random.h?ref=10aeb6e6484048b061620d484dbb10dee0ead386",
        "patch": "@@ -119,14 +119,14 @@ void RandAddEvent(const uint32_t event_info) noexcept;\n class FastRandomContext\n {\n private:\n-    bool requires_seed;\n-    ChaCha20 rng;\n+    bool requires_seed{true};\n+    ChaCha20 rng{};\n \n     unsigned char bytebuf[64];\n-    int bytebuf_size;\n+    int bytebuf_size{0};\n \n     uint64_t bitbuf;\n-    int bitbuf_size;\n+    int bitbuf_size{0};\n \n     void RandomSeed();\n "
      }
    ]
  }
]