achow101,2021-04-22 23:14:29,"""Flush"" is somewhat poor terminology here. The data is always flushed to disk after each write. When Bitcoin Core believes the data is written to disk, it is actually written disk somewhere. The ""flushing"" in this context is actually compacting the wallet database so that everything is in the main database file. Without this ""flushing"", some wallet data will be written to a database log file (BDB ",https://github.com/bitcoin/bitcoin/pull/21760#issuecomment-825250830,825250830,
Brightside56,2021-04-22 23:27:24,"> ""Flush"" is somewhat poor terminology here. The data is always flushed to disk after each write. When Bitcoin Core believes the data is written to disk, it is actually written disk somewhere. The ""flushing"" in this context is actually compacting the wallet database so that everything is in the main database file. Without this ""flushing"", some wallet data will be written to a database log file (BD",https://github.com/bitcoin/bitcoin/pull/21760#issuecomment-825265609,825265609,
DrahtBot,2021-04-23 04:16:01,<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.,https://github.com/bitcoin/bitcoin/pull/21760#issuecomment-825373304,825373304,
Brightside56,2021-04-25 00:12:03,I will send resolve commit for #19101 if merged,https://github.com/bitcoin/bitcoin/pull/21760#issuecomment-826170374,826170374,
Brightside56,2021-04-25 22:07:03,"@achow101  I've built binaries and performed simple test:\n1. Run bitcoind node regtest built from my PR\n2. Mine some coins, create some addresses and sent some TX to have some data in wallet (to be able to create visible load during flushing), wallet is 70MB now (about 45K of blocks, 50K addresses).\n3. Run script which is creating new address every 5 sec. First pass with `-flushinterval=500`",https://github.com/bitcoin/bitcoin/pull/21760#issuecomment-826397531,826397531,
Brightside56,2021-04-25 23:23:42,Hm... Even with `-flushwallet=0` DB is compacting from time to time. Where in sources can I find DB compaction logic?,https://github.com/bitcoin/bitcoin/pull/21760#issuecomment-826413037,826413037,
laanwj,2021-05-05 13:38:20,"Yes, ""flush"" is a terrible name. It should really be called ""compact"", as the goal is to merge into one `.dat` file.\n\nThat said, the logic is in `MaybeCompactWalletDB()` which calls the unfortunately named `BerkeleyDatabase::PeriodicFlush()`. Mind that Sqlite has no equivalent functionality, so if you create a new-style wallet, you will get rid of this problem as well.",https://github.com/bitcoin/bitcoin/pull/21760#issuecomment-832694640,832694640,
Brightside56,2021-05-06 09:31:14,"@laanwj With my setup I have no option to create new wallet or migrate to SQLite( Also if I understand correctly, SQLite isn't production ready in bitcoind and needs massive investigation from point of performance, right? Are there additional options to manage `BerkeleyDatabase::PeriodicFlush()` intervals (when I set `-flushwallet=0`, compaction still happens from time to time)?",https://github.com/bitcoin/bitcoin/pull/21760#issuecomment-833382091,833382091,
laanwj,2021-05-14 13:39:29,"> (when I set -flushwallet=0, compaction still happens from time to time)?\n\nIt would be good to fix it instead of adding another option.\n#18923 was the last PR to touch that AFAIK",https://github.com/bitcoin/bitcoin/pull/21760#issuecomment-841250801,841250801,
Brightside56,2021-05-17 18:49:59,"> > (when I set -flushwallet=0, compaction still happens from time to time)?\n> \n> It would be good to fix it instead of adding another option.\n> #18923 was the last PR to touch that AFAIK\n\nI checked this PR and see that `MaybeCompactWalletDB` should work properly (never to be called with `-flushwallet=0`), but as I see, bdb has some kind of magic which can trigger log flush at any moment",https://github.com/bitcoin/bitcoin/pull/21760#issuecomment-842551391,842551391,
laanwj,2021-06-03 15:12:13,"Closing this PR, as the conclusion was that there is no way to get around this behavior at all, so adding this option wouldn't fix the underlying issue.",https://github.com/bitcoin/bitcoin/pull/21760#issuecomment-853946099,853946099,
