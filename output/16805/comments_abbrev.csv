DrahtBot,2019-09-04 22:10:38,<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.,https://github.com/bitcoin/bitcoin/pull/16805#issuecomment-528110361,528110361,
hebasto,2019-09-09 11:00:42,Concept ACK,https://github.com/bitcoin/bitcoin/pull/16805#issuecomment-529417725,529417725,
jamesob,2019-09-19 18:15:06,"Thanks for the looks so far. I've taken @promag's advice and have added a more generally useful RAII utility for logging times, `BCLog::Timer`.",https://github.com/bitcoin/bitcoin/pull/16805#issuecomment-533248258,533248258,
MarcoFalke,2019-09-19 18:40:02,ACK cad68f59ff9a95e6e4f7fe9cce61705563bb1409,https://github.com/bitcoin/bitcoin/pull/16805#issuecomment-533257776,533257776,
jamesob,2019-09-27 18:31:49,"Thanks for the looks, have incorporated all feedback.",https://github.com/bitcoin/bitcoin/pull/16805#issuecomment-536050932,536050932,
hebasto,2019-10-12 19:37:02,"Compiled and tested on ODROID-HC1 (ARMv7). Due to the #17010 issue all commits from this PR (0d86f4d3dacab38f3cd5371d0c920585c178302c, 51ab646bba9367c737fbbdb0f5cde4ae4de8b67c and e75b176e9364dd8ba2cbe9907b71b83c8d492693) were cherry-picked and applied on top of the `0.19.0rc1` tag.\n\nWithout applied commits (on v0.19.0rc1):\n\n```\n$ time bitcoin-cli -rpcclienttimeout=86400 gettxoutsetinfo",https://github.com/bitcoin/bitcoin/pull/16805#issuecomment-541355303,541355303,
laanwj,2019-10-30 12:37:58,"@hebasto I do not believe the changes in this PR can have such a performance impact.\n",https://github.com/bitcoin/bitcoin/pull/16805#issuecomment-547881042,547881042,
hebasto,2019-10-30 12:58:30,"@laanwj \n> I do not believe the changes in this PR can have such a performance impact.\n\nYou are right. The ARM big.LITTLE Heterogeneous Multi-Processing causes such a performance impact if any of threads runs on LITTLE core.\n",https://github.com/bitcoin/bitcoin/pull/16805#issuecomment-547889463,547889463,
laanwj,2019-10-30 13:14:00,"Maybe open a new issue for that (don't know how much control applications have over the thread affinity in that case?).\n",https://github.com/bitcoin/bitcoin/pull/16805#issuecomment-547895939,547895939,
jamesob,2019-11-04 19:15:15,"[`flushlogs.8`](https://github.com/jamesob/bitcoin/tree/flushlogs.8) -> [`flushlogs.11`](https://github.com/jamesob/bitcoin/tree/flushlogs.11)\n\nSeparated `BCLog::Timer` out into its own header per @laanwj's recommendation.",https://github.com/bitcoin/bitcoin/pull/16805#issuecomment-549504541,549504541,
laanwj,2019-11-05 20:33:12,"Thanks, ACK dcef9a2922317cb2849f397366b6c56d755db6c9",https://github.com/bitcoin/bitcoin/pull/16805#issuecomment-550007439,550007439,
laanwj,2019-09-06 08:38:02,"Would prefer adding this to the current `BENCH` category, it includes more timings like this. Adding a new category seems overkill to me.",https://github.com/bitcoin/bitcoin/pull/16805#discussion_r321632730,321632730,src/logging.h
jamesob,2019-09-09 18:49:15,"Yeah, I think that makes sense. Fixed.",https://github.com/bitcoin/bitcoin/pull/16805#discussion_r322398563,322398563,src/logging.h
MarcoFalke,2019-09-19 18:39:44,Could say `BENCH_MICROS` to be more specific?,https://github.com/bitcoin/bitcoin/pull/16805#discussion_r326326097,326326097,src/logging.h
jamesob,2019-09-19 21:12:44,"I've changed to `LOG_TIME_*`, hope you like that.",https://github.com/bitcoin/bitcoin/pull/16805#discussion_r326386091,326386091,src/logging.h
ryanofsky,2019-09-24 15:32:19,Could std::move `prefix` and `end_msg` to avoid allocations.,https://github.com/bitcoin/bitcoin/pull/16805#discussion_r327685274,327685274,src/logging.h
ryanofsky,2019-09-24 15:36:42,"Here and below should this use `LogPrintf(""%s"", full_msg)` to avoid errors if `msg` contains `%` characters? Using `%s\n` here would also allow dropping the newline in LogMsg and removing the ""No newline"" lint workarounds.\n\nAlso can `.c_str()` be dropped?",https://github.com/bitcoin/bitcoin/pull/16805#discussion_r327687672,327687672,src/logging.h
ryanofsky,2019-09-24 15:41:47,I'm surprised there aren't warnings about macro redefinitions since sync.h defines same macros. If this does turn out to be a problem could move PASTE/PASTE2 to a common location like util/preprocessor.h or util/macros.h,https://github.com/bitcoin/bitcoin/pull/16805#discussion_r327690551,327690551,src/logging.h
MarcoFalke,2019-09-24 16:01:41,"style-nit: Could move this up to not include the (trivial) switch-case statement above in the measurement? (edit: Looks like the switch-case should be evaluated at compile time, so should be fine either way)",https://github.com/bitcoin/bitcoin/pull/16805#discussion_r327701305,327701305,src/logging.h
laanwj,2019-09-25 09:40:02,Seems a good idea to factor these out in any case,https://github.com/bitcoin/bitcoin/pull/16805#discussion_r328026017,328026017,src/logging.h
jamesob,2019-09-25 15:03:18,done,https://github.com/bitcoin/bitcoin/pull/16805#discussion_r328176887,328176887,src/logging.h
jamesob,2019-09-25 15:03:26,Ah good suggestions! done,https://github.com/bitcoin/bitcoin/pull/16805#discussion_r328176951,328176951,src/logging.h
jamesob,2019-09-25 15:03:33,done,https://github.com/bitcoin/bitcoin/pull/16805#discussion_r328177003,328177003,src/logging.h
jamesob,2019-09-25 15:03:37,done,https://github.com/bitcoin/bitcoin/pull/16805#discussion_r328177039,328177039,src/logging.h
MarcoFalke,2019-09-27 17:22:14,style-nit: Any reason the members are not const and private?,https://github.com/bitcoin/bitcoin/pull/16805#discussion_r329173587,329173587,src/logging.h
jamesob,2019-09-27 17:45:18,"Nah, will change if rebase happens.",https://github.com/bitcoin/bitcoin/pull/16805#discussion_r329182335,329182335,src/logging.h
ryanofsky,2019-09-27 17:52:15,"Maybe wait to initialize m_start_t until after the Log call, so the elapsed time doesn't include the time spent logging. This would also let you eliminate the `show_elapsed_time` bool arguments (could just check `m_start_t != 0` instead).",https://github.com/bitcoin/bitcoin/pull/16805#discussion_r329185026,329185026,src/logging.h
jamesob,2019-09-27 18:04:33,Oh that's a good point. Will do.,https://github.com/bitcoin/bitcoin/pull/16805#discussion_r329189732,329189732,src/logging.h
ryanofsky,2019-09-27 18:38:30,"In commit ""logs: add timing information to FlushStateToDisk()"" (07b8f8389c5ec557fbb6a7ab59a186865636d2d4)\n\nNote: third commit is moving lines added by the second commit.",https://github.com/bitcoin/bitcoin/pull/16805#discussion_r329202341,329202341,src/logging.h
jamesob,2019-09-27 18:44:33,"Oops! Fixed, thanks.",https://github.com/bitcoin/bitcoin/pull/16805#discussion_r329204747,329204747,src/logging.h
practicalswift,2019-09-28 16:39:20,"Should be ""outputting"" :)",https://github.com/bitcoin/bitcoin/pull/16805#discussion_r329317334,329317334,src/logging.h
laanwj,2019-11-01 10:27:48,Might want to put the timer in a new header. Pulling in these extra header files in everything that uses `logging.h` (read: everything) might slow down the build unnecessarily.,https://github.com/bitcoin/bitcoin/pull/16805#discussion_r341520438,341520438,src/logging.h
MarcoFalke,2019-11-01 12:57:26,"Last time I looked, I found that the standard library headers are generally fast to include (compared to boost and our serialize.h)",https://github.com/bitcoin/bitcoin/pull/16805#discussion_r341561049,341561049,src/logging.h
laanwj,2019-11-02 11:15:12,In comparison that's true. Still it's good to be extra careful about introducing extra dependencies for such a common header.,https://github.com/bitcoin/bitcoin/pull/16805#discussion_r341807534,341807534,src/logging.h
MarcoFalke,2019-11-06 13:07:01,How is this different from the existing `cacheSize`?,https://github.com/bitcoin/bitcoin/pull/16805#discussion_r343083297,343083297,src/validation.cpp
jamesob,2019-11-06 16:08:04,"Ah yeah, guess it's not. Oops.",https://github.com/bitcoin/bitcoin/pull/16805#discussion_r343183638,343183638,src/validation.cpp
