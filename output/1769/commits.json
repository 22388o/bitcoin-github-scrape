[
  {
    "sha": "028ec224b8acb9273e79c1c10c5278a102e3f305",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzowMjhlYzIyNGI4YWNiOTI3M2U3OWMxYzEwYzUyNzhhMTAyZTNmMzA1",
    "commit": {
      "author": {
        "name": "xanatos",
        "email": "xanatos@geocities.com",
        "date": "2012-08-27T12:08:20Z"
      },
      "committer": {
        "name": "xanatos",
        "email": "xanatos@geocities.com",
        "date": "2012-08-27T12:08:20Z"
      },
      "message": "Removed duplicated lock\n\nAround line 167 there is already a LOCK(bitdb.cs_db) that covers everything. Re-locking is useless.",
      "tree": {
        "sha": "bc63962c684c9dd0a87aa0767a6eb5a4047c8d4d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/bc63962c684c9dd0a87aa0767a6eb5a4047c8d4d"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/028ec224b8acb9273e79c1c10c5278a102e3f305",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/028ec224b8acb9273e79c1c10c5278a102e3f305",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/028ec224b8acb9273e79c1c10c5278a102e3f305",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/028ec224b8acb9273e79c1c10c5278a102e3f305/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "772351b0d5b298a93bb90b403b4ec151ca5f9770",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/772351b0d5b298a93bb90b403b4ec151ca5f9770",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/772351b0d5b298a93bb90b403b4ec151ca5f9770"
      }
    ],
    "stats": {
      "total": 5,
      "additions": 1,
      "deletions": 4
    },
    "files": [
      {
        "sha": "015e7ec2de8e15e04fa7b90535399598f5389e38",
        "filename": "src/db.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 4,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/028ec224b8acb9273e79c1c10c5278a102e3f305/src/db.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/028ec224b8acb9273e79c1c10c5278a102e3f305/src/db.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/db.cpp?ref=028ec224b8acb9273e79c1c10c5278a102e3f305",
        "patch": "@@ -195,10 +195,7 @@ CDB::CDB(const char *pszFile, const char* pszMode) :\n             {\n                 delete pdb;\n                 pdb = NULL;\n-                {\n-                     LOCK(bitdb.cs_db);\n-                    --bitdb.mapFileUseCount[strFile];\n-                }\n+                --bitdb.mapFileUseCount[strFile];\n                 strFile = \"\";\n                 throw runtime_error(strprintf(\"CDB() : can't open database file %s, error %d\", pszFile, ret));\n             }"
      }
    ]
  },
  {
    "sha": "9eb7fc58426e8d3afedd9959c21566a3d2eaf6d8",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5ZWI3ZmM1ODQyNmU4ZDNhZmVkZDk5NTljMjE1NjZhM2QyZWFmNmQ4",
    "commit": {
      "author": {
        "name": "xanatos",
        "email": "xanatos@geocities.com",
        "date": "2012-08-28T20:25:52Z"
      },
      "committer": {
        "name": "xanatos",
        "email": "xanatos@geocities.com",
        "date": "2012-08-28T20:25:52Z"
      },
      "message": "Changed nprev->pprev\n\nIt should be pprev, because the next one is pnext, and it's printing the memory address of the CBlockIndex (so pSomething).",
      "tree": {
        "sha": "8d1425387099927c2fec83ae78065b9d5d77886b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8d1425387099927c2fec83ae78065b9d5d77886b"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9eb7fc58426e8d3afedd9959c21566a3d2eaf6d8",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9eb7fc58426e8d3afedd9959c21566a3d2eaf6d8",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/9eb7fc58426e8d3afedd9959c21566a3d2eaf6d8",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9eb7fc58426e8d3afedd9959c21566a3d2eaf6d8/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "06707dd610bbdecf3a4e25534ae74bad67ac0a13",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/06707dd610bbdecf3a4e25534ae74bad67ac0a13",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/06707dd610bbdecf3a4e25534ae74bad67ac0a13"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 1,
      "deletions": 1
    },
    "files": [
      {
        "sha": "b8057a295e33086e4fdc2edb1ac3abe1d9b01da4",
        "filename": "src/main.h",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9eb7fc58426e8d3afedd9959c21566a3d2eaf6d8/src/main.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9eb7fc58426e8d3afedd9959c21566a3d2eaf6d8/src/main.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.h?ref=9eb7fc58426e8d3afedd9959c21566a3d2eaf6d8",
        "patch": "@@ -1174,7 +1174,7 @@ class CBlockIndex\n \n     std::string ToString() const\n     {\n-        return strprintf(\"CBlockIndex(nprev=%08x, pnext=%08x, nFile=%d, nBlockPos=%-6d nHeight=%d, merkle=%s, hashBlock=%s)\",\n+        return strprintf(\"CBlockIndex(pprev=%08x, pnext=%08x, nFile=%d, nBlockPos=%-6d nHeight=%d, merkle=%s, hashBlock=%s)\",\n             pprev, pnext, nFile, nBlockPos, nHeight,\n             hashMerkleRoot.ToString().substr(0,10).c_str(),\n             GetBlockHash().ToString().substr(0,20).c_str());"
      }
    ]
  },
  {
    "sha": "ddb709e9de1490afcfa1af045517d2228d5b864c",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpkZGI3MDllOWRlMTQ5MGFmY2ZhMWFmMDQ1NTE3ZDIyMjhkNWI4NjRj",
    "commit": {
      "author": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2012-09-01T22:07:47Z"
      },
      "committer": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2012-09-02T08:02:46Z"
      },
      "message": "Bugfix: Require OrderedTxItems to provide properly scoped accounting entry list\n\nOrderedTxItems returns a multimap of pointers, but needs a place to store the actual CAccountingEntries it points to.\nIt had been using a stack item, which was clobbered as soon as it returned, resulting in undefined behaviour.\nThis fixes at least bug #1768.",
      "tree": {
        "sha": "46a8f68d95e38d527729e2b7da7976dad8654921",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/46a8f68d95e38d527729e2b7da7976dad8654921"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ddb709e9de1490afcfa1af045517d2228d5b864c",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ddb709e9de1490afcfa1af045517d2228d5b864c",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/ddb709e9de1490afcfa1af045517d2228d5b864c",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ddb709e9de1490afcfa1af045517d2228d5b864c/comments",
    "author": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "c3f95ef13f48d21db53992984976eac93e7a08fc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c3f95ef13f48d21db53992984976eac93e7a08fc",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/c3f95ef13f48d21db53992984976eac93e7a08fc"
      }
    ],
    "stats": {
      "total": 18,
      "additions": 12,
      "deletions": 6
    },
    "files": [
      {
        "sha": "20df4c0a68954e67989d825912a651470c77b027",
        "filename": "src/rpcwallet.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/ddb709e9de1490afcfa1af045517d2228d5b864c/src/rpcwallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/ddb709e9de1490afcfa1af045517d2228d5b864c/src/rpcwallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpcwallet.cpp?ref=ddb709e9de1490afcfa1af045517d2228d5b864c",
        "patch": "@@ -987,7 +987,8 @@ Value listtransactions(const Array& params, bool fHelp)\n \n     Array ret;\n \n-    CWallet::TxItems txOrdered = pwalletMain->OrderedTxItems(strAccount);\n+    std::list<CAccountingEntry> acentries;\n+    CWallet::TxItems txOrdered = pwalletMain->OrderedTxItems(acentries, strAccount);\n \n     // iterate backwards until we have nCount items to return:\n     for (CWallet::TxItems::reverse_iterator it = txOrdered.rbegin(); it != txOrdered.rend(); ++it)"
      },
      {
        "sha": "3af9fdaeaeed21e2cc91b1e8b7522d67773ffefb",
        "filename": "src/wallet.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 4,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/ddb709e9de1490afcfa1af045517d2228d5b864c/src/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/ddb709e9de1490afcfa1af045517d2228d5b864c/src/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet.cpp?ref=ddb709e9de1490afcfa1af045517d2228d5b864c",
        "patch": "@@ -291,8 +291,7 @@ bool CWallet::EncryptWallet(const SecureString& strWalletPassphrase)\n     return true;\n }\n \n-CWallet::TxItems\n-CWallet::OrderedTxItems(std::string strAccount)\n+CWallet::TxItems CWallet::OrderedTxItems(std::list<CAccountingEntry>& acentries, std::string strAccount)\n {\n     CWalletDB walletdb(strWalletFile);\n \n@@ -306,7 +305,7 @@ CWallet::OrderedTxItems(std::string strAccount)\n         CWalletTx* wtx = &((*it).second);\n         txOrdered.insert(make_pair(wtx->nOrderPos, TxPair(wtx, (CAccountingEntry*)0)));\n     }\n-    list<CAccountingEntry> acentries;\n+    acentries.clear();\n     walletdb.ListAccountCreditDebit(strAccount, acentries);\n     BOOST_FOREACH(CAccountingEntry& entry, acentries)\n     {\n@@ -375,7 +374,8 @@ bool CWallet::AddToWallet(const CWalletTx& wtxIn)\n                     {\n                         // Tolerate times up to the last timestamp in the wallet not more than 5 minutes into the future\n                         int64 latestTolerated = latestNow + 300;\n-                        TxItems txOrdered = OrderedTxItems();\n+                        std::list<CAccountingEntry> acentries;\n+                        TxItems txOrdered = OrderedTxItems(acentries);\n                         for (TxItems::reverse_iterator it = txOrdered.rbegin(); it != txOrdered.rend(); ++it)\n                         {\n                             CWalletTx *const pwtx = (*it).second.first;"
      },
      {
        "sha": "65d3448212dd5fe59f3a3274a960cb33d3544186",
        "filename": "src/wallet.h",
        "status": "modified",
        "additions": 6,
        "deletions": 1,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/ddb709e9de1490afcfa1af045517d2228d5b864c/src/wallet.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/ddb709e9de1490afcfa1af045517d2228d5b864c/src/wallet.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet.h?ref=ddb709e9de1490afcfa1af045517d2228d5b864c",
        "patch": "@@ -146,7 +146,12 @@ class CWallet : public CCryptoKeyStore\n \n     typedef std::pair<CWalletTx*, CAccountingEntry*> TxPair;\n     typedef std::multimap<int64, TxPair > TxItems;\n-    TxItems OrderedTxItems(std::string strAccount = \"\");\n+\n+    /** Get the wallet's activity log\n+        @return multimap of ordered transactions and accounting entries\n+        @warning Returned pointers are *only* valid within the scope of passed acentries\n+     */\n+    TxItems OrderedTxItems(std::list<CAccountingEntry>& acentries, std::string strAccount = \"\");\n \n     void MarkDirty();\n     bool AddToWallet(const CWalletTx& wtxIn);"
      }
    ]
  },
  {
    "sha": "eaf00a3a5d80fb50d761c14b7c295df6ae2f0e44",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzplYWYwMGEzYTVkODBmYjUwZDc2MWMxNGI3YzI5NWRmNmFlMmYwZTQ0",
    "commit": {
      "author": {
        "name": "Gavin Andresen",
        "email": "gavinandresen@gmail.com",
        "date": "2012-09-02T23:47:58Z"
      },
      "committer": {
        "name": "Gavin Andresen",
        "email": "gavinandresen@gmail.com",
        "date": "2012-09-02T23:47:58Z"
      },
      "message": "Merge pull request #1774 from luke-jr/refactor_times\n\nBugfix: Require OrderedTxItems to provide properly scoped accounting entry list",
      "tree": {
        "sha": "92c402e1cf3352c8079af84cc60f5129ffeb1d6f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/92c402e1cf3352c8079af84cc60f5129ffeb1d6f"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/eaf00a3a5d80fb50d761c14b7c295df6ae2f0e44",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/eaf00a3a5d80fb50d761c14b7c295df6ae2f0e44",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/eaf00a3a5d80fb50d761c14b7c295df6ae2f0e44",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/eaf00a3a5d80fb50d761c14b7c295df6ae2f0e44/comments",
    "author": {
      "login": "gavinandresen",
      "id": 331997,
      "node_id": "MDQ6VXNlcjMzMTk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/331997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gavinandresen",
      "html_url": "https://github.com/gavinandresen",
      "followers_url": "https://api.github.com/users/gavinandresen/followers",
      "following_url": "https://api.github.com/users/gavinandresen/following{/other_user}",
      "gists_url": "https://api.github.com/users/gavinandresen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gavinandresen/subscriptions",
      "organizations_url": "https://api.github.com/users/gavinandresen/orgs",
      "repos_url": "https://api.github.com/users/gavinandresen/repos",
      "events_url": "https://api.github.com/users/gavinandresen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gavinandresen/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "gavinandresen",
      "id": 331997,
      "node_id": "MDQ6VXNlcjMzMTk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/331997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gavinandresen",
      "html_url": "https://github.com/gavinandresen",
      "followers_url": "https://api.github.com/users/gavinandresen/followers",
      "following_url": "https://api.github.com/users/gavinandresen/following{/other_user}",
      "gists_url": "https://api.github.com/users/gavinandresen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gavinandresen/subscriptions",
      "organizations_url": "https://api.github.com/users/gavinandresen/orgs",
      "repos_url": "https://api.github.com/users/gavinandresen/repos",
      "events_url": "https://api.github.com/users/gavinandresen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gavinandresen/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "4d0c2b6cf4e0d3ece4e785af442e8d5538770048",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4d0c2b6cf4e0d3ece4e785af442e8d5538770048",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/4d0c2b6cf4e0d3ece4e785af442e8d5538770048"
      },
      {
        "sha": "ddb709e9de1490afcfa1af045517d2228d5b864c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ddb709e9de1490afcfa1af045517d2228d5b864c",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/ddb709e9de1490afcfa1af045517d2228d5b864c"
      }
    ],
    "stats": {
      "total": 18,
      "additions": 12,
      "deletions": 6
    },
    "files": [
      {
        "sha": "b8e6a4467a88efd27c1f2d2ea99679a19c70bf1d",
        "filename": "src/rpcwallet.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/eaf00a3a5d80fb50d761c14b7c295df6ae2f0e44/src/rpcwallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/eaf00a3a5d80fb50d761c14b7c295df6ae2f0e44/src/rpcwallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpcwallet.cpp?ref=eaf00a3a5d80fb50d761c14b7c295df6ae2f0e44",
        "patch": "@@ -1006,7 +1006,8 @@ Value listtransactions(const Array& params, bool fHelp)\n \n     Array ret;\n \n-    CWallet::TxItems txOrdered = pwalletMain->OrderedTxItems(strAccount);\n+    std::list<CAccountingEntry> acentries;\n+    CWallet::TxItems txOrdered = pwalletMain->OrderedTxItems(acentries, strAccount);\n \n     // iterate backwards until we have nCount items to return:\n     for (CWallet::TxItems::reverse_iterator it = txOrdered.rbegin(); it != txOrdered.rend(); ++it)"
      },
      {
        "sha": "6538ca971308b50cd0d769eb3e61b86c84dbed22",
        "filename": "src/wallet.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 4,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/eaf00a3a5d80fb50d761c14b7c295df6ae2f0e44/src/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/eaf00a3a5d80fb50d761c14b7c295df6ae2f0e44/src/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet.cpp?ref=eaf00a3a5d80fb50d761c14b7c295df6ae2f0e44",
        "patch": "@@ -291,8 +291,7 @@ bool CWallet::EncryptWallet(const SecureString& strWalletPassphrase)\n     return true;\n }\n \n-CWallet::TxItems\n-CWallet::OrderedTxItems(std::string strAccount)\n+CWallet::TxItems CWallet::OrderedTxItems(std::list<CAccountingEntry>& acentries, std::string strAccount)\n {\n     CWalletDB walletdb(strWalletFile);\n \n@@ -306,7 +305,7 @@ CWallet::OrderedTxItems(std::string strAccount)\n         CWalletTx* wtx = &((*it).second);\n         txOrdered.insert(make_pair(wtx->nOrderPos, TxPair(wtx, (CAccountingEntry*)0)));\n     }\n-    list<CAccountingEntry> acentries;\n+    acentries.clear();\n     walletdb.ListAccountCreditDebit(strAccount, acentries);\n     BOOST_FOREACH(CAccountingEntry& entry, acentries)\n     {\n@@ -375,7 +374,8 @@ bool CWallet::AddToWallet(const CWalletTx& wtxIn)\n                     {\n                         // Tolerate times up to the last timestamp in the wallet not more than 5 minutes into the future\n                         int64 latestTolerated = latestNow + 300;\n-                        TxItems txOrdered = OrderedTxItems();\n+                        std::list<CAccountingEntry> acentries;\n+                        TxItems txOrdered = OrderedTxItems(acentries);\n                         for (TxItems::reverse_iterator it = txOrdered.rbegin(); it != txOrdered.rend(); ++it)\n                         {\n                             CWalletTx *const pwtx = (*it).second.first;"
      },
      {
        "sha": "7fd33629feaaf34f4093d849af3c26cdee2fa04a",
        "filename": "src/wallet.h",
        "status": "modified",
        "additions": 6,
        "deletions": 1,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/eaf00a3a5d80fb50d761c14b7c295df6ae2f0e44/src/wallet.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/eaf00a3a5d80fb50d761c14b7c295df6ae2f0e44/src/wallet.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet.h?ref=eaf00a3a5d80fb50d761c14b7c295df6ae2f0e44",
        "patch": "@@ -146,7 +146,12 @@ class CWallet : public CCryptoKeyStore\n \n     typedef std::pair<CWalletTx*, CAccountingEntry*> TxPair;\n     typedef std::multimap<int64, TxPair > TxItems;\n-    TxItems OrderedTxItems(std::string strAccount = \"\");\n+\n+    /** Get the wallet's activity log\n+        @return multimap of ordered transactions and accounting entries\n+        @warning Returned pointers are *only* valid within the scope of passed acentries\n+     */\n+    TxItems OrderedTxItems(std::list<CAccountingEntry>& acentries, std::string strAccount = \"\");\n \n     void MarkDirty();\n     bool AddToWallet(const CWalletTx& wtxIn);"
      }
    ]
  },
  {
    "sha": "acbe4a1f32a1cb145349cd753022b182e6baa1da",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzphY2JlNGExZjMyYTFjYjE0NTM0OWNkNzUzMDIyYjE4MmU2YmFhMWRh",
    "commit": {
      "author": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@gmail.com",
        "date": "2012-09-03T15:00:18Z"
      },
      "committer": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@gmail.com",
        "date": "2012-09-03T15:00:18Z"
      },
      "message": "Merge pull request #1728 from xanatos/patch-11\n\nRemoved duplicated lock",
      "tree": {
        "sha": "f502e45bfca0d13652de15c96d31f1b6246598b6",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f502e45bfca0d13652de15c96d31f1b6246598b6"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/acbe4a1f32a1cb145349cd753022b182e6baa1da",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/acbe4a1f32a1cb145349cd753022b182e6baa1da",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/acbe4a1f32a1cb145349cd753022b182e6baa1da",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/acbe4a1f32a1cb145349cd753022b182e6baa1da/comments",
    "author": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "eaf00a3a5d80fb50d761c14b7c295df6ae2f0e44",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/eaf00a3a5d80fb50d761c14b7c295df6ae2f0e44",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/eaf00a3a5d80fb50d761c14b7c295df6ae2f0e44"
      },
      {
        "sha": "028ec224b8acb9273e79c1c10c5278a102e3f305",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/028ec224b8acb9273e79c1c10c5278a102e3f305",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/028ec224b8acb9273e79c1c10c5278a102e3f305"
      }
    ],
    "stats": {
      "total": 5,
      "additions": 1,
      "deletions": 4
    },
    "files": [
      {
        "sha": "015e7ec2de8e15e04fa7b90535399598f5389e38",
        "filename": "src/db.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 4,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/acbe4a1f32a1cb145349cd753022b182e6baa1da/src/db.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/acbe4a1f32a1cb145349cd753022b182e6baa1da/src/db.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/db.cpp?ref=acbe4a1f32a1cb145349cd753022b182e6baa1da",
        "patch": "@@ -195,10 +195,7 @@ CDB::CDB(const char *pszFile, const char* pszMode) :\n             {\n                 delete pdb;\n                 pdb = NULL;\n-                {\n-                     LOCK(bitdb.cs_db);\n-                    --bitdb.mapFileUseCount[strFile];\n-                }\n+                --bitdb.mapFileUseCount[strFile];\n                 strFile = \"\";\n                 throw runtime_error(strprintf(\"CDB() : can't open database file %s, error %d\", pszFile, ret));\n             }"
      }
    ]
  },
  {
    "sha": "9d7da11458b53dc12053d3625d05a21e8a7eeb2f",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5ZDdkYTExNDU4YjUzZGMxMjA1M2QzNjI1ZDA1YTIxZThhN2VlYjJm",
    "commit": {
      "author": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@gmail.com",
        "date": "2012-09-03T15:11:36Z"
      },
      "committer": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@gmail.com",
        "date": "2012-09-03T15:11:36Z"
      },
      "message": "Merge pull request #1743 from xanatos/patch-14\n\nChanged nprev->pprev",
      "tree": {
        "sha": "60a90b9ef99b6126214d9b89813278cf10a27f1a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/60a90b9ef99b6126214d9b89813278cf10a27f1a"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9d7da11458b53dc12053d3625d05a21e8a7eeb2f",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9d7da11458b53dc12053d3625d05a21e8a7eeb2f",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/9d7da11458b53dc12053d3625d05a21e8a7eeb2f",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9d7da11458b53dc12053d3625d05a21e8a7eeb2f/comments",
    "author": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "acbe4a1f32a1cb145349cd753022b182e6baa1da",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/acbe4a1f32a1cb145349cd753022b182e6baa1da",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/acbe4a1f32a1cb145349cd753022b182e6baa1da"
      },
      {
        "sha": "9eb7fc58426e8d3afedd9959c21566a3d2eaf6d8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9eb7fc58426e8d3afedd9959c21566a3d2eaf6d8",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/9eb7fc58426e8d3afedd9959c21566a3d2eaf6d8"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 1,
      "deletions": 1
    },
    "files": [
      {
        "sha": "b8057a295e33086e4fdc2edb1ac3abe1d9b01da4",
        "filename": "src/main.h",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9d7da11458b53dc12053d3625d05a21e8a7eeb2f/src/main.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9d7da11458b53dc12053d3625d05a21e8a7eeb2f/src/main.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.h?ref=9d7da11458b53dc12053d3625d05a21e8a7eeb2f",
        "patch": "@@ -1174,7 +1174,7 @@ class CBlockIndex\n \n     std::string ToString() const\n     {\n-        return strprintf(\"CBlockIndex(nprev=%08x, pnext=%08x, nFile=%d, nBlockPos=%-6d nHeight=%d, merkle=%s, hashBlock=%s)\",\n+        return strprintf(\"CBlockIndex(pprev=%08x, pnext=%08x, nFile=%d, nBlockPos=%-6d nHeight=%d, merkle=%s, hashBlock=%s)\",\n             pprev, pnext, nFile, nBlockPos, nHeight,\n             hashMerkleRoot.ToString().substr(0,10).c_str(),\n             GetBlockHash().ToString().substr(0,20).c_str());"
      }
    ]
  },
  {
    "sha": "c57082dc8c69934939ef7c7129d6dd9e46ee4fa1",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpjNTcwODJkYzhjNjk5MzQ5MzllZjdjNzEyOWQ2ZGQ5ZTQ2ZWU0ZmEx",
    "commit": {
      "author": {
        "name": "Philip Kaufmann",
        "email": "phil.kaufmann@t-online.de",
        "date": "2012-08-31T22:26:59Z"
      },
      "committer": {
        "name": "Philip Kaufmann",
        "email": "phil.kaufmann@t-online.de",
        "date": "2012-09-03T20:36:15Z"
      },
      "message": "enhance proxy support / network init\n\n- add -proxy6 to specify a SOCKS5 proxy for reaching IPv6 peers\n- add init message for network initialisation\n- enhance control flow for proxy init code\n- new init order Tor -> IPv6 -> Base proxy\n- remove redundant .IsValid() check for Tor proxy address\n- don't set Tor proxy, when IsLimited(NET_TOR)\n- don't allow SOCKS versions != 4 or != 5\n- update parameter help messages to reflect changes and tweak them to\n  be more clear",
      "tree": {
        "sha": "30769d5d9d146a7666d698bde6eecceaf955a3c7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/30769d5d9d146a7666d698bde6eecceaf955a3c7"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c57082dc8c69934939ef7c7129d6dd9e46ee4fa1",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c57082dc8c69934939ef7c7129d6dd9e46ee4fa1",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/c57082dc8c69934939ef7c7129d6dd9e46ee4fa1",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c57082dc8c69934939ef7c7129d6dd9e46ee4fa1/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "9d7da11458b53dc12053d3625d05a21e8a7eeb2f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9d7da11458b53dc12053d3625d05a21e8a7eeb2f",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/9d7da11458b53dc12053d3625d05a21e8a7eeb2f"
      }
    ],
    "stats": {
      "total": 78,
      "additions": 55,
      "deletions": 23
    },
    "files": [
      {
        "sha": "94b8a7a5c38425f776c8b1b9fc9f238a6f3baf44",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 55,
        "deletions": 23,
        "changes": 78,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c57082dc8c69934939ef7c7129d6dd9e46ee4fa1/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c57082dc8c69934939ef7c7129d6dd9e46ee4fa1/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=c57082dc8c69934939ef7c7129d6dd9e46ee4fa1",
        "patch": "@@ -226,9 +226,10 @@ std::string HelpMessage()\n         \"  -dbcache=<n>           \" + _(\"Set database cache size in megabytes (default: 25)\") + \"\\n\" +\n         \"  -dblogsize=<n>         \" + _(\"Set database disk log size in megabytes (default: 100)\") + \"\\n\" +\n         \"  -timeout=<n>           \" + _(\"Specify connection timeout in milliseconds (default: 5000))\") + \"\\n\" +\n-        \"  -proxy=<ip:port>       \" + _(\"Connect through socks proxy\") + \"\\n\" +\n-        \"  -socks=<n>             \" + _(\"Select the version of socks proxy to use (4-5, default: 5)\") + \"\\n\" +\n-        \"  -tor=<ip:port>         \" + _(\"Use proxy to reach tor hidden services (default: same as -proxy)\") + \"\\n\"\n+        \"  -proxy=<ip:port>       \" + _(\"Connect through SOCKS proxy\") + \"\\n\" +\n+        \"  -socks=<n>             \" + _(\"Select SOCKS version for -proxy (4 or 5, default: 5)\") + \"\\n\" +\n+        \"  -proxy6=<ip:port>      \" + _(\"Use separate SOCKS5 proxy to reach IPv6 peers (default: -proxy if no -socks=4)\") + \"\\n\" +\n+        \"  -tor=<ip:port>         \" + _(\"Use separate SOCKS5 proxy to reach Tor hidden services (default: -proxy if no -socks=4)\") + \"\\n\"\n         \"  -dns                   \" + _(\"Allow DNS lookups for -addnode, -seednode and -connect\") + \"\\n\" +\n         \"  -port=<port>           \" + _(\"Listen for connections on <port> (default: 8333 or testnet: 18333)\") + \"\\n\" +\n         \"  -maxconnections=<n>    \" + _(\"Maintain at most <n> connections to peers (default: 125)\") + \"\\n\" +\n@@ -481,6 +482,8 @@ bool AppInit2()\n \n     // ********************************************************* Step 5: network initialization\n \n+    uiInterface.InitMessage(_(\"Network initialisation...\"));\n+\n     int nSocksVersion = GetArg(\"-socks\", 5);\n \n     if (nSocksVersion != 4 && nSocksVersion != 5)\n@@ -508,35 +511,64 @@ bool AppInit2()\n #endif\n \n     CService addrProxy;\n-    bool fProxy = false;\n-    if (mapArgs.count(\"-proxy\")) {\n+    // true when Tor networks are not allowed or when -notor\n+    bool fTorDisabled = IsLimited(NET_TOR) || (mapArgs.count(\"-tor\") && mapArgs[\"-tor\"] == \"0\");\n+    // true when IPv6 networks are not allowed or when -noproxy6\n+    bool fProxy6Disabled = IsLimited(NET_IPV6) || (mapArgs.count(\"-proxy6\") && mapArgs[\"-proxy6\"] == \"0\");\n+    bool fTorActive = false;\n+    bool fProxy6Active = false;\n+\n+    // setup separate SOCKS5 proxy to reach Tor hidden services\n+    // -tor overrides base proxy, -notor disables tor entirely\n+    if (mapArgs.count(\"-tor\") && !fTorDisabled)\n+    {\n+        addrProxy = CService(mapArgs[\"-tor\"], 9050);\n+        if (SetProxy(NET_TOR, addrProxy, 5))\n+        {\n+            SetReachable(NET_TOR);\n+            fTorActive = true;\n+        }\n+        else\n+            return InitError(strprintf(_(\"Invalid -tor address: '%s'\"), mapArgs[\"-tor\"].c_str()));\n+    }\n+\n+#ifdef USE_IPV6\n+    // setup separate SOCKS5 proxy to reach IPv6 peers\n+    // -proxy6 overrides base proxy, -noproxy6 disables IPv6 proxy\n+    if (mapArgs.count(\"-proxy6\") && !fProxy6Disabled)\n+    {\n+        addrProxy = CService(mapArgs[\"-proxy6\"], 9050);\n+        if (SetProxy(NET_IPV6, addrProxy, 5))\n+            fProxy6Active = true;\n+        else\n+            return InitError(strprintf(_(\"Invalid -proxy6 address: '%s'\"), mapArgs[\"-proxy6\"].c_str()));\n+    }\n+#endif\n+\n+    // setup base SOCKS proxy\n+    if (mapArgs.count(\"-proxy\"))\n+    {\n         addrProxy = CService(mapArgs[\"-proxy\"], 9050);\n         if (!addrProxy.IsValid())\n             return InitError(strprintf(_(\"Invalid -proxy address: '%s'\"), mapArgs[\"-proxy\"].c_str()));\n \n         if (!IsLimited(NET_IPV4))\n             SetProxy(NET_IPV4, addrProxy, nSocksVersion);\n-        if (nSocksVersion > 4) {\n+        if (nSocksVersion == 5)\n+        {\n+            if (!fTorDisabled && !fTorActive)\n+            {\n+                SetProxy(NET_TOR, addrProxy, 5);\n+                SetReachable(NET_TOR);\n+            }\n #ifdef USE_IPV6\n-            if (!IsLimited(NET_IPV6))\n-                SetProxy(NET_IPV6, addrProxy, nSocksVersion);\n+            if (!fProxy6Disabled && !fProxy6Active)\n+            {\n+                SetProxy(NET_IPV6, addrProxy, 5);\n+            }\n #endif\n-            SetNameProxy(addrProxy, nSocksVersion);\n+            SetNameProxy(addrProxy, 5);\n         }\n-        fProxy = true;\n-    }\n-\n-    // -tor can override normal proxy, -notor disables tor entirely\n-    if (!(mapArgs.count(\"-tor\") && mapArgs[\"-tor\"] == \"0\") && (fProxy || mapArgs.count(\"-tor\"))) {\n-        CService addrOnion;\n-        if (!mapArgs.count(\"-tor\"))\n-            addrOnion = addrProxy;\n-        else\n-            addrOnion = CService(mapArgs[\"-tor\"], 9050);\n-        if (!addrOnion.IsValid())\n-            return InitError(strprintf(_(\"Invalid -tor address: '%s'\"), mapArgs[\"-tor\"].c_str()));\n-        SetProxy(NET_TOR, addrOnion, 5);\n-        SetReachable(NET_TOR);\n     }\n \n     // see Step 2: parameter interactions for more information about these"
      }
    ]
  }
]