DrahtBot,2021-04-09 21:13:53,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #21506 (p2p, refactor: make NetPermissionFlags an enum class by jonatack)\n\nIf you consider this pull request important, ",https://github.com/bitcoin/bitcoin/pull/21644#issuecomment-816975094,816975094,
vasild,2021-04-14 07:45:19,"> ...If the intent is for this conditional to return false only for noban...\n\nI think it is - the reasoning must be that we do not want to advertise our listen address if it has `noban`.",https://github.com/bitcoin/bitcoin/pull/21644#issuecomment-819306371,819306371,
jonatack,2021-04-14 16:26:21,"Thanks for the excellent review, @vasild. I added your commit description example from #21668, incorporated your suggestions, followed up on your https://github.com/bitcoin/bitcoin/pull/21644#discussion_r612996118 with the last commit, and updated all the commit messages and the PR description.",https://github.com/bitcoin/bitcoin/pull/21644#issuecomment-819649285,819649285,
jonatack,2021-04-18 14:41:16,@theStack Thanks for having a look! Dropped the bitwise AND test assertions; they would be removed in #21506 anyway so we may as well not add them.,https://github.com/bitcoin/bitcoin/pull/21644#issuecomment-822002097,822002097,
jonatack,2021-04-29 17:20:01,@hebasto Thanks. Follow-up #21506 prevents this class of bugs.,https://github.com/bitcoin/bitcoin/pull/21644#issuecomment-829445953,829445953,
jonatack,2021-05-11 10:16:22,"Thanks @vasild, @theStack, and @hebasto for the reviews and ACKs but this bugfix isn't being merged and I am cleaning up some loose ends before being less present here for some seminars. Up for grabs.",https://github.com/bitcoin/bitcoin/pull/21644#issuecomment-838215628,838215628,
jonatack,2021-05-11 10:47:23,"@kallewoof  agree, I thought about removing the argument too, could go one way or the other.",https://github.com/bitcoin/bitcoin/pull/21644#issuecomment-838256671,838256671,
MarcoFalke,2021-05-22 07:54:50,Only backport to 0.21 needed,https://github.com/bitcoin/bitcoin/pull/21644#issuecomment-846371084,846371084,
MarcoFalke,2021-05-22 08:01:16,Backported in #22022,https://github.com/bitcoin/bitcoin/pull/21644#issuecomment-846371749,846371749,
vasild,2021-04-14 06:46:54,`s/PF_NOBAN/NetPermissionsFlags::PF_NOBAN/`?,https://github.com/bitcoin/bitcoin/pull/21644#discussion_r612979295,612979295,src/net.cpp
vasild,2021-04-14 06:49:45,"nit: maybe `BOOST_REQUIRE()` is more appropriate here - if `TryParse()` fails, then the checks below are meaningless.",https://github.com/bitcoin/bitcoin/pull/21644#discussion_r612980851,612980851,src/test/netbase_tests.cpp
vasild,2021-04-14 07:16:57,"out of scope of this PR: this `ClearFlag()` will leave the flags in an invalid state `0b10000` that does not equal any of the `PF_*` flags or a combination of them. This shouldn't be even possible/allowed.\n\nIt is like having some fruits in a bag - apple, orange, pear and when you remove the apple, then the bag does not contain fruits anymore, it now contains a frog :frog:.",https://github.com/bitcoin/bitcoin/pull/21644#discussion_r612996118,612996118,src/test/netbase_tests.cpp
vasild,2021-04-14 07:25:20,"This is repeated 3 times: for `noban`, `noban,download` and `download,noban`. Could avoid the repetitions with something like:\n\n```cpp\nNetWhitebindPermissions noban;\nNetWhitebindPermissions noban_download;\nNetWhitebindPermissions download_noban;\n\nTryParse(""noban@..."", noban);\n...all 6 checks...\n\nTryParse(""noban,download@..."", noban_download);\nBOOST_CHECK_EQUAL(noban_download,",https://github.com/bitcoin/bitcoin/pull/21644#discussion_r613001155,613001155,src/test/netbase_tests.cpp
jonatack,2021-04-14 14:17:30,"sure, it's done in https://github.com/bitcoin/bitcoin/pull/21506/commits/873bbe6e46b8561acea365cb0fffa226fd891826#diff-00021eed586a482abdb09d6cdada1d90115abe988a91421851960e26658bed02R2413 but may as well update it here since I'm retouching both pulls",https://github.com/bitcoin/bitcoin/pull/21644#discussion_r613288505,613288505,src/net.cpp
jonatack,2021-04-14 14:17:47,done,https://github.com/bitcoin/bitcoin/pull/21644#discussion_r613288822,613288822,src/test/netbase_tests.cpp
jonatack,2021-04-14 14:20:09,done,https://github.com/bitcoin/bitcoin/pull/21644#discussion_r613291029,613291029,src/test/netbase_tests.cpp
jonatack,2021-04-14 15:28:10,"Good point. Added an assert and doxygen doc explanation to `ClearFlags` to allow only clearing the implicit flag, as it's the only current use.",https://github.com/bitcoin/bitcoin/pull/21644#discussion_r613351570,613351570,src/test/netbase_tests.cpp
vasild,2021-04-14 16:46:00,"During fuzzing `ClearFlag()` is called with a fuzzed/random argument:\n\nhttps://github.com/bitcoin/bitcoin/blob/773f8c1a7d568012768e16d2ede65b5d4d62aced/src/test/fuzz/net_permissions.cpp#L28\n\nhttps://github.com/bitcoin/bitcoin/blob/773f8c1a7d568012768e16d2ede65b5d4d62aced/src/test/fuzz/net_permissions.cpp#L38\n\nI guess this means that eventually this newly added assert will be triggered?",https://github.com/bitcoin/bitcoin/pull/21644#discussion_r613411881,613411881,src/net_permissions.h
jonatack,2021-04-14 17:07:22,"Ah, didn't check the fuzzer. Thanks!",https://github.com/bitcoin/bitcoin/pull/21644#discussion_r613426449,613426449,src/net_permissions.h
jonatack,2021-04-14 18:46:13,Fixed.,https://github.com/bitcoin/bitcoin/pull/21644#discussion_r613504020,613504020,src/net_permissions.h
rebroad,2021-05-15 17:38:57,why the brackets?,https://github.com/bitcoin/bitcoin/pull/21644#discussion_r632986519,632986519,src/net.cpp
jonatack,2021-05-15 17:45:54,"> why the brackets?\n\ndoc/developer-notes.md:\n\n```\n  - If an `if` only has a single-statement `then`-clause, it can appear\n    on the same line as the `if`, without braces. In every other case,\n    braces are required, and the `then` and `else` clauses must appear\n    correctly indented on a new line.\n```\n(there was a famous bug caused by this, I don't recall the link)",https://github.com/bitcoin/bitcoin/pull/21644#discussion_r632987154,632987154,src/net.cpp
practicalswift,2021-05-16 17:54:57,"> (there was a famous bug caused by this, I don't recall the link)\n\nCVE-2014-1266: the [Apple ""goto fail"" vulnerability](https://dwheeler.com/essays/apple-goto-fail.html) :)",https://github.com/bitcoin/bitcoin/pull/21644#discussion_r633119088,633119088,src/net.cpp
vasild,2021-05-17 16:19:09,"In addition to bugs, maintenance/code review is easier if braces are always present. Consider this:\n\n```diff\n if ((some long expression && what is this == 123) || oh no) {\n     statement 1;\n+    statement 2;\n }\n```\n\nvs\n\n```diff\n- if ((some long expression && what is this == 123) || oh no)\n+ if ((some long expression && what is this == 123) || oh no) {\n     statement 1;",https://github.com/bitcoin/bitcoin/pull/21644#discussion_r633674732,633674732,src/net.cpp
