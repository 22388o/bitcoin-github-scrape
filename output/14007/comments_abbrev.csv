MarcoFalke,2018-08-22T20:22:34Z,I think there is some interference with a firewall or something that kills the bitcoind processes?,https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-415166784,415166784,
ken2812221,2018-08-23T04:31:54Z,"It is really hard to see blue color on powershell, so change the color to green\n![image](https://user-images.githubusercontent.com/11154118/44504782-5a1c1b80-a6d0-11e8-8f0c-9d3f4c9e380f.png)\n",https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-415286908,415286908,
DrahtBot,2018-08-23T04:46:22Z,<!--e57a25ab6845829454e8d69fc972939a-->Note to reviewers: This pull request conflicts with the following ones:\n\n* #14275 (tests: Write the notification message to different files to avoid race condition in feature_notifications.py by ken2812221)\n* #14241 (appveyor: trivial build cache improvement by ken2812221)\n* #14237 (Fix for test runner UnicodeDecodeError when utf-8 is not supported by san,https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-415289153,415289153,
ken2812221,2018-08-23T10:50:07Z,">I think there is some interference with a firewall or something that kills the bitcoind processes?\n\nI agree with you, they are all passed on my Windows PC.",https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-415373421,415373421,
MarcoFalke,2018-08-23T13:37:25Z,They didn't pass for me on Windows 7,https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-415416696,415416696,
ken2812221,2018-08-24T01:01:28Z,"Oh, it's occasionally. I tested to run it 10 times, 8 times failed, 2 times succeed.",https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-415618728,415618728,
ken2812221,2018-08-25T08:26:33Z,"This is ready for review, the wallet_multiwallet.py fail is unrelated to the test framework. It is a bug related to c++ code, it would exit with 0xC0000005(Acccess violation) during shutdown occasionally.",https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-415953042,415953042,
ken2812221,2018-08-27T14:31:40Z,I think we could disable those problematic tests for now.,https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-416246540,416246540,
ken2812221,2018-08-27T16:39:33Z,"> I think there is some interference with a firewall or something that kills the bitcoind processes?\n\nSolve this problem by using new connection every time we call RPC. Not sure why would that happen.",https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-416287813,416287813,
MarcoFalke,2018-08-27T17:13:49Z,What happened to the cache fix? I think we are not yet properly caching the intermediate compile results?,https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-416298156,416298156,
ken2812221,2018-08-27T19:42:13Z,@MarcoFalke I add the build cache in #14086,https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-416344135,416344135,
ken2812221,2018-08-29T10:57:43Z,"Update: Based on #14086, following #14092 ",https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-416912105,416912105,
ken2812221,2018-09-05T09:50:22Z,"#14086 has been merged, this is ready for review.",https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-418670915,418670915,
ken2812221,2018-09-07T22:52:47Z,@NicolasDorier @sipsorcery Would you mind reviewing this?,https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-419586914,419586914,
sipsorcery,2018-09-08T19:50:26Z,"tACK https://github.com/bitcoin/bitcoin/pull/14007/commits/1223343106c4c889360aeb019d1bfe703708534f\n",https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-419668561,419668561,
NicolasDorier,2018-09-09T06:05:53Z,"Why, when I build from visual studio directly, bitcoind.exe is not in `bitcoindir\build_msvc\%PLATFORM%\%CONFIGURATION%\bitcoind.exe` but in `bitcoindir\build_msvc\%CONFIGURATION%\bitcoind.exe` ?",https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-419693310,419693310,
ken2812221,2018-09-09T06:19:47Z,"@NicolasDorier How about now? If you prefer this, I will squash it.",https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-419693793,419693793,
NicolasDorier,2018-09-09T06:27:32Z,"Trying to debug this (strange error, as bitcoind is started correctly)\n\n```\nPS C:\Sources\bitcoin> python test\functional\test_runner.py --force wallet_multiwallet.py\nTemporary test directory at C:\Users\NICOLA~1\AppData\Local\Temp/test_runner_20180909_152112\n..................................................................................................................................",https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-419694111,419694111,
ken2812221,2018-09-09T06:38:55Z,@NicolasDorier You get that error in every test or just wallet_multiwallet?,https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-419694577,419694577,
NicolasDorier,2018-09-09T07:02:29Z,"Does not seem to be only this test, probably a problem on my end. Searching why.",https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-419695423,419695423,
ken2812221,2018-09-09T07:06:04Z,@NicolasDorier Did you switch to my PR branch? I usually see that issue on current master.,https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-419695575,419695575,
NicolasDorier,2018-09-09T07:12:05Z,"I need to go, will check/debug again later, \n\n[node1.debug.log](https://github.com/bitcoin/bitcoin/files/2364038/node1.debug.log)\n[node0.debug.log](https://github.com/bitcoin/bitcoin/files/2364039/node0.debug.log)\n\nafter trying `python test\functional\test_runner.py --force wallet_hd.py`",https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-419695822,419695822,
NicolasDorier,2018-09-09T07:12:47Z,yes I am on patch-2,https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-419695860,419695860,
NicolasDorier,2018-09-09T12:07:12Z,"Ok so this is strange,\n\n```python test\functional\test_runner.py --force wallet_hd.py``` fails (actually any test fail on my machine)\n\n```\n2018-09-09 11:58:02.382258 Bitcoin Core version v1.15.99.0-unk (release build)\n2018-09-09 11:58:02.382258 InitParameterInteraction: parameter interaction: -whitelistforcerelay=1 -> setting -whitelistrelay=1\n2018-09-09 11:58:02.384259 Validating si",https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-419711490,419711490,
ken2812221,2018-09-09T12:16:44Z,"Weird, why is your temporary directory is `C:\Users\NICOLA~1\AppData\Local\Temp\` when your username is `NicolasDorier`? Do `C:\Users\NICOLA~1\` exist?",https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-419712049,419712049,
NicolasDorier,2018-09-09T12:21:28Z,@ken2812221 yes it exists. I think it is an alternative name for `C:\Users\NicolasDorier\`. I don't know why bitcoin python test use the ~1 version. Do you want I check? I don't think that is the issue though.,https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-419712249,419712249,
ken2812221,2018-09-09T14:10:23Z,"Why is your version is `v1.15.99.0`? if it is the same as `0.15.99`, it may not able to read conf file properly, especially for rpcport setting.",https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-419718558,419718558,
sipsorcery,2018-09-09T20:08:08Z,"@NicolasDorier @ken2812221 The `C:\Users\NICOLA~1\` is the Windows ""Short"" directory name, a hangover from [MS-DOS naming ](https://docs.microsoft.com/en-us/windows/desktop/fileio/naming-a-file#naming-conventions) I also doubt it's causing a problem.\n\nThe python tests work correctly for me on an AppVeyor build. They fail in a few different spots on my x64 Windows 10 machine with Python 3.7. I ",https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-419741423,419741423,
ken2812221,2018-09-09T23:08:45Z,@sipsorcery BN_new is not in libssl but in libeay on Windows,https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-419751871,419751871,
NicolasDorier,2018-09-10T02:36:56Z,"I am not testing the tests on AppVeyor now, just replicating his command line on my own box. \n\nWild guess: is it possible that the config file get created too late, after the node started? (as if you forgot to flush the data to the config file?)\n\nI will continue to dig in.",https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-419770805,419770805,
ken2812221,2018-09-10T02:44:08Z,"@NicolasDorier Can you try re-compile your bitcoind? Seems like you're using v0.15, but the tests is for v0.17. v0.15 can't read current test conf file properly and does not warn.",https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-419771704,419771704,
NicolasDorier,2018-09-10T03:50:07Z,"@ken2812221 I think that's why! Sorry for that, I compiled for Debug but was referencing Release... Recompiling now, but it should work.",https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-419779700,419779700,
NicolasDorier,2018-09-10T06:15:04Z,"@ken2812221 so the problem was just me having not linked the right exe... was stupid.\n\nNow concerning `wallet_multiwallet.py`\n```\nPS C:\Sources\bitcoin>  python test\functional\test_runner.py --force wallet_multiwallet.py\nTemporary test directory at C:\Users\NICOLA~1\AppData\Local\Temp/test_runner_20180910_150543\n...................................................\nwallet_multiwallet.",https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-419799793,419799793,
ken2812221,2018-09-10T06:47:00Z,"@NicolasDorier That's a bug in bitcoind, so I disabled wallet_multiwallet.py to run on Appveyor for now. Maybe it's related to #14163.",https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-419806190,419806190,
NicolasDorier,2018-09-10T07:24:58Z,"Understood, so I think you should remove the changes of `wallet_multiwallet.py` for this PR. Then rebase them on a separate PR on top of #14163 fix, so we can properly test that part independently when we can.",https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-419814190,419814190,
ken2812221,2018-09-10T07:33:34Z,"Actually, the probability that it would fail is about 50%, so the script can be tested. And the tests would fails only when nodes shutting down.\n\nIf there are more people think that I should revert those changes, I will do that.",https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-419816313,419816313,
NicolasDorier,2018-09-10T07:39:20Z,"ran several time, do not pass. Though it is not blocking for me, can as well reactivate the test once the fix is done later down the road. \n\ntACK 529c5274de6fae782154c2845b6a691db46b0d4e",https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-419817695,419817695,
ken2812221,2018-09-10T07:42:36Z,Thanks for your review 👍 ,https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-419818441,419818441,
MarcoFalke,2018-09-12T00:25:24Z,"Thanks, re-ACK",https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-420470268,420470268,
ken2812221,2018-09-12T20:31:03Z,@jnewbery Would you mind reviewing the test changes here. Most of code that changed in this PR are previously written by you.,https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-420786905,420786905,
jnewbery,2018-09-12T21:08:41Z,"Sure, I can review the _tests: Make it possible to run functional tests on Windows_ commit, but it probably won't be until next week.",https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-420798453,420798453,
laanwj,2018-09-13T08:19:34Z,utACK d5678479266bb087b37ee503000ab161d9e44664,https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-420924111,420924111,
ken2812221,2018-09-16T23:42:36Z,"Update: Disabled 1 additional tests for now because of #14225 merged.\n- [feature_notifications](https://ci.appveyor.com/project/DrahtBot/bitcoin/build/master.1396#L345)\nBitcoin Core handle notifications in different thread, which can cause a race condition.\n\n- ~[mining_getblocktemplate_longpoll](https://ci.appveyor.com/project/DrahtBot/bitcoin/build/master.1396#L300)\nI'm not entirely sur",https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-421854259,421854259,
ken2812221,2018-09-17T00:43:05Z,@MarcoFalke `connection` is still used in `mining_getblocktemplate_longpoll.py`. Please re-review.,https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-421861578,421861578,
MarcoFalke,2018-09-17T19:30:21Z,utACK 661ac15a4aafae6ec1579721ef36ca2fde9c17b0,https://github.com/bitcoin/bitcoin/pull/14007#issuecomment-422140777,422140777,
MarcoFalke,2018-08-22T20:23:17Z,Could as a first step only run the util tests?,https://github.com/bitcoin/bitcoin/pull/14007#discussion_r212095050,212095050,appveyor.yml
ken2812221,2018-08-23T02:36:43Z,"You mean to drop away functional tests and replace it with util tests from this PR, and re-add the funfctional tests in another PR?",https://github.com/bitcoin/bitcoin/pull/14007#discussion_r212167188,212167188,appveyor.yml
MarcoFalke,2018-08-25T13:52:48Z,Why is this change needed?,https://github.com/bitcoin/bitcoin/pull/14007#discussion_r212799062,212799062,test/util/bitcoin-util-test.py
ken2812221,2018-08-25T13:59:50Z,"The binary built by MSVC is not at `src/`, so it needs a variable to indicate the binary location.",https://github.com/bitcoin/bitcoin/pull/14007#discussion_r212799214,212799214,test/util/bitcoin-util-test.py
MarcoFalke,2018-08-25T15:00:10Z,I think this caching fix can be submitted in an independent pr,https://github.com/bitcoin/bitcoin/pull/14007#discussion_r212800611,212800611,appveyor.yml
ken2812221,2018-08-25T15:20:08Z,fine,https://github.com/bitcoin/bitcoin/pull/14007#discussion_r212801089,212801089,appveyor.yml
MarcoFalke,2018-09-05T12:58:27Z,"I think this check can be removed. Color is off by default and if someone specifies color, they have a reason to do so (maybe write to a file that is read on a different os/platform)",https://github.com/bitcoin/bitcoin/pull/14007#discussion_r215258053,215258053,test/functional/combine_logs.py
MarcoFalke,2018-09-05T13:03:52Z,"I think this is no longer supported? So could remove the named arg ""connection""?",https://github.com/bitcoin/bitcoin/pull/14007#discussion_r215259898,215259898,test/functional/test_framework/authproxy.py
MarcoFalke,2018-09-05T13:05:04Z,Could move this into a method `def _set_conn(self):` to avoid duplication?,https://github.com/bitcoin/bitcoin/pull/14007#discussion_r215260267,215260267,test/functional/test_framework/authproxy.py
MarcoFalke,2018-09-05T13:05:22Z,Could add a comment that this works around some issues on windows.,https://github.com/bitcoin/bitcoin/pull/14007#discussion_r215260367,215260367,test/functional/test_framework/authproxy.py
MarcoFalke,2018-09-05T13:06:17Z,"Hmm, any rationale for this? I'd prefer to throw if the log was not unicode.",https://github.com/bitcoin/bitcoin/pull/14007#discussion_r215260628,215260628,test/functional/test_framework/test_node.py
MarcoFalke,2018-09-05T13:11:09Z,I'd prefer to keep the throw on non-unicode log files.,https://github.com/bitcoin/bitcoin/pull/14007#discussion_r215262180,215262180,test/functional/test_runner.py
ken2812221,2018-09-05T13:25:34Z,"an error message thrown by boost is always localized(translated) and use ANSI encoding, so it would always throw an error. I don't know any solution to fix this. There is no way to specify the error message format.\n\nFor now, I could revert this because appveyor is using English, but it would cause problem if the user is running a non-English Windows. It can be marked as an issue with #13869.",https://github.com/bitcoin/bitcoin/pull/14007#discussion_r215267179,215267179,test/functional/test_framework/test_node.py
ken2812221,2018-09-05T15:05:48Z,Same as above.,https://github.com/bitcoin/bitcoin/pull/14007#discussion_r215309027,215309027,test/functional/test_runner.py
ken2812221,2018-09-07T14:22:42Z,"I want to avoid re-uploading cache files if there is no change in #14086, I chose to delete the stats file entirely. But that was a mistake, it would also clear the cache size information which extremely increase cache size.\n\nAfter then, I realize that clcache has a command to clear hit and miss info but retain size info: `clcache -z`\n\nSee: https://github.com/frerich/clcache/blob/master/RE",https://github.com/bitcoin/bitcoin/pull/14007#discussion_r215975435,215975435,appveyor.yml
NicolasDorier,2018-09-09T05:59:03Z,"Why is it in `'` ? This command just print the string, it does not save on `config.ini`",https://github.com/bitcoin/bitcoin/pull/14007#discussion_r216148034,216148034,appveyor.yml
ken2812221,2018-09-09T06:02:49Z,This is to escape that `[` has special meaning in yaml. The actual command does not contain the quote.,https://github.com/bitcoin/bitcoin/pull/14007#discussion_r216148072,216148072,appveyor.yml
NicolasDorier,2018-09-09T06:03:31Z,Would be better to not mix and use powershell.,https://github.com/bitcoin/bitcoin/pull/14007#discussion_r216148085,216148085,appveyor.yml
ken2812221,2018-09-09T06:06:12Z,Any reason why that is better?,https://github.com/bitcoin/bitcoin/pull/14007#discussion_r216148139,216148139,appveyor.yml
NicolasDorier,2018-09-09T06:21:58Z,$env:Platform\$env:Configuration,https://github.com/bitcoin/bitcoin/pull/14007#discussion_r216148387,216148387,appveyor.yml
NicolasDorier,2018-09-09T06:22:24Z,"""$env:APPVEYOR_BUILD_FOLDER\build_msvc\\$env:Platform\\$env:Configuration""",https://github.com/bitcoin/bitcoin/pull/14007#discussion_r216148399,216148399,appveyor.yml
NicolasDorier,2018-09-09T06:28:42Z,"You can keep like this is you feel lazy, but \n\n` $env:BITCOINPATH = ""$env:APPVEYOR_BUILD_FOLDER\build_msvc\$env:PLATFORM\$env:CONFIGURATION""` is more readable",https://github.com/bitcoin/bitcoin/pull/14007#discussion_r216148495,216148495,appveyor.yml
ken2812221,2018-09-09T06:31:52Z,done,https://github.com/bitcoin/bitcoin/pull/14007#discussion_r216148650,216148650,appveyor.yml
NicolasDorier,2018-09-09T06:40:03Z,using `ps` here would be better.,https://github.com/bitcoin/bitcoin/pull/14007#discussion_r216148822,216148822,appveyor.yml
ken2812221,2018-09-09T06:45:52Z," `ps` on appveyor can't show unicode correctly\nhttps://help.appveyor.com/discussions/problems/1105-utf-8-characters-in-powershell-log",https://github.com/bitcoin/bitcoin/pull/14007#discussion_r216148931,216148931,appveyor.yml
ken2812221,2018-09-09T06:49:36Z,"So you would prefer to use `ps` if possible? If so, I would change those except \n```\npython test\functional\test_runner.py --force --quiet --combinedlogslen=4000 --exclude ""wallet_multiwallet,wallet_multiwallet.py --usecli""\n```\nbecause of appveyor ps issue.",https://github.com/bitcoin/bitcoin/pull/14007#discussion_r216148989,216148989,appveyor.yml
NicolasDorier,2018-09-09T06:54:20Z,"Interesting, yes I think that is a good choice.\nShould probably add a short comment about it.",https://github.com/bitcoin/bitcoin/pull/14007#discussion_r216149105,216149105,appveyor.yml
,2018-09-09T06:55:10Z,ps,https://github.com/bitcoin/bitcoin/pull/14007#discussion_r216149122,216149122,appveyor.yml
ken2812221,2018-09-09T07:25:39Z,@NicolasDorier Keep this `cmd` because appveyor ps hate stderr: https://ci.appveyor.com/project/DrahtBot/bitcoin/build/master.991,https://github.com/bitcoin/bitcoin/pull/14007#discussion_r216149869,216149869,appveyor.yml
MarcoFalke,2018-09-09T21:25:02Z,Could just shorten this to `'non-canonical ReadCompactSize'`?,https://github.com/bitcoin/bitcoin/pull/14007#discussion_r216170532,216170532,test/functional/feature_block.py
ken2812221,2018-09-09T23:50:13Z,Done.,https://github.com/bitcoin/bitcoin/pull/14007#discussion_r216175012,216175012,test/functional/feature_block.py
ken2812221,2018-09-11T20:42:55Z,Done in #14192,https://github.com/bitcoin/bitcoin/pull/14007#discussion_r216815396,216815396,test/functional/test_framework/test_node.py
MarcoFalke,2018-09-11T22:55:30Z,"Hmm, this env var is not documented and makes the code a bit harder to read. Would it be too ugly to call `mkdir src && mv ./bitcoin*.exe ./src` in the appveyor after compile?",https://github.com/bitcoin/bitcoin/pull/14007#discussion_r216849739,216849739,test/util/bitcoin-util-test.py
ken2812221,2018-09-11T23:22:55Z,How about now?,https://github.com/bitcoin/bitcoin/pull/14007#discussion_r216854697,216854697,test/util/bitcoin-util-test.py
laanwj,2018-09-13T07:19:34Z,"if you have to use ctypes directly here, with magic numbers, can you please at least add a comment about what the numbers here mean, what it is doing",https://github.com/bitcoin/bitcoin/pull/14007#discussion_r217282477,217282477,test/functional/test_runner.py
laanwj,2018-09-13T07:20:38Z,"ACK on the color change to red/green, right in time for christmas",https://github.com/bitcoin/bitcoin/pull/14007#discussion_r217282730,217282730,test/functional/test_runner.py
laanwj,2018-09-13T07:28:30Z,"I guess this is meant as a temporary work-around until we find out *why*? (might want to add a comment in that regard) being able to re-use RPC connections is a big deal, it's not something we should simply accept as-is.",https://github.com/bitcoin/bitcoin/pull/14007#discussion_r217284637,217284637,test/functional/test_framework/authproxy.py
jnewbery,2018-09-24T21:48:04Z,"I don't understand this change. The point of:\n\n```\n[re.sub(""\.py$"", """", test) + "".py""\n```\nis that if `<test_name>.py` or `<test_name>` is given, then it's normalized to `<test_name>.py`.\n\nYour new version:\n\n```\nre.sub(""\.py$"", """", test) + ("".py"" if "".py"" not in test else """")\n```\n\n essentially toggles, so `<test_name>.py` is changed to `<test_name>` and `<test_name>` is ch",https://github.com/bitcoin/bitcoin/pull/14007#discussion_r220000285,220000285,test/functional/test_runner.py
MarcoFalke,2018-09-24T22:29:36Z,"The goal was to be able to specify `--exclude ""feature_notifications,wallet_multiwallet,wallet_multiwallet.py --usecli""`.\n\nI think removing everything from the `test_list` that `.startswith(item.split('.py')[0])` for any item in `args.exclude.split(',')` should solve all issues?",https://github.com/bitcoin/bitcoin/pull/14007#discussion_r220009123,220009123,test/functional/test_runner.py
ken2812221,2018-09-25T03:17:39Z,"Oh, I didn't test that case. Should be fixed in #14316",https://github.com/bitcoin/bitcoin/pull/14007#discussion_r220048678,220048678,test/functional/test_runner.py
