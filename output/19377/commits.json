[
  {
    "sha": "b0a576128669c7ebe61a53a3c3a9d1e21c4c844e",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiMGE1NzYxMjg2NjljN2ViZTYxYTUzYTNjM2E5ZDFlMjFjNGM4NDRl",
    "commit": {
      "author": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2020-06-25T06:12:52Z"
      },
      "committer": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2020-08-02T20:13:53Z"
      },
      "message": "bench: Add OrphanTxPool benchmark",
      "tree": {
        "sha": "cdbe2187e51cbcfe4214929ebb93554c2bf397fb",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/cdbe2187e51cbcfe4214929ebb93554c2bf397fb"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b0a576128669c7ebe61a53a3c3a9d1e21c4c844e",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE0dvyxLlvLev0wWZUQQEIES5+qB8FAl8nHoEACgkQQQEIES5+\nqB/qkA/8DCM5Co1/nJFYDIUeIlTh+slqnFzltwGONa9PYCRa4Wb9lUVnkjuCLecK\ndwwSvqzbpx5Kl+nPZ1wQqxOs4tYE1UHbKECbDRHrq4HW0sI2CGi8kn/4cnBVu8hr\nQj7TRfzeEyyNPQco2JV8D4uIFNPVYlCYlhU2N/mRaisemefDnkTQQpGI24iU+Gva\nNuap2Y/K4Mwem+lksa2qzR69Q9EADYsB+pJuNmDa6gSqdvnD1PK6d8xIC1D7JipX\n9k4jSoFp7uYkhjbcJnCBfADc7j45s8NltrHbg2n5CF4uXK7kQV2zYVMHOfvQgmFy\ni9MKtQmtkQjyg1JRI/znEYfitOMC4wIh71/Q6vE1VN6ha8Va0THTn1nJPqYE3bFE\nqeYh3Mb+CgE0/fdCkVhyV6NGwf9/zxpZG06Ua/nxNbuCkGeEUgzHeQv002kl3dTT\n+Qy47Qsyl2oQwyVK7iTHj0e4gsx+zFHlsbb7cOZLs5i8KxYBPskcHLqBsaS8P2QY\nG0wemAN8KBycjzV0Pj8lycl59nqZK2ndey+f/H441+9zLbd1ru4mQGY00myOngkE\nXNa5d5gJL8bxS2rUUARxUhPDyacTGtEiRpqf/r6VytCx4H0R2xcHMFk6Toc3wSz9\nDBVWGH34nN4xSnD7XKl91Aa0nt1RSELZ7f+e1rxNQM6IzyGNeMc=\n=wY4n\n-----END PGP SIGNATURE-----",
        "payload": "tree cdbe2187e51cbcfe4214929ebb93554c2bf397fb\nparent a78742830aa35bf57bcb0a4730977a1e5a1876bc\nauthor Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1593065572 +0300\ncommitter Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1596399233 +0300\n\nbench: Add OrphanTxPool benchmark\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b0a576128669c7ebe61a53a3c3a9d1e21c4c844e",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/b0a576128669c7ebe61a53a3c3a9d1e21c4c844e",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b0a576128669c7ebe61a53a3c3a9d1e21c4c844e/comments",
    "author": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "a78742830aa35bf57bcb0a4730977a1e5a1876bc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a78742830aa35bf57bcb0a4730977a1e5a1876bc",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/a78742830aa35bf57bcb0a4730977a1e5a1876bc"
      }
    ],
    "stats": {
      "total": 43,
      "additions": 43,
      "deletions": 0
    },
    "files": [
      {
        "sha": "d921bfee97c89409c35c2abf5e15ed15fc411461",
        "filename": "src/Makefile.bench.include",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/b0a576128669c7ebe61a53a3c3a9d1e21c4c844e/src/Makefile.bench.include",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/b0a576128669c7ebe61a53a3c3a9d1e21c4c844e/src/Makefile.bench.include",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/Makefile.bench.include?ref=b0a576128669c7ebe61a53a3c3a9d1e21c4c844e",
        "patch": "@@ -35,6 +35,7 @@ bench_bench_bitcoin_SOURCES = \\\n   bench/mempool_stress.cpp \\\n   bench/nanobench.h \\\n   bench/nanobench.cpp \\\n+  bench/orphan_tx_pool.cpp \\\n   bench/rpc_blockchain.cpp \\\n   bench/rpc_mempool.cpp \\\n   bench/util_time.cpp \\"
      },
      {
        "sha": "f6c84e704c85837a2afb9f1f06fbe7934cf283e4",
        "filename": "src/bench/orphan_tx_pool.cpp",
        "status": "added",
        "additions": 42,
        "deletions": 0,
        "changes": 42,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/b0a576128669c7ebe61a53a3c3a9d1e21c4c844e/src/bench/orphan_tx_pool.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/b0a576128669c7ebe61a53a3c3a9d1e21c4c844e/src/bench/orphan_tx_pool.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bench/orphan_tx_pool.cpp?ref=b0a576128669c7ebe61a53a3c3a9d1e21c4c844e",
        "patch": "@@ -0,0 +1,42 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <bench/nanobench.h>\n+\n+#include <net.h>\n+#include <net_processing.h>\n+#include <primitives/transaction.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <sync.h>\n+\n+#include <vector>\n+\n+bool AddOrphanTx(const CTransactionRef& tx, NodeId peer) EXCLUSIVE_LOCKS_REQUIRED(g_cs_orphans);\n+unsigned int LimitOrphanTxSize(unsigned int nMaxOrphans);\n+\n+static void OrphanTxPool(benchmark::Bench& bench)\n+{\n+    FastRandomContext rand;\n+    std::vector<CTransactionRef> txs;\n+    for (unsigned int i = 0; i < DEFAULT_MAX_ORPHAN_TRANSACTIONS; ++i) {\n+        CMutableTransaction tx;\n+        tx.vin.resize(1);\n+        tx.vin[0].prevout.n = 0;\n+        tx.vin[0].prevout.hash = rand.rand256();\n+        tx.vin[0].scriptSig << OP_1;\n+        tx.vout.resize(1);\n+        tx.vout[0].nValue = 0;\n+        tx.vout[0].scriptPubKey << OP_1;\n+        txs.emplace_back(MakeTransactionRef(tx));\n+    }\n+\n+    bench.batch(txs.size()).unit(\"byte\").run([&] {\n+        WITH_LOCK(g_cs_orphans, for (const auto& tx : txs) { AddOrphanTx(tx, 0); });\n+        LimitOrphanTxSize(0);\n+    });\n+}\n+\n+BENCHMARK(OrphanTxPool);"
      }
    ]
  }
]