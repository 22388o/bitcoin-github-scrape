laanwj,2014-08-14T08:33:37Z,"Not sure about this.\nFor wallets it's extremely important to keep compatibility, even with the oldest possible ones.\nBut if you say that multiple transactions having the same orderpos (or an orderpos<0) doesn't give problems then it may not be so important to keep `ReorderTransactions` around, especially if the current implementation makes it even more broken.\n",https://github.com/bitcoin/bitcoin/pull/4697#issuecomment-52156843,52156843,
luke-jr,2014-08-14T08:44:09Z,"This worked when I wrote it. Maybe there's a bug introduced by the zap wallet stuff, but that shouldn't be ""fixed"" by breaking compatibility with old wallets.\n",https://github.com/bitcoin/bitcoin/pull/4697#issuecomment-52157705,52157705,
cozz,2014-08-14T08:48:20Z,I will do some more testing and report back.\n,https://github.com/bitcoin/bitcoin/pull/4697#issuecomment-52158086,52158086,
laanwj,2014-08-14T08:50:48Z,In principle ReorderTransactions is a quite simple function. Not some Satoshi monster code that we have to get rid of asap. So my preference would go to fixing it as well.\n,https://github.com/bitcoin/bitcoin/pull/4697#issuecomment-52158315,52158315,
cozz,2014-08-14T14:50:20Z,"Updated the title from ""Remove"" to ""Improve"" now.\n\nI think we should write all changes to nOrderPos back to the database.\nCurrently txs and nOrderPosNext are not written back, only in-memory. This means that\nReorderTransactions(..) is run everytime you start the wallet and\nhave -1 ids. \n\nIf you only had AccEntrys with -1, this could result in a bug,\nbecause they are written back with highe",https://github.com/bitcoin/bitcoin/pull/4697#issuecomment-52193146,52193146,
luke-jr,2014-08-14T14:52:05Z,"I think that looks safe, but it's been a while... Writing nOrderPosNext should be sufficient to fix it, no?\n",https://github.com/bitcoin/bitcoin/pull/4697#issuecomment-52193387,52193387,
cozz,2014-08-14T15:03:29Z,"Yes,\n\nbut if we dont write the txs back, they have nOrderPos=-1 again, next time you start the wallet.\nUnless you trigger a wtx.WriteToDisk() somehow else, through rescan for example.\n\nThis means that ReorderTransactions(..) is called everytime you load the wallet.\nBut it should be a one time thing.\n\nI am fine with closing this pull request too, if you prefer that, as this code is 2 years ",https://github.com/bitcoin/bitcoin/pull/4697#issuecomment-52194951,52194951,
luke-jr,2014-08-14T15:09:34Z,@cozz It's okay to redo it every time: the results should be the same. :)\n\nBut writing it back should be harmless too.\n,https://github.com/bitcoin/bitcoin/pull/4697#issuecomment-52195806,52195806,
cozz,2014-08-14T15:28:33Z,"Closing in that case, thanks for helping here anyway.\n",https://github.com/bitcoin/bitcoin/pull/4697#issuecomment-52198659,52198659,
laanwj,2014-08-14T15:30:42Z,I don't think it makes sense to do it every time. Fixing an old wallet should be a one-time thing - after that it should behave like a new wallet.\n,https://github.com/bitcoin/bitcoin/pull/4697#issuecomment-52198959,52198959,
cozz,2014-08-14T15:38:48Z,Reopening in that case.\n,https://github.com/bitcoin/bitcoin/pull/4697#issuecomment-52200101,52200101,
BitcoinPullTester,2014-08-18T17:48:28Z,"Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/p4697_da2ede2aa68ba14e1228b61e41a5840669560eee/ for binaries and test log.\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.log is moving at http://jenkins.bluematt.me/pull-te",https://github.com/bitcoin/bitcoin/pull/4697#issuecomment-52528474,52528474,
laanwj,2014-09-08T09:05:21Z,ACK\n,https://github.com/bitcoin/bitcoin/pull/4697#issuecomment-54792591,54792591,
