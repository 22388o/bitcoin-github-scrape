[
  {
    "sha": "28d4542a0ac77a30a242d0568e580a5b437f53fa",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyOGQ0NTQyYTBhYzc3YTMwYTI0MmQwNTY4ZTU4MGE1YjQzN2Y1M2Zh",
    "commit": {
      "author": {
        "name": "Matt Corallo",
        "email": "git@bluematt.me",
        "date": "2017-09-21T00:19:14Z"
      },
      "committer": {
        "name": "Matt Corallo",
        "email": "git@bluematt.me",
        "date": "2017-09-21T03:29:59Z"
      },
      "message": "Disallow uncompressed pubkeys in bitcoin-tx [multisig] output adds",
      "tree": {
        "sha": "f21f03c770beb8586aef0fede0d18e089471882c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f21f03c770beb8586aef0fede0d18e089471882c"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/28d4542a0ac77a30a242d0568e580a5b437f53fa",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/28d4542a0ac77a30a242d0568e580a5b437f53fa",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/28d4542a0ac77a30a242d0568e580a5b437f53fa",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/28d4542a0ac77a30a242d0568e580a5b437f53fa/comments",
    "author": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "98212745c8acb5cc4e688bbb3979bfd46b25f98a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/98212745c8acb5cc4e688bbb3979bfd46b25f98a",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/98212745c8acb5cc4e688bbb3979bfd46b25f98a"
      }
    ],
    "stats": {
      "total": 53,
      "additions": 53,
      "deletions": 0
    },
    "files": [
      {
        "sha": "3b62a106031c86f431981d4bae5f5447ef0efea1",
        "filename": "Makefile.am",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/28d4542a0ac77a30a242d0568e580a5b437f53fa/Makefile.am",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/28d4542a0ac77a30a242d0568e580a5b437f53fa/Makefile.am",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/Makefile.am?ref=28d4542a0ac77a30a242d0568e580a5b437f53fa",
        "patch": "@@ -249,6 +249,7 @@ EXTRA_DIST += \\\n     test/util/data/txcreatemultisig3.json \\\n     test/util/data/txcreatemultisig4.hex \\\n     test/util/data/txcreatemultisig4.json \\\n+    test/util/data/txcreatemultisig5.json \\\n     test/util/data/txcreateoutpubkey1.hex \\\n     test/util/data/txcreateoutpubkey1.json \\\n     test/util/data/txcreateoutpubkey2.hex \\"
      },
      {
        "sha": "e4f44435ba292312e9d755d1a468bf09c6bf835b",
        "filename": "src/bitcoin-tx.cpp",
        "status": "modified",
        "additions": 8,
        "deletions": 0,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/28d4542a0ac77a30a242d0568e580a5b437f53fa/src/bitcoin-tx.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/28d4542a0ac77a30a242d0568e580a5b437f53fa/src/bitcoin-tx.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bitcoin-tx.cpp?ref=28d4542a0ac77a30a242d0568e580a5b437f53fa",
        "patch": "@@ -310,6 +310,9 @@ static void MutateTxAddOutPubKey(CMutableTransaction& tx, const std::string& str\n     }\n \n     if (bSegWit) {\n+        if (!pubkey.IsCompressed()) {\n+            throw std::runtime_error(\"Uncompressed pubkeys are not useable for SegWit outputs\");\n+        }\n         // Call GetScriptForWitness() to build a P2WSH scriptPubKey\n         scriptPubKey = GetScriptForWitness(scriptPubKey);\n     }\n@@ -375,6 +378,11 @@ static void MutateTxAddOutMultiSig(CMutableTransaction& tx, const std::string& s\n     CScript scriptPubKey = GetScriptForMultisig(required, pubkeys);\n \n     if (bSegWit) {\n+        for (CPubKey& pubkey : pubkeys) {\n+            if (!pubkey.IsCompressed()) {\n+                throw std::runtime_error(\"Uncompressed pubkeys are not useable for SegWit outputs\");\n+            }\n+        }\n         // Call GetScriptForWitness() to build a P2WSH scriptPubKey\n         scriptPubKey = GetScriptForWitness(scriptPubKey);\n     }"
      },
      {
        "sha": "89b28bba6ced9ccd0633221405bc27cfaeac23dd",
        "filename": "test/util/data/bitcoin-util-test.json",
        "status": "modified",
        "additions": 18,
        "deletions": 0,
        "changes": 18,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/28d4542a0ac77a30a242d0568e580a5b437f53fa/test/util/data/bitcoin-util-test.json",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/28d4542a0ac77a30a242d0568e580a5b437f53fa/test/util/data/bitcoin-util-test.json",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/util/data/bitcoin-util-test.json?ref=28d4542a0ac77a30a242d0568e580a5b437f53fa",
        "patch": "@@ -261,6 +261,13 @@\n     \"output_cmp\": \"txcreateoutpubkey3.json\",\n     \"description\": \"Creates a new transaction with a single pay-to-pub-key output, wrapped in P2SH (output as json)\"\n   },\n+  { \"exec\": \"./bitcoin-tx\",\n+    \"args\":\n+    [\"-json\", \"-create\", \"outpubkey=0:047d1368ba7ae01c94bc32293efd70bd7e3be7aa7912d07d0b1c659c1008d179b8642f5fb90f47580feb29f045e216ff5a4716d3a0fed36da414d332046303c44a:WS\", \"nversion=1\"],\n+    \"return_code\": 1,\n+    \"error_txt\": \"error: Uncompressed pubkeys are not useable for SegWit outputs\",\n+    \"description\": \"Creates a new transaction with a single pay-to-pub-key output, wrapped in P2SH (output as json)\"\n+  },\n   { \"exec\": \"./bitcoin-tx\",\n     \"args\":\n     [\"-create\",\n@@ -388,5 +395,16 @@\n     \"args\": [\"-json\", \"-create\", \"outmultisig=1:2:3:02a5613bd857b7048924264d1e70e08fb2a7e6527d32b7ab1bb993ac59964ff397:021ac43c7ff740014c3b33737ede99c967e4764553d1b2b83db77c83b8715fa72d:02df2089105c77f266fa11a9d33f05c735234075f2e8780824c6b709415f9fb485:WS\", \"nversion=1\"],\n     \"output_cmp\": \"txcreatemultisig4.json\",\n     \"description\": \"Creates a new transaction with a single 2-of-3 multisig in a P2WSH output, wrapped in P2SH (output in json)\"\n+  },\n+  { \"exec\": \"./bitcoin-tx\",\n+    \"args\": [\"-json\", \"-create\", \"outmultisig=1:2:3:02a5613bd857b7048924264d1e70e08fb2a7e6527d32b7ab1bb993ac59964ff397:021ac43c7ff740014c3b33737ede99c967e4764553d1b2b83db77c83b8715fa72d:047d1368ba7ae01c94bc32293efd70bd7e3be7aa7912d07d0b1c659c1008d179b8642f5fb90f47580feb29f045e216ff5a4716d3a0fed36da414d332046303c44a:S\"],\n+    \"output_cmp\": \"txcreatemultisig5.json\",\n+    \"description\": \"Uncompressed pubkeys should work just fine for non-witness outputs\"\n+  },\n+  { \"exec\": \"./bitcoin-tx\",\n+    \"args\": [\"-json\", \"-create\", \"outmultisig=1:2:3:02a5613bd857b7048924264d1e70e08fb2a7e6527d32b7ab1bb993ac59964ff397:021ac43c7ff740014c3b33737ede99c967e4764553d1b2b83db77c83b8715fa72d:047d1368ba7ae01c94bc32293efd70bd7e3be7aa7912d07d0b1c659c1008d179b8642f5fb90f47580feb29f045e216ff5a4716d3a0fed36da414d332046303c44a:WS\"],\n+    \"return_code\": 1,\n+    \"error_txt\": \"error: Uncompressed pubkeys are not useable for SegWit outputs\",\n+    \"description\": \"Ensure adding witness outputs with uncompressed pubkeys fails\"\n   }\n ]"
      },
      {
        "sha": "20e9bb077bbf5bc85bc4a60876e7061dbd7e6960",
        "filename": "test/util/data/txcreatemultisig5.json",
        "status": "added",
        "additions": 26,
        "deletions": 0,
        "changes": 26,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/28d4542a0ac77a30a242d0568e580a5b437f53fa/test/util/data/txcreatemultisig5.json",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/28d4542a0ac77a30a242d0568e580a5b437f53fa/test/util/data/txcreatemultisig5.json",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/util/data/txcreatemultisig5.json?ref=28d4542a0ac77a30a242d0568e580a5b437f53fa",
        "patch": "@@ -0,0 +1,26 @@\n+{\n+    \"txid\": \"813cf75e1f08debd242ef7c8192b7d478fb651355209369499a0de779ba7eb2f\",\n+    \"hash\": \"813cf75e1f08debd242ef7c8192b7d478fb651355209369499a0de779ba7eb2f\",\n+    \"version\": 2,\n+    \"size\": 42,\n+    \"vsize\": 42,\n+    \"locktime\": 0,\n+    \"vin\": [\n+    ],\n+    \"vout\": [\n+        {\n+            \"value\": 1.00000000,\n+            \"n\": 0,\n+            \"scriptPubKey\": {\n+                \"asm\": \"OP_HASH160 a4051c02398868af83f28f083208fae99a769263 OP_EQUAL\",\n+                \"hex\": \"a914a4051c02398868af83f28f083208fae99a76926387\",\n+                \"reqSigs\": 1,\n+                \"type\": \"scripthash\",\n+                \"addresses\": [\n+                    \"3GeGs1eHUxPz5YyuFe9WPpXid2UsUb5Jos\"\n+                ]\n+            }\n+        }\n+    ],\n+    \"hex\": \"02000000000100e1f5050000000017a914a4051c02398868af83f28f083208fae99a7692638700000000\"\n+}"
      }
    ]
  }
]