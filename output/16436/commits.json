[
  {
    "sha": "4057b7acb7125739537078d026ad96bb21708e3c",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0MDU3YjdhY2I3MTI1NzM5NTM3MDc4ZDAyNmFkOTZiYjIxNzA4ZTNj",
    "commit": {
      "author": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2019-07-23T12:38:10Z"
      },
      "committer": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2019-07-23T12:38:10Z"
      },
      "message": "wallet: Recognize -disablewallet option early",
      "tree": {
        "sha": "54ca2fb7523172a833720ee63af929a9b2a3ea77",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/54ca2fb7523172a833720ee63af929a9b2a3ea77"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4057b7acb7125739537078d026ad96bb21708e3c",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE0dvyxLlvLev0wWZUQQEIES5+qB8FAl02/7IACgkQQQEIES5+\nqB9nFg//ZrhZg1Q69yD21QprpJArO2dllSwqlbBv9npzTEtfwE/jVZ9YK6Rkbms0\nz/Xnm6o3BvrxaHK610XGCA0EnHbOAn86uqHo50J2yu1RErrznW3HW3LrzbGKPasb\n2YPjCNAazEYwO2cu5qViEqc/2rFe+57WYYLoj579ojGAO3+dA1D1orjhTgf2yiJ/\nqQD1RUbG88su9N/vDBc1s0EnHfPL2++fFae4ubHwQX8NoWum3HTqScG5JZpEJqok\nfNxhQUP0UakUpK1I4U/3dfO/GmhAZdkq6So9YZY8/El2+8RILdkw6ftU9Qj/z0EL\nUG5Bhhgkv7Yqpqz9izi2oK6hj/nsMAzvVleBijF6uVaRgp0ZKddEFjVmM7f3rJO1\nFqIgbyOsMOGIKpK+2EI12xCfka70xZBGMsugAYKs96SVCDxsGSyh14AO5k8Yod1W\nyGpNrrn4BQOhU8slfmqCVP2DmomHUc0qyXbBD/Hj1CG4r89Dq1Txguk6Ww/LTAQf\ntQiiCXIkvXqDIj4PHJNYfWtTx5nMtGgu3P0mjvmOjOOu63k7ccTpnCX4vKYHTx8o\nWpkzm7B+mNZ83TTjHdoNRy0gaCnB7vXvUghZ7T1Oxz6DoZ/fz4i/ZoGod4rFPkVK\nzhOA2Z6th8FhIVXxoVN1a3VOLo8379/9hytA13Ka1/j/PPna3bU=\n=X9bR\n-----END PGP SIGNATURE-----",
        "payload": "tree 54ca2fb7523172a833720ee63af929a9b2a3ea77\nparent 51a6e2c4192913c9c18507d8dfb3302500b26cc3\nauthor Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1563885490 +0300\ncommitter Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1563885490 +0300\n\nwallet: Recognize -disablewallet option early\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4057b7acb7125739537078d026ad96bb21708e3c",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/4057b7acb7125739537078d026ad96bb21708e3c",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4057b7acb7125739537078d026ad96bb21708e3c/comments",
    "author": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "51a6e2c4192913c9c18507d8dfb3302500b26cc3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/51a6e2c4192913c9c18507d8dfb3302500b26cc3",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/51a6e2c4192913c9c18507d8dfb3302500b26cc3"
      }
    ],
    "stats": {
      "total": 40,
      "additions": 17,
      "deletions": 23
    },
    "files": [
      {
        "sha": "6e2cbddb0aa1cc12289a0c8fe6ccf8cd86ceaec7",
        "filename": "src/qt/bitcoin.cpp",
        "status": "modified",
        "additions": 17,
        "deletions": 23,
        "changes": 40,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4057b7acb7125739537078d026ad96bb21708e3c/src/qt/bitcoin.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4057b7acb7125739537078d026ad96bb21708e3c/src/qt/bitcoin.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/bitcoin.cpp?ref=4057b7acb7125739537078d026ad96bb21708e3c",
        "patch": "@@ -25,7 +25,8 @@\n #ifdef ENABLE_WALLET\n #include <qt/paymentserver.h>\n #include <qt/walletcontroller.h>\n-#endif\n+#include <qt/walletmodel.h>\n+#endif // ENABLE_WALLET\n \n #include <interfaces/handler.h>\n #include <interfaces/node.h>\n@@ -210,12 +211,6 @@ BitcoinApplication::~BitcoinApplication()\n \n     delete window;\n     window = nullptr;\n-#ifdef ENABLE_WALLET\n-    delete paymentServer;\n-    paymentServer = nullptr;\n-    delete m_wallet_controller;\n-    m_wallet_controller = nullptr;\n-#endif\n     delete optionsModel;\n     optionsModel = nullptr;\n     delete platformStyle;\n@@ -331,24 +326,21 @@ void BitcoinApplication::initializeResult(bool success)\n     {\n         // Log this only after AppInitMain finishes, as then logging setup is guaranteed complete\n         qInfo() << \"Platform customization:\" << platformStyle->getName();\n-#ifdef ENABLE_WALLET\n-        m_wallet_controller = new WalletController(m_node, platformStyle, optionsModel, this);\n-#ifdef ENABLE_BIP70\n-        PaymentServer::LoadRootCAs();\n-#endif\n-        if (paymentServer) {\n-            paymentServer->setOptionsModel(optionsModel);\n-#ifdef ENABLE_BIP70\n-            connect(m_wallet_controller, &WalletController::coinsSent, paymentServer, &PaymentServer::fetchPaymentACK);\n-#endif\n-        }\n-#endif\n-\n         clientModel = new ClientModel(m_node, optionsModel);\n         window->setClientModel(clientModel);\n #ifdef ENABLE_WALLET\n-        window->setWalletController(m_wallet_controller);\n+        if (WalletModel::isWalletEnabled()) {\n+            m_wallet_controller = new WalletController(m_node, platformStyle, optionsModel, this);\n+            window->setWalletController(m_wallet_controller);\n+            if (paymentServer) {\n+                paymentServer->setOptionsModel(optionsModel);\n+#ifdef ENABLE_BIP70\n+                PaymentServer::LoadRootCAs();\n+                connect(m_wallet_controller, &WalletController::coinsSent, paymentServer, &PaymentServer::fetchPaymentACK);\n #endif\n+            }\n+        }\n+#endif // ENABLE_WALLET\n \n         // If -min option passed, start window minimized (iconified) or minimized to tray\n         if (!gArgs.GetBoolArg(\"-min\", false)) {\n@@ -546,8 +538,10 @@ int GuiMain(int argc, char* argv[])\n \n     // Start up the payment server early, too, so impatient users that click on\n     // bitcoin: links repeatedly have their payment requests routed to this process:\n-    app.createPaymentServer();\n-#endif\n+    if (WalletModel::isWalletEnabled()) {\n+        app.createPaymentServer();\n+    }\n+#endif // ENABLE_WALLET\n \n     /// 9. Main GUI initialization\n     // Install global event filter that makes sure that long tooltips can be word-wrapped"
      }
    ]
  }
]