[
  {
    "sha": "70ab73a0087cbb0d6b26c9ad58146ae542b1b9be",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo3MGFiNzNhMDA4N2NiYjBkNmIyNmM5YWQ1ODE0NmFlNTQyYjFiOWJl",
    "commit": {
      "author": {
        "name": "Jeff Garzik",
        "email": "jgarzik@exmulti.com",
        "date": "2012-06-29T03:18:38Z"
      },
      "committer": {
        "name": "Jeff Garzik",
        "email": "jgarzik@redhat.com",
        "date": "2012-06-29T03:18:38Z"
      },
      "message": "Create new rpcnet module, and move 'getconnectioncount' RPC to it",
      "tree": {
        "sha": "4b65de10c0606f765d4c1b99bfcb3a2825f7dc0c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4b65de10c0606f765d4c1b99bfcb3a2825f7dc0c"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/70ab73a0087cbb0d6b26c9ad58146ae542b1b9be",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/70ab73a0087cbb0d6b26c9ad58146ae542b1b9be",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/70ab73a0087cbb0d6b26c9ad58146ae542b1b9be",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/70ab73a0087cbb0d6b26c9ad58146ae542b1b9be/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "5fa83965f22ae92f86de74104b621c2168d37698",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5fa83965f22ae92f86de74104b621c2168d37698",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/5fa83965f22ae92f86de74104b621c2168d37698"
      }
    ],
    "stats": {
      "total": 38,
      "additions": 27,
      "deletions": 11
    },
    "files": [
      {
        "sha": "6bfeeff072811ff72d417ca207ede9d514d0c332",
        "filename": "bitcoin-qt.pro",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/70ab73a0087cbb0d6b26c9ad58146ae542b1b9be/bitcoin-qt.pro",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/70ab73a0087cbb0d6b26c9ad58146ae542b1b9be/bitcoin-qt.pro",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/bitcoin-qt.pro?ref=70ab73a0087cbb0d6b26c9ad58146ae542b1b9be",
        "patch": "@@ -206,6 +206,7 @@ SOURCES += src/qt/bitcoin.cpp src/qt/bitcoingui.cpp \\\n     src/qt/walletmodel.cpp \\\n     src/bitcoinrpc.cpp \\\n     src/rpcdump.cpp \\\n+    src/rpcnet.cpp \\\n     src/qt/overviewpage.cpp \\\n     src/qt/csvmodelwriter.cpp \\\n     src/crypter.cpp \\"
      },
      {
        "sha": "3c61121dab03c11dff16774c36243d06f3c64eec",
        "filename": "src/bitcoinrpc.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 11,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/70ab73a0087cbb0d6b26c9ad58146ae542b1b9be/src/bitcoinrpc.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/70ab73a0087cbb0d6b26c9ad58146ae542b1b9be/src/bitcoinrpc.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bitcoinrpc.cpp?ref=70ab73a0087cbb0d6b26c9ad58146ae542b1b9be",
        "patch": "@@ -46,6 +46,7 @@ static std::string strRPCUserColonPass;\n static int64 nWalletUnlockTime;\n static CCriticalSection cs_nWalletUnlockTime;\n \n+extern Value getconnectioncount(const Array& params, bool fHelp);\n extern Value dumpprivkey(const Array& params, bool fHelp);\n extern Value importprivkey(const Array& params, bool fHelp);\n \n@@ -456,17 +457,6 @@ Value getblockcount(const Array& params, bool fHelp)\n }\n \n \n-Value getconnectioncount(const Array& params, bool fHelp)\n-{\n-    if (fHelp || params.size() != 0)\n-        throw runtime_error(\n-            \"getconnectioncount\\n\"\n-            \"Returns the number of connections to other nodes.\");\n-\n-    return (int)vNodes.size();\n-}\n-\n-\n Value getdifficulty(const Array& params, bool fHelp)\n {\n     if (fHelp || params.size() != 0)"
      },
      {
        "sha": "5afb5c78a19161395475efe64429546b16192ea9",
        "filename": "src/makefile.linux-mingw",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/70ab73a0087cbb0d6b26c9ad58146ae542b1b9be/src/makefile.linux-mingw",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/70ab73a0087cbb0d6b26c9ad58146ae542b1b9be/src/makefile.linux-mingw",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/makefile.linux-mingw?ref=70ab73a0087cbb0d6b26c9ad58146ae542b1b9be",
        "patch": "@@ -60,6 +60,7 @@ OBJS= \\\n     obj/protocol.o \\\n     obj/bitcoinrpc.o \\\n     obj/rpcdump.o \\\n+    obj/rpcnet.o \\\n     obj/script.o \\\n     obj/sync.o \\\n     obj/util.o \\"
      },
      {
        "sha": "907a15a3f135206b1497b83bed7e9c54e5a2680a",
        "filename": "src/makefile.mingw",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/70ab73a0087cbb0d6b26c9ad58146ae542b1b9be/src/makefile.mingw",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/70ab73a0087cbb0d6b26c9ad58146ae542b1b9be/src/makefile.mingw",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/makefile.mingw?ref=70ab73a0087cbb0d6b26c9ad58146ae542b1b9be",
        "patch": "@@ -57,6 +57,7 @@ OBJS= \\\n     obj/protocol.o \\\n     obj/bitcoinrpc.o \\\n     obj/rpcdump.o \\\n+    obj/rpcnet.o \\\n     obj/script.o \\\n     obj/sync.o \\\n     obj/util.o \\"
      },
      {
        "sha": "cbb269cef15d29d2080e5c6adc14488a7eb04dba",
        "filename": "src/makefile.osx",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/70ab73a0087cbb0d6b26c9ad58146ae542b1b9be/src/makefile.osx",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/70ab73a0087cbb0d6b26c9ad58146ae542b1b9be/src/makefile.osx",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/makefile.osx?ref=70ab73a0087cbb0d6b26c9ad58146ae542b1b9be",
        "patch": "@@ -84,6 +84,7 @@ OBJS= \\\n     obj/protocol.o \\\n     obj/bitcoinrpc.o \\\n     obj/rpcdump.o \\\n+    obj/rpcnet.o \\\n     obj/script.o \\\n     obj/sync.o \\\n     obj/util.o \\"
      },
      {
        "sha": "420c7ac3fa599f2407fbea9fe0c1ae3fd96b1590",
        "filename": "src/makefile.unix",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/70ab73a0087cbb0d6b26c9ad58146ae542b1b9be/src/makefile.unix",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/70ab73a0087cbb0d6b26c9ad58146ae542b1b9be/src/makefile.unix",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/makefile.unix?ref=70ab73a0087cbb0d6b26c9ad58146ae542b1b9be",
        "patch": "@@ -104,6 +104,7 @@ OBJS= \\\n     obj/protocol.o \\\n     obj/bitcoinrpc.o \\\n     obj/rpcdump.o \\\n+    obj/rpcnet.o \\\n     obj/script.o \\\n     obj/sync.o \\\n     obj/util.o \\"
      },
      {
        "sha": "1c27d0ef8cd0bbb711d83e20e088fc7bbb097ac7",
        "filename": "src/rpcnet.cpp",
        "status": "added",
        "additions": 21,
        "deletions": 0,
        "changes": 21,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/70ab73a0087cbb0d6b26c9ad58146ae542b1b9be/src/rpcnet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/70ab73a0087cbb0d6b26c9ad58146ae542b1b9be/src/rpcnet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpcnet.cpp?ref=70ab73a0087cbb0d6b26c9ad58146ae542b1b9be",
        "patch": "@@ -0,0 +1,21 @@\n+// Copyright (c) 2009-2012 Bitcoin Developers\n+// Distributed under the MIT/X11 software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include \"net.h\"\n+#include \"bitcoinrpc.h\"\n+\n+using namespace json_spirit;\n+using namespace std;\n+\n+Value getconnectioncount(const Array& params, bool fHelp)\n+{\n+    if (fHelp || params.size() != 0)\n+        throw runtime_error(\n+            \"getconnectioncount\\n\"\n+            \"Returns the number of connections to other nodes.\");\n+\n+    return (int)vNodes.size();\n+}\n+\n+"
      }
    ]
  },
  {
    "sha": "1006f0707e34f8903f247195dabd86243ae61f05",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxMDA2ZjA3MDdlMzRmODkwM2YyNDcxOTVkYWJkODYyNDNhZTYxZjA1",
    "commit": {
      "author": {
        "name": "Jeff Garzik",
        "email": "jgarzik@exmulti.com",
        "date": "2012-06-29T21:24:53Z"
      },
      "committer": {
        "name": "Jeff Garzik",
        "email": "jgarzik@redhat.com",
        "date": "2012-06-29T21:24:53Z"
      },
      "message": "RPC: add 'getpeerinfo', returning easy-to-retrieve per-CNode data",
      "tree": {
        "sha": "cc1539a2e0d8fe72e3545c617d0bc1a9e34c0330",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/cc1539a2e0d8fe72e3545c617d0bc1a9e34c0330"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1006f0707e34f8903f247195dabd86243ae61f05",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1006f0707e34f8903f247195dabd86243ae61f05",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/1006f0707e34f8903f247195dabd86243ae61f05",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1006f0707e34f8903f247195dabd86243ae61f05/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "70ab73a0087cbb0d6b26c9ad58146ae542b1b9be",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/70ab73a0087cbb0d6b26c9ad58146ae542b1b9be",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/70ab73a0087cbb0d6b26c9ad58146ae542b1b9be"
      }
    ],
    "stats": {
      "total": 85,
      "additions": 84,
      "deletions": 1
    },
    "files": [
      {
        "sha": "51690243bc57eb3a0211c91d508542391eddaaf6",
        "filename": "src/bitcoinrpc.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1006f0707e34f8903f247195dabd86243ae61f05/src/bitcoinrpc.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1006f0707e34f8903f247195dabd86243ae61f05/src/bitcoinrpc.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bitcoinrpc.cpp?ref=1006f0707e34f8903f247195dabd86243ae61f05",
        "patch": "@@ -47,6 +47,7 @@ static int64 nWalletUnlockTime;\n static CCriticalSection cs_nWalletUnlockTime;\n \n extern Value getconnectioncount(const Array& params, bool fHelp);\n+extern Value getpeerinfo(const Array& params, bool fHelp);\n extern Value dumpprivkey(const Array& params, bool fHelp);\n extern Value importprivkey(const Array& params, bool fHelp);\n \n@@ -2300,6 +2301,7 @@ static const CRPCCommand vRPCCommands[] =\n     { \"stop\",                   &stop,                   true },\n     { \"getblockcount\",          &getblockcount,          true },\n     { \"getconnectioncount\",     &getconnectioncount,     true },\n+    { \"getpeerinfo\",            &getpeerinfo,            true },\n     { \"getdifficulty\",          &getdifficulty,          true },\n     { \"getgenerate\",            &getgenerate,            true },\n     { \"setgenerate\",            &setgenerate,            true },"
      },
      {
        "sha": "2a09d20deac223893f75bdb686e889301a2930ee",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 17,
        "deletions": 1,
        "changes": 18,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1006f0707e34f8903f247195dabd86243ae61f05/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1006f0707e34f8903f247195dabd86243ae61f05/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=1006f0707e34f8903f247195dabd86243ae61f05",
        "patch": "@@ -606,7 +606,23 @@ bool CNode::Misbehaving(int howmuch)\n     return false;\n }\n \n-\n+#undef X\n+#define X(name) stats.name = name\n+void CNode::copyStats(CNodeStats &stats)\n+{\n+    X(nServices);\n+    X(nLastSend);\n+    X(nLastRecv);\n+    X(nTimeConnected);\n+    X(addrName);\n+    X(nVersion);\n+    X(strSubVer);\n+    X(fInbound);\n+    X(nReleaseTime);\n+    X(nStartingHeight);\n+    X(nMisbehavior);\n+}\n+#undef X\n \n \n "
      },
      {
        "sha": "21ecaef848d62f2d6a92b5bd263a15ddcaea29a0",
        "filename": "src/net.h",
        "status": "modified",
        "additions": 19,
        "deletions": 0,
        "changes": 19,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1006f0707e34f8903f247195dabd86243ae61f05/src/net.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1006f0707e34f8903f247195dabd86243ae61f05/src/net.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.h?ref=1006f0707e34f8903f247195dabd86243ae61f05",
        "patch": "@@ -128,6 +128,24 @@ extern std::map<CInv, int64> mapAlreadyAskedFor;\n \n \n \n+class CNodeStats\n+{\n+public:\n+    uint64 nServices;\n+    int64 nLastSend;\n+    int64 nLastRecv;\n+    int64 nTimeConnected;\n+    std::string addrName;\n+    int nVersion;\n+    std::string strSubVer;\n+    bool fInbound;\n+    int64 nReleaseTime;\n+    int nStartingHeight;\n+    int nMisbehavior;\n+};\n+\n+\n+\n \n \n /** Information about a peer */\n@@ -617,6 +635,7 @@ class CNode\n     static void ClearBanned(); // needed for unit testing\n     static bool IsBanned(CNetAddr ip);\n     bool Misbehaving(int howmuch); // 1 == a little, 100 == a lot\n+    void copyStats(CNodeStats &stats);\n };\n \n "
      },
      {
        "sha": "c5746651c12f11d2bd665e7aabe008649b4ee213",
        "filename": "src/rpcnet.cpp",
        "status": "modified",
        "additions": 46,
        "deletions": 0,
        "changes": 46,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1006f0707e34f8903f247195dabd86243ae61f05/src/rpcnet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1006f0707e34f8903f247195dabd86243ae61f05/src/rpcnet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpcnet.cpp?ref=1006f0707e34f8903f247195dabd86243ae61f05",
        "patch": "@@ -15,7 +15,53 @@ Value getconnectioncount(const Array& params, bool fHelp)\n             \"getconnectioncount\\n\"\n             \"Returns the number of connections to other nodes.\");\n \n+    LOCK(cs_vNodes);\n     return (int)vNodes.size();\n }\n \n+static void CopyNodeStats(std::vector<CNodeStats>& vstats)\n+{\n+    vstats.clear();\n+\n+    LOCK(cs_vNodes);\n+    vstats.reserve(vNodes.size());\n+    BOOST_FOREACH(CNode* pnode, vNodes) {\n+        CNodeStats stats;\n+        pnode->copyStats(stats);\n+        vstats.push_back(stats);\n+    }\n+}\n+\n+Value getpeerinfo(const Array& params, bool fHelp)\n+{\n+    if (fHelp || params.size() != 0)\n+        throw runtime_error(\n+            \"getpeerinfo\\n\"\n+            \"Returns data about each connected network node.\");\n+\n+    vector<CNodeStats> vstats;\n+    CopyNodeStats(vstats);\n+\n+    Array ret;\n+\n+    BOOST_FOREACH(const CNodeStats& stats, vstats) {\n+        Object obj;\n+\n+        obj.push_back(Pair(\"addr\", stats.addrName));\n+        obj.push_back(Pair(\"services\", strprintf(\"%08\"PRI64x, stats.nServices)));\n+        obj.push_back(Pair(\"lastsend\", (boost::int64_t)stats.nLastSend));\n+        obj.push_back(Pair(\"lastrecv\", (boost::int64_t)stats.nLastRecv));\n+        obj.push_back(Pair(\"conntime\", (boost::int64_t)stats.nTimeConnected));\n+        obj.push_back(Pair(\"version\", stats.nVersion));\n+        obj.push_back(Pair(\"subver\", stats.strSubVer));\n+        obj.push_back(Pair(\"inbound\", stats.fInbound));\n+        obj.push_back(Pair(\"releasetime\", (boost::int64_t)stats.nReleaseTime));\n+        obj.push_back(Pair(\"height\", stats.nStartingHeight));\n+        obj.push_back(Pair(\"banscore\", stats.nMisbehavior));\n+\n+        ret.push_back(obj);\n+    }\n+    \n+    return ret;\n+}\n "
      }
    ]
  }
]