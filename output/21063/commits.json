[
  {
    "sha": "2e5f7def22e1b212fbd69e9147145d9d1f408aaf",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyZTVmN2RlZjIyZTFiMjEyZmJkNjllOTE0NzE0NWQ5ZDFmNDA4YWFm",
    "commit": {
      "author": {
        "name": "Ivan Metlushko",
        "email": "metlushko@gmail.com",
        "date": "2021-02-02T08:28:27Z"
      },
      "committer": {
        "name": "Ivan Metlushko",
        "email": "metlushko@gmail.com",
        "date": "2021-03-09T08:04:35Z"
      },
      "message": "wallet, rpc: update listdescriptors response format",
      "tree": {
        "sha": "689614f9dd072e7b68a2739189db1c52bafef1af",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/689614f9dd072e7b68a2739189db1c52bafef1af"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2e5f7def22e1b212fbd69e9147145d9d1f408aaf",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2e5f7def22e1b212fbd69e9147145d9d1f408aaf",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/2e5f7def22e1b212fbd69e9147145d9d1f408aaf",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2e5f7def22e1b212fbd69e9147145d9d1f408aaf/comments",
    "author": {
      "login": "S3RK",
      "id": 1466284,
      "node_id": "MDQ6VXNlcjE0NjYyODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/S3RK",
      "html_url": "https://github.com/S3RK",
      "followers_url": "https://api.github.com/users/S3RK/followers",
      "following_url": "https://api.github.com/users/S3RK/following{/other_user}",
      "gists_url": "https://api.github.com/users/S3RK/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
      "organizations_url": "https://api.github.com/users/S3RK/orgs",
      "repos_url": "https://api.github.com/users/S3RK/repos",
      "events_url": "https://api.github.com/users/S3RK/events{/privacy}",
      "received_events_url": "https://api.github.com/users/S3RK/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "S3RK",
      "id": 1466284,
      "node_id": "MDQ6VXNlcjE0NjYyODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/S3RK",
      "html_url": "https://github.com/S3RK",
      "followers_url": "https://api.github.com/users/S3RK/followers",
      "following_url": "https://api.github.com/users/S3RK/following{/other_user}",
      "gists_url": "https://api.github.com/users/S3RK/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
      "organizations_url": "https://api.github.com/users/S3RK/orgs",
      "repos_url": "https://api.github.com/users/S3RK/repos",
      "events_url": "https://api.github.com/users/S3RK/events{/privacy}",
      "received_events_url": "https://api.github.com/users/S3RK/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "461f0c781e5a9c13df21ca0c35029f685758d0bb",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/461f0c781e5a9c13df21ca0c35029f685758d0bb",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/461f0c781e5a9c13df21ca0c35029f685758d0bb"
      }
    ],
    "stats": {
      "total": 58,
      "additions": 37,
      "deletions": 21
    },
    "files": [
      {
        "sha": "748d911efe0dc5ed380cade7793d0b0b2f0cf9c4",
        "filename": "src/wallet/rpcdump.cpp",
        "status": "modified",
        "additions": 12,
        "deletions": 7,
        "changes": 19,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2e5f7def22e1b212fbd69e9147145d9d1f408aaf/src/wallet/rpcdump.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2e5f7def22e1b212fbd69e9147145d9d1f408aaf/src/wallet/rpcdump.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcdump.cpp?ref=2e5f7def22e1b212fbd69e9147145d9d1f408aaf",
        "patch": "@@ -1747,22 +1747,23 @@ RPCHelpMan listdescriptors()\n         \"listdescriptors\",\n         \"\\nList descriptors imported into a descriptor-enabled wallet.\",\n         {},\n-        RPCResult{\n-            RPCResult::Type::ARR, \"\", \"Response is an array of descriptor objects\",\n+        RPCResult{RPCResult::Type::OBJ, \"\", \"\", {\n+            {RPCResult::Type::STR, \"wallet_name\", \"Name of wallet this operation was performed on\"},\n+            {RPCResult::Type::ARR, \"descriptors\", \"Array of descriptor objects\",\n             {\n                 {RPCResult::Type::OBJ, \"\", \"\", {\n                     {RPCResult::Type::STR, \"desc\", \"Descriptor string representation\"},\n                     {RPCResult::Type::NUM, \"timestamp\", \"The creation time of the descriptor\"},\n                     {RPCResult::Type::BOOL, \"active\", \"Activeness flag\"},\n-                    {RPCResult::Type::BOOL, \"internal\", true, \"Whether this is internal or external descriptor; defined only for active descriptors\"},\n+                    {RPCResult::Type::BOOL, \"internal\", true, \"Whether this is an internal or external descriptor; defined only for active descriptors\"},\n                     {RPCResult::Type::ARR_FIXED, \"range\", true, \"Defined only for ranged descriptors\", {\n                         {RPCResult::Type::NUM, \"\", \"Range start inclusive\"},\n                         {RPCResult::Type::NUM, \"\", \"Range end inclusive\"},\n                     }},\n                     {RPCResult::Type::NUM, \"next\", true, \"The next index to generate addresses from; defined only for ranged descriptors\"},\n                 }},\n-            }\n-        },\n+            }}\n+        }},\n         RPCExamples{\n             HelpExampleCli(\"listdescriptors\", \"\") + HelpExampleRpc(\"listdescriptors\", \"\")\n         },\n@@ -1779,7 +1780,7 @@ RPCHelpMan listdescriptors()\n \n     LOCK(wallet->cs_wallet);\n \n-    UniValue response(UniValue::VARR);\n+    UniValue descriptors(UniValue::VARR);\n     const auto active_spk_mans = wallet->GetActiveScriptPubKeyMans();\n     for (const auto& spk_man : wallet->GetAllScriptPubKeyMans()) {\n         const auto desc_spk_man = dynamic_cast<DescriptorScriptPubKeyMan*>(spk_man);\n@@ -1808,9 +1809,13 @@ RPCHelpMan listdescriptors()\n             spk.pushKV(\"range\", range);\n             spk.pushKV(\"next\", wallet_descriptor.next_index);\n         }\n-        response.push_back(spk);\n+        descriptors.push_back(spk);\n     }\n \n+    UniValue response(UniValue::VOBJ);\n+    response.pushKV(\"wallet_name\", wallet->GetName());\n+    response.pushKV(\"descriptors\", descriptors);\n+\n     return response;\n },\n     };"
      },
      {
        "sha": "c1444164ce7a249bb14e3e7be37a5df9b9c7d585",
        "filename": "test/functional/wallet_listdescriptors.py",
        "status": "modified",
        "additions": 25,
        "deletions": 14,
        "changes": 39,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2e5f7def22e1b212fbd69e9147145d9d1f408aaf/test/functional/wallet_listdescriptors.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2e5f7def22e1b212fbd69e9147145d9d1f408aaf/test/functional/wallet_listdescriptors.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/wallet_listdescriptors.py?ref=2e5f7def22e1b212fbd69e9147145d9d1f408aaf",
        "patch": "@@ -36,15 +36,16 @@ def run_test(self):\n \n         self.log.info('Test the command for empty descriptors wallet.')\n         node.createwallet(wallet_name='w2', blank=True, descriptors=True)\n-        assert_equal(0, len(node.get_wallet_rpc('w2').listdescriptors()))\n+        assert_equal(0, len(node.get_wallet_rpc('w2').listdescriptors()['descriptors']))\n \n         self.log.info('Test the command for a default descriptors wallet.')\n         node.createwallet(wallet_name='w3', descriptors=True)\n         result = node.get_wallet_rpc('w3').listdescriptors()\n-        assert_equal(6, len(result))\n-        assert_equal(6, len([d for d in result if d['active']]))\n-        assert_equal(3, len([d for d in result if d['internal']]))\n-        for item in result:\n+        assert_equal(\"w3\", result['wallet_name'])\n+        assert_equal(6, len(result['descriptors']))\n+        assert_equal(6, len([d for d in result['descriptors'] if d['active']]))\n+        assert_equal(3, len([d for d in result['descriptors'] if d['internal']]))\n+        for item in result['descriptors']:\n             assert item['desc'] != ''\n             assert item['next'] == 0\n             assert item['range'] == [0, 0]\n@@ -59,12 +60,17 @@ def run_test(self):\n             'desc': descsum_create('wpkh(' + xprv + hardened_path + '/0/*)'),\n             'timestamp': 1296688602,\n         }])\n-        expected = {'desc': descsum_create('wpkh([80002067' + hardened_path + ']' + xpub_acc + '/0/*)'),\n-                    'timestamp': 1296688602,\n-                    'active': False,\n-                    'range': [0, 0],\n-                    'next': 0}\n-        assert_equal([expected], wallet.listdescriptors())\n+        expected = {\n+            'wallet_name': 'w2',\n+            'descriptors': [\n+                {'desc': descsum_create('wpkh([80002067' + hardened_path + ']' + xpub_acc + '/0/*)'),\n+                 'timestamp': 1296688602,\n+                 'active': False,\n+                 'range': [0, 0],\n+                 'next': 0},\n+            ],\n+        }\n+        assert_equal(expected, wallet.listdescriptors())\n \n         self.log.info('Test non-active non-range combo descriptor')\n         node.createwallet(wallet_name='w4', blank=True, descriptors=True)\n@@ -73,9 +79,14 @@ def run_test(self):\n             'desc': descsum_create('combo(' + node.get_deterministic_priv_key().key + ')'),\n             'timestamp': 1296688602,\n         }])\n-        expected = [{'active': False,\n-                     'desc': 'combo(0227d85ba011276cf25b51df6a188b75e604b38770a462b2d0e9fb2fc839ef5d3f)#np574htj',\n-                     'timestamp': 1296688602}]\n+        expected = {\n+            'wallet_name': 'w4',\n+            'descriptors': [\n+                {'active': False,\n+                 'desc': 'combo(0227d85ba011276cf25b51df6a188b75e604b38770a462b2d0e9fb2fc839ef5d3f)#np574htj',\n+                 'timestamp': 1296688602},\n+            ]\n+        }\n         assert_equal(expected, wallet.listdescriptors())\n \n "
      }
    ]
  }
]