gavinandresen,2014-02-18T18:19:50Z,"Update: no problems with wallet backup/restore, no problems running with -DDEBUG_LOCKORDER (after fixes unrelated to this pull, see #3704 ).\n",https://github.com/bitcoin/bitcoin/pull/3694#issuecomment-35415468,35415468,
gavinandresen,2014-02-24T18:27:48Z,"Nits picked, rebased.\n",https://github.com/bitcoin/bitcoin/pull/3694#issuecomment-35918154,35918154,
gavinandresen,2014-02-25T00:09:44Z,.... I'll fix the pull-tester ... just have to figure out a robust way of HOW ... \n(issue is bitcoind's still running from previous failed test; ideally tests would be run in a fresh VM so they cannot interfere with each other).\n,https://github.com/bitcoin/bitcoin/pull/3694#issuecomment-35959592,35959592,
BitcoinPullTester,2014-02-26T17:32:19Z,"Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/93a18a3650292afbb441a47d1fa1b94aeb0164e3 for binaries and test log.\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.log is moving at http://jenkins.bluematt.me/pull-tester/cu",https://github.com/bitcoin/bitcoin/pull/3694#issuecomment-36152068,36152068,
djpnewton,2014-02-26T20:40:59Z,I have a reasonably biggish wallet (~7.5K transactions). What is a good performance test for this (what would exercise the right code paths)?\n\nThe listaccounts rpc is consistently 40ms faster on my wallet with this branch =)\n,https://github.com/bitcoin/bitcoin/pull/3694#issuecomment-36173735,36173735,
gavinandresen,2014-02-28T20:16:23Z,Merging; I think this is good enough for a release candidate release.\n,https://github.com/bitcoin/bitcoin/pull/3694#issuecomment-36390045,36390045,
laanwj,2014-02-21T13:10:49Z,"Using a recursive IsTrusted call here could run out of stack space if there are a lot of transactions depending on each other in the wallet.\nI don't think this is very likely, but when they happen stack overflows are nasty and hard to debug.\nIt was avoided with the workqueue-based approach.\n",https://github.com/bitcoin/bitcoin/pull/3694#discussion_r9944602,9944602,src/wallet.h
laanwj,2014-02-21T13:13:40Z,Could move this to a local variable inside serialize() instead of a property.\n,https://github.com/bitcoin/bitcoin/pull/3694#discussion_r9944666,9944666,src/wallet.h
gavinandresen,2014-02-21T13:25:16Z,"Long chains of unconfirmed transactions are a very bad idea; I'd vote for limiting the depth of the recursion to something reasonable.  I am very tempted to limit it to a depth of one, and eliminate the recursion all-together.\n",https://github.com/bitcoin/bitcoin/pull/3694#discussion_r9944931,9944931,src/wallet.h
laanwj,2014-02-21T14:38:48Z,"Nit: I can't help but notice that all calls to pwallet->IsSpent (apart from the one in the UI) construct a COutPoint object specifically to pass to the function. Maybe IsSpent(const uint256&, int n) would be more convenient.\n",https://github.com/bitcoin/bitcoin/pull/3694#discussion_r9947008,9947008,src/wallet.h
laanwj,2014-02-21T15:21:19Z,The -walletnotify and UI notification dispatch for the transaction update happens in AddToWallet. Ideally we'd want to do this invalidation before the notification is launched to prevent races.\nOne idea would be to move this logic here: https://github.com/bitcoin/bitcoin/blob/master/src/wallet.cpp#L566 where previously the WalletUpdateSpent happened? (execution will get there anyway through AddTo,https://github.com/bitcoin/bitcoin/pull/3694#discussion_r9948496,9948496,src/wallet.cpp
laanwj,2014-02-24T14:08:13Z,A valid case in which long chains of unconfirmed transaction could happen is in case of a reorganize.\n,https://github.com/bitcoin/bitcoin/pull/3694#discussion_r9991690,9991690,src/wallet.h
laanwj,2014-02-24T14:10:53Z,I just realized that vtxPrev could be useful for re-broadcasting (others) parent transactions in the case of a reorganization. Or is this covered some other way? Right now we store only our own transactions in the wallet.\n,https://github.com/bitcoin/bitcoin/pull/3694#discussion_r9991782,9991782,src/wallet.h
gavinandresen,2014-02-24T14:11:40Z,"Yes, but IsTrusted() is mostly irrelevant during a re-organize.  I suppose if there is a deep re-org underway and you try to spend some coins in the middle of it the spend might fail with ""insufficient funds"".  Very much an edge case not worth worrying about, though, I think.\n",https://github.com/bitcoin/bitcoin/pull/3694#discussion_r9991812,9991812,src/wallet.h
sipa,2014-02-24T14:16:41Z,"Agree. I do believe the C++ compiler avoids the extra copying involved, though.\n",https://github.com/bitcoin/bitcoin/pull/3694#discussion_r9991964,9991964,src/wallet.h
laanwj,2014-02-24T14:20:35Z,"Right, that's not much of a problem.\n",https://github.com/bitcoin/bitcoin/pull/3694#discussion_r9992099,9992099,src/wallet.h
sipa,2014-02-24T14:29:04Z,"Even now, vtxPrev only stores our own transactions, so it is utterly pointless to keep it.\n\nThe correct solution - if we want to deal better with unconfirmed out-of-wallet dependencies - is to add these to the wallet directly instead of inside the transactions they depend on. In practice, these lead to huge duplication of transactions in large wallets.\n\n@pstratem has some more context, I belie",https://github.com/bitcoin/bitcoin/pull/3694#discussion_r9992382,9992382,src/wallet.h
sipa,2014-02-24T14:30:33Z,"There is no need for this recursion at all. If a transaction is either in the blockchain or in the memory pool, all its dependencies are also in the blockchain or the memory pool.\n",https://github.com/bitcoin/bitcoin/pull/3694#discussion_r9992440,9992440,src/wallet.h
sipa,2014-02-24T14:41:02Z,I'm in favor of moving this variable to inside the serialization implementations. It will save memory.\n,https://github.com/bitcoin/bitcoin/pull/3694#discussion_r9992782,9992782,src/wallet.h
laanwj,2014-02-24T14:41:42Z,"OK, agreed, vtxprev is not the way to do this. Storing transactions in the wallet only on the top level (and not nested into other transactions) makes sense.\n",https://github.com/bitcoin/bitcoin/pull/3694#discussion_r9992805,9992805,src/wallet.h
gavinandresen,2014-02-24T15:14:06Z,"Recursion here is necessary if we want to continue allowing spending of unconfirmed change of unconfirmed change (of unconfirmed change, etc).  If there is no recursion, then you will be allowed to spend unconfirmed change once, but will then have to wait for that transaction to confirm (if you have no other inputs in your wallet) before being allowed to spend again.\n\nRE: other nits: ACK.\n",https://github.com/bitcoin/bitcoin/pull/3694#discussion_r9994253,9994253,src/wallet.h
sipa,2014-02-24T16:03:28Z,"Eh no - you have to check the inputs whether they belong to you. But unconfirmed change of unconfirmed change is in the mempool, and you don't need to check whether its dependencies do - it being in the mempool guarantees that already.\n",https://github.com/bitcoin/bitcoin/pull/3694#discussion_r9996511,9996511,src/wallet.h
gavinandresen,2014-02-24T18:16:38Z,@sipa: ACK.  Replacing the recursion with:\n\n```\n-            if (parent == NULL || !parent->IsTrusted())\n+            if (parent == NULL || !parent->IsFromMe() || parent->GetDepthInMainChain() < 0)\n                return false;\n```\n,https://github.com/bitcoin/bitcoin/pull/3694#discussion_r10002197,10002197,src/wallet.h
sipa,2014-02-24T20:05:20Z,"Even that < 0 test isn't necessary: if this transaction is in the mempool or blockchain, all its parents are too.\n\nWe only need to check that all inputs are from us.\n",https://github.com/bitcoin/bitcoin/pull/3694#discussion_r10007400,10007400,src/wallet.h
sipa,2014-02-24T20:08:31Z,Indentation.\n,https://github.com/bitcoin/bitcoin/pull/3694#discussion_r10007581,10007581,src/wallet.h
gavinandresen,2014-02-24T20:36:17Z,Fixed (emacs settings were wrong on my new computer....)\n,https://github.com/bitcoin/bitcoin/pull/3694#discussion_r10008943,10008943,src/wallet.h
gavinandresen,2014-02-24T20:53:55Z,Indeed. Maybe if reporters would stop calling me I'd stop making dumb mistakes...\n,https://github.com/bitcoin/bitcoin/pull/3694#discussion_r10009709,10009709,src/wallet.h
sipa,2014-02-25T20:21:42Z,"Can you pass this list<CTransaction> by reference into the method, and append to it everywhere, rather than copying it in every recursion step?\n",https://github.com/bitcoin/bitcoin/pull/3694#discussion_r10053931,10053931,src/txmempool.cpp
gavinandresen,2014-02-26T15:23:13Z,"ACK, I'll rewrite to pass the list by reference.\n",https://github.com/bitcoin/bitcoin/pull/3694#discussion_r10083308,10083308,src/txmempool.cpp
