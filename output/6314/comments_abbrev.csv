theuni,2015-06-20T19:13:03Z,"Great work! I had been planning to switch to submodules with this bump, so thanks for doing that as well. I see a few things that need some work, I'll comment on the individual files.\n",https://github.com/bitcoin/bitcoin/pull/6314#issuecomment-113805186,113805186,
theuni,2015-06-20T19:33:26Z,Looks like their buildsystem changes broke our OSX cross-build again. We'll need to poke at it to see what's changed.\n,https://github.com/bitcoin/bitcoin/pull/6314#issuecomment-113809439,113809439,
theuni,2015-06-20T23:43:35Z,"@welshjf See the top 3 commits at https://github.com/theuni/bitcoin/commits/qt54 .\n\nThey're not completely correct (some heavy-handed work-arounds), but it should be enough to have all platforms building again successfully.\n",https://github.com/bitcoin/bitcoin/pull/6314#issuecomment-113842336,113842336,
laanwj,2015-06-22T11:35:44Z,"> By switching to submodules, I've reduced the download size to 76M, and disk space needed to build from ~2G to ~600M\n\nNice!\n",https://github.com/bitcoin/bitcoin/pull/6314#issuecomment-114074422,114074422,
jonasschnelli,2015-06-24T13:33:26Z,"I almost forgot to post my gitian build: https://builds.jonasschnelli.ch/pulls/6314/\nTested the OSX version and the app can't run. Exits with:\n\n```\n$ /Volumes/Bitcoin-Core/Bitcoin-Qt.app/Contents/MacOS/Bitcoin-Qt \nThis application failed to start because it could not find or load the Qt platform plugin ""cocoa"".\n\nReinstalling the application may fix this problem.\nAbort trap: 6\n```\n",https://github.com/bitcoin/bitcoin/pull/6314#issuecomment-114869499,114869499,
welshjf,2015-06-24T16:24:59Z,"@jonasschnelli, sounds just like my problem on Linux, https://github.com/bitcoin/bitcoin/issues/6267#issuecomment-111655218.\n\nWe build Qt with `<prefix>/include` exported in CPATH, which causes it to assume that's the standard system include path, and no longer include it in its pkg-config. Thus when building bitcoin-qt, the system qconfig.h gets included, which among other potential problems ma",https://github.com/bitcoin/bitcoin/pull/6314#issuecomment-114931524,114931524,
welshjf,2015-06-24T16:39:33Z,"Er, I didn't summarize that quite right... see linked comments for more complicated but correct explanation ;)\n",https://github.com/bitcoin/bitcoin/pull/6314#issuecomment-114937117,114937117,
theuni,2015-06-24T17:06:58Z,"The CPATH trick is a hack, and as @welshjf mentioned, needs to be re-worked after 5.3.\n\nI'd like to take a fresh look with this bump, and see if we can work around the issues more cleanly. The patches I posted earlier were just enough to get it building, I'll spend some time this weekend looking at the remaining issues.\n",https://github.com/bitcoin/bitcoin/pull/6314#issuecomment-114943507,114943507,
welshjf,2015-06-24T17:17:41Z,"Moved CPATH setting to config.site as requested. Tested on Linux; should fix the platform plugin problem on Mac too.\n\nAs I mentioned, my first attempt was to remove the CPATH setting from qt.mk which seemed to be the root of the problem, but that broke something about the openssl linkage. I think that would be a good place to start investigating.\n",https://github.com/bitcoin/bitcoin/pull/6314#issuecomment-114945843,114945843,
theuni,2015-06-24T17:56:01Z,"CPATH is necessary for the qt build because we need to show qt how to find cross includes. Unfortunately, if you pass it -I/foo/bar in configure, it'll apply those flags to native builds (qmake and friends) as well.\n\nNeed to start by seeing if they've fixed up configure to be smarter with cross, allowing separate flags to be passed.\n\nBarring that, it'd be better to just fix up the .pc files. S",https://github.com/bitcoin/bitcoin/pull/6314#issuecomment-114957497,114957497,
theuni,2015-06-24T19:21:24Z,"@welshjf ok, the problem here was that we were dropping the current flags for the static test. qt's assumption that the pkg-config prefix is already included is a reasonable one.\n\nSee https://github.com/theuni/bitcoin/commit/294e35e8869ad07579e99f669477cbef732c22c8 for a fix that should let you drop the CPATH stuff outside of qt. It also fixes up configure for OSX on qt < 5.4. Still need to fix ",https://github.com/bitcoin/bitcoin/pull/6314#issuecomment-114985626,114985626,
welshjf,2015-06-24T21:52:50Z,"@theuni great, thanks, that's a much nicer fix. Simple if you know where to look!\n\nFor qt < 5.4 on OSX, wouldn't we still need the tablet crash and yosemite build patches? Although, those were applied from qt.mk, and if you're using that then you must be on 5.4. Still confused about when and how non-depends-based static builds are done :/\n",https://github.com/bitcoin/bitcoin/pull/6314#issuecomment-115022282,115022282,
theuni,2015-06-24T22:22:55Z,"@welshjf Bitcoin's buildsystem is completely independent of depends. No matter where the dependencies came from or how they were configured, if they're sane, we attempt to work with them.\n\nThe depends system is our way of self-building dependencies, since we need to build everything from source for trusted releases. Once they're built, we setup a config.site so that our configure can use them wi",https://github.com/bitcoin/bitcoin/pull/6314#issuecomment-115029095,115029095,
welshjf,2015-06-24T22:44:39Z,"Yes, when I say ""static build"" I mean a build using static libraries. On Windows/Mac there are no ""distro"" patches since Qt comes directly from upstream. Linux distros, to my knowledge, always package Qt as .so shared libraries. So as I see it, either you're on Win/Mac and cannot rely on outdated versions being sane, or you're on Linux doing a dynamic build, or you're building an official release ",https://github.com/bitcoin/bitcoin/pull/6314#issuecomment-115035022,115035022,
jonasschnelli,2015-06-25T11:43:54Z,Just built over gitian and tested on max OSX10.10. Works as expected.\nNice!\n\n![bildschirmfoto 2015-06-25 um 13 43 30](https://cloud.githubusercontent.com/assets/178464/8353609/303039f6-1b40-11e5-9dd6-52b319c1e36e.png)\n,https://github.com/bitcoin/bitcoin/pull/6314#issuecomment-115217912,115217912,
laanwj,2015-06-25T15:47:34Z,"@welshjf these kinds of builds it needs to be able to handle:\n\n|  | depends | non-depends |\n| --- | --- | --- |\n| static | × | × |\n| dynamic | - | × |\n\n'non-depends' uses any dependencies that the user themselves provides (or their distro, in case of Linux), this can be a wider range of library versions. E.g. we even still support building with Qt4, and with ancient boost.\n",https://github.com/bitcoin/bitcoin/pull/6314#issuecomment-115299916,115299916,
laanwj,2015-06-29T14:46:23Z,@theuni Is this ready to merge?\n,https://github.com/bitcoin/bitcoin/pull/6314#issuecomment-116711744,116711744,
theuni,2015-06-29T15:23:06Z,"@laanwj No, not yet. Windows still needs fixing up, and the Linux build needs testing. Need to look over the X include order stuff, since that's subtle. I'll document the issues while I go over them this time.\n",https://github.com/bitcoin/bitcoin/pull/6314#issuecomment-116730830,116730830,
laanwj,2015-07-05T12:51:15Z,I also just got a notification that my suggestion for a flag to force TLS has been implemented and will be in Qt 5.5.0: https://bugreports.qt.io/browse/QTBUG-43168\n,https://github.com/bitcoin/bitcoin/pull/6314#issuecomment-118618647,118618647,
jonasschnelli,2015-07-13T09:25:48Z,I assume this might fix #6426. Just built this PR over gitian but the linux build failed.\nVarious errors (grep error):\n\n```\ncc1plus: error: unrecognized command line option â€˜-fuse-ld=goldâ€™\ncc1plus: error: unrecognized command line option â€˜-mavx2â€™\nProject ERROR: mtdev development package not found\npulseaudio.cpp:34:30: fatal error: pulse/pulseaudio.h: No such file or directory\nxrend,https://github.com/bitcoin/bitcoin/pull/6314#issuecomment-120868083,120868083,
welshjf,2015-07-13T21:13:29Z,"Most of those are just auto-detections failing; XIproto.h is the relevant error.\n\nI guess that answers https://github.com/bitcoin/bitcoin/issues/6267#issuecomment-111579554.\n\nWe used to just strip out that #include, but now qxcbsettings.cpp actually uses some macros from the X headers. Probably we can just define them locally.\n",https://github.com/bitcoin/bitcoin/pull/6314#issuecomment-121061630,121061630,
welshjf,2015-07-13T21:21:50Z,"@laanwj good news, maybe we should leapfrog 5.4. http://doc.qt.io/qt-5/qssl.html#SslProtocol-enum seems to be where to look, unfortunately doesn't show what's new in 5.5. Looks like it might be secure by default now, but ""denying SSLv3 connections that does not upgrade to TLS"" doesn't make me feel entirely confident.\n",https://github.com/bitcoin/bitcoin/pull/6314#issuecomment-121063538,121063538,
theuni,2015-07-17T02:28:53Z,"@welshjf Have a look at https://github.com/theuni/bitcoin/commit/f7b1db98c03ec9d1e1f70e16683c37126e6e49c5 . With that, all platforms work for me as intended. Gitian builds included.\n\nI've confirmed that the Linux include order is still ok. I'm not entirely happy about the osx print workaround, but everything seems to work.\n\nAs for jumping to 5.5 that's fine too when it's out+stable, but I don'",https://github.com/bitcoin/bitcoin/pull/6314#issuecomment-122152272,122152272,
welshjf,2015-07-17T04:35:43Z,"Repeating here for clarify: theuni's latest commit is working for me (depends build on Fedora). Travis is failing due to SF outage: ""The sourceforge.net website is temporarily in static offline mode.\nOnly a very limited set of project pages are available until the main website returns to service.""\n",https://github.com/bitcoin/bitcoin/pull/6314#issuecomment-122169691,122169691,
welshjf,2015-07-17T04:37:44Z,Incidentally... are we effectively re-downloading all deps from upstream each time someone submits or updates a PR? That doesn't seem very nice.\n,https://github.com/bitcoin/bitcoin/pull/6314#issuecomment-122170456,122170456,
theuni,2015-07-17T04:45:08Z,"No, only when the cache is wiped or the depends are stale and need to be rebuilt. In this case, boost has been bumped in master, so when this PR is merged for testing boost must be rebuilt as well.\n\nUsually the sourceforge problem would not be an issue as we have a fallback download, but annoyingly, they don't respond with an error :\\n",https://github.com/bitcoin/bitcoin/pull/6314#issuecomment-122173201,122173201,
welshjf,2015-07-17T05:02:28Z,"Would it help if I rebased this on master, then?\n",https://github.com/bitcoin/bitcoin/pull/6314#issuecomment-122176473,122176473,
theuni,2015-07-17T05:03:20Z,I've pushed 2 more commits here https://github.com/theuni/bitcoin/tree/qt54 which bump to 5.5. Quickly sanity checked on all platforms.\n,https://github.com/bitcoin/bitcoin/pull/6314#issuecomment-122176548,122176548,
theuni,2015-07-17T05:04:33Z,"Yea, that might work. Though if SF stays down for a while, we'll need to redirect the download anyway, to avoid having a bunch of other PRs fail until it comes back up.\n",https://github.com/bitcoin/bitcoin/pull/6314#issuecomment-122176629,122176629,
welshjf,2015-07-20T14:56:44Z,"SF is partially back, downloads working at least. @theuni why don't you rename your branch and do a new PR for 5.5. Don't think there's anything left for me to fix here.\n",https://github.com/bitcoin/bitcoin/pull/6314#issuecomment-122910649,122910649,
laanwj,2015-07-20T16:33:27Z,"Thanks for your work @welshjf . Yes, let's move directly to 5.5. WIll you file the PR @theuni?\n",https://github.com/bitcoin/bitcoin/pull/6314#issuecomment-122941840,122941840,
theuni,2015-07-22T22:34:30Z,"Yes, will do. Maybe the OSX printing problem has been fixed for 5.5 and we can drop that hack.\n",https://github.com/bitcoin/bitcoin/pull/6314#issuecomment-123892099,123892099,
theuni,2015-06-20T19:23:40Z,"please use $(package)_foo for variables. All files are included by the main makefile, so $(package)_ acts somewhat as a namespace.\n",https://github.com/bitcoin/bitcoin/pull/6314#discussion_r32887191,32887191,depends/packages/qt.mk
welshjf,2015-06-20T21:54:21Z,"Ah, I figured there was some reason like that... at least it will help consistency, but I'd note that $(package) in this case is ""qt"" ;)\n",https://github.com/bitcoin/bitcoin/pull/6314#discussion_r32888491,32888491,depends/packages/qt.mk
Diapolo,2015-06-20T22:52:41Z,"Is it possible to download via https, just feels better these days...\n",https://github.com/bitcoin/bitcoin/pull/6314#discussion_r32888913,32888913,depends/packages/qt.mk
welshjf,2015-06-21T02:38:27Z,"If you don't trust verification by SHA256 baked into the download code, then you really shouldn't trust HTTPS ;)\n",https://github.com/bitcoin/bitcoin/pull/6314#discussion_r32889962,32889962,depends/packages/qt.mk
laanwj,2015-06-24T13:27:54Z,Why remove the accessability stuff?\n,https://github.com/bitcoin/bitcoin/pull/6314#discussion_r33146647,33146647,build-aux/m4/bitcoin_qt.m4
laanwj,2015-06-24T13:42:29Z,"I was about to say belt and suspenders to use https, especially as the server supports it. Being slightly paranoid hasn't hurt us in the past.\nBut looks like using https makes no sense, it redirects you to a http mirror:\n\n```\n--2015-06-24 15:40:51--  https://download.qt.io/official_releases/qt/5.4/5.4.2/submodules/qtx11extras-opensource-src-5.4.2.tar.xz\nResolving download.qt.io (download.qt.i",https://github.com/bitcoin/bitcoin/pull/6314#discussion_r33148019,33148019,depends/packages/qt.mk
welshjf,2015-06-24T15:59:18Z,"The plugin no longer exists; it was moved to the base library. theuni wants all this conditional though, to support static builds with either version.\n",https://github.com/bitcoin/bitcoin/pull/6314#discussion_r33163449,33163449,build-aux/m4/bitcoin_qt.m4
welshjf,2015-06-24T16:01:40Z,"FWIW, the hashes are checked twice, once on download and again on extract.\n",https://github.com/bitcoin/bitcoin/pull/6314#discussion_r33163762,33163762,depends/packages/qt.mk
laanwj,2015-06-25T06:39:46Z,"OK, fair enough\n",https://github.com/bitcoin/bitcoin/pull/6314#discussion_r33226133,33226133,build-aux/m4/bitcoin_qt.m4
