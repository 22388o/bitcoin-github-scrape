[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/613763747",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#issuecomment-613763747",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18642",
    "id": 613763747,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMzc2Mzc0Nw==",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?u=06eb9ae4f9b3f954056098860decccbf1340e40f&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-15T01:29:06Z",
    "updated_at": "2020-04-15T01:29:06Z",
    "author_association": "MEMBER",
    "body": "@sipa btw, take a look at how hashAddr was fed to the hasher twice (with a shift, yeah).\r\nI removed it, although I don't know why it was there in the first place... Feeding it once like I do should be sufficient.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/613763747/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/613773120",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#issuecomment-613773120",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18642",
    "id": 613773120,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMzc3MzEyMA==",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?u=7999a16349f0df0fb273fffa18e5a955c9d3f11c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-15T02:05:30Z",
    "updated_at": "2020-04-15T02:12:03Z",
    "author_association": "MEMBER",
    "body": "@naumenkogs It was very inscrutable code, but the construction with double-hashing the address hash was by design.\r\n\r\nThe idea is that the address both influences the hash directly, but also determines when the \"reset time of the day\" is (by including hashaddr in `(time + hashaddr)/DAY`, not every address will change salt simultaneously throughout the day).\r\n\r\nThe shifting is pointless, we should get rid of it. It seems to be a silly evolution of this 2010 Satoshi code: 5cbf75324d1509a1262b65c5073314a4da3f6d77 (where it made sense because everything was XORed together, and the address used the high bits, while the time used the low ones).",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/613773120/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/614060919",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#issuecomment-614060919",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18642",
    "id": 614060919,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxNDA2MDkxOQ==",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?u=06eb9ae4f9b3f954056098860decccbf1340e40f&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-15T14:05:34Z",
    "updated_at": "2020-04-15T14:12:15Z",
    "author_association": "MEMBER",
    "body": "Updated the code with suggestion by @sipa, and simplified tests.\r\nThey are a bit loosened now, but more robust to failures caused by randomness. ",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/614060919/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/618671026",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#issuecomment-618671026",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18642",
    "id": 618671026,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxODY3MTAyNg==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-23T21:06:44Z",
    "updated_at": "2021-11-30T11:27:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#23542](https://github.com/bitcoin/bitcoin/pull/23542) (net: open p2p connections to nodes that listen on non-default ports by vasild)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/618671026/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/652327720",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#issuecomment-652327720",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18642",
    "id": 652327720,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1MjMyNzcyMA==",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?u=06eb9ae4f9b3f954056098860decccbf1340e40f&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-01T10:10:23Z",
    "updated_at": "2020-07-01T10:10:23Z",
    "author_association": "MEMBER",
    "body": "@jonatack addressed all the things.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/652327720/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/701591535",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#issuecomment-701591535",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18642",
    "id": 701591535,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMTU5MTUzNQ==",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?u=7999a16349f0df0fb273fffa18e5a955c9d3f11c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-30T19:17:58Z",
    "updated_at": "2020-09-30T19:17:58Z",
    "author_association": "MEMBER",
    "body": "utACK 72d7e2400759dacfc8860341d5bb90459e363a81. I only casually reviewed the tests.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/701591535/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/701965127",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#issuecomment-701965127",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18642",
    "id": 701965127,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMTk2NTEyNw==",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-01T08:04:17Z",
    "updated_at": "2020-10-01T08:04:17Z",
    "author_association": "MEMBER",
    "body": "ACK 72d7e2400759dacfc8860341d5bb90459e363a81",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/701965127/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/920518707",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#issuecomment-920518707",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18642",
    "id": 920518707,
    "node_id": "IC_kwDOABII58423gAz",
    "user": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?u=a0e0040aacd7d4f0787481e8ac30b494fa429e11&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-16T02:08:55Z",
    "updated_at": "2021-09-16T02:08:55Z",
    "author_association": "MEMBER",
    "body": "Aside from this needing rebase for conflicts, can you rebase on master so that new CIs run. That should remove appveyor as well.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/920518707/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/924666057",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#issuecomment-924666057",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18642",
    "id": 924666057,
    "node_id": "IC_kwDOABII5843HUjJ",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-22T07:36:41Z",
    "updated_at": "2021-09-22T07:36:41Z",
    "author_association": "MEMBER",
    "body": "@naumenkogs Is this up for grabs?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/924666057/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/927863694",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#issuecomment-927863694",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18642",
    "id": 927863694,
    "node_id": "IC_kwDOABII5843ThOO",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?u=06eb9ae4f9b3f954056098860decccbf1340e40f&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-27T13:14:54Z",
    "updated_at": "2021-09-27T13:14:54Z",
    "author_association": "MEMBER",
    "body": "Okay, it was hard to rebase @jonatack test contributed, but I just did it. Ready for review.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/927863694/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/408525476",
    "pull_request_review_id": 393396647,
    "id": 408525476,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODUyNTQ3Ng==",
    "diff_hunk": "@@ -1373,7 +1375,11 @@ static void RelayAddress(const CAddress& addr, bool fReachable, const CConnman&\n     // Use deterministic randomness to send to the same nodes for 24 hours\n     // at a time so the m_addr_knowns of the chosen nodes prevent repeats\n     uint64_t hashAddr = addr.GetHash();\n-    const CSipHasher hasher = connman.GetDeterministicRandomizer(RANDOMIZER_ID_ADDRESS_RELAY).Write(hashAddr << 32).Write((GetTime() + hashAddr) / (24 * 60 * 60));\n+\n+    std::chrono::seconds rotate_interval = std::chrono::duration_cast<std::chrono::seconds>(ROTATE_ADDR_RELAY_DEST_INTERVAL);",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 15,
    "commit_id": "7ba6b190b626095945a0637354ba61ba5ccce1ad",
    "original_commit_id": "3c8319f57b8f982335dd588ac2fe40ad87fabd29",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Is this duration_cast needed? I think conversion should be automatic.",
    "created_at": "2020-04-15T01:18:23Z",
    "updated_at": "2020-07-01T09:14:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r408525476",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/408525476"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r408525476"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/408525476/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1379,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/408527433",
    "pull_request_review_id": 393398772,
    "id": 408527433,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODUyNzQzMw==",
    "diff_hunk": "@@ -1373,7 +1375,11 @@ static void RelayAddress(const CAddress& addr, bool fReachable, const CConnman&\n     // Use deterministic randomness to send to the same nodes for 24 hours\n     // at a time so the m_addr_knowns of the chosen nodes prevent repeats\n     uint64_t hashAddr = addr.GetHash();\n-    const CSipHasher hasher = connman.GetDeterministicRandomizer(RANDOMIZER_ID_ADDRESS_RELAY).Write(hashAddr << 32).Write((GetTime() + hashAddr) / (24 * 60 * 60));\n+\n+    std::chrono::seconds rotate_interval = std::chrono::duration_cast<std::chrono::seconds>(ROTATE_ADDR_RELAY_DEST_INTERVAL);",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 15,
    "commit_id": "7ba6b190b626095945a0637354ba61ba5ccce1ad",
    "original_commit_id": "3c8319f57b8f982335dd588ac2fe40ad87fabd29",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "You are right. I spent 30 minutes fighting with this code, and couldn't come up with something better.\r\n\r\nBut after you messaged I tried once more and it worked. Will force push in a second.",
    "created_at": "2020-04-15T01:25:42Z",
    "updated_at": "2020-07-01T09:14:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r408527433",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/408527433"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r408527433"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/408527433/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1379,
    "side": "RIGHT",
    "in_reply_to_id": 408525476
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/408528523",
    "pull_request_review_id": 393399933,
    "id": 408528523,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODUyODUyMw==",
    "diff_hunk": "@@ -1373,7 +1375,11 @@ static void RelayAddress(const CAddress& addr, bool fReachable, const CConnman&\n     // Use deterministic randomness to send to the same nodes for 24 hours\n     // at a time so the m_addr_knowns of the chosen nodes prevent repeats\n     uint64_t hashAddr = addr.GetHash();\n-    const CSipHasher hasher = connman.GetDeterministicRandomizer(RANDOMIZER_ID_ADDRESS_RELAY).Write(hashAddr << 32).Write((GetTime() + hashAddr) / (24 * 60 * 60));\n+\n+    std::chrono::seconds rotate_interval = std::chrono::duration_cast<std::chrono::seconds>(ROTATE_ADDR_RELAY_DEST_INTERVAL);\n+    std::chrono::seconds current_time = GetTime<std::chrono::seconds>();\n+    uint64_t time_seed = current_time.count() / rotate_interval.count();",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 17,
    "commit_id": "7ba6b190b626095945a0637354ba61ba5ccce1ad",
    "original_commit_id": "3c8319f57b8f982335dd588ac2fe40ad87fabd29",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\n    const uint64_t time_seed {GetTime<std::chrono::seconds>().count() / std::chrono::seconds{ROTATE_ADDR_RELAY_DEST_INTERVAL}.count()};\r\n```\r\n\r\nEverything in one line with compile-time checks enabled would look like this, btw",
    "created_at": "2020-04-15T01:29:40Z",
    "updated_at": "2020-07-01T09:14:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r408528523",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/408528523"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r408528523"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/408528523/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1381,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/408528847",
    "pull_request_review_id": 393400312,
    "id": 408528847,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODUyODg0Nw==",
    "diff_hunk": "@@ -1373,7 +1375,11 @@ static void RelayAddress(const CAddress& addr, bool fReachable, const CConnman&\n     // Use deterministic randomness to send to the same nodes for 24 hours\n     // at a time so the m_addr_knowns of the chosen nodes prevent repeats\n     uint64_t hashAddr = addr.GetHash();\n-    const CSipHasher hasher = connman.GetDeterministicRandomizer(RANDOMIZER_ID_ADDRESS_RELAY).Write(hashAddr << 32).Write((GetTime() + hashAddr) / (24 * 60 * 60));\n+\n+    std::chrono::seconds rotate_interval = std::chrono::duration_cast<std::chrono::seconds>(ROTATE_ADDR_RELAY_DEST_INTERVAL);\n+    std::chrono::seconds current_time = GetTime<std::chrono::seconds>();\n+    uint64_t time_seed = current_time.count() / rotate_interval.count();",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 17,
    "commit_id": "7ba6b190b626095945a0637354ba61ba5ccce1ad",
    "original_commit_id": "3c8319f57b8f982335dd588ac2fe40ad87fabd29",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "can we keep it to 2 lines? I think what you suggest is hard to read.",
    "created_at": "2020-04-15T01:30:57Z",
    "updated_at": "2020-07-01T09:14:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r408528847",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/408528847"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r408528847"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/408528847/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1381,
    "side": "RIGHT",
    "in_reply_to_id": 408528523
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/408538603",
    "pull_request_review_id": 393410577,
    "id": 408538603,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODUzODYwMw==",
    "diff_hunk": "@@ -1373,7 +1375,10 @@ static void RelayAddress(const CAddress& addr, bool fReachable, const CConnman&\n     // Use deterministic randomness to send to the same nodes for 24 hours\n     // at a time so the m_addr_knowns of the chosen nodes prevent repeats\n     uint64_t hashAddr = addr.GetHash();\n-    const CSipHasher hasher = connman.GetDeterministicRandomizer(RANDOMIZER_ID_ADDRESS_RELAY).Write(hashAddr << 32).Write((GetTime() + hashAddr) / (24 * 60 * 60));\n+\n+    std::chrono::seconds current_time = GetTime<std::chrono::seconds>();\n+    uint64_t time_seed = current_time / ROTATE_ADDR_RELAY_DEST_INTERVAL;\n+    const CSipHasher hasher = connman.GetDeterministicRandomizer(RANDOMIZER_ID_ADDRESS_RELAY).Write(hashAddr).Write(time_seed);",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 17,
    "commit_id": "7ba6b190b626095945a0637354ba61ba5ccce1ad",
    "original_commit_id": "8690d401a71609108f47d7e303c113eed401d52f",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\n    const CSipHasher hasher = connman.GetDeterministicRandomizer(RANDOMIZER_ID_ADDRESS_RELAY).Write(hashAddr).Write((current_time + hashAddr) / ROTATE_ADDR_RELAY_DEST_INTERVAL);\r\n```",
    "created_at": "2020-04-15T02:06:36Z",
    "updated_at": "2020-07-01T09:14:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r408538603",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/408538603"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r408538603"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/408538603/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1381,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/408860100",
    "pull_request_review_id": 393796074,
    "id": 408860100,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg2MDEwMA==",
    "diff_hunk": "@@ -1373,7 +1375,10 @@ static void RelayAddress(const CAddress& addr, bool fReachable, const CConnman&\n     // Use deterministic randomness to send to the same nodes for 24 hours\n     // at a time so the m_addr_knowns of the chosen nodes prevent repeats\n     uint64_t hashAddr = addr.GetHash();\n-    const CSipHasher hasher = connman.GetDeterministicRandomizer(RANDOMIZER_ID_ADDRESS_RELAY).Write(hashAddr << 32).Write((GetTime() + hashAddr) / (24 * 60 * 60));\n+\n+    std::chrono::seconds current_time = GetTime<std::chrono::seconds>();\n+    uint64_t time_seed = current_time / ROTATE_ADDR_RELAY_DEST_INTERVAL;\n+    const CSipHasher hasher = connman.GetDeterministicRandomizer(RANDOMIZER_ID_ADDRESS_RELAY).Write(hashAddr).Write(time_seed);",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 17,
    "commit_id": "7ba6b190b626095945a0637354ba61ba5ccce1ad",
    "original_commit_id": "8690d401a71609108f47d7e303c113eed401d52f",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yeah, I'm not 100% sure that this measure is effective against anything, but it won't hurt to have a less symmetry.\r\nThis mehaviour _may_ leak extra information if someone tries to analyze how addresses are flowing, but since we don't have any real evidence, we probably should stick to the existing reasoning.\r\n\r\nHad to slightly adjust the code you suggested, because adding uint to chrono type doesn't work right away.",
    "created_at": "2020-04-15T13:54:20Z",
    "updated_at": "2020-07-01T09:14:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r408860100",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/408860100"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r408860100"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/408860100/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1381,
    "side": "RIGHT",
    "in_reply_to_id": 408538603
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/408882152",
    "pull_request_review_id": 393824603,
    "id": 408882152,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg4MjE1Mg==",
    "diff_hunk": "@@ -1373,7 +1375,11 @@ static void RelayAddress(const CAddress& addr, bool fReachable, const CConnman&\n     // Use deterministic randomness to send to the same nodes for 24 hours\n     // at a time so the m_addr_knowns of the chosen nodes prevent repeats\n     uint64_t hashAddr = addr.GetHash();\n-    const CSipHasher hasher = connman.GetDeterministicRandomizer(RANDOMIZER_ID_ADDRESS_RELAY).Write(hashAddr << 32).Write((GetTime() + hashAddr) / (24 * 60 * 60));\n+\n+    std::chrono::seconds current_time = GetTime<std::chrono::seconds>();\n+    // Adding address hash makes exact rotation time different per address, while preserving periodicity.\n+    uint64_t time_addr = (current_time + std::chrono::hours(hashAddr)) / ROTATE_ADDR_RELAY_DEST_INTERVAL;",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 17,
    "commit_id": "7ba6b190b626095945a0637354ba61ba5ccce1ad",
    "original_commit_id": "cca35ff2477eea45a2d0781544621ce6e8afa158",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Previously `hashAddr` was of type seconds, now it is type hours. What was the reason to change it?",
    "created_at": "2020-04-15T14:23:32Z",
    "updated_at": "2020-07-01T09:14:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r408882152",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/408882152"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r408882152"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/408882152/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1381,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/408927009",
    "pull_request_review_id": 393880756,
    "id": 408927009,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODkyNzAwOQ==",
    "diff_hunk": "@@ -1373,7 +1375,11 @@ static void RelayAddress(const CAddress& addr, bool fReachable, const CConnman&\n     // Use deterministic randomness to send to the same nodes for 24 hours\n     // at a time so the m_addr_knowns of the chosen nodes prevent repeats\n     uint64_t hashAddr = addr.GetHash();\n-    const CSipHasher hasher = connman.GetDeterministicRandomizer(RANDOMIZER_ID_ADDRESS_RELAY).Write(hashAddr << 32).Write((GetTime() + hashAddr) / (24 * 60 * 60));\n+\n+    std::chrono::seconds current_time = GetTime<std::chrono::seconds>();\n+    // Adding address hash makes exact rotation time different per address, while preserving periodicity.\n+    uint64_t time_addr = (current_time + std::chrono::hours(hashAddr)) / ROTATE_ADDR_RELAY_DEST_INTERVAL;",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 17,
    "commit_id": "7ba6b190b626095945a0637354ba61ba5ccce1ad",
    "original_commit_id": "cca35ff2477eea45a2d0781544621ce6e8afa158",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "There is no real difference, as long as it  is an order of hours or more. Otherwise, it won't add enough randomness.",
    "created_at": "2020-04-15T15:20:50Z",
    "updated_at": "2020-07-01T09:14:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r408927009",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/408927009"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r408927009"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/408927009/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1381,
    "side": "RIGHT",
    "in_reply_to_id": 408882152
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/408942249",
    "pull_request_review_id": 393899475,
    "id": 408942249,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODk0MjI0OQ==",
    "diff_hunk": "@@ -1373,7 +1375,11 @@ static void RelayAddress(const CAddress& addr, bool fReachable, const CConnman&\n     // Use deterministic randomness to send to the same nodes for 24 hours\n     // at a time so the m_addr_knowns of the chosen nodes prevent repeats\n     uint64_t hashAddr = addr.GetHash();\n-    const CSipHasher hasher = connman.GetDeterministicRandomizer(RANDOMIZER_ID_ADDRESS_RELAY).Write(hashAddr << 32).Write((GetTime() + hashAddr) / (24 * 60 * 60));\n+\n+    std::chrono::seconds current_time = GetTime<std::chrono::seconds>();\n+    // Adding address hash makes exact rotation time different per address, while preserving periodicity.\n+    uint64_t time_addr = (current_time + std::chrono::hours(hashAddr)) / ROTATE_ADDR_RELAY_DEST_INTERVAL;",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 17,
    "commit_id": "7ba6b190b626095945a0637354ba61ba5ccce1ad",
    "original_commit_id": "cca35ff2477eea45a2d0781544621ce6e8afa158",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "You will get rid of the \"reset time of the day\" feature. Generally I don't like refactoring commits to also change behavior.",
    "created_at": "2020-04-15T15:40:55Z",
    "updated_at": "2020-07-01T09:14:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r408942249",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/408942249"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r408942249"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/408942249/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1381,
    "side": "RIGHT",
    "in_reply_to_id": 408882152
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/408950804",
    "pull_request_review_id": 393909762,
    "id": 408950804,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODk1MDgwNA==",
    "diff_hunk": "@@ -1373,7 +1375,11 @@ static void RelayAddress(const CAddress& addr, bool fReachable, const CConnman&\n     // Use deterministic randomness to send to the same nodes for 24 hours\n     // at a time so the m_addr_knowns of the chosen nodes prevent repeats\n     uint64_t hashAddr = addr.GetHash();\n-    const CSipHasher hasher = connman.GetDeterministicRandomizer(RANDOMIZER_ID_ADDRESS_RELAY).Write(hashAddr << 32).Write((GetTime() + hashAddr) / (24 * 60 * 60));\n+\n+    std::chrono::seconds current_time = GetTime<std::chrono::seconds>();\n+    // Adding address hash makes exact rotation time different per address, while preserving periodicity.\n+    uint64_t time_addr = (current_time + std::chrono::hours(hashAddr)) / ROTATE_ADDR_RELAY_DEST_INTERVAL;",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 17,
    "commit_id": "7ba6b190b626095945a0637354ba61ba5ccce1ad",
    "original_commit_id": "cca35ff2477eea45a2d0781544621ce6e8afa158",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Okay, made it seconds again so that we don't change the behavior. Although I think we won't loose any properties if hours are used.",
    "created_at": "2020-04-15T15:52:49Z",
    "updated_at": "2020-07-01T09:14:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r408950804",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/408950804"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r408950804"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/408950804/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1381,
    "side": "RIGHT",
    "in_reply_to_id": 408882152
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/409919084",
    "pull_request_review_id": 395080647,
    "id": 409919084,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTkxOTA4NA==",
    "diff_hunk": "@@ -1373,7 +1375,11 @@ static void RelayAddress(const CAddress& addr, bool fReachable, const CConnman&\n     // Use deterministic randomness to send to the same nodes for 24 hours\n     // at a time so the m_addr_knowns of the chosen nodes prevent repeats\n     uint64_t hashAddr = addr.GetHash();\n-    const CSipHasher hasher = connman.GetDeterministicRandomizer(RANDOMIZER_ID_ADDRESS_RELAY).Write(hashAddr << 32).Write((GetTime() + hashAddr) / (24 * 60 * 60));\n+\n+    std::chrono::seconds current_time = GetTime<std::chrono::seconds>();\n+    // Adding address hash makes exact rotation time different per address, while preserving periodicity.\n+    uint64_t time_addr = (current_time + std::chrono::seconds(hashAddr)) / ROTATE_ADDR_RELAY_DEST_INTERVAL;",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 17,
    "commit_id": "7ba6b190b626095945a0637354ba61ba5ccce1ad",
    "original_commit_id": "ae5eaf52624703752f63703942fd5aacdc0b7122",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\n    uint64_t time_addr = (current_time + std::chrono::seconds{static_cast<int64_t>(hashAddr)}) / ROTATE_ADDR_RELAY_DEST_INTERVAL;\r\n```\r\n\r\nMaybe try this to avoid https://travis-ci.org/github/bitcoin/bitcoin/jobs/675780723#L4756",
    "created_at": "2020-04-17T00:10:42Z",
    "updated_at": "2020-07-01T09:14:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r409919084",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/409919084"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r409919084"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/409919084/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1381,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/412253058",
    "pull_request_review_id": 397408347,
    "id": 412253058,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjI1MzA1OA==",
    "diff_hunk": "@@ -1373,7 +1375,11 @@ static void RelayAddress(const CAddress& addr, bool fReachable, const CConnman&\n     // Use deterministic randomness to send to the same nodes for 24 hours\n     // at a time so the m_addr_knowns of the chosen nodes prevent repeats\n     uint64_t hashAddr = addr.GetHash();\n-    const CSipHasher hasher = connman.GetDeterministicRandomizer(RANDOMIZER_ID_ADDRESS_RELAY).Write(hashAddr << 32).Write((GetTime() + hashAddr) / (24 * 60 * 60));\n+\n+    std::chrono::seconds current_time = GetTime<std::chrono::seconds>();\n+    // Adding address hash makes exact rotation time different per address, while preserving periodicity.\n+    uint64_t time_addr = (current_time + std::chrono::seconds{static_cast<int64_t>(hashAddr)}) / ROTATE_ADDR_RELAY_DEST_INTERVAL;",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 17,
    "commit_id": "7ba6b190b626095945a0637354ba61ba5ccce1ad",
    "original_commit_id": "72c4db3521069240a91609499638ba92313009af",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\n    uint64_t time_addr = static_cast<uint64_t>((current_time + std::chrono::seconds{static_cast<int64_t>(hashAddr)}) / ROTATE_ADDR_RELAY_DEST_INTERVAL);\r\n```\r\n\r\n\r\n```\r\n node0 stderr net_processing.cpp:1381:26: runtime error: implicit conversion from type 'typename common_type<long, long>::type' (aka 'long') of value -28739051454386 (64-bit, signed) to type 'uint64_t' (aka 'unsigned long') changed the value to 18446715334658097230 (64-bit, unsigned)",
    "created_at": "2020-04-21T14:49:28Z",
    "updated_at": "2020-07-01T09:14:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r412253058",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/412253058"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r412253058"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/412253058/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1381,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446666126",
    "pull_request_review_id": 438791359,
    "id": 446666126,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY2NjEyNg==",
    "diff_hunk": "@@ -1433,7 +1435,11 @@ static void RelayAddress(const CAddress& addr, bool fReachable, const CConnman&\n     // Use deterministic randomness to send to the same nodes for 24 hours\n     // at a time so the m_addr_knowns of the chosen nodes prevent repeats\n     uint64_t hashAddr = addr.GetHash();\n-    const CSipHasher hasher = connman.GetDeterministicRandomizer(RANDOMIZER_ID_ADDRESS_RELAY).Write(hashAddr << 32).Write((GetTime() + hashAddr) / (24 * 60 * 60));\n+\n+    std::chrono::seconds current_time = GetTime<std::chrono::seconds>();\n+    // Adding address hash makes exact rotation time different per address, while preserving periodicity.\n+    uint64_t time_addr = static_cast<uint64_t>((current_time + std::chrono::seconds{static_cast<int64_t>(hashAddr)}) / ROTATE_ADDR_RELAY_DEST_INTERVAL);",
    "path": "src/net_processing.cpp",
    "position": 19,
    "original_position": 17,
    "commit_id": "7ba6b190b626095945a0637354ba61ba5ccce1ad",
    "original_commit_id": "177df94a6ccce896e3bf067cc3c8254ecc40bfa9",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: Can this be simpler? It's more code and (even with the removed bit shifting) a bit more complex to understand.",
    "created_at": "2020-06-28T15:45:29Z",
    "updated_at": "2020-07-01T09:14:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r446666126",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446666126"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r446666126"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446666126/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1708,
    "original_line": 1708,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446666432",
    "pull_request_review_id": 438791359,
    "id": 446666432,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY2NjQzMg==",
    "diff_hunk": "@@ -48,24 +53,72 @@ def run_test(self):\n         self.log.info('Create connection that sends addr messages')\n         addr_source = self.nodes[0].add_p2p_connection(P2PInterface())\n         msg = msg_addr()\n-\n         self.log.info('Send too-large addr message')\n-        msg.addrs = ADDRS * 101\n+        msg.addrs = gen_addrs(1010, int(time.time()))\n         with self.nodes[0].assert_debug_log(['addr message size = 1010']):\n             addr_source.send_and_ping(msg)\n \n         self.log.info('Check that addr message content is relayed and added to addrman')\n         addr_receiver = self.nodes[0].add_p2p_connection(AddrReceiver())\n-        msg.addrs = ADDRS\n+        mocked_time = int(time.time())\n+        self.nodes[0].setmocktime(mocked_time)\n+        msg.addrs = gen_addrs(10, mocked_time)\n         with self.nodes[0].assert_debug_log([\n                 'Added 10 addresses from 127.0.0.1: 0 tried',\n                 'received: addr (301 bytes) peer=0',\n                 'sending addr (301 bytes) peer=1',\n         ]):\n             addr_source.send_and_ping(msg)\n-            self.nodes[0].setmocktime(int(time.time()) + 30 * 60)\n+            mocked_time += 30 * 60\n+            self.nodes[0].setmocktime(mocked_time)\n             addr_receiver.sync_with_ping()\n \n+        self.log.info('Check that within 24 hours an addr relay destination is rotated at most once')\n+        mocked_time = int(time.time()) + 100000\n+        self.nodes[0].setmocktime(mocked_time)\n+        msg.addrs = gen_addrs(1, mocked_time)\n+        addr_receiver.received_addr = False\n+        addr_receivers = [addr_receiver]\n+        for i in range(20):\n+            addr_receiver = self.nodes[0].add_p2p_connection(AddrReceiver())\n+            addr_receivers.append(addr_receiver)\n+\n+        for i in range(11): # 11 times jump for 2 hours, so less than 24 hours -> at most one rotation\n+            msg.addrs[0].time = mocked_time + 10 * 60\n+            with self.nodes[0].assert_debug_log([\n+                'received: addr (31 bytes) peer=0',\n+            ]):\n+                addr_source.send_and_ping(msg)\n+                mocked_time += 2 * 60 * 60",
    "path": "test/functional/p2p_addr_relay.py",
    "position": null,
    "original_position": 80,
    "commit_id": "7ba6b190b626095945a0637354ba61ba5ccce1ad",
    "original_commit_id": "177df94a6ccce896e3bf067cc3c8254ecc40bfa9",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In 6 places (here, above at line 72 and line 87, below at lines 106+107 and 113), it could be good to move the multiplications out of the loops and up to constants at the top like `ONE_HOUR`, `TWO_HOURS`, and `ONE_DAY`.",
    "created_at": "2020-06-28T15:48:55Z",
    "updated_at": "2020-07-01T09:14:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r446666432",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446666432"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r446666432"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446666432/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 92,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446666610",
    "pull_request_review_id": 438791359,
    "id": 446666610,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY2NjYxMA==",
    "diff_hunk": "@@ -48,24 +53,72 @@ def run_test(self):\n         self.log.info('Create connection that sends addr messages')\n         addr_source = self.nodes[0].add_p2p_connection(P2PInterface())\n         msg = msg_addr()\n-\n         self.log.info('Send too-large addr message')\n-        msg.addrs = ADDRS * 101\n+        msg.addrs = gen_addrs(1010, int(time.time()))\n         with self.nodes[0].assert_debug_log(['addr message size = 1010']):\n             addr_source.send_and_ping(msg)\n \n         self.log.info('Check that addr message content is relayed and added to addrman')\n         addr_receiver = self.nodes[0].add_p2p_connection(AddrReceiver())\n-        msg.addrs = ADDRS\n+        mocked_time = int(time.time())\n+        self.nodes[0].setmocktime(mocked_time)\n+        msg.addrs = gen_addrs(10, mocked_time)\n         with self.nodes[0].assert_debug_log([\n                 'Added 10 addresses from 127.0.0.1: 0 tried',\n                 'received: addr (301 bytes) peer=0',\n                 'sending addr (301 bytes) peer=1',\n         ]):\n             addr_source.send_and_ping(msg)\n-            self.nodes[0].setmocktime(int(time.time()) + 30 * 60)\n+            mocked_time += 30 * 60\n+            self.nodes[0].setmocktime(mocked_time)\n             addr_receiver.sync_with_ping()\n \n+        self.log.info('Check that within 24 hours an addr relay destination is rotated at most once')\n+        mocked_time = int(time.time()) + 100000\n+        self.nodes[0].setmocktime(mocked_time)\n+        msg.addrs = gen_addrs(1, mocked_time)\n+        addr_receiver.received_addr = False\n+        addr_receivers = [addr_receiver]\n+        for i in range(20):\n+            addr_receiver = self.nodes[0].add_p2p_connection(AddrReceiver())\n+            addr_receivers.append(addr_receiver)\n+\n+        for i in range(11): # 11 times jump for 2 hours, so less than 24 hours -> at most one rotation",
    "path": "test/functional/p2p_addr_relay.py",
    "position": null,
    "original_position": 74,
    "commit_id": "7ba6b190b626095945a0637354ba61ba5ccce1ad",
    "original_commit_id": "177df94a6ccce896e3bf067cc3c8254ecc40bfa9",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\n        for _ in range(11):  # 11 times jump for 2 hours, so less than 24 hours -> at most one rotation\r\n```",
    "created_at": "2020-06-28T15:50:19Z",
    "updated_at": "2020-07-01T09:14:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r446666610",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446666610"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r446666610"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446666610/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 86,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446666666",
    "pull_request_review_id": 438791359,
    "id": 446666666,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY2NjY2Ng==",
    "diff_hunk": "@@ -48,24 +53,72 @@ def run_test(self):\n         self.log.info('Create connection that sends addr messages')\n         addr_source = self.nodes[0].add_p2p_connection(P2PInterface())\n         msg = msg_addr()\n-\n         self.log.info('Send too-large addr message')\n-        msg.addrs = ADDRS * 101\n+        msg.addrs = gen_addrs(1010, int(time.time()))\n         with self.nodes[0].assert_debug_log(['addr message size = 1010']):\n             addr_source.send_and_ping(msg)\n \n         self.log.info('Check that addr message content is relayed and added to addrman')\n         addr_receiver = self.nodes[0].add_p2p_connection(AddrReceiver())\n-        msg.addrs = ADDRS\n+        mocked_time = int(time.time())\n+        self.nodes[0].setmocktime(mocked_time)\n+        msg.addrs = gen_addrs(10, mocked_time)\n         with self.nodes[0].assert_debug_log([\n                 'Added 10 addresses from 127.0.0.1: 0 tried',\n                 'received: addr (301 bytes) peer=0',\n                 'sending addr (301 bytes) peer=1',\n         ]):\n             addr_source.send_and_ping(msg)\n-            self.nodes[0].setmocktime(int(time.time()) + 30 * 60)\n+            mocked_time += 30 * 60\n+            self.nodes[0].setmocktime(mocked_time)\n             addr_receiver.sync_with_ping()\n \n+        self.log.info('Check that within 24 hours an addr relay destination is rotated at most once')\n+        mocked_time = int(time.time()) + 100000\n+        self.nodes[0].setmocktime(mocked_time)\n+        msg.addrs = gen_addrs(1, mocked_time)\n+        addr_receiver.received_addr = False\n+        addr_receivers = [addr_receiver]\n+        for i in range(20):\n+            addr_receiver = self.nodes[0].add_p2p_connection(AddrReceiver())\n+            addr_receivers.append(addr_receiver)\n+\n+        for i in range(11): # 11 times jump for 2 hours, so less than 24 hours -> at most one rotation\n+            msg.addrs[0].time = mocked_time + 10 * 60\n+            with self.nodes[0].assert_debug_log([\n+                'received: addr (31 bytes) peer=0',\n+            ]):\n+                addr_source.send_and_ping(msg)\n+                mocked_time += 2 * 60 * 60\n+                self.nodes[0].setmocktime(mocked_time)\n+                for receiver in addr_receivers:\n+                    receiver.sync_with_ping()\n+        nodes_received_addr = [node for node in addr_receivers if node.received_addr]\n+        assert(len(nodes_received_addr) <= 4)\n+\n+        self.log.info('Check that after 5 days an addr relay destination was rotated more than once')\n+        mocked_time = int(time.time()) + 200000\n+        self.nodes[0].setmocktime(mocked_time)\n+        for node in addr_receivers:\n+            node.received_addr = False\n+\n+        for i in range(10): # 11 times jump for a day, so less than 24 hours -> at most one rotation",
    "path": "test/functional/p2p_addr_relay.py",
    "position": null,
    "original_position": 93,
    "commit_id": "7ba6b190b626095945a0637354ba61ba5ccce1ad",
    "original_commit_id": "177df94a6ccce896e3bf067cc3c8254ecc40bfa9",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\n        for _ in range(10):  # 11 times jump for a day, so less than 24 hours -> at most one rotation\r\n```\r\nShould this be 10 or 11?",
    "created_at": "2020-06-28T15:50:49Z",
    "updated_at": "2020-07-01T09:14:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r446666666",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446666666"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r446666666"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446666666/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 105,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446666908",
    "pull_request_review_id": 438791359,
    "id": 446666908,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY2NjkwOA==",
    "diff_hunk": "@@ -48,24 +53,72 @@ def run_test(self):\n         self.log.info('Create connection that sends addr messages')\n         addr_source = self.nodes[0].add_p2p_connection(P2PInterface())\n         msg = msg_addr()\n-\n         self.log.info('Send too-large addr message')\n-        msg.addrs = ADDRS * 101\n+        msg.addrs = gen_addrs(1010, int(time.time()))\n         with self.nodes[0].assert_debug_log(['addr message size = 1010']):\n             addr_source.send_and_ping(msg)\n \n         self.log.info('Check that addr message content is relayed and added to addrman')\n         addr_receiver = self.nodes[0].add_p2p_connection(AddrReceiver())\n-        msg.addrs = ADDRS\n+        mocked_time = int(time.time())\n+        self.nodes[0].setmocktime(mocked_time)\n+        msg.addrs = gen_addrs(10, mocked_time)\n         with self.nodes[0].assert_debug_log([\n                 'Added 10 addresses from 127.0.0.1: 0 tried',\n                 'received: addr (301 bytes) peer=0',\n                 'sending addr (301 bytes) peer=1',\n         ]):\n             addr_source.send_and_ping(msg)\n-            self.nodes[0].setmocktime(int(time.time()) + 30 * 60)\n+            mocked_time += 30 * 60\n+            self.nodes[0].setmocktime(mocked_time)\n             addr_receiver.sync_with_ping()\n \n+        self.log.info('Check that within 24 hours an addr relay destination is rotated at most once')\n+        mocked_time = int(time.time()) + 100000\n+        self.nodes[0].setmocktime(mocked_time)\n+        msg.addrs = gen_addrs(1, mocked_time)\n+        addr_receiver.received_addr = False\n+        addr_receivers = [addr_receiver]\n+        for i in range(20):\n+            addr_receiver = self.nodes[0].add_p2p_connection(AddrReceiver())\n+            addr_receivers.append(addr_receiver)\n+\n+        for i in range(11): # 11 times jump for 2 hours, so less than 24 hours -> at most one rotation\n+            msg.addrs[0].time = mocked_time + 10 * 60\n+            with self.nodes[0].assert_debug_log([\n+                'received: addr (31 bytes) peer=0',\n+            ]):\n+                addr_source.send_and_ping(msg)\n+                mocked_time += 2 * 60 * 60\n+                self.nodes[0].setmocktime(mocked_time)\n+                for receiver in addr_receivers:\n+                    receiver.sync_with_ping()\n+        nodes_received_addr = [node for node in addr_receivers if node.received_addr]\n+        assert(len(nodes_received_addr) <= 4)\n+\n+        self.log.info('Check that after 5 days an addr relay destination was rotated more than once')\n+        mocked_time = int(time.time()) + 200000\n+        self.nodes[0].setmocktime(mocked_time)\n+        for node in addr_receivers:\n+            node.received_addr = False\n+\n+        for i in range(10): # 11 times jump for a day, so less than 24 hours -> at most one rotation\n+            mocked_time += 24 * 60 * 60\n+            msg.addrs[0].time = mocked_time + 10 * 60\n+            self.nodes[0].setmocktime(mocked_time)\n+            with self.nodes[0].assert_debug_log([\n+                'received: addr (31 bytes) peer=0',\n+            ]):\n+                addr_source.send_and_ping(msg)\n+                mocked_time += 60 * 60 # should be enough to cover 30-min Poisson in most cases.",
    "path": "test/functional/p2p_addr_relay.py",
    "position": null,
    "original_position": 101,
    "commit_id": "7ba6b190b626095945a0637354ba61ba5ccce1ad",
    "original_commit_id": "177df94a6ccce896e3bf067cc3c8254ecc40bfa9",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\n                mocked_time += 60 * 60  # should be enough to cover 30-min Poisson in most cases.\r\n```",
    "created_at": "2020-06-28T15:53:10Z",
    "updated_at": "2020-07-01T09:14:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r446666908",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446666908"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r446666908"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446666908/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 113,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446667037",
    "pull_request_review_id": 438791359,
    "id": 446667037,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY2NzAzNw==",
    "diff_hunk": "@@ -48,24 +53,72 @@ def run_test(self):\n         self.log.info('Create connection that sends addr messages')\n         addr_source = self.nodes[0].add_p2p_connection(P2PInterface())\n         msg = msg_addr()\n-\n         self.log.info('Send too-large addr message')\n-        msg.addrs = ADDRS * 101\n+        msg.addrs = gen_addrs(1010, int(time.time()))\n         with self.nodes[0].assert_debug_log(['addr message size = 1010']):\n             addr_source.send_and_ping(msg)\n \n         self.log.info('Check that addr message content is relayed and added to addrman')\n         addr_receiver = self.nodes[0].add_p2p_connection(AddrReceiver())\n-        msg.addrs = ADDRS\n+        mocked_time = int(time.time())\n+        self.nodes[0].setmocktime(mocked_time)\n+        msg.addrs = gen_addrs(10, mocked_time)\n         with self.nodes[0].assert_debug_log([\n                 'Added 10 addresses from 127.0.0.1: 0 tried',\n                 'received: addr (301 bytes) peer=0',\n                 'sending addr (301 bytes) peer=1',\n         ]):\n             addr_source.send_and_ping(msg)\n-            self.nodes[0].setmocktime(int(time.time()) + 30 * 60)\n+            mocked_time += 30 * 60\n+            self.nodes[0].setmocktime(mocked_time)\n             addr_receiver.sync_with_ping()\n \n+        self.log.info('Check that within 24 hours an addr relay destination is rotated at most once')\n+        mocked_time = int(time.time()) + 100000\n+        self.nodes[0].setmocktime(mocked_time)\n+        msg.addrs = gen_addrs(1, mocked_time)\n+        addr_receiver.received_addr = False\n+        addr_receivers = [addr_receiver]\n+        for i in range(20):\n+            addr_receiver = self.nodes[0].add_p2p_connection(AddrReceiver())\n+            addr_receivers.append(addr_receiver)\n+\n+        for i in range(11): # 11 times jump for 2 hours, so less than 24 hours -> at most one rotation\n+            msg.addrs[0].time = mocked_time + 10 * 60\n+            with self.nodes[0].assert_debug_log([\n+                'received: addr (31 bytes) peer=0',\n+            ]):\n+                addr_source.send_and_ping(msg)\n+                mocked_time += 2 * 60 * 60\n+                self.nodes[0].setmocktime(mocked_time)\n+                for receiver in addr_receivers:\n+                    receiver.sync_with_ping()\n+        nodes_received_addr = [node for node in addr_receivers if node.received_addr]\n+        assert(len(nodes_received_addr) <= 4)\n+\n+        self.log.info('Check that after 5 days an addr relay destination was rotated more than once')\n+        mocked_time = int(time.time()) + 200000\n+        self.nodes[0].setmocktime(mocked_time)\n+        for node in addr_receivers:\n+            node.received_addr = False\n+\n+        for i in range(10): # 11 times jump for a day, so less than 24 hours -> at most one rotation\n+            mocked_time += 24 * 60 * 60\n+            msg.addrs[0].time = mocked_time + 10 * 60\n+            self.nodes[0].setmocktime(mocked_time)\n+            with self.nodes[0].assert_debug_log([\n+                'received: addr (31 bytes) peer=0',\n+            ]):\n+                addr_source.send_and_ping(msg)\n+                mocked_time += 60 * 60 # should be enough to cover 30-min Poisson in most cases.\n+                self.nodes[0].setmocktime(mocked_time)\n+                for receiver in addr_receivers:\n+                    receiver.sync_with_ping()\n+        nodes_received_addr = [node for node in addr_receivers if node.received_addr]\n+        assert(len(nodes_received_addr) > 4)",
    "path": "test/functional/p2p_addr_relay.py",
    "position": null,
    "original_position": 106,
    "commit_id": "7ba6b190b626095945a0637354ba61ba5ccce1ad",
    "original_commit_id": "177df94a6ccce896e3bf067cc3c8254ecc40bfa9",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\n        assert len(nodes_received_addr) > 4\r\n```\r\nor even better (adding it to the imported methods at the top)\r\n```suggestion\r\n        assert_greater_than(len(nodes_received_addr), 4)\r\n```",
    "created_at": "2020-06-28T15:54:27Z",
    "updated_at": "2020-07-01T09:14:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r446667037",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446667037"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r446667037"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446667037/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 118,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446667134",
    "pull_request_review_id": 438791359,
    "id": 446667134,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY2NzEzNA==",
    "diff_hunk": "@@ -48,24 +53,72 @@ def run_test(self):\n         self.log.info('Create connection that sends addr messages')\n         addr_source = self.nodes[0].add_p2p_connection(P2PInterface())\n         msg = msg_addr()\n-\n         self.log.info('Send too-large addr message')\n-        msg.addrs = ADDRS * 101\n+        msg.addrs = gen_addrs(1010, int(time.time()))\n         with self.nodes[0].assert_debug_log(['addr message size = 1010']):\n             addr_source.send_and_ping(msg)\n \n         self.log.info('Check that addr message content is relayed and added to addrman')\n         addr_receiver = self.nodes[0].add_p2p_connection(AddrReceiver())\n-        msg.addrs = ADDRS\n+        mocked_time = int(time.time())\n+        self.nodes[0].setmocktime(mocked_time)\n+        msg.addrs = gen_addrs(10, mocked_time)\n         with self.nodes[0].assert_debug_log([\n                 'Added 10 addresses from 127.0.0.1: 0 tried',\n                 'received: addr (301 bytes) peer=0',\n                 'sending addr (301 bytes) peer=1',\n         ]):\n             addr_source.send_and_ping(msg)\n-            self.nodes[0].setmocktime(int(time.time()) + 30 * 60)\n+            mocked_time += 30 * 60\n+            self.nodes[0].setmocktime(mocked_time)\n             addr_receiver.sync_with_ping()\n \n+        self.log.info('Check that within 24 hours an addr relay destination is rotated at most once')\n+        mocked_time = int(time.time()) + 100000\n+        self.nodes[0].setmocktime(mocked_time)\n+        msg.addrs = gen_addrs(1, mocked_time)\n+        addr_receiver.received_addr = False\n+        addr_receivers = [addr_receiver]\n+        for i in range(20):\n+            addr_receiver = self.nodes[0].add_p2p_connection(AddrReceiver())\n+            addr_receivers.append(addr_receiver)\n+\n+        for i in range(11): # 11 times jump for 2 hours, so less than 24 hours -> at most one rotation\n+            msg.addrs[0].time = mocked_time + 10 * 60\n+            with self.nodes[0].assert_debug_log([\n+                'received: addr (31 bytes) peer=0',\n+            ]):\n+                addr_source.send_and_ping(msg)\n+                mocked_time += 2 * 60 * 60\n+                self.nodes[0].setmocktime(mocked_time)\n+                for receiver in addr_receivers:\n+                    receiver.sync_with_ping()\n+        nodes_received_addr = [node for node in addr_receivers if node.received_addr]\n+        assert(len(nodes_received_addr) <= 4)",
    "path": "test/functional/p2p_addr_relay.py",
    "position": null,
    "original_position": 85,
    "commit_id": "7ba6b190b626095945a0637354ba61ba5ccce1ad",
    "original_commit_id": "177df94a6ccce896e3bf067cc3c8254ecc40bfa9",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\n        assert len(nodes_received_addr) <= 4\r\n```",
    "created_at": "2020-06-28T15:55:15Z",
    "updated_at": "2020-07-01T09:14:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r446667134",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446667134"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r446667134"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446667134/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 97,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446667220",
    "pull_request_review_id": 438791359,
    "id": 446667220,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY2NzIyMA==",
    "diff_hunk": "@@ -48,24 +53,72 @@ def run_test(self):\n         self.log.info('Create connection that sends addr messages')\n         addr_source = self.nodes[0].add_p2p_connection(P2PInterface())\n         msg = msg_addr()\n-\n         self.log.info('Send too-large addr message')\n-        msg.addrs = ADDRS * 101\n+        msg.addrs = gen_addrs(1010, int(time.time()))\n         with self.nodes[0].assert_debug_log(['addr message size = 1010']):\n             addr_source.send_and_ping(msg)\n \n         self.log.info('Check that addr message content is relayed and added to addrman')\n         addr_receiver = self.nodes[0].add_p2p_connection(AddrReceiver())\n-        msg.addrs = ADDRS\n+        mocked_time = int(time.time())\n+        self.nodes[0].setmocktime(mocked_time)\n+        msg.addrs = gen_addrs(10, mocked_time)\n         with self.nodes[0].assert_debug_log([\n                 'Added 10 addresses from 127.0.0.1: 0 tried',\n                 'received: addr (301 bytes) peer=0',\n                 'sending addr (301 bytes) peer=1',\n         ]):\n             addr_source.send_and_ping(msg)\n-            self.nodes[0].setmocktime(int(time.time()) + 30 * 60)\n+            mocked_time += 30 * 60\n+            self.nodes[0].setmocktime(mocked_time)\n             addr_receiver.sync_with_ping()\n \n+        self.log.info('Check that within 24 hours an addr relay destination is rotated at most once')\n+        mocked_time = int(time.time()) + 100000\n+        self.nodes[0].setmocktime(mocked_time)\n+        msg.addrs = gen_addrs(1, mocked_time)\n+        addr_receiver.received_addr = False\n+        addr_receivers = [addr_receiver]\n+        for i in range(20):",
    "path": "test/functional/p2p_addr_relay.py",
    "position": null,
    "original_position": 70,
    "commit_id": "7ba6b190b626095945a0637354ba61ba5ccce1ad",
    "original_commit_id": "177df94a6ccce896e3bf067cc3c8254ecc40bfa9",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\n        for _ in range(20):\r\n```",
    "created_at": "2020-06-28T15:55:54Z",
    "updated_at": "2020-07-01T09:14:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r446667220",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446667220"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r446667220"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446667220/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 82,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446668071",
    "pull_request_review_id": 438791359,
    "id": 446668071,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY2ODA3MQ==",
    "diff_hunk": "@@ -48,24 +53,72 @@ def run_test(self):\n         self.log.info('Create connection that sends addr messages')\n         addr_source = self.nodes[0].add_p2p_connection(P2PInterface())\n         msg = msg_addr()\n-\n         self.log.info('Send too-large addr message')\n-        msg.addrs = ADDRS * 101\n+        msg.addrs = gen_addrs(1010, int(time.time()))\n         with self.nodes[0].assert_debug_log(['addr message size = 1010']):\n             addr_source.send_and_ping(msg)\n \n         self.log.info('Check that addr message content is relayed and added to addrman')\n         addr_receiver = self.nodes[0].add_p2p_connection(AddrReceiver())\n-        msg.addrs = ADDRS\n+        mocked_time = int(time.time())\n+        self.nodes[0].setmocktime(mocked_time)\n+        msg.addrs = gen_addrs(10, mocked_time)\n         with self.nodes[0].assert_debug_log([\n                 'Added 10 addresses from 127.0.0.1: 0 tried',\n                 'received: addr (301 bytes) peer=0',\n                 'sending addr (301 bytes) peer=1',\n         ]):\n             addr_source.send_and_ping(msg)\n-            self.nodes[0].setmocktime(int(time.time()) + 30 * 60)\n+            mocked_time += 30 * 60\n+            self.nodes[0].setmocktime(mocked_time)\n             addr_receiver.sync_with_ping()\n \n+        self.log.info('Check that within 24 hours an addr relay destination is rotated at most once')\n+        mocked_time = int(time.time()) + 100000",
    "path": "test/functional/p2p_addr_relay.py",
    "position": null,
    "original_position": 65,
    "commit_id": "7ba6b190b626095945a0637354ba61ba5ccce1ad",
    "original_commit_id": "177df94a6ccce896e3bf067cc3c8254ecc40bfa9",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I don't grok what/why regarding the 100000 value. It would be nice to comment and/or hoist it to a variable.\r\n\r\nSame for 200000 at line 100.",
    "created_at": "2020-06-28T16:03:25Z",
    "updated_at": "2020-07-01T09:14:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r446668071",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446668071"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r446668071"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446668071/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 77,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446668728",
    "pull_request_review_id": 438791359,
    "id": 446668728,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY2ODcyOA==",
    "diff_hunk": "@@ -48,24 +53,72 @@ def run_test(self):\n         self.log.info('Create connection that sends addr messages')\n         addr_source = self.nodes[0].add_p2p_connection(P2PInterface())\n         msg = msg_addr()\n-\n         self.log.info('Send too-large addr message')\n-        msg.addrs = ADDRS * 101\n+        msg.addrs = gen_addrs(1010, int(time.time()))\n         with self.nodes[0].assert_debug_log(['addr message size = 1010']):\n             addr_source.send_and_ping(msg)\n \n         self.log.info('Check that addr message content is relayed and added to addrman')\n         addr_receiver = self.nodes[0].add_p2p_connection(AddrReceiver())\n-        msg.addrs = ADDRS\n+        mocked_time = int(time.time())\n+        self.nodes[0].setmocktime(mocked_time)\n+        msg.addrs = gen_addrs(10, mocked_time)\n         with self.nodes[0].assert_debug_log([\n                 'Added 10 addresses from 127.0.0.1: 0 tried',\n                 'received: addr (301 bytes) peer=0',\n                 'sending addr (301 bytes) peer=1',\n         ]):\n             addr_source.send_and_ping(msg)\n-            self.nodes[0].setmocktime(int(time.time()) + 30 * 60)\n+            mocked_time += 30 * 60\n+            self.nodes[0].setmocktime(mocked_time)\n             addr_receiver.sync_with_ping()\n \n+        self.log.info('Check that within 24 hours an addr relay destination is rotated at most once')\n+        mocked_time = int(time.time()) + 100000\n+        self.nodes[0].setmocktime(mocked_time)\n+        msg.addrs = gen_addrs(1, mocked_time)\n+        addr_receiver.received_addr = False\n+        addr_receivers = [addr_receiver]\n+        for i in range(20):\n+            addr_receiver = self.nodes[0].add_p2p_connection(AddrReceiver())\n+            addr_receivers.append(addr_receiver)\n+\n+        for i in range(11): # 11 times jump for 2 hours, so less than 24 hours -> at most one rotation\n+            msg.addrs[0].time = mocked_time + 10 * 60\n+            with self.nodes[0].assert_debug_log([\n+                'received: addr (31 bytes) peer=0',\n+            ]):\n+                addr_source.send_and_ping(msg)\n+                mocked_time += 2 * 60 * 60\n+                self.nodes[0].setmocktime(mocked_time)\n+                for receiver in addr_receivers:\n+                    receiver.sync_with_ping()\n+        nodes_received_addr = [node for node in addr_receivers if node.received_addr]\n+        assert(len(nodes_received_addr) <= 4)",
    "path": "test/functional/p2p_addr_relay.py",
    "position": null,
    "original_position": 85,
    "commit_id": "7ba6b190b626095945a0637354ba61ba5ccce1ad",
    "original_commit_id": "177df94a6ccce896e3bf067cc3c8254ecc40bfa9",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Why the value of 4 here and line 118? Perhaps add a comment.",
    "created_at": "2020-06-28T16:10:00Z",
    "updated_at": "2020-07-01T09:14:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r446668728",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446668728"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r446668728"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446668728/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 97,
    "side": "RIGHT",
    "in_reply_to_id": 446667134
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447658790",
    "pull_request_review_id": 439982931,
    "id": 447658790,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY1ODc5MA==",
    "diff_hunk": "@@ -1433,7 +1435,11 @@ static void RelayAddress(const CAddress& addr, bool fReachable, const CConnman&\n     // Use deterministic randomness to send to the same nodes for 24 hours\n     // at a time so the m_addr_knowns of the chosen nodes prevent repeats\n     uint64_t hashAddr = addr.GetHash();\n-    const CSipHasher hasher = connman.GetDeterministicRandomizer(RANDOMIZER_ID_ADDRESS_RELAY).Write(hashAddr << 32).Write((GetTime() + hashAddr) / (24 * 60 * 60));\n+\n+    std::chrono::seconds current_time = GetTime<std::chrono::seconds>();\n+    // Adding address hash makes exact rotation time different per address, while preserving periodicity.\n+    uint64_t time_addr = static_cast<uint64_t>((current_time + std::chrono::seconds{static_cast<int64_t>(hashAddr)}) / ROTATE_ADDR_RELAY_DEST_INTERVAL);",
    "path": "src/net_processing.cpp",
    "position": 19,
    "original_position": 17,
    "commit_id": "7ba6b190b626095945a0637354ba61ba5ccce1ad",
    "original_commit_id": "177df94a6ccce896e3bf067cc3c8254ecc40bfa9",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "We iterated over this line a couple times with @MarcoFalke, so I'm out of ideas here.\r\nOpen to suggestions!",
    "created_at": "2020-06-30T12:54:23Z",
    "updated_at": "2020-07-01T09:14:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r447658790",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447658790"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r447658790"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447658790/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1708,
    "original_line": 1708,
    "side": "RIGHT",
    "in_reply_to_id": 446666126
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/451096710",
    "pull_request_review_id": 444191165,
    "id": 451096710,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTA5NjcxMA==",
    "diff_hunk": "@@ -1433,7 +1435,11 @@ static void RelayAddress(const CAddress& addr, bool fReachable, const CConnman&\n     // Use deterministic randomness to send to the same nodes for 24 hours\n     // at a time so the m_addr_knowns of the chosen nodes prevent repeats\n     uint64_t hashAddr = addr.GetHash();\n-    const CSipHasher hasher = connman.GetDeterministicRandomizer(RANDOMIZER_ID_ADDRESS_RELAY).Write(hashAddr << 32).Write((GetTime() + hashAddr) / (24 * 60 * 60));\n+\n+    std::chrono::seconds current_time = GetTime<std::chrono::seconds>();\n+    // Adding address hash makes exact rotation time different per address, while preserving periodicity.\n+    uint64_t time_addr = static_cast<uint64_t>((current_time + std::chrono::seconds{static_cast<int64_t>(hashAddr)}) / ROTATE_ADDR_RELAY_DEST_INTERVAL);",
    "path": "src/net_processing.cpp",
    "position": 19,
    "original_position": 17,
    "commit_id": "7ba6b190b626095945a0637354ba61ba5ccce1ad",
    "original_commit_id": "177df94a6ccce896e3bf067cc3c8254ecc40bfa9",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Annoyingly, I think this is UB, as hashAddr may exceed 2^63, and casting a larger number to a signed 64-bit integer would be outside its range (and overflowing signed integers is undefined behavior).\r\n\r\nSuggestion: `uint64_t time_addr = (current_time + std::chrono::seconds{hashAddr % ROTATE_ADDR_RELAY_DEST_INTERVAL.count()}) / ROTATE_ADDR_RELAY_DEST_INTERVAL;`, and make `ROTATE_ADDR_RELAY_DEST_INTERVAL` to be of type `std::chrono::seconds`.",
    "created_at": "2020-07-07T19:35:12Z",
    "updated_at": "2020-07-07T19:35:13Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r451096710",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/451096710"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18642#discussion_r451096710"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18642"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/451096710/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1708,
    "original_line": 1708,
    "side": "RIGHT",
    "in_reply_to_id": 446666126
  }
]