[
  {
    "sha": "ddcd1afc5fdd148cd56f257b40a12f70841bd1b3",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpkZGNkMWFmYzVmZGQxNDhjZDU2ZjI1N2I0MGExMmY3MDg0MWJkMWIz",
    "commit": {
      "author": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@gmail.com",
        "date": "2014-03-20T11:03:36Z"
      },
      "committer": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@gmail.com",
        "date": "2014-03-26T08:48:22Z"
      },
      "message": "gitian: add statically built variant of bitcoind/bitcoin-cli",
      "tree": {
        "sha": "7ccb2680e96871e5a4a642cccc6c603582acb298",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7ccb2680e96871e5a4a642cccc6c603582acb298"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ddcd1afc5fdd148cd56f257b40a12f70841bd1b3",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ddcd1afc5fdd148cd56f257b40a12f70841bd1b3",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/ddcd1afc5fdd148cd56f257b40a12f70841bd1b3",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ddcd1afc5fdd148cd56f257b40a12f70841bd1b3/comments",
    "author": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "e3f5d4338d0305a398817279e36ef2d0cfd2fd2b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e3f5d4338d0305a398817279e36ef2d0cfd2fd2b",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/e3f5d4338d0305a398817279e36ef2d0cfd2fd2b"
      }
    ],
    "stats": {
      "total": 25,
      "additions": 23,
      "deletions": 2
    },
    "files": [
      {
        "sha": "05ef5ba5872f62a85ca61677fc5d330eb5350dfe",
        "filename": "contrib/gitian-descriptors/gitian-linux.yml",
        "status": "modified",
        "additions": 23,
        "deletions": 2,
        "changes": 25,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/ddcd1afc5fdd148cd56f257b40a12f70841bd1b3/contrib/gitian-descriptors/gitian-linux.yml",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/ddcd1afc5fdd148cd56f257b40a12f70841bd1b3/contrib/gitian-descriptors/gitian-linux.yml",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/gitian-descriptors/gitian-linux.yml?ref=ddcd1afc5fdd148cd56f257b40a12f70841bd1b3",
        "patch": "@@ -39,18 +39,39 @@ script: |\n   unzip ../build/bitcoin-deps-linux${GBUILD_BITS}-gitian-r3.zip\n   unzip ../build/boost-linux${GBUILD_BITS}-1.55.0-gitian-r1.zip\n   cd ../build\n+\n+  function do_configure {\n+    ./configure \"$@\" --enable-upnp-default --prefix=$STAGING --with-protoc-bindir=$STAGING/host/bin --with-boost=$STAGING --disable-maintainer-mode --disable-dependency-tracking PKG_CONFIG_PATH=\"$STAGING/lib/pkgconfig\" CPPFLAGS=\"-I$STAGING/include ${OPTFLAGS}\" LDFLAGS=\"-L$STAGING/lib ${OPTFLAGS}\" CXXFLAGS=\"-frandom-seed=bitcoin ${OPTFLAGS}\" BOOST_CHRONO_EXTRALIBS=\"-lrt\"\n+  }\n   #\n   cd bitcoin\n   ./autogen.sh\n-  ./configure --prefix=$STAGING --bindir=$BINDIR --with-protoc-bindir=$STAGING/host/bin --with-boost=$STAGING --disable-maintainer-mode --disable-dependency-tracking PKG_CONFIG_PATH=\"$STAGING/lib/pkgconfig\" CPPFLAGS=\"-I$STAGING/include ${OPTFLAGS}\" LDFLAGS=\"-L$STAGING/lib ${OPTFLAGS}\" CXXFLAGS=\"-frandom-seed=bitcoin ${OPTFLAGS}\" BOOST_CHRONO_EXTRALIBS=\"-lrt\"\n+  do_configure\n   make dist\n   DISTNAME=`echo bitcoin-*.tar.gz`\n+\n+  # Build dynamic versions of everything\n+  # (with static linking to boost and openssl as well a some non-OS deps)\n   mkdir -p distsrc\n   cd distsrc\n   tar --strip-components=1 -xf ../$DISTNAME\n-  ./configure --enable-upnp-default --prefix=$STAGING --bindir=$BINDIR --with-protoc-bindir=$STAGING/host/bin --with-boost=$STAGING --disable-maintainer-mode --disable-dependency-tracking PKG_CONFIG_PATH=\"$STAGING/lib/pkgconfig\" CPPFLAGS=\"-I$STAGING/include ${OPTFLAGS}\" LDFLAGS=\"-L$STAGING/lib ${OPTFLAGS}\" CXXFLAGS=\"-frandom-seed=bitcoin ${OPTFLAGS}\" BOOST_CHRONO_EXTRALIBS=\"-lrt\"\n+  do_configure --bindir=$BINDIR \n   make $MAKEOPTS\n   make $MAKEOPTS install-strip\n+  make $MAKEOPTS clean\n+\n+  # Build fully static versions of bitcoind and bitcoin-cli for older Linux distros\n+  STATIC_BINDIR=\"$HOME/bindir.static\"\n+  mkdir -p $STATIC_BINDIR\n+  # For 32-bit, -pie cannot be used with -static, as invalid executables are generated\n+  # For 64-bit, -pie with -static causes a link error\n+  # Disable hardening in configure and manually pass 'static-safe' hardening flags\n+  OPTFLAGS='-O2 -static -Wstack-protector -fstack-protector-all -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=2 -Wl,-z,relro -Wl,-z,now'\n+  do_configure --bindir=$STATIC_BINDIR --disable-tests --enable-upnp-default --without-gui --disable-hardening\n+  make $MAKEOPTS\n+  make $MAKEOPTS install-strip\n+  cp $STATIC_BINDIR/bitcoind $BINDIR/bitcoind.static\n+  cp $STATIC_BINDIR/bitcoin-cli $BINDIR/bitcoin-cli.static\n   \n   # sort distribution tar file and normalize user/group/mtime information for deterministic output\n   mkdir -p $OUTDIR/src"
      }
    ]
  }
]