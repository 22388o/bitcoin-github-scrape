ajtowns,2016-08-23T11:24:04Z,Build logs that failed (without the patch):\n\nhttps://buildd.debian.org/status/fetch.php?pkg=bitcoin&arch=mipsel&ver=0.13.0~rc3-0.1&stamp=1471929506\nhttps://buildd.debian.org/status/fetch.php?pkg=bitcoin&arch=mips&ver=0.13.0~rc3-0.1&stamp=1471898920\n\nSuccessful versions:\n\nhttps://buildd.debian.org/status/fetch.php?pkg=bitcoin&arch=mipsel&ver=0.13.0-0.1~exp1&stamp=1471946370\nhttps://buildd.d,https://github.com/bitcoin/bitcoin/pull/8563#issuecomment-241701690,241701690,
sipa,2016-08-26T17:18:55Z,Concept ACK\n,https://github.com/bitcoin/bitcoin/pull/8563#issuecomment-242796097,242796097,
luke-jr,2016-08-27T03:58:24Z,"Concept ACK, but I wonder if we should try to link with -latomic _first_, in case linking without it merely fails at runtime (or worse, works without providing the atomic guarantees).\n",https://github.com/bitcoin/bitcoin/pull/8563#issuecomment-242894095,242894095,
laanwj,2016-08-30T11:45:30Z,"Hm, you have a point @luke-jr but I also like the approach of trying `-latomic` only when necessary. This will make sure that no spurious library is linked that happens to be called 'atomic' on completely unrelated platforms/compilers, and that the configure log clearly states why a certain library is linked.\n\n> without it merely fails at runtime (or worse, works without providing the atomic gua",https://github.com/bitcoin/bitcoin/pull/8563#issuecomment-243413654,243413654,
laanwj,2016-08-30T11:45:59Z,utACK https://github.com/bitcoin/bitcoin/pull/8563/commits/878faacd7b3daac437cc689b13422f6432fb5cd0\n,https://github.com/bitcoin/bitcoin/pull/8563#issuecomment-243413753,243413753,
luke-jr,2016-08-31T01:46:30Z,"I agree, it would indeed be messed-up, but wasn't that almost exactly what happened in CVE-2012-1910?\n",https://github.com/bitcoin/bitcoin/pull/8563#issuecomment-243634953,243634953,
theuni,2016-08-31T03:24:26Z,"Assuming we're only doing link tests, is an AC_SEARCH_LIBS not enough here?\n",https://github.com/bitcoin/bitcoin/pull/8563#issuecomment-243647926,243647926,
laanwj,2016-08-31T14:02:26Z,"> I agree, it would indeed be messed-up, but wasn't that almost exactly what happened in CVE-2012-1910?\n\nIIRC there the problem was linking the wrong library, not forgetting to link a library.\n",https://github.com/bitcoin/bitcoin/pull/8563#issuecomment-243773962,243773962,
laanwj,2016-09-09T05:52:43Z,"> Assuming we're only doing link tests, is an AC_SEARCH_LIBS not enough here?\n\nI think the problem is that it is unspecified which symbols are exported. The requirement is that the atomic library is linked when c++11 atomics are used. How these relate to ELF-level symbols is probably an implementation detail that may change over time.\n",https://github.com/bitcoin/bitcoin/pull/8563#issuecomment-245825727,245825727,
luke-jr,2016-09-09T06:16:17Z,`main` is always exported ;)\n,https://github.com/bitcoin/bitcoin/pull/8563#issuecomment-245828624,245828624,
laanwj,2016-09-09T06:20:28Z,"I mean these symbols exported by atomic library:\n\n```\nlibbitcoin_server.a(libbitcoin_server_a-main.o): In function `std::__atomic_base<long long>::store(long long, std::memory_order)':\n/usr/include/c++/6/bits/atomic_base.h:374: undefined reference to `__atomic_store_8'\nlibbitcoin_server.a(libbitcoin_server_a-main.o): In function `std::__atomic_base<long long>::load(std::memory_order) const':\",https://github.com/bitcoin/bitcoin/pull/8563#issuecomment-245829186,245829186,
laanwj,2016-09-09T06:58:34Z,"ACK 878faac, reproduced with a `mipsel-unknown-linux-gnu` toolchain (gcc 5.3.0) built with crosstool-ng.\nWithout this patch it fails, with this patch it proceeds. Haven't tested the executable, but it's a clear step forward at least.\n",https://github.com/bitcoin/bitcoin/pull/8563#issuecomment-245835269,245835269,
luke-jr,2016-09-21T22:40:08Z,"Ugh, this m4 code is GPL licensed at best... checking with upstream if we can get MIT license on it.\n",https://github.com/bitcoin/bitcoin/pull/8563#issuecomment-248763436,248763436,
ajtowns,2016-09-22T05:16:42Z,Looks like @luke-jr was successful; https://svn.filezilla-project.org/filezilla/FileZilla3/trunk/m4/check_atomic.m4?r1=7216&r2=7788\n,https://github.com/bitcoin/bitcoin/pull/8563#issuecomment-248814858,248814858,
laanwj,2016-09-26T14:09:59Z,"This was backported in #8772, removing tag\n",https://github.com/bitcoin/bitcoin/pull/8563#issuecomment-249580115,249580115,
