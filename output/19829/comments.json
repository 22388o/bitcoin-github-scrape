[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/683152078",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#issuecomment-683152078",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19829",
    "id": 683152078,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MzE1MjA3OA==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-28T21:21:18Z",
    "updated_at": "2020-12-20T23:48:38Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20729 (p2p: standardize on outbound-{full, block}-relay connection type naming by jonatack)\n* #20724 (Cleanup of -debug=net log messages by ajtowns)\n* #20158 (tree-wide: De-globalize ChainstateManager by dongcarl)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/683152078/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/683264367",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#issuecomment-683264367",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19829",
    "id": 683264367,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MzI2NDM2Nw==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-29T09:27:33Z",
    "updated_at": "2020-08-29T09:27:33Z",
    "author_association": "MEMBER",
    "body": "Thanks for the review @ariard . I've addressed your comments.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/683264367/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/685811311",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#issuecomment-685811311",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19829",
    "id": 685811311,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4NTgxMTMxMQ==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-02T15:26:13Z",
    "updated_at": "2020-09-02T15:26:13Z",
    "author_association": "MEMBER",
    "body": "Rebased",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/685811311/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/685817072",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#issuecomment-685817072",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19829",
    "id": 685817072,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4NTgxNzA3Mg==",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-02T15:34:43Z",
    "updated_at": "2020-09-02T15:34:43Z",
    "author_association": "MEMBER",
    "body": "Concept ACK",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/685817072/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/686588115",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#issuecomment-686588115",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19829",
    "id": 686588115,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4NjU4ODExNQ==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-03T15:56:13Z",
    "updated_at": "2020-09-03T15:56:13Z",
    "author_association": "MEMBER",
    "body": "rebased",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/686588115/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/687563790",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#issuecomment-687563790",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19829",
    "id": 687563790,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4NzU2Mzc5MA==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-05T07:06:41Z",
    "updated_at": "2020-09-05T07:06:41Z",
    "author_association": "MEMBER",
    "body": "Concept ACK.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/687563790/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/687580549",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#issuecomment-687580549",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19829",
    "id": 687580549,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4NzU4MDU0OQ==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-05T09:42:42Z",
    "updated_at": "2020-09-05T09:42:42Z",
    "author_association": "MEMBER",
    "body": "Thanks for the review @hebasto . I've addressed both of your comments.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/687580549/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/688473718",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#issuecomment-688473718",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19829",
    "id": 688473718,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4ODQ3MzcxOA==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-07T18:51:40Z",
    "updated_at": "2020-09-07T18:51:40Z",
    "author_association": "MEMBER",
    "body": "rebased",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/688473718/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/689152626",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#issuecomment-689152626",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19829",
    "id": 689152626,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4OTE1MjYyNg==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-08T21:44:04Z",
    "updated_at": "2020-09-08T21:44:04Z",
    "author_association": "MEMBER",
    "body": "rebased",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/689152626/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/699903877",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#issuecomment-699903877",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19829",
    "id": 699903877,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5OTkwMzg3Nw==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-28T09:50:49Z",
    "updated_at": "2020-09-28T09:50:49Z",
    "author_association": "MEMBER",
    "body": "rebased",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/699903877/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/700652906",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#issuecomment-700652906",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19829",
    "id": 700652906,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMDY1MjkwNg==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-29T11:54:13Z",
    "updated_at": "2020-09-29T11:54:13Z",
    "author_association": "MEMBER",
    "body": "Thanks for the very thorough review, @jonatack. I've addressed all of your comments.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/700652906/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/702054221",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#issuecomment-702054221",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19829",
    "id": 702054221,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMjA1NDIyMQ==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-01T10:53:27Z",
    "updated_at": "2020-10-01T10:53:27Z",
    "author_association": "MEMBER",
    "body": "Thanks @jonatack . I fixed the bad rebase.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/702054221/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/702137666",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#issuecomment-702137666",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19829",
    "id": 702137666,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMjEzNzY2Ng==",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-01T13:32:39Z",
    "updated_at": "2020-10-01T13:32:39Z",
    "author_association": "MEMBER",
    "body": "commits f9136f4bf, 7199d81968, 8ff3e9319c11 and 40ea4a42d9\r\n```diff\r\nnet_processing.cpp: In function \u2018bool GetNodeStateStats(NodeId, CNodeStateStats&)\u2019:\r\nnet_processing.cpp:982/1000/1009: error: \u2018struct CNodeStateStats\u2019 has no member named \u2018nStartingHeight\u2019; did you mean \u2018m_starting_height\u2019?\r\n  982 |     stats.nStartingHeight = peer->nStartingHeight;\r\n      |           ^~~~~~~~~~~~~~~\r\n      |           m_starting_height\r\n```\r\n(we'll get there!)",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/702137666/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/702303723",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#issuecomment-702303723",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19829",
    "id": 702303723,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMjMwMzcyMw==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-01T18:01:47Z",
    "updated_at": "2020-10-01T18:01:47Z",
    "author_association": "MEMBER",
    "body": "Oops. Sorry Jon. Should be good now.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/702303723/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/711816616",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#issuecomment-711816616",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19829",
    "id": 711816616,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxMTgxNjYxNg==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-19T08:16:11Z",
    "updated_at": "2020-10-19T08:16:11Z",
    "author_association": "MEMBER",
    "body": "Rebased",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/711816616/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/730300986",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#issuecomment-730300986",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19829",
    "id": 730300986,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMDMwMDk4Ng==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-19T11:10:30Z",
    "updated_at": "2020-11-19T11:10:30Z",
    "author_association": "MEMBER",
    "body": "Rebased",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/730300986/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/741971580",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#issuecomment-741971580",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19829",
    "id": 741971580,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0MTk3MTU4MA==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-09T18:42:54Z",
    "updated_at": "2020-12-09T18:42:54Z",
    "author_association": "MEMBER",
    "body": "This is a slightly difficult rebase since the commits need to be structured a little differently to all build. Will work on it tomorrow.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/741971580/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/743125310",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#issuecomment-743125310",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19829",
    "id": 743125310,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0MzEyNTMxMA==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-11T10:54:55Z",
    "updated_at": "2020-12-11T10:54:55Z",
    "author_association": "MEMBER",
    "body": "I'm going to mark this as WIP for now. It'll be a lot easier to rebase after #20624 is merged.\r\n\r\nIf you want to help with #19398, please review #20624 first!",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/743125310/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/744398168",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#issuecomment-744398168",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19829",
    "id": 744398168,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0NDM5ODE2OA==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-14T12:09:04Z",
    "updated_at": "2020-12-14T12:09:04Z",
    "author_association": "MEMBER",
    "body": "Rebased. This is now ready for review.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/744398168/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/744413465",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#issuecomment-744413465",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19829",
    "id": 744413465,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0NDQxMzQ2NQ==",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-14T12:42:01Z",
    "updated_at": "2020-12-14T12:42:01Z",
    "author_association": "MEMBER",
    "body": "```\r\nRunning script for: fe391ca326f73337275d726f7de9db384ac35466\r\n\r\nsed -i 's/vBlockHashesToAnnounce/m_blocks_for_headers_relay/g' src/net_processing.cpp\r\n\r\nsed -i 's/vInventoryBlockToSend/m_blocks_for_inv_relay/g' src/net_processing.cpp\r\n\r\ndiff --git a/src/net_processing.h b/src/net_processing.h\r\n\r\nindex 1ad40982b..4998a1e04 100644\r\n\r\n--- a/src/net_processing.h\r\n\r\n+++ b/src/net_processing.h\r\n\r\n@@ -66,9 +66,9 @@ struct Peer {\r\n\r\n     /** List of block ids we still have announce.\r\n\r\n      * There is no final sorting before sending, as they are always sent\r\n\r\n      * immediately and in the order requested. */\r\n\r\n-    std::vector<uint256> m_blocks_for_inv_relay GUARDED_BY(m_block_inv_mutex);\r\n\r\n+    std::vector<uint256> vInventoryBlockToSend GUARDED_BY(m_block_inv_mutex);\r\n\r\n     /** List of headers to relay */\r\n\r\n-    std::vector<uint256> m_blocks_for_headers_relay GUARDED_BY(m_block_inv_mutex);\r\n\r\n+    std::vector<uint256> vBlockHashesToAnnounce GUARDED_BY(m_block_inv_mutex);\r\n\r\n \r\n\r\n     /** This peer's reported block height when we connected */\r\n\r\n     std::atomic<int> m_starting_height{-1};\r\n\r\nFailed",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/744413465/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/744414753",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#issuecomment-744414753",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19829",
    "id": 744414753,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0NDQxNDc1Mw==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-14T12:44:37Z",
    "updated_at": "2020-12-14T12:44:37Z",
    "author_association": "MEMBER",
    "body": "Thanks @MarcoFalke. Should be fixed now.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/744414753/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748272056",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#issuecomment-748272056",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19829",
    "id": 748272056,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0ODI3MjA1Ng==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-18T19:15:47Z",
    "updated_at": "2020-12-18T19:15:47Z",
    "author_association": "MEMBER",
    "body": "@hebasto @ariard @jonatack - this is now rebased with all comments addressed. Do you have time to rereview?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748272056/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748329137",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#issuecomment-748329137",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19829",
    "id": 748329137,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0ODMyOTEzNw==",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?u=7999a16349f0df0fb273fffa18e5a955c9d3f11c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-18T21:31:14Z",
    "updated_at": "2020-12-18T21:31:14Z",
    "author_association": "MEMBER",
    "body": "utACK b5b27ea052905ff7f26a962baa961fcc762c5ee0\r\n\r\nIs m_hash_continue protected by any locks? A \"this is only accessed by the singular net_processing thread\" rationale would be sufficient, but if there happens to be a lock that's held in all access locations, perhaps it's easy to add?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748329137/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748374852",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#issuecomment-748374852",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19829",
    "id": 748374852,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0ODM3NDg1Mg==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-18T23:42:13Z",
    "updated_at": "2020-12-18T23:42:13Z",
    "author_association": "MEMBER",
    "body": "> Is m_hash_continue protected by any locks? A \"this is only accessed by the singular net_processing thread\" rationale would be sufficient, but if there happens to be a lock that's held in all access locations, perhaps it's easy to add?\r\n\r\n@sipa could we just make it a std::atomic? It doesn't need to be synchronized with any other data, so as long as we're guaranteeing that reads/writes are atomic, I think that's enough?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748374852/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748375235",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#issuecomment-748375235",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19829",
    "id": 748375235,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0ODM3NTIzNQ==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-18T23:43:46Z",
    "updated_at": "2020-12-18T23:43:46Z",
    "author_association": "MEMBER",
    "body": "This has three code review ACKs, with just three minor comments outstanding. I think we can merge now and I can fix those outstanding comments in the next PR in the #19398 sequence. Also happy to fix them here if that's what others prefer.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748375235/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748460913",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#issuecomment-748460913",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19829",
    "id": 748460913,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0ODQ2MDkxMw==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-19T11:25:51Z",
    "updated_at": "2020-12-19T11:25:51Z",
    "author_association": "MEMBER",
    "body": "I've addressed @sdaftuar, @hebasto and @sipa suggestions in the first three commits of #20721.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748460913/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748482302",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#issuecomment-748482302",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19829",
    "id": 748482302,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0ODQ4MjMwMg==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-19T14:32:14Z",
    "updated_at": "2020-12-19T14:32:14Z",
    "author_association": "MEMBER",
    "body": "Thanks for the review @MarcoFalke . There are enough review comments here that it makes sense to address them in this PR instead of a follow-up. It also looks to me like this isn't entirely a clean merge, so I'm going to rebase on master.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748482302/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748487089",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#issuecomment-748487089",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19829",
    "id": 748487089,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0ODQ4NzA4OQ==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-19T15:16:21Z",
    "updated_at": "2020-12-19T15:16:21Z",
    "author_association": "MEMBER",
    "body": "Addressed all comments.\r\n\r\n> Is m_hash_continue protected by any locks? A \"this is only accessed by the singular net_processing thread\" rationale would be sufficient, but if there happens to be a lock that's held in all access locations, perhaps it's easy to add?\r\n\r\n@sipa I've added a commit to guard m_hash_continue with m_block_inv_mutex.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748487089/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748517082",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#issuecomment-748517082",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19829",
    "id": 748517082,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0ODUxNzA4Mg==",
    "user": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?u=5ff13e375b40ea55ecd3c108337dd6a23f68eddf&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-19T19:48:31Z",
    "updated_at": "2020-12-19T19:48:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "Concept ACK",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748517082/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748587747",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#issuecomment-748587747",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19829",
    "id": 748587747,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0ODU4Nzc0Nw==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-20T10:11:15Z",
    "updated_at": "2020-12-20T10:11:15Z",
    "author_association": "MEMBER",
    "body": "Thanks for the latest reviews @jonatack and @MarcoFalke. I've addressed/responded to all of your comments.\r\n\r\nI'd like to stabilize this PR now unless any functional issues are found. We have ACKs on the code change at various times from @MarcoFalke, @jonatack, @hebasto, @sipa and @Sjors. If there are any further style suggestions, I can address them in the next PR in this series.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748587747/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748601703",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#issuecomment-748601703",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19829",
    "id": 748601703,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0ODYwMTcwMw==",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-20T12:30:16Z",
    "updated_at": "2020-12-20T12:30:16Z",
    "author_association": "MEMBER",
    "body": "re-ACK 3002b4af2b4fde63026f8f7c575452a5c989c662 per `git diff 9aad3e4 3002b4a`",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748601703/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/749497914",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#issuecomment-749497914",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19829",
    "id": 749497914,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0OTQ5NzkxNA==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-22T11:37:42Z",
    "updated_at": "2020-12-22T11:37:42Z",
    "author_association": "MEMBER",
    "body": "Code review re-ACK 3002b4af2b4fde63026f8f7c575452a5c989c662",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/749497914/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479586353",
    "pull_request_review_id": 478083375,
    "id": 479586353,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU4NjM1Mw==",
    "diff_hunk": "@@ -488,6 +488,9 @@ struct Peer {\n     /** Whether this peer should be disconnected and marked as discouraged (unless it has the noban permission). */\n     bool m_should_discourage GUARDED_BY(m_misbehavior_mutex){false};\n \n+    /** Starting height of this peer */\n+    std::atomic<int> nStartingHeight{-1};",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "cc2c15fd73979e60e63526cc071c1fd025c3a7e3",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "\"Discovered at version message exchange. Used at tip update, to decide if our chain is fresh enough compared to peer's one to be worthy of headers announcement.\" ?",
    "created_at": "2020-08-29T00:49:49Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r479586353",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479586353"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r479586353"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479586353/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 492,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479588290",
    "pull_request_review_id": 478083375,
    "id": 479588290,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU4ODI5MA==",
    "diff_hunk": "@@ -928,9 +922,6 @@ class CNode\n     // m_tx_relay == nullptr if we're not relaying transactions with this peer\n     std::unique_ptr<TxRelay> m_tx_relay;\n \n-    // Used for headers announcements - unfiltered blocks to relay",
    "path": "src/net.h",
    "position": 35,
    "original_position": 17,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "3ee51652e93fc41c750713070200f98014d64bf3",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "What's the distinction you loose by dropping `unfiltered blocks to relay` ?\r\n\r\nI guess this is a reference to sort done at headers announcement, L4218 src/net_processing.cpp:\r\nhttps://github.com/bitcoin/bitcoin/blob/1cf73fb8eba3b89a30d5e943deaec5052a8b21b7/src/net_processing.cpp#L4218\r\n\r\nBefore to announce headers, we check both with regards to peer's context (\"Does this header connect to known peer's tip ?\") and our context (\"Does this header is part of best chain ?\"). It wasn't a clear comment, so yes either drop it or extend ?",
    "created_at": "2020-08-29T01:06:25Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r479588290",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479588290"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r479588290"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479588290/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1046,
    "original_line": 1046,
    "side": "LEFT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479590868",
    "pull_request_review_id": 478083375,
    "id": 479590868,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU5MDg2OA==",
    "diff_hunk": "@@ -488,6 +488,14 @@ struct Peer {\n     /** Whether this peer should be disconnected and marked as discouraged (unless it has the noban permission). */\n     bool m_should_discourage GUARDED_BY(m_misbehavior_mutex){false};\n \n+    /** Protects block inventory data members */\n+    RecursiveMutex m_block_inv_mutex;\n+    /** List of block ids we still have announce.\n+     * There is no final sorting before sending, as they are always sent\n+     * immediately and in the order requested. */\n+    std::vector<uint256> vInventoryBlockToSend GUARDED_BY(m_block_inv_mutex);\n+    /** List of headers to relay */",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 10,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "3ee51652e93fc41c750713070200f98014d64bf3",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "`vBlockHashesToAnnounce` is a list of block hashes not headers ? With regards to renaming follow-up commit, I would lean towards the most verbose option `m_blockids_for_inv_relay/m_blockids_for_headers_relay` to denotate that these vectors contain an identifier even if the endgoal is to relay the identifiee (either block or headers).",
    "created_at": "2020-08-29T01:30:53Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r479590868",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479590868"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r479590868"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479590868/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 455,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479628361",
    "pull_request_review_id": 478112685,
    "id": 479628361,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTYyODM2MQ==",
    "diff_hunk": "@@ -488,6 +488,9 @@ struct Peer {\n     /** Whether this peer should be disconnected and marked as discouraged (unless it has the noban permission). */\n     bool m_should_discourage GUARDED_BY(m_misbehavior_mutex){false};\n \n+    /** Starting height of this peer */\n+    std::atomic<int> nStartingHeight{-1};",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "cc2c15fd73979e60e63526cc071c1fd025c3a7e3",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "The comment doesn't need to document _everything_ that the variable is used for. That's what the code does.",
    "created_at": "2020-08-29T09:02:28Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r479628361",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479628361"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r479628361"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479628361/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 492,
    "side": "RIGHT",
    "in_reply_to_id": 479586353
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479629760",
    "pull_request_review_id": 478113517,
    "id": 479629760,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTYyOTc2MA==",
    "diff_hunk": "@@ -488,6 +488,14 @@ struct Peer {\n     /** Whether this peer should be disconnected and marked as discouraged (unless it has the noban permission). */\n     bool m_should_discourage GUARDED_BY(m_misbehavior_mutex){false};\n \n+    /** Protects block inventory data members */\n+    RecursiveMutex m_block_inv_mutex;\n+    /** List of block ids we still have announce.\n+     * There is no final sorting before sending, as they are always sent\n+     * immediately and in the order requested. */\n+    std::vector<uint256> vInventoryBlockToSend GUARDED_BY(m_block_inv_mutex);\n+    /** List of headers to relay */",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 10,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "3ee51652e93fc41c750713070200f98014d64bf3",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Ok, I'll update the comment to \"List of block ids to announce headers for\".\r\n\r\n> I would lean towards the most verbose option m_blockids_for_inv_relay/m_blockids_for_headers_relay\r\n\r\nSure. I'll update.",
    "created_at": "2020-08-29T09:19:00Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r479629760",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479629760"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r479629760"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479629760/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 455,
    "side": "RIGHT",
    "in_reply_to_id": 479590868
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479629856",
    "pull_request_review_id": 478113570,
    "id": 479629856,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTYyOTg1Ng==",
    "diff_hunk": "@@ -928,9 +922,6 @@ class CNode\n     // m_tx_relay == nullptr if we're not relaying transactions with this peer\n     std::unique_ptr<TxRelay> m_tx_relay;\n \n-    // Used for headers announcements - unfiltered blocks to relay",
    "path": "src/net.h",
    "position": 35,
    "original_position": 17,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "3ee51652e93fc41c750713070200f98014d64bf3",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think drop it.",
    "created_at": "2020-08-29T09:20:07Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r479629856",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479629856"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r479629856"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479629856/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1046,
    "original_line": 1046,
    "side": "LEFT",
    "in_reply_to_id": 479588290
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483928636",
    "pull_request_review_id": 483041519,
    "id": 483928636,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkyODYzNg==",
    "diff_hunk": "@@ -488,6 +488,14 @@ struct Peer {\n     /** Whether this peer should be disconnected and marked as discouraged (unless it has the noban permission). */\n     bool m_should_discourage GUARDED_BY(m_misbehavior_mutex){false};\n \n+    /** Protects block inventory data members */\n+    RecursiveMutex m_block_inv_mutex;",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "e04fb9a2df9f4d77c587bd25c608ce806c97ea45",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "e04fb9a2df9f4d77c587bd25c608ce806c97ea45\r\nCould using of `RecursiveMutex` type be avoided?\r\n(as there was `Mutex cs_inventory;`)",
    "created_at": "2020-09-05T08:46:00Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r483928636",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483928636"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r483928636"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483928636/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 492,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483929087",
    "pull_request_review_id": 483041519,
    "id": 483929087,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkyOTA4Nw==",
    "diff_hunk": "@@ -505,6 +505,24 @@ using PeerRef = std::shared_ptr<Peer>;\n Mutex g_peer_mutex;\n static std::map<NodeId, PeerRef> g_peer_map GUARDED_BY(g_peer_mutex);\n \n+/** Get a reference to each Peer, then call a function on each of them */\n+template<typename Callable>\n+void ForEachPeer(Callable&& func)\n+{\n+    std::vector<PeerRef> peer_copies;\n+    {\n+        LOCK(g_peer_mutex);\n+        peer_copies.reserve(g_peer_map.size());\n+        for (auto peer : g_peer_map) {\n+            peer_copies.push_back(peer.second);\n+        }\n+    }\n+\n+    for (auto&& peer : peer_copies) {\n+        func(peer);",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 18,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "575c5f55cc44348f0ebc7740c90013b96bdb8c27",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "575c5f55cc44348f0ebc7740c90013b96bdb8c27\r\nIt is good for concurrency to limit the lock scope. But is it safe to call `func` on potentially stale `peer_copies`?",
    "created_at": "2020-09-05T08:51:13Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r483929087",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483929087"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r483929087"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483929087/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 512,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 502,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483933383",
    "pull_request_review_id": 483044394,
    "id": 483933383,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzMzM4Mw==",
    "diff_hunk": "@@ -488,6 +488,14 @@ struct Peer {\n     /** Whether this peer should be disconnected and marked as discouraged (unless it has the noban permission). */\n     bool m_should_discourage GUARDED_BY(m_misbehavior_mutex){false};\n \n+    /** Protects block inventory data members */\n+    RecursiveMutex m_block_inv_mutex;",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "e04fb9a2df9f4d77c587bd25c608ce806c97ea45",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Good catch! `cs_inventory` was a RecursiveMutex when I opened this PR, and I missed the change when I rebased. Fixed.",
    "created_at": "2020-09-05T09:41:20Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r483933383",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483933383"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r483933383"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483933383/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 492,
    "side": "RIGHT",
    "in_reply_to_id": 483928636
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483933457",
    "pull_request_review_id": 483044446,
    "id": 483933457,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzMzQ1Nw==",
    "diff_hunk": "@@ -505,6 +505,24 @@ using PeerRef = std::shared_ptr<Peer>;\n Mutex g_peer_mutex;\n static std::map<NodeId, PeerRef> g_peer_map GUARDED_BY(g_peer_mutex);\n \n+/** Get a reference to each Peer, then call a function on each of them */\n+template<typename Callable>\n+void ForEachPeer(Callable&& func)\n+{\n+    std::vector<PeerRef> peer_copies;\n+    {\n+        LOCK(g_peer_mutex);\n+        peer_copies.reserve(g_peer_map.size());\n+        for (auto peer : g_peer_map) {\n+            peer_copies.push_back(peer.second);\n+        }\n+    }\n+\n+    for (auto&& peer : peer_copies) {\n+        func(peer);",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 18,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "575c5f55cc44348f0ebc7740c90013b96bdb8c27",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yes. `peer_copies` holds shared_ptr references, so the objects pointed to can't be destructed while it's in scope.",
    "created_at": "2020-09-05T09:42:16Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r483933457",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483933457"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r483933457"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483933457/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 512,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 502,
    "side": "RIGHT",
    "in_reply_to_id": 483929087
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483933970",
    "pull_request_review_id": 483044795,
    "id": 483933970,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzMzk3MA==",
    "diff_hunk": "@@ -488,6 +488,14 @@ struct Peer {\n     /** Whether this peer should be disconnected and marked as discouraged (unless it has the noban permission). */\n     bool m_should_discourage GUARDED_BY(m_misbehavior_mutex){false};\n \n+    /** Protects block inventory data members */\n+    RecursiveMutex m_block_inv_mutex;",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "e04fb9a2df9f4d77c587bd25c608ce806c97ea45",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "#19347 is yours, btw :)",
    "created_at": "2020-09-05T09:48:56Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r483933970",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483933970"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r483933970"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483933970/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 492,
    "side": "RIGHT",
    "in_reply_to_id": 483928636
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483934204",
    "pull_request_review_id": 483044925,
    "id": 483934204,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzNDIwNA==",
    "diff_hunk": "@@ -505,6 +505,24 @@ using PeerRef = std::shared_ptr<Peer>;\n Mutex g_peer_mutex;\n static std::map<NodeId, PeerRef> g_peer_map GUARDED_BY(g_peer_mutex);\n \n+/** Get a reference to each Peer, then call a function on each of them */\n+template<typename Callable>\n+void ForEachPeer(Callable&& func)\n+{\n+    std::vector<PeerRef> peer_copies;\n+    {\n+        LOCK(g_peer_mutex);\n+        peer_copies.reserve(g_peer_map.size());\n+        for (auto peer : g_peer_map) {\n+            peer_copies.push_back(peer.second);\n+        }\n+    }\n+\n+    for (auto&& peer : peer_copies) {\n+        func(peer);",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 18,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "575c5f55cc44348f0ebc7740c90013b96bdb8c27",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I mean not language safety rather client behavior safety: if another thread removes a `peer` from the `g_peer_map`, can we rely on result of `func(peer)`?",
    "created_at": "2020-09-05T09:51:52Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r483934204",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483934204"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r483934204"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483934204/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 512,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 502,
    "side": "RIGHT",
    "in_reply_to_id": 483929087
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483935273",
    "pull_request_review_id": 483045575,
    "id": 483935273,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzNTI3Mw==",
    "diff_hunk": "@@ -505,6 +505,24 @@ using PeerRef = std::shared_ptr<Peer>;\n Mutex g_peer_mutex;\n static std::map<NodeId, PeerRef> g_peer_map GUARDED_BY(g_peer_mutex);\n \n+/** Get a reference to each Peer, then call a function on each of them */\n+template<typename Callable>\n+void ForEachPeer(Callable&& func)\n+{\n+    std::vector<PeerRef> peer_copies;\n+    {\n+        LOCK(g_peer_mutex);\n+        peer_copies.reserve(g_peer_map.size());\n+        for (auto peer : g_peer_map) {\n+            peer_copies.push_back(peer.second);\n+        }\n+    }\n+\n+    for (auto&& peer : peer_copies) {\n+        func(peer);",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 18,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "575c5f55cc44348f0ebc7740c90013b96bdb8c27",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yes, because peer still exists in that case.",
    "created_at": "2020-09-05T10:05:20Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r483935273",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483935273"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r483935273"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483935273/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 512,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 502,
    "side": "RIGHT",
    "in_reply_to_id": 483929087
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483935288",
    "pull_request_review_id": 483045586,
    "id": 483935288,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzNTI4OA==",
    "diff_hunk": "@@ -488,6 +488,14 @@ struct Peer {\n     /** Whether this peer should be disconnected and marked as discouraged (unless it has the noban permission). */\n     bool m_should_discourage GUARDED_BY(m_misbehavior_mutex){false};\n \n+    /** Protects block inventory data members */\n+    RecursiveMutex m_block_inv_mutex;",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "e04fb9a2df9f4d77c587bd25c608ce806c97ea45",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": ":flushed: ",
    "created_at": "2020-09-05T10:05:39Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r483935288",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483935288"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r483935288"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483935288/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 492,
    "side": "RIGHT",
    "in_reply_to_id": 483928636
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495931907",
    "pull_request_review_id": 497502164,
    "id": 495931907,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTkzMTkwNw==",
    "diff_hunk": "@@ -1542,6 +1582,7 @@ static void RelayAddress(const CAddress& addr, bool fReachable, const CConnman&\n \n void static ProcessGetBlockData(CNode& pfrom, const CChainParams& chainparams, const CInv& inv, CConnman& connman)\n {\n+    PeerRef peer = GetPeerRef(pfrom.GetId());",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 88,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "8d3a0684ba749c35161b121da442e07e5ba594a4",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In 8d3a068 I suppose this is placed at the top of the function, instead of where it is used 150 lines below, as you plan to add more uses of it to this function.",
    "created_at": "2020-09-28T13:18:52Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r495931907",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495931907"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r495931907"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495931907/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1530,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495978760",
    "pull_request_review_id": 497502164,
    "id": 495978760,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTk3ODc2MA==",
    "diff_hunk": "@@ -913,6 +948,10 @@ void PeerManager::FinalizeNode(NodeId nodeid, bool& fUpdateConnectionTime) {\n     LOCK(cs_main);\n     int misbehavior{0};\n     {\n+        // We remove the Peer object from g_peer_map here, but it's not guaranteed that\n+        // we'll destruct Peer here since another thread could potentially still hold\n+        // a reference to the object. Be careful not to do any processing here that\n+        // assumes Peer won't be changed before it's destructed.\n         PeerRef peer = GetPeerRef(nodeid);\n         assert(peer != nullptr);",
    "path": "src/net_processing.cpp",
    "position": 10,
    "original_position": 58,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "8d3a0684ba749c35161b121da442e07e5ba594a4",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit 85e7deb, perhaps go a bit further in the added comment to clarify that the refcount is often > 1 here.\r\n\r\nIn my testing, adding `assert(peer.use_count() <= 1);` after this line as suggested in https://github.com/bitcoin/bitcoin/pull/19607#discussion_r470173964 causes bitcoind on mainnet to halt nearly immediately after net processing begins and 1-2 peers start to connect.",
    "created_at": "2020-09-28T14:23:45Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r495978760",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495978760"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r495978760"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495978760/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 800,
    "original_line": 800,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496054882",
    "pull_request_review_id": 497502164,
    "id": 496054882,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA1NDg4Mg==",
    "diff_hunk": "@@ -502,6 +519,24 @@ using PeerRef = std::shared_ptr<Peer>;\n Mutex g_peer_mutex;\n static std::map<NodeId, PeerRef> g_peer_map GUARDED_BY(g_peer_mutex);\n \n+/** Get a reference to each Peer, then call a function on each of them */\n+template<typename Callable>\n+void ForEachPeer(Callable&& func)",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 30,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "8d3a0684ba749c35161b121da442e07e5ba594a4",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "cff5d286 What are your plans with respect to this function `ForEachPeer()` in your roadmap...end game interface, or more of an intermediary step?",
    "created_at": "2020-09-28T15:49:03Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496054882",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496054882"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496054882"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496054882/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 490,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496056128",
    "pull_request_review_id": 497502164,
    "id": 496056128,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA1NjEyOA==",
    "diff_hunk": "@@ -1148,6 +1147,8 @@ void RPCConsole::updateNodeDetail(const CNodeCombinedStats *stats)\n             ui->peerCommonHeight->setText(QString(\"%1\").arg(stats->nodeStateStats.nCommonHeight));\n         else\n             ui->peerCommonHeight->setText(tr(\"Unknown\"));\n+\n+        ui->peerHeight->setText(QString::number(stats->nodeStateStats.m_starting_height));",
    "path": "src/qt/rpcconsole.cpp",
    "position": 13,
    "original_position": 13,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "8d3a0684ba749c35161b121da442e07e5ba594a4",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "9b14eb372 verified manually that this displays as before, as there is no GUI test coverage. Unfortunately, it is broken at this commit and returns only the initial value of `-1` until 3 commits later at f27a1e221d.",
    "created_at": "2020-09-28T15:50:47Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496056128",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496056128"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496056128"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496056128/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1138,
    "original_line": 1138,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496058069",
    "pull_request_review_id": 497502164,
    "id": 496058069,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA1ODA2OQ==",
    "diff_hunk": "@@ -202,14 +202,14 @@ static RPCHelpMan getpeerinfo()\n             // addnode is deprecated in v0.21 for removal in v0.22\n             obj.pushKV(\"addnode\", stats.m_manual_connection);\n         }\n-        obj.pushKV(\"startingheight\", stats.nStartingHeight);\n         if (fStateStats) {\n             if (IsDeprecatedRPCEnabled(\"banscore\")) {\n                 // banscore is deprecated in v0.21 for removal in v0.22\n                 obj.pushKV(\"banscore\", statestats.m_misbehavior_score);\n             }\n             obj.pushKV(\"synced_headers\", statestats.nSyncHeight);\n             obj.pushKV(\"synced_blocks\", statestats.nCommonHeight);\n+            obj.pushKV(\"startingheight\", statestats.m_starting_height);",
    "path": "src/rpc/net.cpp",
    "position": null,
    "original_position": 12,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "8d3a0684ba749c35161b121da442e07e5ba594a4",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "9b14eb37 verified this functions as before per `./src/bitcoin-cli getpeerinfo | grep 'startingheight' | sort`, as there appear to be no functional tests for `getpeerinfo#startingheight`. As above, it is broken at this commit and returns only the initial value of `-1`. Functionality returns 3 commits later at f27a1e221d.",
    "created_at": "2020-09-28T15:53:27Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496058069",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496058069"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496058069"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496058069/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 234,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496068251",
    "pull_request_review_id": 497502164,
    "id": 496068251,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA2ODI1MQ==",
    "diff_hunk": "@@ -488,6 +488,23 @@ struct Peer {\n     /** Whether this peer should be disconnected and marked as discouraged (unless it has the noban permission). */\n     bool m_should_discourage GUARDED_BY(m_misbehavior_mutex){false};\n \n+    /** Protects block inventory data members */\n+    Mutex m_block_inv_mutex;\n+    /** List of block ids we still have announce.\n+     * There is no final sorting before sending, as they are always sent\n+     * immediately and in the order requested. */\n+    std::vector<uint256> m_blocks_for_inv_relay GUARDED_BY(m_block_inv_mutex);\n+    /** List of headers to relay */\n+    std::vector<uint256> m_blocks_for_headers_relay GUARDED_BY(m_block_inv_mutex);\n+\n+    /** Starting height of this peer */\n+    std::atomic<int> m_starting_height{-1};",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 14,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "8d3a0684ba749c35161b121da442e07e5ba594a4",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "9b14eb372 `m_starting_height` presumably still needs to be `std::atomic_int`? \r\n\r\nIf you retouch, perhaps `s/height/block height/` for the Doxygen doc.",
    "created_at": "2020-09-28T16:09:02Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496068251",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496068251"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496068251"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496068251/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 459,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496071488",
    "pull_request_review_id": 497502164,
    "id": 496071488,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA3MTQ4OA==",
    "diff_hunk": "@@ -2334,6 +2375,7 @@ void PeerManager::ProcessMessage(CNode& pfrom, const std::string& msg_type, CDat\n         return;\n     }\n \n+    PeerRef peer = GetPeerRef(pfrom.GetId());",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 124,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "8d3a0684ba749c35161b121da442e07e5ba594a4",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In general, is there a plan to eventually no longer need to set `PeerRef peer = GetPeerRef(...)` in many net processing methods? ",
    "created_at": "2020-09-28T16:14:03Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496071488",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496071488"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496071488"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496071488/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2281,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496080304",
    "pull_request_review_id": 497502164,
    "id": 496080304,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA4MDMwNA==",
    "diff_hunk": "@@ -4196,7 +4239,7 @@ bool PeerManager::SendMessages(CNode* pto)\n                 // Try to find first header that our peer doesn't have, and\n                 // then send all headers past that one.  If we come across any\n                 // headers that aren't on ::ChainActive(), give up.\n-                for (const uint256 &hash : pto->vBlockHashesToAnnounce) {\n+                for (const uint256 &hash : peer->m_blocks_for_headers_relay) {",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 226,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "8d3a0684ba749c35161b121da442e07e5ba594a4",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "f27a1e221 nit, while touching this and lines 4334 and 4366 (3 places), if so inclined\r\n```suggestion\r\n                for (const uint256& hash : peer->m_blocks_for_headers_relay) {\r\n```",
    "created_at": "2020-09-28T16:27:33Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496080304",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496080304"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496080304"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496080304/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4242,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496082768",
    "pull_request_review_id": 497502164,
    "id": 496082768,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA4Mjc2OA==",
    "diff_hunk": "@@ -940,8 +940,6 @@ class CNode\n     mapMsgCmdSize mapRecvBytesPerMsgCmd GUARDED_BY(cs_vRecv);\n \n public:\n-    uint256 hashContinue;\n-    std::atomic<int> nStartingHeight{-1};\n ",
    "path": "src/net.h",
    "position": null,
    "original_position": 15,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "8d3a0684ba749c35161b121da442e07e5ba594a4",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "8d3a068 nit, remove extra line created by this deletion",
    "created_at": "2020-09-28T16:31:28Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496082768",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496082768"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496082768"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496082768/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1000,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496083616",
    "pull_request_review_id": 497502164,
    "id": 496083616,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA4MzYxNg==",
    "diff_hunk": "@@ -488,6 +488,23 @@ struct Peer {\n     /** Whether this peer should be disconnected and marked as discouraged (unless it has the noban permission). */\n     bool m_should_discourage GUARDED_BY(m_misbehavior_mutex){false};\n \n+    /** Protects block inventory data members */\n+    Mutex m_block_inv_mutex;\n+    /** List of block ids we still have announce.\n+     * There is no final sorting before sending, as they are always sent\n+     * immediately and in the order requested. */\n+    std::vector<uint256> m_blocks_for_inv_relay GUARDED_BY(m_block_inv_mutex);\n+    /** List of headers to relay */\n+    std::vector<uint256> m_blocks_for_headers_relay GUARDED_BY(m_block_inv_mutex);\n+\n+    /** Starting height of this peer */\n+    std::atomic<int> m_starting_height{-1};\n+    /** The final block hash in a INV message. When the peer requests this",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 15,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "8d3a0684ba749c35161b121da442e07e5ba594a4",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "8d3a068 pico-nits, `s/a INV/an INV/` and `s/them/it|the peer/`",
    "created_at": "2020-09-28T16:32:58Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496083616",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496083616"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496083616"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496083616/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 502,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496090875",
    "pull_request_review_id": 497502164,
    "id": 496090875,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA5MDg3NQ==",
    "diff_hunk": "@@ -1399,11 +1439,11 @@ void PeerManager::UpdatedBlockTip(const CBlockIndex *pindexNew, const CBlockInde\n             }\n         }\n         // Relay inventory, but don't relay old inventory during initial block download.\n-        m_connman.ForEachNode([nNewHeight, &vHashes](CNode* pnode) {\n-            LOCK(pnode->cs_inventory);\n-            if (nNewHeight > (pnode->nStartingHeight != -1 ? pnode->nStartingHeight - 2000 : 0)) {\n+        ForEachPeer([nNewHeight, &vHashes](const PeerRef& peer) {\n+            LOCK(peer->m_block_inv_mutex);",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 76,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "8d3a0684ba749c35161b121da442e07e5ba594a4",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In 9b14eb37 is it safe to remove `LOCK(pnode->cs_inventory);` this early? Another lock doesn't replace it until 3 commits later in f27a1e22.",
    "created_at": "2020-09-28T16:44:55Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496090875",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496090875"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496090875"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496090875/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1387,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496578664",
    "pull_request_review_id": 498287785,
    "id": 496578664,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjU3ODY2NA==",
    "diff_hunk": "@@ -1542,6 +1582,7 @@ static void RelayAddress(const CAddress& addr, bool fReachable, const CConnman&\n \n void static ProcessGetBlockData(CNode& pfrom, const CChainParams& chainparams, const CInv& inv, CConnman& connman)\n {\n+    PeerRef peer = GetPeerRef(pfrom.GetId());",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 88,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "8d3a0684ba749c35161b121da442e07e5ba594a4",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Correct. Future commits will use `peer` throughout the function, and there's no downside to holding on to the object for a bit longer.",
    "created_at": "2020-09-29T09:35:59Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496578664",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496578664"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496578664"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496578664/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1530,
    "side": "RIGHT",
    "in_reply_to_id": 495931907
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496581548",
    "pull_request_review_id": 498291388,
    "id": 496581548,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjU4MTU0OA==",
    "diff_hunk": "@@ -913,6 +948,10 @@ void PeerManager::FinalizeNode(NodeId nodeid, bool& fUpdateConnectionTime) {\n     LOCK(cs_main);\n     int misbehavior{0};\n     {\n+        // We remove the Peer object from g_peer_map here, but it's not guaranteed that\n+        // we'll destruct Peer here since another thread could potentially still hold\n+        // a reference to the object. Be careful not to do any processing here that\n+        // assumes Peer won't be changed before it's destructed.\n         PeerRef peer = GetPeerRef(nodeid);\n         assert(peer != nullptr);",
    "path": "src/net_processing.cpp",
    "position": 10,
    "original_position": 58,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "8d3a0684ba749c35161b121da442e07e5ba594a4",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done",
    "created_at": "2020-09-29T09:40:26Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496581548",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496581548"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496581548"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496581548/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 800,
    "original_line": 800,
    "side": "RIGHT",
    "in_reply_to_id": 495978760
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496582845",
    "pull_request_review_id": 498292946,
    "id": 496582845,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjU4Mjg0NQ==",
    "diff_hunk": "@@ -2334,6 +2375,7 @@ void PeerManager::ProcessMessage(CNode& pfrom, const std::string& msg_type, CDat\n         return;\n     }\n \n+    PeerRef peer = GetPeerRef(pfrom.GetId());",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 124,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "8d3a0684ba749c35161b121da442e07e5ba594a4",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yes, potentially we could just pass a `Peer&` to many of the private functions (just as `CNodeState*` is passed to some of the functions now).",
    "created_at": "2020-09-29T09:42:29Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496582845",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496582845"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496582845"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496582845/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2281,
    "side": "RIGHT",
    "in_reply_to_id": 496071488
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496647277",
    "pull_request_review_id": 498376974,
    "id": 496647277,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY0NzI3Nw==",
    "diff_hunk": "@@ -940,8 +940,6 @@ class CNode\n     mapMsgCmdSize mapRecvBytesPerMsgCmd GUARDED_BY(cs_vRecv);\n \n public:\n-    uint256 hashContinue;\n-    std::atomic<int> nStartingHeight{-1};\n ",
    "path": "src/net.h",
    "position": null,
    "original_position": 15,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "8d3a0684ba749c35161b121da442e07e5ba594a4",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "done",
    "created_at": "2020-09-29T11:38:21Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496647277",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496647277"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496647277"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496647277/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1000,
    "side": "RIGHT",
    "in_reply_to_id": 496082768
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496647768",
    "pull_request_review_id": 498377624,
    "id": 496647768,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY0Nzc2OA==",
    "diff_hunk": "@@ -502,6 +519,24 @@ using PeerRef = std::shared_ptr<Peer>;\n Mutex g_peer_mutex;\n static std::map<NodeId, PeerRef> g_peer_map GUARDED_BY(g_peer_mutex);\n \n+/** Get a reference to each Peer, then call a function on each of them */\n+template<typename Callable>\n+void ForEachPeer(Callable&& func)",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 30,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "8d3a0684ba749c35161b121da442e07e5ba594a4",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I don't have a strong opinion. I've done it this way here to minimize the difference in logic, but if people want to change the internal implementation later, I'm fine with that.",
    "created_at": "2020-09-29T11:39:17Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496647768",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496647768"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496647768"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496647768/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 490,
    "side": "RIGHT",
    "in_reply_to_id": 496054882
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496647935",
    "pull_request_review_id": 498377856,
    "id": 496647935,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY0NzkzNQ==",
    "diff_hunk": "@@ -1148,6 +1147,8 @@ void RPCConsole::updateNodeDetail(const CNodeCombinedStats *stats)\n             ui->peerCommonHeight->setText(QString(\"%1\").arg(stats->nodeStateStats.nCommonHeight));\n         else\n             ui->peerCommonHeight->setText(tr(\"Unknown\"));\n+\n+        ui->peerHeight->setText(QString::number(stats->nodeStateStats.m_starting_height));",
    "path": "src/qt/rpcconsole.cpp",
    "position": 13,
    "original_position": 13,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "8d3a0684ba749c35161b121da442e07e5ba594a4",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Oops. I think this was a bad rebase. Should be fixed now.",
    "created_at": "2020-09-29T11:39:36Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496647935",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496647935"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496647935"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496647935/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1138,
    "original_line": 1138,
    "side": "RIGHT",
    "in_reply_to_id": 496056128
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496648070",
    "pull_request_review_id": 498378020,
    "id": 496648070,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY0ODA3MA==",
    "diff_hunk": "@@ -202,14 +202,14 @@ static RPCHelpMan getpeerinfo()\n             // addnode is deprecated in v0.21 for removal in v0.22\n             obj.pushKV(\"addnode\", stats.m_manual_connection);\n         }\n-        obj.pushKV(\"startingheight\", stats.nStartingHeight);\n         if (fStateStats) {\n             if (IsDeprecatedRPCEnabled(\"banscore\")) {\n                 // banscore is deprecated in v0.21 for removal in v0.22\n                 obj.pushKV(\"banscore\", statestats.m_misbehavior_score);\n             }\n             obj.pushKV(\"synced_headers\", statestats.nSyncHeight);\n             obj.pushKV(\"synced_blocks\", statestats.nCommonHeight);\n+            obj.pushKV(\"startingheight\", statestats.m_starting_height);",
    "path": "src/rpc/net.cpp",
    "position": null,
    "original_position": 12,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "8d3a0684ba749c35161b121da442e07e5ba594a4",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "As above, should now be fixed.",
    "created_at": "2020-09-29T11:39:49Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496648070",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496648070"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496648070"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496648070/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 234,
    "side": "RIGHT",
    "in_reply_to_id": 496058069
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496649424",
    "pull_request_review_id": 498379591,
    "id": 496649424,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY0OTQyNA==",
    "diff_hunk": "@@ -488,6 +488,23 @@ struct Peer {\n     /** Whether this peer should be disconnected and marked as discouraged (unless it has the noban permission). */\n     bool m_should_discourage GUARDED_BY(m_misbehavior_mutex){false};\n \n+    /** Protects block inventory data members */\n+    Mutex m_block_inv_mutex;\n+    /** List of block ids we still have announce.\n+     * There is no final sorting before sending, as they are always sent\n+     * immediately and in the order requested. */\n+    std::vector<uint256> m_blocks_for_inv_relay GUARDED_BY(m_block_inv_mutex);\n+    /** List of headers to relay */\n+    std::vector<uint256> m_blocks_for_headers_relay GUARDED_BY(m_block_inv_mutex);\n+\n+    /** Starting height of this peer */\n+    std::atomic<int> m_starting_height{-1};",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 14,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "8d3a0684ba749c35161b121da442e07e5ba594a4",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> m_starting_height presumably still needs to be std::atomic_int?\r\n\r\nI don't understand. It's a `std::atomic<int>` before and after this PR.\r\n\r\n> If you retouch, perhaps s/height/block height/ for the Doxygen doc.\r\n\r\nI've updated the Doxygen comment to be clearer.",
    "created_at": "2020-09-29T11:42:04Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496649424",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496649424"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496649424"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496649424/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 459,
    "side": "RIGHT",
    "in_reply_to_id": 496068251
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496652482",
    "pull_request_review_id": 498383510,
    "id": 496652482,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY1MjQ4Mg==",
    "diff_hunk": "@@ -4196,7 +4239,7 @@ bool PeerManager::SendMessages(CNode* pto)\n                 // Try to find first header that our peer doesn't have, and\n                 // then send all headers past that one.  If we come across any\n                 // headers that aren't on ::ChainActive(), give up.\n-                for (const uint256 &hash : pto->vBlockHashesToAnnounce) {\n+                for (const uint256 &hash : peer->m_blocks_for_headers_relay) {",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 226,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "8d3a0684ba749c35161b121da442e07e5ba594a4",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "done",
    "created_at": "2020-09-29T11:47:52Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496652482",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496652482"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496652482"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496652482/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4242,
    "side": "RIGHT",
    "in_reply_to_id": 496080304
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496653268",
    "pull_request_review_id": 498384511,
    "id": 496653268,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY1MzI2OA==",
    "diff_hunk": "@@ -488,6 +488,23 @@ struct Peer {\n     /** Whether this peer should be disconnected and marked as discouraged (unless it has the noban permission). */\n     bool m_should_discourage GUARDED_BY(m_misbehavior_mutex){false};\n \n+    /** Protects block inventory data members */\n+    Mutex m_block_inv_mutex;\n+    /** List of block ids we still have announce.\n+     * There is no final sorting before sending, as they are always sent\n+     * immediately and in the order requested. */\n+    std::vector<uint256> m_blocks_for_inv_relay GUARDED_BY(m_block_inv_mutex);\n+    /** List of headers to relay */\n+    std::vector<uint256> m_blocks_for_headers_relay GUARDED_BY(m_block_inv_mutex);\n+\n+    /** Starting height of this peer */\n+    std::atomic<int> m_starting_height{-1};\n+    /** The final block hash in a INV message. When the peer requests this",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 15,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "8d3a0684ba749c35161b121da442e07e5ba594a4",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "fixed",
    "created_at": "2020-09-29T11:49:25Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496653268",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496653268"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496653268"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496653268/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 502,
    "side": "RIGHT",
    "in_reply_to_id": 496083616
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496653399",
    "pull_request_review_id": 498384642,
    "id": 496653399,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY1MzM5OQ==",
    "diff_hunk": "@@ -1399,11 +1439,11 @@ void PeerManager::UpdatedBlockTip(const CBlockIndex *pindexNew, const CBlockInde\n             }\n         }\n         // Relay inventory, but don't relay old inventory during initial block download.\n-        m_connman.ForEachNode([nNewHeight, &vHashes](CNode* pnode) {\n-            LOCK(pnode->cs_inventory);\n-            if (nNewHeight > (pnode->nStartingHeight != -1 ? pnode->nStartingHeight - 2000 : 0)) {\n+        ForEachPeer([nNewHeight, &vHashes](const PeerRef& peer) {\n+            LOCK(peer->m_block_inv_mutex);",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 76,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "8d3a0684ba749c35161b121da442e07e5ba594a4",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Oops. Bad rebase. Should be fixed now.",
    "created_at": "2020-09-29T11:49:38Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496653399",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496653399"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r496653399"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496653399/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1387,
    "side": "RIGHT",
    "in_reply_to_id": 496090875
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498128377",
    "pull_request_review_id": 500193857,
    "id": 498128377,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODEyODM3Nw==",
    "diff_hunk": "@@ -971,6 +1011,7 @@ bool GetNodeStateStats(NodeId nodeid, CNodeStateStats &stats) {\n     PeerRef peer = GetPeerRef(nodeid);\n     if (peer == nullptr) return false;\n     stats.m_misbehavior_score = WITH_LOCK(peer->m_misbehavior_mutex, return peer->m_misbehavior_score);\n+    stats.m_starting_height = peer->m_starting_height;",
    "path": "src/net_processing.cpp",
    "position": 16,
    "original_position": 65,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "1a9e1911673e2e643e9ad9b6ff412ce34e7af72f",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "0a9839058c\r\n```bash\r\nnet_processing.cpp: In function \u2018bool GetNodeStateStats(NodeId, CNodeStateStats&)\u2019:\r\nnet_processing.cpp:982:11: error: \u2018struct CNodeStateStats\u2019 has no member named \u2018m_starting_height\u2019; did you mean \u2018nStartingHeight\u2019?\r\n  982 |     stats.m_starting_height = peer->m_starting_height;\r\n      |           ^~~~~~~~~~~~~~~~~\r\n      |           nStartingHeight\r\n```",
    "created_at": "2020-10-01T10:03:17Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r498128377",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498128377"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r498128377"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498128377/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 878,
    "original_line": 878,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498154958",
    "pull_request_review_id": 500228247,
    "id": 498154958,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODE1NDk1OA==",
    "diff_hunk": "@@ -971,6 +1011,7 @@ bool GetNodeStateStats(NodeId nodeid, CNodeStateStats &stats) {\n     PeerRef peer = GetPeerRef(nodeid);\n     if (peer == nullptr) return false;\n     stats.m_misbehavior_score = WITH_LOCK(peer->m_misbehavior_mutex, return peer->m_misbehavior_score);\n+    stats.m_starting_height = peer->m_starting_height;",
    "path": "src/net_processing.cpp",
    "position": 16,
    "original_position": 65,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "1a9e1911673e2e643e9ad9b6ff412ce34e7af72f",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "fixed",
    "created_at": "2020-10-01T10:53:12Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r498154958",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498154958"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r498154958"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498154958/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 878,
    "original_line": 878,
    "side": "RIGHT",
    "in_reply_to_id": 498128377
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/543272216",
    "pull_request_review_id": 552365804,
    "id": 543272216,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI3MjIxNg==",
    "diff_hunk": "@@ -1315,13 +1315,17 @@ void PeerManager::UpdatedBlockTip(const CBlockIndex *pindexNew, const CBlockInde\n         }\n     }\n \n-    // Relay to all peers\n-    m_connman.ForEachNode([&vHashes](CNode* pnode) {\n-        LOCK(pnode->cs_inventory);\n-        for (const uint256& hash : reverse_iterate(vHashes)) {\n-            pnode->vBlockHashesToAnnounce.push_back(hash);\n+    {\n+        LOCK(m_peer_mutex);\n+        for (auto& it : m_peer_map) {",
    "path": "src/net_processing.cpp",
    "position": 31,
    "original_position": 11,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "a50dee50fd2aee93b41bfb3b04b24939d0c2f6c1",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "a50dee50fd2aee93b41bfb3b04b24939d0c2f6c1 : `ForEachNode` performs an additional check `NodeFullyConnected` (`pnode->fSuccessfullyConnected && !pnode->fDisconnect;`).\r\n\r\nNot sure if that matters much here. Could we prematurely send headers before `VERACK`?",
    "created_at": "2020-12-15T11:41:32Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r543272216",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/543272216"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r543272216"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/543272216/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1320,
    "original_line": 1320,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/543710801",
    "pull_request_review_id": 552937445,
    "id": 543710801,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzcxMDgwMQ==",
    "diff_hunk": "@@ -1315,13 +1315,17 @@ void PeerManager::UpdatedBlockTip(const CBlockIndex *pindexNew, const CBlockInde\n         }\n     }\n \n-    // Relay to all peers\n-    m_connman.ForEachNode([&vHashes](CNode* pnode) {\n-        LOCK(pnode->cs_inventory);\n-        for (const uint256& hash : reverse_iterate(vHashes)) {\n-            pnode->vBlockHashesToAnnounce.push_back(hash);\n+    {\n+        LOCK(m_peer_mutex);\n+        for (auto& it : m_peer_map) {",
    "path": "src/net_processing.cpp",
    "position": 31,
    "original_position": 11,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "a50dee50fd2aee93b41bfb3b04b24939d0c2f6c1",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This is an excellent observation. Block hashes could be pushed into `m_blocks_for_headers_relay` before the version/verack handshake is complete. However, we'll never send any blocks inventory before we're fully connected due to the guard clause at the top of SendMessages():\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/c434e2cca9181ce184efef946ab2ce62f2cd2ee7/src/net_processing.cpp#L4077-L4078\r\n\r\nI think this behaviour is ok. The version-verack handshake usually lasts no more than a second or two, and at the worst case times out after a minute, so we're never going to push many block hashes onto this vector.",
    "created_at": "2020-12-15T21:48:58Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r543710801",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/543710801"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r543710801"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/543710801/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1320,
    "original_line": 1320,
    "side": "RIGHT",
    "in_reply_to_id": 543272216
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546087558",
    "pull_request_review_id": 555809738,
    "id": 546087558,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjA4NzU1OA==",
    "diff_hunk": "@@ -224,14 +224,14 @@ static RPCHelpMan getpeerinfo()\n             // addnode is deprecated in v0.21 for removal in v0.22\n             obj.pushKV(\"addnode\", stats.m_manual_connection);\n         }\n-        obj.pushKV(\"startingheight\", stats.nStartingHeight);\n         if (fStateStats) {\n             if (IsDeprecatedRPCEnabled(\"banscore\")) {\n                 // banscore is deprecated in v0.21 for removal in v0.22\n                 obj.pushKV(\"banscore\", statestats.m_misbehavior_score);\n             }\n             obj.pushKV(\"synced_headers\", statestats.nSyncHeight);\n             obj.pushKV(\"synced_blocks\", statestats.nCommonHeight);\n+            obj.pushKV(\"startingheight\", statestats.nStartingHeight);",
    "path": "src/rpc/net.cpp",
    "position": null,
    "original_position": 12,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "4ac61d85f1624b1cd7af4a85c8bca0bd430801f0",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "4ac61d85f1624b1cd7af4a85c8bca0bd430801f0\r\nPosition of `\"startingheight\"` in `RPCHelpMan` should be changed accordingly.",
    "created_at": "2020-12-18T20:58:34Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546087558",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546087558"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546087558"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546087558/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 234,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546095735",
    "pull_request_review_id": 555809738,
    "id": 546095735,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjA5NTczNQ==",
    "diff_hunk": "@@ -61,6 +61,15 @@ struct Peer {\n     /** Whether this peer should be disconnected and marked as discouraged (unless it has the noban permission). */\n     bool m_should_discourage GUARDED_BY(m_misbehavior_mutex){false};\n \n+    /** Protects block inventory data members */\n+    Mutex m_block_inv_mutex;\n+    /** List of block ids we still have announce.",
    "path": "src/net_processing.h",
    "position": null,
    "original_position": 6,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "a50dee50fd2aee93b41bfb3b04b24939d0c2f6c1",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "a50dee50fd2aee93b41bfb3b04b24939d0c2f6c1\r\n\r\nI understand that comment text has been preserved, but maybe\r\n```suggestion\r\n    /** List of block ids we still have to announce.\r\n```\r\n?",
    "created_at": "2020-12-18T21:19:18Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546095735",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546095735"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546095735"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546095735/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 66,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546116786",
    "pull_request_review_id": 480949559,
    "id": 546116786,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjExNjc4Ng==",
    "diff_hunk": "@@ -1315,13 +1315,17 @@ void PeerManager::UpdatedBlockTip(const CBlockIndex *pindexNew, const CBlockInde\n         }\n     }\n \n-    // Relay to all peers\n-    m_connman.ForEachNode([&vHashes](CNode* pnode) {\n-        LOCK(pnode->cs_inventory);\n-        for (const uint256& hash : reverse_iterate(vHashes)) {\n-            pnode->vBlockHashesToAnnounce.push_back(hash);\n+    {\n+        LOCK(m_peer_mutex);\n+        for (auto& it : m_peer_map) {\n+            Peer& peer = *it.second;\n+            LOCK(peer.m_block_inv_mutex);",
    "path": "src/net_processing.cpp",
    "position": 33,
    "original_position": 13,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "a50dee50fd2aee93b41bfb3b04b24939d0c2f6c1",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think this is the first place where we are acquiring a lock while already holding `m_peer_mutex`.  Any thoughts on what is the best way to document this design, so that future code writers know that acquiring `m_peer_mutex` while holding a peer's `m_block_inv_mutex` is not allowed?\r\n\r\nOr, would it be better to first copy all the Peer objects to a temporary place, release the `m_peer_mutex` lock, and then grab the per-peer `m_block_inv_mutex` locks to avoid holding both at the same time?  (I don't know or have an opinion; just trying to figure out the locking design here.)",
    "created_at": "2020-12-18T22:16:36Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546116786",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546116786"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546116786"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546116786/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1322,
    "original_line": 1322,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546118439",
    "pull_request_review_id": 480949559,
    "id": 546118439,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjExODQzOQ==",
    "diff_hunk": "@@ -72,6 +72,11 @@ struct Peer {\n \n     /** This peer's reported block height when we connected */\n     std::atomic<int> m_starting_height{-1};\n+    /** The final block hash in an INV message. When the peer requests this\n+     * block, we send a BLOCK message to trigger the peer to request the next",
    "path": "src/net_processing.h",
    "position": null,
    "original_position": 5,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "b5b27ea052905ff7f26a962baa961fcc762c5ee0",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "We send an INV message, not a BLOCK message.",
    "created_at": "2020-12-18T22:21:49Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546118439",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546118439"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546118439"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546118439/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 76,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546147190",
    "pull_request_review_id": 555879922,
    "id": 546147190,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjE0NzE5MA==",
    "diff_hunk": "@@ -1315,13 +1315,17 @@ void PeerManager::UpdatedBlockTip(const CBlockIndex *pindexNew, const CBlockInde\n         }\n     }\n \n-    // Relay to all peers\n-    m_connman.ForEachNode([&vHashes](CNode* pnode) {\n-        LOCK(pnode->cs_inventory);\n-        for (const uint256& hash : reverse_iterate(vHashes)) {\n-            pnode->vBlockHashesToAnnounce.push_back(hash);\n+    {\n+        LOCK(m_peer_mutex);\n+        for (auto& it : m_peer_map) {\n+            Peer& peer = *it.second;\n+            LOCK(peer.m_block_inv_mutex);",
    "path": "src/net_processing.cpp",
    "position": 33,
    "original_position": 13,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "a50dee50fd2aee93b41bfb3b04b24939d0c2f6c1",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Would a comment next to `m_peer_mutex` suffice here? This design (take `m_peer_mutex` first, then lock the mutexes protecting the individual data members) is analogous to `ForEachNode()` was doing here before (take `cs_vNodes` first, then lock the mutexes protecting the individual data members in the lambda - here `cs_inventory`).",
    "created_at": "2020-12-18T23:38:51Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546147190",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546147190"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546147190"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546147190/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1322,
    "original_line": 1322,
    "side": "RIGHT",
    "in_reply_to_id": 546116786
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546147750",
    "pull_request_review_id": 555880570,
    "id": 546147750,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjE0Nzc1MA==",
    "diff_hunk": "@@ -72,6 +72,11 @@ struct Peer {\n \n     /** This peer's reported block height when we connected */\n     std::atomic<int> m_starting_height{-1};\n+    /** The final block hash in an INV message. When the peer requests this\n+     * block, we send a BLOCK message to trigger the peer to request the next",
    "path": "src/net_processing.h",
    "position": null,
    "original_position": 5,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "b5b27ea052905ff7f26a962baa961fcc762c5ee0",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yes, will fix.",
    "created_at": "2020-12-18T23:41:35Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546147750",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546147750"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546147750"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546147750/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 76,
    "side": "RIGHT",
    "in_reply_to_id": 546118439
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546147783",
    "pull_request_review_id": 555880607,
    "id": 546147783,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjE0Nzc4Mw==",
    "diff_hunk": "@@ -61,6 +61,15 @@ struct Peer {\n     /** Whether this peer should be disconnected and marked as discouraged (unless it has the noban permission). */\n     bool m_should_discourage GUARDED_BY(m_misbehavior_mutex){false};\n \n+    /** Protects block inventory data members */\n+    Mutex m_block_inv_mutex;\n+    /** List of block ids we still have announce.",
    "path": "src/net_processing.h",
    "position": null,
    "original_position": 6,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "a50dee50fd2aee93b41bfb3b04b24939d0c2f6c1",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Agree. Will fix.",
    "created_at": "2020-12-18T23:41:44Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546147783",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546147783"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546147783"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546147783/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 66,
    "side": "RIGHT",
    "in_reply_to_id": 546095735
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546147815",
    "pull_request_review_id": 555880664,
    "id": 546147815,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjE0NzgxNQ==",
    "diff_hunk": "@@ -224,14 +224,14 @@ static RPCHelpMan getpeerinfo()\n             // addnode is deprecated in v0.21 for removal in v0.22\n             obj.pushKV(\"addnode\", stats.m_manual_connection);\n         }\n-        obj.pushKV(\"startingheight\", stats.nStartingHeight);\n         if (fStateStats) {\n             if (IsDeprecatedRPCEnabled(\"banscore\")) {\n                 // banscore is deprecated in v0.21 for removal in v0.22\n                 obj.pushKV(\"banscore\", statestats.m_misbehavior_score);\n             }\n             obj.pushKV(\"synced_headers\", statestats.nSyncHeight);\n             obj.pushKV(\"synced_blocks\", statestats.nCommonHeight);\n+            obj.pushKV(\"startingheight\", statestats.nStartingHeight);",
    "path": "src/rpc/net.cpp",
    "position": null,
    "original_position": 12,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "4ac61d85f1624b1cd7af4a85c8bca0bd430801f0",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Will fix.",
    "created_at": "2020-12-18T23:41:53Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546147815",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546147815"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546147815"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546147815/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 234,
    "side": "RIGHT",
    "in_reply_to_id": 546087558
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546232897",
    "pull_request_review_id": 555938493,
    "id": 546232897,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMjg5Nw==",
    "diff_hunk": "@@ -1843,7 +1844,8 @@ void PeerManager::ProcessHeadersMessage(CNode& pfrom, const std::vector<CBlockHe\n             // Headers message had its maximum size; the peer may have more headers.\n             // TODO: optimize: if pindexLast is an ancestor of ::ChainActive().Tip or pindexBestHeader, continue\n             // from there instead.\n-            LogPrint(BCLog::NET, \"more getheaders (%d) to end to peer=%d (startheight:%d)\\n\", pindexLast->nHeight, pfrom.GetId(), pfrom.nStartingHeight);\n+            PeerRef peer = GetPeerRef(pfrom.GetId());",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 13,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "4ac61d85f1624b1cd7af4a85c8bca0bd430801f0",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "4ac61d85f1624b1cd7af4a85c8bca0bd430801f0:\r\n\r\nCan you explain why a nullptr-Assert is not needed here?\r\nAlso, why isn't the peer passed in from outside, where it already exists?",
    "created_at": "2020-12-19T12:27:53Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546232897",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546232897"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546232897"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546232897/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1866,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546234157",
    "pull_request_review_id": 555938493,
    "id": 546234157,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzNDE1Nw==",
    "diff_hunk": "@@ -1315,13 +1315,17 @@ void PeerManager::UpdatedBlockTip(const CBlockIndex *pindexNew, const CBlockInde\n         }\n     }\n \n-    // Relay to all peers\n-    m_connman.ForEachNode([&vHashes](CNode* pnode) {\n-        LOCK(pnode->cs_inventory);\n-        for (const uint256& hash : reverse_iterate(vHashes)) {\n-            pnode->vBlockHashesToAnnounce.push_back(hash);\n+    {\n+        LOCK(m_peer_mutex);\n+        for (auto& it : m_peer_map) {",
    "path": "src/net_processing.cpp",
    "position": 31,
    "original_position": 11,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "a50dee50fd2aee93b41bfb3b04b24939d0c2f6c1",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "a50dee50fd2aee93b41bfb3b04b24939d0c2f6c1\r\n\r\nAny reason to not have a `ForEachPeer` member function?",
    "created_at": "2020-12-19T12:41:31Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546234157",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546234157"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546234157"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546234157/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1320,
    "original_line": 1320,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546235312",
    "pull_request_review_id": 555938493,
    "id": 546235312,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzNTMxMg==",
    "diff_hunk": "@@ -61,6 +61,15 @@ struct Peer {\n     /** Whether this peer should be disconnected and marked as discouraged (unless it has the noban permission). */\n     bool m_should_discourage GUARDED_BY(m_misbehavior_mutex){false};\n \n+    /** Protects block inventory data members */\n+    Mutex m_block_inv_mutex;\n+    /** List of block ids we still have announce.\n+     * There is no final sorting before sending, as they are always sent\n+     * immediately and in the order requested. */\n+    std::vector<uint256> vInventoryBlockToSend GUARDED_BY(m_block_inv_mutex);\n+    /** List of headers to relay */",
    "path": "src/net_processing.h",
    "position": null,
    "original_position": 10,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "a50dee50fd2aee93b41bfb3b04b24939d0c2f6c1",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "a50dee50fd2aee93b41bfb3b04b24939d0c2f6c1\r\n\r\nThe list is unfiltered, as was mentioned in the previous comment. Any reason to remove that?",
    "created_at": "2020-12-19T12:54:18Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546235312",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546235312"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546235312"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546235312/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 70,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546235973",
    "pull_request_review_id": 555938493,
    "id": 546235973,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzNTk3Mw==",
    "diff_hunk": "@@ -66,9 +66,9 @@ struct Peer {\n     /** List of block ids we still have announce.\n      * There is no final sorting before sending, as they are always sent\n      * immediately and in the order requested. */\n-    std::vector<uint256> vInventoryBlockToSend GUARDED_BY(m_block_inv_mutex);\n+    std::vector<uint256> m_blocks_for_inv_relay GUARDED_BY(m_block_inv_mutex);\n     /** List of headers to relay */\n-    std::vector<uint256> vBlockHashesToAnnounce GUARDED_BY(m_block_inv_mutex);\n+    std::vector<uint256> m_blocks_for_headers_relay GUARDED_BY(m_block_inv_mutex);",
    "path": "src/net_processing.h",
    "position": 30,
    "original_position": 8,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "22c2b3eff601cbc1aed2e466502bdc5549e11ae2",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "22c2b3eff601cbc1aed2e466502bdc5549e11ae2\r\n\r\nI don't think this name is correct. Headers relay isn't implied. It might very well fall back to inv relay. Most importantly when the peer asked us to. Though, there are other reasons, too.",
    "created_at": "2020-12-19T13:00:47Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546235973",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546235973"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546235973"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546235973/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 75,
    "original_line": 75,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546237229",
    "pull_request_review_id": 555938493,
    "id": 546237229,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzNzIyOQ==",
    "diff_hunk": "@@ -72,6 +72,11 @@ struct Peer {\n \n     /** This peer's reported block height when we connected */\n     std::atomic<int> m_starting_height{-1};\n+    /** The final block hash in an INV message. When the peer requests this",
    "path": "src/net_processing.h",
    "position": null,
    "original_position": 4,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "b5b27ea052905ff7f26a962baa961fcc762c5ee0",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "b5b27ea052905ff7f26a962baa961fcc762c5ee0\r\n\r\nI don't think this is true either. `m_hash_continue` is a purely internal helper, never sent over the wire directly.  Instead, the tip hash is sent to trigger the peer to ask further.",
    "created_at": "2020-12-19T13:14:56Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546237229",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546237229"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546237229"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546237229/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 75,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546246602",
    "pull_request_review_id": 555946452,
    "id": 546246602,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI0NjYwMg==",
    "diff_hunk": "@@ -1315,13 +1315,17 @@ void PeerManager::UpdatedBlockTip(const CBlockIndex *pindexNew, const CBlockInde\n         }\n     }\n \n-    // Relay to all peers\n-    m_connman.ForEachNode([&vHashes](CNode* pnode) {\n-        LOCK(pnode->cs_inventory);\n-        for (const uint256& hash : reverse_iterate(vHashes)) {\n-            pnode->vBlockHashesToAnnounce.push_back(hash);\n+    {\n+        LOCK(m_peer_mutex);\n+        for (auto& it : m_peer_map) {\n+            Peer& peer = *it.second;\n+            LOCK(peer.m_block_inv_mutex);",
    "path": "src/net_processing.cpp",
    "position": 33,
    "original_position": 13,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "a50dee50fd2aee93b41bfb3b04b24939d0c2f6c1",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Added comments to the first commit. Let me know if you think more is required.",
    "created_at": "2020-12-19T14:52:05Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546246602",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546246602"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546246602"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546246602/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1322,
    "original_line": 1322,
    "side": "RIGHT",
    "in_reply_to_id": 546116786
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546246608",
    "pull_request_review_id": 555946460,
    "id": 546246608,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI0NjYwOA==",
    "diff_hunk": "@@ -72,6 +72,11 @@ struct Peer {\n \n     /** This peer's reported block height when we connected */\n     std::atomic<int> m_starting_height{-1};\n+    /** The final block hash in an INV message. When the peer requests this\n+     * block, we send a BLOCK message to trigger the peer to request the next",
    "path": "src/net_processing.h",
    "position": null,
    "original_position": 5,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "b5b27ea052905ff7f26a962baa961fcc762c5ee0",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done.",
    "created_at": "2020-12-19T14:52:11Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546246608",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546246608"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546246608"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546246608/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 76,
    "side": "RIGHT",
    "in_reply_to_id": 546118439
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546246613",
    "pull_request_review_id": 555946464,
    "id": 546246613,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI0NjYxMw==",
    "diff_hunk": "@@ -61,6 +61,15 @@ struct Peer {\n     /** Whether this peer should be disconnected and marked as discouraged (unless it has the noban permission). */\n     bool m_should_discourage GUARDED_BY(m_misbehavior_mutex){false};\n \n+    /** Protects block inventory data members */\n+    Mutex m_block_inv_mutex;\n+    /** List of block ids we still have announce.",
    "path": "src/net_processing.h",
    "position": null,
    "original_position": 6,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "a50dee50fd2aee93b41bfb3b04b24939d0c2f6c1",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Fixed",
    "created_at": "2020-12-19T14:52:18Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546246613",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546246613"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546246613"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546246613/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 66,
    "side": "RIGHT",
    "in_reply_to_id": 546095735
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546246624",
    "pull_request_review_id": 555946473,
    "id": 546246624,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI0NjYyNA==",
    "diff_hunk": "@@ -224,14 +224,14 @@ static RPCHelpMan getpeerinfo()\n             // addnode is deprecated in v0.21 for removal in v0.22\n             obj.pushKV(\"addnode\", stats.m_manual_connection);\n         }\n-        obj.pushKV(\"startingheight\", stats.nStartingHeight);\n         if (fStateStats) {\n             if (IsDeprecatedRPCEnabled(\"banscore\")) {\n                 // banscore is deprecated in v0.21 for removal in v0.22\n                 obj.pushKV(\"banscore\", statestats.m_misbehavior_score);\n             }\n             obj.pushKV(\"synced_headers\", statestats.nSyncHeight);\n             obj.pushKV(\"synced_blocks\", statestats.nCommonHeight);\n+            obj.pushKV(\"startingheight\", statestats.nStartingHeight);",
    "path": "src/rpc/net.cpp",
    "position": null,
    "original_position": 12,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "4ac61d85f1624b1cd7af4a85c8bca0bd430801f0",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Fixed",
    "created_at": "2020-12-19T14:52:25Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546246624",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546246624"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546246624"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546246624/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 234,
    "side": "RIGHT",
    "in_reply_to_id": 546087558
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546246883",
    "pull_request_review_id": 555946615,
    "id": 546246883,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI0Njg4Mw==",
    "diff_hunk": "@@ -224,14 +224,14 @@ static RPCHelpMan getpeerinfo()\n             // addnode is deprecated in v0.21 for removal in v0.22\n             obj.pushKV(\"addnode\", stats.m_manual_connection);\n         }\n-        obj.pushKV(\"startingheight\", stats.nStartingHeight);\n         if (fStateStats) {\n             if (IsDeprecatedRPCEnabled(\"banscore\")) {\n                 // banscore is deprecated in v0.21 for removal in v0.22\n                 obj.pushKV(\"banscore\", statestats.m_misbehavior_score);\n             }\n             obj.pushKV(\"synced_headers\", statestats.nSyncHeight);\n             obj.pushKV(\"synced_blocks\", statestats.nCommonHeight);\n+            obj.pushKV(\"startingheight\", statestats.nStartingHeight);",
    "path": "src/rpc/net.cpp",
    "position": null,
    "original_position": 12,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "4ac61d85f1624b1cd7af4a85c8bca0bd430801f0",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Not sure if it is done in the latest push (58f4c8567ba77fbdbd65a12c74628505aacd0d3c).",
    "created_at": "2020-12-19T14:55:05Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546246883",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546246883"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546246883"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546246883/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 234,
    "side": "RIGHT",
    "in_reply_to_id": 546087558
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546247528",
    "pull_request_review_id": 555947033,
    "id": 546247528,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI0NzUyOA==",
    "diff_hunk": "@@ -1843,7 +1844,8 @@ void PeerManager::ProcessHeadersMessage(CNode& pfrom, const std::vector<CBlockHe\n             // Headers message had its maximum size; the peer may have more headers.\n             // TODO: optimize: if pindexLast is an ancestor of ::ChainActive().Tip or pindexBestHeader, continue\n             // from there instead.\n-            LogPrint(BCLog::NET, \"more getheaders (%d) to end to peer=%d (startheight:%d)\\n\", pindexLast->nHeight, pfrom.GetId(), pfrom.nStartingHeight);\n+            PeerRef peer = GetPeerRef(pfrom.GetId());",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 13,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "4ac61d85f1624b1cd7af4a85c8bca0bd430801f0",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yes, passing in from outside is a much better idea. I've done that now.",
    "created_at": "2020-12-19T15:00:57Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546247528",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546247528"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546247528"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546247528/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1866,
    "side": "RIGHT",
    "in_reply_to_id": 546232897
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546247965",
    "pull_request_review_id": 555947299,
    "id": 546247965,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI0Nzk2NQ==",
    "diff_hunk": "@@ -1315,13 +1315,17 @@ void PeerManager::UpdatedBlockTip(const CBlockIndex *pindexNew, const CBlockInde\n         }\n     }\n \n-    // Relay to all peers\n-    m_connman.ForEachNode([&vHashes](CNode* pnode) {\n-        LOCK(pnode->cs_inventory);\n-        for (const uint256& hash : reverse_iterate(vHashes)) {\n-            pnode->vBlockHashesToAnnounce.push_back(hash);\n+    {\n+        LOCK(m_peer_mutex);\n+        for (auto& it : m_peer_map) {",
    "path": "src/net_processing.cpp",
    "position": 31,
    "original_position": 11,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "a50dee50fd2aee93b41bfb3b04b24939d0c2f6c1",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I originally had one but removed it because it didn't seem worth it. We can revisit that decision later if it seems useful.\r\n\r\nForEachNode was useful because it allowed passing a lambda into CConnman which would be executed while the cs_vNodes lock was held. Here, the m_peer_mutex is in PeerMan, so it can be held directly.",
    "created_at": "2020-12-19T15:05:24Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546247965",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546247965"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546247965"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546247965/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1320,
    "original_line": 1320,
    "side": "RIGHT",
    "in_reply_to_id": 546234157
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546247973",
    "pull_request_review_id": 555947311,
    "id": 546247973,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI0Nzk3Mw==",
    "diff_hunk": "@@ -61,6 +61,15 @@ struct Peer {\n     /** Whether this peer should be disconnected and marked as discouraged (unless it has the noban permission). */\n     bool m_should_discourage GUARDED_BY(m_misbehavior_mutex){false};\n \n+    /** Protects block inventory data members */\n+    Mutex m_block_inv_mutex;\n+    /** List of block ids we still have announce.\n+     * There is no final sorting before sending, as they are always sent\n+     * immediately and in the order requested. */\n+    std::vector<uint256> vInventoryBlockToSend GUARDED_BY(m_block_inv_mutex);\n+    /** List of headers to relay */",
    "path": "src/net_processing.h",
    "position": null,
    "original_position": 10,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "a50dee50fd2aee93b41bfb3b04b24939d0c2f6c1",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Ok, I've added the word unfiltered back.",
    "created_at": "2020-12-19T15:05:37Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546247973",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546247973"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546247973"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546247973/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 70,
    "side": "RIGHT",
    "in_reply_to_id": 546235312
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546248923",
    "pull_request_review_id": 555947892,
    "id": 546248923,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI0ODkyMw==",
    "diff_hunk": "@@ -66,9 +66,9 @@ struct Peer {\n     /** List of block ids we still have announce.\n      * There is no final sorting before sending, as they are always sent\n      * immediately and in the order requested. */\n-    std::vector<uint256> vInventoryBlockToSend GUARDED_BY(m_block_inv_mutex);\n+    std::vector<uint256> m_blocks_for_inv_relay GUARDED_BY(m_block_inv_mutex);\n     /** List of headers to relay */\n-    std::vector<uint256> vBlockHashesToAnnounce GUARDED_BY(m_block_inv_mutex);\n+    std::vector<uint256> m_blocks_for_headers_relay GUARDED_BY(m_block_inv_mutex);",
    "path": "src/net_processing.h",
    "position": 30,
    "original_position": 8,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "22c2b3eff601cbc1aed2e466502bdc5549e11ae2",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "We hope to announce these blocks via headers. If we can't, we'll move the hashes onto the `m_blocks_for_inv_relay` and then announce via inv.\r\n\r\nI've updated the comment. Let me know if you think it's clear enough now.",
    "created_at": "2020-12-19T15:14:34Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546248923",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546248923"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546248923"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546248923/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 75,
    "original_line": 75,
    "side": "RIGHT",
    "in_reply_to_id": 546235973
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546248967",
    "pull_request_review_id": 555947933,
    "id": 546248967,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI0ODk2Nw==",
    "diff_hunk": "@@ -72,6 +72,11 @@ struct Peer {\n \n     /** This peer's reported block height when we connected */\n     std::atomic<int> m_starting_height{-1};\n+    /** The final block hash in an INV message. When the peer requests this",
    "path": "src/net_processing.h",
    "position": null,
    "original_position": 4,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "b5b27ea052905ff7f26a962baa961fcc762c5ee0",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I've updated the comment to be \"The final block hash that we sent in an `inv` message to this peer.\" Let me know if you have suggestions for better wording.",
    "created_at": "2020-12-19T15:15:10Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546248967",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546248967"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546248967"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546248967/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 75,
    "side": "RIGHT",
    "in_reply_to_id": 546237229
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546251702",
    "pull_request_review_id": 555949691,
    "id": 546251702,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI1MTcwMg==",
    "diff_hunk": "@@ -1764,7 +1775,9 @@ void PeerManager::SendBlockTransactions(CNode& pfrom, const CBlock& block, const\n     m_connman.PushMessage(&pfrom, msgMaker.Make(nSendFlags, NetMsgType::BLOCKTXN, resp));\n }\n \n-void PeerManager::ProcessHeadersMessage(CNode& pfrom, const std::vector<CBlockHeader>& headers, bool via_compact_block)\n+void PeerManager::ProcessHeadersMessage(CNode& pfrom, const Peer& peer,\n+                                        const std::vector<CBlockHeader>& headers,\n+                                        bool via_compact_block)",
    "path": "src/net_processing.cpp",
    "position": 97,
    "original_position": 97,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "9aad3e4f3347990641da23c0d9a3f05e1669cabf",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "2f023a8 nit, the diff would be clearer without the line break changes, and I also find the code less readable here than on one line",
    "created_at": "2020-12-19T15:42:09Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546251702",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546251702"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546251702"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546251702/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1781,
    "original_line": 1781,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546251731",
    "pull_request_review_id": 555949691,
    "id": 546251731,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI1MTczMQ==",
    "diff_hunk": "@@ -1854,7 +1867,8 @@ void PeerManager::ProcessHeadersMessage(CNode& pfrom, const std::vector<CBlockHe\n             // Headers message had its maximum size; the peer may have more headers.\n             // TODO: optimize: if pindexLast is an ancestor of ::ChainActive().Tip or pindexBestHeader, continue\n             // from there instead.\n-            LogPrint(BCLog::NET, \"more getheaders (%d) to end to peer=%d (startheight:%d)\\n\", pindexLast->nHeight, pfrom.GetId(), pfrom.nStartingHeight);\n+            LogPrint(BCLog::NET, \"more getheaders (%d) to end to peer=%d (startheight:%d)\\n\",\n+                                 pindexLast->nHeight, pfrom.GetId(), peer.m_starting_height);",
    "path": "src/net_processing.cpp",
    "position": 107,
    "original_position": 107,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "9aad3e4f3347990641da23c0d9a3f05e1669cabf",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "2f023a8 nit, as above, easier diff to review and more readable without the added line break",
    "created_at": "2020-12-19T15:42:49Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546251731",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546251731"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546251731"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546251731/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1872,
    "original_line": 1872,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546252186",
    "pull_request_review_id": 555949691,
    "id": 546252186,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI1MjE4Ng==",
    "diff_hunk": "@@ -180,7 +202,9 @@ class PeerManager final : public CValidationInterface, public NetEventsInterface\n \n     void ProcessOrphanTx(std::set<uint256>& orphan_work_set) EXCLUSIVE_LOCKS_REQUIRED(cs_main, g_cs_orphans);\n     /** Process a single headers message from a peer. */\n-    void ProcessHeadersMessage(CNode& pfrom, const std::vector<CBlockHeader>& headers, bool via_compact_block);\n+    void ProcessHeadersMessage(CNode& pfrom, const Peer& peer,",
    "path": "src/net_processing.h",
    "position": 48,
    "original_position": 48,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "9aad3e4f3347990641da23c0d9a3f05e1669cabf",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "2f023a8 nit, as above, easier diff to review and more readable here without the line break changes",
    "created_at": "2020-12-19T15:46:37Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546252186",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546252186"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546252186"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546252186/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 205,
    "original_line": 205,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546266076",
    "pull_request_review_id": 555949691,
    "id": 546266076,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI2NjA3Ng==",
    "diff_hunk": "@@ -224,14 +224,14 @@ static RPCHelpMan getpeerinfo()\n             // addnode is deprecated in v0.21 for removal in v0.22\n             obj.pushKV(\"addnode\", stats.m_manual_connection);\n         }\n-        obj.pushKV(\"startingheight\", stats.nStartingHeight);\n         if (fStateStats) {\n             if (IsDeprecatedRPCEnabled(\"banscore\")) {\n                 // banscore is deprecated in v0.21 for removal in v0.22\n                 obj.pushKV(\"banscore\", statestats.m_misbehavior_score);\n             }\n             obj.pushKV(\"synced_headers\", statestats.nSyncHeight);\n             obj.pushKV(\"synced_blocks\", statestats.nCommonHeight);\n+            obj.pushKV(\"startingheight\", statestats.m_starting_height);",
    "path": "src/rpc/net.cpp",
    "position": null,
    "original_position": 24,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "9aad3e4f3347990641da23c0d9a3f05e1669cabf",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In 2f023a8c0e445985a20, `startingheight` should remain before `synced_headers` and `synced_blocks` (here and in the help) for consistency with the GUI peers info (or maybe less preferably, the GUI should be updated to follow this change)",
    "created_at": "2020-12-19T18:05:53Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546266076",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546266076"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546266076"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546266076/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 234,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546267230",
    "pull_request_review_id": 555949691,
    "id": 546267230,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI2NzIzMA==",
    "diff_hunk": "@@ -60,6 +63,25 @@ struct Peer {\n     /** Whether this peer should be disconnected and marked as discouraged (unless it has the noban permission). */\n     bool m_should_discourage GUARDED_BY(m_misbehavior_mutex){false};\n \n+    /** Protects block inventory data members */\n+    Mutex m_block_inv_mutex;\n+    /** List of blocks that we'll anounce via an `inv` message.\n+     * There is no final sorting before sending, as they are always sent\n+     * immediately and in the order requested. */\n+    std::vector<uint256> m_blocks_for_inv_relay GUARDED_BY(m_block_inv_mutex);\n+    /** Unfiltered list of blocks that we'd like to announce via a `headers`\n+     * message. If we can't announce via a `headers` message, we'll fall back to\n+     * announcing via `inv`. */\n+    std::vector<uint256> m_blocks_for_headers_relay GUARDED_BY(m_block_inv_mutex);\n+    /** The final block hash that we sent in an `inv` message to this peer.\n+     * When the peer requests this block, we send an `inv` message to trigger\n+     * the peer to request the next sequence of block hashes.\n+     * Most peers use headers-first syncing, which doesn't use this mechanism */\n+    uint256 m_hash_continue GUARDED_BY(m_block_inv_mutex) {};",
    "path": "src/net_processing.h",
    "position": null,
    "original_position": 35,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "9aad3e4f3347990641da23c0d9a3f05e1669cabf",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "25ccfd3b while renaming `hashContinue`, I wonder if it can be better named (but don't have one to propose)",
    "created_at": "2020-12-19T18:17:18Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546267230",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546267230"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546267230"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546267230/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 80,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546338754",
    "pull_request_review_id": 555994173,
    "id": 546338754,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjMzODc1NA==",
    "diff_hunk": "@@ -46,6 +46,8 @@ struct CNodeStateStats {\n  * Memory is owned by shared pointers and this object is destructed when\n  * the refcount drops to zero.\n  *\n+ * Mutexes inside this struct must not be held when locking m_peer_mutex.",
    "path": "src/net_processing.h",
    "position": 12,
    "original_position": 4,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "717a374e74b64b7b90bc1b2995e8900212bd0bfe",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "717a374e74b64b7b90bc1b2995e8900212bd0bfe\r\n\r\nnit to avoid the inversion and give a rationale:\r\n\r\n\"m_peer_mutex should be locked before locking a mutex inside this struct to avoid lock order violations\"\r\n\r\nThis will also weaken the requirement, because for some mutexes it could make sense to not require m_peer_mutex beforehand. ",
    "created_at": "2020-12-20T08:06:25Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546338754",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546338754"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546338754"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546338754/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 50,
    "original_line": 49,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546338825",
    "pull_request_review_id": 555994173,
    "id": 546338825,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjMzODgyNQ==",
    "diff_hunk": "@@ -210,7 +212,8 @@ class PeerManager final : public CValidationInterface, public NetEventsInterface\n       * on extra block-relay-only peers. */\n     bool m_initial_sync_finished{false};\n \n-    /** Protects m_peer_map */\n+    /** Protects m_peer_map. This mutex must not be locked while holding a lock\n+     *  on any of the mutexes inside a Peer object. */",
    "path": "src/net_processing.h",
    "position": 60,
    "original_position": 15,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "717a374e74b64b7b90bc1b2995e8900212bd0bfe",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "same",
    "created_at": "2020-12-20T08:06:52Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546338825",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546338825"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546338825"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546338825/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 238,
    "original_line": 216,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546342334",
    "pull_request_review_id": 555994173,
    "id": 546342334,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjM0MjMzNA==",
    "diff_hunk": "@@ -1615,15 +1615,17 @@ void static ProcessGetBlockData(CNode& pfrom, Peer& peer, const CChainParams& ch\n             }\n         }\n \n-        // Trigger the peer node to send a getblocks request for the next batch of inventory\n-        if (inv.hash == peer.m_hash_continue) {\n-            // Send immediately. This must send even if redundant,\n-            // and we want it right after the last block so they don't\n-            // wait for other stuff first.\n-            std::vector<CInv> vInv;\n-            vInv.push_back(CInv(MSG_BLOCK, ::ChainActive().Tip()->GetBlockHash()));\n-            connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::INV, vInv));\n-            peer.m_hash_continue.SetNull();\n+        LOCK(peer.m_block_inv_mutex); {",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 13,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "9aad3e4f3347990641da23c0d9a3f05e1669cabf",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "What syntax is this? I don't think we use `LOCK(); { ... }` anywhere in the codebase",
    "created_at": "2020-12-20T08:20:49Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546342334",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546342334"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546342334"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546342334/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1618,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546342415",
    "pull_request_review_id": 555994173,
    "id": 546342415,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjM0MjQxNQ==",
    "diff_hunk": "@@ -1615,15 +1615,17 @@ void static ProcessGetBlockData(CNode& pfrom, Peer& peer, const CChainParams& ch\n             }\n         }\n \n-        // Trigger the peer node to send a getblocks request for the next batch of inventory\n-        if (inv.hash == peer.m_hash_continue) {\n-            // Send immediately. This must send even if redundant,\n-            // and we want it right after the last block so they don't\n-            // wait for other stuff first.\n-            std::vector<CInv> vInv;\n-            vInv.push_back(CInv(MSG_BLOCK, ::ChainActive().Tip()->GetBlockHash()));\n-            connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::INV, vInv));\n-            peer.m_hash_continue.SetNull();\n+        LOCK(peer.m_block_inv_mutex); {",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 13,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "9aad3e4f3347990641da23c0d9a3f05e1669cabf",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Also, doesn't this lock violate the documentation you added in the first commit?",
    "created_at": "2020-12-20T08:21:34Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546342415",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546342415"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546342415"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546342415/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1618,
    "side": "RIGHT",
    "in_reply_to_id": 546342334
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546342532",
    "pull_request_review_id": 555996244,
    "id": 546342532,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjM0MjUzMg==",
    "diff_hunk": "@@ -72,6 +72,11 @@ struct Peer {\n \n     /** This peer's reported block height when we connected */\n     std::atomic<int> m_starting_height{-1};\n+    /** The final block hash in an INV message. When the peer requests this",
    "path": "src/net_processing.h",
    "position": null,
    "original_position": 4,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "b5b27ea052905ff7f26a962baa961fcc762c5ee0",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks. Looks good now.",
    "created_at": "2020-12-20T08:22:53Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546342532",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546342532"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546342532"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546342532/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 75,
    "side": "RIGHT",
    "in_reply_to_id": 546237229
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546342556",
    "pull_request_review_id": 555996261,
    "id": 546342556,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjM0MjU1Ng==",
    "diff_hunk": "@@ -66,9 +66,9 @@ struct Peer {\n     /** List of block ids we still have announce.\n      * There is no final sorting before sending, as they are always sent\n      * immediately and in the order requested. */\n-    std::vector<uint256> vInventoryBlockToSend GUARDED_BY(m_block_inv_mutex);\n+    std::vector<uint256> m_blocks_for_inv_relay GUARDED_BY(m_block_inv_mutex);\n     /** List of headers to relay */\n-    std::vector<uint256> vBlockHashesToAnnounce GUARDED_BY(m_block_inv_mutex);\n+    std::vector<uint256> m_blocks_for_headers_relay GUARDED_BY(m_block_inv_mutex);",
    "path": "src/net_processing.h",
    "position": 30,
    "original_position": 8,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "22c2b3eff601cbc1aed2e466502bdc5549e11ae2",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "\r\n\r\nThanks. Looks good now.\r\n",
    "created_at": "2020-12-20T08:23:06Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546342556",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546342556"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546342556"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546342556/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 75,
    "original_line": 75,
    "side": "RIGHT",
    "in_reply_to_id": 546235973
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546352430",
    "pull_request_review_id": 556002144,
    "id": 546352430,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjM1MjQzMA==",
    "diff_hunk": "@@ -46,6 +46,8 @@ struct CNodeStateStats {\n  * Memory is owned by shared pointers and this object is destructed when\n  * the refcount drops to zero.\n  *\n+ * Mutexes inside this struct must not be held when locking m_peer_mutex.",
    "path": "src/net_processing.h",
    "position": 12,
    "original_position": 4,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "717a374e74b64b7b90bc1b2995e8900212bd0bfe",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "That isn't precise enough. It's fine to lock m_peer_mutex, take a shared_ptr to one of the Peer objects, release m_peer_mutex and later lock one of the inner mutexes. The only rule is that we don't want to lock m_peer_mutex while already holding a lock on one of the inner mutexes.\r\n\r\nThis is the same as cs_vNodes and the inner mutexes in CNode.",
    "created_at": "2020-12-20T09:53:19Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546352430",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546352430"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546352430"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546352430/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 50,
    "original_line": 49,
    "side": "RIGHT",
    "in_reply_to_id": 546338754
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546352494",
    "pull_request_review_id": 556002188,
    "id": 546352494,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjM1MjQ5NA==",
    "diff_hunk": "@@ -210,7 +212,8 @@ class PeerManager final : public CValidationInterface, public NetEventsInterface\n       * on extra block-relay-only peers. */\n     bool m_initial_sync_finished{false};\n \n-    /** Protects m_peer_map */\n+    /** Protects m_peer_map. This mutex must not be locked while holding a lock\n+     *  on any of the mutexes inside a Peer object. */",
    "path": "src/net_processing.h",
    "position": 60,
    "original_position": 15,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "717a374e74b64b7b90bc1b2995e8900212bd0bfe",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "as above",
    "created_at": "2020-12-20T09:53:44Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546352494",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546352494"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546352494"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546352494/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 238,
    "original_line": 216,
    "side": "RIGHT",
    "in_reply_to_id": 546338825
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546353092",
    "pull_request_review_id": 556002530,
    "id": 546353092,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjM1MzA5Mg==",
    "diff_hunk": "@@ -1615,15 +1615,17 @@ void static ProcessGetBlockData(CNode& pfrom, Peer& peer, const CChainParams& ch\n             }\n         }\n \n-        // Trigger the peer node to send a getblocks request for the next batch of inventory\n-        if (inv.hash == peer.m_hash_continue) {\n-            // Send immediately. This must send even if redundant,\n-            // and we want it right after the last block so they don't\n-            // wait for other stuff first.\n-            std::vector<CInv> vInv;\n-            vInv.push_back(CInv(MSG_BLOCK, ::ChainActive().Tip()->GetBlockHash()));\n-            connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::INV, vInv));\n-            peer.m_hash_continue.SetNull();\n+        LOCK(peer.m_block_inv_mutex); {",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 13,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "9aad3e4f3347990641da23c0d9a3f05e1669cabf",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This is my brain not working properly. I've fixed the syntax.\r\n\r\nThis doesn't violate the documentation. That says that it's not permitted to lock m_peer_map while holding a lock on an inner mutex. This is locking an inner mutex.",
    "created_at": "2020-12-20T09:58:24Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546353092",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546353092"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546353092"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546353092/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1618,
    "side": "RIGHT",
    "in_reply_to_id": 546342334
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546353260",
    "pull_request_review_id": 556002647,
    "id": 546353260,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjM1MzI2MA==",
    "diff_hunk": "@@ -1764,7 +1775,9 @@ void PeerManager::SendBlockTransactions(CNode& pfrom, const CBlock& block, const\n     m_connman.PushMessage(&pfrom, msgMaker.Make(nSendFlags, NetMsgType::BLOCKTXN, resp));\n }\n \n-void PeerManager::ProcessHeadersMessage(CNode& pfrom, const std::vector<CBlockHeader>& headers, bool via_compact_block)\n+void PeerManager::ProcessHeadersMessage(CNode& pfrom, const Peer& peer,\n+                                        const std::vector<CBlockHeader>& headers,\n+                                        bool via_compact_block)",
    "path": "src/net_processing.cpp",
    "position": 97,
    "original_position": 97,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "9aad3e4f3347990641da23c0d9a3f05e1669cabf",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This is permitted by our clang formatter. I find it easier to read lines that are less than 100 columns, so I think this is a matter of taste.",
    "created_at": "2020-12-20T09:59:52Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546353260",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546353260"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546353260"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546353260/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1781,
    "original_line": 1781,
    "side": "RIGHT",
    "in_reply_to_id": 546251702
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546353297",
    "pull_request_review_id": 556002678,
    "id": 546353297,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjM1MzI5Nw==",
    "diff_hunk": "@@ -1854,7 +1867,8 @@ void PeerManager::ProcessHeadersMessage(CNode& pfrom, const std::vector<CBlockHe\n             // Headers message had its maximum size; the peer may have more headers.\n             // TODO: optimize: if pindexLast is an ancestor of ::ChainActive().Tip or pindexBestHeader, continue\n             // from there instead.\n-            LogPrint(BCLog::NET, \"more getheaders (%d) to end to peer=%d (startheight:%d)\\n\", pindexLast->nHeight, pfrom.GetId(), pfrom.nStartingHeight);\n+            LogPrint(BCLog::NET, \"more getheaders (%d) to end to peer=%d (startheight:%d)\\n\",\n+                                 pindexLast->nHeight, pfrom.GetId(), peer.m_starting_height);",
    "path": "src/net_processing.cpp",
    "position": 107,
    "original_position": 107,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "9aad3e4f3347990641da23c0d9a3f05e1669cabf",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Again, this is personal taste, so I'm going to resolve this.",
    "created_at": "2020-12-20T10:00:17Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546353297",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546353297"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546353297"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546353297/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1872,
    "original_line": 1872,
    "side": "RIGHT",
    "in_reply_to_id": 546251731
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546353320",
    "pull_request_review_id": 556002693,
    "id": 546353320,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjM1MzMyMA==",
    "diff_hunk": "@@ -180,7 +202,9 @@ class PeerManager final : public CValidationInterface, public NetEventsInterface\n \n     void ProcessOrphanTx(std::set<uint256>& orphan_work_set) EXCLUSIVE_LOCKS_REQUIRED(cs_main, g_cs_orphans);\n     /** Process a single headers message from a peer. */\n-    void ProcessHeadersMessage(CNode& pfrom, const std::vector<CBlockHeader>& headers, bool via_compact_block);\n+    void ProcessHeadersMessage(CNode& pfrom, const Peer& peer,",
    "path": "src/net_processing.h",
    "position": 48,
    "original_position": 48,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "9aad3e4f3347990641da23c0d9a3f05e1669cabf",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "as above",
    "created_at": "2020-12-20T10:00:27Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546353320",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546353320"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546353320"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546353320/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 205,
    "original_line": 205,
    "side": "RIGHT",
    "in_reply_to_id": 546252186
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546353473",
    "pull_request_review_id": 556002806,
    "id": 546353473,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjM1MzQ3Mw==",
    "diff_hunk": "@@ -224,14 +224,14 @@ static RPCHelpMan getpeerinfo()\n             // addnode is deprecated in v0.21 for removal in v0.22\n             obj.pushKV(\"addnode\", stats.m_manual_connection);\n         }\n-        obj.pushKV(\"startingheight\", stats.nStartingHeight);\n         if (fStateStats) {\n             if (IsDeprecatedRPCEnabled(\"banscore\")) {\n                 // banscore is deprecated in v0.21 for removal in v0.22\n                 obj.pushKV(\"banscore\", statestats.m_misbehavior_score);\n             }\n             obj.pushKV(\"synced_headers\", statestats.nSyncHeight);\n             obj.pushKV(\"synced_blocks\", statestats.nCommonHeight);\n+            obj.pushKV(\"startingheight\", statestats.m_starting_height);",
    "path": "src/rpc/net.cpp",
    "position": null,
    "original_position": 24,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "9aad3e4f3347990641da23c0d9a3f05e1669cabf",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "done",
    "created_at": "2020-12-20T10:01:54Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546353473",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546353473"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546353473"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546353473/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 234,
    "side": "RIGHT",
    "in_reply_to_id": 546266076
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546353844",
    "pull_request_review_id": 556003057,
    "id": 546353844,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjM1Mzg0NA==",
    "diff_hunk": "@@ -60,6 +63,25 @@ struct Peer {\n     /** Whether this peer should be disconnected and marked as discouraged (unless it has the noban permission). */\n     bool m_should_discourage GUARDED_BY(m_misbehavior_mutex){false};\n \n+    /** Protects block inventory data members */\n+    Mutex m_block_inv_mutex;\n+    /** List of blocks that we'll anounce via an `inv` message.\n+     * There is no final sorting before sending, as they are always sent\n+     * immediately and in the order requested. */\n+    std::vector<uint256> m_blocks_for_inv_relay GUARDED_BY(m_block_inv_mutex);\n+    /** Unfiltered list of blocks that we'd like to announce via a `headers`\n+     * message. If we can't announce via a `headers` message, we'll fall back to\n+     * announcing via `inv`. */\n+    std::vector<uint256> m_blocks_for_headers_relay GUARDED_BY(m_block_inv_mutex);\n+    /** The final block hash that we sent in an `inv` message to this peer.\n+     * When the peer requests this block, we send an `inv` message to trigger\n+     * the peer to request the next sequence of block hashes.\n+     * Most peers use headers-first syncing, which doesn't use this mechanism */\n+    uint256 m_hash_continue GUARDED_BY(m_block_inv_mutex) {};",
    "path": "src/net_processing.h",
    "position": null,
    "original_position": 35,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "9aad3e4f3347990641da23c0d9a3f05e1669cabf",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Changed to `m_continuation_block`",
    "created_at": "2020-12-20T10:05:24Z",
    "updated_at": "2020-12-20T10:08:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546353844",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546353844"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546353844"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546353844/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 80,
    "side": "RIGHT",
    "in_reply_to_id": 546267230
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546367599",
    "pull_request_review_id": 556011499,
    "id": 546367599,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjM2NzU5OQ==",
    "diff_hunk": "@@ -46,6 +46,8 @@ struct CNodeStateStats {\n  * Memory is owned by shared pointers and this object is destructed when\n  * the refcount drops to zero.\n  *\n+ * Mutexes inside this struct must not be held when locking m_peer_mutex.",
    "path": "src/net_processing.h",
    "position": 12,
    "original_position": 4,
    "commit_id": "3002b4af2b4fde63026f8f7c575452a5c989c662",
    "original_commit_id": "717a374e74b64b7b90bc1b2995e8900212bd0bfe",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Ah right. I didn't parse this correctly. Thanks for the explanation.",
    "created_at": "2020-12-20T12:05:36Z",
    "updated_at": "2020-12-20T12:05:36Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546367599",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546367599"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19829#discussion_r546367599"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19829"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546367599/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 50,
    "original_line": 49,
    "side": "RIGHT",
    "in_reply_to_id": 546338754
  }
]