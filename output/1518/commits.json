[
  {
    "sha": "5c83f797c5bcbebe4c2646044f968205980b2350",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1YzgzZjc5N2M1YmNiZWJlNGMyNjQ2MDQ0Zjk2ODIwNTk4MGIyMzUw",
    "commit": {
      "author": {
        "name": "Philip Kaufmann",
        "email": "phil.kaufmann@t-online.de",
        "date": "2012-06-24T16:28:05Z"
      },
      "committer": {
        "name": "Philip Kaufmann",
        "email": "phil.kaufmann@t-online.de",
        "date": "2012-07-06T16:51:30Z"
      },
      "message": "update QRCodeDialog\n\n- remove unused #include <QDebug> and lblBTC label\n- update Bitcoin input field to a BitcoinAmountField to allow Bitcoin unit selection\n- use BitcoinUnits::format for the resulting amount parameter in the generated URI (always use BTC as per BIP21)\n- move MAX_URI_LENGTH and EXPORT_IMAGE_SIZE to guiconstants.h\n- add OptionsModel in AddressBookPage and use it in on_showQRCode_clicked() to pass it to QRCodeDialog\n- add OptionsModel in QRCodeDialog to enable display unit updates\n- add updateDisplayUnit() slot to be able to imediately update currently set bitcoin unit\n- make all labels in the UI-file plain text\n- resize dialog to match for an updated layout (fields are now stacked and new field)\n- remove unused parameters from private slots\n- only enable save button, when QR Code was generated\n- show message when entered amound is invalid\n- add read-only QPlainTextEdit field to output generated URI",
      "tree": {
        "sha": "165023fadc3cd4b6ac30f9c84e4e11a5a2f4443d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/165023fadc3cd4b6ac30f9c84e4e11a5a2f4443d"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5c83f797c5bcbebe4c2646044f968205980b2350",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5c83f797c5bcbebe4c2646044f968205980b2350",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/5c83f797c5bcbebe4c2646044f968205980b2350",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5c83f797c5bcbebe4c2646044f968205980b2350/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "2a919e396d95425fd2a3411c1716b7ccfe719540",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2a919e396d95425fd2a3411c1716b7ccfe719540",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/2a919e396d95425fd2a3411c1716b7ccfe719540"
      }
    ],
    "stats": {
      "total": 367,
      "additions": 215,
      "deletions": 152
    },
    "files": [
      {
        "sha": "663ff686694a0f4888c4616d8c798535545ce346",
        "filename": "src/qt/addressbookpage.cpp",
        "status": "modified",
        "additions": 9,
        "deletions": 0,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5c83f797c5bcbebe4c2646044f968205980b2350/src/qt/addressbookpage.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5c83f797c5bcbebe4c2646044f968205980b2350/src/qt/addressbookpage.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/addressbookpage.cpp?ref=5c83f797c5bcbebe4c2646044f968205980b2350",
        "patch": "@@ -2,6 +2,7 @@\n #include \"ui_addressbookpage.h\"\n \n #include \"addresstablemodel.h\"\n+#include \"optionsmodel.h\"\n #include \"bitcoingui.h\"\n #include \"editaddressdialog.h\"\n #include \"csvmodelwriter.h\"\n@@ -20,6 +21,7 @@ AddressBookPage::AddressBookPage(Mode mode, Tabs tab, QWidget *parent) :\n     QDialog(parent),\n     ui(new Ui::AddressBookPage),\n     model(0),\n+    optionsModel(0),\n     mode(mode),\n     tab(tab)\n {\n@@ -139,6 +141,11 @@ void AddressBookPage::setModel(AddressTableModel *model)\n     selectionChanged();\n }\n \n+void AddressBookPage::setOptionsModel(OptionsModel *optionsModel)\n+{\n+    this->optionsModel = optionsModel;\n+}\n+\n void AddressBookPage::on_copyToClipboard_clicked()\n {\n     GUIUtil::copyEntryData(ui->tableView, AddressTableModel::Address);\n@@ -314,6 +321,8 @@ void AddressBookPage::on_showQRCode_clicked()\n         QString address = index.data().toString(), label = index.sibling(index.row(), 0).data(Qt::EditRole).toString();\n \n         QRCodeDialog *dialog = new QRCodeDialog(address, label, tab == ReceivingTab, this);\n+        if(optionsModel)\n+            dialog->setModel(optionsModel);\n         dialog->setAttribute(Qt::WA_DeleteOnClose);\n         dialog->show();\n     }"
      },
      {
        "sha": "e94c5561317905f52ab8a815223541309830eabd",
        "filename": "src/qt/addressbookpage.h",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5c83f797c5bcbebe4c2646044f968205980b2350/src/qt/addressbookpage.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5c83f797c5bcbebe4c2646044f968205980b2350/src/qt/addressbookpage.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/addressbookpage.h?ref=5c83f797c5bcbebe4c2646044f968205980b2350",
        "patch": "@@ -7,6 +7,7 @@ namespace Ui {\n     class AddressBookPage;\n }\n class AddressTableModel;\n+class OptionsModel;\n \n QT_BEGIN_NAMESPACE\n class QTableView;\n@@ -37,6 +38,7 @@ class AddressBookPage : public QDialog\n     ~AddressBookPage();\n \n     void setModel(AddressTableModel *model);\n+    void setOptionsModel(OptionsModel *optionsModel);\n     const QString &getReturnValue() const { return returnValue; }\n \n public slots:\n@@ -46,6 +48,7 @@ public slots:\n private:\n     Ui::AddressBookPage *ui;\n     AddressTableModel *model;\n+    OptionsModel *optionsModel;\n     Mode mode;\n     Tabs tab;\n     QString returnValue;"
      },
      {
        "sha": "3ef03c437ed3b0aff6f7548d5f506182c8d49a60",
        "filename": "src/qt/bitcoingui.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5c83f797c5bcbebe4c2646044f968205980b2350/src/qt/bitcoingui.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5c83f797c5bcbebe4c2646044f968205980b2350/src/qt/bitcoingui.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/bitcoingui.cpp?ref=5c83f797c5bcbebe4c2646044f968205980b2350",
        "patch": "@@ -357,6 +357,8 @@ void BitcoinGUI::setClientModel(ClientModel *clientModel)\n         connect(clientModel, SIGNAL(error(QString,QString,bool)), this, SLOT(error(QString,QString,bool)));\n \n         rpcConsole->setClientModel(clientModel);\n+        addressBookPage->setOptionsModel(clientModel->getOptionsModel());\n+        receiveCoinsPage->setOptionsModel(clientModel->getOptionsModel());\n     }\n }\n "
      },
      {
        "sha": "52e9db37627d2bed28b0efe1a83301f718988841",
        "filename": "src/qt/forms/qrcodedialog.ui",
        "status": "modified",
        "additions": 119,
        "deletions": 123,
        "changes": 242,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5c83f797c5bcbebe4c2646044f968205980b2350/src/qt/forms/qrcodedialog.ui",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5c83f797c5bcbebe4c2646044f968205980b2350/src/qt/forms/qrcodedialog.ui",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/forms/qrcodedialog.ui?ref=5c83f797c5bcbebe4c2646044f968205980b2350",
        "patch": "@@ -6,8 +6,8 @@\n    <rect>\n     <x>0</x>\n     <y>0</y>\n-    <width>334</width>\n-    <height>425</height>\n+    <width>340</width>\n+    <height>530</height>\n    </rect>\n   </property>\n   <property name=\"windowTitle\">\n@@ -28,8 +28,8 @@\n        <height>300</height>\n       </size>\n      </property>\n-     <property name=\"text\">\n-      <string>QR Code</string>\n+     <property name=\"textFormat\">\n+      <enum>Qt::PlainText</enum>\n      </property>\n      <property name=\"alignment\">\n       <set>Qt::AlignCenter</set>\n@@ -39,134 +39,123 @@\n      </property>\n     </widget>\n    </item>\n+   <item>\n+    <widget class=\"QPlainTextEdit\" name=\"outUri\">\n+     <property name=\"sizePolicy\">\n+      <sizepolicy hsizetype=\"Expanding\" vsizetype=\"Minimum\">\n+       <horstretch>0</horstretch>\n+       <verstretch>0</verstretch>\n+      </sizepolicy>\n+     </property>\n+     <property name=\"minimumSize\">\n+      <size>\n+       <width>0</width>\n+       <height>50</height>\n+      </size>\n+     </property>\n+     <property name=\"tabChangesFocus\">\n+      <bool>true</bool>\n+     </property>\n+     <property name=\"textInteractionFlags\">\n+      <set>Qt::TextSelectableByKeyboard|Qt::TextSelectableByMouse</set>\n+     </property>\n+    </widget>\n+   </item>\n    <item>\n     <widget class=\"QWidget\" name=\"widget\" native=\"true\">\n      <layout class=\"QVBoxLayout\" name=\"verticalLayout_2\">\n       <item>\n-       <layout class=\"QHBoxLayout\" name=\"horizontalLayout_2\">\n-        <item>\n-         <layout class=\"QVBoxLayout\" name=\"verticalLayout\">\n-          <item>\n-           <widget class=\"QCheckBox\" name=\"chkReqPayment\">\n-            <property name=\"enabled\">\n-             <bool>true</bool>\n-            </property>\n-            <property name=\"text\">\n-             <string>Request Payment</string>\n-            </property>\n-           </widget>\n-          </item>\n-          <item>\n-           <layout class=\"QHBoxLayout\" name=\"horizontalLayout\">\n-            <item>\n-             <widget class=\"QLabel\" name=\"lblAmount\">\n-              <property name=\"sizePolicy\">\n-               <sizepolicy hsizetype=\"Preferred\" vsizetype=\"Maximum\">\n-                <horstretch>0</horstretch>\n-                <verstretch>0</verstretch>\n-               </sizepolicy>\n-              </property>\n-              <property name=\"text\">\n-               <string>Amount:</string>\n-              </property>\n-              <property name=\"alignment\">\n-               <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n-              </property>\n-              <property name=\"buddy\">\n-               <cstring>lnReqAmount</cstring>\n-              </property>\n-             </widget>\n-            </item>\n-            <item>\n-             <widget class=\"QLineEdit\" name=\"lnReqAmount\">\n-              <property name=\"enabled\">\n-               <bool>false</bool>\n-              </property>\n-              <property name=\"minimumSize\">\n-               <size>\n-                <width>60</width>\n-                <height>0</height>\n-               </size>\n-              </property>\n-              <property name=\"alignment\">\n-               <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n-              </property>\n-             </widget>\n-            </item>\n-            <item>\n-             <widget class=\"QLabel\" name=\"lblBTC\">\n-              <property name=\"sizePolicy\">\n-               <sizepolicy hsizetype=\"Preferred\" vsizetype=\"Maximum\">\n-                <horstretch>0</horstretch>\n-                <verstretch>0</verstretch>\n-               </sizepolicy>\n-              </property>\n-              <property name=\"text\">\n-               <string>BTC</string>\n-              </property>\n-              <property name=\"buddy\">\n-               <cstring>lnReqAmount</cstring>\n-              </property>\n-             </widget>\n-            </item>\n-           </layout>\n-          </item>\n-         </layout>\n+       <widget class=\"QCheckBox\" name=\"chkReqPayment\">\n+        <property name=\"enabled\">\n+         <bool>true</bool>\n+        </property>\n+        <property name=\"text\">\n+         <string>Request Payment</string>\n+        </property>\n+       </widget>\n+      </item>\n+      <item>\n+       <layout class=\"QFormLayout\" name=\"formLayout\">\n+        <property name=\"fieldGrowthPolicy\">\n+         <enum>QFormLayout::AllNonFixedFieldsGrow</enum>\n+        </property>\n+        <item row=\"1\" column=\"0\">\n+         <widget class=\"QLabel\" name=\"lblLabel\">\n+          <property name=\"text\">\n+           <string>Label:</string>\n+          </property>\n+          <property name=\"textFormat\">\n+           <enum>Qt::PlainText</enum>\n+          </property>\n+          <property name=\"alignment\">\n+           <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n+          </property>\n+          <property name=\"buddy\">\n+           <cstring>lnLabel</cstring>\n+          </property>\n+         </widget>\n         </item>\n-        <item>\n-         <layout class=\"QGridLayout\" name=\"gridLayout\">\n-          <item row=\"0\" column=\"0\">\n-           <widget class=\"QLabel\" name=\"lblLabel\">\n-            <property name=\"text\">\n-             <string>Label:</string>\n-            </property>\n-            <property name=\"alignment\">\n-             <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n-            </property>\n-            <property name=\"buddy\">\n-             <cstring>lnLabel</cstring>\n-            </property>\n-           </widget>\n-          </item>\n-          <item row=\"0\" column=\"1\">\n-           <widget class=\"QLineEdit\" name=\"lnLabel\">\n-            <property name=\"minimumSize\">\n-             <size>\n-              <width>100</width>\n-              <height>0</height>\n-             </size>\n-            </property>\n-           </widget>\n-          </item>\n-          <item row=\"1\" column=\"0\">\n-           <widget class=\"QLabel\" name=\"lblMessage\">\n-            <property name=\"text\">\n-             <string>Message:</string>\n-            </property>\n-            <property name=\"alignment\">\n-             <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n-            </property>\n-            <property name=\"buddy\">\n-             <cstring>lnMessage</cstring>\n-            </property>\n-           </widget>\n-          </item>\n-          <item row=\"1\" column=\"1\">\n-           <widget class=\"QLineEdit\" name=\"lnMessage\">\n-            <property name=\"minimumSize\">\n-             <size>\n-              <width>100</width>\n-              <height>0</height>\n-             </size>\n-            </property>\n-           </widget>\n-          </item>\n-         </layout>\n+        <item row=\"1\" column=\"1\">\n+         <widget class=\"QLineEdit\" name=\"lnLabel\"/>\n+        </item>\n+        <item row=\"2\" column=\"0\">\n+         <widget class=\"QLabel\" name=\"lblMessage\">\n+          <property name=\"text\">\n+           <string>Message:</string>\n+          </property>\n+          <property name=\"textFormat\">\n+           <enum>Qt::PlainText</enum>\n+          </property>\n+          <property name=\"alignment\">\n+           <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n+          </property>\n+          <property name=\"buddy\">\n+           <cstring>lnMessage</cstring>\n+          </property>\n+         </widget>\n+        </item>\n+        <item row=\"2\" column=\"1\">\n+         <widget class=\"QLineEdit\" name=\"lnMessage\"/>\n+        </item>\n+        <item row=\"0\" column=\"0\">\n+         <widget class=\"QLabel\" name=\"lblAmount\">\n+          <property name=\"sizePolicy\">\n+           <sizepolicy hsizetype=\"Preferred\" vsizetype=\"Maximum\">\n+            <horstretch>0</horstretch>\n+            <verstretch>0</verstretch>\n+           </sizepolicy>\n+          </property>\n+          <property name=\"text\">\n+           <string>Amount:</string>\n+          </property>\n+          <property name=\"textFormat\">\n+           <enum>Qt::PlainText</enum>\n+          </property>\n+          <property name=\"alignment\">\n+           <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n+          </property>\n+          <property name=\"buddy\">\n+           <cstring>lnReqAmount</cstring>\n+          </property>\n+         </widget>\n+        </item>\n+        <item row=\"0\" column=\"1\">\n+         <widget class=\"BitcoinAmountField\" name=\"lnReqAmount\">\n+          <property name=\"enabled\">\n+           <bool>false</bool>\n+          </property>\n+          <property name=\"minimumSize\">\n+           <size>\n+            <width>80</width>\n+            <height>0</height>\n+           </size>\n+          </property>\n+         </widget>\n         </item>\n        </layout>\n       </item>\n       <item>\n-       <layout class=\"QHBoxLayout\" name=\"horizontalLayout_3\">\n+       <layout class=\"QHBoxLayout\" name=\"horizontalLayout\">\n         <item>\n          <spacer name=\"horizontalSpacer\">\n           <property name=\"orientation\">\n@@ -194,6 +183,13 @@\n    </item>\n   </layout>\n  </widget>\n+ <customwidgets>\n+  <customwidget>\n+   <class>BitcoinAmountField</class>\n+   <extends>QSpinBox</extends>\n+   <header>bitcoinamountfield.h</header>\n+  </customwidget>\n+ </customwidgets>\n  <resources/>\n  <connections>\n   <connection>"
      },
      {
        "sha": "6f6fa7f26176746a4890b5d9ca11804ba3eac597",
        "filename": "src/qt/guiconstants.h",
        "status": "modified",
        "additions": 6,
        "deletions": 0,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5c83f797c5bcbebe4c2646044f968205980b2350/src/qt/guiconstants.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5c83f797c5bcbebe4c2646044f968205980b2350/src/qt/guiconstants.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/guiconstants.h?ref=5c83f797c5bcbebe4c2646044f968205980b2350",
        "patch": "@@ -25,4 +25,10 @@ static const int STATUSBAR_ICONSIZE = 16;\n  */\n static const int TOOLTIP_WRAP_THRESHOLD = 80;\n \n+/* Maximum allowed URI length */\n+static const int MAX_URI_LENGTH = 255;\n+\n+/* QRCodeDialog -- size of exported QR Code image */\n+#define EXPORT_IMAGE_SIZE 256\n+\n #endif // GUICONSTANTS_H"
      },
      {
        "sha": "ca94975128a597385825f93591ba343d067b4e0f",
        "filename": "src/qt/qrcodedialog.cpp",
        "status": "modified",
        "additions": 65,
        "deletions": 22,
        "changes": 87,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5c83f797c5bcbebe4c2646044f968205980b2350/src/qt/qrcodedialog.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5c83f797c5bcbebe4c2646044f968205980b2350/src/qt/qrcodedialog.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/qrcodedialog.cpp?ref=5c83f797c5bcbebe4c2646044f968205980b2350",
        "patch": "@@ -1,28 +1,34 @@\n #include \"qrcodedialog.h\"\n #include \"ui_qrcodedialog.h\"\n+\n+#include \"bitcoinunits.h\"\n+#include \"guiconstants.h\"\n #include \"guiutil.h\"\n+#include \"optionsmodel.h\"\n \n #include <QPixmap>\n #include <QUrl>\n-#include <QDebug>\n \n #include <qrencode.h>\n \n-#define EXPORT_IMAGE_SIZE 256\n-\n QRCodeDialog::QRCodeDialog(const QString &addr, const QString &label, bool enableReq, QWidget *parent) :\n-    QDialog(parent), ui(new Ui::QRCodeDialog), address(addr)\n+    QDialog(parent),\n+    ui(new Ui::QRCodeDialog),\n+    model(0),\n+    address(addr)\n {\n     ui->setupUi(this);\n+\n     setWindowTitle(QString(\"%1\").arg(address));\n \n     ui->chkReqPayment->setVisible(enableReq);\n-    ui->lnReqAmount->setVisible(enableReq);\n     ui->lblAmount->setVisible(enableReq);\n-    ui->lblBTC->setVisible(enableReq);\n+    ui->lnReqAmount->setVisible(enableReq);\n \n     ui->lnLabel->setText(label);\n \n+    ui->btnSaveAs->setEnabled(false);\n+\n     genCode();\n }\n \n@@ -31,6 +37,17 @@ QRCodeDialog::~QRCodeDialog()\n     delete ui;\n }\n \n+void QRCodeDialog::setModel(OptionsModel *model)\n+{\n+    this->model = model;\n+\n+    if (model)\n+        connect(model, SIGNAL(displayUnitChanged(int)), this, SLOT(updateDisplayUnit()));\n+\n+    // update the display unit, to not use the default (\"BTC\")\n+    updateDisplayUnit();\n+}\n+\n void QRCodeDialog::genCode()\n {\n     QString uri = getURI();\n@@ -57,26 +74,34 @@ void QRCodeDialog::genCode()\n             }\n         }\n         QRcode_free(code);\n+\n         ui->lblQRCode->setPixmap(QPixmap::fromImage(myImage).scaled(300, 300));\n+\n+        ui->outUri->setPlainText(uri);\n     }\n-    else\n-        ui->lblQRCode->setText(tr(\"Resulting URI too long, try to reduce the text for label / message.\"));\n }\n \n QString QRCodeDialog::getURI()\n {\n     QString ret = QString(\"bitcoin:%1\").arg(address);\n-\n     int paramCount = 0;\n-    if (ui->chkReqPayment->isChecked() && !ui->lnReqAmount->text().isEmpty())\n+\n+    ui->outUri->clear();\n+\n+    if (ui->chkReqPayment->isChecked())\n     {\n-        bool ok = false;\n-        ui->lnReqAmount->text().toDouble(&ok);\n-        if (ok)\n+        if (ui->lnReqAmount->validate())\n         {\n-            ret += QString(\"?amount=%1\").arg(ui->lnReqAmount->text());\n+            // even if we allow a non BTC unit input in lnReqAmount, we generate the URI with BTC as unit (as defined in BIP21)\n+            ret += QString(\"?amount=%1\").arg(BitcoinUnits::format(BitcoinUnits::BTC, ui->lnReqAmount->value()));\n             paramCount++;\n         }\n+        else\n+        {\n+            ui->btnSaveAs->setEnabled(false);\n+            ui->lblQRCode->setText(tr(\"The entered amount is invalid, please check.\"));\n+            return QString(\"\");\n+        }\n     }\n \n     if (!ui->lnLabel->text().isEmpty())\n@@ -93,24 +118,29 @@ QString QRCodeDialog::getURI()\n         paramCount++;\n     }\n \n-    // limit URI length to 255 chars, to prevent a DoS against the QR-Code dialog\n-    if (ret.length() < 256)\n-        return ret;\n-    else\n+    // limit URI length to prevent a DoS against the QR-Code dialog\n+    if (ret.length() > MAX_URI_LENGTH)\n+    {\n+        ui->btnSaveAs->setEnabled(false);\n+        ui->lblQRCode->setText(tr(\"Resulting URI too long, try to reduce the text for label / message.\"));\n         return QString(\"\");\n+    }\n+\n+    ui->btnSaveAs->setEnabled(true);\n+    return ret;\n }\n \n-void QRCodeDialog::on_lnReqAmount_textChanged(const QString &arg1)\n+void QRCodeDialog::on_lnReqAmount_textChanged()\n {\n     genCode();\n }\n \n-void QRCodeDialog::on_lnLabel_textChanged(const QString &arg1)\n+void QRCodeDialog::on_lnLabel_textChanged()\n {\n     genCode();\n }\n \n-void QRCodeDialog::on_lnMessage_textChanged(const QString &arg1)\n+void QRCodeDialog::on_lnMessage_textChanged()\n {\n     genCode();\n }\n@@ -122,7 +152,20 @@ void QRCodeDialog::on_btnSaveAs_clicked()\n         myImage.scaled(EXPORT_IMAGE_SIZE, EXPORT_IMAGE_SIZE).save(fn);\n }\n \n-void QRCodeDialog::on_chkReqPayment_toggled(bool)\n+void QRCodeDialog::on_chkReqPayment_toggled(bool fChecked)\n {\n+    if (!fChecked)\n+        // if chkReqPayment is not active, don't display lnReqAmount as invalid\n+        ui->lnReqAmount->setValid(true);\n+\n     genCode();\n }\n+\n+void QRCodeDialog::updateDisplayUnit()\n+{\n+    if (model)\n+    {\n+        // Update lnReqAmount with the current unit\n+        ui->lnReqAmount->setDisplayUnit(model->getDisplayUnit());\n+    }\n+}"
      },
      {
        "sha": "c55c34bce6c96bb783b8c0855c55b118b52650ef",
        "filename": "src/qt/qrcodedialog.h",
        "status": "modified",
        "additions": 11,
        "deletions": 7,
        "changes": 18,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5c83f797c5bcbebe4c2646044f968205980b2350/src/qt/qrcodedialog.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5c83f797c5bcbebe4c2646044f968205980b2350/src/qt/qrcodedialog.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/qrcodedialog.h?ref=5c83f797c5bcbebe4c2646044f968205980b2350",
        "patch": "@@ -7,6 +7,7 @@\n namespace Ui {\n     class QRCodeDialog;\n }\n+class OptionsModel;\n \n class QRCodeDialog : public QDialog\n {\n@@ -16,22 +17,25 @@ class QRCodeDialog : public QDialog\n     explicit QRCodeDialog(const QString &addr, const QString &label, bool enableReq, QWidget *parent = 0);\n     ~QRCodeDialog();\n \n+    void setModel(OptionsModel *model);\n+\n private slots:\n-    void on_lnReqAmount_textChanged(const QString &arg1);\n-    void on_lnLabel_textChanged(const QString &arg1);\n-    void on_lnMessage_textChanged(const QString &arg1);\n+    void on_lnReqAmount_textChanged();\n+    void on_lnLabel_textChanged();\n+    void on_lnMessage_textChanged();\n     void on_btnSaveAs_clicked();\n+    void on_chkReqPayment_toggled(bool fChecked);\n \n-    void on_chkReqPayment_toggled(bool checked);\n+    void updateDisplayUnit();\n \n private:\n     Ui::QRCodeDialog *ui;\n-    QImage myImage;\n-\n-    QString getURI();\n+    OptionsModel *model;\n     QString address;\n+    QImage myImage;\n \n     void genCode();\n+    QString getURI();\n };\n \n #endif // QRCODEDIALOG_H"
      }
    ]
  }
]