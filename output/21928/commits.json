[
  {
    "sha": "df0fa571ecec9509f8a701d5bc619c62118621c5",
    "node_id": "C_kwDOABII59oAKGRmMGZhNTcxZWNlYzk1MDlmOGE3MDFkNWJjNjE5YzYyMTE4NjIxYzU",
    "commit": {
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2021-05-12T09:25:25Z"
      },
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2021-11-18T12:09:00Z"
      },
      "message": "rpc: getwalletinfo shows external_signer flag",
      "tree": {
        "sha": "531c7263328d4fa26e8b1059f3a1b450a25e7ccd",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/531c7263328d4fa26e8b1059f3a1b450a25e7ccd"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/df0fa571ecec9509f8a701d5bc619c62118621c5",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAmGWQlwACgkQV/+b28ww\nEAkBuw//elhEiaaXcEEvWkr/A7b1mq6RlQp58DWuXlj5JNVRQrjfhciNJy3PK4JM\n18yLyP31mliwpK1bhv0gozq5OGG/U98T9PyAJQMsEq6FUgh4wtam6IVx4AQmMi6a\nruOPY37e7xnvdiz0Q0k+pqjvt3Wfw8RulkFB2zXI+roNEMSi26eAfx8wrxI19H9z\nl+byvxKUGxUMzjCYtwYqLjLE2UwkTaICr621Joao83nNAR+d7Goi4zt0CPhbgH5g\neWqF33hvHl0VtWGZ8YASkNa4SGJg1G3nsjPYO7Mv+pQJh01BNnHyxafiTc4hssGf\nqfX5WoWtGFtjww7J8xWDgvzHkapq+V/h/5IS1sLhJtvbaPDN31XRCWu3+Meci+Eu\ntRVCp5VAaLXsaYXmZa+902JwJGYw7Yzx2CaPDiW+Wt7l7ZIMhvhBLgZ01YUqKBwJ\nHMT4+THj8O5AZjAji8Xp7LxEogUsZRimP+5wgvMirECopyJtO/l8KAjpVqT4OZEm\nlNONLQvfX7aV0oy512acx24BK/t2agVVF73lpVGPmhINmmKhm/KnGTMjqU19rhPO\n4op1nSDwXbT8zi04OqHMrV1wovNNipGLIcKyBuYk29eyVAW6FCuutqV88Ytm+GLZ\nZuci8WzndRQQ8nvshXf8Mnb34F4uU0VgmHLlV8AX9gtssm5i+mM=\n=Ttga\n-----END PGP SIGNATURE-----",
        "payload": "tree 531c7263328d4fa26e8b1059f3a1b450a25e7ccd\nparent fe03f7a37fd0ef05149161f6b95a25493e1fe38f\nauthor Sjors Provoost <sjors@sprovoost.nl> 1620811525 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1637237340 +0100\n\nrpc: getwalletinfo shows external_signer flag\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/df0fa571ecec9509f8a701d5bc619c62118621c5",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/df0fa571ecec9509f8a701d5bc619c62118621c5",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/df0fa571ecec9509f8a701d5bc619c62118621c5/comments",
    "author": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "fe03f7a37fd0ef05149161f6b95a25493e1fe38f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fe03f7a37fd0ef05149161f6b95a25493e1fe38f",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/fe03f7a37fd0ef05149161f6b95a25493e1fe38f"
      }
    ],
    "stats": {
      "total": 3,
      "additions": 3,
      "deletions": 0
    },
    "files": [
      {
        "sha": "653502b08855b4ced6261cc0585dafca2aee1518",
        "filename": "src/wallet/rpcwallet.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/df0fa571ecec9509f8a701d5bc619c62118621c5/src/wallet/rpcwallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/df0fa571ecec9509f8a701d5bc619c62118621c5/src/wallet/rpcwallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcwallet.cpp?ref=df0fa571ecec9509f8a701d5bc619c62118621c5",
        "patch": "@@ -2501,6 +2501,7 @@ static RPCHelpMan getwalletinfo()\n                             {RPCResult::Type::NUM, \"progress\", \"scanning progress percentage [0.0, 1.0]\"},\n                         }},\n                         {RPCResult::Type::BOOL, \"descriptors\", \"whether this wallet uses descriptors for scriptPubKey management\"},\n+                        {RPCResult::Type::BOOL, \"external_signer\", \"whether this wallet uses an external signer such as a hardware wallet.\"},\n                     }},\n                 },\n                 RPCExamples{\n@@ -2561,6 +2562,7 @@ static RPCHelpMan getwalletinfo()\n         obj.pushKV(\"scanning\", false);\n     }\n     obj.pushKV(\"descriptors\", pwallet->IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS));\n+    obj.pushKV(\"external_signer\", pwallet->IsWalletFlagSet(WALLET_FLAG_EXTERNAL_SIGNER));\n     return obj;\n },\n     };"
      },
      {
        "sha": "e3f07026597ea4467ad9037371938c5e50eb2baa",
        "filename": "test/functional/wallet_signer.py",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/df0fa571ecec9509f8a701d5bc619c62118621c5/test/functional/wallet_signer.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/df0fa571ecec9509f8a701d5bc619c62118621c5/test/functional/wallet_signer.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/wallet_signer.py?ref=df0fa571ecec9509f8a701d5bc619c62118621c5",
        "patch": "@@ -76,6 +76,7 @@ def run_test(self):\n         # self.clear_mock_result(self.nodes[1])\n \n         assert_equal(hww.getwalletinfo()[\"keypoolsize\"], 30)\n+        assert_equal(hww.getwalletinfo()[\"external_signer\"], True)\n \n         address1 = hww.getnewaddress(address_type=\"bech32\")\n         assert_equal(address1, \"bcrt1qm90ugl4d48jv8n6e5t9ln6t9zlpm5th68x4f8g\")"
      }
    ]
  },
  {
    "sha": "1770fb4ffab76a12294056bedfa61c1338280ce4",
    "node_id": "C_kwDOABII59oAKDE3NzBmYjRmZmFiNzZhMTIyOTQwNTZiZWRmYTYxYzEzMzgyODBjZTQ",
    "commit": {
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2021-05-12T09:49:47Z"
      },
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2021-11-18T12:09:00Z"
      },
      "message": "wallet: allow external_signer flag toggle",
      "tree": {
        "sha": "591f6e5a21349ebe777908915cafd56a4c43d706",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/591f6e5a21349ebe777908915cafd56a4c43d706"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1770fb4ffab76a12294056bedfa61c1338280ce4",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAmGWQlwACgkQV/+b28ww\nEAkDCRAAnXO4EhmtSohd4g9Ssuru3uWMc0T0bz/NUnmT0nW+JfhD4RZKVotFFlPO\nDwu/rhFhuEpoXiQSmG67KEbMV+ykx1GbxBhJdzhiRuJ3IWWvH6Z0woJ3WaqBTvmx\n4wYK/jAJ93T9BMZQWB6/1s6A5P/sKEIFftCNKHsZvb9yjVS3+37bJU2cYU42TgN5\n4ATX4l981aZ+7WL19l51vrRCzrYPbIhMzpPIaWn64JDpoHB4yO8/tWpOPGVQxQYS\nsk0/TBuz4K2LnknFmmFNmsJKzKmT+SVLwI6sdypp+PLJ7nibaq9mltQQHQCJdpjV\nljanuo+uuX4V2Z8f5q/sB1FtWY31LvCERzmDfqD1PnIdWbEPJHdYf1LB3r9FK3Q9\n4D6PbUZBLA6ufbCjgJPXGjRqHdn3FRIijymnm908GqZq1rpek0Fez30mAL0g3aCr\nF/9f6u9ijKXPOGfMq2Eeei5OluEHjOvRSe6anOTVXwHnA0273+eQzVmQehfKrBFE\nU5lF51LkgQgvMp2qbcJ8xkWG2ab2GOSA5cmc7mTSPXy1ObpCM7OK3kdO5TrWJHTO\n0QmLscGaoEDdPyzm5FasoEXkUNp5Oe8UMV7JppES9dt29JQB3CAG4rNeoSjlhu4H\nTeMLzDhBQk7Jsw6oUTyFBfHJspab3rR7xnyj3yDEYnNVNL9FAvQ=\n=/JKI\n-----END PGP SIGNATURE-----",
        "payload": "tree 591f6e5a21349ebe777908915cafd56a4c43d706\nparent df0fa571ecec9509f8a701d5bc619c62118621c5\nauthor Sjors Provoost <sjors@sprovoost.nl> 1620812987 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1637237340 +0100\n\nwallet: allow external_signer flag toggle\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1770fb4ffab76a12294056bedfa61c1338280ce4",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/1770fb4ffab76a12294056bedfa61c1338280ce4",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1770fb4ffab76a12294056bedfa61c1338280ce4/comments",
    "author": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "df0fa571ecec9509f8a701d5bc619c62118621c5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/df0fa571ecec9509f8a701d5bc619c62118621c5",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/df0fa571ecec9509f8a701d5bc619c62118621c5"
      }
    ],
    "stats": {
      "total": 20,
      "additions": 18,
      "deletions": 2
    },
    "files": [
      {
        "sha": "34f302313206b02789f5047cd779e7839682031b",
        "filename": "src/wallet/rpcwallet.cpp",
        "status": "modified",
        "additions": 10,
        "deletions": 0,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1770fb4ffab76a12294056bedfa61c1338280ce4/src/wallet/rpcwallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1770fb4ffab76a12294056bedfa61c1338280ce4/src/wallet/rpcwallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcwallet.cpp?ref=1770fb4ffab76a12294056bedfa61c1338280ce4",
        "patch": "@@ -2743,6 +2743,16 @@ static RPCHelpMan setwalletflag()\n \n     auto flag = WALLET_FLAG_MAP.at(flag_str);\n \n+    if (flag == WALLET_FLAG_EXTERNAL_SIGNER) {\n+#ifdef ENABLE_EXTERNAL_SIGNER\n+        if (!pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) || !pwallet->IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS)) {\n+            throw JSONRPCError(RPC_WALLET_ERROR, \"This flag can only be set on a watch-only descriptor wallet\");\n+        }\n+#else\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Compiled without external signing support (required for external signing)\");\n+#endif\n+    }\n+\n     if (!(flag & MUTABLE_WALLET_FLAGS)) {\n         throw JSONRPCError(RPC_INVALID_PARAMETER, strprintf(\"Wallet flag is immutable: %s\", flag_str));\n     }"
      },
      {
        "sha": "f11d930e07ab53edfc83b3c427d7a3012a6b2eaa",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1770fb4ffab76a12294056bedfa61c1338280ce4/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1770fb4ffab76a12294056bedfa61c1338280ce4/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=1770fb4ffab76a12294056bedfa61c1338280ce4",
        "patch": "@@ -54,6 +54,9 @@ const std::map<uint64_t,std::string> WALLET_FLAG_CAVEATS{\n         \"destinations in the past. Until this is done, some destinations may \"\n         \"be considered unused, even if the opposite is the case.\"\n     },\n+    {WALLET_FLAG_EXTERNAL_SIGNER,\n+        \"The ability to toggle this flag may be removed in a future update.\"\n+    },\n };\n \n bool AddWalletSetting(interfaces::Chain& chain, const std::string& wallet_name)"
      },
      {
        "sha": "61d6f47234f0252590e759a0e9f690af53e57ec4",
        "filename": "src/wallet/wallet.h",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1770fb4ffab76a12294056bedfa61c1338280ce4/src/wallet/wallet.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1770fb4ffab76a12294056bedfa61c1338280ce4/src/wallet/wallet.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.h?ref=1770fb4ffab76a12294056bedfa61c1338280ce4",
        "patch": "@@ -125,7 +125,8 @@ static constexpr uint64_t KNOWN_WALLET_FLAGS =\n     |   WALLET_FLAG_EXTERNAL_SIGNER;\n \n static constexpr uint64_t MUTABLE_WALLET_FLAGS =\n-        WALLET_FLAG_AVOID_REUSE;\n+        WALLET_FLAG_EXTERNAL_SIGNER\n+    |   WALLET_FLAG_AVOID_REUSE;\n \n static const std::map<std::string,WalletFlags> WALLET_FLAG_MAP{\n     {\"avoid_reuse\", WALLET_FLAG_AVOID_REUSE},"
      },
      {
        "sha": "d2bc24b4ccd9654acdbb89777de5af3fe7f1db1b",
        "filename": "test/functional/wallet_signer.py",
        "status": "modified",
        "additions": 3,
        "deletions": 1,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1770fb4ffab76a12294056bedfa61c1338280ce4/test/functional/wallet_signer.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1770fb4ffab76a12294056bedfa61c1338280ce4/test/functional/wallet_signer.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/wallet_signer.py?ref=1770fb4ffab76a12294056bedfa61c1338280ce4",
        "patch": "@@ -64,7 +64,9 @@ def run_test(self):\n         # Flag can't be set afterwards (could be added later for non-blank descriptor based watch-only wallets)\n         self.nodes[1].createwallet(wallet_name='not_hww', disable_private_keys=True, descriptors=True, external_signer=False)\n         not_hww = self.nodes[1].get_wallet_rpc('not_hww')\n-        assert_raises_rpc_error(-8, \"Wallet flag is immutable: external_signer\", not_hww.setwalletflag, \"external_signer\", True)\n+        # Flag can be toggled\n+        not_hww.setwalletflag(\"external_signer\", True)\n+        not_hww.setwalletflag(\"external_signer\", False)\n \n         # assert_raises_rpc_error(-4, \"Multiple signers found, please specify which to use\", wallet_name='not_hww', disable_private_keys=True, descriptors=True, external_signer=True)\n "
      }
    ]
  }
]