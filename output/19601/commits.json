[
  {
    "sha": "b475d7d0fa000d5802caf3065b8b2abcea60719b",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiNDc1ZDdkMGZhMDAwZDU4MDJjYWYzMDY1YjhiMmFiY2VhNjA3MTli",
    "commit": {
      "author": {
        "name": "Jeremy Rubin",
        "email": "j@rubin.io",
        "date": "2019-10-07T20:45:00Z"
      },
      "committer": {
        "name": "Jeremy Rubin",
        "email": "j@rubin.io",
        "date": "2020-08-06T23:28:26Z"
      },
      "message": "Add single sha256 call to CHashWriter",
      "tree": {
        "sha": "cbbd801ecf1918ea300f38f043d97f6684637ad4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/cbbd801ecf1918ea300f38f043d97f6684637ad4"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b475d7d0fa000d5802caf3065b8b2abcea60719b",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b475d7d0fa000d5802caf3065b8b2abcea60719b",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/b475d7d0fa000d5802caf3065b8b2abcea60719b",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b475d7d0fa000d5802caf3065b8b2abcea60719b/comments",
    "author": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "82127d27c9001eee3eb28df67ce2e6eace620423",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/82127d27c9001eee3eb28df67ce2e6eace620423",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/82127d27c9001eee3eb28df67ce2e6eace620423"
      }
    ],
    "stats": {
      "total": 27,
      "additions": 20,
      "deletions": 7
    },
    "files": [
      {
        "sha": "4f392fa0aa363094f379cab2515650a06a793e29",
        "filename": "src/hash.h",
        "status": "modified",
        "additions": 20,
        "deletions": 7,
        "changes": 27,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/b475d7d0fa000d5802caf3065b8b2abcea60719b/src/hash.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/b475d7d0fa000d5802caf3065b8b2abcea60719b/src/hash.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/hash.h?ref=b475d7d0fa000d5802caf3065b8b2abcea60719b",
        "patch": "@@ -98,7 +98,7 @@ inline uint160 Hash160(const T1& in1)\n class CHashWriter\n {\n private:\n-    CHash256 ctx;\n+    CSHA256 ctx;\n \n     const int nType;\n     const int nVersion;\n@@ -110,23 +110,36 @@ class CHashWriter\n     int GetVersion() const { return nVersion; }\n \n     void write(const char *pch, size_t size) {\n-        ctx.Write({(const unsigned char*)pch, size});\n+        ctx.Write((const unsigned char*)pch, size);\n     }\n \n-    // invalidates the object\n+    /** Compute the double-SHA256 hash of all data written to this object.\n+     *\n+     * Invalidates this object.\n+     */\n     uint256 GetHash() {\n         uint256 result;\n-        ctx.Finalize(result);\n+        ctx.Finalize(result.begin());\n+        ctx.Reset().Write(result.begin(), CSHA256::OUTPUT_SIZE).Finalize(result.begin());\n+        return result;\n+    }\n+\n+    /** Compute the SHA256 hash of all data written to this object.\n+     *\n+     * Invalidates this object.\n+     */\n+    uint256 GetSHA256() {\n+        uint256 result;\n+        ctx.Finalize(result.begin());\n         return result;\n     }\n \n     /**\n      * Returns the first 64 bits from the resulting hash.\n      */\n     inline uint64_t GetCheapHash() {\n-        unsigned char result[CHash256::OUTPUT_SIZE];\n-        ctx.Finalize(result);\n-        return ReadLE64(result);\n+        uint256 result = GetHash();\n+        return ReadLE64(result.begin());\n     }\n \n     template<typename T>"
      }
    ]
  },
  {
    "sha": "6510d0ff4173a7b01d6728051303c7c38eb34533",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo2NTEwZDBmZjQxNzNhN2IwMWQ2NzI4MDUxMzAzYzdjMzhlYjM0NTMz",
    "commit": {
      "author": {
        "name": "Jeremy Rubin",
        "email": "j@rubin.io",
        "date": "2020-02-05T19:57:32Z"
      },
      "committer": {
        "name": "Jeremy Rubin",
        "email": "j@rubin.io",
        "date": "2020-08-06T23:28:26Z"
      },
      "message": "Add SHA256Uint256 helper functions",
      "tree": {
        "sha": "43d18ecb40cf20a459a03553b946fc2fc5aaf40d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/43d18ecb40cf20a459a03553b946fc2fc5aaf40d"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6510d0ff4173a7b01d6728051303c7c38eb34533",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6510d0ff4173a7b01d6728051303c7c38eb34533",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/6510d0ff4173a7b01d6728051303c7c38eb34533",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6510d0ff4173a7b01d6728051303c7c38eb34533/comments",
    "author": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "b475d7d0fa000d5802caf3065b8b2abcea60719b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b475d7d0fa000d5802caf3065b8b2abcea60719b",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/b475d7d0fa000d5802caf3065b8b2abcea60719b"
      }
    ],
    "stats": {
      "total": 11,
      "additions": 11,
      "deletions": 0
    },
    "files": [
      {
        "sha": "83b90ae063f4b456cde78dff0991660819ab53f2",
        "filename": "src/hash.cpp",
        "status": "modified",
        "additions": 7,
        "deletions": 0,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6510d0ff4173a7b01d6728051303c7c38eb34533/src/hash.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6510d0ff4173a7b01d6728051303c7c38eb34533/src/hash.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/hash.cpp?ref=6510d0ff4173a7b01d6728051303c7c38eb34533",
        "patch": "@@ -77,3 +77,10 @@ void BIP32Hash(const ChainCode &chainCode, unsigned int nChild, unsigned char he\n     num[3] = (nChild >>  0) & 0xFF;\n     CHMAC_SHA512(chainCode.begin(), chainCode.size()).Write(&header, 1).Write(data, 32).Write(num, 4).Finalize(output);\n }\n+\n+uint256 SHA256Uint256(const uint256& input)\n+{\n+    uint256 result;\n+    CSHA256().Write(input.begin(), 32).Finalize(result.begin());\n+    return result;\n+}"
      },
      {
        "sha": "c16bbb48cead6a37c2c1d7707ec8c759a5c32635",
        "filename": "src/hash.h",
        "status": "modified",
        "additions": 4,
        "deletions": 0,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6510d0ff4173a7b01d6728051303c7c38eb34533/src/hash.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6510d0ff4173a7b01d6728051303c7c38eb34533/src/hash.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/hash.h?ref=6510d0ff4173a7b01d6728051303c7c38eb34533",
        "patch": "@@ -6,6 +6,7 @@\n #ifndef BITCOIN_HASH_H\n #define BITCOIN_HASH_H\n \n+#include <attributes.h>\n #include <crypto/common.h>\n #include <crypto/ripemd160.h>\n #include <crypto/sha256.h>\n@@ -194,6 +195,9 @@ uint256 SerializeHash(const T& obj, int nType=SER_GETHASH, int nVersion=PROTOCOL\n     return ss.GetHash();\n }\n \n+/** Single-SHA256 a 32-byte input (represented as uint256). */\n+NODISCARD uint256 SHA256Uint256(const uint256& input);\n+\n unsigned int MurmurHash3(unsigned int nHashSeed, Span<const unsigned char> vDataToHash);\n \n void BIP32Hash(const ChainCode &chainCode, unsigned int nChild, unsigned char header, const unsigned char data[32], unsigned char output[64]);"
      }
    ]
  },
  {
    "sha": "9ab4cafabda227ccee5b241d7690fc67f9a27221",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5YWI0Y2FmYWJkYTIyN2NjZWU1YjI0MWQ3NjkwZmM2N2Y5YTI3MjIx",
    "commit": {
      "author": {
        "name": "Jeremy Rubin",
        "email": "j@rubin.io",
        "date": "2020-02-05T20:31:20Z"
      },
      "committer": {
        "name": "Jeremy Rubin",
        "email": "j@rubin.io",
        "date": "2020-08-07T18:08:40Z"
      },
      "message": "Refactor Get{Prevout,Sequence,Outputs}Hash to Get{Prevouts,Sequences,Outputs}SHA256.\n\nSeveral proposals (Taproot, MuHash, CTV) require access to the single\nhash.",
      "tree": {
        "sha": "c0a4c4bd8aeaf77ad532f9dd14554d0f6417cda9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c0a4c4bd8aeaf77ad532f9dd14554d0f6417cda9"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9ab4cafabda227ccee5b241d7690fc67f9a27221",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9ab4cafabda227ccee5b241d7690fc67f9a27221",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/9ab4cafabda227ccee5b241d7690fc67f9a27221",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9ab4cafabda227ccee5b241d7690fc67f9a27221/comments",
    "author": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "6510d0ff4173a7b01d6728051303c7c38eb34533",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6510d0ff4173a7b01d6728051303c7c38eb34533",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/6510d0ff4173a7b01d6728051303c7c38eb34533"
      }
    ],
    "stats": {
      "total": 27,
      "additions": 15,
      "deletions": 12
    },
    "files": [
      {
        "sha": "7b2457a5e39d6143c4f18a8089d4ba18d4553a0d",
        "filename": "src/script/interpreter.cpp",
        "status": "modified",
        "additions": 15,
        "deletions": 12,
        "changes": 27,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9ab4cafabda227ccee5b241d7690fc67f9a27221/src/script/interpreter.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9ab4cafabda227ccee5b241d7690fc67f9a27221/src/script/interpreter.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/script/interpreter.cpp?ref=9ab4cafabda227ccee5b241d7690fc67f9a27221",
        "patch": "@@ -1258,34 +1258,37 @@ class CTransactionSignatureSerializer\n     }\n };\n \n+/** Compute the (single) SHA256 of the concatenation of all prevouts of a tx. */\n template <class T>\n-uint256 GetPrevoutHash(const T& txTo)\n+uint256 GetPrevoutsSHA256(const T& txTo)\n {\n     CHashWriter ss(SER_GETHASH, 0);\n     for (const auto& txin : txTo.vin) {\n         ss << txin.prevout;\n     }\n-    return ss.GetHash();\n+    return ss.GetSHA256();\n }\n \n+/** Compute the (single) SHA256 of the concatenation of all nSequences of a tx. */\n template <class T>\n-uint256 GetSequenceHash(const T& txTo)\n+uint256 GetSequencesSHA256(const T& txTo)\n {\n     CHashWriter ss(SER_GETHASH, 0);\n     for (const auto& txin : txTo.vin) {\n         ss << txin.nSequence;\n     }\n-    return ss.GetHash();\n+    return ss.GetSHA256();\n }\n \n+/** Compute the (single) SHA256 of the concatenation of all txouts of a tx. */\n template <class T>\n-uint256 GetOutputsHash(const T& txTo)\n+uint256 GetOutputsSHA256(const T& txTo)\n {\n     CHashWriter ss(SER_GETHASH, 0);\n     for (const auto& txout : txTo.vout) {\n         ss << txout;\n     }\n-    return ss.GetHash();\n+    return ss.GetSHA256();\n }\n \n } // namespace\n@@ -1297,9 +1300,9 @@ void PrecomputedTransactionData::Init(const T& txTo)\n \n     // Cache is calculated only for transactions with witness\n     if (txTo.HasWitness()) {\n-        hashPrevouts = GetPrevoutHash(txTo);\n-        hashSequence = GetSequenceHash(txTo);\n-        hashOutputs = GetOutputsHash(txTo);\n+        hashPrevouts = SHA256Uint256(GetPrevoutsSHA256(txTo));\n+        hashSequence = SHA256Uint256(GetSequencesSHA256(txTo));\n+        hashOutputs = SHA256Uint256(GetOutputsSHA256(txTo));\n     }\n \n     m_ready = true;\n@@ -1329,16 +1332,16 @@ uint256 SignatureHash(const CScript& scriptCode, const T& txTo, unsigned int nIn\n         const bool cacheready = cache && cache->m_ready;\n \n         if (!(nHashType & SIGHASH_ANYONECANPAY)) {\n-            hashPrevouts = cacheready ? cache->hashPrevouts : GetPrevoutHash(txTo);\n+            hashPrevouts = cacheready ? cache->hashPrevouts : SHA256Uint256(GetPrevoutsSHA256(txTo));\n         }\n \n         if (!(nHashType & SIGHASH_ANYONECANPAY) && (nHashType & 0x1f) != SIGHASH_SINGLE && (nHashType & 0x1f) != SIGHASH_NONE) {\n-            hashSequence = cacheready ? cache->hashSequence : GetSequenceHash(txTo);\n+            hashSequence = cacheready ? cache->hashSequence : SHA256Uint256(GetSequencesSHA256(txTo));\n         }\n \n \n         if ((nHashType & 0x1f) != SIGHASH_SINGLE && (nHashType & 0x1f) != SIGHASH_NONE) {\n-            hashOutputs = cacheready ? cache->hashOutputs : GetOutputsHash(txTo);\n+            hashOutputs = cacheready ? cache->hashOutputs : SHA256Uint256(GetOutputsSHA256(txTo));\n         } else if ((nHashType & 0x1f) == SIGHASH_SINGLE && nIn < txTo.vout.size()) {\n             CHashWriter ss(SER_GETHASH, 0);\n             ss << txTo.vout[nIn];"
      }
    ]
  }
]