jonasschnelli,2019-01-12T06:17:33Z,"utACK b669ba6bd86a7808e4692bb0cf692b1c95d8d32d\n\nClarification: in master, if you start with no wallet, then load a wallet, you'll miss the selector between ""none"" and the ""loaded wallet"".\n\nThis seems to be a bugfix.",https://github.com/bitcoin/bitcoin/pull/15150#issuecomment-453723430,453723430,
hebasto,2019-01-14T14:18:48Z,"Tested on Linux Mint 19.1. Detected behavior change:\n\nIn master having ""none"" in selector implies an error output of ""getwalletinfo"":\n```\nWallet file not specified (must request wallet RPC through /wallet/<filename> uri-path). (code -19)\n```\n\nWith this PR:\n```\nbitcoin-qt -nowallet\n```\n\nThe selector value is ""none"".\n\n\nThen in Console:\n```\nloadwallet ""test_alpha""\n",https://github.com/bitcoin/bitcoin/pull/15150#issuecomment-454019873,454019873,
promag,2019-01-14T14:23:59Z,"Thanks @hebasto, will fix.\n\nIs this worth of backport?",https://github.com/bitcoin/bitcoin/pull/15150#issuecomment-454021584,454021584,
promag,2019-01-14T15:05:04Z,"@hebasto unfortunately that's not an easy fix, all wallet RPC call `GetWalletForJSONRPCRequest`:\nhttps://github.com/bitcoin/bitcoin/blob/76335298f427de7d7ce58ced177518a7905706cc/src/wallet/rpcwallet.cpp#L56-L67\nThis means that ""None"" is not really possible unless we define an endpoint for that — ""don't default to single wallet"". ",https://github.com/bitcoin/bitcoin/pull/15150#issuecomment-454035851,454035851,
hebasto,2019-01-14T15:08:32Z,@promag maybe update the wallet selector when the first wallet has been loaded?,https://github.com/bitcoin/bitcoin/pull/15150#issuecomment-454037092,454037092,
promag,2019-01-14T15:19:50Z,I don't think we should mimic the RPC server behaviour. It was done like that to avoid breaking changes and so I think the GUI should be explicit. I also think it should be possible to have a no-wallet RPC endpoint — one that no wallet is automatically used. That said I think your test case should be fixed in a separate PR.,https://github.com/bitcoin/bitcoin/pull/15150#issuecomment-454041396,454041396,
hebasto,2019-01-14T15:26:20Z,"@promag \n\n> the GUI should be explicit.\n\nRight.\n\n> That said I think your test case should be fixed in a separate PR.\n\nCould this test case be mentioned in this PR description?",https://github.com/bitcoin/bitcoin/pull/15150#issuecomment-454044004,454044004,
promag,2019-01-14T16:16:14Z,@hebasto please see/test last commit.,https://github.com/bitcoin/bitcoin/pull/15150#issuecomment-454063080,454063080,
DrahtBot,2019-01-14T16:50:24Z,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#15492](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15492.html) ([rpc] remove deprecated generate method by ",https://github.com/bitcoin/bitcoin/pull/15150#issuecomment-454076107,454076107,
promag,2019-01-20T19:15:59Z,"> but I don't understand the need for RPC ""/nowallet""\n\n@Sjors it's just an endpoint where there is no *automagic* wallet selection.\n\nThe idea is that you should explicit select the wallet and if you select ""(none)"" then wallet commands should fail, IMO.",https://github.com/bitcoin/bitcoin/pull/15150#issuecomment-455893770,455893770,
Sjors,2019-01-21T18:45:00Z,"I agree that wallet commands should fail if you select (none). But I don't understand why we need this `/nowallet` path, that feels like a hack.\n\nWhen using `bitcoin-cli` wallet commands without specifying the wallet, the RPC throws `Wallet file not specified (must request wallet RPC through /wallet/<filename> uri-path).`. That seems like a better approach; not sure how to translate that to th",https://github.com/bitcoin/bitcoin/pull/15150#issuecomment-456167394,456167394,
promag,2019-01-21T18:50:06Z,"@Sjors so `/wallet/` explicitly selects the wallet but `/` automatically selects a wallet if there's only one loaded, so we need to somehow avoid that without breaking the current behavior.",https://github.com/bitcoin/bitcoin/pull/15150#issuecomment-456168631,456168631,
Sjors,2019-01-21T19:24:25Z,"Mmm, I kind of like that behavior though. Running a node with one wallet shouldn't require `-rpcwallet` as that's tedious.\n\nIs there a scenario where this leads to the wrong result?\n\nIt might be better to hide the ""no wallet"" option when that is the case.",https://github.com/bitcoin/bitcoin/pull/15150#issuecomment-456176943,456176943,
DrahtBot,2019-03-02T15:22:00Z,<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase,https://github.com/bitcoin/bitcoin/pull/15150#issuecomment-468929796,468929796,
luke-jr,2019-04-17T06:07:54Z,"@Sjors Users might select ""(none)"" wallet with the intent of protecting their wallet from arbitrary commands they are told to run...\n\nAgree `/nowallet` seems hacky. The original implementation just passed the CWallet pointer... but it got hackily turned into a URI encoding instead. :/",https://github.com/bitcoin/bitcoin/pull/15150#issuecomment-483950023,483950023,
DrahtBot,2019-08-16T14:02:18Z,"<!--5fd3d806e98f4a0ca80977bb178665a0-->There hasn't been much activity lately and the patch still needs rebase, so I am closing this for now. Please let me know when you want to continue working on this, so the pull request can be re-opened.",https://github.com/bitcoin/bitcoin/pull/15150#issuecomment-522019640,522019640,
hebasto,2019-01-14T19:04:24Z,"Missed ""is"" causes test failures.",https://github.com/bitcoin/bitcoin/pull/15150#discussion_r247617931,247617931,src/wallet/rpcwallet.cpp
promag,2019-01-14T19:06:41Z,Ops,https://github.com/bitcoin/bitcoin/pull/15150#discussion_r247618759,247618759,src/wallet/rpcwallet.cpp
hebasto,2019-01-15T18:15:07Z,"```\nbool EnsureWalletIsAvailable(const CWallet* const pwallet, const JSONRPCRequest& request)\n```",https://github.com/bitcoin/bitcoin/pull/15150#discussion_r248005427,248005427,src/wallet/rpcwallet.cpp
hebasto,2019-01-15T18:28:05Z,"```\nbool EnsureWalletIsAvailable(const CWallet* const pwallet, const JSONRPCRequest& request);\n```",https://github.com/bitcoin/bitcoin/pull/15150#discussion_r248010011,248010011,src/wallet/rpcwallet.h
Sjors,2019-01-16T17:30:25Z,Can we just directly count the number of wallets?,https://github.com/bitcoin/bitcoin/pull/15150#discussion_r248378840,248378840,src/qt/rpcconsole.cpp
Sjors,2019-01-16T17:32:05Z,Why it safe to remove `if (wallet_index > 0) {`?,https://github.com/bitcoin/bitcoin/pull/15150#discussion_r248379467,248379467,src/qt/rpcconsole.cpp
promag,2019-01-20T19:12:29Z,"It's safe because what we want is the current `Qt::UserRole` data as `WalletModel*`. If there is none then `currentData().value<WalletModel*>()` returns `nullptr`, which is the case for the fist item.",https://github.com/bitcoin/bitcoin/pull/15150#discussion_r249291667,249291667,src/qt/rpcconsole.cpp
promag,2019-01-20T19:14:53Z,This change doesn't make the code worse. I think this can be improved later by refactoring to take advantage of the new `WalletController`.,https://github.com/bitcoin/bitcoin/pull/15150#discussion_r249291738,249291738,src/qt/rpcconsole.cpp
hebasto,2019-01-20T19:17:21Z,Why was `{}` syntax for `wallet_model` initialization dropped? It could prevent an implicit data conversion.,https://github.com/bitcoin/bitcoin/pull/15150#discussion_r249291816,249291816,src/qt/rpcconsole.cpp
promag,2019-01-20T20:39:22Z,You mean this should be `WalletModel* wallet_model{ui->WalletSelector->currentData().value<WalletModel*>()};`?,https://github.com/bitcoin/bitcoin/pull/15150#discussion_r249294668,249294668,src/qt/rpcconsole.cpp
hebasto,2019-01-20T21:47:08Z,Yes. It seems more robust.,https://github.com/bitcoin/bitcoin/pull/15150#discussion_r249297109,249297109,src/qt/rpcconsole.cpp
luke-jr,2019-04-17T06:12:57Z,Seems like `GetWalletForJSONRPCRequest` is a better place to do this?,https://github.com/bitcoin/bitcoin/pull/15150#discussion_r276091757,276091757,src/wallet/rpcwallet.cpp
