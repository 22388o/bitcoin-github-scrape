[
  {
    "sha": "ba0783e6a584ab8ed9da24cfbef74e90510e9d94",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiYTA3ODNlNmE1ODRhYjhlZDlkYTI0Y2ZiZWY3NGU5MDUxMGU5ZDk0",
    "commit": {
      "author": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2015-12-16T12:13:10Z"
      },
      "committer": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2015-12-16T12:17:01Z"
      },
      "message": "RBF: Allow replacements to pay for minRelayFee(replaced)+minRelayFee(replacement) rather than actualFee(replaced)+minRelayFee(replacement)",
      "tree": {
        "sha": "c9ee4182758215b03e7dedc09ab7ffdc6ce1bb98",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c9ee4182758215b03e7dedc09ab7ffdc6ce1bb98"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ba0783e6a584ab8ed9da24cfbef74e90510e9d94",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ba0783e6a584ab8ed9da24cfbef74e90510e9d94",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/ba0783e6a584ab8ed9da24cfbef74e90510e9d94",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ba0783e6a584ab8ed9da24cfbef74e90510e9d94/comments",
    "author": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "63b5840257a0b892228dfa9cce943b5a2bb94e1a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/63b5840257a0b892228dfa9cce943b5a2bb94e1a",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/63b5840257a0b892228dfa9cce943b5a2bb94e1a"
      }
    ],
    "stats": {
      "total": 7,
      "additions": 5,
      "deletions": 2
    },
    "files": [
      {
        "sha": "8b3f5f9908554812c100269b8040ee5ad32bb33c",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 2,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/ba0783e6a584ab8ed9da24cfbef74e90510e9d94/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/ba0783e6a584ab8ed9da24cfbef74e90510e9d94/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=ba0783e6a584ab8ed9da24cfbef74e90510e9d94",
        "patch": "@@ -1013,6 +1013,7 @@ bool AcceptToMemoryPool(CTxMemPool& pool, CValidationState &state, const CTransa\n         LOCK(pool.cs);\n         if (setConflicts.size())\n         {\n+            CAmount nConflictingMinFees = 0;\n             CFeeRate newFeeRate(nFees, nSize);\n             set<uint256> setConflictsParents;\n             const int maxDescendantsToVisit = 100;\n@@ -1085,6 +1086,7 @@ bool AcceptToMemoryPool(CTxMemPool& pool, CValidationState &state, const CTransa\n                 }\n                 BOOST_FOREACH(CTxMemPool::txiter it, allConflicting) {\n                     nConflictingFees += it->GetFee();\n+                    nConflictingMinFees += ::minRelayTxFee.GetFee(it->GetTxSize());\n                     nConflictingSize += it->GetTxSize();\n                 }\n             } else {\n@@ -1125,8 +1127,9 @@ bool AcceptToMemoryPool(CTxMemPool& pool, CValidationState &state, const CTransa\n             }\n \n             // Finally in addition to paying more fees than the conflicts the\n-            // new transaction must pay for its own bandwidth.\n-            CAmount nDeltaFees = nFees - nConflictingFees;\n+            // new transaction must pay for both its own bandwidth, and the\n+            // bandwidth of the transactions being replaced (to avoid a DoS).\n+            CAmount nDeltaFees = nFees - nConflictingMinFees;\n             if (nDeltaFees < ::minRelayTxFee.GetFee(nSize))\n             {\n                 return state.DoS(0,"
      }
    ]
  },
  {
    "sha": "1ba474aab573feb42681c03a87a463c426b08d7f",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxYmE0NzRhYWI1NzNmZWI0MjY4MWMwM2E4N2E0NjNjNDI2YjA4ZDdm",
    "commit": {
      "author": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2015-12-16T12:15:03Z"
      },
      "committer": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2015-12-16T12:17:02Z"
      },
      "message": "RBF: Avoid possible cyclic replacement DoS",
      "tree": {
        "sha": "479ae2f3ea7cd7cc782b18e4afede14a53dc5a7e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/479ae2f3ea7cd7cc782b18e4afede14a53dc5a7e"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1ba474aab573feb42681c03a87a463c426b08d7f",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1ba474aab573feb42681c03a87a463c426b08d7f",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/1ba474aab573feb42681c03a87a463c426b08d7f",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1ba474aab573feb42681c03a87a463c426b08d7f/comments",
    "author": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "ba0783e6a584ab8ed9da24cfbef74e90510e9d94",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ba0783e6a584ab8ed9da24cfbef74e90510e9d94",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/ba0783e6a584ab8ed9da24cfbef74e90510e9d94"
      }
    ],
    "stats": {
      "total": 6,
      "additions": 4,
      "deletions": 2
    },
    "files": [
      {
        "sha": "206550cedcc913bd0e94c6e170da299c2d5664d6",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 2,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1ba474aab573feb42681c03a87a463c426b08d7f/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1ba474aab573feb42681c03a87a463c426b08d7f/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=1ba474aab573feb42681c03a87a463c426b08d7f",
        "patch": "@@ -1118,8 +1118,10 @@ bool AcceptToMemoryPool(CTxMemPool& pool, CValidationState &state, const CTransa\n \n             // The replacement must pay greater fees than the transactions it\n             // replaces - if we did the bandwidth used by those conflicting\n-            // transactions would not be paid for.\n-            if (nFees < nConflictingFees)\n+            // transactions would not be paid for. Note that equal fees must be\n+            // treated as insufficient, or we would create a DoS where we would\n+            // accept the same two transactions as replacements for each other.\n+            if (nFees <= nConflictingFees)\n             {\n                 return state.DoS(0, error(\"AcceptToMemoryPool: rejecting replacement %s, less fees than conflicting txs; %s < %s\",\n                                           hash.ToString(), FormatMoney(nFees), FormatMoney(nConflictingFees)),"
      }
    ]
  }
]