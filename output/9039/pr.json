{
  "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/9039",
  "id": 91474653,
  "node_id": "MDExOlB1bGxSZXF1ZXN0OTE0NzQ2NTM=",
  "html_url": "https://github.com/bitcoin/bitcoin/pull/9039",
  "diff_url": "https://github.com/bitcoin/bitcoin/pull/9039.diff",
  "patch_url": "https://github.com/bitcoin/bitcoin/pull/9039.patch",
  "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/9039",
  "number": 9039,
  "state": "closed",
  "locked": true,
  "title": "Various serialization simplifcations and optimizations",
  "user": {
    "login": "sipa",
    "id": 548488,
    "node_id": "MDQ6VXNlcjU0ODQ4OA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sipa",
    "html_url": "https://github.com/sipa",
    "followers_url": "https://api.github.com/users/sipa/followers",
    "following_url": "https://api.github.com/users/sipa/following{/other_user}",
    "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
    "organizations_url": "https://api.github.com/users/sipa/orgs",
    "repos_url": "https://api.github.com/users/sipa/repos",
    "events_url": "https://api.github.com/users/sipa/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sipa/received_events",
    "type": "User",
    "site_admin": false
  },
  "body": "The commits in this pull request implement a sequence of changes:\n- Simplifications:\n  - **Remove unused ReadVersion and WriteVersion** CDataStream and CAutoFile had a ReadVersion and WriteVersion method that was never used. Remove them.\n  - **Make nType and nVersion private and sometimes const** Make the various stream implementations' nType and nVersion private and const (except in CDataStream where we really need a setter).\n  - **Make streams' read and write return void** The stream implementations have two layers (the upper one with operator<< and operator>>, and a lower one with read and write). The lower layer's return values are never used (nor should they, as they should only be used from the higher layer), so make them void.\n  - **Make GetSerializeSize a wrapper on top of CSizeComputer** Given that in default GetSerializeSize implementations we're already using CSizeComputer(), get rid of the specialized GetSerializeSize methods everywhere, and just use CSizeComputer. This removes a lot of code which isn't actually used anywhere. In a few places, this removes an actually more efficient size computing algorithm, which we'll bring back in the \"Add optimized CSizeComputer serializers\" commit later.\n  - **Get rid of nType and nVersion** The big change: remove the nType and nVersion as parameters to all serialization methods and functions. There is only one place where it's read and has an impact (in CAddress), and even there it does not impact any of the member objects' serializations. Instead, the few places that need nType or nVersion read it directly from the stream, through GetType and GetVersion calls which are added to all streams.\n  - **Avoid -Wshadow errors** As suggested by @paveljanik, remove the few remaining cases of variable shadowing in the serialization code.\n- Optimizations:\n  - **Make CSerAction's ForRead() constexpr** The CSerAction's ForRead() method does not depend on any runtime data, so guarantee that requests to it can be optimized out by making it constexpr (suggested by @theuni in #8580).\n  - **Add optimized CSizeComputer serializers** To get the advantages of faster GetSerializeSize implementations back, reintroduce them in the few places where they actually make a difference, in the form of a specialized Serialize implementation. This actually gets us in a better state than before, as these even get used when they're nested inside the serialization of another object.\n  - **Use fixed preallocation instead of costly GetSerializeSize** dbwrapper uses GetSerializeSize to compute the size of the buffer to preallocate. For some cases (specifically: CCoins) this requires a costly compression call. Avoid this by just using fixed size preallocations instead.\n\nThis will make it easier to address @TheBlueMatt's comments in #8580, resulting is a simpler and more efficient way to simultaneously deserialize+construct objects with const members from streams.\n\nI assume this conflicts/supersedes #8468. \n",
  "created_at": "2016-10-29T01:45:33Z",
  "updated_at": "2021-09-08T11:06:19Z",
  "closed_at": "2016-11-09T12:52:28Z",
  "merged_at": "2016-11-09T12:52:28Z",
  "merge_commit_sha": "d59a518466f6b9012666a3f9392ec12fff8830b5",
  "assignee": null,
  "assignees": [],
  "requested_reviewers": [],
  "requested_teams": [],
  "labels": [
    {
      "id": 135961,
      "node_id": "MDU6TGFiZWwxMzU5NjE=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
      "name": "Refactoring",
      "color": "E6F6D6",
      "default": false,
      "description": null
    }
  ],
  "milestone": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/21",
    "html_url": "https://github.com/bitcoin/bitcoin/milestone/21",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/21/labels",
    "id": 1823680,
    "node_id": "MDk6TWlsZXN0b25lMTgyMzY4MA==",
    "number": 21,
    "title": "0.14.0",
    "description": "",
    "creator": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 156,
    "state": "closed",
    "created_at": "2016-06-13T14:18:51Z",
    "updated_at": "2017-03-08T16:39:44Z",
    "due_on": null,
    "closed_at": "2017-03-08T16:39:44Z"
  },
  "draft": false,
  "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/9039/commits",
  "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/9039/comments",
  "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments{/number}",
  "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/9039/comments",
  "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/d59a518466f6b9012666a3f9392ec12fff8830b5",
  "head": {
    "label": "sipa:simpleserial",
    "ref": "simpleserial",
    "sha": "d59a518466f6b9012666a3f9392ec12fff8830b5",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "repo": {
      "id": 1458655,
      "node_id": "MDEwOlJlcG9zaXRvcnkxNDU4NjU1",
      "name": "bitcoin",
      "full_name": "sipa/bitcoin",
      "private": false,
      "owner": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following{/other_user}",
        "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events{/privacy}",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/sipa/bitcoin",
      "description": "Bitcoin integration/staging tree",
      "fork": true,
      "url": "https://api.github.com/repos/sipa/bitcoin",
      "forks_url": "https://api.github.com/repos/sipa/bitcoin/forks",
      "keys_url": "https://api.github.com/repos/sipa/bitcoin/keys{/key_id}",
      "collaborators_url": "https://api.github.com/repos/sipa/bitcoin/collaborators{/collaborator}",
      "teams_url": "https://api.github.com/repos/sipa/bitcoin/teams",
      "hooks_url": "https://api.github.com/repos/sipa/bitcoin/hooks",
      "issue_events_url": "https://api.github.com/repos/sipa/bitcoin/issues/events{/number}",
      "events_url": "https://api.github.com/repos/sipa/bitcoin/events",
      "assignees_url": "https://api.github.com/repos/sipa/bitcoin/assignees{/user}",
      "branches_url": "https://api.github.com/repos/sipa/bitcoin/branches{/branch}",
      "tags_url": "https://api.github.com/repos/sipa/bitcoin/tags",
      "blobs_url": "https://api.github.com/repos/sipa/bitcoin/git/blobs{/sha}",
      "git_tags_url": "https://api.github.com/repos/sipa/bitcoin/git/tags{/sha}",
      "git_refs_url": "https://api.github.com/repos/sipa/bitcoin/git/refs{/sha}",
      "trees_url": "https://api.github.com/repos/sipa/bitcoin/git/trees{/sha}",
      "statuses_url": "https://api.github.com/repos/sipa/bitcoin/statuses/{sha}",
      "languages_url": "https://api.github.com/repos/sipa/bitcoin/languages",
      "stargazers_url": "https://api.github.com/repos/sipa/bitcoin/stargazers",
      "contributors_url": "https://api.github.com/repos/sipa/bitcoin/contributors",
      "subscribers_url": "https://api.github.com/repos/sipa/bitcoin/subscribers",
      "subscription_url": "https://api.github.com/repos/sipa/bitcoin/subscription",
      "commits_url": "https://api.github.com/repos/sipa/bitcoin/commits{/sha}",
      "git_commits_url": "https://api.github.com/repos/sipa/bitcoin/git/commits{/sha}",
      "comments_url": "https://api.github.com/repos/sipa/bitcoin/comments{/number}",
      "issue_comment_url": "https://api.github.com/repos/sipa/bitcoin/issues/comments{/number}",
      "contents_url": "https://api.github.com/repos/sipa/bitcoin/contents/{+path}",
      "compare_url": "https://api.github.com/repos/sipa/bitcoin/compare/{base}...{head}",
      "merges_url": "https://api.github.com/repos/sipa/bitcoin/merges",
      "archive_url": "https://api.github.com/repos/sipa/bitcoin/{archive_format}{/ref}",
      "downloads_url": "https://api.github.com/repos/sipa/bitcoin/downloads",
      "issues_url": "https://api.github.com/repos/sipa/bitcoin/issues{/number}",
      "pulls_url": "https://api.github.com/repos/sipa/bitcoin/pulls{/number}",
      "milestones_url": "https://api.github.com/repos/sipa/bitcoin/milestones{/number}",
      "notifications_url": "https://api.github.com/repos/sipa/bitcoin/notifications{?since,all,participating}",
      "labels_url": "https://api.github.com/repos/sipa/bitcoin/labels{/name}",
      "releases_url": "https://api.github.com/repos/sipa/bitcoin/releases{/id}",
      "deployments_url": "https://api.github.com/repos/sipa/bitcoin/deployments",
      "created_at": "2011-03-09T10:46:59Z",
      "updated_at": "2021-11-17T13:31:12Z",
      "pushed_at": "2021-12-02T19:47:39Z",
      "git_url": "git://github.com/sipa/bitcoin.git",
      "ssh_url": "git@github.com:sipa/bitcoin.git",
      "clone_url": "https://github.com/sipa/bitcoin.git",
      "svn_url": "https://github.com/sipa/bitcoin",
      "homepage": "http://www.bitcoin.org",
      "size": 178648,
      "stargazers_count": 71,
      "watchers_count": 71,
      "language": "TypeScript",
      "has_issues": true,
      "has_projects": true,
      "has_downloads": false,
      "has_wiki": true,
      "has_pages": false,
      "forks_count": 18,
      "mirror_url": null,
      "archived": false,
      "disabled": false,
      "open_issues_count": 12,
      "license": {
        "key": "mit",
        "name": "MIT License",
        "spdx_id": "MIT",
        "url": "https://api.github.com/licenses/mit",
        "node_id": "MDc6TGljZW5zZTEz"
      },
      "allow_forking": true,
      "is_template": false,
      "topics": [],
      "visibility": "public",
      "forks": 18,
      "open_issues": 12,
      "watchers": 71,
      "default_branch": "lows"
    }
  },
  "base": {
    "label": "bitcoin:master",
    "ref": "master",
    "sha": "1253f8692fc3a11be9430685cd405236a68df6c3",
    "user": {
      "login": "bitcoin",
      "id": 528860,
      "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bitcoin",
      "html_url": "https://github.com/bitcoin",
      "followers_url": "https://api.github.com/users/bitcoin/followers",
      "following_url": "https://api.github.com/users/bitcoin/following{/other_user}",
      "gists_url": "https://api.github.com/users/bitcoin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bitcoin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
      "organizations_url": "https://api.github.com/users/bitcoin/orgs",
      "repos_url": "https://api.github.com/users/bitcoin/repos",
      "events_url": "https://api.github.com/users/bitcoin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bitcoin/received_events",
      "type": "Organization",
      "site_admin": false
    },
    "repo": {
      "id": 1181927,
      "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
      "name": "bitcoin",
      "full_name": "bitcoin/bitcoin",
      "private": false,
      "owner": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following{/other_user}",
        "gists_url": "https://api.github.com/users/bitcoin/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/bitcoin/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events{/privacy}",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin",
      "description": "Bitcoin Core integration/staging tree",
      "fork": false,
      "url": "https://api.github.com/repos/bitcoin/bitcoin",
      "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
      "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys{/key_id}",
      "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators{/collaborator}",
      "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
      "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
      "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events{/number}",
      "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
      "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees{/user}",
      "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches{/branch}",
      "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
      "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs{/sha}",
      "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags{/sha}",
      "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs{/sha}",
      "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees{/sha}",
      "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/{sha}",
      "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
      "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
      "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
      "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
      "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
      "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits{/sha}",
      "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits{/sha}",
      "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments{/number}",
      "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments{/number}",
      "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/{+path}",
      "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/{base}...{head}",
      "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
      "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/{archive_format}{/ref}",
      "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
      "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues{/number}",
      "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls{/number}",
      "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones{/number}",
      "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications{?since,all,participating}",
      "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels{/name}",
      "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases{/id}",
      "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
      "created_at": "2010-12-19T15:16:43Z",
      "updated_at": "2021-12-03T13:48:33Z",
      "pushed_at": "2021-12-03T13:48:49Z",
      "git_url": "git://github.com/bitcoin/bitcoin.git",
      "ssh_url": "git@github.com:bitcoin/bitcoin.git",
      "clone_url": "https://github.com/bitcoin/bitcoin.git",
      "svn_url": "https://github.com/bitcoin/bitcoin",
      "homepage": "https://bitcoincore.org/en/download",
      "size": 188505,
      "stargazers_count": 59772,
      "watchers_count": 59772,
      "language": "C++",
      "has_issues": true,
      "has_projects": true,
      "has_downloads": false,
      "has_wiki": false,
      "has_pages": false,
      "forks_count": 30724,
      "mirror_url": null,
      "archived": false,
      "disabled": false,
      "open_issues_count": 1014,
      "license": {
        "key": "mit",
        "name": "MIT License",
        "spdx_id": "MIT",
        "url": "https://api.github.com/licenses/mit",
        "node_id": "MDc6TGljZW5zZTEz"
      },
      "allow_forking": true,
      "is_template": false,
      "topics": [
        "bitcoin",
        "c-plus-plus",
        "cryptocurrency",
        "cryptography",
        "p2p"
      ],
      "visibility": "public",
      "forks": 30724,
      "open_issues": 1014,
      "watchers": 59772,
      "default_branch": "master"
    }
  },
  "_links": {
    "self": {
      "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/9039"
    },
    "html": {
      "href": "https://github.com/bitcoin/bitcoin/pull/9039"
    },
    "issue": {
      "href": "https://api.github.com/repos/bitcoin/bitcoin/issues/9039"
    },
    "comments": {
      "href": "https://api.github.com/repos/bitcoin/bitcoin/issues/9039/comments"
    },
    "review_comments": {
      "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/9039/comments"
    },
    "review_comment": {
      "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments{/number}"
    },
    "commits": {
      "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/9039/commits"
    },
    "statuses": {
      "href": "https://api.github.com/repos/bitcoin/bitcoin/statuses/d59a518466f6b9012666a3f9392ec12fff8830b5"
    }
  },
  "author_association": "MEMBER",
  "auto_merge": null,
  "active_lock_reason": "resolved",
  "merged": true,
  "mergeable": null,
  "rebaseable": null,
  "mergeable_state": "unknown",
  "merged_by": {
    "login": "laanwj",
    "id": 126646,
    "node_id": "MDQ6VXNlcjEyNjY0Ng==",
    "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/laanwj",
    "html_url": "https://github.com/laanwj",
    "followers_url": "https://api.github.com/users/laanwj/followers",
    "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
    "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
    "organizations_url": "https://api.github.com/users/laanwj/orgs",
    "repos_url": "https://api.github.com/users/laanwj/repos",
    "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
    "received_events_url": "https://api.github.com/users/laanwj/received_events",
    "type": "User",
    "site_admin": false
  },
  "comments": 21,
  "review_comments": 9,
  "maintainer_can_modify": false,
  "commits": 9,
  "additions": 409,
  "deletions": 543,
  "changed_files": 39
}