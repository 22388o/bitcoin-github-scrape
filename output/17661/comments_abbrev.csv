DrahtBot,2019-12-04 00:07:49,<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.,https://github.com/bitcoin/bitcoin/pull/17661#issuecomment-561414369,561414369,
elichai,2019-12-04 15:57:41,@MarcoFalke arghh it looks like the rebase screwed some stuff up. fixing,https://github.com/bitcoin/bitcoin/pull/17661#issuecomment-561708667,561708667,
elichai,2019-12-04 17:33:06,"I don't get it.\nthe exact same commit passes on my private travis but fails here.\nhttps://travis-ci.org/elichai/bitcoin/builds/620711066",https://github.com/bitcoin/bitcoin/pull/17661#issuecomment-561756636,561756636,
MarcoFalke,2019-12-04 21:11:26,">  the exact same commit passes on my private travis but fails here.\n\nThe depends cache is never invalidated. See bug #17248 . So when it is created once, you can break the build, but travis won't fail.",https://github.com/bitcoin/bitcoin/pull/17661#issuecomment-561840393,561840393,
elichai,2019-12-05 10:17:34,"> The depends cache is never invalidated. See bug #17248 . So when it is created once, you can break the build, but travis won't fail.\n\nThat's bad. I guess I need to remove my cache, and it might also mean that most of the testing i've done were moot :(\n",https://github.com/bitcoin/bitcoin/pull/17661#issuecomment-562064406,562064406,
elichai,2019-12-05 13:12:59,"Lol, I don't really know what happened but i'll clean the commits up now and then it should be ready",https://github.com/bitcoin/bitcoin/pull/17661#issuecomment-562123269,562123269,
MarcoFalke,2019-12-05 15:12:49,ACK a81792804b572f1bfdada2f6b0652f494f49ded5 (didn't review depends build changes),https://github.com/bitcoin/bitcoin/pull/17661#issuecomment-562172125,562172125,
MarcoFalke,2019-12-11 21:12:58,@elichai :pray: Trivial rebase. I can pick it up after that.,https://github.com/bitcoin/bitcoin/pull/17661#issuecomment-564735092,564735092,
DrahtBot,2019-12-15 08:04:40,<!--a722867cd34abeea1fadc8d60700f111-->\n### Gitian builds\n\n| File | commit c5e318aea6ad098db66e6f174f2790acc197351c<br>(master) | commit 0061b7b5af1463ee0868d08e7ee4f2e0235d6fcb<br>(master and this pull) |\n|--|--|--|\n| bitcoin-0.19.99-aarch64-linux-gnu-debug.tar.gz | [`bea40f9a3e1e3d15...`](https://drahtbot.space/gitian/bitcoin/bitcoin/c5e318aea6ad098db66e6f174f2790acc197351c/bitcoin-0.19.99-,https://github.com/bitcoin/bitcoin/pull/17661#issuecomment-565786930,565786930,
MarcoFalke,2019-12-16 15:57:34,"ACK e190000 (first commit only, didn't look at second commit)",https://github.com/bitcoin/bitcoin/pull/17661#issuecomment-566122283,566122283,
MarcoFalke,2019-12-16 17:36:01,"Why is the second commit needed? Travis passes without it, no?",https://github.com/bitcoin/bitcoin/pull/17661#issuecomment-566163549,566163549,
elichai,2019-12-16 18:04:08,"> Why is the second commit needed? Travis passes without it, no?\n\nHmm is it possible that one of your fixes somehow fixed this too? \nI'll reset my travis cache (to avoid the bug you talked about) and rerun the tests on that commit only.\nBecause when I opened the PR this was definitely a problem",https://github.com/bitcoin/bitcoin/pull/17661#issuecomment-566173914,566173914,
MarcoFalke,2019-12-16 22:17:00,I tried it in my repo and it worked: https://travis-ci.org/MarcoFalke/bitcoin-core/jobs/625746803,https://github.com/bitcoin/bitcoin/pull/17661#issuecomment-566270105,566270105,
elichai,2019-12-17 14:54:19,"> I tried it in my repo and it worked: https://travis-ci.org/MarcoFalke/bitcoin-core/jobs/625746803\n\nDone. don't think I understand what's going on in the depends anymore.",https://github.com/bitcoin/bitcoin/pull/17661#issuecomment-566575666,566575666,
MarcoFalke,2019-12-17 15:02:13,"> Done. don't think I understand what's going on in the depends anymore.\n\nNo one does, that I am aware of",https://github.com/bitcoin/bitcoin/pull/17661#issuecomment-566579288,566579288,
dongcarl,2019-12-17 15:08:28,On my `TODO` list to take a look at this week,https://github.com/bitcoin/bitcoin/pull/17661#issuecomment-566582054,566582054,
MarcoFalke,2019-12-17 15:46:20,"I'll probably just merge this. All it does is set the proper cross compile HOST, remove NO_DEPENDS=1 and remove all the packages from apt  to install.\n\n\nI broke the qemu-wrapper script in the ci system I wrote, so for proper cross-compilation and cross-running the tests in qemu (e.g. on aarch64, riscv64 or x86_64 architecture) I'll need to do a follow up pull anyway.",https://github.com/bitcoin/bitcoin/pull/17661#issuecomment-566598936,566598936,
MarcoFalke,2019-12-04 15:49:57,"```suggestion\n# If the host is s390x and wants to run the tests natively, it can set QEMU_USER_CMD to the empty string.\n```",https://github.com/bitcoin/bitcoin/pull/17661#discussion_r353823759,353823759,ci/test/00_setup_env_s390x.sh
MarcoFalke,2019-12-04 15:50:38,"```suggestion\nexport PACKAGES=""python3-zmq bsdmainutils qemu-user""\n```",https://github.com/bitcoin/bitcoin/pull/17661#discussion_r353824295,353824295,ci/test/00_setup_env_s390x.sh
MarcoFalke,2019-12-04 15:54:58,"Why?\n\nI presume because the packages are not available?\n\nhttps://packages.ubuntu.com/eoan/g++-multilib-s390x-linux-gnu\nhttps://packages.ubuntu.com/eoan/gcc-s390x-linux-gnu",https://github.com/bitcoin/bitcoin/pull/17661#discussion_r353827386,353827386,ci/test/00_setup_env_s390x.sh
MarcoFalke,2019-12-04 15:55:52,"If so, this should be reported as a bug. Looks like at least debian is working on them: https://packages.debian.org/experimental/gcc-s390x-linux-gnu",https://github.com/bitcoin/bitcoin/pull/17661#discussion_r353828014,353828014,ci/test/00_setup_env_s390x.sh
elichai,2019-12-04 15:57:23,Yes. that's the reason,https://github.com/bitcoin/bitcoin/pull/17661#discussion_r353829000,353829000,ci/test/00_setup_env_s390x.sh
elichai,2019-12-04 15:58:01,I wrote about that in the PR,https://github.com/bitcoin/bitcoin/pull/17661#discussion_r353829379,353829379,ci/test/00_setup_env_s390x.sh
MarcoFalke,2019-12-04 16:00:13,Hmm. CC @dongcarl and @fanquake for ideas on why this is needed,https://github.com/bitcoin/bitcoin/pull/17661#discussion_r353830780,353830780,ci/test/00_setup_env_s390x.sh
elichai,2019-12-04 16:39:32,Done,https://github.com/bitcoin/bitcoin/pull/17661#discussion_r353854316,353854316,ci/test/00_setup_env_s390x.sh
fanquake,2019-12-04 16:43:05,Why is `libssl1.0-dev` being added here? Can 4d238f0cc8f4bf4170f18a27adf7607a6514b79e be squashed into 15eb4924589cdd8127492d67ac94f1ff2cf8651d.,https://github.com/bitcoin/bitcoin/pull/17661#discussion_r353856397,353856397,ci/test/00_setup_env_s390x.sh
dongcarl,2019-12-04 16:47:29,"Huh... Could you try doing\n```\n$(package)_config_opts_s390x_linux = -platform linux-g++ -xplatform bitcoin-linux-g++\n```\nin `qt.mk` and seeing if that works?",https://github.com/bitcoin/bitcoin/pull/17661#discussion_r353859033,353859033,ci/test/00_setup_env_s390x.sh
elichai,2019-12-04 17:04:55,"arghh, this is because the commits are before libssl was removed and I didn't check things good enough after rebasing, sorry.",https://github.com/bitcoin/bitcoin/pull/17661#discussion_r353869704,353869704,ci/test/00_setup_env_s390x.sh
elichai,2019-12-04 17:10:13,I'll try,https://github.com/bitcoin/bitcoin/pull/17661#discussion_r353872445,353872445,ci/test/00_setup_env_s390x.sh
MarcoFalke,2019-12-04 17:20:28,"Hmm. If the host is not set, it defaults to the arch this script is executed on. This should be the same.\n\nWhat is the error you were seeing when leaving this line as is?",https://github.com/bitcoin/bitcoin/pull/17661#discussion_r353877791,353877791,ci/test/00_setup_env_s390x.sh
elichai,2019-12-04 17:21:48,"Haven't tested that yet, but i'm starting to think that this problem isn't deterministic :O somehow it passes now without it https://travis-ci.org/elichai/bitcoin/jobs/620711630?utm_medium=notification&utm_source=github_status",https://github.com/bitcoin/bitcoin/pull/17661#discussion_r353878497,353878497,ci/test/00_setup_env_s390x.sh
MarcoFalke,2019-12-04 17:37:12,On travis this is set to `s390x-ibm-linux-gnu`,https://github.com/bitcoin/bitcoin/pull/17661#discussion_r353885867,353885867,ci/test/00_setup_env_s390x.sh
dongcarl,2019-12-04 17:37:38,"> Haven't tested that yet, but i'm starting to think that this problem isn't deterministic :O somehow it passes now without it [travis-ci.org/elichai/bitcoin/jobs/620711630?utm_medium=notification&utm_source=github_status](https://travis-ci.org/elichai/bitcoin/jobs/620711630?utm_medium=notification&utm_source=github_status)\n\nThe commit hash in the original PR description does not match this on",https://github.com/bitcoin/bitcoin/pull/17661#discussion_r353886059,353886059,ci/test/00_setup_env_s390x.sh
elichai,2019-12-04 18:01:44,that it can't find the `gcc-s390x-linux-gnu` package,https://github.com/bitcoin/bitcoin/pull/17661#discussion_r353897070,353897070,ci/test/00_setup_env_s390x.sh
MarcoFalke,2019-12-04 18:51:17,"Eh? You mean `error: provided command 's390x-unknown-linux-gnu-g++' not found`?\n\nIf so, `export HOST=s390x-linux-gnu` should work",https://github.com/bitcoin/bitcoin/pull/17661#discussion_r353920628,353920628,ci/test/00_setup_env_s390x.sh
MarcoFalke,2019-12-04 18:55:48,"Sorry, forget my comment. The cross compile packages are missing either way on s390x",https://github.com/bitcoin/bitcoin/pull/17661#discussion_r353922775,353922775,ci/test/00_setup_env_s390x.sh
MarcoFalke,2019-12-04 19:14:11,"I tried cross compilation once from x86_64->s390x and it only worked with the suggestion by @dongcarl \n\n```diff\ndiff --git a/depends/packages/qt.mk b/depends/packages/qt.mk\nindex a9f82d038..2db7f26b2 100644\n--- a/depends/packages/qt.mk\n+++ b/depends/packages/qt.mk\n@@ -106,6 +106,8 @@ $(package)_config_opts += -no-feature-xml\n \n $(package)_config_opts_darwin = -no-dbus\n \n+$(pa",https://github.com/bitcoin/bitcoin/pull/17661#discussion_r353931524,353931524,ci/test/00_setup_env_s390x.sh
fanquake,2019-12-04 19:16:46,"Note: If we are applying this diff, can we make sure we put the `$(package)_config_opts_s390x_linux` line down with the other Linux options, rather than splitting up the darwin config.",https://github.com/bitcoin/bitcoin/pull/17661#discussion_r353932707,353932707,ci/test/00_setup_env_s390x.sh
elichai,2019-12-05 13:17:50,Done.,https://github.com/bitcoin/bitcoin/pull/17661#discussion_r354306055,354306055,ci/test/00_setup_env_s390x.sh
elichai,2019-12-05 13:19:43,"It works without that diff. the only problem is the `HOST`.\nwe could do a trick similiar to `QEMU_USER_CMD` where we only apply the `HOST` var if it's in qemu",https://github.com/bitcoin/bitcoin/pull/17661#discussion_r354307183,354307183,ci/test/00_setup_env_s390x.sh
MarcoFalke,2019-12-13 19:35:17,"On a second try, I think installing gcc on s390x will create the appropriate symlinks in `/usr/bin/s390x-linux-gnu-gcc -> gcc-9`\n\nThis should work:\n\n```diff\ndiff --git a/ci/test/00_setup_env_s390x.sh b/ci/test/00_setup_env_s390x.sh\nindex c17c890546..637d549553 100644\n--- a/ci/test/00_setup_env_s390x.sh\n+++ b/ci/test/00_setup_env_s390x.sh\n@@ -6,10 +6,11 @@\n \n export LC_ALL=C.U",https://github.com/bitcoin/bitcoin/pull/17661#discussion_r357800510,357800510,ci/test/00_setup_env_s390x.sh
