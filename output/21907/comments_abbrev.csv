sipsorcery,2021-05-11 12:24:13,"Started with:\n\n`bitcoin-qt.exe -walletdir=c:\`\n\nIs this error message expected? The app continues as normal once `OK` is clicked.\n\n![bitcoin-qt_walletdir](https://user-images.githubusercontent.com/197660/117813712-4f788a80-b25b-11eb-9e1d-976f73fa7b5a.png)\n\nOn `master` the message is a warning:\n\n![bitcoin_qt_warning](https://user-images.githubusercontent.com/197660/117814047-bac",https://github.com/bitcoin/bitcoin/pull/21907#issuecomment-838383740,838383740,
hebasto,2021-05-11 16:09:46,"@sipsorcery \n\n> Started with:\n> \n> `bitcoin-qt.exe -walletdir=c:\`\n> \n> Is this error message expected? The app continues as normal once `OK` is clicked.\n\nI cannot reproduce neither error message with this PR nor warning message on master. Could you share other relevant non-private options from the `bitcoin.conf`, or the `debug.log` from the beginning (where options are logged)?\n",https://github.com/bitcoin/bitcoin/pull/21907#issuecomment-838756303,838756303,
sipsorcery,2021-05-11 16:25:03,"> I cannot reproduce neither error message with this PR nor warning message on master. Could you share other relevant non-private options from the bitcoin.conf, or the debug.log from the beginning (where options are logged)?\n\nI checked my `bitcoin.conf` at the time and made sure it was empty. I've attempted to repeat the steps with a fresh configuration and have managed to delete my whole bitc",https://github.com/bitcoin/bitcoin/pull/21907#issuecomment-838782747,838782747,
hebasto,2021-05-11 16:49:15,"> > In any case, -walletdir=c:\ on windows is a bad practice :)\n> \n> Sure I was only attempting to test the fix in this PR by getting the wallet logic to scan the root drive. I don't have a `D:\` drive.\n\nWith this PR it is possible to scan C:\ without hanging the client, but it takes _really_ long time :)",https://github.com/bitcoin/bitcoin/pull/21907#issuecomment-838816484,838816484,
hebasto,2021-05-11 16:50:56,"> I don't have a `D:\` drive.\n\nA USB flash-drive could work, no?",https://github.com/bitcoin/bitcoin/pull/21907#issuecomment-838818854,838818854,
hebasto,2021-05-12 09:16:54,"Updated bd13ec6d834d4c5f20a5ff9ab41e2e9e86f32d93 -> 29c9e2c2d2015ade47ed4497926363dea3f9c59b ([pr21907.01](https://github.com/hebasto/bitcoin/commits/pr21907.01) -> [pr21907.02](https://github.com/hebasto/bitcoin/commits/pr21907.02), [diff](https://github.com/hebasto/bitcoin/compare/pr21907.01..pr21907.02)):\n\n- addressed @laanwj's [comment](https://github.com/bitcoin/bitcoin/pull/21907#discuss",https://github.com/bitcoin/bitcoin/pull/21907#issuecomment-839610690,839610690,
prayank23,2021-05-12 14:10:20,"Compiled branch for this PR\n\n1. `bitcoin-qt.exe -walletdir=E:\` I am able to see some names in File->Open Wallet\n2. `bitcoind.exe -walletdir=E:\` and `bitcoin-cli.exe listwalletdir` works fine\n\n```\n2021-05-12T13:35:53Z ListDatabases: Access is denied E:/System Volume Information -- skipping.\n```\n\nI see few names returned by `listwalletdir`\n\nACK https://github.com/bitcoin/bitc",https://github.com/bitcoin/bitcoin/pull/21907#issuecomment-839804475,839804475,
fanquake,2021-07-01 01:36:50,Backported to 0.21 in #22255.,https://github.com/bitcoin/bitcoin/pull/21907#issuecomment-871842439,871842439,
laanwj,2021-05-11 11:20:59,"Is this specific to windows? Or could this happen with directory ""access denied"" errors on other OSes as well?",https://github.com/bitcoin/bitcoin/pull/21907#discussion_r630076648,630076648,src/wallet/db.cpp
hebasto,2021-05-11 11:53:53,"> Is this specific to windows?\n\nThe error code is specific to windows.\n\n> Or could this happen with directory ""access denied"" errors on other OSes as well?\n\nYes, it could. But on other OSes the reason of ""access denied"" errors is a bad setup that a user can/should fix. On windows this situation seems common and not always fixable by a user.\n\n",https://github.com/bitcoin/bitcoin/pull/21907#discussion_r630096967,630096967,src/wallet/db.cpp
promag,2021-05-12 08:30:58,Maybe it should avoid recursion regardless of the error and platform? Is there any case where this approach is not desirable?,https://github.com/bitcoin/bitcoin/pull/21907#discussion_r630836556,630836556,src/wallet/db.cpp
hebasto,2021-05-12 08:44:42,"> Maybe it should avoid recursion regardless of the error and platform? Is there any case where this approach is not desirable?\n\nTo be sure I understand you correctly, you are suggesting do not iterate a directory if we have any error while accessing it, right?\n",https://github.com/bitcoin/bitcoin/pull/21907#discussion_r630847085,630847085,src/wallet/db.cpp
promag,2021-05-12 08:46:05,"Yes, that was my suggestion. Is there any downside of that approach?",https://github.com/bitcoin/bitcoin/pull/21907#discussion_r630848124,630848124,src/wallet/db.cpp
hebasto,2021-05-12 09:20:01,"@laanwj @promag \n\nThanks! [Updated](https://github.com/bitcoin/bitcoin/pull/21907#issuecomment-839610690).",https://github.com/bitcoin/bitcoin/pull/21907#discussion_r630873190,630873190,src/wallet/db.cpp
