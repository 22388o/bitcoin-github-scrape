DrahtBot,2020-03-24 16:18:07,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19316 ([net] Cleanup logic around connection types by amitiuttarwar)\n* #19064 (refactor: Cleanup thread ctor calls by he",https://github.com/bitcoin/bitcoin/pull/18421#issuecomment-603340799,603340799,
sipa,2020-03-24 16:19:26,Can this use the scheduler instead of using a separate thread?,https://github.com/bitcoin/bitcoin/pull/18421#issuecomment-603341645,603341645,
practicalswift,2020-03-24 16:42:00,Concept ACK,https://github.com/bitcoin/bitcoin/pull/18421#issuecomment-603356671,603356671,
naumenkogs,2020-03-24 16:42:57,@sipa yes! I simply forgot that this can be done with scheduler. Just force-pushed an update.,https://github.com/bitcoin/bitcoin/pull/18421#issuecomment-603357337,603357337,
MarcoFalke,2020-03-24 17:31:50,"> Can this use the scheduler instead of using a separate thread?\n\nWhat is the maximum time this can take? If it is unbounded, it seems that this would be a trivial DOS attack against a node, no?",https://github.com/bitcoin/bitcoin/pull/18421#issuecomment-603392699,603392699,
naumenkogs,2020-03-24 23:30:03,"@sipa I was not aware that scheduled event will block other execution threads, and now that Marco pointed out that attack, i'm thinking separate thread makes more sense? We don't want to make any assumptions about these requests executing very fast.",https://github.com/bitcoin/bitcoin/pull/18421#issuecomment-603557583,603557583,
MarcoFalke,2020-03-24 23:40:48,"`LimitValidationInterfaceQueue` is called in `ActivateBestChain`. So even validation itself can be blocked, if an attacker can make those requests go slow. Not sure if that is possible, but I wanted to raise the point.",https://github.com/bitcoin/bitcoin/pull/18421#issuecomment-603560680,603560680,
sipa,2020-03-26 00:09:23,"@naumenkogs It won't block other threads, but it will delay other events in the same scheduler. I agree that it's probably too slow for that (I don't know what latency `getaddrinfo` can have, but I expect it may be substantial). An alternative is doing it from `PeerValidationLogic::SendMessages`, once a timer expires. I'm hammering on avoiding a separate thread for this, because threads have a sig",https://github.com/bitcoin/bitcoin/pull/18421#issuecomment-604154189,604154189,
naumenkogs,2020-03-26 01:41:03,"Agreed that that RAM overhead of a new thread for just this is no good.\n\nYeah, I would say normal execution of this function takes 2s, abnormal may take...a minute even if everyone is honest, due to random internet/os glitches.\nDo we have anything in our toolset to make sure Lookup() function doesn't take more than couple seconds? I don't see anything within scheduler. Maybe it's doable to a",https://github.com/bitcoin/bitcoin/pull/18421#issuecomment-604178979,604178979,
TheBlueMatt,2020-05-08 21:40:37,I thought we had two scheduler threads? If not we should just do that and then its not a problem.,https://github.com/bitcoin/bitcoin/pull/18421#issuecomment-626032987,626032987,
DrahtBot,2020-08-12 02:43:04,"<!--cf906140f33d8803c4a75a2196329ecb-->\nüêô This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a ""draft"".</sub>",https://github.com/bitcoin/bitcoin/pull/18421#issuecomment-672501658,672501658,
naumenkogs,2021-09-29 10:35:54,"Not sure what to do with this PR.\nThe show-stopper here was the discussion around the blocking behavior of DNS queries: the options were either add a new thread or employing existing threads for such non-critical task (see [discussion](https://github.com/bitcoin/bitcoin/issues/18488)).\n\nIt kind of went nowhere, so I'm gonna close this PR for now. If you have an opinion on the way to move for",https://github.com/bitcoin/bitcoin/pull/18421#issuecomment-930055736,930055736,
MarcoFalke,2020-03-24 16:44:20,"I think this in an implementation detail which people that want to reduce their traffic are not interested in learning about.\n\nA release notes snippet would be a better place to put this, no?",https://github.com/bitcoin/bitcoin/pull/18421#discussion_r397302616,397302616,doc/reduce-traffic.md
naumenkogs,2020-03-24 16:47:55,"Yeah, I was hesitant about this part. Committed this for now simply to not ignore this. Unless someone expresses support for keeping this, I would remove this commit later.",https://github.com/bitcoin/bitcoin/pull/18421#discussion_r397305463,397305463,doc/reduce-traffic.md
MarcoFalke,2020-03-24 16:57:55,"nit: Could use doxygen comment?\n```suggestion\n/** How often to make a DNS caches updating query */\n```",https://github.com/bitcoin/bitcoin/pull/18421#discussion_r397313055,397313055,src/net.cpp
MarcoFalke,2020-03-24 17:02:53,"nit: I think this list reads easier if each entry was on its own line.\n\nnit: compile time constants should be all upper case and static\n\n```suggestion\n    static const std::vector<uint64_t> SERVICE_BITS_COMBINATIONS{\n```",https://github.com/bitcoin/bitcoin/pull/18421#discussion_r397316551,397316551,src/net.cpp
MarcoFalke,2020-03-24 17:05:34,nit: Should be removed now?,https://github.com/bitcoin/bitcoin/pull/18421#discussion_r397318427,397318427,src/net.h
MarcoFalke,2020-03-24 17:06:59,"nit: Both of the newly added methods can be `const` because they are read-only, no?\n```suggestion\n    void DNSCachesUpdate() const;\n```",https://github.com/bitcoin/bitcoin/pull/18421#discussion_r397319403,397319403,src/net.h
naumenkogs,2020-03-24 17:28:42,oops. yes!,https://github.com/bitcoin/bitcoin/pull/18421#discussion_r397334535,397334535,src/net.h
luke-jr,2020-04-22 23:39:41,How about a `-dnscloaking` option to force it on/off?,https://github.com/bitcoin/bitcoin/pull/18421#discussion_r413405312,413405312,src/net.cpp
luke-jr,2020-04-22 23:40:27,Wouldn't these be requesting the bare name without any service bit specification?,https://github.com/bitcoin/bitcoin/pull/18421#discussion_r413405590,413405590,src/net.cpp
luke-jr,2020-04-22 23:40:39,What nodes would ever request this?,https://github.com/bitcoin/bitcoin/pull/18421#discussion_r413405668,413405668,src/net.cpp
luke-jr,2020-04-22 23:42:07,Should these really be done all at the same time? No new node would batch them like this...?,https://github.com/bitcoin/bitcoin/pull/18421#discussion_r413406286,413406286,src/net.cpp
luke-jr,2020-04-22 23:45:35,Probably there should be some randomness added to the interval for each iteration?,https://github.com/bitcoin/bitcoin/pull/18421#discussion_r413407639,413407639,src/net.cpp
naumenkogs,2020-04-23 22:47:49,Good idea. Will add this config and add the documentation once we get more concept acks.,https://github.com/bitcoin/bitcoin/pull/18421#discussion_r414174191,414174191,src/net.cpp
naumenkogs,2020-04-23 22:50:05,I think this should be x1.dns.whatever.com?,https://github.com/bitcoin/bitcoin/pull/18421#discussion_r414175134,414175134,src/net.cpp
naumenkogs,2020-04-23 22:52:45,"Well, one private node in the subnet will request one combination, another private node will request another one...\n\nWhy would you want the already public node separate cache updates in time? ",https://github.com/bitcoin/bitcoin/pull/18421#discussion_r414176230,414176230,src/net.cpp
TheBlueMatt,2020-05-08 21:42:37,Can we count that such connections are from non-local addresses? Should be an extra two LoC,https://github.com/bitcoin/bitcoin/pull/18421#discussion_r422389535,422389535,src/net.cpp
practicalswift,2020-08-12 09:57:18,"This could be logged to a debug category to avoid reducing the signal to noise in the default bitcoind output? We already print too much along the lines of ""everything is working as expected"" which makes it easy to miss the more relevant ""oh, something seems broken"" log messages :)",https://github.com/bitcoin/bitcoin/pull/18421#discussion_r469145808,469145808,src/net.cpp
practicalswift,2020-08-12 09:58:02,This could be logged to a debug category to avoid reducing the signal to noise in the default bitcoind output?,https://github.com/bitcoin/bitcoin/pull/18421#discussion_r469146189,469146189,src/net.cpp
