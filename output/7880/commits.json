[
  {
    "sha": "39b467971295eb0bcd0d566a515c454185e2db32",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozOWI0Njc5NzEyOTVlYjBiY2QwZDU2NmE1MTVjNDU0MTg1ZTJkYjMy",
    "commit": {
      "author": {
        "name": "Chris Moore",
        "email": "dooglus@gmail.com",
        "date": "2016-04-15T07:32:59Z"
      },
      "committer": {
        "name": "Chris Moore",
        "email": "dooglus@gmail.com",
        "date": "2016-04-15T07:32:59Z"
      },
      "message": "Add optional 3rd parameter to fundrawtransaction allowing user to specify the change address explicitly.",
      "tree": {
        "sha": "9244cb466fbb9255d0411d23b9f3af9e92bda2c7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9244cb466fbb9255d0411d23b9f3af9e92bda2c7"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/39b467971295eb0bcd0d566a515c454185e2db32",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/39b467971295eb0bcd0d566a515c454185e2db32",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/39b467971295eb0bcd0d566a515c454185e2db32",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/39b467971295eb0bcd0d566a515c454185e2db32/comments",
    "author": {
      "login": "dooglus",
      "id": 573356,
      "node_id": "MDQ6VXNlcjU3MzM1Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/573356?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dooglus",
      "html_url": "https://github.com/dooglus",
      "followers_url": "https://api.github.com/users/dooglus/followers",
      "following_url": "https://api.github.com/users/dooglus/following{/other_user}",
      "gists_url": "https://api.github.com/users/dooglus/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dooglus/subscriptions",
      "organizations_url": "https://api.github.com/users/dooglus/orgs",
      "repos_url": "https://api.github.com/users/dooglus/repos",
      "events_url": "https://api.github.com/users/dooglus/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dooglus/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "dooglus",
      "id": 573356,
      "node_id": "MDQ6VXNlcjU3MzM1Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/573356?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dooglus",
      "html_url": "https://github.com/dooglus",
      "followers_url": "https://api.github.com/users/dooglus/followers",
      "following_url": "https://api.github.com/users/dooglus/following{/other_user}",
      "gists_url": "https://api.github.com/users/dooglus/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dooglus/subscriptions",
      "organizations_url": "https://api.github.com/users/dooglus/orgs",
      "repos_url": "https://api.github.com/users/dooglus/repos",
      "events_url": "https://api.github.com/users/dooglus/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dooglus/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "e6a4d48a9bff0bdbcca3a13de59b5e6e683a6aac",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e6a4d48a9bff0bdbcca3a13de59b5e6e683a6aac",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/e6a4d48a9bff0bdbcca3a13de59b5e6e683a6aac"
      }
    ],
    "stats": {
      "total": 24,
      "additions": 19,
      "deletions": 5
    },
    "files": [
      {
        "sha": "3c8f8af3eba771ed39af49d3a4f5d166f630687d",
        "filename": "src/wallet/rpcwallet.cpp",
        "status": "modified",
        "additions": 8,
        "deletions": 3,
        "changes": 11,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/39b467971295eb0bcd0d566a515c454185e2db32/src/wallet/rpcwallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/39b467971295eb0bcd0d566a515c454185e2db32/src/wallet/rpcwallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcwallet.cpp?ref=39b467971295eb0bcd0d566a515c454185e2db32",
        "patch": "@@ -2435,9 +2435,9 @@ UniValue fundrawtransaction(const UniValue& params, bool fHelp)\n     if (!EnsureWalletIsAvailable(fHelp))\n         return NullUniValue;\n \n-    if (fHelp || params.size() < 1 || params.size() > 2)\n+    if (fHelp || params.size() < 1 || params.size() > 3)\n         throw runtime_error(\n-                            \"fundrawtransaction \\\"hexstring\\\" includeWatching\\n\"\n+                            \"fundrawtransaction \\\"hexstring\\\" includeWatching changeAddress\\n\"\n                             \"\\nAdd inputs to a transaction until it has enough in value to meet its out value.\\n\"\n                             \"This will not modify existing inputs, and will add one change output to the outputs.\\n\"\n                             \"Note that inputs which were signed may need to be resigned after completion since in/outputs have been added.\\n\"\n@@ -2449,6 +2449,7 @@ UniValue fundrawtransaction(const UniValue& params, bool fHelp)\n                             \"\\nArguments:\\n\"\n                             \"1. \\\"hexstring\\\"     (string, required) The hex string of the raw transaction\\n\"\n                             \"2. includeWatching (boolean, optional, default false) Also select inputs which are watch only\\n\"\n+                            \"3. changeAddress   (string, optional) An address for the change output\\n\"\n                             \"\\nResult:\\n\"\n                             \"{\\n\"\n                             \"  \\\"hex\\\":       \\\"value\\\", (string)  The resulting raw transaction (hex-encoded string)\\n\"\n@@ -2481,11 +2482,15 @@ UniValue fundrawtransaction(const UniValue& params, bool fHelp)\n     if (params.size() > 1)\n         includeWatching = params[1].get_bool();\n \n+    string strChangeAddress;\n+    if (params.size() > 2)\n+        strChangeAddress = params[2].get_str();\n+\n     CMutableTransaction tx(origTx);\n     CAmount nFee;\n     string strFailReason;\n     int nChangePos = -1;\n-    if(!pwalletMain->FundTransaction(tx, nFee, nChangePos, strFailReason, includeWatching))\n+    if(!pwalletMain->FundTransaction(tx, nFee, nChangePos, strFailReason, includeWatching, strChangeAddress))\n         throw JSONRPCError(RPC_INTERNAL_ERROR, strFailReason);\n \n     UniValue result(UniValue::VOBJ);"
      },
      {
        "sha": "00cb780cff52f4b7d8829e5ced2fbc63d138ee27",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 10,
        "deletions": 1,
        "changes": 11,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/39b467971295eb0bcd0d566a515c454185e2db32/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/39b467971295eb0bcd0d566a515c454185e2db32/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=39b467971295eb0bcd0d566a515c454185e2db32",
        "patch": "@@ -1932,7 +1932,7 @@ bool CWallet::SelectCoins(const vector<COutput>& vAvailableCoins, const CAmount&\n     return res;\n }\n \n-bool CWallet::FundTransaction(CMutableTransaction& tx, CAmount &nFeeRet, int& nChangePosRet, std::string& strFailReason, bool includeWatching)\n+bool CWallet::FundTransaction(CMutableTransaction& tx, CAmount &nFeeRet, int& nChangePosRet, std::string& strFailReason, bool includeWatching, std::string& strChangeAddress)\n {\n     vector<CRecipient> vecSend;\n \n@@ -1949,6 +1949,15 @@ bool CWallet::FundTransaction(CMutableTransaction& tx, CAmount &nFeeRet, int& nC\n     BOOST_FOREACH(const CTxIn& txin, tx.vin)\n         coinControl.Select(txin.prevout);\n \n+    if (!strChangeAddress.empty()) {\n+        CBitcoinAddress changeAddress(strChangeAddress);\n+        if (!changeAddress.IsValid()) {\n+            strFailReason = _(\"Invalid change address\");\n+            return false;\n+        }\n+        coinControl.destChange = changeAddress.Get();\n+    }\n+\n     CReserveKey reservekey(this);\n     CWalletTx wtx;\n     if (!CreateTransaction(vecSend, wtx, reservekey, nFeeRet, nChangePosRet, strFailReason, &coinControl, false))"
      },
      {
        "sha": "7107e7b6f5959ac097bb2e19aba0f0937fa26bf9",
        "filename": "src/wallet/wallet.h",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/39b467971295eb0bcd0d566a515c454185e2db32/src/wallet/wallet.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/39b467971295eb0bcd0d566a515c454185e2db32/src/wallet/wallet.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.h?ref=39b467971295eb0bcd0d566a515c454185e2db32",
        "patch": "@@ -739,7 +739,7 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n      * Insert additional inputs into the transaction by\n      * calling CreateTransaction();\n      */\n-    bool FundTransaction(CMutableTransaction& tx, CAmount& nFeeRet, int& nChangePosRet, std::string& strFailReason, bool includeWatching);\n+    bool FundTransaction(CMutableTransaction& tx, CAmount& nFeeRet, int& nChangePosRet, std::string& strFailReason, bool includeWatching, std::string& strChangeAddress);\n \n     /**\n      * Create a new transaction paying the recipients with a set of coins"
      }
    ]
  }
]