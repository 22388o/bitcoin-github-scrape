[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/228567883",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8259#issuecomment-228567883",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8259",
    "id": 228567883,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIyODU2Nzg4Mw==",
    "user": {
      "login": "jl2012",
      "id": 8403418,
      "node_id": "MDQ6VXNlcjg0MDM0MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8403418?u=1987fa535c3cae3fc7804bb2ff26a78eae413fb3&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jl2012",
      "html_url": "https://github.com/jl2012",
      "followers_url": "https://api.github.com/users/jl2012/followers",
      "following_url": "https://api.github.com/users/jl2012/following{/other_user}",
      "gists_url": "https://api.github.com/users/jl2012/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jl2012/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jl2012/subscriptions",
      "organizations_url": "https://api.github.com/users/jl2012/orgs",
      "repos_url": "https://api.github.com/users/jl2012/repos",
      "events_url": "https://api.github.com/users/jl2012/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jl2012/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-06-25T20:01:32Z",
    "updated_at": "2016-06-25T20:01:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "This one is hopefully merged for versions with segwit defined on mainnet\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/228567883/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/228647612",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8259#issuecomment-228647612",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8259",
    "id": 228647612,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIyODY0NzYxMg==",
    "user": {
      "login": "dcousens",
      "id": 413395,
      "node_id": "MDQ6VXNlcjQxMzM5NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/413395?u=034ef1433a0704d9c91b57b993009b0383d6b7c0&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dcousens",
      "html_url": "https://github.com/dcousens",
      "followers_url": "https://api.github.com/users/dcousens/followers",
      "following_url": "https://api.github.com/users/dcousens/following{/other_user}",
      "gists_url": "https://api.github.com/users/dcousens/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dcousens/subscriptions",
      "organizations_url": "https://api.github.com/users/dcousens/orgs",
      "repos_url": "https://api.github.com/users/dcousens/repos",
      "events_url": "https://api.github.com/users/dcousens/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dcousens/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-06-27T03:35:46Z",
    "updated_at": "2016-06-27T03:36:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "> hashcashes\n\nhash **caches**?,  had me confused for a second haha\n\nutACK c2ea4dd\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/228647612/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/228997940",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8259#issuecomment-228997940",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8259",
    "id": 228997940,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIyODk5Nzk0MA==",
    "user": {
      "login": "NicolasDorier",
      "id": 3020646,
      "node_id": "MDQ6VXNlcjMwMjA2NDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3020646?u=256d78207f88d303d61b62060a309657276cf6cb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NicolasDorier",
      "html_url": "https://github.com/NicolasDorier",
      "followers_url": "https://api.github.com/users/NicolasDorier/followers",
      "following_url": "https://api.github.com/users/NicolasDorier/following{/other_user}",
      "gists_url": "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NicolasDorier/subscriptions",
      "organizations_url": "https://api.github.com/users/NicolasDorier/orgs",
      "repos_url": "https://api.github.com/users/NicolasDorier/repos",
      "events_url": "https://api.github.com/users/NicolasDorier/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NicolasDorier/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-06-28T09:25:03Z",
    "updated_at": "2016-06-28T09:25:03Z",
    "author_association": "CONTRIBUTOR",
    "body": "@dcousens addressed your nits in dc188d8.\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/228997940/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/229238640",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8259#issuecomment-229238640",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8259",
    "id": 229238640,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIyOTIzODY0MA==",
    "user": {
      "login": "dcousens",
      "id": 413395,
      "node_id": "MDQ6VXNlcjQxMzM5NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/413395?u=034ef1433a0704d9c91b57b993009b0383d6b7c0&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dcousens",
      "html_url": "https://github.com/dcousens",
      "followers_url": "https://api.github.com/users/dcousens/followers",
      "following_url": "https://api.github.com/users/dcousens/following{/other_user}",
      "gists_url": "https://api.github.com/users/dcousens/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dcousens/subscriptions",
      "organizations_url": "https://api.github.com/users/dcousens/orgs",
      "repos_url": "https://api.github.com/users/dcousens/repos",
      "events_url": "https://api.github.com/users/dcousens/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dcousens/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-06-29T02:18:00Z",
    "updated_at": "2016-06-29T02:18:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "utACK dc188d8\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/229238640/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/236046843",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8259#issuecomment-236046843",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8259",
    "id": 236046843,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIzNjA0Njg0Mw==",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?u=7999a16349f0df0fb273fffa18e5a955c9d3f11c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-07-28T22:41:50Z",
    "updated_at": "2016-07-28T22:43:21Z",
    "author_association": "MEMBER",
    "body": "Assume a transaction has many signatures. One is SIGHASH_SINGLE, all the others are SIGHASH_ALL | SIGHASH_ANYONECANPAY.\n\nThe first computes and stores hashPrevouts. All the others will compute hashOutputs. However, after the first call, all TrySets will not do anything, as there is already a result in the cache, so it gets computed over and over again.\n\nI think CachedHashes needs a Merge method like this:\n\n```\nvoid Merge(const CachedHashes& hashes) {\n    if (hashPrevouts.IsNull()) hashPrevouts = hashes.hashPrevout;\n    if (hashSequence.IsNull()) hashSequence = hashes.hashSequence;\n    if (hashOutputs.IsNull()) hashOutputs = hashes.hashOutputs;\n}\n```\n\nwhich can then be called from TrySet (instead of insert, use `map[txid].Merge(hashes)`).\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/236046843/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/236051694",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8259#issuecomment-236051694",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8259",
    "id": 236051694,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIzNjA1MTY5NA==",
    "user": {
      "login": "NicolasDorier",
      "id": 3020646,
      "node_id": "MDQ6VXNlcjMwMjA2NDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3020646?u=256d78207f88d303d61b62060a309657276cf6cb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NicolasDorier",
      "html_url": "https://github.com/NicolasDorier",
      "followers_url": "https://api.github.com/users/NicolasDorier/followers",
      "following_url": "https://api.github.com/users/NicolasDorier/following{/other_user}",
      "gists_url": "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NicolasDorier/subscriptions",
      "organizations_url": "https://api.github.com/users/NicolasDorier/orgs",
      "repos_url": "https://api.github.com/users/NicolasDorier/repos",
      "events_url": "https://api.github.com/users/NicolasDorier/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NicolasDorier/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-07-28T23:08:55Z",
    "updated_at": "2016-07-28T23:08:55Z",
    "author_association": "CONTRIBUTOR",
    "body": "> so it gets computed over and over again\n\nThat's not true, I would be calculating the three hashes at the same time during the SIGHASH_SINGLE.\nTake a look at the SignatureHash method, I changed it to calculate the three hashes aggressively.\n\nI prefer not doing a merge. Without a merge my lock only have to protect the internal map as CachedHashes instances are read only. If we calculate the mid states lazily, I also need to be careful about locking at the CachedHashes instance level.\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/236051694/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/236052125",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8259#issuecomment-236052125",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8259",
    "id": 236052125,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIzNjA1MjEyNQ==",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?u=7999a16349f0df0fb273fffa18e5a955c9d3f11c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-07-28T23:11:35Z",
    "updated_at": "2016-07-28T23:11:35Z",
    "author_association": "MEMBER",
    "body": "@NicolasDorier Oh, I see. I agree that the current code is fine in that case.\n\nI don't understand the argument about the lock. The Merge function would also grab the lock, and be the only code that touches the map.\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/236052125/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/236053263",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8259#issuecomment-236053263",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8259",
    "id": 236053263,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIzNjA1MzI2Mw==",
    "user": {
      "login": "NicolasDorier",
      "id": 3020646,
      "node_id": "MDQ6VXNlcjMwMjA2NDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3020646?u=256d78207f88d303d61b62060a309657276cf6cb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NicolasDorier",
      "html_url": "https://github.com/NicolasDorier",
      "followers_url": "https://api.github.com/users/NicolasDorier/followers",
      "following_url": "https://api.github.com/users/NicolasDorier/following{/other_user}",
      "gists_url": "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NicolasDorier/subscriptions",
      "organizations_url": "https://api.github.com/users/NicolasDorier/orgs",
      "repos_url": "https://api.github.com/users/NicolasDorier/repos",
      "events_url": "https://api.github.com/users/NicolasDorier/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NicolasDorier/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-07-28T23:18:47Z",
    "updated_at": "2016-07-28T23:19:19Z",
    "author_association": "CONTRIBUTOR",
    "body": "@sipa The Merge function as you did here can't grab the lock, because the lock is at the cache map level, not at the CachedHashes instance level.\n\nBut basically, if doing that way, I would need to grab the lock of the map around the Merge, as well as around any hash read of the HashedCaches instance. (so one can't read and call merge on the HashedCaches at the same time)\nThis would make lots of contention on a single lock. An alternative is to have one lock per HashedCaches... not sure if it is worth the complexity though, knowing that the only type of transaction which does not need the 3 midstate hashes are transaction which have no SIGHASH_ALL... this is very marginal case.\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/236053263/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/236075552",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8259#issuecomment-236075552",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8259",
    "id": 236075552,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIzNjA3NTU1Mg==",
    "user": {
      "login": "NicolasDorier",
      "id": 3020646,
      "node_id": "MDQ6VXNlcjMwMjA2NDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3020646?u=256d78207f88d303d61b62060a309657276cf6cb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NicolasDorier",
      "html_url": "https://github.com/NicolasDorier",
      "followers_url": "https://api.github.com/users/NicolasDorier/followers",
      "following_url": "https://api.github.com/users/NicolasDorier/following{/other_user}",
      "gists_url": "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NicolasDorier/subscriptions",
      "organizations_url": "https://api.github.com/users/NicolasDorier/orgs",
      "repos_url": "https://api.github.com/users/NicolasDorier/repos",
      "events_url": "https://api.github.com/users/NicolasDorier/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NicolasDorier/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-07-29T01:58:22Z",
    "updated_at": "2016-07-29T01:58:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "Closing this one in favor of #8422 which calculate hashes lazily.\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/236075552/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/68519098",
    "pull_request_review_id": null,
    "id": 68519098,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NTE5MDk4",
    "diff_hunk": "@@ -16,13 +17,40 @@ static const unsigned int DEFAULT_MAX_SIG_CACHE_SIZE = 40;\n \n class CPubKey;\n \n+/**\n+ * A thread safe map which caches mid state witness signature hash calculation by transaction id\n+ */\n+class CachedHashesMap\n+{\n+private:\n+    std::map<uint256, CachedHashes> map;\n+    CCriticalSection cs;\n+public:\n+    bool TryGet(uint256 txId, CachedHashes* hashes)\n+    {\n+        LOCK(cs);\n+        if(!map.count(txId))\n+            return false;\n+        *hashes = map[txId];\n+        return true;\n+    }\n+    bool TrySet(uint256 txId, const CachedHashes& hashes)\n+    {\n+        LOCK(cs);\n+        if(map.count(txId))",
    "path": "src/script/sigcache.h",
    "position": null,
    "original_position": 32,
    "commit_id": "dc188d82da8925c6b6f08a12a3ff2c1fc4d6f983",
    "original_commit_id": "c2ea4ddafcf40ed894974e2e5f22bd5625f5c1cc",
    "user": {
      "login": "dcousens",
      "id": 413395,
      "node_id": "MDQ6VXNlcjQxMzM5NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/413395?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dcousens",
      "html_url": "https://github.com/dcousens",
      "followers_url": "https://api.github.com/users/dcousens/followers",
      "following_url": "https://api.github.com/users/dcousens/following{/other_user}",
      "gists_url": "https://api.github.com/users/dcousens/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dcousens/subscriptions",
      "organizations_url": "https://api.github.com/users/dcousens/orgs",
      "repos_url": "https://api.github.com/users/dcousens/repos",
      "events_url": "https://api.github.com/users/dcousens/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dcousens/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "You could avoid two look ups (IIRC) by comparing the size of the container before and after instead.\n\nAka:\n\n``` cpp\nauto sizeBefore = map.size();\nmap.insert(txId, hashes);\nreturn map.size() != sizeBefore;\n```\n",
    "created_at": "2016-06-27T03:33:09Z",
    "updated_at": "2016-06-28T09:23:27Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8259#discussion_r68519098",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8259",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/68519098"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/8259#discussion_r68519098"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8259"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/68519098/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 40,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/68519121",
    "pull_request_review_id": null,
    "id": 68519121,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NTE5MTIx",
    "diff_hunk": "@@ -16,13 +17,40 @@ static const unsigned int DEFAULT_MAX_SIG_CACHE_SIZE = 40;\n \n class CPubKey;\n \n+/**\n+ * A thread safe map which caches mid state witness signature hash calculation by transaction id\n+ */\n+class CachedHashesMap\n+{\n+private:\n+    std::map<uint256, CachedHashes> map;\n+    CCriticalSection cs;\n+public:\n+    bool TryGet(uint256 txId, CachedHashes* hashes)\n+    {\n+        LOCK(cs);\n+        if(!map.count(txId))\n+            return false;\n+        *hashes = map[txId];\n+        return true;",
    "path": "src/script/sigcache.h",
    "position": null,
    "original_position": 27,
    "commit_id": "dc188d82da8925c6b6f08a12a3ff2c1fc4d6f983",
    "original_commit_id": "c2ea4ddafcf40ed894974e2e5f22bd5625f5c1cc",
    "user": {
      "login": "dcousens",
      "id": 413395,
      "node_id": "MDQ6VXNlcjQxMzM5NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/413395?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dcousens",
      "html_url": "https://github.com/dcousens",
      "followers_url": "https://api.github.com/users/dcousens/followers",
      "following_url": "https://api.github.com/users/dcousens/following{/other_user}",
      "gists_url": "https://api.github.com/users/dcousens/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dcousens/subscriptions",
      "organizations_url": "https://api.github.com/users/dcousens/orgs",
      "repos_url": "https://api.github.com/users/dcousens/repos",
      "events_url": "https://api.github.com/users/dcousens/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dcousens/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Why not:\n\n``` cpp\nauto iter = map.find(txId);\nif (iter == map.end()) return false;\n*hashes = iter->second;\nreturn true;\n```\n\n**edit**: fixed early-exit\n",
    "created_at": "2016-06-27T03:33:54Z",
    "updated_at": "2016-06-28T09:23:27Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8259#discussion_r68519121",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8259",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/68519121"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/8259#discussion_r68519121"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8259"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/68519121/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 36,
    "original_line": 35,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/68519324",
    "pull_request_review_id": null,
    "id": 68519324,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NTE5MzI0",
    "diff_hunk": "@@ -98,13 +98,30 @@ enum\n \n bool CheckSignatureEncoding(const std::vector<unsigned char> &vchSig, unsigned int flags, ScriptError* serror);\n \n+class CachedHashes\n+{\n+public:\n+    uint256 hashPrevouts,hashSequence,hashOutputs;",
    "path": "src/script/interpreter.h",
    "position": null,
    "original_position": 7,
    "commit_id": "dc188d82da8925c6b6f08a12a3ff2c1fc4d6f983",
    "original_commit_id": "c2ea4ddafcf40ed894974e2e5f22bd5625f5c1cc",
    "user": {
      "login": "dcousens",
      "id": 413395,
      "node_id": "MDQ6VXNlcjQxMzM5NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/413395?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dcousens",
      "html_url": "https://github.com/dcousens",
      "followers_url": "https://api.github.com/users/dcousens/followers",
      "following_url": "https://api.github.com/users/dcousens/following{/other_user}",
      "gists_url": "https://api.github.com/users/dcousens/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dcousens/subscriptions",
      "organizations_url": "https://api.github.com/users/dcousens/orgs",
      "repos_url": "https://api.github.com/users/dcousens/repos",
      "events_url": "https://api.github.com/users/dcousens/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dcousens/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "trivial: maybe spacing between names?\n",
    "created_at": "2016-06-27T03:37:23Z",
    "updated_at": "2016-06-28T09:23:27Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8259#discussion_r68519324",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8259",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/68519324"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/8259#discussion_r68519324"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8259"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/68519324/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 104,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/68519384",
    "pull_request_review_id": null,
    "id": 68519384,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NTE5Mzg0",
    "diff_hunk": "@@ -426,6 +429,7 @@ class CScriptCheck\n         std::swap(nFlags, check.nFlags);\n         std::swap(cacheStore, check.cacheStore);\n         std::swap(error, check.error);\n+        std::swap(cachedHashesMap, check.cachedHashesMap);",
    "path": "src/main.h",
    "position": 38,
    "original_position": 38,
    "commit_id": "dc188d82da8925c6b6f08a12a3ff2c1fc4d6f983",
    "original_commit_id": "c2ea4ddafcf40ed894974e2e5f22bd5625f5c1cc",
    "user": {
      "login": "dcousens",
      "id": 413395,
      "node_id": "MDQ6VXNlcjQxMzM5NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/413395?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dcousens",
      "html_url": "https://github.com/dcousens",
      "followers_url": "https://api.github.com/users/dcousens/followers",
      "following_url": "https://api.github.com/users/dcousens/following{/other_user}",
      "gists_url": "https://api.github.com/users/dcousens/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dcousens/subscriptions",
      "organizations_url": "https://api.github.com/users/dcousens/orgs",
      "repos_url": "https://api.github.com/users/dcousens/repos",
      "events_url": "https://api.github.com/users/dcousens/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dcousens/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Would this need to enforce the lock on `check`?\n",
    "created_at": "2016-06-27T03:38:46Z",
    "updated_at": "2016-06-28T09:23:27Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8259#discussion_r68519384",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8259",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/68519384"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/8259#discussion_r68519384"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8259"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/68519384/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 432,
    "original_line": 432,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/68554463",
    "pull_request_review_id": null,
    "id": 68554463,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NTU0NDYz",
    "diff_hunk": "@@ -16,13 +17,40 @@ static const unsigned int DEFAULT_MAX_SIG_CACHE_SIZE = 40;\n \n class CPubKey;\n \n+/**\n+ * A thread safe map which caches mid state witness signature hash calculation by transaction id\n+ */\n+class CachedHashesMap\n+{\n+private:\n+    std::map<uint256, CachedHashes> map;\n+    CCriticalSection cs;\n+public:\n+    bool TryGet(uint256 txId, CachedHashes* hashes)\n+    {\n+        LOCK(cs);\n+        if(!map.count(txId))\n+            return false;\n+        *hashes = map[txId];\n+        return true;\n+    }\n+    bool TrySet(uint256 txId, const CachedHashes& hashes)\n+    {\n+        LOCK(cs);\n+        if(map.count(txId))",
    "path": "src/script/sigcache.h",
    "position": null,
    "original_position": 32,
    "commit_id": "dc188d82da8925c6b6f08a12a3ff2c1fc4d6f983",
    "original_commit_id": "c2ea4ddafcf40ed894974e2e5f22bd5625f5c1cc",
    "user": {
      "login": "NicolasDorier",
      "id": 3020646,
      "node_id": "MDQ6VXNlcjMwMjA2NDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3020646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NicolasDorier",
      "html_url": "https://github.com/NicolasDorier",
      "followers_url": "https://api.github.com/users/NicolasDorier/followers",
      "following_url": "https://api.github.com/users/NicolasDorier/following{/other_user}",
      "gists_url": "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NicolasDorier/subscriptions",
      "organizations_url": "https://api.github.com/users/NicolasDorier/orgs",
      "repos_url": "https://api.github.com/users/NicolasDorier/repos",
      "events_url": "https://api.github.com/users/NicolasDorier/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NicolasDorier/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Actually, I don't think I _really_ need TrySet to return a bool.\n",
    "created_at": "2016-06-27T10:31:13Z",
    "updated_at": "2016-06-28T09:23:27Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8259#discussion_r68554463",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8259",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/68554463"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/8259#discussion_r68554463"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8259"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/68554463/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 40,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/68554603",
    "pull_request_review_id": null,
    "id": 68554603,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NTU0NjAz",
    "diff_hunk": "@@ -16,13 +17,40 @@ static const unsigned int DEFAULT_MAX_SIG_CACHE_SIZE = 40;\n \n class CPubKey;\n \n+/**\n+ * A thread safe map which caches mid state witness signature hash calculation by transaction id\n+ */\n+class CachedHashesMap\n+{\n+private:\n+    std::map<uint256, CachedHashes> map;\n+    CCriticalSection cs;\n+public:\n+    bool TryGet(uint256 txId, CachedHashes* hashes)\n+    {\n+        LOCK(cs);\n+        if(!map.count(txId))\n+            return false;\n+        *hashes = map[txId];\n+        return true;",
    "path": "src/script/sigcache.h",
    "position": null,
    "original_position": 27,
    "commit_id": "dc188d82da8925c6b6f08a12a3ff2c1fc4d6f983",
    "original_commit_id": "c2ea4ddafcf40ed894974e2e5f22bd5625f5c1cc",
    "user": {
      "login": "NicolasDorier",
      "id": 3020646,
      "node_id": "MDQ6VXNlcjMwMjA2NDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3020646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NicolasDorier",
      "html_url": "https://github.com/NicolasDorier",
      "followers_url": "https://api.github.com/users/NicolasDorier/followers",
      "following_url": "https://api.github.com/users/NicolasDorier/following{/other_user}",
      "gists_url": "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NicolasDorier/subscriptions",
      "organizations_url": "https://api.github.com/users/NicolasDorier/orgs",
      "repos_url": "https://api.github.com/users/NicolasDorier/repos",
      "events_url": "https://api.github.com/users/NicolasDorier/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NicolasDorier/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "What do you mean by \"fixed early-exit\" ?\nYes, I think your proposition is better as it makes only one lookup.\n",
    "created_at": "2016-06-27T10:32:23Z",
    "updated_at": "2016-06-28T09:23:27Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8259#discussion_r68554603",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8259",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/68554603"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/8259#discussion_r68554603"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8259"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/68554603/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 36,
    "original_line": 35,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/68583689",
    "pull_request_review_id": null,
    "id": 68583689,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NTgzNjg5",
    "diff_hunk": "@@ -426,6 +429,7 @@ class CScriptCheck\n         std::swap(nFlags, check.nFlags);\n         std::swap(cacheStore, check.cacheStore);\n         std::swap(error, check.error);\n+        std::swap(cachedHashesMap, check.cachedHashesMap);",
    "path": "src/main.h",
    "position": 38,
    "original_position": 38,
    "commit_id": "dc188d82da8925c6b6f08a12a3ff2c1fc4d6f983",
    "original_commit_id": "c2ea4ddafcf40ed894974e2e5f22bd5625f5c1cc",
    "user": {
      "login": "NicolasDorier",
      "id": 3020646,
      "node_id": "MDQ6VXNlcjMwMjA2NDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3020646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NicolasDorier",
      "html_url": "https://github.com/NicolasDorier",
      "followers_url": "https://api.github.com/users/NicolasDorier/followers",
      "following_url": "https://api.github.com/users/NicolasDorier/following{/other_user}",
      "gists_url": "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NicolasDorier/subscriptions",
      "organizations_url": "https://api.github.com/users/NicolasDorier/orgs",
      "repos_url": "https://api.github.com/users/NicolasDorier/repos",
      "events_url": "https://api.github.com/users/NicolasDorier/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NicolasDorier/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I don't understand, you mean the internal lock of cachedHashesMap ? no, the lock is only meant to protect the internal map, which is not accessed during the swap.\n",
    "created_at": "2016-06-27T14:17:17Z",
    "updated_at": "2016-06-28T09:23:27Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8259#discussion_r68583689",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8259",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/68583689"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/8259#discussion_r68583689"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8259"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/68583689/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 432,
    "original_line": 432,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/68696925",
    "pull_request_review_id": null,
    "id": 68696925,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4Njk2OTI1",
    "diff_hunk": "@@ -16,13 +17,40 @@ static const unsigned int DEFAULT_MAX_SIG_CACHE_SIZE = 40;\n \n class CPubKey;\n \n+/**\n+ * A thread safe map which caches mid state witness signature hash calculation by transaction id\n+ */\n+class CachedHashesMap\n+{\n+private:\n+    std::map<uint256, CachedHashes> map;\n+    CCriticalSection cs;\n+public:\n+    bool TryGet(uint256 txId, CachedHashes* hashes)\n+    {\n+        LOCK(cs);\n+        if(!map.count(txId))\n+            return false;\n+        *hashes = map[txId];\n+        return true;",
    "path": "src/script/sigcache.h",
    "position": null,
    "original_position": 27,
    "commit_id": "dc188d82da8925c6b6f08a12a3ff2c1fc4d6f983",
    "original_commit_id": "c2ea4ddafcf40ed894974e2e5f22bd5625f5c1cc",
    "user": {
      "login": "dcousens",
      "id": 413395,
      "node_id": "MDQ6VXNlcjQxMzM5NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/413395?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dcousens",
      "html_url": "https://github.com/dcousens",
      "followers_url": "https://api.github.com/users/dcousens/followers",
      "following_url": "https://api.github.com/users/dcousens/following{/other_user}",
      "gists_url": "https://api.github.com/users/dcousens/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dcousens/subscriptions",
      "organizations_url": "https://api.github.com/users/dcousens/orgs",
      "repos_url": "https://api.github.com/users/dcousens/repos",
      "events_url": "https://api.github.com/users/dcousens/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dcousens/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> What do you mean by \"fixed early-exit\" ?\n\nI accidentally inverted the early exit logic,  I've since fixed it,  but left the edit in case you read it in an email and followed up.\n",
    "created_at": "2016-06-28T04:44:59Z",
    "updated_at": "2016-06-28T09:23:27Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8259#discussion_r68696925",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8259",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/68696925"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/8259#discussion_r68696925"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8259"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/68696925/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 36,
    "original_line": 35,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/68697180",
    "pull_request_review_id": null,
    "id": 68697180,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4Njk3MTgw",
    "diff_hunk": "@@ -426,6 +429,7 @@ class CScriptCheck\n         std::swap(nFlags, check.nFlags);\n         std::swap(cacheStore, check.cacheStore);\n         std::swap(error, check.error);\n+        std::swap(cachedHashesMap, check.cachedHashesMap);",
    "path": "src/main.h",
    "position": 38,
    "original_position": 38,
    "commit_id": "dc188d82da8925c6b6f08a12a3ff2c1fc4d6f983",
    "original_commit_id": "c2ea4ddafcf40ed894974e2e5f22bd5625f5c1cc",
    "user": {
      "login": "dcousens",
      "id": 413395,
      "node_id": "MDQ6VXNlcjQxMzM5NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/413395?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dcousens",
      "html_url": "https://github.com/dcousens",
      "followers_url": "https://api.github.com/users/dcousens/followers",
      "following_url": "https://api.github.com/users/dcousens/following{/other_user}",
      "gists_url": "https://api.github.com/users/dcousens/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dcousens/subscriptions",
      "organizations_url": "https://api.github.com/users/dcousens/orgs",
      "repos_url": "https://api.github.com/users/dcousens/repos",
      "events_url": "https://api.github.com/users/dcousens/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dcousens/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "My logic was based on the presence of the lock implies multi-threaded access,  and this function implies the entire memory is being swapped when `swap()` is called. \nTo me,  that would imply that it should be `LOCK`'d to avoid another thread reading it during this swap.\n\nPerhaps it isn't needed for this case,  but I just figured I'd ask.\n",
    "created_at": "2016-06-28T04:49:14Z",
    "updated_at": "2016-06-28T09:23:27Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8259#discussion_r68697180",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8259",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/68697180"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/8259#discussion_r68697180"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8259"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/68697180/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 432,
    "original_line": 432,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/68716077",
    "pull_request_review_id": null,
    "id": 68716077,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NzE2MDc3",
    "diff_hunk": "@@ -426,6 +429,7 @@ class CScriptCheck\n         std::swap(nFlags, check.nFlags);\n         std::swap(cacheStore, check.cacheStore);\n         std::swap(error, check.error);\n+        std::swap(cachedHashesMap, check.cachedHashesMap);",
    "path": "src/main.h",
    "position": 38,
    "original_position": 38,
    "commit_id": "dc188d82da8925c6b6f08a12a3ff2c1fc4d6f983",
    "original_commit_id": "c2ea4ddafcf40ed894974e2e5f22bd5625f5c1cc",
    "user": {
      "login": "NicolasDorier",
      "id": 3020646,
      "node_id": "MDQ6VXNlcjMwMjA2NDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3020646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NicolasDorier",
      "html_url": "https://github.com/NicolasDorier",
      "followers_url": "https://api.github.com/users/NicolasDorier/followers",
      "following_url": "https://api.github.com/users/NicolasDorier/following{/other_user}",
      "gists_url": "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NicolasDorier/subscriptions",
      "organizations_url": "https://api.github.com/users/NicolasDorier/orgs",
      "repos_url": "https://api.github.com/users/NicolasDorier/repos",
      "events_url": "https://api.github.com/users/NicolasDorier/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NicolasDorier/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Ah I see. Well, I don't think we need it. The swap is always called before the closure is executed (which is only when we start having concurrent access)\n",
    "created_at": "2016-06-28T08:23:23Z",
    "updated_at": "2016-06-28T09:23:27Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8259#discussion_r68716077",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8259",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/68716077"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/8259#discussion_r68716077"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8259"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/68716077/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 432,
    "original_line": 432,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/72696773",
    "pull_request_review_id": null,
    "id": 72696773,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcyNjk2Nzcz",
    "diff_hunk": "@@ -1110,35 +1110,46 @@ class CTransactionSignatureSerializer {\n \n } // anon namespace\n \n-uint256 SignatureHash(const CScript& scriptCode, const CTransaction& txTo, unsigned int nIn, int nHashType, const CAmount& amount, SigVersion sigversion)\n+uint256 SignatureHash(const CScript& scriptCode, const CTransaction& txTo, unsigned int nIn, int nHashType, const CAmount& amount, SigVersion sigversion, CachedHashes* cache)",
    "path": "src/script/interpreter.cpp",
    "position": 5,
    "original_position": 5,
    "commit_id": "dc188d82da8925c6b6f08a12a3ff2c1fc4d6f983",
    "original_commit_id": "dc188d82da8925c6b6f08a12a3ff2c1fc4d6f983",
    "user": {
      "login": "jtimon",
      "id": 1008458,
      "node_id": "MDQ6VXNlcjEwMDg0NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1008458?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jtimon",
      "html_url": "https://github.com/jtimon",
      "followers_url": "https://api.github.com/users/jtimon/followers",
      "following_url": "https://api.github.com/users/jtimon/following{/other_user}",
      "gists_url": "https://api.github.com/users/jtimon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jtimon/subscriptions",
      "organizations_url": "https://api.github.com/users/jtimon/orgs",
      "repos_url": "https://api.github.com/users/jtimon/repos",
      "events_url": "https://api.github.com/users/jtimon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jtimon/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Perhaps here we can do the same trick we did with the script/sigcache to keep script/interpreter simpler and more reusable.\nping @sipa  \n",
    "created_at": "2016-07-28T20:31:47Z",
    "updated_at": "2016-07-28T20:31:47Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8259#discussion_r72696773",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8259",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/72696773"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/8259#discussion_r72696773"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8259"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/72696773/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1113,
    "original_line": 1113,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/72697198",
    "pull_request_review_id": null,
    "id": 72697198,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcyNjk3MTk4",
    "diff_hunk": "@@ -1110,35 +1110,46 @@ class CTransactionSignatureSerializer {\n \n } // anon namespace\n \n-uint256 SignatureHash(const CScript& scriptCode, const CTransaction& txTo, unsigned int nIn, int nHashType, const CAmount& amount, SigVersion sigversion)\n+uint256 SignatureHash(const CScript& scriptCode, const CTransaction& txTo, unsigned int nIn, int nHashType, const CAmount& amount, SigVersion sigversion, CachedHashes* cache)",
    "path": "src/script/interpreter.cpp",
    "position": 5,
    "original_position": 5,
    "commit_id": "dc188d82da8925c6b6f08a12a3ff2c1fc4d6f983",
    "original_commit_id": "dc188d82da8925c6b6f08a12a3ff2c1fc4d6f983",
    "user": {
      "login": "jtimon",
      "id": 1008458,
      "node_id": "MDQ6VXNlcjEwMDg0NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1008458?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jtimon",
      "html_url": "https://github.com/jtimon",
      "followers_url": "https://api.github.com/users/jtimon/followers",
      "following_url": "https://api.github.com/users/jtimon/following{/other_user}",
      "gists_url": "https://api.github.com/users/jtimon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jtimon/subscriptions",
      "organizations_url": "https://api.github.com/users/jtimon/orgs",
      "repos_url": "https://api.github.com/users/jtimon/repos",
      "events_url": "https://api.github.com/users/jtimon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jtimon/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Or maybe move SignatureHash to BaseSignatureChecker. Just brainstorming.\n",
    "created_at": "2016-07-28T20:34:32Z",
    "updated_at": "2016-07-28T20:34:32Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8259#discussion_r72697198",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8259",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/72697198"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/8259#discussion_r72697198"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8259"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/72697198/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1113,
    "original_line": 1113,
    "side": "RIGHT"
  }
]