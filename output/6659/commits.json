[
  {
    "sha": "4222ffbbb625f1e601e656061fe5b648b59af610",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0MjIyZmZiYmI2MjVmMWU2MDFlNjU2MDYxZmU1YjY0OGI1OWFmNjEw",
    "commit": {
      "author": {
        "name": "lbyyy",
        "email": "skzlbyyy@gmail.com",
        "date": "2015-09-11T07:43:09Z"
      },
      "committer": {
        "name": "lbyyy",
        "email": "skzlbyyy@gmail.com",
        "date": "2015-09-11T07:43:09Z"
      },
      "message": "Remove redundant check\n\nMost check in CheckInputs() are unnecessary when\nconnect block to block-chain if we already check\nwhen accepting to memory(transaction) pool.",
      "tree": {
        "sha": "878a39b3cafac11747310b46c5affa99d56c00cc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/878a39b3cafac11747310b46c5affa99d56c00cc"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4222ffbbb625f1e601e656061fe5b648b59af610",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4222ffbbb625f1e601e656061fe5b648b59af610",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/4222ffbbb625f1e601e656061fe5b648b59af610",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4222ffbbb625f1e601e656061fe5b648b59af610/comments",
    "author": {
      "login": "lbyyy",
      "id": 8475735,
      "node_id": "MDQ6VXNlcjg0NzU3MzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8475735?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lbyyy",
      "html_url": "https://github.com/lbyyy",
      "followers_url": "https://api.github.com/users/lbyyy/followers",
      "following_url": "https://api.github.com/users/lbyyy/following{/other_user}",
      "gists_url": "https://api.github.com/users/lbyyy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lbyyy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lbyyy/subscriptions",
      "organizations_url": "https://api.github.com/users/lbyyy/orgs",
      "repos_url": "https://api.github.com/users/lbyyy/repos",
      "events_url": "https://api.github.com/users/lbyyy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lbyyy/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "lbyyy",
      "id": 8475735,
      "node_id": "MDQ6VXNlcjg0NzU3MzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8475735?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lbyyy",
      "html_url": "https://github.com/lbyyy",
      "followers_url": "https://api.github.com/users/lbyyy/followers",
      "following_url": "https://api.github.com/users/lbyyy/following{/other_user}",
      "gists_url": "https://api.github.com/users/lbyyy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lbyyy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lbyyy/subscriptions",
      "organizations_url": "https://api.github.com/users/lbyyy/orgs",
      "repos_url": "https://api.github.com/users/lbyyy/repos",
      "events_url": "https://api.github.com/users/lbyyy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lbyyy/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "3224936bedd8fe777b23d43c253abd2c0cd95d22",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3224936bedd8fe777b23d43c253abd2c0cd95d22",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/3224936bedd8fe777b23d43c253abd2c0cd95d22"
      }
    ],
    "stats": {
      "total": 17,
      "additions": 12,
      "deletions": 5
    },
    "files": [
      {
        "sha": "2c3b5558432a5261efd08b4a48fc86dd1ac071ca",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 12,
        "deletions": 5,
        "changes": 17,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4222ffbbb625f1e601e656061fe5b648b59af610/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4222ffbbb625f1e601e656061fe5b648b59af610/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=4222ffbbb625f1e601e656061fe5b648b59af610",
        "patch": "@@ -921,6 +921,11 @@ bool AcceptToMemoryPool(CTxMemPool& pool, CValidationState &state, const CTransa\n                 REJECT_HIGHFEE, \"absurdly-high-fee\",\n                 strprintf(\"%d > %d\", nFees, ::minRelayTxFee.GetFee(nSize) * 10000));\n \n+        // This doesn't trigger the DoS code on purpose; if it did, it would make it easier\n+        // for an attacker to attempt to split the network.\n+        if (!view.HaveInputs(tx))\n+            return state.Invalid(false, 0, \"\", \"Inputs unavailable\");\n+\n         // Check against previous transactions\n         // This is done last to help prevent CPU exhaustion denial-of-service attacks.\n         if (!CheckInputs(tx, state, view, true, STANDARD_SCRIPT_VERIFY_FLAGS, true))\n@@ -1292,13 +1297,15 @@ int GetSpendHeight(const CCoinsViewCache& inputs)\n     return pindexPrev->nHeight + 1;\n }\n \n+bool ExistInPool(const CTransaction& tx) {\n+    uint256 txid = tx.GetHash();\n+    LOCK(mempool.cs);\n+    return mempool.mapTx.find(txid) != mempool.mapTx.end();\n+}\n+\n namespace Consensus {\n bool CheckTxInputs(const CTransaction& tx, CValidationState& state, const CCoinsViewCache& inputs, int nSpendHeight)\n {\n-        // This doesn't trigger the DoS code on purpose; if it did, it would make it easier\n-        // for an attacker to attempt to split the network.\n-        if (!inputs.HaveInputs(tx))\n-            return state.Invalid(false, 0, \"\", \"Inputs unavailable\");\n \n         CAmount nValueIn = 0;\n         CAmount nFees = 0;\n@@ -1778,7 +1785,7 @@ bool ConnectBlock(const CBlock& block, CValidationState& state, CBlockIndex* pin\n             nFees += view.GetValueIn(tx)-tx.GetValueOut();\n \n             std::vector<CScriptCheck> vChecks;\n-            if (!CheckInputs(tx, state, view, fScriptChecks, flags, false, nScriptCheckThreads ? &vChecks : NULL))\n+            if (!ExistInPool(tx) && !CheckInputs(tx, state, view, fScriptChecks, flags, false, nScriptCheckThreads ? &vChecks : NULL))\n                 return error(\"ConnectBlock(): CheckInputs on %s failed with %s\",\n                     tx.GetHash().ToString(), FormatStateMessage(state));\n             control.Add(vChecks);"
      }
    ]
  },
  {
    "sha": "c749d303d97f5a711369e56d516b09cc1777bf68",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpjNzQ5ZDMwM2Q5N2Y1YTcxMTM2OWU1NmQ1MTZiMDljYzE3NzdiZjY4",
    "commit": {
      "author": {
        "name": "lbyyy",
        "email": "skzlbyyy@gmail.com",
        "date": "2015-09-11T07:55:07Z"
      },
      "committer": {
        "name": "lbyyy",
        "email": "skzlbyyy@gmail.com",
        "date": "2015-09-11T07:55:07Z"
      },
      "message": "Optimize CheckBlock()\n\nCheckTransaction() check the format of transaction.\nWhile hash of transaction can guarantee transaction will not to be modified.\nSo, CheckTransaction() becomes unnecessary when in CheckBlock()\nif we already check it when accepting to memory(transaction) pool.",
      "tree": {
        "sha": "63d6274657c5bd81c3872653e7e9b3e1f7c4e957",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/63d6274657c5bd81c3872653e7e9b3e1f7c4e957"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c749d303d97f5a711369e56d516b09cc1777bf68",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c749d303d97f5a711369e56d516b09cc1777bf68",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/c749d303d97f5a711369e56d516b09cc1777bf68",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c749d303d97f5a711369e56d516b09cc1777bf68/comments",
    "author": {
      "login": "lbyyy",
      "id": 8475735,
      "node_id": "MDQ6VXNlcjg0NzU3MzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8475735?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lbyyy",
      "html_url": "https://github.com/lbyyy",
      "followers_url": "https://api.github.com/users/lbyyy/followers",
      "following_url": "https://api.github.com/users/lbyyy/following{/other_user}",
      "gists_url": "https://api.github.com/users/lbyyy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lbyyy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lbyyy/subscriptions",
      "organizations_url": "https://api.github.com/users/lbyyy/orgs",
      "repos_url": "https://api.github.com/users/lbyyy/repos",
      "events_url": "https://api.github.com/users/lbyyy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lbyyy/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "lbyyy",
      "id": 8475735,
      "node_id": "MDQ6VXNlcjg0NzU3MzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8475735?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lbyyy",
      "html_url": "https://github.com/lbyyy",
      "followers_url": "https://api.github.com/users/lbyyy/followers",
      "following_url": "https://api.github.com/users/lbyyy/following{/other_user}",
      "gists_url": "https://api.github.com/users/lbyyy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lbyyy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lbyyy/subscriptions",
      "organizations_url": "https://api.github.com/users/lbyyy/orgs",
      "repos_url": "https://api.github.com/users/lbyyy/repos",
      "events_url": "https://api.github.com/users/lbyyy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lbyyy/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "4222ffbbb625f1e601e656061fe5b648b59af610",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4222ffbbb625f1e601e656061fe5b648b59af610",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/4222ffbbb625f1e601e656061fe5b648b59af610"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 1,
      "deletions": 1
    },
    "files": [
      {
        "sha": "f14dba27047a71c474a56368bd0862ce95692e7a",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c749d303d97f5a711369e56d516b09cc1777bf68/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c749d303d97f5a711369e56d516b09cc1777bf68/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=c749d303d97f5a711369e56d516b09cc1777bf68",
        "patch": "@@ -2613,7 +2613,7 @@ bool CheckBlock(const CBlock& block, CValidationState& state, bool fCheckPOW, bo\n \n     // Check transactions\n     BOOST_FOREACH(const CTransaction& tx, block.vtx)\n-        if (!CheckTransaction(tx, state))\n+        if (!ExistInPool(tx) && !CheckTransaction(tx, state))\n             return error(\"CheckBlock(): CheckTransaction of %s failed with %s\",\n                 tx.GetHash().ToString(),\n                 FormatStateMessage(state));"
      }
    ]
  }
]