[
  {
    "sha": "bce697d7faef0d8119ba80ae583cfcce460c7f81",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiY2U2OTdkN2ZhZWYwZDgxMTliYTgwYWU1ODNjZmNjZTQ2MGM3Zjgx",
    "commit": {
      "author": {
        "name": "Gavin Andresen",
        "email": "gavinandresen@gmail.com",
        "date": "2013-05-02T20:16:03Z"
      },
      "committer": {
        "name": "Gavin Andresen",
        "email": "gavinandresen@gmail.com",
        "date": "2013-05-02T21:33:57Z"
      },
      "message": "Remove implementation of disabled opcodes\n\nSo we stop getting pull requests (like #2604) fixing problems with disabled Script opcodes.\nA hard fork would be required to re-enable these, and if we ever did that we'd require extensive review and testing.",
      "tree": {
        "sha": "41f92a848980cb53768e8248dccf9099de661fe0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/41f92a848980cb53768e8248dccf9099de661fe0"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/bce697d7faef0d8119ba80ae583cfcce460c7f81",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bce697d7faef0d8119ba80ae583cfcce460c7f81",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/bce697d7faef0d8119ba80ae583cfcce460c7f81",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bce697d7faef0d8119ba80ae583cfcce460c7f81/comments",
    "author": {
      "login": "gavinandresen",
      "id": 331997,
      "node_id": "MDQ6VXNlcjMzMTk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/331997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gavinandresen",
      "html_url": "https://github.com/gavinandresen",
      "followers_url": "https://api.github.com/users/gavinandresen/followers",
      "following_url": "https://api.github.com/users/gavinandresen/following{/other_user}",
      "gists_url": "https://api.github.com/users/gavinandresen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gavinandresen/subscriptions",
      "organizations_url": "https://api.github.com/users/gavinandresen/orgs",
      "repos_url": "https://api.github.com/users/gavinandresen/repos",
      "events_url": "https://api.github.com/users/gavinandresen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gavinandresen/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "gavinandresen",
      "id": 331997,
      "node_id": "MDQ6VXNlcjMzMTk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/331997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gavinandresen",
      "html_url": "https://github.com/gavinandresen",
      "followers_url": "https://api.github.com/users/gavinandresen/followers",
      "following_url": "https://api.github.com/users/gavinandresen/following{/other_user}",
      "gists_url": "https://api.github.com/users/gavinandresen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gavinandresen/subscriptions",
      "organizations_url": "https://api.github.com/users/gavinandresen/orgs",
      "repos_url": "https://api.github.com/users/gavinandresen/repos",
      "events_url": "https://api.github.com/users/gavinandresen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gavinandresen/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "d9dd0318e142341626619d4ec0d6eb505ee5d0fe",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d9dd0318e142341626619d4ec0d6eb505ee5d0fe",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/d9dd0318e142341626619d4ec0d6eb505ee5d0fe"
      }
    ],
    "stats": {
      "total": 167,
      "additions": 1,
      "deletions": 166
    },
    "files": [
      {
        "sha": "90066efd336665dac265bdb329bbedd20ca674c6",
        "filename": "src/script.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 166,
        "changes": 167,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/bce697d7faef0d8119ba80ae583cfcce460c7f81/src/script.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/bce697d7faef0d8119ba80ae583cfcce460c7f81/src/script.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/script.cpp?ref=bce697d7faef0d8119ba80ae583cfcce460c7f81",
        "patch": "@@ -54,32 +54,6 @@ bool CastToBool(const valtype& vch)\n     return false;\n }\n \n-//\n-// WARNING: This does not work as expected for signed integers; the sign-bit\n-// is left in place as the integer is zero-extended. The correct behavior\n-// would be to move the most significant bit of the last byte during the\n-// resize process. MakeSameSize() is currently only used by the disabled\n-// opcodes OP_AND, OP_OR, and OP_XOR.\n-//\n-void MakeSameSize(valtype& vch1, valtype& vch2)\n-{\n-    // Lengthen the shorter one\n-    if (vch1.size() < vch2.size())\n-        // PATCH:\n-        // +unsigned char msb = vch1[vch1.size()-1];\n-        // +vch1[vch1.size()-1] &= 0x7f;\n-        //  vch1.resize(vch2.size(), 0);\n-        // +vch1[vch1.size()-1] = msb;\n-        vch1.resize(vch2.size(), 0);\n-    if (vch2.size() < vch1.size())\n-        // PATCH:\n-        // +unsigned char msb = vch2[vch2.size()-1];\n-        // +vch2[vch2.size()-1] &= 0x7f;\n-        //  vch2.resize(vch1.size(), 0);\n-        // +vch2[vch2.size()-1] = msb;\n-        vch2.resize(vch1.size(), 0);\n-}\n-\n \n \n //\n@@ -361,7 +335,7 @@ bool EvalScript(vector<vector<unsigned char> >& stack, const CScript& script, co\n                 opcode == OP_MOD ||\n                 opcode == OP_LSHIFT ||\n                 opcode == OP_RSHIFT)\n-                return false;\n+                return false; // Disabled opcodes.\n \n             if (fExec && 0 <= opcode && opcode <= OP_PUSHDATA4)\n                 stack.push_back(vchPushValue);\n@@ -659,64 +633,6 @@ bool EvalScript(vector<vector<unsigned char> >& stack, const CScript& script, co\n                 break;\n \n \n-                //\n-                // Splice ops\n-                //\n-                case OP_CAT:\n-                {\n-                    // (x1 x2 -- out)\n-                    if (stack.size() < 2)\n-                        return false;\n-                    valtype& vch1 = stacktop(-2);\n-                    valtype& vch2 = stacktop(-1);\n-                    vch1.insert(vch1.end(), vch2.begin(), vch2.end());\n-                    popstack(stack);\n-                    if (stacktop(-1).size() > MAX_SCRIPT_ELEMENT_SIZE)\n-                        return false;\n-                }\n-                break;\n-\n-                case OP_SUBSTR:\n-                {\n-                    // (in begin size -- out)\n-                    if (stack.size() < 3)\n-                        return false;\n-                    valtype& vch = stacktop(-3);\n-                    int nBegin = CastToBigNum(stacktop(-2)).getint();\n-                    int nEnd = nBegin + CastToBigNum(stacktop(-1)).getint();\n-                    if (nBegin < 0 || nEnd < nBegin)\n-                        return false;\n-                    if (nBegin > (int)vch.size())\n-                        nBegin = vch.size();\n-                    if (nEnd > (int)vch.size())\n-                        nEnd = vch.size();\n-                    vch.erase(vch.begin() + nEnd, vch.end());\n-                    vch.erase(vch.begin(), vch.begin() + nBegin);\n-                    popstack(stack);\n-                    popstack(stack);\n-                }\n-                break;\n-\n-                case OP_LEFT:\n-                case OP_RIGHT:\n-                {\n-                    // (in size -- out)\n-                    if (stack.size() < 2)\n-                        return false;\n-                    valtype& vch = stacktop(-2);\n-                    int nSize = CastToBigNum(stacktop(-1)).getint();\n-                    if (nSize < 0)\n-                        return false;\n-                    if (nSize > (int)vch.size())\n-                        nSize = vch.size();\n-                    if (opcode == OP_LEFT)\n-                        vch.erase(vch.begin() + nSize, vch.end());\n-                    else\n-                        vch.erase(vch.begin(), vch.end() - nSize);\n-                    popstack(stack);\n-                }\n-                break;\n-\n                 case OP_SIZE:\n                 {\n                     // (in -- in size)\n@@ -731,51 +647,6 @@ bool EvalScript(vector<vector<unsigned char> >& stack, const CScript& script, co\n                 //\n                 // Bitwise logic\n                 //\n-                case OP_INVERT:\n-                {\n-                    // (in - out)\n-                    if (stack.size() < 1)\n-                        return false;\n-                    valtype& vch = stacktop(-1);\n-                    for (unsigned int i = 0; i < vch.size(); i++)\n-                        vch[i] = ~vch[i];\n-                }\n-                break;\n-\n-                //\n-                // WARNING: These disabled opcodes exhibit unexpected behavior\n-                // when used on signed integers due to a bug in MakeSameSize()\n-                // [see definition of MakeSameSize() above].\n-                //\n-                case OP_AND:\n-                case OP_OR:\n-                case OP_XOR:\n-                {\n-                    // (x1 x2 - out)\n-                    if (stack.size() < 2)\n-                        return false;\n-                    valtype& vch1 = stacktop(-2);\n-                    valtype& vch2 = stacktop(-1);\n-                    MakeSameSize(vch1, vch2); // <-- NOT SAFE FOR SIGNED VALUES\n-                    if (opcode == OP_AND)\n-                    {\n-                        for (unsigned int i = 0; i < vch1.size(); i++)\n-                            vch1[i] &= vch2[i];\n-                    }\n-                    else if (opcode == OP_OR)\n-                    {\n-                        for (unsigned int i = 0; i < vch1.size(); i++)\n-                            vch1[i] |= vch2[i];\n-                    }\n-                    else if (opcode == OP_XOR)\n-                    {\n-                        for (unsigned int i = 0; i < vch1.size(); i++)\n-                            vch1[i] ^= vch2[i];\n-                    }\n-                    popstack(stack);\n-                }\n-                break;\n-\n                 case OP_EQUAL:\n                 case OP_EQUALVERIFY:\n                 //case OP_NOTEQUAL: // use OP_NUMNOTEQUAL\n@@ -810,8 +681,6 @@ bool EvalScript(vector<vector<unsigned char> >& stack, const CScript& script, co\n                 //\n                 case OP_1ADD:\n                 case OP_1SUB:\n-                case OP_2MUL:\n-                case OP_2DIV:\n                 case OP_NEGATE:\n                 case OP_ABS:\n                 case OP_NOT:\n@@ -825,8 +694,6 @@ bool EvalScript(vector<vector<unsigned char> >& stack, const CScript& script, co\n                     {\n                     case OP_1ADD:       bn += bnOne; break;\n                     case OP_1SUB:       bn -= bnOne; break;\n-                    case OP_2MUL:       bn <<= 1; break;\n-                    case OP_2DIV:       bn >>= 1; break;\n                     case OP_NEGATE:     bn = -bn; break;\n                     case OP_ABS:        if (bn < bnZero) bn = -bn; break;\n                     case OP_NOT:        bn = (bn == bnZero); break;\n@@ -840,11 +707,6 @@ bool EvalScript(vector<vector<unsigned char> >& stack, const CScript& script, co\n \n                 case OP_ADD:\n                 case OP_SUB:\n-                case OP_MUL:\n-                case OP_DIV:\n-                case OP_MOD:\n-                case OP_LSHIFT:\n-                case OP_RSHIFT:\n                 case OP_BOOLAND:\n                 case OP_BOOLOR:\n                 case OP_NUMEQUAL:\n@@ -873,33 +735,6 @@ bool EvalScript(vector<vector<unsigned char> >& stack, const CScript& script, co\n                         bn = bn1 - bn2;\n                         break;\n \n-                    case OP_MUL:\n-                        if (!BN_mul(&bn, &bn1, &bn2, pctx))\n-                            return false;\n-                        break;\n-\n-                    case OP_DIV:\n-                        if (!BN_div(&bn, NULL, &bn1, &bn2, pctx))\n-                            return false;\n-                        break;\n-\n-                    case OP_MOD:\n-                        if (!BN_mod(&bn, &bn1, &bn2, pctx))\n-                            return false;\n-                        break;\n-\n-                    case OP_LSHIFT:\n-                        if (bn2 < bnZero || bn2 > CBigNum(2048))\n-                            return false;\n-                        bn = bn1 << bn2.getulong();\n-                        break;\n-\n-                    case OP_RSHIFT:\n-                        if (bn2 < bnZero || bn2 > CBigNum(2048))\n-                            return false;\n-                        bn = bn1 >> bn2.getulong();\n-                        break;\n-\n                     case OP_BOOLAND:             bn = (bn1 != bnZero && bn2 != bnZero); break;\n                     case OP_BOOLOR:              bn = (bn1 != bnZero || bn2 != bnZero); break;\n                     case OP_NUMEQUAL:            bn = (bn1 == bn2); break;"
      }
    ]
  }
]