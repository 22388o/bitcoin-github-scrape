[
  {
    "sha": "7c3712fa32b79c1c3abc73ef89990c452e22ce2b",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo3YzM3MTJmYTMyYjc5YzFjM2FiYzczZWY4OTk5MGM0NTJlMjJjZTJi",
    "commit": {
      "author": {
        "name": "klementtan",
        "email": "klementtan@gmail.com",
        "date": "2021-09-13T02:41:29Z"
      },
      "committer": {
        "name": "klementtan",
        "email": "klementtan@gmail.com",
        "date": "2021-09-20T10:52:04Z"
      },
      "message": "cli: Display all proxies in -getinfo",
      "tree": {
        "sha": "fbbbee7df498c726fcb47c85c90b0d27e15266ee",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/fbbbee7df498c726fcb47c85c90b0d27e15266ee"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7c3712fa32b79c1c3abc73ef89990c452e22ce2b",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEdzBbFgjg1umjfk4MZcjk/steXaIFAmFIZ9QACgkQZcjk/ste\nXaKt7g/8C4avctT7T3BlLl6seDbS4suERRDjcwZtUTPYZ7Yd+GWXPTsqjRO00tbS\nUQq9JPF+djCw24EGZ51ErVly0FIypI/k783fumcdj4+UXsYs5MUrJeZzJ+xxKIC+\npGlRPOHZ0opDr0YTfORpAaOyXc066cLotbIl6OxdyZKBFtH1D+/l8FhHlKkYdeU9\nKsa1XSgae10X9u7gC7eDTiFflf5C6dXmTEmX7qSh6b1QYeHKPVsYMqqekQXJyKAm\nTGgA6qg7oQp9cVFhhX7glMLz8ai2vqyJFZHIGP5ZN5pTyzHXXyeZpvbRPpOVsxIk\np/gCwsezX5fSU7fX1Fsik7PIJk9yZAkbrIudfPxX1MF5kfFlK75Zbq9s7S8Q4gqk\nO3XtHmhvpc/AKHZ3kYkRN87h3YHQ1sY2gEu1H1pWqe3j0qP518vAq4siFiRt9+0k\nt1HAQrz0yII/RlH818pBn2qWbMOllt6acD58AlUSNQF0OXInQhL1sFg4llXaKtCX\n9Lhm9uIT4tIATxgYE6fHBfpTdH+HWdeBxXEWlYgSmO4ONl0lQt19+4Dyr905LG9S\nRxE9Jseb+eZL6v/1a3Xk4GEDzLcuISYOEV4g/h6uqLVbbuJFl3nk6zuZt35iqV4u\nrkqudQAjF2xKclXDLkqPxvLHUK6R07/BRLfcxk1GV3MB+naTKNo=\n=/8/K\n-----END PGP SIGNATURE-----",
        "payload": "tree fbbbee7df498c726fcb47c85c90b0d27e15266ee\nparent de2af19dc8e8c848afbc4b43b9b4092fe263364f\nauthor klementtan <klementtan@gmail.com> 1631500889 +0800\ncommitter klementtan <klementtan@gmail.com> 1632135124 +0800\n\ncli: Display all proxies in -getinfo\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7c3712fa32b79c1c3abc73ef89990c452e22ce2b",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/7c3712fa32b79c1c3abc73ef89990c452e22ce2b",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7c3712fa32b79c1c3abc73ef89990c452e22ce2b/comments",
    "author": {
      "login": "klementtan",
      "id": 49265907,
      "node_id": "MDQ6VXNlcjQ5MjY1OTA3",
      "avatar_url": "https://avatars.githubusercontent.com/u/49265907?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/klementtan",
      "html_url": "https://github.com/klementtan",
      "followers_url": "https://api.github.com/users/klementtan/followers",
      "following_url": "https://api.github.com/users/klementtan/following{/other_user}",
      "gists_url": "https://api.github.com/users/klementtan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/klementtan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/klementtan/subscriptions",
      "organizations_url": "https://api.github.com/users/klementtan/orgs",
      "repos_url": "https://api.github.com/users/klementtan/repos",
      "events_url": "https://api.github.com/users/klementtan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/klementtan/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "klementtan",
      "id": 49265907,
      "node_id": "MDQ6VXNlcjQ5MjY1OTA3",
      "avatar_url": "https://avatars.githubusercontent.com/u/49265907?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/klementtan",
      "html_url": "https://github.com/klementtan",
      "followers_url": "https://api.github.com/users/klementtan/followers",
      "following_url": "https://api.github.com/users/klementtan/following{/other_user}",
      "gists_url": "https://api.github.com/users/klementtan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/klementtan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/klementtan/subscriptions",
      "organizations_url": "https://api.github.com/users/klementtan/orgs",
      "repos_url": "https://api.github.com/users/klementtan/repos",
      "events_url": "https://api.github.com/users/klementtan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/klementtan/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "de2af19dc8e8c848afbc4b43b9b4092fe263364f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/de2af19dc8e8c848afbc4b43b9b4092fe263364f",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/de2af19dc8e8c848afbc4b43b9b4092fe263364f"
      }
    ],
    "stats": {
      "total": 35,
      "additions": 30,
      "deletions": 5
    },
    "files": [
      {
        "sha": "d6e7298fd039756260c887081a5f1007aa52c891",
        "filename": "src/bitcoin-cli.cpp",
        "status": "modified",
        "additions": 21,
        "deletions": 3,
        "changes": 24,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7c3712fa32b79c1c3abc73ef89990c452e22ce2b/src/bitcoin-cli.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7c3712fa32b79c1c3abc73ef89990c452e22ce2b/src/bitcoin-cli.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bitcoin-cli.cpp?ref=7c3712fa32b79c1c3abc73ef89990c452e22ce2b",
        "patch": "@@ -337,7 +337,7 @@ class GetinfoRequestHandler: public BaseRequestHandler\n         connections.pushKV(\"total\", batch[ID_NETWORKINFO][\"result\"][\"connections\"]);\n         result.pushKV(\"connections\", connections);\n \n-        result.pushKV(\"proxy\", batch[ID_NETWORKINFO][\"result\"][\"networks\"][0][\"proxy\"]);\n+        result.pushKV(\"networks\", batch[ID_NETWORKINFO][\"result\"][\"networks\"]);\n         result.pushKV(\"difficulty\", batch[ID_BLOCKCHAININFO][\"result\"][\"difficulty\"]);\n         result.pushKV(\"chain\", UniValue(batch[ID_BLOCKCHAININFO][\"result\"][\"chain\"]));\n         if (!batch[ID_WALLETINFO][\"result\"].isNull()) {\n@@ -986,8 +986,26 @@ static void ParseGetInfoResult(UniValue& result)\n         RESET);\n     result_string += strprintf(\"Version: %s\\n\", result[\"version\"].getValStr());\n     result_string += strprintf(\"Time offset (s): %s\\n\", result[\"timeoffset\"].getValStr());\n-    const std::string proxy = result[\"proxy\"].getValStr();\n-    result_string += strprintf(\"Proxy: %s\\n\", proxy.empty() ? \"N/A\" : proxy);\n+\n+    // proxies\n+    std::map<std::string, std::vector<std::string>> proxy_networks;\n+    std::vector<std::string> ordered_proxies;\n+\n+    for (const UniValue& network : result[\"networks\"].getValues()) {\n+        const std::string proxy = network[\"proxy\"].getValStr();\n+        if (proxy.empty()) continue;\n+        // Add proxy to ordered_proxy if has not been processed\n+        if (proxy_networks.find(proxy) == proxy_networks.end()) ordered_proxies.push_back(proxy);\n+\n+        proxy_networks[proxy].push_back(network[\"name\"].getValStr());\n+    }\n+\n+    std::vector<std::string> formatted_proxies;\n+    for (const std::string& proxy : ordered_proxies) {\n+        formatted_proxies.emplace_back(strprintf(\"%s (%s)\", proxy, Join(proxy_networks.find(proxy)->second, \", \")));\n+    }\n+    result_string += strprintf(\"Proxies: %s\\n\", formatted_proxies.empty() ? \"n/a\" : Join(formatted_proxies, \", \"));\n+\n     result_string += strprintf(\"Min tx relay fee rate (%s/kvB): %s\\n\\n\", CURRENCY_UNIT, result[\"relayfee\"].getValStr());\n \n     if (!result[\"has_wallet\"].isNull()) {"
      },
      {
        "sha": "c28186cde718a3ca8feb0d9187bd732856d6d31c",
        "filename": "test/functional/interface_bitcoin_cli.py",
        "status": "modified",
        "additions": 9,
        "deletions": 2,
        "changes": 11,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7c3712fa32b79c1c3abc73ef89990c452e22ce2b/test/functional/interface_bitcoin_cli.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7c3712fa32b79c1c3abc73ef89990c452e22ce2b/test/functional/interface_bitcoin_cli.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/interface_bitcoin_cli.py?ref=7c3712fa32b79c1c3abc73ef89990c452e22ce2b",
        "patch": "@@ -57,7 +57,7 @@ def cli_get_info_string_to_dict(cli_get_info_string):\n             if key == 'Wallet' and value == '\"\"':\n                 # Set default wallet(\"\") to empty string\n                 value = ''\n-            if key == \"Proxy\" and value == \"N/A\":\n+            if key == \"Proxies\" and value == \"n/a\":\n                 # Set N/A to empty string to represent no proxy\n                 value = ''\n             cli_get_info[key.strip()] = value.strip()\n@@ -127,10 +127,17 @@ def run_test(self):\n         assert_equal(int(cli_get_info['Time offset (s)']), network_info['timeoffset'])\n         expected_network_info = f\"in {network_info['connections_in']}, out {network_info['connections_out']}, total {network_info['connections']}\"\n         assert_equal(cli_get_info[\"Network\"], expected_network_info)\n-        assert_equal(cli_get_info['Proxy'], network_info['networks'][0]['proxy'])\n+        assert_equal(cli_get_info['Proxies'], network_info['networks'][0]['proxy'])\n         assert_equal(Decimal(cli_get_info['Difficulty']), blockchain_info['difficulty'])\n         assert_equal(cli_get_info['Chain'], blockchain_info['chain'])\n \n+        self.log.info(\"Test -getinfo and bitcoin-cli return all proxies\")\n+        self.restart_node(0, extra_args=[\"-proxy=127.0.0.1:9050\", \"-i2psam=127.0.0.1:7656\"])\n+        network_info = self.nodes[0].getnetworkinfo()\n+        cli_get_info_string = self.nodes[0].cli('-getinfo').send_cli()\n+        cli_get_info = cli_get_info_string_to_dict(cli_get_info_string)\n+        assert_equal(cli_get_info[\"Proxies\"], \"127.0.0.1:9050 (ipv4, ipv6, onion), 127.0.0.1:7656 (i2p)\")\n+\n         if self.is_wallet_compiled():\n             self.log.info(\"Test -getinfo and bitcoin-cli getwalletinfo return expected wallet info\")\n             assert_equal(Decimal(cli_get_info['Balance']), BALANCE)"
      }
    ]
  }
]