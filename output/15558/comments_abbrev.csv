DrahtBot,2019-03-07T23:51:16Z,<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.,https://github.com/bitcoin/bitcoin/pull/15558#issuecomment-470748173,470748173,
luke-jr,2019-03-08T02:57:07Z,"Wouldn't this mean if one DNS seed is compromised, it could potentially feed sybil addresses to nodes and its victims wouldn't have any honest nodes (eg, from other DNS seeds)?\n\nDoes the issue it intends to address actually exist? I would think DNS queries would get cached and proxied by ISP DNS servers sufficiently to deny any information to the real DNS servers, no?",https://github.com/bitcoin/bitcoin/pull/15558#issuecomment-470786101,470786101,
jimpo,2019-03-08T06:05:35Z,"3 seems like an OK number to query for at once, but a reasonable thing to bikeshed a bit.\n\nCode looks good to me.",https://github.com/bitcoin/bitcoin/pull/15558#issuecomment-470816781,470816781,
gmaxwell,2019-03-08T10:09:35Z,"Yeah, my comment in IRC was that one creates an immediate eclipse vulnerability.  Three sounds reasonable.\n\nWe also really should look at why this is triggered as much as it is, locally I see it run on every restart these days.",https://github.com/bitcoin/bitcoin/pull/15558#issuecomment-470875656,470875656,
laanwj,2019-03-09T05:19:06Z,"Concept ACK.\n\n> Yeah, my comment in IRC was that one creates an immediate eclipse vulnerability. Three sounds reasonable.\n\nBut only for new nodes, I suppose? If it already has gossiped peers before, then 'query one DNS seed' seems more reasonable. But okay, 3 is a safer option in any case.\n\n> We also really should look at why this is triggered as much as it is, locally I see it run on ",https://github.com/bitcoin/bitcoin/pull/15558#issuecomment-471147040,471147040,
gmaxwell,2019-03-09T06:20:57Z,"It may just be that we need to try connections faster initially. ... I dunno I really have the impression that it was frequently not using dns seeds in the past but is now, but I don't have hard data to support that. In theory feelers should mean that our tried table is better than ever before, but it might just be that there has been a lot of node churn lately.",https://github.com/bitcoin/bitcoin/pull/15558#issuecomment-471150395,471150395,
jgarzik,2019-03-09T18:25:17Z,"When the code was added circa 2014 in 2e7009d67b862cf822a1c70e181de6af659a3096, 11 seconds was completely arbitrary.   It was always the intent to adjust that number based on field experience.  It sounds like it needs to increase.\n\nThe driving theory is to make DNS seeds a fallback and ""give it a good try"" to avoid querying DNS seeds at all.\n\nThe code already skips the delay for an empty A",https://github.com/bitcoin/bitcoin/pull/15558#issuecomment-471208937,471208937,
luke-jr,2019-03-10T02:03:46Z,"> It boils down to a question of how much dependence should a node have on DNS seeds, in general? \n\nIMO nodes should only consult DNS seeds at first run, and then never again.",https://github.com/bitcoin/bitcoin/pull/15558#issuecomment-471239506,471239506,
jonasschnelli,2019-03-15T06:16:58Z,Concept ACK,https://github.com/bitcoin/bitcoin/pull/15558#issuecomment-473171758,473171758,
Sjors,2019-03-15T16:57:03Z,"Concept ACK with > 1 seed per round.\n\nutACK 9f36b04fa039d4ddbd9a4b559a62a5d6e1a873e5 (3 seeds)\n\nThe frequent DNS queries recently have hopefully been addressed with #15486. \n\n> IMO nodes should only consult DNS seeds at first run, and then never again.\n\nI like that idea as well, but for another PR, as it requires much more thought than this change.\n\n> 11 seconds was completely ",https://github.com/bitcoin/bitcoin/pull/15558#issuecomment-473364080,473364080,
fanquake,2019-08-04T06:16:51Z,"@naumenkogs Did you want to take a look here? \n\nThis has a number of Concept ACKs, have tagged with `0.19.0`.",https://github.com/bitcoin/bitcoin/pull/15558#issuecomment-517977282,517977282,
practicalswift,2019-08-04T14:32:15Z,Concept ACK,https://github.com/bitcoin/bitcoin/pull/15558#issuecomment-518008426,518008426,
naumenkogs,2019-08-05T15:11:34Z,"First of all, could we update the initial message of the PR so that it's clear that it suggests connecting to 3 (*not one*) without reading full discussion? Maybe strike-through would work.\n\nThe choice of 3 seeds and the general idea seems reasonable to me.\nutACK\n\n\n",https://github.com/bitcoin/bitcoin/pull/15558#issuecomment-518275038,518275038,
sipa,2019-08-07T00:26:06Z,Addressed the comments above.,https://github.com/bitcoin/bitcoin/pull/15558#issuecomment-518891719,518891719,
Sjors,2019-08-07T14:23:12Z,"ACK 6170ec5d3\n\nWith `-forcednsseed=1` it now fetches all (testnet) seeds.\n\nWhen I restart it sometimes fetches (3) seeds, about 10 seconds after `dnsseed thread start`. Other times it finds several outbound nodes and the DNS seed exited. \n\nWhen I delete `peers.dat` it uses all DNS seeds.",https://github.com/bitcoin/bitcoin/pull/15558#issuecomment-519119962,519119962,
TheBlueMatt,2019-09-07T17:38:54Z,"One high-level concern with this is the monoculture of DNS seed software we have, if you select three at random you're almost certain to get three seeds serving from sipa's seeder implementation, whereas we should really be trying to diversify a little bit (not to mention get things like dnssec going, which I dont believe sipa's seeder support). Otherwise, Concept ACK.",https://github.com/bitcoin/bitcoin/pull/15558#issuecomment-529128985,529128985,
fanquake,2019-09-13T02:06:01Z,"@naumenkogs @luke-jr Did you want to re-review here?\n\n@sdaftuar This might also interest you?",https://github.com/bitcoin/bitcoin/pull/15558#issuecomment-531071650,531071650,
sdaftuar,2019-09-18T12:33:56Z,ACK 6170ec5d3ac2bc206068b270e5722a7ecd3a8f26,https://github.com/bitcoin/bitcoin/pull/15558#issuecomment-532663432,532663432,
jonasschnelli,2019-09-18T12:51:28Z,utACK 6170ec5d3ac2bc206068b270e5722a7ecd3a8f26 - I think the risk of a single seeder codebase is orthogonal to this PR. Such risks could also be interpreted differently (diversity could also increase the risk based on the threat model).,https://github.com/bitcoin/bitcoin/pull/15558#issuecomment-532669748,532669748,
fanquake,2019-09-23T04:46:37Z,"> One high-level concern with this is the monoculture of DNS seed software we have, if you select three at random you're almost certain to get three seeds serving from sipa's seeder implementation, whereas we should really be trying to diversify a little bit (not to mention get things like dnssec going, which I dont believe sipa's seeder support). \n\nOpened #16938 if anyone wants to brainstorm ",https://github.com/bitcoin/bitcoin/pull/15558#issuecomment-533958576,533958576,
MarcoFalke,2019-09-23T14:08:34Z,"> Change this to to only query three randomly-selected DNS seed. If 11 seconds later we still don't have enough connections, try again with another one, and so on\n\nI guess this should say ""try again with another *three*""\n\n```\n\n2019-09-23T14:06:29Z Loading addresses from DNS seed seed.bitcoin.sipa.be\n2019-09-23T14:06:29Z Loading addresses from DNS seed seed.bitcoin.sprovoost.nl\n2019",https://github.com/bitcoin/bitcoin/pull/15558#issuecomment-534115760,534115760,
luke-jr,2019-04-17T20:00:20Z,"If the user specifies `-forcednsseed`, they might want/expect all of them to be queried?",https://github.com/bitcoin/bitcoin/pull/15558#discussion_r276410000,276410000,src/net.cpp
luke-jr,2019-04-17T20:03:26Z,I think this might be more readable if the std::string type remained explicit here (since we LogPrintf it below).,https://github.com/bitcoin/bitcoin/pull/15558#discussion_r276411035,276411035,src/net.cpp
sipa,2019-08-07T00:25:27Z,Done.,https://github.com/bitcoin/bitcoin/pull/15558#discussion_r311326690,311326690,src/net.cpp
sipa,2019-08-07T00:25:44Z,Fine.,https://github.com/bitcoin/bitcoin/pull/15558#discussion_r311326750,311326750,src/net.cpp
fanquake,2019-09-23T04:38:16Z,"> goal: only query DNS seed if address need is acute\n\nFrom my understanding, ""acute"" here is essentially on first run, or if you've got a `peers.dat` with low quality/unlikely to connect quickly peers?",https://github.com/bitcoin/bitcoin/pull/15558#discussion_r326947136,326947136,src/net.cpp
ajtowns,2019-09-24T04:23:54Z,"Post-merge review: I think there's a bug here: if this loop is hit with `addrman.size()==0` and `seeds_right_now==0` it will then query the first seed, and set `seeds_right_now==-1`, at which point this condition will keep failing on future loops, preventing a delay between batches of 3 seeds, and preventing early exit. I think this means that new nodes with no peers.dat will still always immediat",https://github.com/bitcoin/bitcoin/pull/15558#discussion_r327421987,327421987,src/net.cpp
sdaftuar,2019-09-24T14:21:28Z,"My understanding was that this was intentional behavior (eg @Sjors  points this out in https://github.com/bitcoin/bitcoin/pull/15558#issuecomment-519119962), but perhaps this should be better commented.\n\nIt made sense to me that we would query all dns seeds when starting up for the first time, which is consistent with prior behavior, and that the purpose of this PR was to limit dns seed usage ",https://github.com/bitcoin/bitcoin/pull/15558#discussion_r327643907,327643907,src/net.cpp
ajtowns,2019-09-24T14:53:29Z,"Seems surprising to me. If it's intentional, could simplify the logic a bit, and make it:\n\n```\nif (forcednsseed || addrman.size() == 0) seeds_right_now = seeds.size();\nfor (seed : seeds) {\n    if (seeds_right_now == 0) { sleep(); check(); seeds_right_now += 3; }\n    lookup();\n    --seeds_right_now;\n}\n```",https://github.com/bitcoin/bitcoin/pull/15558#discussion_r327663011,327663011,src/net.cpp
jgarzik,2019-09-24T15:10:11Z,"Aligning with the code comments that are quoted above + @luke-jr 's comments in related PR, this seems like an adequate summary?\n* Newly initialized nodes with no addrman data should query seeds immediately\n* Nodes with healthy addrman should not query seeds at all\n\nThe latter point seems to maximally align with the code comment & user privacy",https://github.com/bitcoin/bitcoin/pull/15558#discussion_r327672786,327672786,src/net.cpp
