[
  {
    "sha": "fd9d6eebc1eabb4675a118d19d38283da2dead39",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmZDlkNmVlYmMxZWFiYjQ2NzVhMTE4ZDE5ZDM4MjgzZGEyZGVhZDM5",
    "commit": {
      "author": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2019-12-05T23:01:30Z"
      },
      "committer": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2019-12-06T20:05:08Z"
      },
      "message": "Add GetEncryptionKey() and HasEncryptionKeys() to WalletStorage\n\nAdds functions in WalletStorage that allow ScriptPubKeyMans to check\nand get encryption keys from the wallet.",
      "tree": {
        "sha": "94b31da8c4ac4ee1cd54250ed4417d294446c961",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/94b31da8c4ac4ee1cd54250ed4417d294446c961"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fd9d6eebc1eabb4675a118d19d38283da2dead39",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fd9d6eebc1eabb4675a118d19d38283da2dead39",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fd9d6eebc1eabb4675a118d19d38283da2dead39",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fd9d6eebc1eabb4675a118d19d38283da2dead39/comments",
    "author": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "4ee8a58ce77a1e013af98ceff1cf96bd0e4fd436",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4ee8a58ce77a1e013af98ceff1cf96bd0e4fd436",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/4ee8a58ce77a1e013af98ceff1cf96bd0e4fd436"
      }
    ],
    "stats": {
      "total": 15,
      "additions": 15,
      "deletions": 0
    },
    "files": [
      {
        "sha": "d738418a6962b5d4496d0203166073cdf5435785",
        "filename": "src/wallet/scriptpubkeyman.h",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fd9d6eebc1eabb4675a118d19d38283da2dead39/src/wallet/scriptpubkeyman.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fd9d6eebc1eabb4675a118d19d38283da2dead39/src/wallet/scriptpubkeyman.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/scriptpubkeyman.h?ref=fd9d6eebc1eabb4675a118d19d38283da2dead39",
        "patch": "@@ -31,6 +31,8 @@ class WalletStorage\n     virtual void UnsetBlankWalletFlag(WalletBatch&) = 0;\n     virtual bool CanSupportFeature(enum WalletFeature) const = 0;\n     virtual void SetMinVersion(enum WalletFeature, WalletBatch* = nullptr, bool = false) = 0;\n+    virtual const CKeyingMaterial& GetEncryptionKey() const = 0;\n+    virtual bool HasEncryptionKeys() const = 0;\n     virtual bool IsLocked() const = 0;\n };\n "
      },
      {
        "sha": "af3b7cf61312976fa7f175d380b561f697c262f9",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 10,
        "deletions": 0,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fd9d6eebc1eabb4675a118d19d38283da2dead39/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fd9d6eebc1eabb4675a118d19d38283da2dead39/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=fd9d6eebc1eabb4675a118d19d38283da2dead39",
        "patch": "@@ -4056,3 +4056,13 @@ LegacyScriptPubKeyMan* CWallet::GetLegacyScriptPubKeyMan() const\n {\n     return m_spk_man.get();\n }\n+\n+const CKeyingMaterial& CWallet::GetEncryptionKey() const\n+{\n+    return vMasterKey;\n+}\n+\n+bool CWallet::HasEncryptionKeys() const\n+{\n+    return !mapMasterKeys.empty();\n+}"
      },
      {
        "sha": "82661fcc31349f2a21405afd8d7c8c8867b0a0a9",
        "filename": "src/wallet/wallet.h",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fd9d6eebc1eabb4675a118d19d38283da2dead39/src/wallet/wallet.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fd9d6eebc1eabb4675a118d19d38283da2dead39/src/wallet/wallet.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.h?ref=fd9d6eebc1eabb4675a118d19d38283da2dead39",
        "patch": "@@ -1136,6 +1136,9 @@ class CWallet final : public WalletStorage, private interfaces::Chain::Notificat\n \n     LegacyScriptPubKeyMan* GetLegacyScriptPubKeyMan() const;\n \n+    const CKeyingMaterial& GetEncryptionKey() const override;\n+    bool HasEncryptionKeys() const override;\n+\n     // Temporary LegacyScriptPubKeyMan accessors and aliases.\n     friend class LegacyScriptPubKeyMan;\n     std::unique_ptr<LegacyScriptPubKeyMan> m_spk_man = MakeUnique<LegacyScriptPubKeyMan>(*this);"
      }
    ]
  },
  {
    "sha": "e576b135d6451101d6a8219f55d80aefa216dc38",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzplNTc2YjEzNWQ2NDUxMTAxZDZhODIxOWY1NWQ4MGFlZmEyMTZkYzM4",
    "commit": {
      "author": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2019-12-05T23:02:01Z"
      },
      "committer": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2019-12-06T20:05:08Z"
      },
      "message": "Replace LegacyScriptPubKeyMan::vMasterKey with GetDecryptionKey()",
      "tree": {
        "sha": "d989e10eff24459961a1d1c0d216b7b8b59436d4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d989e10eff24459961a1d1c0d216b7b8b59436d4"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e576b135d6451101d6a8219f55d80aefa216dc38",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e576b135d6451101d6a8219f55d80aefa216dc38",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/e576b135d6451101d6a8219f55d80aefa216dc38",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e576b135d6451101d6a8219f55d80aefa216dc38/comments",
    "author": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "fd9d6eebc1eabb4675a118d19d38283da2dead39",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fd9d6eebc1eabb4675a118d19d38283da2dead39",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/fd9d6eebc1eabb4675a118d19d38283da2dead39"
      }
    ],
    "stats": {
      "total": 6,
      "additions": 2,
      "deletions": 4
    },
    "files": [
      {
        "sha": "f9c2645ca9ea5d2b82d0d4fead9cccf057dd40c0",
        "filename": "src/wallet/scriptpubkeyman.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 3,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e576b135d6451101d6a8219f55d80aefa216dc38/src/wallet/scriptpubkeyman.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e576b135d6451101d6a8219f55d80aefa216dc38/src/wallet/scriptpubkeyman.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/scriptpubkeyman.cpp?ref=e576b135d6451101d6a8219f55d80aefa216dc38",
        "patch": "@@ -594,7 +594,7 @@ bool LegacyScriptPubKeyMan::AddKeyPubKeyInner(const CKey& key, const CPubKey &pu\n \n     std::vector<unsigned char> vchCryptedSecret;\n     CKeyingMaterial vchSecret(key.begin(), key.end());\n-    if (!EncryptSecret(vMasterKey, vchSecret, pubkey.GetHash(), vchCryptedSecret)) {\n+    if (!EncryptSecret(m_storage.GetEncryptionKey(), vchSecret, pubkey.GetHash(), vchCryptedSecret)) {\n         return false;\n     }\n \n@@ -759,7 +759,7 @@ bool LegacyScriptPubKeyMan::GetKey(const CKeyID &address, CKey& keyOut) const\n     {\n         const CPubKey &vchPubKey = (*mi).second.first;\n         const std::vector<unsigned char> &vchCryptedSecret = (*mi).second.second;\n-        return DecryptKey(vMasterKey, vchCryptedSecret, vchPubKey, keyOut);\n+        return DecryptKey(m_storage.GetEncryptionKey(), vchCryptedSecret, vchPubKey, keyOut);\n     }\n     return false;\n }\n@@ -1398,7 +1398,6 @@ LegacyScriptPubKeyMan::LegacyScriptPubKeyMan(CWallet& wallet)\n     : ScriptPubKeyMan(wallet),\n       m_wallet(wallet),\n       cs_wallet(wallet.cs_wallet),\n-      vMasterKey(wallet.vMasterKey),\n       fUseCrypto(wallet.fUseCrypto),\n       fDecryptionThoroughlyChecked(wallet.fDecryptionThoroughlyChecked) {}\n "
      },
      {
        "sha": "daed5bd9016d05d69dbd00e07bdd29287578cdfd",
        "filename": "src/wallet/scriptpubkeyman.h",
        "status": "modified",
        "additions": 0,
        "deletions": 1,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e576b135d6451101d6a8219f55d80aefa216dc38/src/wallet/scriptpubkeyman.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e576b135d6451101d6a8219f55d80aefa216dc38/src/wallet/scriptpubkeyman.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/scriptpubkeyman.h?ref=e576b135d6451101d6a8219f55d80aefa216dc38",
        "patch": "@@ -412,7 +412,6 @@ class LegacyScriptPubKeyMan : public ScriptPubKeyMan, public FillableSigningProv\n     template<typename... Params> void WalletLogPrintf(const std::string& fmt, const Params&... parameters) const;\n     CWallet& m_wallet;\n     CCriticalSection& cs_wallet;\n-    CKeyingMaterial& vMasterKey GUARDED_BY(cs_KeyStore);\n     std::atomic<bool>& fUseCrypto;\n     bool& fDecryptionThoroughlyChecked;\n };"
      }
    ]
  },
  {
    "sha": "97c0374a46943b2ed38ea24eeeff1f1568dd55b3",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5N2MwMzc0YTQ2OTQzYjJlZDM4ZWEyNGVlZWZmMWYxNTY4ZGQ1NWIz",
    "commit": {
      "author": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2019-12-05T23:02:11Z"
      },
      "committer": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2019-12-06T20:05:47Z"
      },
      "message": "Move Unlock implementation to LegacyScriptPubKeyMan\n\nCWallet::Unlock is changed to call ScriptPubKeyMan::CheckDecryptionKey\nand the original implementation of Unlock is renamed to CheckDecryptionKey.",
      "tree": {
        "sha": "9be6c26319a8cbdae6d9a098a5f53d9b3916543e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9be6c26319a8cbdae6d9a098a5f53d9b3916543e"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/97c0374a46943b2ed38ea24eeeff1f1568dd55b3",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/97c0374a46943b2ed38ea24eeeff1f1568dd55b3",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/97c0374a46943b2ed38ea24eeeff1f1568dd55b3",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/97c0374a46943b2ed38ea24eeeff1f1568dd55b3/comments",
    "author": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "e576b135d6451101d6a8219f55d80aefa216dc38",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e576b135d6451101d6a8219f55d80aefa216dc38",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/e576b135d6451101d6a8219f55d80aefa216dc38"
      }
    ],
    "stats": {
      "total": 25,
      "additions": 21,
      "deletions": 4
    },
    "files": [
      {
        "sha": "0adfefa1aa4dbdb364efdb1b26cc419a926c1a05",
        "filename": "src/wallet/scriptpubkeyman.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 4,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/97c0374a46943b2ed38ea24eeeff1f1568dd55b3/src/wallet/scriptpubkeyman.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/97c0374a46943b2ed38ea24eeeff1f1568dd55b3/src/wallet/scriptpubkeyman.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/scriptpubkeyman.cpp?ref=97c0374a46943b2ed38ea24eeeff1f1568dd55b3",
        "patch": "@@ -202,7 +202,7 @@ isminetype LegacyScriptPubKeyMan::IsMine(const CScript& script) const\n     assert(false);\n }\n \n-bool CWallet::Unlock(const CKeyingMaterial& vMasterKeyIn, bool accept_no_keys)\n+bool LegacyScriptPubKeyMan::CheckDecryptionKey(const CKeyingMaterial& master_key, bool accept_no_keys)\n {\n     {\n         LOCK(cs_KeyStore);\n@@ -217,7 +217,7 @@ bool CWallet::Unlock(const CKeyingMaterial& vMasterKeyIn, bool accept_no_keys)\n             const CPubKey &vchPubKey = (*mi).second.first;\n             const std::vector<unsigned char> &vchCryptedSecret = (*mi).second.second;\n             CKey key;\n-            if (!DecryptKey(vMasterKeyIn, vchCryptedSecret, vchPubKey, key))\n+            if (!DecryptKey(master_key, vchCryptedSecret, vchPubKey, key))\n             {\n                 keyFail = true;\n                 break;\n@@ -233,10 +233,8 @@ bool CWallet::Unlock(const CKeyingMaterial& vMasterKeyIn, bool accept_no_keys)\n         }\n         if (keyFail || (!keyPass && !accept_no_keys))\n             return false;\n-        vMasterKey = vMasterKeyIn;\n         fDecryptionThoroughlyChecked = true;\n     }\n-    NotifyStatusChanged(this);\n     return true;\n }\n "
      },
      {
        "sha": "f5d7bc658aa7b13cbfde8e182faed403fa661aa0",
        "filename": "src/wallet/scriptpubkeyman.h",
        "status": "modified",
        "additions": 4,
        "deletions": 0,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/97c0374a46943b2ed38ea24eeeff1f1568dd55b3/src/wallet/scriptpubkeyman.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/97c0374a46943b2ed38ea24eeeff1f1568dd55b3/src/wallet/scriptpubkeyman.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/scriptpubkeyman.h?ref=97c0374a46943b2ed38ea24eeeff1f1568dd55b3",
        "patch": "@@ -152,6 +152,9 @@ class ScriptPubKeyMan\n     virtual bool GetNewDestination(const OutputType type, CTxDestination& dest, std::string& error) { return false; }\n     virtual isminetype IsMine(const CScript& script) const { return ISMINE_NO; }\n \n+    //! Check that the given decryption key is valid for this ScriptPubKeyMan, i.e. it decrypts all of the keys handled by it.\n+    virtual bool CheckDecryptionKey(const CKeyingMaterial& master_key, bool accept_no_keys = false) { return false; }\n+\n     virtual bool GetReservedDestination(const OutputType type, bool internal, CTxDestination& address, int64_t& index, CKeyPool& keypool) { return false; }\n     virtual void KeepDestination(int64_t index, const OutputType& type) {}\n     virtual void ReturnDestination(int64_t index, bool internal, const CTxDestination& addr) {}\n@@ -276,6 +279,7 @@ class LegacyScriptPubKeyMan : public ScriptPubKeyMan, public FillableSigningProv\n \n     //! will encrypt previously unencrypted keys\n     bool EncryptKeys(CKeyingMaterial& vMasterKeyIn);\n+    bool CheckDecryptionKey(const CKeyingMaterial& master_key, bool accept_no_keys = false) override;\n \n     bool GetReservedDestination(const OutputType type, bool internal, CTxDestination& address, int64_t& index, CKeyPool& keypool) override;\n     void KeepDestination(int64_t index, const OutputType& type) override;"
      },
      {
        "sha": "80dfbb594df82ab31a4abedf6ce681a8ac068eb6",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 15,
        "deletions": 0,
        "changes": 15,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/97c0374a46943b2ed38ea24eeeff1f1568dd55b3/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/97c0374a46943b2ed38ea24eeeff1f1568dd55b3/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=97c0374a46943b2ed38ea24eeeff1f1568dd55b3",
        "patch": "@@ -4037,6 +4037,21 @@ bool CWallet::Lock()\n     return true;\n }\n \n+bool CWallet::Unlock(const CKeyingMaterial& vMasterKeyIn, bool accept_no_keys)\n+{\n+    {\n+        LOCK(cs_KeyStore);\n+        if (m_spk_man) {\n+            if (!m_spk_man->CheckDecryptionKey(vMasterKeyIn, accept_no_keys)) {\n+                return false;\n+            }\n+        }\n+        vMasterKey = vMasterKeyIn;\n+    }\n+    NotifyStatusChanged(this);\n+    return true;\n+}\n+\n ScriptPubKeyMan* CWallet::GetScriptPubKeyMan(const CScript& script) const\n {\n     return m_spk_man.get();"
      }
    ]
  },
  {
    "sha": "14b5efd66ff0afbf3bf9158a724534a9090fc7fc",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxNGI1ZWZkNjZmZjBhZmJmM2JmOTE1OGE3MjQ1MzRhOTA5MGZjN2Zj",
    "commit": {
      "author": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2019-12-05T23:02:36Z"
      },
      "committer": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2019-12-06T20:05:48Z"
      },
      "message": "Move fDecryptionThoroughlyChecked from CWallet to LegacyScriptPubKeyMan",
      "tree": {
        "sha": "c01bb76824220e70644b55c25c30b4084b80ce5a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c01bb76824220e70644b55c25c30b4084b80ce5a"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/14b5efd66ff0afbf3bf9158a724534a9090fc7fc",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/14b5efd66ff0afbf3bf9158a724534a9090fc7fc",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/14b5efd66ff0afbf3bf9158a724534a9090fc7fc",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/14b5efd66ff0afbf3bf9158a724534a9090fc7fc/comments",
    "author": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "97c0374a46943b2ed38ea24eeeff1f1568dd55b3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/97c0374a46943b2ed38ea24eeeff1f1568dd55b3",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/97c0374a46943b2ed38ea24eeeff1f1568dd55b3"
      }
    ],
    "stats": {
      "total": 10,
      "additions": 4,
      "deletions": 6
    },
    "files": [
      {
        "sha": "8a3f36c2e2b95f8e603c4e00dcc2d015294212f6",
        "filename": "src/wallet/scriptpubkeyman.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 2,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/14b5efd66ff0afbf3bf9158a724534a9090fc7fc/src/wallet/scriptpubkeyman.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/14b5efd66ff0afbf3bf9158a724534a9090fc7fc/src/wallet/scriptpubkeyman.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/scriptpubkeyman.cpp?ref=14b5efd66ff0afbf3bf9158a724534a9090fc7fc",
        "patch": "@@ -1396,8 +1396,7 @@ LegacyScriptPubKeyMan::LegacyScriptPubKeyMan(CWallet& wallet)\n     : ScriptPubKeyMan(wallet),\n       m_wallet(wallet),\n       cs_wallet(wallet.cs_wallet),\n-      fUseCrypto(wallet.fUseCrypto),\n-      fDecryptionThoroughlyChecked(wallet.fDecryptionThoroughlyChecked) {}\n+      fUseCrypto(wallet.fUseCrypto) {}\n \n bool LegacyScriptPubKeyMan::SetCrypted() { return m_wallet.SetCrypted(); }\n bool LegacyScriptPubKeyMan::IsCrypted() const { return m_wallet.IsCrypted(); }"
      },
      {
        "sha": "89e9dc01a3150507e213512285ffbf67251df801",
        "filename": "src/wallet/scriptpubkeyman.h",
        "status": "modified",
        "additions": 3,
        "deletions": 1,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/14b5efd66ff0afbf3bf9158a724534a9090fc7fc/src/wallet/scriptpubkeyman.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/14b5efd66ff0afbf3bf9158a724534a9090fc7fc/src/wallet/scriptpubkeyman.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/scriptpubkeyman.h?ref=14b5efd66ff0afbf3bf9158a724534a9090fc7fc",
        "patch": "@@ -198,6 +198,9 @@ class ScriptPubKeyMan\n class LegacyScriptPubKeyMan : public ScriptPubKeyMan, public FillableSigningProvider\n {\n private:\n+    //! keeps track of whether Unlock has run a thorough check before\n+    bool fDecryptionThoroughlyChecked = false;\n+\n     using WatchOnlySet = std::set<CScript>;\n     using WatchKeyMap = std::map<CKeyID, CPubKey>;\n \n@@ -417,7 +420,6 @@ class LegacyScriptPubKeyMan : public ScriptPubKeyMan, public FillableSigningProv\n     CWallet& m_wallet;\n     CCriticalSection& cs_wallet;\n     std::atomic<bool>& fUseCrypto;\n-    bool& fDecryptionThoroughlyChecked;\n };\n \n #endif // BITCOIN_WALLET_SCRIPTPUBKEYMAN_H"
      },
      {
        "sha": "50cd8833ba2c432d71f95ec06145fb9919210c59",
        "filename": "src/wallet/wallet.h",
        "status": "modified",
        "additions": 0,
        "deletions": 3,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/14b5efd66ff0afbf3bf9158a724534a9090fc7fc/src/wallet/wallet.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/14b5efd66ff0afbf3bf9158a724534a9090fc7fc/src/wallet/wallet.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.h?ref=14b5efd66ff0afbf3bf9158a724534a9090fc7fc",
        "patch": "@@ -601,8 +601,6 @@ class CWallet final : public WalletStorage, private interfaces::Chain::Notificat\n     //! if fUseCrypto is false, vMasterKey must be empty\n     std::atomic<bool> fUseCrypto;\n \n-    //! keeps track of whether Unlock has run a thorough check before\n-    bool fDecryptionThoroughlyChecked;\n \n     bool SetCrypted();\n     bool Unlock(const CKeyingMaterial& vMasterKeyIn, bool accept_no_keys = false);\n@@ -735,7 +733,6 @@ class CWallet final : public WalletStorage, private interfaces::Chain::Notificat\n     /** Construct wallet with specified name and database implementation. */\n     CWallet(interfaces::Chain* chain, const WalletLocation& location, std::unique_ptr<WalletDatabase> database)\n         : fUseCrypto(false),\n-          fDecryptionThoroughlyChecked(false),\n           m_chain(chain),\n           m_location(location),\n           database(std::move(database))"
      }
    ]
  },
  {
    "sha": "35f962fcf0d5107ae6a3a9348e249a9b18ff7106",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozNWY5NjJmY2YwZDUxMDdhZTZhM2E5MzQ4ZTI0OWE5YjE4ZmY3MTA2",
    "commit": {
      "author": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2019-12-05T23:04:06Z"
      },
      "committer": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2019-12-06T20:05:48Z"
      },
      "message": "Clear mapKeys before encrypting\n\nDoes not change behavior. Needed to make AddCryptedKeyInner() work\nwith SetCrypted() being gone.",
      "tree": {
        "sha": "07a5aa9b2a252fd5febc14115682e3f7b1eccb0a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/07a5aa9b2a252fd5febc14115682e3f7b1eccb0a"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/35f962fcf0d5107ae6a3a9348e249a9b18ff7106",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/35f962fcf0d5107ae6a3a9348e249a9b18ff7106",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/35f962fcf0d5107ae6a3a9348e249a9b18ff7106",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/35f962fcf0d5107ae6a3a9348e249a9b18ff7106/comments",
    "author": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "14b5efd66ff0afbf3bf9158a724534a9090fc7fc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/14b5efd66ff0afbf3bf9158a724534a9090fc7fc",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/14b5efd66ff0afbf3bf9158a724534a9090fc7fc"
      }
    ],
    "stats": {
      "total": 5,
      "additions": 3,
      "deletions": 2
    },
    "files": [
      {
        "sha": "acf3ed2e2b8b7ffa85b5bc2f7a607e4e22fedfdb",
        "filename": "src/wallet/scriptpubkeyman.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 2,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/35f962fcf0d5107ae6a3a9348e249a9b18ff7106/src/wallet/scriptpubkeyman.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/35f962fcf0d5107ae6a3a9348e249a9b18ff7106/src/wallet/scriptpubkeyman.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/scriptpubkeyman.cpp?ref=35f962fcf0d5107ae6a3a9348e249a9b18ff7106",
        "patch": "@@ -245,7 +245,9 @@ bool LegacyScriptPubKeyMan::EncryptKeys(CKeyingMaterial& vMasterKeyIn)\n         return false;\n \n     fUseCrypto = true;\n-    for (const KeyMap::value_type& mKey : mapKeys)\n+    KeyMap keys_to_encrypt;\n+    keys_to_encrypt.swap(mapKeys); // Clear mapKeys so AddCryptedKeyInner will succeed.\n+    for (const KeyMap::value_type& mKey : keys_to_encrypt)\n     {\n         const CKey &key = mKey.second;\n         CPubKey vchPubKey = key.GetPubKey();\n@@ -256,7 +258,6 @@ bool LegacyScriptPubKeyMan::EncryptKeys(CKeyingMaterial& vMasterKeyIn)\n         if (!AddCryptedKey(vchPubKey, vchCryptedSecret))\n             return false;\n     }\n-    mapKeys.clear();\n     return true;\n }\n "
      }
    ]
  },
  {
    "sha": "77a777118eaf78f10a439810d1c08d510a539aa0",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo3N2E3NzcxMThlYWY3OGYxMGE0Mzk4MTBkMWMwOGQ1MTBhNTM5YWEw",
    "commit": {
      "author": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2019-12-05T23:23:57Z"
      },
      "committer": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2019-12-06T20:05:48Z"
      },
      "message": "Rename EncryptKeys to Encrypt and pass in the encrypted batch to use",
      "tree": {
        "sha": "3abffca64ce466ec095472740316248f7043e1e8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3abffca64ce466ec095472740316248f7043e1e8"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/77a777118eaf78f10a439810d1c08d510a539aa0",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/77a777118eaf78f10a439810d1c08d510a539aa0",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/77a777118eaf78f10a439810d1c08d510a539aa0",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/77a777118eaf78f10a439810d1c08d510a539aa0/comments",
    "author": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "35f962fcf0d5107ae6a3a9348e249a9b18ff7106",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/35f962fcf0d5107ae6a3a9348e249a9b18ff7106",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/35f962fcf0d5107ae6a3a9348e249a9b18ff7106"
      }
    ],
    "stats": {
      "total": 30,
      "additions": 17,
      "deletions": 13
    },
    "files": [
      {
        "sha": "4d8a7e2d38c6432ee0a48a2b53823370feb02cdb",
        "filename": "src/wallet/scriptpubkeyman.cpp",
        "status": "modified",
        "additions": 13,
        "deletions": 4,
        "changes": 17,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/77a777118eaf78f10a439810d1c08d510a539aa0/src/wallet/scriptpubkeyman.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/77a777118eaf78f10a439810d1c08d510a539aa0/src/wallet/scriptpubkeyman.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/scriptpubkeyman.cpp?ref=77a777118eaf78f10a439810d1c08d510a539aa0",
        "patch": "@@ -238,11 +238,15 @@ bool LegacyScriptPubKeyMan::CheckDecryptionKey(const CKeyingMaterial& master_key\n     return true;\n }\n \n-bool LegacyScriptPubKeyMan::EncryptKeys(CKeyingMaterial& vMasterKeyIn)\n+bool LegacyScriptPubKeyMan::Encrypt(const CKeyingMaterial& master_key, WalletBatch* batch)\n {\n+    AssertLockHeld(cs_wallet);\n     LOCK(cs_KeyStore);\n-    if (!mapCryptedKeys.empty() || IsCrypted())\n+    encrypted_batch = batch;\n+    if (!mapCryptedKeys.empty() || IsCrypted()) {\n+        encrypted_batch = nullptr;\n         return false;\n+    }\n \n     fUseCrypto = true;\n     KeyMap keys_to_encrypt;\n@@ -253,11 +257,16 @@ bool LegacyScriptPubKeyMan::EncryptKeys(CKeyingMaterial& vMasterKeyIn)\n         CPubKey vchPubKey = key.GetPubKey();\n         CKeyingMaterial vchSecret(key.begin(), key.end());\n         std::vector<unsigned char> vchCryptedSecret;\n-        if (!EncryptSecret(vMasterKeyIn, vchSecret, vchPubKey.GetHash(), vchCryptedSecret))\n+        if (!EncryptSecret(master_key, vchSecret, vchPubKey.GetHash(), vchCryptedSecret)) {\n+            encrypted_batch = nullptr;\n             return false;\n-        if (!AddCryptedKey(vchPubKey, vchCryptedSecret))\n+        }\n+        if (!AddCryptedKey(vchPubKey, vchCryptedSecret)) {\n+            encrypted_batch = nullptr;\n             return false;\n+        }\n     }\n+    encrypted_batch = nullptr;\n     return true;\n }\n "
      },
      {
        "sha": "4fe4efc199de6189ad000e9a33ba4a023e73b2f5",
        "filename": "src/wallet/scriptpubkeyman.h",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/77a777118eaf78f10a439810d1c08d510a539aa0/src/wallet/scriptpubkeyman.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/77a777118eaf78f10a439810d1c08d510a539aa0/src/wallet/scriptpubkeyman.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/scriptpubkeyman.h?ref=77a777118eaf78f10a439810d1c08d510a539aa0",
        "patch": "@@ -154,6 +154,7 @@ class ScriptPubKeyMan\n \n     //! Check that the given decryption key is valid for this ScriptPubKeyMan, i.e. it decrypts all of the keys handled by it.\n     virtual bool CheckDecryptionKey(const CKeyingMaterial& master_key, bool accept_no_keys = false) { return false; }\n+    virtual bool Encrypt(const CKeyingMaterial& master_key, WalletBatch* batch) { return false; }\n \n     virtual bool GetReservedDestination(const OutputType type, bool internal, CTxDestination& address, int64_t& index, CKeyPool& keypool) { return false; }\n     virtual void KeepDestination(int64_t index, const OutputType& type) {}\n@@ -280,9 +281,8 @@ class LegacyScriptPubKeyMan : public ScriptPubKeyMan, public FillableSigningProv\n     bool GetNewDestination(const OutputType type, CTxDestination& dest, std::string& error) override;\n     isminetype IsMine(const CScript& script) const override;\n \n-    //! will encrypt previously unencrypted keys\n-    bool EncryptKeys(CKeyingMaterial& vMasterKeyIn);\n     bool CheckDecryptionKey(const CKeyingMaterial& master_key, bool accept_no_keys = false) override;\n+    bool Encrypt(const CKeyingMaterial& master_key, WalletBatch* batch) override;\n \n     bool GetReservedDestination(const OutputType type, bool internal, CTxDestination& address, int64_t& index, CKeyPool& keypool) override;\n     void KeepDestination(int64_t index, const OutputType& type) override;"
      },
      {
        "sha": "88399bbab6b10a6a36006dc477dd198a9d51872f",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 3,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/77a777118eaf78f10a439810d1c08d510a539aa0/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/77a777118eaf78f10a439810d1c08d510a539aa0/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=77a777118eaf78f10a439810d1c08d510a539aa0",
        "patch": "@@ -532,8 +532,7 @@ bool CWallet::EncryptWallet(const SecureString& strWalletPassphrase)\n     {\n         LOCK(cs_wallet);\n         mapMasterKeys[++nMasterKeyMaxID] = kMasterKey;\n-        assert(!encrypted_batch);\n-        encrypted_batch = new WalletBatch(*database);\n+        WalletBatch* encrypted_batch = new WalletBatch(*database);\n         if (!encrypted_batch->TxnBegin()) {\n             delete encrypted_batch;\n             encrypted_batch = nullptr;\n@@ -542,7 +541,7 @@ bool CWallet::EncryptWallet(const SecureString& strWalletPassphrase)\n         encrypted_batch->WriteMasterKey(nMasterKeyMaxID, kMasterKey);\n \n         if (auto spk_man = m_spk_man.get()) {\n-            if (!spk_man->EncryptKeys(_vMasterKey)) {\n+            if (!spk_man->Encrypt(_vMasterKey, encrypted_batch)) {\n                 encrypted_batch->TxnAbort();\n                 delete encrypted_batch;\n                 encrypted_batch = nullptr;"
      },
      {
        "sha": "eb74baee4ebef8923fcdc109903e1bebecabbc04",
        "filename": "src/wallet/wallet.h",
        "status": "modified",
        "additions": 0,
        "deletions": 4,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/77a777118eaf78f10a439810d1c08d510a539aa0/src/wallet/wallet.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/77a777118eaf78f10a439810d1c08d510a539aa0/src/wallet/wallet.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.h?ref=77a777118eaf78f10a439810d1c08d510a539aa0",
        "patch": "@@ -743,8 +743,6 @@ class CWallet final : public WalletStorage, private interfaces::Chain::Notificat\n     {\n         // Should not have slots connected at this point.\n         assert(NotifyUnload.empty());\n-        delete encrypted_batch;\n-        encrypted_batch = nullptr;\n     }\n \n     bool IsCrypted() const { return fUseCrypto; }\n@@ -1145,8 +1143,6 @@ class CWallet final : public WalletStorage, private interfaces::Chain::Notificat\n     LegacyScriptPubKeyMan::CryptedKeyMap& mapCryptedKeys GUARDED_BY(cs_KeyStore) = m_spk_man->mapCryptedKeys;\n     LegacyScriptPubKeyMan::WatchOnlySet& setWatchOnly GUARDED_BY(cs_KeyStore) = m_spk_man->setWatchOnly;\n     LegacyScriptPubKeyMan::WatchKeyMap& mapWatchKeys GUARDED_BY(cs_KeyStore) = m_spk_man->mapWatchKeys;\n-    WalletBatch*& encrypted_batch GUARDED_BY(cs_wallet) = m_spk_man->encrypted_batch;\n-    using CryptedKeyMap = LegacyScriptPubKeyMan::CryptedKeyMap;\n \n     /** Get last block processed height */\n     int GetLastBlockHeight() const EXCLUSIVE_LOCKS_REQUIRED(cs_wallet)"
      }
    ]
  },
  {
    "sha": "bf6417142f36a2f75b3a11368bd73fe788ae1ccb",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiZjY0MTcxNDJmMzZhMmY3NWIzYTExMzY4YmQ3M2ZlNzg4YWUxY2Ni",
    "commit": {
      "author": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2019-12-05T23:14:53Z"
      },
      "committer": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2019-12-06T20:05:48Z"
      },
      "message": "Remove SetCrypted() and fUseCrypto; Change IsCrypted()'s implementation\n\nRemoves SetCrypted() and fUseCrypto as we don't need them anymore.\nSetCrypted calls in LegacyScriptPubKeyMan are replaced with mapKeys.empty()\n\nIsCrypted() is changed to just call HasEncryptionKeys()",
      "tree": {
        "sha": "1c2b79eea3f32fdedfe3eb0ff0d12c42cda8eb5b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1c2b79eea3f32fdedfe3eb0ff0d12c42cda8eb5b"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/bf6417142f36a2f75b3a11368bd73fe788ae1ccb",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bf6417142f36a2f75b3a11368bd73fe788ae1ccb",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/bf6417142f36a2f75b3a11368bd73fe788ae1ccb",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bf6417142f36a2f75b3a11368bd73fe788ae1ccb/comments",
    "author": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "77a777118eaf78f10a439810d1c08d510a539aa0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/77a777118eaf78f10a439810d1c08d510a539aa0",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/77a777118eaf78f10a439810d1c08d510a539aa0"
      }
    ],
    "stats": {
      "total": 38,
      "additions": 9,
      "deletions": 29
    },
    "files": [
      {
        "sha": "0cc30ba1b9825314f9705440ebedfbe45b8e65b9",
        "filename": "src/wallet/scriptpubkeyman.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 10,
        "changes": 14,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/bf6417142f36a2f75b3a11368bd73fe788ae1ccb/src/wallet/scriptpubkeyman.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/bf6417142f36a2f75b3a11368bd73fe788ae1ccb/src/wallet/scriptpubkeyman.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/scriptpubkeyman.cpp?ref=bf6417142f36a2f75b3a11368bd73fe788ae1ccb",
        "patch": "@@ -206,8 +206,7 @@ bool LegacyScriptPubKeyMan::CheckDecryptionKey(const CKeyingMaterial& master_key\n {\n     {\n         LOCK(cs_KeyStore);\n-        if (!SetCrypted())\n-            return false;\n+        assert(mapKeys.empty());\n \n         bool keyPass = mapCryptedKeys.empty(); // Always pass when there are no encrypted keys\n         bool keyFail = false;\n@@ -243,12 +242,11 @@ bool LegacyScriptPubKeyMan::Encrypt(const CKeyingMaterial& master_key, WalletBat\n     AssertLockHeld(cs_wallet);\n     LOCK(cs_KeyStore);\n     encrypted_batch = batch;\n-    if (!mapCryptedKeys.empty() || IsCrypted()) {\n+    if (!mapCryptedKeys.empty()) {\n         encrypted_batch = nullptr;\n         return false;\n     }\n \n-    fUseCrypto = true;\n     KeyMap keys_to_encrypt;\n     keys_to_encrypt.swap(mapKeys); // Clear mapKeys so AddCryptedKeyInner will succeed.\n     for (const KeyMap::value_type& mKey : keys_to_encrypt)\n@@ -620,9 +618,7 @@ bool LegacyScriptPubKeyMan::LoadCryptedKey(const CPubKey &vchPubKey, const std::\n bool LegacyScriptPubKeyMan::AddCryptedKeyInner(const CPubKey &vchPubKey, const std::vector<unsigned char> &vchCryptedSecret)\n {\n     LOCK(cs_KeyStore);\n-    if (!SetCrypted()) {\n-        return false;\n-    }\n+    assert(mapKeys.empty());\n \n     mapCryptedKeys[vchPubKey.GetID()] = make_pair(vchPubKey, vchCryptedSecret);\n     ImplicitlyLearnRelatedKeyScripts(vchPubKey);\n@@ -1405,10 +1401,8 @@ std::set<CKeyID> LegacyScriptPubKeyMan::GetKeys() const\n LegacyScriptPubKeyMan::LegacyScriptPubKeyMan(CWallet& wallet)\n     : ScriptPubKeyMan(wallet),\n       m_wallet(wallet),\n-      cs_wallet(wallet.cs_wallet),\n-      fUseCrypto(wallet.fUseCrypto) {}\n+      cs_wallet(wallet.cs_wallet) {}\n \n-bool LegacyScriptPubKeyMan::SetCrypted() { return m_wallet.SetCrypted(); }\n bool LegacyScriptPubKeyMan::IsCrypted() const { return m_wallet.IsCrypted(); }\n void LegacyScriptPubKeyMan::NotifyWatchonlyChanged(bool fHaveWatchOnly) const { return m_wallet.NotifyWatchonlyChanged(fHaveWatchOnly); }\n void LegacyScriptPubKeyMan::NotifyCanGetAddressesChanged() const { return m_wallet.NotifyCanGetAddressesChanged(); }"
      },
      {
        "sha": "eef9640cd041fd9540d397f250f8972b5a7fc560",
        "filename": "src/wallet/scriptpubkeyman.h",
        "status": "modified",
        "additions": 0,
        "deletions": 2,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/bf6417142f36a2f75b3a11368bd73fe788ae1ccb/src/wallet/scriptpubkeyman.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/bf6417142f36a2f75b3a11368bd73fe788ae1ccb/src/wallet/scriptpubkeyman.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/scriptpubkeyman.h?ref=bf6417142f36a2f75b3a11368bd73fe788ae1ccb",
        "patch": "@@ -412,14 +412,12 @@ class LegacyScriptPubKeyMan : public ScriptPubKeyMan, public FillableSigningProv\n     friend class CWallet;\n     friend class ReserveDestination;\n     LegacyScriptPubKeyMan(CWallet& wallet);\n-    bool SetCrypted();\n     bool IsCrypted() const;\n     void NotifyWatchonlyChanged(bool fHaveWatchOnly) const;\n     void NotifyCanGetAddressesChanged() const;\n     template<typename... Params> void WalletLogPrintf(const std::string& fmt, const Params&... parameters) const;\n     CWallet& m_wallet;\n     CCriticalSection& cs_wallet;\n-    std::atomic<bool>& fUseCrypto;\n };\n \n #endif // BITCOIN_WALLET_SCRIPTPUBKEYMAN_H"
      },
      {
        "sha": "41a816312aa2ceeb642176b10ebcc6b443bf1bb1",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 9,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/bf6417142f36a2f75b3a11368bd73fe788ae1ccb/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/bf6417142f36a2f75b3a11368bd73fe788ae1ccb/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=bf6417142f36a2f75b3a11368bd73fe788ae1ccb",
        "patch": "@@ -4002,15 +4002,9 @@ std::vector<OutputGroup> CWallet::GroupOutputs(const std::vector<COutput>& outpu\n     return groups;\n }\n \n-bool CWallet::SetCrypted()\n+bool CWallet::IsCrypted() const\n {\n-    LOCK(cs_KeyStore);\n-    if (fUseCrypto)\n-        return true;\n-    if (!mapKeys.empty())\n-        return false;\n-    fUseCrypto = true;\n-    return true;\n+    return HasEncryptionKeys();\n }\n \n bool CWallet::IsLocked() const\n@@ -4024,7 +4018,7 @@ bool CWallet::IsLocked() const\n \n bool CWallet::Lock()\n {\n-    if (!SetCrypted())\n+    if (!IsCrypted())\n         return false;\n \n     {"
      },
      {
        "sha": "c4511601de6e434a1c68d405797b053ad7813760",
        "filename": "src/wallet/wallet.h",
        "status": "modified",
        "additions": 2,
        "deletions": 8,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/bf6417142f36a2f75b3a11368bd73fe788ae1ccb/src/wallet/wallet.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/bf6417142f36a2f75b3a11368bd73fe788ae1ccb/src/wallet/wallet.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.h?ref=bf6417142f36a2f75b3a11368bd73fe788ae1ccb",
        "patch": "@@ -597,12 +597,7 @@ class CWallet final : public WalletStorage, private interfaces::Chain::Notificat\n private:\n     CKeyingMaterial vMasterKey GUARDED_BY(cs_KeyStore);\n \n-    //! if fUseCrypto is true, mapKeys must be empty\n-    //! if fUseCrypto is false, vMasterKey must be empty\n-    std::atomic<bool> fUseCrypto;\n \n-\n-    bool SetCrypted();\n     bool Unlock(const CKeyingMaterial& vMasterKeyIn, bool accept_no_keys = false);\n \n     std::atomic<bool> fAbortRescan{false};\n@@ -732,8 +727,7 @@ class CWallet final : public WalletStorage, private interfaces::Chain::Notificat\n \n     /** Construct wallet with specified name and database implementation. */\n     CWallet(interfaces::Chain* chain, const WalletLocation& location, std::unique_ptr<WalletDatabase> database)\n-        : fUseCrypto(false),\n-          m_chain(chain),\n+        : m_chain(chain),\n           m_location(location),\n           database(std::move(database))\n     {\n@@ -745,7 +739,7 @@ class CWallet final : public WalletStorage, private interfaces::Chain::Notificat\n         assert(NotifyUnload.empty());\n     }\n \n-    bool IsCrypted() const { return fUseCrypto; }\n+    bool IsCrypted() const;\n     bool IsLocked() const override;\n     bool Lock();\n "
      }
    ]
  },
  {
    "sha": "7cecf10ac32af0fca206ac5f24f482bdec88cb7d",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo3Y2VjZjEwYWMzMmFmMGZjYTIwNmFjNWYyNGY0ODJiZGVjODhjYjdk",
    "commit": {
      "author": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2019-12-05T22:33:00Z"
      },
      "committer": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2019-12-06T20:05:48Z"
      },
      "message": "Replace LegacyScriptPubKeyMan::IsCrypted with LegacyScriptPubKeyMan::HasEncryptionKeys",
      "tree": {
        "sha": "411f99ad7b3fa9ec594d3033a5369d134ae4180e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/411f99ad7b3fa9ec594d3033a5369d134ae4180e"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7cecf10ac32af0fca206ac5f24f482bdec88cb7d",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7cecf10ac32af0fca206ac5f24f482bdec88cb7d",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/7cecf10ac32af0fca206ac5f24f482bdec88cb7d",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7cecf10ac32af0fca206ac5f24f482bdec88cb7d/comments",
    "author": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "bf6417142f36a2f75b3a11368bd73fe788ae1ccb",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bf6417142f36a2f75b3a11368bd73fe788ae1ccb",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/bf6417142f36a2f75b3a11368bd73fe788ae1ccb"
      }
    ],
    "stats": {
      "total": 14,
      "additions": 6,
      "deletions": 8
    },
    "files": [
      {
        "sha": "b4315014cbabe91423f4ffebc2581913d0d78317",
        "filename": "src/wallet/scriptpubkeyman.cpp",
        "status": "modified",
        "additions": 6,
        "deletions": 7,
        "changes": 13,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7cecf10ac32af0fca206ac5f24f482bdec88cb7d/src/wallet/scriptpubkeyman.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7cecf10ac32af0fca206ac5f24f482bdec88cb7d/src/wallet/scriptpubkeyman.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/scriptpubkeyman.cpp?ref=7cecf10ac32af0fca206ac5f24f482bdec88cb7d",
        "patch": "@@ -549,7 +549,7 @@ bool LegacyScriptPubKeyMan::AddKeyPubKeyWithDB(WalletBatch& batch, const CKey& s\n         RemoveWatchOnly(script);\n     }\n \n-    if (!IsCrypted()) {\n+    if (!m_storage.HasEncryptionKeys()) {\n         return batch.WriteKey(pubkey,\n                                                  secret.GetPrivKey(),\n                                                  mapKeyMetadata[pubkey.GetID()]);\n@@ -590,7 +590,7 @@ void LegacyScriptPubKeyMan::LoadScriptMetadata(const CScriptID& script_id, const\n bool LegacyScriptPubKeyMan::AddKeyPubKeyInner(const CKey& key, const CPubKey &pubkey)\n {\n     LOCK(cs_KeyStore);\n-    if (!IsCrypted()) {\n+    if (!m_storage.HasEncryptionKeys()) {\n         return FillableSigningProvider::AddKeyPubKey(key, pubkey);\n     }\n \n@@ -745,7 +745,7 @@ void LegacyScriptPubKeyMan::SetHDChain(const CHDChain& chain, bool memonly)\n bool LegacyScriptPubKeyMan::HaveKey(const CKeyID &address) const\n {\n     LOCK(cs_KeyStore);\n-    if (!IsCrypted()) {\n+    if (!m_storage.HasEncryptionKeys()) {\n         return FillableSigningProvider::HaveKey(address);\n     }\n     return mapCryptedKeys.count(address) > 0;\n@@ -754,7 +754,7 @@ bool LegacyScriptPubKeyMan::HaveKey(const CKeyID &address) const\n bool LegacyScriptPubKeyMan::GetKey(const CKeyID &address, CKey& keyOut) const\n {\n     LOCK(cs_KeyStore);\n-    if (!IsCrypted()) {\n+    if (!m_storage.HasEncryptionKeys()) {\n         return FillableSigningProvider::GetKey(address, keyOut);\n     }\n \n@@ -801,7 +801,7 @@ bool LegacyScriptPubKeyMan::GetWatchPubKey(const CKeyID &address, CPubKey &pubke\n bool LegacyScriptPubKeyMan::GetPubKey(const CKeyID &address, CPubKey& vchPubKeyOut) const\n {\n     LOCK(cs_KeyStore);\n-    if (!IsCrypted()) {\n+    if (!m_storage.HasEncryptionKeys()) {\n         if (!FillableSigningProvider::GetPubKey(address, vchPubKeyOut)) {\n             return GetWatchPubKey(address, vchPubKeyOut);\n         }\n@@ -1387,7 +1387,7 @@ bool LegacyScriptPubKeyMan::ImportScriptPubKeys(const std::set<CScript>& script_\n std::set<CKeyID> LegacyScriptPubKeyMan::GetKeys() const\n {\n     LOCK(cs_KeyStore);\n-    if (!IsCrypted()) {\n+    if (!m_storage.HasEncryptionKeys()) {\n         return FillableSigningProvider::GetKeys();\n     }\n     std::set<CKeyID> set_address;\n@@ -1403,7 +1403,6 @@ LegacyScriptPubKeyMan::LegacyScriptPubKeyMan(CWallet& wallet)\n       m_wallet(wallet),\n       cs_wallet(wallet.cs_wallet) {}\n \n-bool LegacyScriptPubKeyMan::IsCrypted() const { return m_wallet.IsCrypted(); }\n void LegacyScriptPubKeyMan::NotifyWatchonlyChanged(bool fHaveWatchOnly) const { return m_wallet.NotifyWatchonlyChanged(fHaveWatchOnly); }\n void LegacyScriptPubKeyMan::NotifyCanGetAddressesChanged() const { return m_wallet.NotifyCanGetAddressesChanged(); }\n template<typename... Params> void LegacyScriptPubKeyMan::WalletLogPrintf(const std::string& fmt, const Params&... parameters) const { return m_wallet.WalletLogPrintf(fmt, parameters...); }"
      },
      {
        "sha": "aa5eac3a85489a14b9cdede51b1ef5d5c01388c1",
        "filename": "src/wallet/scriptpubkeyman.h",
        "status": "modified",
        "additions": 0,
        "deletions": 1,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7cecf10ac32af0fca206ac5f24f482bdec88cb7d/src/wallet/scriptpubkeyman.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7cecf10ac32af0fca206ac5f24f482bdec88cb7d/src/wallet/scriptpubkeyman.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/scriptpubkeyman.h?ref=7cecf10ac32af0fca206ac5f24f482bdec88cb7d",
        "patch": "@@ -412,7 +412,6 @@ class LegacyScriptPubKeyMan : public ScriptPubKeyMan, public FillableSigningProv\n     friend class CWallet;\n     friend class ReserveDestination;\n     LegacyScriptPubKeyMan(CWallet& wallet);\n-    bool IsCrypted() const;\n     void NotifyWatchonlyChanged(bool fHaveWatchOnly) const;\n     void NotifyCanGetAddressesChanged() const;\n     template<typename... Params> void WalletLogPrintf(const std::string& fmt, const Params&... parameters) const;"
      }
    ]
  }
]