[
  {
    "sha": "5c03483e26ab414d22ef192691b2336c1bb3cb02",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1YzAzNDgzZTI2YWI0MTRkMjJlZjE5MjY5MWIyMzM2YzFiYjNjYjAy",
    "commit": {
      "author": {
        "name": "AlSzacrel",
        "email": "alszacrel@web.de",
        "date": "2014-09-13T00:09:18Z"
      },
      "committer": {
        "name": "Murch",
        "email": "alszacrel@web.de",
        "date": "2015-12-06T22:26:45Z"
      },
      "message": "Coinselection prunes extraneous inputs from ApproximateBestSubset\n\nA further pass over the available inputs has been added to ApproximateBestSubset after a candidate set has been found. It will prune any extraneous inputs in the selected subset, in order to decrease the number of input and the resulting change.",
      "tree": {
        "sha": "9973d4590bb5a20b4c016918cc284a48ea675882",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9973d4590bb5a20b4c016918cc284a48ea675882"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5c03483e26ab414d22ef192691b2336c1bb3cb02",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5c03483e26ab414d22ef192691b2336c1bb3cb02",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/5c03483e26ab414d22ef192691b2336c1bb3cb02",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5c03483e26ab414d22ef192691b2336c1bb3cb02/comments",
    "author": {
      "login": "Xekyo",
      "id": 4060799,
      "node_id": "MDQ6VXNlcjQwNjA3OTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Xekyo",
      "html_url": "https://github.com/Xekyo",
      "followers_url": "https://api.github.com/users/Xekyo/followers",
      "following_url": "https://api.github.com/users/Xekyo/following{/other_user}",
      "gists_url": "https://api.github.com/users/Xekyo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Xekyo/subscriptions",
      "organizations_url": "https://api.github.com/users/Xekyo/orgs",
      "repos_url": "https://api.github.com/users/Xekyo/repos",
      "events_url": "https://api.github.com/users/Xekyo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Xekyo/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "Xekyo",
      "id": 4060799,
      "node_id": "MDQ6VXNlcjQwNjA3OTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Xekyo",
      "html_url": "https://github.com/Xekyo",
      "followers_url": "https://api.github.com/users/Xekyo/followers",
      "following_url": "https://api.github.com/users/Xekyo/following{/other_user}",
      "gists_url": "https://api.github.com/users/Xekyo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Xekyo/subscriptions",
      "organizations_url": "https://api.github.com/users/Xekyo/orgs",
      "repos_url": "https://api.github.com/users/Xekyo/repos",
      "events_url": "https://api.github.com/users/Xekyo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Xekyo/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "075faaebf2e534265ff8aca015eaf03a8a156f32",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/075faaebf2e534265ff8aca015eaf03a8a156f32",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/075faaebf2e534265ff8aca015eaf03a8a156f32"
      }
    ],
    "stats": {
      "total": 13,
      "additions": 13,
      "deletions": 0
    },
    "files": [
      {
        "sha": "06b77bb9b98f1a979e1e16c32ba25772b58f6fcf",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 13,
        "deletions": 0,
        "changes": 13,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5c03483e26ab414d22ef192691b2336c1bb3cb02/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5c03483e26ab414d22ef192691b2336c1bb3cb02/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=5c03483e26ab414d22ef192691b2336c1bb3cb02",
        "patch": "@@ -1620,6 +1620,19 @@ static void ApproximateBestSubset(vector<pair<CAmount, pair<const CWalletTx*,uns\n                     if (nTotal >= nTargetValue)\n                     {\n                         fReachedTarget = true;\n+\n+                        for (unsigned int i = 0; i < vValue.size(); i++)\n+                        {                        \n+                            //The target has been reached, but the candidate set may contain extraneous inputs.\n+                            //This iterates over all inputs and deducts any that are included, but smaller \n+                            //than the amount nTargetValue is still exceeded by.\n+                            if (vfIncluded[i] && (nTotal - vValue[i].first) >= nTargetValue )\n+                            {\n+                                vfIncluded[i] = false;\n+                                nTotal -= vValue[i].first;\n+                            }\n+                        }\n+                        \n                         if (nTotal < nBest)\n                         {\n                             nBest = nTotal;"
      }
    ]
  },
  {
    "sha": "af9510e0374443b093d633a91c4f1f8bf5071292",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzphZjk1MTBlMDM3NDQ0M2IwOTNkNjMzYTkxYzRmMWY4YmY1MDcxMjky",
    "commit": {
      "author": {
        "name": "Murch",
        "email": "alszacrel@web.de",
        "date": "2015-12-06T21:20:41Z"
      },
      "committer": {
        "name": "Murch",
        "email": "alszacrel@web.de",
        "date": "2015-12-07T16:36:47Z"
      },
      "message": "Moved set reduction to the end of ApproximateBestSubset to reduce performance impact",
      "tree": {
        "sha": "d964d4ee866a6adfee8d85584ad43bd731238a03",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d964d4ee866a6adfee8d85584ad43bd731238a03"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/af9510e0374443b093d633a91c4f1f8bf5071292",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/af9510e0374443b093d633a91c4f1f8bf5071292",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/af9510e0374443b093d633a91c4f1f8bf5071292",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/af9510e0374443b093d633a91c4f1f8bf5071292/comments",
    "author": {
      "login": "Xekyo",
      "id": 4060799,
      "node_id": "MDQ6VXNlcjQwNjA3OTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Xekyo",
      "html_url": "https://github.com/Xekyo",
      "followers_url": "https://api.github.com/users/Xekyo/followers",
      "following_url": "https://api.github.com/users/Xekyo/following{/other_user}",
      "gists_url": "https://api.github.com/users/Xekyo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Xekyo/subscriptions",
      "organizations_url": "https://api.github.com/users/Xekyo/orgs",
      "repos_url": "https://api.github.com/users/Xekyo/repos",
      "events_url": "https://api.github.com/users/Xekyo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Xekyo/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "Xekyo",
      "id": 4060799,
      "node_id": "MDQ6VXNlcjQwNjA3OTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Xekyo",
      "html_url": "https://github.com/Xekyo",
      "followers_url": "https://api.github.com/users/Xekyo/followers",
      "following_url": "https://api.github.com/users/Xekyo/following{/other_user}",
      "gists_url": "https://api.github.com/users/Xekyo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Xekyo/subscriptions",
      "organizations_url": "https://api.github.com/users/Xekyo/orgs",
      "repos_url": "https://api.github.com/users/Xekyo/repos",
      "events_url": "https://api.github.com/users/Xekyo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Xekyo/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "5c03483e26ab414d22ef192691b2336c1bb3cb02",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5c03483e26ab414d22ef192691b2336c1bb3cb02",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/5c03483e26ab414d22ef192691b2336c1bb3cb02"
      }
    ],
    "stats": {
      "total": 27,
      "additions": 11,
      "deletions": 16
    },
    "files": [
      {
        "sha": "f9e8a97ae65d655d05fe5d4a1b083fc58948de9e",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 11,
        "deletions": 16,
        "changes": 27,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/af9510e0374443b093d633a91c4f1f8bf5071292/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/af9510e0374443b093d633a91c4f1f8bf5071292/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=af9510e0374443b093d633a91c4f1f8bf5071292",
        "patch": "@@ -1605,7 +1605,7 @@ static void ApproximateBestSubset(vector<pair<CAmount, pair<const CWalletTx*,uns\n         bool fReachedTarget = false;\n         for (int nPass = 0; nPass < 2 && !fReachedTarget; nPass++)\n         {\n-            for (unsigned int i = 0; i < vValue.size(); i++)\n+            for (unsigned int i = 0; i < vValue.size() && !fReachedTarget; i++)\n             {\n                 //The solver here uses a randomized algorithm,\n                 //the randomness serves no real security purpose but is just\n@@ -1620,31 +1620,26 @@ static void ApproximateBestSubset(vector<pair<CAmount, pair<const CWalletTx*,uns\n                     if (nTotal >= nTargetValue)\n                     {\n                         fReachedTarget = true;\n-\n-                        for (unsigned int i = 0; i < vValue.size(); i++)\n-                        {                        \n-                            //The target has been reached, but the candidate set may contain extraneous inputs.\n-                            //This iterates over all inputs and deducts any that are included, but smaller \n-                            //than the amount nTargetValue is still exceeded by.\n-                            if (vfIncluded[i] && (nTotal - vValue[i].first) >= nTargetValue )\n-                            {\n-                                vfIncluded[i] = false;\n-                                nTotal -= vValue[i].first;\n-                            }\n-                        }\n-                        \n                         if (nTotal < nBest)\n                         {\n                             nBest = nTotal;\n                             vfBest = vfIncluded;\n                         }\n-                        nTotal -= vValue[i].first;\n-                        vfIncluded[i] = false;\n                     }\n                 }\n             }\n         }\n     }\n+\n+    //Reduces the approximate best subset by removing any inputs that are smaller than the surplus of nTotal beyond nTargetValue. \n+    for (unsigned int i = 0; i < vValue.size(); i++)\n+    {                        \n+\tif (vfBest[i] && (nBest - vValue[i].first) >= nTargetValue )\n+\t{\n+\t    vfBest[i] = false;\n+\t    nBest -= vValue[i].first;\n+\t}\n+    }\n }\n \n bool CWallet::SelectCoinsMinConf(const CAmount& nTargetValue, int nConfMine, int nConfTheirs, vector<COutput> vCoins,"
      }
    ]
  },
  {
    "sha": "fc0f52d78085b6ef97d6821fc7592326c2d9b495",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYzBmNTJkNzgwODViNmVmOTdkNjgyMWZjNzU5MjMyNmMyZDliNDk1",
    "commit": {
      "author": {
        "name": "Murch",
        "email": "alszacrel@web.de",
        "date": "2015-12-06T23:15:36Z"
      },
      "committer": {
        "name": "Murch",
        "email": "alszacrel@web.de",
        "date": "2015-12-07T19:08:37Z"
      },
      "message": "Added a test for the pruning of extraneous inputs after ApproximateBestSet",
      "tree": {
        "sha": "a2de0198446bee8439bfdba90cb74efd0256817c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a2de0198446bee8439bfdba90cb74efd0256817c"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fc0f52d78085b6ef97d6821fc7592326c2d9b495",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fc0f52d78085b6ef97d6821fc7592326c2d9b495",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fc0f52d78085b6ef97d6821fc7592326c2d9b495",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fc0f52d78085b6ef97d6821fc7592326c2d9b495/comments",
    "author": {
      "login": "Xekyo",
      "id": 4060799,
      "node_id": "MDQ6VXNlcjQwNjA3OTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Xekyo",
      "html_url": "https://github.com/Xekyo",
      "followers_url": "https://api.github.com/users/Xekyo/followers",
      "following_url": "https://api.github.com/users/Xekyo/following{/other_user}",
      "gists_url": "https://api.github.com/users/Xekyo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Xekyo/subscriptions",
      "organizations_url": "https://api.github.com/users/Xekyo/orgs",
      "repos_url": "https://api.github.com/users/Xekyo/repos",
      "events_url": "https://api.github.com/users/Xekyo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Xekyo/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "Xekyo",
      "id": 4060799,
      "node_id": "MDQ6VXNlcjQwNjA3OTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Xekyo",
      "html_url": "https://github.com/Xekyo",
      "followers_url": "https://api.github.com/users/Xekyo/followers",
      "following_url": "https://api.github.com/users/Xekyo/following{/other_user}",
      "gists_url": "https://api.github.com/users/Xekyo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Xekyo/subscriptions",
      "organizations_url": "https://api.github.com/users/Xekyo/orgs",
      "repos_url": "https://api.github.com/users/Xekyo/repos",
      "events_url": "https://api.github.com/users/Xekyo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Xekyo/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "af9510e0374443b093d633a91c4f1f8bf5071292",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/af9510e0374443b093d633a91c4f1f8bf5071292",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/af9510e0374443b093d633a91c4f1f8bf5071292"
      }
    ],
    "stats": {
      "total": 32,
      "additions": 26,
      "deletions": 6
    },
    "files": [
      {
        "sha": "5e8ccd90ab1ec87f5e1303dc3bbedb92a81bf1a2",
        "filename": "src/wallet/test/wallet_tests.cpp",
        "status": "modified",
        "additions": 18,
        "deletions": 0,
        "changes": 18,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fc0f52d78085b6ef97d6821fc7592326c2d9b495/src/wallet/test/wallet_tests.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fc0f52d78085b6ef97d6821fc7592326c2d9b495/src/wallet/test/wallet_tests.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/test/wallet_tests.cpp?ref=fc0f52d78085b6ef97d6821fc7592326c2d9b495",
        "patch": "@@ -328,4 +328,22 @@ BOOST_AUTO_TEST_CASE(coin_selection_tests)\n     empty_wallet();\n }\n \n+BOOST_AUTO_TEST_CASE(pruning_in_ApproximateBestSet)\n+{\n+    CoinSet setCoinsRet;\n+    CAmount nValueRet;\n+\n+    LOCK(wallet.cs_wallet);\n+\n+    empty_wallet();\n+    for (int i = 0; i < 12; i++) \n+    {\n+        add_coin(10*CENT);\n+    }\n+    add_coin(100*CENT);\n+    add_coin(100*CENT);\n+    BOOST_CHECK(wallet.SelectCoinsMinConf(221*CENT, 1, 6, vCoins, setCoinsRet, nValueRet));\n+    BOOST_CHECK_EQUAL(nValueRet, 230*CENT);\n+}\n+\n BOOST_AUTO_TEST_SUITE_END()"
      },
      {
        "sha": "a262769c4d791735d79cf55d8818c9a327326ffb",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 8,
        "deletions": 6,
        "changes": 14,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fc0f52d78085b6ef97d6821fc7592326c2d9b495/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fc0f52d78085b6ef97d6821fc7592326c2d9b495/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=fc0f52d78085b6ef97d6821fc7592326c2d9b495",
        "patch": "@@ -1605,7 +1605,7 @@ static void ApproximateBestSubset(vector<pair<CAmount, pair<const CWalletTx*,uns\n         bool fReachedTarget = false;\n         for (int nPass = 0; nPass < 2 && !fReachedTarget; nPass++)\n         {\n-            for (unsigned int i = 0; i < vValue.size() && !fReachedTarget; i++)\n+            for (unsigned int i = 0; i < vValue.size(); i++)\n             {\n                 //The solver here uses a randomized algorithm,\n                 //the randomness serves no real security purpose but is just\n@@ -1625,6 +1625,8 @@ static void ApproximateBestSubset(vector<pair<CAmount, pair<const CWalletTx*,uns\n                             nBest = nTotal;\n                             vfBest = vfIncluded;\n                         }\n+                        nTotal -= vValue[i].first;\n+                        vfIncluded[i] = false;\n                     }\n                 }\n             }\n@@ -1634,11 +1636,11 @@ static void ApproximateBestSubset(vector<pair<CAmount, pair<const CWalletTx*,uns\n     //Reduces the approximate best subset by removing any inputs that are smaller than the surplus of nTotal beyond nTargetValue. \n     for (unsigned int i = 0; i < vValue.size(); i++)\n     {                        \n-\tif (vfBest[i] && (nBest - vValue[i].first) >= nTargetValue )\n-\t{\n-\t    vfBest[i] = false;\n-\t    nBest -= vValue[i].first;\n-\t}\n+        if (vfBest[i] && (nBest - vValue[i].first) >= nTargetValue )\n+        {\n+            vfBest[i] = false;\n+            nBest -= vValue[i].first;\n+        }\n     }\n }\n "
      }
    ]
  }
]