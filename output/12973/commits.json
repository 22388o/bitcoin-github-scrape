[
  {
    "sha": "152701568159915828613fa131e94e21337c0c2d",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxNTI3MDE1NjgxNTk5MTU4Mjg2MTNmYTEzMWU5NGUyMTMzN2MwYzJk",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2018-04-13T05:31:15Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2018-04-13T08:36:53Z"
      },
      "message": "Avoid std::locale/imbue in DateTimeStrFormat",
      "tree": {
        "sha": "5b72f64924e1b377c9b5fd71de49439e340e7738",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/5b72f64924e1b377c9b5fd71de49439e340e7738"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/152701568159915828613fa131e94e21337c0c2d",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/152701568159915828613fa131e94e21337c0c2d",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/152701568159915828613fa131e94e21337c0c2d",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/152701568159915828613fa131e94e21337c0c2d/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "5df84de583c900e00fef63bedaef32786f205a33",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5df84de583c900e00fef63bedaef32786f205a33",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/5df84de583c900e00fef63bedaef32786f205a33"
      }
    ],
    "stats": {
      "total": 42,
      "additions": 14,
      "deletions": 28
    },
    "files": [
      {
        "sha": "e8c7b80c3ae267d01413dc1219d1a5d3394db68f",
        "filename": "src/test/util_tests.cpp",
        "status": "modified",
        "additions": 0,
        "deletions": 11,
        "changes": 11,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/152701568159915828613fa131e94e21337c0c2d/src/test/util_tests.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/152701568159915828613fa131e94e21337c0c2d/src/test/util_tests.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/util_tests.cpp?ref=152701568159915828613fa131e94e21337c0c2d",
        "patch": "@@ -159,17 +159,6 @@ BOOST_AUTO_TEST_CASE(util_HexStr)\n }\n \n \n-BOOST_AUTO_TEST_CASE(util_DateTimeStrFormat)\n-{\n-    BOOST_CHECK_EQUAL(DateTimeStrFormat(\"%Y-%m-%d %H:%M:%S\", 0), \"1970-01-01 00:00:00\");\n-    BOOST_CHECK_EQUAL(DateTimeStrFormat(\"%Y-%m-%d %H:%M:%S\", 0x7FFFFFFF), \"2038-01-19 03:14:07\");\n-    BOOST_CHECK_EQUAL(DateTimeStrFormat(\"%Y-%m-%d %H:%M:%S\", 1317425777), \"2011-09-30 23:36:17\");\n-    BOOST_CHECK_EQUAL(DateTimeStrFormat(\"%Y-%m-%dT%H:%M:%SZ\", 1317425777), \"2011-09-30T23:36:17Z\");\n-    BOOST_CHECK_EQUAL(DateTimeStrFormat(\"%H:%M:%SZ\", 1317425777), \"23:36:17Z\");\n-    BOOST_CHECK_EQUAL(DateTimeStrFormat(\"%Y-%m-%d %H:%M\", 1317425777), \"2011-09-30 23:36\");\n-    BOOST_CHECK_EQUAL(DateTimeStrFormat(\"%a, %d %b %Y %H:%M:%S +0000\", 1317425777), \"Fri, 30 Sep 2011 23:36:17 +0000\");\n-}\n-\n BOOST_AUTO_TEST_CASE(util_FormatISO8601DateTime)\n {\n     BOOST_CHECK_EQUAL(FormatISO8601DateTime(1317425777), \"2011-09-30T23:36:17Z\");"
      },
      {
        "sha": "34800c7b6deeb285a162c78559d0f170743b1a77",
        "filename": "src/utiltime.cpp",
        "status": "modified",
        "additions": 14,
        "deletions": 15,
        "changes": 29,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/152701568159915828613fa131e94e21337c0c2d/src/utiltime.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/152701568159915828613fa131e94e21337c0c2d/src/utiltime.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/utiltime.cpp?ref=152701568159915828613fa131e94e21337c0c2d",
        "patch": "@@ -10,9 +10,10 @@\n #include <utiltime.h>\n \n #include <atomic>\n-\n #include <boost/date_time/posix_time/posix_time.hpp>\n #include <boost/thread.hpp>\n+#include <ctime>\n+#include <tinyformat.h>\n \n static std::atomic<int64_t> nMockTime(0); //!< For unit testing\n \n@@ -75,25 +76,23 @@ void MilliSleep(int64_t n)\n #endif\n }\n \n-std::string DateTimeStrFormat(const char* pszFormat, int64_t nTime)\n-{\n-    static std::locale classic(std::locale::classic());\n-    // std::locale takes ownership of the pointer\n-    std::locale loc(classic, new boost::posix_time::time_facet(pszFormat));\n-    std::stringstream ss;\n-    ss.imbue(loc);\n-    ss << boost::posix_time::from_time_t(nTime);\n-    return ss.str();\n-}\n-\n std::string FormatISO8601DateTime(int64_t nTime) {\n-    return DateTimeStrFormat(\"%Y-%m-%dT%H:%M:%SZ\", nTime);\n+    struct tm ts;\n+    time_t time_val = nTime;\n+    gmtime_r(&time_val, &ts);\n+    return strprintf(\"%04i-%02i-%02iT%02i:%02i:%02iZ\", ts.tm_year + 1900, ts.tm_mon + 1, ts.tm_mday, ts.tm_hour, ts.tm_min, ts.tm_sec);\n }\n \n std::string FormatISO8601Date(int64_t nTime) {\n-    return DateTimeStrFormat(\"%Y-%m-%d\", nTime);\n+    struct tm ts;\n+    time_t time_val = nTime;\n+    gmtime_r(&time_val, &ts);\n+    return strprintf(\"%04i-%02i-%02i\", ts.tm_year + 1900, ts.tm_mon + 1, ts.tm_mday);\n }\n \n std::string FormatISO8601Time(int64_t nTime) {\n-    return DateTimeStrFormat(\"%H:%M:%SZ\", nTime);\n+    struct tm ts;\n+    time_t time_val = nTime;\n+    gmtime_r(&time_val, &ts);\n+    return strprintf(\"%02i:%02i:%02iZ\", ts.tm_hour, ts.tm_min, ts.tm_sec);\n }"
      },
      {
        "sha": "3bcbb00c163e0e5a6eef97559f48dd23420ab29f",
        "filename": "src/utiltime.h",
        "status": "modified",
        "additions": 0,
        "deletions": 2,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/152701568159915828613fa131e94e21337c0c2d/src/utiltime.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/152701568159915828613fa131e94e21337c0c2d/src/utiltime.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/utiltime.h?ref=152701568159915828613fa131e94e21337c0c2d",
        "patch": "@@ -31,8 +31,6 @@ void MilliSleep(int64_t n);\n  * ISO 8601 formatting is preferred. Use the FormatISO8601{DateTime,Date,Time}\n  * helper functions if possible.\n  */\n-std::string DateTimeStrFormat(const char* pszFormat, int64_t nTime);\n-\n std::string FormatISO8601DateTime(int64_t nTime);\n std::string FormatISO8601Date(int64_t nTime);\n std::string FormatISO8601Time(int64_t nTime);"
      }
    ]
  }
]