[
  {
    "sha": "69b01e6f8b3aca781da7f049909ad75de73a804a",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo2OWIwMWU2ZjhiM2FjYTc4MWRhN2YwNDk5MDlhZDc1ZGU3M2E4MDRh",
    "commit": {
      "author": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2018-03-31T20:02:58Z"
      },
      "committer": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2018-04-12T21:00:30Z"
      },
      "message": "Add cancel button to rescan progress dialog\n\nAdds a cancel button to the rescan progress dialog. When it is clicked,\nAbortRescan is called to abort a rescan",
      "tree": {
        "sha": "d4d73a1574e6367c60dea42293280e6a3dd491cb",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d4d73a1574e6367c60dea42293280e6a3dd491cb"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/69b01e6f8b3aca781da7f049909ad75de73a804a",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/69b01e6f8b3aca781da7f049909ad75de73a804a",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/69b01e6f8b3aca781da7f049909ad75de73a804a",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/69b01e6f8b3aca781da7f049909ad75de73a804a/comments",
    "author": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "27278dffe877ab95488f2e0fada53edb9590487f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/27278dffe877ab95488f2e0fada53edb9590487f",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/27278dffe877ab95488f2e0fada53edb9590487f"
      }
    ],
    "stats": {
      "total": 23,
      "additions": 17,
      "deletions": 6
    },
    "files": [
      {
        "sha": "ecc073f9bcfc44ccb092732e5b9047f3a5928f90",
        "filename": "src/interfaces/wallet.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/69b01e6f8b3aca781da7f049909ad75de73a804a/src/interfaces/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/69b01e6f8b3aca781da7f049909ad75de73a804a/src/interfaces/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/interfaces/wallet.cpp?ref=69b01e6f8b3aca781da7f049909ad75de73a804a",
        "patch": "@@ -132,6 +132,7 @@ class WalletImpl : public Wallet\n     {\n         return m_wallet.ChangeWalletPassphrase(old_wallet_passphrase, new_wallet_passphrase);\n     }\n+    void abortRescan() override { m_wallet.AbortRescan(); }\n     bool backupWallet(const std::string& filename) override { return m_wallet.BackupWallet(filename); }\n     std::string getWalletName() override { return m_wallet.GetName(); }\n     bool getKeyFromPool(bool internal, CPubKey& pub_key) override"
      },
      {
        "sha": "dfe3d5f711efd62daaae8833e9d2dc16cf27d464",
        "filename": "src/interfaces/wallet.h",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/69b01e6f8b3aca781da7f049909ad75de73a804a/src/interfaces/wallet.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/69b01e6f8b3aca781da7f049909ad75de73a804a/src/interfaces/wallet.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/interfaces/wallet.h?ref=69b01e6f8b3aca781da7f049909ad75de73a804a",
        "patch": "@@ -65,6 +65,9 @@ class Wallet\n     virtual bool changeWalletPassphrase(const SecureString& old_wallet_passphrase,\n         const SecureString& new_wallet_passphrase) = 0;\n \n+    //! Abort a rescan.\n+    virtual void abortRescan() = 0;\n+\n     //! Back up wallet.\n     virtual bool backupWallet(const std::string& filename) = 0;\n "
      },
      {
        "sha": "d529595dec22070e03d58bc752a8cb8438f68091",
        "filename": "src/qt/walletview.cpp",
        "status": "modified",
        "additions": 8,
        "deletions": 3,
        "changes": 11,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/69b01e6f8b3aca781da7f049909ad75de73a804a/src/qt/walletview.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/69b01e6f8b3aca781da7f049909ad75de73a804a/src/qt/walletview.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/walletview.cpp?ref=69b01e6f8b3aca781da7f049909ad75de73a804a",
        "patch": "@@ -315,9 +315,9 @@ void WalletView::showProgress(const QString &title, int nProgress)\n         progressDialog = new QProgressDialog(title, \"\", 0, 100);\n         progressDialog->setWindowModality(Qt::ApplicationModal);\n         progressDialog->setMinimumDuration(0);\n-        progressDialog->setCancelButton(0);\n         progressDialog->setAutoClose(false);\n         progressDialog->setValue(0);\n+        progressDialog->setCancelButtonText(tr(\"Cancel\"));\n     }\n     else if (nProgress == 100)\n     {\n@@ -327,8 +327,13 @@ void WalletView::showProgress(const QString &title, int nProgress)\n             progressDialog->deleteLater();\n         }\n     }\n-    else if (progressDialog)\n-        progressDialog->setValue(nProgress);\n+    else if (progressDialog) {\n+        if (progressDialog->wasCanceled()) {\n+            getWalletModel()->wallet().abortRescan();\n+        } else {\n+            progressDialog->setValue(nProgress);\n+        }\n+    }\n }\n \n void WalletView::requestedSyncWarningInfo()"
      },
      {
        "sha": "55cdbdb145eb7a288085a2ec2e2e5dd4e4c61b05",
        "filename": "src/wallet/rpcdump.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 3,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/69b01e6f8b3aca781da7f049909ad75de73a804a/src/wallet/rpcdump.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/69b01e6f8b3aca781da7f049909ad75de73a804a/src/wallet/rpcdump.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcdump.cpp?ref=69b01e6f8b3aca781da7f049909ad75de73a804a",
        "patch": "@@ -534,9 +534,11 @@ UniValue importwallet(const JSONRPCRequest& request)\n         int64_t nFilesize = std::max((int64_t)1, (int64_t)file.tellg());\n         file.seekg(0, file.beg);\n \n-        pwallet->ShowProgress(_(\"Importing...\"), 0); // show progress dialog in GUI\n+        // Use uiInterface.ShowProgress instead of pwallet.ShowProgress because pwallet.ShowProgress has a cancel button tied to AbortRescan which\n+        // we don't want for this progress bar shoing the import progress. uiInterface.ShowProgress does not have a cancel button.\n+        uiInterface.ShowProgress(_(\"Importing...\"), 0, false); // show progress dialog in GUI\n         while (file.good()) {\n-            pwallet->ShowProgress(\"\", std::max(1, std::min(99, (int)(((double)file.tellg() / (double)nFilesize) * 100))));\n+            uiInterface.ShowProgress(\"\", std::max(1, std::min(99, (int)(((double)file.tellg() / (double)nFilesize) * 100))), false);\n             std::string line;\n             std::getline(file, line);\n             if (line.empty() || line[0] == '#')\n@@ -599,7 +601,7 @@ UniValue importwallet(const JSONRPCRequest& request)\n             }\n         }\n         file.close();\n-        pwallet->ShowProgress(\"\", 100); // hide progress dialog in GUI\n+        uiInterface.ShowProgress(\"\", 100, false); // hide progress dialog in GUI\n         pwallet->UpdateTimeFirstKey(nTimeBegin);\n     }\n     pwallet->RescanFromTime(nTimeBegin, reserver, false /* update */);"
      }
    ]
  },
  {
    "sha": "ae1d2b0308d7fe9df7fc18699c69e9587e6154bd",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzphZTFkMmIwMzA4ZDdmZTlkZjdmYzE4Njk5YzY5ZTk1ODdlNjE1NGJk",
    "commit": {
      "author": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2017-08-31T00:34:03Z"
      },
      "committer": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2018-04-12T21:00:34Z"
      },
      "message": "Give an error when rescan is aborted by the user",
      "tree": {
        "sha": "6e07e934d6e84487c1c25c3dd4cab597e331db59",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6e07e934d6e84487c1c25c3dd4cab597e331db59"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ae1d2b0308d7fe9df7fc18699c69e9587e6154bd",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ae1d2b0308d7fe9df7fc18699c69e9587e6154bd",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/ae1d2b0308d7fe9df7fc18699c69e9587e6154bd",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ae1d2b0308d7fe9df7fc18699c69e9587e6154bd/comments",
    "author": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "69b01e6f8b3aca781da7f049909ad75de73a804a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/69b01e6f8b3aca781da7f049909ad75de73a804a",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/69b01e6f8b3aca781da7f049909ad75de73a804a"
      }
    ],
    "stats": {
      "total": 36,
      "additions": 32,
      "deletions": 4
    },
    "files": [
      {
        "sha": "b8533839a0e9f5b199828cc3447d01c79501745f",
        "filename": "src/wallet/rpcdump.cpp",
        "status": "modified",
        "additions": 32,
        "deletions": 4,
        "changes": 36,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/ae1d2b0308d7fe9df7fc18699c69e9587e6154bd/src/wallet/rpcdump.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/ae1d2b0308d7fe9df7fc18699c69e9587e6154bd/src/wallet/rpcdump.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcdump.cpp?ref=ae1d2b0308d7fe9df7fc18699c69e9587e6154bd",
        "patch": "@@ -172,7 +172,13 @@ UniValue importprivkey(const JSONRPCRequest& request)\n         }\n     }\n     if (fRescan) {\n-        pwallet->RescanFromTime(TIMESTAMP_MIN, reserver, true /* update */);\n+        int64_t scanned_time = pwallet->RescanFromTime(TIMESTAMP_MIN, reserver, true /* update */);\n+        if (pwallet->IsAbortingRescan()) {\n+            throw JSONRPCError(RPC_MISC_ERROR, \"Rescan aborted by user.\");\n+        }\n+        if (scanned_time > TIMESTAMP_MIN) {\n+            throw JSONRPCError(RPC_WALLET_ERROR, \"Rescan was unable to fully rescan the blockchain. Some transactions may be missing.\");\n+        }\n     }\n \n     return NullUniValue;\n@@ -310,7 +316,13 @@ UniValue importaddress(const JSONRPCRequest& request)\n     }\n     if (fRescan)\n     {\n-        pwallet->RescanFromTime(TIMESTAMP_MIN, reserver, true /* update */);\n+        int64_t scanned_time = pwallet->RescanFromTime(TIMESTAMP_MIN, reserver, true /* update */);\n+        if (pwallet->IsAbortingRescan()) {\n+            throw JSONRPCError(RPC_MISC_ERROR, \"Rescan aborted by user.\");\n+        }\n+        if (scanned_time > TIMESTAMP_MIN) {\n+            throw JSONRPCError(RPC_WALLET_ERROR, \"Rescan was unable to fully rescan the blockchain. Some transactions may be missing.\");\n+        }\n         pwallet->ReacceptWalletTransactions();\n     }\n \n@@ -479,7 +491,13 @@ UniValue importpubkey(const JSONRPCRequest& request)\n     }\n     if (fRescan)\n     {\n-        pwallet->RescanFromTime(TIMESTAMP_MIN, reserver, true /* update */);\n+        int64_t scanned_time = pwallet->RescanFromTime(TIMESTAMP_MIN, reserver, true /* update */);\n+        if (pwallet->IsAbortingRescan()) {\n+            throw JSONRPCError(RPC_MISC_ERROR, \"Rescan aborted by user.\");\n+        }\n+        if (scanned_time > TIMESTAMP_MIN) {\n+            throw JSONRPCError(RPC_WALLET_ERROR, \"Rescan was unable to fully rescan the blockchain. Some transactions may be missing.\");\n+        }\n         pwallet->ReacceptWalletTransactions();\n     }\n \n@@ -604,7 +622,14 @@ UniValue importwallet(const JSONRPCRequest& request)\n         uiInterface.ShowProgress(\"\", 100, false); // hide progress dialog in GUI\n         pwallet->UpdateTimeFirstKey(nTimeBegin);\n     }\n-    pwallet->RescanFromTime(nTimeBegin, reserver, false /* update */);\n+    uiInterface.ShowProgress(\"\", 100, false); // hide progress dialog in GUI\n+    int64_t scanned_time = pwallet->RescanFromTime(nTimeBegin, reserver, false /* update */);\n+    if (pwallet->IsAbortingRescan()) {\n+        throw JSONRPCError(RPC_MISC_ERROR, \"Rescan aborted by user.\");\n+    }\n+    if (scanned_time > nTimeBegin) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Rescan was unable to fully rescan the blockchain. Some transactions may be missing.\");\n+    }\n     pwallet->MarkDirty();\n \n     if (!fGood)\n@@ -1214,6 +1239,9 @@ UniValue importmulti(const JSONRPCRequest& mainRequest)\n         int64_t scannedTime = pwallet->RescanFromTime(nLowestTimestamp, reserver, true /* update */);\n         pwallet->ReacceptWalletTransactions();\n \n+        if (pwallet->IsAbortingRescan()) {\n+            throw JSONRPCError(RPC_MISC_ERROR, \"Rescan aborted by user.\");\n+        }\n         if (scannedTime > nLowestTimestamp) {\n             std::vector<UniValue> results = response.getValues();\n             response.clear();"
      }
    ]
  }
]