[
  {
    "sha": "bb2c8ce23c9d7ba8d0e5538243e07218443c85b4",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiYjJjOGNlMjNjOWQ3YmE4ZDBlNTUzODI0M2UwNzIxODQ0M2M4NWI0",
    "commit": {
      "author": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2019-11-20T17:38:44Z"
      },
      "committer": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2019-11-23T04:45:34Z"
      },
      "message": "keypool: Remove  superfluous topup from CWallet::GetNewChangeDestination\n\nThis does not change behavior. This TopUp() is unnecessary as currently\nm_spk_man calls TopUp further down the call stack inside\nLegacyScriptPubKeyMan::ReserveKeyFromKeyPool (called by LegacyScriptPubKeyMan::GetReservedDestination)\n\nBy removing this here, we also prepare for future changes where CWallet\nhas multiple ScriptPubKeyMans instead of m_spk_man.",
      "tree": {
        "sha": "ba69a2c29e32a5f5fa44720e07f81b63a6528d7e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ba69a2c29e32a5f5fa44720e07f81b63a6528d7e"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/bb2c8ce23c9d7ba8d0e5538243e07218443c85b4",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bb2c8ce23c9d7ba8d0e5538243e07218443c85b4",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/bb2c8ce23c9d7ba8d0e5538243e07218443c85b4",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bb2c8ce23c9d7ba8d0e5538243e07218443c85b4/comments",
    "author": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "0b79caf658019de2c65a53c9e11fd1d2f4c369b6",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0b79caf658019de2c65a53c9e11fd1d2f4c369b6",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/0b79caf658019de2c65a53c9e11fd1d2f4c369b6"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 0,
      "deletions": 2
    },
    "files": [
      {
        "sha": "65ac679825303764a8a95f591a6a32e2a2c2d9e6",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 0,
        "deletions": 2,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/bb2c8ce23c9d7ba8d0e5538243e07218443c85b4/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/bb2c8ce23c9d7ba8d0e5538243e07218443c85b4/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=bb2c8ce23c9d7ba8d0e5538243e07218443c85b4",
        "patch": "@@ -3122,8 +3122,6 @@ bool CWallet::GetNewChangeDestination(const OutputType type, CTxDestination& des\n {\n     error.clear();\n \n-    m_spk_man->TopUp();\n-\n     ReserveDestination reservedest(this, type);\n     if (!reservedest.GetReservedDestination(dest, true)) {\n         error = \"Error: Keypool ran out, please call keypoolrefill first\";"
      }
    ]
  },
  {
    "sha": "ea50e34b287e0da0806c1116bb55ade730e8ff6c",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzplYTUwZTM0YjI4N2UwZGEwODA2YzExMTZiYjU1YWRlNzMwZThmZjZj",
    "commit": {
      "author": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2019-11-20T17:42:10Z"
      },
      "committer": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2019-11-23T04:45:34Z"
      },
      "message": "keypool: Move opportunistic TopUps from LegacyScriptPubKeyMan to CWallet and ReserveDestination\n\nAn opportunistic TopUp is moved from LegacyScriptPubKeyMan::GetNewDestination\nto CWallet::GetNewDestination. Another opportunistic TopUp is moved from\nLegacyScriptPubKeyMan::ReserveKeyFromKeyPool (called by LegacyScriptPubKeyMan::GetReservedDestination)\nto ReserveDestination::GetReservedDestination.\n\nMoving opportunistic TopUps ensures that ScriptPubKeyMans will always\nbe topped up before requesting Destinations from them as we cannot\nalways rely on future ScriptPubKeyMan implementaions topping up internally.\nAs such, it is also unnecessary to keep the TopUp calls in the\nLegacyScriptPubKeyMan functions so they are moved.\n\nThis does not change behavior as TopUp calls are moved up the call stack.",
      "tree": {
        "sha": "5d2911268e01609efcbc373b4dc1fea962ada94c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/5d2911268e01609efcbc373b4dc1fea962ada94c"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ea50e34b287e0da0806c1116bb55ade730e8ff6c",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ea50e34b287e0da0806c1116bb55ade730e8ff6c",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/ea50e34b287e0da0806c1116bb55ade730e8ff6c",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ea50e34b287e0da0806c1116bb55ade730e8ff6c/comments",
    "author": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "bb2c8ce23c9d7ba8d0e5538243e07218443c85b4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bb2c8ce23c9d7ba8d0e5538243e07218443c85b4",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/bb2c8ce23c9d7ba8d0e5538243e07218443c85b4"
      }
    ],
    "stats": {
      "total": 6,
      "additions": 3,
      "deletions": 3
    },
    "files": [
      {
        "sha": "6ed0a6a6ad458f495ce43b6e267385876411cc4f",
        "filename": "src/wallet/scriptpubkeyman.cpp",
        "status": "modified",
        "additions": 0,
        "deletions": 3,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/ea50e34b287e0da0806c1116bb55ade730e8ff6c/src/wallet/scriptpubkeyman.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/ea50e34b287e0da0806c1116bb55ade730e8ff6c/src/wallet/scriptpubkeyman.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/scriptpubkeyman.cpp?ref=ea50e34b287e0da0806c1116bb55ade730e8ff6c",
        "patch": "@@ -14,7 +14,6 @@\n bool LegacyScriptPubKeyMan::GetNewDestination(const OutputType type, CTxDestination& dest, std::string& error)\n {\n     error.clear();\n-    TopUp();\n \n     // Generate a new key that is added to wallet\n     CPubKey new_key;\n@@ -1147,8 +1146,6 @@ bool LegacyScriptPubKeyMan::ReserveKeyFromKeyPool(int64_t& nIndex, CKeyPool& key\n     {\n         LOCK(cs_wallet);\n \n-        TopUp();\n-\n         bool fReturningInternal = fRequestedInternal;\n         fReturningInternal &= (IsHDEnabled() && m_storage.CanSupportFeature(FEATURE_HD_SPLIT)) || m_storage.IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS);\n         bool use_split_keypool = set_pre_split_keypool.empty();"
      },
      {
        "sha": "e8abb437e9ab867464775abd1fc1145917a90f50",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/ea50e34b287e0da0806c1116bb55ade730e8ff6c/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/ea50e34b287e0da0806c1116bb55ade730e8ff6c/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=ea50e34b287e0da0806c1116bb55ade730e8ff6c",
        "patch": "@@ -3109,6 +3109,7 @@ bool CWallet::GetNewDestination(const OutputType type, const std::string label,\n     bool result = false;\n     auto spk_man = m_spk_man.get();\n     if (spk_man) {\n+        spk_man->TopUp();\n         result = spk_man->GetNewDestination(type, dest, error);\n     }\n     if (result) {\n@@ -3302,6 +3303,8 @@ bool ReserveDestination::GetReservedDestination(CTxDestination& dest, bool inter\n \n     if (nIndex == -1)\n     {\n+        m_spk_man->TopUp();\n+\n         CKeyPool keypool;\n         if (!m_spk_man->GetReservedDestination(type, internal, nIndex, keypool)) {\n             return false;"
      }
    ]
  },
  {
    "sha": "6e77a7b65cda1b46ce42f0c99ca91562255aeb28",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo2ZTc3YTdiNjVjZGExYjQ2Y2U0MmYwYzk5Y2E5MTU2MjI1NWFlYjI4",
    "commit": {
      "author": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2019-11-20T20:41:20Z"
      },
      "committer": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2019-12-05T16:51:52Z"
      },
      "message": "keypool: Add comment about TopUp and when to use it",
      "tree": {
        "sha": "723b5cecff1d0cc2afb7b5f475dc2812af26190d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/723b5cecff1d0cc2afb7b5f475dc2812af26190d"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6e77a7b65cda1b46ce42f0c99ca91562255aeb28",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6e77a7b65cda1b46ce42f0c99ca91562255aeb28",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/6e77a7b65cda1b46ce42f0c99ca91562255aeb28",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6e77a7b65cda1b46ce42f0c99ca91562255aeb28/comments",
    "author": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "ea50e34b287e0da0806c1116bb55ade730e8ff6c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ea50e34b287e0da0806c1116bb55ade730e8ff6c",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/ea50e34b287e0da0806c1116bb55ade730e8ff6c"
      }
    ],
    "stats": {
      "total": 4,
      "additions": 4,
      "deletions": 0
    },
    "files": [
      {
        "sha": "37b34223d91b76c84f56d5e5bdf8aa072c6f6f0f",
        "filename": "src/wallet/scriptpubkeyman.h",
        "status": "modified",
        "additions": 4,
        "deletions": 0,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6e77a7b65cda1b46ce42f0c99ca91562255aeb28/src/wallet/scriptpubkeyman.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6e77a7b65cda1b46ce42f0c99ca91562255aeb28/src/wallet/scriptpubkeyman.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/scriptpubkeyman.h?ref=6e77a7b65cda1b46ce42f0c99ca91562255aeb28",
        "patch": "@@ -154,6 +154,10 @@ class ScriptPubKeyMan\n     virtual void KeepDestination(int64_t index) {}\n     virtual void ReturnDestination(int64_t index, bool internal, const CPubKey& pubkey) {}\n \n+    /** Fills internal address pool. Use within ScriptPubKeyMan implementations should be used sparingly and only\n+      * when something from the address pool is removed, excluding GetNewDestination and GetReservedDestination.\n+      * External wallet code is primarily responsible for topping up prior to fetching new addresses\n+      */\n     virtual bool TopUp(unsigned int size = 0) { return false; }\n \n     //! Mark unused addresses as being used"
      }
    ]
  }
]