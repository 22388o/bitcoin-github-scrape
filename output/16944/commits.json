[
  {
    "sha": "40537f090907f81ba885edb7dff1558382976912",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0MDUzN2YwOTA5MDdmODFiYTg4NWVkYjdkZmYxNTU4MzgyOTc2OTEy",
    "commit": {
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2019-09-23T17:13:55Z"
      },
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2019-11-13T17:54:39Z"
      },
      "message": "[wallet] ListCoins: include watch-only for wallets without private keys\n\nThis makes them available in GUI coin selection.",
      "tree": {
        "sha": "fbe1a0e7974afb8aeb9ce13dede8b1cf3b055271",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/fbe1a0e7974afb8aeb9ce13dede8b1cf3b055271"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/40537f090907f81ba885edb7dff1558382976912",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAl3MQ18ACgkQV/+b28ww\nEAmgug//adFdx3nA8dji27zWd2PkFcAA/ThfK+iiFuuHTlMNE5U5TU8NdalR7K78\nHSdqfW76vi7VzDahr5nNfKmFgbqgqdHkxcDF7lTJdVRN+SSiL33oTy2gM2u9UHGN\nICZJrMy64RnU8bJVMJY5hYfloPhshqBZoWFjR5odxJpVe596ajRtRNXN+GLg/49o\nautdV068trLAs1YqSY8aEMossyynLv0EjWhj2XnMKhlTHjP691NVn4sPUudoAufO\niyLYkR2cuL5lWp+k1nWXxZCcNnobyugdNsJnzRfTdzaYHs3EmUNI1Zv0YA+7OdQ8\nOFUzFXPb9s3vaFFj1gXRbCzVyFEan4qGV+JUejblqdIZsIQ+qwEAXLq/+puvJL2F\n2h1LxN35i57hqTfcgsCMVu5hXb2LDQmNw+8HGmO8M0eP+/DjkmjPm5BiXZm/pS4u\ni8jRICq3iYggY54aLTLCKkQ26W82QMNTB+8Y+3cuFppOJ2vka9/iLNZJjMtgEeG2\n9rVvV7blnKOA7Dk2vpC6ZtcoElqv69zPO9NScSLNUfzPO1WJ+CO3bAgPwL0VJ2C1\nQxU2Wlbc4jFZpHovBrN+N/faQhbXzWtRnNeHVwUs242HxV6Oq6+4O7zUxaj1AbFm\nGQHePXCnnLXTI1Pn/DfHTotX6pGtm757eJcq/syD78HWnFYt+BE=\n=RvAe\n-----END PGP SIGNATURE-----",
        "payload": "tree fbe1a0e7974afb8aeb9ce13dede8b1cf3b055271\nparent 8021392b825c74312173f15eb937ba6d4aec3841\nauthor Sjors Provoost <sjors@sprovoost.nl> 1569258835 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1573667679 +0100\n\n[wallet] ListCoins: include watch-only for wallets without private keys\n\nThis makes them available in GUI coin selection.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/40537f090907f81ba885edb7dff1558382976912",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/40537f090907f81ba885edb7dff1558382976912",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/40537f090907f81ba885edb7dff1558382976912/comments",
    "author": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "8021392b825c74312173f15eb937ba6d4aec3841",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8021392b825c74312173f15eb937ba6d4aec3841",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/8021392b825c74312173f15eb937ba6d4aec3841"
      }
    ],
    "stats": {
      "total": 8,
      "additions": 6,
      "deletions": 2
    },
    "files": [
      {
        "sha": "058b70d85253687fce6e30876fc3279a89cd4523",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 6,
        "deletions": 2,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/40537f090907f81ba885edb7dff1558382976912/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/40537f090907f81ba885edb7dff1558382976912/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=40537f090907f81ba885edb7dff1558382976912",
        "patch": "@@ -2160,20 +2160,24 @@ std::map<CTxDestination, std::vector<COutput>> CWallet::ListCoins(interfaces::Ch\n \n     for (const COutput& coin : availableCoins) {\n         CTxDestination address;\n-        if (coin.fSpendable &&\n+        if ((coin.fSpendable || (IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) && coin.fSolvable)) &&\n             ExtractDestination(FindNonChangeParentOutput(*coin.tx->tx, coin.i).scriptPubKey, address)) {\n             result[address].emplace_back(std::move(coin));\n         }\n     }\n \n     std::vector<COutPoint> lockedCoins;\n     ListLockedCoins(lockedCoins);\n+    // Include watch-only for wallets without private keys\n+    const bool include_watch_only = IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS);\n+    const isminetype is_mine_filter = include_watch_only ? ISMINE_WATCH_ONLY : ISMINE_SPENDABLE;\n     for (const COutPoint& output : lockedCoins) {\n         auto it = mapWallet.find(output.hash);\n         if (it != mapWallet.end()) {\n             int depth = it->second.GetDepthInMainChain();\n             if (depth >= 0 && output.n < it->second.tx->vout.size() &&\n-                IsMine(it->second.tx->vout[output.n]) == ISMINE_SPENDABLE) {\n+                IsMine(it->second.tx->vout[output.n]) == is_mine_filter\n+            ) {\n                 CTxDestination address;\n                 if (ExtractDestination(FindNonChangeParentOutput(*it->second.tx, output.n).scriptPubKey, address)) {\n                     result[address].emplace_back("
      }
    ]
  },
  {
    "sha": "848f88920853724511387ca0b7ef652fa14ced71",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4NDhmODg5MjA4NTM3MjQ1MTEzODdjYTBiN2VmNjUyZmExNGNlZDcx",
    "commit": {
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2019-09-23T17:20:22Z"
      },
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2019-11-13T17:54:40Z"
      },
      "message": "[gui] send: include watch-only\n\nFor wallets with WALLET_FLAG_DISABLE_PRIVATE_KEYS.",
      "tree": {
        "sha": "32575f225ef34e3808a20d7dd1ec5fc8aef4fa66",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/32575f225ef34e3808a20d7dd1ec5fc8aef4fa66"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/848f88920853724511387ca0b7ef652fa14ced71",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAl3MQ2AACgkQV/+b28ww\nEAnldxAApbXk+dbmLf7ZiWLzE8j3nDila/KHORLP5GGhTqZtx+Lzl/hlCJ91dtfH\n8ozcuax8snpeTPdCMEWg6Z8wol0veeuI1Iccu4R3HyLZWbWEqJ3SobfyuertaMqy\n5AvQzXZRrMW4r9sNjN0fRJu5t6PL1/4kFNxX3Qoqt6zUfCMKg/RaI1AvjBWFCFxN\nQA0B2mkcIxDlNsgBZcl8VKvM7n83sIMxfRaQ3LL/2PQKhB+HdvncnmCfhEouENHR\n2mEkL0Kh84eJRrJMr5ZL7cm6j5Fm/XbOujxZTqIQSXhk9EHqf/+HVMGXCnca8lYa\nb7nf+pEHf8qwAd7KiIcloQfMUE7P3fYcz0iLlukaReEKATevT8fwCZOseWQD2bHE\nBOpDQEqODVROR0XMGYQKE+fVCag4CjhQIsBeAQdt28t883TKdJDJZaoc0zE3ahrr\nZBBc+gLYaCsYvk7WTiFB5IGd3yAQIIvWQnUlqUGbQbJpl0uVEbBeP+6661Om+X+8\ngp3IQSYUviIJxPKAAjjvf4eJ2qhCqbtvtyPvMjiLtWTsgFHcEcC4ASeCiGba29WG\n8WcpN6W3lys7CWWXcRel5tb+CNFhqp0TpEbOzPRjeyZiMV/enI8RHPLAbNu38yxF\n8VTjgO5F7TmDFnqodss2Yc2AATY9nR3Dxr82dbO1VSThzP0IiB8=\n=nq3h\n-----END PGP SIGNATURE-----",
        "payload": "tree 32575f225ef34e3808a20d7dd1ec5fc8aef4fa66\nparent 40537f090907f81ba885edb7dff1558382976912\nauthor Sjors Provoost <sjors@sprovoost.nl> 1569259222 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1573667680 +0100\n\n[gui] send: include watch-only\n\nFor wallets with WALLET_FLAG_DISABLE_PRIVATE_KEYS.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/848f88920853724511387ca0b7ef652fa14ced71",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/848f88920853724511387ca0b7ef652fa14ced71",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/848f88920853724511387ca0b7ef652fa14ced71/comments",
    "author": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "40537f090907f81ba885edb7dff1558382976912",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/40537f090907f81ba885edb7dff1558382976912",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/40537f090907f81ba885edb7dff1558382976912"
      }
    ],
    "stats": {
      "total": 5,
      "additions": 5,
      "deletions": 0
    },
    "files": [
      {
        "sha": "b1631b57c9ddcb3765e2fd37203109f4294200ea",
        "filename": "src/qt/sendcoinsdialog.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 0,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/848f88920853724511387ca0b7ef652fa14ced71/src/qt/sendcoinsdialog.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/848f88920853724511387ca0b7ef652fa14ced71/src/qt/sendcoinsdialog.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/sendcoinsdialog.cpp?ref=848f88920853724511387ca0b7ef652fa14ced71",
        "patch": "@@ -611,6 +611,9 @@ void SendCoinsDialog::useAvailableBalance(SendCoinsEntry* entry)\n         coin_control = *CoinControlDialog::coinControl();\n     }\n \n+    // Include watch-only for wallets without private key\n+    coin_control.fAllowWatchOnly = model->privateKeysDisabled();\n+\n     // Calculate available amount to send.\n     CAmount amount = model->wallet().getAvailableBalance(coin_control);\n     for (int i = 0; i < ui->entries->count(); ++i) {\n@@ -663,6 +666,8 @@ void SendCoinsDialog::updateCoinControlState(CCoinControl& ctrl)\n     // Either custom fee will be used or if not selected, the confirmation target from dropdown box\n     ctrl.m_confirm_target = getConfTargetForIndex(ui->confTargetSelector->currentIndex());\n     ctrl.m_signal_bip125_rbf = ui->optInRBF->isChecked();\n+    // Include watch-only for wallets without private key\n+    ctrl.fAllowWatchOnly = model->privateKeysDisabled();\n }\n \n void SendCoinsDialog::updateSmartFeeLabel()"
      }
    ]
  },
  {
    "sha": "39465d545d521e66bb3accfa788aa94bffaf47eb",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozOTQ2NWQ1NDVkNTIxZTY2YmIzYWNjZmE3ODhhYTk0YmZmYWY0N2Vi",
    "commit": {
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2019-09-23T18:25:10Z"
      },
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2019-11-13T17:54:40Z"
      },
      "message": "[wallet] add fillPSBT to interface",
      "tree": {
        "sha": "015361db70b9270b5007d9a43f148052664ec9b0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/015361db70b9270b5007d9a43f148052664ec9b0"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/39465d545d521e66bb3accfa788aa94bffaf47eb",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAl3MQ2AACgkQV/+b28ww\nEAk0lA//c2FmighnvH9A/lMf69pL1hlyKiBM0O0eAzRhTI5KmD5lQDVQ3F6lEmvH\nZETXYOqBNWvHsrkbRgOOaMr/7stJlsCE9Qnu898wGPJ0Ik0NB9PvmTrtpAW+8QCG\niyCedUBMcRH1A5ALulahSGqCTA7QQww9Y9o+PioMKmYe2nR5arXwyZx9hx/gZRIw\nZpHaQZpMrIZkBNjGGlEI8/r3L8TKAwFwMLlAIy98pDqYZs5aHosL09COKyPO7PNn\nIXFE97Tk85C0GfJJMZmamCR+CG4tTC919OjwVe/MwNcN9CDqmZWGxf1lFrY/fZip\nJfCQRt2QMRD1Tgi8YDJXDCJPy0IJp/jMF8gDORI9ADSuOxptlM4xvrb7IZQWfp9K\nNovK/plZfLROc69gsMiVcJw1XeQG6dVa3i92teee8uvrSAHpDacagbePmW0zNhrN\nxZ/R658BYYvoSkZcYo7AtZHZSamvG/fLLqFjzToHcfjDF/GBdQUw93bdFsbn8LzW\nNr/TJXB5MVT6VTNGkXPIIdjIOt3wNrvv8RZrhIuRPc9+1bRTULubfXO2aTgxfBTM\narlNmM70hUg3cM9+eAj5RU/lMKbYbG+yP+iCZgjONP+erEFfwZ50BCFkkh4yi5vY\nK75XQ2X7HS4JIfhgff0hZM9HjeBJowm2ZQiWR8Ua805DTe0TVk4=\n=OpeK\n-----END PGP SIGNATURE-----",
        "payload": "tree 015361db70b9270b5007d9a43f148052664ec9b0\nparent 848f88920853724511387ca0b7ef652fa14ced71\nauthor Sjors Provoost <sjors@sprovoost.nl> 1569263110 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1573667680 +0100\n\n[wallet] add fillPSBT to interface\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/39465d545d521e66bb3accfa788aa94bffaf47eb",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/39465d545d521e66bb3accfa788aa94bffaf47eb",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/39465d545d521e66bb3accfa788aa94bffaf47eb/comments",
    "author": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "848f88920853724511387ca0b7ef652fa14ced71",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/848f88920853724511387ca0b7ef652fa14ced71",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/848f88920853724511387ca0b7ef652fa14ced71"
      }
    ],
    "stats": {
      "total": 19,
      "additions": 18,
      "deletions": 1
    },
    "files": [
      {
        "sha": "008902e8a6516763cda40b29daab229ab73cc75c",
        "filename": "src/interfaces/wallet.cpp",
        "status": "modified",
        "additions": 10,
        "deletions": 1,
        "changes": 11,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/39465d545d521e66bb3accfa788aa94bffaf47eb/src/interfaces/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/39465d545d521e66bb3accfa788aa94bffaf47eb/src/interfaces/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/interfaces/wallet.cpp?ref=39465d545d521e66bb3accfa788aa94bffaf47eb",
        "patch": "@@ -18,8 +18,9 @@\n #include <wallet/feebumper.h>\n #include <wallet/fees.h>\n #include <wallet/ismine.h>\n-#include <wallet/rpcwallet.h>\n #include <wallet/load.h>\n+#include <wallet/psbtwallet.h>\n+#include <wallet/rpcwallet.h>\n #include <wallet/wallet.h>\n \n #include <memory>\n@@ -343,6 +344,14 @@ class WalletImpl : public Wallet\n         }\n         return {};\n     }\n+    TransactionError fillPSBT(PartiallySignedTransaction& psbtx,\n+        bool& complete,\n+        int sighash_type = 1 /* SIGHASH_ALL */,\n+        bool sign = true,\n+        bool bip32derivs = false) override\n+    {\n+        return FillPSBT(m_wallet.get(), psbtx, complete, sighash_type, sign, bip32derivs);\n+    }\n     WalletBalances getBalances() override\n     {\n         const auto bal = m_wallet->GetBalance();"
      },
      {
        "sha": "93d3970585c9431a47215267971c5e569d477b4b",
        "filename": "src/interfaces/wallet.h",
        "status": "modified",
        "additions": 8,
        "deletions": 0,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/39465d545d521e66bb3accfa788aa94bffaf47eb/src/interfaces/wallet.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/39465d545d521e66bb3accfa788aa94bffaf47eb/src/interfaces/wallet.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/interfaces/wallet.h?ref=39465d545d521e66bb3accfa788aa94bffaf47eb",
        "patch": "@@ -14,6 +14,7 @@\n #include <functional>\n #include <map>\n #include <memory>\n+#include <psbt.h>\n #include <stdint.h>\n #include <string>\n #include <tuple>\n@@ -194,6 +195,13 @@ class Wallet\n         bool& in_mempool,\n         int& num_blocks) = 0;\n \n+    //! Fill PSBT.\n+    virtual TransactionError fillPSBT(PartiallySignedTransaction& psbtx,\n+        bool& complete,\n+        int sighash_type = 1 /* SIGHASH_ALL */,\n+        bool sign = true,\n+        bool bip32derivs = false) = 0;\n+\n     //! Get balances.\n     virtual WalletBalances getBalances() = 0;\n "
      }
    ]
  },
  {
    "sha": "c6dd565c8820aa8a98b190621e10c6e2821a9ecc",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpjNmRkNTY1Yzg4MjBhYThhOThiMTkwNjIxZTEwYzZlMjgyMWE5ZWNj",
    "commit": {
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2019-09-26T09:31:49Z"
      },
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2019-11-13T19:03:42Z"
      },
      "message": "[gui] watch-only wallet: copy PSBT to clipboard",
      "tree": {
        "sha": "894f4cde23b01755a1d0300d1cdadbb31e10b8c3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/894f4cde23b01755a1d0300d1cdadbb31e10b8c3"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c6dd565c8820aa8a98b190621e10c6e2821a9ecc",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAl3MU5AACgkQV/+b28ww\nEAlAfhAAuYPhQvf98ebnIa8D9aj5pwEL8MfOzuZlcF91jpMTcF3ebisJB+6GPrkz\nNnc/gOHG08y7Ln9AQIEWFDrWKr50jJQnRzDMhXdcdPbJg+J5VEWgTVkUJMXhEo6I\nUrDGbTUgiSf2kvKce4r22MwqKSygmRId1LT23hGrnlI/EMi8dthIYgSFE2aeJHxU\n53RsfLGVWAYGVDMCXc3yPEBxu3sQgOeMaxTuAIzskxpicnlUdMUbGqN3plgid1ja\nDZN1BR6a2BpKEfz4eIPDdSY8sAfGTWe6Fes8d5w7zFBGhA7ZNNQfPIn7uth9YMEw\nqu6jZTBVYAAHfXIPbY7XtSqLHorwVGLMf59dHWtgyhTPKx0yX35Kh5/1Gqi5LMmz\nsPPxt4cN3rwWHO0QbxtniSA239yUQ33k754VKSFsZVdWHnj73XbVdZESTS9wmKtC\njV90XiCvSCxNpydI7XrccJO9sjaWUBYSNKcVkoCeBiP5kzRPpffCOdcwtddSdaz8\nZ/PHW5wjJ/q54C7KeEf4Nv2tzop91AfAJiqLmzl0GefuD9DITvYIAAfVKm7VEu2D\nfufpqNjYw/FlrEldN9TurODa9VswITmnQzSZdikYHXA0gf/MLlA66mz1S0bbpB56\nzZpyN2Zs1OACAtCnFjIykF2b1qA1o+B3P+/SOOR34kCz65+vSgQ=\n=Nw02\n-----END PGP SIGNATURE-----",
        "payload": "tree 894f4cde23b01755a1d0300d1cdadbb31e10b8c3\nparent 39465d545d521e66bb3accfa788aa94bffaf47eb\nauthor Sjors Provoost <sjors@sprovoost.nl> 1569490309 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1573671822 +0100\n\n[gui] watch-only wallet: copy PSBT to clipboard\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c6dd565c8820aa8a98b190621e10c6e2821a9ecc",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/c6dd565c8820aa8a98b190621e10c6e2821a9ecc",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c6dd565c8820aa8a98b190621e10c6e2821a9ecc/comments",
    "author": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "39465d545d521e66bb3accfa788aa94bffaf47eb",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/39465d545d521e66bb3accfa788aa94bffaf47eb",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/39465d545d521e66bb3accfa788aa94bffaf47eb"
      }
    ],
    "stats": {
      "total": 76,
      "additions": 56,
      "deletions": 20
    },
    "files": [
      {
        "sha": "c3d00fa38e7b202b0492ebbfe87133ff1538f1b9",
        "filename": "src/qt/sendcoinsdialog.cpp",
        "status": "modified",
        "additions": 53,
        "deletions": 18,
        "changes": 71,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c6dd565c8820aa8a98b190621e10c6e2821a9ecc/src/qt/sendcoinsdialog.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c6dd565c8820aa8a98b190621e10c6e2821a9ecc/src/qt/sendcoinsdialog.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/sendcoinsdialog.cpp?ref=c6dd565c8820aa8a98b190621e10c6e2821a9ecc",
        "patch": "@@ -21,11 +21,12 @@\n #include <chainparams.h>\n #include <interfaces/node.h>\n #include <key_io.h>\n-#include <wallet/coincontrol.h>\n-#include <ui_interface.h>\n-#include <txmempool.h>\n #include <policy/fees.h>\n+#include <txmempool.h>\n+#include <ui_interface.h>\n+#include <wallet/coincontrol.h>\n #include <wallet/fees.h>\n+#include <wallet/psbtwallet.h>\n \n #include <QFontMetrics>\n #include <QScrollBar>\n@@ -186,6 +187,11 @@ void SendCoinsDialog::setModel(WalletModel *_model)\n         // set default rbf checkbox state\n         ui->optInRBF->setCheckState(Qt::Checked);\n \n+        if (model->privateKeysDisabled()) {\n+            ui->sendButton->setText(tr(\"Cr&eate Unsigned\"));\n+            ui->sendButton->setToolTip(tr(\"Creates a Partially Signed Bitcoin Transaction (PSBT) for use with e.g. an offline %1 wallet, or a PSBT-compatible hardware wallet.\").arg(PACKAGE_NAME));\n+        }\n+\n         // set the smartfee-sliders default value (wallets default conf.target or last stored value)\n         QSettings settings;\n         if (settings.value(\"nSmartFeeSliderPosition\").toInt() != 0) {\n@@ -305,9 +311,19 @@ void SendCoinsDialog::on_sendButton_clicked()\n         formatted.append(recipientElement);\n     }\n \n-    QString questionString = tr(\"Are you sure you want to send?\");\n+    QString questionString;\n+    if (model->privateKeysDisabled()) {\n+        questionString.append(tr(\"Do you want to draft this transaction?\"));\n+    } else {\n+        questionString.append(tr(\"Are you sure you want to send?\"));\n+    }\n+\n     questionString.append(\"<br /><span style='font-size:10pt;'>\");\n-    questionString.append(tr(\"Please, review your transaction.\"));\n+    if (model->privateKeysDisabled()) {\n+        questionString.append(tr(\"Please, review your transaction proposal. This will produce a Partially Signed Bitcoin Transaction (PSBT) which you can copy and then sign with e.g. an offline %1 wallet, or a PSBT-compatible hardware wallet.\").arg(PACKAGE_NAME));\n+    } else {\n+        questionString.append(tr(\"Please, review your transaction.\"));\n+    }\n     questionString.append(\"</span>%1\");\n \n     if(txFee > 0)\n@@ -358,8 +374,9 @@ void SendCoinsDialog::on_sendButton_clicked()\n     } else {\n         questionString = questionString.arg(\"<br /><br />\" + formatted.at(0));\n     }\n-\n-    SendConfirmationDialog confirmationDialog(tr(\"Confirm send coins\"), questionString, informative_text, detailed_text, SEND_CONFIRM_DELAY, this);\n+    const QString confirmation = model->privateKeysDisabled() ? tr(\"Confirm transaction proposal\") : tr(\"Confirm send coins\");\n+    const QString confirmButtonText = model->privateKeysDisabled() ? tr(\"Copy PSBT to clipboard\") : tr(\"Send\");\n+    SendConfirmationDialog confirmationDialog(confirmation, questionString, informative_text, detailed_text, SEND_CONFIRM_DELAY, confirmButtonText, this);\n     confirmationDialog.exec();\n     QMessageBox::StandardButton retval = static_cast<QMessageBox::StandardButton>(confirmationDialog.result());\n \n@@ -369,17 +386,35 @@ void SendCoinsDialog::on_sendButton_clicked()\n         return;\n     }\n \n-    // now send the prepared transaction\n-    WalletModel::SendCoinsReturn sendStatus = model->sendCoins(currentTransaction);\n-    // process sendStatus and on error generate message shown to user\n-    processSendCoinsReturn(sendStatus);\n+    bool send_failure = false;\n+    if (model->privateKeysDisabled()) {\n+        CMutableTransaction mtx = CMutableTransaction{*(currentTransaction.getWtx())};\n+        PartiallySignedTransaction psbtx(mtx);\n+        bool complete = false;\n+        const TransactionError err = model->wallet().fillPSBT(psbtx, complete, SIGHASH_ALL, false /* sign */, true /* bip32derivs */);\n+        assert(!complete);\n+        assert(err == TransactionError::OK);\n+        // Serialize the PSBT\n+        CDataStream ssTx(SER_NETWORK, PROTOCOL_VERSION);\n+        ssTx << psbtx;\n+        GUIUtil::setClipboard(EncodeBase64(ssTx.str()).c_str());\n+        Q_EMIT message(tr(\"PSBT copied\"), \"Copied to clipboard\", CClientUIInterface::MSG_INFORMATION);\n+    } else {\n+        // now send the prepared transaction\n+        WalletModel::SendCoinsReturn sendStatus = model->sendCoins(currentTransaction);\n+        // process sendStatus and on error generate message shown to user\n+        processSendCoinsReturn(sendStatus);\n \n-    if (sendStatus.status == WalletModel::OK)\n-    {\n+        if (sendStatus.status == WalletModel::OK) {\n+            Q_EMIT coinsSent(currentTransaction.getWtx()->GetHash());\n+        } else {\n+            send_failure = true;\n+        }\n+    }\n+    if (!send_failure) {\n         accept();\n         CoinControlDialog::coinControl()->UnSelectAll();\n         coinControlUpdateLabels();\n-        Q_EMIT coinsSent(currentTransaction.getWtx()->GetHash());\n     }\n     fNewRecipientAllowed = true;\n }\n@@ -875,8 +910,8 @@ void SendCoinsDialog::coinControlUpdateLabels()\n     }\n }\n \n-SendConfirmationDialog::SendConfirmationDialog(const QString& title, const QString& text, const QString& informative_text, const QString& detailed_text, int _secDelay, QWidget* parent)\n-    : QMessageBox(parent), secDelay(_secDelay)\n+SendConfirmationDialog::SendConfirmationDialog(const QString& title, const QString& text, const QString& informative_text, const QString& detailed_text, int _secDelay, const QString& _confirmButtonText, QWidget* parent)\n+    : QMessageBox(parent), secDelay(_secDelay), confirmButtonText(_confirmButtonText)\n {\n     setIcon(QMessageBox::Question);\n     setWindowTitle(title); // On macOS, the window title is ignored (as required by the macOS Guidelines).\n@@ -913,11 +948,11 @@ void SendConfirmationDialog::updateYesButton()\n     if(secDelay > 0)\n     {\n         yesButton->setEnabled(false);\n-        yesButton->setText(tr(\"Send\") + \" (\" + QString::number(secDelay) + \")\");\n+        yesButton->setText(confirmButtonText + \" (\" + QString::number(secDelay) + \")\");\n     }\n     else\n     {\n         yesButton->setEnabled(true);\n-        yesButton->setText(tr(\"Send\"));\n+        yesButton->setText(confirmButtonText);\n     }\n }"
      },
      {
        "sha": "ccd84946136909c4e702ecf692911afccbdf845f",
        "filename": "src/qt/sendcoinsdialog.h",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c6dd565c8820aa8a98b190621e10c6e2821a9ecc/src/qt/sendcoinsdialog.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c6dd565c8820aa8a98b190621e10c6e2821a9ecc/src/qt/sendcoinsdialog.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/sendcoinsdialog.h?ref=c6dd565c8820aa8a98b190621e10c6e2821a9ecc",
        "patch": "@@ -108,7 +108,7 @@ class SendConfirmationDialog : public QMessageBox\n     Q_OBJECT\n \n public:\n-    SendConfirmationDialog(const QString& title, const QString& text, const QString& informative_text = \"\", const QString& detailed_text = \"\", int secDelay = SEND_CONFIRM_DELAY, QWidget* parent = nullptr);\n+    SendConfirmationDialog(const QString& title, const QString& text, const QString& informative_text = \"\", const QString& detailed_text = \"\", int secDelay = SEND_CONFIRM_DELAY, const QString& confirmText = \"Send\", QWidget* parent = nullptr);\n     int exec();\n \n private Q_SLOTS:\n@@ -119,6 +119,7 @@ private Q_SLOTS:\n     QAbstractButton *yesButton;\n     QTimer countDownTimer;\n     int secDelay;\n+    QString confirmButtonText;\n };\n \n #endif // BITCOIN_QT_SENDCOINSDIALOG_H"
      },
      {
        "sha": "fb92e29f21d8a68522040a5f07200a501852cb5d",
        "filename": "src/qt/walletmodel.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c6dd565c8820aa8a98b190621e10c6e2821a9ecc/src/qt/walletmodel.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c6dd565c8820aa8a98b190621e10c6e2821a9ecc/src/qt/walletmodel.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/walletmodel.cpp?ref=c6dd565c8820aa8a98b190621e10c6e2821a9ecc",
        "patch": "@@ -183,7 +183,7 @@ WalletModel::SendCoinsReturn WalletModel::prepareTransaction(WalletModelTransact\n         std::string strFailReason;\n \n         auto& newTx = transaction.getWtx();\n-        newTx = m_wallet->createTransaction(vecSend, coinControl, true /* sign */, nChangePosRet, nFeeRequired, strFailReason);\n+        newTx = m_wallet->createTransaction(vecSend, coinControl, !privateKeysDisabled() /* sign */, nChangePosRet, nFeeRequired, strFailReason);\n         transaction.setTransactionFee(nFeeRequired);\n         if (fSubtractFeeFromAmount && newTx)\n             transaction.reassignAmounts(nChangePosRet);"
      }
    ]
  }
]