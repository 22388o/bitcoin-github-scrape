DrahtBot,2021-03-06 08:00:01,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20641 (depends: Use Qt top-level build facilities by hebasto)\n\nIf you consider this pull request important, please also",https://github.com/bitcoin/bitcoin/pull/21376#issuecomment-791892125,791892125,
hebasto,2021-03-06 12:43:18,"The build fail on CentOS\n```\n/tmp/cirrus-ci-build/depends/i686-pc-linux-gnu/lib/libQt5XcbQpa.a(qxcbbackingstore.o): In function `QXcbBackingStoreImage::createShmSegment(unsigned int)':\nqxcbbackingstore.cpp:(.text._ZN21QXcbBackingStoreImage16createShmSegmentEj+0x4e): undefined reference to `xcb_shm_create_segment'\nqxcbbackingstore.cpp:(.text._ZN21QXcbBackingStoreImage16createShmSegmentEj+0x",https://github.com/bitcoin/bitcoin/pull/21376#issuecomment-791931330,791931330,
DrahtBot,2021-03-07 16:20:37,<!--9cd9c72976c961c55c7acef8f6ba82cd-->\n### Guix builds\n\n| File | commit 48725e64fbfb85200dd2226386fbf1cfc8fe6c1f<br>(master) | commit 3be11666df002c4a3c01f6506bcbf0bec00b1092<br>(master and this pull) |\n|--|--|--|\n| *-aarch64-linux-gnu-debug.tar.gz | [`c0874d1b330fbefe...`](https://drahtbot.space/guix/bitcoin/bitcoin/48725e64fbfb85200dd2226386fbf1cfc8fe6c1f/bitcoin-48725e64fbfb-aarch64-linux,https://github.com/bitcoin/bitcoin/pull/21376#issuecomment-792304433,792304433,
MarcoFalke,2021-03-07 17:51:06,"Copied excerpt from the guix build log:\n\n```\ntouch /bitcoin/depends/work/build/x86_64-linux-gnu/libxkbcommon/0.8.4-b8529cd0f07/./.stamp_configured\necho Building libxkbcommon...\nBuilding libxkbcommon...\nmkdir -p /bitcoin/depends/work/build/x86_64-linux-gnu/libxkbcommon/0.8.4-b8529cd0f07/.\ncd /bitcoin/depends/work/build/x86_64-linux-gnu/libxkbcommon/0.8.4-b8529cd0f07/.; PATH=/bitcoin/d",https://github.com/bitcoin/bitcoin/pull/21376#issuecomment-792323022,792323022,
hebasto,2021-03-07 17:59:17,"> ```\n> touch /bitcoin/depends/work/build/x86_64-linux-gnu/libxkbcommon/0.8.4-b8529cd0f07/./.stamp_configured\n> echo Building libxkbcommon...\n> Building libxkbcommon...\n> mkdir -p /bitcoin/depends/work/build/x86_64-linux-gnu/libxkbcommon/0.8.4-b8529cd0f07/.\n> cd /bitcoin/depends/work/build/x86_64-linux-gnu/libxkbcommon/0.8.4-b8529cd0f07/.; PATH=/bitcoin/depends/x86_64-linux-gnu/native/bi",https://github.com/bitcoin/bitcoin/pull/21376#issuecomment-792324265,792324265,
MarcoFalke,2021-03-07 18:00:59,"(clarified that my comment is an excerpt from the guix build log, which will be deleted in 14 days by @DrahtBot )",https://github.com/bitcoin/bitcoin/pull/21376#issuecomment-792324625,792324625,
hebasto,2021-03-07 18:40:16,"> Copied excerpt from the guix build log:\n> \n> ```\n> touch /bitcoin/depends/work/build/x86_64-linux-gnu/libxkbcommon/0.8.4-b8529cd0f07/./.stamp_configured\n> echo Building libxkbcommon...\n> Building libxkbcommon...\n> mkdir -p /bitcoin/depends/work/build/x86_64-linux-gnu/libxkbcommon/0.8.4-b8529cd0f07/.\n> cd /bitcoin/depends/work/build/x86_64-linux-gnu/libxkbcommon/0.8.4-b8529cd0f07/.;",https://github.com/bitcoin/bitcoin/pull/21376#issuecomment-792330908,792330908,
fanquake,2021-03-07 23:28:27,"> Copied excerpt from the guix build log:\n> Adding bison package:\n\nThat isn't enough to fix the Guix failure. I said the package needed adding in the op, where I mentioned this failure still needed fixing\n\n> Linux Guix build needs bison and fixing up this failure:\n\n",https://github.com/bitcoin/bitcoin/pull/21376#issuecomment-792374268,792374268,
hebasto,2021-03-07 23:32:59,"> That isn't enough to fix the Guix failure. I said the package needed adding in the op, where I mentioned this failure still needed fixing\n\nWhy? Guix build works for me :)",https://github.com/bitcoin/bitcoin/pull/21376#issuecomment-792375012,792375012,
hebasto,2021-03-07 23:52:10,"FWIW, I've got successful guix builds for a [branch](https://github.com/hebasto/bitcoin/commits/pr21376-demo) with applied suggestions:\n```\n$ find output -type f -name *$(git rev-parse --short HEAD)*.* -print0 | env LC_ALL=C sort -z | xargs -r0 sha256sum\nbe0a3034a4fb50875d8fd15b37f2bf60d862fd3dc5e90e3d1be09546718084ed  output/bitcoin-603dbff13496-aarch64-linux-gnu-debug.tar.gz\n7f69079103b0",https://github.com/bitcoin/bitcoin/pull/21376#issuecomment-792378106,792378106,
fanquake,2021-03-08 00:24:57,"> FWIW, I've got successful guix builds for a branch with applied suggestions:\n\nI'm still seeing the same failure I was seeing before opening this PR, with the guix bison changes applied:\n```bash\nBuilding libxkbcommon...\nmake[1]: Entering directory '/bitcoin/depends/work/build/arm-linux-gnueabihf/libxkbcommon/0.8.4-47d086c3594'\n  YACC     src/xkbcomp/parser.c\n/bitcoin/depends/work/bu",https://github.com/bitcoin/bitcoin/pull/21376#issuecomment-792385213,792385213,
hebasto,2021-03-08 01:16:14,"> I'm still seeing the same failure I was seeing before opening this PR, with the guix bison changes applied:\n\nMade guix build again (for the same [branch](https://github.com/hebasto/bitcoin/commits/pr21376-demo)):\n```\nBuilding libxkbcommon...\nmake[1]: Entering directory '/bitcoin/depends/work/build/arm-linux-gnueabihf/libxkbcommon/0.8.4-967647c9b27'\n  YACC     src/xkbcomp/parser.c\n/",https://github.com/bitcoin/bitcoin/pull/21376#issuecomment-792398597,792398597,
hebasto,2021-03-09 14:59:44,"@fanquake \nwrt https://github.com/bitcoin/bitcoin/pull/21376#discussion_r588867355 (marked as resolved):\n\n```\n$ make -j 9 -C depends libxkbcommon_staged\n$ cd $PATH_TO_STAGED_DIR\n$ find .\n.\n./include\n./include/xkbcommon\n./include/xkbcommon/xkbcommon-compose.h\n./include/xkbcommon/xkbcommon-compat.h\n./include/xkbcommon/xkbcommon-keysyms.h\n./include/xkbcommon/xkbcommon-names.",https://github.com/bitcoin/bitcoin/pull/21376#issuecomment-794010534,794010534,
hebasto,2021-03-09 16:47:12,"**Gitian** buids:\n- Linux\n```\nGenerating report\n22ff2f7f61a83d66fcf5e9d908985ed0f393f42dd2270dfb95c9772778e20a91  bitcoin-54f231284515-aarch64-linux-gnu-debug.tar.gz\n9e100810f323d88a69622d0925922d608b08ca6789f4527adb4ce8c5c465b0cd  bitcoin-54f231284515-aarch64-linux-gnu.tar.gz\neaeb80e76b2fcab3095fe19e1be8e84e6aa7c8d9cf0efed44f40c20e6e37cc4f  bitcoin-54f231284515-arm-linux-gnueabihf-deb",https://github.com/bitcoin/bitcoin/pull/21376#issuecomment-794147392,794147392,
hebasto,2021-03-09 17:29:23,"The Qt configure summary diff (master vs 54f23128451525bbd704d669ac6d6473bf7dceb3) for `HOST=x86_64-pc-linux-gnu`:\n```diff\n@@ -2,11 +2,13 @@\n \n Building on: linux-g++ (x86_64, CPU features: mmx sse sse2)\n Building for: linux-g++-64 (x86_64, CPU features: mmx sse sse2)\n-Configuration: cross_compile sse2 sse3 ssse3 sse4_1 sse4_2 avx avx2 avx512f avx512bw avx512cd avx512dq avx512er avx512",https://github.com/bitcoin/bitcoin/pull/21376#issuecomment-794201799,794201799,
fanquake,2021-03-10 01:34:45,I think I've addressed most of the comments. Also added `-no-feature-sqlmodel` given the configure summary above. I had that in #19716 but forgot to include it here.,https://github.com/bitcoin/bitcoin/pull/21376#issuecomment-794711545,794711545,
hebasto,2021-03-10 10:12:08,"Gitian builds:\n- Linux:\n```\nGenerating report\n978601b2c0bd9f1dce40ec3a6de72f5e029aa0f8fbf2b28793e585d72345a123  bitcoin-550ed1bed2e8-aarch64-linux-gnu-debug.tar.gz\nad2732abe02eb89e64612ac47ff29e8c1fca23b36a09c9623695728c589d9f44  bitcoin-550ed1bed2e8-aarch64-linux-gnu.tar.gz\nd229b072f2249f2b1ac024406c605d70ddd61fc4726a791d65cda236f55f855c  bitcoin-550ed1bed2e8-arm-linux-gnueabihf-debug",https://github.com/bitcoin/bitcoin/pull/21376#issuecomment-795194114,795194114,
hebasto,2021-03-10 11:04:41,"macOS tests (550ed1bed2e8091616a2d64254efdd217d94e808):\n- [x] cross-compiled on Linux Mint 20.1 with DEBUG=1 (debug-build)\n- [x] gitian-build is tested on Mojave 10.14.6 (18G8022):\n  - [x] macstyle\n  - [x] native file open/save dialogs\n- [x] debug-build is tested on Mojave 10.14.6 (18G8022):\n  - [x] macstyle\n  - [x] native file open/save dialogs\n- [x] gitian-build is tested on Big ",https://github.com/bitcoin/bitcoin/pull/21376#issuecomment-795254766,795254766,
hebasto,2021-03-10 12:40:28,"Linux tests (550ed1bed2e8091616a2d64254efdd217d94e808) on Linux Mint 20.1 (x86_64):\n- [x] compiled with DEBUG=1 (debug-build) and tested:\n```\n$ make -C depends\n$ ./autogen.sh\n$ CONFIG_SITE=$PWD/depends/x86_64-pc-linux-gnu/share/config.site ./configure --disable-fuzz-binary\n$ make clean > /dev/null\n$ make\n```\nTo build without `--disable-fuzz-binary` the fix is required (#21349)\n",https://github.com/bitcoin/bitcoin/pull/21376#issuecomment-795358241,795358241,
hebasto,2021-03-10 13:00:27,"Tested compiling with depends on macOS Big Sur 11.2.2 (20D80):\n```\n% make -j 9 -C depends\n% ./autogen.sh\n% CONFIG_SITE=$PWD/depends/x86_64-apple-darwin20.3.0/share/config.site ./configure\n% make clean > /dev/null\n% make\n% src/qt/bitcoin-qt -printtoconsole\n2021-03-10T12:58:28Z Bitcoin Core version v21.99.0-550ed1bed2e8 (release build)\n2021-03-10T12:58:28Z Qt 5.12.10 (static), plug",https://github.com/bitcoin/bitcoin/pull/21376#issuecomment-795379418,795379418,
hebasto,2021-03-10 13:08:24,"Guix builds:\n```\n$ find output -type f -name *$(git rev-parse --short HEAD)*.* -print0 | env LC_ALL=C sort -z | xargs -r0 sha256sum\nd48123ece74a551b02b5b3ca21b1d33995c2dd284e38e268c573398c1c73dad9  output/bitcoin-550ed1bed2e8-aarch64-linux-gnu-debug.tar.gz\nae628864d7d6a0ff954c1e9ad4362d0df382711befdca521c912d6ebf6fc143b  output/bitcoin-550ed1bed2e8-aarch64-linux-gnu.tar.gz\n5d7c1e55fedc76",https://github.com/bitcoin/bitcoin/pull/21376#issuecomment-795388231,795388231,
fanquake,2021-03-10 14:46:02,"Builds @ 550ed1bed2e8091616a2d64254efdd217d94e808\nLinux:\n```bash\n978601b2c0bd9f1dce40ec3a6de72f5e029aa0f8fbf2b28793e585d72345a123  bitcoin-550ed1bed2e8-aarch64-linux-gnu-debug.tar.gz\nad2732abe02eb89e64612ac47ff29e8c1fca23b36a09c9623695728c589d9f44  bitcoin-550ed1bed2e8-aarch64-linux-gnu.tar.gz\nd229b072f2249f2b1ac024406c605d70ddd61fc4726a791d65cda236f55f855c  bitcoin-550ed1bed2e8-arm-linu",https://github.com/bitcoin/bitcoin/pull/21376#issuecomment-795529236,795529236,
laanwj,2021-03-10 14:49:04,"Code review ACK 550ed1bed2e8091616a2d64254efdd217d94e808\n\nMy GUIX build matches @fanquake's and @hebasto 's exactly.",https://github.com/bitcoin/bitcoin/pull/21376#issuecomment-795535763,795535763,
hebasto,2021-03-10 15:17:44,"Windows tests (550ed1bed2e8091616a2d64254efdd217d94e808):\n- [x] cross-compiled on Linux Mint 20.1 with DEBUG=1 (debug-build)\n```\n$ make -C depends HOST=x86_64-w64-mingw32 DEBUG=1\n$ ./autogen.sh\n$ CONFIG_SITE=$PWD/depends/x86_64-w64-mingw32/share/config.site ./configure --without-libs --disable-fuzz-binary\n$ make clean > /dev/null\n$ make\n```\n\nTo build without `--without-libs` th",https://github.com/bitcoin/bitcoin/pull/21376#issuecomment-795589614,795589614,
DrahtBot,2021-03-13 07:38:45,<!--9cd9c72976c961c55c7acef8f6ba82cd-->\n### Guix builds\n\n| File | commit 63314b8211d795b2bf0814e244d801e74f50b152<br>(master) | commit ce09ca18b6d31369d79b81cb0ae8527e30262284<br>(master and this pull) |\n|--|--|--|\n| *-aarch64-linux-gnu-debug.tar.gz | [`60c5d4ae1427a954...`](https://drahtbot.space/guix/bitcoin/bitcoin/63314b8211d795b2bf0814e244d801e74f50b152/bitcoin-63314b8211d7-aarch64-linux,https://github.com/bitcoin/bitcoin/pull/21376#issuecomment-797884167,797884167,
hebasto,2021-03-06 09:59:38,Add `bison` to https://github.com/bitcoin/bitcoin/blob/master/depends/README.md#for-linux-including-i386-arm-cross-compilation?,https://github.com/bitcoin/bitcoin/pull/21376#discussion_r588862003,588862003,contrib/gitian-descriptors/gitian-linux.yml
hebasto,2021-03-06 10:55:56,"6a70950799e54ce5b85f7d58aca6d19adae961c8\n\nCould be simplified:\n```suggestion\n  rm -f lib/*.la\n```",https://github.com/bitcoin/bitcoin/pull/21376#discussion_r588867355,588867355,depends/packages/libxkbcommon.mk
hebasto,2021-03-06 13:42:32,"typo:\n```suggestion\n'CoreVideo', # digital video processing\n```",https://github.com/bitcoin/bitcoin/pull/21376#discussion_r588883828,588883828,contrib/devtools/symbol-check.py
fanquake,2021-03-09 08:20:29,I think this can actually be dropped.,https://github.com/bitcoin/bitcoin/pull/21376#discussion_r590061261,590061261,depends/packages/qt.mk
hebasto,2021-03-09 13:38:33,"dedc7021d487e4b991ac851a9d7c5985b8ab9963\n```suggestion\n      _BITCOIN_QT_CHECK_STATIC_PLUGIN([QMacStylePlugin], [-lqmacstyle])\n```",https://github.com/bitcoin/bitcoin/pull/21376#discussion_r590375483,590375483,build-aux/m4/bitcoin_qt.m4
hebasto,2021-03-09 16:17:34,"Could this diff be moved from the _""build: qt 5.12.10""_ commit to the previous _""build: Add xkbcommon 0.8.4""_ one?",https://github.com/bitcoin/bitcoin/pull/21376#discussion_r590514264,590514264,contrib/devtools/symbol-check.py
hebasto,2021-03-09 16:40:19,"style nit:\n```suggestion\n      AX_CHECK_LINK_FLAG([-lwtsapi32], [QT_LIBS=""$QT_LIBS -lwtsapi32""], [AC_MSG_ERROR([could not link against -lwtsapi32])])\n```",https://github.com/bitcoin/bitcoin/pull/21376#discussion_r590534294,590534294,build-aux/m4/bitcoin_qt.m4
hebasto,2021-03-09 16:44:27,"Could it be safer and more robust:\n```suggestion\n      AX_CHECK_LINK_FLAG([-lxcb-shm], [QT_LIBS=""-lxcb-shm $QT_LIBS""], [AC_MSG_ERROR([could not link against -lxcb-shm])])\n```\n?",https://github.com/bitcoin/bitcoin/pull/21376#discussion_r590537638,590537638,build-aux/m4/bitcoin_qt.m4
hebasto,2021-03-09 17:59:50,"I'm ok with this line as it is.\n\nAs Qt 5.12 [supports](https://doc.qt.io/qt-5.12/macos.html#supported-versions) macOS target platforms 10.12, 10.13 and 10.14, and our minimum support macOS is 10.14, it seems reasonable to set [`QMAKE_MACOSX_DEPLOYMENT_TARGET`](https://doc.qt.io/qt-5.12/macos.html#target-platforms) 10.14 rather 10.12.",https://github.com/bitcoin/bitcoin/pull/21376#discussion_r590596950,590596950,depends/packages/qt.mk
hebasto,2021-03-09 18:11:12,"On macOS Sierra 10.12.6 (16G2136) I got nice warnings:\n\n![Screenshot from 2021-03-09 20-07-40](https://user-images.githubusercontent.com/32963518/110517446-89ba9400-8113-11eb-99c6-d9dcf7bc9b1e.png)\n\n![Screenshot from 2021-03-09 20-08-47](https://user-images.githubusercontent.com/32963518/110517452-8cb58480-8113-11eb-9b49-af1487d41056.png)\n",https://github.com/bitcoin/bitcoin/pull/21376#discussion_r590604605,590604605,depends/packages/qt.mk
hebasto,2021-03-09 20:25:04,"To handle `DEBUG=1` this line should be:\n```suggestion\n    PKG_CHECK_MODULES([QT_WINDOWSUIAUTOMATION], [Qt5WindowsUIAutomationSupport${qt_lib_suffix}], [QT_LIBS=""$QT_WINDOWSUIAUTOMATION_LIBS $QT_LIBS""])\n```\n\nInstead of `$QT_WINDOWSUIAUTOMATION_LIBS` could be just `-lQt5WindowsUIAutomationSupport${qt_lib_suffix}`, but I prefer the former variant as I think it is more robust and maintainab",https://github.com/bitcoin/bitcoin/pull/21376#discussion_r590693514,590693514,build-aux/m4/bitcoin_qt.m4
hebasto,2021-03-09 20:42:34,"Could macOS framework checks be placed in one place?\n\nOther place is https://github.com/bitcoin/bitcoin/blob/ee0dc02c6f93de2a366bbff490eb4d37bca6a24f/build-aux/m4/bitcoin_qt.m4#L220-L221",https://github.com/bitcoin/bitcoin/pull/21376#discussion_r590704565,590704565,build-aux/m4/bitcoin_qt.m4
hebasto,2021-03-09 22:03:01,See #21400,https://github.com/bitcoin/bitcoin/pull/21376#discussion_r590753647,590753647,build-aux/m4/bitcoin_qt.m4
fanquake,2021-03-10 00:41:38,"Left this as the later for now, we can refactor all the checks later on/as a part of supporting qt6.",https://github.com/bitcoin/bitcoin/pull/21376#discussion_r590870820,590870820,build-aux/m4/bitcoin_qt.m4
fanquake,2021-03-10 01:25:07,"No, that wont configure.",https://github.com/bitcoin/bitcoin/pull/21376#discussion_r590899621,590899621,build-aux/m4/bitcoin_qt.m4
hebasto,2021-03-10 07:55:34,Agree.,https://github.com/bitcoin/bitcoin/pull/21376#discussion_r591174482,591174482,build-aux/m4/bitcoin_qt.m4
hebasto,2021-03-10 15:20:52,"nit (leave for a follow up): ""style"" directory is not present on all platforms\n```suggestion\n      QT_LIBS=""$QT_LIBS -L$qt_plugin_path/platforms""\n      if test -d ""$qt_plugin_path/styles""; then\n        QT_LIBS=""$QT_LIBS -L$qt_plugin_path/styles""\n      fi\n```",https://github.com/bitcoin/bitcoin/pull/21376#discussion_r591613489,591613489,build-aux/m4/bitcoin_qt.m4
fanquake,2021-03-10 23:33:00,"Ok. We can combine this as well as [this](https://github.com/bitcoin/bitcoin/pull/21376#discussion_r590693514), and other cleanups into a followup.",https://github.com/bitcoin/bitcoin/pull/21376#discussion_r591954834,591954834,build-aux/m4/bitcoin_qt.m4
hebasto,2021-03-11 09:59:52,"A note to myself.\n[`plugins/platforms/cocoa/cocoa.pro#n92`](https://code.qt.io/cgit/qt/qtbase.git/tree/src/plugins/platforms/cocoa/cocoa.pro?h=5.12.10#n92l):\n```\nLIBS += -framework AppKit -framework CoreServices -framework Carbon -framework IOKit -framework QuartzCore -framework CoreVideo -framework Metal -framework IOSurface -lcups\n```",https://github.com/bitcoin/bitcoin/pull/21376#discussion_r592220823,592220823,build-aux/m4/bitcoin_qt.m4
hebasto,2021-04-03 23:25:40,It appears that this line always forces cross-compiling. See #21588.,https://github.com/bitcoin/bitcoin/pull/21376#discussion_r606722368,606722368,depends/packages/qt.mk
hebasto,2021-05-21 14:56:29,"@fanquake \nWas it done intentionally? If so, what reasons for?\n\nAsking in regards to https://github.com/bitcoin-core/gui/pull/337/files#r636353521.",https://github.com/bitcoin/bitcoin/pull/21376#discussion_r636986899,636986899,depends/packages/qt.mk
fanquake,2021-05-22 11:13:23,From what I remember qt wouldn't compiler with this disabled.,https://github.com/bitcoin/bitcoin/pull/21376#discussion_r637390428,637390428,depends/packages/qt.mk
hebasto,2021-05-22 22:04:39,Thanks. Can confirm it.,https://github.com/bitcoin/bitcoin/pull/21376#discussion_r637455618,637455618,depends/packages/qt.mk
