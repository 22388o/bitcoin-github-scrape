[
  {
    "sha": "2e526aef3a9c176bef5b6786c1531a3de1ef0c86",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyZTUyNmFlZjNhOWMxNzZiZWY1YjY3ODZjMTUzMWEzZGUxZWYwYzg2",
    "commit": {
      "author": {
        "name": "Ben Woosley",
        "email": "ben.woosley@gmail.com",
        "date": "2018-12-07T10:26:10Z"
      },
      "committer": {
        "name": "Ben Woosley",
        "email": "ben.woosley@gmail.com",
        "date": "2019-01-17T08:52:54Z"
      },
      "message": "test: Extract BuildCrediting/SpendingTransaction to shared factories folder\n\nThis is a first step toward a library of common factory functions for test and\nbench purposes.",
      "tree": {
        "sha": "3af203a258e2bfb4d79a1507dfb5cf1f3ef45976",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3af203a258e2bfb4d79a1507dfb5cf1f3ef45976"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2e526aef3a9c176bef5b6786c1531a3de1ef0c86",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE+XLHXoy4Dim7e8hvTYykuhgECQYFAlxAQmcACgkQTYykuhgE\nCQb1aw/+JGIqaM1rlb3YYeFNCL3YEXQmay+vVCy4dzmyklivBgP/7qoEfr1qTrFx\nZPZC+ZOZMJWab2DWZLidwX+NkWfwmA6oqFkpW7oXRrVe/4Wku4H/kl4TgzHpkh2X\nERnsuBFGGnLYwMR3IatAVgv7UzKSZBQQ7gi6ACNHCFtNLGXdWO/oGLY+eOUZ5q2J\nFJnXN352IMfskUMKrP7gWL9UHNGtq6zzOZfcNpyUMOHD+aMkcMxk5RPohzbzBJiR\ndV0dQJCK8q7DEsq5DXzlBXCTO3QkhpHgfR7kBMT1ZAdWzwg7l6bdBmXpLswEcDon\n94y1jOwKMtsfq8mmH52/gCmG6OlYO3jo/RzDZKLV7Z1urhP3VEcPMHg50qI6y4Bt\n7d4dvst88tj9hbILIB9z0u5JsCZr9QOUhP1eJvLzlcZ6XvCpRGXbXYv+dgVet2V9\nNdDEU+6Hs1pIeA4FJVGQu1sU+U128BTSjffx6S1OVxzLcNaty0Y3Mx7JtQVA1Bn/\nm98vKUis3XjRLXwjWcMGH18Ca6+rMOOCN+DMT3qaJ27rGCeRCaK+0itMnW2QiXx2\nRs2bsjqb9xSUaTlsIyjCkYok1IYXmlSKs/aUex0izMq5TqmY/wDZeCCPdzSQ1PkG\nfGz551J3IiJLez0VDBYyezT6sZQX5wRwAVWgBphpihgpS8XOqMs=\n=J/iO\n-----END PGP SIGNATURE-----",
        "payload": "tree 3af203a258e2bfb4d79a1507dfb5cf1f3ef45976\nparent 0ed279cb4e4198e20a552c279c09134626bbb0bd\nauthor Ben Woosley <ben.woosley@gmail.com> 1544178370 -0800\ncommitter Ben Woosley <ben.woosley@gmail.com> 1547715174 -0800\n\ntest: Extract BuildCrediting/SpendingTransaction to shared factories folder\n\nThis is a first step toward a library of common factory functions for test and\nbench purposes.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2e526aef3a9c176bef5b6786c1531a3de1ef0c86",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/2e526aef3a9c176bef5b6786c1531a3de1ef0c86",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2e526aef3a9c176bef5b6786c1531a3de1ef0c86/comments",
    "author": {
      "login": "Empact",
      "id": 5470,
      "node_id": "MDQ6VXNlcjU0NzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5470?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Empact",
      "html_url": "https://github.com/Empact",
      "followers_url": "https://api.github.com/users/Empact/followers",
      "following_url": "https://api.github.com/users/Empact/following{/other_user}",
      "gists_url": "https://api.github.com/users/Empact/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Empact/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Empact/subscriptions",
      "organizations_url": "https://api.github.com/users/Empact/orgs",
      "repos_url": "https://api.github.com/users/Empact/repos",
      "events_url": "https://api.github.com/users/Empact/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Empact/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "Empact",
      "id": 5470,
      "node_id": "MDQ6VXNlcjU0NzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5470?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Empact",
      "html_url": "https://github.com/Empact",
      "followers_url": "https://api.github.com/users/Empact/followers",
      "following_url": "https://api.github.com/users/Empact/following{/other_user}",
      "gists_url": "https://api.github.com/users/Empact/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Empact/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Empact/subscriptions",
      "organizations_url": "https://api.github.com/users/Empact/orgs",
      "repos_url": "https://api.github.com/users/Empact/repos",
      "events_url": "https://api.github.com/users/Empact/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Empact/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "0ed279cb4e4198e20a552c279c09134626bbb0bd",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0ed279cb4e4198e20a552c279c09134626bbb0bd",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/0ed279cb4e4198e20a552c279c09134626bbb0bd"
      }
    ],
    "stats": {
      "total": 210,
      "additions": 107,
      "deletions": 103
    },
    "files": [
      {
        "sha": "1d78334f9711fb47648ac08ec56c9bb0523997d6",
        "filename": "build_msvc/testconsensus/testconsensus.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 17,
        "changes": 18,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2e526aef3a9c176bef5b6786c1531a3de1ef0c86/build_msvc/testconsensus/testconsensus.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2e526aef3a9c176bef5b6786c1531a3de1ef0c86/build_msvc/testconsensus/testconsensus.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/build_msvc/testconsensus/testconsensus.cpp?ref=2e526aef3a9c176bef5b6786c1531a3de1ef0c86",
        "patch": "@@ -7,23 +7,7 @@\n #include <..\\src\\streams.h>\n #include <..\\src\\version.h>\n \n-CMutableTransaction BuildSpendingTransaction(const CScript& scriptSig, const CScriptWitness& scriptWitness, int nValue = 0)\n-{\n-    CMutableTransaction txSpend;\n-    txSpend.nVersion = 1;\n-    txSpend.nLockTime = 0;\n-    txSpend.vin.resize(1);\n-    txSpend.vout.resize(1);\n-    txSpend.vin[0].scriptWitness = scriptWitness;\n-    txSpend.vin[0].prevout.hash = uint256();\n-    txSpend.vin[0].prevout.n = 0;\n-    txSpend.vin[0].scriptSig = scriptSig;\n-    txSpend.vin[0].nSequence = CTxIn::SEQUENCE_FINAL;\n-    txSpend.vout[0].scriptPubKey = CScript();\n-    txSpend.vout[0].nValue = nValue;\n-\n-    return txSpend;\n-}\n+#include <..\\src\\factories\\transactions.h>\n \n int main()\n {"
      },
      {
        "sha": "6a3986d7cb7a2babf66c8a5db80a14fed0fdda94",
        "filename": "src/Makefile.am",
        "status": "modified",
        "additions": 11,
        "deletions": 1,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2e526aef3a9c176bef5b6786c1531a3de1ef0c86/src/Makefile.am",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2e526aef3a9c176bef5b6786c1531a3de1ef0c86/src/Makefile.am",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/Makefile.am?ref=2e526aef3a9c176bef5b6786c1531a3de1ef0c86",
        "patch": "@@ -30,6 +30,7 @@ LIBBITCOIN_CONSENSUS=libbitcoin_consensus.a\n LIBBITCOIN_CLI=libbitcoin_cli.a\n LIBBITCOIN_UTIL=libbitcoin_util.a\n LIBBITCOIN_CRYPTO_BASE=crypto/libbitcoin_crypto_base.a\n+LIBBITCOIN_FACTORIES=factories/libbitcoin_factories.a\n LIBBITCOINQT=qt/libbitcoinqt.a\n LIBSECP256K1=secp256k1/libsecp256k1.la\n \n@@ -70,7 +71,8 @@ EXTRA_LIBRARIES += \\\n   $(LIBBITCOIN_SERVER) \\\n   $(LIBBITCOIN_CLI) \\\n   $(LIBBITCOIN_WALLET) \\\n-  $(LIBBITCOIN_ZMQ)\n+  $(LIBBITCOIN_ZMQ) \\\n+  $(LIBBITCOIN_FACTORIES)\n \n lib_LTLIBRARIES = $(LIBBITCOINCONSENSUS)\n \n@@ -445,6 +447,14 @@ libbitcoin_util_a_SOURCES += compat/glibc_compat.cpp\n AM_LDFLAGS += $(COMPAT_LDFLAGS)\n endif\n \n+factories_libbitcoin_factories_a_CPPFLAGS = $(AM_CPPFLAGS) $(BITCOIN_INCLUDES)\n+factories_libbitcoin_factories_a_CXXFLAGS = $(AM_CXXFLAGS) $(PIE_FLAGS)\n+factories_libbitcoin_factories_a_SOURCES = \\\n+  test/factories/transactions.cpp \\\n+  $(BITCOIN_CORE_H)\n+factories_libbitcoin_factories_a_LIBADD = \\\n+  $(LIBBITCOIN_CONSENSUS)\n+\n # cli: shared between bitcoin-cli and bitcoin-qt\n libbitcoin_cli_a_CPPFLAGS = $(AM_CPPFLAGS) $(BITCOIN_INCLUDES)\n libbitcoin_cli_a_CXXFLAGS = $(AM_CXXFLAGS) $(PIE_FLAGS)"
      },
      {
        "sha": "49ea4beaecb063974734db0139e41017a0005d01",
        "filename": "src/Makefile.bench.include",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2e526aef3a9c176bef5b6786c1531a3de1ef0c86/src/Makefile.bench.include",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2e526aef3a9c176bef5b6786c1531a3de1ef0c86/src/Makefile.bench.include",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/Makefile.bench.include?ref=2e526aef3a9c176bef5b6786c1531a3de1ef0c86",
        "patch": "@@ -34,7 +34,7 @@ bench_bench_bitcoin_SOURCES = \\\n \n nodist_bench_bench_bitcoin_SOURCES = $(GENERATED_BENCH_FILES)\n \n-bench_bench_bitcoin_CPPFLAGS = $(AM_CPPFLAGS) $(BITCOIN_INCLUDES) $(EVENT_CLFAGS) $(EVENT_PTHREADS_CFLAGS) -I$(builddir)/bench/\n+bench_bench_bitcoin_CPPFLAGS = $(AM_CPPFLAGS) $(BITCOIN_INCLUDES) $(EVENT_CLFAGS) $(EVENT_PTHREADS_CFLAGS) -I$(builddir)/bench/ -I$(builddir)/test/\n bench_bench_bitcoin_CXXFLAGS = $(AM_CXXFLAGS) $(PIE_FLAGS)\n bench_bench_bitcoin_LDADD = \\\n   $(LIBBITCOIN_WALLET) \\\n@@ -43,6 +43,7 @@ bench_bench_bitcoin_LDADD = \\\n   $(LIBBITCOIN_UTIL) \\\n   $(LIBBITCOIN_CONSENSUS) \\\n   $(LIBBITCOIN_CRYPTO) \\\n+  $(LIBBITCOIN_FACTORIES) \\\n   $(LIBLEVELDB) \\\n   $(LIBLEVELDB_SSE42) \\\n   $(LIBMEMENV) \\"
      },
      {
        "sha": "1e9d0aa7df5b5341fde43f065b5c13b778f14100",
        "filename": "src/Makefile.test.include",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2e526aef3a9c176bef5b6786c1531a3de1ef0c86/src/Makefile.test.include",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2e526aef3a9c176bef5b6786c1531a3de1ef0c86/src/Makefile.test.include",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/Makefile.test.include?ref=2e526aef3a9c176bef5b6786c1531a3de1ef0c86",
        "patch": "@@ -128,7 +128,7 @@ if ENABLE_WALLET\n test_test_bitcoin_LDADD += $(LIBBITCOIN_WALLET)\n endif\n \n-test_test_bitcoin_LDADD += $(LIBBITCOIN_SERVER) $(LIBBITCOIN_CLI) $(LIBBITCOIN_COMMON) $(LIBBITCOIN_UTIL) $(LIBBITCOIN_CONSENSUS) $(LIBBITCOIN_CRYPTO) $(LIBUNIVALUE) \\\n+test_test_bitcoin_LDADD += $(LIBBITCOIN_SERVER) $(LIBBITCOIN_CLI) $(LIBBITCOIN_COMMON) $(LIBBITCOIN_UTIL) $(LIBBITCOIN_CONSENSUS) $(LIBBITCOIN_FACTORIES) $(LIBBITCOIN_CRYPTO) $(LIBUNIVALUE) \\\n   $(LIBLEVELDB) $(LIBLEVELDB_SSE42) $(LIBMEMENV) $(BOOST_LIBS) $(BOOST_UNIT_TEST_FRAMEWORK_LIB) $(LIBSECP256K1) $(EVENT_LIBS) $(EVENT_PTHREADS_LIBS)\n test_test_bitcoin_CXXFLAGS = $(AM_CXXFLAGS) $(PIE_FLAGS)\n "
      },
      {
        "sha": "a0f90e8e26730f3b8d9c384bac70135d4f57d96c",
        "filename": "src/bench/verify_script.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 36,
        "changes": 38,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2e526aef3a9c176bef5b6786c1531a3de1ef0c86/src/bench/verify_script.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2e526aef3a9c176bef5b6786c1531a3de1ef0c86/src/bench/verify_script.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bench/verify_script.cpp?ref=2e526aef3a9c176bef5b6786c1531a3de1ef0c86",
        "patch": "@@ -11,44 +11,10 @@\n #include <script/sign.h>\n #include <script/standard.h>\n #include <streams.h>\n+#include <factories/transactions.h>\n \n #include <array>\n \n-// FIXME: Dedup with BuildCreditingTransaction in test/script_tests.cpp.\n-static CMutableTransaction BuildCreditingTransaction(const CScript& scriptPubKey)\n-{\n-    CMutableTransaction txCredit;\n-    txCredit.nVersion = 1;\n-    txCredit.nLockTime = 0;\n-    txCredit.vin.resize(1);\n-    txCredit.vout.resize(1);\n-    txCredit.vin[0].prevout.SetNull();\n-    txCredit.vin[0].scriptSig = CScript() << CScriptNum(0) << CScriptNum(0);\n-    txCredit.vin[0].nSequence = CTxIn::SEQUENCE_FINAL;\n-    txCredit.vout[0].scriptPubKey = scriptPubKey;\n-    txCredit.vout[0].nValue = 1;\n-\n-    return txCredit;\n-}\n-\n-// FIXME: Dedup with BuildSpendingTransaction in test/script_tests.cpp.\n-static CMutableTransaction BuildSpendingTransaction(const CScript& scriptSig, const CMutableTransaction& txCredit)\n-{\n-    CMutableTransaction txSpend;\n-    txSpend.nVersion = 1;\n-    txSpend.nLockTime = 0;\n-    txSpend.vin.resize(1);\n-    txSpend.vout.resize(1);\n-    txSpend.vin[0].prevout.hash = txCredit.GetHash();\n-    txSpend.vin[0].prevout.n = 0;\n-    txSpend.vin[0].scriptSig = scriptSig;\n-    txSpend.vin[0].nSequence = CTxIn::SEQUENCE_FINAL;\n-    txSpend.vout[0].scriptPubKey = CScript();\n-    txSpend.vout[0].nValue = txCredit.vout[0].nValue;\n-\n-    return txSpend;\n-}\n-\n // Microbenchmark for verification of a basic P2WPKH script. Can be easily\n // modified to measure performance of other types of scripts.\n static void VerifyScriptBench(benchmark::State& state)\n@@ -72,7 +38,7 @@ static void VerifyScriptBench(benchmark::State& state)\n     CScript scriptPubKey = CScript() << witnessversion << ToByteVector(pubkeyHash);\n     CScript scriptSig;\n     CScript witScriptPubkey = CScript() << OP_DUP << OP_HASH160 << ToByteVector(pubkeyHash) << OP_EQUALVERIFY << OP_CHECKSIG;\n-    const CMutableTransaction& txCredit = BuildCreditingTransaction(scriptPubKey);\n+    const CMutableTransaction& txCredit = BuildCreditingTransaction(scriptPubKey, 1);\n     CMutableTransaction txSpend = BuildSpendingTransaction(scriptSig, txCredit);\n     CScriptWitness& witness = txSpend.vin[0].scriptWitness;\n     witness.stack.emplace_back();"
      },
      {
        "sha": "e688303f6b59ddbf16dbf287e3104b315133b32b",
        "filename": "src/test/factories/transactions.cpp",
        "status": "added",
        "additions": 59,
        "deletions": 0,
        "changes": 59,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2e526aef3a9c176bef5b6786c1531a3de1ef0c86/src/test/factories/transactions.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2e526aef3a9c176bef5b6786c1531a3de1ef0c86/src/test/factories/transactions.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/factories/transactions.cpp?ref=2e526aef3a9c176bef5b6786c1531a3de1ef0c86",
        "patch": "@@ -0,0 +1,59 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <test/factories/transactions.h>\n+\n+CMutableTransaction BuildSpendingTransaction(const CScript& scriptSig, int nValue, const uint256& prevout_hash)\n+{\n+    CMutableTransaction txSpend;\n+    txSpend.nVersion = 1;\n+    txSpend.nLockTime = 0;\n+    txSpend.vin.resize(1);\n+    txSpend.vout.resize(1);\n+    txSpend.vin[0].prevout.hash = prevout_hash;\n+    txSpend.vin[0].prevout.n = 0;\n+    txSpend.vin[0].scriptSig = scriptSig;\n+    txSpend.vin[0].nSequence = CTxIn::SEQUENCE_FINAL;\n+    txSpend.vout[0].scriptPubKey = CScript();\n+    txSpend.vout[0].nValue = nValue;\n+\n+    return txSpend;\n+}\n+\n+CMutableTransaction BuildSpendingTransaction(const CScript& scriptSig, const CScriptWitness& scriptWitness, int nValue, const uint256& prevout_hash)\n+{\n+    CMutableTransaction txSpend{BuildSpendingTransaction(scriptSig, nValue, prevout_hash)};\n+    txSpend.vin[0].scriptWitness = scriptWitness;\n+\n+    return txSpend;\n+}\n+\n+CMutableTransaction BuildSpendingTransaction(const CScript& scriptSig, const CMutableTransaction& txCredit)\n+{\n+    return BuildSpendingTransaction(scriptSig, txCredit.vout[0].nValue, txCredit.GetHash());\n+}\n+\n+CMutableTransaction BuildSpendingTransaction(const CScript& scriptSig, const CScriptWitness& scriptWitness, const CMutableTransaction& txCredit)\n+{\n+    CMutableTransaction txSpend{BuildSpendingTransaction(scriptSig, txCredit)};\n+    txSpend.vin[0].scriptWitness = scriptWitness;\n+\n+    return txSpend;\n+}\n+\n+CMutableTransaction BuildCreditingTransaction(const CScript& scriptPubKey, int nValue)\n+{\n+    CMutableTransaction txCredit;\n+    txCredit.nVersion = 1;\n+    txCredit.nLockTime = 0;\n+    txCredit.vin.resize(1);\n+    txCredit.vout.resize(1);\n+    txCredit.vin[0].prevout.SetNull();\n+    txCredit.vin[0].scriptSig = CScript() << CScriptNum(0) << CScriptNum(0);\n+    txCredit.vin[0].nSequence = CTxIn::SEQUENCE_FINAL;\n+    txCredit.vout[0].scriptPubKey = scriptPubKey;\n+    txCredit.vout[0].nValue = nValue;\n+\n+    return txCredit;\n+}"
      },
      {
        "sha": "9506bd24ef55d175516e87108f61085af9a53de3",
        "filename": "src/test/factories/transactions.h",
        "status": "added",
        "additions": 16,
        "deletions": 0,
        "changes": 16,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2e526aef3a9c176bef5b6786c1531a3de1ef0c86/src/test/factories/transactions.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2e526aef3a9c176bef5b6786c1531a3de1ef0c86/src/test/factories/transactions.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/factories/transactions.h?ref=2e526aef3a9c176bef5b6786c1531a3de1ef0c86",
        "patch": "@@ -0,0 +1,16 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+#ifndef BITCOIN_TEST_FACTORIES_TRANSACTIONS_H\n+#define BITCOIN_TEST_FACTORIES_TRANSACTIONS_H\n+\n+#include <primitives/transaction.h>\n+\n+CMutableTransaction BuildSpendingTransaction(const CScript& scriptSig, int nValue, const uint256& prevout_hash = uint256());\n+CMutableTransaction BuildSpendingTransaction(const CScript& scriptSig, const CScriptWitness& scriptWitness, int nValue, const uint256& prevout_hash = uint256());\n+CMutableTransaction BuildSpendingTransaction(const CScript& scriptSig, const CMutableTransaction& txCredit);\n+CMutableTransaction BuildSpendingTransaction(const CScript& scriptSig, const CScriptWitness& scriptWitness, const CMutableTransaction& txCredit);\n+\n+CMutableTransaction BuildCreditingTransaction(const CScript& scriptPubKey, int nValue);\n+\n+#endif"
      },
      {
        "sha": "3573f4cf7f2e1fdb8ada0fea5c6b3a5474d287a8",
        "filename": "src/test/script_tests.cpp",
        "status": "modified",
        "additions": 15,
        "deletions": 47,
        "changes": 62,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2e526aef3a9c176bef5b6786c1531a3de1ef0c86/src/test/script_tests.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2e526aef3a9c176bef5b6786c1531a3de1ef0c86/src/test/script_tests.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/script_tests.cpp?ref=2e526aef3a9c176bef5b6786c1531a3de1ef0c86",
        "patch": "@@ -14,6 +14,7 @@\n #include <util/strencodings.h>\n #include <test/test_bitcoin.h>\n #include <rpc/server.h>\n+#include <test/factories/transactions.h>\n \n #if defined(HAVE_CONSENSUS_LIB)\n #include <script/bitcoinconsensus.h>\n@@ -121,40 +122,6 @@ static ScriptError_t ParseScriptError(const std::string &name)\n \n BOOST_FIXTURE_TEST_SUITE(script_tests, BasicTestingSetup)\n \n-CMutableTransaction BuildCreditingTransaction(const CScript& scriptPubKey, int nValue = 0)\n-{\n-    CMutableTransaction txCredit;\n-    txCredit.nVersion = 1;\n-    txCredit.nLockTime = 0;\n-    txCredit.vin.resize(1);\n-    txCredit.vout.resize(1);\n-    txCredit.vin[0].prevout.SetNull();\n-    txCredit.vin[0].scriptSig = CScript() << CScriptNum(0) << CScriptNum(0);\n-    txCredit.vin[0].nSequence = CTxIn::SEQUENCE_FINAL;\n-    txCredit.vout[0].scriptPubKey = scriptPubKey;\n-    txCredit.vout[0].nValue = nValue;\n-\n-    return txCredit;\n-}\n-\n-CMutableTransaction BuildSpendingTransaction(const CScript& scriptSig, const CScriptWitness& scriptWitness, const CTransaction& txCredit)\n-{\n-    CMutableTransaction txSpend;\n-    txSpend.nVersion = 1;\n-    txSpend.nLockTime = 0;\n-    txSpend.vin.resize(1);\n-    txSpend.vout.resize(1);\n-    txSpend.vin[0].scriptWitness = scriptWitness;\n-    txSpend.vin[0].prevout.hash = txCredit.GetHash();\n-    txSpend.vin[0].prevout.n = 0;\n-    txSpend.vin[0].scriptSig = scriptSig;\n-    txSpend.vin[0].nSequence = CTxIn::SEQUENCE_FINAL;\n-    txSpend.vout[0].scriptPubKey = CScript();\n-    txSpend.vout[0].nValue = txCredit.vout[0].nValue;\n-\n-    return txSpend;\n-}\n-\n void DoTest(const CScript& scriptPubKey, const CScript& scriptSig, const CScriptWitness& scriptWitness, int flags, const std::string& message, int scriptError, CAmount nValue = 0)\n {\n     bool expect = (scriptError == SCRIPT_ERR_OK);\n@@ -163,7 +130,7 @@ void DoTest(const CScript& scriptPubKey, const CScript& scriptSig, const CScript\n         flags |= SCRIPT_VERIFY_WITNESS;\n     }\n     ScriptError err;\n-    const CTransaction txCredit{BuildCreditingTransaction(scriptPubKey, nValue)};\n+    const CMutableTransaction txCredit{BuildCreditingTransaction(scriptPubKey, nValue)};\n     CMutableTransaction tx = BuildSpendingTransaction(scriptSig, scriptWitness, txCredit);\n     CMutableTransaction tx2 = tx;\n     BOOST_CHECK_MESSAGE(VerifyScript(scriptSig, scriptPubKey, &scriptWitness, flags, MutableTransactionSignatureChecker(&tx, 0, txCredit.vout[0].nValue), &err) == expect, message);\n@@ -328,8 +295,9 @@ class TestBuilder\n             redeemscript = scriptPubKey;\n             scriptPubKey = CScript() << OP_HASH160 << ToByteVector(CScriptID(redeemscript)) << OP_EQUAL;\n         }\n-        creditTx = MakeTransactionRef(BuildCreditingTransaction(scriptPubKey, nValue));\n-        spendTx = BuildSpendingTransaction(CScript(), CScriptWitness(), *creditTx);\n+        CMutableTransaction creditMutTx = BuildCreditingTransaction(scriptPubKey, nValue);\n+        spendTx = BuildSpendingTransaction(CScript(), CScriptWitness(), creditMutTx);\n+        creditTx = MakeTransactionRef(creditMutTx);\n     }\n \n     TestBuilder& ScriptError(ScriptError_t err)\n@@ -1097,7 +1065,7 @@ BOOST_AUTO_TEST_CASE(script_CHECKMULTISIG12)\n     CScript scriptPubKey12;\n     scriptPubKey12 << OP_1 << ToByteVector(key1.GetPubKey()) << ToByteVector(key2.GetPubKey()) << OP_2 << OP_CHECKMULTISIG;\n \n-    const CTransaction txFrom12{BuildCreditingTransaction(scriptPubKey12)};\n+    const CMutableTransaction txFrom12{BuildCreditingTransaction(scriptPubKey12, 0)};\n     CMutableTransaction txTo12 = BuildSpendingTransaction(CScript(), CScriptWitness(), txFrom12);\n \n     CScript goodsig1 = sign_multisig(scriptPubKey12, key1, CTransaction(txTo12));\n@@ -1128,7 +1096,7 @@ BOOST_AUTO_TEST_CASE(script_CHECKMULTISIG23)\n     CScript scriptPubKey23;\n     scriptPubKey23 << OP_2 << ToByteVector(key1.GetPubKey()) << ToByteVector(key2.GetPubKey()) << ToByteVector(key3.GetPubKey()) << OP_3 << OP_CHECKMULTISIG;\n \n-    const CTransaction txFrom23{BuildCreditingTransaction(scriptPubKey23)};\n+    const CMutableTransaction txFrom23{BuildCreditingTransaction(scriptPubKey23, 0)};\n     CMutableTransaction txTo23 = BuildSpendingTransaction(CScript(), CScriptWitness(), txFrom23);\n \n     std::vector<CKey> keys;\n@@ -1210,8 +1178,8 @@ BOOST_AUTO_TEST_CASE(script_combineSigs)\n         BOOST_CHECK(keystore.AddKey(key));\n     }\n \n-    CMutableTransaction txFrom = BuildCreditingTransaction(GetScriptForDestination(keys[0].GetPubKey().GetID()));\n-    CMutableTransaction txTo = BuildSpendingTransaction(CScript(), CScriptWitness(), CTransaction(txFrom));\n+    CMutableTransaction txFrom = BuildCreditingTransaction(GetScriptForDestination(keys[0].GetPubKey().GetID()), 0);\n+    CMutableTransaction txTo = BuildSpendingTransaction(CScript(), CScriptWitness(), txFrom);\n     CScript& scriptPubKey = txFrom.vout[0].scriptPubKey;\n     SignatureData scriptSig;\n \n@@ -1533,7 +1501,7 @@ BOOST_AUTO_TEST_CASE(bitcoinconsensus_verify_script_returns_true)\n     CScriptWitness wit;\n \n     scriptPubKey << OP_1;\n-    CTransaction creditTx = BuildCreditingTransaction(scriptPubKey, 1);\n+    CMutableTransaction creditTx = BuildCreditingTransaction(scriptPubKey, 1);\n     CTransaction spendTx = BuildSpendingTransaction(scriptSig, wit, creditTx);\n \n     CDataStream stream(SER_NETWORK, PROTOCOL_VERSION);\n@@ -1556,7 +1524,7 @@ BOOST_AUTO_TEST_CASE(bitcoinconsensus_verify_script_tx_index_err)\n     CScriptWitness wit;\n \n     scriptPubKey << OP_EQUAL;\n-    CTransaction creditTx = BuildCreditingTransaction(scriptPubKey, 1);\n+    CMutableTransaction creditTx = BuildCreditingTransaction(scriptPubKey, 1);\n     CTransaction spendTx = BuildSpendingTransaction(scriptSig, wit, creditTx);\n \n     CDataStream stream(SER_NETWORK, PROTOCOL_VERSION);\n@@ -1579,7 +1547,7 @@ BOOST_AUTO_TEST_CASE(bitcoinconsensus_verify_script_tx_size)\n     CScriptWitness wit;\n \n     scriptPubKey << OP_EQUAL;\n-    CTransaction creditTx = BuildCreditingTransaction(scriptPubKey, 1);\n+    CMutableTransaction creditTx = BuildCreditingTransaction(scriptPubKey, 1);\n     CTransaction spendTx = BuildSpendingTransaction(scriptSig, wit, creditTx);\n \n     CDataStream stream(SER_NETWORK, PROTOCOL_VERSION);\n@@ -1602,7 +1570,7 @@ BOOST_AUTO_TEST_CASE(bitcoinconsensus_verify_script_tx_serialization)\n     CScriptWitness wit;\n \n     scriptPubKey << OP_EQUAL;\n-    CTransaction creditTx = BuildCreditingTransaction(scriptPubKey, 1);\n+    CMutableTransaction creditTx = BuildCreditingTransaction(scriptPubKey, 1);\n     CTransaction spendTx = BuildSpendingTransaction(scriptSig, wit, creditTx);\n \n     CDataStream stream(SER_NETWORK, PROTOCOL_VERSION);\n@@ -1625,7 +1593,7 @@ BOOST_AUTO_TEST_CASE(bitcoinconsensus_verify_script_amount_required_err)\n     CScriptWitness wit;\n \n     scriptPubKey << OP_EQUAL;\n-    CTransaction creditTx = BuildCreditingTransaction(scriptPubKey, 1);\n+    CMutableTransaction creditTx = BuildCreditingTransaction(scriptPubKey, 1);\n     CTransaction spendTx = BuildSpendingTransaction(scriptSig, wit, creditTx);\n \n     CDataStream stream(SER_NETWORK, PROTOCOL_VERSION);\n@@ -1648,7 +1616,7 @@ BOOST_AUTO_TEST_CASE(bitcoinconsensus_verify_script_invalid_flags)\n     CScriptWitness wit;\n \n     scriptPubKey << OP_EQUAL;\n-    CTransaction creditTx = BuildCreditingTransaction(scriptPubKey, 1);\n+    CMutableTransaction creditTx = BuildCreditingTransaction(scriptPubKey, 1);\n     CTransaction spendTx = BuildSpendingTransaction(scriptSig, wit, creditTx);\n \n     CDataStream stream(SER_NETWORK, PROTOCOL_VERSION);"
      }
    ]
  }
]