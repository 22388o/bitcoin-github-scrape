BitcoinPullTester,2014-02-12T00:54:48Z,"Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/e7853a91cf646a6a4701158d148f036924575a97 for binaries and test log.\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.log is moving at http://jenkins.bluematt.me/pull-tester/cu",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34827381,34827381,
gmaxwell,2014-02-12T02:00:11Z,"I note that this patch does what MtGox appeared to be asking for in their press release. In the >48 hours since its creation no one from MtGox has commented on it.\n\nIf people think a normalized ID would be useful, then great. Personally I'm pretty meh about it, as it doesn't address most of the interesting consequences of malleability, and some people might think they don't have to worry about m",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34831255,34831255,
jMyles,2014-02-12T05:49:05Z,"I agree that it's telling that MtGox hasn't weighed in, here specifically or with a solution proposal in general.\n\nI generally lean toward wontfix on malleability, so I'm a little biased, but I agree that this solution may provide a false anaesthesis. \n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34841139,34841139,
laanwj,2014-02-12T07:30:30Z,"Maybe we should rename it to 'mtgox helpdesk id' :-)\n\nI genuinely think that a normalized transaction hash standard can be useful. Not only for helpdesks but also for associating information to a transaction outside the block chain. Wallet metadata for example, we store this mapped to txid right now, which we explicitly recommend against using!\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34845446,34845446,
gmaxwell,2014-02-12T07:40:09Z,"@laanwj   I don't think we've thought through the implications of all the cases where different transactions would get the same ID or wouldn't but would be expected to... different applications may need different levels of normalization.\n\nE.g. consider a pubkey requiring signatures 1 of {A,B}.  (or some more complicated scriptPubKey with an or like property).  A transaction singing with one key ",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34845855,34845855,
MagicalTux,2014-02-12T10:28:48Z,"I am unsure about ANYONE_CAN_PAY transactions as I haven't seen these yet.\n\nNote that normalized transaction ids are meant to be used for transactions issued by the exchange, not received transactions.\n\nFinally even if nobody from MtGox commented here before, this doesn't mean we have not been involved.\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34856227,34856227,
wtogami,2014-02-12T11:25:42Z,"I heard from another exchange that they had accounting problems for deposits.  Apparently their implementation was confused between the 0-conf txid and the mutated 1-conf txid that came later.  While that was an implementation issue for them that was easily fixed, this normalized txid would make it easier to see which tx are the same.\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34859969,34859969,
sipa,2014-02-12T13:36:43Z,"@MagicalTux Absolutely, this is about transactions you send yourself, so if you're sure you stay within the confines of what this guarantees to catch as malleability, you're fine. Sighash flags just limit the usefulness of this normalized txid, not its correctness.\n\n@laanwj Wallets internally have much better ways of dealing with this. The problem is wider - you probably want to deal with double",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34868853,34868853,
coblee,2014-02-13T06:41:49Z,"At Coinbase, we went with our own normalized tx id. I think having a standard recommended normalized tx id would be useful. Sites like Coinbase and MtGox can tell their users this tx id, and the users can check for the transaction on blockchain.info.\n\nThere's also no need to add an index for this txid. Only sites like blockchain.info will need to have an index for it.\n\nCould also consider have",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34952466,34952466,
gmaxwell,2014-02-13T07:31:38Z,"@coblee Sounds great.\n\nIf people want this to be something standardized, you're going to need to comment on it. If you are waiting on something to just happen here then you are going to be waiting a very long time.\n\nAlternative implementations would be goodâ€” so we can make sure they agree (e.g. on fuzzed versions of all tx in the blockchain) and that there isn't corner-case behavior which is t",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34954514,34954514,
MagicalTux,2014-02-13T07:34:44Z,"@gmaxwell Are you saying that we should just come up with our own standard and push it rather than waiting for the bitcoin core devs to confirm what standard would work best?\nIf not I believe most of the people here agree that having this ""normalised id"" (call it maybe a ""helpdesk id"" or whatever) being the SignatureHash makes most sense.\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34954644,34954644,
coblee,2014-02-13T07:43:42Z,"@gmaxwell Yeah, we were just waiting for a decision from the devs, figuring you guys will have a better idea on how to solve this problem.\n\n@MagicalTux If the devs aren't going to move forward with this, we should just talk to piuk (blockchain.info) and other exchanges and come up with a standard.\n\nI think having a standard normalized transaction id is important for the user experience when do",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34955016,34955016,
laanwj,2014-02-13T07:52:12Z,"a) Restricting the scope to 'accounting id' or 'helpdesk id' is helpful here. Transactions that are never issued by an exchange for withdraws fall outside the scope here (like ANYONECANPAY).\n\nb) What we need here is a BIP standard, not a 'bitcoind client feature'! So that means different implementations should be made, test vectors for cross-validating them, and so on.\n\nc) 'The devs' (@sipa in",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34955436,34955436,
gmaxwell,2014-02-13T07:54:11Z,"@MagicalTux  We've proposed an approach,. In the three days that it has been posted you have not provided any substantive comment on it.  Will this fit your needs?  Are you able to implement it? have you attempted to implement it? If so can we test agreement between this implementation and yours?  Do you have an alternative proposal? \n\nI don't believe there is anything more that the core devs sh",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34955516,34955516,
MagicalTux,2014-02-13T08:01:58Z,"@gmaxwell The implementation here fits what I discussed with @sipa and on IRC on the chatroom dedicated to this issue. It is still missing ways to get this id while sending coins (for example ""normsendtoaddress"" rpc method?) but apart from this, this seems to works exactly as we suggested.\nI am unsure about a single point: bitcoin usually reverse bytes in hashes for txs and blocks, I do guess the",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34955897,34955897,
luke-jr,2014-02-13T08:04:19Z,"This proposal doesn't gracefully scale to newer protocols such as CoinJoin. Using a hash of scriptPubKey (if address reuse must be supported, the change scriptPubKey fits all current uses of txid) should be fairly compatible and also known only to the transacting parties (sender, in case of change output) and those whom they reveal it.\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34956007,34956007,
luke-jr,2014-02-13T08:07:54Z,@coblee IMO any solution that proposes users depend on a centralised service is unacceptable. So indexes _are_ needed.\n,https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34956221,34956221,
laanwj,2014-02-13T08:07:55Z,@luke-jr That's beside the point if this is an id for exchanges to track their outgoing transactions.\n\n@MagicalTux getting this id after sending would be a matter of calling `getnormalizedtxid` on the transaction created by the send. I do think we need a `getrawwallettransaction` RPC as there is currently no way to get raw transactions from the wallet.\n,https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34956225,34956225,
luke-jr,2014-02-13T08:10:53Z,"@laanwj There's no reason to single out exchanges as a special case that gets to use a new feature. Furthermore, exchanges should not be forced to avoid (or even discouraged from) using improvements like CoinJoin.\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34956395,34956395,
laanwj,2014-02-13T08:17:31Z,@luke-jr The point is that this cannot be everything to everyone! As @gmaxwell explains in his second post it may not be possible to come up with a generic 'normalized txid' that satisfies everyone and every use case. So the focus has to be narrowed to something practical. They want an ID to track a specific network transaction.\n\nIf you want to be invariant under coinjoin and other input/output ,https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34956776,34956776,
MagicalTux,2014-02-13T08:20:00Z,"@laanwj having to do two rpc calls can increase the risk of an error occurring, and may not be something exchanges want to do. Maybe alternatively we could use an argument to sendtoaddress to specify that the returned hash should be this new hash (or maybe both could be returned at the same time via another method that would provide more details on the generated tx such as fees/etc)\n\n@luke-jr ac",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34956906,34956906,
gmaxwell,2014-02-13T08:22:10Z,"@luke-jr we don't normally have an index for txid in the default configuration, even the wallets internal indexing of txids is pretty much just for internal use.  E.g. no way to get to it in the GUI as far as I know.\n\n@MagicalTux To get this ID when sending coins you call the additional RPC to look it up.  Sadly, we can't use this as a general replacement for txids because some (currently unusua",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34957038,34957038,
MagicalTux,2014-02-13T08:24:09Z,"@gmaxwell While I do not think using this as a replacement (an api needs to stay consistent across updates), but having a different method or a parameter allowing to obtain this id directly will make the implementation of this solution that much easier for services using the bitcoind client.\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34957138,34957138,
gmaxwell,2014-02-13T08:28:39Z,"Unfortunately, as I pointed out, it is not viable to use the normalized ID exclusively to track transactionsâ€” not just for API stability reasons, but because the IDs are not very useful if you start making transactions with sighash flags other than ALL or do things which depend on which way a script with branches was satisfied, so I believe we're not going to do that at this time. \n\nI wouldn't s",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34957387,34957387,
laanwj,2014-02-13T08:30:12Z,@MagicalTux we need to seperate two concerns here:\n\n1) Standarization of the 'helpdesk id'\n2) Implementation in the bitcoind client\n\nLet's focus on 1 first. 2) can wait. Remember that @sipa explicitly mentions that he didn't flesh out the entire API yet and just wants to propose a way to compute the id so that we can at least agree on that.\nAs you use custom software (as I guess many exchang,https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34957492,34957492,
MagicalTux,2014-02-13T09:16:24Z,"@laanwj I agree, standardization is the most important point. Since we use our own client we can easily implement that on our side, and I believe it'll be the same for blockchain.info\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34960471,34960471,
sipa,2014-02-13T11:31:54Z,"So, to clarify: I don't think this normalized transaction id as such is a required part of solving the malleability problem in _wallets_ - those have better (potential) ways of dealing with it (which would equally help with double-spending in general).\n\nHowever, it turns out that due to how many services work, I believe it is useful to have a standard for this at a higher level. As MtGox asked f",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34970229,34970229,
Corelianer,2014-02-13T11:51:44Z,"@sipa Sorry I'm new here but, can you maybe explain what the normalizing function should do? \n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34971342,34971342,
ghost,2014-02-13T12:38:28Z,"@Corelianer It will create something similar to the TXID that will not be malleable. However it won't be useful for other things like creating transactions. Its simply an identifier which you can use to label each transaction.\n\n@MagicalTux Is there any particular reason that you use a client written in PHP? While I can understand that it would make some aspects easier, couldn't you create a wall",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34974157,34974157,
laanwj,2014-02-13T12:43:39Z,"Guys, please, let's not let this devolve this into a generic Q&A forum for Mtgox or malleability issues. This is for technical discussion only.\n\n@MagicalTux yep, this implementation suffices to validate alternate implementations.\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34974448,34974448,
llongeri,2014-02-13T13:09:56Z,"@sipa: isn't where an existing rule to deal with TXID collisions in the blockchain? That 2 transactions in the blockchain can have the same TXID if and only if the first transaction is spent by the time the second transaction is added in a new block? (can't find the reference now)\n\nHow do you deal with normalized TXID collisions? Now, in the long run, you may end up with 2 unrelated transactions",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34976116,34976116,
lodewijkadlp,2014-02-13T13:30:12Z,"@llongeri If you're worried about that, use the whole transaction as the unique ID. Honestly nothing else will prevent a possible collision. It is just too unlikely there'll ever be a collision to worry about it.\n\nIdentical NTXID will cause a transaction to seem confirmed when it isn't yet. If that should ever happen (it won't, I bet) it will likely not affect whatever process it is in, as it is",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34977552,34977552,
llongeri,2014-02-13T14:00:26Z,"@lodewijkadlp you are right, it is just that dealing with two IDs that are not unique either of them is just more confusion.\nAnd yes, if ever a NTXID collision happens it most probably will go unnoticed and will only involve 2 transactions.\nBut I think this is just making a more confusing system, and it could be useful until there is a real solution to malleability is widely adopted. I would ver",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34980007,34980007,
sipa,2014-02-13T14:08:29Z,"Two transactions with the same ntxid will necessarily have the same inputs, so conflict with eachother. This guarantees they cannot enter the same block chain together, since BIP30 and BIP34.\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34980677,34980677,
justusranvier,2014-02-13T14:37:00Z,"The name should avoid including ""id"", because that's going to cause problems down the road when people will make false assumptions about its properties.\n\nI think ""txhint"" would result in fewer future problems.\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34983395,34983395,
llongeri,2014-02-13T14:51:09Z,"@sipa BIP30 guarantees that 2 unspend transactions in the blockchain cannot have the same TXID. And BIP34 introduces uniqueness of coinbase transactions.\n\nI understand there is no guaranty for unique TXID, and much less guaranty for NTXID uniqueness since is not even treated by miners or ever consider in the mining process.\n\nBut NTXID can be useful until a solution to malleability is widely sp",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34984833,34984833,
sipa,2014-02-13T14:56:31Z,"BIP34 guarantees that the same txid cannot reoccur for a new transaction, as that requires all its dependencies to be equal as well, up to and including all coinbases it inherits from.\n\nBut even independently from that, two transactions that spend the same inputs will always conflict with eachother. The only way it could occur is if the unspent outputs were recreated in the mean time, and that i",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34985406,34985406,
luke-jr,2014-02-13T15:28:37Z,@laanwj AFAIK hash of change scriptPubKey works in every use case?\n\n@MagicalTux CoinJoin does not provide a final transaction form until it is mined in a block (or at least all parties have signed the transaction and it is broadcast). You also lose the ability to reissue with higher fees should it not get mined in a timeframe you are happy with.\n\n@gmaxwell The wallet should have indexes by txi,https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34989143,34989143,
llongeri,2014-02-13T15:48:45Z,"@sipa, BIP34 guarantees that 2 coinbase transactions cannot have the same content (whole transaction content, by adding the block's height in its scriptSig). Thus stopping the trivial reappearance of the same TXID in the blockchain for coinbase transactions (and also for subsequent transactions in their spending chains).\n\nBut it is important to clearly state that TXIDs are not guarantied to be u",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34991457,34991457,
sipa,2014-02-13T15:57:31Z,"I'm sorry, I don't have the time to explain this. But the network rules current guarantee that any two transactions in the block chain have a different txid. This is an indirect result of BIP34. By extension, as the ntxid depends on the txids of the outputs being spent, any two transactions in the blockchain will have a different ntxid (as otherwise they would be spending the same outputs twice).\",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34992475,34992475,
sipa,2014-02-13T16:02:35Z,"Re-reading your comment, you're just referring to SHA256 collisions resulting in txid collisions?\n\nSure, that is possible. If you're going to care about this, you should stop using Bitcoin, though. We rely on much weaker cryptographic guarantees already.\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34993071,34993071,
tmairegasnighto,2014-02-13T16:23:02Z,"~~Will NTXID be validated by nodes or will it be susceptible to malicious intentional collisions?~~ \n\nEDIT: I thought the ntxid was going to be broadcast with the transaction.  Since it is client side only, there's no risk of intentional spoofing.\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34995424,34995424,
sipa,2014-02-13T16:25:10Z,"NTXID is just a service-level thing. It does not exist at the level of the blockchain, the protocol, the peer to peer network, or the consensus rules. There is no validation on it.\n\nIt just exists to help _humans_ quickly find identical transactions.\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34995649,34995649,
llongeri,2014-02-13T17:01:51Z,"@sipa, sorry, don't want to waste your time. Yes, I was referring to SHA256 collisions (not just being paranoid, but wanted to clarify things). \nBut BIP30 already deals with this for transactions.\n\nAnyway this implementation does not alter current processes (mining, block validation, etc), so the patch is much easier to validate and without possible unforeseen side effects that other patches co",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-34999984,34999984,
ghost,2014-02-13T17:34:23Z,Updates have been today as to how blockchain.info handles mutable transactions which are relevant to this discussion.\n\nWe are now using Sipa's normalized hash scheme to detect transaction conflicts internally. If multiple transactions are received with the same NTXID only one will be kept in the memory pool. \n- If searching for the conflicting hash which wasn't kept in the memory pool it will t,https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35003770,35003770,
underhood,2014-02-13T17:43:20Z,"@zootreeves:\nHmm sounds good however i see one problem in your plan (correct me if i am wrong).\nImagine i send transaction, somebody modifies its ID. Modified/mutated transaction gets into the block before original transaction gets into your bitcoin client memory pool. This way you will have no link to ID of original issued transaction and no way to find it. So MtGox still should use NTXID for s",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35004696,35004696,
sipa,2014-02-13T17:48:43Z,@zootreeves Not sure why you need this normalized hash for that. The mempool (at least in recent bitcoind releases) already guarantees consistency and prevents two transactions that consume the same input from entering the mempool at the same time. \n,https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35005236,35005236,
ghost,2014-02-13T17:51:44Z,"@underhood It will not make it into the memory pool, but we will still record a link from hash to NTXID regardless, so searching by either hash will work. Edit: If we don't see it on the network at all then yes the link will not resolve.\n\n@sipa Blockchain.info displays double spends, so we allow conflicts in the memory pool. Before this manipulated transactions were displayed with a big ""double ",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35005553,35005553,
underhood,2014-02-13T18:00:49Z,@zootreeves: I think you don't get me.\nIn case i described (original transaction not reaching your mempool before malled gets into block):\nyou can do malled transaction hash --> NTXID\nbut not original transaction hash --> NTXID (as original transaction with original hash never reached you)\n\nso exchange cannot use original transactinon hash links as you suggested\n,https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35006511,35006511,
ghost,2014-02-13T18:20:06Z,"@underhood  Yes I see. In that case a standardised hash is needed.\n\nMy only reluctance is allowing searching by NTXID for all transactions means maintaining another large, ever expanding, index. Using the previous technique we only need to keep a link from hash to NTXID while waiting for the transaction to confirm, only if conflict actually occurs then we need to keep the link permanently.\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35008479,35008479,
lnovy,2014-02-13T18:22:07Z,"I don't think this should be considered as standard. My reasoning follows. I would strongly prefer this to be considered as best-practice only as there are clearly some benefits of using this, but this is only limited to specific scenarios and even this is limited to current situation where malleability of transactions is possible. This is a this temporally solution to a design flaw of Bitcoin pro",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35008711,35008711,
b733686a-14ea-4048-aa94-44c2cb029830,2014-02-13T18:30:43Z,"@zootreeves As your business revolves fairly tightly around keeping indexes for the blockchain that nobody else does, it's not like other people are ever going to encounter a similar problem. I can't imagine you'll ever be in the situation where your revenue is less than the cost of adding additional drives to a ZFS pool from time to time.\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35009630,35009630,
maaku,2014-02-13T18:50:19Z,"I didn't know this had gotten to be a pull request. I'm working on a fork of sipa's branch which adds error corrective capabilities and makes the normative ID visually distinctive from the protocol transaction ID in the following ways:\n1. 64 base32 characters instead of base16 (hex).\n2. Automatic correction of up to two errors in input, and highly probable detection of non-recoverable errors.\n3",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35011636,35011636,
justusranvier,2014-02-13T18:51:36Z,"""NTXID is just a service-level thing. It does not exist at the level of the blockchain, the protocol, the peer to peer network, or the consensus rules. There is no validation on it.\n\nIt just exists to help humans quickly find identical transactions.""\n\nA good reason to call it a hint instead of an id, because if you call it an id people will mistake it for something validated in the protocol.\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35011791,35011791,
llongeri,2014-02-13T19:05:46Z,@maaku your ID example does not pass a 'copy-paste' test. A double click on \nit doesn't fully select it in a browser. All other bitcoin's identification encodings were designed to be easy to select. You should get rid of the dashes at least.\n\n@justusranvier I agree with you.\n,https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35013321,35013321,
b733686a-14ea-4048-aa94-44c2cb029830,2014-02-13T19:21:42Z,"@maaku I'm having trouble getting enthusiastic about this one. What possible scenario would involve a user being forced to read out 64 characters of information to a companies support? The original point of a ""normalized ID/hint"" is for a service to be able to identify their own outgoing transactions, and that's it. \n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35014990,35014990,
maaku,2014-02-13T19:31:29Z,"@b733686a-14ea-4048-aa94-44c2cb029830, if you scroll up in this discussion you'll find representatives from Coinbase talking about sending normative IDs to customers which they can use to lookup transactions in their wallet or some centralized indexing service.\n\nAnd, believe it or not, a large segment of the non-tech community actually likes to do things like arrange transactions over the phone.",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35016035,35016035,
ghost,2014-02-13T19:34:08Z,If is is just a service level thing why not use base58 and trim the hash to 16 or 20 bytes.\n,https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35016351,35016351,
gmaxwell,2014-02-13T19:40:09Z,"From experience base58 is remarkably hard to read without errors due to mixed case, FWIW.\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35017013,35017013,
b733686a-14ea-4048-aa94-44c2cb029830,2014-02-13T19:54:25Z,"@maaku Right, I'd missed that part, my mistake. \n\nI'd work on your encoding though. I'm in the same school of thought as @gmaxwell in that it's extremely hard to read, and with @llongeri that keys with hyphens in them are difficult to work with due to copy-paste not seeing it as a ""word"". If anybody else, this novelty account proves that working with GUID-like formats is a right pain in the ass ",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35018563,35018563,
maaku,2014-02-13T19:59:07Z,"@b733686a-14ea-4048-aa94-44c2cb029830, gmaxwell was commenting on the suggestion to use base58. I think that is a bad idea for the same reasons. My encoding is base32 to avoid case sensitivity issues (also a problem for over-the-phone situations). I'm fine with removing hyphens as copy-and-paste seems like a more common use case than the need for visual groupings. The decoder should be insensitive",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35019094,35019094,
Unitech,2014-02-13T19:59:48Z,"@MagicalTux Ca fait maintenant bientÃ´t deux semaines que MtGox bloque les retraits de Bitcoin. Pour les gens et les dÃ©veloppeurs comme moi c'est une triste histoire, qui nous enlÃ¨ve des possibilitÃ©es d'entreprendre certains projets... Est-ce qu'un jour nous allons pouvoir accÃ©der Ã  notre petite fortune qu'on a, pour certains, mis beaucoup de temps a accumuler ?...\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35019156,35019156,
maaku,2014-02-13T20:01:12Z,"@Unitech, totally the wrong place for MtGox support.\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35019296,35019296,
T4Truth,2014-02-13T20:03:57Z,don't you guys see what is going on here?  MtGox is trying to cover up for the gross incompetence that left them insolvent: they paid people multiple times with totally separate transactions and didn't notice until their wallet was empty.\n\nNow they are holding customer's BitCoin trying to extort some free labour from the volunteer developers here but the labour isn't really what they want. By co,https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35019588,35019588,
gmaxwell,2014-02-13T20:16:11Z,"@T4Truth This normalized hash stuff doesn't have anything to do with coin lossâ€” the kind of doubled payments you're talking about can only be prevented by making sure the reissued transaction conflicts with the original, giving you atomic exclusion. Nothing else is safe, since nothing else prevent both txn from going in (even if the inputs were already conflicted by another transaction, due to the",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35020824,35020824,
il--ya,2014-02-13T20:32:55Z,"@zootreeves ""If is is just a service level thing why not use base58 and trim the hash to 16 or 20 bytes."" 4 byte ID is more than enough for identifying transaction in internal database. Any collisions can be resolved using destination address or user ID etc. There is no need to standardize ""normalized ID"" hash or include it into reference implementation, I agree with @lnovy on that. Too much time ",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35022519,35022519,
gmaxwell,2014-02-13T20:42:18Z,"interesting pointâ€” indeed the classic way to identify a payment is that you're supposed to use a virgin scriptpubkey for every payment, and then you know you've been paid when it shows upâ€” but that doesn't match how many people use Bitcoin today.    Maybe  [[8byte ID]-address-value] would be a much better normalized identifier, in fact. \n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35023446,35023446,
lnovy,2014-02-13T21:03:12Z,"Another thing that I'm not ready to accept is that even with the way Bitcoin is used today the probability of _to the customer once given out transaction id_ changing in the future can minimized to negligible, if one just waits for the transaction to be confirmed. In that case only reorgs could/would be causing this id to change and exchanges would have their freedom of choice when deciding how to",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35025520,35025520,
b733686a-14ea-4048-aa94-44c2cb029830,2014-02-13T21:12:16Z,"@gmaxwell 8 bytes is overkill as well. Even if you were looking at a Satoshi Dice level of address reuse you're unlikely to ever get into the situation where you have a collision.  4 bytes of the signature (assuming 0.8 clients that enforce encoding style) + a few bytes of the HASH160 the transaction output was to and you'd be home free.\n\n@lnovy Agreed, it's unlikely that a withdraw from a servi",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35026427,35026427,
lnovy,2014-02-13T21:38:08Z,"You could have a split which each chain having different version, but this is just a corner case, is solvable by 1 proactive email and support desk would be already prepared for that potential ticket.\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35029111,35029111,
jfollas,2014-02-13T23:02:39Z,"The unmalleable transaction/reference id could be based on deterministic data, like a Merkle tree made up of hashes + index of the transaction's TXINs.\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35037314,35037314,
gmaxwell,2014-02-13T23:03:40Z,@jfollas Please don't comment without even reading the patch.\n,https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35037393,35037393,
MagicalTux,2014-02-13T23:04:49Z,"This is getting us nowhere. There is indeed so many things we could do on our own even at MtGox, however this merge request's purpose is to define a standard others using Bitcoin can agree to and that can be implemented.\nGetting rid of malleability would be the ideal idea, but this won't happen anytime soon no matter how everyone tries. It can be made harder, but not impossible.\n\nOn the other h",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35037503,35037503,
gmaxwell,2014-02-13T23:18:51Z,"@MagicalTux   Reissuing a transaction without reusing the inputs is unsafe. You cannot do this and be confident you will not be robbed, because there is nothing preventing both transactions from going through. No amount of checking can provide protection in that case, because the prior transaction may not have gone through _yet_ but still may go through for as long as it has not been conflictedâ€” o",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35038553,35038553,
ghost,2014-02-13T23:27:06Z,"@gmaxwell \nI can't imagine that at this time anyone would suggest adding any more data to the transactions of the block chain, considering the size of it is already considered a high priority issue and that it would most likely require a hard fork and complete reindex of everyone's clients.\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35039259,35039259,
luke-jr,2014-02-13T23:41:45Z,"Indeed, the change-scriptPubKey-hash proposal only suggests using existing data.\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35040426,35040426,
maaku,2014-02-13T23:45:17Z,"@MagicalTux If you re-issue a transaction which does not double-spend at least one of the original transaction's inputs, you will lose money. With the way that the protocol works, double-spending is the only option to ensure that two transactions remain exclusive of each other and only one makes it on the chain. Otherwise the original you issued remains valid and might be confirmed, in which case ",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35040695,35040695,
lnovy,2014-02-14T00:13:23Z,"There are actually 2 different things that exchanges are trying to address here.\n- The need of some id of their own transaction that is invariant under transaction malleation.\n  - this should be some internal token, bitcoin client nor network nor customer is interested in that.\n  - the only reason why regular txid cannot be used here and for this type of transactions is the potential transactio",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35042650,35042650,
lnovy,2014-02-14T00:23:32Z,Giving the transaction hash to the customer before the transaction is confirmed only brings complications on every side even when this not potentially useful for anyone. It is not even more difficult or expensive for service provider to delay this giveaway as it need to track the transaction progress anyway.\n,https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35043293,35043293,
ghost,2014-02-14T00:28:23Z,"@Invony Assuming that the method of creating that token is standardized, and possibly built into future clients without being included in the blockchain it should be fine. The users would still be able to search for the transaction on blockchain.info and if they update their wallet they can do so in their client.\n\nThis way it would be useful for the client, and the exchange without requiring a f",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35043579,35043579,
lnovy,2014-02-14T00:32:44Z,If the customer is given the final txid in first place there is no need for this to be in client nor this need to be implemented by blockchain.info. Why should we implement something that is not needed and is duplicating a functionality of txid but only for smaller subset of possible transaction types?\n,https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35043863,35043863,
il--ya,2014-02-14T00:34:16Z,"@gmaxwell @maaku It's quite worrying and real pain in the backside that failed transactions may potentially be included at some later point into the blockchain. It seems at the moment the only way to properly ""cancel"" previous transaction which failed to be confirmed is to spend at least one of it's inputs. But what if that fails as well? Then you have yet another stuck transaction to worry about ",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35043967,35043967,
ghost,2014-02-14T00:37:10Z,"@lnovy While I agree with you, it also provides a useful index for companies that use 0 confirmation transactions to build up their databases.\n\nI would agree with you fully if it were to be included in the blockchain, but if it is calculated on the client side (and therefore something that could be turned off) it will simply provide another measure against malleability until/if it is fixed.\n\n@",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35044146,35044146,
maaku,2014-02-14T00:39:10Z,"@il--ya off-topic. Short answer: yes, with a fork, but it introduces edge cases where entire chains of transactions can be invalidated. I personally think the pros outweigh the cons, but there is not consensus on this. Please take follow-up discussion to the forum, mailing list, or IRC (not here).\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35044248,35044248,
lnovy,2014-02-14T00:55:34Z,"Companies that need to build these indexes need them strictly for internal needs of speed benefit when fighting the malleability, but contrary to bitcoind they can actually affort this as they can limit the type of transactions they are issuing. It is not possible to do this hashing generally in bitcoind and we are fighting the malleability differently. The point is that the method of achieving th",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35045284,35045284,
lodewijkadlp,2014-02-14T01:38:58Z,"To make the use case clear:\n\nI am company X. The customer Y wants to withdraw.\n- Y requests payment (out of band, http for example)\n- I perform a payment.\n\nNow either I can CLAIM to have made the transaction, and the user has to\nwait 10*x where x >= 1 to know if I'm right. OR I can give him the txid.\n\nIf X gives him the txid it might get malleaded and fail and cause a big\nfuzz. This is n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35047642,35047642,
lnovy,2014-02-14T04:22:51Z,"Until the transaction is confirmed it enjoys exactly the same level of trust as any other claim.\nCompare:\n- User Y requests a payment, is given a ntxid, puts it into blockchain.info, transaction might appear, warning might appear that the transaction was malleated, needs to wait avg. 5 minutes until transaction is confirmed to trust you.\n- User Y requests a payment, is given a message that with",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35054572,35054572,
jcrubino,2014-02-14T04:31:32Z,"@justusranvier +1 on the hint vs id\n\nAs a developer new to bitcoin this has been very confusing, it seems small but with documentation only in the git logs txid has been little devil to work with from the start even without the current issues.\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35054869,35054869,
MagicalTux,2014-02-14T04:53:05Z,"Just to update this thread, it seems that this discussion is mostly stale now. We (at MtGox) will implement this new hash index in our transactions database and start working with it (we will announce a maintenance as we will have to stop bitcoin deposits too during the database schema update) and will start providing this new hash when customers are withdrawing bitcoins, litecoins, or any other c",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35055553,35055553,
maaku,2014-02-14T05:45:18Z,I've finished the encoder and a verification program which exhaustively demonstrates the error-correction capabilities of the CRC polynomial used. It's available at this gist:\n\nhttps://gist.github.com/maaku/8996338\n\nYou can test it out like this:\n\n```\n$ ./encode-ntxid 4a5e1e4baab89f3a32518a88c31bc87f618f76673e2cc77ab2127b7afdeda33b\ntxr5munp7vx5jcsv6omwyhht56yq74pp75pi6ggmekrrsmutpcxk5s4bpj,https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35058184,35058184,
lnovy,2014-02-14T05:49:37Z,"@MagicalTux  this is OT, but I hope you will keep displaying the regular txid along with it, maybe adding some flag (confirmation count?) to let customer know that this txid is final? Also ping me on freenode to discuss some potentially troublesome properties of your implementation I'm concern of...\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35058348,35058348,
underhood,2014-02-14T09:36:07Z,Definitelly ACK on this... I think however format of this NTXID should be discussed. Should be reasonably concise and adding error correction is good to have(against mistype or errors in manual copying from paper).\nAlso good point is being able to distinguish TXID from NTXID by format of it to avoid confusion.\nSelectability by double click in browser is nice thing to have but not critical for me,https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35068969,35068969,
ghost,2014-02-14T11:45:02Z,Preliminary support for searching by normalized hash is now available on blockchain.info. Links can be resolved using /ntxid/\* path e.g.\n\nhttps://blockchain.info/ntxid/3c0b247b0f9107309c603441f0411b1e8a54dbbb86c892d0aced6aa285804c7f\n\nTwo new [query tools](https://blockchain.info/q):\n\n/q/hashtontxid/$txhash - Convert a transaction hash to ntxid\n/q/ntxidtohash/$ntxid - Convert an ntxid to tr,https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35076861,35076861,
lodewijkadlp,2014-02-14T15:07:36Z,@MagicalTux as a long time MtGox user I'm happy to hear we can finish this black chapter soon.\n\n@zootreeves I greatly respect the speed at which new features have always appeared on blockchain.info. Thank you.\n\nI hope that with this we can move on a little bit.\n\n@gmaxwell @sipa @otherdevs I think this forum is outlasting its utility. Keeping it open for further updates on progress might be a,https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35091266,35091266,
lnovy,2014-02-14T15:10:19Z,I found another lethal problem with this. Normalized transaction hashes try but are not by definition unique and sender needs to put out large effort to assert that transaction which he issues has non-colliding ntxid with another one already included in the blockchain if he wishes to use this hash for accounting purporses or eg. as a relation databases' key.\n\nFrom BIP0030:\n\n> Blocks are not al,https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35091518,35091518,
lodewijkadlp,2014-02-14T15:19:02Z,"@Inovy, so you're also in favor of calling it a hint, not an identifier?\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35092280,35092280,
lnovy,2014-02-14T15:32:45Z,"I would consider substantial rework from scratch, the only usable part of this is it's ability of detecting mutant versions of your own transaction of specific type in the time window before this transaction is confirmed in the blockchain. In this case it's actually an id and process of obstaining it should be put out as a best-practice to mitigate some of the current malleability issue at conditi",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35093597,35093597,
sipa,2014-02-14T15:54:20Z,"As I've said before: since BIP34, transaction ids _are_ unique.\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35095727,35095727,
lnovy,2014-02-14T16:09:38Z,"Mae culpa. I need to lower my declaration from broken by design back to ""not useful for anyone else than the sender internally when not duplicating properties already available"" :)\n\nEDIT: It seems I owe you all a big apology as I can no longer stand behind most of the claims I've written here and in other places.\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35097262,35097262,
maaku,2014-02-15T02:42:40Z,My gist has been updated with an error correcting decoder:\n\nhttps://gist.github.com/maaku/8996338\n\nI also have most of the code necessary to integrate this into bitcoind on top of @sipa's commits. That will be the next task. You can use the gist C++ programs like so:\n\n```\n$ ./encode-ntxid 4a5e1e4baab89f3a32518a88c31bc87f618f76673e2cc77ab2127b7afdeda33b\ntxr5munp7vx5jcsv6omwyhht56yq74pp75pi6,https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35145489,35145489,
boborsomeoneelse,2014-02-15T05:15:31Z,"I'm not entirely clear on what ""normalized transaction hash"" is a hash of. Is it a hash of everything but the signature? If someone has a spare minute could you explain...\nconventional: txid -- sha256 hash of whole transaction (right?)\n""normalized transaction hash"": ntxid -- hash of ???\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35147803,35147803,
maaku,2014-02-15T07:12:41Z,"It is that thing which is signed by the holder of the coins in order to authorize the transaction, for standard transactions under normal circumstances.\n\nTransactions are ""malleable"" because there are portions which are not covered by the signature and therefore can be altered without invalidating the signature. A normative / canonical ID excludes these parts of the transaction as well, so the """,https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35149313,35149313,
laanwj,2014-02-15T07:24:20Z,"@boborsomeoneelse  The code that actually serializes the data that will be hashed is in https://github.com/bitcoin/bitcoin/blob/master/src/script.cpp#L1054\n(txTo=transaction, scriptCode=CScript(), nHashType=SIGHASH_ALL, nIn=0).\n\nThis hashes (w/ SHA256):\n- nVersion\n- vIn: \n  - Effectively all input scripts are blanked out before serialization\n    - Blanks out input scripts except for input 0",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35149457,35149457,
gavinandresen,2014-02-15T14:14:41Z,"Rough consensus seems to be this is a good idea. I don't see any consensus for an error-correcting or more complicated version of this.\n\nRE: looking up by normalized transaction ID:  automatically creating a multimap&lt;normtxid,txid&gt; index violates a design principle of ""don't add features that cost something even when they are not being used, unless that feature will be used by the vast maj",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35157089,35157089,
sipa,2014-02-15T14:41:39Z,"@gavinandresen Looking up by normalized txid, you're talking about just indexing the wallet, not the whole blockchain I hope (if so, why does -txindex have anything to do with it?).\n\nWithin the wallet... I'm not sure, it may encourage people to use it for more than it is meant to. But not being able to look up wallet transactions by ntxid would be implementing a feature that's really only useful",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35157659,35157659,
dexX7,2014-02-15T16:44:01Z,blockchain.info implemented a lookup (see [comment](https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35076861) from @zootreeves). From my point of view it appears to be appealing for application developers to simply replace any usage of txids with ntxids and as long as this is no universal replacement for txids I suggest to discourage the usage of it as such as much as possible.\n,https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35160664,35160664,
ghost,2014-02-15T17:21:33Z,"@dexX7 I agree, I don't see what can go wrong with its usage although I don't think ntxid is a good name as it may confuse some people. It should have a completely separate name.\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35161650,35161650,
maaku,2014-02-15T17:58:13Z,"I've pushed the patch using base-32 encoding and CRC error correction polynomials to my own repository. It works, but still needs some test vectors. Any code review would be appreciated:\n\nhttps://github.com/maaku/bitcoin/tree/normtxid\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35162695,35162695,
laanwj,2014-02-16T09:57:12Z,Rebase version after #3671\nhttps://github.com/laanwj/bitcoin/tree/2014_02_normtx_rebased\n,https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35181246,35181246,
stevenroose,2014-02-17T14:24:35Z,Maybe someone from the devs could answer the following question on bitcoin.SE about what the normalized tx hash is:\nhttps://bitcoin.stackexchange.com/questions/22168/what-is-the-normalized-transaction-hash-of-a-transaction\n\nI think that would be very helpful towards other parties trying to implement/use them.\n,https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35285677,35285677,
maaku,2014-02-18T02:50:20Z,"I added unit tests, and the ability to encode/decode strings which are not a multiple of 128 bits in length (to support applications other than ntxid):\n\nhttps://github.com/maaku/bitcoin/tree/normtxid\n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35347783,35347783,
maaku,2014-02-20T10:34:23Z,I've pushed a hopefully final version of the error correction coded normative transaction ID branch to my public repository:\n\nhttps://github.com/maaku/bitcoin/tree/normtxid\n\nThis version breaks behavior from what is described in this pull-request by using the regular (not SignatureHash) transaction ID for coinbase transactions. The patch in this pull request has the potential to result in dupl,https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-35607432,35607432,
laanwj,2014-03-10T13:03:45Z,"Time to close this?\n\nThis does not provide a solution to transaction malleability abuse but only a workaround with very limited applicability. This is basically only good for identifying your own transaction to users for helpdesk usage. There are many other ways to do that, such as providing some internal database ID or even giving the whole transaction hex.\n\nWallets have better ways of being ",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-37179459,37179459,
gavinandresen,2014-03-10T13:05:11Z,I agree with @laanwj -- this should not be merged.\n,https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-37179568,37179568,
ghost,2014-03-10T14:23:10Z,"Agreed wholeheartedly, this should not be merged. \n",https://github.com/bitcoin/bitcoin/pull/3656#issuecomment-37186860,37186860,
rebroad,2014-02-18T01:23:02Z,blah?\n,https://github.com/bitcoin/bitcoin/pull/3656#discussion_r9809845,9809845,src/rpcrawtransaction.cpp
lnovy,2014-02-18T07:03:11Z,Read the whole thread.\nThis is a not a serious proposal for inclusion into bitcoind.\nThis is a simple implementation of a proposed standard to verify compatibility.\n,https://github.com/bitcoin/bitcoin/pull/3656#discussion_r9814111,9814111,src/rpcrawtransaction.cpp
