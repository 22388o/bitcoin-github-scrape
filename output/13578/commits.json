[
  {
    "sha": "f1bd03eb013b96ff040a8f835e4137fbd2a38cda",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmMWJkMDNlYjAxM2I5NmZmMDQwYThmODM1ZTQxMzdmYmQyYTM4Y2Rh",
    "commit": {
      "author": {
        "name": "mruddy",
        "email": "6440430+mruddy@users.noreply.github.com",
        "date": "2018-06-30T14:32:33Z"
      },
      "committer": {
        "name": "mruddy",
        "email": "6440430+mruddy@users.noreply.github.com",
        "date": "2018-09-11T20:33:05Z"
      },
      "message": "[depends, zmq, doc] upgrade zeromq to 4.2.5 and avoid deprecated zeromq api functions",
      "tree": {
        "sha": "500b8111764fa52b15f75a504214af47a4812ac4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/500b8111764fa52b15f75a504214af47a4812ac4"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f1bd03eb013b96ff040a8f835e4137fbd2a38cda",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f1bd03eb013b96ff040a8f835e4137fbd2a38cda",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/f1bd03eb013b96ff040a8f835e4137fbd2a38cda",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f1bd03eb013b96ff040a8f835e4137fbd2a38cda/comments",
    "author": {
      "login": "mruddy",
      "id": 6440430,
      "node_id": "MDQ6VXNlcjY0NDA0MzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6440430?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mruddy",
      "html_url": "https://github.com/mruddy",
      "followers_url": "https://api.github.com/users/mruddy/followers",
      "following_url": "https://api.github.com/users/mruddy/following{/other_user}",
      "gists_url": "https://api.github.com/users/mruddy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mruddy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mruddy/subscriptions",
      "organizations_url": "https://api.github.com/users/mruddy/orgs",
      "repos_url": "https://api.github.com/users/mruddy/repos",
      "events_url": "https://api.github.com/users/mruddy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mruddy/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "mruddy",
      "id": 6440430,
      "node_id": "MDQ6VXNlcjY0NDA0MzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6440430?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mruddy",
      "html_url": "https://github.com/mruddy",
      "followers_url": "https://api.github.com/users/mruddy/followers",
      "following_url": "https://api.github.com/users/mruddy/following{/other_user}",
      "gists_url": "https://api.github.com/users/mruddy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mruddy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mruddy/subscriptions",
      "organizations_url": "https://api.github.com/users/mruddy/orgs",
      "repos_url": "https://api.github.com/users/mruddy/repos",
      "events_url": "https://api.github.com/users/mruddy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mruddy/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "4103cc31690e5be21854a9628f57c54b880ee195",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4103cc31690e5be21854a9628f57c54b880ee195",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/4103cc31690e5be21854a9628f57c54b880ee195"
      }
    ],
    "stats": {
      "total": 60,
      "additions": 33,
      "deletions": 27
    },
    "files": [
      {
        "sha": "c9068e83a584cc6e8f4cddb1964ce4c4e31134a1",
        "filename": "depends/packages/zeromq.mk",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f1bd03eb013b96ff040a8f835e4137fbd2a38cda/depends/packages/zeromq.mk",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f1bd03eb013b96ff040a8f835e4137fbd2a38cda/depends/packages/zeromq.mk",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/depends/packages/zeromq.mk?ref=f1bd03eb013b96ff040a8f835e4137fbd2a38cda",
        "patch": "@@ -1,8 +1,8 @@\n package=zeromq\n-$(package)_version=4.2.3\n+$(package)_version=4.2.5\n $(package)_download_path=https://github.com/zeromq/libzmq/releases/download/v$($(package)_version)/\n $(package)_file_name=$(package)-$($(package)_version).tar.gz\n-$(package)_sha256_hash=8f1e2b2aade4dbfde98d82366d61baef2f62e812530160d2e6d0a5bb24e40bc0\n+$(package)_sha256_hash=cc9090ba35713d59bb2f7d7965f877036c49c5558ea0c290b0dcc6f2a17e489f\n $(package)_patches=0001-fix-build-with-older-mingw64.patch 0002-disable-pthread_set_name_np.patch\n \n define $(package)_set_vars"
      },
      {
        "sha": "b911ac56724b193f84d0cbdbf0bf0f8d92e0bab6",
        "filename": "depends/patches/zeromq/0001-fix-build-with-older-mingw64.patch",
        "status": "modified",
        "additions": 8,
        "deletions": 8,
        "changes": 16,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f1bd03eb013b96ff040a8f835e4137fbd2a38cda/depends/patches/zeromq/0001-fix-build-with-older-mingw64.patch",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f1bd03eb013b96ff040a8f835e4137fbd2a38cda/depends/patches/zeromq/0001-fix-build-with-older-mingw64.patch",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/depends/patches/zeromq/0001-fix-build-with-older-mingw64.patch?ref=f1bd03eb013b96ff040a8f835e4137fbd2a38cda",
        "patch": "@@ -1,17 +1,17 @@\n-From 1a159c128c69a42d90819375c06a39994f3fbfc1 Mon Sep 17 00:00:00 2001\n-From: Cory Fields <cory-nospam-@coryfields.com>\n-Date: Tue, 28 Nov 2017 20:33:25 -0500\n+From f6866b0f166ad168618aae64c7fbee8775d3eb23 Mon Sep 17 00:00:00 2001\n+From: mruddy <6440430+mruddy@users.noreply.github.com>\n+Date: Sat, 30 Jun 2018 09:44:58 -0400\n Subject: [PATCH] fix build with older mingw64\n \n ---\n  src/windows.hpp | 7 +++++++\n  1 file changed, 7 insertions(+)\n \n diff --git a/src/windows.hpp b/src/windows.hpp\n-index 99e889d..e69038e 100644\n+index 6c3839fd..2c32ec79 100644\n --- a/src/windows.hpp\n +++ b/src/windows.hpp\n-@@ -55,6 +55,13 @@\n+@@ -58,6 +58,13 @@\n  #include <winsock2.h>\n  #include <windows.h>\n  #include <mswsock.h>\n@@ -23,8 +23,8 @@ index 99e889d..e69038e 100644\n +#include <ws2ipdef.h>\n +#endif\n  #include <iphlpapi.h>\n-\n+ \n  #if !defined __MINGW32__\n---\n-2.7.4\n+-- \n+2.17.1\n "
      },
      {
        "sha": "022e311977e794df924bd5da8f667356fff9a8fb",
        "filename": "depends/patches/zeromq/0002-disable-pthread_set_name_np.patch",
        "status": "modified",
        "additions": 10,
        "deletions": 10,
        "changes": 20,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f1bd03eb013b96ff040a8f835e4137fbd2a38cda/depends/patches/zeromq/0002-disable-pthread_set_name_np.patch",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f1bd03eb013b96ff040a8f835e4137fbd2a38cda/depends/patches/zeromq/0002-disable-pthread_set_name_np.patch",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/depends/patches/zeromq/0002-disable-pthread_set_name_np.patch?ref=f1bd03eb013b96ff040a8f835e4137fbd2a38cda",
        "patch": "@@ -1,6 +1,6 @@\n-From 6e6b47d5ab381c3df3b30bb0b0a6cf210dfb1eba Mon Sep 17 00:00:00 2001\n-From: Cory Fields <cory-nospam-@coryfields.com>\n-Date: Mon, 5 Mar 2018 14:22:05 -0500\n+From c9bbdd6581d07acfe8971e4bcebe278a3676cf03 Mon Sep 17 00:00:00 2001\n+From: mruddy <6440430+mruddy@users.noreply.github.com>\n+Date: Sat, 30 Jun 2018 09:57:18 -0400\n Subject: [PATCH] disable pthread_set_name_np\n \n pthread_set_name_np adds a Glibc requirement on >= 2.12.\n@@ -9,27 +9,27 @@ pthread_set_name_np adds a Glibc requirement on >= 2.12.\n  1 file changed, 3 insertions(+), 1 deletion(-)\n \n diff --git a/src/thread.cpp b/src/thread.cpp\n-index 4fc59c3e..c3fdfd46 100644\n+index a1086b0c..9943f354 100644\n --- a/src/thread.cpp\n +++ b/src/thread.cpp\n-@@ -220,7 +220,7 @@ void zmq::thread_t::setThreadName(const char *name_)\n+@@ -307,7 +307,7 @@ void zmq::thread_t::setThreadName (const char *name_)\n   */\n      if (!name_)\n          return;\n -\n +#if 0\n  #if defined(ZMQ_HAVE_PTHREAD_SETNAME_1)\n-     int rc = pthread_setname_np(name_);\n-     if(rc) return;\n-@@ -233,6 +233,8 @@ void zmq::thread_t::setThreadName(const char *name_)\n+     int rc = pthread_setname_np (name_);\n+     if (rc)\n+@@ -323,6 +323,8 @@ void zmq::thread_t::setThreadName (const char *name_)\n  #elif defined(ZMQ_HAVE_PTHREAD_SET_NAME)\n-     pthread_set_name_np(descriptor, name_);\n+     pthread_set_name_np (descriptor, name_);\n  #endif\n +#endif\n +    return;\n  }\n  \n  #endif\n -- \n-2.11.1\n+2.17.1\n "
      },
      {
        "sha": "dfeb8ba2601459d23d0e0a6f75a54f60f6edcc03",
        "filename": "doc/build-unix.md",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f1bd03eb013b96ff040a8f835e4137fbd2a38cda/doc/build-unix.md",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f1bd03eb013b96ff040a8f835e4137fbd2a38cda/doc/build-unix.md",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/doc/build-unix.md?ref=f1bd03eb013b96ff040a8f835e4137fbd2a38cda",
        "patch": "@@ -47,7 +47,7 @@ Optional dependencies:\n  protobuf    | Payments in GUI  | Data interchange format used for payment protocol (only needed when GUI enabled)\n  libqrencode | QR codes in GUI  | Optional for generating QR codes (only needed when GUI enabled)\n  univalue    | Utility          | JSON parsing and encoding (bundled version will be used unless --with-system-univalue passed to configure)\n- libzmq3     | ZMQ notification | Optional, allows generating ZMQ notifications (requires ZMQ version >= 4.x)\n+ libzmq3     | ZMQ notification | Optional, allows generating ZMQ notifications (requires ZMQ version >= 4.0.0)\n \n For the versions used, see [dependencies.md](dependencies.md)\n \n@@ -93,7 +93,7 @@ Optional (see --with-miniupnpc and --enable-upnp-default):\n \n     sudo apt-get install libminiupnpc-dev\n \n-ZMQ dependencies (provides ZMQ API 4.x):\n+ZMQ dependencies (provides ZMQ API):\n \n     sudo apt-get install libzmq3-dev\n "
      },
      {
        "sha": "d777aaf66fdb7877c55dff1a656fcd8d2478cc8b",
        "filename": "doc/dependencies.md",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f1bd03eb013b96ff040a8f835e4137fbd2a38cda/doc/dependencies.md",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f1bd03eb013b96ff040a8f835e4137fbd2a38cda/doc/dependencies.md",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/doc/dependencies.md?ref=f1bd03eb013b96ff040a8f835e4137fbd2a38cda",
        "patch": "@@ -26,5 +26,5 @@ These are the dependencies currently used by Bitcoin Core. You can find instruct\n | Qt | [5.9.6](https://download.qt.io/official_releases/qt/) | 5.x | No |  |  |\n | XCB |  |  |  |  | [Yes](https://github.com/bitcoin/bitcoin/blob/master/depends/packages/qt.mk#L87) (Linux only) |\n | xkbcommon |  |  |  |  | [Yes](https://github.com/bitcoin/bitcoin/blob/master/depends/packages/qt.mk#L86) (Linux only) |\n-| ZeroMQ | [4.2.3](https://github.com/zeromq/libzmq/releases) |  | No |  |  |\n+| ZeroMQ | [4.2.5](https://github.com/zeromq/libzmq/releases) | 4.0.0 | No |  |  |\n | zlib | [1.2.11](https://zlib.net/) |  |  |  | No |"
      },
      {
        "sha": "a1a506f2e74f78199f6399df2b97c567a0d30ce5",
        "filename": "doc/zmq.md",
        "status": "modified",
        "additions": 4,
        "deletions": 2,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f1bd03eb013b96ff040a8f835e4137fbd2a38cda/doc/zmq.md",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f1bd03eb013b96ff040a8f835e4137fbd2a38cda/doc/zmq.md",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/doc/zmq.md?ref=f1bd03eb013b96ff040a8f835e4137fbd2a38cda",
        "patch": "@@ -33,8 +33,10 @@ buffering or reassembly.\n \n ## Prerequisites\n \n-The ZeroMQ feature in Bitcoin Core requires ZeroMQ API version 4.x or\n-newer. Typically, it is packaged by distributions as something like\n+The ZeroMQ feature in Bitcoin Core requires the ZeroMQ API >= 4.0.0\n+[libzmq](https://github.com/zeromq/libzmq/releases).\n+For version information, see [dependencies.md](dependencies.md).\n+Typically, it is packaged by distributions as something like\n *libzmq3-dev*. The C++ wrapper for ZeroMQ is *not* needed.\n \n In order to run the example Python client scripts in contrib/ one must"
      },
      {
        "sha": "1d9f86d450851b693fcdb8e3257d54810ecb2f0e",
        "filename": "src/zmq/zmqnotificationinterface.cpp",
        "status": "modified",
        "additions": 6,
        "deletions": 2,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f1bd03eb013b96ff040a8f835e4137fbd2a38cda/src/zmq/zmqnotificationinterface.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f1bd03eb013b96ff040a8f835e4137fbd2a38cda/src/zmq/zmqnotificationinterface.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/zmq/zmqnotificationinterface.cpp?ref=f1bd03eb013b96ff040a8f835e4137fbd2a38cda",
        "patch": "@@ -81,10 +81,14 @@ CZMQNotificationInterface* CZMQNotificationInterface::Create()\n // Called at startup to conditionally set up ZMQ socket(s)\n bool CZMQNotificationInterface::Initialize()\n {\n+    int major = 0, minor = 0, patch = 0;\n+    zmq_version(&major, &minor, &patch);\n+    LogPrint(BCLog::ZMQ, \"zmq: version %d.%d.%d\\n\", major, minor, patch);\n+\n     LogPrint(BCLog::ZMQ, \"zmq: Initialize notification interface\\n\");\n     assert(!pcontext);\n \n-    pcontext = zmq_init(1);\n+    pcontext = zmq_ctx_new();\n \n     if (!pcontext)\n     {\n@@ -127,7 +131,7 @@ void CZMQNotificationInterface::Shutdown()\n             LogPrint(BCLog::ZMQ, \"   Shutdown notifier %s at %s\\n\", notifier->GetType(), notifier->GetAddress());\n             notifier->Shutdown();\n         }\n-        zmq_ctx_destroy(pcontext);\n+        zmq_ctx_term(pcontext);\n \n         pcontext = nullptr;\n     }"
      }
    ]
  }
]