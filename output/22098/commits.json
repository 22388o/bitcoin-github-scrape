[
  {
    "sha": "9c0871977839c28636eff975748182888299cd2b",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5YzA4NzE5Nzc4MzljMjg2MzZlZmY5NzU3NDgxODI4ODgyOTljZDJi",
    "commit": {
      "author": {
        "name": "Amiti Uttarwar",
        "email": "amiti@uttarwar.org",
        "date": "2021-05-28T20:45:15Z"
      },
      "committer": {
        "name": "Amiti Uttarwar",
        "email": "amiti@uttarwar.org",
        "date": "2021-07-30T18:15:49Z"
      },
      "message": "[test] Introduce test logic to query DNS seeds\n\nThis commit introduces a DNS seed to the regest chain params in order to add\ncoverage to the DNS querying logic.\n\nThe first test checks that we do not query DNS seeds if we are able to\nsuccesfully connect to 2 outbound connections. Since we participate in ADDR\nrelay with those connections, including sending a GETADDR message during the\nVERSION handshake, querying the DNS seeds is unnecessary.\n\nCo-authored-by: Martin Zumsande <mzumsande@gmail.com>",
      "tree": {
        "sha": "6a8989104239d81481cff27830332e0eb9298a69",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6a8989104239d81481cff27830332e0eb9298a69"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9c0871977839c28636eff975748182888299cd2b",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9c0871977839c28636eff975748182888299cd2b",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/9c0871977839c28636eff975748182888299cd2b",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9c0871977839c28636eff975748182888299cd2b/comments",
    "author": {
      "login": "amitiuttarwar",
      "id": 1500952,
      "node_id": "MDQ6VXNlcjE1MDA5NTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/amitiuttarwar",
      "html_url": "https://github.com/amitiuttarwar",
      "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
      "following_url": "https://api.github.com/users/amitiuttarwar/following{/other_user}",
      "gists_url": "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
      "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
      "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
      "events_url": "https://api.github.com/users/amitiuttarwar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "amitiuttarwar",
      "id": 1500952,
      "node_id": "MDQ6VXNlcjE1MDA5NTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/amitiuttarwar",
      "html_url": "https://github.com/amitiuttarwar",
      "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
      "following_url": "https://api.github.com/users/amitiuttarwar/following{/other_user}",
      "gists_url": "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
      "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
      "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
      "events_url": "https://api.github.com/users/amitiuttarwar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "b295395664bd37e26d168c329f238237b34aef8c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b295395664bd37e26d168c329f238237b34aef8c",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/b295395664bd37e26d168c329f238237b34aef8c"
      }
    ],
    "stats": {
      "total": 43,
      "additions": 40,
      "deletions": 3
    },
    "files": [
      {
        "sha": "4f1ff1d51210113ae3c7155a19d0dd1c3d10e7c3",
        "filename": "src/chainparams.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9c0871977839c28636eff975748182888299cd2b/src/chainparams.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9c0871977839c28636eff975748182888299cd2b/src/chainparams.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/chainparams.cpp?ref=9c0871977839c28636eff975748182888299cd2b",
        "patch": "@@ -435,7 +435,8 @@ class CRegTestParams : public CChainParams {\n         assert(genesis.hashMerkleRoot == uint256S(\"0x4a5e1e4baab89f3a32518a88c31bc87f618f76673e2cc77ab2127b7afdeda33b\"));\n \n         vFixedSeeds.clear(); //!< Regtest mode doesn't have any fixed seeds.\n-        vSeeds.clear();      //!< Regtest mode doesn't have any DNS seeds.\n+        vSeeds.clear();\n+        vSeeds.emplace_back(\"dummySeed.invalid.\");\n \n         fDefaultConsistencyChecks = true;\n         fRequireStandard = true;"
      },
      {
        "sha": "07b74e65de4190b5f06cdfdb0635401c1a3d20ce",
        "filename": "test/functional/feature_config_args.py",
        "status": "modified",
        "additions": 3,
        "deletions": 2,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9c0871977839c28636eff975748182888299cd2b/test/functional/feature_config_args.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9c0871977839c28636eff975748182888299cd2b/test/functional/feature_config_args.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/feature_config_args.py?ref=9c0871977839c28636eff975748182888299cd2b",
        "patch": "@@ -158,8 +158,9 @@ def test_seed_peers(self):\n         self.stop_node(0)\n \n         # No peers.dat exists and -dnsseed=1\n-        # We expect the node will use DNS Seeds, but Regtest mode has 0 DNS seeds\n-        # So after 60 seconds, the node should fallback to fixed seeds (this is a slow test)\n+        # We expect the node will use DNS Seeds, but Regtest mode does not have\n+        # any valid DNS seeds. So after 60 seconds, the node should fallback to\n+        # fixed seeds\n         assert not os.path.exists(os.path.join(default_data_dir, \"peers.dat\"))\n         start = int(time.time())\n         with self.nodes[0].assert_debug_log(expected_msgs=["
      },
      {
        "sha": "254f9af445873ccb11e831241364a634a8ba6fe3",
        "filename": "test/functional/p2p_dns_seeds.py",
        "status": "added",
        "additions": 34,
        "deletions": 0,
        "changes": 34,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9c0871977839c28636eff975748182888299cd2b/test/functional/p2p_dns_seeds.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9c0871977839c28636eff975748182888299cd2b/test/functional/p2p_dns_seeds.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/p2p_dns_seeds.py?ref=9c0871977839c28636eff975748182888299cd2b",
        "patch": "@@ -0,0 +1,34 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test ThreadDNSAddressSeed logic for querying DNS seeds.\"\"\"\n+\n+from test_framework.p2p import P2PInterface\n+from test_framework.test_framework import BitcoinTestFramework\n+\n+\n+class P2PDNSSeeds(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+        self.extra_args = [[\"-dnsseed=1\"]]\n+\n+    def run_test(self):\n+        self.existing_outbound_connections_test()\n+\n+    def existing_outbound_connections_test(self):\n+        # Make sure addrman is populated to enter the conditional where we\n+        # delay and potentially skip DNS seeding.\n+        self.nodes[0].addpeeraddress(\"192.0.0.8\", 8333)\n+\n+        self.log.info(\"Check that we *do not* query DNS seeds if we have 2 outbound connections\")\n+\n+        self.restart_node(0)\n+        with self.nodes[0].assert_debug_log(expected_msgs=[\"P2P peers available. Skipped DNS seeding.\"], timeout=12):\n+            for i in range(2):\n+                self.nodes[0].add_outbound_p2p_connection(P2PInterface(), p2p_idx=i, connection_type=\"outbound-full-relay\")\n+\n+\n+if __name__ == '__main__':\n+    P2PDNSSeeds().main()"
      },
      {
        "sha": "1a59cfc755062c358e79abb19111c4b90cee8afc",
        "filename": "test/functional/test_runner.py",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9c0871977839c28636eff975748182888299cd2b/test/functional/test_runner.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9c0871977839c28636eff975748182888299cd2b/test/functional/test_runner.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/test_runner.py?ref=9c0871977839c28636eff975748182888299cd2b",
        "patch": "@@ -121,6 +121,7 @@\n     'wallet_listreceivedby.py --legacy-wallet',\n     'wallet_listreceivedby.py --descriptors',\n     'wallet_abandonconflict.py --legacy-wallet',\n+    'p2p_dns_seeds.py',\n     'wallet_abandonconflict.py --descriptors',\n     'feature_csv_activation.py',\n     'rpc_rawtransaction.py --legacy-wallet',"
      }
    ]
  },
  {
    "sha": "75c05af361552eeecd100cee8cc40d4cd5a3aa27",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo3NWMwNWFmMzYxNTUyZWVlY2QxMDBjZWU4Y2M0MGQ0Y2Q1YTNhYTI3",
    "commit": {
      "author": {
        "name": "Amiti Uttarwar",
        "email": "amiti@uttarwar.org",
        "date": "2021-05-28T20:49:29Z"
      },
      "committer": {
        "name": "Amiti Uttarwar",
        "email": "amiti@uttarwar.org",
        "date": "2021-07-30T18:15:49Z"
      },
      "message": "[test] Test logic to query DNS seeds with block-relay-only connections\n\nWhen a node is able to properly shutdown, it will persist its block-relay-only\nconnections to the addrman. On startup, it will attempt to reconnect to these\nanchors. Since block-relay-only connections do not participate in ADDR relay,\nsuccesful connections are insufficient to skip querying the DNS seeds.\n\nThis test fails prior to the changes in #22013.\n\nCo-authored-by: Martin Zumsande <mzumsande@gmail.com>",
      "tree": {
        "sha": "c13807384da0378eb2f928a3f741fdf5d29e9c26",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c13807384da0378eb2f928a3f741fdf5d29e9c26"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/75c05af361552eeecd100cee8cc40d4cd5a3aa27",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/75c05af361552eeecd100cee8cc40d4cd5a3aa27",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/75c05af361552eeecd100cee8cc40d4cd5a3aa27",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/75c05af361552eeecd100cee8cc40d4cd5a3aa27/comments",
    "author": {
      "login": "amitiuttarwar",
      "id": 1500952,
      "node_id": "MDQ6VXNlcjE1MDA5NTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/amitiuttarwar",
      "html_url": "https://github.com/amitiuttarwar",
      "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
      "following_url": "https://api.github.com/users/amitiuttarwar/following{/other_user}",
      "gists_url": "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
      "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
      "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
      "events_url": "https://api.github.com/users/amitiuttarwar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "amitiuttarwar",
      "id": 1500952,
      "node_id": "MDQ6VXNlcjE1MDA5NTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/amitiuttarwar",
      "html_url": "https://github.com/amitiuttarwar",
      "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
      "following_url": "https://api.github.com/users/amitiuttarwar/following{/other_user}",
      "gists_url": "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
      "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
      "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
      "events_url": "https://api.github.com/users/amitiuttarwar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "9c0871977839c28636eff975748182888299cd2b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9c0871977839c28636eff975748182888299cd2b",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/9c0871977839c28636eff975748182888299cd2b"
      }
    ],
    "stats": {
      "total": 18,
      "additions": 18,
      "deletions": 0
    },
    "files": [
      {
        "sha": "b58607a5c9b9878dc80e93d10f521b7ef009226a",
        "filename": "test/functional/p2p_dns_seeds.py",
        "status": "modified",
        "additions": 18,
        "deletions": 0,
        "changes": 18,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/75c05af361552eeecd100cee8cc40d4cd5a3aa27/test/functional/p2p_dns_seeds.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/75c05af361552eeecd100cee8cc40d4cd5a3aa27/test/functional/p2p_dns_seeds.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/p2p_dns_seeds.py?ref=75c05af361552eeecd100cee8cc40d4cd5a3aa27",
        "patch": "@@ -16,6 +16,7 @@ def set_test_params(self):\n \n     def run_test(self):\n         self.existing_outbound_connections_test()\n+        self.existing_block_relay_connections_test()\n \n     def existing_outbound_connections_test(self):\n         # Make sure addrman is populated to enter the conditional where we\n@@ -29,6 +30,23 @@ def existing_outbound_connections_test(self):\n             for i in range(2):\n                 self.nodes[0].add_outbound_p2p_connection(P2PInterface(), p2p_idx=i, connection_type=\"outbound-full-relay\")\n \n+    def existing_block_relay_connections_test(self):\n+        # Make sure addrman is populated to enter the conditional where we\n+        # delay and potentially skip DNS seeding. No-op when run after\n+        # existing_outbound_connections_test.\n+        self.nodes[0].addpeeraddress(\"192.0.0.8\", 8333)\n+\n+        self.log.info(\"Check that we *do* query DNS seeds if we only have 2 block-relay-only connections\")\n+\n+        self.restart_node(0)\n+        with self.nodes[0].assert_debug_log(expected_msgs=[\"Loading addresses from DNS seed\"], timeout=12):\n+            # This mimics the \"anchors\" logic where nodes are likely to\n+            # reconnect to block-relay-only connections on startup.\n+            # Since we do not participate in addr relay with these connections,\n+            # we still want to query the DNS seeds.\n+            for i in range(2):\n+                self.nodes[0].add_outbound_p2p_connection(P2PInterface(), p2p_idx=i, connection_type=\"block-relay-only\")\n+\n \n if __name__ == '__main__':\n     P2PDNSSeeds().main()"
      }
    ]
  },
  {
    "sha": "35851450a928ffacca240fadbf1747a42d5ba256",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozNTg1MTQ1MGE5MjhmZmFjY2EyNDBmYWRiZjE3NDdhNDJkNWJhMjU2",
    "commit": {
      "author": {
        "name": "Amiti Uttarwar",
        "email": "amiti@uttarwar.org",
        "date": "2021-05-24T22:56:32Z"
      },
      "committer": {
        "name": "Amiti Uttarwar",
        "email": "amiti@uttarwar.org",
        "date": "2021-07-30T18:15:49Z"
      },
      "message": "[test] Test the interactions between -connect and -dnsseed",
      "tree": {
        "sha": "68b404cca8d717f6afed4ac1922b5b5fcef5f718",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/68b404cca8d717f6afed4ac1922b5b5fcef5f718"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/35851450a928ffacca240fadbf1747a42d5ba256",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/35851450a928ffacca240fadbf1747a42d5ba256",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/35851450a928ffacca240fadbf1747a42d5ba256",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/35851450a928ffacca240fadbf1747a42d5ba256/comments",
    "author": {
      "login": "amitiuttarwar",
      "id": 1500952,
      "node_id": "MDQ6VXNlcjE1MDA5NTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/amitiuttarwar",
      "html_url": "https://github.com/amitiuttarwar",
      "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
      "following_url": "https://api.github.com/users/amitiuttarwar/following{/other_user}",
      "gists_url": "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
      "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
      "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
      "events_url": "https://api.github.com/users/amitiuttarwar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "amitiuttarwar",
      "id": 1500952,
      "node_id": "MDQ6VXNlcjE1MDA5NTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/amitiuttarwar",
      "html_url": "https://github.com/amitiuttarwar",
      "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
      "following_url": "https://api.github.com/users/amitiuttarwar/following{/other_user}",
      "gists_url": "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
      "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
      "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
      "events_url": "https://api.github.com/users/amitiuttarwar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "75c05af361552eeecd100cee8cc40d4cd5a3aa27",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/75c05af361552eeecd100cee8cc40d4cd5a3aa27",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/75c05af361552eeecd100cee8cc40d4cd5a3aa27"
      }
    ],
    "stats": {
      "total": 13,
      "additions": 13,
      "deletions": 0
    },
    "files": [
      {
        "sha": "213741f3a8a52f75381ee732bd380f073e4116ed",
        "filename": "test/functional/p2p_dns_seeds.py",
        "status": "modified",
        "additions": 13,
        "deletions": 0,
        "changes": 13,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/35851450a928ffacca240fadbf1747a42d5ba256/test/functional/p2p_dns_seeds.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/35851450a928ffacca240fadbf1747a42d5ba256/test/functional/p2p_dns_seeds.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/p2p_dns_seeds.py?ref=35851450a928ffacca240fadbf1747a42d5ba256",
        "patch": "@@ -15,9 +15,22 @@ def set_test_params(self):\n         self.extra_args = [[\"-dnsseed=1\"]]\n \n     def run_test(self):\n+        self.init_arg_tests()\n         self.existing_outbound_connections_test()\n         self.existing_block_relay_connections_test()\n \n+    def init_arg_tests(self):\n+        fakeaddr = \"fakenodeaddr.fakedomain.invalid.\"\n+\n+        self.log.info(\"Check that setting -connect disables -dnsseed by default\")\n+        self.nodes[0].stop_node()\n+        with self.nodes[0].assert_debug_log(expected_msgs=[\"DNS seeding disabled\"]):\n+            self.start_node(0, [f\"-connect={fakeaddr}\"])\n+\n+        self.log.info(\"Check that running -connect and -dnsseed means DNS logic runs.\")\n+        with self.nodes[0].assert_debug_log(expected_msgs=[\"Loading addresses from DNS seed\"], timeout=12):\n+            self.restart_node(0, [f\"-connect={fakeaddr}\", \"-dnsseed=1\"])\n+\n     def existing_outbound_connections_test(self):\n         # Make sure addrman is populated to enter the conditional where we\n         # delay and potentially skip DNS seeding."
      }
    ]
  },
  {
    "sha": "26d0ffe4f2573e0297c9b0e095c2a0868929b08b",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyNmQwZmZlNGYyNTczZTAyOTdjOWIwZTA5NWMyYTA4Njg5MjliMDhi",
    "commit": {
      "author": {
        "name": "Amiti Uttarwar",
        "email": "amiti@uttarwar.org",
        "date": "2021-05-25T00:08:54Z"
      },
      "committer": {
        "name": "Amiti Uttarwar",
        "email": "amiti@uttarwar.org",
        "date": "2021-07-30T18:15:49Z"
      },
      "message": "[test] Test -forcednsseed causes querying DNS seeds",
      "tree": {
        "sha": "a2de6f3fcaa1f0e210987b206ee6281368cde509",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a2de6f3fcaa1f0e210987b206ee6281368cde509"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/26d0ffe4f2573e0297c9b0e095c2a0868929b08b",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/26d0ffe4f2573e0297c9b0e095c2a0868929b08b",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/26d0ffe4f2573e0297c9b0e095c2a0868929b08b",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/26d0ffe4f2573e0297c9b0e095c2a0868929b08b/comments",
    "author": {
      "login": "amitiuttarwar",
      "id": 1500952,
      "node_id": "MDQ6VXNlcjE1MDA5NTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/amitiuttarwar",
      "html_url": "https://github.com/amitiuttarwar",
      "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
      "following_url": "https://api.github.com/users/amitiuttarwar/following{/other_user}",
      "gists_url": "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
      "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
      "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
      "events_url": "https://api.github.com/users/amitiuttarwar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "amitiuttarwar",
      "id": 1500952,
      "node_id": "MDQ6VXNlcjE1MDA5NTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/amitiuttarwar",
      "html_url": "https://github.com/amitiuttarwar",
      "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
      "following_url": "https://api.github.com/users/amitiuttarwar/following{/other_user}",
      "gists_url": "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
      "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
      "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
      "events_url": "https://api.github.com/users/amitiuttarwar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "35851450a928ffacca240fadbf1747a42d5ba256",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/35851450a928ffacca240fadbf1747a42d5ba256",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/35851450a928ffacca240fadbf1747a42d5ba256"
      }
    ],
    "stats": {
      "total": 12,
      "additions": 12,
      "deletions": 0
    },
    "files": [
      {
        "sha": "4714de64dc8d014f620b1d177d5a96461ad9f038",
        "filename": "test/functional/p2p_dns_seeds.py",
        "status": "modified",
        "additions": 12,
        "deletions": 0,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/26d0ffe4f2573e0297c9b0e095c2a0868929b08b/test/functional/p2p_dns_seeds.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/26d0ffe4f2573e0297c9b0e095c2a0868929b08b/test/functional/p2p_dns_seeds.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/p2p_dns_seeds.py?ref=26d0ffe4f2573e0297c9b0e095c2a0868929b08b",
        "patch": "@@ -18,6 +18,7 @@ def run_test(self):\n         self.init_arg_tests()\n         self.existing_outbound_connections_test()\n         self.existing_block_relay_connections_test()\n+        self.force_dns_test()\n \n     def init_arg_tests(self):\n         fakeaddr = \"fakenodeaddr.fakedomain.invalid.\"\n@@ -60,6 +61,17 @@ def existing_block_relay_connections_test(self):\n             for i in range(2):\n                 self.nodes[0].add_outbound_p2p_connection(P2PInterface(), p2p_idx=i, connection_type=\"block-relay-only\")\n \n+    def force_dns_test(self):\n+        self.log.info(\"Check that we query DNS seeds if -forcednsseed param is set\")\n+\n+        with self.nodes[0].assert_debug_log(expected_msgs=[\"Loading addresses from DNS seed\"], timeout=12):\n+            # -dnsseed defaults to 1 in bitcoind, but 0 in the test framework,\n+            # so pass it explicitly here\n+            self.restart_node(0, [\"-forcednsseed\", \"-dnsseed=1\"])\n+\n+        # Restore default for subsequent tests\n+        self.restart_node(0)\n+\n \n if __name__ == '__main__':\n     P2PDNSSeeds().main()"
      }
    ]
  },
  {
    "sha": "6f6b7df6bdcf863af160c0426e3a22028ca8259a",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo2ZjZiN2RmNmJkY2Y4NjNhZjE2MGMwNDI2ZTNhMjIwMjhjYTgyNTlh",
    "commit": {
      "author": {
        "name": "Amiti Uttarwar",
        "email": "amiti@uttarwar.org",
        "date": "2021-05-28T20:30:35Z"
      },
      "committer": {
        "name": "Amiti Uttarwar",
        "email": "amiti@uttarwar.org",
        "date": "2021-07-30T18:15:49Z"
      },
      "message": "[init] Disallow starting up with conflicting paramters for -dnsseed and -forcednsseed\n\n-dnsseed determines whether we run ThreadDNSAddressSeed and potentially query\nthe DNS seeds for addresses. -forcednsseed tells the node to force querying the\nDNS seeds even if we have sufficient addresses or current connections.\n\nThis commit disallows starting up with explicitly conflicting parameters.",
      "tree": {
        "sha": "b37422b9a29a290aa5acce6ecb16f353fc32e827",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b37422b9a29a290aa5acce6ecb16f353fc32e827"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6f6b7df6bdcf863af160c0426e3a22028ca8259a",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6f6b7df6bdcf863af160c0426e3a22028ca8259a",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/6f6b7df6bdcf863af160c0426e3a22028ca8259a",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6f6b7df6bdcf863af160c0426e3a22028ca8259a/comments",
    "author": {
      "login": "amitiuttarwar",
      "id": 1500952,
      "node_id": "MDQ6VXNlcjE1MDA5NTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/amitiuttarwar",
      "html_url": "https://github.com/amitiuttarwar",
      "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
      "following_url": "https://api.github.com/users/amitiuttarwar/following{/other_user}",
      "gists_url": "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
      "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
      "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
      "events_url": "https://api.github.com/users/amitiuttarwar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "amitiuttarwar",
      "id": 1500952,
      "node_id": "MDQ6VXNlcjE1MDA5NTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/amitiuttarwar",
      "html_url": "https://github.com/amitiuttarwar",
      "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
      "following_url": "https://api.github.com/users/amitiuttarwar/following{/other_user}",
      "gists_url": "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
      "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
      "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
      "events_url": "https://api.github.com/users/amitiuttarwar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "26d0ffe4f2573e0297c9b0e095c2a0868929b08b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/26d0ffe4f2573e0297c9b0e095c2a0868929b08b",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/26d0ffe4f2573e0297c9b0e095c2a0868929b08b"
      }
    ],
    "stats": {
      "total": 5,
      "additions": 5,
      "deletions": 0
    },
    "files": [
      {
        "sha": "11a87dd4417ef3946763cc83d58a3ebb49ba3115",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 0,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6f6b7df6bdcf863af160c0426e3a22028ca8259a/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6f6b7df6bdcf863af160c0426e3a22028ca8259a/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=6f6b7df6bdcf863af160c0426e3a22028ca8259a",
        "patch": "@@ -853,6 +853,11 @@ bool AppInitParameterInteraction(const ArgsManager& args)\n             return InitError(_(\"Prune mode is incompatible with -coinstatsindex.\"));\n     }\n \n+    // If -forcednsseed is set to true, ensure -dnsseed has not been set to false\n+    if (args.GetBoolArg(\"-forcednsseed\", DEFAULT_FORCEDNSSEED) && !args.GetBoolArg(\"-dnsseed\", DEFAULT_DNSSEED)){\n+        return InitError(_(\"Cannot set -forcednsseed to true when setting -dnsseed to false.\"));\n+    }\n+\n     // -bind and -whitebind can't be set when not listening\n     size_t nUserBind = args.GetArgs(\"-bind\").size() + args.GetArgs(\"-whitebind\").size();\n     if (nUserBind != 0 && !args.GetBoolArg(\"-listen\", DEFAULT_LISTEN)) {"
      }
    ]
  },
  {
    "sha": "6395c8ed5689ea72e9a1618f14551775246f6361",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo2Mzk1YzhlZDU2ODllYTcyZTlhMTYxOGYxNDU1MTc3NTI0NmY2MzYx",
    "commit": {
      "author": {
        "name": "Amiti Uttarwar",
        "email": "amiti@uttarwar.org",
        "date": "2021-05-28T20:38:46Z"
      },
      "committer": {
        "name": "Amiti Uttarwar",
        "email": "amiti@uttarwar.org",
        "date": "2021-07-30T18:15:49Z"
      },
      "message": "[test] Test the interactions between -forcednsseed and -dnsseed\n\nTest that passing conflicting parameters for the two causes a startup error.\nThis logic also impacts -connect, which soft sets -dnsseed, so add a test for\nthat too.",
      "tree": {
        "sha": "f8f08b38a17bc51c4abf1c0b5c0c70884d3ba0cf",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f8f08b38a17bc51c4abf1c0b5c0c70884d3ba0cf"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6395c8ed5689ea72e9a1618f14551775246f6361",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6395c8ed5689ea72e9a1618f14551775246f6361",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/6395c8ed5689ea72e9a1618f14551775246f6361",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6395c8ed5689ea72e9a1618f14551775246f6361/comments",
    "author": {
      "login": "amitiuttarwar",
      "id": 1500952,
      "node_id": "MDQ6VXNlcjE1MDA5NTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/amitiuttarwar",
      "html_url": "https://github.com/amitiuttarwar",
      "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
      "following_url": "https://api.github.com/users/amitiuttarwar/following{/other_user}",
      "gists_url": "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
      "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
      "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
      "events_url": "https://api.github.com/users/amitiuttarwar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "amitiuttarwar",
      "id": 1500952,
      "node_id": "MDQ6VXNlcjE1MDA5NTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/amitiuttarwar",
      "html_url": "https://github.com/amitiuttarwar",
      "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
      "following_url": "https://api.github.com/users/amitiuttarwar/following{/other_user}",
      "gists_url": "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
      "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
      "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
      "events_url": "https://api.github.com/users/amitiuttarwar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "6f6b7df6bdcf863af160c0426e3a22028ca8259a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6f6b7df6bdcf863af160c0426e3a22028ca8259a",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/6f6b7df6bdcf863af160c0426e3a22028ca8259a"
      }
    ],
    "stats": {
      "total": 18,
      "additions": 18,
      "deletions": 0
    },
    "files": [
      {
        "sha": "d9977dccee264d9b0289403d9cec173693c37660",
        "filename": "test/functional/p2p_dns_seeds.py",
        "status": "modified",
        "additions": 18,
        "deletions": 0,
        "changes": 18,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6395c8ed5689ea72e9a1618f14551775246f6361/test/functional/p2p_dns_seeds.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6395c8ed5689ea72e9a1618f14551775246f6361/test/functional/p2p_dns_seeds.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/p2p_dns_seeds.py?ref=6395c8ed5689ea72e9a1618f14551775246f6361",
        "patch": "@@ -32,6 +32,24 @@ def init_arg_tests(self):\n         with self.nodes[0].assert_debug_log(expected_msgs=[\"Loading addresses from DNS seed\"], timeout=12):\n             self.restart_node(0, [f\"-connect={fakeaddr}\", \"-dnsseed=1\"])\n \n+        self.log.info(\"Check that running -forcednsseed and -dnsseed=0 throws an error.\")\n+        self.nodes[0].stop_node()\n+        self.nodes[0].assert_start_raises_init_error(\n+            expected_msg=\"Error: Cannot set -forcednsseed to true when setting -dnsseed to false.\",\n+            extra_args=[\"-forcednsseed=1\", \"-dnsseed=0\"],\n+        )\n+\n+        self.log.info(\"Check that running -forcednsseed and -connect throws an error.\")\n+        # -connect soft sets -dnsseed to false, so throws the same error\n+        self.nodes[0].stop_node()\n+        self.nodes[0].assert_start_raises_init_error(\n+            expected_msg=\"Error: Cannot set -forcednsseed to true when setting -dnsseed to false.\",\n+            extra_args=[\"-forcednsseed=1\", f\"-connect={fakeaddr}\"],\n+        )\n+\n+        # Restore default bitcoind settings\n+        self.restart_node(0)\n+\n     def existing_outbound_connections_test(self):\n         # Make sure addrman is populated to enter the conditional where we\n         # delay and potentially skip DNS seeding."
      }
    ]
  },
  {
    "sha": "4c89e24f64c1dc1a56a3bcb6b5e2b4fb95e8b29f",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0Yzg5ZTI0ZjY0YzFkYzFhNTZhM2JjYjZiNWUyYjRmYjk1ZThiMjlm",
    "commit": {
      "author": {
        "name": "Amiti Uttarwar",
        "email": "amiti@uttarwar.org",
        "date": "2021-05-25T00:56:22Z"
      },
      "committer": {
        "name": "Amiti Uttarwar",
        "email": "amiti@uttarwar.org",
        "date": "2021-07-30T18:15:49Z"
      },
      "message": "[test] Test the delay before querying DNS seeds\n\nWhen starting up with a populated addrman, ThreadDNSAddressSeed adds a delay\nduring which time the node may be able to connect to some peers. This commit\ntests the delay changes based on the number of addresses in the addrman.",
      "tree": {
        "sha": "e2ed5e9030ce07f9c32b7fb4ff3b046cb8d0678c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e2ed5e9030ce07f9c32b7fb4ff3b046cb8d0678c"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4c89e24f64c1dc1a56a3bcb6b5e2b4fb95e8b29f",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4c89e24f64c1dc1a56a3bcb6b5e2b4fb95e8b29f",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/4c89e24f64c1dc1a56a3bcb6b5e2b4fb95e8b29f",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4c89e24f64c1dc1a56a3bcb6b5e2b4fb95e8b29f/comments",
    "author": {
      "login": "amitiuttarwar",
      "id": 1500952,
      "node_id": "MDQ6VXNlcjE1MDA5NTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/amitiuttarwar",
      "html_url": "https://github.com/amitiuttarwar",
      "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
      "following_url": "https://api.github.com/users/amitiuttarwar/following{/other_user}",
      "gists_url": "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
      "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
      "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
      "events_url": "https://api.github.com/users/amitiuttarwar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "amitiuttarwar",
      "id": 1500952,
      "node_id": "MDQ6VXNlcjE1MDA5NTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/amitiuttarwar",
      "html_url": "https://github.com/amitiuttarwar",
      "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
      "following_url": "https://api.github.com/users/amitiuttarwar/following{/other_user}",
      "gists_url": "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
      "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
      "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
      "events_url": "https://api.github.com/users/amitiuttarwar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "6395c8ed5689ea72e9a1618f14551775246f6361",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6395c8ed5689ea72e9a1618f14551775246f6361",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/6395c8ed5689ea72e9a1618f14551775246f6361"
      }
    ],
    "stats": {
      "total": 34,
      "additions": 34,
      "deletions": 0
    },
    "files": [
      {
        "sha": "e58ad8e0fc8115dc0bfba43900aad09ed6ab2c77",
        "filename": "test/functional/p2p_dns_seeds.py",
        "status": "modified",
        "additions": 34,
        "deletions": 0,
        "changes": 34,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4c89e24f64c1dc1a56a3bcb6b5e2b4fb95e8b29f/test/functional/p2p_dns_seeds.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4c89e24f64c1dc1a56a3bcb6b5e2b4fb95e8b29f/test/functional/p2p_dns_seeds.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/p2p_dns_seeds.py?ref=4c89e24f64c1dc1a56a3bcb6b5e2b4fb95e8b29f",
        "patch": "@@ -4,6 +4,8 @@\n # file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \"\"\"Test ThreadDNSAddressSeed logic for querying DNS seeds.\"\"\"\n \n+import itertools\n+\n from test_framework.p2p import P2PInterface\n from test_framework.test_framework import BitcoinTestFramework\n \n@@ -19,6 +21,7 @@ def run_test(self):\n         self.existing_outbound_connections_test()\n         self.existing_block_relay_connections_test()\n         self.force_dns_test()\n+        self.wait_time_tests()\n \n     def init_arg_tests(self):\n         fakeaddr = \"fakenodeaddr.fakedomain.invalid.\"\n@@ -90,6 +93,37 @@ def force_dns_test(self):\n         # Restore default for subsequent tests\n         self.restart_node(0)\n \n+    def wait_time_tests(self):\n+        self.log.info(\"Check the delay before querying DNS seeds\")\n+\n+        # Populate addrman with < 1000 addresses\n+        for i in range(5):\n+            a = f\"192.0.0.{i}\"\n+            self.nodes[0].addpeeraddress(a, 8333)\n+\n+        # The delay should be 11 seconds\n+        with self.nodes[0].assert_debug_log(expected_msgs=[\"Waiting 11 seconds before querying DNS seeds.\\n\"]):\n+            self.restart_node(0)\n+\n+        # Populate addrman with > 1000 addresses\n+        for i in itertools.count():\n+            first_octet = i % 2 + 1\n+            second_octet = i % 256\n+            third_octet = i % 100\n+            a = f\"{first_octet}.{second_octet}.{third_octet}.1\"\n+            self.nodes[0].addpeeraddress(a, 8333)\n+            if (i > 1000 and i % 100 == 0):\n+                # The addrman size is non-deterministic because new addresses\n+                # are sorted into buckets, potentially displacing existing\n+                # addresses. Periodically check if we have met the desired\n+                # threshold.\n+                if len(self.nodes[0].getnodeaddresses(0)) > 1000:\n+                    break\n+\n+        # The delay should be 5 mins\n+        with self.nodes[0].assert_debug_log(expected_msgs=[\"Waiting 300 seconds before querying DNS seeds.\\n\"]):\n+            self.restart_node(0)\n+\n \n if __name__ == '__main__':\n     P2PDNSSeeds().main()"
      }
    ]
  },
  {
    "sha": "82b6f89819e55af26f5264678e0f93052934bcb3",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4MmI2Zjg5ODE5ZTU1YWYyNmY1MjY0Njc4ZTBmOTMwNTI5MzRiY2Iz",
    "commit": {
      "author": {
        "name": "Amiti Uttarwar",
        "email": "amiti@uttarwar.org",
        "date": "2021-05-24T19:57:50Z"
      },
      "committer": {
        "name": "Amiti Uttarwar",
        "email": "amiti@uttarwar.org",
        "date": "2021-07-30T18:15:49Z"
      },
      "message": "[style] Small style improvements to DNS parameters",
      "tree": {
        "sha": "b8e681ced7708f3948e38d5828588c8ed35e3a78",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b8e681ced7708f3948e38d5828588c8ed35e3a78"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/82b6f89819e55af26f5264678e0f93052934bcb3",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/82b6f89819e55af26f5264678e0f93052934bcb3",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/82b6f89819e55af26f5264678e0f93052934bcb3",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/82b6f89819e55af26f5264678e0f93052934bcb3/comments",
    "author": {
      "login": "amitiuttarwar",
      "id": 1500952,
      "node_id": "MDQ6VXNlcjE1MDA5NTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/amitiuttarwar",
      "html_url": "https://github.com/amitiuttarwar",
      "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
      "following_url": "https://api.github.com/users/amitiuttarwar/following{/other_user}",
      "gists_url": "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
      "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
      "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
      "events_url": "https://api.github.com/users/amitiuttarwar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "amitiuttarwar",
      "id": 1500952,
      "node_id": "MDQ6VXNlcjE1MDA5NTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/amitiuttarwar",
      "html_url": "https://github.com/amitiuttarwar",
      "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
      "following_url": "https://api.github.com/users/amitiuttarwar/following{/other_user}",
      "gists_url": "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
      "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
      "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
      "events_url": "https://api.github.com/users/amitiuttarwar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "4c89e24f64c1dc1a56a3bcb6b5e2b4fb95e8b29f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4c89e24f64c1dc1a56a3bcb6b5e2b4fb95e8b29f",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/4c89e24f64c1dc1a56a3bcb6b5e2b4fb95e8b29f"
      }
    ],
    "stats": {
      "total": 8,
      "additions": 4,
      "deletions": 4
    },
    "files": [
      {
        "sha": "1cf7dce8f7c9261b537eaf6f6e2a155c98f5baa7",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/82b6f89819e55af26f5264678e0f93052934bcb3/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/82b6f89819e55af26f5264678e0f93052934bcb3/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=82b6f89819e55af26f5264678e0f93052934bcb3",
        "patch": "@@ -431,7 +431,7 @@ void SetupServerArgs(NodeContext& node)\n     argsman.AddArg(\"-dnsseed\", strprintf(\"Query for peer addresses via DNS lookup, if low on addresses (default: %u unless -connect used)\", DEFAULT_DNSSEED), ArgsManager::ALLOW_BOOL, OptionsCategory::CONNECTION);\n     argsman.AddArg(\"-externalip=<ip>\", \"Specify your own public address\", ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n     argsman.AddArg(\"-fixedseeds\", strprintf(\"Allow fixed seeds if DNS seeds don't provide peers (default: %u)\", DEFAULT_FIXEDSEEDS), ArgsManager::ALLOW_BOOL, OptionsCategory::CONNECTION);\n-    argsman.AddArg(\"-forcednsseed\", strprintf(\"Always query for peer addresses via DNS lookup (default: %u)\", DEFAULT_FORCEDNSSEED), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n+    argsman.AddArg(\"-forcednsseed\", strprintf(\"Always query for peer addresses via DNS lookup (default: %u)\", DEFAULT_FORCEDNSSEED), ArgsManager::ALLOW_BOOL, OptionsCategory::CONNECTION);\n     argsman.AddArg(\"-listen\", \"Accept connections from outside (default: 1 if no -proxy or -connect)\", ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n     argsman.AddArg(\"-listenonion\", strprintf(\"Automatically create Tor onion service (default: %d)\", DEFAULT_LISTEN_ONION), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n     argsman.AddArg(\"-maxconnections=<n>\", strprintf(\"Maintain at most <n> connections to peers (default: %u). This limit does not apply to connections manually added via -addnode or the addnode RPC, which have a separate limit of %u.\", DEFAULT_MAX_PEER_CONNECTIONS, MAX_ADDNODE_CONNECTIONS), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);"
      },
      {
        "sha": "bacce326fe0795f2fa546bb31a21792bd9540179",
        "filename": "src/net.h",
        "status": "modified",
        "additions": 3,
        "deletions": 3,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/82b6f89819e55af26f5264678e0f93052934bcb3/src/net.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/82b6f89819e55af26f5264678e0f93052934bcb3/src/net.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.h?ref=82b6f89819e55af26f5264678e0f93052934bcb3",
        "patch": "@@ -79,9 +79,9 @@ static const int64_t DEFAULT_PEER_CONNECT_TIMEOUT = 60;\n /** Number of file descriptors required for message capture **/\n static const int NUM_FDS_MESSAGE_CAPTURE = 1;\n \n-static const bool DEFAULT_FORCEDNSSEED = false;\n-static const bool DEFAULT_DNSSEED = true;\n-static const bool DEFAULT_FIXEDSEEDS = true;\n+static constexpr bool DEFAULT_FORCEDNSSEED{false};\n+static constexpr bool DEFAULT_DNSSEED{true};\n+static constexpr bool DEFAULT_FIXEDSEEDS{true};\n static const size_t DEFAULT_MAXRECEIVEBUFFER = 5 * 1000;\n static const size_t DEFAULT_MAXSENDBUFFER    = 1 * 1000;\n "
      }
    ]
  }
]