[
  {
    "sha": "fa2310572f4cfcd3322409ce7e37dde155fc4bc9",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYTIzMTA1NzJmNGNmY2QzMzIyNDA5Y2U3ZTM3ZGRlMTU1ZmM0YmM5",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2018-03-07T18:49:44Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2018-03-07T20:53:30Z"
      },
      "message": "qa: Cache only chain and wallet for regtest datadir",
      "tree": {
        "sha": "1ae0e3a10976f64be1a2bf8a5f190611f8181b46",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1ae0e3a10976f64be1a2bf8a5f190611f8181b46"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fa2310572f4cfcd3322409ce7e37dde155fc4bc9",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGcBAABCgAGBQJaoFFKAAoJEM4rdWl+aaVIm8gL/1zSWf7uIIPrUQSPo89BqLC9\n37w2bisNaLtRlCdOeTYRMxVMM6L6rmhfuOidgzUtZYqzPwpD9G5POYos+Nt4tdtg\nnum1RhVMXek5zp79cvECmhBn8mHIEaaUavMlMhFAXKnttOIvw3WwH7Ww+lsIEdHw\nRJSgrGExxONtz5SA2NkLS7rnkphZdF1NP5hzw5wAFOerI82su0HX+ExkIvIKeaAk\nG3A6AOeoWMfok0Acm/7A7D8F6SZG1pB1CD6EEcVEpJkmhW/oKyXGJg4bO81Bxkqy\n7WJWM/Vegg9h+BXULhcsjd0FZlVUFSHiC0iSQcakf8sYdkhxS3iQ1DQ+QGDmEBnE\nVPKKXkkedItvlHlIHIL/BuDFE0LhfPd7fxZEaBD2ED6Swa/v51aV976CrSI6Wbxj\nqkxqJSUPWQVHTVvhNs2Rl8Mu50/cB10O8yueZCKqYxLJvuZYYPeI9qzBtYkpMVvB\nt6ho7uc+CFLkQcYdsJo3PwKbQAoirknDgYZ3c/m/SA==\n=zgSY\n-----END PGP SIGNATURE-----",
        "payload": "tree 1ae0e3a10976f64be1a2bf8a5f190611f8181b46\nparent 791c3ea61b4e49fd46a1a71b84ca99ddf69d2ff7\nauthor MarcoFalke <falke.marco@gmail.com> 1520448584 -0500\ncommitter MarcoFalke <falke.marco@gmail.com> 1520456010 -0500\n\nqa: Cache only chain and wallet for regtest datadir\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa2310572f4cfcd3322409ce7e37dde155fc4bc9",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fa2310572f4cfcd3322409ce7e37dde155fc4bc9",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa2310572f4cfcd3322409ce7e37dde155fc4bc9/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "791c3ea61b4e49fd46a1a71b84ca99ddf69d2ff7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/791c3ea61b4e49fd46a1a71b84ca99ddf69d2ff7",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/791c3ea61b4e49fd46a1a71b84ca99ddf69d2ff7"
      }
    ],
    "stats": {
      "total": 26,
      "additions": 13,
      "deletions": 13
    },
    "files": [
      {
        "sha": "f04b3e69d40d9b68fba52d9227edcc8e47547181",
        "filename": "test/functional/test_framework/test_framework.py",
        "status": "modified",
        "additions": 13,
        "deletions": 10,
        "changes": 23,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa2310572f4cfcd3322409ce7e37dde155fc4bc9/test/functional/test_framework/test_framework.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa2310572f4cfcd3322409ce7e37dde155fc4bc9/test/functional/test_framework/test_framework.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/test_framework/test_framework.py?ref=fa2310572f4cfcd3322409ce7e37dde155fc4bc9",
        "patch": "@@ -24,8 +24,8 @@\n     check_json_precision,\n     connect_nodes_bi,\n     disconnect_nodes,\n+    get_datadir_path,\n     initialize_datadir,\n-    log_filename,\n     p2p_port,\n     set_node_times,\n     sync_blocks,\n@@ -382,7 +382,7 @@ def _initialize_chain(self):\n         assert self.num_nodes <= MAX_NODES\n         create_cache = False\n         for i in range(MAX_NODES):\n-            if not os.path.isdir(os.path.join(self.options.cachedir, 'node' + str(i))):\n+            if not os.path.isdir(get_datadir_path(self.options.cachedir, i)):\n                 create_cache = True\n                 break\n \n@@ -391,8 +391,8 @@ def _initialize_chain(self):\n \n             # find and delete old cache directories if any exist\n             for i in range(MAX_NODES):\n-                if os.path.isdir(os.path.join(self.options.cachedir, \"node\" + str(i))):\n-                    shutil.rmtree(os.path.join(self.options.cachedir, \"node\" + str(i)))\n+                if os.path.isdir(get_datadir_path(self.options.cachedir, i)):\n+                    shutil.rmtree(get_datadir_path(self.options.cachedir, i))\n \n             # Create cache directories, run bitcoinds:\n             for i in range(MAX_NODES):\n@@ -430,15 +430,18 @@ def _initialize_chain(self):\n             self.stop_nodes()\n             self.nodes = []\n             self.disable_mocktime()\n+\n+            def cache_path(n, *paths):\n+                return os.path.join(get_datadir_path(self.options.cachedir, n), \"regtest\", *paths)\n+\n             for i in range(MAX_NODES):\n-                os.remove(log_filename(self.options.cachedir, i, \"debug.log\"))\n-                os.remove(log_filename(self.options.cachedir, i, \"wallets/db.log\"))\n-                os.remove(log_filename(self.options.cachedir, i, \"peers.dat\"))\n-                os.remove(log_filename(self.options.cachedir, i, \"fee_estimates.dat\"))\n+                for entry in os.listdir(cache_path(i)):\n+                    if entry not in ['wallets', 'chainstate', 'blocks']:\n+                        os.remove(cache_path(i, entry))\n \n         for i in range(self.num_nodes):\n-            from_dir = os.path.join(self.options.cachedir, \"node\" + str(i))\n-            to_dir = os.path.join(self.options.tmpdir, \"node\" + str(i))\n+            from_dir = get_datadir_path(self.options.cachedir, i)\n+            to_dir = get_datadir_path(self.options.tmpdir, i)\n             shutil.copytree(from_dir, to_dir)\n             initialize_datadir(self.options.tmpdir, i)  # Overwrite port/rpcport in bitcoin.conf\n "
      },
      {
        "sha": "51d9936ce48a38d36a7c3a359443b9c659b69366",
        "filename": "test/functional/test_framework/util.py",
        "status": "modified",
        "additions": 0,
        "deletions": 3,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa2310572f4cfcd3322409ce7e37dde155fc4bc9/test/functional/test_framework/util.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa2310572f4cfcd3322409ce7e37dde155fc4bc9/test/functional/test_framework/util.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/test_framework/util.py?ref=fa2310572f4cfcd3322409ce7e37dde155fc4bc9",
        "patch": "@@ -328,9 +328,6 @@ def get_auth_cookie(datadir):\n         raise ValueError(\"No RPC credentials\")\n     return user, password\n \n-def log_filename(dirname, n_node, logname):\n-    return os.path.join(dirname, \"node\" + str(n_node), \"regtest\", logname)\n-\n def get_bip9_status(node, key):\n     info = node.getblockchaininfo()\n     return info['bip9_softforks'][key]"
      }
    ]
  }
]