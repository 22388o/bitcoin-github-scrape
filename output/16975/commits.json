[
  {
    "sha": "fa37e0a68bea65979f9f8f2e5258fe608acf2bdf",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYTM3ZTBhNjhiZWE2NTk3OWY5ZjhmMmU1MjU4ZmU2MDhhY2YyYmRm",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2019-09-27T15:53:34Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2020-01-02T23:00:05Z"
      },
      "message": "test: Show debug log on unit test failure",
      "tree": {
        "sha": "8deac6542c23efb0dad232c4c30bc88c68187e71",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8deac6542c23efb0dad232c4c30bc88c68187e71"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fa37e0a68bea65979f9f8f2e5258fe608acf2bdf",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\npUjZPwwAo0hjmynpouxZ+/qjnG+N9cRclzR7mnNJAJ2c7fYZONqOFYtYVGGPgGJT\nLSXdJ1kto8LADgCsZVkwCbgu4ld1jWfqVX1VwbG+LlXMVyt723ZgVOmJuudkmjtB\nHq1VFyKYcIlEaDwN15Dl+M7PShn94ObxnE2LAwMM2C01BhCt6cGbZZI/ZtZWrDEW\n/JkxvaItL/xT7Y2roWj09yFeBVX5eZK72rkTOWynQWD58ARnREnz9ed2j4XZNOFQ\nOobvtIFhVN4hU5TskIW4FoZmaZ70+s35f53ZDys5Z+hLQvuBvuLGR1bAulMFHBx3\n4QJRSEUpOazLLtWcclDzG/NAs+rKUb3duhI6GjFDJC/zhjH6RCLWYNKZLfU+mB1b\nnSczPBoMsgyCoLih0TDBdM3kPMqGdrYqJPlcKOh+lm/YZV+Txg4XWzmsz9GFTiWQ\ncAheAYFGOUnIgBiAXPtdVL5mvl5yHwDAmDppSNdv06iW/zBmpkzyTJYWKptM2faj\nBmdMpLAV\n=amWs\n-----END PGP SIGNATURE-----",
        "payload": "tree 8deac6542c23efb0dad232c4c30bc88c68187e71\nparent 17e14ac92fced92457945859463eda5d435bdd49\nauthor MarcoFalke <falke.marco@gmail.com> 1569599614 -0400\ncommitter MarcoFalke <falke.marco@gmail.com> 1578006005 -0500\n\ntest: Show debug log on unit test failure\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa37e0a68bea65979f9f8f2e5258fe608acf2bdf",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fa37e0a68bea65979f9f8f2e5258fe608acf2bdf",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa37e0a68bea65979f9f8f2e5258fe608acf2bdf/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "17e14ac92fced92457945859463eda5d435bdd49",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/17e14ac92fced92457945859463eda5d435bdd49",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/17e14ac92fced92457945859463eda5d435bdd49"
      }
    ],
    "stats": {
      "total": 34,
      "additions": 34,
      "deletions": 0
    },
    "files": [
      {
        "sha": "d1b2b938ff2c28c32d67b724092e7750b0bbe706",
        "filename": "src/bench/bench.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa37e0a68bea65979f9f8f2e5258fe608acf2bdf/src/bench/bench.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa37e0a68bea65979f9f8f2e5258fe608acf2bdf/src/bench/bench.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bench/bench.cpp?ref=fa37e0a68bea65979f9f8f2e5258fe608acf2bdf",
        "patch": "@@ -16,6 +16,7 @@\n #include <regex>\n \n const RegTestingSetup* g_testing_setup = nullptr;\n+const std::function<void(const std::string&)> G_TEST_LOG_FUN{};\n \n void benchmark::ConsolePrinter::header()\n {"
      },
      {
        "sha": "aefdcd27163a9befc578e321d4d35ec422f60a7c",
        "filename": "src/qt/test/test_main.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa37e0a68bea65979f9f8f2e5258fe608acf2bdf/src/qt/test/test_main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa37e0a68bea65979f9f8f2e5258fe608acf2bdf/src/qt/test/test_main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/test/test_main.cpp?ref=fa37e0a68bea65979f9f8f2e5258fe608acf2bdf",
        "patch": "@@ -37,6 +37,8 @@ Q_IMPORT_PLUGIN(QCocoaIntegrationPlugin);\n #endif\n #endif\n \n+const std::function<void(const std::string&)> G_TEST_LOG_FUN{};\n+\n // This is all you need to run all the tests\n int main(int argc, char *argv[])\n {"
      },
      {
        "sha": "a6ab620e21890a3dbea483fcea45acf35e6b5be3",
        "filename": "src/test/fuzz/fuzz.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 0,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa37e0a68bea65979f9f8f2e5258fe608acf2bdf/src/test/fuzz/fuzz.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa37e0a68bea65979f9f8f2e5258fe608acf2bdf/src/test/fuzz/fuzz.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/fuzz/fuzz.cpp?ref=fa37e0a68bea65979f9f8f2e5258fe608acf2bdf",
        "patch": "@@ -4,10 +4,14 @@\n \n #include <test/fuzz/fuzz.h>\n \n+#include <test/util/setup_common.h>\n+\n #include <cstdint>\n #include <unistd.h>\n #include <vector>\n \n+const std::function<void(const std::string&)> G_TEST_LOG_FUN{};\n+\n static bool read_stdin(std::vector<uint8_t>& data)\n {\n     uint8_t buffer[1024];"
      },
      {
        "sha": "e6529949e27022a4e605155643f54296884ba8ad",
        "filename": "src/test/main.cpp",
        "status": "modified",
        "additions": 15,
        "deletions": 0,
        "changes": 15,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa37e0a68bea65979f9f8f2e5258fe608acf2bdf/src/test/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa37e0a68bea65979f9f8f2e5258fe608acf2bdf/src/test/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/main.cpp?ref=fa37e0a68bea65979f9f8f2e5258fe608acf2bdf",
        "patch": "@@ -2,6 +2,21 @@\n // Distributed under the MIT software license, see the accompanying\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n+/**\n+ * See https://www.boost.org/doc/libs/1_71_0/libs/test/doc/html/boost_test/utf_reference/link_references/link_boost_test_module_macro.html\n+ */\n #define BOOST_TEST_MODULE Bitcoin Core Test Suite\n \n #include <boost/test/unit_test.hpp>\n+\n+#include <test/util/setup_common.h>\n+\n+/** Redirect debug log to boost log */\n+const std::function<void(const std::string&)> G_TEST_LOG_FUN = [](const std::string& s) {\n+    if (s.back() == '\\n') {\n+        // boost will insert the new line\n+        BOOST_TEST_MESSAGE(s.substr(0, s.size() - 1));\n+    } else {\n+        BOOST_TEST_MESSAGE(s);\n+    }\n+};"
      },
      {
        "sha": "ccb3064d5974afc6da768f70cf0df923a7dbc801",
        "filename": "src/test/util/setup_common.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa37e0a68bea65979f9f8f2e5258fe608acf2bdf/src/test/util/setup_common.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa37e0a68bea65979f9f8f2e5258fe608acf2bdf/src/test/util/setup_common.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/util/setup_common.cpp?ref=fa37e0a68bea65979f9f8f2e5258fe608acf2bdf",
        "patch": "@@ -71,6 +71,7 @@ BasicTestingSetup::BasicTestingSetup(const std::string& chainName)\n     SelectParams(chainName);\n     SeedInsecureRand();\n     gArgs.ForceSetArg(\"-printtoconsole\", \"0\");\n+    if (G_TEST_LOG_FUN) LogInstance().PushBackCallback(G_TEST_LOG_FUN);\n     InitLogging();\n     LogInstance().StartLogging();\n     SHA256AutoDetect();"
      },
      {
        "sha": "6741be84804aae9cdd338fa3503a4e51b44e8f21",
        "filename": "src/test/util/setup_common.h",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa37e0a68bea65979f9f8f2e5258fe608acf2bdf/src/test/util/setup_common.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa37e0a68bea65979f9f8f2e5258fe608acf2bdf/src/test/util/setup_common.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/util/setup_common.h?ref=fa37e0a68bea65979f9f8f2e5258fe608acf2bdf",
        "patch": "@@ -18,6 +18,9 @@\n \n #include <boost/thread.hpp>\n \n+/** This is connected to the logger. Can be used to redirect logs to any other log */\n+extern const std::function<void(const std::string&)> G_TEST_LOG_FUN;\n+\n // Enable BOOST_CHECK_EQUAL for enum class types\n template <typename T>\n std::ostream& operator<<(typename std::enable_if<std::is_enum<T>::value, std::ostream>::type& stream, const T& e)"
      },
      {
        "sha": "b9c5c038d0afadfad014ee8b2e436f805408b76a",
        "filename": "test/sanitizer_suppressions/tsan",
        "status": "modified",
        "additions": 8,
        "deletions": 0,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa37e0a68bea65979f9f8f2e5258fe608acf2bdf/test/sanitizer_suppressions/tsan",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa37e0a68bea65979f9f8f2e5258fe608acf2bdf/test/sanitizer_suppressions/tsan",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/sanitizer_suppressions/tsan?ref=fa37e0a68bea65979f9f8f2e5258fe608acf2bdf",
        "patch": "@@ -7,6 +7,14 @@ deadlock:WalletBatch\n # Intentional deadlock in tests\n deadlock:TestPotentialDeadLockDetected\n \n+# Race due to unprotected calls to thread-unsafe BOOST_TEST_MESSAGE from different threads:\n+# * G_TEST_LOG_FUN in the index thread\n+# * boost test case invoker (entering a test case) in the main thread\n+# TODO: get rid of BOOST_ macros, see also https://github.com/bitcoin/bitcoin/issues/8670\n+race:blockfilter_index_initial_sync_invoker\n+race:txindex_initial_sync_invoker\n+race:validation_block_tests::TestSubscriber\n+\n # Wildcard for all gui tests, should be replaced with non-wildcard suppressions\n race:src/qt/test/*\n deadlock:src/qt/test/*"
      }
    ]
  }
]