mikehearn,2014-04-24T16:21:37Z,This looks good to me. What's needed to merge it? More reviews?\n,https://github.com/bitcoin/bitcoin/pull/3580#issuecomment-41300428,41300428,
laanwj,2014-04-24T16:33:31Z,"Yes, a few more reviews and ACKs would be nice. It is a small change, but it does affect main.cpp.\n",https://github.com/bitcoin/bitcoin/pull/3580#issuecomment-41301900,41301900,
sipa,2014-04-24T16:40:13Z,"So the only concern here is that it makes DoS protection solely rely on hardness of PoW. That is probably safe, but it breaks the de facto rule on the network of not ever relaying data that is not known to be correct.\n\nAn alternative (first suggested by @maaku, I think) is just fast-relaying block headers as soon as they are validated, and using header-first-seen as tie breaker for choosing acti",https://github.com/bitcoin/bitcoin/pull/3580#issuecomment-41302707,41302707,
maaku,2014-04-24T17:23:57Z,"Yes, as soon as headers-first is ready (I'm willing to help on that), the better solution is to fast-relay headers and still DoS-ban on a bad block once it is finally fetched (DoS the peer you got the block from, not the block header).\n",https://github.com/bitcoin/bitcoin/pull/3580#issuecomment-41307913,41307913,
gmaxwell,2014-04-24T18:07:56Z,"I don't think we should be serving blocks where we are unsure of the validity identically to blocks that we've validated. Handing bad blocks to SPV nodes, for example, risks creating a network partition between full nodes and SPV nodes even where the SPV nodes are connected only to honest good nodes. \n\nFailing to hang up on nodes giving us bad blocks (which they claim are good and verified) also",https://github.com/bitcoin/bitcoin/pull/3580#issuecomment-41312850,41312850,
sipa,2014-04-24T20:45:24Z,"How about adding a message that means 'I am fine with being told about\nblocks that are not necessarily valid', which is sent by new nodes at\nstartup to new protocol version peers. SPV nodes or block analysis/wallet\nwatching implementation without validation support would not set it?\n",https://github.com/bitcoin/bitcoin/pull/3580#issuecomment-41329860,41329860,
gmaxwell,2014-04-24T20:58:54Z,"Could that also have a ""I have now successfully validated block XYZ"" message that gets sent when validation is complete to peers who've we've send unvalidated blocks to?   If soâ€” we'd use that to find different peers if we have a peer that is obviously imposing different validation rules than us.\n\nIn which case, I think thats basically isomorphic to the alternative getblock and seems reasonable ",https://github.com/bitcoin/bitcoin/pull/3580#issuecomment-41331309,41331309,
leofidus,2014-04-24T22:25:24Z,"A future change to relay invalid blocks with valid PoW may be controversial, but I see no problem with this PR. If a node sends us invalid blocks with valid PoW, it's unlikely that that node is performing a DoS attack. Banning the node for DoS seems wrong for this reason.\n\nBesides enabling future changes, this change might also help transaction propagation in a hardfork by preventing a network s",https://github.com/bitcoin/bitcoin/pull/3580#issuecomment-41340195,41340195,
gmaxwell,2014-04-24T22:27:39Z,"@leofidus  No, it can make a spit significantly worse, because a peer running the majority code may be partitioned by minority nodes which do not relay blocks it will accept. That is hardly does-no-harm.  It could also enable theft from SPV clients who accept transactions from blocks believing them to be valid and that their full node peers are protecting them by validing blocks. Again, that is ha",https://github.com/bitcoin/bitcoin/pull/3580#issuecomment-41340396,41340396,
petertodd,2014-06-13T03:00:32Z,"Note how this can be used to help force a blocksize increase through - the nodes that did not increase the blocksize will still relay invalid and oversized blocks for the ones that did. (up to 20MiB, the max serialization limit)\n",https://github.com/bitcoin/bitcoin/pull/3580#issuecomment-45971343,45971343,
sipa,2014-06-13T19:41:43Z,"@petertodd: If I understand the idea correctly (@gavinandresen correct me if I'm wrong), it would mean relaying blocks as soon as the header plus transactions have been received (and the basic checks on those have been performed, but before doing the full (utxo looking, signature check) validity. As you obviously know the size of what you're going to relay before relaying it, it should be easy eno",https://github.com/bitcoin/bitcoin/pull/3580#issuecomment-46052059,46052059,
petertodd,2014-06-13T19:49:49Z,"Yup, I believe an easy fix would be to reduce the MAX_SIZE constant from 20MiB to 1MB. (+ some headroom?) That would have also make the ""padded tx"" attack last year much less severe.\n",https://github.com/bitcoin/bitcoin/pull/3580#issuecomment-46052717,46052717,
sipa,2014-06-13T19:55:02Z,"@petertodd That too, but it's not even necessary. Just only relay after doing the header + transactions checks (which includes the 1MB limitation), but before the signature/utxo validation. Of course, that means no DoS banning senders of overly large blocks, but I don't really care about that nearly as much as an evil miner being able to make the entire network relay an obviously-violating-consens",https://github.com/bitcoin/bitcoin/pull/3580#issuecomment-46053212,46053212,
petertodd,2014-06-13T20:40:49Z,"@sipa Actually, looking at this again I think I misunderstood the logic in the patch, and it looks like CheckBlock() failing will still cause a DoS ban, so at least what _this_ particular patch implements is ok re: blocksize. (in the sense that it can only be safely followed up by a patch that does CheckBlock() and PoW checks prior to relaying) gmaxwells arguments against this change still apply t",https://github.com/bitcoin/bitcoin/pull/3580#issuecomment-46057422,46057422,
BitcoinPullTester,2014-06-23T16:17:58Z,"Automatic sanity-testing: FAILED MERGE, see http://jenkins.bluematt.me/pull-tester/p3580_b9c3ede02922ab4843c356c0f3df2b1618c73ae5/ for test log.\n\nThis pull does not merge cleanly onto current master\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.lo",https://github.com/bitcoin/bitcoin/pull/3580#issuecomment-46866826,46866826,
gavinandresen,2014-07-04T19:04:01Z,"No consensus, and I don't care enough to work more on this.\n",https://github.com/bitcoin/bitcoin/pull/3580#issuecomment-48065952,48065952,
Michagogo,2014-01-26T10:13:55Z,Typo?\n,https://github.com/bitcoin/bitcoin/pull/3580#discussion_r9175199,9175199,src/main.cpp
rebroad,2014-02-23T00:28:27Z,The previous sentence used up less storage space...\n,https://github.com/bitcoin/bitcoin/pull/3580#discussion_r9973748,9973748,src/main.cpp
laanwj,2014-02-23T08:24:58Z,Github would also use less storage space without your pointless comment :)\n,https://github.com/bitcoin/bitcoin/pull/3580#discussion_r9974865,9974865,src/main.cpp
rebroad,2014-07-05T04:36:28Z,LOL\n,https://github.com/bitcoin/bitcoin/pull/3580#discussion_r14569342,14569342,src/main.cpp
