[
  {
    "sha": "3201035f22fe451c808b0bb157d33a58f0d99c07",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozMjAxMDM1ZjIyZmU0NTFjODA4YjBiYjE1N2QzM2E1OGYwZDk5YzA3",
    "commit": {
      "author": {
        "name": "Jonas Schnelli",
        "email": "jonas.schnelli@include7.ch",
        "date": "2015-04-24T19:31:46Z"
      },
      "committer": {
        "name": "Jonas Schnelli",
        "email": "jonas.schnelli@include7.ch",
        "date": "2015-05-28T07:00:45Z"
      },
      "message": "[autoprune] allow wallet in pruned mode",
      "tree": {
        "sha": "88b19ba6bbe283f0648996fd83e385a288da3aa0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/88b19ba6bbe283f0648996fd83e385a288da3aa0"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3201035f22fe451c808b0bb157d33a58f0d99c07",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3201035f22fe451c808b0bb157d33a58f0d99c07",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/3201035f22fe451c808b0bb157d33a58f0d99c07",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3201035f22fe451c808b0bb157d33a58f0d99c07/comments",
    "author": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "ce56f5621a94dcc2159ebe57e43da727eab18e6c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ce56f5621a94dcc2159ebe57e43da727eab18e6c",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/ce56f5621a94dcc2159ebe57e43da727eab18e6c"
      }
    ],
    "stats": {
      "total": 21,
      "additions": 15,
      "deletions": 6
    },
    "files": [
      {
        "sha": "c102464ad908d63dcf87879e272f0c3625f6d576",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 15,
        "deletions": 6,
        "changes": 21,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3201035f22fe451c808b0bb157d33a58f0d99c07/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3201035f22fe451c808b0bb157d33a58f0d99c07/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=3201035f22fe451c808b0bb157d33a58f0d99c07",
        "patch": "@@ -714,16 +714,12 @@ bool AppInit2(boost::thread_group& threadGroup, CScheduler& scheduler)\n         nMaxConnections = nFD - MIN_CORE_FILEDESCRIPTORS;\n \n     // if using block pruning, then disable txindex\n-    // also disable the wallet (for now, until SPV support is implemented in wallet)\n     if (GetArg(\"-prune\", 0)) {\n         if (GetBoolArg(\"-txindex\", false))\n             return InitError(_(\"Prune mode is incompatible with -txindex.\"));\n #ifdef ENABLE_WALLET\n-        if (!GetBoolArg(\"-disablewallet\", false)) {\n-            if (SoftSetBoolArg(\"-disablewallet\", true))\n-                LogPrintf(\"%s : parameter interaction: -prune -> setting -disablewallet=1\\n\", __func__);\n-            else\n-                return InitError(_(\"Can't run with a wallet in prune mode.\"));\n+        if (GetBoolArg(\"-rescan\", false)) {\n+            return InitError(_(\"Rescans are not possible in pruned mode. You will need to use -reindex which will download the whole blockchain again.\"));\n         }\n #endif\n     }\n@@ -1316,6 +1312,19 @@ bool AppInit2(boost::thread_group& threadGroup, CScheduler& scheduler)\n         }\n         if (chainActive.Tip() && chainActive.Tip() != pindexRescan)\n         {\n+            //We can't rescan beyond non-pruned blocks, stop and throw an error\n+            //this might happen if a user uses a old wallet within a pruned node\n+            // or if he ran -disablewallet for a longer time, then decided to re-enable\n+            if (fPruneMode)\n+            {\n+                CBlockIndex *block = chainActive.Tip();\n+                while (block && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA) && pindexRescan != block)\n+                    block = block->pprev;\n+\n+                if (pindexRescan != block)\n+                    return InitError(_(\"Prune: last wallet synchronisation goes beyond pruned data. You need to -reindex (download the whole blockchain again in case of pruned node)\"));\n+            }\n+\n             uiInterface.InitMessage(_(\"Rescanning...\"));\n             LogPrintf(\"Rescanning last %i blocks (from block %i)...\\n\", chainActive.Height() - pindexRescan->nHeight, pindexRescan->nHeight);\n             nStart = GetTimeMillis();"
      }
    ]
  },
  {
    "sha": "7a12119d7a9084010725cf5b95bafcc3cf2c1d71",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo3YTEyMTE5ZDdhOTA4NDAxMDcyNWNmNWI5NWJhZmNjM2NmMmMxZDcx",
    "commit": {
      "author": {
        "name": "Jonas Schnelli",
        "email": "jonas.schnelli@include7.ch",
        "date": "2015-04-24T19:42:51Z"
      },
      "committer": {
        "name": "Jonas Schnelli",
        "email": "jonas.schnelli@include7.ch",
        "date": "2015-05-28T07:00:45Z"
      },
      "message": "[RPC] disable import functions in pruned mode\n\nimport functions could lead to a rescan beyond prune level",
      "tree": {
        "sha": "652f8afa457ec24410d3a3650e030d1d3018fb3b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/652f8afa457ec24410d3a3650e030d1d3018fb3b"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7a12119d7a9084010725cf5b95bafcc3cf2c1d71",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7a12119d7a9084010725cf5b95bafcc3cf2c1d71",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/7a12119d7a9084010725cf5b95bafcc3cf2c1d71",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7a12119d7a9084010725cf5b95bafcc3cf2c1d71/comments",
    "author": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "3201035f22fe451c808b0bb157d33a58f0d99c07",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3201035f22fe451c808b0bb157d33a58f0d99c07",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/3201035f22fe451c808b0bb157d33a58f0d99c07"
      }
    ],
    "stats": {
      "total": 9,
      "additions": 9,
      "deletions": 0
    },
    "files": [
      {
        "sha": "b8fb0675ed66b6a5773f30197f31772ddef598b3",
        "filename": "src/wallet/rpcdump.cpp",
        "status": "modified",
        "additions": 9,
        "deletions": 0,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7a12119d7a9084010725cf5b95bafcc3cf2c1d71/src/wallet/rpcdump.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7a12119d7a9084010725cf5b95bafcc3cf2c1d71/src/wallet/rpcdump.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcdump.cpp?ref=7a12119d7a9084010725cf5b95bafcc3cf2c1d71",
        "patch": "@@ -95,6 +95,9 @@ Value importprivkey(const Array& params, bool fHelp)\n             + HelpExampleRpc(\"importprivkey\", \"\\\"mykey\\\", \\\"testing\\\", false\")\n         );\n \n+    if (fPruneMode)\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Importing keys is disabled in pruned mode\");\n+\n     LOCK2(cs_main, pwalletMain->cs_wallet);\n \n     EnsureWalletIsUnlocked();\n@@ -167,6 +170,9 @@ Value importaddress(const Array& params, bool fHelp)\n             + HelpExampleRpc(\"importaddress\", \"\\\"myaddress\\\", \\\"testing\\\", false\")\n         );\n \n+    if (fPruneMode)\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Importing addresses is disabled in pruned mode\");\n+\n     LOCK2(cs_main, pwalletMain->cs_wallet);\n \n     CScript script;\n@@ -237,6 +243,9 @@ Value importwallet(const Array& params, bool fHelp)\n             + HelpExampleRpc(\"importwallet\", \"\\\"test\\\"\")\n         );\n \n+    if (fPruneMode)\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Importing wallets is disabled in pruned mode\");\n+\n     LOCK2(cs_main, pwalletMain->cs_wallet);\n \n     EnsureWalletIsUnlocked();"
      }
    ]
  },
  {
    "sha": "7e6569ea5be8cb26454ede3efb6a50b393aaa9be",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo3ZTY1NjllYTViZThjYjI2NDU0ZWRlM2VmYjZhNTBiMzkzYWFhOWJl",
    "commit": {
      "author": {
        "name": "Jonas Schnelli",
        "email": "jonas.schnelli@include7.ch",
        "date": "2015-04-29T11:30:16Z"
      },
      "committer": {
        "name": "Jonas Schnelli",
        "email": "jonas.schnelli@include7.ch",
        "date": "2015-05-28T07:00:45Z"
      },
      "message": "[squashme] improve/corrects prune mode detection test for required wallet rescans",
      "tree": {
        "sha": "e408f1c97e6fa9717b1990e2e5a12ddcb3c410b4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e408f1c97e6fa9717b1990e2e5a12ddcb3c410b4"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7e6569ea5be8cb26454ede3efb6a50b393aaa9be",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7e6569ea5be8cb26454ede3efb6a50b393aaa9be",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/7e6569ea5be8cb26454ede3efb6a50b393aaa9be",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7e6569ea5be8cb26454ede3efb6a50b393aaa9be/comments",
    "author": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "7a12119d7a9084010725cf5b95bafcc3cf2c1d71",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7a12119d7a9084010725cf5b95bafcc3cf2c1d71",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/7a12119d7a9084010725cf5b95bafcc3cf2c1d71"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 1,
      "deletions": 1
    },
    "files": [
      {
        "sha": "24e7e1c04a4c3828987efcd232bebf23080036b3",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7e6569ea5be8cb26454ede3efb6a50b393aaa9be/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7e6569ea5be8cb26454ede3efb6a50b393aaa9be/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=7e6569ea5be8cb26454ede3efb6a50b393aaa9be",
        "patch": "@@ -1318,7 +1318,7 @@ bool AppInit2(boost::thread_group& threadGroup, CScheduler& scheduler)\n             if (fPruneMode)\n             {\n                 CBlockIndex *block = chainActive.Tip();\n-                while (block && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA) && pindexRescan != block)\n+                while (block && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA) && block->pprev->nTx > 0 && pindexRescan != block)\n                     block = block->pprev;\n \n                 if (pindexRescan != block)"
      }
    ]
  }
]