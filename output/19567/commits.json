[
  {
    "sha": "f1012bfd5b0c5b5907def572db3cd3a5aa0aa122",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmMTAxMmJmZDViMGM1YjU5MDdkZWY1NzJkYjNjZDNhNWFhMGFhMTIy",
    "commit": {
      "author": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2020-07-22T12:45:51Z"
      },
      "committer": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2020-07-22T12:45:51Z"
      },
      "message": "p2p, refactor: Use MAX_ADDR_TO_SEND instead of magic numbers",
      "tree": {
        "sha": "067d2534b5d02d6c61c636a5a111e59923fed332",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/067d2534b5d02d6c61c636a5a111e59923fed332"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f1012bfd5b0c5b5907def572db3cd3a5aa0aa122",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE0dvyxLlvLev0wWZUQQEIES5+qB8FAl8YNP8ACgkQQQEIES5+\nqB9COg//SKNsSbVeVa496LqxVghFV/CM4KecqCPC8pxm+nfb83NIO9OIIHQyXpjd\nuCB35HdL9BQcPjFHQq8MMm3JC8CK+doRrifErtNfz8fsb9TPBwOtcLoTOgOfrg6o\nTt4Wnt7Ovyvfi1bBZs2UV39TLAHcSGbYvw/Y/wjG5XiQlZF3g5QH0XCtXiUcW59K\nI8Cc5KK0zsZtuJ/LyRTPM5ere1meEH5XTxg1SqULhNzs2qJJ2Q8DZZZ+HjFFx/7J\nhN62tPVRVs71rhn998jMLHIxI0zvStIook6X2LVwj6lujlMEmoVMiIhI4Y5drK1X\nkYqaJmsC6bEfTHQ9EBbPi28DD/Gt2SbLQS6ooejSuUyBAinB2NIn58kfVZ5KlHxv\n4FpZUKWXtOjcVwDXhJ6qoLbBvqUU5fGaIl3mZzhCFyW8fTfp6EFA366cvzzzbCfQ\ny5XOeE8a3UY+HSRUfdHukLs9OT7zvGdr+TkWY/tbjtI4qIMwAIocoIdA1QVsXxmE\nm/oYt7OgPVd1yhwLg5XpeVzF+Df2L7YbHYH/DTUu2YdLlaTNStXEO6ZtMiMV8d7A\nPrTUMsMnpmSJ6LP/vncafW33L8TEfE2wpwPbTfw/xVw9caYb2yIesuC1UJ9RfRh0\n1Jv2ItT09XgP6UdMxBS4obJC0A3EUdr02flXK+ExxUxQr9iBTuI=\n=8PON\n-----END PGP SIGNATURE-----",
        "payload": "tree 067d2534b5d02d6c61c636a5a111e59923fed332\nparent c7b4968552c704f1e2e9a046911e1207f5af5fe0\nauthor Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1595421951 +0300\ncommitter Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1595421951 +0300\n\np2p, refactor: Use MAX_ADDR_TO_SEND instead of magic numbers\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f1012bfd5b0c5b5907def572db3cd3a5aa0aa122",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/f1012bfd5b0c5b5907def572db3cd3a5aa0aa122",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f1012bfd5b0c5b5907def572db3cd3a5aa0aa122/comments",
    "author": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "c7b4968552c704f1e2e9a046911e1207f5af5fe0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c7b4968552c704f1e2e9a046911e1207f5af5fe0",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/c7b4968552c704f1e2e9a046911e1207f5af5fe0"
      }
    ],
    "stats": {
      "total": 10,
      "additions": 4,
      "deletions": 6
    },
    "files": [
      {
        "sha": "854f727c82e877b12330d0c8e03300369fe15d8b",
        "filename": "src/net_processing.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 6,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f1012bfd5b0c5b5907def572db3cd3a5aa0aa122/src/net_processing.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f1012bfd5b0c5b5907def572db3cd3a5aa0aa122/src/net_processing.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net_processing.cpp?ref=f1012bfd5b0c5b5907def572db3cd3a5aa0aa122",
        "patch": "@@ -2469,8 +2469,7 @@ void ProcessMessage(\n         if (!pfrom.IsAddrRelayPeer()) {\n             return;\n         }\n-        if (vAddr.size() > 1000)\n-        {\n+        if (vAddr.size() > MAX_ADDR_TO_SEND) {\n             LOCK(cs_main);\n             Misbehaving(pfrom.GetId(), 20, strprintf(\"addr message size = %u\", vAddr.size()));\n             return;\n@@ -2509,7 +2508,7 @@ void ProcessMessage(\n                 vAddrOk.push_back(addr);\n         }\n         connman.AddNewAddresses(vAddrOk, pfrom.addr, 2 * 60 * 60);\n-        if (vAddr.size() < 1000)\n+        if (vAddr.size() < MAX_ADDR_TO_SEND)\n             pfrom.fGetAddr = false;\n         if (pfrom.fOneShot)\n             pfrom.fDisconnect = true;\n@@ -3935,9 +3934,8 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n                 {\n                     pto->m_addr_known->insert(addr.GetKey());\n                     vAddr.push_back(addr);\n-                    // receiver rejects addr messages larger than 1000\n-                    if (vAddr.size() >= 1000)\n-                    {\n+                    // receiver rejects addr messages larger than MAX_ADDR_TO_SEND\n+                    if (vAddr.size() >= MAX_ADDR_TO_SEND) {\n                         connman->PushMessage(pto, msgMaker.Make(NetMsgType::ADDR, vAddr));\n                         vAddr.clear();\n                     }"
      }
    ]
  },
  {
    "sha": "7aad9b2f02d0c62c05134e24b7274c27bb0a4624",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo3YWFkOWIyZjAyZDBjNjJjMDUxMzRlMjRiNzI3NGMyN2JiMGE0NjI0",
    "commit": {
      "author": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2020-07-22T12:54:49Z"
      },
      "committer": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2020-07-22T12:57:58Z"
      },
      "message": "p2p, refactor: Do not over-reserve vAddr capacity",
      "tree": {
        "sha": "0ddbfd0ab5ee0b0432ea3b042a836daa07f078f4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0ddbfd0ab5ee0b0432ea3b042a836daa07f078f4"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7aad9b2f02d0c62c05134e24b7274c27bb0a4624",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE0dvyxLlvLev0wWZUQQEIES5+qB8FAl8YN9YACgkQQQEIES5+\nqB9pRQ//ZXsYnVN/RxCnedEuQ6tUcHBrPJt/gbIxmbCKDWGxASqQQwDzi6JE7uT3\nfuE9md8esNtGFHnncCU/r1emDf96H8RKnbnc3VfuJtLbRTBcRe8Z/QP5okWTTwwD\nPqJF/GXX3FtN3VgAklTCBJQUh1xAnrL0QjwT4Nn10Kl69JRAS6EJ9ONVACGoa1Nh\nqBl+hOXekg5oqaJ2per2UKt/USUQ6VHBSBmDaEuFkZBx4BJrgrjTH8v/1UMqxUVF\nF/blZZWe+KjGWfv4RRRgI6H+gPr74evpF/lWlbNufvoMR/cSprMqRaKC3zWkv7s0\n/9GdI/PeatX0SHy3oLp/cQTjjO8l26fyThfMtYF2FwV995koWs8pSmYGxgw/egQJ\nZmBfTKDy3CMbUjYHiaU6cjG1NF/uhAyxYZUI0J0VX6O2Ob0VJXTCioiBOSAZHaaL\naPp06jSmOAPpPjqp4Vo/07o4wpp6WbovH4F4YvcS4To9mdnWlNhHw/UjzVkBOBzH\nXArKAaB0XYNEd/lmVqAFbjFHdoq0bbQ38chDu5sZ0Y+W+r3+TECJVL6SZ6Qiw+DD\nzEwfr1OqTRNVLsxkq5X9Z1CUAV+qBOteOcP6IxE1h6ZkIhePAShPUANchGMt8+Vr\noSilKlHxwEtA2uBWJKwhPBdnLcgRUAlQw3r603ZynzZU3HBhvZA=\n=1COv\n-----END PGP SIGNATURE-----",
        "payload": "tree 0ddbfd0ab5ee0b0432ea3b042a836daa07f078f4\nparent f1012bfd5b0c5b5907def572db3cd3a5aa0aa122\nauthor Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1595422489 +0300\ncommitter Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1595422678 +0300\n\np2p, refactor: Do not over-reserve vAddr capacity\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7aad9b2f02d0c62c05134e24b7274c27bb0a4624",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/7aad9b2f02d0c62c05134e24b7274c27bb0a4624",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7aad9b2f02d0c62c05134e24b7274c27bb0a4624/comments",
    "author": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "f1012bfd5b0c5b5907def572db3cd3a5aa0aa122",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f1012bfd5b0c5b5907def572db3cd3a5aa0aa122",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/f1012bfd5b0c5b5907def572db3cd3a5aa0aa122"
      }
    ],
    "stats": {
      "total": 3,
      "additions": 2,
      "deletions": 1
    },
    "files": [
      {
        "sha": "acd940384cd4da316560b178f6b70c0ecbba0fbc",
        "filename": "src/net_processing.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7aad9b2f02d0c62c05134e24b7274c27bb0a4624/src/net_processing.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7aad9b2f02d0c62c05134e24b7274c27bb0a4624/src/net_processing.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net_processing.cpp?ref=7aad9b2f02d0c62c05134e24b7274c27bb0a4624",
        "patch": "@@ -30,6 +30,7 @@\n #include <util/system.h>\n #include <validation.h>\n \n+#include <algorithm>\n #include <memory>\n #include <typeinfo>\n \n@@ -3926,7 +3927,7 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n         if (pto->IsAddrRelayPeer() && pto->m_next_addr_send < current_time) {\n             pto->m_next_addr_send = PoissonNextSend(current_time, AVG_ADDRESS_BROADCAST_INTERVAL);\n             std::vector<CAddress> vAddr;\n-            vAddr.reserve(pto->vAddrToSend.size());\n+            vAddr.reserve(std::min(pto->vAddrToSend.size(), (size_t)MAX_ADDR_TO_SEND));\n             assert(pto->m_addr_known);\n             for (const CAddress& addr : pto->vAddrToSend)\n             {"
      }
    ]
  }
]