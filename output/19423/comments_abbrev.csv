glozow,2020-07-01 05:05:50,Btw thanks @jonatack for input on the test ðŸ˜„  added you as coauthor. I added a loop for peerinfo so this test should work with any number of nodes.,https://github.com/bitcoin/bitcoin/pull/19423#issuecomment-652192912,652192912,
glozow,2020-07-01 05:46:34,Pushing to rerun travis because a job timed out :(,https://github.com/bitcoin/bitcoin/pull/19423#issuecomment-652205393,652205393,
jonatack,2020-07-01 05:58:19,"> Pushing to rerun travis because a job timed out :(\n\nYou can also ask for a travis re-kick on irc and someone will restart just the recalcitrant job. In this case, I'll keep a sharp weather eye and re-kick any jobs needed here.",https://github.com/bitcoin/bitcoin/pull/19423#issuecomment-652209073,652209073,
jonatack,2020-07-01 07:05:00,LGTM,https://github.com/bitcoin/bitcoin/pull/19423#issuecomment-652233973,652233973,
MarcoFalke,2020-07-02 18:48:19,ACK fc1a714699a66f9feec9e8ab0d6be92a07244a74,https://github.com/bitcoin/bitcoin/pull/19423#issuecomment-653167332,653167332,
glozow,2020-07-02 21:26:22,"Status: I think https://github.com/bitcoin/bitcoin/commit/fc1a714699a66f9feec9e8ab0d6be92a07244a74 (with just the minfeefilter) is sufficient for testing #19204.\n\nI figured out a way to test transaction relay too in https://github.com/bitcoin/bitcoin/pull/19423/commits/7bc653e7e3d21c675c6a1257f658222b97e166cb, but it's not perfect - there isn't an obvious way to see what tx invs a node has rec",https://github.com/bitcoin/bitcoin/pull/19423#issuecomment-653227645,653227645,
glozow,2020-07-03 20:50:42,Soooo I just had an excellent adventure through the mock time stuff... I can't get `-mocktime` to work (see [this test](https://github.com/gzhao408/bitcoin/blob/init-mocktime/test/functional/interface_mocktime.py) which passes for `setmocktime` but not `-mocktime`) so I implemented this by fastforwarding one node by 2 days so it thinks it's still in IBD even when receiving blocks (all > 1 day old),https://github.com/bitcoin/bitcoin/pull/19423#issuecomment-653674443,653674443,
promag,2020-07-07 11:09:25,"Concept ACK, just read the code and looks good to me.",https://github.com/bitcoin/bitcoin/pull/19423#issuecomment-654779502,654779502,
practicalswift,2020-07-10 21:03:04,"Concept ACK\n\nThanks for improving our testing!",https://github.com/bitcoin/bitcoin/pull/19423#issuecomment-656889456,656889456,
MarcoFalke,2020-07-11 10:21:38,"The test fails on the second commit. I am happy to merge the first commit, though, and we can leave the second commit for a later pull?",https://github.com/bitcoin/bitcoin/pull/19423#issuecomment-657035479,657035479,
glozow,2020-07-11 18:38:42,"@MarcoFalke thanks! Would you happen to have a log for the test fail? (Also it seems like a travis job timed out but otherwise green). I can definitely separate the second commit, but currently it's working for me so I'm not sure how to fix it ðŸ˜• ",https://github.com/bitcoin/bitcoin/pull/19423#issuecomment-657109356,657109356,
jonatack,2020-07-11 18:44:14,@gzhao408 here's the link (you can click through to it on the :x: ) https://travis-ci.org/github/bitcoin/bitcoin/jobs/704781135. I restarted the job a few days ago to see if it would re-fail.,https://github.com/bitcoin/bitcoin/pull/19423#issuecomment-657110115,657110115,
jonatack,2020-07-11 18:47:31,(Do you have travis linked to your personal fork of the bitcoin repo? You can restart failing jobs there.),https://github.com/bitcoin/bitcoin/pull/19423#issuecomment-657110591,657110591,
glozow,2020-07-16 00:16:40,"Sorry for the delay ðŸ˜“   ready for review again.\n\nPushed it back to the first commit and fixed the error - this tests the fee filter during and after IBD, no txrelay. I'll work on txrelay and will make it a followup. ",https://github.com/bitcoin/bitcoin/pull/19423#issuecomment-659081116,659081116,
jnewbery,2020-07-16 14:31:16,utACK cb31ee01b42af58c64b5d3c0eabae4bcd7fd67cf,https://github.com/bitcoin/bitcoin/pull/19423#issuecomment-659451211,659451211,
jonatack,2020-07-01 05:18:29,I think you can remove these two lines about the wallet. This should be unrelated to wallet presence.,https://github.com/bitcoin/bitcoin/pull/19423#discussion_r448120513,448120513,test/functional/p2p_ibd.py
jonatack,2020-07-01 05:48:22,"Nice idea to add the inner loop. Can also assert the filter for each element.\n```diff\n-            assert_equal(info[0]['minfeefilter'], MAX_FEE_FILTER)\n             for conn_info in info:\n+                assert_equal(conn_info['minfeefilter'], MAX_FEE_FILTER)\n```",https://github.com/bitcoin/bitcoin/pull/19423#discussion_r448128886,448128886,test/functional/p2p_ibd.py
jonatack,2020-07-01 05:49:00,"idem!\n```diff\n-            assert_equal(info[0]['minfeefilter'], NORMAL_FEE_FILTER)\n             for conn_info in info:\n+                assert_equal(conn_info['minfeefilter'], NORMAL_FEE_FILTER)\n```",https://github.com/bitcoin/bitcoin/pull/19423#discussion_r448129043,448129043,test/functional/p2p_ibd.py
jonatack,2020-07-01 05:49:27,"If you like, the constants can be pulled out to the top to de-clutter the test. I think that's generally what is done but that could be a misconception on my part.",https://github.com/bitcoin/bitcoin/pull/19423#discussion_r448129186,448129186,test/functional/p2p_ibd.py
glozow,2020-07-01 06:03:13,woops,https://github.com/bitcoin/bitcoin/pull/19423#discussion_r448133436,448133436,test/functional/p2p_ibd.py
naumenkogs,2020-07-01 10:12:50,"This is a confusing name because it doesn't really test IBD (the main purpose of which is to sync the tip).\nMaybe 'p2p_tx_relay_while_ibd.py'",https://github.com/bitcoin/bitcoin/pull/19423#discussion_r448261753,448261753,test/functional/test_runner.py
MarcoFalke,2020-07-01 11:59:16,p2p_feefilter_ibd ? ,https://github.com/bitcoin/bitcoin/pull/19423#discussion_r448313573,448313573,test/functional/test_runner.py
MarcoFalke,2020-07-01 12:01:39,"Seems a bit odd to use floating point, but then put the result in a decimal. Why not `Decimal(9170997)/COIN`?",https://github.com/bitcoin/bitcoin/pull/19423#discussion_r448314722,448314722,test/functional/p2p_ibd.py
MarcoFalke,2020-07-01 12:01:45,same,https://github.com/bitcoin/bitcoin/pull/19423#discussion_r448314773,448314773,test/functional/p2p_ibd.py
MarcoFalke,2020-07-01 12:02:49,"Could use the constant?\n```suggestion\n        self.extra_args = [\n        [""-minrelaytxfee={}"".format(NORMAL_FEE_FILTER)],\n        [""-minrelaytxfee={}"".fromat(NORMAL_FEE_FILTER)],\n         ]\n```",https://github.com/bitcoin/bitcoin/pull/19423#discussion_r448315317,448315317,test/functional/p2p_ibd.py
MarcoFalke,2020-07-01 12:05:10,"This is a inv of type block, no?\n\nI am not sure if there is a way to ask Bitcoin Core which inv type it received. Maybe the only way is to use mininode?",https://github.com/bitcoin/bitcoin/pull/19423#discussion_r448316507,448316507,test/functional/p2p_ibd.py
glozow,2020-07-01 19:29:49,p2p_ibd_txrelay?,https://github.com/bitcoin/bitcoin/pull/19423#discussion_r448572594,448572594,test/functional/test_runner.py
glozow,2020-07-02 18:22:24,"Well, to be honest, this test doesn't even produce any transactions to send invs about right now ðŸ˜…  I need to work that out.\n\nMininodes are useful for seeing what nodes send out, but I'm not sure how useful they for seeing what nodes receive... I could have a mininode manually send a feefilter and make sure it doesn't receive anything, but then I'm testing the feefilter message instead of IBD ",https://github.com/bitcoin/bitcoin/pull/19423#discussion_r449194955,449194955,test/functional/p2p_ibd.py
MarcoFalke,2020-07-02 18:39:37,Isn't the point to test what the node sends out? I.e. test whether MAX_FILER or not was sent out?,https://github.com/bitcoin/bitcoin/pull/19423#discussion_r449203050,449203050,test/functional/p2p_ibd.py
glozow,2020-07-02 18:41:34,"Yep, feefilter is already tested - `MAX_FILTER` during IBD, then reset to normal after.\nI had been hoping to also test that they don't receive tx invs, but it seems more complicated than what I was doing originally.",https://github.com/bitcoin/bitcoin/pull/19423#discussion_r449204003,449204003,test/functional/p2p_ibd.py
glozow,2020-07-03 00:38:19,@MarcoFalke if you have time to check out https://github.com/bitcoin/bitcoin/pull/19423/commits/7bc653e7e3d21c675c6a1257f658222b97e166cb please let me know what you think :),https://github.com/bitcoin/bitcoin/pull/19423#discussion_r449323480,449323480,test/functional/p2p_ibd.py
jnewbery,2020-07-03 00:59:48,I'm worried that this might be intermittent. IsInitialBlockDownload is a latch. The first time it returns false causes it to return false on all subsequent calls. Is there a window between restarting the node and fastforwarding time with `setmocktime` where somthing could call `IsInitialBlockDownload()` and cause it to latch to false?,https://github.com/bitcoin/bitcoin/pull/19423#discussion_r449327609,449327609,test/functional/p2p_ibd_txrelay.py
glozow,2020-07-03 15:33:47,"Gooooooood point. A few ideas I have:\n1. Wondering if I can pass in an argument for `start` to get the test node to start up at a particular mocktime?\n2. I could... setmocktime backwards to begin with and maybe when it restarts, it'll be outdated from the get go?\n",https://github.com/bitcoin/bitcoin/pull/19423#discussion_r449636523,449636523,test/functional/p2p_ibd_txrelay.py
jnewbery,2020-07-03 15:43:03,"~1. I don't think there's a way to start a bitcoind node with a mocktime. It can only be set by an RPC after the node has started.~\n2. Yes, I think this would work!\n\nEDIT. You were right, I was wrong. You can start bitcoind with a `-mocktime`: https://github.com/bitcoin/bitcoin/blob/3276c148c4cac7b7c9adbaab5997b26488612085/src/init.cpp#L527",https://github.com/bitcoin/bitcoin/pull/19423#discussion_r449639667,449639667,test/functional/p2p_ibd_txrelay.py
jonatack,2020-07-03 17:01:45,"> I'm worried that this might be intermittent. IsInitialBlockDownload is a latch.\n\nYes, I'm seeing the test fail at that line.\n\nGreat stuff, will check out your next push asap @gzhao408!\n\n",https://github.com/bitcoin/bitcoin/pull/19423#discussion_r449661020,449661020,test/functional/p2p_ibd_txrelay.py
glozow,2020-07-03 17:31:35,"~Oo hmmmmm these args are only used in `test_framework.add_nodes` to instantiate the `TestNode` objects, and then can't be changed afterward. So I can't actually restart the node with a new `-mocktime`.~ Just kidding, I'm just struggling to make it work for some reason ðŸ˜‚ ",https://github.com/bitcoin/bitcoin/pull/19423#discussion_r449667159,449667159,test/functional/p2p_ibd_txrelay.py
glozow,2020-07-03 17:34:45,Not sure ðŸ¤” ,https://github.com/bitcoin/bitcoin/pull/19423#discussion_r449667698,449667698,test/functional/p2p_ibd_txrelay.py
MarcoFalke,2020-07-03 17:44:11,extra_args can be overwritten for start_node(s),https://github.com/bitcoin/bitcoin/pull/19423#discussion_r449669525,449669525,test/functional/p2p_ibd_txrelay.py
