[
  {
    "sha": "d9fb93da74b3e76871455feb649ea3157b7b9107",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpkOWZiOTNkYTc0YjNlNzY4NzE0NTVmZWI2NDllYTMxNTdiN2I5MTA3",
    "commit": {
      "author": {
        "name": "Robert Escriva",
        "email": "me@robescriva.com",
        "date": "2013-11-27T14:44:21Z"
      },
      "committer": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@gmail.com",
        "date": "2013-11-28T11:57:14Z"
      },
      "message": "Fix LevelDB 197 on OS X\n\nHere's the gist of what's going wrong:\n\n1.  PosixMmapFile is used for performing sequential writes.  Internally, it maps\n    regions of the file one after the other.  Each region is unmapped before the\n    next region is mapped.\n\n2.  In some circumstances on OS X, the unmapped data is not written to disk.\n\nThe fix is to perform a msync before the munmap on OS X, which seems to be where\nthis issue manifests itself most.\n\nNote:  Simply performing a write with the `sync' option is not a sufficient fix\n    because the sync will happen after the munmap.",
      "tree": {
        "sha": "be41c593dc1e61548a55d7f6eae58bab7c717dd8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/be41c593dc1e61548a55d7f6eae58bab7c717dd8"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d9fb93da74b3e76871455feb649ea3157b7b9107",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d9fb93da74b3e76871455feb649ea3157b7b9107",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/d9fb93da74b3e76871455feb649ea3157b7b9107",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d9fb93da74b3e76871455feb649ea3157b7b9107/comments",
    "author": {
      "login": "rescrv",
      "id": 1453649,
      "node_id": "MDQ6VXNlcjE0NTM2NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1453649?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rescrv",
      "html_url": "https://github.com/rescrv",
      "followers_url": "https://api.github.com/users/rescrv/followers",
      "following_url": "https://api.github.com/users/rescrv/following{/other_user}",
      "gists_url": "https://api.github.com/users/rescrv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rescrv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rescrv/subscriptions",
      "organizations_url": "https://api.github.com/users/rescrv/orgs",
      "repos_url": "https://api.github.com/users/rescrv/repos",
      "events_url": "https://api.github.com/users/rescrv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rescrv/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "4ae42d43a47ff4b004ac51cae043c4c9f0ee390e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4ae42d43a47ff4b004ac51cae043c4c9f0ee390e",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/4ae42d43a47ff4b004ac51cae043c4c9f0ee390e"
      }
    ],
    "stats": {
      "total": 5,
      "additions": 5,
      "deletions": 0
    },
    "files": [
      {
        "sha": "4106a04879b3c5c537310158ee109d8dee759590",
        "filename": "src/leveldb/util/env_posix.cc",
        "status": "modified",
        "additions": 5,
        "deletions": 0,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d9fb93da74b3e76871455feb649ea3157b7b9107/src/leveldb/util/env_posix.cc",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d9fb93da74b3e76871455feb649ea3157b7b9107/src/leveldb/util/env_posix.cc",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/leveldb/util/env_posix.cc?ref=d9fb93da74b3e76871455feb649ea3157b7b9107",
        "patch": "@@ -209,6 +209,11 @@ class PosixMmapFile : public WritableFile {\n   bool UnmapCurrentRegion() {\n     bool result = true;\n     if (base_ != NULL) {\n+#if defined(OS_MACOSX)\n+      if (msync(base_, limit_ - base_, MS_SYNC) != 0) {\n+        result = false;\n+      }\n+#endif\n       if (last_sync_ < limit_) {\n         // Defer syncing this data until next Sync() call, if any\n         pending_sync_ = true;"
      }
    ]
  }
]