[
  {
    "sha": "c30dd02cd893d2bc34779516a13ae7156d3f8ba7",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpjMzBkZDAyY2Q4OTNkMmJjMzQ3Nzk1MTZhMTNhZTcxNTZkM2Y4YmE3",
    "commit": {
      "author": {
        "name": "t-bast",
        "email": "bastuc@hotmail.fr",
        "date": "2021-05-11T07:58:13Z"
      },
      "committer": {
        "name": "t-bast",
        "email": "bastuc@hotmail.fr",
        "date": "2021-05-11T07:58:13Z"
      },
      "message": "refactor: remove redundant fOnlySafe argument\n\nThe fOnlySafe argument to AvailableCoins is now redundant, since #21359\nadded a similar field inside the CCoinControl struct.\n\nNot all code paths set a CCoinControl instance, but when it's missing we\ncan default to using only safe inputs which is backwards-compatible.",
      "tree": {
        "sha": "8dde577c6254bc6769da6705856a9b220bf43c2d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8dde577c6254bc6769da6705856a9b220bf43c2d"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c30dd02cd893d2bc34779516a13ae7156d3f8ba7",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEWmvUsbjhNg6Tzyflvl00KtNowToFAmCaORUACgkQvl00KtNo\nwTqrQhAArcNGrr/sRh3ekcakgl6a5xoiGgOWKwRB/NBUsD6E3vztKjdJTqRZLnmv\nrYHX82wxJqu4yJo6UaB+GMBhWCemCvW0qWP8D4QSBv5jf008J2iwVJDmKkIr7cjG\nMdFTiW1AbRbpLi0f36FpsXHMOzHf1HFlGGiPKy71toQ0olVanSzUFV/twqyxGONd\nPcdvwEf9ljCUDX+MD1WdsDrI0LsAdeUzRM62GOFqTxgJIcwQkSB0HVBFHl59FlOx\nXYv552Z/8VDyQGwu3faYLVFLEhg7AsFBJ2xDr/rPW4tr5b4Zdw8c6nZMNVHUS4Vv\nt/6e6UY7RfDNl/fSgh5Hig20YfVT8felq/us59boD+6BPyhNMEkF9q2MWtAols/k\nxwjN4IRh2aVw+2pgXTYpqBrGgqQd2fqOVoq4Hy/hpZ2X/AwArlZiFQNdoV4MbN+C\ntwKyQsSP3Wx2yOORNBF1MGOLh3bVyLgdGK60cOHcN2iVHKMf+6C8Bdvv4HMXssAc\nZvEzOXPJfypuiW7gUoEDMIn4DuxPzD8ebrvPrqMXto3ifT9ZdEp0+xQJqyqimOrr\n7i+1cwXh+F6CdPlQ2PReJKhFDMII9Pm2oecIL0SSBAOrqGE57rRjOEmstmN4JcKU\nuCMzh6luqu/EUJ0yT0T9K59SCFF7R+CxHndvZ2mRA9aCb+5Gs/8=\n=70ou\n-----END PGP SIGNATURE-----",
        "payload": "tree 8dde577c6254bc6769da6705856a9b220bf43c2d\nparent d2f6d2976f50e7944b1582f022c7ba8dfbc0bfa7\nauthor t-bast <bastuc@hotmail.fr> 1620719893 +0200\ncommitter t-bast <bastuc@hotmail.fr> 1620719893 +0200\n\nrefactor: remove redundant fOnlySafe argument\n\nThe fOnlySafe argument to AvailableCoins is now redundant, since #21359\nadded a similar field inside the CCoinControl struct.\n\nNot all code paths set a CCoinControl instance, but when it's missing we\ncan default to using only safe inputs which is backwards-compatible.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c30dd02cd893d2bc34779516a13ae7156d3f8ba7",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/c30dd02cd893d2bc34779516a13ae7156d3f8ba7",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c30dd02cd893d2bc34779516a13ae7156d3f8ba7/comments",
    "author": {
      "login": "t-bast",
      "id": 31281497,
      "node_id": "MDQ6VXNlcjMxMjgxNDk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/31281497?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/t-bast",
      "html_url": "https://github.com/t-bast",
      "followers_url": "https://api.github.com/users/t-bast/followers",
      "following_url": "https://api.github.com/users/t-bast/following{/other_user}",
      "gists_url": "https://api.github.com/users/t-bast/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/t-bast/subscriptions",
      "organizations_url": "https://api.github.com/users/t-bast/orgs",
      "repos_url": "https://api.github.com/users/t-bast/repos",
      "events_url": "https://api.github.com/users/t-bast/events{/privacy}",
      "received_events_url": "https://api.github.com/users/t-bast/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "t-bast",
      "id": 31281497,
      "node_id": "MDQ6VXNlcjMxMjgxNDk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/31281497?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/t-bast",
      "html_url": "https://github.com/t-bast",
      "followers_url": "https://api.github.com/users/t-bast/followers",
      "following_url": "https://api.github.com/users/t-bast/following{/other_user}",
      "gists_url": "https://api.github.com/users/t-bast/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/t-bast/subscriptions",
      "organizations_url": "https://api.github.com/users/t-bast/orgs",
      "repos_url": "https://api.github.com/users/t-bast/repos",
      "events_url": "https://api.github.com/users/t-bast/events{/privacy}",
      "received_events_url": "https://api.github.com/users/t-bast/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "d2f6d2976f50e7944b1582f022c7ba8dfbc0bfa7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d2f6d2976f50e7944b1582f022c7ba8dfbc0bfa7",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/d2f6d2976f50e7944b1582f022c7ba8dfbc0bfa7"
      }
    ],
    "stats": {
      "total": 14,
      "additions": 8,
      "deletions": 6
    },
    "files": [
      {
        "sha": "7062be6a48d1599f8399d3d9fe82812b356950c1",
        "filename": "src/wallet/rpcwallet.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c30dd02cd893d2bc34779516a13ae7156d3f8ba7/src/wallet/rpcwallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c30dd02cd893d2bc34779516a13ae7156d3f8ba7/src/wallet/rpcwallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcwallet.cpp?ref=c30dd02cd893d2bc34779516a13ae7156d3f8ba7",
        "patch": "@@ -2970,8 +2970,9 @@ static RPCHelpMan listunspent()\n         cctl.m_avoid_address_reuse = false;\n         cctl.m_min_depth = nMinDepth;\n         cctl.m_max_depth = nMaxDepth;\n+        cctl.m_include_unsafe_inputs = include_unsafe;\n         LOCK(pwallet->cs_wallet);\n-        pwallet->AvailableCoins(vecOutputs, !include_unsafe, &cctl, nMinimumAmount, nMaximumAmount, nMinimumSumAmount, nMaximumCount);\n+        pwallet->AvailableCoins(vecOutputs, &cctl, nMinimumAmount, nMaximumAmount, nMinimumSumAmount, nMaximumCount);\n     }\n \n     LOCK(pwallet->cs_wallet);"
      },
      {
        "sha": "456c26ea31e53bd3fca1fc5a15d125c614ad0439",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 4,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c30dd02cd893d2bc34779516a13ae7156d3f8ba7/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c30dd02cd893d2bc34779516a13ae7156d3f8ba7/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=c30dd02cd893d2bc34779516a13ae7156d3f8ba7",
        "patch": "@@ -2197,7 +2197,7 @@ CAmount CWallet::GetAvailableBalance(const CCoinControl* coinControl) const\n \n     CAmount balance = 0;\n     std::vector<COutput> vCoins;\n-    AvailableCoins(vCoins, true, coinControl);\n+    AvailableCoins(vCoins, coinControl);\n     for (const COutput& out : vCoins) {\n         if (out.fSpendable) {\n             balance += out.tx->tx->vout[out.i].nValue;\n@@ -2206,7 +2206,7 @@ CAmount CWallet::GetAvailableBalance(const CCoinControl* coinControl) const\n     return balance;\n }\n \n-void CWallet::AvailableCoins(std::vector<COutput>& vCoins, bool fOnlySafe, const CCoinControl* coinControl, const CAmount& nMinimumAmount, const CAmount& nMaximumAmount, const CAmount& nMinimumSumAmount, const uint64_t nMaximumCount) const\n+void CWallet::AvailableCoins(std::vector<COutput>& vCoins, const CCoinControl* coinControl, const CAmount& nMinimumAmount, const CAmount& nMaximumAmount, const CAmount& nMinimumSumAmount, const uint64_t nMaximumCount) const\n {\n     AssertLockHeld(cs_wallet);\n \n@@ -2217,6 +2217,7 @@ void CWallet::AvailableCoins(std::vector<COutput>& vCoins, bool fOnlySafe, const\n     bool allow_used_addresses = !IsWalletFlagSet(WALLET_FLAG_AVOID_REUSE) || (coinControl && !coinControl->m_avoid_address_reuse);\n     const int min_depth = {coinControl ? coinControl->m_min_depth : DEFAULT_MIN_DEPTH};\n     const int max_depth = {coinControl ? coinControl->m_max_depth : DEFAULT_MAX_DEPTH};\n+    const bool only_safe = {coinControl ? !coinControl->m_include_unsafe_inputs : true};\n \n     std::set<uint256> trusted_parents;\n     for (const auto& entry : mapWallet)\n@@ -2273,7 +2274,7 @@ void CWallet::AvailableCoins(std::vector<COutput>& vCoins, bool fOnlySafe, const\n             safeTx = false;\n         }\n \n-        if (fOnlySafe && !safeTx) {\n+        if (only_safe && !safeTx) {\n             continue;\n         }\n \n@@ -2843,7 +2844,7 @@ bool CWallet::CreateTransactionInternal(\n         txNew.nLockTime = GetLocktimeForNewTransaction(chain(), GetLastBlockHash(), GetLastBlockHeight());\n         {\n             std::vector<COutput> vAvailableCoins;\n-            AvailableCoins(vAvailableCoins, !coin_control.m_include_unsafe_inputs, &coin_control, 1, MAX_MONEY, MAX_MONEY, 0);\n+            AvailableCoins(vAvailableCoins, &coin_control, 1, MAX_MONEY, MAX_MONEY, 0);\n             CoinSelectionParams coin_selection_params; // Parameters for coin selection, init with dummy\n             coin_selection_params.m_avoid_partial_spends = coin_control.m_avoid_partial_spends;\n "
      },
      {
        "sha": "5a36d92784ea50d9e3b4f38916c641957c41079c",
        "filename": "src/wallet/wallet.h",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c30dd02cd893d2bc34779516a13ae7156d3f8ba7/src/wallet/wallet.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c30dd02cd893d2bc34779516a13ae7156d3f8ba7/src/wallet/wallet.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.h?ref=c30dd02cd893d2bc34779516a13ae7156d3f8ba7",
        "patch": "@@ -850,7 +850,7 @@ class CWallet final : public WalletStorage, public interfaces::Chain::Notificati\n     /**\n      * populate vCoins with vector of available COutputs.\n      */\n-    void AvailableCoins(std::vector<COutput>& vCoins, bool fOnlySafe = true, const CCoinControl* coinControl = nullptr, const CAmount& nMinimumAmount = 1, const CAmount& nMaximumAmount = MAX_MONEY, const CAmount& nMinimumSumAmount = MAX_MONEY, const uint64_t nMaximumCount = 0) const EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n+    void AvailableCoins(std::vector<COutput>& vCoins, const CCoinControl* coinControl = nullptr, const CAmount& nMinimumAmount = 1, const CAmount& nMaximumAmount = MAX_MONEY, const CAmount& nMinimumSumAmount = MAX_MONEY, const uint64_t nMaximumCount = 0) const EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n \n     /**\n      * Return list of available coins and locked coins grouped by non-change output address."
      }
    ]
  }
]