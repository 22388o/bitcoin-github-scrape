randolf,2018-03-23T14:24:14Z,@ctp-tsteenholdt Please remember to squash/rebase.,https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-375681449,375681449,
ghost,2018-03-23T14:57:42Z,@randolf That makes total sense. My apologies - looking into it right now...,https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-375692307,375692307,
laanwj,2018-03-26T19:36:22Z,"We already have a `bitcoind.service` in `contrib/init/` - what is the difference with this one, can we avoid duplicating it?",https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-376285682,376285682,
ghost,2018-03-26T19:37:39Z,@randolf The pull request should look better now - please let me know if I'm missing something.,https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-376286084,376286084,
ghost,2018-03-27T11:02:36Z,"@laanwj I'm completely with you on that question, but I don't think we can feasibly avoid multiple versions of a file like this. The different versions of the `bitcoind.service` in the `contrib/` tree have subtle differences to make them work best for their particular purpose. The differences reflect distro-specifics such as location of environment files, dependency services etc.\n\nAlso, buildi",https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-376484636,376484636,
laanwj,2018-03-27T14:16:11Z,"@ctp-tsteenholdt If it is intentional, then IMO it's not a problem. Arguably the debian-specific file is easier to maintain because at least it aims for a specific environment and can be tested there, not 'all distributions in general', which has made the file under `contrib/init/` a real pain in practice (see e.g. discussion in #12255).",https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-376541442,376541442,
ghost,2018-03-27T15:03:50Z,@laanwj That's exactly right.,https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-376559096,376559096,
laanwj,2018-03-28T11:30:20Z,Would be good to have an ACK from @TheBlueMatt here.,https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-376854091,376854091,
ghost,2018-03-28T21:45:27Z,Thanks @TheBlueMatt. Each of your comments make perfect sense and I'll have them all addressed.,https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-377047866,377047866,
ghost,2018-03-29T16:45:59Z,"I've addressed the suggestions made by @TheBlueMatt, run a test dpkg-buildpackage using the updated `contrib/debian/` tree and tested that the package changes work as expected, with success.\n\nThe commits have been updated to reflect the changes.",https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-377298043,377298043,
laanwj,2018-04-07T13:55:49Z,"@TheBlueMatt can you take another look?\nWould be good to get this merged, I think.",https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-379471130,379471130,
TheBlueMatt,2018-04-17T19:12:14Z,"Hmm, if you're gonna pull some of the debian changes upstream, can you just pull all of them? Especially getting the changelog and other stuff out of sync seems not ideal.",https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-382108445,382108445,
ghost,2018-04-18T14:38:40Z,"@TheBlueMatt I'm not sure what you mean by:\n\n_Hmm, if you're gonna pull some of the debian changes upstream, can you just pull all of them? Especially getting the changelog and other stuff out of sync seems not ideal._\n\nUpstream in this case would essentially be your PPA right? Or is there somewhere else?\n\nI can certainly take a look at any other differences between this tree and yours",https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-382410174,382410174,
TheBlueMatt,2018-04-18T14:42:06Z,"Yea, just pull the stuff from the PPA's debian tar.",https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-382411351,382411351,
ghost,2018-04-18T15:22:21Z,Alright - I'm looking in to it...,https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-382425505,382425505,
ghost,2018-04-18T19:26:47Z,"@TheBlueMatt so I took all the changes from your upstream PPA debian tar and committed them as a single commit. After that, I committed the Systemd changes in a separate commit.\n\nAs a precaution I've run a local build and made sure that things still work as expected.",https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-382501563,382501563,
ghost,2018-04-20T10:40:50Z,So I re-resolved the conflict with #12854. This time without nuking the accepted changes of that PR. Sorry about that. Thanks @fanquake for the heads up.,https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-383057943,383057943,
laanwj,2018-04-26T18:48:56Z,@TheBlueMatt is this now ready for merge?,https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-384751109,384751109,
ghost,2018-04-26T21:43:08Z,"Just tested on Ubuntu 18.04, with no issues related to this PR. There is an unrelated issue with the `libdb++` version that needs to be sorted out, so I built with `--with-incompatible-bdb` to test things out.",https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-384798306,384798306,
TheBlueMatt,2018-04-27T18:53:53Z,utACK 2a87b1b07c5c4f8b9b34747c5f254c2ae1e824bf with or without restart-after-upgrade.,https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-385062355,385062355,
luke-jr,2018-04-27T21:05:08Z,How will this affect systems that don't have/use systemd?,https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-385093925,385093925,
ghost,2018-04-28T00:07:45Z,@luke-jr this affects only debian-based systems (including Ubuntu) with systemd.,https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-385122854,385122854,
TheBlueMatt,2018-04-28T00:20:43Z,"I believe @luke-jr's question was ""what about older but still supported Debian-based systems that do not have systemd"", which is a good one. WIll this not result in them failing to build the packages?",https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-385124217,385124217,
ghost,2018-04-28T00:47:54Z,"Older debian systems that are missing the `dh-systemd` package, will fail to build the packages, yes. I believe the (supported) Debian/Ubuntu versions that are affected by this, are Debian 7 (LTS version is EOL at the end of May 2018) and Ubuntu 14.04 LTS (EOL in April 2019).\n\nI'm running a test on Ubuntu 14.04 right now, to see what kind of issues we're running into on that platform.",https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-385126624,385126624,
ghost,2018-04-28T01:57:36Z,"As it turns out, Ubuntu 14.04 LTS actually does have a `dh-systemd` package and apart from the `libdb4.8++-dev` build dependency, that was also causing problems on Ubuntu 18.04, the build is working just fine.\n\nSince the distro does not actually use systemd, the included `bitcoind.service` simply does nothing.\n\nFWIW, Debian 7 also has a `dh-systemd` package (in the backports repository), s",https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-385131501,385131501,
luke-jr,2018-04-28T02:59:16Z,"I'm less concerned with merely old distros, as much as ones that have simply rejected the mandatory-systemd nonsense, such as Devuan.",https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-385134999,385134999,
ghost,2018-04-28T08:28:00Z,"@luke-jr to build the package, you'd need to have `dh-systemd` installed, but you do *not* need `systemd` to install or use it. If you don't have `systemd` on the system, you simply can't use the systemd service configuration that's included here.",https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-385152667,385152667,
ghost,2018-05-01T13:45:28Z,Did that last comment answer your questions?,https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-385674024,385674024,
laanwj,2018-05-01T14:52:37Z,"I'm going to merge this as @TheBlueMatt utACKed this - he's the ppa maintainer. \nI don't think other distributions are relevant here as this concerns explicitly the `debian` directory.\nOther improvements can be made later.",https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-385690313,385690313,
TheBlueMatt,2018-05-01T14:53:55Z,"Err, no, Luke's point is good and would break several PPA-supported releases.\n\nOn May 1, 2018 2:52:47 PM UTC, ""Wladimir J. van der Laan"" <notifications@github.com> wrote:\n>I'm going to merge this as @TheBlueMatt utACKed this - he's the ppa\n>maintainer. \n>I don't think other distributions are relevant here as this concerns\n>explicitly the `debian` directory.\n>Other improvements can be made l",https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-385690655,385690655,
TheBlueMatt,2018-05-01T15:04:44Z,"Oh, hmm, I appears to be wrong, it looks like the dh-systemd package *is* on trusty, I suppose its fine, then.",https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-385693735,385693735,
laanwj,2018-05-01T15:38:19Z,"Had to revert this, please file again in 2019 (or whenever relevant).",https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-385702459,385702459,
ghost,2018-05-01T15:38:20Z,"@laanwj, as @TheBlueMatt mentions in his followup, `dh-systemd` is indeed available on the relevant distributions - It certainly is on all supported versions of Ubuntu, Debian and Devuan. I can't see a reason to hold off on the merge?",https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-385702465,385702465,
laanwj,2018-05-01T16:15:40Z,"After discussion on IRC we're switching to a different strategy, distribution packaging files will be under this repository from now on:\nhttps://github.com/bitcoin-core/packaging\n(see also #13137)",https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-385712472,385712472,
ghost,2018-05-01T16:28:10Z,Okay... Does this mean I should rework the changes to go in the new path then?,https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-385715832,385715832,
MarcoFalke,2018-05-01T16:54:28Z,"Indeed, just cherry-pick the commits and submit them to the other repo.",https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-385722644,385722644,
ghost,2018-05-02T12:21:04Z,Thanks. I've created https://github.com/bitcoin-core/packaging/pull/1 with exact same changes...,https://github.com/bitcoin/bitcoin/pull/12769#issuecomment-385959128,385959128,
TheBlueMatt,2018-03-28T17:54:10Z,Maybe make it explicit that they should check /var/lib/bitcoin for things like wallets?,https://github.com/bitcoin/bitcoin/pull/12769#discussion_r177836750,177836750,contrib/debian/bitcoind.postrm
TheBlueMatt,2018-03-28T17:54:51Z,May be nice to make the datadir explicit so that we dont have /var/lib/bitcoin/.bitcoin and instead just put stuff in /var/lib/bitcoin?,https://github.com/bitcoin/bitcoin/pull/12769#discussion_r177836978,177836978,contrib/debian/bitcoind.service
TheBlueMatt,2018-03-28T17:56:14Z,Can you pull the backporting of existing debian/ contents out into a separate commit to make it easier to track?,https://github.com/bitcoin/bitcoin/pull/12769#discussion_r177837443,177837443,contrib/debian/rules
TheBlueMatt,2018-04-17T19:13:59Z,"Why not create the directory? If its empty it will be deleted on uninstall, but if ther user ever tries to use the service things will simply fail to start, no?",https://github.com/bitcoin/bitcoin/pull/12769#discussion_r182195159,182195159,contrib/debian/bitcoind.postinst
,2018-04-18T14:25:58Z,"The reason for this approach is that, if for whatever reason the user has changed ownership or permissions on the `/var/lib/bitcoin` directory, we don't want to mess with that on operations like reconfigure, update etc.\n\n`adduser` does not let me specify custom homedir permissions, so I'm using `--no-create-home` to work around that. A missing home directory becomes a stable indicator that thi",https://github.com/bitcoin/bitcoin/pull/12769#discussion_r182446347,182446347,contrib/debian/bitcoind.postinst
TheBlueMatt,2018-04-18T14:41:56Z,"Oh, I misread the script, sorry.",https://github.com/bitcoin/bitcoin/pull/12769#discussion_r182452558,182452558,contrib/debian/bitcoind.postinst
fanquake,2018-04-20T01:50:42Z,These additional categories were just added in #12854,https://github.com/bitcoin/bitcoin/pull/12769#discussion_r182928535,182928535,contrib/debian/bitcoin-qt.desktop
,2018-04-20T09:43:35Z,@fanquake thanks. I'll get that sorted out here...,https://github.com/bitcoin/bitcoin/pull/12769#discussion_r182999455,182999455,contrib/debian/bitcoin-qt.desktop
TheBlueMatt,2018-04-27T18:21:28Z,"Why? I dont think anyone would be surprised by their bitcoind going down prior to upgrade instead of only being restarted, and this could break eg a lxc VM as you'll get a text file busy error.",https://github.com/bitcoin/bitcoin/pull/12769#discussion_r184768854,184768854,contrib/debian/rules
,2018-04-27T18:50:18Z,"@TheBlueMatt, good point.\n\n`--restart-after-upgrade` is default in `dh_systemd_start` from compat level 10, so the reason is perhaps best described as emulating modern defaults. I agree that for bitcoind, there should not be any real issues with using the defaults.\n\nI don't quite follow the problems you mention though. As far as I can tell, an upgrade should work perfectly, even when leavi",https://github.com/bitcoin/bitcoin/pull/12769#discussion_r184776571,184776571,contrib/debian/rules
TheBlueMatt,2018-04-27T18:52:55Z,"Eh, if its default whatever, but linux generally refuses to replace binaries on disk if they are running inside of an LXC/docker container (though will happily do so during normal operation).",https://github.com/bitcoin/bitcoin/pull/12769#discussion_r184777239,184777239,contrib/debian/rules
,2018-04-27T19:21:27Z,"Got it. I've never run into that problem, but haven't really come across a situation where such a setup would be needed. I tend to want to install apps like `bitcoind` inside my containers, in which case this would not be an issue.\n\nBut if I wanted this kind of setup, I imagine I'd leave `bitcoind` disabled on the host and only start the service inside the container, right?\n\nIf this is tru",https://github.com/bitcoin/bitcoin/pull/12769#discussion_r184784042,184784042,contrib/debian/rules
