practicalswift,2017-10-30T13:51:07Z,Friendly ping @sdaftuar: does this look correct? :-),https://github.com/bitcoin/bitcoin/pull/11578#issuecomment-340449643,340449643,
promag,2017-10-30T14:20:18Z,"~~One of the calls already has the lock, should instead assert the lock is held and add the other lock before?~~\nhttps://github.com/bitcoin/bitcoin/blob/bb9ab0fccfbadd5c032a2cd0bb3135049cffa42b/src/net_processing.cpp#L2524\n\nEdit: sorry, after all none of the calls have the lock.",https://github.com/bitcoin/bitcoin/pull/11578#issuecomment-340458224,340458224,
sdaftuar,2017-10-30T14:25:50Z,"@promag I think neither caller of `ProcessHeadersMessage()` is holding `cs_main` (and they shouldn't be, either).",https://github.com/bitcoin/bitcoin/pull/11578#issuecomment-340459971,340459971,
promag,2017-10-30T14:33:29Z,Maybe `ProcessNewBlockHeaders` should return the first invalid block index instead? (not the same as the fist invalid block header),https://github.com/bitcoin/bitcoin/pull/11578#issuecomment-340462299,340462299,
promag,2017-10-30T14:34:41Z,"> @promag I think neither caller of ProcessHeadersMessage() is holding cs_main (and they shouldn't be, either).\n\n@sdaftuar yes, missed a `}` while scrolling the code.",https://github.com/bitcoin/bitcoin/pull/11578#issuecomment-340462704,340462704,
sdaftuar,2017-10-30T14:35:04Z,@promag The first invalid block header may not have been added to mapBlockIndex.,https://github.com/bitcoin/bitcoin/pull/11578#issuecomment-340462836,340462836,
promag,2017-10-30T14:46:27Z,"Right. Anyway, something like #11041 can easily prevent these cases.",https://github.com/bitcoin/bitcoin/pull/11578#issuecomment-340466476,340466476,
practicalswift,2017-10-30T19:01:31Z,@sdaftuar Thanks for the review. The two locks are now merged into one as suggested :-),https://github.com/bitcoin/bitcoin/pull/11578#issuecomment-340550327,340550327,
achow101,2017-10-30T19:03:27Z,utACK 2530bf27b72e53cc6ffec27de35f3b487984833d,https://github.com/bitcoin/bitcoin/pull/11578#issuecomment-340550916,340550916,
TheBlueMatt,2017-10-30T23:06:58Z,utACK 2530bf27b72e53cc6ffec27de35f3b487984833d,https://github.com/bitcoin/bitcoin/pull/11578#issuecomment-340611467,340611467,
laanwj,2017-11-01T20:06:10Z,This should be backported after #11568.,https://github.com/bitcoin/bitcoin/pull/11578#issuecomment-341224616,341224616,
sdaftuar,2017-10-30T14:16:15Z,"I think we can move this up to above the `if (nDoS > 0)` line, and then remove the `LOCK(cs_main)` that's inside that block?",https://github.com/bitcoin/bitcoin/pull/11578#discussion_r147714347,147714347,src/net_processing.cpp
