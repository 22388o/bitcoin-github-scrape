[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/688444546",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#issuecomment-688444546",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19910",
    "id": 688444546,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4ODQ0NDU0Ng==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-07T17:18:04Z",
    "updated_at": "2020-09-07T17:18:04Z",
    "author_association": "MEMBER",
    "body": "Requested by @MarcoFalke @sdaftuar and @theuni . Review very much appreciated :pray: ",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/688444546/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/688467825",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#issuecomment-688467825",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19910",
    "id": 688467825,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4ODQ2NzgyNQ==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-07T18:34:00Z",
    "updated_at": "2020-09-07T18:34:00Z",
    "author_association": "MEMBER",
    "body": "Concept ACK.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/688467825/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/688482583",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#issuecomment-688482583",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19910",
    "id": 688482583,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4ODQ4MjU4Mw==",
    "user": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?u=5ff13e375b40ea55ecd3c108337dd6a23f68eddf&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-07T19:23:42Z",
    "updated_at": "2020-09-07T19:23:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "Concept ACK: decoupling is good!",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/688482583/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/689404986",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#issuecomment-689404986",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19910",
    "id": 689404986,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4OTQwNDk4Ng==",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?u=4a9af998e1a560b3f49c3827f453e1bcbe6a5cfb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-09T08:14:08Z",
    "updated_at": "2020-09-09T08:14:08Z",
    "author_association": "MEMBER",
    "body": "Concept ACK.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/689404986/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/695215523",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#issuecomment-695215523",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19910",
    "id": 695215523,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5NTIxNTUyMw==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-19T13:46:28Z",
    "updated_at": "2020-12-07T20:21:37Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20295 (rpc: getblockfrompeer by Sjors)\n* #20217 (net: Remove g_relay_txes by jnewbery)\n* #19858 (Periodically make block-relay connections and sync headers by sdaftuar)\n* #19829 (net processing: Move block inventory state to net_processing by jnewbery)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/695215523/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/705473240",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#issuecomment-705473240",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19910",
    "id": 705473240,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNTQ3MzI0MA==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-08T10:13:51Z",
    "updated_at": "2020-10-08T10:13:51Z",
    "author_association": "MEMBER",
    "body": "Thanks for the review @theuni. I've addressed your comment.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/705473240/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/711808191",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#issuecomment-711808191",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19910",
    "id": 711808191,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxMTgwODE5MQ==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-19T08:10:52Z",
    "updated_at": "2020-10-19T08:10:52Z",
    "author_association": "MEMBER",
    "body": "Rebased",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/711808191/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/730303039",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#issuecomment-730303039",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19910",
    "id": 730303039,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMDMwMzAzOQ==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-19T11:14:36Z",
    "updated_at": "2020-11-19T11:14:36Z",
    "author_association": "MEMBER",
    "body": "Rebased",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/730303039/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/736503375",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#issuecomment-736503375",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19910",
    "id": 736503375,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczNjUwMzM3NQ==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-01T11:54:30Z",
    "updated_at": "2020-12-01T11:54:30Z",
    "author_association": "MEMBER",
    "body": "rebased",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/736503375/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/738126619",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#issuecomment-738126619",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19910",
    "id": 738126619,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczODEyNjYxOQ==",
    "user": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?u=62e3204f6586795420395a7059ec7dc7c4a40c7d&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-03T16:39:38Z",
    "updated_at": "2020-12-03T16:39:38Z",
    "author_association": "CONTRIBUTOR",
    "body": "Code Review ACK aedd418\r\n\r\n-----\r\n\r\nPrivate members >> Anon-namespaced statics/functions\r\n\r\nEspecially when the functionality is strongly intertwined with the class of which it's being made a member.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/738126619/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/738743686",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#issuecomment-738743686",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19910",
    "id": 738743686,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczODc0MzY4Ng==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-04T11:55:01Z",
    "updated_at": "2020-12-04T11:55:01Z",
    "author_association": "MEMBER",
    "body": "Rebased and addressed outstanding review comments.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/738743686/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/739880094",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#issuecomment-739880094",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19910",
    "id": 739880094,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczOTg4MDA5NA==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-07T12:12:04Z",
    "updated_at": "2020-12-07T12:12:04Z",
    "author_association": "MEMBER",
    "body": "Thanks for the review @hebasto @promag @theuni and @dongcarl. I've addressed all comments, so this should now be ready for re-review.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/739880094/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/740894306",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#issuecomment-740894306",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19910",
    "id": 740894306,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0MDg5NDMwNg==",
    "user": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-08T19:23:55Z",
    "updated_at": "2020-12-08T19:23:55Z",
    "author_association": "MEMBER",
    "body": "Re-ACK 3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/740894306/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/741760526",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#issuecomment-741760526",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19910",
    "id": 741760526,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0MTc2MDUyNg==",
    "user": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?u=62e3204f6586795420395a7059ec7dc7c4a40c7d&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-09T13:11:18Z",
    "updated_at": "2020-12-09T13:11:18Z",
    "author_association": "CONTRIBUTOR",
    "body": "Re-ACK 3025ca9\r\n\r\n-----\r\n\r\n1. Disambiguated between nullptr and empty shared_ptr\r\n2. Reverted refactoring in PeerManager::GetPeerRef\r\n3. Made `Peer` constructor `explicit`",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/741760526/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484529215",
    "pull_request_review_id": 483673436,
    "id": 484529215,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUyOTIxNQ==",
    "diff_hunk": "@@ -156,7 +156,10 @@ static UniValue getpeerinfo(const JSONRPCRequest& request)\n     for (const CNodeStats& stats : vstats) {\n         UniValue obj(UniValue::VOBJ);\n         CNodeStateStats statestats;\n-        bool fStateStats = GetNodeStateStats(stats.nodeid, statestats);\n+        bool fStateStats{false};\n+        if (node.peerman) {",
    "path": "src/rpc/net.cpp",
    "position": null,
    "original_position": 6,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "e0b0d0c5648cf79ab563225fb1947a95dcb0373d",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "It is currently not possible to not have `node.peerman`. I think an `Ensure..()` like `EnsureMempool` would be good. It doesn't really make sense to call `getpeerinfo` without a peerman anyway?",
    "created_at": "2020-09-07T17:25:02Z",
    "updated_at": "2020-12-07T12:00:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r484529215",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484529215"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r484529215"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484529215/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 160,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484529374",
    "pull_request_review_id": 483673436,
    "id": 484529374,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUyOTM3NA==",
    "diff_hunk": "@@ -93,7 +126,14 @@ class PeerManager final : public CValidationInterface, public NetEventsInterface\n      */\n     void Misbehaving(const NodeId pnode, const int howmuch, const std::string& message);\n \n+    /** Get statistics from node state */\n+    bool GetNodeStateStats(NodeId nodeid, CNodeStateStats &stats);",
    "path": "src/net_processing.h",
    "position": null,
    "original_position": 45,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "e0b0d0c5648cf79ab563225fb1947a95dcb0373d",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\n    bool GetNodeStateStats(NodeId nodeid, CNodeStateStats& stats);\r\n```\r\n\r\nnit for new code",
    "created_at": "2020-09-07T17:25:42Z",
    "updated_at": "2020-12-07T12:00:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r484529374",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484529374"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r484529374"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484529374/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 130,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484537675",
    "pull_request_review_id": 483681660,
    "id": 484537675,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUzNzY3NQ==",
    "diff_hunk": "@@ -156,7 +156,10 @@ static UniValue getpeerinfo(const JSONRPCRequest& request)\n     for (const CNodeStats& stats : vstats) {\n         UniValue obj(UniValue::VOBJ);\n         CNodeStateStats statestats;\n-        bool fStateStats = GetNodeStateStats(stats.nodeid, statestats);\n+        bool fStateStats{false};\n+        if (node.peerman) {",
    "path": "src/rpc/net.cpp",
    "position": null,
    "original_position": 6,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "e0b0d0c5648cf79ab563225fb1947a95dcb0373d",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I've done something slightly different and checked existence at the top of this function. Let me know what you think.",
    "created_at": "2020-09-07T18:08:44Z",
    "updated_at": "2020-12-07T12:00:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r484537675",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484537675"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r484537675"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484537675/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 160,
    "side": "RIGHT",
    "in_reply_to_id": 484529215
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484537830",
    "pull_request_review_id": 483681814,
    "id": 484537830,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUzNzgzMA==",
    "diff_hunk": "@@ -93,7 +126,14 @@ class PeerManager final : public CValidationInterface, public NetEventsInterface\n      */\n     void Misbehaving(const NodeId pnode, const int howmuch, const std::string& message);\n \n+    /** Get statistics from node state */\n+    bool GetNodeStateStats(NodeId nodeid, CNodeStateStats &stats);",
    "path": "src/net_processing.h",
    "position": null,
    "original_position": 45,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "e0b0d0c5648cf79ab563225fb1947a95dcb0373d",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "fixed. Thanks!",
    "created_at": "2020-09-07T18:09:37Z",
    "updated_at": "2020-12-07T12:00:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r484537830",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484537830"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r484537830"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484537830/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 130,
    "side": "RIGHT",
    "in_reply_to_id": 484529374
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484785195",
    "pull_request_review_id": 483963562,
    "id": 484785195,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDc4NTE5NQ==",
    "diff_hunk": "@@ -146,6 +176,16 @@ class PeerManager final : public CValidationInterface, public NetEventsInterface\n     CTxMemPool& m_mempool;\n \n     int64_t m_stale_tip_check_time; //!< Next time to check for stale tip\n+\n+    /** Protects m_peer_map */\n+    Mutex m_peer_mutex;\n+    /**\n+     * Map of all Peer objects, keyed by peer id. This map is protected\n+     * by the global m_peer_mutex. Once a shared pointer reference is",
    "path": "src/net_processing.h",
    "position": null,
    "original_position": 53,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "322e87b6039877ed3457baea93cc87d78f3f4d96",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "322e87b6039877ed3457baea93cc87d78f3f4d96\r\n```suggestion\r\n     * by the m_peer_mutex. Once a shared pointer reference is\r\n```",
    "created_at": "2020-09-08T09:36:28Z",
    "updated_at": "2020-12-07T12:00:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r484785195",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484785195"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r484785195"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484785195/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 184,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484785821",
    "pull_request_review_id": 483963562,
    "id": 484785821,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDc4NTgyMQ==",
    "diff_hunk": "@@ -146,6 +176,16 @@ class PeerManager final : public CValidationInterface, public NetEventsInterface\n     CTxMemPool& m_mempool;\n \n     int64_t m_stale_tip_check_time; //!< Next time to check for stale tip\n+\n+    /** Protects m_peer_map */",
    "path": "src/net_processing.h",
    "position": 78,
    "original_position": 49,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "322e87b6039877ed3457baea93cc87d78f3f4d96",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "322e87b6039877ed3457baea93cc87d78f3f4d96\r\nnit: This comment duplicates the code :) Consider to drop it.",
    "created_at": "2020-09-08T09:37:33Z",
    "updated_at": "2020-12-07T12:00:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r484785821",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484785821"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r484785821"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484785821/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 199,
    "original_line": 199,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484816918",
    "pull_request_review_id": 484004756,
    "id": 484816918,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDgxNjkxOA==",
    "diff_hunk": "@@ -146,6 +176,16 @@ class PeerManager final : public CValidationInterface, public NetEventsInterface\n     CTxMemPool& m_mempool;\n \n     int64_t m_stale_tip_check_time; //!< Next time to check for stale tip\n+\n+    /** Protects m_peer_map */\n+    Mutex m_peer_mutex;\n+    /**\n+     * Map of all Peer objects, keyed by peer id. This map is protected\n+     * by the global m_peer_mutex. Once a shared pointer reference is",
    "path": "src/net_processing.h",
    "position": null,
    "original_position": 53,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "322e87b6039877ed3457baea93cc87d78f3f4d96",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "good catch. Fixed.",
    "created_at": "2020-09-08T10:32:10Z",
    "updated_at": "2020-12-07T12:00:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r484816918",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484816918"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r484816918"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484816918/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 184,
    "side": "RIGHT",
    "in_reply_to_id": 484785195
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484817325",
    "pull_request_review_id": 484005300,
    "id": 484817325,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDgxNzMyNQ==",
    "diff_hunk": "@@ -146,6 +176,16 @@ class PeerManager final : public CValidationInterface, public NetEventsInterface\n     CTxMemPool& m_mempool;\n \n     int64_t m_stale_tip_check_time; //!< Next time to check for stale tip\n+\n+    /** Protects m_peer_map */",
    "path": "src/net_processing.h",
    "position": 78,
    "original_position": 49,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "322e87b6039877ed3457baea93cc87d78f3f4d96",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Normally I'd agree with removing unnecessary commenting, but I think it's useful for every member variable to have a doxygen comment. Happy to go either way if others think it should be dropped.",
    "created_at": "2020-09-08T10:32:57Z",
    "updated_at": "2020-12-07T12:00:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r484817325",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484817325"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r484817325"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484817325/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 199,
    "original_line": 199,
    "side": "RIGHT",
    "in_reply_to_id": 484785821
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484838191",
    "pull_request_review_id": 484031953,
    "id": 484838191,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDgzODE5MQ==",
    "diff_hunk": "@@ -146,6 +176,16 @@ class PeerManager final : public CValidationInterface, public NetEventsInterface\n     CTxMemPool& m_mempool;\n \n     int64_t m_stale_tip_check_time; //!< Next time to check for stale tip\n+\n+    /** Protects m_peer_map */",
    "path": "src/net_processing.h",
    "position": 78,
    "original_position": 49,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "322e87b6039877ed3457baea93cc87d78f3f4d96",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I'm for keeping it, it's better for consistency to have a comment for every one.",
    "created_at": "2020-09-08T11:14:10Z",
    "updated_at": "2020-12-07T12:00:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r484838191",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484838191"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r484838191"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484838191/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 199,
    "original_line": 199,
    "side": "RIGHT",
    "in_reply_to_id": 484785821
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484981819",
    "pull_request_review_id": 484220356,
    "id": 484981819,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk4MTgxOQ==",
    "diff_hunk": "@@ -105,11 +105,13 @@ class NodeImpl : public Node\n             }\n \n             // Try to retrieve the CNodeStateStats for each node.\n-            TRY_LOCK(::cs_main, lockMain);\n-            if (lockMain) {\n-                for (auto& node_stats : stats) {\n-                    std::get<1>(node_stats) =\n-                        GetNodeStateStats(std::get<0>(node_stats).nodeid, std::get<2>(node_stats));\n+            if (m_context->peerman) {\n+                TRY_LOCK(::cs_main, lockMain);\n+                if (lockMain) {",
    "path": "src/interfaces/node.cpp",
    "position": null,
    "original_position": 11,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "6647af93614c834f99d431e4c09f7bac79f0f4dd",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Does it change something if  this check is moved above at the `m_context->connman` level ? You may save one more control flow.",
    "created_at": "2020-09-08T14:50:47Z",
    "updated_at": "2020-12-07T12:00:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r484981819",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484981819"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r484981819"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484981819/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 110,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484983468",
    "pull_request_review_id": 484220356,
    "id": 484983468,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk4MzQ2OA==",
    "diff_hunk": "@@ -953,7 +953,7 @@ void PeerManager::FinalizeNode(NodeId nodeid, bool& fUpdateConnectionTime) {\n     LogPrint(BCLog::NET, \"Cleared nodestate for peer=%d\\n\", nodeid);\n }\n \n-bool GetNodeStateStats(NodeId nodeid, CNodeStateStats &stats) {\n+bool PeerManager::GetNodeStateStats(NodeId nodeid, CNodeStateStats &stats) {",
    "path": "src/net_processing.cpp",
    "position": 107,
    "original_position": 5,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "6647af93614c834f99d431e4c09f7bac79f0f4dd",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "It's a bit confusing to have `GetNodeStateStats` which is actually a member of `PeerManager`, and still have a `CNodeState`, even if inside this function you effectively fetch it. Maybe rename `GetNodeProcessingStats` ?",
    "created_at": "2020-09-08T14:52:56Z",
    "updated_at": "2020-12-07T12:00:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r484983468",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484983468"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r484983468"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484983468/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 855,
    "original_line": 855,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485038136",
    "pull_request_review_id": 484293681,
    "id": 485038136,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTAzODEzNg==",
    "diff_hunk": "@@ -105,11 +105,13 @@ class NodeImpl : public Node\n             }\n \n             // Try to retrieve the CNodeStateStats for each node.\n-            TRY_LOCK(::cs_main, lockMain);\n-            if (lockMain) {\n-                for (auto& node_stats : stats) {\n-                    std::get<1>(node_stats) =\n-                        GetNodeStateStats(std::get<0>(node_stats).nodeid, std::get<2>(node_stats));\n+            if (m_context->peerman) {\n+                TRY_LOCK(::cs_main, lockMain);\n+                if (lockMain) {",
    "path": "src/interfaces/node.cpp",
    "position": null,
    "original_position": 11,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "6647af93614c834f99d431e4c09f7bac79f0f4dd",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> Does it change something if this check is moved above at the `m_context->connman` level ? You may save one more control flow.\r\n\r\nWhy increase code block with locked `::cs_main`?",
    "created_at": "2020-09-08T16:10:25Z",
    "updated_at": "2020-12-07T12:00:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r485038136",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485038136"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r485038136"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485038136/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 110,
    "side": "RIGHT",
    "in_reply_to_id": 484981819
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485039519",
    "pull_request_review_id": 484295439,
    "id": 485039519,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTAzOTUxOQ==",
    "diff_hunk": "@@ -953,7 +953,7 @@ void PeerManager::FinalizeNode(NodeId nodeid, bool& fUpdateConnectionTime) {\n     LogPrint(BCLog::NET, \"Cleared nodestate for peer=%d\\n\", nodeid);\n }\n \n-bool GetNodeStateStats(NodeId nodeid, CNodeStateStats &stats) {\n+bool PeerManager::GetNodeStateStats(NodeId nodeid, CNodeStateStats &stats) {",
    "path": "src/net_processing.cpp",
    "position": 107,
    "original_position": 5,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "6647af93614c834f99d431e4c09f7bac79f0f4dd",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think the name right now is fine. It's getting stats related to the node's state.",
    "created_at": "2020-09-08T16:12:40Z",
    "updated_at": "2020-12-07T12:00:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r485039519",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485039519"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r485039519"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485039519/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 855,
    "original_line": 855,
    "side": "RIGHT",
    "in_reply_to_id": 484983468
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485048559",
    "pull_request_review_id": 484306707,
    "id": 485048559,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA0ODU1OQ==",
    "diff_hunk": "@@ -105,11 +105,13 @@ class NodeImpl : public Node\n             }\n \n             // Try to retrieve the CNodeStateStats for each node.\n-            TRY_LOCK(::cs_main, lockMain);\n-            if (lockMain) {\n-                for (auto& node_stats : stats) {\n-                    std::get<1>(node_stats) =\n-                        GetNodeStateStats(std::get<0>(node_stats).nodeid, std::get<2>(node_stats));\n+            if (m_context->peerman) {\n+                TRY_LOCK(::cs_main, lockMain);\n+                if (lockMain) {",
    "path": "src/interfaces/node.cpp",
    "position": null,
    "original_position": 11,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "6647af93614c834f99d431e4c09f7bac79f0f4dd",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> Does it change something if this check is moved above at the m_context->connman level ? You may save one more control flow.\r\n\r\nYes, it's a try lock. It's possible that we're not able to take the lock, and therefore that we're not able to get the node state stats, but we'd still get the node stats. If we move the try above the m_context->connman level, then if we couldn't get the cs_main lock, we wouldn't be able to get any stats.\r\n\r\nEventually, none of the statistics should require cs_main, so the try lock can be removed entirely.",
    "created_at": "2020-09-08T16:27:09Z",
    "updated_at": "2020-12-07T12:00:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r485048559",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485048559"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r485048559"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485048559/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 110,
    "side": "RIGHT",
    "in_reply_to_id": 484981819
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/493008783",
    "pull_request_review_id": 493814969,
    "id": 493008783,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAwODc4Mw==",
    "diff_hunk": "@@ -915,8 +871,8 @@ void PeerManager::FinalizeNode(NodeId nodeid, bool& fUpdateConnectionTime) {\n         PeerRef peer = GetPeerRef(nodeid);\n         assert(peer != nullptr);\n         misbehavior = WITH_LOCK(peer->m_misbehavior_mutex, return peer->m_misbehavior_score);\n-        LOCK(g_peer_mutex);\n-        g_peer_map.erase(nodeid);\n+        LOCK(m_peer_mutex);",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 68,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "d350feb2013e8db8a7464ec40670ef609d77e778",
    "user": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Using ```GetPeerRef()``` with an encapsulated lock for ```m_peer_map```, then manually locking the private mutex 3 lines later looks strange. It also requires two locks... all the drawbacks of mutex encapsulation without exploiting the benefits :)\r\n\r\nSince misbehavior changes to the peer will go unobserved after this point anyway, why not just take and remove with a single lock?\r\n\r\nSomething like (untested):\r\n```c++\r\nPeerRef PeerManager::RemovePeer(NodeId id)\r\n{\r\n    PeerRef ret;\r\n    {\r\n        LOCK(m_peer_mutex);\r\n        auto it = m_peer_map.find(id);\r\n        if (it != m_peer_map.end()) {\r\n            ret = std::move(it->second);\r\n            m_peer_map.erase(it);\r\n        }\r\n    }\r\n    return ret;\r\n}\r\n```",
    "created_at": "2020-09-22T20:19:54Z",
    "updated_at": "2020-12-07T12:00:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r493008783",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/493008783"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r493008783"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/493008783/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 874,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/494167048",
    "pull_request_review_id": 495380221,
    "id": 494167048,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDE2NzA0OA==",
    "diff_hunk": "@@ -915,8 +871,8 @@ void PeerManager::FinalizeNode(NodeId nodeid, bool& fUpdateConnectionTime) {\n         PeerRef peer = GetPeerRef(nodeid);\n         assert(peer != nullptr);\n         misbehavior = WITH_LOCK(peer->m_misbehavior_mutex, return peer->m_misbehavior_score);\n-        LOCK(g_peer_mutex);\n-        g_peer_map.erase(nodeid);\n+        LOCK(m_peer_mutex);",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 68,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "d350feb2013e8db8a7464ec40670ef609d77e778",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yes, that's much better. Thank you!\r\n\r\nI've implemented this within `GetPeerRef()` to avoid the code duplication, and also added another commit that tidies up `FinalizeNode()` a bit more. Let me know what you think.",
    "created_at": "2020-09-24T09:22:04Z",
    "updated_at": "2020-12-07T12:00:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r494167048",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/494167048"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r494167048"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/494167048/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 874,
    "side": "RIGHT",
    "in_reply_to_id": 493008783
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/494218405",
    "pull_request_review_id": 495445622,
    "id": 494218405,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDIxODQwNQ==",
    "diff_hunk": "@@ -915,8 +871,8 @@ void PeerManager::FinalizeNode(NodeId nodeid, bool& fUpdateConnectionTime) {\n         PeerRef peer = GetPeerRef(nodeid);\n         assert(peer != nullptr);\n         misbehavior = WITH_LOCK(peer->m_misbehavior_mutex, return peer->m_misbehavior_score);\n-        LOCK(g_peer_mutex);\n-        g_peer_map.erase(nodeid);\n+        LOCK(m_peer_mutex);",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 68,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "d350feb2013e8db8a7464ec40670ef609d77e778",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "EDIT: The comment below is wrong. I introduced a different bug when implementing this as Cory points out below.\r\n\r\n~oops. There's a bug in the code above which caused this to fail. You can't move the shared_ptr out of the map and then erase it. More precisely, I think something like the following is happening:~\r\n\r\n- ~`ret = std::move(it->second);` means `ret` is reset to be a shared pointer to `Peer`. It steals the refcount from `it->second`, since `std::move(it->second)` is an rvalue. `std::move` doesn't do anything to the map entry.~\r\n- ~the entry is then erased from the map, decrementing the refcount to zero and destructing the `Peer` object.~\r\n\r\n~Removing the `std::move` fixed this.~",
    "created_at": "2020-09-24T10:50:37Z",
    "updated_at": "2020-12-07T12:00:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r494218405",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/494218405"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r494218405"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/494218405/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 874,
    "side": "RIGHT",
    "in_reply_to_id": 493008783
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/494574969",
    "pull_request_review_id": 495905693,
    "id": 494574969,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDU3NDk2OQ==",
    "diff_hunk": "@@ -864,23 +864,18 @@ void PeerManager::ReattemptInitialBroadcast(CScheduler& scheduler) const\n }\n \n void PeerManager::FinalizeNode(NodeId nodeid, bool& fUpdateConnectionTime) {\n-    fUpdateConnectionTime = false;\n+    PeerRef peer = RemovePeer(nodeid);",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "658ca700ffc4ccb92df6a7b69df7a0a25fb82094",
    "user": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This undoes this assumption: https://github.com/bitcoin/bitcoin/pull/19607#discussion_r467079107 , which I'm still not convinced is a good idea.",
    "created_at": "2020-09-24T19:56:15Z",
    "updated_at": "2020-12-07T12:00:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r494574969",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/494574969"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r494574969"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/494574969/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 867,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/494816208",
    "pull_request_review_id": 496195024,
    "id": 494816208,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDgxNjIwOA==",
    "diff_hunk": "@@ -864,23 +864,18 @@ void PeerManager::ReattemptInitialBroadcast(CScheduler& scheduler) const\n }\n \n void PeerManager::FinalizeNode(NodeId nodeid, bool& fUpdateConnectionTime) {\n-    fUpdateConnectionTime = false;\n+    PeerRef peer = RemovePeer(nodeid);",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "658ca700ffc4ccb92df6a7b69df7a0a25fb82094",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "ok, removed that commit",
    "created_at": "2020-09-25T08:01:09Z",
    "updated_at": "2020-12-07T12:00:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r494816208",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/494816208"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r494816208"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/494816208/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 867,
    "side": "RIGHT",
    "in_reply_to_id": 494574969
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499749803",
    "pull_request_review_id": 502258906,
    "id": 499749803,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTc0OTgwMw==",
    "diff_hunk": "@@ -915,8 +871,8 @@ void PeerManager::FinalizeNode(NodeId nodeid, bool& fUpdateConnectionTime) {\n         PeerRef peer = GetPeerRef(nodeid);\n         assert(peer != nullptr);\n         misbehavior = WITH_LOCK(peer->m_misbehavior_mutex, return peer->m_misbehavior_score);\n-        LOCK(g_peer_mutex);\n-        g_peer_map.erase(nodeid);\n+        LOCK(m_peer_mutex);",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 68,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "d350feb2013e8db8a7464ec40670ef609d77e778",
    "user": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This is really uninteresting minutia, but @jnewbery and I happened to get into a discussion/debate about it today so I'm following up with details. Everyone else can safely ignore this as boring.\r\n\r\nI don't believe the comment above is correct. If removing the ```std::move``` helps, I'm wondering if there might be another issue causing problems.\r\n\r\n> - ret = std::move(it->second); means ret is reset to be a shared pointer to Peer. It steals the refcount from it->second, since std::move(it->second) is an rvalue. std::move doesn't do anything to the map entry.\r\n\r\nIndeed ```std::move``` doesn't do anything to the map entry as it's essentially just a cast, but the ```operator=``` does likely (definitely?) reset it.\r\nSee [libc++'s implementation of shared_ptr's move assignment operator](https://github.com/llvm/llvm-project/blob/master/libcxx/include/memory#L3967), which [calls the move constructor](https://github.com/llvm/llvm-project/blob/master/libcxx/include/memory#L3845), where the rhs is null'd.\r\n\r\n\r\n> - the entry is then erased from the map, decrementing the refcount to zero and destructing the Peer object.\r\n\r\nWe can write a quick test to see that the refcount never hits zero after removal from the map, that copy vs. move refcounts are different as we would expect them to be, and that a shared_ptr moved from a map's value is still safe to use:\r\n```c++\r\n#include <cassert>\r\n#include <cstdio>\r\n#include <map>\r\n#include <memory>\r\n#include <string>\r\n\r\nstatic std::shared_ptr<std::string> copytest()\r\n{\r\n    std::map<char, std::shared_ptr<std::string> > foo;\r\n    foo.emplace('c', std::make_shared<std::string>(\"hello\"));\r\n    auto it = foo.find('c');\r\n    std::shared_ptr<std::string> ret;\r\n    if (it != foo.end()) {\r\n        assert(it->second.use_count() == 1);\r\n        ret = it->second;\r\n        assert(it->second != nullptr); // <------------------\r\n        assert(ret.use_count() == 2);  // <------------------\r\n        foo.erase(it);\r\n        assert(ret.use_count() == 1);\r\n    }\r\n    return ret;\r\n}\r\n\r\nstatic std::shared_ptr<std::string> movetest()\r\n{\r\n    std::map<char, std::shared_ptr<std::string> > foo;\r\n    foo.emplace('c', std::make_shared<std::string>(\"world\"));\r\n    auto it = foo.find('c');\r\n    std::shared_ptr<std::string> ret;\r\n    if (it != foo.end()) {\r\n        assert(it->second.use_count() == 1);\r\n        ret = std::move(it->second);\r\n        assert(it->second == nullptr); // <------------------\r\n        assert(ret.use_count() == 1);  // <------------------\r\n        foo.erase(it);\r\n        assert(ret.use_count() == 1);\r\n    }\r\n    return ret;\r\n}\r\n\r\nint main()\r\n{\r\n    auto copyptr = copytest();\r\n    assert(copyptr.use_count() == 1);\r\n    auto moveptr = movetest();\r\n    assert(moveptr.use_count() == 1);\r\n\r\n    printf(\"%s %s!\\n\", copyptr->c_str(), moveptr->c_str());\r\n}\r\n```\r\n\r\nNote that this doesn't actually prove that the map itself is still in working order after the move+removal, but I don't see why that should break anything.\r\n\r\nLastly, we have cases in our code where we move from a map's value. One example: https://github.com/bitcoin/bitcoin/blob/master/src/net.cpp#L1012\r\n\r\n**tl;dr**: If moving a ```shared_ptr``` out of a mapped value causes a problem that a copy doesn't, we should make sure to understand why and potentially audit other places where we do it as well.",
    "created_at": "2020-10-05T17:12:29Z",
    "updated_at": "2020-12-07T12:00:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r499749803",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499749803"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r499749803"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499749803/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 874,
    "side": "RIGHT",
    "in_reply_to_id": 493008783
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499754354",
    "pull_request_review_id": 502264735,
    "id": 499754354,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTc1NDM1NA==",
    "diff_hunk": "@@ -915,8 +871,8 @@ void PeerManager::FinalizeNode(NodeId nodeid, bool& fUpdateConnectionTime) {\n         PeerRef peer = GetPeerRef(nodeid);\n         assert(peer != nullptr);\n         misbehavior = WITH_LOCK(peer->m_misbehavior_mutex, return peer->m_misbehavior_score);\n-        LOCK(g_peer_mutex);\n-        g_peer_map.erase(nodeid);\n+        LOCK(m_peer_mutex);",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 68,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "d350feb2013e8db8a7464ec40670ef609d77e778",
    "user": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Aha, I think I found the problem. From your previous version of this commit:\r\n```c++\r\n...\r\n    if (it != m_peer_map.end()) {\r\n        ret = std::move(it->second);\r\n        if (erase) m_peer_map.erase(it);\r\n    }\r\n    return ret;\r\n```\r\nMoving only makes sense when erasing.",
    "created_at": "2020-10-05T17:20:28Z",
    "updated_at": "2020-12-07T12:00:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r499754354",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499754354"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r499754354"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499754354/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 874,
    "side": "RIGHT",
    "in_reply_to_id": 493008783
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499806616",
    "pull_request_review_id": 502334736,
    "id": 499806616,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTgwNjYxNg==",
    "diff_hunk": "@@ -909,11 +907,16 @@ void PeerManager::FinalizeNode(NodeId nodeid, bool& fUpdateConnectionTime) {\n     LogPrint(BCLog::NET, \"Cleared nodestate for peer=%d\\n\", nodeid);\n }\n \n-PeerRef PeerManager::GetPeerRef(NodeId id)\n+PeerRef PeerManager::GetPeerRef(NodeId id, bool erase)",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 18,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "2ce2ec188a4cb163ff77f2834a9e401cbee53995",
    "user": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This is (mostly) a style preference, but I'm not a fan of adding a boolean option to substantially change the functionality of a function as opposed to just creating two functions. GetPeerRef() is logically a read-only operation.\r\n\r\nIt's also easier easy to slip up and make mistakes like this one: https://github.com/bitcoin/bitcoin/pull/19910#discussion_r499754354 ;)",
    "created_at": "2020-10-05T18:58:20Z",
    "updated_at": "2020-12-07T12:00:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r499806616",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499806616"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r499806616"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499806616/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 910,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/501585667",
    "pull_request_review_id": 504605754,
    "id": 501585667,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTU4NTY2Nw==",
    "diff_hunk": "@@ -915,8 +871,8 @@ void PeerManager::FinalizeNode(NodeId nodeid, bool& fUpdateConnectionTime) {\n         PeerRef peer = GetPeerRef(nodeid);\n         assert(peer != nullptr);\n         misbehavior = WITH_LOCK(peer->m_misbehavior_mutex, return peer->m_misbehavior_score);\n-        LOCK(g_peer_mutex);\n-        g_peer_map.erase(nodeid);\n+        LOCK(m_peer_mutex);",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 68,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "d350feb2013e8db8a7464ec40670ef609d77e778",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Indeed, the failure was caused by that. Sorry for the noise (and for casting aspersions on your code!)",
    "created_at": "2020-10-08T09:42:05Z",
    "updated_at": "2020-12-07T12:00:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r501585667",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/501585667"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r501585667"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/501585667/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 874,
    "side": "RIGHT",
    "in_reply_to_id": 493008783
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/501605336",
    "pull_request_review_id": 504630812,
    "id": 501605336,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTYwNTMzNg==",
    "diff_hunk": "@@ -909,11 +907,16 @@ void PeerManager::FinalizeNode(NodeId nodeid, bool& fUpdateConnectionTime) {\n     LogPrint(BCLog::NET, \"Cleared nodestate for peer=%d\\n\", nodeid);\n }\n \n-PeerRef PeerManager::GetPeerRef(NodeId id)\n+PeerRef PeerManager::GetPeerRef(NodeId id, bool erase)",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 18,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "2ce2ec188a4cb163ff77f2834a9e401cbee53995",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "You got me. I've made it a separate function.\r\n\r\n> GetPeerRef() is logically a read-only operation.\r\n\r\nGood point. I've made it `const` (and made the mutex `mutable`)\r\n",
    "created_at": "2020-10-08T10:13:28Z",
    "updated_at": "2020-12-07T12:00:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r501605336",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/501605336"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r501605336"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/501605336/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 910,
    "side": "RIGHT",
    "in_reply_to_id": 499806616
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/535077391",
    "pull_request_review_id": 543818354,
    "id": 535077391,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTA3NzM5MQ==",
    "diff_hunk": "@@ -143,6 +143,10 @@ class PeerManager final : public CValidationInterface, public NetEventsInterface\n      *  May return nullptr if the Peer object can't be found. */\n     PeerRef GetPeerRef(NodeId id) const;\n \n+    /** Get a shared pointer to the Peer object and remove it from m_peer_map.\n+     *  May return nullptr if the Peer object can't be found. */",
    "path": "src/net_processing.h",
    "position": null,
    "original_position": 5,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "aedd418fed7abfd00cc731bd57ed5b013259eb5a",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "aedd418fed7abfd00cc731bd57ed5b013259eb5a\r\n\r\nTo be precise, it may return an [empty](https://en.cppreference.com/w/cpp/memory/shared_ptr/shared_ptr) shared pointer rather `nullptr`.",
    "created_at": "2020-12-03T10:35:44Z",
    "updated_at": "2020-12-07T12:00:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r535077391",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/535077391"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r535077391"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/535077391/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 147,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/535083417",
    "pull_request_review_id": 543818354,
    "id": 535083417,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTA4MzQxNw==",
    "diff_hunk": "@@ -835,11 +835,13 @@ void PeerManager::FinalizeNode(const CNode& node, bool& fUpdateConnectionTime) {\n     LogPrint(BCLog::NET, \"Cleared nodestate for peer=%d\\n\", nodeid);\n }\n \n-PeerRef PeerManager::GetPeerRef(NodeId id)\n+PeerRef PeerManager::GetPeerRef(NodeId id) const\n {\n+    PeerRef ret;\n     LOCK(m_peer_mutex);\n     auto it = m_peer_map.find(id);\n-    return it != m_peer_map.end() ? it->second : nullptr;\n+    if (it != m_peer_map.end()) ret = it->second;\n+    return ret;",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 12,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "6bfcef3797d4d105180e325033929684f84cfc08",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "6bfcef3797d4d105180e325033929684f84cfc08\r\n\r\nWhy are these changes required? What are benefits to return an empty shared pointer instead `nullptr`-constructed one? Btw, in all caller places the return value is checked for `nullptr`, not being empty.",
    "created_at": "2020-12-03T10:41:08Z",
    "updated_at": "2020-12-07T12:00:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r535083417",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/535083417"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r535083417"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/535083417/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 840,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 842,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/536045568",
    "pull_request_review_id": 544893589,
    "id": 536045568,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA0NTU2OA==",
    "diff_hunk": "@@ -143,6 +143,10 @@ class PeerManager final : public CValidationInterface, public NetEventsInterface\n      *  May return nullptr if the Peer object can't be found. */\n     PeerRef GetPeerRef(NodeId id) const;\n \n+    /** Get a shared pointer to the Peer object and remove it from m_peer_map.\n+     *  May return nullptr if the Peer object can't be found. */",
    "path": "src/net_processing.h",
    "position": null,
    "original_position": 5,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "aedd418fed7abfd00cc731bd57ed5b013259eb5a",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "fixed",
    "created_at": "2020-12-04T11:53:32Z",
    "updated_at": "2020-12-07T12:00:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r536045568",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/536045568"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r536045568"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/536045568/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 147,
    "side": "RIGHT",
    "in_reply_to_id": 535077391
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/536045912",
    "pull_request_review_id": 544894037,
    "id": 536045912,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA0NTkxMg==",
    "diff_hunk": "@@ -835,11 +835,13 @@ void PeerManager::FinalizeNode(const CNode& node, bool& fUpdateConnectionTime) {\n     LogPrint(BCLog::NET, \"Cleared nodestate for peer=%d\\n\", nodeid);\n }\n \n-PeerRef PeerManager::GetPeerRef(NodeId id)\n+PeerRef PeerManager::GetPeerRef(NodeId id) const\n {\n+    PeerRef ret;\n     LOCK(m_peer_mutex);\n     auto it = m_peer_map.find(id);\n-    return it != m_peer_map.end() ? it->second : nullptr;\n+    if (it != m_peer_map.end()) ret = it->second;\n+    return ret;",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 12,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "6bfcef3797d4d105180e325033929684f84cfc08",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This makes is clear that NRVO can be used, since there's only one return statement. I'm not sure if the previous version would have used copy elision.",
    "created_at": "2020-12-04T11:54:11Z",
    "updated_at": "2020-12-07T12:00:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r536045912",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/536045912"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r536045912"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/536045912/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 840,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 842,
    "side": "RIGHT",
    "in_reply_to_id": 535083417
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/536049347",
    "pull_request_review_id": 544898224,
    "id": 536049347,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA0OTM0Nw==",
    "diff_hunk": "@@ -790,11 +790,9 @@ void PeerManager::FinalizeNode(const CNode& node, bool& fUpdateConnectionTime) {\n     LOCK(cs_main);\n     int misbehavior{0};\n     {\n-        PeerRef peer = GetPeerRef(nodeid);\n+        PeerRef peer = RemovePeer(nodeid);",
    "path": "src/net_processing.cpp",
    "position": 75,
    "original_position": 5,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "5a1f08ce1f4d49fe85b8571cd5da1b1096339a89",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This also avoids duplicate lookup on m_peer_map :+1:",
    "created_at": "2020-12-04T12:00:18Z",
    "updated_at": "2020-12-07T12:00:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r536049347",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/536049347"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r536049347"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/536049347/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 793,
    "original_line": 793,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/536140554",
    "pull_request_review_id": 545008571,
    "id": 536140554,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjE0MDU1NA==",
    "diff_hunk": "@@ -842,11 +790,9 @@ void PeerManager::FinalizeNode(const CNode& node, bool& fUpdateConnectionTime) {\n     LOCK(cs_main);\n     int misbehavior{0};\n     {\n-        PeerRef peer = GetPeerRef(nodeid);\n+        PeerRef peer = RemovePeer(nodeid);\n         assert(peer != nullptr);",
    "path": "src/net_processing.cpp",
    "position": 76,
    "original_position": 76,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "4fe77ae9aab73d8de6c40d504e079e30eff45f91",
    "user": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This is a little awkward because of the comment in RemovePeer:\r\n```c++\r\n/** Get a shared pointer to the Peer object and remove it from m_peer_map.\r\n *  May return an empty shared_ptr if the Peer object can't be found. */\r\n```\r\nMight be worth of a comment explaining that _at this point_ the peer is guaranteed to exist, but not afterwards. Then again, that's kinda what the assert means. Shrug.",
    "created_at": "2020-12-04T14:31:58Z",
    "updated_at": "2020-12-07T12:00:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r536140554",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/536140554"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r536140554"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/536140554/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 794,
    "original_line": 794,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/536156231",
    "pull_request_review_id": 545028349,
    "id": 536156231,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjE1NjIzMQ==",
    "diff_hunk": "@@ -835,11 +835,13 @@ void PeerManager::FinalizeNode(const CNode& node, bool& fUpdateConnectionTime) {\n     LogPrint(BCLog::NET, \"Cleared nodestate for peer=%d\\n\", nodeid);\n }\n \n-PeerRef PeerManager::GetPeerRef(NodeId id)\n+PeerRef PeerManager::GetPeerRef(NodeId id) const\n {\n+    PeerRef ret;\n     LOCK(m_peer_mutex);\n     auto it = m_peer_map.find(id);\n-    return it != m_peer_map.end() ? it->second : nullptr;\n+    if (it != m_peer_map.end()) ret = it->second;\n+    return ret;",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 12,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "6bfcef3797d4d105180e325033929684f84cfc08",
    "user": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "+1 for considering this!\r\n\r\nI'd be curious to know if compilers are allowed to rearrange the code before deciding how many return statements there are. I could see this going either way.",
    "created_at": "2020-12-04T14:54:20Z",
    "updated_at": "2020-12-07T12:00:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r536156231",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/536156231"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r536156231"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/536156231/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 840,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 842,
    "side": "RIGHT",
    "in_reply_to_id": 535083417
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/536646781",
    "pull_request_review_id": 545575187,
    "id": 536646781,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjY0Njc4MQ==",
    "diff_hunk": "@@ -835,11 +835,13 @@ void PeerManager::FinalizeNode(const CNode& node, bool& fUpdateConnectionTime) {\n     LogPrint(BCLog::NET, \"Cleared nodestate for peer=%d\\n\", nodeid);\n }\n \n-PeerRef PeerManager::GetPeerRef(NodeId id)\n+PeerRef PeerManager::GetPeerRef(NodeId id) const\n {\n+    PeerRef ret;\n     LOCK(m_peer_mutex);\n     auto it = m_peer_map.find(id);\n-    return it != m_peer_map.end() ? it->second : nullptr;\n+    if (it != m_peer_map.end()) ret = it->second;\n+    return ret;",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 12,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "6bfcef3797d4d105180e325033929684f84cfc08",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Considering the before-change code, to be precise, in C++17 in a return statement, when the operand is a prvalue (the result of the ternary conditional expression), elision of copy/move operations is [mandatory](https://en.cppreference.com/w/cpp/language/copy_elision).\r\n\r\nOTOH, NRVO is non-mandatory.",
    "created_at": "2020-12-05T10:08:10Z",
    "updated_at": "2020-12-07T12:00:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r536646781",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/536646781"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r536646781"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/536646781/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 840,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 842,
    "side": "RIGHT",
    "in_reply_to_id": 535083417
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/537453217",
    "pull_request_review_id": 546083773,
    "id": 537453217,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzQ1MzIxNw==",
    "diff_hunk": "@@ -835,11 +835,13 @@ void PeerManager::FinalizeNode(const CNode& node, bool& fUpdateConnectionTime) {\n     LogPrint(BCLog::NET, \"Cleared nodestate for peer=%d\\n\", nodeid);\n }\n \n-PeerRef PeerManager::GetPeerRef(NodeId id)\n+PeerRef PeerManager::GetPeerRef(NodeId id) const\n {\n+    PeerRef ret;\n     LOCK(m_peer_mutex);\n     auto it = m_peer_map.find(id);\n-    return it != m_peer_map.end() ? it->second : nullptr;\n+    if (it != m_peer_map.end()) ret = it->second;\n+    return ret;",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 12,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "6bfcef3797d4d105180e325033929684f84cfc08",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks @hebasto! Yes, I think you're right. If I'm reading it correctly, the result of the conditional operator is a prvalue (item 5 in https://en.cppreference.com/w/cpp/language/operator_other#Conditional_operator since 4 doesn't apply), and copy elision is mandatory for returning a prvalue.\r\n\r\nI've reverted this.",
    "created_at": "2020-12-07T12:02:33Z",
    "updated_at": "2020-12-07T12:02:34Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r537453217",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/537453217"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r537453217"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/537453217/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 840,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 842,
    "side": "RIGHT",
    "in_reply_to_id": 535083417
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/537454856",
    "pull_request_review_id": 546085750,
    "id": 537454856,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzQ1NDg1Ng==",
    "diff_hunk": "@@ -835,11 +835,13 @@ void PeerManager::FinalizeNode(const CNode& node, bool& fUpdateConnectionTime) {\n     LogPrint(BCLog::NET, \"Cleared nodestate for peer=%d\\n\", nodeid);\n }\n \n-PeerRef PeerManager::GetPeerRef(NodeId id)\n+PeerRef PeerManager::GetPeerRef(NodeId id) const\n {\n+    PeerRef ret;\n     LOCK(m_peer_mutex);\n     auto it = m_peer_map.find(id);\n-    return it != m_peer_map.end() ? it->second : nullptr;\n+    if (it != m_peer_map.end()) ret = it->second;\n+    return ret;",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 12,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "6bfcef3797d4d105180e325033929684f84cfc08",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> ... and copy elision is mandatory for returning a prvalue.\r\n\r\nGood to have C++17 :)",
    "created_at": "2020-12-07T12:05:13Z",
    "updated_at": "2020-12-07T12:05:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r537454856",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/537454856"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r537454856"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/537454856/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 840,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 842,
    "side": "RIGHT",
    "in_reply_to_id": 535083417
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/537458391",
    "pull_request_review_id": 546089823,
    "id": 537458391,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzQ1ODM5MQ==",
    "diff_hunk": "@@ -842,11 +790,9 @@ void PeerManager::FinalizeNode(const CNode& node, bool& fUpdateConnectionTime) {\n     LOCK(cs_main);\n     int misbehavior{0};\n     {\n-        PeerRef peer = GetPeerRef(nodeid);\n+        PeerRef peer = RemovePeer(nodeid);\n         assert(peer != nullptr);",
    "path": "src/net_processing.cpp",
    "position": 76,
    "original_position": 76,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "4fe77ae9aab73d8de6c40d504e079e30eff45f91",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yeah, I think it's ok for now. Happy to change this if you decide you feel more strongly about it.",
    "created_at": "2020-12-07T12:11:13Z",
    "updated_at": "2020-12-07T12:11:13Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r537458391",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/537458391"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r537458391"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/537458391/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 794,
    "original_line": 794,
    "side": "RIGHT",
    "in_reply_to_id": 536140554
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/537460651",
    "pull_request_review_id": 546092494,
    "id": 537460651,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzQ2MDY1MQ==",
    "diff_hunk": "@@ -887,7 +833,26 @@ void PeerManager::FinalizeNode(const CNode& node, bool& fUpdateConnectionTime) {\n     LogPrint(BCLog::NET, \"Cleared nodestate for peer=%d\\n\", nodeid);\n }\n \n-bool GetNodeStateStats(NodeId nodeid, CNodeStateStats &stats) {\n+PeerRef PeerManager::GetPeerRef(NodeId id) const\n+{\n+    LOCK(m_peer_mutex);\n+    auto it = m_peer_map.find(id);\n+    return it != m_peer_map.end() ? it->second : nullptr;\n+}\n+\n+PeerRef PeerManager::RemovePeer(NodeId id)\n+{\n+    PeerRef ret;\n+    LOCK(m_peer_mutex);\n+    auto it = m_peer_map.find(id);\n+    if (it != m_peer_map.end()) {\n+        ret = std::move(it->second);\n+        m_peer_map.erase(it);\n+    }\n+    return ret;\n+}",
    "path": "src/net_processing.cpp",
    "position": 105,
    "original_position": 105,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54\r\nI'm curios is it possible to force the mandatory copy/move elision for the return value here as well?",
    "created_at": "2020-12-07T12:15:18Z",
    "updated_at": "2020-12-07T12:15:18Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r537460651",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/537460651"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r537460651"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/537460651/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 843,
    "original_start_line": 843,
    "start_side": "RIGHT",
    "line": 853,
    "original_line": 853,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708937645",
    "pull_request_review_id": 754789488,
    "id": 708937645,
    "node_id": "PRRC_kwDOABII584qQYet",
    "diff_hunk": "@@ -842,11 +790,9 @@ void PeerManager::FinalizeNode(const CNode& node, bool& fUpdateConnectionTime) {\n     LOCK(cs_main);\n     int misbehavior{0};\n     {\n-        PeerRef peer = GetPeerRef(nodeid);\n+        PeerRef peer = RemovePeer(nodeid);\n         assert(peer != nullptr);",
    "path": "src/net_processing.cpp",
    "position": 76,
    "original_position": 76,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "user": {
      "login": "rebroad",
      "id": 1530283,
      "node_id": "MDQ6VXNlcjE1MzAyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rebroad",
      "html_url": "https://github.com/rebroad",
      "followers_url": "https://api.github.com/users/rebroad/followers",
      "following_url": "https://api.github.com/users/rebroad/following{/other_user}",
      "gists_url": "https://api.github.com/users/rebroad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
      "organizations_url": "https://api.github.com/users/rebroad/orgs",
      "repos_url": "https://api.github.com/users/rebroad/repos",
      "events_url": "https://api.github.com/users/rebroad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rebroad/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I'm getting bitcoind crashing due to this assert. It appears that sometimes FinalizeNode gets called twice (from DeleteNode()). Perhaps nRefCount is being increased between the two occurances. This only seems to happen though when there's a delay between them due to UpdateTip(). It's probably a bug I've introduced somewhere, but just leaving this comment as a \"heads up\".",
    "created_at": "2021-09-15T08:00:08Z",
    "updated_at": "2021-09-15T08:00:08Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r708937645",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708937645"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r708937645"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708937645/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 794,
    "original_line": 794,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709030496",
    "pull_request_review_id": 754910612,
    "id": 709030496,
    "node_id": "PRRC_kwDOABII584qQvJg",
    "diff_hunk": "@@ -842,11 +790,9 @@ void PeerManager::FinalizeNode(const CNode& node, bool& fUpdateConnectionTime) {\n     LOCK(cs_main);\n     int misbehavior{0};\n     {\n-        PeerRef peer = GetPeerRef(nodeid);\n+        PeerRef peer = RemovePeer(nodeid);\n         assert(peer != nullptr);",
    "path": "src/net_processing.cpp",
    "position": 76,
    "original_position": 76,
    "commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "original_commit_id": "3025ca9e7743d9b96c22e9c6ed7ef051dcea7e54",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks. I expect if the bug was present in master we'd have seen it in CI or from a user report.",
    "created_at": "2021-09-15T09:54:54Z",
    "updated_at": "2021-09-15T09:54:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r709030496",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709030496"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19910#discussion_r709030496"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19910"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709030496/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 794,
    "original_line": 794,
    "side": "RIGHT",
    "in_reply_to_id": 708937645
  }
]