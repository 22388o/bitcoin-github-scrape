[
  {
    "sha": "3f5ad622e5fe0781a70bee9e3322b23c2352e956",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozZjVhZDYyMmU1ZmUwNzgxYTcwYmVlOWUzMzIyYjIzYzIzNTJlOTU2",
    "commit": {
      "author": {
        "name": "riordant",
        "email": "riordant@tcd.ie",
        "date": "2019-02-25T09:00:34Z"
      },
      "committer": {
        "name": "riordant",
        "email": "riordant@tcd.ie",
        "date": "2019-02-25T09:00:34Z"
      },
      "message": "Enable PID file creation on Windows\n- Add available WIN PID function\n- Consider WIN32 in each relevant case\n- Add new preprocessor definitions to suppress warning\n- Update error message for generic OS\n\nCo-authored-by: J\u00f6rn R\u00f6der <kontakt@joernroeder.de>",
      "tree": {
        "sha": "0aa9a36a1654036ce19ac7c236d1844e90bbfe45",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0aa9a36a1654036ce19ac7c236d1844e90bbfe45"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3f5ad622e5fe0781a70bee9e3322b23c2352e956",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3f5ad622e5fe0781a70bee9e3322b23c2352e956",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/3f5ad622e5fe0781a70bee9e3322b23c2352e956",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3f5ad622e5fe0781a70bee9e3322b23c2352e956/comments",
    "author": {
      "login": "riordant",
      "id": 6988731,
      "node_id": "MDQ6VXNlcjY5ODg3MzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6988731?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/riordant",
      "html_url": "https://github.com/riordant",
      "followers_url": "https://api.github.com/users/riordant/followers",
      "following_url": "https://api.github.com/users/riordant/following{/other_user}",
      "gists_url": "https://api.github.com/users/riordant/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/riordant/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/riordant/subscriptions",
      "organizations_url": "https://api.github.com/users/riordant/orgs",
      "repos_url": "https://api.github.com/users/riordant/repos",
      "events_url": "https://api.github.com/users/riordant/events{/privacy}",
      "received_events_url": "https://api.github.com/users/riordant/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "riordant",
      "id": 6988731,
      "node_id": "MDQ6VXNlcjY5ODg3MzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6988731?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/riordant",
      "html_url": "https://github.com/riordant",
      "followers_url": "https://api.github.com/users/riordant/followers",
      "following_url": "https://api.github.com/users/riordant/following{/other_user}",
      "gists_url": "https://api.github.com/users/riordant/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/riordant/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/riordant/subscriptions",
      "organizations_url": "https://api.github.com/users/riordant/orgs",
      "repos_url": "https://api.github.com/users/riordant/repos",
      "events_url": "https://api.github.com/users/riordant/events{/privacy}",
      "received_events_url": "https://api.github.com/users/riordant/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "b853746d4a8a8ac0d3f535538e2ac4e3cc14e1c7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b853746d4a8a8ac0d3f535538e2ac4e3cc14e1c7",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/b853746d4a8a8ac0d3f535538e2ac4e3cc14e1c7"
      }
    ],
    "stats": {
      "total": 24,
      "additions": 9,
      "deletions": 15
    },
    "files": [
      {
        "sha": "913f3c35da99fc91c2f2e7c85e38fc757816bb0f",
        "filename": "build_msvc/libbitcoin_server/libbitcoin_server.vcxproj.in",
        "status": "modified",
        "additions": 4,
        "deletions": 4,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3f5ad622e5fe0781a70bee9e3322b23c2352e956/build_msvc/libbitcoin_server/libbitcoin_server.vcxproj.in",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3f5ad622e5fe0781a70bee9e3322b23c2352e956/build_msvc/libbitcoin_server/libbitcoin_server.vcxproj.in",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/build_msvc/libbitcoin_server/libbitcoin_server.vcxproj.in?ref=3f5ad622e5fe0781a70bee9e3322b23c2352e956",
        "patch": "@@ -89,7 +89,7 @@\n       <PrecompiledHeader>NotUsing</PrecompiledHeader>\n       <WarningLevel>Level3</WarningLevel>\n       <Optimization>Disabled</Optimization>\n-      <PreprocessorDefinitions>WIN32;HAVE_CONFIG_H;_SCL_SECURE_NO_WARNINGS;_DEBUG;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>\n+      <PreprocessorDefinitions>WIN32;HAVE_CONFIG_H;_CRT_SECURE_NO_WARNINGS;_SCL_SECURE_NO_WARNINGS;_DEBUG;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>\n       <SDLCheck>true</SDLCheck>\n       <AdditionalIncludeDirectories>..\\..\\src;..\\..\\src\\univalue\\include;..\\..\\src\\leveldb\\include;..\\..\\src\\leveldb\\helpers\\memenv;</AdditionalIncludeDirectories>\n       <RuntimeLibrary>MultiThreadedDebug</RuntimeLibrary>\n@@ -104,7 +104,7 @@\n       <PrecompiledHeader>NotUsing</PrecompiledHeader>\n       <WarningLevel>Level3</WarningLevel>\n       <Optimization>Disabled</Optimization>\n-      <PreprocessorDefinitions>WIN32;HAVE_CONFIG_H;_SCL_SECURE_NO_WARNINGS;WIN32;_DEBUG;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>\n+      <PreprocessorDefinitions>WIN32;HAVE_CONFIG_H;_CRT_SECURE_NO_WARNINGS;_SCL_SECURE_NO_WARNINGS;WIN32;_DEBUG;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>\n       <SDLCheck>true</SDLCheck>\n       <AdditionalIncludeDirectories>..\\..\\src;..\\..\\src\\univalue\\include;..\\..\\src\\leveldb\\include;..\\..\\src\\leveldb\\helpers\\memenv;</AdditionalIncludeDirectories>\n       <RuntimeLibrary>MultiThreadedDebug</RuntimeLibrary>\n@@ -122,7 +122,7 @@\n       <Optimization>MaxSpeed</Optimization>\n       <FunctionLevelLinking>true</FunctionLevelLinking>\n       <IntrinsicFunctions>true</IntrinsicFunctions>\n-      <PreprocessorDefinitions>WIN32;HAVE_CONFIG_H;_SCL_SECURE_NO_WARNINGS;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>\n+      <PreprocessorDefinitions>WIN32;HAVE_CONFIG_H;_CRT_SECURE_NO_WARNINGS;_SCL_SECURE_NO_WARNINGS;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>\n       <SDLCheck>true</SDLCheck>\n       <AdditionalIncludeDirectories>..\\..\\src;..\\..\\src\\univalue\\include;..\\..\\src\\leveldb\\include;..\\..\\src\\leveldb\\helpers\\memenv;</AdditionalIncludeDirectories>\n       <RuntimeLibrary>MultiThreaded</RuntimeLibrary>\n@@ -141,7 +141,7 @@\n       <Optimization>MaxSpeed</Optimization>\n       <FunctionLevelLinking>true</FunctionLevelLinking>\n       <IntrinsicFunctions>true</IntrinsicFunctions>\n-      <PreprocessorDefinitions>WIN32;HAVE_CONFIG_H;_SCL_SECURE_NO_WARNINGS;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>\n+      <PreprocessorDefinitions>WIN32;HAVE_CONFIG_H;_CRT_SECURE_NO_WARNINGS;_SCL_SECURE_NO_WARNINGS;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>\n       <SDLCheck>true</SDLCheck>\n       <AdditionalIncludeDirectories>..\\..\\src;..\\..\\src\\univalue\\include;..\\..\\src\\leveldb\\include;..\\..\\src\\leveldb\\helpers\\memenv;</AdditionalIncludeDirectories>\n       <RuntimeLibrary>MultiThreaded</RuntimeLibrary>"
      },
      {
        "sha": "9ba9b2803a7ac39048e39f470d87234a9628aa12",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 11,
        "changes": 16,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3f5ad622e5fe0781a70bee9e3322b23c2352e956/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3f5ad622e5fe0781a70bee9e3322b23c2352e956/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=3f5ad622e5fe0781a70bee9e3322b23c2352e956",
        "patch": "@@ -97,7 +97,6 @@ static const char* FEE_ESTIMATES_FILENAME=\"fee_estimates.dat\";\n /**\n  * The PID file facilities.\n  */\n-#ifndef WIN32\n static const char* BITCOIN_PID_FILENAME = \"bitcoind.pid\";\n \n static fs::path GetPidFile()\n@@ -109,14 +108,17 @@ NODISCARD static bool CreatePidFile()\n {\n     FILE* file = fsbridge::fopen(GetPidFile(), \"w\");\n     if (file) {\n+#ifdef WIN32\n+        fprintf(file, \"%d\\n\", GetCurrentProcessId());\n+#else\n         fprintf(file, \"%d\\n\", getpid());\n+#endif\n         fclose(file);\n         return true;\n     } else {\n         return InitError(strprintf(_(\"Unable to create the PID file '%s': %s\"), GetPidFile().string(), std::strerror(errno)));\n     }\n }\n-#endif\n \n //////////////////////////////////////////////////////////////////////////////\n //\n@@ -286,15 +288,13 @@ void Shutdown(InitInterfaces& interfaces)\n     }\n #endif\n \n-#ifndef WIN32\n     try {\n         if (!fs::remove(GetPidFile())) {\n             LogPrintf(\"%s: Unable to remove PID file: File does not exist\\n\", __func__);\n         }\n     } catch (const fs::filesystem_error& e) {\n-        LogPrintf(\"%s: Unable to remove PID file: %s\\n\", __func__, e.what());\n+        LogPrintf(\"%s: Unable to remove PID file: %s\\n\", __func__, fsbridge::get_filesystem_error_message(e));\n     }\n-#endif\n     interfaces.chain_clients.clear();\n     UnregisterAllValidationInterfaces();\n     GetMainSignals().UnregisterBackgroundSignalScheduler();\n@@ -392,11 +392,7 @@ void SetupServerArgs()\n     gArgs.AddArg(\"-par=<n>\", strprintf(\"Set the number of script verification threads (%u to %d, 0 = auto, <0 = leave that many cores free, default: %d)\",\n         -GetNumCores(), MAX_SCRIPTCHECK_THREADS, DEFAULT_SCRIPTCHECK_THREADS), false, OptionsCategory::OPTIONS);\n     gArgs.AddArg(\"-persistmempool\", strprintf(\"Whether to save the mempool on shutdown and load on restart (default: %u)\", DEFAULT_PERSIST_MEMPOOL), false, OptionsCategory::OPTIONS);\n-#ifndef WIN32\n     gArgs.AddArg(\"-pid=<file>\", strprintf(\"Specify pid file. Relative paths will be prefixed by a net-specific datadir location. (default: %s)\", BITCOIN_PID_FILENAME), false, OptionsCategory::OPTIONS);\n-#else\n-    hidden_args.emplace_back(\"-pid\");\n-#endif\n     gArgs.AddArg(\"-prune=<n>\", strprintf(\"Reduce storage requirements by enabling pruning (deleting) of old blocks. This allows the pruneblockchain RPC to be called to delete specific blocks, and enables automatic pruning of old blocks if a target size in MiB is provided. This mode is incompatible with -txindex and -rescan. \"\n             \"Warning: Reverting this setting requires re-downloading the entire blockchain. \"\n             \"(default: 0 = disable pruning blocks, 1 = allow manual pruning via RPC, >=%u = automatically prune block files to stay under the specified target size in MiB)\", MIN_DISK_SPACE_FOR_BLOCK_FILES / 1024 / 1024), false, OptionsCategory::OPTIONS);\n@@ -1228,12 +1224,10 @@ bool AppInitMain(InitInterfaces& interfaces)\n {\n     const CChainParams& chainparams = Params();\n     // ********************************************************* Step 4a: application initialization\n-#ifndef WIN32\n     if (!CreatePidFile()) {\n         // Detailed error printed inside CreatePidFile().\n         return false;\n     }\n-#endif\n     if (LogInstance().m_print_to_file) {\n         if (gArgs.GetBoolArg(\"-shrinkdebugfile\", LogInstance().DefaultShrinkDebugFile())) {\n             // Do this first since it both loads a bunch of debug.log into memory,"
      }
    ]
  }
]