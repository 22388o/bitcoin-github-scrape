promag,2019-03-17T18:44:16Z,"Alternative to #15313 for 0.18, more details in http://www.erisian.com.au/bitcoin-core-dev/log-2019-03-16.html (line 279) cc @gmaxwell @jonasschnelli ",https://github.com/bitcoin/bitcoin/pull/15614#issuecomment-473699028,473699028,
jonasschnelli,2019-03-18T08:06:26Z,"Concept ACK for 0.18.\n\nLooks like a hack (but a good one)... I think we should merge this into 0.18 and properly remove synchronous dialogs in 0.19.",https://github.com/bitcoin/bitcoin/pull/15614#issuecomment-473808394,473808394,
jonasschnelli,2019-03-18T09:01:25Z,"Hmm... second thought: I'm unsure about this. This waits until the users closes the dialogs (rather then closing them explicit). This may lead to an RPC timeout in `unload wallet`...\n\nMaybe we combine this with #15313?",https://github.com/bitcoin/bitcoin/pull/15614#issuecomment-473824144,473824144,
promag,2019-03-18T09:27:59Z,"I don't think that's a problem. The RPC client can timeout (can also happen for other reasons, rescanning for instance?) but the RPC handler still waits. This fixes a unlikely crash (I mean, is there a good reason to do this?) without major changes and can be reverted easily if the future master refactor is backport.",https://github.com/bitcoin/bitcoin/pull/15614#issuecomment-473832797,473832797,
promag,2019-03-21T19:13:44Z,I'll verify if `QWindow::activeChanged` can be used instead of `QApplication::focusChanged`.,https://github.com/bitcoin/bitcoin/pull/15614#issuecomment-475366158,475366158,
MarcoFalke,2019-03-21T19:28:05Z,"Changed base, needs commit cherry-picked on some other base as well, obviously.",https://github.com/bitcoin/bitcoin/pull/15614#issuecomment-475370739,475370739,
promag,2019-03-21T19:46:36Z,Rebased.,https://github.com/bitcoin/bitcoin/pull/15614#issuecomment-475376465,475376465,
MarcoFalke,2019-03-21T20:01:25Z,"Should update OP with something like ""Addresses #15310""?",https://github.com/bitcoin/bitcoin/pull/15614#issuecomment-475380992,475380992,
gmaxwell,2019-03-21T20:07:49Z,This seems like a better workaround to the issue for the short term.,https://github.com/bitcoin/bitcoin/pull/15614#issuecomment-475383070,475383070,
promag,2019-03-21T20:08:22Z,"@MarcoFalke yes, after rebased with master.",https://github.com/bitcoin/bitcoin/pull/15614#issuecomment-475383278,475383278,
MarcoFalke,2019-03-21T20:14:54Z,"tested ACK f33e9bcda8a34385872555c1857bbabdf5c68134 (No longer crashes and having the modal gui dialog open will block the unloadwallet RPC, didn't review code too closely)",https://github.com/bitcoin/bitcoin/pull/15614#issuecomment-475385356,475385356,
DrahtBot,2019-03-21T21:37:19Z,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#15478](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15478.html) (wip: gui: Refactor open wallet activity by ",https://github.com/bitcoin/bitcoin/pull/15614#issuecomment-475412553,475412553,
promag,2019-03-22T00:16:00Z,@luke-jr care to elaborate?,https://github.com/bitcoin/bitcoin/pull/15614#issuecomment-475450062,475450062,
jonasschnelli,2019-03-22T10:06:23Z,Tested ACK a10972bc03e1ebbe79c3edc929c91ed53b391c9a,https://github.com/bitcoin/bitcoin/pull/15614#issuecomment-475562028,475562028,
luke-jr,2019-03-22T15:57:24Z,"@promag \n\nline 104 evaluates to false, then a problematic modal window is opened before line 111\n\nor\n\nline 104 evaluates to true, then the problematic modal window is closed before focusWindowChanged is connected; wallet closing then waits for some arbitrarily future time",https://github.com/bitcoin/bitcoin/pull/15614#issuecomment-475675979,475675979,
promag,2019-03-22T16:15:28Z,"@luke-jr it's impossible, both callbacks runs in the GUI thread and so:\n - first case, no modal can be opened;\n - second case, the modal can't be closed before connecting the signal.",https://github.com/bitcoin/bitcoin/pull/15614#issuecomment-475682687,475682687,
luke-jr,2019-03-22T21:56:26Z,I thought the whole point of the Qt::QueuedConnection was to move the callback to the GUI thread later?,https://github.com/bitcoin/bitcoin/pull/15614#issuecomment-475796648,475796648,
luke-jr,2019-03-22T21:57:15Z,"Ah, nevermind, I get it - the focusWindowChanged might be in another thread.",https://github.com/bitcoin/bitcoin/pull/15614#issuecomment-475796841,475796841,
promag,2019-03-21T22:12:22Z,"Just noting that the 3rd parameter `wallet_model` is used as the destination context, which means:\n - the connection is destroyed when the `wallet_model` is destroyed\n - the connection runs on the wallet model thread (GUI thread) due to `Qt::QueuedConnection`.\n",https://github.com/bitcoin/bitcoin/pull/15614#discussion_r267976860,267976860,src/qt/walletcontroller.cpp
