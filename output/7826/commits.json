[
  {
    "sha": "82962bd8c615a3758c1588ec9108082cdc9e4d30",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4Mjk2MmJkOGM2MTVhMzc1OGMxNTg4ZWM5MTA4MDgyY2RjOWU0ZDMw",
    "commit": {
      "author": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2016-04-06T14:20:08Z"
      },
      "committer": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2016-05-20T15:49:31Z"
      },
      "message": "[Qt] show mempool conflicts in the UI\n\nOn RPC level, we show possible mempool conflicts already via detecting them over the CWallet::GetConflicts() function.\nCurrently, the GUI shows only conflicts with transaction in a block.\n\nThis results in displaying replaced transaction (RBF) wrong.\n\nThis PR will mark unconfirmed transactions that are _not_ in our mempool and have conflicts as conflicted.",
      "tree": {
        "sha": "876d7cd04423b796b236a2831c1b0f95690c392d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/876d7cd04423b796b236a2831c1b0f95690c392d"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/82962bd8c615a3758c1588ec9108082cdc9e4d30",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "expired_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQIcBAABAgAGBQJXPzINAAoJECnUvLZBb1PstVwP/0PStDejgUvyEChmcSI5kLPP\nH1LSO2ASYFG8aMdC3TnwiiD88B5hZfUI9iOxAFUkwIoStM6z1Upsp/S2O7LQ7Dez\nr0bp6ELmAmblsSi2dySVpcXaty4rselwsxNkL6hjoYV931Se0qZe3kDLrUguFmrL\nvD0bEAOOviDmyB4GqaTpYHSOJzxGm+XxUL+/P26tirktBg66xY22GtgN/XaynMaI\nT3Nk31/ulr+DA/cso5WqLh0uR7NDAp/SJ3r01TJ08m9VC77XHevnoiq2LccWfNa/\nx1WpS7YD9Q/8jUEhdYApQgEen7xz1dSJb8gXUfDh77wtZRbG49Juyfs7N0hid3xh\nG1yF+0tbPu3oO8E7fhXVVfaDKCAaahPklsY0nx5eFK9REcK5a+awDyGlYwdIAYZb\n7P6LD1bqQ8MJkMdY2oXbQykmfSzwFLKXSISY1yqa8igVII0JLJQs0N52s3XEqp+m\nvgbZoqRwAupzw8zK7+Uu0Me9Tz4KLtopXg5fqVgl+oEh2juKNl8kXK17Bzb2yN6v\nFR3fTtrHpR1adUtXm4YuC3vh1PgerR37rMXpkh7VMx06AukGpy9zBtudGXVQskQx\nLkdWO5Ss9w5a+OTsJhaXPlf6PmFrH2iOcikvl8oGTUqiuk7fH/O5eHrwB+Y/u5rm\n2MnTSkYrDFo5wXtCoTUN\n=UWFh\n-----END PGP SIGNATURE-----",
        "payload": "tree 876d7cd04423b796b236a2831c1b0f95690c392d\nparent 8844ef15ded02d5ed86fb95aaf251235fcef2396\nauthor Jonas Schnelli <dev@jonasschnelli.ch> 1459952408 +0200\ncommitter Jonas Schnelli <dev@jonasschnelli.ch> 1463759371 +0200\n\n[Qt] show mempool conflicts in the UI\n\nOn RPC level, we show possible mempool conflicts already via detecting them over the CWallet::GetConflicts() function.\nCurrently, the GUI shows only conflicts with transaction in a block.\n\nThis results in displaying replaced transaction (RBF) wrong.\n\nThis PR will mark unconfirmed transactions that are _not_ in our mempool and have conflicts as conflicted.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/82962bd8c615a3758c1588ec9108082cdc9e4d30",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/82962bd8c615a3758c1588ec9108082cdc9e4d30",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/82962bd8c615a3758c1588ec9108082cdc9e4d30/comments",
    "author": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "8844ef15ded02d5ed86fb95aaf251235fcef2396",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8844ef15ded02d5ed86fb95aaf251235fcef2396",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/8844ef15ded02d5ed86fb95aaf251235fcef2396"
      }
    ],
    "stats": {
      "total": 25,
      "additions": 24,
      "deletions": 1
    },
    "files": [
      {
        "sha": "ba71a273697e09a71f66af0a80e5227a7335d469",
        "filename": "src/Makefile.qt.include",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/82962bd8c615a3758c1588ec9108082cdc9e4d30/src/Makefile.qt.include",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/82962bd8c615a3758c1588ec9108082cdc9e4d30/src/Makefile.qt.include",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/Makefile.qt.include?ref=82962bd8c615a3758c1588ec9108082cdc9e4d30",
        "patch": "@@ -263,6 +263,7 @@ RES_ICONS = \\\n   qt/res/icons/transaction0.png \\\n   qt/res/icons/transaction2.png \\\n   qt/res/icons/transaction_conflicted.png \\\n+  qt/res/icons/transaction_conflicted_notinmempool.png \\\n   qt/res/icons/tx_inout.png \\\n   qt/res/icons/tx_input.png \\\n   qt/res/icons/tx_output.png \\"
      },
      {
        "sha": "73cc3c79ea9471a906e404f70975f96d98b0b615",
        "filename": "src/qt/bitcoin.qrc",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/82962bd8c615a3758c1588ec9108082cdc9e4d30/src/qt/bitcoin.qrc",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/82962bd8c615a3758c1588ec9108082cdc9e4d30/src/qt/bitcoin.qrc",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/bitcoin.qrc?ref=82962bd8c615a3758c1588ec9108082cdc9e4d30",
        "patch": "@@ -12,6 +12,7 @@\n         <file alias=\"transaction_0\">res/icons/transaction0.png</file>\n         <file alias=\"transaction_confirmed\">res/icons/transaction2.png</file>\n         <file alias=\"transaction_conflicted\">res/icons/transaction_conflicted.png</file>\n+        <file alias=\"transaction_conflicted_notinmempool\">res/icons/transaction_conflicted_notinmempool.png</file>\n         <file alias=\"transaction_1\">res/icons/clock1.png</file>\n         <file alias=\"transaction_2\">res/icons/clock2.png</file>\n         <file alias=\"transaction_3\">res/icons/clock3.png</file>"
      },
      {
        "sha": "305d3c76641981fdaa6a7147394a80509e7f89d5",
        "filename": "src/qt/res/icons/transaction_conflicted_notinmempool.png",
        "status": "added",
        "additions": 0,
        "deletions": 0,
        "changes": 0,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/82962bd8c615a3758c1588ec9108082cdc9e4d30/src/qt/res/icons/transaction_conflicted_notinmempool.png",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/82962bd8c615a3758c1588ec9108082cdc9e4d30/src/qt/res/icons/transaction_conflicted_notinmempool.png",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/res/icons/transaction_conflicted_notinmempool.png?ref=82962bd8c615a3758c1588ec9108082cdc9e4d30"
      },
      {
        "sha": "ec9d579d462f661d4991e9c398dc5145c4e18e69",
        "filename": "src/qt/transactionfilterproxy.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/82962bd8c615a3758c1588ec9108082cdc9e4d30/src/qt/transactionfilterproxy.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/82962bd8c615a3758c1588ec9108082cdc9e4d30/src/qt/transactionfilterproxy.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/transactionfilterproxy.cpp?ref=82962bd8c615a3758c1588ec9108082cdc9e4d30",
        "patch": "@@ -41,7 +41,7 @@ bool TransactionFilterProxy::filterAcceptsRow(int sourceRow, const QModelIndex &\n     qint64 amount = llabs(index.data(TransactionTableModel::AmountRole).toLongLong());\n     int status = index.data(TransactionTableModel::StatusRole).toInt();\n \n-    if(!showInactive && status == TransactionStatus::Conflicted)\n+    if(!showInactive && (status == TransactionStatus::Conflicted || status == TransactionStatus::ConflictedNotInMempool))\n         return false;\n     if(!(TYPE(type) & typeFilter))\n         return false;"
      },
      {
        "sha": "12754597a1ba3a1d4059a14a84319b14558b1b0b",
        "filename": "src/qt/transactionrecord.cpp",
        "status": "modified",
        "additions": 15,
        "deletions": 0,
        "changes": 15,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/82962bd8c615a3758c1588ec9108082cdc9e4d30/src/qt/transactionrecord.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/82962bd8c615a3758c1588ec9108082cdc9e4d30/src/qt/transactionrecord.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/transactionrecord.cpp?ref=82962bd8c615a3758c1588ec9108082cdc9e4d30",
        "patch": "@@ -7,6 +7,7 @@\n #include \"base58.h\"\n #include \"consensus/consensus.h\"\n #include \"main.h\"\n+#include \"txmempool.h\"\n #include \"timedata.h\"\n #include \"wallet/wallet.h\"\n \n@@ -187,6 +188,7 @@ void TransactionRecord::updateStatus(const CWalletTx &wtx)\n     status.countsForBalance = wtx.IsTrusted() && !(wtx.GetBlocksToMaturity() > 0);\n     status.depth = wtx.GetDepthInMainChain();\n     status.cur_num_blocks = chainActive.Height();\n+    status.inMempool = wtx.InMempool();\n \n     if (!CheckFinalTx(wtx))\n     {\n@@ -239,6 +241,8 @@ void TransactionRecord::updateStatus(const CWalletTx &wtx)\n         else if (status.depth == 0)\n         {\n             status.status = TransactionStatus::Unconfirmed;\n+            if (!status.inMempool && wtx.GetConflicts().size())\n+                status.status = TransactionStatus::ConflictedNotInMempool;\n             if (wtx.isAbandoned())\n                 status.status = TransactionStatus::Abandoned;\n         }\n@@ -257,6 +261,17 @@ void TransactionRecord::updateStatus(const CWalletTx &wtx)\n bool TransactionRecord::statusUpdateNeeded()\n {\n     AssertLockHeld(cs_main);\n+    {\n+        // to detect mempool conflicts, we need to check each\n+        // transaction if the mempool status has been changed.\n+        // Could be further improved by a signal fired when a\n+        // mempool transaction has been evicted\n+\n+        LOCK(mempool.cs);\n+        if (status.inMempool != mempool.exists(hash))\n+            return true;\n+    }\n+\n     return status.cur_num_blocks != chainActive.Height();\n }\n "
      },
      {
        "sha": "5ab0ff8b5bbad0c435055ba9616509cb26ef6407",
        "filename": "src/qt/transactionrecord.h",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/82962bd8c615a3758c1588ec9108082cdc9e4d30/src/qt/transactionrecord.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/82962bd8c615a3758c1588ec9108082cdc9e4d30/src/qt/transactionrecord.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/transactionrecord.h?ref=82962bd8c615a3758c1588ec9108082cdc9e4d30",
        "patch": "@@ -33,6 +33,7 @@ class TransactionStatus\n         Unconfirmed,        /**< Not yet mined into a block **/\n         Confirming,         /**< Confirmed, but waiting for the recommended number of confirmations **/\n         Conflicted,         /**< Conflicts with other transaction or mempool **/\n+        ConflictedNotInMempool, /**< Conflicts with other transaction but is not in mempool (RBF/replaced) **/\n         Abandoned,          /**< Abandoned from the wallet **/\n         /// Generated (mined) transactions\n         Immature,           /**< Mined but waiting for maturity */\n@@ -61,6 +62,8 @@ class TransactionStatus\n \n     /** Current number of blocks (to know whether cached status is still valid) */\n     int cur_num_blocks;\n+\n+    bool inMempool;\n };\n \n /** UI model for a transaction. A core transaction can be represented by multiple UI transactions if it has"
      },
      {
        "sha": "039ad91226974863973500070211a4e5753c94ce",
        "filename": "src/qt/transactiontablemodel.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/82962bd8c615a3758c1588ec9108082cdc9e4d30/src/qt/transactiontablemodel.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/82962bd8c615a3758c1588ec9108082cdc9e4d30/src/qt/transactiontablemodel.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/transactiontablemodel.cpp?ref=82962bd8c615a3758c1588ec9108082cdc9e4d30",
        "patch": "@@ -321,6 +321,7 @@ QString TransactionTableModel::formatTxStatus(const TransactionRecord *wtx) cons\n     case TransactionStatus::Confirmed:\n         status = tr(\"Confirmed (%1 confirmations)\").arg(wtx->status.depth);\n         break;\n+    case TransactionStatus::ConflictedNotInMempool:\n     case TransactionStatus::Conflicted:\n         status = tr(\"Conflicted\");\n         break;\n@@ -486,6 +487,8 @@ QVariant TransactionTableModel::txStatusDecoration(const TransactionRecord *wtx)\n         return QIcon(\":/icons/transaction_confirmed\");\n     case TransactionStatus::Conflicted:\n         return QIcon(\":/icons/transaction_conflicted\");\n+    case TransactionStatus::ConflictedNotInMempool:\n+        return QIcon(\":/icons/transaction_conflicted_notinmempool\");\n     case TransactionStatus::Immature: {\n         int total = wtx->status.depth + wtx->status.matures_in;\n         int part = (wtx->status.depth * 4 / total) + 1;"
      }
    ]
  }
]