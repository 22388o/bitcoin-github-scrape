[
  {
    "sha": "16a5c18cea7330bd68dc9d2f768eb518af88795b",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxNmE1YzE4Y2VhNzMzMGJkNjhkYzlkMmY3NjhlYjUxOGFmODg3OTVi",
    "commit": {
      "author": {
        "name": "Gregory Maxwell",
        "email": "greg@xiph.org",
        "date": "2015-01-14T01:43:39Z"
      },
      "committer": {
        "name": "Gregory Maxwell",
        "email": "greg@xiph.org",
        "date": "2015-01-14T17:49:57Z"
      },
      "message": "Add a -rpckeepalive and disable RPC use of HTTP persistent connections.\n\nIt turns out that some miners have been staying with old versions of\n Bitcoin Core because their software  behaves poorly with persistent\n connections and the Bitcoin Core thread and connection limits.\n\nWhat happens is that underlying  HTTP libraries leave connections open\n invisibly to their users and then the user runs into the default four\n thread limit.  This looks like Bitcoin Core is unresponsive to RPC.\n\nThere are many things that should be improved in Bitcoin Core's behavior\n here, e.g. supporting more concurrent connections, not tying up threads\n for idle connections, disconnecting kept-alive  connections when limits\n are reached, etc. All are fairly big, risky changes.\n\nDisabling keep-alive is a simple workaround. It's often not easy to turn\n off the keep-alive support in the client where it may be buried in some\n platform library.\n\nIf you are one of the few who really needs persistent connections you\n probably know that you want them and can find a switch; while if you\n don't and the misbehavior is hitting you it is hard to discover the\n source of your problems is keepalive related.  Given that it is best\n to default to off until they're handled better.",
      "tree": {
        "sha": "338fef59c36dfd4141a2782b7e045ab5a72220ad",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/338fef59c36dfd4141a2782b7e045ab5a72220ad"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/16a5c18cea7330bd68dc9d2f768eb518af88795b",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/16a5c18cea7330bd68dc9d2f768eb518af88795b",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/16a5c18cea7330bd68dc9d2f768eb518af88795b",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/16a5c18cea7330bd68dc9d2f768eb518af88795b/comments",
    "author": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "d1aa3c67f027fd1fc6993bcc52c83c68715edcc5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d1aa3c67f027fd1fc6993bcc52c83c68715edcc5",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/d1aa3c67f027fd1fc6993bcc52c83c68715edcc5"
      }
    ],
    "stats": {
      "total": 3,
      "additions": 2,
      "deletions": 1
    },
    "files": [
      {
        "sha": "f851fcbbca420767dcbc1b7b14601e2e9beb4c31",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/16a5c18cea7330bd68dc9d2f768eb518af88795b/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/16a5c18cea7330bd68dc9d2f768eb518af88795b/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=16a5c18cea7330bd68dc9d2f768eb518af88795b",
        "patch": "@@ -380,6 +380,7 @@ std::string HelpMessage(HelpMessageMode mode)\n     strUsage += \"  -rpcport=<port>        \" + strprintf(_(\"Listen for JSON-RPC connections on <port> (default: %u or testnet: %u)\"), 8332, 18332) + \"\\n\";\n     strUsage += \"  -rpcallowip=<ip>       \" + _(\"Allow JSON-RPC connections from specified source. Valid for <ip> are a single IP (e.g. 1.2.3.4), a network/netmask (e.g. 1.2.3.4/255.255.255.0) or a network/CIDR (e.g. 1.2.3.4/24). This option can be specified multiple times\") + \"\\n\";\n     strUsage += \"  -rpcthreads=<n>        \" + strprintf(_(\"Set the number of threads to service RPC calls (default: %d)\"), 4) + \"\\n\";\n+    strUsage += \"  -rpckeepalive          \" + strprintf(_(\"RPC support for HTTP persistent connections (default: %d)\"), 0) + \"\\n\";\n \n     strUsage += \"\\n\" + _(\"RPC SSL options: (see the Bitcoin Wiki for SSL setup instructions)\") + \"\\n\";\n     strUsage += \"  -rpcssl                                  \" + _(\"Use OpenSSL (https) for JSON-RPC connections\") + \"\\n\";"
      },
      {
        "sha": "9ebacdbe2e0c6cbe6febd36dc8052b7f5c00e6f5",
        "filename": "src/rpcserver.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/16a5c18cea7330bd68dc9d2f768eb518af88795b/src/rpcserver.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/16a5c18cea7330bd68dc9d2f768eb518af88795b/src/rpcserver.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpcserver.cpp?ref=16a5c18cea7330bd68dc9d2f768eb518af88795b",
        "patch": "@@ -953,7 +953,7 @@ void ServiceConnection(AcceptedConnection *conn)\n         ReadHTTPMessage(conn->stream(), mapHeaders, strRequest, nProto, MAX_SIZE);\n \n         // HTTP Keep-Alive is false; close connection immediately\n-        if (mapHeaders[\"connection\"] == \"close\")\n+        if ((mapHeaders[\"connection\"] == \"close\") || (!GetBoolArg(\"-rpckeepalive\", false)))\n             fRun = false;\n \n         // Process via JSON-RPC API"
      }
    ]
  },
  {
    "sha": "56c1093dae0c523f9f643f00c67414691272a983",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1NmMxMDkzZGFlMGM1MjNmOWY2NDNmMDBjNjc0MTQ2OTEyNzJhOTgz",
    "commit": {
      "author": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@gmail.com",
        "date": "2015-01-14T11:45:11Z"
      },
      "committer": {
        "name": "Gregory Maxwell",
        "email": "greg@xiph.org",
        "date": "2015-01-14T17:50:00Z"
      },
      "message": "fix tests for #5655",
      "tree": {
        "sha": "a24e15e6cb98f4283d12c54720a9785149dc3c91",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a24e15e6cb98f4283d12c54720a9785149dc3c91"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/56c1093dae0c523f9f643f00c67414691272a983",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/56c1093dae0c523f9f643f00c67414691272a983",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/56c1093dae0c523f9f643f00c67414691272a983",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/56c1093dae0c523f9f643f00c67414691272a983/comments",
    "author": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "16a5c18cea7330bd68dc9d2f768eb518af88795b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/16a5c18cea7330bd68dc9d2f768eb518af88795b",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/16a5c18cea7330bd68dc9d2f768eb518af88795b"
      }
    ],
    "stats": {
      "total": 8,
      "additions": 7,
      "deletions": 1
    },
    "files": [
      {
        "sha": "7a9857a77102a6231ce71676da8095bfe6b6c955",
        "filename": "qa/rpc-tests/httpbasics.py",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/56c1093dae0c523f9f643f00c67414691272a983/qa/rpc-tests/httpbasics.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/56c1093dae0c523f9f643f00c67414691272a983/qa/rpc-tests/httpbasics.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/qa/rpc-tests/httpbasics.py?ref=56c1093dae0c523f9f643f00c67414691272a983",
        "patch": "@@ -21,6 +21,9 @@\n     import urlparse\n \n class HTTPBasicsTest (BitcoinTestFramework):        \n+    def setup_nodes(self):\n+        return start_nodes(4, self.options.tmpdir, extra_args=[['-rpckeepalive']]*4)\n+\n     def run_test(self):        \n         \n         #################################################"
      },
      {
        "sha": "4c8a11b821d4af21e870a5d3e21e494b8a15857f",
        "filename": "qa/rpc-tests/test_framework.py",
        "status": "modified",
        "additions": 4,
        "deletions": 1,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/56c1093dae0c523f9f643f00c67414691272a983/qa/rpc-tests/test_framework.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/56c1093dae0c523f9f643f00c67414691272a983/qa/rpc-tests/test_framework.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/qa/rpc-tests/test_framework.py?ref=56c1093dae0c523f9f643f00c67414691272a983",
        "patch": "@@ -33,8 +33,11 @@ def setup_chain(self):\n         print(\"Initializing test directory \"+self.options.tmpdir)\n         initialize_chain(self.options.tmpdir)\n \n+    def setup_nodes(self):\n+        return start_nodes(4, self.options.tmpdir)\n+\n     def setup_network(self, split = False):\n-        self.nodes = start_nodes(4, self.options.tmpdir)\n+        self.nodes = self.setup_nodes()\n \n         # Connect the nodes as a \"chain\".  This allows us\n         # to split the network between nodes 1 and 2 to get"
      }
    ]
  },
  {
    "sha": "1dd8ee72afc26191da51d8d3a5590eab7c9368f6",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxZGQ4ZWU3MmFmYzI2MTkxZGE1MWQ4ZDNhNTU5MGVhYjdjOTM2OGY2",
    "commit": {
      "author": {
        "name": "Jonas Schnelli",
        "email": "jonas.schnelli@include7.ch",
        "date": "2015-01-14T15:36:48Z"
      },
      "committer": {
        "name": "Gregory Maxwell",
        "email": "greg@xiph.org",
        "date": "2015-01-14T17:50:00Z"
      },
      "message": "improve tests for #5655",
      "tree": {
        "sha": "624089594c54cf63ba6f2aea0195b2cfe2790e65",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/624089594c54cf63ba6f2aea0195b2cfe2790e65"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1dd8ee72afc26191da51d8d3a5590eab7c9368f6",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1dd8ee72afc26191da51d8d3a5590eab7c9368f6",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/1dd8ee72afc26191da51d8d3a5590eab7c9368f6",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1dd8ee72afc26191da51d8d3a5590eab7c9368f6/comments",
    "author": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "56c1093dae0c523f9f643f00c67414691272a983",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/56c1093dae0c523f9f643f00c67414691272a983",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/56c1093dae0c523f9f643f00c67414691272a983"
      }
    ],
    "stats": {
      "total": 25,
      "additions": 24,
      "deletions": 1
    },
    "files": [
      {
        "sha": "8cbf1d7f4c457e244801712f288e02d805203078",
        "filename": "qa/rpc-tests/httpbasics.py",
        "status": "modified",
        "additions": 24,
        "deletions": 1,
        "changes": 25,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1dd8ee72afc26191da51d8d3a5590eab7c9368f6/qa/rpc-tests/httpbasics.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1dd8ee72afc26191da51d8d3a5590eab7c9368f6/qa/rpc-tests/httpbasics.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/qa/rpc-tests/httpbasics.py?ref=1dd8ee72afc26191da51d8d3a5590eab7c9368f6",
        "patch": "@@ -22,7 +22,7 @@\n \n class HTTPBasicsTest (BitcoinTestFramework):        \n     def setup_nodes(self):\n-        return start_nodes(4, self.options.tmpdir, extra_args=[['-rpckeepalive']]*4)\n+        return start_nodes(4, self.options.tmpdir, extra_args=[['-rpckeepalive=1'], ['-rpckeepalive=0'], [], []])\n \n     def run_test(self):        \n         \n@@ -74,6 +74,29 @@ def run_test(self):\n         assert_equal('\"error\":null' in out1, True)\n         assert_equal(conn.sock!=None, False) #now the connection must be closed after the response        \n         \n+        #node1 (2nd node) is running with disabled keep-alive option\n+        urlNode1 = urlparse.urlparse(self.nodes[1].url)\n+        authpair = urlNode1.username + ':' + urlNode1.password\n+        headers = {\"Authorization\": \"Basic \" + base64.b64encode(authpair)}\n+                \n+        conn = httplib.HTTPConnection(urlNode1.hostname, urlNode1.port)\n+        conn.connect()\n+        conn.request('GET', '/', '{\"method\": \"getbestblockhash\"}', headers)\n+        out1 = conn.getresponse().read();\n+        assert_equal('\"error\":null' in out1, True)\n+        assert_equal(conn.sock!=None, False) #connection must be closed because keep-alive was set to false\n+        \n+        #node2 (third node) is running with standard keep-alive parameters which means keep-alive is off\n+        urlNode2 = urlparse.urlparse(self.nodes[2].url)\n+        authpair = urlNode2.username + ':' + urlNode2.password\n+        headers = {\"Authorization\": \"Basic \" + base64.b64encode(authpair)}\n+                \n+        conn = httplib.HTTPConnection(urlNode2.hostname, urlNode2.port)\n+        conn.connect()\n+        conn.request('GET', '/', '{\"method\": \"getbestblockhash\"}', headers)\n+        out1 = conn.getresponse().read();\n+        assert_equal('\"error\":null' in out1, True)\n+        assert_equal(conn.sock!=None, False) #connection must be closed because bitcoind should use keep-alive by default\n         \n if __name__ == '__main__':\n     HTTPBasicsTest ().main ()"
      }
    ]
  }
]