[
  {
    "sha": "d76a8acb9b7bcabf43e3e05168a36911f187818d",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpkNzZhOGFjYjliN2JjYWJmNDNlM2UwNTE2OGEzNjkxMWYxODc4MThk",
    "commit": {
      "author": {
        "name": "Jonas Schnelli",
        "email": "jonas.schnelli@include7.ch",
        "date": "2015-09-16T14:42:23Z"
      },
      "committer": {
        "name": "Jonas Schnelli",
        "email": "jonas.schnelli@include7.ch",
        "date": "2015-09-16T14:51:21Z"
      },
      "message": "use CBlockIndex* insted of uint256 for UpdatedBlockTip signal\n\n- removes mapBlockIndex find operation\n- theoretically allows removing the cs_main lock during zqm notification while introducing a new file position lock",
      "tree": {
        "sha": "2322acc9cd1448c524e7507a517deca6da7cf43c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2322acc9cd1448c524e7507a517deca6da7cf43c"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d76a8acb9b7bcabf43e3e05168a36911f187818d",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d76a8acb9b7bcabf43e3e05168a36911f187818d",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/d76a8acb9b7bcabf43e3e05168a36911f187818d",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d76a8acb9b7bcabf43e3e05168a36911f187818d/comments",
    "author": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "0143a1f228c3447ae2e025c697b0ad53a0d8d306",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0143a1f228c3447ae2e025c697b0ad53a0d8d306",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/0143a1f228c3447ae2e025c697b0ad53a0d8d306"
      }
    ],
    "stats": {
      "total": 38,
      "additions": 21,
      "deletions": 17
    },
    "files": [
      {
        "sha": "d0d2476462a98f3057bcf403a645d1cb143079af",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d76a8acb9b7bcabf43e3e05168a36911f187818d/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d76a8acb9b7bcabf43e3e05168a36911f187818d/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=d76a8acb9b7bcabf43e3e05168a36911f187818d",
        "patch": "@@ -2303,7 +2303,7 @@ bool ActivateBestChain(CValidationState &state, const CBlock *pblock) {\n                         pnode->PushInventory(CInv(MSG_BLOCK, hashNewTip));\n             }\n             // Notify external listeners about the new tip.\n-            GetMainSignals().UpdatedBlockTip(hashNewTip);\n+            GetMainSignals().UpdatedBlockTip(pindexNewTip);\n             uiInterface.NotifyBlockTip(hashNewTip);\n         }\n     } while(pindexMostWork != chainActive.Tip());"
      },
      {
        "sha": "ffb56d266b95846db70ce5a162f2802b263e935d",
        "filename": "src/validationinterface.h",
        "status": "modified",
        "additions": 3,
        "deletions": 2,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d76a8acb9b7bcabf43e3e05168a36911f187818d/src/validationinterface.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d76a8acb9b7bcabf43e3e05168a36911f187818d/src/validationinterface.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/validationinterface.h?ref=d76a8acb9b7bcabf43e3e05168a36911f187818d",
        "patch": "@@ -11,6 +11,7 @@\n \n class CBlock;\n struct CBlockLocator;\n+class CBlockIndex;\n class CReserveScript;\n class CTransaction;\n class CValidationInterface;\n@@ -30,7 +31,7 @@ void SyncWithWallets(const CTransaction& tx, const CBlock* pblock = NULL);\n \n class CValidationInterface {\n protected:\n-    virtual void UpdatedBlockTip(const uint256 &newHashTip) {}\n+    virtual void UpdatedBlockTip(const CBlockIndex *pindex) {}\n     virtual void SyncTransaction(const CTransaction &tx, const CBlock *pblock) {}\n     virtual void SetBestChain(const CBlockLocator &locator) {}\n     virtual void UpdatedTransaction(const uint256 &hash) {}\n@@ -46,7 +47,7 @@ class CValidationInterface {\n \n struct CMainSignals {\n     /** Notifies listeners of updated block chain tip */\n-    boost::signals2::signal<void (const uint256 &)> UpdatedBlockTip;\n+    boost::signals2::signal<void (const CBlockIndex *)> UpdatedBlockTip;\n     /** Notifies listeners of updated transaction data (transaction, and optionally the block it is found in. */\n     boost::signals2::signal<void (const CTransaction &, const CBlock *)> SyncTransaction;\n     /** Notifies listeners of an updated transaction without new data (for now: a coinbase potentially becoming visible). */"
      },
      {
        "sha": "9f5cb3ba677ce5ca8b851c3c1719cb70cbf70275",
        "filename": "src/zmq/zmqabstractnotifier.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d76a8acb9b7bcabf43e3e05168a36911f187818d/src/zmq/zmqabstractnotifier.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d76a8acb9b7bcabf43e3e05168a36911f187818d/src/zmq/zmqabstractnotifier.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/zmq/zmqabstractnotifier.cpp?ref=d76a8acb9b7bcabf43e3e05168a36911f187818d",
        "patch": "@@ -11,7 +11,7 @@ CZMQAbstractNotifier::~CZMQAbstractNotifier()\n     assert(!psocket);\n }\n \n-bool CZMQAbstractNotifier::NotifyBlock(const uint256 &/*hash*/)\n+bool CZMQAbstractNotifier::NotifyBlock(const CBlockIndex * /*CBlockIndex*/)\n {\n     return true;\n }"
      },
      {
        "sha": "77cf5141e27b7568dbd8a3e9499b64f06477f095",
        "filename": "src/zmq/zmqabstractnotifier.h",
        "status": "modified",
        "additions": 3,
        "deletions": 1,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d76a8acb9b7bcabf43e3e05168a36911f187818d/src/zmq/zmqabstractnotifier.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d76a8acb9b7bcabf43e3e05168a36911f187818d/src/zmq/zmqabstractnotifier.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/zmq/zmqabstractnotifier.h?ref=d76a8acb9b7bcabf43e3e05168a36911f187818d",
        "patch": "@@ -7,7 +7,9 @@\n \n #include \"zmqconfig.h\"\n \n+class CBlockIndex;\n class CZMQAbstractNotifier;\n+\n typedef CZMQAbstractNotifier* (*CZMQNotifierFactory)();\n \n class CZMQAbstractNotifier\n@@ -30,7 +32,7 @@ class CZMQAbstractNotifier\n     virtual bool Initialize(void *pcontext) = 0;\n     virtual void Shutdown() = 0;\n \n-    virtual bool NotifyBlock(const uint256 &hash);\n+    virtual bool NotifyBlock(const CBlockIndex *pindex);\n     virtual bool NotifyTransaction(const CTransaction &transaction);\n \n protected:"
      },
      {
        "sha": "388b86707b346b19e9f452de50486af47e5613ea",
        "filename": "src/zmq/zmqnotificationinterface.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d76a8acb9b7bcabf43e3e05168a36911f187818d/src/zmq/zmqnotificationinterface.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d76a8acb9b7bcabf43e3e05168a36911f187818d/src/zmq/zmqnotificationinterface.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/zmq/zmqnotificationinterface.cpp?ref=d76a8acb9b7bcabf43e3e05168a36911f187818d",
        "patch": "@@ -120,12 +120,12 @@ void CZMQNotificationInterface::Shutdown()\n     }\n }\n \n-void CZMQNotificationInterface::UpdatedBlockTip(const uint256 &hash)\n+void CZMQNotificationInterface::UpdatedBlockTip(const CBlockIndex *pindex)\n {\n     for (std::list<CZMQAbstractNotifier*>::iterator i = notifiers.begin(); i!=notifiers.end(); )\n     {\n         CZMQAbstractNotifier *notifier = *i;\n-        if (notifier->NotifyBlock(hash))\n+        if (notifier->NotifyBlock(pindex))\n         {\n             i++;\n         }"
      },
      {
        "sha": "8eea15c0689ccdcadb61ff358e8834e13c514673",
        "filename": "src/zmq/zmqnotificationinterface.h",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d76a8acb9b7bcabf43e3e05168a36911f187818d/src/zmq/zmqnotificationinterface.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d76a8acb9b7bcabf43e3e05168a36911f187818d/src/zmq/zmqnotificationinterface.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/zmq/zmqnotificationinterface.h?ref=d76a8acb9b7bcabf43e3e05168a36911f187818d",
        "patch": "@@ -9,6 +9,7 @@\n #include <string>\n #include <map>\n \n+class CBlockIndex;\n class CZMQAbstractNotifier;\n \n class CZMQNotificationInterface : public CValidationInterface\n@@ -23,7 +24,7 @@ class CZMQNotificationInterface : public CValidationInterface\n \n protected: // CValidationInterface\n     void SyncTransaction(const CTransaction &tx, const CBlock *pblock);\n-    void UpdatedBlockTip(const uint256 &newHashTip);\n+    void UpdatedBlockTip(const CBlockIndex *pindex);\n \n private:\n     CZMQNotificationInterface();"
      },
      {
        "sha": "4c3eb8f2d9666debb02c692e4f413266d4583c23",
        "filename": "src/zmq/zmqpublishnotifier.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 7,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d76a8acb9b7bcabf43e3e05168a36911f187818d/src/zmq/zmqpublishnotifier.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d76a8acb9b7bcabf43e3e05168a36911f187818d/src/zmq/zmqpublishnotifier.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/zmq/zmqpublishnotifier.cpp?ref=d76a8acb9b7bcabf43e3e05168a36911f187818d",
        "patch": "@@ -116,8 +116,9 @@ void CZMQAbstractPublishNotifier::Shutdown()\n     psocket = 0;\n }\n \n-bool CZMQPublishHashBlockNotifier::NotifyBlock(const uint256 &hash)\n+bool CZMQPublishHashBlockNotifier::NotifyBlock(const CBlockIndex *pindex)\n {\n+    uint256 hash = pindex->GetBlockHash();\n     LogPrint(\"zmq\", \"Publish hash block %s\\n\", hash.GetHex());\n     char data[32];\n     for (unsigned int i = 0; i < 32; i++)\n@@ -137,18 +138,15 @@ bool CZMQPublishHashTransactionNotifier::NotifyTransaction(const CTransaction &t\n     return rc == 0;\n }\n \n-bool CZMQPublishRawBlockNotifier::NotifyBlock(const uint256 &hash)\n+bool CZMQPublishRawBlockNotifier::NotifyBlock(const CBlockIndex *pindex)\n {\n-    LogPrint(\"zmq\", \"Publish raw block %s\\n\", hash.GetHex());\n+    LogPrint(\"zmq\", \"Publish raw block %s\\n\", pindex->GetBlockHash().GetHex());\n \n     CDataStream ss(SER_NETWORK, PROTOCOL_VERSION);\n     {\n         LOCK(cs_main);\n-\n         CBlock block;\n-        CBlockIndex* pblockindex = mapBlockIndex[hash];\n-\n-        if(!ReadBlockFromDisk(block, pblockindex))\n+        if(!ReadBlockFromDisk(block, pindex))\n         {\n             zmqError(\"Can't read block from disk\");\n             return false;"
      },
      {
        "sha": "44d5cbea67d2031446ac47df030c90165772af5e",
        "filename": "src/zmq/zmqpublishnotifier.h",
        "status": "modified",
        "additions": 4,
        "deletions": 2,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d76a8acb9b7bcabf43e3e05168a36911f187818d/src/zmq/zmqpublishnotifier.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d76a8acb9b7bcabf43e3e05168a36911f187818d/src/zmq/zmqpublishnotifier.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/zmq/zmqpublishnotifier.h?ref=d76a8acb9b7bcabf43e3e05168a36911f187818d",
        "patch": "@@ -7,6 +7,8 @@\n \n #include \"zmqabstractnotifier.h\"\n \n+class CBlockIndex;\n+\n class CZMQAbstractPublishNotifier : public CZMQAbstractNotifier\n {\n public:\n@@ -17,7 +19,7 @@ class CZMQAbstractPublishNotifier : public CZMQAbstractNotifier\n class CZMQPublishHashBlockNotifier : public CZMQAbstractPublishNotifier\n {\n public:\n-    bool NotifyBlock(const uint256 &hash);\n+    bool NotifyBlock(const CBlockIndex *pindex);\n };\n \n class CZMQPublishHashTransactionNotifier : public CZMQAbstractPublishNotifier\n@@ -29,7 +31,7 @@ class CZMQPublishHashTransactionNotifier : public CZMQAbstractPublishNotifier\n class CZMQPublishRawBlockNotifier : public CZMQAbstractPublishNotifier\n {\n public:\n-    bool NotifyBlock(const uint256 &hash);\n+    bool NotifyBlock(const CBlockIndex *pindex);\n };\n \n class CZMQPublishRawTransactionNotifier : public CZMQAbstractPublishNotifier"
      }
    ]
  }
]