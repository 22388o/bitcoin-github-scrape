[
  {
    "sha": "bb44d9e7546e6118cd91db5bbe471a3ce2ee7fcd",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiYjQ0ZDllNzU0NmU2MTE4Y2Q5MWRiNWJiZTQ3MWEzY2UyZWU3ZmNk",
    "commit": {
      "author": {
        "name": "Cory Fields",
        "email": "cory-nospam-@coryfields.com",
        "date": "2015-03-17T01:01:20Z"
      },
      "committer": {
        "name": "Cory Fields",
        "email": "cory-nospam-@coryfields.com",
        "date": "2015-03-17T03:45:15Z"
      },
      "message": "depends: fix a static qt5 crash when using certain versions of libxcb\n\nSee here for background: https://bugreports.qt.io/browse/QTBUG-34748\n\nlibxcb temporarily had an abi breakage which caused crashes when qt was\ncompiled against a non-compatible version. Building qt with -qt-xcb should have\nshielded us from this issue, except that incompatible headers were used when\nbuilding qt's wrapper.\n\nMake sure those headers aren't picked up by qt's build.\n\nDetails:\n\nqt's build adds a wrapper around the xcb libs when -qt-xcb is used. This is\ndone to avoid having to link to a handful of different libs, which may not be\napi/abi stable. This build depends on include-order, so that its files are\nfound before the real libxcb headers.\n\nOur build (for other reasons related to qt's complicated build-system) injects\nour prefix into CXXFLAGS. Because libxcb is found in this path, that reverses\nthe include-order, negating the purpose of the wrapper.\n\nTo fix, libxcb's includes are simply moved to a subdir. pkg-config ensures that\nthey're still found properly when needed.\n\nTo make things even more interesting, this behavior in qt's .pro files is broken:\nINCLUDEPATH += $$QMAKE_CFLAGS_XCB\n\nThe INCLUDEPATH variable is processed by qmake which automatically prefixes each\nentry with \"-I\". The QMAKE_CFLAGS_XCB variable comes from pkg-config and\nalready contains -I, making the path look like \"-I-I/path/to/xcb/headers\".\n\nTo work around that, CFLAGS/CXXFLAGS are used here rather than INCLUDEPATH.",
      "tree": {
        "sha": "053574a48db2838d265bd7bf5fe61e14446343bc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/053574a48db2838d265bd7bf5fe61e14446343bc"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/bb44d9e7546e6118cd91db5bbe471a3ce2ee7fcd",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bb44d9e7546e6118cd91db5bbe471a3ce2ee7fcd",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/bb44d9e7546e6118cd91db5bbe471a3ce2ee7fcd",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bb44d9e7546e6118cd91db5bbe471a3ce2ee7fcd/comments",
    "author": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "226f880498f82aee0d59974142dea3eeec2a12ee",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/226f880498f82aee0d59974142dea3eeec2a12ee",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/226f880498f82aee0d59974142dea3eeec2a12ee"
      }
    ],
    "stats": {
      "total": 55,
      "additions": 35,
      "deletions": 20
    },
    "files": [
      {
        "sha": "28f2bd6f25343de809c9b2c568bd88b778bb26ec",
        "filename": "depends/packages/libxcb.mk",
        "status": "modified",
        "additions": 6,
        "deletions": 1,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/bb44d9e7546e6118cd91db5bbe471a3ce2ee7fcd/depends/packages/libxcb.mk",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/bb44d9e7546e6118cd91db5bbe471a3ce2ee7fcd/depends/packages/libxcb.mk",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/depends/packages/libxcb.mk?ref=bb44d9e7546e6118cd91db5bbe471a3ce2ee7fcd",
        "patch": "@@ -13,8 +13,13 @@ define $(package)_preprocess_cmds\n   sed \"s/pthread-stubs//\" -i configure\n endef\n \n+# Don't install xcb headers to the default path in order to work around a qt\n+# build issue: https://bugreports.qt.io/browse/QTBUG-34748\n+# When using qt's internal libxcb, it may end up finding the real headers in\n+# depends staging. Use a non-default path to avoid that.\n+\n define $(package)_config_cmds\n-  $($(package)_autoconf)\n+  $($(package)_autoconf) --includedir=$(host_prefix)/include/xcb-shared\n endef\n \n define $(package)_build_cmds"
      },
      {
        "sha": "3bdbba32a455474b845fac17d218be163a7c7690",
        "filename": "depends/patches/qt/fix-xcb-include-order.patch",
        "status": "modified",
        "additions": 29,
        "deletions": 19,
        "changes": 48,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/bb44d9e7546e6118cd91db5bbe471a3ce2ee7fcd/depends/patches/qt/fix-xcb-include-order.patch",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/bb44d9e7546e6118cd91db5bbe471a3ce2ee7fcd/depends/patches/qt/fix-xcb-include-order.patch",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/depends/patches/qt/fix-xcb-include-order.patch?ref=bb44d9e7546e6118cd91db5bbe471a3ce2ee7fcd",
        "patch": "@@ -1,21 +1,31 @@\n---- old/qtbase/src/plugins/platforms/xcb/xcb-plugin.pro\t2014-07-30 18:17:27.384458441 -0400\n-+++ new/qtbase/src/plugins/platforms/xcb/xcb-plugin.pro\t2014-07-30 18:18:28.620459303 -0400\n-@@ -101,10 +101,6 @@\n-     }\n- }\n- \n--DEFINES += $$QMAKE_DEFINES_XCB\n--LIBS += $$QMAKE_LIBS_XCB\n+--- old/qtbase/src/plugins/platforms/xcb/xcb-plugin.pro 2015-03-17 02:06:42.705930685 +0000\n++++ new/qtbase/src/plugins/platforms/xcb/xcb-plugin.pro 2015-03-17 02:08:41.281926351 +0000\n+@@ -103,7 +103,6 @@\n+\n+ DEFINES += $$QMAKE_DEFINES_XCB\n+ LIBS += $$QMAKE_LIBS_XCB\n -QMAKE_CXXFLAGS += $$QMAKE_CFLAGS_XCB\n--\n+\n  CONFIG += qpa/genericunixfontdatabase\n- \n- contains(QT_CONFIG, dbus) {\n-@@ -141,3 +137,7 @@\n-         INCLUDEPATH += ../../../3rdparty/xkbcommon/xkbcommon/\n-     }\n- }\n-+\n-+DEFINES += $$QMAKE_DEFINES_XCB\n-+LIBS += $$QMAKE_LIBS_XCB\n-+INCLUDEPATH += $$QMAKE_CFLAGS_XCB\n+\n+@@ -118,7 +117,8 @@\n+ contains(QT_CONFIG, xcb-qt) {\n+     DEFINES += XCB_USE_RENDER\n+     XCB_DIR = ../../../3rdparty/xcb\n+-    INCLUDEPATH += $$XCB_DIR/include $$XCB_DIR/sysinclude\n++    QMAKE_CFLAGS += -I$$XCB_DIR/include -I$$XCB_DIR/sysinclude $$QMAKE_CFLAGS_XCB\n++    QMAKE_CXXFLAGS += -I$$XCB_DIR/include -I$$XCB_DIR/sysinclude $$QMAKE_CFLAGS_XCB\n+     LIBS += -lxcb -L$$OUT_PWD/xcb-static -lxcb-static\n+ } else {\n+     LIBS += -lxcb -lxcb-image -lxcb-icccm -lxcb-sync -lxcb-xfixes -lxcb-shm -lxcb-randr\n+--- old/qtbase/src/plugins/platforms/xcb/xcb-static/xcb-static.pro      2015-03-17 02:07:04.641929383 +0000\n++++ new/qtbase/src/plugins/platforms/xcb/xcb-static/xcb-static.pro      2015-03-17 02:10:15.485922059 +0000\n+@@ -8,7 +8,7 @@\n+\n+ XCB_DIR = ../../../../3rdparty/xcb\n+\n+-INCLUDEPATH += $$XCB_DIR/include $$XCB_DIR/include/xcb $$XCB_DIR/sysinclude\n++QMAKE_CFLAGS += -I$$XCB_DIR/include -I$$XCB_DIR/include/xcb -I$$XCB_DIR/sysinclude $$QMAKE_CFLAGS_XCB\n+\n+ # ignore compiler warnings in 3rdparty code\n+ QMAKE_CFLAGS_STATIC_LIB+=-w"
      }
    ]
  }
]