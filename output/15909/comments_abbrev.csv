promag,2019-04-27 17:12:42,@MarcoFalke can we have a gitian build?,https://github.com/bitcoin/bitcoin/pull/15909#issuecomment-487303685,487303685,
promag,2019-04-27 17:13:12,Have you considered using boost process?,https://github.com/bitcoin/bitcoin/pull/15909#issuecomment-487303723,487303723,
Sjors,2019-04-27 18:41:19,"If you decide to use boost process, consider building on top of #15382 (minus the last commit). That said, this change is much smaller (though I have no idea if it's correct).",https://github.com/bitcoin/bitcoin/pull/15909#issuecomment-487309937,487309937,
MarcoFalke,2019-04-27 21:10:23,"```\nc:\projects\bitcoin\src\util\system.cpp(1140): error C2664: 'BOOL CreateProcessW(LPCWSTR,LPWSTR,LPSECURITY_ATTRIBUTES,LPSECURITY_ATTRIBUTES,BOOL,DWORD,LPVOID,LPCWSTR,LPSTARTUPINFOW,LPPROCESS_INFORMATION)': cannot convert argument 2 from 'char *' to 'LPWSTR",https://github.com/bitcoin/bitcoin/pull/15909#issuecomment-487320033,487320033,
darosior,2019-04-28 10:23:09,"> ```\n> c:\projects\bitcoin\src\util\system.cpp(1140): error C2664: 'BOOL CreateProcessW(LPCWSTR,LPWSTR,LPSECURITY_ATTRIBUTES,LPSECURITY_ATTRIBUTES,BOOL,DWORD,LPVOID,LPCWSTR,LPSTARTUPINFOW,LPPROCESS_INFORMATION)': cannot convert argument 2 from 'char *' to 'LPWSTR\n> ```\n\nFixed it by explicitly using `CreateProcessA` (I used `CreateProcess` that was interpreted as `CreateProcessA` during my",https://github.com/bitcoin/bitcoin/pull/15909#issuecomment-487365895,487365895,
Sjors,2019-04-28 11:54:19,"The idea is to move from Boost to modern C++, where it's often the case that new C++ standards adopt things from Boost. So the hope is the boost::process can eventually easily be replaced with something in C++42 :-)",https://github.com/bitcoin/bitcoin/pull/15909#issuecomment-487372119,487372119,
laanwj,2019-04-30 18:24:44,"This change was rejected before in #5834—not sure the same reasoning, or problems exist with this PR, but have a look.",https://github.com/bitcoin/bitcoin/pull/15909#issuecomment-488061514,488061514,
luke-jr,2019-05-01 06:36:08,"re boost::process, note that early versions had bugs which IIRC would likely break this use case.",https://github.com/bitcoin/bitcoin/pull/15909#issuecomment-488220328,488220328,
darosior,2019-05-02 12:32:51,"@luke-jr thank you for the review. I finally opted for the `ShellExecute` function to handle batch files, as proposed by Sipa in #5834 (thank you @laanwj for pointing me to this PR), and to reduce diff. I also changed the Log message and did not set `nErr` to the process exit code because [ShellExecute can return 0 on error](https://docs.microsoft.com/en-us/windows/desktop/api/shellapi/nf-shellapi",https://github.com/bitcoin/bitcoin/pull/15909#issuecomment-488654483,488654483,
NicolasDorier,2019-05-02 13:09:01,You might need to call `CreateProcessW` or `CreateProcess` instead ping @ken2812221 . I am unsure.,https://github.com/bitcoin/bitcoin/pull/15909#issuecomment-488665992,488665992,
DrahtBot,2019-05-02 15:41:15,<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.,https://github.com/bitcoin/bitcoin/pull/15909#issuecomment-488723575,488723575,
DrahtBot,2019-05-04 04:41:45,<!--a722867cd34abeea1fadc8d60700f111-->\nGitian builds for commit 24dfcf3a56f90b101bc208f48ccdb7813fa08b83 (master):\n * `3d60ebc8cbfd7f4933063f9d69639e64...` [bitcoin-0.18.99-osx-unsigned.dmg](https://drahtbot.space/gitian/bitcoin/bitcoin/24dfcf3a56f90b101bc208f48ccdb7813fa08b83/bitcoin-0.18.99-osx-unsigned.dmg)\n * `a4e22cda5ea46ee15e54b7b69b8b27ce...` [bitcoin-0.18.99-osx64.tar.gz](https://drah,https://github.com/bitcoin/bitcoin/pull/15909#issuecomment-489293390,489293390,
fanquake,2019-07-30 05:52:21,@ken2812221 Is not currently available. So maybe we can defer to @sipsorcery for a Concept ACK / NACK.,https://github.com/bitcoin/bitcoin/pull/15909#issuecomment-516273392,516273392,
sipsorcery,2019-07-30 06:07:11,"@darosior if the command can ever contain unicode characters then `SHELLEXECUTEINFOW` should be used instead of `SHELLEXECUTEINFOA`. \n\n@ken2812221's work added some big improvements to the bitcoin core software unicode handling on Windows. The `datadir` and other paths should be treated as potentially containing unicode characters.",https://github.com/bitcoin/bitcoin/pull/15909#issuecomment-516276963,516276963,
darosior,2019-08-03 13:59:45,Thank you for the help with the Windows version which I struggled to test. I'll revisit this PR soon.,https://github.com/bitcoin/bitcoin/pull/15909#issuecomment-517926692,517926692,
darosior,2019-09-24 12:04:08,"@luke-jr thank you for the time you spent reviewing this again. However I can't test this PR since I can't access a Windows machine and the appveyor testing is really not viable.\n\nI'm sorry for people experiencing #15883 but I shouldn't have done a Windows PR in the first place (maybe someone can grab and correct this if it's not too wrong) ... Closing.",https://github.com/bitcoin/bitcoin/pull/15909#issuecomment-534526890,534526890,
luke-jr,2019-05-01 06:26:56,"This message is explicit about the call being `system`, so should probably be made ambiguous",https://github.com/bitcoin/bitcoin/pull/15909#discussion_r280012283,280012283,src/util/system.cpp
luke-jr,2019-05-01 06:28:09,Why not just initialise info with `{.cb = sizeof(info)}` above?,https://github.com/bitcoin/bitcoin/pull/15909#discussion_r280012381,280012381,src/util/system.cpp
luke-jr,2019-05-01 06:30:53,Is there a need to zero this?,https://github.com/bitcoin/bitcoin/pull/15909#discussion_r280012602,280012602,src/util/system.cpp
luke-jr,2019-05-01 06:32:21,"`CreateProcessA` seems to execute the program directly, rather than passing through the shell as expected for `-*notify`. This may break existing usage, especially because `.bat` files will fail.",https://github.com/bitcoin/bitcoin/pull/15909#discussion_r280012781,280012781,src/util/system.cpp
luke-jr,2019-05-01 06:34:26,Where is `nErr` set to the process's return value?,https://github.com/bitcoin/bitcoin/pull/15909#discussion_r280012955,280012955,src/util/system.cpp
darosior,2019-05-01 18:14:31,"I had never used the windows API before this, so I sticked to the documentation example : https://docs.microsoft.com/en-us/windows/desktop/ProcThread/creating-processes",https://github.com/bitcoin/bitcoin/pull/15909#discussion_r280161297,280161297,src/util/system.cpp
darosior,2019-05-01 19:12:50,"Indeed, a workaround is to put `cmd.exe` at the command beginning as in #5834, but I don't know if this is a good way to do it..",https://github.com/bitcoin/bitcoin/pull/15909#discussion_r280181354,280181354,src/util/system.cpp
darosior,2019-05-01 19:13:37,nErr is set only if the command did not succeed.,https://github.com/bitcoin/bitcoin/pull/15909#discussion_r280181582,280181582,src/util/system.cpp
luke-jr,2019-05-02 00:37:01,`nErr` should always be set to the exit code of the process.,https://github.com/bitcoin/bitcoin/pull/15909#discussion_r280263247,280263247,src/util/system.cpp
darosior,2019-05-02 10:46:00,"I could have set `nErr` to `GetLastError()` outside of the `else` block but I've read from [the doc](https://msdn.microsoft.com/fr-fr/library/windows/desktop/ms679360(v=vs.85).aspx) that a windows process would not always return `0` on success : ""some functions set the last-error code to 0 on success and others do not."" This means that `if (nErr)` could pass and log as an error on windows even if ",https://github.com/bitcoin/bitcoin/pull/15909#discussion_r280367116,280367116,src/util/system.cpp
luke-jr,2019-05-02 12:47:45,Does this actually work at all? From the docs I would expect it doesn't.,https://github.com/bitcoin/bitcoin/pull/15909#discussion_r280402452,280402452,src/util/system.cpp
darosior,2019-05-02 12:53:13,"Yes it does, I tested it before comitting.",https://github.com/bitcoin/bitcoin/pull/15909#discussion_r280404213,280404213,src/util/system.cpp
darosior,2019-05-02 12:56:46,"Actually you are right about the condition, I messed up the return values of [ShellExecuteEx](https://docs.microsoft.com/en-us/windows/desktop/api/Shellapi/nf-shellapi-shellexecuteexa) (boolean) and [ShellExecute](https://docs.microsoft.com/en-us/windows/desktop/api/shellapi/nf-shellapi-shellexecutea#return-value) (HINSTANCE). I am going to fix it right now.",https://github.com/bitcoin/bitcoin/pull/15909#discussion_r280405523,280405523,src/util/system.cpp
luke-jr,2019-09-24 01:26:16,"```c++\n    SHELLEXECUTEINFOA ShExecInfo = {\n        .cbSize = sizeof(SHELLEXECUTEINFOA),\n        .lpFile = strCommand.c_str(),\n        .nShow = SW_HIDE,\n    };\n```",https://github.com/bitcoin/bitcoin/pull/15909#discussion_r327393302,327393302,src/util/system.cpp
luke-jr,2019-09-24 01:26:40,"It shouldn't be hidden if there is already a console available (eg, if bitcoind is being used in a command shell)",https://github.com/bitcoin/bitcoin/pull/15909#discussion_r327393359,327393359,src/util/system.cpp
luke-jr,2019-09-24 01:26:55,Needs braces,https://github.com/bitcoin/bitcoin/pull/15909#discussion_r327393391,327393391,src/util/system.cpp
