[
  {
    "sha": "fd6bb700b77491689f0b5f34bdfb75764138f406",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmZDZiYjcwMGI3NzQ5MTY4OWYwYjVmMzRiZGZiNzU3NjQxMzhmNDA2",
    "commit": {
      "author": {
        "name": "Russell Yanofsky",
        "email": "russ@yanofsky.org",
        "date": "2016-11-11T20:38:59Z"
      },
      "committer": {
        "name": "Russell Yanofsky",
        "email": "russ@yanofsky.org",
        "date": "2016-11-14T17:01:51Z"
      },
      "message": "[qa] Improve sync_blocks error messages.",
      "tree": {
        "sha": "dbc74c07347a35c29e4b677eab8a19299ecd2899",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/dbc74c07347a35c29e4b677eab8a19299ecd2899"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fd6bb700b77491689f0b5f34bdfb75764138f406",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fd6bb700b77491689f0b5f34bdfb75764138f406",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fd6bb700b77491689f0b5f34bdfb75764138f406",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fd6bb700b77491689f0b5f34bdfb75764138f406/comments",
    "author": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "87ab49e4fe38f0d8d527090ea348081037a68cef",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/87ab49e4fe38f0d8d527090ea348081037a68cef",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/87ab49e4fe38f0d8d527090ea348081037a68cef"
      }
    ],
    "stats": {
      "total": 6,
      "additions": 4,
      "deletions": 2
    },
    "files": [
      {
        "sha": "2de4d5e303c918862ef9515f725e6c2db6cd182b",
        "filename": "qa/rpc-tests/test_framework/util.py",
        "status": "modified",
        "additions": 4,
        "deletions": 2,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fd6bb700b77491689f0b5f34bdfb75764138f406/qa/rpc-tests/test_framework/util.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fd6bb700b77491689f0b5f34bdfb75764138f406/qa/rpc-tests/test_framework/util.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/qa/rpc-tests/test_framework/util.py?ref=fd6bb700b77491689f0b5f34bdfb75764138f406",
        "patch": "@@ -132,10 +132,12 @@ def sync_blocks(rpc_connections, *, wait=1, timeout=60):\n         if tips == [tips[0]] * len(tips):\n             return\n         if heights == [heights[0]] * len(heights):\n-            raise AssertionError(\"Block sync failed: (Hashes don't match)\")\n+            raise AssertionError(\"Block sync failed, mismatched block hashes:{}\".format(\n+                                 \"\".join(\"\\n  {!r}\".format(tip) for tip in tips)))\n         timeout -= wait\n         maxheight = max(heights)\n-    raise AssertionError(\"Block sync failed with heights: {}\".format(heights))\n+    raise AssertionError(\"Block sync to height {} timed out:{}\".format(\n+                         maxheight, \"\".join(\"\\n  {!r}\".format(tip) for tip in tips)))\n \n def sync_chain(rpc_connections, *, wait=1, timeout=60):\n     \"\"\""
      }
    ]
  },
  {
    "sha": "05e57ccd746b2e14699d2b1980927f30070cb3ad",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzowNWU1N2NjZDc0NmIyZTE0Njk5ZDJiMTk4MDkyN2YzMDA3MGNiM2Fk",
    "commit": {
      "author": {
        "name": "Russell Yanofsky",
        "email": "russ@yanofsky.org",
        "date": "2016-11-11T20:40:48Z"
      },
      "committer": {
        "name": "Russell Yanofsky",
        "email": "russ@yanofsky.org",
        "date": "2016-11-14T17:02:31Z"
      },
      "message": "[qa] Fix sync_blocks timeout argument\n\nMotivation for this change is mainly to make sync_blocks behavior easier to\nunderstand. Behavior is unchanged in the normal case when there are only 2\nnodes in the rpc_connections set. When there are more than 2 nodes, the\nprevious \"timeout -= wait\" statement wouldn't take into account time spent\nwaiting for all nodes and as a result could lead to blocking for longer than\nthe requested timeout.",
      "tree": {
        "sha": "1cbafd8a97db85acf13ba2d809fc346569f7690d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1cbafd8a97db85acf13ba2d809fc346569f7690d"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/05e57ccd746b2e14699d2b1980927f30070cb3ad",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/05e57ccd746b2e14699d2b1980927f30070cb3ad",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/05e57ccd746b2e14699d2b1980927f30070cb3ad",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/05e57ccd746b2e14699d2b1980927f30070cb3ad/comments",
    "author": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "fd6bb700b77491689f0b5f34bdfb75764138f406",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fd6bb700b77491689f0b5f34bdfb75764138f406",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/fd6bb700b77491689f0b5f34bdfb75764138f406"
      }
    ],
    "stats": {
      "total": 11,
      "additions": 8,
      "deletions": 3
    },
    "files": [
      {
        "sha": "01bde0c84db19c8b5e125f11ee5b1c9121dd11c7",
        "filename": "qa/rpc-tests/test_framework/util.py",
        "status": "modified",
        "additions": 8,
        "deletions": 3,
        "changes": 11,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/05e57ccd746b2e14699d2b1980927f30070cb3ad/qa/rpc-tests/test_framework/util.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/05e57ccd746b2e14699d2b1980927f30070cb3ad/qa/rpc-tests/test_framework/util.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/qa/rpc-tests/test_framework/util.py?ref=05e57ccd746b2e14699d2b1980927f30070cb3ad",
        "patch": "@@ -123,19 +123,24 @@ def str_to_b64str(string):\n \n def sync_blocks(rpc_connections, *, wait=1, timeout=60):\n     \"\"\"\n-    Wait until everybody has the same tip\n+    Wait until everybody has the same tip.\n+\n+    sync_blocks needs to be called with an rpc_connections set that has least\n+    one node already synced to the latest, stable tip, otherwise there's a\n+    chance it might return before all nodes are stably synced.\n     \"\"\"\n     maxheight = 0\n-    while timeout > 0:\n+    start_time = cur_time = time.time()\n+    while cur_time <= start_time + timeout:\n         tips = [r.waitforblockheight(maxheight, int(wait * 1000)) for r in rpc_connections]\n         heights = [t[\"height\"] for t in tips]\n         if tips == [tips[0]] * len(tips):\n             return\n         if heights == [heights[0]] * len(heights):\n             raise AssertionError(\"Block sync failed, mismatched block hashes:{}\".format(\n                                  \"\".join(\"\\n  {!r}\".format(tip) for tip in tips)))\n-        timeout -= wait\n         maxheight = max(heights)\n+        cur_time = time.time()\n     raise AssertionError(\"Block sync to height {} timed out:{}\".format(\n                          maxheight, \"\".join(\"\\n  {!r}\".format(tip) for tip in tips)))\n "
      }
    ]
  },
  {
    "sha": "7943b13ab3e005e1dd5c277efdbc06088d89f6de",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo3OTQzYjEzYWIzZTAwNWUxZGQ1YzI3N2VmZGJjMDYwODhkODlmNmRl",
    "commit": {
      "author": {
        "name": "Russell Yanofsky",
        "email": "russ@yanofsky.org",
        "date": "2016-11-11T20:43:15Z"
      },
      "committer": {
        "name": "Russell Yanofsky",
        "email": "russ@yanofsky.org",
        "date": "2016-11-14T17:02:33Z"
      },
      "message": "[qa] Avoid 2 list comprehensions in sync_blocks",
      "tree": {
        "sha": "5aac185db80d822562c06cfebf24e22350c92214",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/5aac185db80d822562c06cfebf24e22350c92214"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7943b13ab3e005e1dd5c277efdbc06088d89f6de",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7943b13ab3e005e1dd5c277efdbc06088d89f6de",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/7943b13ab3e005e1dd5c277efdbc06088d89f6de",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7943b13ab3e005e1dd5c277efdbc06088d89f6de/comments",
    "author": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "05e57ccd746b2e14699d2b1980927f30070cb3ad",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/05e57ccd746b2e14699d2b1980927f30070cb3ad",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/05e57ccd746b2e14699d2b1980927f30070cb3ad"
      }
    ],
    "stats": {
      "total": 4,
      "additions": 2,
      "deletions": 2
    },
    "files": [
      {
        "sha": "bf13b7fd8480b1e05f6ddaa82b55f3488bef7d0b",
        "filename": "qa/rpc-tests/test_framework/util.py",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7943b13ab3e005e1dd5c277efdbc06088d89f6de/qa/rpc-tests/test_framework/util.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7943b13ab3e005e1dd5c277efdbc06088d89f6de/qa/rpc-tests/test_framework/util.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/qa/rpc-tests/test_framework/util.py?ref=7943b13ab3e005e1dd5c277efdbc06088d89f6de",
        "patch": "@@ -134,9 +134,9 @@ def sync_blocks(rpc_connections, *, wait=1, timeout=60):\n     while cur_time <= start_time + timeout:\n         tips = [r.waitforblockheight(maxheight, int(wait * 1000)) for r in rpc_connections]\n         heights = [t[\"height\"] for t in tips]\n-        if tips == [tips[0]] * len(tips):\n+        if all(t == tips[0] for t in tips):\n             return\n-        if heights == [heights[0]] * len(heights):\n+        if all(h == heights[0] for h in heights):\n             raise AssertionError(\"Block sync failed, mismatched block hashes:{}\".format(\n                                  \"\".join(\"\\n  {!r}\".format(tip) for tip in tips)))\n         maxheight = max(heights)"
      }
    ]
  }
]