[
  {
    "sha": "3107280e14f7ca63c693937aac490794ae746a09",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozMTA3MjgwZTE0ZjdjYTYzYzY5MzkzN2FhYzQ5MDc5NGFlNzQ2YTA5",
    "commit": {
      "author": {
        "name": "mrbandrews",
        "email": "bandrewsny@gmail.com",
        "date": "2016-11-15T20:37:46Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2016-11-19T22:20:14Z"
      },
      "message": "[qa] add assert_raises_message to check specific error message\n\nGithub-Pull: #9168\nRebased-From: 307acdd3df03082295ac0f7fe9eba7dd35973bc4",
      "tree": {
        "sha": "99cec293ac513c74bb7cebb2e99d4b4b9e301bd5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/99cec293ac513c74bb7cebb2e99d4b4b9e301bd5"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3107280e14f7ca63c693937aac490794ae746a09",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3107280e14f7ca63c693937aac490794ae746a09",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/3107280e14f7ca63c693937aac490794ae746a09",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3107280e14f7ca63c693937aac490794ae746a09/comments",
    "author": {
      "login": "mrbandrews",
      "id": 7504522,
      "node_id": "MDQ6VXNlcjc1MDQ1MjI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7504522?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mrbandrews",
      "html_url": "https://github.com/mrbandrews",
      "followers_url": "https://api.github.com/users/mrbandrews/followers",
      "following_url": "https://api.github.com/users/mrbandrews/following{/other_user}",
      "gists_url": "https://api.github.com/users/mrbandrews/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mrbandrews/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mrbandrews/subscriptions",
      "organizations_url": "https://api.github.com/users/mrbandrews/orgs",
      "repos_url": "https://api.github.com/users/mrbandrews/repos",
      "events_url": "https://api.github.com/users/mrbandrews/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mrbandrews/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "9460771a60e28b42cd21ac38710dd9ee7f57cc71",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9460771a60e28b42cd21ac38710dd9ee7f57cc71",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/9460771a60e28b42cd21ac38710dd9ee7f57cc71"
      }
    ],
    "stats": {
      "total": 10,
      "additions": 7,
      "deletions": 3
    },
    "files": [
      {
        "sha": "c5f270591e16636978f0e183878c0be3ec180feb",
        "filename": "qa/rpc-tests/test_framework/util.py",
        "status": "modified",
        "additions": 6,
        "deletions": 2,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3107280e14f7ca63c693937aac490794ae746a09/qa/rpc-tests/test_framework/util.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3107280e14f7ca63c693937aac490794ae746a09/qa/rpc-tests/test_framework/util.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/qa/rpc-tests/test_framework/util.py?ref=3107280e14f7ca63c693937aac490794ae746a09",
        "patch": "@@ -508,10 +508,14 @@ def assert_greater_than(thing1, thing2):\n         raise AssertionError(\"%s <= %s\"%(str(thing1),str(thing2)))\n \n def assert_raises(exc, fun, *args, **kwds):\n+    assert_raises_message(exc, None, fun, *args, **kwds)\n+\n+def assert_raises_message(exc, message, fun, *args, **kwds):\n     try:\n         fun(*args, **kwds)\n-    except exc:\n-        pass\n+    except exc as e:\n+        if message is not None and message not in e.error['message']:\n+            raise AssertionError(\"Expected substring not found:\"+e.error['message'])\n     except Exception as e:\n         raise AssertionError(\"Unexpected exception raised: \"+type(e).__name__)\n     else:"
      },
      {
        "sha": "3c0dc0f4ea1bb1c9b6c4688f0bbfd712f4e740f1",
        "filename": "qa/rpc-tests/wallet.py",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3107280e14f7ca63c693937aac490794ae746a09/qa/rpc-tests/wallet.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3107280e14f7ca63c693937aac490794ae746a09/qa/rpc-tests/wallet.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/qa/rpc-tests/wallet.py?ref=3107280e14f7ca63c693937aac490794ae746a09",
        "patch": "@@ -71,7 +71,7 @@ def run_test (self):\n         unspent_0 = self.nodes[2].listunspent()[0]\n         unspent_0 = {\"txid\": unspent_0[\"txid\"], \"vout\": unspent_0[\"vout\"]}\n         self.nodes[2].lockunspent(False, [unspent_0])\n-        assert_raises(JSONRPCException, self.nodes[2].sendtoaddress, self.nodes[2].getnewaddress(), 20)\n+        assert_raises_message(JSONRPCException, \"Insufficient funds\", self.nodes[2].sendtoaddress, self.nodes[2].getnewaddress(), 20)\n         assert_equal([unspent_0], self.nodes[2].listlockunspent())\n         self.nodes[2].lockunspent(True, [unspent_0])\n         assert_equal(len(self.nodes[2].listlockunspent()), 0)"
      }
    ]
  },
  {
    "sha": "1d4c884cd325150c68b8b129e4dc18a933866509",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxZDRjODg0Y2QzMjUxNTBjNjhiOGIxMjllNGRjMThhOTMzODY2NTA5",
    "commit": {
      "author": {
        "name": "Russell Yanofsky",
        "email": "russ@yanofsky.org",
        "date": "2016-11-02T13:46:55Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2016-11-19T22:21:07Z"
      },
      "message": "[qa] Increase wallet-dump RPC timeout\n\nIncrease wallet-dump RPC timeout from 30 seconds to 1 minute. This avoids a\ntimeout error that seemed to happen regularly (around 50% of builds) on a\nparticular jenkins server during the first getnewaddress RPC call made by the\ntest.\n\nThe failing stack trace looked like:\n\n    Unexpected exception caught during testing: timeout('timed out',)\n\n    File \".../bitcoin/qa/rpc-tests/test_framework/test_framework.py\", line 146, in main\n      self.run_test()\n    File \".../bitcoin/qa/rpc-tests/wallet-dump.py\", line 73, in run_test\n      addr = self.nodes[0].getnewaddress()\n    File \".../bitcoin/qa/rpc-tests/test_framework/coverage.py\", line 49, in __call__\n      return_val = self.auth_service_proxy_instance.__call__(*args, **kwargs)\n    File \".../bitcoin/qa/rpc-tests/test_framework/authproxy.py\", line 145, in __call__\n      response = self._request('POST', self.__url.path, postdata.encode('utf-8'))\n    File \".../bitcoin/qa/rpc-tests/test_framework/authproxy.py\", line 121, in _request\n      return self._get_response()\n    File \".../bitcoin/qa/rpc-tests/test_framework/authproxy.py\", line 160, in _get_response\n      http_response = self.__conn.getresponse()\n    File \"/usr/lib/python3.4/http/client.py\", line 1171, in getresponse\n      response.begin()\n    File \"/usr/lib/python3.4/http/client.py\", line 351, in begin\n      version, status, reason = self._read_status()\n    File \"/usr/lib/python3.4/http/client.py\", line 313, in _read_status\n      line = str(self.fp.readline(_MAXLINE + 1), \"iso-8859-1\")\n    File \"/usr/lib/python3.4/socket.py\", line 374, in readinto\n      return self._sock.recv_into(b)\n\nGithub-Pull: #9077\nRebased-From: 8463aaa63c5ac76421c4d2754ea9e17a31584c93",
      "tree": {
        "sha": "b47210c75b736c10771ae98b1daaab870ca4ad89",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b47210c75b736c10771ae98b1daaab870ca4ad89"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1d4c884cd325150c68b8b129e4dc18a933866509",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1d4c884cd325150c68b8b129e4dc18a933866509",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/1d4c884cd325150c68b8b129e4dc18a933866509",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1d4c884cd325150c68b8b129e4dc18a933866509/comments",
    "author": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "3107280e14f7ca63c693937aac490794ae746a09",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3107280e14f7ca63c693937aac490794ae746a09",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/3107280e14f7ca63c693937aac490794ae746a09"
      }
    ],
    "stats": {
      "total": 10,
      "additions": 7,
      "deletions": 3
    },
    "files": [
      {
        "sha": "bf3f2b2db1600109ef1f795d32f51c713b249b8d",
        "filename": "qa/rpc-tests/test_framework/util.py",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1d4c884cd325150c68b8b129e4dc18a933866509/qa/rpc-tests/test_framework/util.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1d4c884cd325150c68b8b129e4dc18a933866509/qa/rpc-tests/test_framework/util.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/qa/rpc-tests/test_framework/util.py?ref=1d4c884cd325150c68b8b129e4dc18a933866509",
        "patch": "@@ -327,7 +327,7 @@ def start_node(i, dirname, extra_args=None, rpchost=None, timewait=None, binary=\n \n     return proxy\n \n-def start_nodes(num_nodes, dirname, extra_args=None, rpchost=None, binary=None):\n+def start_nodes(num_nodes, dirname, extra_args=None, rpchost=None, timewait=None, binary=None):\n     \"\"\"\n     Start multiple bitcoinds, return RPC connections to them\n     \"\"\"\n@@ -336,7 +336,7 @@ def start_nodes(num_nodes, dirname, extra_args=None, rpchost=None, binary=None):\n     rpcs = []\n     try:\n         for i in range(num_nodes):\n-            rpcs.append(start_node(i, dirname, extra_args[i], rpchost, binary=binary[i]))\n+            rpcs.append(start_node(i, dirname, extra_args[i], rpchost, timewait=timewait, binary=binary[i]))\n     except: # If one node failed to start, stop the others\n         stop_nodes(rpcs)\n         raise"
      },
      {
        "sha": "c6dc2e3d107492075d9b1e6851bc022b369555de",
        "filename": "qa/rpc-tests/wallet-dump.py",
        "status": "modified",
        "additions": 5,
        "deletions": 1,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1d4c884cd325150c68b8b129e4dc18a933866509/qa/rpc-tests/wallet-dump.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1d4c884cd325150c68b8b129e4dc18a933866509/qa/rpc-tests/wallet-dump.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/qa/rpc-tests/wallet-dump.py?ref=1d4c884cd325150c68b8b129e4dc18a933866509",
        "patch": "@@ -61,7 +61,11 @@ def __init__(self):\n         self.extra_args = [[\"-keypool=90\"]]\n \n     def setup_network(self, split=False):\n-        self.nodes = start_nodes(self.num_nodes, self.options.tmpdir, self.extra_args)\n+        # Use 1 minute timeout because the initial getnewaddress RPC can take\n+        # longer than the default 30 seconds due to an expensive\n+        # CWallet::TopUpKeyPool call, and the encryptwallet RPC made later in\n+        # the test often takes even longer.\n+        self.nodes = start_nodes(self.num_nodes, self.options.tmpdir, self.extra_args, timewait=60)\n \n     def run_test (self):\n         tmpdir = self.options.tmpdir"
      }
    ]
  },
  {
    "sha": "da4926b1d28c600076d3eb35df60981298194697",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpkYTQ5MjZiMWQyOGM2MDAwNzZkM2ViMzVkZjYwOTgxMjk4MTk0Njk3",
    "commit": {
      "author": {
        "name": "Russell Yanofsky",
        "email": "russ@yanofsky.org",
        "date": "2016-11-02T19:08:54Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2016-11-19T22:21:19Z"
      },
      "message": "[qa] Add more helpful RPC timeout message\n\nReplace previous timeout('timed out',) exception with more detailed error.\n\nGithub-Pull: #9077\nRebased-From: e89614b6abf28d7fe201c3db44a0df6e4db6de03",
      "tree": {
        "sha": "06ecdb31520f0b6d4961654f3360d48ac14a25a7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/06ecdb31520f0b6d4961654f3360d48ac14a25a7"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/da4926b1d28c600076d3eb35df60981298194697",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/da4926b1d28c600076d3eb35df60981298194697",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/da4926b1d28c600076d3eb35df60981298194697",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/da4926b1d28c600076d3eb35df60981298194697/comments",
    "author": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "1d4c884cd325150c68b8b129e4dc18a933866509",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1d4c884cd325150c68b8b129e4dc18a933866509",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/1d4c884cd325150c68b8b129e4dc18a933866509"
      }
    ],
    "stats": {
      "total": 11,
      "additions": 10,
      "deletions": 1
    },
    "files": [
      {
        "sha": "7b051545c8597dfa71573c517482977de3552368",
        "filename": "qa/rpc-tests/test_framework/authproxy.py",
        "status": "modified",
        "additions": 10,
        "deletions": 1,
        "changes": 11,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/da4926b1d28c600076d3eb35df60981298194697/qa/rpc-tests/test_framework/authproxy.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/da4926b1d28c600076d3eb35df60981298194697/qa/rpc-tests/test_framework/authproxy.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/qa/rpc-tests/test_framework/authproxy.py?ref=da4926b1d28c600076d3eb35df60981298194697",
        "patch": "@@ -42,6 +42,7 @@\n import decimal\n import json\n import logging\n+import socket\n try:\n     import urllib.parse as urlparse\n except ImportError:\n@@ -157,7 +158,15 @@ def _batch(self, rpc_call_list):\n         return self._request('POST', self.__url.path, postdata.encode('utf-8'))\n \n     def _get_response(self):\n-        http_response = self.__conn.getresponse()\n+        try:\n+            http_response = self.__conn.getresponse()\n+        except socket.timeout as e:\n+            raise JSONRPCException({\n+                'code': -344,\n+                'message': '%r RPC took longer than %f seconds. Consider '\n+                           'using larger timeout for calls that take '\n+                           'longer to return.' % (self._service_name,\n+                                                  self.__conn.timeout)})\n         if http_response is None:\n             raise JSONRPCException({\n                 'code': -342, 'message': 'missing HTTP response from server'})"
      }
    ]
  },
  {
    "sha": "dccdc3aa34218eecd4a37988857b5d4f3dd884ef",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpkY2NkYzNhYTM0MjE4ZWVjZDRhMzc5ODg4NTdiNWQ0ZjNkZDg4NGVm",
    "commit": {
      "author": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@gmail.com",
        "date": "2016-11-18T12:08:30Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2016-11-19T22:24:35Z"
      },
      "message": "test: Fix use-after-free in scheduler tests\n\nMake a copy of the boost time-point to wait for, otherwise the head of\nthe queue may be deleted by another thread while this one is waiting,\nwhile the boost function still has a reference to it.\n\nAlthough this problem is in non-test code, this is not an actual problem\noutside of the tests because we use the thread scheduler with only one\nservice thread, so there will never be threads fighting at the head of\nthe queue.\n\nThe old boost fallback escapes this problem because it passes a scalar\nvalue to wait_until instead of a const object reference.\n\nFound by running the tests in LLVM-4.0-master asan.\n\nGithub-Pull: #9186\nRebased-From: 12519bf62b8c49b1c1744eca6ea5b3162a61f962",
      "tree": {
        "sha": "3593c750b314b54b53d9e47e158a4e1a7eb4e4b6",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3593c750b314b54b53d9e47e158a4e1a7eb4e4b6"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/dccdc3aa34218eecd4a37988857b5d4f3dd884ef",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/dccdc3aa34218eecd4a37988857b5d4f3dd884ef",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/dccdc3aa34218eecd4a37988857b5d4f3dd884ef",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/dccdc3aa34218eecd4a37988857b5d4f3dd884ef/comments",
    "author": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "da4926b1d28c600076d3eb35df60981298194697",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/da4926b1d28c600076d3eb35df60981298194697",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/da4926b1d28c600076d3eb35df60981298194697"
      }
    ],
    "stats": {
      "total": 7,
      "additions": 4,
      "deletions": 3
    },
    "files": [
      {
        "sha": "27c03f154cb986aeed3dd6164a8c029f33a5363c",
        "filename": "src/scheduler.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 3,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/dccdc3aa34218eecd4a37988857b5d4f3dd884ef/src/scheduler.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/dccdc3aa34218eecd4a37988857b5d4f3dd884ef/src/scheduler.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/scheduler.cpp?ref=dccdc3aa34218eecd4a37988857b5d4f3dd884ef",
        "patch": "@@ -54,9 +54,10 @@ void CScheduler::serviceQueue()\n #else\n             // Some boost versions have a conflicting overload of wait_until that returns void.\n             // Explicitly use a template here to avoid hitting that overload.\n-            while (!shouldStop() && !taskQueue.empty() &&\n-                   newTaskScheduled.wait_until<>(lock, taskQueue.begin()->first) != boost::cv_status::timeout) {\n-                // Keep waiting until timeout\n+            while (!shouldStop() && !taskQueue.empty()) {\n+                boost::chrono::system_clock::time_point timeToWaitFor = taskQueue.begin()->first;\n+                if (newTaskScheduled.wait_until<>(lock, timeToWaitFor) == boost::cv_status::timeout)\n+                    break; // Exit loop after timeout, it means we reached the time of the event\n             }\n #endif\n             // If there are multiple threads, the queue can empty while we're waiting (another"
      }
    ]
  },
  {
    "sha": "eca9b4653788570c25e646dcdfa9ba088e89f20e",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzplY2E5YjQ2NTM3ODg1NzBjMjVlNjQ2ZGNkZmE5YmEwODhlODlmMjBl",
    "commit": {
      "author": {
        "name": "Russell Yanofsky",
        "email": "russ@yanofsky.org",
        "date": "2016-11-14T14:58:30Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2016-11-19T22:34:58Z"
      },
      "message": "[qa] Wait for specific block announcement in p2p-compactblocks\n\nChange check_announcement_of_new_block() to wait specifically for the\nannouncement of the newly created block, instead of waiting for any\nannouncement at all. A difficult to reproduce failure in\ncheck_announcement_of_new_block() that happened in a travis build\n(https://travis-ci.org/bitcoin/bitcoin/jobs/175198367) might have happened\nbecause an older announcement was mistaken for the expected one. The error\nlooked like:\n\n  Assertion failed: Failed\n\n  File \".../bitcoin/qa/rpc-tests/test_framework/test_framework.py\", line 145, in main\n    self.run_test()\n  File \".../bitcoin/build/../qa/rpc-tests/p2p-compactblocks.py\", line 787, in run_test\n    self.test_sendcmpct(self.nodes[1], self.segwit_node, 2, old_node=self.old_node)\n  File \".../bitcoin/build/../qa/rpc-tests/p2p-compactblocks.py\", line 201, in test_sendcmpct\n    check_announcement_of_new_block(node, test_node, lambda p: p.last_cmpctblock is None and p.last_inv is not None)\n  File \".../bitcoin/build/../qa/rpc-tests/p2p-compactblocks.py\", line 194, in check_announcement_of_new_block\n    assert(predicate(peer))\n\nThis commit also changes the assertion failed message above to include more\ndetailed information for debug.\n\nGithub-Pull: #9159\nRebased-From: dfa44d1b07a6d1022005dba63dd6372739eee8a0",
      "tree": {
        "sha": "e892a9524f7f6bb3850116b51cac29f0c6f6cced",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e892a9524f7f6bb3850116b51cac29f0c6f6cced"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/eca9b4653788570c25e646dcdfa9ba088e89f20e",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/eca9b4653788570c25e646dcdfa9ba088e89f20e",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/eca9b4653788570c25e646dcdfa9ba088e89f20e",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/eca9b4653788570c25e646dcdfa9ba088e89f20e/comments",
    "author": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "dccdc3aa34218eecd4a37988857b5d4f3dd884ef",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/dccdc3aa34218eecd4a37988857b5d4f3dd884ef",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/dccdc3aa34218eecd4a37988857b5d4f3dd884ef"
      }
    ],
    "stats": {
      "total": 9,
      "additions": 6,
      "deletions": 3
    },
    "files": [
      {
        "sha": "c20cbede5dde673a1f6e5cc62e9847ee2a23cc20",
        "filename": "qa/rpc-tests/p2p-compactblocks.py",
        "status": "modified",
        "additions": 6,
        "deletions": 3,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/eca9b4653788570c25e646dcdfa9ba088e89f20e/qa/rpc-tests/p2p-compactblocks.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/eca9b4653788570c25e646dcdfa9ba088e89f20e/qa/rpc-tests/p2p-compactblocks.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/qa/rpc-tests/p2p-compactblocks.py?ref=eca9b4653788570c25e646dcdfa9ba088e89f20e",
        "patch": "@@ -186,12 +186,15 @@ def received_sendcmpct():\n \n         def check_announcement_of_new_block(node, peer, predicate):\n             peer.clear_block_announcement()\n-            node.generate(1)\n-            got_message = wait_until(lambda: peer.block_announced, timeout=30)\n+            block_hash = int(node.generate(1)[0], 16)\n+            peer.wait_for_block_announcement(block_hash, timeout=30)\n             assert(peer.block_announced)\n             assert(got_message)\n+\n             with mininode_lock:\n-                assert(predicate(peer))\n+                assert predicate(peer), (\n+                    \"block_hash={!r}, cmpctblock={!r}, inv={!r}\".format(\n+                        block_hash, peer.last_cmpctblock, peer.last_inv))\n \n         # We shouldn't get any block announcements via cmpctblock yet.\n         check_announcement_of_new_block(node, test_node, lambda p: p.last_cmpctblock is None)"
      }
    ]
  },
  {
    "sha": "2ba5d784276783716bbf27b458514c4c3f44f4b6",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyYmE1ZDc4NDI3Njc4MzcxNmJiZjI3YjQ1ODUxNGM0YzNmNDRmNGI2",
    "commit": {
      "author": {
        "name": "Russell Yanofsky",
        "email": "russ@chaincode.com",
        "date": "2016-10-24T19:33:14Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2016-11-19T22:53:01Z"
      },
      "message": "[qa] Fix bug in compactblocks v2 merge\n\nBug caused the wait_for_block_announcement to be called on the wrong node,\nleading to nondeterminism and occasional test failures. Bug was introduced in\nmerge commit:\n\nd075479 Merge #8882: [qa] Fix race conditions in p2p-compactblocks.py and sendheaders.py\n\nUnderlying commits which conflicted were:\n\n27acfc1 [qa] Update p2p-compactblocks.py for compactblocks v2\n6976db2 [qa] Another attempt to fix race condition in p2p-compactblocks.py\n\nThe first commit changed the test_compactblock_construction function signature\nand second commit added code which wasn't updated during the merge to use the\nnew arguments.\n\nSuhas Daftuar <sdaftuar@chaincode.com> noticed the bug and suggested the fix.\n\nGithub-Pull: #9058\nRebased-From: 47e9659ecfbe07077a4564591095bd5510e0f917",
      "tree": {
        "sha": "fbb643de2edc8b9b23c7111f230958d308c261bd",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/fbb643de2edc8b9b23c7111f230958d308c261bd"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2ba5d784276783716bbf27b458514c4c3f44f4b6",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2ba5d784276783716bbf27b458514c4c3f44f4b6",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/2ba5d784276783716bbf27b458514c4c3f44f4b6",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2ba5d784276783716bbf27b458514c4c3f44f4b6/comments",
    "author": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "eca9b4653788570c25e646dcdfa9ba088e89f20e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/eca9b4653788570c25e646dcdfa9ba088e89f20e",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/eca9b4653788570c25e646dcdfa9ba088e89f20e"
      }
    ],
    "stats": {
      "total": 4,
      "additions": 2,
      "deletions": 2
    },
    "files": [
      {
        "sha": "0abb9f986972f70e8b5e98b234cfe7b71e69388c",
        "filename": "qa/rpc-tests/p2p-compactblocks.py",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2ba5d784276783716bbf27b458514c4c3f44f4b6/qa/rpc-tests/p2p-compactblocks.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2ba5d784276783716bbf27b458514c4c3f44f4b6/qa/rpc-tests/p2p-compactblocks.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/qa/rpc-tests/p2p-compactblocks.py?ref=2ba5d784276783716bbf27b458514c4c3f44f4b6",
        "patch": "@@ -303,8 +303,8 @@ def test_compactblock_construction(self, node, test_node, version, use_witness_a\n             assert(segwit_tx_generated) # check that our test is not broken\n \n         # Wait until we've seen the block announcement for the resulting tip\n-        tip = int(self.nodes[0].getbestblockhash(), 16)\n-        assert(self.test_node.wait_for_block_announcement(tip))\n+        tip = int(node.getbestblockhash(), 16)\n+        assert(test_node.wait_for_block_announcement(tip))\n \n         # Now mine a block, and look at the resulting compact block.\n         test_node.clear_block_announcement()"
      }
    ]
  },
  {
    "sha": "286e548d87266f3b394d75182f04fb701b2263e8",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyODZlNTQ4ZDg3MjY2ZjNiMzk0ZDc1MTgyZjA0ZmI3MDFiMjI2M2U4",
    "commit": {
      "author": {
        "name": "Russell Yanofsky",
        "email": "russ@chaincode.com",
        "date": "2016-10-26T18:15:16Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2016-11-19T22:55:07Z"
      },
      "message": "[qa] Fix stale data bug in test_compactblocks_not_at_tip\n\nClear test_node.last_block before requesting blocks in the\ncompactblocks_not_at_tip test so comparisons won't fail if a blocks were received\nbefore the test started.\n\nThe bug doesn't currently cause any problems due to the order tests run, but\nthis will change in the next commit.\n\nGithub-Pull: #9058\nRebased-From: 55bfddcabbf9e8a3743f77167ba4a43aaba9f948",
      "tree": {
        "sha": "c6c1e30b3735cd02c1a55242360e8308b530604e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c6c1e30b3735cd02c1a55242360e8308b530604e"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/286e548d87266f3b394d75182f04fb701b2263e8",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/286e548d87266f3b394d75182f04fb701b2263e8",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/286e548d87266f3b394d75182f04fb701b2263e8",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/286e548d87266f3b394d75182f04fb701b2263e8/comments",
    "author": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "2ba5d784276783716bbf27b458514c4c3f44f4b6",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2ba5d784276783716bbf27b458514c4c3f44f4b6",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/2ba5d784276783716bbf27b458514c4c3f44f4b6"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 2,
      "deletions": 0
    },
    "files": [
      {
        "sha": "249afec2b5e72c850b4374cb667b33c478019ae5",
        "filename": "qa/rpc-tests/p2p-compactblocks.py",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/286e548d87266f3b394d75182f04fb701b2263e8/qa/rpc-tests/p2p-compactblocks.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/286e548d87266f3b394d75182f04fb701b2263e8/qa/rpc-tests/p2p-compactblocks.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/qa/rpc-tests/p2p-compactblocks.py?ref=286e548d87266f3b394d75182f04fb701b2263e8",
        "patch": "@@ -651,6 +651,8 @@ def test_compactblocks_not_at_tip(self, node, test_node):\n         node.generate(1)\n         wait_until(test_node.received_block_announcement, timeout=30)\n         test_node.clear_block_announcement()\n+        with mininode_lock:\n+            test_node.last_block = None\n         test_node.send_message(msg_getdata([CInv(4, int(new_blocks[0], 16))]))\n         success = wait_until(lambda: test_node.last_block is not None, timeout=30)\n         assert(success)"
      }
    ]
  },
  {
    "sha": "36e3b951039b98508badaafa0bbec166c22900d3",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozNmUzYjk1MTAzOWI5ODUwOGJhZGFhZmEwYmJlYzE2NmMyMjkwMGQz",
    "commit": {
      "author": {
        "name": "Matt Corallo",
        "email": "git@bluematt.me",
        "date": "2016-06-21T20:08:29Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2016-11-20T14:07:39Z"
      },
      "message": "Dont remove a \"preferred\" cmpctblock peer if they provide a block\n\nGithub-Pull: #8637\nRebased-From: 02a337defdd854efc78ecba6d1fb19cb1c075f16",
      "tree": {
        "sha": "a22ea0303a2537336ad98dbeb407b32311f3c601",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a22ea0303a2537336ad98dbeb407b32311f3c601"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/36e3b951039b98508badaafa0bbec166c22900d3",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/36e3b951039b98508badaafa0bbec166c22900d3",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/36e3b951039b98508badaafa0bbec166c22900d3",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/36e3b951039b98508badaafa0bbec166c22900d3/comments",
    "author": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "286e548d87266f3b394d75182f04fb701b2263e8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/286e548d87266f3b394d75182f04fb701b2263e8",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/286e548d87266f3b394d75182f04fb701b2263e8"
      }
    ],
    "stats": {
      "total": 14,
      "additions": 12,
      "deletions": 2
    },
    "files": [
      {
        "sha": "3436caaf10696fb728181752f661561296a26aa3",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 12,
        "deletions": 2,
        "changes": 14,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/36e3b951039b98508badaafa0bbec166c22900d3/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/36e3b951039b98508badaafa0bbec166c22900d3/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=36e3b951039b98508badaafa0bbec166c22900d3",
        "patch": "@@ -495,9 +495,13 @@ void MaybeSetPeerAsAnnouncingHeaderAndIDs(const CNodeState* nodestate, CNode* pf\n         return;\n     }\n     if (nodestate->fProvidesHeaderAndIDs) {\n-        BOOST_FOREACH(const NodeId nodeid, lNodesAnnouncingHeaderAndIDs)\n-            if (nodeid == pfrom->GetId())\n+        for (std::list<NodeId>::iterator it = lNodesAnnouncingHeaderAndIDs.begin(); it != lNodesAnnouncingHeaderAndIDs.end(); it++) {\n+            if (*it == pfrom->GetId()) {\n+                lNodesAnnouncingHeaderAndIDs.erase(it);\n+                lNodesAnnouncingHeaderAndIDs.push_back(pfrom->GetId());\n                 return;\n+            }\n+        }\n         bool fAnnounceUsingCMPCTBLOCK = false;\n         uint64_t nCMPCTBLOCKVersion = (nLocalServices & NODE_WITNESS) ? 2 : 1;\n         if (lNodesAnnouncingHeaderAndIDs.size() >= 3) {\n@@ -5727,6 +5731,12 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n                     return true;\n                 }\n \n+                if (!fAlreadyInFlight && mapBlocksInFlight.size() == 1 && pindex->pprev->IsValid(BLOCK_VALID_CHAIN)) {\n+                    // We seem to be rather well-synced, so it appears pfrom was the first to provide us\n+                    // with this block! Let's get them to announce using compact blocks in the future.\n+                    MaybeSetPeerAsAnnouncingHeaderAndIDs(nodestate, pfrom, connman);\n+                }\n+\n                 BlockTransactionsRequest req;\n                 for (size_t i = 0; i < cmpctblock.BlockTxCount(); i++) {\n                     if (!partialBlock.IsTxAvailable(i))"
      }
    ]
  },
  {
    "sha": "76ba1c973948a33bbf87d13c4bd2f2b81fb466a2",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo3NmJhMWM5NzM5NDhhMzNiYmY4N2QxM2M0YmQyZjJiODFmYjQ2NmEy",
    "commit": {
      "author": {
        "name": "Matt Corallo",
        "email": "git@bluematt.me",
        "date": "2016-06-21T23:28:38Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2016-11-20T14:07:53Z"
      },
      "message": "More agressively filter compact block requests\n\nUnit test adaptations by Pieter Wuille.\n\nGithub-Pull: #8637\nRebased-From: fe998e962dc015978f104b782afb7daec3c4d4df",
      "tree": {
        "sha": "8850031f5ca501a2275cf5079489166920b03fde",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8850031f5ca501a2275cf5079489166920b03fde"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/76ba1c973948a33bbf87d13c4bd2f2b81fb466a2",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/76ba1c973948a33bbf87d13c4bd2f2b81fb466a2",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/76ba1c973948a33bbf87d13c4bd2f2b81fb466a2",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/76ba1c973948a33bbf87d13c4bd2f2b81fb466a2/comments",
    "author": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "36e3b951039b98508badaafa0bbec166c22900d3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/36e3b951039b98508badaafa0bbec166c22900d3",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/36e3b951039b98508badaafa0bbec166c22900d3"
      }
    ],
    "stats": {
      "total": 10,
      "additions": 5,
      "deletions": 5
    },
    "files": [
      {
        "sha": "4029669780eea157779e13dcd5d29b97c6dc1673",
        "filename": "qa/rpc-tests/p2p-compactblocks.py",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/76ba1c973948a33bbf87d13c4bd2f2b81fb466a2/qa/rpc-tests/p2p-compactblocks.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/76ba1c973948a33bbf87d13c4bd2f2b81fb466a2/qa/rpc-tests/p2p-compactblocks.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/qa/rpc-tests/p2p-compactblocks.py?ref=76ba1c973948a33bbf87d13c4bd2f2b81fb466a2",
        "patch": "@@ -594,7 +594,7 @@ def test_incorrect_blocktxn_response(self, node, test_node, version):\n     def test_getblocktxn_handler(self, node, test_node, version):\n         # bitcoind won't respond for blocks whose height is more than 15 blocks\n         # deep.\n-        MAX_GETBLOCKTXN_DEPTH = 15\n+        MAX_GETBLOCKTXN_DEPTH = 10\n         chain_height = node.getblockcount()\n         current_height = chain_height\n         while (current_height >= chain_height - MAX_GETBLOCKTXN_DEPTH):\n@@ -635,7 +635,7 @@ def test_getblocktxn_handler(self, node, test_node, version):\n \n     def test_compactblocks_not_at_tip(self, node, test_node):\n         # Test that requesting old compactblocks doesn't work.\n-        MAX_CMPCTBLOCK_DEPTH = 11\n+        MAX_CMPCTBLOCK_DEPTH = 6\n         new_blocks = []\n         for i in range(MAX_CMPCTBLOCK_DEPTH):\n             test_node.clear_block_announcement()"
      },
      {
        "sha": "2e09b6cf75343df51ce564054caf93f1e99bf275",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 3,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/76ba1c973948a33bbf87d13c4bd2f2b81fb466a2/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/76ba1c973948a33bbf87d13c4bd2f2b81fb466a2/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=76ba1c973948a33bbf87d13c4bd2f2b81fb466a2",
        "patch": "@@ -4855,7 +4855,7 @@ void static ProcessGetData(CNode* pfrom, const Consensus::Params& consensusParam\n                         // and we don't feel like constructing the object for them, so\n                         // instead we respond with the full, non-compact block.\n                         bool fPeerWantsWitness = State(pfrom->GetId())->fWantsCmpctWitness;\n-                        if (mi->second->nHeight >= chainActive.Height() - 10) {\n+                        if (CanDirectFetch(Params().GetConsensus()) && mi->second->nHeight >= chainActive.Height() - 5) {\n                             CBlockHeaderAndShortTxIDs cmpctblock(block, fPeerWantsWitness);\n                             pfrom->PushMessageWithFlag(fPeerWantsWitness ? 0 : SERIALIZE_TRANSACTION_NO_WITNESS, NetMsgType::CMPCTBLOCK, cmpctblock);\n                         } else\n@@ -5401,8 +5401,8 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n             return true;\n         }\n \n-        if (it->second->nHeight < chainActive.Height() - 15) {\n-            LogPrint(\"net\", \"Peer %d sent us a getblocktxn for a block > 15 deep\", pfrom->id);\n+        if (it->second->nHeight < chainActive.Height() - 10) {\n+            LogPrint(\"net\", \"Peer %d sent us a getblocktxn for a block > 10 deep\", pfrom->id);\n             return true;\n         }\n "
      }
    ]
  },
  {
    "sha": "3d23a0eaa3cfa349833e42345daf954e9530bdfd",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozZDIzYTBlYWEzY2ZhMzQ5ODMzZTQyMzQ1ZGFmOTU0ZTk1MzBiZGZk",
    "commit": {
      "author": {
        "name": "instagibbs",
        "email": "gsanders87@gmail.com",
        "date": "2016-06-22T12:18:22Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2016-11-20T14:08:03Z"
      },
      "message": "Add cmpctblock to debug help list\n\nGithub-Pull: #8637\nRebased-From: b2e93a343ec2dc7d255b970e6ee45e9c390f7ed0",
      "tree": {
        "sha": "632be4986ed5cf89bfd28855f0ad46bc46e88816",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/632be4986ed5cf89bfd28855f0ad46bc46e88816"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3d23a0eaa3cfa349833e42345daf954e9530bdfd",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3d23a0eaa3cfa349833e42345daf954e9530bdfd",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/3d23a0eaa3cfa349833e42345daf954e9530bdfd",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3d23a0eaa3cfa349833e42345daf954e9530bdfd/comments",
    "author": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "76ba1c973948a33bbf87d13c4bd2f2b81fb466a2",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/76ba1c973948a33bbf87d13c4bd2f2b81fb466a2",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/76ba1c973948a33bbf87d13c4bd2f2b81fb466a2"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 1,
      "deletions": 1
    },
    "files": [
      {
        "sha": "eab8de8d029575b6c4e0d76830488487a42a74f9",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3d23a0eaa3cfa349833e42345daf954e9530bdfd/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3d23a0eaa3cfa349833e42345daf954e9530bdfd/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=3d23a0eaa3cfa349833e42345daf954e9530bdfd",
        "patch": "@@ -412,7 +412,7 @@ std::string HelpMessage(HelpMessageMode mode)\n         strUsage += HelpMessageOpt(\"-limitdescendantsize=<n>\", strprintf(\"Do not accept transactions if any ancestor would have more than <n> kilobytes of in-mempool descendants (default: %u).\", DEFAULT_DESCENDANT_SIZE_LIMIT));\n         strUsage += HelpMessageOpt(\"-bip9params=deployment:start:end\", \"Use given start/end times for specified bip9 deployment (regtest-only)\");\n     }\n-    string debugCategories = \"addrman, alert, bench, coindb, db, http, libevent, lock, mempool, mempoolrej, net, proxy, prune, rand, reindex, rpc, selectcoins, tor, zmq\"; // Don't translate these and qt below\n+    string debugCategories = \"addrman, alert, bench, cmpctblock, coindb, db, http, libevent, lock, mempool, mempoolrej, net, proxy, prune, rand, reindex, rpc, selectcoins, tor, zmq\"; // Don't translate these and qt below\n     if (mode == HMM_BITCOIN_QT)\n         debugCategories += \", qt\";\n     strUsage += HelpMessageOpt(\"-debug=<category>\", strprintf(_(\"Output debugging information (default: %u, supplying <category> is optional)\"), 0) + \". \" +"
      }
    ]
  },
  {
    "sha": "2cad5db6f752ad8fa2d047b67a137de76eb9c982",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyY2FkNWRiNmY3NTJhZDhmYTJkMDQ3YjY3YTEzN2RlNzZlYjljOTgy",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2016-08-31T15:35:59Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2016-11-20T14:08:16Z"
      },
      "message": "Align constant names for maximum compact block / blocktxn depth\n\nGithub-Pull: #8637\nRebased-From: 3ac6de0a045cc9b2047ceb19af970e7ffbf905fa",
      "tree": {
        "sha": "7ae8cd2ba5acdd9c7bda8215d51ef67e64833966",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7ae8cd2ba5acdd9c7bda8215d51ef67e64833966"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2cad5db6f752ad8fa2d047b67a137de76eb9c982",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2cad5db6f752ad8fa2d047b67a137de76eb9c982",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/2cad5db6f752ad8fa2d047b67a137de76eb9c982",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2cad5db6f752ad8fa2d047b67a137de76eb9c982/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "3d23a0eaa3cfa349833e42345daf954e9530bdfd",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3d23a0eaa3cfa349833e42345daf954e9530bdfd",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/3d23a0eaa3cfa349833e42345daf954e9530bdfd"
      }
    ],
    "stats": {
      "total": 15,
      "additions": 10,
      "deletions": 5
    },
    "files": [
      {
        "sha": "0c73032c9dfbebd6e30115213c83a726a4ca62ef",
        "filename": "qa/rpc-tests/p2p-compactblocks.py",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2cad5db6f752ad8fa2d047b67a137de76eb9c982/qa/rpc-tests/p2p-compactblocks.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2cad5db6f752ad8fa2d047b67a137de76eb9c982/qa/rpc-tests/p2p-compactblocks.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/qa/rpc-tests/p2p-compactblocks.py?ref=2cad5db6f752ad8fa2d047b67a137de76eb9c982",
        "patch": "@@ -635,9 +635,9 @@ def test_getblocktxn_handler(self, node, test_node, version):\n \n     def test_compactblocks_not_at_tip(self, node, test_node):\n         # Test that requesting old compactblocks doesn't work.\n-        MAX_CMPCTBLOCK_DEPTH = 6\n+        MAX_CMPCTBLOCK_DEPTH = 5\n         new_blocks = []\n-        for i in range(MAX_CMPCTBLOCK_DEPTH):\n+        for i in range(MAX_CMPCTBLOCK_DEPTH + 1):\n             test_node.clear_block_announcement()\n             new_blocks.append(node.generate(1)[0])\n             wait_until(test_node.received_block_announcement, timeout=30)"
      },
      {
        "sha": "db020a4495dc3d1a33069c40b97733183dcc50f5",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 3,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2cad5db6f752ad8fa2d047b67a137de76eb9c982/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2cad5db6f752ad8fa2d047b67a137de76eb9c982/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=2cad5db6f752ad8fa2d047b67a137de76eb9c982",
        "patch": "@@ -4855,7 +4855,7 @@ void static ProcessGetData(CNode* pfrom, const Consensus::Params& consensusParam\n                         // and we don't feel like constructing the object for them, so\n                         // instead we respond with the full, non-compact block.\n                         bool fPeerWantsWitness = State(pfrom->GetId())->fWantsCmpctWitness;\n-                        if (CanDirectFetch(Params().GetConsensus()) && mi->second->nHeight >= chainActive.Height() - 5) {\n+                        if (CanDirectFetch(consensusParams) && mi->second->nHeight >= chainActive.Height() - MAX_CMPCTBLOCK_DEPTH) {\n                             CBlockHeaderAndShortTxIDs cmpctblock(block, fPeerWantsWitness);\n                             pfrom->PushMessageWithFlag(fPeerWantsWitness ? 0 : SERIALIZE_TRANSACTION_NO_WITNESS, NetMsgType::CMPCTBLOCK, cmpctblock);\n                         } else\n@@ -5401,8 +5401,8 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n             return true;\n         }\n \n-        if (it->second->nHeight < chainActive.Height() - 10) {\n-            LogPrint(\"net\", \"Peer %d sent us a getblocktxn for a block > 10 deep\", pfrom->id);\n+        if (it->second->nHeight < chainActive.Height() - MAX_BLOCKTXN_DEPTH) {\n+            LogPrint(\"net\", \"Peer %d sent us a getblocktxn for a block > %i deep\", pfrom->id, MAX_BLOCKTXN_DEPTH);\n             return true;\n         }\n "
      },
      {
        "sha": "024f35cd399d0c3fb5f3f4cec5bdcd16d086e323",
        "filename": "src/main.h",
        "status": "modified",
        "additions": 5,
        "deletions": 0,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2cad5db6f752ad8fa2d047b67a137de76eb9c982/src/main.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2cad5db6f752ad8fa2d047b67a137de76eb9c982/src/main.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.h?ref=2cad5db6f752ad8fa2d047b67a137de76eb9c982",
        "patch": "@@ -89,6 +89,11 @@ static const unsigned int BLOCK_STALLING_TIMEOUT = 2;\n /** Number of headers sent in one getheaders result. We rely on the assumption that if a peer sends\n  *  less than this number, we reached its tip. Changing this value is a protocol upgrade. */\n static const unsigned int MAX_HEADERS_RESULTS = 2000;\n+/** Maximum depth of blocks we're willing to serve as compact blocks to peers\n+ *  when requested. For older blocks, a regular BLOCK response will be sent. */\n+static const int MAX_CMPCTBLOCK_DEPTH = 5;\n+/** Maximum depth of blocks we're willing to respond to GETBLOCKTXN requests for. */\n+static const int MAX_BLOCKTXN_DEPTH = 10;\n /** Size of the \"block download window\": how far ahead of our current height do we fetch?\n  *  Larger windows tolerate larger download speed differences between peer, but increase the potential\n  *  degree of disordering of blocks on disk (which make reindexing and in the future perhaps pruning"
      }
    ]
  },
  {
    "sha": "e8461666ecd7f0f89fba92a377c0f8beffa233e9",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzplODQ2MTY2NmVjZDdmMGY4OWZiYTkyYTM3N2MwZjhiZWZmYTIzM2U5",
    "commit": {
      "author": {
        "name": "Russell Yanofsky",
        "email": "russ@chaincode.com",
        "date": "2016-10-26T18:53:18Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2016-11-20T14:25:34Z"
      },
      "message": "Modify getblocktxn handler not to drop requests for old blocks\n\nThe current getblocktxn implementation drops and ignores requests for old\nblocks, which causes occasional sync_block timeouts during the\np2p-compactblocks.py test as reported in\nhttps://github.com/bitcoin/bitcoin/issues/8842.\n\nThe p2p-compactblocks.py test setup creates many new blocks in a short\nperiod of time, which can lead to getblocktxn requests for blocks below the\nhardcoded depth limit of 10 blocks. This commit changes the getblocktxn\nhandler not to ignore these requests, so the peer nodes in the test setup\nwill reliably be able to sync.\n\nThe protocol change is documented in BIP-152 update \"Allow block responses\nto getblocktxn requests\" at https://github.com/bitcoin/bips/pull/469.\n\nThe protocol change is not expected to affect nodes running outside the test\nenvironment, because there shouldn't normally be lots of new blocks being\nrapidly added that need to be synced.\n\nGithub-Pull: #9058\nRebased-From: dac53b58b555183ccc0d5e64c428528267cd98b3\nGithub-Pull: #9160\nRebased-From: ec34648766c4052816e4072cc61ad429430bcfd9",
      "tree": {
        "sha": "6c40073e479480f2e21d30bfa762095d50510e72",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6c40073e479480f2e21d30bfa762095d50510e72"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e8461666ecd7f0f89fba92a377c0f8beffa233e9",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e8461666ecd7f0f89fba92a377c0f8beffa233e9",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/e8461666ecd7f0f89fba92a377c0f8beffa233e9",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e8461666ecd7f0f89fba92a377c0f8beffa233e9/comments",
    "author": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "2cad5db6f752ad8fa2d047b67a137de76eb9c982",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2cad5db6f752ad8fa2d047b67a137de76eb9c982",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/2cad5db6f752ad8fa2d047b67a137de76eb9c982"
      }
    ],
    "stats": {
      "total": 26,
      "additions": 22,
      "deletions": 4
    },
    "files": [
      {
        "sha": "e0b72e68402eccd44d1f5fd2029a1d5ff946a452",
        "filename": "qa/rpc-tests/p2p-compactblocks.py",
        "status": "modified",
        "additions": 9,
        "deletions": 3,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e8461666ecd7f0f89fba92a377c0f8beffa233e9/qa/rpc-tests/p2p-compactblocks.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e8461666ecd7f0f89fba92a377c0f8beffa233e9/qa/rpc-tests/p2p-compactblocks.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/qa/rpc-tests/p2p-compactblocks.py?ref=e8461666ecd7f0f89fba92a377c0f8beffa233e9",
        "patch": "@@ -592,8 +592,8 @@ def test_incorrect_blocktxn_response(self, node, test_node, version):\n         assert_equal(int(node.getbestblockhash(), 16), block.sha256)\n \n     def test_getblocktxn_handler(self, node, test_node, version):\n-        # bitcoind won't respond for blocks whose height is more than 15 blocks\n-        # deep.\n+        # bitcoind will not send blocktxn responses for blocks whose height is\n+        # more than 10 blocks deep.\n         MAX_GETBLOCKTXN_DEPTH = 10\n         chain_height = node.getblockcount()\n         current_height = chain_height\n@@ -626,11 +626,17 @@ def test_getblocktxn_handler(self, node, test_node, version):\n                 test_node.last_blocktxn = None\n             current_height -= 1\n \n-        # Next request should be ignored, as we're past the allowed depth.\n+        # Next request should send a full block response, as we're past the\n+        # allowed depth for a blocktxn response.\n         block_hash = node.getblockhash(current_height)\n         msg.block_txn_request = BlockTransactionsRequest(int(block_hash, 16), [0])\n+        with mininode_lock:\n+            test_node.last_block = None\n+            test_node.last_blocktxn = None\n         test_node.send_and_ping(msg)\n         with mininode_lock:\n+            test_node.last_block.block.calc_sha256()\n+            assert_equal(test_node.last_block.block.sha256, int(block_hash, 16))\n             assert_equal(test_node.last_blocktxn, None)\n \n     def test_compactblocks_not_at_tip(self, node, test_node):"
      },
      {
        "sha": "191bcff4cc1292dbd1a98cf12ea6519e7c77e7d9",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 13,
        "deletions": 1,
        "changes": 14,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e8461666ecd7f0f89fba92a377c0f8beffa233e9/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e8461666ecd7f0f89fba92a377c0f8beffa233e9/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=e8461666ecd7f0f89fba92a377c0f8beffa233e9",
        "patch": "@@ -5402,7 +5402,19 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n         }\n \n         if (it->second->nHeight < chainActive.Height() - MAX_BLOCKTXN_DEPTH) {\n+            // If an older block is requested (should never happen in practice,\n+            // but can happen in tests) send a block response instead of a\n+            // blocktxn response. Sending a full block response instead of a\n+            // small blocktxn response is preferable in the case where a peer\n+            // might maliciously send lots of getblocktxn requests to trigger\n+            // expensive disk reads, because it will require the peer to\n+            // actually receive all the data read from disk over the network.\n             LogPrint(\"net\", \"Peer %d sent us a getblocktxn for a block > %i deep\", pfrom->id, MAX_BLOCKTXN_DEPTH);\n+            CInv inv;\n+            inv.type = State(pfrom->GetId())->fWantsCmpctWitness ? MSG_WITNESS_BLOCK : MSG_BLOCK;\n+            inv.hash = req.blockhash;\n+            pfrom->vRecvGetData.push_back(inv);\n+            ProcessGetData(pfrom, chainparams.GetConsensus());\n             return true;\n         }\n \n@@ -5734,7 +5746,7 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n                 if (!fAlreadyInFlight && mapBlocksInFlight.size() == 1 && pindex->pprev->IsValid(BLOCK_VALID_CHAIN)) {\n                     // We seem to be rather well-synced, so it appears pfrom was the first to provide us\n                     // with this block! Let's get them to announce using compact blocks in the future.\n-                    MaybeSetPeerAsAnnouncingHeaderAndIDs(nodestate, pfrom, connman);\n+                    MaybeSetPeerAsAnnouncingHeaderAndIDs(nodestate, pfrom);\n                 }\n \n                 BlockTransactionsRequest req;"
      }
    ]
  }
]