[
  {
    "sha": "1f6c650c99eb94fdd0cbdd528aa3405201de08c2",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxZjZjNjUwYzk5ZWI5NGZkZDBjYmRkNTI4YWEzNDA1MjAxZGUwOGMy",
    "commit": {
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2019-10-14T21:00:49Z"
      },
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2019-10-14T21:00:49Z"
      },
      "message": "travis: run tests on macOS native\n\nReview hint:\ngit show -w\n\nCo-authored-by: MarcoFalke <falke.marco@gmail.com>\nCo-authored-by: keneanung <keneanung@googlemail.com>\nCo-authored-by: Vadim Peretokin <vperetokin@gmail.com>",
      "tree": {
        "sha": "17f9520cf4d995dafe94902119afb13bdf583d55",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/17f9520cf4d995dafe94902119afb13bdf583d55"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1f6c650c99eb94fdd0cbdd528aa3405201de08c2",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAl2k4gEACgkQV/+b28ww\nEAlWIw/+N95piNj9g6injE7nMGt5EhRbnQr81MR4f94a2npMT60qDRR5OycyLfP3\n9Z8pN02NDO3MsDR8kzsdeiAb2XhmTHoS7FP4cQEYQj5SdriTu8W3PvnkeWWkkDXq\ncouFfCnEkt5FZClVOOGAgmC7t7UCaUCdiZyfuvHXw5bvaYdcCTuuHv63QEkAWToI\nIuJJ4gYz1FeGW33UiRd4UOclijF+XGJ8xtljC/7hbVa8X4+nw6AuqiDpBm92CM8q\nVVaxsjUHRp/S8T73ujbI6rMnIk42lz70KHaqpNplHoL9Eg+FjENCLmVDZqAVYzN8\nSQacdFfhiXVrbx4jdWeJ2edfNeinA5mr+0DJpha6f276GG1cfxdbxm/MAbeDj7Cq\nf9msF1nv814Dh2HlXIpNALN/R5xxS+c+8A0dD+UztNvkSBvge8xjRbGLroGQFMX5\nrk00QDzqzUIcFtTu1Lw5MC36qR9rXhji0uwkP8LhubWvMdGCSPMT4l1Q0eFRoFEX\nFA23cbCjASBUpTLWMYxgmKRgPt7twJa1mAlVuWbse3eVHS9G7Z0Xi1hCnz26rP2a\nTFyY5Ja1aUsGFXd1BW7/sN0eg0dHpjXfGE7h5kXQSCvaDlsMlOEyQwhEUS6ASAjM\nY1q46u1aaAopuBE5NCYzv30v6V+ibfwywWDhk1WBg/i3uaiRpmw=\n=Rqyd\n-----END PGP SIGNATURE-----",
        "payload": "tree 17f9520cf4d995dafe94902119afb13bdf583d55\nparent 42d0eca725a83c999e2b67e33dfc7bcc96288dc3\nauthor Sjors Provoost <sjors@sprovoost.nl> 1571086849 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1571086849 +0200\n\ntravis: run tests on macOS native\n\nReview hint:\ngit show -w\n\nCo-authored-by: MarcoFalke <falke.marco@gmail.com>\nCo-authored-by: keneanung <keneanung@googlemail.com>\nCo-authored-by: Vadim Peretokin <vperetokin@gmail.com>\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1f6c650c99eb94fdd0cbdd528aa3405201de08c2",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/1f6c650c99eb94fdd0cbdd528aa3405201de08c2",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1f6c650c99eb94fdd0cbdd528aa3405201de08c2/comments",
    "author": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "42d0eca725a83c999e2b67e33dfc7bcc96288dc3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/42d0eca725a83c999e2b67e33dfc7bcc96288dc3",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/42d0eca725a83c999e2b67e33dfc7bcc96288dc3"
      }
    ],
    "stats": {
      "total": 127,
      "additions": 109,
      "deletions": 18
    },
    "files": [
      {
        "sha": "7519d72e8312bf3b59042da52a025543e0fbf645",
        "filename": ".travis.yml",
        "status": "modified",
        "additions": 18,
        "deletions": 1,
        "changes": 19,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1f6c650c99eb94fdd0cbdd528aa3405201de08c2/.travis.yml",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1f6c650c99eb94fdd0cbdd528aa3405201de08c2/.travis.yml",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/.travis.yml?ref=1f6c650c99eb94fdd0cbdd528aa3405201de08c2",
        "patch": "@@ -34,6 +34,13 @@ cache:\n     - $TRAVIS_BUILD_DIR/depends/built\n     - $TRAVIS_BUILD_DIR/depends/sdk-sources\n     - $TRAVIS_BUILD_DIR/ci/scratch/.ccache\n+    # macOS\n+    - $HOME/Library/Caches/Homebrew\n+    - /usr/local/Homebrew\n+before_cache:\n+  - if [ \"${TRAVIS_OS_NAME}\" = \"osx\" ]; then brew cleanup; fi\n+  # Cache only .git files under \"/usr/local/Homebrew\" so \"brew update\" does not take 5min every build\n+  # - if [ \"${TRAVIS_OS_NAME}\" = \"osx\" ]; then find /usr/local/Homebrew \\! -regex \".+\\.git.+\" -delete; fi\n stages:\n   - lint\n   - test\n@@ -93,7 +100,7 @@ jobs:\n       os: osx\n       # Use the earliest macOS that can build our lint dependencies:\n       # Xcode 8.3.3, macOS 10.12, JDK 1.8.0_112-b16\n-      # https://docs.travis-ci.com/user/reference/osx/#OS-X-Version\n+      # https://docs.travis-ci.com/user/reference/osx/#macos-version\n       osx_image: xcode8.3\n       # TODO: if you're updating osx_image, try using \"rvm:\" to supply the\n       # version of ruby required by homebrew. Despite this \"rvm:\" declaration,\n@@ -160,3 +167,13 @@ jobs:\n       name: 'macOS 10.10  [GOAL: deploy] [no functional tests]'\n       env: >-\n         FILE_ENV=\"./ci/test/00_setup_env_mac.sh\"\n+\n+    - stage: test\n+      name: 'macOS 10.14 native [GOAL: install] [GUI: BIP70 enabled] [no depends]'\n+      os: osx\n+      # Use the most recent version:\n+      # Xcode 11, macOS 10.14, JDK 12.0.1\n+      # https://docs.travis-ci.com/user/reference/osx/#macos-version\n+      osx_image: xcode11\n+      env: >-\n+        FILE_ENV=\"./ci/test/00_setup_env_mac_functional.sh\""
      },
      {
        "sha": "cf19a0962f62c3f629d9aa76137d347a2f48fcb5",
        "filename": "ci/test/00_setup_env_mac_functional.sh",
        "status": "added",
        "additions": 18,
        "deletions": 0,
        "changes": 18,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1f6c650c99eb94fdd0cbdd528aa3405201de08c2/ci/test/00_setup_env_mac_functional.sh",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1f6c650c99eb94fdd0cbdd528aa3405201de08c2/ci/test/00_setup_env_mac_functional.sh",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/ci/test/00_setup_env_mac_functional.sh?ref=1f6c650c99eb94fdd0cbdd528aa3405201de08c2",
        "patch": "@@ -0,0 +1,18 @@\n+#!/usr/bin/env bash\n+#\n+# Copyright (c) 2019 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+export LC_ALL=C.UTF-8\n+\n+export HOST=x86_64-apple-darwin14\n+export BREW_PACKAGES=\"automake berkeley-db4 libtool boost miniupnpc pkg-config protobuf qt qrencode python3 ccache zeromq\"\n+export PIP_PACKAGES=\"zmq\"\n+export OSX_SDK=10.11\n+export RUN_CI_ON_HOST=true\n+export RUN_UNIT_TESTS=true\n+export RUN_FUNCTIONAL_TESTS=true\n+export GOAL=\"install\"\n+export BITCOIN_CONFIG=\"--enable-gui --enable-bip70 --enable-reduce-exports --enable-werror\"\n+export NO_DEPENDS=1"
      },
      {
        "sha": "1578e3c0b4bf4a49958ebc7f3d18562da62a06a0",
        "filename": "ci/test/04_install.sh",
        "status": "modified",
        "additions": 38,
        "deletions": 4,
        "changes": 42,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1f6c650c99eb94fdd0cbdd528aa3405201de08c2/ci/test/04_install.sh",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1f6c650c99eb94fdd0cbdd528aa3405201de08c2/ci/test/04_install.sh",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/ci/test/04_install.sh?ref=1f6c650c99eb94fdd0cbdd528aa3405201de08c2",
        "patch": "@@ -6,6 +6,32 @@\n \n export LC_ALL=C.UTF-8\n \n+if [ \"$TRAVIS_OS_NAME\" == \"osx\" ]; then\n+  set +o errexit\n+  pushd /usr/local/Homebrew || exit 1\n+  git reset --hard origin/master\n+  popd || exit 1\n+  set -o errexit\n+  ${CI_RETRY_EXE} brew update\n+  # brew upgrade returns an error if any of the packages is already up to date\n+  # Failure is safe to ignore, unless we really need an update.\n+  brew upgrade $BREW_PACKAGES || true\n+\n+  # install new packages (brew install returns an error if already installed)\n+  for i in $BREW_PACKAGES; do\n+    if ! brew list | grep -q $i; then\n+      ${CI_RETRY_EXE} brew install $i\n+    fi\n+  done\n+\n+  export PATH=\"/usr/local/opt/ccache/libexec:$PATH\"\n+  OPENSSL_PKG_CONFIG_PATH=\"/usr/local/opt/openssl@1.1/lib/pkgconfig\"\n+  export PKG_CONFIG_PATH=$OPENSSL_PKG_CONFIG_PATH:$PKG_CONFIG_PATH\n+\n+  ${CI_RETRY_EXE} pip3 install $PIP_PACKAGES\n+\n+fi\n+\n mkdir -p \"${BASE_SCRATCH_DIR}\"\n ccache echo \"Creating ccache dir if it didn't already exist\"\n \n@@ -42,11 +68,19 @@ else\n   }\n fi\n \n-DOCKER_EXEC free -m -h\n-DOCKER_EXEC echo \"Number of CPUs \\(nproc\\):\" \\$\\(nproc\\)\n+if [ \"$TRAVIS_OS_NAME\" == \"osx\" ]; then\n+  top -l 1 -s 0 | awk ' /PhysMem/ {print}'\n+  echo \"Number of CPUs: $(sysctl -n hw.logicalcpu)\"\n+else\n+  DOCKER_EXEC free -m -h\n+  DOCKER_EXEC echo \"Number of CPUs \\(nproc\\):\" \\$\\(nproc\\)\n+fi\n \n-${CI_RETRY_EXE} DOCKER_EXEC apt-get update\n-${CI_RETRY_EXE} DOCKER_EXEC apt-get install --no-install-recommends --no-upgrade -y $PACKAGES $DOCKER_PACKAGES\n+\n+if [ \"$TRAVIS_OS_NAME\" != \"osx\" ]; then\n+  ${CI_RETRY_EXE} DOCKER_EXEC apt-get update\n+  ${CI_RETRY_EXE} DOCKER_EXEC apt-get install --no-install-recommends --no-upgrade -y $PACKAGES $DOCKER_PACKAGES\n+fi\n \n if [ \"$USE_BUSY_BOX\" = \"true\" ]; then\n   echo \"Setup to use BusyBox utils\""
      },
      {
        "sha": "469853cc8034d88bebe0b964a1902a2e86b87baa",
        "filename": "ci/test/05_before_script.sh",
        "status": "modified",
        "additions": 22,
        "deletions": 13,
        "changes": 35,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1f6c650c99eb94fdd0cbdd528aa3405201de08c2/ci/test/05_before_script.sh",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1f6c650c99eb94fdd0cbdd528aa3405201de08c2/ci/test/05_before_script.sh",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/ci/test/05_before_script.sh?ref=1f6c650c99eb94fdd0cbdd528aa3405201de08c2",
        "patch": "@@ -6,19 +6,28 @@\n \n export LC_ALL=C.UTF-8\n \n-DOCKER_EXEC echo \\> \\$HOME/.bitcoin  # Make sure default datadir does not exist and is never read by creating a dummy file\n+# Make sure default datadir does not exist and is never read by creating a dummy file\n+if [ \"$TRAVIS_OS_NAME\" == \"osx\" ]; then\n+  echo > $HOME/Library/Application\\ Support/Bitcoin\n+else\n+  DOCKER_EXEC echo \\> \\$HOME/.bitcoin\n+fi\n \n-mkdir -p depends/SDKs depends/sdk-sources\n+if [ \"$TRAVIS_OS_NAME\" != \"osx\" ]; then\n+\n+  mkdir -p depends/SDKs depends/sdk-sources\n+\n+  if [ -n \"$OSX_SDK\" ] && [ ! -f depends/sdk-sources/MacOSX${OSX_SDK}.sdk.tar.gz ]; then\n+    curl --location --fail $SDK_URL/MacOSX${OSX_SDK}.sdk.tar.gz -o depends/sdk-sources/MacOSX${OSX_SDK}.sdk.tar.gz\n+  fi\n+  if [ -n \"$OSX_SDK\" ] && [ -f depends/sdk-sources/MacOSX${OSX_SDK}.sdk.tar.gz ]; then\n+    tar -C depends/SDKs -xf depends/sdk-sources/MacOSX${OSX_SDK}.sdk.tar.gz\n+  fi\n+  if [[ $HOST = *-mingw32 ]]; then\n+    DOCKER_EXEC update-alternatives --set $HOST-g++ \\$\\(which $HOST-g++-posix\\)\n+  fi\n+  if [ -z \"$NO_DEPENDS\" ]; then\n+    DOCKER_EXEC CONFIG_SHELL= make $MAKEJOBS -C depends HOST=$HOST $DEP_OPTS\n+  fi\n \n-if [ -n \"$OSX_SDK\" ] && [ ! -f depends/sdk-sources/MacOSX${OSX_SDK}.sdk.tar.gz ]; then\n-  curl --location --fail $SDK_URL/MacOSX${OSX_SDK}.sdk.tar.gz -o depends/sdk-sources/MacOSX${OSX_SDK}.sdk.tar.gz\n-fi\n-if [ -n \"$OSX_SDK\" ] && [ -f depends/sdk-sources/MacOSX${OSX_SDK}.sdk.tar.gz ]; then\n-  tar -C depends/SDKs -xf depends/sdk-sources/MacOSX${OSX_SDK}.sdk.tar.gz\n-fi\n-if [[ $HOST = *-mingw32 ]]; then\n-  DOCKER_EXEC update-alternatives --set $HOST-g++ \\$\\(which $HOST-g++-posix\\)\n-fi\n-if [ -z \"$NO_DEPENDS\" ]; then\n-  DOCKER_EXEC CONFIG_SHELL= make $MAKEJOBS -C depends HOST=$HOST $DEP_OPTS\n fi"
      },
      {
        "sha": "c4dc22bdd8e7e7e026fba6defae1056d1e4a711e",
        "filename": "ci/test/06_script_a.sh",
        "status": "modified",
        "additions": 8,
        "deletions": 0,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1f6c650c99eb94fdd0cbdd528aa3405201de08c2/ci/test/06_script_a.sh",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1f6c650c99eb94fdd0cbdd528aa3405201de08c2/ci/test/06_script_a.sh",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/ci/test/06_script_a.sh?ref=1f6c650c99eb94fdd0cbdd528aa3405201de08c2",
        "patch": "@@ -20,7 +20,11 @@ fi\n END_FOLD\n \n mkdir -p build\n+\n+# Temporarily disable errexit, because Travis macOS fails without error message\n+set +o errexit\n cd build || (echo \"could not enter build directory\"; exit 1)\n+set -o errexit\n \n BEGIN_FOLD configure\n DOCKER_EXEC ../configure --cache-file=config.cache $BITCOIN_CONFIG_ALL $BITCOIN_CONFIG || ( cat config.log && false)\n@@ -30,7 +34,9 @@ BEGIN_FOLD distdir\n DOCKER_EXEC make distdir VERSION=$HOST\n END_FOLD\n \n+set +o errexit\n cd \"bitcoin-$HOST\" || (echo \"could not enter distdir bitcoin-$HOST\"; exit 1)\n+set -o errexit\n \n BEGIN_FOLD configure\n DOCKER_EXEC ./configure --cache-file=../config.cache $BITCOIN_CONFIG_ALL $BITCOIN_CONFIG || ( cat config.log && false)\n@@ -43,4 +49,6 @@ BEGIN_FOLD build\n DOCKER_EXEC make $MAKEJOBS $GOAL || ( echo \"Build failure. Verbose build follows.\" && DOCKER_EXEC make $GOAL V=1 ; false )\n END_FOLD\n \n+set +o errexit\n cd ${BASE_BUILD_DIR} || (echo \"could not enter travis build dir $BASE_BUILD_DIR\"; exit 1)\n+set -o errexit"
      },
      {
        "sha": "048fe06c8426f010fd79f282ced9204ed7884c72",
        "filename": "ci/test/06_script_b.sh",
        "status": "modified",
        "additions": 5,
        "deletions": 0,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1f6c650c99eb94fdd0cbdd528aa3405201de08c2/ci/test/06_script_b.sh",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1f6c650c99eb94fdd0cbdd528aa3405201de08c2/ci/test/06_script_b.sh",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/ci/test/06_script_b.sh?ref=1f6c650c99eb94fdd0cbdd528aa3405201de08c2",
        "patch": "@@ -6,7 +6,10 @@\n \n export LC_ALL=C.UTF-8\n \n+# Temporarily disable errexit, because Travis macOS fails without error message\n+set +o errexit\n cd \"build/bitcoin-$HOST\" || (echo \"could not enter distdir build/bitcoin-$HOST\"; exit 1)\n+set -o errexit\n \n if [ -n \"$QEMU_USER_CMD\" ]; then\n   BEGIN_FOLD wrap-qemu\n@@ -46,4 +49,6 @@ if [ \"$RUN_FUZZ_TESTS\" = \"true\" ]; then\n   END_FOLD\n fi\n \n+set +o errexit\n cd ${BASE_BUILD_DIR} || (echo \"could not enter travis build dir $BASE_BUILD_DIR\"; exit 1)\n+set -o errexit"
      }
    ]
  }
]