DrahtBot,2019-08-13 22:11:36,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#12134](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/12134.html) (Build previous releases and run functional ",https://github.com/bitcoin/bitcoin/pull/16597#issuecomment-521028699,521028699,
emilengler,2019-08-13 23:17:27,"Are there travis tests which can proof it? Like your fork?\nBut I generally like this idea as the current situation with tuxes on the side is a bit confusing",https://github.com/bitcoin/bitcoin/pull/16597#issuecomment-521044297,521044297,
fanquake,2019-08-14 03:46:27,Concept ACK. Will take a look at the base PR first.,https://github.com/bitcoin/bitcoin/pull/16597#issuecomment-521090978,521090978,
Sjors,2019-08-14 08:21:24,Travis is ignoring this PR and my branch atm.,https://github.com/bitcoin/bitcoin/pull/16597#issuecomment-521150734,521150734,
emilengler,2019-08-14 17:58:09,Can you enable travis for your forked repository?,https://github.com/bitcoin/bitcoin/pull/16597#issuecomment-521352416,521352416,
Sjors,2019-08-15 10:45:43,"@emilengler I tried that, but it wasn't building there either. I'll wait until the previous PR is merged and then try again.",https://github.com/bitcoin/bitcoin/pull/16597#issuecomment-521599566,521599566,
emilengler,2019-08-15 14:43:39,"@Sjors Ok I will fork your repository, then remove it from the parent and try to enable travis then",https://github.com/bitcoin/bitcoin/pull/16597#issuecomment-521666629,521666629,
emilengler,2019-08-15 15:34:24,"@Sjors Doesn't work, take a look [https://travis-ci.org/emilengler/bitcoin-sjors-test/requests](here).\nI also forked your [repo](https://github.com/emilengler/bitcoin-sjors-test) here as a playgroud, I also invited you for commit access, will delete it once it is done.",https://github.com/bitcoin/bitcoin/pull/16597#issuecomment-521685739,521685739,
Sjors,2019-10-13 11:50:14,"5ea77cd56d [failed](https://travis-ci.org/bitcoin/bitcoin/jobs/597230378) at `travis_fold:end:autogen` without any error. I added a check for OSX in order to run `./autogen.sh` without `DOCKER_EXEC`; who knows...\n\n_Update:_ no luck, trying some other things. Apparently sometimes `set -o errexit` can cause Travis to exit [before the log is updated](https://travis-ci.community/t/build-fails-with",https://github.com/bitcoin/bitcoin/pull/16597#issuecomment-541411806,541411806,
Sjors,2019-10-14 06:55:17,"Travis macOS passed! I added `pip install zmq` for the functional ZMQ tests...\n\n`pyenv` was causing more headaches than it solved. There doesn't appear to be any `language: python python: '3.x'. packages available, so I'm installing via homebrew instead.",https://github.com/bitcoin/bitcoin/pull/16597#issuecomment-541523460,541523460,
MarcoFalke,2019-10-15 15:59:37,re-ACK 1f6c650c99eb94fdd0cbdd528aa3405201de08c2,https://github.com/bitcoin/bitcoin/pull/16597#issuecomment-542284932,542284932,
fanquake,2019-08-14 03:45:57,Should this be `3.5.6` to match our [minimum supported Python](https://github.com/bitcoin/bitcoin/blob/master/.python-version)?,https://github.com/bitcoin/bitcoin/pull/16597#discussion_r313694170,313694170,.travis.yml
MarcoFalke,2019-10-09 19:02:59,why is this changed?,https://github.com/bitcoin/bitcoin/pull/16597#discussion_r333182092,333182092,ci/test/00_setup_env_mac.sh
MarcoFalke,2019-10-09 19:03:02,"\n\n```suggestion\n    ${CI_RETRY_EXE} brew install $PACKAGES\n```",https://github.com/bitcoin/bitcoin/pull/16597#discussion_r333182121,333182121,ci/test/04_install.sh
Sjors,2019-10-09 19:21:06,By accident. Fixed. This PR is still very rough; I can pick it up again now that #13728 is merged.,https://github.com/bitcoin/bitcoin/pull/16597#discussion_r333189535,333189535,ci/test/00_setup_env_mac.sh
MarcoFalke,2019-10-10 19:19:45,should move this below the LC_ALL line,https://github.com/bitcoin/bitcoin/pull/16597#discussion_r333693457,333693457,ci/test/04_install.sh
MarcoFalke,2019-10-10 20:46:53,"```suggestion\n      # https://docs.travis-ci.com/user/reference/osx/#macos-version\n```",https://github.com/bitcoin/bitcoin/pull/16597#discussion_r333727754,333727754,.travis.yml
MarcoFalke,2019-10-10 20:48:27,"This config doesn't boot (even after waiting an hour)\n\nMaybe you need to install python via `brew upgrade python`?",https://github.com/bitcoin/bitcoin/pull/16597#discussion_r333728408,333728408,.travis.yml
Sjors,2019-10-11 11:24:06,Trying with `pyenv install 3.5.6`,https://github.com/bitcoin/bitcoin/pull/16597#discussion_r333944672,333944672,.travis.yml
Sjors,2019-10-11 11:57:12,That doesn't seem to boot either.,https://github.com/bitcoin/bitcoin/pull/16597#discussion_r333955200,333955200,.travis.yml
MarcoFalke,2019-10-11 12:32:28,"In def61133e18a4487af1c9406ffa3f6bf19b702fd I removed both of these and it fails with:\n\nhttps://travis-ci.org/bitcoin/bitcoin/jobs/596568166",https://github.com/bitcoin/bitcoin/pull/16597#discussion_r333967270,333967270,.travis.yml
MarcoFalke,2019-10-11 13:29:05,"```\nWarning: automake 1.16.1_1 is already installed and up-to-date\n\nTo reinstall 1.16.1_1, run `brew reinstall automake`\n\nWarning: berkeley-db@4 4.8.30 is already installed and up-to-date\n\nTo reinstall 4.8.30, run `brew reinstall berkeley-db@4`\n\nWarning: libtool 2.4.6_1 is already installed and up-to-date\n\nTo reinstall 2.4.6_1, run `brew reinstall libtool`\n\nWarning: boost",https://github.com/bitcoin/bitcoin/pull/16597#discussion_r333990888,333990888,.travis.yml
Sjors,2019-10-13 08:40:12,"Oh boy, Homebrew is a pain. I lifted some stuff from:\nhttps://discourse.brew.sh/t/best-practice-for-homebrew-on-travis-brew-update-is-5min-to-build-time/5215/11 and https://github.com/vadi2/Mudlet/blob/857d1ae29fe6e55f1507399200c45db318b28ae6/CI/travis.osx.install.sh#L11-L35",https://github.com/bitcoin/bitcoin/pull/16597#discussion_r334268527,334268527,.travis.yml
Sjors,2019-10-13 08:47:18,@vadi2 @keneanung let me know if you prefer not to be mentioned as co-authored-by in the commit.,https://github.com/bitcoin/bitcoin/pull/16597#discussion_r334268722,334268722,.travis.yml
Sjors,2019-10-13 08:48:45,(assuming we ever get this to work :-),https://github.com/bitcoin/bitcoin/pull/16597#discussion_r334268772,334268772,.travis.yml
vadi2,2019-10-13 09:08:02,It's fine! Let us know if we can help you out with this.,https://github.com/bitcoin/bitcoin/pull/16597#discussion_r334269436,334269436,.travis.yml
fanquake,2019-10-13 13:40:11,No reason to install `protobuf` if we're not enabling BIP70.,https://github.com/bitcoin/bitcoin/pull/16597#discussion_r334278460,334278460,ci/test/00_setup_env_mac_functional.sh
fanquake,2019-10-13 13:57:22,"Even thought it'll be unused, could add `NO_DEPENDS=1` here to make it clear that we aren't actually using depends.",https://github.com/bitcoin/bitcoin/pull/16597#discussion_r334279015,334279015,ci/test/00_setup_env_mac_functional.sh
Sjors,2019-10-13 14:25:17,"Dropped (in other branch, will push later)",https://github.com/bitcoin/bitcoin/pull/16597#discussion_r334279999,334279999,ci/test/00_setup_env_mac_functional.sh
luke-jr,2019-10-13 16:42:09,"If we're building/testing only once natively, we should enable everything...",https://github.com/bitcoin/bitcoin/pull/16597#discussion_r334285534,334285534,ci/test/00_setup_env_mac_functional.sh
keneanung,2019-10-13 17:48:17,"I'm good with this as well. As Vadim said, let us know if we can be of help.",https://github.com/bitcoin/bitcoin/pull/16597#discussion_r334288170,334288170,.travis.yml
Sjors,2019-10-13 20:19:49,Thanks! I could use some help with _update 7_ below. ,https://github.com/bitcoin/bitcoin/pull/16597#discussion_r334294928,334294928,.travis.yml
Sjors,2019-10-13 20:21:37,I added it back and enabled BIP70 in the build.,https://github.com/bitcoin/bitcoin/pull/16597#discussion_r334294986,334294986,ci/test/00_setup_env_mac_functional.sh
MarcoFalke,2019-10-14 12:30:32,I'd prefer if you set `RUN_CI_ON_HOST=1` in the env file or travis.yml,https://github.com/bitcoin/bitcoin/pull/16597#discussion_r334457533,334457533,ci/test/04_install.sh
MarcoFalke,2019-10-14 12:33:17,"homebrew :man_facepalming: \n\n\nThis can't be written shorter, right?",https://github.com/bitcoin/bitcoin/pull/16597#discussion_r334458594,334458594,ci/test/04_install.sh
Sjors,2019-10-14 14:00:15,"Probably, but I'm no bash-master. Homebrew doesn't have a ""install or update if possible, don't complain otherwise"" feature, because ... reason.",https://github.com/bitcoin/bitcoin/pull/16597#discussion_r334496800,334496800,ci/test/04_install.sh
fanquake,2019-10-14 14:05:35,Could you just run `brew update` then `brew install package-name --force` for each package you're trying to install?,https://github.com/bitcoin/bitcoin/pull/16597#discussion_r334499215,334499215,ci/test/04_install.sh
Sjors,2019-10-14 16:09:39,"Reinstalling these packages at every Travis run seems very slow:\n```\n-f, --force\n              Remove a previously cached version and re-fetch.\n```\n\nI shortened it a bit; we don't really care if `brew upgrade` fails, and we can use `CI_RETRY_EXE` for install.",https://github.com/bitcoin/bitcoin/pull/16597#discussion_r334556487,334556487,ci/test/04_install.sh
MarcoFalke,2019-10-14 17:05:08,"I'd be fine with a solution that works, but isn't the fastest. We can optimize for speed in a follow up pull request.",https://github.com/bitcoin/bitcoin/pull/16597#discussion_r334577515,334577515,ci/test/04_install.sh
MarcoFalke,2019-10-14 17:11:35,Why is the linter modified?,https://github.com/bitcoin/bitcoin/pull/16597#discussion_r334579807,334579807,ci/lint/04_install.sh
Sjors,2019-10-14 18:47:41,"Oops, wrong one.",https://github.com/bitcoin/bitcoin/pull/16597#discussion_r334616180,334616180,ci/lint/04_install.sh
Sjors,2019-10-14 18:58:48,"@MarcoFalke `brew update` blew up on a previous run (can't find it anymore) and recommended these two lines to ""fix"" it. ",https://github.com/bitcoin/bitcoin/pull/16597#discussion_r334620157,334620157,ci/test/04_install.sh
Sjors,2019-10-14 18:59:46,It might be worth rebasing the PR for a while to see if any other surprises show up.,https://github.com/bitcoin/bitcoin/pull/16597#discussion_r334620452,334620452,ci/test/04_install.sh
Sjors,2019-10-14 19:17:19,This is where your sanity gives in...,https://github.com/bitcoin/bitcoin/pull/16597#discussion_r334626194,334626194,ci/test/06_script_b.sh
keneanung,2019-10-14 23:30:06,"Hm. I'm unsure whether we had this error... And since we don't use this deep caching anymore, we don't have any further experience in this dark corner of homebrew :ghost: ",https://github.com/bitcoin/bitcoin/pull/16597#discussion_r334699987,334699987,.travis.yml
MarcoFalke,2019-10-15 16:00:08,What happens if you remove this?,https://github.com/bitcoin/bitcoin/pull/16597#discussion_r335041816,335041816,ci/test/04_install.sh
Sjors,2019-10-15 16:56:52,Nothing initially because the brew cache is in a good state. But at some random other moment homebrew will be in a bad state and you'll need this.,https://github.com/bitcoin/bitcoin/pull/16597#discussion_r335068874,335068874,ci/test/04_install.sh
MarcoFalke,2019-10-16 13:05:07,"Is this still needed?\n\nThe whole process takes 2 min without it: https://travis-ci.org/bitcoin/bitcoin/jobs/597848502#L100",https://github.com/bitcoin/bitcoin/pull/16597#discussion_r335461553,335461553,.travis.yml
ryanofsky,2019-10-17 14:51:06,"The cd command succeeds and returns an error code? I guess this is calling some travis-wrapped `cd` alias rather than the actual cd command? Could debug with `type cd`. If a workaround is necessary, it would seem nicer to wrap the workaround in a `safe_cd` function than repeat this errexit stuff different places.",https://github.com/bitcoin/bitcoin/pull/16597#discussion_r336052676,336052676,ci/test/06_script_a.sh
ryanofsky,2019-10-17 15:01:55,Maybe should add a comment explaining this check. I'm confused about why all of this is skipped on osx. Does the depends build not work there? It would seem cleaner to use NO_DEPENDS variable to skip depends steps than to tie the decision to the travis operating system name.,https://github.com/bitcoin/bitcoin/pull/16597#discussion_r336059418,336059418,ci/test/05_before_script.sh
MarcoFalke,2019-10-17 15:31:42,Thanks for the review @ryanofsky . This check looks indeed redundant. Removed in #17176,https://github.com/bitcoin/bitcoin/pull/16597#discussion_r336076998,336076998,ci/test/05_before_script.sh
MarcoFalke,2019-10-17 15:35:03,Filed as good first issue. See #17178,https://github.com/bitcoin/bitcoin/pull/16597#discussion_r336078845,336078845,ci/test/06_script_a.sh
Sjors,2019-10-17 17:15:15,"I don't know if it builds up any cruft over time, but if time doesn't creep up, then we can drop this.",https://github.com/bitcoin/bitcoin/pull/16597#discussion_r336126745,336126745,.travis.yml
MarcoFalke,2019-10-17 17:41:17,"Well it is commented out already, so I removed it in #17176 ",https://github.com/bitcoin/bitcoin/pull/16597#discussion_r336138105,336138105,.travis.yml
