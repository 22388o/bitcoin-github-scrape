TheBlueMatt,2017-11-03T21:58:35Z,"It looks like openssl removed the threading stuff out from under us - we should proabbly do something like check OPENSSL_THREADS (ie if openssl was built with threading support - can we also do this at runtime?) and fail to build/run if it wasn't, only setting the locking callbacks if the openssl version is low enough that they are needed.",https://github.com/bitcoin/bitcoin/pull/11602#issuecomment-341837549,341837549,
laanwj,2017-11-06T10:42:22Z,"> It looks like openssl removed the threading stuff out from under us\n\nWhat I don't understand is why this doesn't fail because it still calls `CRYPTO_set_locking_callback`? If they removed the threading stuff and associated flags why not that?\n\n> can we also do this at runtime?\n\nMaybe - though even checking the OpenSSL version at runtime isn't straightforward. E.g. there used to be a ",https://github.com/bitcoin/bitcoin/pull/11602#issuecomment-342111099,342111099,
TheBlueMatt,2017-11-06T13:34:43Z,"> What I don't understand is why this doesn't fail because it still callsÂ CRYPTO_set_locking_callback?\n\nThe functions themselves were kept, except they are now just #defines to nothing, the constant was removed.\n\nI am somewhat concerned that the current code may break if OpenSSL is complied without threading support, though I'd hope that's rather rare in any case.\n\nOn November 6, 2017 5:42:2",https://github.com/bitcoin/bitcoin/pull/11602#issuecomment-342149848,342149848,
laanwj,2017-11-07T07:44:18Z,"> I am somewhat concerned that the current code may break if OpenSSL is complied without threading support, though I'd hope that's rather rare in any case.\n\nI had hoped that the thread-related functions would be missing from the library in that case, causing either compilation error or a runtime error in the dynamic linker. \n(one'd hope they don't #define them away in the case of no thread s",https://github.com/bitcoin/bitcoin/pull/11602#issuecomment-342400998,342400998,
laanwj,2017-11-08T07:41:44Z,"In any case this can't be merged as-is. It breaks the tests, and breaks compatibility with older OpenSSL. At the least it needs `#if` to delimit the OpenSSL versions where it is needed versus not needed.",https://github.com/bitcoin/bitcoin/pull/11602#issuecomment-342735803,342735803,
azavalla,2017-11-09T00:33:03Z,"They removed the thread-related functions and then `#define`d them again as `no-ops`.\nThis means that:\n- Everything will work just fine for a openssl version low enough.\n- Compilation will fail for the openssl versions where they removed those functions.\n- Possibly obscure race conditions at run time for openssl versions with the `no-op` defines?\n\nIs that correct?",https://github.com/bitcoin/bitcoin/pull/11602#issuecomment-343008480,343008480,
laanwj,2017-11-30T11:02:25Z,Ping @azavalla,https://github.com/bitcoin/bitcoin/pull/11602#issuecomment-348155973,348155973,
laanwj,2017-12-07T12:53:15Z,"Closing due to inactivity, added ""up for grabs"" label, in case anyone else wants to have a go at this.\n(or let me know when you want to pick this back up)",https://github.com/bitcoin/bitcoin/pull/11602#issuecomment-349958539,349958539,
adamjonas,2019-10-18T20:37:29Z,Can remove up for grabs label now that #11601 is closed.,https://github.com/bitcoin/bitcoin/pull/11602#issuecomment-543932701,543932701,
laanwj,2017-11-09T11:38:06Z,"Does the removal of CRYPTO_LOCK here have any influence on older versions of OpenSSL which need this? (as this was a bit field, it may now inadvertently trigger)\nMight be better to add the define here, if it's not defined.",https://github.com/bitcoin/bitcoin/pull/11602#discussion_r149938189,149938189,src/util.cpp
laanwj,2017-11-09T11:38:42Z,We'd still want to call this function for versions of OpenSSL that need it.,https://github.com/bitcoin/bitcoin/pull/11602#discussion_r149938288,149938288,src/util.cpp
