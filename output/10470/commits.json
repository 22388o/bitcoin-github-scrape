[
  {
    "sha": "593b66dce666f67f1b61ac5ba0499c445531fe6d",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1OTNiNjZkY2U2NjZmNjdmMWI2MWFjNWJhMDQ5OWM0NDU1MzFmZTZk",
    "commit": {
      "author": {
        "name": "Michael Chrostowski",
        "email": "michael.chrostowski@gmail.com",
        "date": "2017-05-27T19:45:54Z"
      },
      "committer": {
        "name": "Michael Chrostowski",
        "email": "michael.chrostowski@gmail.com",
        "date": "2017-05-27T19:45:54Z"
      },
      "message": "Refactor in preparation for additional tests.",
      "tree": {
        "sha": "482342a5216cbb01dc7516d502f3680fa7b98159",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/482342a5216cbb01dc7516d502f3680fa7b98159"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/593b66dce666f67f1b61ac5ba0499c445531fe6d",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/593b66dce666f67f1b61ac5ba0499c445531fe6d",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/593b66dce666f67f1b61ac5ba0499c445531fe6d",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/593b66dce666f67f1b61ac5ba0499c445531fe6d/comments",
    "author": {
      "login": "mchrostowski",
      "id": 19847568,
      "node_id": "MDQ6VXNlcjE5ODQ3NTY4",
      "avatar_url": "https://avatars.githubusercontent.com/u/19847568?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mchrostowski",
      "html_url": "https://github.com/mchrostowski",
      "followers_url": "https://api.github.com/users/mchrostowski/followers",
      "following_url": "https://api.github.com/users/mchrostowski/following{/other_user}",
      "gists_url": "https://api.github.com/users/mchrostowski/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mchrostowski/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mchrostowski/subscriptions",
      "organizations_url": "https://api.github.com/users/mchrostowski/orgs",
      "repos_url": "https://api.github.com/users/mchrostowski/repos",
      "events_url": "https://api.github.com/users/mchrostowski/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mchrostowski/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "mchrostowski",
      "id": 19847568,
      "node_id": "MDQ6VXNlcjE5ODQ3NTY4",
      "avatar_url": "https://avatars.githubusercontent.com/u/19847568?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mchrostowski",
      "html_url": "https://github.com/mchrostowski",
      "followers_url": "https://api.github.com/users/mchrostowski/followers",
      "following_url": "https://api.github.com/users/mchrostowski/following{/other_user}",
      "gists_url": "https://api.github.com/users/mchrostowski/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mchrostowski/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mchrostowski/subscriptions",
      "organizations_url": "https://api.github.com/users/mchrostowski/orgs",
      "repos_url": "https://api.github.com/users/mchrostowski/repos",
      "events_url": "https://api.github.com/users/mchrostowski/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mchrostowski/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "b4b057a3e0712dd16b50cbcfe7d613e4413ffa1c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b4b057a3e0712dd16b50cbcfe7d613e4413ffa1c",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/b4b057a3e0712dd16b50cbcfe7d613e4413ffa1c"
      }
    ],
    "stats": {
      "total": 3,
      "additions": 3,
      "deletions": 0
    },
    "files": [
      {
        "sha": "6e7ca705886e8a95eed48fddfce9f7273a64c98f",
        "filename": "test/functional/listsinceblock.py",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/593b66dce666f67f1b61ac5ba0499c445531fe6d/test/functional/listsinceblock.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/593b66dce666f67f1b61ac5ba0499c445531fe6d/test/functional/listsinceblock.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/listsinceblock.py?ref=593b66dce666f67f1b61ac5ba0499c445531fe6d",
        "patch": "@@ -15,6 +15,9 @@ def __init__(self):\n         self.num_nodes = 4\n \n     def run_test (self):\n+        self.list_since_reorg()\n+\n+    def list_since_reorg (self):\n         '''\n         `listsinceblock` did not behave correctly when handed a block that was\n         no longer in the main chain:"
      }
    ]
  },
  {
    "sha": "9389d333385754ba6c46a41d2acca6b537162f4e",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5Mzg5ZDMzMzM4NTc1NGJhNmM0NmE0MWQyYWNjYTZiNTM3MTYyZjRl",
    "commit": {
      "author": {
        "name": "Michael Chrostowski",
        "email": "michael.chrostowski@gmail.com",
        "date": "2017-05-27T20:27:13Z"
      },
      "committer": {
        "name": "Michael Chrostowski",
        "email": "michael.chrostowski@gmail.com",
        "date": "2017-05-27T20:51:52Z"
      },
      "message": "Added test for issue 8752.\n\nTests that conflicted transactions are not returned by calls\nto listsinceblock that filter out the confirmed transaction\nwith which they are conflicted.",
      "tree": {
        "sha": "73af870a1535a017c156335e81e0b33e3dc65968",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/73af870a1535a017c156335e81e0b33e3dc65968"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9389d333385754ba6c46a41d2acca6b537162f4e",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9389d333385754ba6c46a41d2acca6b537162f4e",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/9389d333385754ba6c46a41d2acca6b537162f4e",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9389d333385754ba6c46a41d2acca6b537162f4e/comments",
    "author": {
      "login": "mchrostowski",
      "id": 19847568,
      "node_id": "MDQ6VXNlcjE5ODQ3NTY4",
      "avatar_url": "https://avatars.githubusercontent.com/u/19847568?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mchrostowski",
      "html_url": "https://github.com/mchrostowski",
      "followers_url": "https://api.github.com/users/mchrostowski/followers",
      "following_url": "https://api.github.com/users/mchrostowski/following{/other_user}",
      "gists_url": "https://api.github.com/users/mchrostowski/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mchrostowski/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mchrostowski/subscriptions",
      "organizations_url": "https://api.github.com/users/mchrostowski/orgs",
      "repos_url": "https://api.github.com/users/mchrostowski/repos",
      "events_url": "https://api.github.com/users/mchrostowski/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mchrostowski/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "mchrostowski",
      "id": 19847568,
      "node_id": "MDQ6VXNlcjE5ODQ3NTY4",
      "avatar_url": "https://avatars.githubusercontent.com/u/19847568?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mchrostowski",
      "html_url": "https://github.com/mchrostowski",
      "followers_url": "https://api.github.com/users/mchrostowski/followers",
      "following_url": "https://api.github.com/users/mchrostowski/following{/other_user}",
      "gists_url": "https://api.github.com/users/mchrostowski/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mchrostowski/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mchrostowski/subscriptions",
      "organizations_url": "https://api.github.com/users/mchrostowski/orgs",
      "repos_url": "https://api.github.com/users/mchrostowski/repos",
      "events_url": "https://api.github.com/users/mchrostowski/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mchrostowski/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "593b66dce666f67f1b61ac5ba0499c445531fe6d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/593b66dce666f67f1b61ac5ba0499c445531fe6d",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/593b66dce666f67f1b61ac5ba0499c445531fe6d"
      }
    ],
    "stats": {
      "total": 53,
      "additions": 52,
      "deletions": 1
    },
    "files": [
      {
        "sha": "3b8f78b508588ffedde839af42d626a46d339690",
        "filename": "test/functional/listsinceblock.py",
        "status": "modified",
        "additions": 52,
        "deletions": 1,
        "changes": 53,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9389d333385754ba6c46a41d2acca6b537162f4e/test/functional/listsinceblock.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9389d333385754ba6c46a41d2acca6b537162f4e/test/functional/listsinceblock.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/listsinceblock.py?ref=9389d333385754ba6c46a41d2acca6b537162f4e",
        "patch": "@@ -5,7 +5,11 @@\n \"\"\"Test the listsincelast RPC.\"\"\"\n \n from test_framework.test_framework import BitcoinTestFramework\n-from test_framework.util import assert_equal\n+from decimal import Decimal\n+from test_framework.util import assert_equal, start_nodes, sync_mempools\n+\n+# Sequence number that is BIP 125 opt-in and BIP 68-compliant\n+BIP125_SEQUENCE_NUMBER = 0xfffffffd\n \n class ListSinceBlockTest (BitcoinTestFramework):\n \n@@ -16,6 +20,7 @@ def __init__(self):\n \n     def run_test (self):\n         self.list_since_reorg()\n+        self.double_spends_filtered()\n \n     def list_since_reorg (self):\n         '''\n@@ -78,5 +83,51 @@ def list_since_reorg (self):\n                 break\n         assert_equal(found, True)\n \n+    def double_spends_filtered(self):\n+        '''\n+        `listsinceblock` was returning conflicted transactions even if they \n+        occurred before the specified cutoff blockhash\n+        '''\n+        spending_node = self.nodes[2];\n+        dest_address = spending_node.getnewaddress()\n+\n+        tx_input = dict(\n+            sequence=BIP125_SEQUENCE_NUMBER, **next(u for u in spending_node.listunspent()))\n+        rawtx = spending_node.createrawtransaction(\n+            [tx_input], {dest_address: tx_input[\"amount\"] - Decimal(\"0.00051000\"),\n+                         spending_node.getrawchangeaddress(): Decimal(\"0.00050000\")})\n+        signedtx = spending_node.signrawtransaction(rawtx)\n+        orig_tx_id = spending_node.sendrawtransaction(signedtx[\"hex\"])\n+        original_tx = spending_node.gettransaction(orig_tx_id)\n+\n+        double_tx = spending_node.bumpfee(orig_tx_id);\n+\n+        # check that both transactions exist\n+        block_hash = spending_node.listsinceblock(\n+            spending_node.getblockhash(spending_node.getblockcount()))\n+        original_found = False;\n+        double_found = False\n+        for tx in block_hash['transactions']:\n+            if tx['txid'] == original_tx['txid']:\n+                original_found = True\n+            if tx['txid'] == double_tx['txid']:\n+                double_found = True\n+        assert_equal(original_found, True)\n+        assert_equal(double_found, True)\n+\n+        lastblockhash = spending_node.generate(6)[5]\n+\n+        # check that neither transaction exists\n+        block_hash = spending_node.listsinceblock(lastblockhash)\n+        original_found = False;\n+        double_found = False\n+        for tx in block_hash['transactions']:\n+            if tx['txid'] == original_tx['txid']:\n+                original_found = True\n+            if tx['txid'] == double_tx['txid']:\n+                double_found = True\n+        assert_equal(original_found, False)\n+        assert_equal(double_found, False)\n+\n if __name__ == '__main__':\n     ListSinceBlockTest().main()"
      }
    ]
  },
  {
    "sha": "df09c3aaca3d261a0679a2fcc04da9ee01fb824a",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpkZjA5YzNhYWNhM2QyNjFhMDY3OWEyZmNjMDRkYTllZTAxZmI4MjRh",
    "commit": {
      "author": {
        "name": "Michael Chrostowski",
        "email": "michael.chrostowski@gmail.com",
        "date": "2017-05-27T20:33:17Z"
      },
      "committer": {
        "name": "Michael Chrostowski",
        "email": "michael.chrostowski@gmail.com",
        "date": "2017-05-27T20:51:59Z"
      },
      "message": "Fixes issue 8752 in listsinceblock RPC.\n\nlistsinceblock now checks that returned transactions are not\nconflicting with any transactions that are filtered out by\nthe given blockhash.",
      "tree": {
        "sha": "22376925e3caa0ca84d78e45801c0e2434d0f8f1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/22376925e3caa0ca84d78e45801c0e2434d0f8f1"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/df09c3aaca3d261a0679a2fcc04da9ee01fb824a",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/df09c3aaca3d261a0679a2fcc04da9ee01fb824a",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/df09c3aaca3d261a0679a2fcc04da9ee01fb824a",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/df09c3aaca3d261a0679a2fcc04da9ee01fb824a/comments",
    "author": {
      "login": "mchrostowski",
      "id": 19847568,
      "node_id": "MDQ6VXNlcjE5ODQ3NTY4",
      "avatar_url": "https://avatars.githubusercontent.com/u/19847568?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mchrostowski",
      "html_url": "https://github.com/mchrostowski",
      "followers_url": "https://api.github.com/users/mchrostowski/followers",
      "following_url": "https://api.github.com/users/mchrostowski/following{/other_user}",
      "gists_url": "https://api.github.com/users/mchrostowski/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mchrostowski/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mchrostowski/subscriptions",
      "organizations_url": "https://api.github.com/users/mchrostowski/orgs",
      "repos_url": "https://api.github.com/users/mchrostowski/repos",
      "events_url": "https://api.github.com/users/mchrostowski/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mchrostowski/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "mchrostowski",
      "id": 19847568,
      "node_id": "MDQ6VXNlcjE5ODQ3NTY4",
      "avatar_url": "https://avatars.githubusercontent.com/u/19847568?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mchrostowski",
      "html_url": "https://github.com/mchrostowski",
      "followers_url": "https://api.github.com/users/mchrostowski/followers",
      "following_url": "https://api.github.com/users/mchrostowski/following{/other_user}",
      "gists_url": "https://api.github.com/users/mchrostowski/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mchrostowski/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mchrostowski/subscriptions",
      "organizations_url": "https://api.github.com/users/mchrostowski/orgs",
      "repos_url": "https://api.github.com/users/mchrostowski/repos",
      "events_url": "https://api.github.com/users/mchrostowski/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mchrostowski/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "9389d333385754ba6c46a41d2acca6b537162f4e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9389d333385754ba6c46a41d2acca6b537162f4e",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/9389d333385754ba6c46a41d2acca6b537162f4e"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 1,
      "deletions": 1
    },
    "files": [
      {
        "sha": "7c73aec07cdf9f0b182b9ec158f3b34e25f66c44",
        "filename": "src/wallet/rpcwallet.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/df09c3aaca3d261a0679a2fcc04da9ee01fb824a/src/wallet/rpcwallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/df09c3aaca3d261a0679a2fcc04da9ee01fb824a/src/wallet/rpcwallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcwallet.cpp?ref=df09c3aaca3d261a0679a2fcc04da9ee01fb824a",
        "patch": "@@ -1772,7 +1772,7 @@ UniValue listsinceblock(const JSONRPCRequest& request)\n     for (const std::pair<uint256, CWalletTx>& pairWtx : pwallet->mapWallet) {\n         CWalletTx tx = pairWtx.second;\n \n-        if (depth == -1 || tx.GetDepthInMainChain() < depth)\n+        if (depth == -1 || abs(tx.GetDepthInMainChain()) < depth)\n             ListTransactions(pwallet, tx, \"*\", 0, true, transactions, filter);\n     }\n "
      }
    ]
  }
]