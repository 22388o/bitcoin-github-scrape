gmaxwell,2017-01-17T23:48:28Z,"Whitelisted peers can still relay transactions for blocksonly, I suspect this would break that. (FWIW I don't like that whitelisting does stuff like that, but its what it does and people depend on it)",https://github.com/bitcoin/bitcoin/pull/9569#issuecomment-273338305,273338305,
pstratem,2017-01-18T16:06:10Z,"The intended behavior is for nodes in blocks only mode to have a mempool\nbecause of whitelisted peers.\n\nNACK\n\nOn Jan 17, 2017 4:48 PM, ""Gregory Maxwell"" <notifications@github.com> wrote:\n\n> Whitelisted peers can still relay transactions for blocksonly, I suspect\n> this would break that.\n>\n> â€”\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email dire",https://github.com/bitcoin/bitcoin/pull/9569#issuecomment-273517910,273517910,
sipa,2017-01-18T16:12:08Z,"Interesting, I was not aware.\n\nHow do we reconcile these things? Someone without whitelisted peers who\nsets -blocksonly will not have a mempool, and can reasonably expect that\nthere won't ne an extra 300 MB added to their dbcache.\n\nEven in cases where whitelisted peers exist, I doubt a full 300 MB (if\n-maxmempool was not changed) will be used in commom cases.\n\nMaybe -blocksonly should jus",https://github.com/bitcoin/bitcoin/pull/9569#issuecomment-273519754,273519754,
jnewbery,2017-01-18T19:03:27Z,"@gmaxwell @pstratem Thank you. I wasn't aware of this behaviour.\n\nAs far as I can tell, this can only happen to a -blocksonly node as follows:\n\n- the node connects to a peer and sends a version message. The 'relay' field is set to FALSE (see  PushNodeVersion() in net_processing.cpp - bitcoin core *always* sets relay to FALSE if -blocksonly is set since the global fRelayTxes = !blocksonly).",https://github.com/bitcoin/bitcoin/pull/9569#issuecomment-273568508,273568508,
pstratem,2017-01-18T23:46:13Z,"Transaction relay to whitelisted peers ignores fRelay\n\nOn Jan 18, 2017 12:03 PM, ""John Newbery"" <notifications@github.com> wrote:\n\n> @gmaxwell <https://github.com/gmaxwell> @pstratem\n> <https://github.com/pstratem> Thank you. I wasn't aware of this behaviour.\n>\n> As far as I can tell, this can only happen to a -blocksonly node as\n> follows:\n>\n>    - the node connects to a peer and sends ",https://github.com/bitcoin/bitcoin/pull/9569#issuecomment-273638503,273638503,
jnewbery,2017-01-19T00:20:38Z,"@pstratem Maybe I'm misunderstanding, but I would expect the only way for transactions to enter the node's mempool is for transactions to be relayed *from* peers. That can't happen if blocksonly is set, unless that peer is violating the relay field in our version message.\n\nOf course, we can send transactions *to* peers. That's true without a mempool, and is unaffected by this PR.\n\nYou seem",https://github.com/bitcoin/bitcoin/pull/9569#issuecomment-273644406,273644406,
theuni,2017-01-19T01:39:16Z,"Somewhat unrelated to the discussion here, but I've been meaning to get rid of the fRelayTxes global for a while. I just hacked this up, and I think it makes reasoning about this much easier: https://github.com/theuni/bitcoin/commit/f1966109d17035b814a03599e5f222825056457a .\n\nIt was done quickly and probably isn't quite right, but I'll clean it up and PR separately if the approach is agreed up",https://github.com/bitcoin/bitcoin/pull/9569#issuecomment-273657351,273657351,
jnewbery,2017-01-19T15:05:09Z,"@theuni I agree that we should get rid of the global to make reasoning easier. I also think we need additional documentation here to make the intended behaviour more explicit (ie that blocksonly doesn't mean only blocks if you have some other setting!).\n\nPlease tag me when you have a PR for the relay/accept transactions split so I can review it. I've had a look at https://github.com/theuni/bit",https://github.com/bitcoin/bitcoin/pull/9569#issuecomment-273799536,273799536,
pstratem,2017-01-21T20:38:21Z,"Nodes in blocks only mode will accept transactions sent to them.\n\nNodes which have whitelisted a blocks only peer will send them transactions.\n\nThe only way to achieve what you want is to dynamically resize the cache\nbased on available memory.\n\nOn Jan 18, 2017 5:20 PM, ""John Newbery"" <notifications@github.com> wrote:\n\n> @pstratem <https://github.com/pstratem> Maybe I'm misunderstanding, b",https://github.com/bitcoin/bitcoin/pull/9569#issuecomment-274286761,274286761,
jnewbery,2017-01-23T18:30:52Z,"> Nodes which have whitelisted a blocks only peer will send them transactions.\n\nI don't think this is true. When a blocksonly node connects to a peer, it sends the version header with the relay field set to false:\n\n```\n   connman.PushMessage(pnode, CNetMsgMaker(INIT_PROTO_VERSION).Make(NetMsgType::VERSION, PROTOCOL_VERSION, (uint64_t)nLocalNodeServices, nTime, addrYou, addrMe,\n        ",https://github.com/bitcoin/bitcoin/pull/9569#issuecomment-274575076,274575076,
sipa,2017-01-23T18:50:04Z,Maybe it's easier to just not add the unused mempool space to the available dbcache when blocksonly is set?,https://github.com/bitcoin/bitcoin/pull/9569#issuecomment-274580542,274580542,
jnewbery,2017-01-23T19:17:00Z,"@sipa - it's certainly true that what you're suggesting is possible. It's the approach that I started with, but changed tack later because it was a far smaller, cleaner code change to simply set mempool size to zero.\n\nI'm happy to revert to my original approach, but at the very least we should understand and document the behaviour that @pstratem is talking about. From my testing and code-readi",https://github.com/bitcoin/bitcoin/pull/9569#issuecomment-274588067,274588067,
jnewbery,2017-01-28T00:46:53Z,"Pinging @pstratem @gmaxwell . Can you help me understand what the use case here, so we can either:\n- document the blocksonly/whitelist behaviour that you're talking about; or\n- move forward with this PR.\n\nThanks!",https://github.com/bitcoin/bitcoin/pull/9569#issuecomment-275812385,275812385,
gmaxwell,2017-01-29T02:54:32Z,"Whitelisting was originally added so that armory user's mandatory Bitcoin nodes would still be able to reliably relay transactions when the armory software, which ignores frelaytxes, behind them wanted the transactions relayed.  I have been told that other commercial custom wallet code depend on this whitelist always relays behavior (which is too bad, because I dislike it and think we never should",https://github.com/bitcoin/bitcoin/pull/9569#issuecomment-275890237,275890237,
laanwj,2017-06-26T11:53:30Z,"Looks like this is stuck/controversial. I think it's a good point that `-blocksonly` is an ""undocumented"" developer-only option, so interaction with other options isn't very important.\nShould we close?",https://github.com/bitcoin/bitcoin/pull/9569#issuecomment-311037918,311037918,
jnewbery,2017-06-26T20:18:30Z,Yes - closing for now. This should be revisited when blocksonly is made a non-debug option.,https://github.com/bitcoin/bitcoin/pull/9569#issuecomment-311169979,311169979,
jnewbery,2019-06-09T15:35:03Z,`-blocksonly` is no longer a hidden option (#15990),https://github.com/bitcoin/bitcoin/pull/9569#issuecomment-500221776,500221776,
