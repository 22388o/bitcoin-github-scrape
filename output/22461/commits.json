[
  {
    "sha": "48bd7d3b7737656052d2c745ed40c7f6670842cf",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0OGJkN2QzYjc3Mzc2NTYwNTJkMmM3NDVlZDQwYzdmNjY3MDg0MmNm",
    "commit": {
      "author": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2021-07-15T16:33:16Z"
      },
      "committer": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2021-07-15T16:33:16Z"
      },
      "message": "Change ScriptPubKeyMan::Upgrade to default to return true\n\nIf a ScriptPubKeyMan does not implement Upgrade, then using upgraewallet\nwill fail unexpectedly. By changing the default to return true, then\nthis error can be avoided. This is still correct because a successful\nupgrade can be that nothing happened.",
      "tree": {
        "sha": "3b3106f8d9afb1ef886399956ae2bbcdae06778f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3b3106f8d9afb1ef886399956ae2bbcdae06778f"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/48bd7d3b7737656052d2c745ed40c7f6670842cf",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/48bd7d3b7737656052d2c745ed40c7f6670842cf",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/48bd7d3b7737656052d2c745ed40c7f6670842cf",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/48bd7d3b7737656052d2c745ed40c7f6670842cf/comments",
    "author": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "a88fa1a555195af6543cdc802e8e1c2e1668dd38",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a88fa1a555195af6543cdc802e8e1c2e1668dd38",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/a88fa1a555195af6543cdc802e8e1c2e1668dd38"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 1,
      "deletions": 1
    },
    "files": [
      {
        "sha": "e329e0cf8fdb697dbe88c69d34fc753a71061cff",
        "filename": "src/wallet/scriptpubkeyman.h",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/48bd7d3b7737656052d2c745ed40c7f6670842cf/src/wallet/scriptpubkeyman.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/48bd7d3b7737656052d2c745ed40c7f6670842cf/src/wallet/scriptpubkeyman.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/scriptpubkeyman.h?ref=48bd7d3b7737656052d2c745ed40c7f6670842cf",
        "patch": "@@ -207,7 +207,7 @@ class ScriptPubKeyMan\n     virtual bool CanGetAddresses(bool internal = false) const { return false; }\n \n     /** Upgrades the wallet to the specified version */\n-    virtual bool Upgrade(int prev_version, int new_version, bilingual_str& error) { return false; }\n+    virtual bool Upgrade(int prev_version, int new_version, bilingual_str& error) { return true; }\n \n     virtual bool HavePrivateKeys() const { return false; }\n "
      }
    ]
  },
  {
    "sha": "5012a7912ee9fa35bc417cb073eebffd85f36c6c",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1MDEyYTc5MTJlZTlmYTM1YmM0MTdjYjA3M2VlYmZmZDg1ZjM2YzZj",
    "commit": {
      "author": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2021-07-15T16:41:27Z"
      },
      "committer": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2021-07-16T19:34:56Z"
      },
      "message": "Test that descriptor wallet upgrade does nothing",
      "tree": {
        "sha": "30c74239158260b1fb0e6d067aa5a9f51a9fa9bc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/30c74239158260b1fb0e6d067aa5a9f51a9fa9bc"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5012a7912ee9fa35bc417cb073eebffd85f36c6c",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5012a7912ee9fa35bc417cb073eebffd85f36c6c",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/5012a7912ee9fa35bc417cb073eebffd85f36c6c",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5012a7912ee9fa35bc417cb073eebffd85f36c6c/comments",
    "author": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "48bd7d3b7737656052d2c745ed40c7f6670842cf",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/48bd7d3b7737656052d2c745ed40c7f6670842cf",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/48bd7d3b7737656052d2c745ed40c7f6670842cf"
      }
    ],
    "stats": {
      "total": 10,
      "additions": 8,
      "deletions": 2
    },
    "files": [
      {
        "sha": "4d34670ea944b53e673f4cdf38d33565485e0b80",
        "filename": "test/functional/wallet_upgradewallet.py",
        "status": "modified",
        "additions": 8,
        "deletions": 2,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5012a7912ee9fa35bc417cb073eebffd85f36c6c/test/functional/wallet_upgradewallet.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5012a7912ee9fa35bc417cb073eebffd85f36c6c/test/functional/wallet_upgradewallet.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/wallet_upgradewallet.py?ref=5012a7912ee9fa35bc417cb073eebffd85f36c6c",
        "patch": "@@ -94,10 +94,11 @@ def dumb_sync_blocks(self):\n     def test_upgradewallet(self, wallet, previous_version, requested_version=None, expected_version=None):\n         unchanged = expected_version == previous_version\n         new_version = previous_version if unchanged else expected_version if expected_version else requested_version\n-        assert_equal(wallet.getwalletinfo()[\"walletversion\"], previous_version)\n+        old_wallet_info = wallet.getwalletinfo()\n+        assert_equal(old_wallet_info[\"walletversion\"], previous_version)\n         assert_equal(wallet.upgradewallet(requested_version),\n             {\n-                \"wallet_name\": \"\",\n+                \"wallet_name\": old_wallet_info[\"walletname\"],\n                 \"previous_version\": previous_version,\n                 \"current_version\": new_version,\n                 \"result\": \"Already at latest version. Wallet version unchanged.\" if unchanged else \"Wallet upgraded successfully from version {} to version {}.\".format(previous_version, new_version),\n@@ -352,6 +353,11 @@ def copy_split_hd():\n         v16_3_kvs = dump_bdb_kv(v16_3_wallet)\n         assert b'\\x0adefaultkey' not in v16_3_kvs\n \n+        if self.is_sqlite_compiled():\n+            self.log.info(\"Checking that descriptor wallets do nothing, successfully\")\n+            self.nodes[0].createwallet(wallet_name=\"desc_upgrade\", descriptors=True)\n+            desc_wallet = self.nodes[0].get_wallet_rpc(\"desc_upgrade\")\n+            self.test_upgradewallet(desc_wallet, previous_version=169900, expected_version=169900)\n \n if __name__ == '__main__':\n     UpgradeWalletTest().main()"
      }
    ]
  }
]