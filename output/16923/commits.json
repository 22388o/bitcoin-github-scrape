[
  {
    "sha": "ee9e88ba2734b81d0ffe23fd45c4f69a970c6494",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzplZTllODhiYTI3MzRiODFkMGZmZTIzZmQ0NWM0ZjY5YTk3MGM2NDk0",
    "commit": {
      "author": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2020-03-28T02:14:08Z"
      },
      "committer": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2020-03-31T13:23:43Z"
      },
      "message": "wallet: Handle duplicate fileid exception",
      "tree": {
        "sha": "affa697c956cbb96973091937b68e80995b04930",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/affa697c956cbb96973091937b68e80995b04930"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ee9e88ba2734b81d0ffe23fd45c4f69a970c6494",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ee9e88ba2734b81d0ffe23fd45c4f69a970c6494",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/ee9e88ba2734b81d0ffe23fd45c4f69a970c6494",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ee9e88ba2734b81d0ffe23fd45c4f69a970c6494/comments",
    "author": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "9a2b5f22c1f603a6e3abc16dbf074c8d33a8d01f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9a2b5f22c1f603a6e3abc16dbf074c8d33a8d01f",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/9a2b5f22c1f603a6e3abc16dbf074c8d33a8d01f"
      }
    ],
    "stats": {
      "total": 55,
      "additions": 32,
      "deletions": 23
    },
    "files": [
      {
        "sha": "d6e44c7be50fcde2def83ee8a722edf6730ba8ad",
        "filename": "src/wallet/load.cpp",
        "status": "modified",
        "additions": 15,
        "deletions": 11,
        "changes": 26,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/ee9e88ba2734b81d0ffe23fd45c4f69a970c6494/src/wallet/load.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/ee9e88ba2734b81d0ffe23fd45c4f69a970c6494/src/wallet/load.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/load.cpp?ref=ee9e88ba2734b81d0ffe23fd45c4f69a970c6494",
        "patch": "@@ -66,19 +66,23 @@ bool VerifyWallets(interfaces::Chain& chain, const std::vector<std::string>& wal\n \n bool LoadWallets(interfaces::Chain& chain, const std::vector<std::string>& wallet_files)\n {\n-    for (const std::string& walletFile : wallet_files) {\n-        std::string error;\n-        std::vector<std::string> warnings;\n-        std::shared_ptr<CWallet> pwallet = CWallet::CreateWalletFromFile(chain, WalletLocation(walletFile), error, warnings);\n-        if (!warnings.empty()) chain.initWarning(Join(warnings, \"\\n\"));\n-        if (!pwallet) {\n-            chain.initError(error);\n-            return false;\n+    try {\n+        for (const std::string& walletFile : wallet_files) {\n+            std::string error;\n+            std::vector<std::string> warnings;\n+            std::shared_ptr<CWallet> pwallet = CWallet::CreateWalletFromFile(chain, WalletLocation(walletFile), error, warnings);\n+            if (!warnings.empty()) chain.initWarning(Join(warnings, \"\\n\"));\n+            if (!pwallet) {\n+                chain.initError(error);\n+                return false;\n+            }\n+            AddWallet(pwallet);\n         }\n-        AddWallet(pwallet);\n+        return true;\n+    } catch (const std::runtime_error& e) {\n+        chain.initError(e.what());\n+        return false;\n     }\n-\n-    return true;\n }\n \n void StartWallets(CScheduler& scheduler)"
      },
      {
        "sha": "bc9f84a11da4b469c25b880187c5c39d5a595026",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 15,
        "deletions": 10,
        "changes": 25,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/ee9e88ba2734b81d0ffe23fd45c4f69a970c6494/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/ee9e88ba2734b81d0ffe23fd45c4f69a970c6494/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=ee9e88ba2734b81d0ffe23fd45c4f69a970c6494",
        "patch": "@@ -148,19 +148,24 @@ void UnloadWallet(std::shared_ptr<CWallet>&& wallet)\n \n std::shared_ptr<CWallet> LoadWallet(interfaces::Chain& chain, const WalletLocation& location, std::string& error, std::vector<std::string>& warnings)\n {\n-    if (!CWallet::Verify(chain, location, false, error, warnings)) {\n-        error = \"Wallet file verification failed: \" + error;\n-        return nullptr;\n-    }\n+    try {\n+        if (!CWallet::Verify(chain, location, false, error, warnings)) {\n+            error = \"Wallet file verification failed: \" + error;\n+            return nullptr;\n+        }\n \n-    std::shared_ptr<CWallet> wallet = CWallet::CreateWalletFromFile(chain, location, error, warnings);\n-    if (!wallet) {\n-        error = \"Wallet loading failed: \" + error;\n+        std::shared_ptr<CWallet> wallet = CWallet::CreateWalletFromFile(chain, location, error, warnings);\n+        if (!wallet) {\n+            error = \"Wallet loading failed: \" + error;\n+            return nullptr;\n+        }\n+        AddWallet(wallet);\n+        wallet->postInitProcess();\n+        return wallet;\n+    } catch (const std::runtime_error& e) {\n+        error = e.what();\n         return nullptr;\n     }\n-    AddWallet(wallet);\n-    wallet->postInitProcess();\n-    return wallet;\n }\n \n std::shared_ptr<CWallet> LoadWallet(interfaces::Chain& chain, const std::string& name, std::string& error, std::vector<std::string>& warnings)"
      },
      {
        "sha": "a2c502f280c5b34305e4e4ba6a5a1cd806c1b130",
        "filename": "test/functional/wallet_multiwallet.py",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/ee9e88ba2734b81d0ffe23fd45c4f69a970c6494/test/functional/wallet_multiwallet.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/ee9e88ba2734b81d0ffe23fd45c4f69a970c6494/test/functional/wallet_multiwallet.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/wallet_multiwallet.py?ref=ee9e88ba2734b81d0ffe23fd45c4f69a970c6494",
        "patch": "@@ -236,10 +236,10 @@ def wallet_file(name):\n         assert_raises_rpc_error(-4, \"Wallet file verification failed: Error loading wallet wallet.dat. Duplicate -wallet filename specified.\", self.nodes[0].loadwallet, 'wallet.dat')\n \n         # Fail to load if one wallet is a copy of another\n-        assert_raises_rpc_error(-1, \"BerkeleyBatch: Can't open database w8_copy (duplicates fileid\", self.nodes[0].loadwallet, 'w8_copy')\n+        assert_raises_rpc_error(-4, \"BerkeleyBatch: Can't open database w8_copy (duplicates fileid\", self.nodes[0].loadwallet, 'w8_copy')\n \n         # Fail to load if one wallet is a copy of another, test this twice to make sure that we don't re-introduce #14304\n-        assert_raises_rpc_error(-1, \"BerkeleyBatch: Can't open database w8_copy (duplicates fileid\", self.nodes[0].loadwallet, 'w8_copy')\n+        assert_raises_rpc_error(-4, \"BerkeleyBatch: Can't open database w8_copy (duplicates fileid\", self.nodes[0].loadwallet, 'w8_copy')\n \n \n         # Fail to load if wallet file is a symlink"
      }
    ]
  },
  {
    "sha": "9eefc6e92fa1acef6eddd87886ed80510b439a57",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5ZWVmYzZlOTJmYTFhY2VmNmVkZGQ4Nzg4NmVkODA1MTBiNDM5YTU3",
    "commit": {
      "author": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2020-03-30T10:41:20Z"
      },
      "committer": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2020-03-31T13:23:43Z"
      },
      "message": "gui: Delete progress dialog instead of hidding it",
      "tree": {
        "sha": "cd03e4b90d00cd6d42a42020f399a69883fc6e40",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/cd03e4b90d00cd6d42a42020f399a69883fc6e40"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9eefc6e92fa1acef6eddd87886ed80510b439a57",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9eefc6e92fa1acef6eddd87886ed80510b439a57",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/9eefc6e92fa1acef6eddd87886ed80510b439a57",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9eefc6e92fa1acef6eddd87886ed80510b439a57/comments",
    "author": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "ee9e88ba2734b81d0ffe23fd45c4f69a970c6494",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ee9e88ba2734b81d0ffe23fd45c4f69a970c6494",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/ee9e88ba2734b81d0ffe23fd45c4f69a970c6494"
      }
    ],
    "stats": {
      "total": 13,
      "additions": 11,
      "deletions": 2
    },
    "files": [
      {
        "sha": "f076b5ba61977887c4ab8768d5fe0d7feebf4902",
        "filename": "src/qt/walletcontroller.cpp",
        "status": "modified",
        "additions": 10,
        "deletions": 2,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9eefc6e92fa1acef6eddd87886ed80510b439a57/src/qt/walletcontroller.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9eefc6e92fa1acef6eddd87886ed80510b439a57/src/qt/walletcontroller.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/walletcontroller.cpp?ref=9eefc6e92fa1acef6eddd87886ed80510b439a57",
        "patch": "@@ -166,6 +166,7 @@ WalletControllerActivity::~WalletControllerActivity()\n \n void WalletControllerActivity::showProgressDialog(const QString& label_text)\n {\n+    assert(!m_progress_dialog);\n     m_progress_dialog = new QProgressDialog(m_parent_widget);\n \n     m_progress_dialog->setLabelText(label_text);\n@@ -175,6 +176,13 @@ void WalletControllerActivity::showProgressDialog(const QString& label_text)\n     GUIUtil::PolishProgressDialog(m_progress_dialog);\n }\n \n+void WalletControllerActivity::destroyProgressDialog()\n+{\n+    assert(m_progress_dialog);\n+    delete m_progress_dialog;\n+    m_progress_dialog = nullptr;\n+}\n+\n CreateWalletActivity::CreateWalletActivity(WalletController* wallet_controller, QWidget* parent_widget)\n     : WalletControllerActivity(wallet_controller, parent_widget)\n {\n@@ -229,7 +237,7 @@ void CreateWalletActivity::createWallet()\n \n void CreateWalletActivity::finish()\n {\n-    m_progress_dialog->hide();\n+    destroyProgressDialog();\n \n     if (!m_error_message.empty()) {\n         QMessageBox::critical(m_parent_widget, tr(\"Create wallet failed\"), QString::fromStdString(m_error_message));\n@@ -270,7 +278,7 @@ OpenWalletActivity::OpenWalletActivity(WalletController* wallet_controller, QWid\n \n void OpenWalletActivity::finish()\n {\n-    m_progress_dialog->hide();\n+    destroyProgressDialog();\n \n     if (!m_error_message.empty()) {\n         QMessageBox::critical(m_parent_widget, tr(\"Open wallet failed\"), QString::fromStdString(m_error_message));"
      },
      {
        "sha": "f30eb25308181ea6b7d4161327d4a857a89b79ce",
        "filename": "src/qt/walletcontroller.h",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9eefc6e92fa1acef6eddd87886ed80510b439a57/src/qt/walletcontroller.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9eefc6e92fa1acef6eddd87886ed80510b439a57/src/qt/walletcontroller.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/walletcontroller.h?ref=9eefc6e92fa1acef6eddd87886ed80510b439a57",
        "patch": "@@ -96,6 +96,7 @@ class WalletControllerActivity : public QObject\n     QObject* worker() const { return m_wallet_controller->m_activity_worker; }\n \n     void showProgressDialog(const QString& label_text);\n+    void destroyProgressDialog();\n \n     WalletController* const m_wallet_controller;\n     QWidget* const m_parent_widget;"
      }
    ]
  }
]