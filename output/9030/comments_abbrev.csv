TheBlueMatt,2016-10-30T04:04:01Z,"Oops, misread the line.\n\nOn October 28, 2016 11:45:10 PM EDT, R E Broadley notifications@github.com wrote:\n\n> rebroad commented on this pull request.\n> \n> > ```\n> >      vRecv >> resp;\n> > ```\n> -        BlockMap::iterator mi = mapBlockIndex.find(resp.blockhash);\n> -        if (mi == mapBlockIndex.end()) {\n> -            LogPrint(""block"", ""recv blocktxn %s size=%d not recognised\n>   pe",https://github.com/bitcoin/bitcoin/pull/9030#issuecomment-257130823,257130823,
TheBlueMatt,2016-10-30T04:05:04Z,"Yea, you need a LOCK(cs_main).\n\nSee https://en.m.wikipedia.org/wiki/Lock_(computer_science) for more.\n\nOn October 28, 2016 11:46:17 PM EDT, R E Broadley notifications@github.com wrote:\n\n> rebroad commented on this pull request.\n> \n> > ```\n> >      vRecv >> resp;\n> > ```\n> -        BlockMap::iterator mi = mapBlockIndex.find(resp.blockhash);\n> \n> Do you mean I need to add a LOCK(cs_main",https://github.com/bitcoin/bitcoin/pull/9030#issuecomment-257130847,257130847,
rebroad,2016-10-31T07:18:31Z,@TheBlueMatt Thanks. Now moved additions to within the LOCK.\n,https://github.com/bitcoin/bitcoin/pull/9030#issuecomment-257227993,257227993,
sdaftuar,2016-11-01T16:02:12Z,"I don't think there's a situation where this code change would improve the behavior of the node.  It's already the case that if we're not expecting a BLOCKTXN, then we abort processing (in the code just below the code you're adding here).\n\nThis change also further complicates the logic, as if somehow we are in the (unlikely) situation where we received a block, pruned it, and then somehow re-req",https://github.com/bitcoin/bitcoin/pull/9030#issuecomment-257607116,257607116,
TheBlueMatt,2016-10-27T13:21:40Z,This will entirely break downloading of blocks via compact blocks.\n,https://github.com/bitcoin/bitcoin/pull/9030#discussion_r85334580,85334580,src/main.cpp
TheBlueMatt,2016-10-27T13:21:55Z,This needs cs_main\n,https://github.com/bitcoin/bitcoin/pull/9030#discussion_r85334648,85334648,src/main.cpp
rebroad,2016-10-29T03:45:03Z,How so?\n,https://github.com/bitcoin/bitcoin/pull/9030#discussion_r85633123,85633123,src/main.cpp
rebroad,2016-10-29T03:46:10Z,Do you mean I need to add a LOCK(cs_main) before this line? I'm still trying to get my head around locks... what is the risk without obtaining a lock first please?\n,https://github.com/bitcoin/bitcoin/pull/9030#discussion_r85633135,85633135,src/main.cpp
