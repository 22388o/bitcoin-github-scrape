[
  {
    "sha": "2da95545ea42f925dbc7703e42e9356908a8c83e",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyZGE5NTU0NWVhNDJmOTI1ZGJjNzcwM2U0MmU5MzU2OTA4YThjODNl",
    "commit": {
      "author": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2021-05-23T13:27:14Z"
      },
      "committer": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2021-06-14T14:21:22Z"
      },
      "message": "test: Drop excessive locking in CAddrManTest::SimConnFail\n\nThe unit test is single threaded, so there's no need to hold the mutex\nbetween Good() and Attempt().\n\nThis change avoids recursive locking in the CAddrMan::Attempt function.\n\nCo-authored-by: John Newbery <john@johnnewbery.com>",
      "tree": {
        "sha": "db0013e9136a511798612ef61264bf46469108b9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/db0013e9136a511798612ef61264bf46469108b9"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2da95545ea42f925dbc7703e42e9356908a8c83e",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE0dvyxLlvLev0wWZUQQEIES5+qB8FAmDHZeIACgkQQQEIES5+\nqB+eERAArYsl8fIWBAPsvb44x0XtR4DdFbp/YJRaKY+S4aeDZN/ePpW8COjQ1ADw\n0ufyLfQVqCOyEHi2p/lkqiJg8q03DEyCseP3hS9kSbVB6KUl3yGonnuOLnVJjiKF\nB3/YSSe9fbMXaIak4QBkoyDVFa2/XU8DndRG28RJFa73kbNUlqRIs258qclMVuOA\nEUPOGb+2YAaud5iur3/CTqHD4UO6JN4ZRYhbyTpVv2Q8kq36kBuseZA0uO9dRJeM\nnu0Vmu/IPBKNo0tGMlkSxhndfu6IsfnC5yLqUfRrV2mOCM1tvAzJO523dnz1fYf5\ndwd2NkN7QSHvYEStLT3Y8omVT/0KTUvg/YBfxMtn83ElET6YZ5FiguW9mB0GLHm9\nTdjKOEab5x6BPGniBgP0DCdwoONn6e7ZwF5DMTiva95VaQ2I9Xaatlyx5le2n7CC\nJ9vY1KiBkXIGjHCL05UDzBEwg+goZnZY4zaHkq+hWH1kmdBxU4uXlJsuM3X/AceO\nTlqYb7CM1/5+dwLyPoUlTb3cynfwbcveZMpxEYPQE9Z3IARzFz6sPXsG5IoJtc9Q\nuOPy6pb0qv5vKDudV7LUX86/sloFtHbLKv+PcWqZL6/wtN7REaCGwC9WnG6lxTkc\ngh6u+7WXY0EmZ9e/a2MBaBdgx9hIK+WzyLfxuFnHW2j5NUJPyxM=\n=gA83\n-----END PGP SIGNATURE-----",
        "payload": "tree db0013e9136a511798612ef61264bf46469108b9\nparent 5c4f0c4d46f030498c222a15a0399c6e0a7d28f1\nauthor Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1621776434 +0300\ncommitter Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1623680482 +0300\n\ntest: Drop excessive locking in CAddrManTest::SimConnFail\n\nThe unit test is single threaded, so there's no need to hold the mutex\nbetween Good() and Attempt().\n\nThis change avoids recursive locking in the CAddrMan::Attempt function.\n\nCo-authored-by: John Newbery <john@johnnewbery.com>\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2da95545ea42f925dbc7703e42e9356908a8c83e",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/2da95545ea42f925dbc7703e42e9356908a8c83e",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2da95545ea42f925dbc7703e42e9356908a8c83e/comments",
    "author": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "5c4f0c4d46f030498c222a15a0399c6e0a7d28f1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5c4f0c4d46f030498c222a15a0399c6e0a7d28f1",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/5c4f0c4d46f030498c222a15a0399c6e0a7d28f1"
      }
    ],
    "stats": {
      "total": 4,
      "additions": 2,
      "deletions": 2
    },
    "files": [
      {
        "sha": "eb5c37b34dde4284bffb96ce14f369e7e25a7b32",
        "filename": "src/test/addrman_tests.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2da95545ea42f925dbc7703e42e9356908a8c83e/src/test/addrman_tests.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2da95545ea42f925dbc7703e42e9356908a8c83e/src/test/addrman_tests.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/addrman_tests.cpp?ref=2da95545ea42f925dbc7703e42e9356908a8c83e",
        "patch": "@@ -74,9 +74,9 @@ class CAddrManTest : public CAddrMan\n     // Simulates connection failure so that we can test eviction of offline nodes\n     void SimConnFail(const CService& addr)\n     {\n-         LOCK(cs);\n          int64_t nLastSuccess = 1;\n-         Good_(addr, true, nLastSuccess); // Set last good connection in the deep past.\n+         // Set last good connection in the deep past.\n+         Good(addr, true, nLastSuccess);\n \n          bool count_failure = false;\n          int64_t nLastTry = GetAdjustedTime()-61;"
      }
    ]
  },
  {
    "sha": "efc6fac951e75ba913350bb470c3d4e6a4e284b9",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzplZmM2ZmFjOTUxZTc1YmE5MTMzNTBiYjQ3MGMzZDRlNmE0ZTI4NGI5",
    "commit": {
      "author": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2021-05-23T15:54:23Z"
      },
      "committer": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2021-06-14T14:21:28Z"
      },
      "message": "refactor: Avoid recursive locking in CAddrMan::size",
      "tree": {
        "sha": "5102e9b6fb71a60f941a7a0328556e61d3fb5890",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/5102e9b6fb71a60f941a7a0328556e61d3fb5890"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/efc6fac951e75ba913350bb470c3d4e6a4e284b9",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE0dvyxLlvLev0wWZUQQEIES5+qB8FAmDHZegACgkQQQEIES5+\nqB8IIw/+PHimehIF/Y5zZZFC4jRF3eNkqgzM/OmRX9TwBqZsr3h8hxfaDVeqvBCy\ns/8OvJd43avIKo0+UXMVbeuJTqMYNLDURvqOPzAKcWLTStx7uW4otpQN/uFxyUan\nRYpQqYWTcOX3fYkzCoBCCU/eaquoP5AT638tVJma1Q11C+KOaVsYCD4+svoivIGA\nyuUqy8ffL2sFrESv0EMm3xbqhe0LgIVkWU6PPh2oDIMO5nwifUnT4y4BqQyD7Rch\nRZiF3Gi1PEsuwFSHsQs86tGPr36iEMzpSOvT08zZ17gWy2OyVVK9qAFZRC8cCGw+\nhhyQoL6MkFoyeJ9WypX+YS43XQoss/nMbdXhw9zHe6XiJ/qywHAX/q5cLklnTTm2\n0MGfKk3COyW3Ds0nX+OBpv8lAiAyL2hnQ9/7/7D/oMkO93RnzBLERaktHJawybM2\nHFDBfnJE03TAH3nxy01vQnUTwnAJ0eIb5XIqOavMZ5Izzud7/Un4tAudTUGmCPhm\nUacE5lnkhcQcqRC7hfXH+n7CeGqL+ZBw/EMzUH7mZfiOLMvsW7DVE8DXEwfX7Dr0\nsNKmieYD6vMkIKep66xBJW/wQy5/5hhK/PFlztOzrDHmAWvwfQbae7noRH7z8CBu\nURFuRq9ybSGOtImJWyr4P11EJLUciMONaSL3KSel4RKmLsc2otw=\n=w/Gc\n-----END PGP SIGNATURE-----",
        "payload": "tree 5102e9b6fb71a60f941a7a0328556e61d3fb5890\nparent 2da95545ea42f925dbc7703e42e9356908a8c83e\nauthor Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1621785263 +0300\ncommitter Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1623680488 +0300\n\nrefactor: Avoid recursive locking in CAddrMan::size\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/efc6fac951e75ba913350bb470c3d4e6a4e284b9",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/efc6fac951e75ba913350bb470c3d4e6a4e284b9",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/efc6fac951e75ba913350bb470c3d4e6a4e284b9/comments",
    "author": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "2da95545ea42f925dbc7703e42e9356908a8c83e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2da95545ea42f925dbc7703e42e9356908a8c83e",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/2da95545ea42f925dbc7703e42e9356908a8c83e"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 1,
      "deletions": 1
    },
    "files": [
      {
        "sha": "36cd28cc58c6ac40fc5bd312d49cb4fa064a6298",
        "filename": "src/addrman.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/efc6fac951e75ba913350bb470c3d4e6a4e284b9/src/addrman.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/efc6fac951e75ba913350bb470c3d4e6a4e284b9/src/addrman.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrman.cpp?ref=efc6fac951e75ba913350bb470c3d4e6a4e284b9",
        "patch": "@@ -362,7 +362,7 @@ void CAddrMan::Attempt_(const CService& addr, bool fCountFailure, int64_t nTime)\n \n CAddrInfo CAddrMan::Select_(bool newOnly)\n {\n-    if (size() == 0)\n+    if (vRandom.empty())\n         return CAddrInfo();\n \n     if (newOnly && nNew == 0)"
      }
    ]
  },
  {
    "sha": "06703973c758c2c5d0ff916993aa7055f609d2d7",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzowNjcwMzk3M2M3NThjMmM1ZDBmZjkxNjk5M2FhNzA1NWY2MDlkMmQ3",
    "commit": {
      "author": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2021-05-23T16:17:23Z"
      },
      "committer": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2021-06-14T14:28:30Z"
      },
      "message": "Make CAddrMan::Check private\n\nChange in the addrman.h header is move-only.",
      "tree": {
        "sha": "df32b02e1f8a96b257a3af912b5b7c0ddf9af978",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/df32b02e1f8a96b257a3af912b5b7c0ddf9af978"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/06703973c758c2c5d0ff916993aa7055f609d2d7",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE0dvyxLlvLev0wWZUQQEIES5+qB8FAmDHZ44ACgkQQQEIES5+\nqB86fxAAr4pNOTvWMmC5J2k6OwiijPpltm6fFqvWbO9bm5f99NlIimUQCIdmwfkL\nK7VXC/t9pd3ZWzW3s7Ko206TwdBLSwS0tf/B0tEdkJd5LlTTvbhGL9/x1bHcnmPS\nwaW/+WEiWW0ZlfWiL8x7tSzduA1rY9nquuS4IDTusNKd0KhJktHpF3OgT5wJ7hI6\ntMQ3oOCILITGLPP/DqQMYJH5R0/7cn+dLt2AXrHyos4CXwfLhamPDTbM206iMiN8\nmJka3RgiKJWLLcp5kqNwf7OWcn6SmLu2/cMuTBQ/xFujaOGYN80THAui8NpwM9Gg\n/fIyh0sBSTx5fWZP69V5VcgvN0VUAO2J56Xg3Kb8WcpWNtwn6zLPC7o5K/LqVdJW\nSLBcXeJoLjBab80gmGCGw1/uAAVc+/+zSnwZYU1cPDSUQP6SNMAW0KOnRgt4Ebqw\n1Zm42cHDR62tCAgb6LC9a1BuJbbRoY4qE4v8I600cvZyHlISE1o3sLoRdoXVkbNf\nFwR/9KXj8ArRNZJtqrKyCdPhikA8FxJ+ppLViONuLw8bGCqTAl4THfT8mB4oYeBr\nLyfOvg8RZzZ7q5Bnuqef6AF0QlsYZk8bN39VMzJkSznG2z0RZqEPlLWu81kxfG2o\nVzhVm9xSg6LRPa4715xjbvN+r+k2q853H1YQF4Fap+XzpLON7ew=\n=K5e1\n-----END PGP SIGNATURE-----",
        "payload": "tree df32b02e1f8a96b257a3af912b5b7c0ddf9af978\nparent efc6fac951e75ba913350bb470c3d4e6a4e284b9\nauthor Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1621786643 +0300\ncommitter Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1623680910 +0300\n\nMake CAddrMan::Check private\n\nChange in the addrman.h header is move-only.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/06703973c758c2c5d0ff916993aa7055f609d2d7",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/06703973c758c2c5d0ff916993aa7055f609d2d7",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/06703973c758c2c5d0ff916993aa7055f609d2d7/comments",
    "author": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "efc6fac951e75ba913350bb470c3d4e6a4e284b9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/efc6fac951e75ba913350bb470c3d4e6a4e284b9",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/efc6fac951e75ba913350bb470c3d4e6a4e284b9"
      }
    ],
    "stats": {
      "total": 27,
      "additions": 13,
      "deletions": 14
    },
    "files": [
      {
        "sha": "a11dffd0487443750ac387de179a4b527e9c67d6",
        "filename": "src/addrman.h",
        "status": "modified",
        "additions": 13,
        "deletions": 13,
        "changes": 26,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/06703973c758c2c5d0ff916993aa7055f609d2d7/src/addrman.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/06703973c758c2c5d0ff916993aa7055f609d2d7/src/addrman.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrman.h?ref=06703973c758c2c5d0ff916993aa7055f609d2d7",
        "patch": "@@ -492,19 +492,6 @@ class CAddrMan\n         return vRandom.size();\n     }\n \n-    //! Consistency check\n-    void Check()\n-    {\n-#ifdef DEBUG_ADDRMAN\n-        {\n-            LOCK(cs);\n-            int err;\n-            if ((err=Check_()))\n-                LogPrintf(\"ADDRMAN CONSISTENCY CHECK FAILED!!! err=%i\\n\", err);\n-        }\n-#endif\n-    }\n-\n     //! Add a single address.\n     bool Add(const CAddress &addr, const CNetAddr& source, int64_t nTimePenalty = 0)\n     {\n@@ -725,6 +712,19 @@ class CAddrMan\n     //! Return a random to-be-evicted tried table address.\n     CAddrInfo SelectTriedCollision_() EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n+    //! Consistency check\n+    void Check()\n+    {\n+#ifdef DEBUG_ADDRMAN\n+        {\n+            LOCK(cs);\n+            int err;\n+            if ((err=Check_()))\n+                LogPrintf(\"ADDRMAN CONSISTENCY CHECK FAILED!!! err=%i\\n\", err);\n+        }\n+#endif\n+    }\n+\n #ifdef DEBUG_ADDRMAN\n     //! Perform consistency check. Returns an error code or zero.\n     int Check_() EXCLUSIVE_LOCKS_REQUIRED(cs);"
      },
      {
        "sha": "db0b4618730766d1eb0a8993fef743de47194ddf",
        "filename": "src/test/fuzz/addrman.cpp",
        "status": "modified",
        "additions": 0,
        "deletions": 1,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/06703973c758c2c5d0ff916993aa7055f609d2d7/src/test/fuzz/addrman.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/06703973c758c2c5d0ff916993aa7055f609d2d7/src/test/fuzz/addrman.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/fuzz/addrman.cpp?ref=06703973c758c2c5d0ff916993aa7055f609d2d7",
        "patch": "@@ -107,7 +107,6 @@ FUZZ_TARGET_INIT(addrman, initialize_addrman)\n         /* max_addresses */ fuzzed_data_provider.ConsumeIntegralInRange<size_t>(0, 4096),\n         /* max_pct */ fuzzed_data_provider.ConsumeIntegralInRange<size_t>(0, 4096),\n         /* network */ std::nullopt);\n-    (void)/*const_*/addr_man.Check();\n     (void)/*const_*/addr_man.Select(fuzzed_data_provider.ConsumeBool());\n     (void)const_addr_man.size();\n     CDataStream data_stream(SER_NETWORK, PROTOCOL_VERSION);"
      }
    ]
  },
  {
    "sha": "f77d9c79aa41dab4285e95c9432cc6d853be67a3",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmNzdkOWM3OWFhNDFkYWI0Mjg1ZTk1Yzk0MzJjYzZkODUzYmU2N2Ez",
    "commit": {
      "author": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2021-05-23T16:23:28Z"
      },
      "committer": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2021-06-14T14:28:36Z"
      },
      "message": "refactor: Fix CAddrMan::Check style\n\nThis change improves readability, and follows Developer Notes.",
      "tree": {
        "sha": "1ddaa6df9b643fbd2d4a092891957af02f860a42",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1ddaa6df9b643fbd2d4a092891957af02f860a42"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f77d9c79aa41dab4285e95c9432cc6d853be67a3",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE0dvyxLlvLev0wWZUQQEIES5+qB8FAmDHZ5QACgkQQQEIES5+\nqB+Jzg/8DOsWc13rMoUQ/QFLNqGmm0UACFiip294DbmOVfOqZ9tny+uUZGixA7jA\nOz+oxQ4QmBynQmjLOfYvk45jlY8Fqv9BGxCNsDpaLuuETTccYKSwcaHISyD24hmb\nNilMMnra8oCA+sxeIYzicPQ4RYTklYtMU3g5aPXtZcTXDml2IGGDXnEsSBnetMsV\n+KuVYGCcpzOOwCIYUYlM+GIDOo80CHGLJbhJV4ZiiBXsjyMZE+AaCvfNRlZ2zmFO\nhZFQBHdOmyU0Tu4U0sAjWFxmPFcu/SmOnTk55Qi8ow/dQ85B22iAcpaS4K50jNMt\ngrctXEelVZAXlTfKPdmlQvcvN2u3V59hJmqGz2jitwSZy/xBsvf3U33L7KK8d70w\n697aExuAeMTNTUW3dSs1TWgqRSBy4TdiIOB5DrqC6Yp1UsnJIsdangebkXHr3Rje\nxPGaTEDrlWCby4n0Wtk9u/S0VMO1PQ40RmNFnVXQXvfl9c9WIAIacGFTGZoRfuI4\nNWmLDYIZlO13RYl0vX3ltLW0DU7KZfhxe4geMCU4Duug4e2jnP/+LK/t/xy15P0k\nIoTtjhFyueMc7J8z2tiAFRgRJa75Sj/TmmfD2ubdduh/j+hQFe+zYd8+Zb0TxTLp\nfEweadoY8m2/mBDBU1SjmG3ccSi6nJEX0YNFQBb2t2l1ETsM81g=\n=/Lui\n-----END PGP SIGNATURE-----",
        "payload": "tree 1ddaa6df9b643fbd2d4a092891957af02f860a42\nparent 06703973c758c2c5d0ff916993aa7055f609d2d7\nauthor Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1621787008 +0300\ncommitter Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1623680916 +0300\n\nrefactor: Fix CAddrMan::Check style\n\nThis change improves readability, and follows Developer Notes.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f77d9c79aa41dab4285e95c9432cc6d853be67a3",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/f77d9c79aa41dab4285e95c9432cc6d853be67a3",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f77d9c79aa41dab4285e95c9432cc6d853be67a3/comments",
    "author": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "06703973c758c2c5d0ff916993aa7055f609d2d7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/06703973c758c2c5d0ff916993aa7055f609d2d7",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/06703973c758c2c5d0ff916993aa7055f609d2d7"
      }
    ],
    "stats": {
      "total": 9,
      "additions": 4,
      "deletions": 5
    },
    "files": [
      {
        "sha": "600c524bce5a8bd9d9cc023c8e10f8016ceeb64c",
        "filename": "src/addrman.h",
        "status": "modified",
        "additions": 4,
        "deletions": 5,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f77d9c79aa41dab4285e95c9432cc6d853be67a3/src/addrman.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f77d9c79aa41dab4285e95c9432cc6d853be67a3/src/addrman.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrman.h?ref=f77d9c79aa41dab4285e95c9432cc6d853be67a3",
        "patch": "@@ -716,11 +716,10 @@ class CAddrMan\n     void Check()\n     {\n #ifdef DEBUG_ADDRMAN\n-        {\n-            LOCK(cs);\n-            int err;\n-            if ((err=Check_()))\n-                LogPrintf(\"ADDRMAN CONSISTENCY CHECK FAILED!!! err=%i\\n\", err);\n+        LOCK(cs);\n+        const int err = Check_();\n+        if (err) {\n+            LogPrintf(\"ADDRMAN CONSISTENCY CHECK FAILED!!! err=%i\\n\", err);\n         }\n #endif\n     }"
      }
    ]
  },
  {
    "sha": "187b7d2bb36e6de9cd960378021ebe690619a2ef",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxODdiN2QyYmIzNmU2ZGU5Y2Q5NjAzNzgwMjFlYmU2OTA2MTlhMmVm",
    "commit": {
      "author": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2021-05-23T16:32:03Z"
      },
      "committer": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2021-06-14T14:28:37Z"
      },
      "message": "refactor: Avoid recursive locking in CAddrMan::Check",
      "tree": {
        "sha": "a8e42308abeab4f243779915a9ebcb8474fccccc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a8e42308abeab4f243779915a9ebcb8474fccccc"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/187b7d2bb36e6de9cd960378021ebe690619a2ef",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE0dvyxLlvLev0wWZUQQEIES5+qB8FAmDHZ5UACgkQQQEIES5+\nqB8YpBAAjgnWMoI1lJ1uydwbjMQ/DBSxDT3dvUVwojgSt1MlKVVRwiWTw0TkKkIM\nldNtZX45ZAlwPW126YoZ2OfQBg2oJ4QkzmbpWQFsH80/0eATY5g9b831E1HjxCGB\nYFN+s5T4+x5PEAEMiLyahaPSlweibyYVf6WrAUEUJ3dD+u4b+FS77OB8IrxL2a+o\n2KXoupczjb32g3NkH3iZkVpwzK/YkZRzuAzkSL3bjwEiVqbba5TNRu1Po7Z08SkS\nO5AYWcuS7X3W6wK5pvLqAYisGwCQ0BbCS7hzBsqwecf9a/yPuaexlskrvZ3YXhBy\nIhReC6yzVVFNyG+WAKZH8kvH6VygHKjOzBZpyabcwICv1F9aqoYyn8gemn4btpf9\nG27ztQaM3op2yoQ03/tBdYyuAGHDM51UzRFswtw/LtJ7KG13UA2IWrXsT8CXaVKZ\ndk08CSWTL0alLeg9W8238vojuW4Ek471uWPDGIPyh8sMxwRx9YtZRQEv2rreAhLD\nWP2WhPnwo1yKmclSJ2FfP8oFqgDqdpQixN7uJYdx0Y9XnD6VvwuELb9sdn+ET/lE\ndIWO8baEGZCqLoJPLQ+t1Lx2e1EWSraTBhgGFuSYcf/S725KGUR7CwfZhekWldQF\nHsTI9EevITN7m9DAfcXxfHrfom2NuFa/PT0d9z5v3j5XlZBlvEA=\n=KQ6K\n-----END PGP SIGNATURE-----",
        "payload": "tree a8e42308abeab4f243779915a9ebcb8474fccccc\nparent f77d9c79aa41dab4285e95c9432cc6d853be67a3\nauthor Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1621787523 +0300\ncommitter Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1623680917 +0300\n\nrefactor: Avoid recursive locking in CAddrMan::Check\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/187b7d2bb36e6de9cd960378021ebe690619a2ef",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/187b7d2bb36e6de9cd960378021ebe690619a2ef",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/187b7d2bb36e6de9cd960378021ebe690619a2ef/comments",
    "author": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "f77d9c79aa41dab4285e95c9432cc6d853be67a3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f77d9c79aa41dab4285e95c9432cc6d853be67a3",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/f77d9c79aa41dab4285e95c9432cc6d853be67a3"
      }
    ],
    "stats": {
      "total": 9,
      "additions": 4,
      "deletions": 5
    },
    "files": [
      {
        "sha": "3474153e36dbf3d219f54605a709cb659f61ac50",
        "filename": "src/addrman.h",
        "status": "modified",
        "additions": 4,
        "deletions": 5,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/187b7d2bb36e6de9cd960378021ebe690619a2ef/src/addrman.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/187b7d2bb36e6de9cd960378021ebe690619a2ef/src/addrman.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrman.h?ref=187b7d2bb36e6de9cd960378021ebe690619a2ef",
        "patch": "@@ -585,12 +585,10 @@ class CAddrMan\n      */\n     std::vector<CAddress> GetAddr(size_t max_addresses, size_t max_pct, std::optional<Network> network)\n     {\n+        LOCK(cs);\n         Check();\n         std::vector<CAddress> vAddr;\n-        {\n-            LOCK(cs);\n-            GetAddr_(vAddr, max_addresses, max_pct, network);\n-        }\n+        GetAddr_(vAddr, max_addresses, max_pct, network);\n         Check();\n         return vAddr;\n     }\n@@ -714,9 +712,10 @@ class CAddrMan\n \n     //! Consistency check\n     void Check()\n+        EXCLUSIVE_LOCKS_REQUIRED(cs)\n     {\n #ifdef DEBUG_ADDRMAN\n-        LOCK(cs);\n+        AssertLockHeld(cs);\n         const int err = Check_();\n         if (err) {\n             LogPrintf(\"ADDRMAN CONSISTENCY CHECK FAILED!!! err=%i\\n\", err);"
      }
    ]
  },
  {
    "sha": "f79a664314b88941c1a2796623e846d0a5916c06",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmNzlhNjY0MzE0Yjg4OTQxYzFhMjc5NjYyM2U4NDZkMGE1OTE2YzA2",
    "commit": {
      "author": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2021-05-23T16:40:21Z"
      },
      "committer": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2021-06-14T14:28:37Z"
      },
      "message": "refactor: Apply consistent pattern for CAddrMan::Check usage\n\nCo-authored-by: John Newbery <john@johnnewbery.com>",
      "tree": {
        "sha": "82f1ba8a72eca87980ff6cf28e6ff6768e18e1ac",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/82f1ba8a72eca87980ff6cf28e6ff6768e18e1ac"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f79a664314b88941c1a2796623e846d0a5916c06",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE0dvyxLlvLev0wWZUQQEIES5+qB8FAmDHZ5UACgkQQQEIES5+\nqB/JchAAo4mSSjImpqVBxRqw8tXIuRIJiUv04gGyigDVP3P+sYgPbTZ70Rg9qJzw\nIAPP/roTGO5Ggjeuz4V86/X+pZ3eWo7uk5QmhzFhxkgSEIKUSWIs8XIyZWWg3Dd7\n0BlxhxX4yujWDpJzdeO+aEn6L2nC40DGkY6XRG/vbZ4dlz9lbRFAzVBan2FqSoR3\nTYiuV81L8qCBkgVEwpWc5tWwKh8im2oXsmeJWumQXtLocvAf/FEuCbngWi/Wp+46\nk81ANVsmGnYbKdbVqo/anVQb77ikcUleRFB8vSJIWTETAwaD4oTCg/psBJ/bOnnq\nEfFpKjkYl8rSBrMtLpLzKiRLqnAbdgeOlgzuVSSCdTrufNrkHI5kt5q0iydtKlBa\nw6wk8Y5oJmKz7fkK7+FJFTPjfpmRuwHY1XTg1Gtyhn5n5P0mi8xmBwMs4/rFChFe\nqfLboSwVPnPyqdwLh3HYMIO52rNdFxNitSzpBf2Z7bWqTvtikY2bCx5TQPbZAIWr\nCB+on9HvMDoZtlkzetlYJbPYWrIbhabPAhAaHHNW/3JvQ3bkPQdLZuNl9usSdW3J\nAQ7WWPA9D3MDLO0LOxPDi4MED953d1B+XSMAEaCovESN90Q9UfdCbJWg3jBcKAN2\naAB09xBZ7Lj2pDNNCuRm1rXUDCVJd8x8a0GV8nMr/q95TaEsnMU=\n=N81+\n-----END PGP SIGNATURE-----",
        "payload": "tree 82f1ba8a72eca87980ff6cf28e6ff6768e18e1ac\nparent 187b7d2bb36e6de9cd960378021ebe690619a2ef\nauthor Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1621788021 +0300\ncommitter Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1623680917 +0300\n\nrefactor: Apply consistent pattern for CAddrMan::Check usage\n\nCo-authored-by: John Newbery <john@johnnewbery.com>\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f79a664314b88941c1a2796623e846d0a5916c06",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/f79a664314b88941c1a2796623e846d0a5916c06",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f79a664314b88941c1a2796623e846d0a5916c06/comments",
    "author": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "187b7d2bb36e6de9cd960378021ebe690619a2ef",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/187b7d2bb36e6de9cd960378021ebe690619a2ef",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/187b7d2bb36e6de9cd960378021ebe690619a2ef"
      }
    ],
    "stats": {
      "total": 22,
      "additions": 8,
      "deletions": 14
    },
    "files": [
      {
        "sha": "2250d1a14cad937e612fada7b00ee66355b74680",
        "filename": "src/addrman.h",
        "status": "modified",
        "additions": 8,
        "deletions": 14,
        "changes": 22,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f79a664314b88941c1a2796623e846d0a5916c06/src/addrman.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f79a664314b88941c1a2796623e846d0a5916c06/src/addrman.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrman.h?ref=f79a664314b88941c1a2796623e846d0a5916c06",
        "patch": "@@ -551,13 +551,10 @@ class CAddrMan\n     //! Randomly select an address in tried that another address is attempting to evict.\n     CAddrInfo SelectTriedCollision()\n     {\n-        CAddrInfo ret;\n-        {\n-            LOCK(cs);\n-            Check();\n-            ret = SelectTriedCollision_();\n-            Check();\n-        }\n+        LOCK(cs);\n+        Check();\n+        const CAddrInfo ret = SelectTriedCollision_();\n+        Check();\n         return ret;\n     }\n \n@@ -566,13 +563,10 @@ class CAddrMan\n      */\n     CAddrInfo Select(bool newOnly = false)\n     {\n-        CAddrInfo addrRet;\n-        {\n-            LOCK(cs);\n-            Check();\n-            addrRet = Select_(newOnly);\n-            Check();\n-        }\n+        LOCK(cs);\n+        Check();\n+        const CAddrInfo addrRet = Select_(newOnly);\n+        Check();\n         return addrRet;\n     }\n "
      }
    ]
  },
  {
    "sha": "b138973a8b4bbe061ad97011f278a21e08ea79e6",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiMTM4OTczYThiNGJiZTA2MWFkOTcwMTFmMjc4YTIxZTA4ZWE3OWU2",
    "commit": {
      "author": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2021-05-23T17:53:03Z"
      },
      "committer": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2021-06-14T14:28:37Z"
      },
      "message": "refactor: Avoid recursive locking in CAddrMan::Clear\n\nCo-authored-by: John Newbery <john@johnnewbery.com>",
      "tree": {
        "sha": "bb8ee10b39b7edf18ac8d4b982a909f5f9dd3f7d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/bb8ee10b39b7edf18ac8d4b982a909f5f9dd3f7d"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b138973a8b4bbe061ad97011f278a21e08ea79e6",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE0dvyxLlvLev0wWZUQQEIES5+qB8FAmDHZ5UACgkQQQEIES5+\nqB8gow/7BL0utTfiwFXCOBcbLaSO9HJqtRckw/nYBUasNrcurHtfMbI5U2rUuKOZ\ncpdCZyks2tfFsNhyHQ4iBlrKt3Mi0drcN3k3KH+M2SeVyPjpOg39OT3f3ScZytRq\nLVri/K9wm4Em1jqsvqmdq8jd3mDdKoGGfQj2vxjHXMjyk4ViHKVjzj1T6X0oU+Ej\niEnpA6jWwP8a7StMphEBZf77bKj35ANGLklRNqV2MPVzbYqg8+rWedIZ2yIVM7H6\nsi7iW/y/ptonPTxi+mfzFC4zo0bsiq8pgGLSiq45p96+B+id22oUh+RSGkfx7ndz\nmLHePbNyDC4bb9Q82DqtxBc2+8mcG0cNY9vdmMVwbM/8x3Q/lDe67jivhtvLgmKZ\n/jI7B/FdOBrIUNUnPDcm+Zzx20+Fo6FKmGA5lcPBEEUVHAglRwE3IEV7dIKrBckI\nOjbevTcPLKdedlokT4T3QDNGQbNcsh/oozSAB+/M7Bxer9wQrAXGOHwzYNlVNbz1\nuBZpOTEZ7x61+sVHmDRY1Eqhoi6twIE8c3ebTgQmrpLXnlFfA08Cm7UD/Sekk+yH\n9F/uQRwrphNdmai8Sp4E7PA0y1rUwD+urM19jaR4E4wE1PtNBTnaxRB+neT9CCL1\n3IJwyFWKCRVDF/6llsb3PJPkzR4gLrQt/ExiC9yuFWJdv8GUdio=\n=y87Z\n-----END PGP SIGNATURE-----",
        "payload": "tree bb8ee10b39b7edf18ac8d4b982a909f5f9dd3f7d\nparent f79a664314b88941c1a2796623e846d0a5916c06\nauthor Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1621792383 +0300\ncommitter Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1623680917 +0300\n\nrefactor: Avoid recursive locking in CAddrMan::Clear\n\nCo-authored-by: John Newbery <john@johnnewbery.com>\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b138973a8b4bbe061ad97011f278a21e08ea79e6",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/b138973a8b4bbe061ad97011f278a21e08ea79e6",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b138973a8b4bbe061ad97011f278a21e08ea79e6/comments",
    "author": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "f79a664314b88941c1a2796623e846d0a5916c06",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f79a664314b88941c1a2796623e846d0a5916c06",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/f79a664314b88941c1a2796623e846d0a5916c06"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 1,
      "deletions": 1
    },
    "files": [
      {
        "sha": "b391bac2581fbf3283c9311a6dd43d0299972c67",
        "filename": "src/addrman.h",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/b138973a8b4bbe061ad97011f278a21e08ea79e6/src/addrman.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/b138973a8b4bbe061ad97011f278a21e08ea79e6/src/addrman.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrman.h?ref=b138973a8b4bbe061ad97011f278a21e08ea79e6",
        "patch": "@@ -299,7 +299,7 @@ class CAddrMan\n     {\n         LOCK(cs);\n \n-        Clear();\n+        assert(vRandom.empty());\n \n         Format format;\n         s_ >> Using<CustomUintFormatter<1>>(format);"
      }
    ]
  },
  {
    "sha": "5ef1d0b6982f05f70ff2164ab9af1ac1d2f97f5d",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1ZWYxZDBiNjk4MmYwNWY3MGZmMjE2NGFiOWFmMWFjMWQyZjk3ZjVk",
    "commit": {
      "author": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2021-05-23T17:53:25Z"
      },
      "committer": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2021-06-14T14:28:38Z"
      },
      "message": "Add thread safety annotations to CAddrMan public functions",
      "tree": {
        "sha": "2e421eee04a188a5332cb3fad977b5e69f95bd06",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2e421eee04a188a5332cb3fad977b5e69f95bd06"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5ef1d0b6982f05f70ff2164ab9af1ac1d2f97f5d",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE0dvyxLlvLev0wWZUQQEIES5+qB8FAmDHZ5YACgkQQQEIES5+\nqB/acg//bIlDx5zJnSxGBO37t0I5xovelnNgYYeD+bFyzBkP3PAM5sl2eFN3rCvt\nZBZtRQ0NXFzQtGjS6rb+L6FcHZupq5K/PPYfP7p6OJEDPt7SgaPSQxaHbJmB5dBe\nrafG4m4UCqd+CwiDJx/6vBwM16E4XQM/OJyQ6jHArwJVkAJLL+YWpTc5fcaHLaAc\njvtdONbYnylac9luPyoMxL7E1/fgDFYhmwo48fACjhrBIGXvEcSJ/4QdGTA+cZyl\nPTv2OXa7d0HEvrtNpDA4ABxbj9b6e2RO5d164kCazaTVoSDy0h0Pa0n3ZFBZDf+c\n1ge/0JnHBSUNmrky0wzpLERKTtuGCrI9YHMUgEidziS2iqphUFPMiQnXE33HavLd\nt5EhtDWIObWY/JHEhgGE8o5B5b0qWIOZk7NxBKJUUAJ7WBaZSoSq1x6U0pzhpxDA\nnx1wK+iEMzmlGbtzBsA8ZPjQX+inglCXA7QB9oEU3VqtUtn7CRC6fRIqkhxXelPm\nuyWNaI8TTF2xucuT5kKJZXy7nWxu0TB0/qI/z2n0FRPumjwpD5c1JOfJQvwIrGhk\nLezvNVPgnT5JRDsXUCKtHLVrXD+ZNcqnKH6OHZQ2vM58lxaVXmPGdEnJ3rvItgYO\nrkeaALTZmp/NtefTeD8IF+/ZUzx+lOMzGvGad+Pvv2DTQtpth8E=\n=Zd/c\n-----END PGP SIGNATURE-----",
        "payload": "tree 2e421eee04a188a5332cb3fad977b5e69f95bd06\nparent b138973a8b4bbe061ad97011f278a21e08ea79e6\nauthor Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1621792405 +0300\ncommitter Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1623680918 +0300\n\nAdd thread safety annotations to CAddrMan public functions\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5ef1d0b6982f05f70ff2164ab9af1ac1d2f97f5d",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/5ef1d0b6982f05f70ff2164ab9af1ac1d2f97f5d",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5ef1d0b6982f05f70ff2164ab9af1ac1d2f97f5d/comments",
    "author": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "b138973a8b4bbe061ad97011f278a21e08ea79e6",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b138973a8b4bbe061ad97011f278a21e08ea79e6",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/b138973a8b4bbe061ad97011f278a21e08ea79e6"
      }
    ],
    "stats": {
      "total": 14,
      "additions": 14,
      "deletions": 0
    },
    "files": [
      {
        "sha": "ab97d6fb1245c1416e96a44574809505c12fc2f7",
        "filename": "src/addrman.h",
        "status": "modified",
        "additions": 14,
        "deletions": 0,
        "changes": 14,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5ef1d0b6982f05f70ff2164ab9af1ac1d2f97f5d/src/addrman.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5ef1d0b6982f05f70ff2164ab9af1ac1d2f97f5d/src/addrman.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrman.h?ref=5ef1d0b6982f05f70ff2164ab9af1ac1d2f97f5d",
        "patch": "@@ -231,6 +231,7 @@ class CAddrMan\n      */\n     template <typename Stream>\n     void Serialize(Stream& s_) const\n+        EXCLUSIVE_LOCKS_REQUIRED(!cs)\n     {\n         LOCK(cs);\n \n@@ -296,6 +297,7 @@ class CAddrMan\n \n     template <typename Stream>\n     void Unserialize(Stream& s_)\n+        EXCLUSIVE_LOCKS_REQUIRED(!cs)\n     {\n         LOCK(cs);\n \n@@ -452,6 +454,7 @@ class CAddrMan\n     }\n \n     void Clear()\n+        EXCLUSIVE_LOCKS_REQUIRED(!cs)\n     {\n         LOCK(cs);\n         std::vector<int>().swap(vRandom);\n@@ -487,13 +490,15 @@ class CAddrMan\n \n     //! Return the number of (unique) addresses in all tables.\n     size_t size() const\n+        EXCLUSIVE_LOCKS_REQUIRED(!cs)\n     {\n         LOCK(cs); // TODO: Cache this in an atomic to avoid this overhead\n         return vRandom.size();\n     }\n \n     //! Add a single address.\n     bool Add(const CAddress &addr, const CNetAddr& source, int64_t nTimePenalty = 0)\n+        EXCLUSIVE_LOCKS_REQUIRED(!cs)\n     {\n         LOCK(cs);\n         bool fRet = false;\n@@ -508,6 +513,7 @@ class CAddrMan\n \n     //! Add multiple addresses.\n     bool Add(const std::vector<CAddress> &vAddr, const CNetAddr& source, int64_t nTimePenalty = 0)\n+        EXCLUSIVE_LOCKS_REQUIRED(!cs)\n     {\n         LOCK(cs);\n         int nAdd = 0;\n@@ -523,6 +529,7 @@ class CAddrMan\n \n     //! Mark an entry as accessible.\n     void Good(const CService &addr, bool test_before_evict = true, int64_t nTime = GetAdjustedTime())\n+        EXCLUSIVE_LOCKS_REQUIRED(!cs)\n     {\n         LOCK(cs);\n         Check();\n@@ -532,6 +539,7 @@ class CAddrMan\n \n     //! Mark an entry as connection attempted to.\n     void Attempt(const CService &addr, bool fCountFailure, int64_t nTime = GetAdjustedTime())\n+        EXCLUSIVE_LOCKS_REQUIRED(!cs)\n     {\n         LOCK(cs);\n         Check();\n@@ -541,6 +549,7 @@ class CAddrMan\n \n     //! See if any to-be-evicted tried table entries have been tested and if so resolve the collisions.\n     void ResolveCollisions()\n+        EXCLUSIVE_LOCKS_REQUIRED(!cs)\n     {\n         LOCK(cs);\n         Check();\n@@ -550,6 +559,7 @@ class CAddrMan\n \n     //! Randomly select an address in tried that another address is attempting to evict.\n     CAddrInfo SelectTriedCollision()\n+        EXCLUSIVE_LOCKS_REQUIRED(!cs)\n     {\n         LOCK(cs);\n         Check();\n@@ -562,6 +572,7 @@ class CAddrMan\n      * Choose an address to connect to.\n      */\n     CAddrInfo Select(bool newOnly = false)\n+        EXCLUSIVE_LOCKS_REQUIRED(!cs)\n     {\n         LOCK(cs);\n         Check();\n@@ -578,6 +589,7 @@ class CAddrMan\n      * @param[in] network        Select only addresses of this network (nullopt = all).\n      */\n     std::vector<CAddress> GetAddr(size_t max_addresses, size_t max_pct, std::optional<Network> network)\n+        EXCLUSIVE_LOCKS_REQUIRED(!cs)\n     {\n         LOCK(cs);\n         Check();\n@@ -589,6 +601,7 @@ class CAddrMan\n \n     //! Outer function for Connected_()\n     void Connected(const CService &addr, int64_t nTime = GetAdjustedTime())\n+        EXCLUSIVE_LOCKS_REQUIRED(!cs)\n     {\n         LOCK(cs);\n         Check();\n@@ -597,6 +610,7 @@ class CAddrMan\n     }\n \n     void SetServices(const CService &addr, ServiceFlags nServices)\n+        EXCLUSIVE_LOCKS_REQUIRED(!cs)\n     {\n         LOCK(cs);\n         Check();"
      }
    ]
  },
  {
    "sha": "f5d1c7fac70f424114dae3be270fdc31589a8c34",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmNWQxYzdmYWM3MGY0MjQxMTRkYWUzYmUyNzBmZGMzMTU4OWE4YzM0",
    "commit": {
      "author": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2021-05-23T18:06:10Z"
      },
      "committer": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2021-06-14T14:28:38Z"
      },
      "message": "Add AssertLockHeld to CAddrMan private functions",
      "tree": {
        "sha": "14344151261c1e5011c4de30768b725a46b519bf",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/14344151261c1e5011c4de30768b725a46b519bf"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f5d1c7fac70f424114dae3be270fdc31589a8c34",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE0dvyxLlvLev0wWZUQQEIES5+qB8FAmDHZ5YACgkQQQEIES5+\nqB+FORAApVrBFBvOb+d2S3bubTpEHg2voiRvkdx25YY8899J+9oNz3IWtSKOgl9U\nD7FxoQWUg6fbJHlAx+TEPBlyxmQRh3kab5qgX+Pm/GjzFKscsBEZMtRleblq+7lm\nmVdiFVmS+Xc+x1T/hgYAQktM9/LTM5BWYfQzueptMj285Ckam6KPKeRgtFIVZRyH\nW1OJ5H0/1niRiiI6YDcTKSBQtMOdlktYdqFrYQY7hldjAchIFp7TdXelA7O9CG0I\nNNnHf+fnKhXMW+u7oh6IZ+9REAyi72g/mC7neib3EVztZw4/tKufVHEvK+XD1rdR\nWNhR23pKm76+B7RojalH9UYHgOJFtVr3U6FzmzGUSUMD0jqW5HCQ98QdOIGLIhEp\nsDHQXVQXwNlU22WAmuyX4kNtC20Oqg366EIlcK9Cem/QbObsbnARp9/2VCVObK/N\n9/FznlqJGmINtIxOqq1q53EtthVs2XTlYf5vF2q5c44mSPGLaGa5TPWBkNEjc/Xm\n6ATWCHfAd5ZEfRHQHxHbONfaDcipgJLzK4zyhquX6QE4sfLc5bEvDMNDFVYiWU11\n4/2tGkHv0EMBKmfgDHmIFqOBjIxfb2d66dCnmHYD5oRq5z55nfpunPmAzr3S2M52\nEGN6/T1hAR1JUB1+I7t7oX9uLFJqRf4bqkByzTm+CMBg0GL3GqE=\n=nalJ\n-----END PGP SIGNATURE-----",
        "payload": "tree 14344151261c1e5011c4de30768b725a46b519bf\nparent 5ef1d0b6982f05f70ff2164ab9af1ac1d2f97f5d\nauthor Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1621793170 +0300\ncommitter Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1623680918 +0300\n\nAdd AssertLockHeld to CAddrMan private functions\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f5d1c7fac70f424114dae3be270fdc31589a8c34",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/f5d1c7fac70f424114dae3be270fdc31589a8c34",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f5d1c7fac70f424114dae3be270fdc31589a8c34/comments",
    "author": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "5ef1d0b6982f05f70ff2164ab9af1ac1d2f97f5d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5ef1d0b6982f05f70ff2164ab9af1ac1d2f97f5d",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/5ef1d0b6982f05f70ff2164ab9af1ac1d2f97f5d"
      }
    ],
    "stats": {
      "total": 32,
      "additions": 32,
      "deletions": 0
    },
    "files": [
      {
        "sha": "8f702b5a8c06e464ec86eef5c9257ea63e780606",
        "filename": "src/addrman.cpp",
        "status": "modified",
        "additions": 32,
        "deletions": 0,
        "changes": 32,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f5d1c7fac70f424114dae3be270fdc31589a8c34/src/addrman.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f5d1c7fac70f424114dae3be270fdc31589a8c34/src/addrman.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrman.cpp?ref=f5d1c7fac70f424114dae3be270fdc31589a8c34",
        "patch": "@@ -79,6 +79,8 @@ double CAddrInfo::GetChance(int64_t nNow) const\n \n CAddrInfo* CAddrMan::Find(const CNetAddr& addr, int* pnId)\n {\n+    AssertLockHeld(cs);\n+\n     const auto it = mapAddr.find(addr);\n     if (it == mapAddr.end())\n         return nullptr;\n@@ -92,6 +94,8 @@ CAddrInfo* CAddrMan::Find(const CNetAddr& addr, int* pnId)\n \n CAddrInfo* CAddrMan::Create(const CAddress& addr, const CNetAddr& addrSource, int* pnId)\n {\n+    AssertLockHeld(cs);\n+\n     int nId = nIdCount++;\n     mapInfo[nId] = CAddrInfo(addr, addrSource);\n     mapAddr[addr] = nId;\n@@ -104,6 +108,8 @@ CAddrInfo* CAddrMan::Create(const CAddress& addr, const CNetAddr& addrSource, in\n \n void CAddrMan::SwapRandom(unsigned int nRndPos1, unsigned int nRndPos2)\n {\n+    AssertLockHeld(cs);\n+\n     if (nRndPos1 == nRndPos2)\n         return;\n \n@@ -124,6 +130,8 @@ void CAddrMan::SwapRandom(unsigned int nRndPos1, unsigned int nRndPos2)\n \n void CAddrMan::Delete(int nId)\n {\n+    AssertLockHeld(cs);\n+\n     assert(mapInfo.count(nId) != 0);\n     CAddrInfo& info = mapInfo[nId];\n     assert(!info.fInTried);\n@@ -138,6 +146,8 @@ void CAddrMan::Delete(int nId)\n \n void CAddrMan::ClearNew(int nUBucket, int nUBucketPos)\n {\n+    AssertLockHeld(cs);\n+\n     // if there is an entry in the specified bucket, delete it.\n     if (vvNew[nUBucket][nUBucketPos] != -1) {\n         int nIdDelete = vvNew[nUBucket][nUBucketPos];\n@@ -153,6 +163,8 @@ void CAddrMan::ClearNew(int nUBucket, int nUBucketPos)\n \n void CAddrMan::MakeTried(CAddrInfo& info, int nId)\n {\n+    AssertLockHeld(cs);\n+\n     // remove the entry from all new buckets\n     for (int bucket = 0; bucket < ADDRMAN_NEW_BUCKET_COUNT; bucket++) {\n         int pos = info.GetBucketPosition(nKey, true, bucket);\n@@ -201,6 +213,8 @@ void CAddrMan::MakeTried(CAddrInfo& info, int nId)\n \n void CAddrMan::Good_(const CService& addr, bool test_before_evict, int64_t nTime)\n {\n+    AssertLockHeld(cs);\n+\n     int nId;\n \n     nLastGood = nTime;\n@@ -267,6 +281,8 @@ void CAddrMan::Good_(const CService& addr, bool test_before_evict, int64_t nTime\n \n bool CAddrMan::Add_(const CAddress& addr, const CNetAddr& source, int64_t nTimePenalty)\n {\n+    AssertLockHeld(cs);\n+\n     if (!addr.IsRoutable())\n         return false;\n \n@@ -340,6 +356,8 @@ bool CAddrMan::Add_(const CAddress& addr, const CNetAddr& source, int64_t nTimeP\n \n void CAddrMan::Attempt_(const CService& addr, bool fCountFailure, int64_t nTime)\n {\n+    AssertLockHeld(cs);\n+\n     CAddrInfo* pinfo = Find(addr);\n \n     // if not found, bail out\n@@ -362,6 +380,8 @@ void CAddrMan::Attempt_(const CService& addr, bool fCountFailure, int64_t nTime)\n \n CAddrInfo CAddrMan::Select_(bool newOnly)\n {\n+    AssertLockHeld(cs);\n+\n     if (vRandom.empty())\n         return CAddrInfo();\n \n@@ -410,6 +430,8 @@ CAddrInfo CAddrMan::Select_(bool newOnly)\n #ifdef DEBUG_ADDRMAN\n int CAddrMan::Check_()\n {\n+    AssertLockHeld(cs);\n+\n     std::unordered_set<int> setTried;\n     std::unordered_map<int, int> mapNew;\n \n@@ -487,6 +509,8 @@ int CAddrMan::Check_()\n \n void CAddrMan::GetAddr_(std::vector<CAddress>& vAddr, size_t max_addresses, size_t max_pct, std::optional<Network> network)\n {\n+    AssertLockHeld(cs);\n+\n     size_t nNodes = vRandom.size();\n     if (max_pct != 0) {\n         nNodes = max_pct * nNodes / 100;\n@@ -519,6 +543,8 @@ void CAddrMan::GetAddr_(std::vector<CAddress>& vAddr, size_t max_addresses, size\n \n void CAddrMan::Connected_(const CService& addr, int64_t nTime)\n {\n+    AssertLockHeld(cs);\n+\n     CAddrInfo* pinfo = Find(addr);\n \n     // if not found, bail out\n@@ -539,6 +565,8 @@ void CAddrMan::Connected_(const CService& addr, int64_t nTime)\n \n void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n {\n+    AssertLockHeld(cs);\n+\n     CAddrInfo* pinfo = Find(addr);\n \n     // if not found, bail out\n@@ -557,6 +585,8 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n \n void CAddrMan::ResolveCollisions_()\n {\n+    AssertLockHeld(cs);\n+\n     for (std::set<int>::iterator it = m_tried_collisions.begin(); it != m_tried_collisions.end();) {\n         int id_new = *it;\n \n@@ -616,6 +646,8 @@ void CAddrMan::ResolveCollisions_()\n \n CAddrInfo CAddrMan::SelectTriedCollision_()\n {\n+    AssertLockHeld(cs);\n+\n     if (m_tried_collisions.size() == 0) return CAddrInfo();\n \n     std::set<int>::iterator it = m_tried_collisions.begin();"
      }
    ]
  },
  {
    "sha": "ae98aec9c0521cdcec76459c8200bd45ff6a1485",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzphZTk4YWVjOWMwNTIxY2RjZWM3NjQ1OWM4MjAwYmQ0NWZmNmExNDg1",
    "commit": {
      "author": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2021-05-23T18:11:00Z"
      },
      "committer": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2021-06-14T14:28:38Z"
      },
      "message": "refactor: Make CAddrMan::cs non-recursive",
      "tree": {
        "sha": "3e091f0250b0938c47384082f6fc534232e8e9cd",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3e091f0250b0938c47384082f6fc534232e8e9cd"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ae98aec9c0521cdcec76459c8200bd45ff6a1485",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE0dvyxLlvLev0wWZUQQEIES5+qB8FAmDHZ5YACgkQQQEIES5+\nqB+aPw//Sf+axOq+Ynn8Dq84rXm/t1OnW5w/BEkDzWwJ6czCwj6IbAHx4E6kMC0P\n1q2JGzRmzAkRgJC57AvEW5iqD+5Ma7GQcU80w0YSGyBBG5z4ZS4DJD85nTwmLFT3\n2Q6MHmJPsecFYPKy06RXWSsfuJVGodaJ8eX3/I6vzGMqS9sXftZa66WTi/FN2kLn\ndQf+2oMRhe3+i1tT+gLS1N+H1VrHqbjFUIAg+h9s2HT3vb4Mov7N1Fq9Yy0o5EAM\nX6ezwNMnKvGvEECrLMN+H+flanFjzA2Ravaw2lK2nKBiNfNWY42dwfLIwAP+IZXN\nC577XcS2yZEN5CviDSCrUbXMKZgzfxtV8PIFhdxvpVbZ4XEU93DLvTfnCp60p56f\nccRXr9TCT7VTjO6BDOI1i7xcqGqEXYPUHF6Md9oB7+dtS7sY/ulcuNr57Oc6gOIK\nLmyY9RD8K+ATuNoOIl66zyrCpYehJngN9OemX2xBZ+kfTfYo7trBdNNeT61rMFjC\nszOd6b6pvxE9j281lwQHY4lKIgNCh2ysiXvt2wW1kgNLtqgAAX4KzNRC54M1lHxz\n0uWindyX631omLdNlwft2pDEKb1T98PefRMcQrwI+as2rQyzz53v8MoIn+2/DD7U\nnFBdYDfsfZI2fqQQ0mnHeGPPG61UeQSbi4hf4J39ZPkA89e4zkw=\n=+Adq\n-----END PGP SIGNATURE-----",
        "payload": "tree 3e091f0250b0938c47384082f6fc534232e8e9cd\nparent f5d1c7fac70f424114dae3be270fdc31589a8c34\nauthor Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1621793460 +0300\ncommitter Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1623680918 +0300\n\nrefactor: Make CAddrMan::cs non-recursive\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ae98aec9c0521cdcec76459c8200bd45ff6a1485",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/ae98aec9c0521cdcec76459c8200bd45ff6a1485",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ae98aec9c0521cdcec76459c8200bd45ff6a1485/comments",
    "author": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "f5d1c7fac70f424114dae3be270fdc31589a8c34",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f5d1c7fac70f424114dae3be270fdc31589a8c34",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/f5d1c7fac70f424114dae3be270fdc31589a8c34"
      }
    ],
    "stats": {
      "total": 4,
      "additions": 2,
      "deletions": 2
    },
    "files": [
      {
        "sha": "665e253192617550852c27ae6e7edb1138a3c345",
        "filename": "src/addrman.h",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/ae98aec9c0521cdcec76459c8200bd45ff6a1485/src/addrman.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/ae98aec9c0521cdcec76459c8200bd45ff6a1485/src/addrman.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrman.h?ref=ae98aec9c0521cdcec76459c8200bd45ff6a1485",
        "patch": "@@ -626,8 +626,8 @@ class CAddrMan\n     FastRandomContext insecure_rand;\n \n private:\n-    //! critical section to protect the inner data structures\n-    mutable RecursiveMutex cs;\n+    //! A mutex to protect the inner data structures.\n+    mutable Mutex cs;\n \n     //! Serialization versions.\n     enum Format : uint8_t {"
      }
    ]
  }
]