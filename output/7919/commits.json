[
  {
    "sha": "3a99fb2cb14955f5e029d315041a093e957e6c3e",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozYTk5ZmIyY2IxNDk1NWY1ZTAyOWQzMTUwNDFhMDkzZTk1N2U2YzNl",
    "commit": {
      "author": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@gmail.com",
        "date": "2016-04-20T17:49:55Z"
      },
      "committer": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@gmail.com",
        "date": "2016-04-20T18:19:03Z"
      },
      "message": "Fix headers announcements edge case\n\nPreviously we would assert that if every block in vBlockHashesToAnnounce is in\nchainActive, then the blocks to be announced must connect.  However, there are\nedge cases where this assumption could be violated (eg using invalidateblock /\nreconsiderblock), so just check for this case and revert to inv-announcement\ninstead.",
      "tree": {
        "sha": "309e1beff538d39a50d33cbb984670fbb5a2e06c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/309e1beff538d39a50d33cbb984670fbb5a2e06c"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3a99fb2cb14955f5e029d315041a093e957e6c3e",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3a99fb2cb14955f5e029d315041a093e957e6c3e",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/3a99fb2cb14955f5e029d315041a093e957e6c3e",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3a99fb2cb14955f5e029d315041a093e957e6c3e/comments",
    "author": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "04a29373571d44be36bd099c3b3ec3cda89e99d1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/04a29373571d44be36bd099c3b3ec3cda89e99d1",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/04a29373571d44be36bd099c3b3ec3cda89e99d1"
      }
    ],
    "stats": {
      "total": 16,
      "additions": 15,
      "deletions": 1
    },
    "files": [
      {
        "sha": "e2fbfcf12dfa4daa7ad693739be5d9c6a4c16396",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 15,
        "deletions": 1,
        "changes": 16,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3a99fb2cb14955f5e029d315041a093e957e6c3e/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3a99fb2cb14955f5e029d315041a093e957e6c3e/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=3a99fb2cb14955f5e029d315041a093e957e6c3e",
        "patch": "@@ -5718,7 +5718,21 @@ bool SendMessages(CNode* pto)\n                         fRevertToInv = true;\n                         break;\n                     }\n-                    assert(pBestIndex == NULL || pindex->pprev == pBestIndex);\n+                    if (pBestIndex != NULL && pindex->pprev != pBestIndex) {\n+                        // This means that the list of blocks to announce don't\n+                        // connect to each other.\n+                        // This shouldn't really be possible to hit during\n+                        // regular operation (because reorgs should take us to\n+                        // a chain that has some block not on the prior chain,\n+                        // which should be caught by the prior check), but one\n+                        // way this could happen is by using invalidateblock /\n+                        // reconsiderblock repeatedly on the tip, causing it to\n+                        // be added multiple times to vBlockHashesToAnnounce.\n+                        // Robustly deal with this rare situation by reverting\n+                        // to an inv.\n+                        fRevertToInv = true;\n+                        break;\n+                    }\n                     pBestIndex = pindex;\n                     if (fFoundStartingHeader) {\n                         // add this to the headers message"
      }
    ]
  }
]