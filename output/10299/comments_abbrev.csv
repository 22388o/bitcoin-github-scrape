gmaxwell,2017-04-29T18:18:34Z,I'd like to see us pull most seeder stuff out of the earlier randomness PR to set that initial state to protect against cases like we saw in netbsd where the OS rng was producing no randomness of use.,https://github.com/bitcoin/bitcoin/pull/10299#issuecomment-298185550,298185550,
sipa,2017-04-29T18:31:04Z,"@gmaxwell As that's trying to protect against a scenario that the current OpenSSL-based approach is unlikely to be protecting against, I think that's something that can easily be done in a later PR.",https://github.com/bitcoin/bitcoin/pull/10299#issuecomment-298186284,298186284,
gmaxwell,2017-04-29T19:25:53Z,"@sipa OpenSSL used a collection of system pointers and timestamps, and our use on windows also adds a screenshot.  I agree that they can be considered separately, but we should do the improved seeding first so that we're not potentially introducing a vulnerability on systems where the os entropy isn't helpful.",https://github.com/bitcoin/bitcoin/pull/10299#issuecomment-298189304,298189304,
sipa,2017-04-30T18:58:11Z,"@gmaxwell I had a look at what OpenSSL 1.1.0 uses as RNG seeding (latest stable release):\n* On UNIX systems\n  * read /dev/urandom / EGD / arc4random bytes (through a poll loop, which does not gather timing information)\n  * The (internally cached!) current pid\n  * getuid()\n  * time() (seconds resolution)\n* On Windows:\n  * CryptGenRandom (OS entropy, like we do)\n  * Intel HW rng (thr",https://github.com/bitcoin/bitcoin/pull/10299#issuecomment-298250033,298250033,
gmaxwell,2017-04-30T20:43:33Z,"Yes, I would... though I don't see why we shouldn't just take the entropy collection function we wrote before, which (at least on linux) was pretty comprehensive and really not complex at all and use that as the seed.  We could do it in a commit merged before this one too, it would just feed openssl. \n\nI think what we should be doing is in the realtime call we would read things which are relat",https://github.com/bitcoin/bitcoin/pull/10299#issuecomment-298255822,298255822,
sipa,2017-04-30T20:49:49Z,"@gmaxwell Again, if everyone is fine with just doing that, great. But if all of that needs to become a separately-maintained library first, then I don't think it should be a blocker for this PR.\n\nI do not believe that protecting against broken OSes should be a priority for us. In general, OSses are in a much better position to provide an RNG than we are. If the OS RNG is broken, generally all be",https://github.com/bitcoin/bitcoin/pull/10299#issuecomment-298256205,298256205,
gmaxwell,2017-04-30T21:00:58Z,"We have seen more instances of OS RNGs being broken than OpenSSL's RNG being broken in the last 5 years.\n\nTo me it sounds like you are proposing increasing exposure to real issues that we have actually seen in order to eliminate crufty code which is time tested. I don't believe that this is a good trade-off.\n\nDoubly so because our process for generating long lived secrets is already combin",https://github.com/bitcoin/bitcoin/pull/10299#issuecomment-298256806,298256806,
gmaxwell,2017-04-30T21:08:38Z,"Unrelated to this debate:  I think you should considering adding a counter to the reseeder.  e.g.  static unsigned uint32_t entropy_count = 0; and in the lock append it to the hash and update it. It's another source of real-time entropy which is effectively free, as it's protected by the same lock as the entropy pool.",https://github.com/bitcoin/bitcoin/pull/10299#issuecomment-298257240,298257240,
sipa,2017-04-30T21:19:49Z,"@gmaxwell I considered doing that, but given that it's effectively a hash chain, unless the hash function is horribly broken, a counter does not add anything. In fact, increasing the state to 36 bytes should be a better use of 4 bytes of memory than a counter.",https://github.com/bitcoin/bitcoin/pull/10299#issuecomment-298257929,298257929,
gmaxwell,2017-04-30T22:35:10Z,"I thought about that too, though I believe the counter would allow us to make stronger proofs about the cycle length of the function while relying on much less strong assumptions about the behavior of the hash-- similar to how fortuna uses a permutation in order to make _very_ strong proofs about the cycle length.  I suppose we could always change it later if someone wants to do the formal work to",https://github.com/bitcoin/bitcoin/pull/10299#issuecomment-298261885,298261885,
sipa,2017-05-02T23:01:40Z,Going to close this and propose some other RNG changes first.,https://github.com/bitcoin/bitcoin/pull/10299#issuecomment-298785082,298785082,
Sjors,2018-02-24T16:59:07Z,Don't forget to move `openssl` to `qt_packages` in `depends/packages/packages.mk` if you try this again. Assuming that's the last piece.,https://github.com/bitcoin/bitcoin/pull/10299#issuecomment-368242346,368242346,
