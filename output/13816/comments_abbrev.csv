scravy,2018-07-31T13:25:14Z,"A whitespace slipped in, removed that one (will squash these commits)",https://github.com/bitcoin/bitcoin/pull/13816#issuecomment-409219636,409219636,
ken2812221,2018-07-31T13:47:13Z,"In my opinion, you could make it run on macos and linux both. Also, please remove the first two commits, e0d9191 and 3144b15.",https://github.com/bitcoin/bitcoin/pull/13816#issuecomment-409226767,409226767,
DrahtBot,2018-07-31T15:13:35Z,"<!--e57a25ab6845829454e8d69fc972939a-->Reviewers, this pull request conflicts with the following ones:\n\n* #13728 (Scripts and tools: Run the CI lint stage on mac by Empact)\n* #12134 (Build previous releases and run functional tests by Sjors)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged",https://github.com/bitcoin/bitcoin/pull/13816#issuecomment-409257434,409257434,
Sjors,2018-07-31T17:56:11Z,"Concept ACK, I encounter macOS specific problems quite often.\n\n+1 for keeping the cross-compile version around\n\nThere's also some difference in compiler noisiness between using depends and not using depends, so it might be worth running `make` for both (but not the full test suite). If you keep (homebrew) system dependencies and Xcode versions up to date we'll also notice if those start ca",https://github.com/bitcoin/bitcoin/pull/13816#issuecomment-409311414,409311414,
practicalswift,2018-08-01T14:39:57Z,"Concept ACK assuming the Docker dependency added in `test/lint/lint-shell.sh` is removed :-)\n\nLinting should not require Docker :-)",https://github.com/bitcoin/bitcoin/pull/13816#issuecomment-409598648,409598648,
scravy,2018-08-01T14:59:42Z,"I did remove the docker dependency and am curious on whether the build will fail now and shellcheck segfault.\n\nI seem to not have communicated this properly: The lint step is run using `os: linux` just as before. shellcheck segfaults for me **in travis**, not on a mac. There is a PR which makes the lint stage also run on `osx` ( https://github.com/bitcoin/bitcoin/pull/13728 ).\n\nLooking at ",https://github.com/bitcoin/bitcoin/pull/13816#issuecomment-409605548,409605548,
scravy,2018-08-01T15:20:45Z,"The lint step indeed failed now. I printed `uname -a`:\n\n```\n16.14s$ test/lint/lint-all.sh\nLinux travis-job-3b3edecb-cf13-406f-8e5d-e8031fd1d16d 4.4.0-101-generic #124~14.04.1-Ubuntu SMP Fri Nov 10 19:05:36 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\ntest/lint/lint-shell.sh: line 33:  8542 Segmentation fault      (core dumped) shellcheck -e SC1087,SC1117,SC2001,SC2004,SC2005,SC2006,SC2016,SC2",https://github.com/bitcoin/bitcoin/pull/13816#issuecomment-409613117,409613117,
practicalswift,2018-08-01T15:27:45Z,"@scravy Are we relying on Travis' pre-installed `shellcheck` version? Perhaps the output of these can help:\n\n```\n$ dpkg -S $(which shellcheck)\n$ dpkg -s shellcheck\n$ shellcheck --version\n```",https://github.com/bitcoin/bitcoin/pull/13816#issuecomment-409615514,409615514,
MarcoFalke,2018-08-01T16:19:32Z,"re shellcheck on travis:\n* If you want to install it with apt, you'd have to set `sudo: true`, but then you might as well run the linter in some of the minimal docker images?\n* If you want to install it with the apt extension on `sudo: false`, it is just as broken as the version that is already installed, so no need to add the extension\n\nWouldn't it work if you just left it the way it was ",https://github.com/bitcoin/bitcoin/pull/13816#issuecomment-409632877,409632877,
MarcoFalke,2018-08-01T16:23:31Z,It seems that you extract the travis.yml into bash scripts. Imo it would help review to split this specific change into a separate commit/pull (for just linux).,https://github.com/bitcoin/bitcoin/pull/13816#issuecomment-409634120,409634120,
scravy,2018-08-02T09:59:37Z,"@practicalswift @MarcoFalke \n\nMy shellcheck woes were because of LC_ALL=C. Apparently it segfaults then. There is a comment in the lint script invoking shellcheck which I overlooked :-( I am now explicitly `unset`ing `LC_ALL` and it runs as well as before.",https://github.com/bitcoin/bitcoin/pull/13816#issuecomment-409874219,409874219,
scravy,2018-08-02T10:40:28Z,I started splitting this PR up into smaller ones. Here is the first part as proposed by @Empact to have the matrix/jobs transition in a separate PR: https://github.com/bitcoin/bitcoin/pull/13849,https://github.com/bitcoin/bitcoin/pull/13816#issuecomment-409884310,409884310,
promag,2018-08-03T11:28:38Z,"> I started splitting this PR up into smaller ones. Here is the first part as proposed byÂ @EmpactÂ to have the matrix/jobs transition in a separate PR:Â #13849\n\nðŸ‘€ ",https://github.com/bitcoin/bitcoin/pull/13816#issuecomment-410225851,410225851,
scravy,2018-08-03T14:01:06Z,"I extracted the move-script-sections-to-files-part into https://github.com/bitcoin/bitcoin/pull/13863 as suggested by @MarcoFalke \n\nOnce that one is reviewed I will rebase this one which should boil down to a really tiny change then.",https://github.com/bitcoin/bitcoin/pull/13816#issuecomment-410263062,410263062,
MarcoFalke,2018-10-26T15:40:57Z,"Should be marked ""up for grabs""?",https://github.com/bitcoin/bitcoin/pull/13816#issuecomment-433451488,433451488,
fanquake,2021-03-02T08:10:18Z,"Removing ""Up for grabs"" as we have left Travis and have a ""native"" macOS build via Cirrus.",https://github.com/bitcoin/bitcoin/pull/13816#issuecomment-788708151,788708151,
MarcoFalke,2018-07-31T13:29:39Z,"I'd prefer if we kept the cross compile on linux, since something similar is used for producing the release binaries.",https://github.com/bitcoin/bitcoin/pull/13816#discussion_r206527244,206527244,.travis.yml
promag,2018-07-31T14:11:18Z,NACK this change. Skip in macos for now?,https://github.com/bitcoin/bitcoin/pull/13816#discussion_r206543583,206543583,test/lint/lint-shell.sh
scravy,2018-07-31T15:09:22Z,"@promag I am unsure about what you mean. This part does not have anything to do with macos. I'd happily factor this one out into a separate pull request.\n\nThe lint step is executed in linux/trusty and uses a shellcheck that comes with the distro. It kept segfaulting for me (in travis, not on macos), so I am using a different version which runs in docker and has a different (and more modern) ex",https://github.com/bitcoin/bitcoin/pull/13816#discussion_r206567443,206567443,test/lint/lint-shell.sh
scravy,2018-07-31T15:10:40Z,"I see. So it should cross-build on linux and for the purpose of this PR do the build on osx additionally, not instead of!",https://github.com/bitcoin/bitcoin/pull/13816#discussion_r206567970,206567970,.travis.yml
MarcoFalke,2018-07-31T16:35:18Z,"Yes, both would be fine with me.",https://github.com/bitcoin/bitcoin/pull/13816#discussion_r206598662,206598662,.travis.yml
MarcoFalke,2018-07-31T16:40:54Z,Please rebase on master to get rid of these changes.,https://github.com/bitcoin/bitcoin/pull/13816#discussion_r206600403,206600403,src/chainparams.h
practicalswift,2018-08-01T14:38:46Z,Please don't introduce a Docker dependency. If `shellcheck` does not run on Mac then just skip it.,https://github.com/bitcoin/bitcoin/pull/13816#discussion_r206906069,206906069,test/lint/lint-shell.sh
scravy,2018-08-01T14:52:32Z,"It does run on Mac. I did not introduce this step because it does not run on mac (it does) â€“ as can be seen in https://github.com/bitcoin/bitcoin/pull/13728 ). For some reason it does segfault though in the `os: linux/dist: trusty` build.\n\nHere is a build where it segfaults: https://travis-ci.org/scravy/bitcoin/jobs/410232096#L623",https://github.com/bitcoin/bitcoin/pull/13816#discussion_r206911758,206911758,test/lint/lint-shell.sh
scravy,2018-08-01T14:55:19Z,"@practicalswift What is the problem with a docker dependency? To me it seems like the shellcheck binary in ubuntu trusty is broken and segfaults under certain conditions. Here is an issue: https://github.com/koalaman/shellcheck/issues/1053 The docker image pulled in is the official build of shellcheck.\n\nFor me to understand: Introducing a dependency for example using `brew` on osx - is that ok",https://github.com/bitcoin/bitcoin/pull/13816#discussion_r206912894,206912894,test/lint/lint-shell.sh
practicalswift,2018-08-01T15:16:25Z,"@scravy With the suggested change everyone running the linter would effectively be vulnerable if the `koalaman` Docker Hub account is compromised.\n\nSo a clear NACK from me on this specific change. Try to find a more lightweight workaround that doesn't introduce any additional trust or dependencies.",https://github.com/bitcoin/bitcoin/pull/13816#discussion_r206921259,206921259,test/lint/lint-shell.sh
MarcoFalke,2018-08-01T15:20:27Z,"You could run all the linters in a docker on travis, if that helps?",https://github.com/bitcoin/bitcoin/pull/13816#discussion_r206922872,206922872,test/lint/lint-shell.sh
ken2812221,2018-08-02T07:52:19Z,"This does not require sudo if you use \n```\naddons:\n  apt:\n    packages:\n    - shellcheck",https://github.com/bitcoin/bitcoin/pull/13816#discussion_r207131434,207131434,.travis.yml
practicalswift,2018-08-02T10:13:31Z,"Please update the comment above (""Disabled warnings"") if you're intentionally changing the excludes here :-)  There should be a 1:1 mapping between the exclude comments and the actual excludes.\n\nPlease try to find out if the change in excludes a result of improved shape of the shell scripts (or that shell scripts have been removed?) or if it is due to a change in `shellcheck`? My guess is that",https://github.com/bitcoin/bitcoin/pull/13816#discussion_r207173427,207173427,test/lint/lint-shell.sh
practicalswift,2018-08-02T10:15:41Z,Can you make this `unset` conditional on the specific environment where this `shellcheck` issue occurs? Plus add a comment on why it is done.,https://github.com/bitcoin/bitcoin/pull/13816#discussion_r207173980,207173980,test/lint/lint-shell.sh
practicalswift,2018-08-02T10:20:23Z,"Nit: Please use new style `$(...)`. Backticks are discouraged nowadays. See `shellcheck` documentation. Same comment applies to all usages of backticks.\n\nAlso, try running `shellcheck` without any excluded warnings on your newly introduced shell scripts to make sure they pass without warnings.",https://github.com/bitcoin/bitcoin/pull/13816#discussion_r207175195,207175195,.travis/script_osx.sh
scravy,2018-08-02T10:29:41Z,"Why? The comment above even says that it specifically does not set LC_ALL because it seg fauls (core cumps) when it is set. Means that if I have LC_ALL set and exported and run this script it will segfault. So to me it looks as if unsetting LC_ALL for good should be required on all platforms.\n\nI can see how this makes one uneasy (at least it makes me uneasy). According to one of the lints all ",https://github.com/bitcoin/bitcoin/pull/13816#discussion_r207177560,207177560,test/lint/lint-shell.sh
scravy,2018-08-02T10:33:36Z,@MarcoFalke Running all the linters in a docker container sounds intriguing to me. I might tackle that in a separate pull request. Simply to pull in more recent versions.,https://github.com/bitcoin/bitcoin/pull/13816#discussion_r207178545,207178545,test/lint/lint-shell.sh
practicalswift,2018-08-02T11:49:22Z,"@scravy I wrote that comment in the code :-)  The comment says that `LC_ALL=C` segfaults under certain `shellcheck` versions (perhaps a certain Ubuntu distributed `shellcheck` binary?), so my suggestions is to make the workaround (`unset LC_ALL`) conditional on where we have found that it is actually needed. That way we document when it is needed which will help us make an informed decision on whe",https://github.com/bitcoin/bitcoin/pull/13816#discussion_r207196859,207196859,test/lint/lint-shell.sh
MarcoFalke,2018-08-02T11:54:14Z,I believe on travis just all versions would segfault :/,https://github.com/bitcoin/bitcoin/pull/13816#discussion_r207197958,207197958,test/lint/lint-shell.sh
practicalswift,2018-08-02T12:00:49Z,"Oh, that's bad! I didn't know that. I thought it was generally for a specific Ubuntu version in combination with a specific `shellcheck` version. No one has been able to reproduce this locally when running same version? @scravy, can you verify that it is not present locally?",https://github.com/bitcoin/bitcoin/pull/13816#discussion_r207199638,207199638,test/lint/lint-shell.sh
promag,2018-08-02T12:13:38Z,IMO docker should not be a developer dependency and so running linters should also be possible without docker.,https://github.com/bitcoin/bitcoin/pull/13816#discussion_r207203025,207203025,test/lint/lint-shell.sh
scravy,2018-08-02T12:26:49Z,"@practicalswift So I now checked with/and without `export LC_ALL=C` on Ubuntu 14.04, 16.04, 18.04 in docker and in 18.04 on my ubuntu laptop and the shellcheck version that is part of the distro does not segfault (0.3.3, 0.3.7, 0.4.6) respectively.\n\nLooks to me as if in travis they just have a horrible version.\n\nOkay, so I guess I can make this script use `export LC_ALL=C` just like the li",https://github.com/bitcoin/bitcoin/pull/13816#discussion_r207206602,207206602,test/lint/lint-shell.sh
practicalswift,2018-08-02T12:33:08Z,@scravy That would be excellent! :-),https://github.com/bitcoin/bitcoin/pull/13816#discussion_r207208289,207208289,test/lint/lint-shell.sh
scravy,2018-08-02T12:35:48Z,@practicalswift @MarcoFalke I extracted this change into: https://github.com/bitcoin/bitcoin/pull/13851,https://github.com/bitcoin/bitcoin/pull/13816#discussion_r207209005,207209005,test/lint/lint-shell.sh
practicalswift,2018-09-11T14:15:48Z,"~~Double quote to prevent globbing and word splitting. Same below. Fix throughout :-)~~\n\n~~Verify with `shellcheck .travis/test_06_script.sh | grep SC2086`.~~",https://github.com/bitcoin/bitcoin/pull/13816#discussion_r216685696,216685696,.travis/test_06_script.sh
ken2812221,2018-09-12T09:15:07Z,I think the config arguments should be split off. No?,https://github.com/bitcoin/bitcoin/pull/13816#discussion_r216954740,216954740,.travis/test_06_script.sh
practicalswift,2018-09-25T21:48:25Z,"Oh, sorry. Was a bit too quick with that comment :-)",https://github.com/bitcoin/bitcoin/pull/13816#discussion_r220366889,220366889,.travis/test_06_script.sh
