[
  {
    "sha": "53cb1a49e744b9ebed85bb03ccd1a241cf818d74",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1M2NiMWE0OWU3NDRiOWViZWQ4NWJiMDNjY2QxYTI0MWNmODE4ZDc0",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-03-26T18:17:35Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-03-26T18:22:38Z"
      },
      "message": "Use erase instead of rewrite to remove old addr entries",
      "tree": {
        "sha": "ad281935559850934b14b6ea298954c619c5d6fc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ad281935559850934b14b6ea298954c619c5d6fc"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/53cb1a49e744b9ebed85bb03ccd1a241cf818d74",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/53cb1a49e744b9ebed85bb03ccd1a241cf818d74",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/53cb1a49e744b9ebed85bb03ccd1a241cf818d74",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/53cb1a49e744b9ebed85bb03ccd1a241cf818d74/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "01a196e08db49d83cf6c5abd8a799c56dcfef503",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/01a196e08db49d83cf6c5abd8a799c56dcfef503",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/01a196e08db49d83cf6c5abd8a799c56dcfef503"
      }
    ],
    "stats": {
      "total": 32,
      "additions": 12,
      "deletions": 20
    },
    "files": [
      {
        "sha": "c18860afcc417a11187ed06e151860e7597c9c71",
        "filename": "src/db.cpp",
        "status": "modified",
        "additions": 11,
        "deletions": 17,
        "changes": 28,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/53cb1a49e744b9ebed85bb03ccd1a241cf818d74/src/db.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/53cb1a49e744b9ebed85bb03ccd1a241cf818d74/src/db.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/db.cpp?ref=53cb1a49e744b9ebed85bb03ccd1a241cf818d74",
        "patch": "@@ -714,22 +714,12 @@ bool CTxDB::LoadBlockIndex()\n // CAddrDB\n //\n \n-bool CAddrDB::WriteAddress(const CAddress& addr)\n-{\n-    return Write(make_pair(string(\"addr\"), addr.GetKey()), addr);\n-}\n-\n bool CAddrDB::WriteAddrman(const CAddrMan& addrman)\n {\n     return Write(string(\"addrman\"), addrman);\n }\n \n-bool CAddrDB::EraseAddress(const CAddress& addr)\n-{\n-    return Erase(make_pair(string(\"addr\"), addr.GetKey()));\n-}\n-\n-bool CAddrDB::LoadAddresses(bool &fUpdate)\n+bool CAddrDB::LoadAddresses()\n {\n     bool fAddrMan = false;\n     if (Read(string(\"addrman\"), addrman))\n@@ -739,6 +729,7 @@ bool CAddrDB::LoadAddresses(bool &fUpdate)\n     }\n \n     vector<CAddress> vAddr;\n+    vector<vector<unsigned char> > vDelete;\n \n     // Get cursor\n     Dbc* pcursor = GetCursor();\n@@ -762,7 +753,11 @@ bool CAddrDB::LoadAddresses(bool &fUpdate)\n         if (strType == \"addr\")\n         {\n             if (fAddrMan)\n-                fUpdate = true;\n+            {\n+                vector<unsigned char> vchKey;\n+                ssKey >> vchKey;\n+                vDelete.push_back(vchKey);\n+            }\n             else\n             {\n                 CAddress addr;\n@@ -774,6 +769,9 @@ bool CAddrDB::LoadAddresses(bool &fUpdate)\n     }\n     pcursor->close();\n \n+    BOOST_FOREACH(const vector<unsigned char> &vchKey, vDelete)\n+        Erase(make_pair(string(\"addr\"), vchKey));\n+\n     if (!fAddrMan)\n     {\n         addrman.Add(vAddr, CNetAddr(\"0.0.0.0\"));\n@@ -785,11 +783,7 @@ bool CAddrDB::LoadAddresses(bool &fUpdate)\n \n bool LoadAddresses()\n {\n-    bool fUpdate = false;\n-    bool fRet = CAddrDB(\"cr+\").LoadAddresses(fUpdate);\n-    if (fUpdate)\n-        CDB::Rewrite(\"addr.dat\", \"\\004addr\");\n-    return fRet;\n+    return CAddrDB(\"cr+\").LoadAddresses();\n }\n \n "
      },
      {
        "sha": "688c390e409399bcf382da3ec6a4048e198909b7",
        "filename": "src/db.h",
        "status": "modified",
        "additions": 1,
        "deletions": 3,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/53cb1a49e744b9ebed85bb03ccd1a241cf818d74/src/db.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/53cb1a49e744b9ebed85bb03ccd1a241cf818d74/src/db.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/db.h?ref=53cb1a49e744b9ebed85bb03ccd1a241cf818d74",
        "patch": "@@ -306,10 +306,8 @@ class CAddrDB : public CDB\n     CAddrDB(const CAddrDB&);\n     void operator=(const CAddrDB&);\n public:\n-    bool WriteAddress(const CAddress& addr);\n-    bool EraseAddress(const CAddress& addr);\n     bool WriteAddrman(const CAddrMan& addr);\n-    bool LoadAddresses(bool &fUpdate);\n+    bool LoadAddresses();\n };\n \n bool LoadAddresses();"
      }
    ]
  }
]