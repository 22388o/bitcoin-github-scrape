[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/475168548",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15633#issuecomment-475168548",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15633",
    "id": 475168548,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NTE2ODU0OA==",
    "user": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?u=63e5c438c242094837a9deeda775d77988b508bf&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-21T09:55:55Z",
    "updated_at": "2019-03-21T09:55:55Z",
    "author_association": "CONTRIBUTOR",
    "body": "@TheBlueMatt @pstratem ",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/475168548/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/475183620",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15633#issuecomment-475183620",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15633",
    "id": 475183620,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NTE4MzYyMA==",
    "user": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?u=a0e0040aacd7d4f0787481e8ac30b494fa429e11&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-21T10:47:46Z",
    "updated_at": "2019-03-21T10:47:46Z",
    "author_association": "MEMBER",
    "body": "`p2p_compactblocks.py` is failing with this change:\r\n```\r\nbash-3.2$ test/functional/test_runner.py p2p_compactblocks.py\r\nTemporary test directory at /var/folders/z2/cn877pxd3czdfh47mfkmbwgm0000gn/T/test_runner_\u20bf_\ud83c\udfc3_20190321_184436\r\nRemaining jobs: [p2p_compactblocks.py]\r\n1/1 - p2p_compactblocks.py failed, Duration: 3 s\r\n\r\nstdout:\r\n2019-03-21T10:44:36.761000Z TestFramework (INFO): Initializing test directory /var/folders/z2/cn877pxd3czdfh47mfkmbwgm0000gn/T/test_runner_\u20bf_\ud83c\udfc3_20190321_184436/p2p_compactblocks_0\r\n2019-03-21T10:44:38.441000Z TestFramework (INFO): Running tests, pre-segwit activation:\r\n2019-03-21T10:44:38.441000Z TestFramework (INFO): Testing SENDCMPCT p2p message... \r\n2019-03-21T10:44:39.097000Z TestFramework (ERROR): Assertion failed\r\nTraceback (most recent call last):\r\n  File \"/Users/michael/github/bitcoin/test/functional/test_framework/test_framework.py\", line 175, in main\r\n    self.run_test()\r\n  File \"/Users/michael/github/bitcoin/test/functional/p2p_compactblocks.py\", line 806, in run_test\r\n    self.test_sendcmpct(self.nodes[0], self.test_node, 1)\r\n  File \"/Users/michael/github/bitcoin/test/functional/p2p_compactblocks.py\", line 212, in test_sendcmpct\r\n    check_announcement_of_new_block(node, test_node, lambda p: \"cmpctblock\" in p.last_message)\r\n  File \"/Users/michael/github/bitcoin/test/functional/p2p_compactblocks.py\", line 175, in check_announcement_of_new_block\r\n    block_hash, peer.last_message.get(\"cmpctblock\", None), peer.last_message.get(\"inv\", None)))\r\nAssertionError: block_hash=48262114212731911042171011596261530915111028555007967809551738925302554894788, cmpctblock=None, inv=msg_inv(inv=[CInv(type=Block hash=6ab3637cd497baf974b2449251695e43f104bbdae282328302333645dd3121c4)])\r\n2019-03-21T10:44:39.154000Z TestFramework (INFO): Stopping nodes\r\n2019-03-21T10:44:39.517000Z TestFramework (WARNING): Not cleaning up dir /var/folders/z2/cn877pxd3czdfh47mfkmbwgm0000gn/T/test_runner_\u20bf_\ud83c\udfc3_20190321_184436/p2p_compactblocks_0\r\n2019-03-21T10:44:39.517000Z TestFramework (ERROR): Test failed. Test logging available at /var/folders/z2/cn877pxd3czdfh47mfkmbwgm0000gn/T/test_runner_\u20bf_\ud83c\udfc3_20190321_184436/p2p_compactblocks_0/test_framework.log\r\n2019-03-21T10:44:39.518000Z TestFramework (ERROR): Hint: Call /Users/michael/github/bitcoin/test/functional/combine_logs.py '/var/folders/z2/cn877pxd3czdfh47mfkmbwgm0000gn/T/test_runner_\u20bf_\ud83c\udfc3_20190321_184436/p2p_compactblocks_0' to consolidate all logs\r\n\r\np2p_compactblocks.py | \u2716 Failed  | 3 s\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/475183620/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/475191025",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15633#issuecomment-475191025",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15633",
    "id": 475191025,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NTE5MTAyNQ==",
    "user": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?u=63e5c438c242094837a9deeda775d77988b508bf&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-21T11:15:43Z",
    "updated_at": "2019-03-21T11:15:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "nevermind. after spending an hour trying to update the tests to support this, I give up. it's not worth the effort.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/475191025/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/475338058",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15633#issuecomment-475338058",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15633",
    "id": 475338058,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NTMzODA1OA==",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-21T17:55:22Z",
    "updated_at": "2019-03-21T17:55:22Z",
    "author_association": "MEMBER",
    "body": "Sorry for the pain here \u2014 I\u2019ll try to rework the test to be more maintainable (and update for this PR).",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/475338058/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/475507719",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15633#issuecomment-475507719",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15633",
    "id": 475507719,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NTUwNzcxOQ==",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-22T06:23:17Z",
    "updated_at": "2019-03-22T06:23:41Z",
    "author_association": "MEMBER",
    "body": "it would be unfortunate if a clear improvement couldn't been done because of test impact, but if you're sure it's not worth the effort then let's leave it be\r\n\r\n> Sorry for the pain here \u2014 I\u2019ll try to rework the test to be more maintainable (and update for this PR).\r\n\r\noh great!\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/475507719/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/475826705",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15633#issuecomment-475826705",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15633",
    "id": 475826705,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NTgyNjcwNQ==",
    "user": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?u=63e5c438c242094837a9deeda775d77988b508bf&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-23T01:12:47Z",
    "updated_at": "2019-03-23T01:12:47Z",
    "author_association": "CONTRIBUTOR",
    "body": "It's a small improvement--  but the test makes really extensive assumptions about the protocol flow, and unfortunately its base case is a v1 peer (so it breaks much more than one case that tries HB vs non-HB for v1 peers).\r\n\r\nThe easy change would be switching almost all the test to v2, but then I'm concerned that it would leave v1 under-tested.\r\n\r\nSome of this is the product of the test design, it's much closer to a unit test that expects an EXACT behaviour, than a system test.... and some of that is just a consequence of using the mininode to interrogate behaviour. \r\n\r\nAnother possibility would be dropping most of the v1 CB support. E.g. only support answering getdata for v1 compact block.  At least that might simplify the codebase some.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/475826705/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/576054404",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15633#issuecomment-576054404",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15633",
    "id": 576054404,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3NjA1NDQwNA==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-19T22:27:17Z",
    "updated_at": "2020-01-19T22:27:17Z",
    "author_association": "MEMBER",
    "body": "Is this any easier now that #15660 is merged?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/576054404/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268435516",
    "pull_request_review_id": 218083876,
    "id": 268435516,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2ODQzNTUxNg==",
    "diff_hunk": "@@ -2058,6 +2058,8 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n                 State(pfrom->GetId())->fProvidesHeaderAndIDs = true;\n                 State(pfrom->GetId())->fWantsCmpctWitness = nCMPCTBLOCKVersion == 2;\n             }\n+            // ignore HB requests from peers without witness support\n+            fAnnounceUsingCMPCTBLOCK = fAnnounceUsingCMPCTBLOCK && (pfrom->GetLocalServices() & NODE_WITNESS);",
    "path": "src/net_processing.cpp",
    "position": 5,
    "original_position": 5,
    "commit_id": "5069427f76a1f4fc5c9ffb69dc105b56bb53d255",
    "original_commit_id": "5069427f76a1f4fc5c9ffb69dc105b56bb53d255",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Isn't `GetLocalServices()` always equal to what our services are, rather than our peers?  (I find this very confusing, but tracing through the code I can't see how this relates to what our peer sends us.)\r\n\r\nI think this code should be checking against the fWantsCmpctWitness variable for the peer, not GetLocalServices(). ",
    "created_at": "2019-03-24T14:11:11Z",
    "updated_at": "2019-03-24T14:11:11Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15633#discussion_r268435516",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15633",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268435516"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15633#discussion_r268435516"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15633"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268435516/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2062,
    "original_line": 2062,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268460540",
    "pull_request_review_id": 218109779,
    "id": 268460540,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2ODQ2MDU0MA==",
    "diff_hunk": "@@ -2058,6 +2058,8 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n                 State(pfrom->GetId())->fProvidesHeaderAndIDs = true;\n                 State(pfrom->GetId())->fWantsCmpctWitness = nCMPCTBLOCKVersion == 2;\n             }\n+            // ignore HB requests from peers without witness support\n+            fAnnounceUsingCMPCTBLOCK = fAnnounceUsingCMPCTBLOCK && (pfrom->GetLocalServices() & NODE_WITNESS);",
    "path": "src/net_processing.cpp",
    "position": 5,
    "original_position": 5,
    "commit_id": "5069427f76a1f4fc5c9ffb69dc105b56bb53d255",
    "original_commit_id": "5069427f76a1f4fc5c9ffb69dc105b56bb53d255",
    "user": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Indeed, it's gated on nCMPCTBLOCKVersion on my branch now, but it isn't showing up here because the PR is closed.   What I was actually intending to match on was pfrom->nServices ... I'm not actually sure what will happen if a peer requests v2 compact blocks while not sending NODE_WITNESS",
    "created_at": "2019-03-24T23:46:49Z",
    "updated_at": "2019-03-24T23:46:49Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15633#discussion_r268460540",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15633",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268460540"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15633#discussion_r268460540"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15633"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268460540/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2062,
    "original_line": 2062,
    "side": "RIGHT",
    "in_reply_to_id": 268435516
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268460916",
    "pull_request_review_id": 218110243,
    "id": 268460916,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2ODQ2MDkxNg==",
    "diff_hunk": "@@ -2058,6 +2058,8 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n                 State(pfrom->GetId())->fProvidesHeaderAndIDs = true;\n                 State(pfrom->GetId())->fWantsCmpctWitness = nCMPCTBLOCKVersion == 2;\n             }\n+            // ignore HB requests from peers without witness support\n+            fAnnounceUsingCMPCTBLOCK = fAnnounceUsingCMPCTBLOCK && (pfrom->GetLocalServices() & NODE_WITNESS);",
    "path": "src/net_processing.cpp",
    "position": 5,
    "original_position": 5,
    "commit_id": "5069427f76a1f4fc5c9ffb69dc105b56bb53d255",
    "original_commit_id": "5069427f76a1f4fc5c9ffb69dc105b56bb53d255",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think (but haven't checked recently) that NODE_WITNESS is only used for finding outbound peers that we want to be connected to, and that we don't use it anywhere else in our p2p protocol logic (eg deciding how to serialize transactions/blocks and negotiating compact block versions).  So I suspect it would work just fine?",
    "created_at": "2019-03-24T23:55:04Z",
    "updated_at": "2019-03-24T23:55:04Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15633#discussion_r268460916",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15633",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268460916"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15633#discussion_r268460916"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15633"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268460916/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2062,
    "original_line": 2062,
    "side": "RIGHT",
    "in_reply_to_id": 268435516
  }
]