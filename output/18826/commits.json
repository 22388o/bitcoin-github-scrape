[
  {
    "sha": "3e4421070af01374cd3daf77b28a2abc223c6f83",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozZTQ0MjEwNzBhZjAxMzc0Y2QzZGFmNzdiMjhhMmFiYzIyM2M2Zjgz",
    "commit": {
      "author": {
        "name": "Rod Vagg",
        "email": "rod@vagg.org",
        "date": "2020-04-30T08:55:57Z"
      },
      "committer": {
        "name": "Rod Vagg",
        "email": "rod@vagg.org",
        "date": "2020-05-08T02:19:26Z"
      },
      "message": "Expose txinwitness for coinbase in JSON form\n\ntxinwitness is used as the witness commitment nonce so is necessary if\nreconstructing block data from RPC data.",
      "tree": {
        "sha": "ce3e3dc3063c223a881a991c16123f0bc0fd319f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ce3e3dc3063c223a881a991c16123f0bc0fd319f"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3e4421070af01374cd3daf77b28a2abc223c6f83",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQEzBAABCgAdFiEE3Y8jOLrnUB491ax4wnN5L32DVF0FAl60wa4ACgkQwnN5L32D\nVF0F9Af9E74JWNYZAYKpEQM3Y35qvSA2BsZ/l6ULXYkzcGwIOqNA0DZRpVwTIHek\ns4eH1/JbcwWUsOvUkCUqwx4wOfXRt87W4jJtqB78G9ujQe01SHTaccmHomtLdBjQ\nT6iyaFslAXc+J6uIj3bbU1L1Sc0ARwvaQj7VLrouWpkPU4F8kXVQL8BxRc/jVYBK\nBA7p/+dpCm49Xvg0r9YWWr+WyfBp/ScTriXyqOzq/bz3VII40kOe3C9rzbPN6raZ\nJQlXXp6EDAhx8V0ZrYn3qIC0oYrzGXpm/yd5NqdZuRO332nzXBvFxlPKW9AfvcsO\nLRPZ9uau/c0Z6PASxLplYVhWInPUBA==\n=8QwG\n-----END PGP SIGNATURE-----",
        "payload": "tree ce3e3dc3063c223a881a991c16123f0bc0fd319f\nparent f54753293fe7355e4280944d766f22054b560ba1\nauthor Rod Vagg <rod@vagg.org> 1588236957 +1000\ncommitter Rod Vagg <rod@vagg.org> 1588904366 +1000\n\nExpose txinwitness for coinbase in JSON form\n\ntxinwitness is used as the witness commitment nonce so is necessary if\nreconstructing block data from RPC data.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3e4421070af01374cd3daf77b28a2abc223c6f83",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/3e4421070af01374cd3daf77b28a2abc223c6f83",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3e4421070af01374cd3daf77b28a2abc223c6f83/comments",
    "author": {
      "login": "rvagg",
      "id": 495647,
      "node_id": "MDQ6VXNlcjQ5NTY0Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/495647?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rvagg",
      "html_url": "https://github.com/rvagg",
      "followers_url": "https://api.github.com/users/rvagg/followers",
      "following_url": "https://api.github.com/users/rvagg/following{/other_user}",
      "gists_url": "https://api.github.com/users/rvagg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rvagg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rvagg/subscriptions",
      "organizations_url": "https://api.github.com/users/rvagg/orgs",
      "repos_url": "https://api.github.com/users/rvagg/repos",
      "events_url": "https://api.github.com/users/rvagg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rvagg/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "rvagg",
      "id": 495647,
      "node_id": "MDQ6VXNlcjQ5NTY0Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/495647?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rvagg",
      "html_url": "https://github.com/rvagg",
      "followers_url": "https://api.github.com/users/rvagg/followers",
      "following_url": "https://api.github.com/users/rvagg/following{/other_user}",
      "gists_url": "https://api.github.com/users/rvagg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rvagg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rvagg/subscriptions",
      "organizations_url": "https://api.github.com/users/rvagg/orgs",
      "repos_url": "https://api.github.com/users/rvagg/repos",
      "events_url": "https://api.github.com/users/rvagg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rvagg/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "f54753293fe7355e4280944d766f22054b560ba1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f54753293fe7355e4280944d766f22054b560ba1",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/f54753293fe7355e4280944d766f22054b560ba1"
      }
    ],
    "stats": {
      "total": 12,
      "additions": 6,
      "deletions": 6
    },
    "files": [
      {
        "sha": "eb0cc35f0609f676f040ccfc0725ab877b4cc813",
        "filename": "src/core_write.cpp",
        "status": "modified",
        "additions": 6,
        "deletions": 6,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3e4421070af01374cd3daf77b28a2abc223c6f83/src/core_write.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3e4421070af01374cd3daf77b28a2abc223c6f83/src/core_write.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/core_write.cpp?ref=3e4421070af01374cd3daf77b28a2abc223c6f83",
        "patch": "@@ -198,13 +198,13 @@ void TxToUniv(const CTransaction& tx, const uint256& hashBlock, UniValue& entry,\n             o.pushKV(\"asm\", ScriptToAsmStr(txin.scriptSig, true));\n             o.pushKV(\"hex\", HexStr(txin.scriptSig.begin(), txin.scriptSig.end()));\n             in.pushKV(\"scriptSig\", o);\n-            if (!tx.vin[i].scriptWitness.IsNull()) {\n-                UniValue txinwitness(UniValue::VARR);\n-                for (const auto& item : tx.vin[i].scriptWitness.stack) {\n-                    txinwitness.push_back(HexStr(item.begin(), item.end()));\n-                }\n-                in.pushKV(\"txinwitness\", txinwitness);\n+        }\n+        if (!tx.vin[i].scriptWitness.IsNull()) {\n+            UniValue txinwitness(UniValue::VARR);\n+            for (const auto& item : tx.vin[i].scriptWitness.stack) {\n+                txinwitness.push_back(HexStr(item.begin(), item.end()));\n             }\n+            in.pushKV(\"txinwitness\", txinwitness);\n         }\n         in.pushKV(\"sequence\", (int64_t)txin.nSequence);\n         vin.push_back(in);"
      }
    ]
  },
  {
    "sha": "34645c4dd04f1e9bc199fb722de0bb397ec0e131",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozNDY0NWM0ZGQwNGYxZTliYzE5OWZiNzIyZGUwYmIzOTdlYzBlMTMx",
    "commit": {
      "author": {
        "name": "Rod Vagg",
        "email": "rod@vagg.org",
        "date": "2020-05-02T11:13:58Z"
      },
      "committer": {
        "name": "Rod Vagg",
        "email": "rod@vagg.org",
        "date": "2020-05-08T02:19:34Z"
      },
      "message": "Test txinwitness is accessible on coinbase vin",
      "tree": {
        "sha": "ff6a3a63a888fe96f18ffdc4e4812cc343a9595e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ff6a3a63a888fe96f18ffdc4e4812cc343a9595e"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/34645c4dd04f1e9bc199fb722de0bb397ec0e131",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQEzBAABCgAdFiEE3Y8jOLrnUB491ax4wnN5L32DVF0FAl60wbYACgkQwnN5L32D\nVF1cVwgA3adQ34SYphQUOXLn7pmlKjYhvcf+1U5vSOQodm3vBqxPPeiizbghWdCH\nZgD2lg6WWsafkrcC/4S0O29TkUqTmZYe1D0oGSMlTOBNN3ju3XMfd8pue3Xa6pcT\nBjZBH/FoMl6OP1gGr9YrOJeFvVoz9lyk1TwvPG4hnbS7vZGtm/btnYsDUwVnk7vE\noilLMJ5YWeuIHh85TZSly6YzVVhTdg4cToPvh8XoKxYp1mhx/s216rSTbmlJZ5R6\nDpO1Vtb9Lvpep+CJ3mIg9WTUWksAdI+7sb49fHsw60VjMQav2Bqlq8NuPwa5xgUE\n88HjYf5cUfOV8IX5jj6Zyt3dCC9Frw==\n=xoo6\n-----END PGP SIGNATURE-----",
        "payload": "tree ff6a3a63a888fe96f18ffdc4e4812cc343a9595e\nparent 3e4421070af01374cd3daf77b28a2abc223c6f83\nauthor Rod Vagg <rod@vagg.org> 1588418038 +1000\ncommitter Rod Vagg <rod@vagg.org> 1588904374 +1000\n\nTest txinwitness is accessible on coinbase vin\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/34645c4dd04f1e9bc199fb722de0bb397ec0e131",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/34645c4dd04f1e9bc199fb722de0bb397ec0e131",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/34645c4dd04f1e9bc199fb722de0bb397ec0e131/comments",
    "author": {
      "login": "rvagg",
      "id": 495647,
      "node_id": "MDQ6VXNlcjQ5NTY0Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/495647?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rvagg",
      "html_url": "https://github.com/rvagg",
      "followers_url": "https://api.github.com/users/rvagg/followers",
      "following_url": "https://api.github.com/users/rvagg/following{/other_user}",
      "gists_url": "https://api.github.com/users/rvagg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rvagg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rvagg/subscriptions",
      "organizations_url": "https://api.github.com/users/rvagg/orgs",
      "repos_url": "https://api.github.com/users/rvagg/repos",
      "events_url": "https://api.github.com/users/rvagg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rvagg/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "rvagg",
      "id": 495647,
      "node_id": "MDQ6VXNlcjQ5NTY0Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/495647?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rvagg",
      "html_url": "https://github.com/rvagg",
      "followers_url": "https://api.github.com/users/rvagg/followers",
      "following_url": "https://api.github.com/users/rvagg/following{/other_user}",
      "gists_url": "https://api.github.com/users/rvagg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rvagg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rvagg/subscriptions",
      "organizations_url": "https://api.github.com/users/rvagg/orgs",
      "repos_url": "https://api.github.com/users/rvagg/repos",
      "events_url": "https://api.github.com/users/rvagg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rvagg/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "3e4421070af01374cd3daf77b28a2abc223c6f83",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3e4421070af01374cd3daf77b28a2abc223c6f83",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/3e4421070af01374cd3daf77b28a2abc223c6f83"
      }
    ],
    "stats": {
      "total": 9,
      "additions": 9,
      "deletions": 0
    },
    "files": [
      {
        "sha": "94eb844dfb27fc6afc9312c7a0080efb30bcef45",
        "filename": "test/functional/feature_segwit.py",
        "status": "modified",
        "additions": 9,
        "deletions": 0,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/34645c4dd04f1e9bc199fb722de0bb397ec0e131/test/functional/feature_segwit.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/34645c4dd04f1e9bc199fb722de0bb397ec0e131/test/functional/feature_segwit.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/feature_segwit.py?ref=34645c4dd04f1e9bc199fb722de0bb397ec0e131",
        "patch": "@@ -20,6 +20,7 @@\n from test_framework.test_framework import BitcoinTestFramework\n from test_framework.util import (\n     assert_equal,\n+    assert_is_hex_string,\n     assert_raises_rpc_error,\n     connect_nodes,\n     hex_str_to_bytes,\n@@ -193,6 +194,14 @@ def run_test(self):\n             assert self.nodes[1].getrawtransaction(tx_id, False, blockhash) == self.nodes[2].gettransaction(tx_id)[\"hex\"]\n             assert self.nodes[0].getrawtransaction(tx_id, False, blockhash) == tx.serialize_without_witness().hex()\n \n+        # Coinbase contains the witness commitment nonce, check that RPC shows us\n+        coinbase_txid = self.nodes[2].getblock(blockhash)['tx'][0]\n+        coinbase_tx = self.nodes[2].gettransaction(txid=coinbase_txid, verbose=True)\n+        witnesses = coinbase_tx[\"decoded\"][\"vin\"][0][\"txinwitness\"]\n+        assert_equal(len(witnesses), 1)\n+        assert_is_hex_string(witnesses[0])\n+        assert_equal(witnesses[0], '00'*32)\n+\n         self.log.info(\"Verify witness txs without witness data are invalid after the fork\")\n         self.fail_accept(self.nodes[2], 'non-mandatory-script-verify-flag (Witness program hash mismatch)', wit_ids[NODE_2][P2WPKH][2], sign=False)\n         self.fail_accept(self.nodes[2], 'non-mandatory-script-verify-flag (Witness program was passed an empty witness)', wit_ids[NODE_2][P2WSH][2], sign=False)"
      }
    ]
  }
]