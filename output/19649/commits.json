[
  {
    "sha": "0fea6ede1b46f5137e8ea0fbacce169d97e4a5ee",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzowZmVhNmVkZTFiNDZmNTEzN2U4ZWEwZmJhY2NlMTY5ZDk3ZTRhNWVl",
    "commit": {
      "author": {
        "name": "Gregory Sanders",
        "email": "gsanders87@gmail.com",
        "date": "2020-08-03T00:56:52Z"
      },
      "committer": {
        "name": "Gregory Sanders",
        "email": "gsanders87@gmail.com",
        "date": "2020-08-03T01:07:44Z"
      },
      "message": "Restore test case for p2p transaction blinding\n\nIntroduced in ca10a03addf70421893791c2c499e82fc494d60b then erroneously removed in\n8d8099e97ab8af2126f6fbd223fbd82c52f2e85e. The restored line is how we are\nchecking that the node will still re-request a specific txid given a witness-related failure.",
      "tree": {
        "sha": "669935afea12a49f3220c4ff76893cdb5e4d63e7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/669935afea12a49f3220c4ff76893cdb5e4d63e7"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0fea6ede1b46f5137e8ea0fbacce169d97e4a5ee",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0fea6ede1b46f5137e8ea0fbacce169d97e4a5ee",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/0fea6ede1b46f5137e8ea0fbacce169d97e4a5ee",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0fea6ede1b46f5137e8ea0fbacce169d97e4a5ee/comments",
    "author": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "a78742830aa35bf57bcb0a4730977a1e5a1876bc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a78742830aa35bf57bcb0a4730977a1e5a1876bc",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/a78742830aa35bf57bcb0a4730977a1e5a1876bc"
      }
    ],
    "stats": {
      "total": 4,
      "additions": 3,
      "deletions": 1
    },
    "files": [
      {
        "sha": "07efc36e67c27470911df8a0eaf8292f28ce68d4",
        "filename": "test/functional/p2p_segwit.py",
        "status": "modified",
        "additions": 3,
        "deletions": 1,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/0fea6ede1b46f5137e8ea0fbacce169d97e4a5ee/test/functional/p2p_segwit.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/0fea6ede1b46f5137e8ea0fbacce169d97e4a5ee/test/functional/p2p_segwit.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/p2p_segwit.py?ref=0fea6ede1b46f5137e8ea0fbacce169d97e4a5ee",
        "patch": "@@ -1319,9 +1319,11 @@ def test_tx_relay_after_segwit_activation(self):\n         tx3.wit.vtxinwit[0].scriptWitness.stack = [witness_program2]\n         tx3.rehash()\n \n-        # Node will not be blinded to the transaction\n+        # Node will not be blinded to the transaction, requesting it any number of times\n+        # since it is being announced via txid relay.\n         self.std_node.announce_tx_and_wait_for_getdata(tx3)\n         test_transaction_acceptance(self.nodes[1], self.std_node, tx3, True, False, 'tx-size')\n+        self.std_node.announce_tx_and_wait_for_getdata(tx3)\n \n         # Remove witness stuffing, instead add extra witness push on stack\n         tx3.vout[0] = CTxOut(tx2.vout[0].nValue - 1000, CScript([OP_TRUE, OP_DROP] * 15 + [OP_TRUE]))"
      }
    ]
  },
  {
    "sha": "566aada386e181c2ff40ef18ee660a819f485415",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1NjZhYWRhMzg2ZTE4MWMyZmY0MGVmMThlZTY2MGE4MTlmNDg1NDE1",
    "commit": {
      "author": {
        "name": "Gregory Sanders",
        "email": "gsanders87@gmail.com",
        "date": "2020-08-03T03:29:11Z"
      },
      "committer": {
        "name": "Gregory Sanders",
        "email": "gsanders87@gmail.com",
        "date": "2020-08-03T03:34:11Z"
      },
      "message": "Test that wtxid relay peers add wtxid to reject filter\n\nh/t Anthony Towns",
      "tree": {
        "sha": "2a23cc21519c40e4e816fb3f87316c733ed3eb98",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2a23cc21519c40e4e816fb3f87316c733ed3eb98"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/566aada386e181c2ff40ef18ee660a819f485415",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/566aada386e181c2ff40ef18ee660a819f485415",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/566aada386e181c2ff40ef18ee660a819f485415",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/566aada386e181c2ff40ef18ee660a819f485415/comments",
    "author": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "0fea6ede1b46f5137e8ea0fbacce169d97e4a5ee",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0fea6ede1b46f5137e8ea0fbacce169d97e4a5ee",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/0fea6ede1b46f5137e8ea0fbacce169d97e4a5ee"
      }
    ],
    "stats": {
      "total": 10,
      "additions": 9,
      "deletions": 1
    },
    "files": [
      {
        "sha": "e66beddbdb5245dac93f7ea8c707f959861db4ad",
        "filename": "test/functional/p2p_segwit.py",
        "status": "modified",
        "additions": 9,
        "deletions": 1,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/566aada386e181c2ff40ef18ee660a819f485415/test/functional/p2p_segwit.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/566aada386e181c2ff40ef18ee660a819f485415/test/functional/p2p_segwit.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/p2p_segwit.py?ref=566aada386e181c2ff40ef18ee660a819f485415",
        "patch": "@@ -174,6 +174,9 @@ def on_wtxidrelay(self, message):\n         self.last_wtxidrelay.append(message)\n \n     def announce_tx_and_wait_for_getdata(self, tx, timeout=60, success=True, use_wtxid=False):\n+        if success:\n+            # sanity check\n+            assert (self.wtxidrelay and use_wtxid) or (not self.wtxidrelay and not use_wtxid)\n         with mininode_lock:\n             self.last_message.pop(\"getdata\", None)\n         if use_wtxid:\n@@ -259,6 +262,8 @@ def run_test(self):\n         self.old_node = self.nodes[0].add_p2p_connection(TestP2PConn(), services=NODE_NETWORK)\n         # self.std_node is for testing node1 (fRequireStandard=true)\n         self.std_node = self.nodes[1].add_p2p_connection(TestP2PConn(), services=NODE_NETWORK | NODE_WITNESS)\n+        # self.std_wtx_node is for testing node1 with wtxid relay\n+        self.std_wtx_node = self.nodes[1].add_p2p_connection(TestP2PConn(wtxidrelay=True), services=NODE_NETWORK | NODE_WITNESS)\n \n         assert self.test_node.nServices & NODE_WITNESS != 0\n \n@@ -1320,10 +1325,13 @@ def test_tx_relay_after_segwit_activation(self):\n         tx3.rehash()\n \n         # Node will not be blinded to the transaction, requesting it any number of times\n-        # since it is being announced via txid relay.\n+        # if it is being announced via txid relay.\n+        # Node will be blinded to the transaction via wtxid, however.\n         self.std_node.announce_tx_and_wait_for_getdata(tx3)\n+        self.std_wtx_node.announce_tx_and_wait_for_getdata(tx3, use_wtxid=True)\n         test_transaction_acceptance(self.nodes[1], self.std_node, tx3, True, False, 'tx-size')\n         self.std_node.announce_tx_and_wait_for_getdata(tx3)\n+        self.std_wtx_node.announce_tx_and_wait_for_getdata(tx3, use_wtxid=True, success=False)\n \n         # Remove witness stuffing, instead add extra witness push on stack\n         tx3.vout[0] = CTxOut(tx2.vout[0].nValue - 1000, CScript([OP_TRUE, OP_DROP] * 15 + [OP_TRUE]))"
      }
    ]
  }
]