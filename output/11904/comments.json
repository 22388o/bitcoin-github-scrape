[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/351876406",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#issuecomment-351876406",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11904",
    "id": 351876406,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MTg3NjQwNg==",
    "user": {
      "login": "jtimon",
      "id": 1008458,
      "node_id": "MDQ6VXNlcjEwMDg0NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1008458?u=636a89c913ac407f52bb8d57c4fff384b98f421f&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jtimon",
      "html_url": "https://github.com/jtimon",
      "followers_url": "https://api.github.com/users/jtimon/followers",
      "following_url": "https://api.github.com/users/jtimon/following{/other_user}",
      "gists_url": "https://api.github.com/users/jtimon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jtimon/subscriptions",
      "organizations_url": "https://api.github.com/users/jtimon/orgs",
      "repos_url": "https://api.github.com/users/jtimon/repos",
      "events_url": "https://api.github.com/users/jtimon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jtimon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-15T00:20:39Z",
    "updated_at": "2017-12-15T00:20:39Z",
    "author_association": "MEMBER",
    "body": "Concept ACK",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/351876406/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/351897871",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#issuecomment-351897871",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11904",
    "id": 351897871,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MTg5Nzg3MQ==",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-15T02:43:31Z",
    "updated_at": "2017-12-15T02:45:50Z",
    "author_association": "CONTRIBUTOR",
    "body": "Suggest moving LockWalletDirectory to wallet/db.cpp and calling it from CDBEnv::Open instead of VerifyWallets. That way this will be compatible with #11687. Also would suggest renaming LockWalletDirectory to LockEnvDirectory to be a little more consistent with terminology used in that file (even though the file isn't totally consistent right now).",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/351897871/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/352204896",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#issuecomment-352204896",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11904",
    "id": 352204896,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MjIwNDg5Ng==",
    "user": {
      "login": "meshcollider",
      "id": 3211283,
      "node_id": "MDQ6VXNlcjMyMTEyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3211283?u=447cdc9e2966cbee415545c8ff452954ee1209af&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meshcollider",
      "html_url": "https://github.com/meshcollider",
      "followers_url": "https://api.github.com/users/meshcollider/followers",
      "following_url": "https://api.github.com/users/meshcollider/following{/other_user}",
      "gists_url": "https://api.github.com/users/meshcollider/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
      "organizations_url": "https://api.github.com/users/meshcollider/orgs",
      "repos_url": "https://api.github.com/users/meshcollider/repos",
      "events_url": "https://api.github.com/users/meshcollider/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meshcollider/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-16T19:14:49Z",
    "updated_at": "2017-12-16T19:14:49Z",
    "author_association": "MEMBER",
    "body": "@ryanofsky something like this? I had to probe the lock before calling open because of the weird database log backup thing when open fails, perhaps there is a cleaner way to do it e.g. returning different errors from open rather than just true/false. But I think this is ok",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/352204896/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/352237886",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#issuecomment-352237886",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11904",
    "id": 352237886,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MjIzNzg4Ng==",
    "user": {
      "login": "meshcollider",
      "id": 3211283,
      "node_id": "MDQ6VXNlcjMyMTEyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3211283?u=447cdc9e2966cbee415545c8ff452954ee1209af&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meshcollider",
      "html_url": "https://github.com/meshcollider",
      "followers_url": "https://api.github.com/users/meshcollider/followers",
      "following_url": "https://api.github.com/users/meshcollider/following{/other_user}",
      "gists_url": "https://api.github.com/users/meshcollider/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
      "organizations_url": "https://api.github.com/users/meshcollider/orgs",
      "repos_url": "https://api.github.com/users/meshcollider/repos",
      "events_url": "https://api.github.com/users/meshcollider/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meshcollider/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-17T07:42:48Z",
    "updated_at": "2017-12-17T07:42:48Z",
    "author_association": "MEMBER",
    "body": "Removed the probing with a bit of a rework",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/352237886/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/353377831",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#issuecomment-353377831",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11904",
    "id": 353377831,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MzM3NzgzMQ==",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?u=4a9af998e1a560b3f49c3827f453e1bcbe6a5cfb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-21T15:23:26Z",
    "updated_at": "2017-12-21T15:23:26Z",
    "author_association": "MEMBER",
    "body": "Tested ACK. Needs squash.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/353377831/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/353754724",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#issuecomment-353754724",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11904",
    "id": 353754724,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1Mzc1NDcyNA==",
    "user": {
      "login": "meshcollider",
      "id": 3211283,
      "node_id": "MDQ6VXNlcjMyMTEyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3211283?u=447cdc9e2966cbee415545c8ff452954ee1209af&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meshcollider",
      "html_url": "https://github.com/meshcollider",
      "followers_url": "https://api.github.com/users/meshcollider/followers",
      "following_url": "https://api.github.com/users/meshcollider/following{/other_user}",
      "gists_url": "https://api.github.com/users/meshcollider/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
      "organizations_url": "https://api.github.com/users/meshcollider/orgs",
      "repos_url": "https://api.github.com/users/meshcollider/repos",
      "events_url": "https://api.github.com/users/meshcollider/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meshcollider/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-23T23:46:40Z",
    "updated_at": "2017-12-24T00:10:18Z",
    "author_association": "MEMBER",
    "body": "Squashed and added a commit to modify the error message as suggested.\r\n\r\nNote travis failure on second commit is just because the last three tests were cancelled due to third commit being pushed before they started",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/353754724/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/353929270",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#issuecomment-353929270",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11904",
    "id": 353929270,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MzkyOTI3MA==",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?u=7999a16349f0df0fb273fffa18e5a955c9d3f11c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-26T07:06:10Z",
    "updated_at": "2017-12-26T07:06:10Z",
    "author_association": "MEMBER",
    "body": "utACK 005d4cdef7a7a9f98cf202db7542a7fd01e048b8",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/353929270/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/353934275",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#issuecomment-353934275",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11904",
    "id": 353934275,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MzkzNDI3NQ==",
    "user": {
      "login": "meshcollider",
      "id": 3211283,
      "node_id": "MDQ6VXNlcjMyMTEyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3211283?u=447cdc9e2966cbee415545c8ff452954ee1209af&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meshcollider",
      "html_url": "https://github.com/meshcollider",
      "followers_url": "https://api.github.com/users/meshcollider/followers",
      "following_url": "https://api.github.com/users/meshcollider/following{/other_user}",
      "gists_url": "https://api.github.com/users/meshcollider/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
      "organizations_url": "https://api.github.com/users/meshcollider/orgs",
      "repos_url": "https://api.github.com/users/meshcollider/repos",
      "events_url": "https://api.github.com/users/meshcollider/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meshcollider/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-26T07:53:43Z",
    "updated_at": "2017-12-27T01:17:18Z",
    "author_association": "MEMBER",
    "body": "Thanks for the feedback @sipa ",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/353934275/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/357660855",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#issuecomment-357660855",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11904",
    "id": 357660855,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1NzY2MDg1NQ==",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-15T11:48:07Z",
    "updated_at": "2018-01-15T11:48:07Z",
    "author_association": "MEMBER",
    "body": "utACK, needs rebase",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/357660855/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/357862498",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#issuecomment-357862498",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11904",
    "id": 357862498,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1Nzg2MjQ5OA==",
    "user": {
      "login": "meshcollider",
      "id": 3211283,
      "node_id": "MDQ6VXNlcjMyMTEyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3211283?u=447cdc9e2966cbee415545c8ff452954ee1209af&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meshcollider",
      "html_url": "https://github.com/meshcollider",
      "followers_url": "https://api.github.com/users/meshcollider/followers",
      "following_url": "https://api.github.com/users/meshcollider/following{/other_user}",
      "gists_url": "https://api.github.com/users/meshcollider/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
      "organizations_url": "https://api.github.com/users/meshcollider/orgs",
      "repos_url": "https://api.github.com/users/meshcollider/repos",
      "events_url": "https://api.github.com/users/meshcollider/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meshcollider/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-16T06:06:14Z",
    "updated_at": "2018-01-16T06:06:14Z",
    "author_association": "MEMBER",
    "body": "Rebased",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/357862498/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/357913481",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#issuecomment-357913481",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11904",
    "id": 357913481,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1NzkxMzQ4MQ==",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-16T10:11:24Z",
    "updated_at": "2018-01-16T10:11:24Z",
    "author_association": "MEMBER",
    "body": "Tested ACK 2f3bd47\r\n```\r\n2018-01-16 10:09:49 Cannot obtain a lock on wallet directory /tmp/wallet1. Another instance of bitcoin may be using it.\r\n```\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/357913481/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157355132",
    "pull_request_review_id": 83987481,
    "id": 157355132,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1NzM1NTEzMg==",
    "diff_hunk": "@@ -52,6 +53,27 @@ void CheckUniqueFileid(const CDBEnv& env, const std::string& filename, Db& db)\n         }\n     }\n }\n+\n+bool LockEnvDirectory(const fs::path& env_path, bool probe_only)\n+{\n+    // Make sure only a single Bitcoin process is using the wallet directory.\n+    fs::path lock_file_path = env_path / \".lock\";\n+    FILE* file = fsbridge::fopen(lock_file_path, \"a\"); // empty lock file; created if it doesn't exist.\n+    if (file) fclose(file);\n+\n+    try {\n+        static boost::interprocess::file_lock lock(lock_file_path.string().c_str());\n+        if (!lock.try_lock()) {\n+            return false;\n+        }\n+        if (probe_only) {\n+            lock.unlock();\n+        }\n+    } catch(const boost::interprocess::interprocess_exception& e) {",
    "path": "src/wallet/db.cpp",
    "position": null,
    "original_position": 28,
    "commit_id": "2f3bd47d44634cfc0a4261e64af178407ce2869c",
    "original_commit_id": "94be65ea6d4149a50854b342fdaddb8363b9a0a0",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Nit, missing space after `catch`.",
    "created_at": "2017-12-17T00:45:25Z",
    "updated_at": "2018-01-16T06:05:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r157355132",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157355132"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r157355132"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157355132/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 72,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157355161",
    "pull_request_review_id": 83987481,
    "id": 157355161,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1NzM1NTE2MQ==",
    "diff_hunk": "@@ -58,7 +58,12 @@ def run_test(self):\n         w5 = self.nodes[0].get_wallet_rpc(\"w5\")\n         w5_info = w5.getwalletinfo()\n         assert_equal(w5_info['immature_balance'], 50)\n+        self.stop_node(0)\n \n+        competing_wallet_dir = os.path.join(self.options.tmpdir, 'competing_walletdir')\n+        os.mkdir(competing_wallet_dir)\n+        self.start_node(0, ['-walletdir='+competing_wallet_dir])",
    "path": "test/functional/multiwallet.py",
    "position": null,
    "original_position": 25,
    "commit_id": "2f3bd47d44634cfc0a4261e64af178407ce2869c",
    "original_commit_id": "94be65ea6d4149a50854b342fdaddb8363b9a0a0",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Use `restart_node`, and remove `stop_node` above?",
    "created_at": "2017-12-17T00:47:52Z",
    "updated_at": "2018-01-16T06:05:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r157355161",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157355161"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r157355161"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157355161/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 65,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157363498",
    "pull_request_review_id": 83995746,
    "id": 157363498,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1NzM2MzQ5OA==",
    "diff_hunk": "@@ -68,7 +68,10 @@ class CDBEnv\n     typedef std::pair<std::vector<unsigned char>, std::vector<unsigned char> > KeyValPair;\n     bool Salvage(const std::string& strFile, bool fAggressive, std::vector<KeyValPair>& vResult);\n \n-    bool Open(const fs::path& path);\n+    enum OpenResult { OPEN_OK,\n+                        ENV_LOCKED,\n+                        OPEN_FAIL };\n+    OpenResult Open(const fs::path& path);",
    "path": "src/wallet/db.h",
    "position": null,
    "original_position": 8,
    "commit_id": "2f3bd47d44634cfc0a4261e64af178407ce2869c",
    "original_commit_id": "8020abc808cbf8e0b8db24f92eafbf3262ea9163",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "How about `bool Open(const fs::path& path, bool* is_locked = 0)`?",
    "created_at": "2017-12-17T09:48:55Z",
    "updated_at": "2018-01-16T06:05:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r157363498",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157363498"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r157363498"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157363498/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 74,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157364001",
    "pull_request_review_id": 83996260,
    "id": 157364001,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1NzM2NDAwMQ==",
    "diff_hunk": "@@ -68,7 +68,10 @@ class CDBEnv\n     typedef std::pair<std::vector<unsigned char>, std::vector<unsigned char> > KeyValPair;\n     bool Salvage(const std::string& strFile, bool fAggressive, std::vector<KeyValPair>& vResult);\n \n-    bool Open(const fs::path& path);\n+    enum OpenResult { OPEN_OK,\n+                        ENV_LOCKED,\n+                        OPEN_FAIL };\n+    OpenResult Open(const fs::path& path);",
    "path": "src/wallet/db.h",
    "position": null,
    "original_position": 8,
    "commit_id": "2f3bd47d44634cfc0a4261e64af178407ce2869c",
    "original_commit_id": "8020abc808cbf8e0b8db24f92eafbf3262ea9163",
    "user": {
      "login": "meshcollider",
      "id": 3211283,
      "node_id": "MDQ6VXNlcjMyMTEyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3211283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meshcollider",
      "html_url": "https://github.com/meshcollider",
      "followers_url": "https://api.github.com/users/meshcollider/followers",
      "following_url": "https://api.github.com/users/meshcollider/following{/other_user}",
      "gists_url": "https://api.github.com/users/meshcollider/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
      "organizations_url": "https://api.github.com/users/meshcollider/orgs",
      "repos_url": "https://api.github.com/users/meshcollider/repos",
      "events_url": "https://api.github.com/users/meshcollider/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meshcollider/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Could do, but IMO doesn't simplify the code much, if we're returning something why not use return :)",
    "created_at": "2017-12-17T10:14:46Z",
    "updated_at": "2018-01-16T06:05:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r157364001",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157364001"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r157364001"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157364001/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 74,
    "side": "RIGHT",
    "in_reply_to_id": 157363498
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157364106",
    "pull_request_review_id": 83996361,
    "id": 157364106,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1NzM2NDEwNg==",
    "diff_hunk": "@@ -68,7 +68,10 @@ class CDBEnv\n     typedef std::pair<std::vector<unsigned char>, std::vector<unsigned char> > KeyValPair;\n     bool Salvage(const std::string& strFile, bool fAggressive, std::vector<KeyValPair>& vResult);\n \n-    bool Open(const fs::path& path);\n+    enum OpenResult { OPEN_OK,\n+                        ENV_LOCKED,\n+                        OPEN_FAIL };\n+    OpenResult Open(const fs::path& path);",
    "path": "src/wallet/db.h",
    "position": null,
    "original_position": 8,
    "commit_id": "2f3bd47d44634cfc0a4261e64af178407ce2869c",
    "original_commit_id": "8020abc808cbf8e0b8db24f92eafbf3262ea9163",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Because you only care of `is_locked` when `Open` fails. For me `ENV_LOCKED` is the *reason* `Open` failed.\r\n\r\nAlso, you can avoid those `!= OPEN_OK` conditions.\r\n\r\nBut sure, consider my suggestion a nit.",
    "created_at": "2017-12-17T10:19:55Z",
    "updated_at": "2018-01-16T06:05:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r157364106",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157364106"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r157364106"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157364106/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 74,
    "side": "RIGHT",
    "in_reply_to_id": 157363498
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157364214",
    "pull_request_review_id": 83996451,
    "id": 157364214,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1NzM2NDIxNA==",
    "diff_hunk": "@@ -68,7 +68,10 @@ class CDBEnv\n     typedef std::pair<std::vector<unsigned char>, std::vector<unsigned char> > KeyValPair;\n     bool Salvage(const std::string& strFile, bool fAggressive, std::vector<KeyValPair>& vResult);\n \n-    bool Open(const fs::path& path);\n+    enum OpenResult { OPEN_OK,\n+                        ENV_LOCKED,\n+                        OPEN_FAIL };\n+    OpenResult Open(const fs::path& path);",
    "path": "src/wallet/db.h",
    "position": null,
    "original_position": 8,
    "commit_id": "2f3bd47d44634cfc0a4261e64af178407ce2869c",
    "original_commit_id": "8020abc808cbf8e0b8db24f92eafbf3262ea9163",
    "user": {
      "login": "meshcollider",
      "id": 3211283,
      "node_id": "MDQ6VXNlcjMyMTEyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3211283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meshcollider",
      "html_url": "https://github.com/meshcollider",
      "followers_url": "https://api.github.com/users/meshcollider/followers",
      "following_url": "https://api.github.com/users/meshcollider/following{/other_user}",
      "gists_url": "https://api.github.com/users/meshcollider/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
      "organizations_url": "https://api.github.com/users/meshcollider/orgs",
      "repos_url": "https://api.github.com/users/meshcollider/repos",
      "events_url": "https://api.github.com/users/meshcollider/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meshcollider/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Ah that's true, ok :+1:",
    "created_at": "2017-12-17T10:23:35Z",
    "updated_at": "2018-01-16T06:05:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r157364214",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157364214"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r157364214"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157364214/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 74,
    "side": "RIGHT",
    "in_reply_to_id": 157363498
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157484972",
    "pull_request_review_id": 84133083,
    "id": 157484972,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1NzQ4NDk3Mg==",
    "diff_hunk": "@@ -68,7 +68,10 @@ class CDBEnv\n     typedef std::pair<std::vector<unsigned char>, std::vector<unsigned char> > KeyValPair;\n     bool Salvage(const std::string& strFile, bool fAggressive, std::vector<KeyValPair>& vResult);\n \n-    bool Open(const fs::path& path);\n+    enum OpenResult { OPEN_OK,\n+                        ENV_LOCKED,\n+                        OPEN_FAIL };\n+    OpenResult Open(const fs::path& path);",
    "path": "src/wallet/db.h",
    "position": null,
    "original_position": 8,
    "commit_id": "2f3bd47d44634cfc0a4261e64af178407ce2869c",
    "original_commit_id": "8020abc808cbf8e0b8db24f92eafbf3262ea9163",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "https://github.com/bitcoin/bitcoin/pull/11904/files#r157363498\r\n\r\nSeems fine to use either an enum or a bool, whichever you prefer. The real problem is that VerifyEnvironment is the wrong place for the rename/retry code to live. It creates a bizarre API because you can't reliably open an environment without making two different calls and pointlessly closing and reopening. It's also a bad division of code because the verify function has to make assumptions about what the open function is doing internally.\r\n\r\nA better way to organize the code would be to have a single `bool CDBEnv::Open(fs::path, bool retry=false)` function, where setting the `retry` parameter to true renames the log directory and reopens if the initial open fails. Verifying would then just call `Open(path, true)` followed by a `Close`. Anyway this would be nice to clean up, but no need to do it here as part of fixing the lock issue.",
    "created_at": "2017-12-18T13:35:39Z",
    "updated_at": "2018-01-16T06:05:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r157484972",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157484972"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r157484972"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157484972/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 74,
    "side": "RIGHT",
    "in_reply_to_id": 157363498
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157908232",
    "pull_request_review_id": 84630121,
    "id": 157908232,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1NzkwODIzMg==",
    "diff_hunk": "@@ -134,7 +157,22 @@ bool CDBEnv::Open(const fs::path& pathIn)\n                          S_IRUSR | S_IWUSR);\n     if (ret != 0) {\n         dbenv->close(0);\n-        return error(\"CDBEnv::Open: Error %d opening database environment: %s\\n\", ret, DbEnv::strerror(ret));\n+        LogPrintf(\"CDBEnv::Open: Error %d opening database environment: %s\\n\", ret, DbEnv::strerror(ret));\n+        if (retry) {\n+            // try moving the database env out of the way\n+            fs::path pathDatabaseBak = pathIn / strprintf(\"database.%d.bak\", GetTime());\n+            try {\n+                fs::rename(pathLogDir, pathDatabaseBak);\n+                LogPrintf(\"Moved old %s to %s. Retrying.\\n\", pathDatabase.string(), pathDatabaseBak.string());\n+            } catch (const fs::filesystem_error&) {\n+                // failure is ok (well, not really, but it's not worse than what we started with)\n+            }\n+            // try opening it again one more time\n+            if (!Open(walletDir, false)) {\n+                // if it still fails, it probably means we can't even create the database env\n+                return false;\n+            }\n+        return false;",
    "path": "src/wallet/db.cpp",
    "position": null,
    "original_position": 72,
    "commit_id": "2f3bd47d44634cfc0a4261e64af178407ce2869c",
    "original_commit_id": "6ff6b2fba71a0f89011bc999de441b5074ff1d4e",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Something wrong here, missing `}`?",
    "created_at": "2017-12-20T00:04:33Z",
    "updated_at": "2018-01-16T06:05:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r157908232",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157908232"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r157908232"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157908232/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 175,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157912347",
    "pull_request_review_id": 84634932,
    "id": 157912347,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1NzkxMjM0Nw==",
    "diff_hunk": "@@ -134,7 +157,22 @@ bool CDBEnv::Open(const fs::path& pathIn)\n                          S_IRUSR | S_IWUSR);\n     if (ret != 0) {\n         dbenv->close(0);\n-        return error(\"CDBEnv::Open: Error %d opening database environment: %s\\n\", ret, DbEnv::strerror(ret));\n+        LogPrintf(\"CDBEnv::Open: Error %d opening database environment: %s\\n\", ret, DbEnv::strerror(ret));\n+        if (retry) {\n+            // try moving the database env out of the way\n+            fs::path pathDatabaseBak = pathIn / strprintf(\"database.%d.bak\", GetTime());\n+            try {\n+                fs::rename(pathLogDir, pathDatabaseBak);\n+                LogPrintf(\"Moved old %s to %s. Retrying.\\n\", pathDatabase.string(), pathDatabaseBak.string());\n+            } catch (const fs::filesystem_error&) {\n+                // failure is ok (well, not really, but it's not worse than what we started with)\n+            }\n+            // try opening it again one more time\n+            if (!Open(walletDir, false)) {\n+                // if it still fails, it probably means we can't even create the database env\n+                return false;\n+            }\n+        return false;",
    "path": "src/wallet/db.cpp",
    "position": null,
    "original_position": 72,
    "commit_id": "2f3bd47d44634cfc0a4261e64af178407ce2869c",
    "original_commit_id": "6ff6b2fba71a0f89011bc999de441b5074ff1d4e",
    "user": {
      "login": "meshcollider",
      "id": 3211283,
      "node_id": "MDQ6VXNlcjMyMTEyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3211283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meshcollider",
      "html_url": "https://github.com/meshcollider",
      "followers_url": "https://api.github.com/users/meshcollider/followers",
      "following_url": "https://api.github.com/users/meshcollider/following{/other_user}",
      "gists_url": "https://api.github.com/users/meshcollider/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
      "organizations_url": "https://api.github.com/users/meshcollider/orgs",
      "repos_url": "https://api.github.com/users/meshcollider/repos",
      "events_url": "https://api.github.com/users/meshcollider/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meshcollider/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yep oops, bad code move. Fixed.",
    "created_at": "2017-12-20T00:35:56Z",
    "updated_at": "2018-01-16T06:05:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r157912347",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157912347"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r157912347"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157912347/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 175,
    "side": "RIGHT",
    "in_reply_to_id": 157908232
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157912763",
    "pull_request_review_id": 84635332,
    "id": 157912763,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1NzkxMjc2Mw==",
    "diff_hunk": "@@ -68,7 +68,7 @@ class CDBEnv\n     typedef std::pair<std::vector<unsigned char>, std::vector<unsigned char> > KeyValPair;\n     bool Salvage(const std::string& strFile, bool fAggressive, std::vector<KeyValPair>& vResult);\n \n-    bool Open(const fs::path& path);\n+    bool Open(const fs::path& path, bool retry = 0);",
    "path": "src/wallet/db.h",
    "position": 5,
    "original_position": 5,
    "commit_id": "2f3bd47d44634cfc0a4261e64af178407ce2869c",
    "original_commit_id": "d421c4bb7fc2156e6f6591152b5a610550cb5478",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "`= false`?",
    "created_at": "2017-12-20T00:38:54Z",
    "updated_at": "2018-01-16T06:05:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r157912763",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157912763"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r157912763"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157912763/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 71,
    "original_line": 71,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157912908",
    "pull_request_review_id": 84635332,
    "id": 157912908,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1NzkxMjkwOA==",
    "diff_hunk": "@@ -68,7 +68,7 @@ class CDBEnv\n     typedef std::pair<std::vector<unsigned char>, std::vector<unsigned char> > KeyValPair;\n     bool Salvage(const std::string& strFile, bool fAggressive, std::vector<KeyValPair>& vResult);\n \n-    bool Open(const fs::path& path);\n+    bool Open(const fs::path& path, bool retry = 0);",
    "path": "src/wallet/db.h",
    "position": 5,
    "original_position": 5,
    "commit_id": "2f3bd47d44634cfc0a4261e64af178407ce2869c",
    "original_commit_id": "d421c4bb7fc2156e6f6591152b5a610550cb5478",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "BTW, how about:\r\n```cpp\r\nprivate:\r\n    bool Open(const fs::path& path, bool retry);\r\n\r\npublic:\r\n    bool Open(const fs::path& path) { return Open(path, true); }\r\n```\r\nthis way the *public* API remains, for instance, https://github.com/bitcoin/bitcoin/pull/11904/files#diff-5cd083d2c34da5f0ac380011f7b725d2R312 goes away.",
    "created_at": "2017-12-20T00:40:08Z",
    "updated_at": "2018-01-16T06:05:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r157912908",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157912908"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r157912908"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157912908/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 71,
    "original_line": 71,
    "side": "RIGHT",
    "in_reply_to_id": 157912763
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157914236",
    "pull_request_review_id": 84636940,
    "id": 157914236,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1NzkxNDIzNg==",
    "diff_hunk": "@@ -68,7 +68,7 @@ class CDBEnv\n     typedef std::pair<std::vector<unsigned char>, std::vector<unsigned char> > KeyValPair;\n     bool Salvage(const std::string& strFile, bool fAggressive, std::vector<KeyValPair>& vResult);\n \n-    bool Open(const fs::path& path);\n+    bool Open(const fs::path& path, bool retry = 0);",
    "path": "src/wallet/db.h",
    "position": 5,
    "original_position": 5,
    "commit_id": "2f3bd47d44634cfc0a4261e64af178407ce2869c",
    "original_commit_id": "d421c4bb7fc2156e6f6591152b5a610550cb5478",
    "user": {
      "login": "meshcollider",
      "id": 3211283,
      "node_id": "MDQ6VXNlcjMyMTEyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3211283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meshcollider",
      "html_url": "https://github.com/meshcollider",
      "followers_url": "https://api.github.com/users/meshcollider/followers",
      "following_url": "https://api.github.com/users/meshcollider/following{/other_user}",
      "gists_url": "https://api.github.com/users/meshcollider/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
      "organizations_url": "https://api.github.com/users/meshcollider/orgs",
      "repos_url": "https://api.github.com/users/meshcollider/repos",
      "events_url": "https://api.github.com/users/meshcollider/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meshcollider/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I'd prefer to leave it explicit I think, is there any other benefit to hiding the retry parameter?",
    "created_at": "2017-12-20T00:49:39Z",
    "updated_at": "2018-01-16T06:05:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r157914236",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157914236"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r157914236"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157914236/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 71,
    "original_line": 71,
    "side": "RIGHT",
    "in_reply_to_id": 157912763
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157914686",
    "pull_request_review_id": 84637425,
    "id": 157914686,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1NzkxNDY4Ng==",
    "diff_hunk": "@@ -68,7 +68,7 @@ class CDBEnv\n     typedef std::pair<std::vector<unsigned char>, std::vector<unsigned char> > KeyValPair;\n     bool Salvage(const std::string& strFile, bool fAggressive, std::vector<KeyValPair>& vResult);\n \n-    bool Open(const fs::path& path);\n+    bool Open(const fs::path& path, bool retry = 0);",
    "path": "src/wallet/db.h",
    "position": 5,
    "original_position": 5,
    "commit_id": "2f3bd47d44634cfc0a4261e64af178407ce2869c",
    "original_commit_id": "d421c4bb7fc2156e6f6591152b5a610550cb5478",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "It's an internal detail, you should not be able to call `Open(path, false)`, it's only there for the 2nd attempt.",
    "created_at": "2017-12-20T00:53:27Z",
    "updated_at": "2018-01-16T06:05:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r157914686",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157914686"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r157914686"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157914686/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 71,
    "original_line": 71,
    "side": "RIGHT",
    "in_reply_to_id": 157912763
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157916549",
    "pull_request_review_id": 84639566,
    "id": 157916549,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1NzkxNjU0OQ==",
    "diff_hunk": "@@ -68,7 +68,7 @@ class CDBEnv\n     typedef std::pair<std::vector<unsigned char>, std::vector<unsigned char> > KeyValPair;\n     bool Salvage(const std::string& strFile, bool fAggressive, std::vector<KeyValPair>& vResult);\n \n-    bool Open(const fs::path& path);\n+    bool Open(const fs::path& path, bool retry = 0);",
    "path": "src/wallet/db.h",
    "position": 5,
    "original_position": 5,
    "commit_id": "2f3bd47d44634cfc0a4261e64af178407ce2869c",
    "original_commit_id": "d421c4bb7fc2156e6f6591152b5a610550cb5478",
    "user": {
      "login": "meshcollider",
      "id": 3211283,
      "node_id": "MDQ6VXNlcjMyMTEyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3211283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meshcollider",
      "html_url": "https://github.com/meshcollider",
      "followers_url": "https://api.github.com/users/meshcollider/followers",
      "following_url": "https://api.github.com/users/meshcollider/following{/other_user}",
      "gists_url": "https://api.github.com/users/meshcollider/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
      "organizations_url": "https://api.github.com/users/meshcollider/orgs",
      "repos_url": "https://api.github.com/users/meshcollider/repos",
      "events_url": "https://api.github.com/users/meshcollider/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meshcollider/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Its also called without retry here: \r\nhttps://github.com/MeshCollider/bitcoin/blob/f70ce89806a7f0ce1755e7d074f6e07753a85694/src/wallet/db.cpp#L436",
    "created_at": "2017-12-20T01:08:54Z",
    "updated_at": "2018-01-16T06:05:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r157916549",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157916549"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r157916549"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157916549/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 71,
    "original_line": 71,
    "side": "RIGHT",
    "in_reply_to_id": 157912763
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158247611",
    "pull_request_review_id": 85026528,
    "id": 158247611,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1ODI0NzYxMQ==",
    "diff_hunk": "@@ -68,7 +68,7 @@ class CDBEnv\n     typedef std::pair<std::vector<unsigned char>, std::vector<unsigned char> > KeyValPair;\n     bool Salvage(const std::string& strFile, bool fAggressive, std::vector<KeyValPair>& vResult);\n \n-    bool Open(const fs::path& path);\n+    bool Open(const fs::path& path, bool retry = 0);",
    "path": "src/wallet/db.h",
    "position": 5,
    "original_position": 5,
    "commit_id": "2f3bd47d44634cfc0a4261e64af178407ce2869c",
    "original_commit_id": "d421c4bb7fc2156e6f6591152b5a610550cb5478",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Ok, missed that.",
    "created_at": "2017-12-21T10:49:42Z",
    "updated_at": "2018-01-16T06:05:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r158247611",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158247611"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r158247611"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158247611/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 71,
    "original_line": 71,
    "side": "RIGHT",
    "in_reply_to_id": 157912763
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158317339",
    "pull_request_review_id": 85109570,
    "id": 158317339,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1ODMxNzMzOQ==",
    "diff_hunk": "@@ -52,6 +53,24 @@ void CheckUniqueFileid(const CDBEnv& env, const std::string& filename, Db& db)\n         }\n     }\n }\n+\n+bool LockEnvDirectory(const fs::path& env_path)\n+{\n+    // Make sure only a single Bitcoin process is using the wallet directory.\n+    fs::path lock_file_path = env_path / \".lock\";\n+    FILE* file = fsbridge::fopen(lock_file_path, \"a\"); // empty lock file; created if it doesn't exist.\n+    if (file) fclose(file);\n+\n+    try {\n+        static boost::interprocess::file_lock lock(lock_file_path.string().c_str());",
    "path": "src/wallet/db.cpp",
    "position": null,
    "original_position": 21,
    "commit_id": "2f3bd47d44634cfc0a4261e64af178407ce2869c",
    "original_commit_id": "f70ce89806a7f0ce1755e7d074f6e07753a85694",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Didn't notice this before, and no need for a change now, but just in case #11687 is somehow merged before this PR, static variable here should move to CDBEnv instance variable. (A single static variable can't guard different database directories if different database directories may be opened during the lifetime of the process.)",
    "created_at": "2017-12-21T16:16:16Z",
    "updated_at": "2018-01-16T06:05:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r158317339",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158317339"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r158317339"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158317339/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 65,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158318929",
    "pull_request_review_id": 85109570,
    "id": 158318929,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1ODMxODkyOQ==",
    "diff_hunk": "@@ -269,25 +309,11 @@ bool CDB::VerifyEnvironment(const std::string& walletFile, const fs::path& walle\n         return false;\n     }\n \n-    if (!bitdb.Open(walletDir))\n-    {\n-        // try moving the database env out of the way\n-        fs::path pathDatabase = walletDir / \"database\";\n-        fs::path pathDatabaseBak = walletDir / strprintf(\"database.%d.bak\", GetTime());\n-        try {\n-            fs::rename(pathDatabase, pathDatabaseBak);\n-            LogPrintf(\"Moved old %s to %s. Retrying.\\n\", pathDatabase.string(), pathDatabaseBak.string());\n-        } catch (const fs::filesystem_error&) {\n-            // failure is ok (well, not really, but it's not worse than what we started with)\n-        }\n-\n-        // try again\n-        if (!bitdb.Open(walletDir)) {\n-            // if it still fails, it probably means we can't even create the database env\n-            errorStr = strprintf(_(\"Error initializing wallet database environment %s!\"), walletDir);\n-            return false;\n-        }\n+    if (!bitdb.Open(walletDir, true)) {\n+        errorStr = strprintf(_(\"Cannot obtain a lock on wallet directory %s. Another instance of bitcoin may be using it.\"), walletDir);",
    "path": "src/wallet/db.cpp",
    "position": null,
    "original_position": 101,
    "commit_id": "2f3bd47d44634cfc0a4261e64af178407ce2869c",
    "original_commit_id": "f70ce89806a7f0ce1755e7d074f6e07753a85694",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Might want to keep the previous generic error here (\"Error initializing wallet database environment\") since this can happen in other conditions than failing to obtain the lock.",
    "created_at": "2017-12-21T16:22:32Z",
    "updated_at": "2018-01-16T06:05:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r158318929",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158318929"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r158318929"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158318929/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 313,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158646847",
    "pull_request_review_id": 85489103,
    "id": 158646847,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1ODY0Njg0Nw==",
    "diff_hunk": "@@ -52,6 +53,24 @@ void CheckUniqueFileid(const CDBEnv& env, const std::string& filename, Db& db)\n         }\n     }\n }\n+\n+bool LockEnvDirectory(const fs::path& env_path)\n+{\n+    // Make sure only a single Bitcoin process is using the wallet directory.\n+    fs::path lock_file_path = env_path / \".lock\";",
    "path": "src/wallet/db.cpp",
    "position": null,
    "original_position": 16,
    "commit_id": "2f3bd47d44634cfc0a4261e64af178407ce2869c",
    "original_commit_id": "edf5a3fd56100120de968f08f75b142f042a13d9",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "What if the walletdir is the same as the datadir? Won't there be a problem if both use the same lockfile? I would consider renaming this to `\".walletlock\"` perhaps (which is also clearer to people who see the file).",
    "created_at": "2017-12-25T14:51:56Z",
    "updated_at": "2018-01-16T06:05:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r158646847",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158646847"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r158646847"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158646847/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 60,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158646896",
    "pull_request_review_id": 85489103,
    "id": 158646896,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1ODY0Njg5Ng==",
    "diff_hunk": "@@ -52,6 +53,24 @@ void CheckUniqueFileid(const CDBEnv& env, const std::string& filename, Db& db)\n         }\n     }\n }\n+\n+bool LockEnvDirectory(const fs::path& env_path)",
    "path": "src/wallet/db.cpp",
    "position": null,
    "original_position": 13,
    "commit_id": "2f3bd47d44634cfc0a4261e64af178407ce2869c",
    "original_commit_id": "edf5a3fd56100120de968f08f75b142f042a13d9",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "A lot in this function seems to be a duplication from `LockDataDirectory` in `init.cpp`. What do you think about abstracting them out to a utility function in `util.cpp` instead?",
    "created_at": "2017-12-25T14:53:02Z",
    "updated_at": "2018-01-16T06:05:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r158646896",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158646896"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r158646896"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158646896/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 57,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158647046",
    "pull_request_review_id": 85489319,
    "id": 158647046,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1ODY0NzA0Ng==",
    "diff_hunk": "@@ -52,6 +53,24 @@ void CheckUniqueFileid(const CDBEnv& env, const std::string& filename, Db& db)\n         }\n     }\n }\n+\n+bool LockEnvDirectory(const fs::path& env_path)\n+{\n+    // Make sure only a single Bitcoin process is using the wallet directory.\n+    fs::path lock_file_path = env_path / \".lock\";",
    "path": "src/wallet/db.cpp",
    "position": null,
    "original_position": 16,
    "commit_id": "2f3bd47d44634cfc0a4261e64af178407ce2869c",
    "original_commit_id": "edf5a3fd56100120de968f08f75b142f042a13d9",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Reading more, I think this is indeed advisable:\r\n\r\nFrom http://www.boost.org/doc/libs/1_55_0/doc/html/interprocess/synchronization_mechanisms.html#interprocess.synchronization_mechanisms.file_lock:\r\n> * It's unspecified if a file_lock synchronizes two threads from the same process.\r\n> * It's unspecified if a process can use two file_lock objects pointing to the same file.\r\n",
    "created_at": "2017-12-25T14:58:07Z",
    "updated_at": "2018-01-16T06:05:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r158647046",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158647046"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r158647046"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158647046/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 60,
    "side": "RIGHT",
    "in_reply_to_id": 158646847
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158655797",
    "pull_request_review_id": 85497358,
    "id": 158655797,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1ODY1NTc5Nw==",
    "diff_hunk": "@@ -52,6 +53,24 @@ void CheckUniqueFileid(const CDBEnv& env, const std::string& filename, Db& db)\n         }\n     }\n }\n+\n+bool LockEnvDirectory(const fs::path& env_path)\n+{\n+    // Make sure only a single Bitcoin process is using the wallet directory.\n+    fs::path lock_file_path = env_path / \".lock\";",
    "path": "src/wallet/db.cpp",
    "position": null,
    "original_position": 16,
    "commit_id": "2f3bd47d44634cfc0a4261e64af178407ce2869c",
    "original_commit_id": "edf5a3fd56100120de968f08f75b142f042a13d9",
    "user": {
      "login": "meshcollider",
      "id": 3211283,
      "node_id": "MDQ6VXNlcjMyMTEyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3211283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meshcollider",
      "html_url": "https://github.com/meshcollider",
      "followers_url": "https://api.github.com/users/meshcollider/followers",
      "following_url": "https://api.github.com/users/meshcollider/following{/other_user}",
      "gists_url": "https://api.github.com/users/meshcollider/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
      "organizations_url": "https://api.github.com/users/meshcollider/orgs",
      "repos_url": "https://api.github.com/users/meshcollider/repos",
      "events_url": "https://api.github.com/users/meshcollider/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meshcollider/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Good point, fixed!",
    "created_at": "2017-12-25T22:43:32Z",
    "updated_at": "2018-01-16T06:05:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r158655797",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158655797"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r158655797"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158655797/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 60,
    "side": "RIGHT",
    "in_reply_to_id": 158646847
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158749359",
    "pull_request_review_id": 85600916,
    "id": 158749359,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1ODc0OTM1OQ==",
    "diff_hunk": "@@ -375,6 +376,26 @@ int LogPrintStr(const std::string &str)\n     return ret;\n }\n \n+bool LockDirectory(const fs::path& directory, const std::string lockfile_name, bool probe_only)\n+{\n+    fs::path pathLockFile = directory / lockfile_name;\n+    FILE* file = fsbridge::fopen(pathLockFile, \"a\"); // empty lock file; created if it doesn't exist.\n+    if (file) fclose(file);\n+\n+    try {\n+        static boost::interprocess::file_lock lock(pathLockFile.string().c_str());",
    "path": "src/util.cpp",
    "position": null,
    "original_position": 19,
    "commit_id": "2f3bd47d44634cfc0a4261e64af178407ce2869c",
    "original_commit_id": "4f600cb0ba39b1e4015e09835837b99ba8d2c785",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "From https://botbot.me/freenode/bitcoin-core-dev/msg/95065183/\r\n\r\n> I've been trying to work out why the last commit in #11904 is breaking the locking function, it works fine before that commit is added, but I can't work out why it doesn't work with that change. with a brand new walletdir, it creates the .walletlock file, but lock.try_lock() fails and the node crashes on startup, does anyone with more boost familiarity than me know why lock.try_lock fails when I move it\r\n\r\nI haven't looked closely at changes here yet, but as I was trying to say in https://github.com/bitcoin/bitcoin/pull/11904#discussion_r158317339, I think the static declaration on this line becomes broken as soon as more than one directory is locked, because this will only create one single `file_lock` instance no matter how many different directories need to be locked. I think what you really need here is a map or list of locks, not one single lock. Perhaps something along the lines of (untested):\r\n\r\n```c++\r\nstatic std::map<std::string, boost::interprocess::file_lock> locks;\r\nboost::interprocess::file_lock& lock = locks.emplace(pathLockFile.string(), pathLockFile.string().c_str()).first->second;\r\n```",
    "created_at": "2017-12-27T00:32:44Z",
    "updated_at": "2018-01-16T06:05:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r158749359",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158749359"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r158749359"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158749359/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 386,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158751015",
    "pull_request_review_id": 85602794,
    "id": 158751015,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1ODc1MTAxNQ==",
    "diff_hunk": "@@ -375,6 +376,26 @@ int LogPrintStr(const std::string &str)\n     return ret;\n }\n \n+bool LockDirectory(const fs::path& directory, const std::string lockfile_name, bool probe_only)\n+{\n+    fs::path pathLockFile = directory / lockfile_name;\n+    FILE* file = fsbridge::fopen(pathLockFile, \"a\"); // empty lock file; created if it doesn't exist.\n+    if (file) fclose(file);\n+\n+    try {\n+        static boost::interprocess::file_lock lock(pathLockFile.string().c_str());",
    "path": "src/util.cpp",
    "position": null,
    "original_position": 19,
    "commit_id": "2f3bd47d44634cfc0a4261e64af178407ce2869c",
    "original_commit_id": "4f600cb0ba39b1e4015e09835837b99ba8d2c785",
    "user": {
      "login": "meshcollider",
      "id": 3211283,
      "node_id": "MDQ6VXNlcjMyMTEyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3211283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meshcollider",
      "html_url": "https://github.com/meshcollider",
      "followers_url": "https://api.github.com/users/meshcollider/followers",
      "following_url": "https://api.github.com/users/meshcollider/following{/other_user}",
      "gists_url": "https://api.github.com/users/meshcollider/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
      "organizations_url": "https://api.github.com/users/meshcollider/orgs",
      "repos_url": "https://api.github.com/users/meshcollider/repos",
      "events_url": "https://api.github.com/users/meshcollider/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meshcollider/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Ah, of course. Fixed. Thank you!",
    "created_at": "2017-12-27T01:16:31Z",
    "updated_at": "2018-01-16T06:05:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r158751015",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158751015"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r158751015"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158751015/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 386,
    "side": "RIGHT",
    "in_reply_to_id": 158749359
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/159489514",
    "pull_request_review_id": 86446588,
    "id": 159489514,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1OTQ4OTUxNA==",
    "diff_hunk": "@@ -375,6 +376,27 @@ int LogPrintStr(const std::string &str)\n     return ret;\n }\n \n+bool LockDirectory(const fs::path& directory, const std::string lockfile_name, bool probe_only)",
    "path": "src/util.cpp",
    "position": 12,
    "original_position": 12,
    "commit_id": "2f3bd47d44634cfc0a4261e64af178407ce2869c",
    "original_commit_id": "abcfc2713d4e2696b5178c15975291bfd79a68b7",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Maybe combine `directory` and `std::string lockfile_name` arguments into a single `path` argument. Having 2 arguments seems more verbose and less flexible.",
    "created_at": "2018-01-03T18:06:29Z",
    "updated_at": "2018-01-16T06:05:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r159489514",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/159489514"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r159489514"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/159489514/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 379,
    "original_line": 379,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/159489730",
    "pull_request_review_id": 86446588,
    "id": 159489730,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1OTQ4OTczMA==",
    "diff_hunk": "@@ -375,6 +376,27 @@ int LogPrintStr(const std::string &str)\n     return ret;\n }\n \n+bool LockDirectory(const fs::path& directory, const std::string lockfile_name, bool probe_only)\n+{\n+    fs::path pathLockFile = directory / lockfile_name;\n+    FILE* file = fsbridge::fopen(pathLockFile, \"a\"); // empty lock file; created if it doesn't exist.\n+    if (file) fclose(file);\n+\n+    try {\n+        static std::map<std::string, boost::interprocess::file_lock> locks;\n+        boost::interprocess::file_lock& lock = locks.emplace(pathLockFile.string(), pathLockFile.string().c_str()).first->second;\n+        if (!lock.try_lock()) {\n+            return false;\n+        }\n+        if (probe_only) {\n+            lock.unlock();\n+        }\n+    } catch (const boost::interprocess::interprocess_exception& e) {\n+        return error(\"Error while attempting to lock directory %s: %s\", directory.string(), e.what());",
    "path": "src/util.cpp",
    "position": 28,
    "original_position": 28,
    "commit_id": "2f3bd47d44634cfc0a4261e64af178407ce2869c",
    "original_commit_id": "abcfc2713d4e2696b5178c15975291bfd79a68b7",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Would be good to include filename so you could see whether wallet or data lock failed.",
    "created_at": "2018-01-03T18:07:30Z",
    "updated_at": "2018-01-16T06:05:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r159489730",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/159489730"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r159489730"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/159489730/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 395,
    "original_line": 395,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/159515976",
    "pull_request_review_id": 86477776,
    "id": 159515976,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1OTUxNTk3Ng==",
    "diff_hunk": "@@ -375,6 +376,27 @@ int LogPrintStr(const std::string &str)\n     return ret;\n }\n \n+bool LockDirectory(const fs::path& directory, const std::string lockfile_name, bool probe_only)\n+{\n+    fs::path pathLockFile = directory / lockfile_name;\n+    FILE* file = fsbridge::fopen(pathLockFile, \"a\"); // empty lock file; created if it doesn't exist.\n+    if (file) fclose(file);\n+\n+    try {\n+        static std::map<std::string, boost::interprocess::file_lock> locks;\n+        boost::interprocess::file_lock& lock = locks.emplace(pathLockFile.string(), pathLockFile.string().c_str()).first->second;\n+        if (!lock.try_lock()) {\n+            return false;\n+        }\n+        if (probe_only) {\n+            lock.unlock();\n+        }\n+    } catch (const boost::interprocess::interprocess_exception& e) {\n+        return error(\"Error while attempting to lock directory %s: %s\", directory.string(), e.what());",
    "path": "src/util.cpp",
    "position": 28,
    "original_position": 28,
    "commit_id": "2f3bd47d44634cfc0a4261e64af178407ce2869c",
    "original_commit_id": "abcfc2713d4e2696b5178c15975291bfd79a68b7",
    "user": {
      "login": "meshcollider",
      "id": 3211283,
      "node_id": "MDQ6VXNlcjMyMTEyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3211283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meshcollider",
      "html_url": "https://github.com/meshcollider",
      "followers_url": "https://api.github.com/users/meshcollider/followers",
      "following_url": "https://api.github.com/users/meshcollider/following{/other_user}",
      "gists_url": "https://api.github.com/users/meshcollider/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
      "organizations_url": "https://api.github.com/users/meshcollider/orgs",
      "repos_url": "https://api.github.com/users/meshcollider/repos",
      "events_url": "https://api.github.com/users/meshcollider/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meshcollider/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Could do, but in both cases another more specific error message is printed out when LockDirectory returns, so it's always on the next log line anyway",
    "created_at": "2018-01-03T20:08:27Z",
    "updated_at": "2018-01-16T06:05:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r159515976",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/159515976"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r159515976"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/159515976/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 395,
    "original_line": 395,
    "side": "RIGHT",
    "in_reply_to_id": 159489730
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/159516338",
    "pull_request_review_id": 86478230,
    "id": 159516338,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1OTUxNjMzOA==",
    "diff_hunk": "@@ -375,6 +376,27 @@ int LogPrintStr(const std::string &str)\n     return ret;\n }\n \n+bool LockDirectory(const fs::path& directory, const std::string lockfile_name, bool probe_only)",
    "path": "src/util.cpp",
    "position": 12,
    "original_position": 12,
    "commit_id": "2f3bd47d44634cfc0a4261e64af178407ce2869c",
    "original_commit_id": "abcfc2713d4e2696b5178c15975291bfd79a68b7",
    "user": {
      "login": "meshcollider",
      "id": 3211283,
      "node_id": "MDQ6VXNlcjMyMTEyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3211283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meshcollider",
      "html_url": "https://github.com/meshcollider",
      "followers_url": "https://api.github.com/users/meshcollider/followers",
      "following_url": "https://api.github.com/users/meshcollider/following{/other_user}",
      "gists_url": "https://api.github.com/users/meshcollider/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
      "organizations_url": "https://api.github.com/users/meshcollider/orgs",
      "repos_url": "https://api.github.com/users/meshcollider/repos",
      "events_url": "https://api.github.com/users/meshcollider/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meshcollider/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Indeed, was just for the purpose of printing out the directory in the log message below rather than the filename too. Will modify if/when there's another change too",
    "created_at": "2018-01-03T20:10:17Z",
    "updated_at": "2018-01-16T06:05:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r159516338",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/159516338"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r159516338"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/159516338/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 379,
    "original_line": 379,
    "side": "RIGHT",
    "in_reply_to_id": 159489514
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161496043",
    "pull_request_review_id": 88793746,
    "id": 161496043,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2MTQ5NjA0Mw==",
    "diff_hunk": "@@ -375,6 +376,27 @@ int LogPrintStr(const std::string &str)\n     return ret;\n }\n \n+bool LockDirectory(const fs::path& directory, const std::string lockfile_name, bool probe_only)",
    "path": "src/util.cpp",
    "position": 12,
    "original_position": 12,
    "commit_id": "2f3bd47d44634cfc0a4261e64af178407ce2869c",
    "original_commit_id": "abcfc2713d4e2696b5178c15975291bfd79a68b7",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I kind of like these separated out - after all, the function is called `LockDirectory` and not `CreateLockFile`. If you merge the directory and lockfile name, I'd say you'd also have to rename the function because it's not longer specifically about locking directories.",
    "created_at": "2018-01-15T11:44:44Z",
    "updated_at": "2018-01-16T06:05:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r161496043",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161496043"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r161496043"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161496043/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 379,
    "original_line": 379,
    "side": "RIGHT",
    "in_reply_to_id": 159489514
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161496275",
    "pull_request_review_id": 88794010,
    "id": 161496275,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2MTQ5NjI3NQ==",
    "diff_hunk": "@@ -375,6 +376,27 @@ int LogPrintStr(const std::string &str)\n     return ret;\n }\n \n+bool LockDirectory(const fs::path& directory, const std::string lockfile_name, bool probe_only)",
    "path": "src/util.cpp",
    "position": 12,
    "original_position": 12,
    "commit_id": "2f3bd47d44634cfc0a4261e64af178407ce2869c",
    "original_commit_id": "abcfc2713d4e2696b5178c15975291bfd79a68b7",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Nit: `const std::string &lockfile_name`",
    "created_at": "2018-01-15T11:45:52Z",
    "updated_at": "2018-01-16T06:05:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r161496275",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161496275"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11904#discussion_r161496275"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11904"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161496275/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 379,
    "original_line": 379,
    "side": "RIGHT",
    "in_reply_to_id": 159489514
  }
]