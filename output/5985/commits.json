[
  {
    "sha": "14d4eef79931318cb5968f9154cf458d9f8d27fa",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxNGQ0ZWVmNzk5MzEzMThjYjU5NjhmOTE1NGNmNDU4ZDlmOGQyN2Zh",
    "commit": {
      "author": {
        "name": "Alex Morcos",
        "email": "morcos@chaincode.com",
        "date": "2015-04-08T13:57:19Z"
      },
      "committer": {
        "name": "Alex Morcos",
        "email": "morcos@chaincode.com",
        "date": "2015-05-12T16:02:38Z"
      },
      "message": "Fix removing of orphan transactions\n\nWe don't want to erase orphans that still have missing inputs, they should still be tracked as orphans.  Also, the transaction thats being accepted can't be an orphan otherwise it would have previously been accepted, so doesn't need to be added to the erase queue.",
      "tree": {
        "sha": "c71dba134d7d81fd10e14ffa2c50c4ba4483c948",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c71dba134d7d81fd10e14ffa2c50c4ba4483c948"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/14d4eef79931318cb5968f9154cf458d9f8d27fa",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/14d4eef79931318cb5968f9154cf458d9f8d27fa",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/14d4eef79931318cb5968f9154cf458d9f8d27fa",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/14d4eef79931318cb5968f9154cf458d9f8d27fa/comments",
    "author": {
      "login": "morcos",
      "id": 4360349,
      "node_id": "MDQ6VXNlcjQzNjAzNDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/morcos",
      "html_url": "https://github.com/morcos",
      "followers_url": "https://api.github.com/users/morcos/followers",
      "following_url": "https://api.github.com/users/morcos/following{/other_user}",
      "gists_url": "https://api.github.com/users/morcos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/morcos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
      "organizations_url": "https://api.github.com/users/morcos/orgs",
      "repos_url": "https://api.github.com/users/morcos/repos",
      "events_url": "https://api.github.com/users/morcos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/morcos/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "morcos",
      "id": 4360349,
      "node_id": "MDQ6VXNlcjQzNjAzNDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/morcos",
      "html_url": "https://github.com/morcos",
      "followers_url": "https://api.github.com/users/morcos/followers",
      "following_url": "https://api.github.com/users/morcos/following{/other_user}",
      "gists_url": "https://api.github.com/users/morcos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/morcos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
      "organizations_url": "https://api.github.com/users/morcos/orgs",
      "repos_url": "https://api.github.com/users/morcos/repos",
      "events_url": "https://api.github.com/users/morcos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/morcos/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "7efc9cf672acd752521a79c1547d232b2ca3486b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7efc9cf672acd752521a79c1547d232b2ca3486b",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/7efc9cf672acd752521a79c1547d232b2ca3486b"
      }
    ],
    "stats": {
      "total": 7,
      "additions": 4,
      "deletions": 3
    },
    "files": [
      {
        "sha": "b04274fa2181c169b67c7c295d7323347574cbed",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 3,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/14d4eef79931318cb5968f9154cf458d9f8d27fa/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/14d4eef79931318cb5968f9154cf458d9f8d27fa/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=14d4eef79931318cb5968f9154cf458d9f8d27fa",
        "patch": "@@ -3979,7 +3979,6 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n             mempool.check(pcoinsTip);\n             RelayTransaction(tx);\n             vWorkQueue.push_back(inv.hash);\n-            vEraseQueue.push_back(inv.hash);\n \n             LogPrint(\"mempool\", \"AcceptToMemoryPool: peer=%d %s: accepted %s (poolsz %u)\\n\",\n                 pfrom->id, pfrom->cleanSubVer,\n@@ -4006,7 +4005,6 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n                     // anyone relaying LegitTxX banned)\n                     CValidationState stateDummy;\n \n-                    vEraseQueue.push_back(orphanHash);\n \n                     if (setMisbehaving.count(fromPeer))\n                         continue;\n@@ -4015,6 +4013,7 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n                         LogPrint(\"mempool\", \"   accepted orphan tx %s\\n\", orphanHash.ToString());\n                         RelayTransaction(orphanTx);\n                         vWorkQueue.push_back(orphanHash);\n+                        vEraseQueue.push_back(orphanHash);\n                     }\n                     else if (!fMissingInputs2)\n                     {\n@@ -4026,8 +4025,10 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n                             setMisbehaving.insert(fromPeer);\n                             LogPrint(\"mempool\", \"   invalid orphan tx %s\\n\", orphanHash.ToString());\n                         }\n-                        // too-little-fee orphan\n+                        // Has inputs but not accepted to mempool\n+                        // Probably non-standard or insufficient fee/priority\n                         LogPrint(\"mempool\", \"   removed orphan tx %s\\n\", orphanHash.ToString());\n+                        vEraseQueue.push_back(orphanHash);\n                     }\n                     mempool.check(pcoinsTip);\n                 }"
      }
    ]
  }
]