[
  {
    "sha": "fa0a864b383a794910cdb215bb836dae12357bc6",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYTBhODY0YjM4M2E3OTQ5MTBjZGIyMTViYjgzNmRhZTEyMzU3YmM2",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2021-01-10T15:41:52Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2021-01-13T06:48:41Z"
      },
      "message": "fuzz: Use mocktime in process_message* fuzz targets",
      "tree": {
        "sha": "ffe185d500e63256d36c3344af713414635355b9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ffe185d500e63256d36c3344af713414635355b9"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fa0a864b383a794910cdb215bb836dae12357bc6",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\npUgSgwwAn+IKx7E/77IgIsWlFjkZV/s4mwBqnb23fJyGlMm8ytP3NceNULXH9FqJ\nr54xeSbLp1qfj0pllxP8xsU+H0pUI6lGC5c6OQj9XaY6PyCeCP1Udz8RBlbPygLd\nFFq9jYxBlLN/LeACQOCKiO0wDM7tjn1Qt7v4S1LE2UL02FyTQTKLmogBaNIISFs9\nxsdGhfSqG+C5cJexq++hIm4ZsNxUZyiXyOCzUbcei9qOsfwLuYX9A0EoRj3fVWgC\nkuQNc2yAICDKb72daYoAfTuggXZgkoD3QKA50cINnT4qrVQzewlFvLa10ObBVpys\n0GAwzuHHHWBNsg/pzVApg67ZgpaYGgFIispVqS0zDvC/UD6H23arLp+wbP1AWzNy\n6FJ6w06G9EsnSfkiav/rtMAK/LrIos1owt9CZfUJXHUlQbD+sJRoYd/Vx+1oKLjL\n7ojumsyUFU0n9xCuJ78pnH82m7qHcFWC09m2jZcxDD5etmxohskJj6ds9Vpu4sk2\nECUuE3o2\n=dQIp\n-----END PGP SIGNATURE-----",
        "payload": "tree ffe185d500e63256d36c3344af713414635355b9\nparent 6af013792f1bf85824803fc5283bf0d68a8fd080\nauthor MarcoFalke <falke.marco@gmail.com> 1610293312 +0100\ncommitter MarcoFalke <falke.marco@gmail.com> 1610520521 +0100\n\nfuzz: Use mocktime in process_message* fuzz targets\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa0a864b383a794910cdb215bb836dae12357bc6",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fa0a864b383a794910cdb215bb836dae12357bc6",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa0a864b383a794910cdb215bb836dae12357bc6/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "6af013792f1bf85824803fc5283bf0d68a8fd080",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6af013792f1bf85824803fc5283bf0d68a8fd080",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/6af013792f1bf85824803fc5283bf0d68a8fd080"
      }
    ],
    "stats": {
      "total": 17,
      "additions": 11,
      "deletions": 6
    },
    "files": [
      {
        "sha": "e9aeef1d3282b1a676c9a2ca4d7a0efeb26c7137",
        "filename": "src/test/fuzz/process_message.cpp",
        "status": "modified",
        "additions": 6,
        "deletions": 2,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa0a864b383a794910cdb215bb836dae12357bc6/src/test/fuzz/process_message.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa0a864b383a794910cdb215bb836dae12357bc6/src/test/fuzz/process_message.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/fuzz/process_message.cpp?ref=fa0a864b383a794910cdb215bb836dae12357bc6",
        "patch": "@@ -55,21 +55,25 @@ void initialize_process_message()\n void fuzz_target(const std::vector<uint8_t>& buffer, const std::string& LIMIT_TO_MESSAGE_TYPE)\n {\n     FuzzedDataProvider fuzzed_data_provider(buffer.data(), buffer.size());\n+\n     ConnmanTestMsg& connman = *(ConnmanTestMsg*)g_setup->m_node.connman.get();\n     TestChainState& chainstate = *(TestChainState*)&g_setup->m_node.chainman->ActiveChainstate();\n+    SetMockTime(1610000000); // any time to successfully reset ibd\n     chainstate.ResetIbd();\n+\n     const std::string random_message_type{fuzzed_data_provider.ConsumeBytesAsString(CMessageHeader::COMMAND_SIZE).c_str()};\n     if (!LIMIT_TO_MESSAGE_TYPE.empty() && random_message_type != LIMIT_TO_MESSAGE_TYPE) {\n         return;\n     }\n-    const bool jump_out_of_ibd{fuzzed_data_provider.ConsumeBool()};\n-    if (jump_out_of_ibd) chainstate.JumpOutOfIbd();\n     CNode& p2p_node = *ConsumeNodeAsUniquePtr(fuzzed_data_provider).release();\n     FillNode(fuzzed_data_provider, p2p_node);\n     p2p_node.fSuccessfullyConnected = true;\n     connman.AddTestNode(p2p_node);\n     g_setup->m_node.peerman->InitializeNode(&p2p_node);\n \n+    const auto mock_time = ConsumeTime(fuzzed_data_provider);\n+    SetMockTime(mock_time);\n+\n     // fuzzed_data_provider is fully consumed after this call, don't use it\n     CDataStream random_bytes_data_stream{fuzzed_data_provider.ConsumeRemainingBytes<unsigned char>(), SER_NETWORK, PROTOCOL_VERSION};\n     try {"
      },
      {
        "sha": "a54a3d5be1fac60695e278c7683a779f81ca4be1",
        "filename": "src/test/fuzz/process_messages.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 4,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa0a864b383a794910cdb215bb836dae12357bc6/src/test/fuzz/process_messages.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa0a864b383a794910cdb215bb836dae12357bc6/src/test/fuzz/process_messages.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/fuzz/process_messages.cpp?ref=fa0a864b383a794910cdb215bb836dae12357bc6",
        "patch": "@@ -41,10 +41,10 @@ FUZZ_TARGET_INIT(process_messages, initialize_process_messages)\n \n     ConnmanTestMsg& connman = *(ConnmanTestMsg*)g_setup->m_node.connman.get();\n     TestChainState& chainstate = *(TestChainState*)&g_setup->m_node.chainman->ActiveChainstate();\n+    SetMockTime(1610000000); // any time to successfully reset ibd\n     chainstate.ResetIbd();\n-    std::vector<CNode*> peers;\n-    bool jump_out_of_ibd{false};\n \n+    std::vector<CNode*> peers;\n     const auto num_peers_to_add = fuzzed_data_provider.ConsumeIntegralInRange(1, 3);\n     for (int i = 0; i < num_peers_to_add; ++i) {\n         peers.push_back(ConsumeNodeAsUniquePtr(fuzzed_data_provider, i).release());\n@@ -59,10 +59,11 @@ FUZZ_TARGET_INIT(process_messages, initialize_process_messages)\n     }\n \n     while (fuzzed_data_provider.ConsumeBool()) {\n-        if (!jump_out_of_ibd) jump_out_of_ibd = fuzzed_data_provider.ConsumeBool();\n-        if (jump_out_of_ibd && chainstate.IsInitialBlockDownload()) chainstate.JumpOutOfIbd();\n         const std::string random_message_type{fuzzed_data_provider.ConsumeBytesAsString(CMessageHeader::COMMAND_SIZE).c_str()};\n \n+        const auto mock_time = ConsumeTime(fuzzed_data_provider);\n+        SetMockTime(mock_time);\n+\n         CSerializedNetMsg net_msg;\n         net_msg.m_type = random_message_type;\n         net_msg.data = ConsumeRandomLengthByteVector(fuzzed_data_provider);"
      }
    ]
  }
]