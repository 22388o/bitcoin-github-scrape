[
  {
    "sha": "484d40e3f10cf6daa9a0af7f32fe4b3b9015b4cf",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0ODRkNDBlM2YxMGNmNmRhYTlhMGFmN2YzMmZlNGIzYjkwMTViNGNm",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2017-02-10T01:24:30Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2017-05-03T04:27:21Z"
      },
      "message": "Add getchaintxstats RPC",
      "tree": {
        "sha": "86af315033afffee3e8850bbea89599ab0ef9a87",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/86af315033afffee3e8850bbea89599ab0ef9a87"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/484d40e3f10cf6daa9a0af7f32fe4b3b9015b4cf",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/484d40e3f10cf6daa9a0af7f32fe4b3b9015b4cf",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/484d40e3f10cf6daa9a0af7f32fe4b3b9015b4cf",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/484d40e3f10cf6daa9a0af7f32fe4b3b9015b4cf/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "36f9d3ae6da48325b0a37ad7fd1abe263a0f2c9a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/36f9d3ae6da48325b0a37ad7fd1abe263a0f2c9a",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/36f9d3ae6da48325b0a37ad7fd1abe263a0f2c9a"
      }
    ],
    "stats": {
      "total": 67,
      "additions": 67,
      "deletions": 0
    },
    "files": [
      {
        "sha": "ecd018f20cc82800c4fa64ba0bb8f1b89350889e",
        "filename": "src/rpc/blockchain.cpp",
        "status": "modified",
        "additions": 66,
        "deletions": 0,
        "changes": 66,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/484d40e3f10cf6daa9a0af7f32fe4b3b9015b4cf/src/rpc/blockchain.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/484d40e3f10cf6daa9a0af7f32fe4b3b9015b4cf/src/rpc/blockchain.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpc/blockchain.cpp?ref=484d40e3f10cf6daa9a0af7f32fe4b3b9015b4cf",
        "patch": "@@ -1413,10 +1413,76 @@ UniValue reconsiderblock(const JSONRPCRequest& request)\n     return NullUniValue;\n }\n \n+UniValue getchaintxstats(const JSONRPCRequest& request)\n+{\n+    if (request.fHelp || request.params.size() > 2)\n+        throw runtime_error(\n+            \"getchaintxstats ( nblocks blockhash )\\n\"\n+            \"\\nCompute statistics about the total number and rate of transactions in the chain.\\n\"\n+            \"\\nArguments:\\n\"\n+            \"1. nblocks      (numeric, optional) Size of the window in number of blocks (default: one month).\\n\"\n+            \"2. \\\"blockhash\\\"  (string, optional) The hash of the block that ends the window.\\n\"\n+            \"\\nResult:\\n\"\n+            \"{\\n\"\n+            \"  \\\"time\\\": xxxxx,        (numeric) The timestamp for the statistics in UNIX format.\\n\"\n+            \"  \\\"txcount\\\": xxxxx,     (numeric) The total number of transactions in the chain up to that point.\\n\"\n+            \"  \\\"txrate\\\": x.xx,       (numeric) The average rate of transactions per second in the window.\\n\"\n+            \"}\\n\"\n+            \"\\nExamples:\\n\"\n+            + HelpExampleCli(\"getchaintxstats\", \"\")\n+            + HelpExampleRpc(\"getchaintxstats\", \"2016\")\n+        );\n+\n+    const CBlockIndex* pindex;\n+    int blockcount = 30 * 24 * 60 * 60 / Params().GetConsensus().nPowTargetSpacing; // By default: 1 month\n+\n+    if (request.params.size() > 0 && !request.params[0].isNull()) {\n+        blockcount = request.params[0].get_int();\n+    }\n+\n+    bool havehash = request.params.size() > 1 && !request.params[1].isNull();\n+    uint256 hash;\n+    if (havehash) {\n+        hash = uint256S(request.params[1].get_str());\n+    }\n+\n+    {\n+        LOCK(cs_main);\n+        if (havehash) {\n+            auto it = mapBlockIndex.find(hash);\n+            if (it == mapBlockIndex.end()) {\n+                throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Block not found\");\n+            }\n+            pindex = it->second;\n+            if (!chainActive.Contains(pindex)) {\n+                throw JSONRPCError(RPC_INVALID_PARAMETER, \"Block is not in main chain\");\n+            }\n+        } else {\n+            pindex = chainActive.Tip();\n+        }\n+    }\n+\n+    if (blockcount < 1 || blockcount >= pindex->nHeight) {\n+        throw JSONRPCError(RPC_INVALID_PARAMETER, \"Invalid block count: should be between 1 and the block's height\");\n+    }\n+\n+    const CBlockIndex* pindexPast = pindex->GetAncestor(pindex->nHeight - blockcount);\n+    int nTimeDiff = pindex->GetMedianTimePast() - pindexPast->GetMedianTimePast();\n+    int nTxDiff = pindex->nChainTx - pindexPast->nChainTx;\n+\n+    UniValue ret(UniValue::VOBJ);\n+    ret.push_back(Pair(\"time\", (int64_t)pindex->nTime));\n+    ret.push_back(Pair(\"txcount\", (int64_t)pindex->nChainTx));\n+    ret.push_back(Pair(\"txrate\", ((double)nTxDiff) / nTimeDiff));\n+\n+    return ret;\n+}\n+\n static const CRPCCommand commands[] =\n { //  category              name                      actor (function)         okSafe argNames\n   //  --------------------- ------------------------  -----------------------  ------ ----------\n     { \"blockchain\",         \"getblockchaininfo\",      &getblockchaininfo,      true,  {} },\n+    { \"blockchain\",         \"getchaintxstats\",        &getchaintxstats,        true,  {\"nblocks\", \"blockhash\"} },\n     { \"blockchain\",         \"getbestblockhash\",       &getbestblockhash,       true,  {} },\n     { \"blockchain\",         \"getblockcount\",          &getblockcount,          true,  {} },\n     { \"blockchain\",         \"getblock\",               &getblock,               true,  {\"blockhash\",\"verbose\"} },"
      },
      {
        "sha": "68e43dfadbe23975630279de553a2650d145da1a",
        "filename": "src/rpc/client.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/484d40e3f10cf6daa9a0af7f32fe4b3b9015b4cf/src/rpc/client.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/484d40e3f10cf6daa9a0af7f32fe4b3b9015b4cf/src/rpc/client.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpc/client.cpp?ref=484d40e3f10cf6daa9a0af7f32fe4b3b9015b4cf",
        "patch": "@@ -81,6 +81,7 @@ static const CRPCConvertParam vRPCConvertParams[] =\n     { \"listunspent\", 2, \"addresses\" },\n     { \"getblock\", 1, \"verbose\" },\n     { \"getblockheader\", 1, \"verbose\" },\n+    { \"getchaintxstats\", 0, \"nblocks\" },\n     { \"gettransaction\", 1, \"include_watchonly\" },\n     { \"getrawtransaction\", 1, \"verbose\" },\n     { \"createrawtransaction\", 0, \"transactions\" },"
      }
    ]
  }
]