[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/791110639",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21366#issuecomment-791110639",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21366",
    "id": 791110639,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5MTExMDYzOQ==",
    "user": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?u=a0e0040aacd7d4f0787481e8ac30b494fa429e11&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-05T02:49:17Z",
    "updated_at": "2021-03-05T02:49:17Z",
    "author_association": "MEMBER",
    "body": "Concept ACK on removing no-longer  needed abstraction. [Currently failing to compile](https://cirrus-ci.com/task/5067477362147328?command=ci#L2464):\r\n```bash\r\n  CXX      wallet/libbitcoin_wallet_a-coincontrol.o\r\nIn file included from /usr/include/c++/9/bits/move.h:55,\r\n                 from /usr/include/c++/9/bits/nested_exception.h:40,\r\n                 from /usr/include/c++/9/exception:144,\r\n                 from /usr/include/c++/9/new:40,\r\n                 from /usr/include/c++/9/any:37,\r\n                 from ./rpc/request.h:9,\r\n                 from ./rpc/server.h:10,\r\n                 from rpc/server.cpp:6:\r\n/usr/include/c++/9/type_traits: In instantiation of \u2018struct std::__and_<std::is_copy_constructible<JSONRPCRequest>, std::__not_<std::is_constructible<JSONRPCRequest, const JSONRPCRequest&> >, std::__not_<std::__is_in_place_type<JSONRPCRequest> > >\u2019:\r\n/usr/include/c++/9/type_traits:150:27:   required from \u2018constexpr const bool std::__and_v<std::is_copy_constructible<JSONRPCRequest>, std::__not_<std::is_constructible<JSONRPCRequest, const JSONRPCRequest&> >, std::__not_<std::__is_in_place_type<JSONRPCRequest> > >\u2019\r\n/usr/include/c++/9/any:192:27:   required by substitution of \u2018template<class _ValueType, class _Tp, class _Mgr, typename std::enable_if<__and_v<std::is_copy_constructible<_Tp>, std::__not_<std::is_constructible<_Tp, _ValueType&&> >, std::__not_<std::__is_in_place_type<_Tp> > >, bool>::type <anonymous> > std::any::any(_ValueType&&) [with _ValueType = const JSONRPCRequest&; _Tp = JSONRPCRequest; _Mgr = std::any::_Manager_external<JSONRPCRequest>; typename std::enable_if<__and_v<std::is_copy_constructible<_Tp>, std::__not_<std::is_constructible<_Tp, _ValueType&&> >, std::__not_<std::__is_in_place_type<_Tp> > >, bool>::type <anonymous> = <missing>]\u2019\r\n/usr/include/c++/9/type_traits:883:12:   required from \u2018struct std::is_constructible<JSONRPCRequest, const JSONRPCRequest&>\u2019\r\n/usr/include/c++/9/type_traits:901:12:   required from \u2018struct std::__is_copy_constructible_impl<JSONRPCRequest, true>\u2019\r\n/usr/include/c++/9/type_traits:907:12:   required from \u2018struct std::is_copy_constructible<JSONRPCRequest>\u2019\r\n/usr/include/c++/9/type_traits:131:12:   required from \u2018struct std::__and_<std::is_copy_constructible<JSONRPCRequest>, std::is_constructible<JSONRPCRequest, const JSONRPCRequest&> >\u2019\r\n/usr/include/c++/9/any:181:58:   required by substitution of \u2018template<class _ValueType, class _Tp, class _Mgr, typename std::enable_if<std::__and_<std::is_copy_constructible<_Tp>, std::is_constructible<_Tp, _ValueType&&> >::value, bool>::type <anonymous>, typename std::enable_if<(! std::__is_in_place_type<_Tp>::value), bool>::type <anonymous> > std::any::any(_ValueType&&) [with _ValueType = const JSONRPCRequest&; _Tp = JSONRPCRequest; _Mgr = std::any::_Manager_external<JSONRPCRequest>; typename std::enable_if<std::__and_<std::is_copy_constructible<_Tp>, std::is_constructible<_Tp, _ValueType&&> >::value, bool>::type <anonymous> = <missing>; typename std::enable_if<(! std::__is_in_place_type<_Tp>::value), bool>::type <anonymous> = <missing>]\u2019\r\nrpc/server.cpp:91:32:   required from here\r\n/usr/include/c++/9/type_traits:136:12: error: incomplete type \u2018std::is_copy_constructible<JSONRPCRequest>\u2019 used in nested name specifier\r\n  136 |     struct __and_<_B1, _B2, _B3, _Bn...>\r\n      |            ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n/usr/include/c++/9/type_traits: In instantiation of \u2018constexpr const bool std::__and_v<std::is_copy_constructible<JSONRPCRequest>, std::__not_<std::is_constructible<JSONRPCRequest, const JSONRPCRequest&> >, std::__not_<std::__is_in_place_type<JSONRPCRequest> > >\u2019:\r\n/usr/include/c++/9/any:192:27:   required by substitution of \u2018template<class _ValueType, class _Tp, class _Mgr, typename std::enable_if<__and_v<std::is_copy_constructible<_Tp>, std::__not_<std::is_constructible<_Tp, _ValueType&&> >, std::__not_<std::__is_in_place_type<_Tp> > >, bool>::type <anonymous> > std::any::any(_ValueType&&) [with _ValueType = const JSONRPCRequest&; _Tp = JSONRPCRequest; _Mgr = std::any::_Manager_external<JSONRPCRequest>; typename std::enable_if<__and_v<std::is_copy_constructible<_Tp>, std::__not_<std::is_constructible<_Tp, _ValueType&&> >, std::__not_<std::__is_in_place_type<_Tp> > >, bool>::type <anonymous> = <missing>]\u2019\r\n/usr/include/c++/9/type_traits:883:12:   required from \u2018struct std::is_constructible<JSONRPCRequest, const JSONRPCRequest&>\u2019\r\n/usr/include/c++/9/type_traits:901:12:   required from \u2018struct std::__is_copy_constructible_impl<JSONRPCRequest, true>\u2019\r\n/usr/include/c++/9/type_traits:907:12:   required from \u2018struct std::is_copy_constructible<JSONRPCRequest>\u2019\r\n/usr/include/c++/9/type_traits:131:12:   required from \u2018struct std::__and_<std::is_copy_constructible<JSONRPCRequest>, std::is_constructible<JSONRPCRequest, const JSONRPCRequest&> >\u2019\r\n/usr/include/c++/9/any:181:58:   required by substitution of \u2018template<class _ValueType, class _Tp, class _Mgr, typename std::enable_if<std::__and_<std::is_copy_constructible<_Tp>, std::is_constructible<_Tp, _ValueType&&> >::value, bool>::type <anonymous>, typename std::enable_if<(! std::__is_in_place_type<_Tp>::value), bool>::type <anonymous> > std::any::any(_ValueType&&) [with _ValueType = const JSONRPCRequest&; _Tp = JSONRPCRequest; _Mgr = std::any::_Manager_external<JSONRPCRequest>; typename std::enable_if<std::__and_<std::is_copy_constructible<_Tp>, std::is_constructible<_Tp, _ValueType&&> >::value, bool>::type <anonymous> = <missing>; typename std::enable_if<(! std::__is_in_place_type<_Tp>::value), bool>::type <anonymous> = <missing>]\u2019\r\nrpc/server.cpp:91:32:   required from here\r\n/usr/include/c++/9/type_traits:150:27: error: \u2018value\u2019 is not a member of \u2018std::__and_<std::is_copy_constructible<JSONRPCRequest>, std::__not_<std::is_constructible<JSONRPCRequest, const JSONRPCRequest&> >, std::__not_<std::__is_in_place_type<JSONRPCRequest> > >\u2019\r\n  150 |     inline constexpr bool __and_v = __and_<_Bn...>::value;\r\n      |                           ^~~~~~~\r\nmake[2]: *** [Makefile:8807: rpc/libbitcoin_server_a-server.o] Error 1\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/791110639/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/791310076",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21366#issuecomment-791310076",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21366",
    "id": 791310076,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5MTMxMDA3Ng==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-05T09:56:10Z",
    "updated_at": "2021-03-31T19:22:58Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20459 (rpc: Fail to return undocumented return values by MarcoFalke)\n* #19101 (refactor: remove ::vpwallets and related global variables by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/791310076/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/791407659",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21366#issuecomment-791407659",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21366",
    "id": 791407659,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5MTQwNzY1OQ==",
    "user": {
      "login": "theStack",
      "id": 91535,
      "node_id": "MDQ6VXNlcjkxNTM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theStack",
      "html_url": "https://github.com/theStack",
      "followers_url": "https://api.github.com/users/theStack/followers",
      "following_url": "https://api.github.com/users/theStack/following{/other_user}",
      "gists_url": "https://api.github.com/users/theStack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theStack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
      "organizations_url": "https://api.github.com/users/theStack/orgs",
      "repos_url": "https://api.github.com/users/theStack/repos",
      "events_url": "https://api.github.com/users/theStack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theStack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-05T13:05:37Z",
    "updated_at": "2021-03-05T13:05:37Z",
    "author_association": "CONTRIBUTOR",
    "body": "Meh, there seems to be a problem with the (default) copy-constructor of `class JSONRPCRequest` that is invoked in `CRPCTable::help`:\r\n```\r\n... (..., const JSONRPCRequest& helpreq) {\r\n    ...\r\n    JSONRPCRequest jreq(helpreq);\r\n    ...\r\n}\r\n```\r\nNo idea why this compiles locally with clang11 and obviously also for the CI jobs for MacOS and ARM.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/791407659/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/791472457",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21366#issuecomment-791472457",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21366",
    "id": 791472457,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5MTQ3MjQ1Nw==",
    "user": {
      "login": "theStack",
      "id": 91535,
      "node_id": "MDQ6VXNlcjkxNTM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theStack",
      "html_url": "https://github.com/theStack",
      "followers_url": "https://api.github.com/users/theStack/followers",
      "following_url": "https://api.github.com/users/theStack/following{/other_user}",
      "gists_url": "https://api.github.com/users/theStack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theStack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
      "organizations_url": "https://api.github.com/users/theStack/orgs",
      "repos_url": "https://api.github.com/users/theStack/repos",
      "events_url": "https://api.github.com/users/theStack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theStack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-05T14:59:26Z",
    "updated_at": "2021-03-05T14:59:26Z",
    "author_association": "CONTRIBUTOR",
    "body": "Force-pushed with suggestions by @ryanofsky (https://github.com/bitcoin/bitcoin/pull/21366#discussion_r588287531): introduced a helper `AnyPtr` to access `std::any` contents and generally assigned pointers to std::any instances instead of references. Code looks much cleaner now.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/791472457/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/792044351",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21366#issuecomment-792044351",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21366",
    "id": 792044351,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5MjA0NDM1MQ==",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-06T20:09:57Z",
    "updated_at": "2021-03-06T20:09:57Z",
    "author_association": "CONTRIBUTOR",
    "body": "Another batch of simplifications you could consider. There's no need really to require request objects to have contexts assigned.\r\n\r\n<details><summary>diff</summary>\r\n<p>\r\n\r\n```diff\r\ndiff --git a/src/bitcoind.cpp b/src/bitcoind.cpp\r\nindex 87c63593051..7d246325e44 100644\r\n--- a/src/bitcoind.cpp\r\n+++ b/src/bitcoind.cpp\r\n@@ -131,7 +131,7 @@ static bool AppInit(int argc, char* argv[])\r\n             // If locking the data directory failed, exit immediately\r\n             return false;\r\n         }\r\n-        fRet = AppInitInterfaces(node) && AppInitMain(context, node);\r\n+        fRet = AppInitInterfaces(node) && AppInitMain(node);\r\n     }\r\n     catch (const std::exception& e) {\r\n         PrintExceptionContinue(&e, \"AppInit()\");\r\ndiff --git a/src/httprpc.cpp b/src/httprpc.cpp\r\nindex d33e671ee42..cd45eccc4ed 100644\r\n--- a/src/httprpc.cpp\r\n+++ b/src/httprpc.cpp\r\n@@ -159,7 +159,8 @@ static bool HTTPReq_JSONRPC(const std::any& context, HTTPRequest* req)\r\n         return false;\r\n     }\r\n \r\n-    JSONRPCRequest jreq(context);\r\n+    JSONRPCRequest jreq;\r\n+    jreq.context = context;\r\n     jreq.peerAddr = req->GetPeer().ToString();\r\n     if (!RPCAuthorized(authHeader.second, jreq.authUser)) {\r\n         LogPrintf(\"ThreadRPCServer incorrect password attempt from %s\\n\", jreq.peerAddr);\r\n@@ -294,7 +295,7 @@ bool StartHTTPRPC(const std::any& context)\r\n     if (!InitRPCAuthentication())\r\n         return false;\r\n \r\n-    auto handle_rpc = [&context](HTTPRequest* req, const std::string&) { return HTTPReq_JSONRPC(context, req); };\r\n+    auto handle_rpc = [context](HTTPRequest* req, const std::string&) { return HTTPReq_JSONRPC(context, req); };\r\n     RegisterHTTPHandler(\"/\", true, handle_rpc);\r\n     if (g_wallet_init_interface.HasWalletSupport()) {\r\n         RegisterHTTPHandler(\"/wallet/\", false, handle_rpc);\r\ndiff --git a/src/init.cpp b/src/init.cpp\r\nindex efb92802126..c166af10f1f 100644\r\n--- a/src/init.cpp\r\n+++ b/src/init.cpp\r\n@@ -785,7 +785,7 @@ static bool InitSanityCheck()\r\n     return true;\r\n }\r\n \r\n-static bool AppInitServers(const std::any& context, NodeContext& node)\r\n+static bool AppInitServers(NodeContext& node)\r\n {\r\n     const ArgsManager& args = *Assert(node.args);\r\n     RPCServer::OnStarted(&OnRPCStarted);\r\n@@ -794,9 +794,9 @@ static bool AppInitServers(const std::any& context, NodeContext& node)\r\n         return false;\r\n     StartRPC();\r\n     node.rpc_interruption_point = RpcInterruptionPoint;\r\n-    if (!StartHTTPRPC(context))\r\n+    if (!StartHTTPRPC(&node))\r\n         return false;\r\n-    if (args.GetBoolArg(\"-rest\", DEFAULT_REST_ENABLE)) StartREST(context);\r\n+    if (args.GetBoolArg(\"-rest\", DEFAULT_REST_ENABLE)) StartREST(&node);\r\n     StartHTTPServer();\r\n     return true;\r\n }\r\n@@ -1274,7 +1274,7 @@ bool AppInitInterfaces(NodeContext& node)\r\n     return true;\r\n }\r\n \r\n-bool AppInitMain(const std::any& context, NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\r\n+bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\r\n {\r\n     const ArgsManager& args = *Assert(node.args);\r\n     const CChainParams& chainparams = Params();\r\n@@ -1379,7 +1379,7 @@ bool AppInitMain(const std::any& context, NodeContext& node, interfaces::BlockAn\r\n      */\r\n     if (args.GetBoolArg(\"-server\", false)) {\r\n         uiInterface.InitMessage_connect(SetRPCWarmupStatus);\r\n-        if (!AppInitServers(context, node))\r\n+        if (!AppInitServers(node))\r\n             return InitError(_(\"Unable to start HTTP server. See debug log for details.\"));\r\n     }\r\n \r\ndiff --git a/src/init.h b/src/init.h\r\nindex fe1c66202bf..d8fcb1e0ce3 100644\r\n--- a/src/init.h\r\n+++ b/src/init.h\r\n@@ -59,7 +59,7 @@ bool AppInitInterfaces(NodeContext& node);\r\n  * @note This should only be done after daemonization. Call Shutdown() if this function fails.\r\n  * @pre Parameters should be parsed and config file should be read, AppInitLockDataDirectory should have been called.\r\n  */\r\n-bool AppInitMain(const std::any& context, NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info = nullptr);\r\n+bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info = nullptr);\r\n \r\n /**\r\n  * Register all arguments with the ArgsManager\r\ndiff --git a/src/node/interfaces.cpp b/src/node/interfaces.cpp\r\nindex 8cf0dee5b4e..7d195688032 100644\r\n--- a/src/node/interfaces.cpp\r\n+++ b/src/node/interfaces.cpp\r\n@@ -76,7 +76,7 @@ public:\r\n     }\r\n     bool appInitMain(interfaces::BlockAndHeaderTipInfo* tip_info) override\r\n     {\r\n-        return AppInitMain(m_context_ref, *m_context, tip_info);\r\n+        return AppInitMain(*m_context, tip_info);\r\n     }\r\n     void appShutdown() override\r\n     {\r\n@@ -218,7 +218,8 @@ public:\r\n     CFeeRate getDustRelayFee() override { return ::dustRelayFee; }\r\n     UniValue executeRpc(const std::string& command, const UniValue& params, const std::string& uri) override\r\n     {\r\n-        JSONRPCRequest req(m_context_ref);\r\n+        JSONRPCRequest req;\r\n+        req.context = m_context;\r\n         req.params = params;\r\n         req.strMethod = command;\r\n         req.URI = uri;\r\n@@ -287,14 +288,8 @@ public:\r\n     void setContext(NodeContext* context) override\r\n     {\r\n         m_context = context;\r\n-        if (context) {\r\n-            m_context_ref = context;\r\n-        } else {\r\n-            m_context_ref.reset();\r\n-        }\r\n     }\r\n     NodeContext* m_context{nullptr};\r\n-    std::any m_context_ref;\r\n };\r\n \r\n bool FillBlock(const CBlockIndex* index, const FoundBlock& block, UniqueLock<RecursiveMutex>& lock, const CChain& active)\r\ndiff --git a/src/rest.cpp b/src/rest.cpp\r\nindex 452435f3e92..e2af5128121 100644\r\n--- a/src/rest.cpp\r\n+++ b/src/rest.cpp\r\n@@ -317,7 +317,8 @@ static bool rest_chaininfo(const std::any& context, HTTPRequest* req, const std:\r\n \r\n     switch (rf) {\r\n     case RetFormat::JSON: {\r\n-        JSONRPCRequest jsonRequest(context);\r\n+        JSONRPCRequest jsonRequest;\r\n+        jsonRequest.context = context;\r\n         jsonRequest.params = UniValue(UniValue::VARR);\r\n         UniValue chainInfoObject = getblockchaininfo().HandleRequest(jsonRequest);\r\n         std::string strJSON = chainInfoObject.write() + \"\\n\";\r\n@@ -687,7 +688,7 @@ static const struct {\r\n void StartREST(const std::any& context)\r\n {\r\n     for (const auto& up : uri_prefixes) {\r\n-        auto handler = [&context, up](HTTPRequest* req, const std::string& prefix) { return up.handler(context, req, prefix); };\r\n+        auto handler = [context, up](HTTPRequest* req, const std::string& prefix) { return up.handler(context, req, prefix); };\r\n         RegisterHTTPHandler(up.prefix, false, handler);\r\n     }\r\n }\r\ndiff --git a/src/rpc/request.h b/src/rpc/request.h\r\nindex 82d8fdc63ae..7a78d382cc9 100644\r\n--- a/src/rpc/request.h\r\n+++ b/src/rpc/request.h\r\n@@ -35,18 +35,7 @@ public:\r\n     std::string URI;\r\n     std::string authUser;\r\n     std::string peerAddr;\r\n-    const std::any& context;\r\n-\r\n-    explicit JSONRPCRequest(const std::any& context) : id(NullUniValue), params(NullUniValue), fHelp(false), context(context) {}\r\n-\r\n-    //! Initializes request information from another request object and the\r\n-    //! given context. The implementation should be updated if any members are\r\n-    //! added or removed above.\r\n-    JSONRPCRequest(const JSONRPCRequest& other, const std::any& context)\r\n-        : id(other.id), strMethod(other.strMethod), params(other.params), fHelp(other.fHelp), URI(other.URI),\r\n-          authUser(other.authUser), peerAddr(other.peerAddr), context(context)\r\n-    {\r\n-    }\r\n+    std::any context;\r\n \r\n     void parse(const UniValue& valRequest);\r\n };\r\ndiff --git a/src/rpc/server.cpp b/src/rpc/server.cpp\r\nindex 3d5216055ce..f16adf96d3e 100644\r\n--- a/src/rpc/server.cpp\r\n+++ b/src/rpc/server.cpp\r\n@@ -88,7 +88,7 @@ std::string CRPCTable::help(const std::string& strCommand, const JSONRPCRequest&\r\n         vCommands.push_back(make_pair(entry.second.front()->category + entry.first, entry.second.front()));\r\n     sort(vCommands.begin(), vCommands.end());\r\n \r\n-    JSONRPCRequest jreq(&helpreq);\r\n+    JSONRPCRequest jreq(helpreq);\r\n     jreq.fHelp = true;\r\n     jreq.params = UniValue();\r\n \r\ndiff --git a/src/test/rpc_tests.cpp b/src/test/rpc_tests.cpp\r\nindex 4ffc2478696..d2749c89599 100644\r\n--- a/src/test/rpc_tests.cpp\r\n+++ b/src/test/rpc_tests.cpp\r\n@@ -33,8 +33,8 @@ UniValue RPCTestingSetup::CallRPC(std::string args)\r\n     boost::split(vArgs, args, boost::is_any_of(\" \\t\"));\r\n     std::string strMethod = vArgs[0];\r\n     vArgs.erase(vArgs.begin());\r\n-    std::any context{&m_node};\r\n-    JSONRPCRequest request(context);\r\n+    JSONRPCRequest request;\r\n+    request.context = &m_node;\r\n     request.strMethod = strMethod;\r\n     request.params = RPCConvertValues(strMethod, vArgs);\r\n     request.fHelp = false;\r\ndiff --git a/src/wallet/interfaces.cpp b/src/wallet/interfaces.cpp\r\nindex c91ede94f95..46533d8704c 100644\r\n--- a/src/wallet/interfaces.cpp\r\n+++ b/src/wallet/interfaces.cpp\r\n@@ -514,7 +514,9 @@ public:\r\n     {\r\n         for (const CRPCCommand& command : GetWalletRPCCommands()) {\r\n             m_rpc_commands.emplace_back(command.category, command.name, [this, &command](const JSONRPCRequest& request, UniValue& result, bool last_handler) {\r\n-                return command.actor({request, &m_context}, result, last_handler);\r\n+                JSONRPCRequest wrapped = request;\r\n+                wrapped.context = &m_context;\r\n+                return command.actor(wrapped, result, last_handler);\r\n             }, command.argNames, command.unique_id);\r\n             m_rpc_handlers.emplace_back(m_context.chain->handleRpc(m_rpc_commands.back()));\r\n         }\r\ndiff --git a/src/wallet/test/wallet_tests.cpp b/src/wallet/test/wallet_tests.cpp\r\nindex e48f7b4d4f5..a9c20921abd 100644\r\n--- a/src/wallet/test/wallet_tests.cpp\r\n+++ b/src/wallet/test/wallet_tests.cpp\r\n@@ -213,8 +213,7 @@ BOOST_FIXTURE_TEST_CASE(importmulti_rescan, TestChain100Setup)\r\n         key.pushKV(\"timestamp\", newTip->GetBlockTimeMax() + TIMESTAMP_WINDOW + 1);\r\n         key.pushKV(\"internal\", UniValue(true));\r\n         keys.push_back(key);\r\n-        std::any context;\r\n-        JSONRPCRequest request(context);\r\n+        JSONRPCRequest request;\r\n         request.params.setArray();\r\n         request.params.push_back(keys);\r\n \r\n@@ -265,8 +264,7 @@ BOOST_FIXTURE_TEST_CASE(importwallet_rescan, TestChain100Setup)\r\n             AddWallet(wallet);\r\n             wallet->SetLastBlockProcessed(::ChainActive().Height(), ::ChainActive().Tip()->GetBlockHash());\r\n         }\r\n-        std::any context;\r\n-        JSONRPCRequest request(context);\r\n+        JSONRPCRequest request;\r\n         request.params.setArray();\r\n         request.params.push_back(backup_file);\r\n \r\n@@ -281,8 +279,7 @@ BOOST_FIXTURE_TEST_CASE(importwallet_rescan, TestChain100Setup)\r\n         LOCK(wallet->cs_wallet);\r\n         wallet->SetupLegacyScriptPubKeyMan();\r\n \r\n-        std::any context;\r\n-        JSONRPCRequest request(context);\r\n+        JSONRPCRequest request;\r\n         request.params.setArray();\r\n         request.params.push_back(backup_file);\r\n         AddWallet(wallet);\r\n```\r\n</p>\r\n</details>",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/792044351/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/792124283",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21366#issuecomment-792124283",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21366",
    "id": 792124283,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5MjEyNDI4Mw==",
    "user": {
      "login": "theStack",
      "id": 91535,
      "node_id": "MDQ6VXNlcjkxNTM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theStack",
      "html_url": "https://github.com/theStack",
      "followers_url": "https://api.github.com/users/theStack/followers",
      "following_url": "https://api.github.com/users/theStack/following{/other_user}",
      "gists_url": "https://api.github.com/users/theStack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theStack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
      "organizations_url": "https://api.github.com/users/theStack/orgs",
      "repos_url": "https://api.github.com/users/theStack/repos",
      "events_url": "https://api.github.com/users/theStack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theStack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-06T23:59:42Z",
    "updated_at": "2021-03-07T00:03:25Z",
    "author_association": "CONTRIBUTOR",
    "body": "Force-pushed with feedback from @JeremyRubin (https://github.com/bitcoin/bitcoin/pull/21366#discussion_r588921151) and @ryanofsky (https://github.com/bitcoin/bitcoin/pull/21366#discussion_r588923880) taken into account: `AnyPtr` uses now the variant of `std::any_cast` that doesn't use exceptions. Also updated the PR description which still referred to the changeset without the `AnyPtr` helper and the exception variant of `std::any_cast`.\r\n\r\n> Another batch of simplifications you could consider. There's no need really to require request objects to have contexts assigned.\r\n\r\nGood idea. I think those changes are out of scope for this PR, as the proposed simplifications are not connected to the `util::Ref`/`std::any` replacements. Happy to open a follow-up PR though or review if someone else does.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/792124283/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/792329779",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21366#issuecomment-792329779",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21366",
    "id": 792329779,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5MjMyOTc3OQ==",
    "user": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?u=5ff13e375b40ea55ecd3c108337dd6a23f68eddf&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-07T18:31:35Z",
    "updated_at": "2021-03-07T18:31:35Z",
    "author_association": "CONTRIBUTOR",
    "body": "Concept ACK\r\n\r\n+89 \u2212155 -- very nice! :)",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/792329779/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/796031037",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21366#issuecomment-796031037",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21366",
    "id": 796031037,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5NjAzMTAzNw==",
    "user": {
      "login": "theStack",
      "id": 91535,
      "node_id": "MDQ6VXNlcjkxNTM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theStack",
      "html_url": "https://github.com/theStack",
      "followers_url": "https://api.github.com/users/theStack/followers",
      "following_url": "https://api.github.com/users/theStack/following{/other_user}",
      "gists_url": "https://api.github.com/users/theStack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theStack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
      "organizations_url": "https://api.github.com/users/theStack/orgs",
      "repos_url": "https://api.github.com/users/theStack/repos",
      "events_url": "https://api.github.com/users/theStack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theStack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-10T20:18:16Z",
    "updated_at": "2021-03-10T20:18:16Z",
    "author_association": "CONTRIBUTOR",
    "body": "Rebased on master.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/796031037/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/799860466",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21366#issuecomment-799860466",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21366",
    "id": 799860466,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5OTg2MDQ2Ng==",
    "user": {
      "login": "theStack",
      "id": 91535,
      "node_id": "MDQ6VXNlcjkxNTM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theStack",
      "html_url": "https://github.com/theStack",
      "followers_url": "https://api.github.com/users/theStack/followers",
      "following_url": "https://api.github.com/users/theStack/following{/other_user}",
      "gists_url": "https://api.github.com/users/theStack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theStack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
      "organizations_url": "https://api.github.com/users/theStack/orgs",
      "repos_url": "https://api.github.com/users/theStack/repos",
      "events_url": "https://api.github.com/users/theStack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theStack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-16T00:49:58Z",
    "updated_at": "2021-03-16T00:49:58Z",
    "author_association": "CONTRIBUTOR",
    "body": "Rebased on master again.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/799860466/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/808823725",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21366#issuecomment-808823725",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21366",
    "id": 808823725,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgwODgyMzcyNQ==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-28T00:38:45Z",
    "updated_at": "2021-03-28T00:38:45Z",
    "author_association": "MEMBER",
    "body": "Concept ACK.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/808823725/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/809735068",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21366#issuecomment-809735068",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21366",
    "id": 809735068,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgwOTczNTA2OA==",
    "user": {
      "login": "theStack",
      "id": 91535,
      "node_id": "MDQ6VXNlcjkxNTM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theStack",
      "html_url": "https://github.com/theStack",
      "followers_url": "https://api.github.com/users/theStack/followers",
      "following_url": "https://api.github.com/users/theStack/following{/other_user}",
      "gists_url": "https://api.github.com/users/theStack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theStack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
      "organizations_url": "https://api.github.com/users/theStack/orgs",
      "repos_url": "https://api.github.com/users/theStack/repos",
      "events_url": "https://api.github.com/users/theStack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theStack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-29T21:45:19Z",
    "updated_at": "2021-03-29T21:45:19Z",
    "author_association": "CONTRIBUTOR",
    "body": "Rebased on master and took in all suggestions by @hebasto (https://github.com/bitcoin/bitcoin/pull/21366#pullrequestreview-622716405) -- thanks a lot for reviewing!",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/809735068/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588287531",
    "pull_request_review_id": 605127354,
    "id": 588287531,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4ODI4NzUzMQ==",
    "diff_hunk": "@@ -94,9 +96,15 @@ static NodeContext* GetNodeContext(const util::Ref& context, HTTPRequest* req)\n  *                 context mempool is not found.\n  * @returns        Pointer to the mempool or nullptr if no mempool found.\n  */\n-static CTxMemPool* GetMemPool(const util::Ref& context, HTTPRequest* req)\n+static CTxMemPool* GetMemPool(const std::any& context, HTTPRequest* req)\n {\n-    NodeContext* node = context.Has<NodeContext>() ? &context.Get<NodeContext>() : nullptr;\n+    const NodeContext* node;\n+    try {\n+        NodeContext& node_context = std::any_cast<std::reference_wrapper<NodeContext>>(context);\n+        node = &node_context;\n+    } catch (const std::bad_any_cast&) {\n+        node = nullptr;\n+    }",
    "path": "src/rest.cpp",
    "position": null,
    "original_position": 51,
    "commit_id": "916ab0195d567fd0a9097045e73a6654c453adea",
    "original_commit_id": "c6686a3a582670618b685e69bdfa2ba893b5ce92",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"refactor: replace util::Ref by std::any (C++17)\" (c6686a3a582670618b685e69bdfa2ba893b5ce92)\r\n\r\nThis change and other changes in this commit seems pretty obscure and verbose. It would be nice to define a helper function so these 7 lines could be just be replaced with:\r\n\r\n```c++\r\nconst NodeContext* node = util::AnyPtr<NodeContext>(context);\r\n```\r\n\r\nHelper could go in `util/system.h` and look like:\r\n\r\n```c++\r\ntemplate<typename T>\r\nT* AnyPtr(const std::any& any)\r\n{\r\n    try {\r\n        return std::any_cast<T*>(any);\r\n    } catch (const std::bad_any_cast&) {\r\n        return nullptr;\r\n    }\r\n}\r\n```\r\n\r\nAlso I think it would be better to just assign `context = &node` instead of `context = std::ref(node)`. I think the only reason you would use reference_wrappers instead of pointers is when you want non-nullable references, but std::any is inherently nullable so combining it with std::reference_wrapper just makes things complicated for no benefit.",
    "created_at": "2021-03-05T13:15:01Z",
    "updated_at": "2021-03-29T21:35:59Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r588287531",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588287531"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r588287531"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588287531/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 99,
    "start_side": "LEFT",
    "line": null,
    "original_line": 107,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588356462",
    "pull_request_review_id": 605296631,
    "id": 588356462,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4ODM1NjQ2Mg==",
    "diff_hunk": "@@ -94,9 +96,15 @@ static NodeContext* GetNodeContext(const util::Ref& context, HTTPRequest* req)\n  *                 context mempool is not found.\n  * @returns        Pointer to the mempool or nullptr if no mempool found.\n  */\n-static CTxMemPool* GetMemPool(const util::Ref& context, HTTPRequest* req)\n+static CTxMemPool* GetMemPool(const std::any& context, HTTPRequest* req)\n {\n-    NodeContext* node = context.Has<NodeContext>() ? &context.Get<NodeContext>() : nullptr;\n+    const NodeContext* node;\n+    try {\n+        NodeContext& node_context = std::any_cast<std::reference_wrapper<NodeContext>>(context);\n+        node = &node_context;\n+    } catch (const std::bad_any_cast&) {\n+        node = nullptr;\n+    }",
    "path": "src/rest.cpp",
    "position": null,
    "original_position": 51,
    "commit_id": "916ab0195d567fd0a9097045e73a6654c453adea",
    "original_commit_id": "c6686a3a582670618b685e69bdfa2ba893b5ce92",
    "user": {
      "login": "theStack",
      "id": 91535,
      "node_id": "MDQ6VXNlcjkxNTM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theStack",
      "html_url": "https://github.com/theStack",
      "followers_url": "https://api.github.com/users/theStack/followers",
      "following_url": "https://api.github.com/users/theStack/following{/other_user}",
      "gists_url": "https://api.github.com/users/theStack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theStack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
      "organizations_url": "https://api.github.com/users/theStack/orgs",
      "repos_url": "https://api.github.com/users/theStack/repos",
      "events_url": "https://api.github.com/users/theStack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theStack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Both introducing a `std::any` access helper and using pointers instead of references are great ideas, thanks! Looks much cleaner now, with the clunky try/catch-construct deduplicated and hidden in util/system.h.",
    "created_at": "2021-03-05T14:57:45Z",
    "updated_at": "2021-03-29T21:35:59Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r588356462",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588356462"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r588356462"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588356462/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 99,
    "start_side": "LEFT",
    "line": null,
    "original_line": 107,
    "side": "RIGHT",
    "in_reply_to_id": 588287531
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588895346",
    "pull_request_review_id": 605765026,
    "id": 588895346,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4ODg5NTM0Ng==",
    "diff_hunk": "@@ -87,7 +88,7 @@ std::string CRPCTable::help(const std::string& strCommand, const JSONRPCRequest&\n         vCommands.push_back(make_pair(entry.second.front()->category + entry.first, entry.second.front()));\n     sort(vCommands.begin(), vCommands.end());\n \n-    JSONRPCRequest jreq(helpreq);\n+    JSONRPCRequest jreq(&helpreq);",
    "path": "src/rpc/server.cpp",
    "position": null,
    "original_position": 13,
    "commit_id": "916ab0195d567fd0a9097045e73a6654c453adea",
    "original_commit_id": "feb55dde39e59a2709ecefff848a1d8eb9fe69ca",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"refactor: replace util::Ref by std::any (C++17)\" (feb55dde39e59a2709ecefff848a1d8eb9fe69ca)\r\n\r\nThere's a bug here ~and this change should be reverted~. This line is supposed to create `jreq` as a copy of `helpreq` using the `JSONRPCRequest` copy constructor. Now it creates a new `jreq` request using the `helpreq` object as an embedded request context.\r\n\r\nI'm not sure if this is a new bug, or this bug was present previously (even previously `util::Ref` constructor might have take precedence over copy constructor), but passing `&helpreq` here is not intended.\r\n\r\n---\r\n\r\nEDIT: Instead of reverting this, would suggest changing it to:\r\n\r\n```\r\nJSONRPCRequest jreq = helpreq;\r\n```\r\n\r\nThis would be more clear and prevent the context constructor from being called (since it's marked explicit).",
    "created_at": "2021-03-06T15:34:42Z",
    "updated_at": "2021-03-29T21:35:59Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r588895346",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588895346"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r588895346"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588895346/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 91,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588896097",
    "pull_request_review_id": 605765026,
    "id": 588896097,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4ODg5NjA5Nw==",
    "diff_hunk": "@@ -38,14 +35,14 @@ class JSONRPCRequest\n     std::string URI;\n     std::string authUser;\n     std::string peerAddr;\n-    const util::Ref& context;\n+    const std::any& context;\n \n-    explicit JSONRPCRequest(const util::Ref& context) : id(NullUniValue), params(NullUniValue), fHelp(false), context(context) {}\n+    explicit JSONRPCRequest(const std::any& context) : id(NullUniValue), params(NullUniValue), fHelp(false), context(context) {}",
    "path": "src/rpc/request.h",
    "position": null,
    "original_position": 24,
    "commit_id": "916ab0195d567fd0a9097045e73a6654c453adea",
    "original_commit_id": "feb55dde39e59a2709ecefff848a1d8eb9fe69ca",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"refactor: replace util::Ref by std::any (C++17)\" (feb55dde39e59a2709ecefff848a1d8eb9fe69ca)\r\n\r\nThis turns out to be dangerous because in some cases like `JSONRPCRequest jreq(helpreq);` this constructor will take precedence over the copy constructor.\r\n\r\n~Would suggest changing this only to accept pointer arguments so it won't be accidentally invoked trying to create a copy:~\r\n\r\n```c++\r\ntemplate<typename T>\r\nexplicit JSONRPCRequest(T* context) : id(NullUniValue), params(NullUniValue), fHelp(false), context(context) {}\r\n```\r\n\r\n---\r\n\r\nEDIT: Struck out suggestion above. It doesn't work because the JSONRPCRequest needs a reference to a long-lived std::any object and can't use a internal one. I'm not actually sure why this is the case, and think it may be worth simplifying in the future, but this would be a bigger change. Can disregard this comment.",
    "created_at": "2021-03-06T15:41:00Z",
    "updated_at": "2021-03-29T21:35:59Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r588896097",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588896097"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r588896097"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588896097/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 40,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588921151",
    "pull_request_review_id": 605781570,
    "id": 588921151,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4ODkyMTE1MQ==",
    "diff_hunk": "@@ -501,6 +502,21 @@ inline void insert(std::set<TsetT>& dst, const Tsrc& src) {\n     dst.insert(src.begin(), src.end());\n }\n \n+/**\n+ * Helper function to access the contained object of a std::any instance.\n+ * Returns a pointer to the object if passed instance has a value and the type\n+ * matches, nullptr otherwise.\n+ */\n+template<typename T>\n+T* AnyPtr(const std::any& any)",
    "path": "src/util/system.h",
    "position": null,
    "original_position": 18,
    "commit_id": "916ab0195d567fd0a9097045e73a6654c453adea",
    "original_commit_id": "003e76c29caa0173e0e898659e9e06fad31577ad",
    "user": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Concept NACK this implementation.\r\n\r\nYou should label this function as noexcept and use the noexcept versions of any_cast which will already return you a nullptr. See variants 4 and 5 https://en.cppreference.com/w/cpp/utility/any/any_cast. These are implemented AFAIK internally without using exceptions.\r\n\r\nExceptions have a non negligible performance overhead if hitting the `catch` case we may want to avoid.\r\n\r\nYou could -- if you want -- introduce a try/catch variant that is called `AnyPtrLikely` that uses try/catch where we're already pretty sure that we'll succeed, but that seems like over optimizing.",
    "created_at": "2021-03-06T19:29:52Z",
    "updated_at": "2021-03-29T21:35:59Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r588921151",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588921151"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r588921151"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588921151/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 511,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588923880",
    "pull_request_review_id": 605783441,
    "id": 588923880,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4ODkyMzg4MA==",
    "diff_hunk": "@@ -501,6 +502,21 @@ inline void insert(std::set<TsetT>& dst, const Tsrc& src) {\n     dst.insert(src.begin(), src.end());\n }\n \n+/**\n+ * Helper function to access the contained object of a std::any instance.\n+ * Returns a pointer to the object if passed instance has a value and the type\n+ * matches, nullptr otherwise.\n+ */\n+template<typename T>\n+T* AnyPtr(const std::any& any)",
    "path": "src/util/system.h",
    "position": null,
    "original_position": 18,
    "commit_id": "916ab0195d567fd0a9097045e73a6654c453adea",
    "original_commit_id": "003e76c29caa0173e0e898659e9e06fad31577ad",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Oops, sorry. I didn't know about the noexcept casts. This can be simplified to:\r\n\r\n```c++\r\ntemplate<typename T>\r\nT* AnyPtr(const std::any& any)\r\n{\r\n    T* const* ptr = std::any_cast<T*>(&any);\r\n    return ptr ? *ptr : nullptr;\r\n}\r\n```\r\n\r\nI don't think this is used in any performance critical code, but no reason this needs to be slower and more complicated.",
    "created_at": "2021-03-06T19:55:34Z",
    "updated_at": "2021-03-29T21:35:59Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r588923880",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588923880"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r588923880"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588923880/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 511,
    "side": "RIGHT",
    "in_reply_to_id": 588921151
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588926343",
    "pull_request_review_id": 605784947,
    "id": 588926343,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4ODkyNjM0Mw==",
    "diff_hunk": "@@ -501,6 +502,21 @@ inline void insert(std::set<TsetT>& dst, const Tsrc& src) {\n     dst.insert(src.begin(), src.end());\n }\n \n+/**\n+ * Helper function to access the contained object of a std::any instance.\n+ * Returns a pointer to the object if passed instance has a value and the type\n+ * matches, nullptr otherwise.\n+ */\n+template<typename T>\n+T* AnyPtr(const std::any& any)",
    "path": "src/util/system.h",
    "position": null,
    "original_position": 18,
    "commit_id": "916ab0195d567fd0a9097045e73a6654c453adea",
    "original_commit_id": "003e76c29caa0173e0e898659e9e06fad31577ad",
    "user": {
      "login": "theStack",
      "id": 91535,
      "node_id": "MDQ6VXNlcjkxNTM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theStack",
      "html_url": "https://github.com/theStack",
      "followers_url": "https://api.github.com/users/theStack/followers",
      "following_url": "https://api.github.com/users/theStack/following{/other_user}",
      "gists_url": "https://api.github.com/users/theStack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theStack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
      "organizations_url": "https://api.github.com/users/theStack/orgs",
      "repos_url": "https://api.github.com/users/theStack/repos",
      "events_url": "https://api.github.com/users/theStack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theStack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Good catch, I somehow missed that there was a noexcept version of `std::any_cast`. But then I guess we can as well directly use that instead of introducing AnyPtr? This would be in effect just another name for the same purpose.",
    "created_at": "2021-03-06T20:19:25Z",
    "updated_at": "2021-03-29T21:35:59Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r588926343",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588926343"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r588926343"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588926343/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 511,
    "side": "RIGHT",
    "in_reply_to_id": 588921151
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588927512",
    "pull_request_review_id": 605785613,
    "id": 588927512,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4ODkyNzUxMg==",
    "diff_hunk": "@@ -87,7 +88,7 @@ std::string CRPCTable::help(const std::string& strCommand, const JSONRPCRequest&\n         vCommands.push_back(make_pair(entry.second.front()->category + entry.first, entry.second.front()));\n     sort(vCommands.begin(), vCommands.end());\n \n-    JSONRPCRequest jreq(helpreq);\n+    JSONRPCRequest jreq(&helpreq);",
    "path": "src/rpc/server.cpp",
    "position": null,
    "original_position": 13,
    "commit_id": "916ab0195d567fd0a9097045e73a6654c453adea",
    "original_commit_id": "feb55dde39e59a2709ecefff848a1d8eb9fe69ca",
    "user": {
      "login": "theStack",
      "id": 91535,
      "node_id": "MDQ6VXNlcjkxNTM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theStack",
      "html_url": "https://github.com/theStack",
      "followers_url": "https://api.github.com/users/theStack/followers",
      "following_url": "https://api.github.com/users/theStack/following{/other_user}",
      "gists_url": "https://api.github.com/users/theStack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theStack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
      "organizations_url": "https://api.github.com/users/theStack/orgs",
      "repos_url": "https://api.github.com/users/theStack/repos",
      "events_url": "https://api.github.com/users/theStack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theStack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks, done.",
    "created_at": "2021-03-06T20:29:32Z",
    "updated_at": "2021-03-29T21:35:59Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r588927512",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588927512"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r588927512"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588927512/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 91,
    "side": "RIGHT",
    "in_reply_to_id": 588895346
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588928188",
    "pull_request_review_id": 605786058,
    "id": 588928188,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4ODkyODE4OA==",
    "diff_hunk": "@@ -501,6 +502,21 @@ inline void insert(std::set<TsetT>& dst, const Tsrc& src) {\n     dst.insert(src.begin(), src.end());\n }\n \n+/**\n+ * Helper function to access the contained object of a std::any instance.\n+ * Returns a pointer to the object if passed instance has a value and the type\n+ * matches, nullptr otherwise.\n+ */\n+template<typename T>\n+T* AnyPtr(const std::any& any)",
    "path": "src/util/system.h",
    "position": null,
    "original_position": 18,
    "commit_id": "916ab0195d567fd0a9097045e73a6654c453adea",
    "original_commit_id": "003e76c29caa0173e0e898659e9e06fad31577ad",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> Good catch, I somehow missed that there was a noexcept version of `std::any_cast`. But then I guess we can as well directly use that instead of introducing AnyPtr? This would be in effect just another name for the same purpose.\r\n\r\nMy preference would be to keep AnyPtr instead of introducing NodeContext* const* temporary variables because I think the two different ways these could be null could be confusing and cause non-obvious bugs, but feel free to take any approach.",
    "created_at": "2021-03-06T20:36:43Z",
    "updated_at": "2021-03-29T21:35:59Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r588928188",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588928188"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r588928188"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588928188/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 511,
    "side": "RIGHT",
    "in_reply_to_id": 588921151
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588957692",
    "pull_request_review_id": 605801761,
    "id": 588957692,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4ODk1NzY5Mg==",
    "diff_hunk": "@@ -501,6 +502,21 @@ inline void insert(std::set<TsetT>& dst, const Tsrc& src) {\n     dst.insert(src.begin(), src.end());\n }\n \n+/**\n+ * Helper function to access the contained object of a std::any instance.\n+ * Returns a pointer to the object if passed instance has a value and the type\n+ * matches, nullptr otherwise.\n+ */\n+template<typename T>\n+T* AnyPtr(const std::any& any)",
    "path": "src/util/system.h",
    "position": null,
    "original_position": 18,
    "commit_id": "916ab0195d567fd0a9097045e73a6654c453adea",
    "original_commit_id": "003e76c29caa0173e0e898659e9e06fad31577ad",
    "user": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "using any_cast bare is a code smell IMO because it can arbitrarily become the non noexcept version :(, the wrapper makes the version guaranteed. If anything, you could declare it as inline so there is no overhead? (idk about template + inline...)\r\n\r\nI think that's what @ryanofsky is saying.",
    "created_at": "2021-03-07T01:50:30Z",
    "updated_at": "2021-03-29T21:35:59Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r588957692",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588957692"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r588957692"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588957692/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 511,
    "side": "RIGHT",
    "in_reply_to_id": 588921151
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/589096062",
    "pull_request_review_id": 605890553,
    "id": 589096062,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4OTA5NjA2Mg==",
    "diff_hunk": "@@ -501,6 +502,21 @@ inline void insert(std::set<TsetT>& dst, const Tsrc& src) {\n     dst.insert(src.begin(), src.end());\n }\n \n+/**\n+ * Helper function to access the contained object of a std::any instance.\n+ * Returns a pointer to the object if passed instance has a value and the type\n+ * matches, nullptr otherwise.\n+ */\n+template<typename T>\n+T* AnyPtr(const std::any& any)",
    "path": "src/util/system.h",
    "position": null,
    "original_position": 18,
    "commit_id": "916ab0195d567fd0a9097045e73a6654c453adea",
    "original_commit_id": "003e76c29caa0173e0e898659e9e06fad31577ad",
    "user": {
      "login": "theStack",
      "id": 91535,
      "node_id": "MDQ6VXNlcjkxNTM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theStack",
      "html_url": "https://github.com/theStack",
      "followers_url": "https://api.github.com/users/theStack/followers",
      "following_url": "https://api.github.com/users/theStack/following{/other_user}",
      "gists_url": "https://api.github.com/users/theStack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theStack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
      "organizations_url": "https://api.github.com/users/theStack/orgs",
      "repos_url": "https://api.github.com/users/theStack/repos",
      "events_url": "https://api.github.com/users/theStack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theStack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "After having tried out using std::any_cast directly yesterday, I can confirm ryanofsky's point of the drawback, needing temporary variables, making the code clunky and potentially confusing. Also the ambiguity on which version is chosen is a strong argument against it. Kept the AnyPtr function, changed it to the [proposed implementation](https://github.com/bitcoin/bitcoin/pull/21366#discussion_r588923880), see https://github.com/bitcoin/bitcoin/pull/21366#issuecomment-792124283.",
    "created_at": "2021-03-07T22:09:50Z",
    "updated_at": "2021-03-29T21:35:59Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r589096062",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/589096062"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r589096062"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/589096062/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 511,
    "side": "RIGHT",
    "in_reply_to_id": 588921151
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/602820686",
    "pull_request_review_id": 622716405,
    "id": 602820686,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjgyMDY4Ng==",
    "diff_hunk": "@@ -38,7 +38,6 @@\n #include <uint256.h>\n #include <univalue.h>\n #include <util/check.h>\n-#include <util/ref.h>",
    "path": "src/node/interfaces.cpp",
    "position": 4,
    "original_position": 4,
    "commit_id": "916ab0195d567fd0a9097045e73a6654c453adea",
    "original_commit_id": "39069499a61d7c2cab8594162c99bf00ea2ac88b",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Add `#include <any>` ?",
    "created_at": "2021-03-28T02:46:37Z",
    "updated_at": "2021-03-29T21:35:59Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r602820686",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/602820686"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r602820686"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/602820686/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 41,
    "original_line": 41,
    "side": "LEFT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/602821073",
    "pull_request_review_id": 622716405,
    "id": 602821073,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjgyMTA3Mw==",
    "diff_hunk": "@@ -73,18 +75,18 @@ static bool RESTERR(HTTPRequest* req, enum HTTPStatusCode status, std::string me\n  *                  context is not found.\n  * @returns         Pointer to the node context or nullptr if not found.\n  */\n-static NodeContext* GetNodeContext(const util::Ref& context, HTTPRequest* req)\n+static NodeContext* GetNodeContext(const std::any& context, HTTPRequest* req)\n {\n-    NodeContext* node = context.Has<NodeContext>() ? &context.Get<NodeContext>() : nullptr;\n-    if (!node) {\n+    NodeContext* node_context = util::AnyPtr<NodeContext>(context);",
    "path": "src/rest.cpp",
    "position": null,
    "original_position": 23,
    "commit_id": "916ab0195d567fd0a9097045e73a6654c453adea",
    "original_commit_id": "39069499a61d7c2cab8594162c99bf00ea2ac88b",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: Could be more concise without losing much details:\r\n```suggestion\r\n    auto node_context = util::AnyPtr<NodeContext>(context);\r\n```\r\n\r\n(Here and in other places when `util::AnyPtr<T>` is used)",
    "created_at": "2021-03-28T02:50:15Z",
    "updated_at": "2021-03-29T21:35:59Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r602821073",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/602821073"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r602821073"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/602821073/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 80,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/602821146",
    "pull_request_review_id": 622716405,
    "id": 602821146,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjgyMTE0Ng==",
    "diff_hunk": "@@ -15,6 +15,7 @@\n #include <boost/algorithm/string/split.hpp>\n #include <boost/signals2/signal.hpp>\n \n+#include <any>",
    "path": "src/rpc/server.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "916ab0195d567fd0a9097045e73a6654c453adea",
    "original_commit_id": "39069499a61d7c2cab8594162c99bf00ea2ac88b",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "No need to `#include <any>` here. ",
    "created_at": "2021-03-28T02:51:21Z",
    "updated_at": "2021-03-29T21:35:59Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r602821146",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/602821146"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r602821146"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/602821146/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 18,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603630093",
    "pull_request_review_id": 623671044,
    "id": 603630093,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMzYzMDA5Mw==",
    "diff_hunk": "@@ -38,7 +38,6 @@\n #include <uint256.h>\n #include <univalue.h>\n #include <util/check.h>\n-#include <util/ref.h>",
    "path": "src/node/interfaces.cpp",
    "position": 4,
    "original_position": 4,
    "commit_id": "916ab0195d567fd0a9097045e73a6654c453adea",
    "original_commit_id": "39069499a61d7c2cab8594162c99bf00ea2ac88b",
    "user": {
      "login": "theStack",
      "id": 91535,
      "node_id": "MDQ6VXNlcjkxNTM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theStack",
      "html_url": "https://github.com/theStack",
      "followers_url": "https://api.github.com/users/theStack/followers",
      "following_url": "https://api.github.com/users/theStack/following{/other_user}",
      "gists_url": "https://api.github.com/users/theStack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theStack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
      "organizations_url": "https://api.github.com/users/theStack/orgs",
      "repos_url": "https://api.github.com/users/theStack/repos",
      "events_url": "https://api.github.com/users/theStack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theStack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done.",
    "created_at": "2021-03-29T21:36:55Z",
    "updated_at": "2021-03-29T21:37:11Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r603630093",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603630093"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r603630093"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603630093/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 41,
    "original_line": 41,
    "side": "LEFT",
    "in_reply_to_id": 602820686
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603632492",
    "pull_request_review_id": 623673790,
    "id": 603632492,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMzYzMjQ5Mg==",
    "diff_hunk": "@@ -73,18 +75,18 @@ static bool RESTERR(HTTPRequest* req, enum HTTPStatusCode status, std::string me\n  *                  context is not found.\n  * @returns         Pointer to the node context or nullptr if not found.\n  */\n-static NodeContext* GetNodeContext(const util::Ref& context, HTTPRequest* req)\n+static NodeContext* GetNodeContext(const std::any& context, HTTPRequest* req)\n {\n-    NodeContext* node = context.Has<NodeContext>() ? &context.Get<NodeContext>() : nullptr;\n-    if (!node) {\n+    NodeContext* node_context = util::AnyPtr<NodeContext>(context);",
    "path": "src/rest.cpp",
    "position": null,
    "original_position": 23,
    "commit_id": "916ab0195d567fd0a9097045e73a6654c453adea",
    "original_commit_id": "39069499a61d7c2cab8594162c99bf00ea2ac88b",
    "user": {
      "login": "theStack",
      "id": 91535,
      "node_id": "MDQ6VXNlcjkxNTM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theStack",
      "html_url": "https://github.com/theStack",
      "followers_url": "https://api.github.com/users/theStack/followers",
      "following_url": "https://api.github.com/users/theStack/following{/other_user}",
      "gists_url": "https://api.github.com/users/theStack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theStack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
      "organizations_url": "https://api.github.com/users/theStack/orgs",
      "repos_url": "https://api.github.com/users/theStack/repos",
      "events_url": "https://api.github.com/users/theStack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theStack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Good idea. I agree that for the reader it is obvious enough to see that \"AnyPtr< T >(...)\" returns type \"T*\" and using \"auto\" makes sense here. Done for all instances.",
    "created_at": "2021-03-29T21:41:15Z",
    "updated_at": "2021-03-29T21:42:13Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r603632492",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603632492"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r603632492"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603632492/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 80,
    "side": "RIGHT",
    "in_reply_to_id": 602821073
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603633200",
    "pull_request_review_id": 623674675,
    "id": 603633200,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMzYzMzIwMA==",
    "diff_hunk": "@@ -15,6 +15,7 @@\n #include <boost/algorithm/string/split.hpp>\n #include <boost/signals2/signal.hpp>\n \n+#include <any>",
    "path": "src/rpc/server.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "916ab0195d567fd0a9097045e73a6654c453adea",
    "original_commit_id": "39069499a61d7c2cab8594162c99bf00ea2ac88b",
    "user": {
      "login": "theStack",
      "id": 91535,
      "node_id": "MDQ6VXNlcjkxNTM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theStack",
      "html_url": "https://github.com/theStack",
      "followers_url": "https://api.github.com/users/theStack/followers",
      "following_url": "https://api.github.com/users/theStack/following{/other_user}",
      "gists_url": "https://api.github.com/users/theStack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theStack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
      "organizations_url": "https://api.github.com/users/theStack/orgs",
      "repos_url": "https://api.github.com/users/theStack/repos",
      "events_url": "https://api.github.com/users/theStack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theStack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks, removed.",
    "created_at": "2021-03-29T21:42:47Z",
    "updated_at": "2021-03-29T21:42:47Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r603633200",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603633200"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21366#discussion_r603633200"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21366"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603633200/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 18,
    "side": "RIGHT",
    "in_reply_to_id": 602821146
  }
]