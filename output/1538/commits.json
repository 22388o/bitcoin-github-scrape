[
  {
    "sha": "250ccc4d2bdd44eaee8a885681516ee4999be9f5",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyNTBjY2M0ZDJiZGQ0NGVhZWU4YTg4NTY4MTUxNmVlNDk5OWJlOWY1",
    "commit": {
      "author": {
        "name": "Jeff Garzik",
        "email": "jgarzik@exmulti.com",
        "date": "2012-06-30T00:10:46Z"
      },
      "committer": {
        "name": "Jeff Garzik",
        "email": "jgarzik@redhat.com",
        "date": "2012-06-30T00:10:46Z"
      },
      "message": "Add per-node recv/send byte counters, accessible via getpeerinfo RPC",
      "tree": {
        "sha": "54e0856fc59b245b75e2ed439a5d71d4e7197cc5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/54e0856fc59b245b75e2ed439a5d71d4e7197cc5"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/250ccc4d2bdd44eaee8a885681516ee4999be9f5",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/250ccc4d2bdd44eaee8a885681516ee4999be9f5",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/250ccc4d2bdd44eaee8a885681516ee4999be9f5",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/250ccc4d2bdd44eaee8a885681516ee4999be9f5/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "1006f0707e34f8903f247195dabd86243ae61f05",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1006f0707e34f8903f247195dabd86243ae61f05",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/1006f0707e34f8903f247195dabd86243ae61f05"
      }
    ],
    "stats": {
      "total": 14,
      "additions": 14,
      "deletions": 0
    },
    "files": [
      {
        "sha": "f2000e9062b3f8790935c77dc5c159617549dba8",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/250ccc4d2bdd44eaee8a885681516ee4999be9f5/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/250ccc4d2bdd44eaee8a885681516ee4999be9f5/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=250ccc4d2bdd44eaee8a885681516ee4999be9f5",
        "patch": "@@ -2955,6 +2955,8 @@ bool ProcessMessages(CNode* pfrom)\n             break;\n         }\n \n+        pfrom->nRecvBytes += nHeaderSize + nMessageSize;\n+\n         // Checksum\n         uint256 hash = Hash(vRecv.begin(), vRecv.begin() + nMessageSize);\n         unsigned int nChecksum = 0;"
      },
      {
        "sha": "3fbdc94016bc5d2a13310b9b57deca54e608dd7e",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/250ccc4d2bdd44eaee8a885681516ee4999be9f5/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/250ccc4d2bdd44eaee8a885681516ee4999be9f5/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=250ccc4d2bdd44eaee8a885681516ee4999be9f5",
        "patch": "@@ -614,6 +614,8 @@ void CNode::copyStats(CNodeStats &stats)\n     X(nLastSend);\n     X(nLastRecv);\n     X(nTimeConnected);\n+    X(nRecvBytes);\n+    X(nSendBytes);\n     X(addrName);\n     X(nVersion);\n     X(strSubVer);"
      },
      {
        "sha": "c83eab4208c1aa83eea7beaf1b3bcabfea291055",
        "filename": "src/net.h",
        "status": "modified",
        "additions": 8,
        "deletions": 0,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/250ccc4d2bdd44eaee8a885681516ee4999be9f5/src/net.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/250ccc4d2bdd44eaee8a885681516ee4999be9f5/src/net.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.h?ref=250ccc4d2bdd44eaee8a885681516ee4999be9f5",
        "patch": "@@ -135,6 +135,8 @@ class CNodeStats\n     int64 nLastSend;\n     int64 nLastRecv;\n     int64 nTimeConnected;\n+    uint64 nRecvBytes;\n+    uint64 nSendBytes;\n     std::string addrName;\n     int nVersion;\n     std::string strSubVer;\n@@ -163,6 +165,8 @@ class CNode\n     int64 nLastRecv;\n     int64 nLastSendEmpty;\n     int64 nTimeConnected;\n+    uint64 nRecvBytes;\n+    uint64 nSendBytes;\n     int nHeaderStart;\n     unsigned int nMessageStart;\n     CAddress addr;\n@@ -215,6 +219,8 @@ class CNode\n         nLastRecv = 0;\n         nLastSendEmpty = GetTime();\n         nTimeConnected = GetTime();\n+        nRecvBytes = 0;\n+        nSendBytes = 0;\n         nHeaderStart = -1;\n         nMessageStart = -1;\n         addr = addrIn;\n@@ -380,6 +386,8 @@ class CNode\n         assert(nMessageStart - nHeaderStart >= offsetof(CMessageHeader, nChecksum) + sizeof(nChecksum));\n         memcpy((char*)&vSend[nHeaderStart] + offsetof(CMessageHeader, nChecksum), &nChecksum, sizeof(nChecksum));\n \n+        nSendBytes += nSize;\n+\n         if (fDebug) {\n             printf(\"(%d bytes)\\n\", nSize);\n         }"
      },
      {
        "sha": "171460300efc11185ac79084ca1c148972f35190",
        "filename": "src/rpcnet.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/250ccc4d2bdd44eaee8a885681516ee4999be9f5/src/rpcnet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/250ccc4d2bdd44eaee8a885681516ee4999be9f5/src/rpcnet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpcnet.cpp?ref=250ccc4d2bdd44eaee8a885681516ee4999be9f5",
        "patch": "@@ -52,6 +52,8 @@ Value getpeerinfo(const Array& params, bool fHelp)\n         obj.push_back(Pair(\"lastsend\", (boost::int64_t)stats.nLastSend));\n         obj.push_back(Pair(\"lastrecv\", (boost::int64_t)stats.nLastRecv));\n         obj.push_back(Pair(\"conntime\", (boost::int64_t)stats.nTimeConnected));\n+        obj.push_back(Pair(\"recvbytes\", (boost::uint64_t)stats.nRecvBytes));\n+        obj.push_back(Pair(\"sendbytes\", (boost::uint64_t)stats.nSendBytes));\n         obj.push_back(Pair(\"version\", stats.nVersion));\n         obj.push_back(Pair(\"subver\", stats.strSubVer));\n         obj.push_back(Pair(\"inbound\", stats.fInbound));"
      }
    ]
  },
  {
    "sha": "e58e23e1e3bc64cbe766308d6d15bb33c728ddbf",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzplNThlMjNlMWUzYmM2NGNiZTc2NjMwOGQ2ZDE1YmIzM2M3MjhkZGJm",
    "commit": {
      "author": {
        "name": "Jeff Garzik",
        "email": "jgarzik@exmulti.com",
        "date": "2012-06-30T02:05:25Z"
      },
      "committer": {
        "name": "Jeff Garzik",
        "email": "jgarzik@redhat.com",
        "date": "2012-06-30T02:05:25Z"
      },
      "message": "Collect per-message send/receive stats, with reporting via getpeerinfo RPC",
      "tree": {
        "sha": "0cadb240c983de75f9158316c940c1d53ea06c20",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0cadb240c983de75f9158316c940c1d53ea06c20"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e58e23e1e3bc64cbe766308d6d15bb33c728ddbf",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e58e23e1e3bc64cbe766308d6d15bb33c728ddbf",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/e58e23e1e3bc64cbe766308d6d15bb33c728ddbf",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e58e23e1e3bc64cbe766308d6d15bb33c728ddbf/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "250ccc4d2bdd44eaee8a885681516ee4999be9f5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/250ccc4d2bdd44eaee8a885681516ee4999be9f5",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/250ccc4d2bdd44eaee8a885681516ee4999be9f5"
      }
    ],
    "stats": {
      "total": 46,
      "additions": 46,
      "deletions": 0
    },
    "files": [
      {
        "sha": "8708fca1aebf9c8092c05c6089ae7576329e64bc",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e58e23e1e3bc64cbe766308d6d15bb33c728ddbf/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e58e23e1e3bc64cbe766308d6d15bb33c728ddbf/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=e58e23e1e3bc64cbe766308d6d15bb33c728ddbf",
        "patch": "@@ -2978,6 +2978,8 @@ bool ProcessMessages(CNode* pfrom)\n         {\n             {\n                 LOCK(cs_main);\n+                pfrom->mapRecvMsgs[strCommand]++;\n+                pfrom->mapRecvMsgBytes[strCommand] += nHeaderSize+nMessageSize;\n                 fRet = ProcessMessage(pfrom, strCommand, vMsg);\n             }\n             if (fShutdown)"
      },
      {
        "sha": "22990af8556ebd8b7ceb9a2510b810732c08e344",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 0,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e58e23e1e3bc64cbe766308d6d15bb33c728ddbf/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e58e23e1e3bc64cbe766308d6d15bb33c728ddbf/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=e58e23e1e3bc64cbe766308d6d15bb33c728ddbf",
        "patch": "@@ -621,6 +621,10 @@ void CNode::copyStats(CNodeStats &stats)\n     X(strSubVer);\n     X(fInbound);\n     X(nReleaseTime);\n+    X(mapRecvMsgs);\n+    X(mapRecvMsgBytes);\n+    X(mapSendMsgs);\n+    X(mapSendMsgBytes);\n     X(nStartingHeight);\n     X(nMisbehavior);\n }"
      },
      {
        "sha": "7b9b45ea734897cbd5efe9049456d36948f84a8f",
        "filename": "src/net.h",
        "status": "modified",
        "additions": 14,
        "deletions": 0,
        "changes": 14,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e58e23e1e3bc64cbe766308d6d15bb33c728ddbf/src/net.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e58e23e1e3bc64cbe766308d6d15bb33c728ddbf/src/net.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.h?ref=e58e23e1e3bc64cbe766308d6d15bb33c728ddbf",
        "patch": "@@ -144,6 +144,10 @@ class CNodeStats\n     int64 nReleaseTime;\n     int nStartingHeight;\n     int nMisbehavior;\n+    std::map<std::string, uint64> mapRecvMsgs;\n+    std::map<std::string, uint64> mapRecvMsgBytes;\n+    std::map<std::string, uint64> mapSendMsgs;\n+    std::map<std::string, uint64> mapSendMsgBytes;\n };\n \n \n@@ -169,6 +173,7 @@ class CNode\n     uint64 nSendBytes;\n     int nHeaderStart;\n     unsigned int nMessageStart;\n+    std::string strSendCmd;\n     CAddress addr;\n     std::string addrName;\n     CService addrLocal;\n@@ -181,6 +186,11 @@ class CNode\n     bool fSuccessfullyConnected;\n     bool fDisconnect;\n     CSemaphoreGrant grantOutbound;\n+    std::map<std::string, uint64> mapRecvMsgs;\n+    std::map<std::string, uint64> mapRecvMsgBytes;\n+    std::map<std::string, uint64> mapSendMsgs;\n+    std::map<std::string, uint64> mapSendMsgBytes;\n+\n protected:\n     int nRefCount;\n \n@@ -346,6 +356,7 @@ class CNode\n         nHeaderStart = vSend.size();\n         vSend << CMessageHeader(pszCommand, 0);\n         nMessageStart = vSend.size();\n+        strSendCmd = pszCommand;\n         if (fDebug)\n             printf(\"sending: %s \", pszCommand);\n     }\n@@ -357,6 +368,7 @@ class CNode\n         vSend.resize(nHeaderStart);\n         nHeaderStart = -1;\n         nMessageStart = -1;\n+        strSendCmd = \"\";\n         LEAVE_CRITICAL_SECTION(cs_vSend);\n \n         if (fDebug)\n@@ -387,6 +399,8 @@ class CNode\n         memcpy((char*)&vSend[nHeaderStart] + offsetof(CMessageHeader, nChecksum), &nChecksum, sizeof(nChecksum));\n \n         nSendBytes += nSize;\n+        mapSendMsgs[strSendCmd]++;\n+        mapSendMsgBytes[strSendCmd] += (nMessageStart - nHeaderStart) + nSize;\n \n         if (fDebug) {\n             printf(\"(%d bytes)\\n\", nSize);"
      },
      {
        "sha": "2e7ada1e114cfffd5a575a0e290c413022ba4d6c",
        "filename": "src/rpcnet.cpp",
        "status": "modified",
        "additions": 26,
        "deletions": 0,
        "changes": 26,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e58e23e1e3bc64cbe766308d6d15bb33c728ddbf/src/rpcnet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e58e23e1e3bc64cbe766308d6d15bb33c728ddbf/src/rpcnet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpcnet.cpp?ref=e58e23e1e3bc64cbe766308d6d15bb33c728ddbf",
        "patch": "@@ -32,6 +32,28 @@ static void CopyNodeStats(std::vector<CNodeStats>& vstats)\n     }\n }\n \n+static Object CmdStatToJSON(const map<string, uint64>& mapMsgs,\n+                            const map<string, uint64>& mapMsgBytes_)\n+{\n+    Object ret;\n+\n+    map<string, uint64> mapMsgBytes(mapMsgBytes_);\n+\n+    for (map<string, uint64>::const_iterator mi = mapMsgs.begin(); mi != mapMsgs.end(); ++mi) {\n+        Array a;\n+\n+        string strCommand = mi->first;\n+        boost::uint64_t msgCount = mi->second;\n+        boost::uint64_t msgBytes = mapMsgBytes[strCommand];\n+\n+        a.push_back(msgCount);\n+        a.push_back(msgBytes);\n+        ret.push_back(Pair(strCommand, a));\n+    }\n+\n+    return ret;\n+}\n+\n Value getpeerinfo(const Array& params, bool fHelp)\n {\n     if (fHelp || params.size() != 0)\n@@ -58,6 +80,10 @@ Value getpeerinfo(const Array& params, bool fHelp)\n         obj.push_back(Pair(\"subver\", stats.strSubVer));\n         obj.push_back(Pair(\"inbound\", stats.fInbound));\n         obj.push_back(Pair(\"releasetime\", (boost::int64_t)stats.nReleaseTime));\n+        obj.push_back(Pair(\"recvmsgs\",\n+            CmdStatToJSON(stats.mapRecvMsgs, stats.mapRecvMsgBytes)));\n+        obj.push_back(Pair(\"sendmsgs\",\n+            CmdStatToJSON(stats.mapSendMsgs, stats.mapSendMsgBytes)));\n         obj.push_back(Pair(\"height\", stats.nStartingHeight));\n         obj.push_back(Pair(\"banscore\", stats.nMisbehavior));\n "
      }
    ]
  }
]