jtimon,2014-06-18T20:52:06Z,"I need to think more about this, I'm closing it for now.\n",https://github.com/bitcoin/bitcoin/pull/4366#issuecomment-46492335,46492335,
sipa,2014-06-19T12:08:22Z,"I haven't looked at the code, but in general yes, CBlockIndex could be a\nsubclass of CBlockHeader. The reason it is not yet the case is that\nCBlockHeader originally did not exist, and only CBlock existed. Now that\nthe header is split off it could become a common ancestor to both.\n\nHowever, do not remove nVersion = this->nVersion. The local variable\nnVersion is defined by the IMPLEMENT_SERIAL",https://github.com/bitcoin/bitcoin/pull/4366#issuecomment-46552474,46552474,
sipa,2014-06-21T12:22:31Z,"I'm not very keen on making core data structure methods virtual. It adds indirection overhead, and prevents inlining.\n\nYou can just override the method, no? You'll get the more efficient cached version when using a CBlockIndex reference, and the old on-the-fly-computed hash when using a CBlockHeader one.\n",https://github.com/bitcoin/bitcoin/pull/4366#issuecomment-46752309,46752309,
jtimon,2014-06-21T23:46:44Z,"Yes, in this case is polymorphism is completely unnecessary, I just have to unify GetHash() and GetBlockHash() and remove that ugly TODO comment.\n",https://github.com/bitcoin/bitcoin/pull/4366#issuecomment-46768086,46768086,
jtimon,2014-06-25T10:53:30Z,"The main objective of this PR is ""don't repeat yourself"" and sepcially get rid of those field-by-field ugly mappings. But it could be also solved with simple composition instead of inheritance.\nThat would require more work since pindex->nTime would turn into pindex->header->nTime (the same for CBlocks), but the end result is probably more readable (since you don't have to take inheritance into ac",https://github.com/bitcoin/bitcoin/pull/4366#issuecomment-47086696,47086696,
sipa,2014-06-28T14:20:23Z,"I only now realize that CBlockIndex did not store the hashPrev, but only a pointer to the previous CBlockIndex instead; changing that means adding 32 bytes to every CBlockIndex in memory, which means some 10MB extra RAM.\n\nThat seems like a high cost for a minor code cleanup.\n",https://github.com/bitcoin/bitcoin/pull/4366#issuecomment-47428646,47428646,
jtimon,2014-06-28T15:03:24Z,"That's very interesting.\nUsing composition wouldn't help either, unless the indexes share the headers with other classes, say CDiskBlockIndex or CBlock.\nI don't know which of these structures are maintained more permanently and which only temporarily in memory.\nWhat I'm proposing is to have a common container (say a map<block_hash, block_header>) and let the indexes and blocks have a pointer to",https://github.com/bitcoin/bitcoin/pull/4366#issuecomment-47429637,47429637,
sipa,2014-06-28T15:59:27Z,A CBlockIndex instance is permanently held in memory for every known block.\n,https://github.com/bitcoin/bitcoin/pull/4366#issuecomment-47431136,47431136,
jtimon,2014-06-28T16:22:30Z,"I was asking if there was any other structure that is similarly contained in memory and contained a header too. Probably not.\n\nAnyway, maybe there's another solution. Now that the index has hashPrev, it may be possible to delete uint256\* phashBlock to take back the memory space...\n",https://github.com/bitcoin/bitcoin/pull/4366#issuecomment-47431762,47431762,
sipa,2014-06-28T16:35:40Z,"Yes, you could, but at the cost of needing to look up hashPrev in\nmapBlockIndex on every access, and still only reclaiming 8 out 32 bytes. I\ndon't think that is worth it.\n",https://github.com/bitcoin/bitcoin/pull/4366#issuecomment-47432107,47432107,
BitcoinPullTester,2014-06-30T23:22:20Z,"Automatic sanity-testing: FAILED BUILD/TEST, see http://jenkins.bluematt.me/pull-tester/p4366_e84533abc0a96ad4d6f48984b6ba537300b5a5b1/ for binaries and test log.\n\nThis could happen for one of several reasons:\n1. It chanages paths in makefile.linux-mingw or otherwise changes build scripts in a way that made them incompatible with the automated testing scripts (please tweak those patches in qa/p",https://github.com/bitcoin/bitcoin/pull/4366#issuecomment-47599985,47599985,
sipa,2014-06-28T14:17:16Z,I do not believe that is necessary.\n,https://github.com/bitcoin/bitcoin/pull/4366#discussion_r14324467,14324467,src/main.h
jtimon,2014-06-28T14:43:33Z,"thanks, removing TODO\n",https://github.com/bitcoin/bitcoin/pull/4366#discussion_r14324576,14324576,src/main.h
