[
  {
    "sha": "65c7141731b976af467ff23d234acf2244ffefe3",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo2NWM3MTQxNzMxYjk3NmFmNDY3ZmYyM2QyMzRhY2YyMjQ0ZmZlZmUz",
    "commit": {
      "author": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2011-12-21T22:17:12Z"
      },
      "committer": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2012-08-01T20:33:17Z"
      },
      "message": "Don't automatically include fees via JSON-RPC, and (with undocumented -nosafefees option) allow forcing them to send with under the 'minimum'",
      "tree": {
        "sha": "4ecdfeeea1e89f4ef574769fd80f6c34d287ac19",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4ecdfeeea1e89f4ef574769fd80f6c34d287ac19"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/65c7141731b976af467ff23d234acf2244ffefe3",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/65c7141731b976af467ff23d234acf2244ffefe3",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/65c7141731b976af467ff23d234acf2244ffefe3",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/65c7141731b976af467ff23d234acf2244ffefe3/comments",
    "author": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "8ce7915aad505fd6e57f599b5b43fc241d8b4cb4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8ce7915aad505fd6e57f599b5b43fc241d8b4cb4",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/8ce7915aad505fd6e57f599b5b43fc241d8b4cb4"
      }
    ],
    "stats": {
      "total": 66,
      "additions": 42,
      "deletions": 24
    },
    "files": [
      {
        "sha": "31a966ebae3152904e612e75407601de56085753",
        "filename": "src/bitcoinrpc.cpp",
        "status": "modified",
        "additions": 16,
        "deletions": 3,
        "changes": 19,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/65c7141731b976af467ff23d234acf2244ffefe3/src/bitcoinrpc.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/65c7141731b976af467ff23d234acf2244ffefe3/src/bitcoinrpc.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bitcoinrpc.cpp?ref=65c7141731b976af467ff23d234acf2244ffefe3",
        "patch": "@@ -391,6 +391,7 @@ Value getinfo(const Array& params, bool fHelp)\n     obj.push_back(Pair(\"keypoololdest\", (boost::int64_t)pwalletMain->GetOldestKeyPoolTime()));\n     obj.push_back(Pair(\"keypoolsize\",   pwalletMain->GetKeyPoolSize()));\n     obj.push_back(Pair(\"paytxfee\",      ValueFromAmount(nTransactionFee)));\n+    obj.push_back(Pair(\"forcetxfee\",    fForceFee));\n     if (pwalletMain->IsCrypted())\n         obj.push_back(Pair(\"unlocked_until\", (boost::int64_t)nWalletUnlockTime / 1000));\n     obj.push_back(Pair(\"errors\",        GetWarnings(\"statusbar\")));\n@@ -578,6 +579,15 @@ Value getaddressesbyaccount(const Array& params, bool fHelp)\n \n Value settxfee(const Array& params, bool fHelp)\n {\n+    if (GetBoolArg(\"-nosafefees\"))\n+    {\n+        if (fHelp || params.size() < 1 || params.size() > 2)\n+            throw runtime_error(\n+                \"settxfee <amount> [force]\\n\"\n+                \"<amount> is a real and is rounded to the nearest 0.00000001\\n\"\n+                \"[force] is a boolean that enables sending less than the safe minimum fee\");\n+    }\n+    else\n     if (fHelp || params.size() < 1 || params.size() > 1)\n         throw runtime_error(\n             \"settxfee <amount>\\n\"\n@@ -589,6 +599,8 @@ Value settxfee(const Array& params, bool fHelp)\n         nAmount = AmountFromValue(params[0]);        // rejects 0.0 amounts\n \n     nTransactionFee = nAmount;\n+    if (params.size() > 1)\n+        fForceFee = params[1].get_bool();\n     return true;\n }\n \n@@ -617,7 +629,7 @@ Value sendtoaddress(const Array& params, bool fHelp)\n     if (pwalletMain->IsLocked())\n         throw JSONRPCError(-13, \"Error: Please enter the wallet passphrase with walletpassphrase first.\");\n \n-    string strError = pwalletMain->SendMoneyToDestination(address.Get(), nAmount, wtx);\n+    string strError = pwalletMain->SendMoneyToDestination(address.Get(), nAmount, wtx, fForceFee);\n     if (strError != \"\")\n         throw JSONRPCError(-4, strError);\n \n@@ -949,7 +961,7 @@ Value sendfrom(const Array& params, bool fHelp)\n         throw JSONRPCError(-6, \"Account has insufficient funds\");\n \n     // Send\n-    string strError = pwalletMain->SendMoneyToDestination(address.Get(), nAmount, wtx);\n+    string strError = pwalletMain->SendMoneyToDestination(address.Get(), nAmount, wtx, fForceFee);\n     if (strError != \"\")\n         throw JSONRPCError(-4, strError);\n \n@@ -1008,7 +1020,7 @@ Value sendmany(const Array& params, bool fHelp)\n     // Send\n     CReserveKey keyChange(pwalletMain);\n     int64 nFeeRequired = 0;\n-    bool fCreated = pwalletMain->CreateTransaction(vecSend, wtx, keyChange, nFeeRequired);\n+    bool fCreated = pwalletMain->CreateTransaction(vecSend, wtx, keyChange, nFeeRequired, fForceFee);\n     if (!fCreated)\n     {\n         if (totalAmount + nFeeRequired > pwalletMain->GetBalance())\n@@ -2999,6 +3011,7 @@ Array RPCConvertValues(const std::string &strMethod, const std::vector<std::stri\n     if (strMethod == \"setgenerate\"            && n > 1) ConvertTo<boost::int64_t>(params[1]);\n     if (strMethod == \"sendtoaddress\"          && n > 1) ConvertTo<double>(params[1]);\n     if (strMethod == \"settxfee\"               && n > 0) ConvertTo<double>(params[0]);\n+    if (strMethod == \"settxfee\"               && n > 1) ConvertTo<bool>(params[1]);\n     if (strMethod == \"getreceivedbyaddress\"   && n > 1) ConvertTo<boost::int64_t>(params[1]);\n     if (strMethod == \"getreceivedbyaccount\"   && n > 1) ConvertTo<boost::int64_t>(params[1]);\n     if (strMethod == \"listreceivedbyaddress\"  && n > 0) ConvertTo<boost::int64_t>(params[0]);"
      },
      {
        "sha": "e8242e6760fcdcb4b1aaddf0ec36bf78b0664ed9",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/65c7141731b976af467ff23d234acf2244ffefe3/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/65c7141731b976af467ff23d234acf2244ffefe3/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=65c7141731b976af467ff23d234acf2244ffefe3",
        "patch": "@@ -56,6 +56,7 @@ int64 nHPSTimerStart;\n \n // Settings\n int64 nTransactionFee = 0;\n+bool fForceFee = false;\n \n \n "
      },
      {
        "sha": "eb04bd919b553f98d119e67212c7626a9f440e86",
        "filename": "src/main.h",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/65c7141731b976af467ff23d234acf2244ffefe3/src/main.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/65c7141731b976af467ff23d234acf2244ffefe3/src/main.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.h?ref=65c7141731b976af467ff23d234acf2244ffefe3",
        "patch": "@@ -70,6 +70,7 @@ extern unsigned char pchMessageStart[4];\n \n // Settings\n extern int64 nTransactionFee;\n+extern bool fForceFee;\n \n // Minimum disk space required - used in CheckDiskSpace()\n static const uint64 nMinDiskSpace = 52428800;"
      },
      {
        "sha": "f659dde0b75f6bf5be3e74c07a9547ff9b13ac6b",
        "filename": "src/noui.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/65c7141731b976af467ff23d234acf2244ffefe3/src/noui.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/65c7141731b976af467ff23d234acf2244ffefe3/src/noui.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/noui.cpp?ref=65c7141731b976af467ff23d234acf2244ffefe3",
        "patch": "@@ -17,7 +17,7 @@ static int noui_ThreadSafeMessageBox(const std::string& message, const std::stri\n \n static bool noui_ThreadSafeAskFee(int64 nFeeRequired, const std::string& strCaption)\n {\n-    return true;\n+    return false;\n }\n \n void noui_connect()"
      },
      {
        "sha": "f03b1e2f489cbd30c3ae7ef0e519ab0ee3aa37c2",
        "filename": "src/wallet.cpp",
        "status": "modified",
        "additions": 19,
        "deletions": 16,
        "changes": 35,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/65c7141731b976af467ff23d234acf2244ffefe3/src/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/65c7141731b976af467ff23d234acf2244ffefe3/src/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet.cpp?ref=65c7141731b976af467ff23d234acf2244ffefe3",
        "patch": "@@ -1075,7 +1075,7 @@ bool CWallet::SelectCoins(int64 nTargetValue, set<pair<const CWalletTx*,unsigned\n \n \n \n-bool CWallet::CreateTransaction(const vector<pair<CScript, int64> >& vecSend, CWalletTx& wtxNew, CReserveKey& reservekey, int64& nFeeRet)\n+bool CWallet::CreateTransaction(const vector<pair<CScript, int64> >& vecSend, CWalletTx& wtxNew, CReserveKey& reservekey, int64& nFeeRet, const bool fForceFee)\n {\n     int64 nValue = 0;\n     BOOST_FOREACH (const PAIRTYPE(CScript, int64)& s, vecSend)\n@@ -1122,7 +1122,7 @@ bool CWallet::CreateTransaction(const vector<pair<CScript, int64> >& vecSend, CW\n                 // if sub-cent change is required, the fee must be raised to at least MIN_TX_FEE\n                 // or until nChange becomes zero\n                 // NOTE: this depends on the exact behaviour of GetMinFee\n-                if (nFeeRet < MIN_TX_FEE && nChange > 0 && nChange < CENT)\n+                if (!fForceFee && nFeeRet < MIN_TX_FEE && nChange > 0 && nChange < CENT)\n                 {\n                     int64 nMoveToFee = min(nChange, MIN_TX_FEE - nFeeRet);\n                     nChange -= nMoveToFee;\n@@ -1171,14 +1171,17 @@ bool CWallet::CreateTransaction(const vector<pair<CScript, int64> >& vecSend, CW\n                     return false;\n                 dPriority /= nBytes;\n \n-                // Check that enough fee is included\n-                int64 nPayFee = nTransactionFee * (1 + (int64)nBytes / 1000);\n-                bool fAllowFree = CTransaction::AllowFree(dPriority);\n-                int64 nMinFee = wtxNew.GetMinFee(1, fAllowFree, GMF_SEND);\n-                if (nFeeRet < max(nPayFee, nMinFee))\n+                if (!fForceFee)\n                 {\n-                    nFeeRet = max(nPayFee, nMinFee);\n-                    continue;\n+                    // Check that enough fee is included\n+                    int64 nPayFee = nTransactionFee * (1 + (int64)nBytes / 1000);\n+                    bool fAllowFree = CTransaction::AllowFree(dPriority);\n+                    int64 nMinFee = wtxNew.GetMinFee(1, fAllowFree, GMF_SEND);\n+                    if (nFeeRet < max(nPayFee, nMinFee))\n+                    {\n+                        nFeeRet = max(nPayFee, nMinFee);\n+                        continue;\n+                    }\n                 }\n \n                 // Fill vtxPrev by copying from previous transactions vtxPrev\n@@ -1192,11 +1195,11 @@ bool CWallet::CreateTransaction(const vector<pair<CScript, int64> >& vecSend, CW\n     return true;\n }\n \n-bool CWallet::CreateTransaction(CScript scriptPubKey, int64 nValue, CWalletTx& wtxNew, CReserveKey& reservekey, int64& nFeeRet)\n+bool CWallet::CreateTransaction(CScript scriptPubKey, int64 nValue, CWalletTx& wtxNew, CReserveKey& reservekey, int64& nFeeRet, const bool fForceFee)\n {\n     vector< pair<CScript, int64> > vecSend;\n     vecSend.push_back(make_pair(scriptPubKey, nValue));\n-    return CreateTransaction(vecSend, wtxNew, reservekey, nFeeRet);\n+    return CreateTransaction(vecSend, wtxNew, reservekey, nFeeRet, fForceFee);\n }\n \n // Call after CreateTransaction unless you want to abort\n@@ -1251,7 +1254,7 @@ bool CWallet::CommitTransaction(CWalletTx& wtxNew, CReserveKey& reservekey)\n \n \n \n-string CWallet::SendMoney(CScript scriptPubKey, int64 nValue, CWalletTx& wtxNew, bool fAskFee)\n+string CWallet::SendMoney(CScript scriptPubKey, int64 nValue, CWalletTx& wtxNew, bool fAskFee, const bool fForceFee)\n {\n     CReserveKey reservekey(this);\n     int64 nFeeRequired;\n@@ -1262,7 +1265,7 @@ string CWallet::SendMoney(CScript scriptPubKey, int64 nValue, CWalletTx& wtxNew,\n         printf(\"SendMoney() : %s\", strError.c_str());\n         return strError;\n     }\n-    if (!CreateTransaction(scriptPubKey, nValue, wtxNew, reservekey, nFeeRequired))\n+    if (!CreateTransaction(scriptPubKey, nValue, wtxNew, reservekey, nFeeRequired, fForceFee))\n     {\n         string strError;\n         if (nValue + nFeeRequired > GetBalance())\n@@ -1274,7 +1277,7 @@ string CWallet::SendMoney(CScript scriptPubKey, int64 nValue, CWalletTx& wtxNew,\n     }\n \n     if (fAskFee && !uiInterface.ThreadSafeAskFee(nFeeRequired, _(\"Sending...\")))\n-        return \"ABORTED\";\n+        return strprintf(_(\"Error: This transaction requires a transaction fee of at least %s because of its amount, complexity, or use of recently received funds  \"), FormatMoney(nFeeRequired).c_str());\n \n     if (!CommitTransaction(wtxNew, reservekey))\n         return _(\"Error: The transaction was rejected.  This might happen if some of the coins in your wallet were already spent, such as if you used a copy of wallet.dat and coins were spent in the copy but not marked as spent here.\");\n@@ -1284,7 +1287,7 @@ string CWallet::SendMoney(CScript scriptPubKey, int64 nValue, CWalletTx& wtxNew,\n \n \n \n-string CWallet::SendMoneyToDestination(const CTxDestination& address, int64 nValue, CWalletTx& wtxNew, bool fAskFee)\n+string CWallet::SendMoneyToDestination(const CTxDestination& address, int64 nValue, CWalletTx& wtxNew, bool fAskFee, const bool fForceFee)\n {\n     // Check amount\n     if (nValue <= 0)\n@@ -1296,7 +1299,7 @@ string CWallet::SendMoneyToDestination(const CTxDestination& address, int64 nVal\n     CScript scriptPubKey;\n     scriptPubKey.SetDestination(address);\n \n-    return SendMoney(scriptPubKey, nValue, wtxNew, fAskFee);\n+    return SendMoney(scriptPubKey, nValue, wtxNew, fAskFee, fForceFee);\n }\n \n "
      },
      {
        "sha": "cd0d6daa0e3d4fe611bf10d44622d208efdffe23",
        "filename": "src/wallet.h",
        "status": "modified",
        "additions": 4,
        "deletions": 4,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/65c7141731b976af467ff23d234acf2244ffefe3/src/wallet.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/65c7141731b976af467ff23d234acf2244ffefe3/src/wallet.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet.h?ref=65c7141731b976af467ff23d234acf2244ffefe3",
        "patch": "@@ -148,11 +148,11 @@ class CWallet : public CCryptoKeyStore\n     int64 GetBalance() const;\n     int64 GetUnconfirmedBalance() const;\n     int64 GetImmatureBalance() const;\n-    bool CreateTransaction(const std::vector<std::pair<CScript, int64> >& vecSend, CWalletTx& wtxNew, CReserveKey& reservekey, int64& nFeeRet);\n-    bool CreateTransaction(CScript scriptPubKey, int64 nValue, CWalletTx& wtxNew, CReserveKey& reservekey, int64& nFeeRet);\n+    bool CreateTransaction(const std::vector<std::pair<CScript, int64> >& vecSend, CWalletTx& wtxNew, CReserveKey& reservekey, int64& nFeeRet, const bool fForceFee=false);\n+    bool CreateTransaction(CScript scriptPubKey, int64 nValue, CWalletTx& wtxNew, CReserveKey& reservekey, int64& nFeeRet, const bool fForceFee=false);\n     bool CommitTransaction(CWalletTx& wtxNew, CReserveKey& reservekey);\n-    std::string SendMoney(CScript scriptPubKey, int64 nValue, CWalletTx& wtxNew, bool fAskFee=false);\n-    std::string SendMoneyToDestination(const CTxDestination &address, int64 nValue, CWalletTx& wtxNew, bool fAskFee=false);\n+    std::string SendMoney(CScript scriptPubKey, int64 nValue, CWalletTx& wtxNew, bool fAskFee=false, const bool fForceFee=false);\n+    std::string SendMoneyToDestination(const CTxDestination &address, int64 nValue, CWalletTx& wtxNew, bool fAskFee=false, const bool fForceFee=false);\n \n     bool NewKeyPool();\n     bool TopUpKeyPool();"
      }
    ]
  },
  {
    "sha": "fff1f424c612b8fa29fcc7786e00cece353ffdf7",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmZmYxZjQyNGM2MTJiOGZhMjlmY2M3Nzg2ZTAwY2VjZTM1M2ZmZGY3",
    "commit": {
      "author": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2011-12-21T22:20:20Z"
      },
      "committer": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2012-08-01T20:33:22Z"
      },
      "message": "Accept automatic fees up to new \"maxtxfee\" parameter",
      "tree": {
        "sha": "9cd3676e08859482c43b80f53123c6d0e34c1974",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9cd3676e08859482c43b80f53123c6d0e34c1974"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fff1f424c612b8fa29fcc7786e00cece353ffdf7",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fff1f424c612b8fa29fcc7786e00cece353ffdf7",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fff1f424c612b8fa29fcc7786e00cece353ffdf7",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fff1f424c612b8fa29fcc7786e00cece353ffdf7/comments",
    "author": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "65c7141731b976af467ff23d234acf2244ffefe3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/65c7141731b976af467ff23d234acf2244ffefe3",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/65c7141731b976af467ff23d234acf2244ffefe3"
      }
    ],
    "stats": {
      "total": 49,
      "additions": 38,
      "deletions": 11
    },
    "files": [
      {
        "sha": "be2ab56bc7825cf1d5cc69eee0e8f5baea16de17",
        "filename": "src/bitcoinrpc.cpp",
        "status": "modified",
        "additions": 28,
        "deletions": 10,
        "changes": 38,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fff1f424c612b8fa29fcc7786e00cece353ffdf7/src/bitcoinrpc.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fff1f424c612b8fa29fcc7786e00cece353ffdf7/src/bitcoinrpc.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bitcoinrpc.cpp?ref=fff1f424c612b8fa29fcc7786e00cece353ffdf7",
        "patch": "@@ -391,6 +391,7 @@ Value getinfo(const Array& params, bool fHelp)\n     obj.push_back(Pair(\"keypoololdest\", (boost::int64_t)pwalletMain->GetOldestKeyPoolTime()));\n     obj.push_back(Pair(\"keypoolsize\",   pwalletMain->GetKeyPoolSize()));\n     obj.push_back(Pair(\"paytxfee\",      ValueFromAmount(nTransactionFee)));\n+    obj.push_back(Pair(\"maxtxfee\",      ValueFromAmount(nTransactionFeeMax)));\n     obj.push_back(Pair(\"forcetxfee\",    fForceFee));\n     if (pwalletMain->IsCrypted())\n         obj.push_back(Pair(\"unlocked_until\", (boost::int64_t)nWalletUnlockTime / 1000));\n@@ -581,26 +582,42 @@ Value settxfee(const Array& params, bool fHelp)\n {\n     if (GetBoolArg(\"-nosafefees\"))\n     {\n-        if (fHelp || params.size() < 1 || params.size() > 2)\n+        if (fHelp || params.size() < 1 || params.size() > 3)\n             throw runtime_error(\n-                \"settxfee <amount> [force]\\n\"\n-                \"<amount> is a real and is rounded to the nearest 0.00000001\\n\"\n+                \"settxfee <default amount> [maximum amount] [force]\\n\"\n+                \"<default amount> specifies the transaction fee to include in all transactions\\n\"\n+                \"[maximum amount] specifies the upper limit of how high the client will automatically\\n\"\n+                \"                 adjust your fee as it deems necessary\\n\"\n                 \"[force] is a boolean that enables sending less than the safe minimum fee\");\n     }\n     else\n-    if (fHelp || params.size() < 1 || params.size() > 1)\n+    if (fHelp || params.size() < 1 || params.size() > 2)\n         throw runtime_error(\n-            \"settxfee <amount>\\n\"\n-            \"<amount> is a real and is rounded to the nearest 0.00000001\");\n+            \"settxfee <default amount> [maximum amount]\\n\"\n+            \"<default amount> specifies the transaction fee to include in all transactions\\n\"\n+            \"[maximum amount] specifies the upper limit of how high the client will automatically\\n\"\n+            \"                 adjust your fee as it deems necessary\");\n \n-    // Amount\n+    // Amounts\n     int64 nAmount = 0;\n     if (params[0].get_real() != 0.0)\n         nAmount = AmountFromValue(params[0]);        // rejects 0.0 amounts\n \n-    nTransactionFee = nAmount;\n     if (params.size() > 1)\n-        fForceFee = params[1].get_bool();\n+    {\n+        int64 nAmountMax;\n+        if (params[1].get_real() == 0.0)\n+            nAmountMax = 0;\n+        else\n+            nAmountMax = AmountFromValue(params[1]);\n+        if (nAmountMax < nAmount)\n+            throw runtime_error(\"Maximum fee, if provided, should be at least the amount of the default fee\");\n+        nTransactionFeeMax = nAmountMax;\n+    }\n+    nTransactionFee = nAmount;\n+    if (params.size() > 2)\n+        fForceFee = params[2].get_bool();\n+\n     return true;\n }\n \n@@ -3011,7 +3028,8 @@ Array RPCConvertValues(const std::string &strMethod, const std::vector<std::stri\n     if (strMethod == \"setgenerate\"            && n > 1) ConvertTo<boost::int64_t>(params[1]);\n     if (strMethod == \"sendtoaddress\"          && n > 1) ConvertTo<double>(params[1]);\n     if (strMethod == \"settxfee\"               && n > 0) ConvertTo<double>(params[0]);\n-    if (strMethod == \"settxfee\"               && n > 1) ConvertTo<bool>(params[1]);\n+    if (strMethod == \"settxfee\"               && n > 1) ConvertTo<double>(params[1]);\n+    if (strMethod == \"settxfee\"               && n > 2) ConvertTo<bool>(params[2]);\n     if (strMethod == \"getreceivedbyaddress\"   && n > 1) ConvertTo<boost::int64_t>(params[1]);\n     if (strMethod == \"getreceivedbyaccount\"   && n > 1) ConvertTo<boost::int64_t>(params[1]);\n     if (strMethod == \"listreceivedbyaddress\"  && n > 0) ConvertTo<boost::int64_t>(params[0]);"
      },
      {
        "sha": "135ac7f5de700bee6404a7444cc815f9922a86e9",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 6,
        "deletions": 0,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fff1f424c612b8fa29fcc7786e00cece353ffdf7/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fff1f424c612b8fa29fcc7786e00cece353ffdf7/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=fff1f424c612b8fa29fcc7786e00cece353ffdf7",
        "patch": "@@ -420,6 +420,12 @@ bool AppInit2()\n             InitWarning(_(\"Warning: -paytxfee is set very high! This is the transaction fee you will pay if you send a transaction.\"));\n     }\n \n+    if (mapArgs.count(\"-maxtxfee\"))\n+    {\n+        if (!ParseMoney(mapArgs[\"-maxtxfee\"], nTransactionFeeMax))\n+            return InitError(strprintf(_(\"Invalid amount for -maxtxfee=<amount>: '%s'\"), mapArgs[\"-maxtxfee\"].c_str()));\n+    }\n+\n     // ********************************************************* Step 4: application initialization: dir lock, daemonize, pidfile, debug log\n \n     // Make sure only a single Bitcoin process is using the data directory."
      },
      {
        "sha": "8da73b01c7fd4b752515a8db475aec60ee7d9bc9",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fff1f424c612b8fa29fcc7786e00cece353ffdf7/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fff1f424c612b8fa29fcc7786e00cece353ffdf7/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=fff1f424c612b8fa29fcc7786e00cece353ffdf7",
        "patch": "@@ -56,6 +56,7 @@ int64 nHPSTimerStart;\n \n // Settings\n int64 nTransactionFee = 0;\n+int64 nTransactionFeeMax = CENT;\n bool fForceFee = false;\n \n "
      },
      {
        "sha": "7341e5e3c1c83e326de74214189ffaa6b2f259af",
        "filename": "src/main.h",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fff1f424c612b8fa29fcc7786e00cece353ffdf7/src/main.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fff1f424c612b8fa29fcc7786e00cece353ffdf7/src/main.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.h?ref=fff1f424c612b8fa29fcc7786e00cece353ffdf7",
        "patch": "@@ -70,6 +70,7 @@ extern unsigned char pchMessageStart[4];\n \n // Settings\n extern int64 nTransactionFee;\n+extern int64 nTransactionFeeMax;\n extern bool fForceFee;\n \n // Minimum disk space required - used in CheckDiskSpace()"
      },
      {
        "sha": "25633a7180fc45f4ef0f099010e04bf77756027e",
        "filename": "src/noui.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fff1f424c612b8fa29fcc7786e00cece353ffdf7/src/noui.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fff1f424c612b8fa29fcc7786e00cece353ffdf7/src/noui.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/noui.cpp?ref=fff1f424c612b8fa29fcc7786e00cece353ffdf7",
        "patch": "@@ -7,6 +7,7 @@\n #include \"bitcoinrpc.h\"\n \n #include <string>\n+#include \"main.h\"\n \n static int noui_ThreadSafeMessageBox(const std::string& message, const std::string& caption, int style)\n {\n@@ -17,7 +18,7 @@ static int noui_ThreadSafeMessageBox(const std::string& message, const std::stri\n \n static bool noui_ThreadSafeAskFee(int64 nFeeRequired, const std::string& strCaption)\n {\n-    return false;\n+    return nFeeRequired == nTransactionFee || nFeeRequired <= nTransactionFeeMax;\n }\n \n void noui_connect()"
      }
    ]
  },
  {
    "sha": "97412a54633addab3e5311a1f0c27ed3c37dcf64",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5NzQxMmE1NDYzM2FkZGFiM2U1MzExYTFmMGMyN2VkM2MzN2RjZjY0",
    "commit": {
      "author": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2011-12-21T22:21:05Z"
      },
      "committer": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2012-08-01T20:34:07Z"
      },
      "message": "Accept any transaction (fee-free or even non-standard) from myself",
      "tree": {
        "sha": "27d6fc75632c92765080c3c0ac150f9be6ab14df",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/27d6fc75632c92765080c3c0ac150f9be6ab14df"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/97412a54633addab3e5311a1f0c27ed3c37dcf64",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/97412a54633addab3e5311a1f0c27ed3c37dcf64",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/97412a54633addab3e5311a1f0c27ed3c37dcf64",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/97412a54633addab3e5311a1f0c27ed3c37dcf64/comments",
    "author": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "fff1f424c612b8fa29fcc7786e00cece353ffdf7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fff1f424c612b8fa29fcc7786e00cece353ffdf7",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/fff1f424c612b8fa29fcc7786e00cece353ffdf7"
      }
    ],
    "stats": {
      "total": 13,
      "additions": 10,
      "deletions": 3
    },
    "files": [
      {
        "sha": "f9460bcf11cf6ec7c5fc186e9e1593608cc5be90",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 10,
        "deletions": 3,
        "changes": 13,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/97412a54633addab3e5311a1f0c27ed3c37dcf64/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/97412a54633addab3e5311a1f0c27ed3c37dcf64/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=97412a54633addab3e5311a1f0c27ed3c37dcf64",
        "patch": "@@ -492,8 +492,10 @@ bool CTxMemPool::accept(CTxDB& txdb, CTransaction &tx, bool fCheckInputs,\n     if ((int64)tx.nLockTime > std::numeric_limits<int>::max())\n         return error(\"CTxMemPool::accept() : not accepting nLockTime beyond 2038 yet\");\n \n+    bool fFromMe = pwalletMain->IsFromMe(tx);\n+\n     // Rather not work on nonstandard transactions (unless -testnet)\n-    if (!fTestNet && !tx.IsStandard())\n+    if (!fTestNet && !tx.IsStandard() && !fFromMe)\n         return error(\"CTxMemPool::accept() : nonstandard transaction type\");\n \n     // Do we already have it?\n@@ -550,7 +552,7 @@ bool CTxMemPool::accept(CTxDB& txdb, CTransaction &tx, bool fCheckInputs,\n         }\n \n         // Check for non-standard pay-to-script-hash in inputs\n-        if (!tx.AreInputsStandard(mapInputs) && !fTestNet)\n+        if (!tx.AreInputsStandard(mapInputs) && !fFromMe && !fTestNet)\n             return error(\"CTxMemPool::accept() : nonstandard transaction input\");\n \n         // Note: if you modify this code to accept non-standard transactions, then\n@@ -560,6 +562,9 @@ bool CTxMemPool::accept(CTxDB& txdb, CTransaction &tx, bool fCheckInputs,\n         int64 nFees = tx.GetValueIn(mapInputs)-tx.GetValueOut();\n         unsigned int nSize = ::GetSerializeSize(tx, SER_NETWORK, PROTOCOL_VERSION);\n \n+        if (!fFromMe)\n+        {\n+\n         // Don't accept it if it can't get into a block\n         if (nFees < tx.GetMinFee(1000, true, GMF_RELAY))\n             return error(\"CTxMemPool::accept() : not enough fees\");\n@@ -589,6 +594,8 @@ bool CTxMemPool::accept(CTxDB& txdb, CTransaction &tx, bool fCheckInputs,\n             }\n         }\n \n+        }\n+\n         // Check against previous transactions\n         // This is done last to help prevent CPU exhaustion denial-of-service attacks.\n         if (!tx.ConnectInputs(mapInputs, mapUnused, CDiskTxPos(1,1,1), pindexBest, false, false))\n@@ -3536,7 +3543,7 @@ CBlock* CreateNewBlock(CReserveKey& reservekey)\n                 continue;\n \n             // Skip free transactions if we're past the minimum block size:\n-            if (fSortedByFee && (dFeePerKb < nMinTxFee) && (nBlockSize + nTxSize >= nBlockMinSize))\n+            if (fSortedByFee && (dFeePerKb < nMinTxFee) && (nBlockSize + nTxSize >= nBlockMinSize) && !pwalletMain->IsFromMe(tx))\n                 continue;\n \n             // Prioritize by fee once past the priority size or we run out of high-priority"
      }
    ]
  },
  {
    "sha": "eb130ae6478f8569d669d718bc11068a7f5f6dfe",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzplYjEzMGFlNjQ3OGY4NTY5ZDY2OWQ3MThiYzExMDY4YTdmNWY2ZGZl",
    "commit": {
      "author": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2011-12-21T22:24:32Z"
      },
      "committer": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2012-08-01T20:34:12Z"
      },
      "message": "Refactor maxtxfee and -nosafefees slightly to work together",
      "tree": {
        "sha": "14af60cb48b8788979284ea68aabfb0010925c9d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/14af60cb48b8788979284ea68aabfb0010925c9d"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/eb130ae6478f8569d669d718bc11068a7f5f6dfe",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/eb130ae6478f8569d669d718bc11068a7f5f6dfe",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/eb130ae6478f8569d669d718bc11068a7f5f6dfe",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/eb130ae6478f8569d669d718bc11068a7f5f6dfe/comments",
    "author": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "97412a54633addab3e5311a1f0c27ed3c37dcf64",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/97412a54633addab3e5311a1f0c27ed3c37dcf64",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/97412a54633addab3e5311a1f0c27ed3c37dcf64"
      }
    ],
    "stats": {
      "total": 48,
      "additions": 27,
      "deletions": 21
    },
    "files": [
      {
        "sha": "ab8d43c49a7b06aed128dd0ac633fd4a7806c446",
        "filename": "src/bitcoinrpc.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 3,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/eb130ae6478f8569d669d718bc11068a7f5f6dfe/src/bitcoinrpc.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/eb130ae6478f8569d669d718bc11068a7f5f6dfe/src/bitcoinrpc.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bitcoinrpc.cpp?ref=eb130ae6478f8569d669d718bc11068a7f5f6dfe",
        "patch": "@@ -646,7 +646,7 @@ Value sendtoaddress(const Array& params, bool fHelp)\n     if (pwalletMain->IsLocked())\n         throw JSONRPCError(-13, \"Error: Please enter the wallet passphrase with walletpassphrase first.\");\n \n-    string strError = pwalletMain->SendMoneyToDestination(address.Get(), nAmount, wtx, fForceFee);\n+    string strError = pwalletMain->SendMoneyToDestination(address.Get(), nAmount, wtx, true, fForceFee ? nTransactionFeeMax : MAX_MONEY);\n     if (strError != \"\")\n         throw JSONRPCError(-4, strError);\n \n@@ -978,7 +978,7 @@ Value sendfrom(const Array& params, bool fHelp)\n         throw JSONRPCError(-6, \"Account has insufficient funds\");\n \n     // Send\n-    string strError = pwalletMain->SendMoneyToDestination(address.Get(), nAmount, wtx, fForceFee);\n+    string strError = pwalletMain->SendMoneyToDestination(address.Get(), nAmount, wtx, true, fForceFee ? nTransactionFeeMax : MAX_MONEY);\n     if (strError != \"\")\n         throw JSONRPCError(-4, strError);\n \n@@ -1037,7 +1037,7 @@ Value sendmany(const Array& params, bool fHelp)\n     // Send\n     CReserveKey keyChange(pwalletMain);\n     int64 nFeeRequired = 0;\n-    bool fCreated = pwalletMain->CreateTransaction(vecSend, wtx, keyChange, nFeeRequired, fForceFee);\n+    bool fCreated = pwalletMain->CreateTransaction(vecSend, wtx, keyChange, nFeeRequired, fForceFee ? nTransactionFeeMax : MAX_MONEY);\n     if (!fCreated)\n     {\n         if (totalAmount + nFeeRequired > pwalletMain->GetBalance())"
      },
      {
        "sha": "9825dd65e3669f2a7d35903a0c99e68d83383928",
        "filename": "src/wallet.cpp",
        "status": "modified",
        "additions": 20,
        "deletions": 14,
        "changes": 34,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/eb130ae6478f8569d669d718bc11068a7f5f6dfe/src/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/eb130ae6478f8569d669d718bc11068a7f5f6dfe/src/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet.cpp?ref=eb130ae6478f8569d669d718bc11068a7f5f6dfe",
        "patch": "@@ -1075,7 +1075,7 @@ bool CWallet::SelectCoins(int64 nTargetValue, set<pair<const CWalletTx*,unsigned\n \n \n \n-bool CWallet::CreateTransaction(const vector<pair<CScript, int64> >& vecSend, CWalletTx& wtxNew, CReserveKey& reservekey, int64& nFeeRet, const bool fForceFee)\n+bool CWallet::CreateTransaction(const vector<pair<CScript, int64> >& vecSend, CWalletTx& wtxNew, CReserveKey& reservekey, int64& nFeeRet, const int64 nMaxFee)\n {\n     int64 nValue = 0;\n     BOOST_FOREACH (const PAIRTYPE(CScript, int64)& s, vecSend)\n@@ -1122,11 +1122,15 @@ bool CWallet::CreateTransaction(const vector<pair<CScript, int64> >& vecSend, CW\n                 // if sub-cent change is required, the fee must be raised to at least MIN_TX_FEE\n                 // or until nChange becomes zero\n                 // NOTE: this depends on the exact behaviour of GetMinFee\n-                if (!fForceFee && nFeeRet < MIN_TX_FEE && nChange > 0 && nChange < CENT)\n+                if (nChange > 0 && nChange < CENT)\n                 {\n-                    int64 nMoveToFee = min(nChange, MIN_TX_FEE - nFeeRet);\n-                    nChange -= nMoveToFee;\n-                    nFeeRet += nMoveToFee;\n+                    int64 nFeeForChange = min(MIN_TX_FEE, nMaxFee);\n+                    if (nFeeRet < nFeeForChange)\n+                    {\n+                        int64 nMoveToFee = min(nChange, nFeeForChange - nFeeRet);\n+                        nChange -= nMoveToFee;\n+                        nFeeRet += nMoveToFee;\n+                    }\n                 }\n \n                 if (nChange > 0)\n@@ -1171,15 +1175,17 @@ bool CWallet::CreateTransaction(const vector<pair<CScript, int64> >& vecSend, CW\n                     return false;\n                 dPriority /= nBytes;\n \n-                if (!fForceFee)\n+                if (nMaxFee > nFeeRet)\n                 {\n                     // Check that enough fee is included\n                     int64 nPayFee = nTransactionFee * (1 + (int64)nBytes / 1000);\n                     bool fAllowFree = CTransaction::AllowFree(dPriority);\n                     int64 nMinFee = wtxNew.GetMinFee(1, fAllowFree, GMF_SEND);\n-                    if (nFeeRet < max(nPayFee, nMinFee))\n+                    nMinFee = max(nPayFee, nMinFee);\n+                    nMinFee = min(nMinFee, nMaxFee);\n+                    if (nFeeRet < nMinFee)\n                     {\n-                        nFeeRet = max(nPayFee, nMinFee);\n+                        nFeeRet = nMinFee;\n                         continue;\n                     }\n                 }\n@@ -1195,11 +1201,11 @@ bool CWallet::CreateTransaction(const vector<pair<CScript, int64> >& vecSend, CW\n     return true;\n }\n \n-bool CWallet::CreateTransaction(CScript scriptPubKey, int64 nValue, CWalletTx& wtxNew, CReserveKey& reservekey, int64& nFeeRet, const bool fForceFee)\n+bool CWallet::CreateTransaction(CScript scriptPubKey, int64 nValue, CWalletTx& wtxNew, CReserveKey& reservekey, int64& nFeeRet, const int64 nMaxFee)\n {\n     vector< pair<CScript, int64> > vecSend;\n     vecSend.push_back(make_pair(scriptPubKey, nValue));\n-    return CreateTransaction(vecSend, wtxNew, reservekey, nFeeRet, fForceFee);\n+    return CreateTransaction(vecSend, wtxNew, reservekey, nFeeRet, nMaxFee);\n }\n \n // Call after CreateTransaction unless you want to abort\n@@ -1254,7 +1260,7 @@ bool CWallet::CommitTransaction(CWalletTx& wtxNew, CReserveKey& reservekey)\n \n \n \n-string CWallet::SendMoney(CScript scriptPubKey, int64 nValue, CWalletTx& wtxNew, bool fAskFee, const bool fForceFee)\n+string CWallet::SendMoney(CScript scriptPubKey, int64 nValue, CWalletTx& wtxNew, bool fAskFee, const int64 nMaxFee)\n {\n     CReserveKey reservekey(this);\n     int64 nFeeRequired;\n@@ -1265,7 +1271,7 @@ string CWallet::SendMoney(CScript scriptPubKey, int64 nValue, CWalletTx& wtxNew,\n         printf(\"SendMoney() : %s\", strError.c_str());\n         return strError;\n     }\n-    if (!CreateTransaction(scriptPubKey, nValue, wtxNew, reservekey, nFeeRequired, fForceFee))\n+    if (!CreateTransaction(scriptPubKey, nValue, wtxNew, reservekey, nFeeRequired, nMaxFee))\n     {\n         string strError;\n         if (nValue + nFeeRequired > GetBalance())\n@@ -1287,7 +1293,7 @@ string CWallet::SendMoney(CScript scriptPubKey, int64 nValue, CWalletTx& wtxNew,\n \n \n \n-string CWallet::SendMoneyToDestination(const CTxDestination& address, int64 nValue, CWalletTx& wtxNew, bool fAskFee, const bool fForceFee)\n+string CWallet::SendMoneyToDestination(const CTxDestination& address, int64 nValue, CWalletTx& wtxNew, bool fAskFee, const int64 nMaxFee)\n {\n     // Check amount\n     if (nValue <= 0)\n@@ -1299,7 +1305,7 @@ string CWallet::SendMoneyToDestination(const CTxDestination& address, int64 nVal\n     CScript scriptPubKey;\n     scriptPubKey.SetDestination(address);\n \n-    return SendMoney(scriptPubKey, nValue, wtxNew, fAskFee, fForceFee);\n+    return SendMoney(scriptPubKey, nValue, wtxNew, fAskFee, nMaxFee);\n }\n \n "
      },
      {
        "sha": "616fda8e084e4ad0ca197758be6b973c1808eddf",
        "filename": "src/wallet.h",
        "status": "modified",
        "additions": 4,
        "deletions": 4,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/eb130ae6478f8569d669d718bc11068a7f5f6dfe/src/wallet.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/eb130ae6478f8569d669d718bc11068a7f5f6dfe/src/wallet.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet.h?ref=eb130ae6478f8569d669d718bc11068a7f5f6dfe",
        "patch": "@@ -148,11 +148,11 @@ class CWallet : public CCryptoKeyStore\n     int64 GetBalance() const;\n     int64 GetUnconfirmedBalance() const;\n     int64 GetImmatureBalance() const;\n-    bool CreateTransaction(const std::vector<std::pair<CScript, int64> >& vecSend, CWalletTx& wtxNew, CReserveKey& reservekey, int64& nFeeRet, const bool fForceFee=false);\n-    bool CreateTransaction(CScript scriptPubKey, int64 nValue, CWalletTx& wtxNew, CReserveKey& reservekey, int64& nFeeRet, const bool fForceFee=false);\n+    bool CreateTransaction(const std::vector<std::pair<CScript, int64> >& vecSend, CWalletTx& wtxNew, CReserveKey& reservekey, int64& nFeeRet, const int64 nMaxFee=0x7fffffff);\n+    bool CreateTransaction(CScript scriptPubKey, int64 nValue, CWalletTx& wtxNew, CReserveKey& reservekey, int64& nFeeRet, const int64 nMaxFee=0x7fffffff);\n     bool CommitTransaction(CWalletTx& wtxNew, CReserveKey& reservekey);\n-    std::string SendMoney(CScript scriptPubKey, int64 nValue, CWalletTx& wtxNew, bool fAskFee=false, const bool fForceFee=false);\n-    std::string SendMoneyToDestination(const CTxDestination &address, int64 nValue, CWalletTx& wtxNew, bool fAskFee=false, const bool fForceFee=false);\n+    std::string SendMoney(CScript scriptPubKey, int64 nValue, CWalletTx& wtxNew, bool fAskFee=false, const int64 nMaxFee=0x7fffffff);\n+    std::string SendMoneyToDestination(const CTxDestination &address, int64 nValue, CWalletTx& wtxNew, bool fAskFee=false, const int64 nMaxFee=0x7fffffff);\n \n     bool NewKeyPool();\n     bool TopUpKeyPool();"
      }
    ]
  }
]