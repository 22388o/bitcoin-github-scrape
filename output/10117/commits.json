[
  {
    "sha": "916351e321b786080fa3322a07251b645bc4bb51",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5MTYzNTFlMzIxYjc4NjA4MGZhMzMyMmEwNzI1MWI2NDViYzRiYjUx",
    "commit": {
      "author": {
        "name": "Russell Yanofsky",
        "email": "russ@yanofsky.org",
        "date": "2017-03-29T18:01:40Z"
      },
      "committer": {
        "name": "Russell Yanofsky",
        "email": "russ@yanofsky.org",
        "date": "2017-03-29T18:01:40Z"
      },
      "message": "Add --skip-gui-tests option to bitcoin_test-qt\n\nAllows partial execution of qt tests on systems that have x11 libraries but\naren't running an X server or framebuffer.",
      "tree": {
        "sha": "fc53919967e4d4dee0f256471cdc587e2082779f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/fc53919967e4d4dee0f256471cdc587e2082779f"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/916351e321b786080fa3322a07251b645bc4bb51",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/916351e321b786080fa3322a07251b645bc4bb51",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/916351e321b786080fa3322a07251b645bc4bb51",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/916351e321b786080fa3322a07251b645bc4bb51/comments",
    "author": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "919aaf6508557439ab859c25dae86998a9bed12f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/919aaf6508557439ab859c25dae86998a9bed12f",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/919aaf6508557439ab859c25dae86998a9bed12f"
      }
    ],
    "stats": {
      "total": 9,
      "additions": 7,
      "deletions": 2
    },
    "files": [
      {
        "sha": "953f6a7879ee65bb0709243886060fe187da8960",
        "filename": "src/qt/test/test_main.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 2,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/916351e321b786080fa3322a07251b645bc4bb51/src/qt/test/test_main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/916351e321b786080fa3322a07251b645bc4bb51/src/qt/test/test_main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/test/test_main.cpp?ref=916351e321b786080fa3322a07251b645bc4bb51",
        "patch": "@@ -46,6 +46,7 @@ extern void noui_connect();\n // This is all you need to run all the tests\n int main(int argc, char *argv[])\n {\n+    ParseParameters(argc, argv);\n     SetupEnvironment();\n     SetupNetworking();\n     SelectParams(CBaseChainParams::MAIN);\n@@ -55,8 +56,8 @@ int main(int argc, char *argv[])\n \n     // Don't remove this, it's needed to access\n     // QApplication:: and QCoreApplication:: in the tests\n-    QApplication app(argc, argv);\n-    app.setApplicationName(\"Bitcoin-Qt-test\");\n+    std::unique_ptr<QCoreApplication> app(GetBoolArg(\"-skip-gui-tests\", false) ? new QCoreApplication(argc, argv) : new QApplication(argc, argv));\n+    app->setApplicationName(\"Bitcoin-Qt-test\");\n \n     SSL_library_init();\n "
      },
      {
        "sha": "93e8bc7715342a68c0d62dbaf24d6406cd64946a",
        "filename": "src/qt/test/wallettests.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 0,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/916351e321b786080fa3322a07251b645bc4bb51/src/qt/test/wallettests.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/916351e321b786080fa3322a07251b645bc4bb51/src/qt/test/wallettests.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/test/wallettests.cpp?ref=916351e321b786080fa3322a07251b645bc4bb51",
        "patch": "@@ -71,6 +71,10 @@ QModelIndex FindTx(const QAbstractItemModel& model, const uint256& txid)\n //! Simple qt wallet tests.\n void WalletTests::walletTests()\n {\n+    if (GetBoolArg(\"-skip-gui-tests\", false)) {\n+        return;\n+    }\n+\n     // Set up wallet and chain with 101 blocks (1 mature block for spending).\n     TestChain100Setup test;\n     test.CreateAndProcessBlock({}, GetScriptForRawPubKey(test.coinbaseKey.GetPubKey()));"
      }
    ]
  },
  {
    "sha": "5bf26c808a2a20c1fd5385a0bd86b9f9f411264e",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1YmYyNmM4MDhhMmEyMGMxZmQ1Mzg1YTBiZDg2YjlmOWY0MTEyNjRl",
    "commit": {
      "author": {
        "name": "Russell Yanofsky",
        "email": "russ@yanofsky.org",
        "date": "2017-03-29T18:15:19Z"
      },
      "committer": {
        "name": "Russell Yanofsky",
        "email": "russ@yanofsky.org",
        "date": "2017-03-29T18:15:19Z"
      },
      "message": "Run bitcoin_test-qt under xvfb-run, if available\n\nIf xvfb-run is not available, run an autoconf check to determine if\ninstantiating a QApplication is possible, and if not, run the test with\n--skip-gui-tests.\n\nFixes broken \"make check\" reported by Matt Corallo <git@bluematt.me> in\nhttps://github.com/bitcoin/bitcoin/issues/10110\n\nFixes #10110",
      "tree": {
        "sha": "1df063daf399475ea69ff768bea05e704d51dad0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1df063daf399475ea69ff768bea05e704d51dad0"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5bf26c808a2a20c1fd5385a0bd86b9f9f411264e",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5bf26c808a2a20c1fd5385a0bd86b9f9f411264e",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/5bf26c808a2a20c1fd5385a0bd86b9f9f411264e",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5bf26c808a2a20c1fd5385a0bd86b9f9f411264e/comments",
    "author": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "916351e321b786080fa3322a07251b645bc4bb51",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/916351e321b786080fa3322a07251b645bc4bb51",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/916351e321b786080fa3322a07251b645bc4bb51"
      }
    ],
    "stats": {
      "total": 45,
      "additions": 40,
      "deletions": 5
    },
    "files": [
      {
        "sha": "4b45df1fc29aecb6d09e024538984d52e0ab06f6",
        "filename": ".travis.yml",
        "status": "modified",
        "additions": 0,
        "deletions": 2,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5bf26c808a2a20c1fd5385a0bd86b9f9f411264e/.travis.yml",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5bf26c808a2a20c1fd5385a0bd86b9f9f411264e/.travis.yml",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/.travis.yml?ref=5bf26c808a2a20c1fd5385a0bd86b9f9f411264e",
        "patch": "@@ -50,8 +50,6 @@ before_script:\n     - if [ -n \"$OSX_SDK\" -a ! -f depends/sdk-sources/MacOSX${OSX_SDK}.sdk.tar.gz ]; then curl --location --fail $SDK_URL/MacOSX${OSX_SDK}.sdk.tar.gz -o depends/sdk-sources/MacOSX${OSX_SDK}.sdk.tar.gz; fi\n     - if [ -n \"$OSX_SDK\" -a -f depends/sdk-sources/MacOSX${OSX_SDK}.sdk.tar.gz ]; then tar -C depends/SDKs -xf depends/sdk-sources/MacOSX${OSX_SDK}.sdk.tar.gz; fi\n     - make $MAKEJOBS -C depends HOST=$HOST $DEP_OPTS\n-    # Start xvfb if needed, as documented at https://docs.travis-ci.com/user/gui-and-headless-browsers/#Using-xvfb-to-Run-Tests-That-Require-a-GUI\n-    - if [ \"$RUN_TESTS\" = \"true\" -a \"${DEP_OPTS#*NO_QT=1}\" = \"$DEP_OPTS\" ]; then export DISPLAY=:99.0; /sbin/start-stop-daemon --start --pidfile /tmp/custom_xvfb_99.pid --make-pidfile --background --exec /usr/bin/Xvfb -- :99 -ac; fi\n script:\n     - if [ \"$CHECK_DOC\" = 1 -a \"$TRAVIS_REPO_SLUG\" = \"bitcoin/bitcoin\" -a \"$TRAVIS_PULL_REQUEST\" = \"false\" ]; then while read LINE; do travis_retry gpg --keyserver hkp://subset.pool.sks-keyservers.net --recv-keys $LINE; done < contrib/verify-commits/trusted-keys; fi\n     - if [ \"$CHECK_DOC\" = 1 -a \"$TRAVIS_REPO_SLUG\" = \"bitcoin/bitcoin\" -a \"$TRAVIS_PULL_REQUEST\" = \"false\" ]; then git fetch --unshallow; fi"
      },
      {
        "sha": "95b7c59a15bb529bca9ce26090ff3e2bf05394bf",
        "filename": "configure.ac",
        "status": "modified",
        "additions": 31,
        "deletions": 2,
        "changes": 33,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5bf26c808a2a20c1fd5385a0bd86b9f9f411264e/configure.ac",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5bf26c808a2a20c1fd5385a0bd86b9f9f411264e/configure.ac",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/configure.ac?ref=5bf26c808a2a20c1fd5385a0bd86b9f9f411264e",
        "patch": "@@ -84,6 +84,7 @@ AC_PATH_PROG([GIT], [git])\n AC_PATH_PROG(CCACHE,ccache)\n AC_PATH_PROG(XGETTEXT,xgettext)\n AC_PATH_PROG(HEXDUMP,hexdump)\n+AC_PATH_PROG(XVFB_RUN,xvfb-run)\n AC_PATH_TOOL(READELF, readelf)\n AC_PATH_TOOL(CPPFILT, c++filt)\n AC_PATH_TOOL(OBJCOPY, objcopy)\n@@ -968,8 +969,6 @@ if test x$build_bitcoin_libs = xyes; then\n fi\n AC_MSG_RESULT($build_bitcoin_libs)\n \n-AC_LANG_POP\n-\n if test \"x$use_ccache\" != \"xno\"; then\n   AC_MSG_CHECKING(if ccache should be used)\n   if test x$CCACHE = x; then\n@@ -1061,11 +1060,39 @@ if test x$bitcoin_enable_qt != xno; then\n   if test x$use_gui_tests$bitcoin_enable_qt_test = xyesyes; then\n     AC_MSG_RESULT([yes])\n     BUILD_TEST_QT=\"yes\"\n+\n+    if test -z \"$XVFB_RUN\"; then\n+      dnl Check if it is possible to instantiate QApplication in the current\n+      dnl runtime environment. This check will fail on systems that use the\n+      dnl qt-xcb backend but do not have a DISPLAY environment variable set.\n+      dnl In this case, pass --skip-gui-tests to Qt test to avoid running\n+      dnl full tests (but still running tests not requiring QApplication).\n+      AC_MSG_CHECKING([if qt gui applications can run])\n+      TEMP_CPPFLAGS=$CPPFLAGS\n+      TEMP_CXXFLAGS=$CXXFLAGS\n+      TEMP_LIBS=$LIBS\n+      CPPFLAGS=\"$QT_INCLUDES $CPPFLAGS\"\n+      CXXFLAGS=\"$QT_PIE_FLAGS $CXXFLAGS\"\n+      LIBS=\"$QT_LIBS $LIBS\"\n+      AC_RUN_IFELSE([AC_LANG_SOURCE([\n+        #include <QApplication>\n+        int main(int argc, char *argv[[]]) {\n+          QApplication(argc, argv);\n+          return 0;\n+        }\n+      ])], [QT_GUI=yes], [QT_GUI=no; TEST_BITCOIN_QT_ARGS=--skip-gui-tests], [QT_GUI=\"no (cross compiling)\"])\n+      AC_MSG_RESULT([$QT_GUI])\n+      CPPFLAGS=$TEMP_CPPFLAGS\n+      CXXFLAGS=$TEMP_CXXFLAGS\n+      LIBS=$TEMP_LIBS\n+    fi\n   else\n     AC_MSG_RESULT([no])\n   fi\n fi\n \n+AC_LANG_POP\n+\n AM_CONDITIONAL([ENABLE_ZMQ], [test \"x$use_zmq\" = \"xyes\"])\n \n AC_MSG_CHECKING([whether to build test_bitcoin])\n@@ -1147,9 +1174,11 @@ AC_SUBST(EVENT_PTHREADS_LIBS)\n AC_SUBST(ZMQ_LIBS)\n AC_SUBST(PROTOBUF_LIBS)\n AC_SUBST(QR_LIBS)\n+AC_SUBST(TEST_BITCOIN_QT_ARGS)\n AC_CONFIG_FILES([Makefile src/Makefile doc/man/Makefile share/setup.nsi share/qt/Info.plist test/functional/config.ini])\n AC_CONFIG_FILES([test/util/buildenv.py],[chmod +x test/util/buildenv.py])\n AC_CONFIG_FILES([contrib/devtools/split-debug.sh],[chmod +x contrib/devtools/split-debug.sh])\n+AC_CONFIG_FILES([src/qt/test/test_bitcoin-qt.sh],[chmod +x src/qt/test/test_bitcoin-qt.sh])\n AC_CONFIG_LINKS([test/functional/test_runner.py:test/functional/test_runner.py])\n AC_CONFIG_LINKS([test/util/bitcoin-util-test.py:test/util/bitcoin-util-test.py])\n AC_CONFIG_LINKS([test/util/bctest.py:test/util/bctest.py])"
      },
      {
        "sha": "bfeaa57ad38edb445d01f4c79c2ad7446fc0b33f",
        "filename": "src/Makefile.am",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5bf26c808a2a20c1fd5385a0bd86b9f9f411264e/src/Makefile.am",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5bf26c808a2a20c1fd5385a0bd86b9f9f411264e/src/Makefile.am",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/Makefile.am?ref=5bf26c808a2a20c1fd5385a0bd86b9f9f411264e",
        "patch": "@@ -62,6 +62,7 @@ lib_LTLIBRARIES = $(LIBBITCOINCONSENSUS)\n \n bin_PROGRAMS =\n noinst_PROGRAMS =\n+AM_TESTS_ENVIRONMENT =\n TESTS =\n BENCHMARKS =\n "
      },
      {
        "sha": "558de9ff16882e0ba1d3ca0c68544af6eebca432",
        "filename": "src/Makefile.qttest.include",
        "status": "modified",
        "additions": 5,
        "deletions": 1,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5bf26c808a2a20c1fd5385a0bd86b9f9f411264e/src/Makefile.qttest.include",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5bf26c808a2a20c1fd5385a0bd86b9f9f411264e/src/Makefile.qttest.include",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/Makefile.qttest.include?ref=5bf26c808a2a20c1fd5385a0bd86b9f9f411264e",
        "patch": "@@ -3,7 +3,11 @@\n # file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n bin_PROGRAMS += qt/test/test_bitcoin-qt\n-TESTS += qt/test/test_bitcoin-qt\n+AM_TESTS_ENVIRONMENT += \\\n+    if test \"$(TEST_BITCOIN_QT_ARGS)\" = --skip-gui-tests; then \\\n+        echo \"Warning: Skipping GUI tests. To enable, either install xvfb-run or set the DISPLAY environment variable, then rerun the configure script.\"; \\\n+    fi;\n+TESTS += qt/test/test_bitcoin-qt.sh\n \n TEST_QT_MOC_CPP = \\\n   qt/test/moc_compattests.cpp \\"
      },
      {
        "sha": "ab3c6892a22e8129133200d527227e16a863cd59",
        "filename": "src/qt/test/test_bitcoin-qt.sh.in",
        "status": "added",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5bf26c808a2a20c1fd5385a0bd86b9f9f411264e/src/qt/test/test_bitcoin-qt.sh.in",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5bf26c808a2a20c1fd5385a0bd86b9f9f411264e/src/qt/test/test_bitcoin-qt.sh.in",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/test/test_bitcoin-qt.sh.in?ref=5bf26c808a2a20c1fd5385a0bd86b9f9f411264e",
        "patch": "@@ -0,0 +1,3 @@\n+#!/bin/sh\n+\n+exec @XVFB_RUN@ qt/test/test_bitcoin-qt@EXEEXT@ @TEST_BITCOIN_QT_ARGS@"
      }
    ]
  }
]