[
  {
    "sha": "46790135b949e9f7aae3af02ba9e63b7c3bcac62",
    "node_id": "C_kwDOABII59oAKDQ2NzkwMTM1Yjk0OWU5ZjdhYWUzYWYwMmJhOWU2M2I3YzNiY2FjNjI",
    "commit": {
      "author": {
        "name": "klementtan",
        "email": "klementtan@gmail.com",
        "date": "2021-10-30T14:22:40Z"
      },
      "committer": {
        "name": "klementtan",
        "email": "klementtan@gmail.com",
        "date": "2021-11-10T20:03:41Z"
      },
      "message": "util: Add -shutdownnotify option.",
      "tree": {
        "sha": "d219c2d90e0e6f25dc68a7f6b49144ce4b1a0d2e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d219c2d90e0e6f25dc68a7f6b49144ce4b1a0d2e"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/46790135b949e9f7aae3af02ba9e63b7c3bcac62",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEdzBbFgjg1umjfk4MZcjk/steXaIFAmGMJZ0ACgkQZcjk/ste\nXaIuXQ//TEICF/WeS7E+4L7c9hleGvrg9OyQSPuqoPWpOJJpF+8isaC+1AzBKdJh\nnoF4ZtXrm8eRXN/SgBW3MfGPSzKqXMEvZibQJh6fMqL28L/7AVlXbhgmIDtMoJw8\nx2QGrLjZj6RUVTBsILr6YaC5Myx1BXgKQIDSXMTbPY0dnr8IdpSWZ1zXMaDhnHfT\nWuPumgLDFNU+IcUH1lHfPhfPPp3Xkin8Wjn8oAJ1bfz4vuKHjGoW59oIO8jEq8Nc\nmURxJP+caf6c2+q7RJsGxG6yuZwNDHFl0T3AI9nH59HLgNvMsnJFPzigLYUWTmxg\nadeQqQEMZHJfYhaJDNA/2u01XnBSGM/shnj+5J+YzYeWwC5wPqFW84QUJ+P243pg\nft5dBvW+ZIxtf3dKunrN2oqvQbFz5sxs5jPMT1hGsRgU0zlttW1J5jDL7JPn9eqZ\nS0g8fPHYUp1uEv5mxvmk87kJaZAQghp/6xAu/ZzcnTjgdZxdLsClF9re1BnNdX/A\nB8XJjsX0hQ5YhOBJQ8/t3Y6yxgVFD9FKtALTrdKwgwCgg11IG6vn6Nd/pYym8Z/S\nMvEhYC/ejPzvco49eMwogi6tAOV9hthxY4tXnNDmM3bHvZ89hTvhNP0pyxyLpzny\nRpTPV1aWCbC0MkS6Opye764+XMIIgsmAbt+cx0FbHU2kr4WlXVQ=\n=AnKD\n-----END PGP SIGNATURE-----",
        "payload": "tree d219c2d90e0e6f25dc68a7f6b49144ce4b1a0d2e\nparent a8a272ac329da679bd489e272ed1773147f59eb9\nauthor klementtan <klementtan@gmail.com> 1635603760 +0800\ncommitter klementtan <klementtan@gmail.com> 1636574621 +0800\n\nutil: Add -shutdownnotify option.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/46790135b949e9f7aae3af02ba9e63b7c3bcac62",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/46790135b949e9f7aae3af02ba9e63b7c3bcac62",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/46790135b949e9f7aae3af02ba9e63b7c3bcac62/comments",
    "author": {
      "login": "klementtan",
      "id": 49265907,
      "node_id": "MDQ6VXNlcjQ5MjY1OTA3",
      "avatar_url": "https://avatars.githubusercontent.com/u/49265907?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/klementtan",
      "html_url": "https://github.com/klementtan",
      "followers_url": "https://api.github.com/users/klementtan/followers",
      "following_url": "https://api.github.com/users/klementtan/following{/other_user}",
      "gists_url": "https://api.github.com/users/klementtan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/klementtan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/klementtan/subscriptions",
      "organizations_url": "https://api.github.com/users/klementtan/orgs",
      "repos_url": "https://api.github.com/users/klementtan/repos",
      "events_url": "https://api.github.com/users/klementtan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/klementtan/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "klementtan",
      "id": 49265907,
      "node_id": "MDQ6VXNlcjQ5MjY1OTA3",
      "avatar_url": "https://avatars.githubusercontent.com/u/49265907?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/klementtan",
      "html_url": "https://github.com/klementtan",
      "followers_url": "https://api.github.com/users/klementtan/followers",
      "following_url": "https://api.github.com/users/klementtan/following{/other_user}",
      "gists_url": "https://api.github.com/users/klementtan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/klementtan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/klementtan/subscriptions",
      "organizations_url": "https://api.github.com/users/klementtan/orgs",
      "repos_url": "https://api.github.com/users/klementtan/repos",
      "events_url": "https://api.github.com/users/klementtan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/klementtan/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "a8a272ac329da679bd489e272ed1773147f59eb9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a8a272ac329da679bd489e272ed1773147f59eb9",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/a8a272ac329da679bd489e272ed1773147f59eb9"
      }
    ],
    "stats": {
      "total": 17,
      "additions": 17,
      "deletions": 0
    },
    "files": [
      {
        "sha": "9faa9f2fef20d14871c7a1fb2a67ca59500bb720",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 17,
        "deletions": 0,
        "changes": 17,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/46790135b949e9f7aae3af02ba9e63b7c3bcac62/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/46790135b949e9f7aae3af02ba9e63b7c3bcac62/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=46790135b949e9f7aae3af02ba9e63b7c3bcac62",
        "patch": "@@ -155,8 +155,24 @@ static fs::path GetPidFile(const ArgsManager& args)\n // shutdown thing.\n //\n \n+#if HAVE_SYSTEM\n+static void ShutdownNotify(const ArgsManager& args)\n+{\n+    std::vector<std::thread> threads;\n+    for (const auto& cmd : args.GetArgs(\"-shutdownnotify\")) {\n+        threads.emplace_back(runCommand, cmd);\n+    }\n+    for (auto& t : threads) {\n+        t.join();\n+    }\n+}\n+#endif\n+\n void Interrupt(NodeContext& node)\n {\n+#if HAVE_SYSTEM\n+    ShutdownNotify(*node.args);\n+#endif\n     InterruptHTTPServer();\n     InterruptHTTPRPC();\n     InterruptRPC();\n@@ -405,6 +421,7 @@ void SetupServerArgs(ArgsManager& argsman)\n     argsman.AddArg(\"-settings=<file>\", strprintf(\"Specify path to dynamic settings data file. Can be disabled with -nosettings. File is written at runtime and not meant to be edited by users (use %s instead for custom settings). Relative paths will be prefixed by datadir location. (default: %s)\", BITCOIN_CONF_FILENAME, BITCOIN_SETTINGS_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n #if HAVE_SYSTEM\n     argsman.AddArg(\"-startupnotify=<cmd>\", \"Execute command on startup.\", ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n+    argsman.AddArg(\"-shutdownnotify=<cmd>\", \"Execute command immediately before beginning shutdown. The need for shutdown may be urgent, so be careful not to delay it long (if the command doesn't require interaction with the server, consider having it fork into the background).\", ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n #endif\n #ifndef WIN32\n     argsman.AddArg(\"-sysperms\", \"Create new files with system default permissions, instead of umask 077 (only effective with disabled wallet functionality)\", ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);"
      }
    ]
  },
  {
    "sha": "772a7a2fe9c88ac23608333959ee7df65e61e4c0",
    "node_id": "C_kwDOABII59oAKDc3MmE3YTJmZTljODhhYzIzNjA4MzMzOTU5ZWU3ZGY2NWU2MWU0YzA",
    "commit": {
      "author": {
        "name": "klementtan",
        "email": "klementtan@gmail.com",
        "date": "2021-10-30T14:46:26Z"
      },
      "committer": {
        "name": "klementtan",
        "email": "klementtan@gmail.com",
        "date": "2021-11-10T20:03:44Z"
      },
      "message": "doc: Add release note for shutdownnotify.",
      "tree": {
        "sha": "22ea9d2c6a7002a150e343578df32adaeacfa992",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/22ea9d2c6a7002a150e343578df32adaeacfa992"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/772a7a2fe9c88ac23608333959ee7df65e61e4c0",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEdzBbFgjg1umjfk4MZcjk/steXaIFAmGMJaAACgkQZcjk/ste\nXaIwCA//WnNBQD8QXCd5dPh3JxrJKwoirTmwgYNEYjmUygsamQS/nIIUSZ6iH8O2\nhplJFCZcisI+w4Sx3XGhKv27Shy3uuoRZ/LIUY+/IOiS0D8B9VqNhfvHzKMcQ8zU\nVohLP3O9VP3QvWjaFaNYydF5KBxOO6x3mlneYtEYi5KWf8XRkWYHmXyU57beK4rl\n3yfb1hJhJyJkDU5JmWmrP8xvO38k9xsBqLMs2MPxPm8p4ne/mUpbZwTUJ42sYayd\noqn9VrUSz+4mDBENp9TXYljstSQhbLRENvVI33g7DBMCsRqfHrkWbBSlD5zwlTgx\n0GWKPeeNdAZxKk9X6D+a/dF0DqMpw+Wme5N+hCvGNi8zVGfxow+XWZMJ/4VBJUzQ\nasr5lV7p5zItE3Hh0A5HRh/o65TjqTeKFRcift547YyzuJtu49mb8dHRXTbwhc3d\niA74IzQjrOoXLHXCg3HTmlMIc/NIXbkmql4yN5XuIwkegLb2ZpppMDMOVqoY10e6\nIB60VbY7XmIE/gyuJapJuQLmTVW+wvsNYWHg71Az4ByVycvm26XCpfYQTtPXMjJ7\n8R0HkmhP0peMh85htFbm7/iPbg9cDrXEIzIXgYtGCNBFCuxmnlE0otcYNrCTFCoY\np0jKXA89bXO74a/+kGGe9cnnfjlN6LqG3K8QgAyBar2pUEL6+6A=\n=KKYA\n-----END PGP SIGNATURE-----",
        "payload": "tree 22ea9d2c6a7002a150e343578df32adaeacfa992\nparent 46790135b949e9f7aae3af02ba9e63b7c3bcac62\nauthor klementtan <klementtan@gmail.com> 1635605186 +0800\ncommitter klementtan <klementtan@gmail.com> 1636574624 +0800\n\ndoc: Add release note for shutdownnotify.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/772a7a2fe9c88ac23608333959ee7df65e61e4c0",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/772a7a2fe9c88ac23608333959ee7df65e61e4c0",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/772a7a2fe9c88ac23608333959ee7df65e61e4c0/comments",
    "author": {
      "login": "klementtan",
      "id": 49265907,
      "node_id": "MDQ6VXNlcjQ5MjY1OTA3",
      "avatar_url": "https://avatars.githubusercontent.com/u/49265907?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/klementtan",
      "html_url": "https://github.com/klementtan",
      "followers_url": "https://api.github.com/users/klementtan/followers",
      "following_url": "https://api.github.com/users/klementtan/following{/other_user}",
      "gists_url": "https://api.github.com/users/klementtan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/klementtan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/klementtan/subscriptions",
      "organizations_url": "https://api.github.com/users/klementtan/orgs",
      "repos_url": "https://api.github.com/users/klementtan/repos",
      "events_url": "https://api.github.com/users/klementtan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/klementtan/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "klementtan",
      "id": 49265907,
      "node_id": "MDQ6VXNlcjQ5MjY1OTA3",
      "avatar_url": "https://avatars.githubusercontent.com/u/49265907?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/klementtan",
      "html_url": "https://github.com/klementtan",
      "followers_url": "https://api.github.com/users/klementtan/followers",
      "following_url": "https://api.github.com/users/klementtan/following{/other_user}",
      "gists_url": "https://api.github.com/users/klementtan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/klementtan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/klementtan/subscriptions",
      "organizations_url": "https://api.github.com/users/klementtan/orgs",
      "repos_url": "https://api.github.com/users/klementtan/repos",
      "events_url": "https://api.github.com/users/klementtan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/klementtan/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "46790135b949e9f7aae3af02ba9e63b7c3bcac62",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/46790135b949e9f7aae3af02ba9e63b7c3bcac62",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/46790135b949e9f7aae3af02ba9e63b7c3bcac62"
      }
    ],
    "stats": {
      "total": 3,
      "additions": 3,
      "deletions": 0
    },
    "files": [
      {
        "sha": "6045d01cd71e6c2fa884d0e6147e252703006a18",
        "filename": "doc/release-notes.md",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/772a7a2fe9c88ac23608333959ee7df65e61e4c0/doc/release-notes.md",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/772a7a2fe9c88ac23608333959ee7df65e61e4c0/doc/release-notes.md",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/doc/release-notes.md?ref=772a7a2fe9c88ac23608333959ee7df65e61e4c0",
        "patch": "@@ -83,6 +83,9 @@ Files\n New settings\n ------------\n \n+- The `shutdownnotify` option is used to specify a command to execute synchronously\n+before Bitcoin Core has begun its shutdown sequence. (#23395)\n+\n Updated settings\n ----------------\n "
      }
    ]
  }
]