[
  {
    "sha": "8f2f760c95efc63b74543d4a1d4d105d37ceced2",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4ZjJmNzYwYzk1ZWZjNjNiNzQ1NDNkNGExZDRkMTA1ZDM3Y2VjZWQy",
    "commit": {
      "author": {
        "name": "Peter Todd",
        "email": "pete@petertodd.org",
        "date": "2013-03-08T07:44:38Z"
      },
      "committer": {
        "name": "Peter Todd",
        "email": "pete@petertodd.org",
        "date": "2013-03-10T00:50:42Z"
      },
      "message": "Create COIN_DUST_RATIO and COIN_DUST constants\n\nBased on work by Jeff Garzik",
      "tree": {
        "sha": "8abce423ef8c95be95deca32ceafc04e862d7d7b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8abce423ef8c95be95deca32ceafc04e862d7d7b"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8f2f760c95efc63b74543d4a1d4d105d37ceced2",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8f2f760c95efc63b74543d4a1d4d105d37ceced2",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/8f2f760c95efc63b74543d4a1d4d105d37ceced2",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8f2f760c95efc63b74543d4a1d4d105d37ceced2/comments",
    "author": {
      "login": "petertodd",
      "id": 7042,
      "node_id": "MDQ6VXNlcjcwNDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7042?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/petertodd",
      "html_url": "https://github.com/petertodd",
      "followers_url": "https://api.github.com/users/petertodd/followers",
      "following_url": "https://api.github.com/users/petertodd/following{/other_user}",
      "gists_url": "https://api.github.com/users/petertodd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/petertodd/subscriptions",
      "organizations_url": "https://api.github.com/users/petertodd/orgs",
      "repos_url": "https://api.github.com/users/petertodd/repos",
      "events_url": "https://api.github.com/users/petertodd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/petertodd/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "petertodd",
      "id": 7042,
      "node_id": "MDQ6VXNlcjcwNDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7042?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/petertodd",
      "html_url": "https://github.com/petertodd",
      "followers_url": "https://api.github.com/users/petertodd/followers",
      "following_url": "https://api.github.com/users/petertodd/following{/other_user}",
      "gists_url": "https://api.github.com/users/petertodd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/petertodd/subscriptions",
      "organizations_url": "https://api.github.com/users/petertodd/orgs",
      "repos_url": "https://api.github.com/users/petertodd/repos",
      "events_url": "https://api.github.com/users/petertodd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/petertodd/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "a0db772d13a33a3ff18b3dc615a4a1e9c81f6f43",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a0db772d13a33a3ff18b3dc615a4a1e9c81f6f43",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/a0db772d13a33a3ff18b3dc615a4a1e9c81f6f43"
      }
    ],
    "stats": {
      "total": 7,
      "additions": 5,
      "deletions": 2
    },
    "files": [
      {
        "sha": "9a09028a9987881870a0a46560259ab6c51e8fbc",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/8f2f760c95efc63b74543d4a1d4d105d37ceced2/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/8f2f760c95efc63b74543d4a1d4d105d37ceced2/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=8f2f760c95efc63b74543d4a1d4d105d37ceced2",
        "patch": "@@ -602,7 +602,7 @@ int64 CTransaction::GetMinFee(unsigned int nBlockSize, bool fAllowFree,\n     if (nMinFee < nBaseFee)\n     {\n         BOOST_FOREACH(const CTxOut& txout, vout)\n-            if (txout.nValue < CENT)\n+            if (txout.nValue < COIN_DUST)\n                 nMinFee = nBaseFee;\n     }\n "
      },
      {
        "sha": "5c07f4ad3add587550b24b1e680ff50cd1021f3c",
        "filename": "src/main.h",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/8f2f760c95efc63b74543d4a1d4d105d37ceced2/src/main.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/8f2f760c95efc63b74543d4a1d4d105d37ceced2/src/main.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.h?ref=8f2f760c95efc63b74543d4a1d4d105d37ceced2",
        "patch": "@@ -48,6 +48,9 @@ static const unsigned int MEMPOOL_HEIGHT = 0x7FFFFFFF;\n static const int64 MIN_TX_FEE = 50000;\n /** Fees smaller than this (in satoshi) are considered zero fee (for relaying) */\n static const int64 MIN_RELAY_TX_FEE = 10000;\n+/** Coin dust is defined as any output with less than this multiple of the minimum tx fee */\n+static const int64 COIN_DUST_RATIO = 20;\n+static const int64 COIN_DUST = MIN_TX_FEE * COIN_DUST_RATIO; // 0.01 BTC\n /** No amount larger than this (in satoshi) is valid */\n static const int64 MAX_MONEY = 21000000 * COIN;\n inline bool MoneyRange(int64 nValue) { return (nValue >= 0 && nValue <= MAX_MONEY); }"
      },
      {
        "sha": "76e5b06558e1ed4fcd6957a23cb69fa5aeddc924",
        "filename": "src/wallet.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/8f2f760c95efc63b74543d4a1d4d105d37ceced2/src/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/8f2f760c95efc63b74543d4a1d4d105d37ceced2/src/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet.cpp?ref=8f2f760c95efc63b74543d4a1d4d105d37ceced2",
        "patch": "@@ -1182,7 +1182,7 @@ bool CWallet::CreateTransaction(const vector<pair<CScript, int64> >& vecSend, CW\n                 // if sub-cent change is required, the fee must be raised to at least MIN_TX_FEE\n                 // or until nChange becomes zero\n                 // NOTE: this depends on the exact behaviour of GetMinFee\n-                if (nFeeRet < MIN_TX_FEE && nChange > 0 && nChange < CENT)\n+                if (nFeeRet < MIN_TX_FEE && nChange > 0 && nChange < COIN_DUST)\n                 {\n                     int64 nMoveToFee = min(nChange, MIN_TX_FEE - nFeeRet);\n                     nChange -= nMoveToFee;"
      }
    ]
  },
  {
    "sha": "0df65da397f5b1927783f7a8dba2f69e1cfef3ff",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzowZGY2NWRhMzk3ZjViMTkyNzc4M2Y3YThkYmEyZjY5ZTFjZmVmM2Zm",
    "commit": {
      "author": {
        "name": "Peter Todd",
        "email": "pete@petertodd.org",
        "date": "2013-03-08T09:27:21Z"
      },
      "committer": {
        "name": "Peter Todd",
        "email": "pete@petertodd.org",
        "date": "2013-03-10T01:01:53Z"
      },
      "message": "Ignore output values too small to profitably spend\n\nKeeps the UTXO set from being bloated by the creation of outputs that\nwill never be spent because doing so would cost more in fees than they\nare worth.\n\nIncludes changes to the UI to ensure the user can't create such outputs,\nas well as the transaction creation code to round off change if the\nchange txout would itself be unspendable.",
      "tree": {
        "sha": "df22eced867ac703dd678691c2a75d93cbc581ae",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/df22eced867ac703dd678691c2a75d93cbc581ae"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0df65da397f5b1927783f7a8dba2f69e1cfef3ff",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0df65da397f5b1927783f7a8dba2f69e1cfef3ff",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/0df65da397f5b1927783f7a8dba2f69e1cfef3ff",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0df65da397f5b1927783f7a8dba2f69e1cfef3ff/comments",
    "author": {
      "login": "petertodd",
      "id": 7042,
      "node_id": "MDQ6VXNlcjcwNDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7042?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/petertodd",
      "html_url": "https://github.com/petertodd",
      "followers_url": "https://api.github.com/users/petertodd/followers",
      "following_url": "https://api.github.com/users/petertodd/following{/other_user}",
      "gists_url": "https://api.github.com/users/petertodd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/petertodd/subscriptions",
      "organizations_url": "https://api.github.com/users/petertodd/orgs",
      "repos_url": "https://api.github.com/users/petertodd/repos",
      "events_url": "https://api.github.com/users/petertodd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/petertodd/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "petertodd",
      "id": 7042,
      "node_id": "MDQ6VXNlcjcwNDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7042?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/petertodd",
      "html_url": "https://github.com/petertodd",
      "followers_url": "https://api.github.com/users/petertodd/followers",
      "following_url": "https://api.github.com/users/petertodd/following{/other_user}",
      "gists_url": "https://api.github.com/users/petertodd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/petertodd/subscriptions",
      "organizations_url": "https://api.github.com/users/petertodd/orgs",
      "repos_url": "https://api.github.com/users/petertodd/repos",
      "events_url": "https://api.github.com/users/petertodd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/petertodd/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "8f2f760c95efc63b74543d4a1d4d105d37ceced2",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8f2f760c95efc63b74543d4a1d4d105d37ceced2",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/8f2f760c95efc63b74543d4a1d4d105d37ceced2"
      }
    ],
    "stats": {
      "total": 34,
      "additions": 33,
      "deletions": 1
    },
    "files": [
      {
        "sha": "8c33543a042f1c8eab1d6f0fa1ee72d317b2242a",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 21,
        "deletions": 0,
        "changes": 21,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/0df65da397f5b1927783f7a8dba2f69e1cfef3ff/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/0df65da397f5b1927783f7a8dba2f69e1cfef3ff/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=0df65da397f5b1927783f7a8dba2f69e1cfef3ff",
        "patch": "@@ -743,6 +743,27 @@ bool CTxMemPool::accept(CValidationState &state, CTransaction &tx, bool fCheckIn\n                          hash.ToString().c_str(),\n                          nFees, txMinFee);\n \n+        // Don't accept it if it would create an out with a value small enough\n+        // that if spending it would cost more in fees than it is worth. To\n+        // avoid a hard-coded economic assumption, we use the actual\n+        // fees-per-KB the transaction is paying to decide what makes economic\n+        // sense to spend.\n+        int64 nFeesPerKB = nFees / tx.GetSerializeSize(SER_NETWORK, CTransaction::CURRENT_VERSION);\n+\n+        // Sanity limit between MIN_TX_FEE and the COIN_DUST threshold, the\n+        // latter so we don't mess with delibrate sacrifices to mining fees.\n+        nFeesPerKB = min(max(MIN_TX_FEE, nFeesPerKB), COIN_DUST);\n+\n+        for (unsigned int i = 0; i < tx.vout.size(); i++){\n+            // The marginal bytes required to spend a UTXO is always less than\n+            // 1KB, (>500 bytes scriptSigs are non-standard) so using\n+            // nFeesPerKB directly gives some room for a net positive return.\n+            if (tx.vout[i].nValue <= nFeesPerKB)\n+                return error(\"CTxMemPool::accept() : uneconomic txout %s:%d, value %s <= fee %s\",\n+                        hash.ToString().c_str(), i,\n+                        FormatMoney(tx.vout[i].nValue).c_str(), FormatMoney(nFeesPerKB).c_str());\n+        }\n+\n         // Continuously rate-limit free transactions\n         // This mitigates 'penny-flooding' -- sending thousands of free transactions just to\n         // be annoying or make others' transactions take longer to confirm."
      },
      {
        "sha": "5b959ea8bc12de0bf56e2379360101b362e4921b",
        "filename": "src/wallet.cpp",
        "status": "modified",
        "additions": 12,
        "deletions": 1,
        "changes": 13,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/0df65da397f5b1927783f7a8dba2f69e1cfef3ff/src/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/0df65da397f5b1927783f7a8dba2f69e1cfef3ff/src/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet.cpp?ref=0df65da397f5b1927783f7a8dba2f69e1cfef3ff",
        "patch": "@@ -1189,7 +1189,10 @@ bool CWallet::CreateTransaction(const vector<pair<CScript, int64> >& vecSend, CW\n                     nFeeRet += nMoveToFee;\n                 }\n \n-                if (nChange > 0)\n+                // Create change if required, but do not create change that\n+                // results in a output value that isn't economical to spend.\n+                // (see CTxMemPool::accept() logic)\n+                if (nChange > max(MIN_TX_FEE, nTransactionFee))\n                 {\n                     // Note: We use a new key here to keep it from being obvious which side is the change.\n                     //  The drawback is that by not reusing a previous key, the change may be lost if a\n@@ -1316,6 +1319,14 @@ string CWallet::SendMoney(CScript scriptPubKey, int64 nValue, CWalletTx& wtxNew,\n     CReserveKey reservekey(this);\n     int64 nFeeRequired;\n \n+    int64 nTxFee = max(MIN_TX_FEE, nTransactionFee);\n+    if (nValue <= nTxFee){\n+        string strError;\n+        strError = strprintf(_(\"Error: Output value is too small; amount must be greater than the transaction fee, %s\"), FormatMoney(nTxFee).c_str());\n+        printf(\"SendMoney() : %s\", strError.c_str());\n+        return strError;\n+    }\n+\n     if (IsLocked())\n     {\n         string strError = _(\"Error: Wallet locked, unable to create transaction!\");"
      }
    ]
  }
]