[
  {
    "sha": "2ead31fb1b17c9b183a4b81f0ae4f48e5cf67d64",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyZWFkMzFmYjFiMTdjOWIxODNhNGI4MWYwYWU0ZjQ4ZTVjZjY3ZDY0",
    "commit": {
      "author": {
        "name": "Sishir Giri",
        "email": "sishirg27@gmail.com",
        "date": "2020-10-19T01:01:42Z"
      },
      "committer": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2020-11-02T08:38:38Z"
      },
      "message": "[wallet] Return object from upgradewallet RPC",
      "tree": {
        "sha": "24dd306bde6f4d459d67739446e7027d33678189",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/24dd306bde6f4d459d67739446e7027d33678189"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2ead31fb1b17c9b183a4b81f0ae4f48e5cf67d64",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2ead31fb1b17c9b183a4b81f0ae4f48e5cf67d64",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/2ead31fb1b17c9b183a4b81f0ae4f48e5cf67d64",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2ead31fb1b17c9b183a4b81f0ae4f48e5cf67d64/comments",
    "author": {
      "login": "stackman27",
      "id": 26356227,
      "node_id": "MDQ6VXNlcjI2MzU2MjI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/26356227?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stackman27",
      "html_url": "https://github.com/stackman27",
      "followers_url": "https://api.github.com/users/stackman27/followers",
      "following_url": "https://api.github.com/users/stackman27/following{/other_user}",
      "gists_url": "https://api.github.com/users/stackman27/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stackman27/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stackman27/subscriptions",
      "organizations_url": "https://api.github.com/users/stackman27/orgs",
      "repos_url": "https://api.github.com/users/stackman27/repos",
      "events_url": "https://api.github.com/users/stackman27/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stackman27/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "867dbeba5f91be15ca0d4a7303a71957ff9a37ad",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/867dbeba5f91be15ca0d4a7303a71957ff9a37ad",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/867dbeba5f91be15ca0d4a7303a71957ff9a37ad"
      }
    ],
    "stats": {
      "total": 17,
      "additions": 13,
      "deletions": 4
    },
    "files": [
      {
        "sha": "8aaa03e0c9b6c70966915daa740834e71517fc58",
        "filename": "src/wallet/rpcwallet.cpp",
        "status": "modified",
        "additions": 11,
        "deletions": 2,
        "changes": 13,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2ead31fb1b17c9b183a4b81f0ae4f48e5cf67d64/src/wallet/rpcwallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2ead31fb1b17c9b183a4b81f0ae4f48e5cf67d64/src/wallet/rpcwallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcwallet.cpp?ref=2ead31fb1b17c9b183a4b81f0ae4f48e5cf67d64",
        "patch": "@@ -4443,7 +4443,12 @@ static RPCHelpMan upgradewallet()\n         {\n             {\"version\", RPCArg::Type::NUM, /* default */ strprintf(\"%d\", FEATURE_LATEST), \"The version number to upgrade to. Default is the latest wallet version\"}\n         },\n-        RPCResults{},\n+        RPCResult{\n+            RPCResult::Type::OBJ, \"\", \"\",\n+            {\n+                {RPCResult::Type::STR, \"error\", /* optional */ true, \"Error message (if there is one)\"}\n+            },\n+        },\n         RPCExamples{\n             HelpExampleCli(\"upgradewallet\", \"169900\")\n             + HelpExampleRpc(\"upgradewallet\", \"169900\")\n@@ -4468,7 +4473,11 @@ static RPCHelpMan upgradewallet()\n     if (!pwallet->UpgradeWallet(version, error, warnings)) {\n         throw JSONRPCError(RPC_WALLET_ERROR, error.original);\n     }\n-    return error.original;\n+    UniValue obj(UniValue::VOBJ);\n+    if (!error.empty()) {\n+        obj.pushKV(\"error\", error.original);\n+    }\n+    return obj;\n },\n     };\n }"
      },
      {
        "sha": "15d9b109c5a5083067766a2367a352e5d6eaa538",
        "filename": "test/functional/wallet_upgradewallet.py",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2ead31fb1b17c9b183a4b81f0ae4f48e5cf67d64/test/functional/wallet_upgradewallet.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2ead31fb1b17c9b183a4b81f0ae4f48e5cf67d64/test/functional/wallet_upgradewallet.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/wallet_upgradewallet.py?ref=2ead31fb1b17c9b183a4b81f0ae4f48e5cf67d64",
        "patch": "@@ -107,7 +107,7 @@ def run_test(self):\n \n         # calling upgradewallet without version arguments\n         # should return nothing if successful\n-        assert_equal(wallet.upgradewallet(), \"\")\n+        assert_equal(wallet.upgradewallet(), {})\n         new_version = wallet.getwalletinfo()[\"walletversion\"]\n         # upgraded wallet version should be greater than older one\n         assert_greater_than(new_version, old_version)\n@@ -130,7 +130,7 @@ def run_test(self):\n         assert_equal('hdseedid' in wallet.getwalletinfo(), False)\n         # calling upgradewallet with explicit version number\n         # should return nothing if successful\n-        assert_equal(wallet.upgradewallet(169900), \"\")\n+        assert_equal(wallet.upgradewallet(169900), {})\n         new_version = wallet.getwalletinfo()[\"walletversion\"]\n         # upgraded wallet should have version 169900\n         assert_equal(new_version, 169900)"
      }
    ]
  }
]