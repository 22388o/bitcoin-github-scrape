[
  {
    "sha": "8ebbef016928811756e46b9086067d1c826797a8",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4ZWJiZWYwMTY5Mjg4MTE3NTZlNDZiOTA4NjA2N2QxYzgyNjc5N2E4",
    "commit": {
      "author": {
        "name": "Kaz Wesley",
        "email": "kaz@lambdaverse.org",
        "date": "2018-11-15T20:34:46Z"
      },
      "committer": {
        "name": "Kaz Wesley",
        "email": "kaz@lambdaverse.org",
        "date": "2018-11-15T21:47:53Z"
      },
      "message": "add test demonstrating addrLocal UB",
      "tree": {
        "sha": "c5678b2f6d6068c5901483a89e2a8ca63fcdb6cb",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c5678b2f6d6068c5901483a89e2a8ca63fcdb6cb"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8ebbef016928811756e46b9086067d1c826797a8",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8ebbef016928811756e46b9086067d1c826797a8",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/8ebbef016928811756e46b9086067d1c826797a8",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8ebbef016928811756e46b9086067d1c826797a8/comments",
    "author": {
      "login": "kazcw",
      "id": 1047859,
      "node_id": "MDQ6VXNlcjEwNDc4NTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1047859?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kazcw",
      "html_url": "https://github.com/kazcw",
      "followers_url": "https://api.github.com/users/kazcw/followers",
      "following_url": "https://api.github.com/users/kazcw/following{/other_user}",
      "gists_url": "https://api.github.com/users/kazcw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kazcw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kazcw/subscriptions",
      "organizations_url": "https://api.github.com/users/kazcw/orgs",
      "repos_url": "https://api.github.com/users/kazcw/repos",
      "events_url": "https://api.github.com/users/kazcw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kazcw/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "kazcw",
      "id": 1047859,
      "node_id": "MDQ6VXNlcjEwNDc4NTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1047859?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kazcw",
      "html_url": "https://github.com/kazcw",
      "followers_url": "https://api.github.com/users/kazcw/followers",
      "following_url": "https://api.github.com/users/kazcw/following{/other_user}",
      "gists_url": "https://api.github.com/users/kazcw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kazcw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kazcw/subscriptions",
      "organizations_url": "https://api.github.com/users/kazcw/orgs",
      "repos_url": "https://api.github.com/users/kazcw/repos",
      "events_url": "https://api.github.com/users/kazcw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kazcw/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "e74649e95122c9c61aadf607461cf701c3953f88",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e74649e95122c9c61aadf607461cf701c3953f88",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/e74649e95122c9c61aadf607461cf701c3953f88"
      }
    ],
    "stats": {
      "total": 38,
      "additions": 38,
      "deletions": 0
    },
    "files": [
      {
        "sha": "c1ee231d8a236c13d5adfa2ff4e837441b84af71",
        "filename": "src/test/net_tests.cpp",
        "status": "modified",
        "additions": 38,
        "deletions": 0,
        "changes": 38,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/8ebbef016928811756e46b9086067d1c826797a8/src/test/net_tests.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/8ebbef016928811756e46b9086067d1c826797a8/src/test/net_tests.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/net_tests.cpp?ref=8ebbef016928811756e46b9086067d1c826797a8",
        "patch": "@@ -189,4 +189,42 @@ BOOST_AUTO_TEST_CASE(cnode_simple_test)\n     BOOST_CHECK(pnode2->fFeeler == false);\n }\n \n+// prior to PR #14728, this test triggers an undefined behavior\n+BOOST_AUTO_TEST_CASE(ipv4_peer_with_ipv6_addrMe_test)\n+{\n+    // set up local addresses; all that's necessary to reproduce the bug is\n+    // that a normal IPv4 address is among the entries, but if this address is\n+    // !IsRoutable the undefined behavior is easier to trigger deterministically\n+    {\n+        LOCK(cs_mapLocalHost);\n+        in_addr ipv4AddrLocal;\n+        ipv4AddrLocal.s_addr = 0x0100007f;\n+        CNetAddr addr = CNetAddr(ipv4AddrLocal);\n+        LocalServiceInfo lsi;\n+        lsi.nScore = 23;\n+        lsi.nPort = 42;\n+        mapLocalHost[addr] = lsi;\n+    }\n+\n+    // create a peer with an IPv4 address\n+    in_addr ipv4AddrPeer;\n+    ipv4AddrPeer.s_addr = 0xa0b0c001;\n+    CAddress addr = CAddress(CService(ipv4AddrPeer, 7777), NODE_NETWORK);\n+    std::unique_ptr<CNode> pnode = MakeUnique<CNode>(0, NODE_NETWORK, 0, INVALID_SOCKET, addr, 0, 0, CAddress{}, std::string{}, false);\n+    pnode->fSuccessfullyConnected.store(true);\n+\n+    // the peer claims to be reaching us via IPv6\n+    in6_addr ipv6AddrLocal;\n+    memset(ipv6AddrLocal.s6_addr, 0, 16);\n+    ipv6AddrLocal.s6_addr[0] = 0xcc;\n+    CAddress addrLocal = CAddress(CService(ipv6AddrLocal, 7777), NODE_NETWORK);\n+    pnode->SetAddrLocal(addrLocal);\n+\n+    // before patch, this causes undefined behavior detectable with clang's -fsanitize=memory\n+    AdvertiseLocal(&*pnode);\n+\n+    // suppress no-checks-run warning; if this test fails, it's by triggering a sanitizer\n+    BOOST_CHECK(1);\n+}\n+\n BOOST_AUTO_TEST_SUITE_END()"
      }
    ]
  },
  {
    "sha": "b7b36decaf878a8c1dcfdb4a27196c730043474b",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiN2IzNmRlY2FmODc4YThjMWRjZmRiNGEyNzE5NmM3MzAwNDM0NzRi",
    "commit": {
      "author": {
        "name": "Kaz Wesley",
        "email": "kaz@lambdaverse.org",
        "date": "2018-11-14T19:53:27Z"
      },
      "committer": {
        "name": "Kaz Wesley",
        "email": "kaz@lambdaverse.org",
        "date": "2018-11-15T21:47:53Z"
      },
      "message": "fix uninitialized read when stringifying an addrLocal\n\nReachable from either place where SetIP is used when our best-guess\naddrLocal for a peer is IPv4, but the peer tells us it's reaching us at\nan IPv6 address.\n\nIn that case, SetIP turns an IPv4 address into an IPv6 address without\nsetting the scopeId, which is subsequently read in GetSockAddr during\nCNetAddr::ToStringIP and passed to getnameinfo. Fix by ensuring every\nconstructor initializes the scopeId field with something.",
      "tree": {
        "sha": "9550195c8b45644f37f870390c7735a290e8cbf8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9550195c8b45644f37f870390c7735a290e8cbf8"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b7b36decaf878a8c1dcfdb4a27196c730043474b",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b7b36decaf878a8c1dcfdb4a27196c730043474b",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/b7b36decaf878a8c1dcfdb4a27196c730043474b",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b7b36decaf878a8c1dcfdb4a27196c730043474b/comments",
    "author": {
      "login": "kazcw",
      "id": 1047859,
      "node_id": "MDQ6VXNlcjEwNDc4NTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1047859?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kazcw",
      "html_url": "https://github.com/kazcw",
      "followers_url": "https://api.github.com/users/kazcw/followers",
      "following_url": "https://api.github.com/users/kazcw/following{/other_user}",
      "gists_url": "https://api.github.com/users/kazcw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kazcw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kazcw/subscriptions",
      "organizations_url": "https://api.github.com/users/kazcw/orgs",
      "repos_url": "https://api.github.com/users/kazcw/repos",
      "events_url": "https://api.github.com/users/kazcw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kazcw/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "kazcw",
      "id": 1047859,
      "node_id": "MDQ6VXNlcjEwNDc4NTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1047859?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kazcw",
      "html_url": "https://github.com/kazcw",
      "followers_url": "https://api.github.com/users/kazcw/followers",
      "following_url": "https://api.github.com/users/kazcw/following{/other_user}",
      "gists_url": "https://api.github.com/users/kazcw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kazcw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kazcw/subscriptions",
      "organizations_url": "https://api.github.com/users/kazcw/orgs",
      "repos_url": "https://api.github.com/users/kazcw/repos",
      "events_url": "https://api.github.com/users/kazcw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kazcw/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "8ebbef016928811756e46b9086067d1c826797a8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8ebbef016928811756e46b9086067d1c826797a8",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/8ebbef016928811756e46b9086067d1c826797a8"
      }
    ],
    "stats": {
      "total": 3,
      "additions": 1,
      "deletions": 2
    },
    "files": [
      {
        "sha": "10e446392fec27a0469b0fbd063a6daec73a05ab",
        "filename": "src/netaddress.cpp",
        "status": "modified",
        "additions": 0,
        "deletions": 1,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/b7b36decaf878a8c1dcfdb4a27196c730043474b/src/netaddress.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/b7b36decaf878a8c1dcfdb4a27196c730043474b/src/netaddress.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/netaddress.cpp?ref=b7b36decaf878a8c1dcfdb4a27196c730043474b",
        "patch": "@@ -17,7 +17,6 @@ static const unsigned char g_internal_prefix[] = { 0xFD, 0x6B, 0x88, 0xC0, 0x87,\n CNetAddr::CNetAddr()\n {\n     memset(ip, 0, sizeof(ip));\n-    scopeId = 0;\n }\n \n void CNetAddr::SetIP(const CNetAddr& ipIn)"
      },
      {
        "sha": "dc55d8b1a8c0b0a1a8d0745322d980f76fec05a2",
        "filename": "src/netaddress.h",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/b7b36decaf878a8c1dcfdb4a27196c730043474b/src/netaddress.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/b7b36decaf878a8c1dcfdb4a27196c730043474b/src/netaddress.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/netaddress.h?ref=b7b36decaf878a8c1dcfdb4a27196c730043474b",
        "patch": "@@ -33,7 +33,7 @@ class CNetAddr\n {\n     protected:\n         unsigned char ip[16]; // in network byte order\n-        uint32_t scopeId; // for scoped/link-local ipv6 addresses\n+        uint32_t scopeId{0}; // for scoped/link-local ipv6 addresses\n \n     public:\n         CNetAddr();"
      }
    ]
  }
]