jnewbery,2020-11-03 09:22:36,"I originally suggested this as a follow up to #20187: https://github.com/bitcoin/bitcoin/pull/20187#discussion_r511795306\n\ncc @mzumsande @amitiuttarwar @sdaftuar ",https://github.com/bitcoin/bitcoin/pull/20291#issuecomment-720999091,720999091,
DrahtBot,2020-11-03 11:07:05,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20228 (addrman: Make addrman a top-level component by jnewbery)\n\nIf you consider this pull request important, please al",https://github.com/bitcoin/bitcoin/pull/20291#issuecomment-721050210,721050210,
mzumsande,2020-11-03 15:31:00,"Concept ACK.\n\nHow about adding a commit to rename `CAddrMan::Connected` (which is only ever called during disconnection) and correct the documentation, as suggested in https://github.com/bitcoin/bitcoin/pull/20187#discussion_r514646785 and https://github.com/bitcoin/bitcoin/pull/20187#pullrequestreview-521189824 ?",https://github.com/bitcoin/bitcoin/pull/20291#issuecomment-721200717,721200717,
jnewbery,2020-11-04 11:44:29,"> How about adding a commit to rename CAddrMan::Connected (which is only ever called during disconnection) and correct the documentation\n\nI haven't changed the name, but I've updated the documentation, so at least it should be obvious to readers what the function is doing. I think we need to reconsider our whole approach to nTime/nLastSuccess, and potentially remove nTime for addr messages alt",https://github.com/bitcoin/bitcoin/pull/20291#issuecomment-721684434,721684434,
practicalswift,2020-11-04 17:03:21,Concept ACK,https://github.com/bitcoin/bitcoin/pull/20291#issuecomment-721855151,721855151,
jnewbery,2020-11-06 10:29:49,"> one slightly tangential question- when looking for other touch points of nTime, I came across this comment:\n\n> // find an entry, creating it if necessary. \n // nTime and nServices of found node is updated, if necessary. \n CAddrInfo* Create(const CAddress &addr, const CNetAddr &addrSource, int *pnId = NULL); \n\n>but from reading the function definition, I don't understand how. can it r",https://github.com/bitcoin/bitcoin/pull/20291#issuecomment-723005030,723005030,
mzumsande,2020-11-10 22:07:12,Code review ACK 0bfce9dc46234b196a8b3679c21d6f8455962495,https://github.com/bitcoin/bitcoin/pull/20291#issuecomment-724996067,724996067,
amitiuttarwar,2020-11-04 19:26:05,"this comment seems unnecessary- addrman uses this convention of external Function() & internal Function_() in several places.\n\n(but ofc not a big deal if it stays) ",https://github.com/bitcoin/bitcoin/pull/20291#discussion_r517579502,517579502,src/addrman.h
amitiuttarwar,2020-11-05 02:01:33,"might be worth adding a word or two that indicates these are our primary uses of `nTime`, but not the only ones. the comment got me curious so I dove in and looked around, but its not the easiest to sift through a grep for `nTime` ðŸ˜…\n```suggestion\n     *  updates the CAddress's nTime, which is primarily used in our IsTerrible()\n```\n\nincase curious, some other times we read from `nTime` ar",https://github.com/bitcoin/bitcoin/pull/20291#discussion_r517738114,517738114,src/addrman.h
jnewbery,2020-11-06 10:30:47,"I like _all_ functions to have doxygen comments, even if they're short and seem unnecessary. I prefer this to say ""outer function"" than just be a duplicate of the comment for the inner function, which is what it was before.",https://github.com/bitcoin/bitcoin/pull/20291#discussion_r518660894,518660894,src/addrman.h
jnewbery,2020-11-06 10:34:06,"> some other times we read from nTime are when processing an ADDR message & deciding whether to relay\n\nAh. This is using the `nTime` from a received `addr`, so not quite the same as the `nTime` stored in a `CAddress` in addrman.\n\n> for debug printing in ConnectNode\n\nYes, this is true. The nTime is logged here.\n\nI think I'm right in saying that the only _functional_ uses of nTime in",https://github.com/bitcoin/bitcoin/pull/20291#discussion_r518662686,518662686,src/addrman.h
amitiuttarwar,2020-11-06 22:23:41,"> I think I'm right in saying that the only functional uses of nTime in a CAddress in addrman are in IsTerrible() and when relaying the CAddress to a peer in response to a getaddr.\n\nyup, I agree. thats why my suggestion was just to clarify that difference (esp since grep doesn't immediately make this clear). not a big deal though, maybe to consider if you touch up the code for another reason. ",https://github.com/bitcoin/bitcoin/pull/20291#discussion_r519034963,519034963,src/addrman.h
sdaftuar,2020-11-11 18:02:14,"Perhaps it's worth explicitly documenting that we do not call Connected() for FEELER connections?  (This behavior emerges from feelers not having the `fSuccessfullyConnected` bool set, and I think it's desirable to maintain this behavior because otherwise long-lived block-relay-only connections might stick out as the ones which haven't been updated in a while.)",https://github.com/bitcoin/bitcoin/pull/20291#discussion_r521542298,521542298,src/net_processing.cpp
jnewbery,2020-11-12 10:26:14,"Good suggestion. I'm touching this line again in https://github.com/bitcoin/bitcoin/pull/20228, which will need to be rebased once this is merged. Rather than invalidate the ACKs here for a comment update, I'll make the change there.",https://github.com/bitcoin/bitcoin/pull/20291#discussion_r521998219,521998219,src/net_processing.cpp
jnewbery,2020-11-19 17:52:12,Done in #20228.,https://github.com/bitcoin/bitcoin/pull/20291#discussion_r527083966,527083966,src/net_processing.cpp
