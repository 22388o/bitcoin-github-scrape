[
  {
    "sha": "39a9ec579f023ab262a1abd1f0c869be5b1f3f4d",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozOWE5ZWM1NzlmMDIzYWIyNjJhMWFiZDFmMGM4NjliZTViMWYzZjRk",
    "commit": {
      "author": {
        "name": "Troy Giorshev",
        "email": "troygiorshev@gmail.com",
        "date": "2020-11-18T00:50:12Z"
      },
      "committer": {
        "name": "Jarol Rodriguez",
        "email": "jarolrod@tutanota.com",
        "date": "2021-03-23T23:57:17Z"
      },
      "message": "Unconditionally check for fRelay field in test framework\n\nThere is a discrepancy in the implementation of our p2p protocol between\nbitcoind and the testing framework.  The fRelay field is an optional\nfield at the end of a version message as of protocol version 70001.\nHowever, when deserializing a message in bitcoind, we don't check the\nversion to see if it should have an fRelay field or not.  Instead we\nunconditionally attempt to deserialize into the field.\n\nThis commit brings the testing framework in line with the implementation\nin core.\n\nThis matters for a version message with the following fields:\n\nVersion = 60000\nfRelay = 1\n\nBitcoind would deserialize this into a version message with\nVersion=60000 and fRelay=1, whereas (before this commit) our testing\nframework would deserialize this into a version message with\nVersion=60000 and fRelay=0.",
      "tree": {
        "sha": "75b719c278e2c3f3f6a526be14b4659381bb7f89",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/75b719c278e2c3f3f6a526be14b4659381bb7f89"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/39a9ec579f023ab262a1abd1f0c869be5b1f3f4d",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/39a9ec579f023ab262a1abd1f0c869be5b1f3f4d",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/39a9ec579f023ab262a1abd1f0c869be5b1f3f4d",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/39a9ec579f023ab262a1abd1f0c869be5b1f3f4d/comments",
    "author": {
      "login": "troygiorshev",
      "id": 5553787,
      "node_id": "MDQ6VXNlcjU1NTM3ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5553787?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/troygiorshev",
      "html_url": "https://github.com/troygiorshev",
      "followers_url": "https://api.github.com/users/troygiorshev/followers",
      "following_url": "https://api.github.com/users/troygiorshev/following{/other_user}",
      "gists_url": "https://api.github.com/users/troygiorshev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/troygiorshev/subscriptions",
      "organizations_url": "https://api.github.com/users/troygiorshev/orgs",
      "repos_url": "https://api.github.com/users/troygiorshev/repos",
      "events_url": "https://api.github.com/users/troygiorshev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/troygiorshev/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jarolrod",
      "id": 23396902,
      "node_id": "MDQ6VXNlcjIzMzk2OTAy",
      "avatar_url": "https://avatars.githubusercontent.com/u/23396902?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jarolrod",
      "html_url": "https://github.com/jarolrod",
      "followers_url": "https://api.github.com/users/jarolrod/followers",
      "following_url": "https://api.github.com/users/jarolrod/following{/other_user}",
      "gists_url": "https://api.github.com/users/jarolrod/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jarolrod/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jarolrod/subscriptions",
      "organizations_url": "https://api.github.com/users/jarolrod/orgs",
      "repos_url": "https://api.github.com/users/jarolrod/repos",
      "events_url": "https://api.github.com/users/jarolrod/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jarolrod/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "47b99ab1a9e918022ea13f54765f5b4e6aad6140",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/47b99ab1a9e918022ea13f54765f5b4e6aad6140",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/47b99ab1a9e918022ea13f54765f5b4e6aad6140"
      }
    ],
    "stats": {
      "total": 12,
      "additions": 5,
      "deletions": 7
    },
    "files": [
      {
        "sha": "5a9736a7a3e9a4e5b783c0d04b6f3c4d469f424b",
        "filename": "test/functional/test_framework/messages.py",
        "status": "modified",
        "additions": 5,
        "deletions": 7,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/39a9ec579f023ab262a1abd1f0c869be5b1f3f4d/test/functional/test_framework/messages.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/39a9ec579f023ab262a1abd1f0c869be5b1f3f4d/test/functional/test_framework/messages.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/test_framework/messages.py?ref=39a9ec579f023ab262a1abd1f0c869be5b1f3f4d",
        "patch": "@@ -1045,13 +1045,11 @@ def deserialize(self, f):\n \n         self.nStartingHeight = struct.unpack(\"<i\", f.read(4))[0]\n \n-        if self.nVersion >= 70001:\n-            # Relay field is optional for version 70001 onwards\n-            try:\n-                self.relay = struct.unpack(\"<b\", f.read(1))[0]\n-            except:\n-                self.relay = 0\n-        else:\n+        # Relay field is optional for version 70001 onwards\n+        # But, unconditionally check it to match behaviour in bitcoind\n+        try:\n+            self.relay = struct.unpack(\"<b\", f.read(1))[0]\n+        except struct.error:\n             self.relay = 0\n \n     def serialize(self):"
      }
    ]
  }
]