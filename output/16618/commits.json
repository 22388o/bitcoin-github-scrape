[
  {
    "sha": "dc7529abf0197dccb876dc4a93cbdd2ad9f03e5c",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpkYzc1MjlhYmYwMTk3ZGNjYjg3NmRjNGE5M2NiZGQyYWQ5ZjAzZTVj",
    "commit": {
      "author": {
        "name": "nicolas.dorier",
        "email": "nicolas.dorier@gmail.com",
        "date": "2019-08-15T07:34:52Z"
      },
      "committer": {
        "name": "nicolas.dorier",
        "email": "nicolas.dorier@gmail.com",
        "date": "2019-08-15T13:40:32Z"
      },
      "message": "[Fix] Allow connection of a noban banned peer",
      "tree": {
        "sha": "aab9946044dae6258d1e82c6cf8c945679a90951",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/aab9946044dae6258d1e82c6cf8c945679a90951"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/dc7529abf0197dccb876dc4a93cbdd2ad9f03e5c",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEq0z6mJWsoNvif2s0Zhh2PvCRhv4FAl1VYNAACgkQZhh2PvCR\nhv4HwQ/8DN50EeT4gBsjoJDq2CyqorqziEVfQXNkPex3F+iMWoCdQzDu379nYmVo\nc/sHjpJo3EZVjm7E7GNwMe6t6KPWciO2qmtOxbR8hFIC3jPXXgohMDBPWU9MFW2N\n0nDio2niQ8YQXKb0qLvE9Gt2QicbxvkdX6GxOJZ6xQTLAgZowSn+1jWJYnzp5/rn\nnRBQOIgaA9DW5yv/CmTB3VvTR+Q02s26UdNh4HIHbfcYXiXrxGcgbw/JLF92QUg9\nJc/s1e0TstEfz5Sp9un4Zlmq/L0nBsl7Fbbf5fcObsb3Ax9mNpxhLaj++A99cWmF\nGj7MvgIqFOwcM8wfmHIB+7npfVsEEgZDVWPj+ossIWBaMFicb2PAghiBx1+JczjU\nanuHaB/q20LjYgYwWcyifCvHc6Z91LENpBtwyOkAKqfJzIXvdrgW1G0+gaYq1bGZ\nXH+rNEVdlsvaR9grewG/0wNMUM39q9vBVA5lZa1HZsYa9UnvstBHrWN6AOI76M/0\nrPpsJPJBL5OYKtwSZifLDeKuIPAffgUbEzb+j9feP9vT852Vzzk/DJDP413WXVyo\nDOxicorr2C9jdCOMoB6VpgNH+t6a994Mefd4NzDdK2g3YvSF+DwtCHLoXPzran37\nYawIFlIwD9SLbhbL2bCFxBXEcq13z4cyjr4VLHHluAmw0dvyGOk=\n=Pogb\n-----END PGP SIGNATURE-----",
        "payload": "tree aab9946044dae6258d1e82c6cf8c945679a90951\nparent 8fc7f0cba9b1b60ce25d6a8ba51052af1461f825\nauthor nicolas.dorier <nicolas.dorier@gmail.com> 1565854492 +0900\ncommitter nicolas.dorier <nicolas.dorier@gmail.com> 1565876432 +0900\n\n[Fix] Allow connection of a noban banned peer\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/dc7529abf0197dccb876dc4a93cbdd2ad9f03e5c",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/dc7529abf0197dccb876dc4a93cbdd2ad9f03e5c",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/dc7529abf0197dccb876dc4a93cbdd2ad9f03e5c/comments",
    "author": {
      "login": "NicolasDorier",
      "id": 3020646,
      "node_id": "MDQ6VXNlcjMwMjA2NDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3020646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NicolasDorier",
      "html_url": "https://github.com/NicolasDorier",
      "followers_url": "https://api.github.com/users/NicolasDorier/followers",
      "following_url": "https://api.github.com/users/NicolasDorier/following{/other_user}",
      "gists_url": "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NicolasDorier/subscriptions",
      "organizations_url": "https://api.github.com/users/NicolasDorier/orgs",
      "repos_url": "https://api.github.com/users/NicolasDorier/repos",
      "events_url": "https://api.github.com/users/NicolasDorier/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NicolasDorier/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "NicolasDorier",
      "id": 3020646,
      "node_id": "MDQ6VXNlcjMwMjA2NDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3020646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NicolasDorier",
      "html_url": "https://github.com/NicolasDorier",
      "followers_url": "https://api.github.com/users/NicolasDorier/followers",
      "following_url": "https://api.github.com/users/NicolasDorier/following{/other_user}",
      "gists_url": "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NicolasDorier/subscriptions",
      "organizations_url": "https://api.github.com/users/NicolasDorier/orgs",
      "repos_url": "https://api.github.com/users/NicolasDorier/repos",
      "events_url": "https://api.github.com/users/NicolasDorier/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NicolasDorier/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "8fc7f0cba9b1b60ce25d6a8ba51052af1461f825",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8fc7f0cba9b1b60ce25d6a8ba51052af1461f825",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/8fc7f0cba9b1b60ce25d6a8ba51052af1461f825"
      }
    ],
    "stats": {
      "total": 3,
      "additions": 1,
      "deletions": 2
    },
    "files": [
      {
        "sha": "0391edadaa3a0c286dd2440807790bb9963ef6b2",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 2,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/dc7529abf0197dccb876dc4a93cbdd2ad9f03e5c/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/dc7529abf0197dccb876dc4a93cbdd2ad9f03e5c/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=dc7529abf0197dccb876dc4a93cbdd2ad9f03e5c",
        "patch": "@@ -906,7 +906,6 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n     NetPermissionFlags permissionFlags = NetPermissionFlags::PF_NONE;\n     hListenSocket.AddSocketPermissionFlags(permissionFlags);\n     AddWhitelistPermissionFlags(permissionFlags, addr);\n-    const bool noban = NetPermissions::HasFlag(permissionFlags, NetPermissionFlags::PF_NOBAN);\n     bool legacyWhitelisted = false;\n     if (NetPermissions::HasFlag(permissionFlags, NetPermissionFlags::PF_ISIMPLICIT)) {\n         NetPermissions::ClearFlag(permissionFlags, PF_ISIMPLICIT);\n@@ -953,7 +952,7 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n \n     // Don't accept connections from banned peers, but if our inbound slots aren't almost full, accept\n     // if the only banning reason was an automatic misbehavior ban.\n-    if (!noban && bannedlevel > ((nInbound + 1 < nMaxInbound) ? 1 : 0))\n+    if (!NetPermissions::HasFlag(permissionFlags, NetPermissionFlags::PF_NOBAN) && bannedlevel > ((nInbound + 1 < nMaxInbound) ? 1 : 0))\n     {\n         LogPrint(BCLog::NET, \"connection from %s dropped (banned)\\n\", addr.ToString());\n         CloseSocket(hSocket);"
      }
    ]
  },
  {
    "sha": "d117f4541d4717e83c9396273e92960723622030",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpkMTE3ZjQ1NDFkNDcxN2U4M2M5Mzk2MjczZTkyOTYwNzIzNjIyMDMw",
    "commit": {
      "author": {
        "name": "nicolas.dorier",
        "email": "nicolas.dorier@gmail.com",
        "date": "2019-08-15T14:01:32Z"
      },
      "committer": {
        "name": "nicolas.dorier",
        "email": "nicolas.dorier@gmail.com",
        "date": "2019-08-16T04:40:31Z"
      },
      "message": "Add test for setban",
      "tree": {
        "sha": "947cb0f3f18d62c739864240dabf15777f649367",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/947cb0f3f18d62c739864240dabf15777f649367"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d117f4541d4717e83c9396273e92960723622030",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEq0z6mJWsoNvif2s0Zhh2PvCRhv4FAl1WM78ACgkQZhh2PvCR\nhv7yrRAAtPopSAEeIpRDlVpL3eWQvSjcq+u4+uvGyy+lIThP5NOzlVlYS8qBbUZZ\nOXd4ZpNMt3BBwCUPxUVYy/bG0Y+/mTBENlIVkyZVYKN9RvZ7ruYMd4HkcNuAclAb\ni5h/8RR9FWNU9u/LE3yjZ13rlXbr0OkmeMi/3x+XKB69pyLULekQ58K3mbZxe9px\nA1e5b4HKMl8C7hqG8fGYqyxYoygmUnEvR34YywOMbRQnugCdqm4Zm7gHLjqo8/Fc\ny3GlUGEma9zzGm+iVd+bUONUJtf4WcK5gE2AnkJ8ctVe4EHrAImypKNCzsOypZR0\n/k9heF84QPUzs6la7Qssd2LH8OL9FFASaXhwhQ6Mm9K/vULBXvdvz27RGHeWxKWJ\ndLI3n9yX4gHxDSy4pYPRYNkuj0PZDl/qKq1nhXeYQ20UIJyfJ8VTQW8qGEEQLNyU\nD//m/okl2WkvDqytPoCbkLbegYMz/RQ9OSBAUDefObB57XgvS7N3YCOrhKd3y2s7\nGFTylmswvBAxpnIK3IBMoMY1BoYFQGLm7UGLpjiOw/AqtqxlFNe4CXY+wxzIlAsZ\ngvkpaph0fzCgeH2lW84pWPyFp45c5Yj4qsC/ho6KbzAKyHdM4PfFr7a7h6y5H0B9\nbLXNi/9FBc6uEvJvhNY8eY7I3q4i1whusqhuwCR1eNXQyh+jBKE=\n=ByQG\n-----END PGP SIGNATURE-----",
        "payload": "tree 947cb0f3f18d62c739864240dabf15777f649367\nparent dc7529abf0197dccb876dc4a93cbdd2ad9f03e5c\nauthor nicolas.dorier <nicolas.dorier@gmail.com> 1565877692 +0900\ncommitter nicolas.dorier <nicolas.dorier@gmail.com> 1565930431 +0900\n\nAdd test for setban\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d117f4541d4717e83c9396273e92960723622030",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/d117f4541d4717e83c9396273e92960723622030",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d117f4541d4717e83c9396273e92960723622030/comments",
    "author": {
      "login": "NicolasDorier",
      "id": 3020646,
      "node_id": "MDQ6VXNlcjMwMjA2NDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3020646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NicolasDorier",
      "html_url": "https://github.com/NicolasDorier",
      "followers_url": "https://api.github.com/users/NicolasDorier/followers",
      "following_url": "https://api.github.com/users/NicolasDorier/following{/other_user}",
      "gists_url": "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NicolasDorier/subscriptions",
      "organizations_url": "https://api.github.com/users/NicolasDorier/orgs",
      "repos_url": "https://api.github.com/users/NicolasDorier/repos",
      "events_url": "https://api.github.com/users/NicolasDorier/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NicolasDorier/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "NicolasDorier",
      "id": 3020646,
      "node_id": "MDQ6VXNlcjMwMjA2NDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3020646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NicolasDorier",
      "html_url": "https://github.com/NicolasDorier",
      "followers_url": "https://api.github.com/users/NicolasDorier/followers",
      "following_url": "https://api.github.com/users/NicolasDorier/following{/other_user}",
      "gists_url": "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NicolasDorier/subscriptions",
      "organizations_url": "https://api.github.com/users/NicolasDorier/orgs",
      "repos_url": "https://api.github.com/users/NicolasDorier/repos",
      "events_url": "https://api.github.com/users/NicolasDorier/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NicolasDorier/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "dc7529abf0197dccb876dc4a93cbdd2ad9f03e5c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/dc7529abf0197dccb876dc4a93cbdd2ad9f03e5c",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/dc7529abf0197dccb876dc4a93cbdd2ad9f03e5c"
      }
    ],
    "stats": {
      "total": 49,
      "additions": 49,
      "deletions": 0
    },
    "files": [
      {
        "sha": "a1a81965571d122743a958bfb71944958b563add",
        "filename": "test/functional/rpc_setban.py",
        "status": "added",
        "additions": 47,
        "deletions": 0,
        "changes": 47,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d117f4541d4717e83c9396273e92960723622030/test/functional/rpc_setban.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d117f4541d4717e83c9396273e92960723622030/test/functional/rpc_setban.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/rpc_setban.py?ref=d117f4541d4717e83c9396273e92960723622030",
        "patch": "@@ -0,0 +1,47 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2015-2019 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test the setban rpc call.\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    connect_nodes,\n+    p2p_port\n+)\n+\n+class SetBanTests(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+        self.setup_clean_chain = True\n+        self.extra_args = [[],[]]\n+\n+    def run_test(self):\n+        # Node 0 connects to Node 1, check that the noban permission is not granted\n+        connect_nodes(self.nodes[0], 1)\n+        peerinfo = self.nodes[1].getpeerinfo()[0]\n+        assert(not 'noban' in peerinfo['permissions'])\n+\n+        # Node 0 get banned by Node 1\n+        self.nodes[1].setban(\"127.0.0.1\", \"add\")\n+\n+        # Node 0 should not be able to reconnect\n+        with self.nodes[1].assert_debug_log(expected_msgs=['dropped (banned)\\n']):\n+            self.restart_node(1, [])\n+            self.nodes[0].addnode(\"127.0.0.1:\" + str(p2p_port(1)), \"onetry\")\n+\n+        # However, node 0 should be able to reconnect if it has noban permission\n+        self.restart_node(1, ['-whitelist=127.0.0.1'])\n+        connect_nodes(self.nodes[0], 1)\n+        peerinfo = self.nodes[1].getpeerinfo()[0]\n+        assert('noban' in peerinfo['permissions'])\n+\n+        # If we remove the ban, Node 0 should be able to reconnect even without noban permission\n+        self.nodes[1].setban(\"127.0.0.1\", \"remove\")\n+        self.restart_node(1, [])\n+        connect_nodes(self.nodes[0], 1)\n+        peerinfo = self.nodes[1].getpeerinfo()[0]\n+        assert(not 'noban' in peerinfo['permissions'])\n+\n+if __name__ == '__main__':\n+    SetBanTests().main()"
      },
      {
        "sha": "e86602135ea0032ed8886067d97379a0538395ea",
        "filename": "test/functional/test_runner.py",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d117f4541d4717e83c9396273e92960723622030/test/functional/test_runner.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d117f4541d4717e83c9396273e92960723622030/test/functional/test_runner.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/test_runner.py?ref=d117f4541d4717e83c9396273e92960723622030",
        "patch": "@@ -144,6 +144,7 @@\n     'rpc_net.py',\n     'wallet_keypool.py',\n     'p2p_mempool.py',\n+    'rpc_setban.py',\n     'p2p_blocksonly.py',\n     'mining_prioritisetransaction.py',\n     'p2p_invalid_locator.py',"
      },
      {
        "sha": "b08837c1d4bed41ed5fff46d64cf86702e5dc65b",
        "filename": "test/lint/lint-spelling.ignore-words.txt",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d117f4541d4717e83c9396273e92960723622030/test/lint/lint-spelling.ignore-words.txt",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d117f4541d4717e83c9396273e92960723622030/test/lint/lint-spelling.ignore-words.txt",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/lint/lint-spelling.ignore-words.txt?ref=d117f4541d4717e83c9396273e92960723622030",
        "patch": "@@ -12,3 +12,4 @@ cachable\n errorstring\n keyserver\n homogenous\n+setban"
      }
    ]
  }
]