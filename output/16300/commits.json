[
  {
    "sha": "fa69c3e6ca71800376761e264320c363f072dc2f",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYTY5YzNlNmNhNzE4MDAzNzY3NjFlMjY0MzIwYzM2M2YwNzJkYzJm",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2019-06-27T18:11:25Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2019-06-27T18:42:06Z"
      },
      "message": "util: Explain why the path is cached",
      "tree": {
        "sha": "ccd6bdbfb4f351c08928a18ed31875d3ecefa9ce",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ccd6bdbfb4f351c08928a18ed31875d3ecefa9ce"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fa69c3e6ca71800376761e264320c363f072dc2f",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\npUghZQwAvDkBZC5C/U2TFk+mUUZ3mZc45nj6SCMgYM5LvrlO/HSDc+5XoPRCuNIX\nAYKaavdVjR6txkUha/ZyPQHLlRJJAWr0bNJTnHg46w13XAZ9mqqOnEp4TECXv3Gv\nS7RvbF+1K1u066zG4S3gGq/UbdOLKyeR+gR8GkJ/L+krRKf62GSjze2L101D38Vj\nqsKuZ6DxnZGRlvT8rwwVttX2fiGjHSZ4KQgentCzH4t5t0nKq4/cyqBNXOAtXHyG\nH0YKBKc6sJEd79r29c4eXe8sUuN+/fkIvEaOSc7iUKF7nRcqq8MCwnKUcwbbCSs8\ny247GGc6P848vD3LkQsj14LNT5GLQDpXSIztmGVRUwTXL9p1f1GRZwx/Cn7nBOA+\naC0yML5WUlNQXrDZ46uRfConN46CT50h/o6V4lhKXAfU/kDOEsWvbq7R+uOIlQo8\nTS+xOAf4yUoOx6KwRNmuNVBG142YlBPZKycC3u7AsK1BRh+L6rSG9uKiiffnAQuZ\nGsCjG5om\n=Tc4a\n-----END PGP SIGNATURE-----",
        "payload": "tree ccd6bdbfb4f351c08928a18ed31875d3ecefa9ce\nparent 3077f11dadffbc8f2575449fc0177c91a9c3e046\nauthor MarcoFalke <falke.marco@gmail.com> 1561659085 -0400\ncommitter MarcoFalke <falke.marco@gmail.com> 1561660926 -0400\n\nutil: Explain why the path is cached\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa69c3e6ca71800376761e264320c363f072dc2f",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fa69c3e6ca71800376761e264320c363f072dc2f",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa69c3e6ca71800376761e264320c363f072dc2f/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "3077f11dadffbc8f2575449fc0177c91a9c3e046",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3077f11dadffbc8f2575449fc0177c91a9c3e046",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/3077f11dadffbc8f2575449fc0177c91a9c3e046"
      }
    ],
    "stats": {
      "total": 29,
      "additions": 11,
      "deletions": 18
    },
    "files": [
      {
        "sha": "87ff6e62ba8eb3d8f2284e68437fb2fa33b130d3",
        "filename": "src/util/system.cpp",
        "status": "modified",
        "additions": 8,
        "deletions": 14,
        "changes": 22,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa69c3e6ca71800376761e264320c363f072dc2f/src/util/system.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa69c3e6ca71800376761e264320c363f072dc2f/src/util/system.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/util/system.cpp?ref=fa69c3e6ca71800376761e264320c363f072dc2f",
        "patch": "@@ -1,5 +1,5 @@\n // Copyright (c) 2009-2010 Satoshi Nakamoto\n-// Copyright (c) 2009-2018 The Bitcoin Core developers\n+// Copyright (c) 2009-2019 The Bitcoin Core developers\n // Distributed under the MIT software license, see the accompanying\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n@@ -705,19 +705,16 @@ fs::path GetDefaultDataDir()\n static fs::path g_blocks_path_cache_net_specific;\n static fs::path pathCached;\n static fs::path pathCachedNetSpecific;\n-static CCriticalSection csPathCached;\n+static RecursiveMutex csPathCached;\n \n const fs::path &GetBlocksDir()\n {\n-\n     LOCK(csPathCached);\n-\n     fs::path &path = g_blocks_path_cache_net_specific;\n \n-    // This can be called during exceptions by LogPrintf(), so we cache the\n-    // value so we don't have to do memory allocations after that.\n-    if (!path.empty())\n-        return path;\n+    // Cache the path to avoid calling fs::create_directories on every call of\n+    // this function\n+    if (!path.empty()) return path;\n \n     if (gArgs.IsArgSet(\"-blocksdir\")) {\n         path = fs::system_complete(gArgs.GetArg(\"-blocksdir\", \"\"));\n@@ -737,15 +734,12 @@ const fs::path &GetBlocksDir()\n \n const fs::path &GetDataDir(bool fNetSpecific)\n {\n-\n     LOCK(csPathCached);\n-\n     fs::path &path = fNetSpecific ? pathCachedNetSpecific : pathCached;\n \n-    // This can be called during exceptions by LogPrintf(), so we cache the\n-    // value so we don't have to do memory allocations after that.\n-    if (!path.empty())\n-        return path;\n+    // Cache the path to avoid calling fs::create_directories on every call of\n+    // this function\n+    if (!path.empty()) return path;\n \n     if (gArgs.IsArgSet(\"-datadir\")) {\n         path = fs::system_complete(gArgs.GetArg(\"-datadir\", \"\"));"
      },
      {
        "sha": "15d7b1b402d4bd2766b6ab11654d03c484b3eab2",
        "filename": "src/util/system.h",
        "status": "modified",
        "additions": 3,
        "deletions": 4,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa69c3e6ca71800376761e264320c363f072dc2f/src/util/system.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa69c3e6ca71800376761e264320c363f072dc2f/src/util/system.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/util/system.h?ref=fa69c3e6ca71800376761e264320c363f072dc2f",
        "patch": "@@ -1,5 +1,5 @@\n // Copyright (c) 2009-2010 Satoshi Nakamoto\n-// Copyright (c) 2009-2018 The Bitcoin Core developers\n+// Copyright (c) 2009-2019 The Bitcoin Core developers\n // Distributed under the MIT software license, see the accompanying\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n@@ -20,18 +20,16 @@\n #include <fs.h>\n #include <logging.h>\n #include <sync.h>\n-#include <util/threadnames.h>\n #include <tinyformat.h>\n #include <util/memory.h>\n+#include <util/threadnames.h>\n #include <util/time.h>\n \n-#include <atomic>\n #include <exception>\n #include <map>\n #include <set>\n #include <stdint.h>\n #include <string>\n-#include <unordered_set>\n #include <utility>\n #include <vector>\n \n@@ -85,6 +83,7 @@ fs::path GetDefaultDataDir();\n // The blocks directory is always net specific.\n const fs::path &GetBlocksDir();\n const fs::path &GetDataDir(bool fNetSpecific = true);\n+/** Tests only */\n void ClearDatadirCache();\n fs::path GetConfigFile(const std::string& confPath);\n #ifdef WIN32"
      }
    ]
  }
]