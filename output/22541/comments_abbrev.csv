Rspigler,2021-07-27 19:57:52,Concept ACK!,https://github.com/bitcoin/bitcoin/pull/22541#issuecomment-887793693,887793693,
laanwj,2021-07-28 14:45:07,"Concept ACK. I think this is more of an `importwallet` than `restorewallet` in the sense that an external wallet file is being imported into the data directory, which is slightly more general. But no strong opinion on RPC naming (ofc, `importwallet` already exists and does something else,).\n\n> The only way to do this is to replace the wallet.dat of a newly created wallet with the backup file, ",https://github.com/bitcoin/bitcoin/pull/22541#issuecomment-888369974,888369974,
prayank23,2021-07-29 01:24:33,"> As I understand, you can place it in the wallets directory then do loadwallet\n\nThis gives error:\n\n```\n$ bitcoin-cli loadwallet ""B1.dat""\n\nerror code: -4\nerror message:\nBerkeleyDatabase: Can't open database B1.dat (duplicates fileid b6050000000024007aceafe40000000000000000 from wallet.dat)\n```",https://github.com/bitcoin/bitcoin/pull/22541#issuecomment-888728006,888728006,
S3RK,2021-07-29 06:56:47,@prayank23 the error says that you are trying to load *a copy* of already existing wallet. Try the same with the wallet created on another node,https://github.com/bitcoin/bitcoin/pull/22541#issuecomment-888853365,888853365,
prayank23,2021-07-29 12:14:02,"> the error says that you are trying to load a copy of already existing wallet. Try the same with the wallet created on another node\n\nRight. Wallet will be different when users restore from backup. Because if there is already a wallet, there is no need to restore.\n\nOr it can be same in few cases?",https://github.com/bitcoin/bitcoin/pull/22541#issuecomment-889066564,889066564,
lsilva01,2021-07-30 19:32:43,"`test/functional/wallet_backup.py` has been changed to use the `restorewallet` command instead of manually inserting the files.\nThe original test stopped nodes before inserting them. As this is no longer necessary, the backup files are used to restore the wallets on the fourth node without restarting it.",https://github.com/bitcoin/bitcoin/pull/22541#issuecomment-890109678,890109678,
lsilva01,2021-08-10 02:37:12,"https://github.com/bitcoin/bitcoin/pull/22541/commits/5b0a506962fe4388db13062e105201773954e4ee: Adds a helper function to load the wallet which is used by `restorewallet` and `loadwallet`.\n\nhttps://github.com/bitcoin/bitcoin/pull/22541/commits/8f87ef44013caf78e1405ca89f8097cbde1a11b0: Increases  coverage of`restorewallet` test. Adds `restore_nonexistent_wallet` and `restore_wallet_existent_nam",https://github.com/bitcoin/bitcoin/pull/22541#issuecomment-895682829,895682829,
achow101,2021-08-10 20:20:46,ACK 8f87ef44013caf78e1405ca89f8097cbde1a11b0,https://github.com/bitcoin/bitcoin/pull/22541#issuecomment-896291946,896291946,
achow101,2021-08-13 20:38:44,re-ACK 5fe8100ff36fed6d50c2a25b028f57b25af3504c,https://github.com/bitcoin/bitcoin/pull/22541#issuecomment-898708592,898708592,
DrahtBot,2021-08-14 01:36:24,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#19101](https://github.com/bitcoin/bitcoin/pull/19101) (refactor: remove ::vpwallets and related global variables by ryan",https://github.com/bitcoin/bitcoin/pull/22541#issuecomment-898789843,898789843,
prayank23,2021-08-15 10:09:16,"tACK https://github.com/bitcoin/bitcoin/commit/5fe8100ff36fed6d50c2a25b028f57b25af3504c\n\nTested on windows with below commands:\n\n1. Create wallet W1:\n   ```\n   bitcoin-cli createwallet W1\n   ```\n2. Backup wallet:\n   ```\n   bitcoin-cli -rpcwallet=""w1"" backupwallet ""D:\Backups\backup_W1.dat""\n   ```\n3. Delete wallet directory `regtest\wallets\W1`\n4. Restore wallet from backu",https://github.com/bitcoin/bitcoin/pull/22541#issuecomment-899026956,899026956,
meshcollider,2021-08-15 13:53:49,"Great first contribution, thank you! ðŸŽ‰ ",https://github.com/bitcoin/bitcoin/pull/22541#issuecomment-899054167,899054167,
prayank23,2021-07-27 05:50:51,"```suggestion\n```",https://github.com/bitcoin/bitcoin/pull/22541#discussion_r677137717,677137717,src/wallet/rpcwallet.cpp
prayank23,2021-07-27 05:51:13,"```suggestion\n```",https://github.com/bitcoin/bitcoin/pull/22541#discussion_r677137884,677137884,src/wallet/rpcwallet.cpp
prayank23,2021-07-27 05:51:40,"```suggestion\n```",https://github.com/bitcoin/bitcoin/pull/22541#discussion_r677138096,677138096,src/wallet/rpcwallet.cpp
laanwj,2021-07-28 14:49:49,`fs::copy_file`?,https://github.com/bitcoin/bitcoin/pull/22541#discussion_r678377307,678377307,src/wallet/rpcwallet.cpp
achow101,2021-07-29 17:11:16,I would really prefer a shorter command name. I think calling it just `restorewallet` is good enough.,https://github.com/bitcoin/bitcoin/pull/22541#discussion_r679338084,679338084,src/wallet/rpcwallet.cpp
achow101,2021-07-29 18:03:38,"Inexistent is not a word.\n\n```suggestion\n        throw JSONRPCError(RPC_INVALID_PARAMETER, ""Backup file does not exist"");\n```",https://github.com/bitcoin/bitcoin/pull/22541#discussion_r679374353,679374353,src/wallet/rpcwallet.cpp
achow101,2021-07-29 18:15:01,"This `if` block is entirely unnecessary. It is largely copied from `MakeWalletDatabase`. However this is incorrect since `MakeWalletDatabase` is used for both creating new wallets, and opening existing ones. In a restore RPC, we do not want the restored wallet to be copied over an existing one. So allowing existing directories and files are not correct.\n\nThis should only check to see if a some",https://github.com/bitcoin/bitcoin/pull/22541#discussion_r679381753,679381753,src/wallet/rpcwallet.cpp
achow101,2021-07-29 18:18:53,"The wallet will not be restored at an arbitrary path as below we are combining this with `GetWalletDir()`. I don't think we should mention paths at all for the help for `wallet_name`\n\n```suggestion\n            {""wallet_name"", RPCArg::Type::STR, RPCArg::Optional::NO, ""The name that will be applied to the restored wallet""},\n```",https://github.com/bitcoin/bitcoin/pull/22541#discussion_r679384329,679384329,src/wallet/rpcwallet.cpp
lsilva01,2021-07-29 20:49:31,Done.,https://github.com/bitcoin/bitcoin/pull/22541#discussion_r679476700,679476700,src/wallet/rpcwallet.cpp
lsilva01,2021-07-29 20:49:54,Changed to `restorewallet`.,https://github.com/bitcoin/bitcoin/pull/22541#discussion_r679476916,679476916,src/wallet/rpcwallet.cpp
lsilva01,2021-07-29 20:50:07,Fixed.,https://github.com/bitcoin/bitcoin/pull/22541#discussion_r679477013,679477013,src/wallet/rpcwallet.cpp
lsilva01,2021-07-29 20:50:57,`if` block removed.,https://github.com/bitcoin/bitcoin/pull/22541#discussion_r679477520,679477520,src/wallet/rpcwallet.cpp
lsilva01,2021-07-29 20:52:07,Changed to `wallet_name` only.,https://github.com/bitcoin/bitcoin/pull/22541#discussion_r679478182,679478182,src/wallet/rpcwallet.cpp
achow101,2021-07-30 17:57:20,"This will return a bool, we should throw an error if it is `false`.",https://github.com/bitcoin/bitcoin/pull/22541#discussion_r680126836,680126836,src/wallet/rpcwallet.cpp
lsilva01,2021-07-30 18:13:35,"According to the [documentation](https://www.boost.org/doc/libs/1_58_0/libs/filesystem/doc/reference.html#copy_file), the return type is void, but throws an error if it cannot copy.\nSo try/catch can be used instead.\n\n```suggestion\n    try\n    {\n        fs::copy_file(backup_file, wallet_file, fs::copy_option::fail_if_exists);\n    } catch (const boost::filesystem::filesystem_error& e)",https://github.com/bitcoin/bitcoin/pull/22541#discussion_r680135441,680135441,src/wallet/rpcwallet.cpp
achow101,2021-07-30 18:29:32,"Oh, we still use boost..\n\nIt's fine to not try/catch as the RPC server will catch those itself.",https://github.com/bitcoin/bitcoin/pull/22541#discussion_r680143817,680143817,src/wallet/rpcwallet.cpp
achow101,2021-08-09 19:25:32,"In commit e7c86cdb6b0f1b50816b9aec7a9ce1bfeedd32f5 ""Add a new RPC command: restorewallet""\n\nnit: whitespace, `}` should line up with the rest.",https://github.com/bitcoin/bitcoin/pull/22541#discussion_r685461205,685461205,src/wallet/rpcwallet.cpp
achow101,2021-08-09 19:27:05,"In commit e7c86cdb6b0f1b50816b9aec7a9ce1bfeedd32f5 ""Add a new RPC command: restorewallet""\n\nSince all of this code is basically just copied from the `loadwallet` RPC, I think it would be better to refactor it into a helper function that both `restorewallet` and `loadwallet` can call.",https://github.com/bitcoin/bitcoin/pull/22541#discussion_r685462052,685462052,src/wallet/rpcwallet.cpp
lsilva01,2021-08-10 02:37:18,Great suggestion. Done.,https://github.com/bitcoin/bitcoin/pull/22541#discussion_r685647564,685647564,src/wallet/rpcwallet.cpp
lsilva01,2021-08-10 02:37:29,Done.,https://github.com/bitcoin/bitcoin/pull/22541#discussion_r685647616,685647616,src/wallet/rpcwallet.cpp
achow101,2021-08-10 20:21:42,"In 5b0a506962fe4388db13062e105201773954e4ee ""Add a new RPC command: restorewallet""\n\nnit: I would prefer for this to not be named the same as the `LoadWallet` function in wallet.cpp",https://github.com/bitcoin/bitcoin/pull/22541#discussion_r686294691,686294691,src/wallet/rpcwallet.cpp
lsilva01,2021-08-11 02:31:55,Done. Changed the name to `LoadWalletHelper`.,https://github.com/bitcoin/bitcoin/pull/22541#discussion_r686446830,686446830,src/wallet/rpcwallet.cpp
