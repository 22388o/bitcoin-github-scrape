fanquake,2020-01-30 00:39:54,cc @naumenkogs ,https://github.com/bitcoin/bitcoin/pull/18023#issuecomment-580030892,580030892,
DrahtBot,2020-01-30 02:25:09,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#17812](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/17812.html) (config, test: asmap functional tests and fe",https://github.com/bitcoin/bitcoin/pull/18023#issuecomment-580055048,580055048,
sanjaykdragon,2020-01-30 15:15:21,"utack - looks nice, preventing unnecessary copies",https://github.com/bitcoin/bitcoin/pull/18023#issuecomment-580301035,580301035,
practicalswift,2020-01-30 23:21:14,"Concept ACK\n\nWhile improving asmap -- please consider increasing the robustness of `GetMappedAS(â€¦)` by plugging this issue too: [""GetMappedAS(...) lookup on an IPv6 address against a maliciously constructed AS-map triggers heap buffer-overflow""](https://github.com/bitcoin/bitcoin/issues/18033) :)",https://github.com/bitcoin/bitcoin/pull/18023#issuecomment-580508193,580508193,
sipa,2020-01-31 00:54:47,Added a commit to resolve #18033.,https://github.com/bitcoin/bitcoin/pull/18023#issuecomment-580531800,580531800,
jonatack,2020-01-31 11:16:31,"Concept ACK, will review shortly.",https://github.com/bitcoin/bitcoin/pull/18023#issuecomment-580693614,580693614,
naumenkogs,2020-01-31 14:31:34,"utACK 868647e5d72f2718e41b723dc7e15594ffb1d7b6\nThank you!",https://github.com/bitcoin/bitcoin/pull/18023#issuecomment-580756636,580756636,
sipa,2020-01-31 22:53:26,"@practicalswift Nice catch, addressed I think.",https://github.com/bitcoin/bitcoin/pull/18023#issuecomment-580946286,580946286,
practicalswift,2020-02-01 08:26:06,"@sipa I'm no longer able to trigger the two heap buffer overflows, and the code withstood an eight hour `asmap` fuzzer (#18033) run (48 million executions): I think the code is robust against malicious map data now :)\n\nACK c86bc144081f960347232546f7d22deb65d27deb -- patch looks correct",https://github.com/bitcoin/bitcoin/pull/18023#issuecomment-581007633,581007633,
jonatack,2020-02-02 06:12:16,"On my side, this PR held up on 72M execs (about 18 hours) of the asmap fuzzer.\n```\n#72474660	REDUCE cov: 1198 ft: 3529 corp: 197/12792b exec/s: 1063 rss: 452Mb L: 41/1527 MS: 4 InsertByte-EraseBytes-InsertByte-PersAutoDict- DE: ""\x00 \x00\x00\x00\x00\x00\x00""-\n```",https://github.com/bitcoin/bitcoin/pull/18023#issuecomment-581102982,581102982,
naumenkogs,2020-02-05 10:33:52,utACK c86bc14,https://github.com/bitcoin/bitcoin/pull/18023#issuecomment-582343945,582343945,
laanwj,2020-02-05 12:59:31,ACK c86bc144081f960347232546f7d22deb65d27deb,https://github.com/bitcoin/bitcoin/pull/18023#issuecomment-582395696,582395696,
practicalswift,2020-01-29 23:23:53,This comment should be on L83 and vice versa? :),https://github.com/bitcoin/bitcoin/pull/18023#discussion_r372686129,372686129,src/netaddress.h
sipa,2020-01-30 05:02:30,Fixed.,https://github.com/bitcoin/bitcoin/pull/18023#discussion_r372760521,372760521,src/netaddress.h
practicalswift,2020-01-31 15:50:17,A heap buffer overflow will occur here in case of `bits == 0`?,https://github.com/bitcoin/bitcoin/pull/18023#discussion_r373548461,373548461,src/util/asmap.cpp
practicalswift,2020-01-31 16:27:10,"```suggestion\n             if (bits == 0) {\n                 return default_asn;\n             }\n             if (ip[ip.size() - bits]) {\n```",https://github.com/bitcoin/bitcoin/pull/18023#discussion_r373567477,373567477,src/util/asmap.cpp
practicalswift,2020-01-31 16:27:54,"```suggestion\n                 if (bits == 0 || (ip[ip.size() - bits]) != ((match >> (matchlen - 1 - bit)) & 1)) {\n```",https://github.com/bitcoin/bitcoin/pull/18023#discussion_r373567865,373567865,src/util/asmap.cpp
sipa,2020-01-31 22:53:07,"No, reaching the end of the ip array just means a malformed asmap. It's probably better to return 0 (also the other location).",https://github.com/bitcoin/bitcoin/pull/18023#discussion_r373720439,373720439,src/util/asmap.cpp
sipa,2020-01-31 22:53:35,"Yup, fixed.",https://github.com/bitcoin/bitcoin/pull/18023#discussion_r373720581,373720581,src/util/asmap.cpp
jonatack,2020-02-01 09:22:47,This line could be extracted to a `bool CNetAddr::IsHeNet() const` function,https://github.com/bitcoin/bitcoin/pull/18023#discussion_r373768683,373768683,src/netaddress.cpp
