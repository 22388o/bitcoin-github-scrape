[
  {
    "sha": "18c4beb05b494f30b16a17b834c23ec8774749b2",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxOGM0YmViMDViNDk0ZjMwYjE2YTE3YjgzNGMyM2VjODc3NDc0OWIy",
    "commit": {
      "author": {
        "name": "Matt Corallo",
        "email": "matt@bluematt.me",
        "date": "2012-06-28T13:52:45Z"
      },
      "committer": {
        "name": "Matt Corallo",
        "email": "matt@bluematt.me",
        "date": "2012-06-28T13:52:45Z"
      },
      "message": "Revert \"*Always* send a shutdown signal to enable custom shutdown actions\"\n\nThis reverts commit 896899e0d66e25f6549a92749d237c8a87b12f08.",
      "tree": {
        "sha": "cc405a7fc106dd50b0034a4bde09504fc6379876",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/cc405a7fc106dd50b0034a4bde09504fc6379876"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/18c4beb05b494f30b16a17b834c23ec8774749b2",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/18c4beb05b494f30b16a17b834c23ec8774749b2",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/18c4beb05b494f30b16a17b834c23ec8774749b2",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/18c4beb05b494f30b16a17b834c23ec8774749b2/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "e75acc006e8bc5c44d1d6e6c3b027fe28d8c743b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e75acc006e8bc5c44d1d6e6c3b027fe28d8c743b",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/e75acc006e8bc5c44d1d6e6c3b027fe28d8c743b"
      }
    ],
    "stats": {
      "total": 14,
      "additions": 7,
      "deletions": 7
    },
    "files": [
      {
        "sha": "1874493391830a9672e369754db378ef5a7aca51",
        "filename": "src/bitcoinrpc.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/18c4beb05b494f30b16a17b834c23ec8774749b2/src/bitcoinrpc.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/18c4beb05b494f30b16a17b834c23ec8774749b2/src/bitcoinrpc.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bitcoinrpc.cpp?ref=18c4beb05b494f30b16a17b834c23ec8774749b2",
        "patch": "@@ -2905,7 +2905,8 @@ void ThreadRPCServer2(void* parg)\n     }\n \n     vnThreadsRunning[THREAD_RPCLISTENER]--;\n-    io_service.run();\n+    while (!fShutdown)\n+        io_service.run_one();\n     vnThreadsRunning[THREAD_RPCLISTENER]++;\n }\n "
      },
      {
        "sha": "b25d52200fbc118f25dde8f1bfd292fff2335a2f",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 6,
        "changes": 11,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/18c4beb05b494f30b16a17b834c23ec8774749b2/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/18c4beb05b494f30b16a17b834c23ec8774749b2/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=18c4beb05b494f30b16a17b834c23ec8774749b2",
        "patch": "@@ -9,7 +9,6 @@\n #include \"init.h\"\n #include \"util.h\"\n #include \"ui_interface.h\"\n-#include <boost/bind.hpp>\n #include <boost/filesystem.hpp>\n #include <boost/filesystem/fstream.hpp>\n #include <boost/filesystem/convenience.hpp>\n@@ -41,8 +40,13 @@ void ExitTimeout(void* parg)\n \n void StartShutdown()\n {\n+#ifdef QT_GUI\n     // ensure we leave the Qt main loop for a clean GUI exit (Shutdown() is called in bitcoin.cpp afterwards)\n     uiInterface.QueueShutdown();\n+#else\n+    // Without UI, Shutdown() can simply be started in a new thread\n+    CreateThread(Shutdown, NULL);\n+#endif\n }\n \n void Shutdown(void* parg)\n@@ -150,11 +154,6 @@ bool AppInit(int argc, char* argv[])\n             exit(ret);\n         }\n \n-        // Create the shutdown thread when receiving a shutdown signal\n-        boost::signals2::scoped_connection do_stop(\n-                uiInterface.QueueShutdown.connect(boost::bind(\n-                    &CreateThread, &Shutdown, static_cast<void*>(0), false)));\n-\n         fRet = AppInit2();\n     }\n     catch (std::exception& e) {"
      }
    ]
  },
  {
    "sha": "7cf3d2ccb960a1c8e81622d46b38cf253893d9af",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo3Y2YzZDJjY2I5NjBhMWM4ZTgxNjIyZDQ2YjM4Y2YyNTM4OTNkOWFm",
    "commit": {
      "author": {
        "name": "Matt Corallo",
        "email": "matt@bluematt.me",
        "date": "2012-06-28T16:32:32Z"
      },
      "committer": {
        "name": "Matt Corallo",
        "email": "matt@bluematt.me",
        "date": "2012-06-28T16:32:32Z"
      },
      "message": "Use a rpc-specific queue to tell asio connections to shutdown.",
      "tree": {
        "sha": "bd1d0fd80924ea58c59f88154e41b974a6962124",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/bd1d0fd80924ea58c59f88154e41b974a6962124"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7cf3d2ccb960a1c8e81622d46b38cf253893d9af",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7cf3d2ccb960a1c8e81622d46b38cf253893d9af",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/7cf3d2ccb960a1c8e81622d46b38cf253893d9af",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7cf3d2ccb960a1c8e81622d46b38cf253893d9af/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "18c4beb05b494f30b16a17b834c23ec8774749b2",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/18c4beb05b494f30b16a17b834c23ec8774749b2",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/18c4beb05b494f30b16a17b834c23ec8774749b2"
      }
    ],
    "stats": {
      "total": 7,
      "additions": 5,
      "deletions": 2
    },
    "files": [
      {
        "sha": "82bab36dc8cf28d80a9b11ffd13fdd16d12adfe5",
        "filename": "src/bitcoinrpc.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 2,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7cf3d2ccb960a1c8e81622d46b38cf253893d9af/src/bitcoinrpc.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7cf3d2ccb960a1c8e81622d46b38cf253893d9af/src/bitcoinrpc.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bitcoinrpc.cpp?ref=7cf3d2ccb960a1c8e81622d46b38cf253893d9af",
        "patch": "@@ -2858,6 +2858,8 @@ void ThreadRPCServer2(void* parg)\n     asio::ip::address bindAddress = loopback ? asio::ip::address_v6::loopback() : asio::ip::address_v6::any();\n     ip::tcp::endpoint endpoint(bindAddress, GetArg(\"-rpcport\", 8332));\n \n+    boost::signals2::signal<void ()> StopRequests;\n+\n     try\n     {\n         boost::shared_ptr<ip::tcp::acceptor> acceptor(new ip::tcp::acceptor(io_service));\n@@ -2873,7 +2875,7 @@ void ThreadRPCServer2(void* parg)\n \n         RPCListen(acceptor, context, fUseSSL);\n         // Cancel outstanding listen-requests for this acceptor when shutting down\n-        uiInterface.QueueShutdown.connect(signals2::slot<void ()>(\n+        StopRequests.connect(signals2::slot<void ()>(\n                     static_cast<void (ip::tcp::acceptor::*)()>(&ip::tcp::acceptor::close), acceptor.get())\n                 .track(acceptor));\n \n@@ -2891,7 +2893,7 @@ void ThreadRPCServer2(void* parg)\n \n             RPCListen(acceptor, context, fUseSSL);\n             // Cancel outstanding listen-requests for this acceptor when shutting down\n-            uiInterface.QueueShutdown.connect(signals2::slot<void ()>(\n+            StopRequests.connect(signals2::slot<void ()>(\n                         static_cast<void (ip::tcp::acceptor::*)()>(&ip::tcp::acceptor::close), acceptor.get())\n                     .track(acceptor));\n         }\n@@ -2908,6 +2910,7 @@ void ThreadRPCServer2(void* parg)\n     while (!fShutdown)\n         io_service.run_one();\n     vnThreadsRunning[THREAD_RPCLISTENER]++;\n+    StopRequests();\n }\n \n void ThreadRPCServer3(void* parg)"
      }
    ]
  },
  {
    "sha": "4e97a9d9eb91f87e0611c31f28e2e02a07cea8aa",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0ZTk3YTlkOWViOTFmODdlMDYxMWMzMWYyOGUyZTAyYTA3Y2VhOGFh",
    "commit": {
      "author": {
        "name": "Matt Corallo",
        "email": "matt@bluematt.me",
        "date": "2012-06-28T16:34:11Z"
      },
      "committer": {
        "name": "Matt Corallo",
        "email": "matt@bluematt.me",
        "date": "2012-06-28T16:34:11Z"
      },
      "message": "Lock vnThreadsRunning[THREAD_RPCHANDLER].",
      "tree": {
        "sha": "b0c5b0eae5fe90d24ed1108a6e3fa510f8b9c34e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b0c5b0eae5fe90d24ed1108a6e3fa510f8b9c34e"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4e97a9d9eb91f87e0611c31f28e2e02a07cea8aa",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4e97a9d9eb91f87e0611c31f28e2e02a07cea8aa",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/4e97a9d9eb91f87e0611c31f28e2e02a07cea8aa",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4e97a9d9eb91f87e0611c31f28e2e02a07cea8aa/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "7cf3d2ccb960a1c8e81622d46b38cf253893d9af",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7cf3d2ccb960a1c8e81622d46b38cf253893d9af",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/7cf3d2ccb960a1c8e81622d46b38cf253893d9af"
      }
    ],
    "stats": {
      "total": 17,
      "additions": 14,
      "deletions": 3
    },
    "files": [
      {
        "sha": "48c5a738b5548333f8a6c65ed1311ff723eee14f",
        "filename": "src/bitcoinrpc.cpp",
        "status": "modified",
        "additions": 14,
        "deletions": 3,
        "changes": 17,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4e97a9d9eb91f87e0611c31f28e2e02a07cea8aa/src/bitcoinrpc.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4e97a9d9eb91f87e0611c31f28e2e02a07cea8aa/src/bitcoinrpc.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bitcoinrpc.cpp?ref=4e97a9d9eb91f87e0611c31f28e2e02a07cea8aa",
        "patch": "@@ -2913,10 +2913,15 @@ void ThreadRPCServer2(void* parg)\n     StopRequests();\n }\n \n+static CCriticalSection cs_THREAD_RPCHANDLER;\n+\n void ThreadRPCServer3(void* parg)\n {\n     IMPLEMENT_RANDOMIZE_STACK(ThreadRPCServer3(parg));\n-    vnThreadsRunning[THREAD_RPCHANDLER]++;\n+    {\n+        LOCK(cs_THREAD_RPCHANDLER);\n+        vnThreadsRunning[THREAD_RPCHANDLER]++;\n+    }\n     AcceptedConnection *conn = (AcceptedConnection *) parg;\n \n     bool fRun = true;\n@@ -2925,7 +2930,10 @@ void ThreadRPCServer3(void* parg)\n         {\n             conn->close();\n             delete conn;\n-            --vnThreadsRunning[THREAD_RPCHANDLER];\n+            {\n+                LOCK(cs_THREAD_RPCHANDLER);\n+                --vnThreadsRunning[THREAD_RPCHANDLER];\n+            }\n             return;\n         }\n         map<string, string> mapHeaders;\n@@ -3005,7 +3013,10 @@ void ThreadRPCServer3(void* parg)\n     }\n \n     delete conn;\n-    vnThreadsRunning[THREAD_RPCHANDLER]--;\n+    {\n+        LOCK(cs_THREAD_RPCHANDLER);\n+        vnThreadsRunning[THREAD_RPCHANDLER]--;\n+    }\n }\n \n json_spirit::Value CRPCTable::execute(const std::string &strMethod, const json_spirit::Array &params) const"
      }
    ]
  },
  {
    "sha": "460d87861368feb1ee0cfe6a080748b24f7cfcb9",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0NjBkODc4NjEzNjhmZWIxZWUwY2ZlNmEwODA3NDhiMjRmN2NmY2I5",
    "commit": {
      "author": {
        "name": "Matt Corallo",
        "email": "matt@bluematt.me",
        "date": "2012-06-28T17:31:22Z"
      },
      "committer": {
        "name": "Matt Corallo",
        "email": "matt@bluematt.me",
        "date": "2012-06-28T17:31:22Z"
      },
      "message": "Fix build error.",
      "tree": {
        "sha": "83dd40b14a4b2da6eb207b21a6723810fce5ba82",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/83dd40b14a4b2da6eb207b21a6723810fce5ba82"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/460d87861368feb1ee0cfe6a080748b24f7cfcb9",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/460d87861368feb1ee0cfe6a080748b24f7cfcb9",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/460d87861368feb1ee0cfe6a080748b24f7cfcb9",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/460d87861368feb1ee0cfe6a080748b24f7cfcb9/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "4e97a9d9eb91f87e0611c31f28e2e02a07cea8aa",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4e97a9d9eb91f87e0611c31f28e2e02a07cea8aa",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/4e97a9d9eb91f87e0611c31f28e2e02a07cea8aa"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 1,
      "deletions": 1
    },
    "files": [
      {
        "sha": "de6db5398280ea0b6bda3168e6883ee1917fe40c",
        "filename": "src/bitcoinrpc.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/460d87861368feb1ee0cfe6a080748b24f7cfcb9/src/bitcoinrpc.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/460d87861368feb1ee0cfe6a080748b24f7cfcb9/src/bitcoinrpc.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bitcoinrpc.cpp?ref=460d87861368feb1ee0cfe6a080748b24f7cfcb9",
        "patch": "@@ -2768,7 +2768,7 @@ static void RPCAcceptHandler(boost::shared_ptr< basic_socket_acceptor<Protocol,\n     vnThreadsRunning[THREAD_RPCLISTENER]++;\n \n     // Immediately start accepting new connections, except when we're canceled or our socket is closed.\n-    if (error != error::operation_aborted\n+    if (error != asio::error::operation_aborted\n      && acceptor->is_open())\n         RPCListen(acceptor, context, fUseSSL);\n "
      }
    ]
  }
]