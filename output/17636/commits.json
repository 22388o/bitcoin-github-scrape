[
  {
    "sha": "187f9684e03e994b0c6ab5e45ad71e0ab6e4d8b1",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxODdmOTY4NGUwM2U5OTRiMGM2YWI1ZTQ1YWQ3MWUwYWI2ZTRkOGIx",
    "commit": {
      "author": {
        "name": "Emil Engler",
        "email": "me@emilengler.com",
        "date": "2020-03-20T09:56:29Z"
      },
      "committer": {
        "name": "Emil Engler",
        "email": "me@emilengler.com",
        "date": "2020-04-06T12:17:00Z"
      },
      "message": "qt: Add -guisettingsdir option",
      "tree": {
        "sha": "724218f3060bd17a8d06395785b35f58d3019540",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/724218f3060bd17a8d06395785b35f58d3019540"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/187f9684e03e994b0c6ab5e45ad71e0ab6e4d8b1",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE82XmVEpcmrEyk0LUL21BRcVfx8cFAl6LHcMACgkQL21BRcVf\nx8cYdRAAyiDLkDglHzsyQP0rRDkM9l0eYT66pwu2gtLA04hvK0jBxIXLfA1bB+wz\nCrpYGJ3I7G0WREg6dNoltwDQAmeUzAjxPVyIZHpoSb0ismEW9ZbL1nTLb2TenFOK\nYchLutrVpXgps2Nlcv4TgJeGpkMR+U8Nng6tYO8aI/eKQSRYIx+ewBg/CVYWbc8f\nxyqgRneZJOlONxO6m6eMSA7x0CX6s+PxC8unnl/hOGINX0bKnqd67IIeHGzr1Ea+\nJXrXeWH2QvH/dKkA14IKrumQp4hyTGtW/UHF1oLoEro9gb/iwcX1pL7LWkhZLiHT\nCZZ8CGrfj/SOAWnlaSqFVzkC5W67crv+ay+x1pMxfUO6stwWdujoMgDL8KqouN54\ntLKhpx19OMV6XLibgSVDEFtTrrhXwmlJAAjg8NjAxvmDENE4+ksks3z/3Ulxbu/J\nnr1zSgJODalBFwO6jb1XOhh0oR8jXOAmpdxRYf7ATOyQh2VcYEjTDyrER384jYOD\nbKASumsAGbO40FQqvWkgFnsy/ZXtMKD+pOfOQvomeQnT3kbOpYB+sSoE0YdVO/pA\nSJ+TSqrh78QWfUWwXhDJqfn7p+qpPDfH3fkJVU6F6vFpyVsIf2hzb0nd4+vor1vP\ni/zrip6u1fSzaIWor13knWYo87pOmgkBxzUJ/7VOwz7Z1nBerCA=\n=fFV7\n-----END PGP SIGNATURE-----",
        "payload": "tree 724218f3060bd17a8d06395785b35f58d3019540\nparent 5bf45fe2a9642f8ae8f8a12bcbf8f8b4770421ad\nauthor Emil Engler <me@emilengler.com> 1584698189 +0100\ncommitter Emil Engler <me@emilengler.com> 1586175420 +0200\n\nqt: Add -guisettingsdir option\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/187f9684e03e994b0c6ab5e45ad71e0ab6e4d8b1",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/187f9684e03e994b0c6ab5e45ad71e0ab6e4d8b1",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/187f9684e03e994b0c6ab5e45ad71e0ab6e4d8b1/comments",
    "author": {
      "login": "emilengler",
      "id": 12272949,
      "node_id": "MDQ6VXNlcjEyMjcyOTQ5",
      "avatar_url": "https://avatars.githubusercontent.com/u/12272949?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emilengler",
      "html_url": "https://github.com/emilengler",
      "followers_url": "https://api.github.com/users/emilengler/followers",
      "following_url": "https://api.github.com/users/emilengler/following{/other_user}",
      "gists_url": "https://api.github.com/users/emilengler/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emilengler/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emilengler/subscriptions",
      "organizations_url": "https://api.github.com/users/emilengler/orgs",
      "repos_url": "https://api.github.com/users/emilengler/repos",
      "events_url": "https://api.github.com/users/emilengler/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emilengler/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "emilengler",
      "id": 12272949,
      "node_id": "MDQ6VXNlcjEyMjcyOTQ5",
      "avatar_url": "https://avatars.githubusercontent.com/u/12272949?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emilengler",
      "html_url": "https://github.com/emilengler",
      "followers_url": "https://api.github.com/users/emilengler/followers",
      "following_url": "https://api.github.com/users/emilengler/following{/other_user}",
      "gists_url": "https://api.github.com/users/emilengler/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emilengler/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emilengler/subscriptions",
      "organizations_url": "https://api.github.com/users/emilengler/orgs",
      "repos_url": "https://api.github.com/users/emilengler/repos",
      "events_url": "https://api.github.com/users/emilengler/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emilengler/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "5bf45fe2a9642f8ae8f8a12bcbf8f8b4770421ad",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5bf45fe2a9642f8ae8f8a12bcbf8f8b4770421ad",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/5bf45fe2a9642f8ae8f8a12bcbf8f8b4770421ad"
      }
    ],
    "stats": {
      "total": 23,
      "additions": 23,
      "deletions": 0
    },
    "files": [
      {
        "sha": "8abbb564a5b6cb2df6a7282e8e42b21f653c6e65",
        "filename": "doc/files.md",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/187f9684e03e994b0c6ab5e45ad71e0ab6e4d8b1/doc/files.md",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/187f9684e03e994b0c6ab5e45ad71e0ab6e4d8b1/doc/files.md",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/doc/files.md?ref=187f9684e03e994b0c6ab5e45ad71e0ab6e4d8b1",
        "patch": "@@ -85,6 +85,7 @@ Subdirectory | File(s)           | Description\n ## GUI settings\n \n `bitcoin-qt` uses [`QSettings`](https://doc.qt.io/qt-5/qsettings.html) class; this implies platform-specific [locations where application settings are stored](https://doc.qt.io/qt-5/qsettings.html#locations-where-application-settings-are-stored).\n+You can change this with the `-guisettingsdir=<path>` option. It will use the cross-platform ini format then. `<path>` is where the `.ini` file is stored.\n \n ## Legacy subdirectories and files\n "
      },
      {
        "sha": "7f4bb5171a4960c9a36364fc89eb4544e0230447",
        "filename": "src/qt/bitcoin.cpp",
        "status": "modified",
        "additions": 22,
        "deletions": 0,
        "changes": 22,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/187f9684e03e994b0c6ab5e45ad71e0ab6e4d8b1/src/qt/bitcoin.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/187f9684e03e994b0c6ab5e45ad71e0ab6e4d8b1/src/qt/bitcoin.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/bitcoin.cpp?ref=187f9684e03e994b0c6ab5e45ad71e0ab6e4d8b1",
        "patch": "@@ -43,6 +43,7 @@\n #include <QLocale>\n #include <QMessageBox>\n #include <QSettings>\n+#include <QString>\n #include <QThread>\n #include <QTimer>\n #include <QTranslator>\n@@ -396,6 +397,7 @@ WId BitcoinApplication::getMainWinId() const\n static void SetupUIArgs()\n {\n     gArgs.AddArg(\"-choosedatadir\", strprintf(\"Choose data directory on startup (default: %u)\", DEFAULT_CHOOSE_DATADIR), ArgsManager::ALLOW_ANY, OptionsCategory::GUI);\n+    gArgs.AddArg(\"-guisettingsdir=<path>\", \"Choose a custom data directory especially for the Qt Settings\", ArgsManager::ALLOW_ANY, OptionsCategory::GUI);\n     gArgs.AddArg(\"-lang=<lang>\", \"Set language, for example \\\"de_DE\\\" (default: system locale)\", ArgsManager::ALLOW_ANY, OptionsCategory::GUI);\n     gArgs.AddArg(\"-min\", \"Start minimized\", ArgsManager::ALLOW_ANY, OptionsCategory::GUI);\n     gArgs.AddArg(\"-resetguisettings\", \"Reset all settings changed in the GUI\", ArgsManager::ALLOW_ANY, OptionsCategory::GUI);\n@@ -469,6 +471,11 @@ int GuiMain(int argc, char* argv[])\n     QApplication::setOrganizationName(QAPP_ORG_NAME);\n     QApplication::setOrganizationDomain(QAPP_ORG_DOMAIN);\n     QApplication::setApplicationName(QAPP_APP_NAME_DEFAULT);\n+    const std::string qt_settings_path = gArgs.GetArg(\"-guisettingsdir\", \"\");\n+    if (!qt_settings_path.empty()) {\n+        QSettings::setDefaultFormat(QSettings::IniFormat);\n+        QSettings::setPath(QSettings::IniFormat, QSettings::UserScope, QString::fromStdString(qt_settings_path));\n+    }\n \n     /// 4. Initialization of translations, so that intro dialog is in user's language\n     // Now that QSettings are accessible, initialize translations\n@@ -489,6 +496,21 @@ int GuiMain(int argc, char* argv[])\n     bool prune = false; // Intro dialog prune check box\n     // Gracefully exit if the user cancels\n     if (!Intro::showIfNeeded(*node, did_show_intro, prune)) return EXIT_SUCCESS;\n+    // Now check if the custom config files are accecible\n+    // If you run Bitcoin Qt the first time (no datadir) it will simply create the config files at that location\n+    if(!qt_settings_path.empty()) {\n+        QSettings settings;\n+        std::string settingspath = settings.fileName().toUtf8().constData();\n+        // TODO: After C++17 move, port this to std::filesystem\n+        std::fstream f;\n+        f.open(settingspath.c_str());\n+        // File could not be opened\n+        if (f.fail()) {\n+            QMessageBox::critical(nullptr, PACKAGE_NAME,\n+                QObject::tr(\"Error: Cannot open config file at \\\"%1\\\"\").arg(QString::fromStdString(qt_settings_path)));\n+            return EXIT_FAILURE;\n+        }\n+    }\n \n     /// 6. Determine availability of data directory and parse bitcoin.conf\n     /// - Do not call GetDataDir(true) before this step finishes"
      }
    ]
  }
]