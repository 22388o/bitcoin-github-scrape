jonasschnelli,2019-12-01 20:54:26,I prefer #15936 in the long run. Maybe this makes sense as an intermediary step... but unsure (could also be a maintenance burden since this needs to go away with #15936 very likely). Pinging @ryanofsky.,https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-560157814,560157814,
emilengler,2019-12-01 21:19:36,@jonasschnelli #15936 is something different. `-guisettings` is also intended to be the Qt relevant equivalent of bitcoind's `-conf`,https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-560160467,560160467,
ryanofsky,2019-12-01 22:38:39,"Concept ACK. This seems at least marginally useful and I don't see drawbacks. It could use better documentation and error checking though. Documentation: should specified path be a file or directory path, or are both accepted? Error checking: it'd be nice to trigger InitErrors if specified location can't be opened or isn't writeable. It'd also be nice to trigger an init error if `guisettings=path`",https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-560168631,560168631,
emilengler,2019-12-02 16:17:41,">  I understand the OP motivation, not sure if the new argument is the best. Specifying a directory gives the impression that multiple files could be stored there.\n\nThat's a design choice. Other files should be stored there like `Bitcoin-Qt-regtest.conf` (forgot the actual filename, but I mean the other chain configs).",https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-560466531,560466531,
emilengler,2019-12-02 16:37:51,"> It'd also be nice to trigger an init error if guisettings=path is specified in the bitcoin.conf file since right now it looks like that is silently ignored.\n\nIs it even possible to add GUI related stuff to the `bitcoin.conf`?\nAlso the `-guisettings` parsing needs to be done as one of the first operations. As the translation system is going to access `QSettings` for the language string.\n",https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-560475580,560475580,
ryanofsky,2019-12-02 17:08:15,"> > It'd also be nice to trigger an init error if guisettings=path is specified in the bitcoin.conf file since right now it looks like that is silently ignored.\n> \n> Is it even possible to add GUI related stuff to the `bitcoin.conf`?\n\nNo, but that isn't obvious. I'm suggesting it should trigger an init error unless that's difficult, because most command line arguments do work in the config",https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-560488210,560488210,
emilengler,2019-12-02 18:45:32,"@ryanofsky Indeed the file extensions are different but the files are the same so it doesn't matter:\n```\n$ sha256sum testdir/Bitcoin/Bitcoin-Qt.ini\nd00cb5f6ef6183e9752e56bbd13a95b31f39d7ba5a82933449d8bdf2576060f4  testdir/Bitcoin/Bitcoin-Qt.ini\n $ sha256sum .config/Bitcoin/Bitcoin-Qt.conf\nd00cb5f6ef6183e9752e56bbd13a95b31f39d7ba5a82933449d8bdf2576060f4  .config/Bitcoin/Bitcoin-Qt.conf\n",https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-560527367,560527367,
ryanofsky,2019-12-02 19:31:22,"> @ryanofsky Indeed the file extensions are different but the files are the same so it doesn't matter:\n\nQuestion is how values are read, not really how they are written. e.g. is `@bytearray(...)` read as an actual byte array or as the string `""@bytearray(...)""`",https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-560545750,560545750,
laanwj,2019-12-03 09:02:26,"Concept ~0 on this. If there are actual users that have use for this, I'm okay with it (it doesn't add that much complexity), but, it's use is pretty constrained and this is heavily initialization-order dependent, and yet another thing to test when testing setting reading.\n ",https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-561067831,561067831,
laanwj,2019-12-03 09:02:47,This definitely needs a test of some kind.,https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-561067975,561067975,
emilengler,2019-12-04 18:06:15,@laanwj Maybe I overlooked it but I haven't found any Qt tests which test CLI args. Is it really that worth to implement a complete new system just for that?,https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-561769374,561769374,
Talkless,2019-12-06 18:31:45,"Concept ACK. Looks useful. \n\nBuilt & tested a bit - changing values to switch between two .ini files does change language, window position, listening, etc.",https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-562686977,562686977,
emilengler,2019-12-23 22:01:04,"Push, as I changed the title and added the dir suffix",https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-568591641,568591641,
DrahtBot,2019-12-24 01:49:13,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19461 (multiprocess: Add bitcoin-gui -ipcconnect option by ryanofsky)\n\nIf you consider this pull request important, ple",https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-568624046,568624046,
Talkless,2020-01-05 12:17:59,I guess there's two questions left - should it really need test (https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-561067975) and what about error handling in case path is invalid and settings file cannot be created?,https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-570906608,570906608,
emilengler,2020-01-05 15:48:14,"> what about error handling in case path is invalid and settings file cannot be created?\n\nI explained this in the showcase.\nIf the config file can't be created for whatever reason, it won't save anything. However the user should notice this somehow at least when he restarts bitcoin-qt the next time.",https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-570923506,570923506,
Talkless,2020-02-04 19:33:58,"> notice this somehow\n\nI doubt this is good enough. Consider this setup:\n```\n$ fgrep bPrune ~/.config/Bitcoin/Bitcoin-Qt-testnet.conf \nbPrune=false\n``` \n```\n$ fgrep bPrune /tmp/myconfig/Bitcoin/Bitcoin-Qt-testnet.ini \nbPrune=true\n```\nNow imagine `myconfig` dir ""disappears"", like, forgot to plug-in USB drive, network drive not mounted, or whatever. Bitoinc-Qt will silently sta",https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-582077682,582077682,
emilengler,2020-02-04 19:59:23,"> Now imagine myconfig dir ""disappears"", like, forgot to plug-in USB drive, network drive not mounted, or whatever. Bitoinc-Qt will silently start downloading full chain due to old config, possibly filling users drive...\n\nNo, bitcoin-qt doesn't necessarily know where the datadir is and the intro screen opens again. Also I wouldn't call this a direct issue of this PR...",https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-582088350,582088350,
Talkless,2020-02-05 19:06:08,"> datadir\n\nThis PR is not about data dir (`~/.bitcoin`), but Qt settings dir (`~/.config/Bitcoin`). If you remove data dir - yes, wizard is show. But not when `-guisettingsdir` is missing. Try this:\n```\nmkdir /tmp/myconfig\nbicoin-qt -testnet -guisettingsdir=/tmp/mysettings\n# ... enable pruning in `Settings -> Options` window ..\n# ... quit bitcoin-qt ...\nmv /tmp/mysettings /tmp/myse",https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-582562017,582562017,
emilengler,2020-02-05 20:03:19,I was talking about the Qt settings. The data dir path is set in the Qt settings. Sorry if you understood it wrong,https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-582586804,582586804,
jonasschnelli,2020-02-06 07:55:40,utACK 5266efa964b1f29b2c334e7a942a664d335c8e18,https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-582780677,582780677,
Talkless,2020-02-06 17:35:53,"> The data dir path is set in the Qt settings\n\nIt doesn't matter, you can remove `strDataDir=/home/vincas/.bitcoin` line from it and it will still use this path as default.\n\nAnyways, I am not talking theoretically, I ACTAULLY tested your code and reproduced issue when invalid `-guisettingsdir` path makes _pruning_ disabled (it's by default disabled, empty `QSettings` results in default), w",https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-583020921,583020921,
emilengler,2020-02-06 17:39:09,"> Anyways, I am not talking theoretically, I ACTAULLY tested your code and reproduced issue when invalid -guisettingsdir path makes pruning disabled (it's by default disabled, empty QSettings results in default), which is unexpected by user, and results your blockchain copy a full, unpruned archive, using up space.\n\nI bet that 99.99% percent of users will notice it if the blockchain gets re-do",https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-583022329,583022329,
Talkless,2020-02-10 18:46:08,"> I bet that 99.99% percent of users will notice\n\nbitcoin-qt shows me that overlay every day I launch it, as it has to keep up after being offline for the night. I just instinctively close window to minimize it without bothering much...\n\nAnyway, this is only one of possible surprises user can get once `-guisettingsdir` is set to invalid path.",https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-584289769,584289769,
Talkless,2020-02-10 18:48:04,"Tested, Approach NACK, due to insufficient error handling which is inconsistent when compared to `-blocksdir`/`-datadir`/`-walletdir` command line options, and IMHO authors arguments keeping that way are not strong enough.",https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-584290578,584290578,
ryanofsky,2020-03-05 19:46:01,"From IRC\n\n> would be good to get ryanofsky's ack\n\nIMO adding this with no error checking is adding a slightly useful feature that's a big footgun in practice. I don't want to block this change if other people want it, but would just again recommend error checking: https://github.com/bitcoin/bitcoin/pull/17636#discussion_r358953622 so there aren't silent failures and silently discarded sett",https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-595412989,595412989,
emilengler,2020-03-20 09:57:17,"Rebased on 5bf45fe2a9642f8ae8f8a12bcbf8f8b4770421ad,\nwill now work ryanofskys suggestion",https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-601617004,601617004,
emilengler,2020-03-20 10:23:37,"The client now checks if the custom config file is accessible. If not, it returns an error. If it is not accessible but it is the first time you run bitcoin-qt (datadir does not exists), it will create the config at that location. If this fails it also returns an error.",https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-601627088,601627088,
emilengler,2020-04-06 12:15:06,"Thanks for your review @luke-jr \n> I don't see code for this...?\n\nThis is covered by the Qt library itself",https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-609757386,609757386,
luke-jr,2020-04-06 12:40:23,">This is covered by the Qt library itself\n\nQt doesn't know if `-datadir` exists or not...",https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-609769521,609769521,
jonasschnelli,2020-05-29 08:09:33,"Is it intentional that changing the guisettingsdir to an empty folder, once you have a datadir setup (say after IBD), will not work?",https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-635833348,635833348,
jonasschnelli,2020-05-29 08:12:32,"Tested a bit and does not work as expected:\n\nTried on an existing node/datadir (where I previously created a folder `/tmp/gui`):\n\n    ./src/qt/bitcoin-qt --regtest --guisettingsdir=/tmp/gui\n\nLeads to:\n<img width=""520"" alt=""Bildschirmfoto 2020-05-29 um 10 10 37"" src=""https://user-images.githubusercontent.com/178464/83237039-d50f4180-a194-11ea-8a14-a87448e52ab6.png"">\n\nSame for crea",https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-635836904,635836904,
emilengler,2020-05-29 08:27:35,"@jonasschnelli Ok, I will have a look at this somewhere this weekend",https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-635844652,635844652,
fanquake,2020-07-15 07:10:53," Progress here seems to have stalled, and this doesn't yet seem to work as intended. There have also been multiple requests for tests, and none have been added. I'm going to close this and suggest re-opening your changes in the [gui repo](https://github.com/bitcoin-core/gui) if you are still interested in working on them, as aside from `files.md` this is contained to qt code.",https://github.com/bitcoin/bitcoin/pull/17636#issuecomment-658589229,658589229,
hebasto,2019-11-30 06:07:50,nit: Could you apply [clang-format-diff.py](https://github.com/bitcoin/bitcoin/tree/master/contrib/devtools#clang-format-diffpy) to your commit?,https://github.com/bitcoin/bitcoin/pull/17636#discussion_r352268952,352268952,src/qt/bitcoin.cpp
hebasto,2019-11-30 06:09:30,typo: s/direcotry/directory/,https://github.com/bitcoin/bitcoin/pull/17636#discussion_r352269007,352269007,src/qt/bitcoin.cpp
hebasto,2019-11-30 06:22:35,"Is `gArgs.IsArgSet(""-guisettings"")` needed here?",https://github.com/bitcoin/bitcoin/pull/17636#discussion_r352269347,352269347,src/qt/bitcoin.cpp
paymog,2019-11-30 09:03:16,Is it possible to test this logic in UTs?,https://github.com/bitcoin/bitcoin/pull/17636#discussion_r352274674,352274674,src/qt/bitcoin.cpp
emilengler,2019-11-30 13:52:44,"You're right, forgot that",https://github.com/bitcoin/bitcoin/pull/17636#discussion_r352286526,352286526,src/qt/bitcoin.cpp
emilengler,2019-11-30 14:12:23,"Good question. I'm not an expert with the test framework but we could run `bitcoin-qt --guisettings=/a/custom/path/` and see if `/a/custom/path/Bitcoin/Bitcoin-Qt.conf` exists.\nThe problem with the Qt tests is that they test the actual GUI like clicking buttons. This belongs more to a startup test, don't know if this exists",https://github.com/bitcoin/bitcoin/pull/17636#discussion_r352287254,352287254,src/qt/bitcoin.cpp
hebasto,2019-11-30 14:23:13,"[`QSettings::IniFormat`](https://doc.qt.io/qt-5/qsettings.html#Format-enum):\n> ... Note that type information is not preserved when reading settings from INI files; all values will be returned as `QString`.\n\nCould this cause any issue?",https://github.com/bitcoin/bitcoin/pull/17636#discussion_r352287681,352287681,src/qt/bitcoin.cpp
emilengler,2019-11-30 14:29:40,Good question. On UNIX it is always in IniFormat. On macOS and Windows it is in the registry (even if that's not the term on macOS). What would be the point in selecting a custom path to the registry? I don't know if this is even possible.,https://github.com/bitcoin/bitcoin/pull/17636#discussion_r352287931,352287931,src/qt/bitcoin.cpp
emilengler,2019-11-30 23:39:20,I think this as resolved as it is not possible (at least not by ease) to store registry stuff outside of the registry. `IniFormat` is the only cross platform settings format supported by Qt and it is only used with if the parameter is set.,https://github.com/bitcoin/bitcoin/pull/17636#discussion_r352310307,352310307,src/qt/bitcoin.cpp
promag,2019-12-01 21:39:43,Could mention that `<path>` is a directory where the `.ini` file is stored.,https://github.com/bitcoin/bitcoin/pull/17636#discussion_r352374936,352374936,doc/files.md
promag,2019-12-01 21:44:03,"This should have some check, could be an invalid or read only path and then it wouldn't work as expected.",https://github.com/bitcoin/bitcoin/pull/17636#discussion_r352375263,352375263,src/qt/bitcoin.cpp
emilengler,2019-12-02 16:17:57,ACK,https://github.com/bitcoin/bitcoin/pull/17636#discussion_r352688912,352688912,doc/files.md
emilengler,2019-12-02 16:19:32,"Sure that is that important? If the path does not exists it will create the directory recursively, if the user has no permission it will fallback to the default. Don't know if it is that much required to check for writing privileges.",https://github.com/bitcoin/bitcoin/pull/17636#discussion_r352689706,352689706,src/qt/bitcoin.cpp
laanwj,2019-12-03 09:00:57,"Note that due to initialization order constraints, this option can only be provided on the command line.\nIt won't work in the configuration file because at that time, QSettings was already parsed.\n",https://github.com/bitcoin/bitcoin/pull/17636#discussion_r353052258,353052258,src/qt/bitcoin.cpp
emilengler,2019-12-04 17:58:11,"I think you are wrong.\nTake a look at `src/qt/bitcoin.cpp` line 451.\nThere you'll see that `SetupUIArgs()` is executed before the PR feature.",https://github.com/bitcoin/bitcoin/pull/17636#discussion_r353895459,353895459,src/qt/bitcoin.cpp
ryanofsky,2019-12-04 18:45:26,"re: https://github.com/bitcoin/bitcoin/pull/17636#discussion_r353895459\n\nI concluded the same as Wladimir based on the fact that [`readConfigFiles`](https://github.com/emilengler/bitcoin/blob/feed664436f7dd7228285e94de5c9af086e4ccb7/src/qt/bitcoin.cpp#L504) is called after [`GetArg(""-guisettings""`)](https://github.com/emilengler/bitcoin/blob/feed664436f7dd7228285e94de5c9af086e4ccb7/src/qt/bitc",https://github.com/bitcoin/bitcoin/pull/17636#discussion_r353917830,353917830,src/qt/bitcoin.cpp
Talkless,2019-12-06 18:45:44,"nit: is it really necessary to call `GetArg` twice? We could take `const std::string gui_settings = ...` and use it twice. Pity we can't use C++17 if statement with initializer though...\n\nnit2: it's better to use `! ... .empty()` , often suggested by static analyzers. Less code bloat, no need to actually compare against `const char*`...",https://github.com/bitcoin/bitcoin/pull/17636#discussion_r354977277,354977277,src/qt/bitcoin.cpp
Talkless,2019-12-06 18:47:47,"I would suggest to call it -guisettings**dir**, to be consistent with other *dir's options we have. Currently, it makes me fee as I am expected to write full path to the `.ini` file itself, though this is not the case, it's the parent(-parent) directory..",https://github.com/bitcoin/bitcoin/pull/17636#discussion_r354978104,354978104,src/qt/bitcoin.cpp
emilengler,2019-12-07 00:46:47,"> nit2: it's better to use ! ... .empty() , often suggested by static analyzers. Less code bloat, no need to actually compare against const char*...\n\nWill add that\n\n> nit: is it really necessary to call GetArg twice? We could take const std::string gui_settings = ... and use it twice. Pity we can't use C++17 if statement with initializer though...\n\nWill add that as well thanks",https://github.com/bitcoin/bitcoin/pull/17636#discussion_r355084661,355084661,src/qt/bitcoin.cpp
emilengler,2019-12-07 00:47:25,I think path value suggestion says that it is a path to a dir. Otherwise it would be `<file>`,https://github.com/bitcoin/bitcoin/pull/17636#discussion_r355084732,355084732,src/qt/bitcoin.cpp
Talkless,2019-12-07 09:14:58,"""path"" can mean file path or directory path.\n> A path, the general form of the name of a file or directory...\n\nhttps://en.wikipedia.org/wiki/Path_(computing)\n\n\nThis is not hard argument but simply I dont't see the reason to make this option stand out from others. We have bunch of `*dir` options, not sure why this should not have same suffix.",https://github.com/bitcoin/bitcoin/pull/17636#discussion_r355110781,355110781,src/qt/bitcoin.cpp
Talkless,2019-12-08 14:48:26,@ryanofsky @laanwj what's your view about `-guisettings` vs `-guisettingsdir` (more consistent) ?,https://github.com/bitcoin/bitcoin/pull/17636#discussion_r355191461,355191461,src/qt/bitcoin.cpp
ryanofsky,2019-12-16 19:45:21,"> @ryanofsky @laanwj what's your view about `-guisettings` vs `-guisettingsdir` (more consistent) ?\n\nIf it actually is required to be a filename not a directory name then dir suffix could be better, but from the qt documentation, I got the impression that it would accept either an ini file path or a directory path. I keep asking for more documentation in every comment I make on this PR. I just",https://github.com/bitcoin/bitcoin/pull/17636#discussion_r358429400,358429400,src/qt/bitcoin.cpp
Talkless,2019-12-17 18:15:23,"@ryanofsky: \n\n- if I pass `-guisettings=/tmp/mysettings`, it creates `/tmp/mysettings/Bitcoin/Bitcoin-Qt-regtest.ini` file.\n- if I pass `-guisettings=/tmp/mysettings.ini` (file nor directory does not exist), it creates `/tmp/mysettings.ini/Bitcoin/Bitcoin-Qt-regtest.ini`\n- if I pass `-guisettings=/tmp/mysettings.ini` after  `touch /tmp/mysettings.ini`, no directories are created, but neith",https://github.com/bitcoin/bitcoin/pull/17636#discussion_r358949819,358949819,src/qt/bitcoin.cpp
ryanofsky,2019-12-17 18:23:21,"Thanks for testing! If that's the case, I think it'd be good to add the dir suffix, document that the path is supposed to be a directory, and also adding error checking for the silent failure case. Error checking could probably be done by calling [QSettings::sync()](https://doc.qt.io/qt-5/qsettings.html#sync) and checking [QSettings::status()](https://doc.qt.io/qt-5/qsettings.html#status) returns ",https://github.com/bitcoin/bitcoin/pull/17636#discussion_r358953622,358953622,src/qt/bitcoin.cpp
emilengler,2019-12-18 14:24:12,"Ok, will switch to `-guisettingsdir`",https://github.com/bitcoin/bitcoin/pull/17636#discussion_r359370210,359370210,src/qt/bitcoin.cpp
Talkless,2020-04-01 09:39:57,"Any reason not to use `QFile`? In that case would be more ""straightforward"" - no need to convert `QString` to `std::string`.",https://github.com/bitcoin/bitcoin/pull/17636#discussion_r401485178,401485178,src/qt/bitcoin.cpp
Talkless,2020-04-01 09:42:05,IMHO that message could be more concrete - that `config file` is a bit goo vague. Maybe mentioning `GUI settings file` would be more informative (since it's for **-guisettings**dir).,https://github.com/bitcoin/bitcoin/pull/17636#discussion_r401486451,401486451,src/qt/bitcoin.cpp
luke-jr,2020-04-06 11:45:33,"nit: Space after `if`, put `{` on same line",https://github.com/bitcoin/bitcoin/pull/17636#discussion_r404027676,404027676,src/qt/bitcoin.cpp
luke-jr,2020-04-06 12:54:04,(still missing the space),https://github.com/bitcoin/bitcoin/pull/17636#discussion_r404066784,404066784,src/qt/bitcoin.cpp
