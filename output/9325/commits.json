[
  {
    "sha": "5a1f545d27d4c766d47aba5ec0f1cd84b28a6d4a",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1YTFmNTQ1ZDI3ZDRjNzY2ZDQ3YWJhNWVjMGYxY2Q4NGIyOGE2ZDRh",
    "commit": {
      "author": {
        "name": "R E Broadley",
        "email": "rebroad+github@gmail.com",
        "date": "2016-11-01T12:30:31Z"
      },
      "committer": {
        "name": "R E Broadley",
        "email": "rebroad+github@gmail.com",
        "date": "2016-12-27T05:42:56Z"
      },
      "message": "Allow blocktxns from a different peer than the requested from",
      "tree": {
        "sha": "292c94e65145192719210dd012319d5b0ea47583",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/292c94e65145192719210dd012319d5b0ea47583"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5a1f545d27d4c766d47aba5ec0f1cd84b28a6d4a",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "expired_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQIcBAABAgAGBQJYYf9kAAoJEJYWlWnKgEH57IEQAKZqdCVp97IIoiLLw9KBtiBK\nRfFnOZsn4EO5V1S1izaR0kY54yfIgk0Mq+zEVr+1+El96AP4SO9mNlAzPDTW3J5X\nAj4sEL07GzH8UvlAxt3OZWxaWaFkzlje592+tPTvntmxZjL4ouZ2YXtEQ7Ic4qdx\nMHzyOPWv6d6AQA8gkfrsVWI4GVolNdlPAgu6MbNbTFucpdMZzO2ogGcp6YGAbqdF\nl425ILqb2PxXyXMEh04p3ITrjlC8bKlPmhhIQrETZaSuVLw4Ha+tSo2Oun1AZrnX\nDdWJhyxAhh2G35e+QMnKDg2T6a14tlZTfJaiq4FoTz8Ti0ZBsXBmZQ3VEFwDmYIV\nolMDMaV7ynnD79C3UVFMPKgXdL8kckh2RZZW2uxbGzvjQo9+0Nl11OH4FzQsqy4F\niBWss5NO11WtzxH+GLMKQxr1pxHgtI9dh2R8FIQasdg2m8XyaNCPBweZ4BYtSXaP\naS4i0rLYVcHQ4ziPH3igZTrUoakb9iAQBELCkB7PccLBsZt9Yxg47KzIQBDSXZZz\nZc0Dcjq5RClCJJriZ+TB19Jzc1qj1y161Kw82lzRpBovyesep8bUUfdK8Zn1SdpQ\nNgSq3yqgaBpxduB0kdja/oZVovgD5MTWXbL9AMzDpBK2yt4g06tT/W26ZZSzOuWf\n1diZDz7AdedGRu7TX5JG\n=ilZJ\n-----END PGP SIGNATURE-----",
        "payload": "tree 292c94e65145192719210dd012319d5b0ea47583\nparent 0f921e6a0492c4e9f037a9ed91f474885032d68c\nauthor R E Broadley <rebroad+github@gmail.com> 1478003431 +0800\ncommitter R E Broadley <rebroad+github@gmail.com> 1482817376 +0700\n\nAllow blocktxns from a different peer than the requested from\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5a1f545d27d4c766d47aba5ec0f1cd84b28a6d4a",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/5a1f545d27d4c766d47aba5ec0f1cd84b28a6d4a",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5a1f545d27d4c766d47aba5ec0f1cd84b28a6d4a/comments",
    "author": {
      "login": "rebroad",
      "id": 1530283,
      "node_id": "MDQ6VXNlcjE1MzAyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rebroad",
      "html_url": "https://github.com/rebroad",
      "followers_url": "https://api.github.com/users/rebroad/followers",
      "following_url": "https://api.github.com/users/rebroad/following{/other_user}",
      "gists_url": "https://api.github.com/users/rebroad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
      "organizations_url": "https://api.github.com/users/rebroad/orgs",
      "repos_url": "https://api.github.com/users/rebroad/repos",
      "events_url": "https://api.github.com/users/rebroad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rebroad/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "rebroad",
      "id": 1530283,
      "node_id": "MDQ6VXNlcjE1MzAyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rebroad",
      "html_url": "https://github.com/rebroad",
      "followers_url": "https://api.github.com/users/rebroad/followers",
      "following_url": "https://api.github.com/users/rebroad/following{/other_user}",
      "gists_url": "https://api.github.com/users/rebroad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
      "organizations_url": "https://api.github.com/users/rebroad/orgs",
      "repos_url": "https://api.github.com/users/rebroad/repos",
      "events_url": "https://api.github.com/users/rebroad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rebroad/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "0f921e6a0492c4e9f037a9ed91f474885032d68c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0f921e6a0492c4e9f037a9ed91f474885032d68c",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/0f921e6a0492c4e9f037a9ed91f474885032d68c"
      }
    ],
    "stats": {
      "total": 9,
      "additions": 5,
      "deletions": 4
    },
    "files": [
      {
        "sha": "95e7eccb5bdf2fff2ccb57b7b2edaec31f9bac50",
        "filename": "src/net_processing.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 4,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5a1f545d27d4c766d47aba5ec0f1cd84b28a6d4a/src/net_processing.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5a1f545d27d4c766d47aba5ec0f1cd84b28a6d4a/src/net_processing.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net_processing.cpp?ref=5a1f545d27d4c766d47aba5ec0f1cd84b28a6d4a",
        "patch": "@@ -1947,8 +1947,7 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n             LOCK(cs_main);\n \n             map<uint256, pair<NodeId, list<QueuedBlock>::iterator> >::iterator it = mapBlocksInFlight.find(resp.blockhash);\n-            if (it == mapBlocksInFlight.end() || !it->second.second->partialBlock ||\n-                    it->second.first != pfrom->GetId()) {\n+            if (it == mapBlocksInFlight.end() || !it->second.second->partialBlock) {\n                 LogPrint(\"net\", \"Peer %d sent us block transactions for block we weren't expecting\\n\", pfrom->id);\n                 return true;\n             }\n@@ -1957,8 +1956,10 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n             ReadStatus status = partialBlock.FillBlock(*pblock, resp.txn);\n             if (status == READ_STATUS_INVALID) {\n                 MarkBlockAsReceived(resp.blockhash); // Reset in-flight state in case of whitelist\n-                Misbehaving(pfrom->GetId(), 100);\n-                LogPrintf(\"Peer %d sent us invalid compact block/non-matching block transactions\\n\", pfrom->id);\n+                if (it->second.first == pfrom->id) { // Only misbehaving if it's the one we expected\n+                    LogPrintf(\"Peer %d sent us invalid compact block/non-matching block transactions\\n\", pfrom->id);\n+                    Misbehaving(pfrom->GetId(), 100);\n+                }\n                 return true;\n             } else if (status == READ_STATUS_FAILED) {\n                 // Might have collided, fall back to getdata now :("
      }
    ]
  },
  {
    "sha": "424529e081551dee6ec1ebefb29825f3b79e7919",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0MjQ1MjllMDgxNTUxZGVlNmVjMWViZWZiMjk4MjVmM2I3OWU3OTE5",
    "commit": {
      "author": {
        "name": "R E Broadley",
        "email": "rebroad+github@gmail.com",
        "date": "2016-12-11T01:34:31Z"
      },
      "committer": {
        "name": "R E Broadley",
        "email": "rebroad+github@gmail.com",
        "date": "2016-12-27T05:43:05Z"
      },
      "message": "Allow first cmpctblock received to be processed (rather than first\nrequested).\n\nSpeeds up block propagation as avoids an unncessary wait for the first\nrequested cmpctblock and instead allows cmpctblocks sent as announcement\nto be processed when they arrive before the requested cmpctblock.\n\nFixes #9242",
      "tree": {
        "sha": "ff99f39d71fcfd313b0ffe353dc29a8f57bb1d39",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ff99f39d71fcfd313b0ffe353dc29a8f57bb1d39"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/424529e081551dee6ec1ebefb29825f3b79e7919",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "expired_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQIcBAABAgAGBQJYYf9pAAoJEJYWlWnKgEH5RjIP/0qBl8ZNv2wCdPedm0tFWpcm\n15IRYsXI3jHATigvIjpU8zPYv8crnlXM8wGe5Jf6ye68IoDCb5GQK3+iFxYRzgKw\nTtRmNUHb+GTzASPjsFYEsdXgfJZbXyEaUUp2KM5VTPo1nrHJbUTG7e3GRjW3Fths\nqPJTmaRFf2rJ9pn1pT+KhMApcZSg1a5HeTB2wWAwPlRaPxvJAGVluNvIL6OE1Yac\nk2OHkudl5uLo4K9Nmpz+aJ38oLzkqGDD6g130zsRZi2zeY2Xb0v4Enc0ZYsjUvPq\n9vjUDIMXwDy7CutCzCDAJvdpkzJiVAWYOEbM+fsTLV1N4g1P6/xRL8vKsPl/79eO\nOwAhWKH4ppdmPQJXRFn5h77Vb1pVcHJ945bbnIlh6db9VrXPbU23oVXDcMuJluEQ\na4T7s3ZGiCZl1jrGCwJAhaedfxtdOROyiDelkV9vEL5IWtKELBP02SNPO4E8i6Ct\nCkSE7jEW2a38+he3XI9Fx6pnL/2ZabjG+36ghFLpX4mN8/emH+PfdHN4XdnqVPwc\nqyklJNv0fbAZKhghtOmh55UYTSCA7r4BTgBH9ulotm78uEVT6QX5V7tfSPhrvoJp\nVAAS+xOMHjb7Vr9UhpyczcdZ4rl+tiFIarXmwBbvijDcePsaZLFPjOvn7d2ijeCo\nygnOxJryvWm4RN2JTxMu\n=ag7Y\n-----END PGP SIGNATURE-----",
        "payload": "tree ff99f39d71fcfd313b0ffe353dc29a8f57bb1d39\nparent 5a1f545d27d4c766d47aba5ec0f1cd84b28a6d4a\nauthor R E Broadley <rebroad+github@gmail.com> 1481420071 +0700\ncommitter R E Broadley <rebroad+github@gmail.com> 1482817385 +0700\n\nAllow first cmpctblock received to be processed (rather than first\nrequested).\n\nSpeeds up block propagation as avoids an unncessary wait for the first\nrequested cmpctblock and instead allows cmpctblocks sent as announcement\nto be processed when they arrive before the requested cmpctblock.\n\nFixes #9242\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/424529e081551dee6ec1ebefb29825f3b79e7919",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/424529e081551dee6ec1ebefb29825f3b79e7919",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/424529e081551dee6ec1ebefb29825f3b79e7919/comments",
    "author": {
      "login": "rebroad",
      "id": 1530283,
      "node_id": "MDQ6VXNlcjE1MzAyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rebroad",
      "html_url": "https://github.com/rebroad",
      "followers_url": "https://api.github.com/users/rebroad/followers",
      "following_url": "https://api.github.com/users/rebroad/following{/other_user}",
      "gists_url": "https://api.github.com/users/rebroad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
      "organizations_url": "https://api.github.com/users/rebroad/orgs",
      "repos_url": "https://api.github.com/users/rebroad/repos",
      "events_url": "https://api.github.com/users/rebroad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rebroad/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "rebroad",
      "id": 1530283,
      "node_id": "MDQ6VXNlcjE1MzAyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rebroad",
      "html_url": "https://github.com/rebroad",
      "followers_url": "https://api.github.com/users/rebroad/followers",
      "following_url": "https://api.github.com/users/rebroad/following{/other_user}",
      "gists_url": "https://api.github.com/users/rebroad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
      "organizations_url": "https://api.github.com/users/rebroad/orgs",
      "repos_url": "https://api.github.com/users/rebroad/repos",
      "events_url": "https://api.github.com/users/rebroad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rebroad/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "5a1f545d27d4c766d47aba5ec0f1cd84b28a6d4a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5a1f545d27d4c766d47aba5ec0f1cd84b28a6d4a",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/5a1f545d27d4c766d47aba5ec0f1cd84b28a6d4a"
      }
    ],
    "stats": {
      "total": 3,
      "additions": 1,
      "deletions": 2
    },
    "files": [
      {
        "sha": "1f7e44d43b10941a8d23ee2e69a223b6ca5abd6d",
        "filename": "src/net_processing.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 2,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/424529e081551dee6ec1ebefb29825f3b79e7919/src/net_processing.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/424529e081551dee6ec1ebefb29825f3b79e7919/src/net_processing.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net_processing.cpp?ref=424529e081551dee6ec1ebefb29825f3b79e7919",
        "patch": "@@ -1825,8 +1825,7 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n         // We want to be a bit conservative just to be extra careful about DoS\n         // possibilities in compact block processing...\n         if (pindex->nHeight <= chainActive.Height() + 2) {\n-            if ((!fAlreadyInFlight && nodestate->nBlocksInFlight < MAX_BLOCKS_IN_TRANSIT_PER_PEER) ||\n-                 (fAlreadyInFlight && blockInFlightIt->second.first == pfrom->GetId())) {\n+            if (fAlreadyInFlight || nodestate->nBlocksInFlight < MAX_BLOCKS_IN_TRANSIT_PER_PEER) {\n                 list<QueuedBlock>::iterator *queuedBlockIt = NULL;\n                 if (!MarkBlockAsInFlight(pfrom->GetId(), pindex->GetBlockHash(), chainparams.GetConsensus(), pindex, &queuedBlockIt)) {\n                     if (!(*queuedBlockIt)->partialBlock)"
      }
    ]
  }
]