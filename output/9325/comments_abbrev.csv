rebroad,2016-12-12T07:13:36Z,Details of testing done so far mentioned in #9242 ,https://github.com/bitcoin/bitcoin/pull/9325#issuecomment-266358285,266358285,
sdaftuar,2016-12-14T22:16:44Z,"I agree that we shouldn't ignore compactblock messages just because a block is in flight from another peer, but this code could result in downloading the same block multiple times, and this patch would allow a mischievous peer to interfere with block relay to an honest peer (by resetting the PartiallyDownloadedBlock object inside the QueuedBlock).\n\nI have a patch that will allow us to try to r",https://github.com/bitcoin/bitcoin/pull/9325#issuecomment-267174352,267174352,
rebroad,2016-12-15T05:56:25Z,"@sdaftuar Have you tested this PR? I am not sure how it would interfere with relay - can you elaborate?\n\nI do think the code in this PR could be refined further to give a middle-road between what it currently does and what #9352 does - i.e. fetch blocktxns is they are small or base the size based on how much has already been downloaded.\n\nRegarding the ""downloading the same block multiple t",https://github.com/bitcoin/bitcoin/pull/9325#issuecomment-267245696,267245696,
sdaftuar,2016-12-15T15:07:03Z,"> I am not sure how it would interfere with relay - can you elaborate?\n\nThere are too many issues here for me to go through all of them, but I can give you a couple examples of ways an attacker can break this code; hopefully that will provide enough a flavor for how to think about these kinds of changes better.\n\nFirst example: what happens if high-bandwidth peer A and high-bandwidth peer B",https://github.com/bitcoin/bitcoin/pull/9325#issuecomment-267350184,267350184,
rebroad,2016-12-16T08:23:43Z,"@sdaftuar Thanks for this - clearly the travis checks are insufficient, given they all passed It might be worth creating some tests to test it detects the scenarios you mention.\n\nIt seems the partialblock needs to be kept separate for each peer that sent a compact block (up to 3 therefore, and not allow partial blocks to be created for peers where we have not requested compact block announceme",https://github.com/bitcoin/bitcoin/pull/9325#issuecomment-267541898,267541898,
