[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/396157042",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13430#issuecomment-396157042",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13430",
    "id": 396157042,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NjE1NzA0Mg==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-11T08:04:01Z",
    "updated_at": "2018-06-11T08:04:01Z",
    "author_association": "MEMBER",
    "body": "ConceptACK for improved readability, though for the same reason I can't easily tell if it's correct :-)",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/396157042/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/396176052",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13430#issuecomment-396176052",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13430",
    "id": 396176052,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NjE3NjA1Mg==",
    "user": {
      "login": "Empact",
      "id": 5470,
      "node_id": "MDQ6VXNlcjU0NzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5470?u=a1574ca2038ff1dfaa9a7764c59ea5ff4f305b5d&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Empact",
      "html_url": "https://github.com/Empact",
      "followers_url": "https://api.github.com/users/Empact/followers",
      "following_url": "https://api.github.com/users/Empact/following{/other_user}",
      "gists_url": "https://api.github.com/users/Empact/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Empact/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Empact/subscriptions",
      "organizations_url": "https://api.github.com/users/Empact/orgs",
      "repos_url": "https://api.github.com/users/Empact/repos",
      "events_url": "https://api.github.com/users/Empact/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Empact/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-11T09:12:04Z",
    "updated_at": "2018-06-11T09:12:04Z",
    "author_association": "MEMBER",
    "body": "Concept ACK",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/396176052/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/396227294",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13430#issuecomment-396227294",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13430",
    "id": 396227294,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NjIyNzI5NA==",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?u=4a9af998e1a560b3f49c3827f453e1bcbe6a5cfb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-11T12:32:21Z",
    "updated_at": "2018-06-11T12:32:21Z",
    "author_association": "MEMBER",
    "body": "As @sdaftuar pointed out before, the burden in reviewing validation changes may not be worth it, unless this is really incomplete. I don't think this improves readability that much, but I'm in the same position as @Sjors.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/396227294/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/396489830",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13430#issuecomment-396489830",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13430",
    "id": 396489830,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NjQ4OTgzMA==",
    "user": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?u=8aa4d0fd79dff5cf64a98205c78bc1c96b0bf4b6&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-12T07:14:53Z",
    "updated_at": "2018-06-12T07:14:53Z",
    "author_association": "MEMBER",
    "body": "@promag I feel like this makes it clear which of the two cases \"do we have this block yet\" versus \"is this block pruned\", which I believe improves readability enough to warrant the effort. If others think it's more trouble than it's worth I'll grumpily close, though. ;)",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/396489830/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/397553329",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13430#issuecomment-397553329",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13430",
    "id": 397553329,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NzU1MzMyOQ==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-15T08:36:39Z",
    "updated_at": "2018-06-15T08:36:39Z",
    "author_association": "MEMBER",
    "body": "Don't worry too much about #13029; I'm waiting to see if #11082 makes it in, in which case that one can be closed.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/397553329/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/400848788",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13430#issuecomment-400848788",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13430",
    "id": 400848788,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwMDg0ODc4OA==",
    "user": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?u=8aa4d0fd79dff5cf64a98205c78bc1c96b0bf4b6&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-27T22:24:36Z",
    "updated_at": "2018-06-27T22:24:36Z",
    "author_association": "MEMBER",
    "body": "@sipa Github comment threading is buggy, but yes, see discussion above -- `block` is known to be non-null because it is checked (1) before entry and (2) at each loop in the form `block->pprev`.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/400848788/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/410367676",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13430#issuecomment-410367676",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13430",
    "id": 410367676,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxMDM2NzY3Ng==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-08-03T20:28:34Z",
    "updated_at": "2018-12-07T00:13:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#14711](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14711.html) (Remove uses of chainActive and mapBlockIndex in wallet code by ryanofsky)\n* [#10973](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/10973.html) (Refactor: separate wallet from node by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/410367676/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/412069660",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13430#issuecomment-412069660",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13430",
    "id": 412069660,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxMjA2OTY2MA==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-08-10T12:37:21Z",
    "updated_at": "2018-08-10T12:37:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--5d09a71f8925f3f132321140b44b946d-->The last travis run for this pull request was 56 days ago and is thus outdated. To trigger a fresh travis build, this pull request should be closed and re-opened.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/412069660/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/485505154",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13430#issuecomment-485505154",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13430",
    "id": 485505154,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4NTUwNTE1NA==",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-22T18:30:57Z",
    "updated_at": "2019-04-22T18:30:57Z",
    "author_association": "MEMBER",
    "body": "Might want to clarify the documentation of IsBlockPruned first? I.e. explain why it returns false for a block that has its data downloaded or why it returns false for a block that is missing its data.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/485505154/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/486064191",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13430#issuecomment-486064191",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13430",
    "id": 486064191,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4NjA2NDE5MQ==",
    "user": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?u=8aa4d0fd79dff5cf64a98205c78bc1c96b0bf4b6&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-24T04:35:24Z",
    "updated_at": "2019-04-24T04:35:24Z",
    "author_association": "MEMBER",
    "body": "@MarcoFalke I kind of closed this out of frustration due to lack of feedback. I can reopen if you think it's worth it to try to get this merged.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/486064191/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194308210",
    "pull_request_review_id": 127453026,
    "id": 194308210,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDMwODIxMA==",
    "diff_hunk": "@@ -4277,11 +4277,11 @@ std::shared_ptr<CWallet> CWallet::CreateWalletFromFile(const std::string& name,\n         //We can't rescan beyond non-pruned blocks, stop and throw an error\n         //this might happen if a user uses an old wallet within a pruned node\n         // or if he ran -disablewallet for a longer time, then decided to re-enable\n-        if (fPruneMode)\n-        {\n+        if (fPruneMode) {\n             CBlockIndex *block = chainActive.Tip();\n-            while (block && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA) && block->pprev->nTx > 0 && pindexRescan != block)\n+            while (block && block->pprev && !IsBlockPruned(block->pprev) && pindexRescan != block) {",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 9,
    "commit_id": "55e760f54721f320e913f885c89490a9531faaa5",
    "original_commit_id": "106a2a5110665ad7a7ee890c97997e0a50a414b7",
    "user": {
      "login": "Empact",
      "id": 5470,
      "node_id": "MDQ6VXNlcjU0NzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5470?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Empact",
      "html_url": "https://github.com/Empact",
      "followers_url": "https://api.github.com/users/Empact/followers",
      "following_url": "https://api.github.com/users/Empact/following{/other_user}",
      "gists_url": "https://api.github.com/users/Empact/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Empact/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Empact/subscriptions",
      "organizations_url": "https://api.github.com/users/Empact/orgs",
      "repos_url": "https://api.github.com/users/Empact/repos",
      "events_url": "https://api.github.com/users/Empact/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Empact/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This is slightly different because `!IsBlockPruned` is true when `BLOCK_HAVE_DATA` but from the immediate code alone `nTx > 0` is not guaranteed. Is it the case that `BLOCK_HAVE_DATA` blocks are guaranteed to have `nTx > 0`?",
    "created_at": "2018-06-11T07:11:23Z",
    "updated_at": "2018-06-15T03:10:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194308210",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194308210"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194308210"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194308210/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4286,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194308580",
    "pull_request_review_id": 127453466,
    "id": 194308580,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDMwODU4MA==",
    "diff_hunk": "@@ -2040,8 +2040,7 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n             // If pruning, don't inv blocks unless we have on disk and are likely to still have\n             // for some reasonable time window (1 hour) that block relay might require.\n             const int nPrunedBlocksLikelyToHave = MIN_BLOCKS_TO_KEEP - 3600 / chainparams.GetConsensus().nPowTargetSpacing;\n-            if (fPruneMode && (!(pindex->nStatus & BLOCK_HAVE_DATA) || pindex->nHeight <= chainActive.Tip()->nHeight - nPrunedBlocksLikelyToHave))\n-            {\n+            if (fPruneMode && (IsBlockPruned(pindex) || pindex->nHeight <= chainActive.Tip()->nHeight - nPrunedBlocksLikelyToHave)) {",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 6,
    "commit_id": "55e760f54721f320e913f885c89490a9531faaa5",
    "original_commit_id": "106a2a5110665ad7a7ee890c97997e0a50a414b7",
    "user": {
      "login": "Empact",
      "id": 5470,
      "node_id": "MDQ6VXNlcjU0NzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5470?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Empact",
      "html_url": "https://github.com/Empact",
      "followers_url": "https://api.github.com/users/Empact/followers",
      "following_url": "https://api.github.com/users/Empact/following{/other_user}",
      "gists_url": "https://api.github.com/users/Empact/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Empact/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Empact/subscriptions",
      "organizations_url": "https://api.github.com/users/Empact/orgs",
      "repos_url": "https://api.github.com/users/Empact/repos",
      "events_url": "https://api.github.com/users/Empact/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Empact/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: Explicit precedence for `chainActive.Tip()->nHeight - nPrunedBlocksLikelyToHave` would be nice",
    "created_at": "2018-06-11T07:13:30Z",
    "updated_at": "2018-06-15T03:10:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194308580",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194308580"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194308580"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194308580/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2043,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194308812",
    "pull_request_review_id": 127453744,
    "id": 194308812,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDMwODgxMg==",
    "diff_hunk": "@@ -4277,11 +4277,11 @@ std::shared_ptr<CWallet> CWallet::CreateWalletFromFile(const std::string& name,\n         //We can't rescan beyond non-pruned blocks, stop and throw an error\n         //this might happen if a user uses an old wallet within a pruned node\n         // or if he ran -disablewallet for a longer time, then decided to re-enable\n-        if (fPruneMode)\n-        {\n+        if (fPruneMode) {\n             CBlockIndex *block = chainActive.Tip();\n-            while (block && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA) && block->pprev->nTx > 0 && pindexRescan != block)\n+            while (block && block->pprev && !IsBlockPruned(block->pprev) && pindexRescan != block) {",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 9,
    "commit_id": "55e760f54721f320e913f885c89490a9531faaa5",
    "original_commit_id": "106a2a5110665ad7a7ee890c97997e0a50a414b7",
    "user": {
      "login": "Empact",
      "id": 5470,
      "node_id": "MDQ6VXNlcjU0NzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5470?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Empact",
      "html_url": "https://github.com/Empact",
      "followers_url": "https://api.github.com/users/Empact/followers",
      "following_url": "https://api.github.com/users/Empact/following{/other_user}",
      "gists_url": "https://api.github.com/users/Empact/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Empact/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Empact/subscriptions",
      "organizations_url": "https://api.github.com/users/Empact/orgs",
      "repos_url": "https://api.github.com/users/Empact/repos",
      "events_url": "https://api.github.com/users/Empact/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Empact/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Just noting that I see you mention this in your notes: \"Note that nTx > 0? is supposed to always be equivalent to (pindex->nStatus & BLOCK_HAVE_DATA)?.\"",
    "created_at": "2018-06-11T07:14:41Z",
    "updated_at": "2018-06-15T03:10:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194308812",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194308812"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194308812"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194308812/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4286,
    "side": "RIGHT",
    "in_reply_to_id": 194308210
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194310667",
    "pull_request_review_id": 127455898,
    "id": 194310667,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDMxMDY2Nw==",
    "diff_hunk": "@@ -4277,11 +4277,11 @@ std::shared_ptr<CWallet> CWallet::CreateWalletFromFile(const std::string& name,\n         //We can't rescan beyond non-pruned blocks, stop and throw an error\n         //this might happen if a user uses an old wallet within a pruned node\n         // or if he ran -disablewallet for a longer time, then decided to re-enable\n-        if (fPruneMode)\n-        {\n+        if (fPruneMode) {\n             CBlockIndex *block = chainActive.Tip();\n-            while (block && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA) && block->pprev->nTx > 0 && pindexRescan != block)\n+            while (block && block->pprev && !IsBlockPruned(block->pprev) && pindexRescan != block) {",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 9,
    "commit_id": "55e760f54721f320e913f885c89490a9531faaa5",
    "original_commit_id": "106a2a5110665ad7a7ee890c97997e0a50a414b7",
    "user": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yeah. if nTx = 0, it means you do not have data (nStatus & BHD), and if nTx > 0, it means you do have data, so the two checks are supposed to be equivalent, but I think they're done as a safety harness. That said, in this case the old code does `block->pprev->nStatus & BLOCK_HAVE_DATA) && block->pprev->nTx > 0` which is identical to the `!IsBlockPruned` case, isn't it?",
    "created_at": "2018-06-11T07:24:24Z",
    "updated_at": "2018-06-15T03:10:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194310667",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194310667"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194310667"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194310667/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4286,
    "side": "RIGHT",
    "in_reply_to_id": 194308210
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194311026",
    "pull_request_review_id": 127456273,
    "id": 194311026,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDMxMTAyNg==",
    "diff_hunk": "@@ -2040,8 +2040,7 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n             // If pruning, don't inv blocks unless we have on disk and are likely to still have\n             // for some reasonable time window (1 hour) that block relay might require.\n             const int nPrunedBlocksLikelyToHave = MIN_BLOCKS_TO_KEEP - 3600 / chainparams.GetConsensus().nPowTargetSpacing;\n-            if (fPruneMode && (!(pindex->nStatus & BLOCK_HAVE_DATA) || pindex->nHeight <= chainActive.Tip()->nHeight - nPrunedBlocksLikelyToHave))\n-            {\n+            if (fPruneMode && (IsBlockPruned(pindex) || pindex->nHeight <= chainActive.Tip()->nHeight - nPrunedBlocksLikelyToHave)) {",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 6,
    "commit_id": "55e760f54721f320e913f885c89490a9531faaa5",
    "original_commit_id": "106a2a5110665ad7a7ee890c97997e0a50a414b7",
    "user": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "You mean `()`? I don't think it's unclear that `<=` takes precedence over `-` (as opposed to e.g. `&&` and `||`)...",
    "created_at": "2018-06-11T07:25:59Z",
    "updated_at": "2018-06-15T03:10:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194311026",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194311026"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194311026"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194311026/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2043,
    "side": "RIGHT",
    "in_reply_to_id": 194308580
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194315186",
    "pull_request_review_id": 127461202,
    "id": 194315186,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDMxNTE4Ng==",
    "diff_hunk": "@@ -4277,11 +4277,11 @@ std::shared_ptr<CWallet> CWallet::CreateWalletFromFile(const std::string& name,\n         //We can't rescan beyond non-pruned blocks, stop and throw an error\n         //this might happen if a user uses an old wallet within a pruned node\n         // or if he ran -disablewallet for a longer time, then decided to re-enable\n-        if (fPruneMode)\n-        {\n+        if (fPruneMode) {\n             CBlockIndex *block = chainActive.Tip();\n-            while (block && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA) && block->pprev->nTx > 0 && pindexRescan != block)\n+            while (block && block->pprev && !IsBlockPruned(block->pprev) && pindexRescan != block) {",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 9,
    "commit_id": "55e760f54721f320e913f885c89490a9531faaa5",
    "original_commit_id": "106a2a5110665ad7a7ee890c97997e0a50a414b7",
    "user": {
      "login": "Empact",
      "id": 5470,
      "node_id": "MDQ6VXNlcjU0NzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5470?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Empact",
      "html_url": "https://github.com/Empact",
      "followers_url": "https://api.github.com/users/Empact/followers",
      "following_url": "https://api.github.com/users/Empact/following{/other_user}",
      "gists_url": "https://api.github.com/users/Empact/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Empact/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Empact/subscriptions",
      "organizations_url": "https://api.github.com/users/Empact/orgs",
      "repos_url": "https://api.github.com/users/Empact/repos",
      "events_url": "https://api.github.com/users/Empact/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Empact/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "It's not identical - via De Morgan's law:\r\n* IsBlockPruned: `!(nStatus & BLOCK_HAVE_DATA) && nTx > 0`\r\n* !IsBlockPruned: `(nStatus & BLOCK_HAVE_DATA) || nTx <= 0`",
    "created_at": "2018-06-11T07:45:58Z",
    "updated_at": "2018-06-15T03:10:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194315186",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194315186"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194315186"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194315186/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4286,
    "side": "RIGHT",
    "in_reply_to_id": 194308210
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194322419",
    "pull_request_review_id": 127469635,
    "id": 194322419,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDMyMjQxOQ==",
    "diff_hunk": "@@ -4277,11 +4277,11 @@ std::shared_ptr<CWallet> CWallet::CreateWalletFromFile(const std::string& name,\n         //We can't rescan beyond non-pruned blocks, stop and throw an error\n         //this might happen if a user uses an old wallet within a pruned node\n         // or if he ran -disablewallet for a longer time, then decided to re-enable\n-        if (fPruneMode)\n-        {\n+        if (fPruneMode) {\n             CBlockIndex *block = chainActive.Tip();\n-            while (block && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA) && block->pprev->nTx > 0 && pindexRescan != block)\n+            while (block && block->pprev && !IsBlockPruned(block->pprev) && pindexRescan != block) {",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 9,
    "commit_id": "55e760f54721f320e913f885c89490a9531faaa5",
    "original_commit_id": "106a2a5110665ad7a7ee890c97997e0a50a414b7",
    "user": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Hm, you're right. I got the `nTx > 0` part backwards... Eesh.",
    "created_at": "2018-06-11T08:15:33Z",
    "updated_at": "2018-06-15T03:10:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194322419",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194322419"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194322419"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194322419/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4286,
    "side": "RIGHT",
    "in_reply_to_id": 194308210
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194324920",
    "pull_request_review_id": 127472694,
    "id": 194324920,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDMyNDkyMA==",
    "diff_hunk": "@@ -4277,11 +4277,11 @@ std::shared_ptr<CWallet> CWallet::CreateWalletFromFile(const std::string& name,\n         //We can't rescan beyond non-pruned blocks, stop and throw an error\n         //this might happen if a user uses an old wallet within a pruned node\n         // or if he ran -disablewallet for a longer time, then decided to re-enable\n-        if (fPruneMode)\n-        {\n+        if (fPruneMode) {\n             CBlockIndex *block = chainActive.Tip();\n-            while (block && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA) && block->pprev->nTx > 0 && pindexRescan != block)\n+            while (block && block->pprev && !IsBlockPruned(block->pprev) && pindexRescan != block) {",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 9,
    "commit_id": "55e760f54721f320e913f885c89490a9531faaa5",
    "original_commit_id": "106a2a5110665ad7a7ee890c97997e0a50a414b7",
    "user": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "The more I stare at the original line, the more I think the nTx part is backwards. I think they intended to check if it was pruned, but got the check to instead check if 'they have the data and the nTx > 0'. But if they have the data, nTx should always be > 0.\r\n\r\nI.e.\r\n* for a pruned block, `nTx > 0` but `nStatus & BHD == 0`\r\n* for a non-pruned block, `nTx > 0` and `nStatus & BHD != 0`\r\n* for a block the node has not retrieved yet, `nTx == 0` and `nStatus & BHD == 0`\r\n\r\nI.e.\r\n```\r\nnTx > 0 nStatus & BHD != 0 case\r\n======= ================== =====================\r\nfalse   false              block data never seen\r\nfalse   true               ?????\r\ntrue    false              pruned block\r\ntrue    true               block data available\r\n```\r\n\r\nThe code checks that case 2 in the above table (`false true`) is not the case, but this check is unnecessary.\r\n\r\nI think the `!IsBlockPruned()` replacement here is correct.",
    "created_at": "2018-06-11T08:26:03Z",
    "updated_at": "2018-06-15T03:10:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194324920",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194324920"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194324920"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194324920/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4286,
    "side": "RIGHT",
    "in_reply_to_id": 194308210
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194335893",
    "pull_request_review_id": 127485713,
    "id": 194335893,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDMzNTg5Mw==",
    "diff_hunk": "@@ -4277,11 +4277,11 @@ std::shared_ptr<CWallet> CWallet::CreateWalletFromFile(const std::string& name,\n         //We can't rescan beyond non-pruned blocks, stop and throw an error\n         //this might happen if a user uses an old wallet within a pruned node\n         // or if he ran -disablewallet for a longer time, then decided to re-enable\n-        if (fPruneMode)\n-        {\n+        if (fPruneMode) {\n             CBlockIndex *block = chainActive.Tip();\n-            while (block && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA) && block->pprev->nTx > 0 && pindexRescan != block)\n+            while (block && block->pprev && !IsBlockPruned(block->pprev) && pindexRescan != block) {",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 9,
    "commit_id": "55e760f54721f320e913f885c89490a9531faaa5",
    "original_commit_id": "106a2a5110665ad7a7ee890c97997e0a50a414b7",
    "user": {
      "login": "Empact",
      "id": 5470,
      "node_id": "MDQ6VXNlcjU0NzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5470?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Empact",
      "html_url": "https://github.com/Empact",
      "followers_url": "https://api.github.com/users/Empact/followers",
      "following_url": "https://api.github.com/users/Empact/following{/other_user}",
      "gists_url": "https://api.github.com/users/Empact/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Empact/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Empact/subscriptions",
      "organizations_url": "https://api.github.com/users/Empact/orgs",
      "repos_url": "https://api.github.com/users/Empact/repos",
      "events_url": "https://api.github.com/users/Empact/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Empact/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Right, so my point is that, if the `false true ?????` case is relevant, then we need to exclude it. Looks like `CChainState::CheckBlockIndex` excludes that possibility (which is intuitive given coinbase exists at least), so I'm tending to agree with you: https://github.com/bitcoin/bitcoin/blob/master/src/validation.cpp#L4545",
    "created_at": "2018-06-11T09:06:15Z",
    "updated_at": "2018-06-15T03:10:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194335893",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194335893"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194335893"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194335893/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4286,
    "side": "RIGHT",
    "in_reply_to_id": 194308210
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194341639",
    "pull_request_review_id": 127492590,
    "id": 194341639,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDM0MTYzOQ==",
    "diff_hunk": "@@ -4277,11 +4277,11 @@ std::shared_ptr<CWallet> CWallet::CreateWalletFromFile(const std::string& name,\n         //We can't rescan beyond non-pruned blocks, stop and throw an error\n         //this might happen if a user uses an old wallet within a pruned node\n         // or if he ran -disablewallet for a longer time, then decided to re-enable\n-        if (fPruneMode)\n-        {\n+        if (fPruneMode) {\n             CBlockIndex *block = chainActive.Tip();\n-            while (block && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA) && block->pprev->nTx > 0 && pindexRescan != block)\n+            while (block && block->pprev && !IsBlockPruned(block->pprev) && pindexRescan != block) {",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 9,
    "commit_id": "55e760f54721f320e913f885c89490a9531faaa5",
    "original_commit_id": "106a2a5110665ad7a7ee890c97997e0a50a414b7",
    "user": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I don't think it's ever possible for that case to happen, so I think `!IsBlockPruned()` does what we want here. I.e. it's not a relevant case. Note that this is a check that goes back in the blockchain and only stops if it encounters a missing block. That will only ever be the case if pruning is enabled, and will only ever be caused by pruning. Non-pruning nodes never have holes in the blockchain data (i.e. if they have block at `height=x`, they also have block at `height=x-1` for `x > 0`).",
    "created_at": "2018-06-11T09:27:04Z",
    "updated_at": "2018-06-15T03:10:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194341639",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194341639"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194341639"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194341639/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4286,
    "side": "RIGHT",
    "in_reply_to_id": 194308210
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194385675",
    "pull_request_review_id": 127546153,
    "id": 194385675,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDM4NTY3NQ==",
    "diff_hunk": "@@ -2040,8 +2040,7 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n             // If pruning, don't inv blocks unless we have on disk and are likely to still have\n             // for some reasonable time window (1 hour) that block relay might require.\n             const int nPrunedBlocksLikelyToHave = MIN_BLOCKS_TO_KEEP - 3600 / chainparams.GetConsensus().nPowTargetSpacing;\n-            if (fPruneMode && (!(pindex->nStatus & BLOCK_HAVE_DATA) || pindex->nHeight <= chainActive.Tip()->nHeight - nPrunedBlocksLikelyToHave))\n-            {\n+            if (fPruneMode && (IsBlockPruned(pindex) || pindex->nHeight <= chainActive.Tip()->nHeight - nPrunedBlocksLikelyToHave)) {",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 6,
    "commit_id": "55e760f54721f320e913f885c89490a9531faaa5",
    "original_commit_id": "106a2a5110665ad7a7ee890c97997e0a50a414b7",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Could drop `fPruneMode` because `fHavePruned` is only true if `fHavePruned` is also true. Same below.",
    "created_at": "2018-06-11T12:29:05Z",
    "updated_at": "2018-06-15T03:10:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194385675",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194385675"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194385675"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194385675/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2043,
    "side": "RIGHT",
    "in_reply_to_id": 194308580
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194634789",
    "pull_request_review_id": 127841522,
    "id": 194634789,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDYzNDc4OQ==",
    "diff_hunk": "@@ -2040,8 +2040,7 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n             // If pruning, don't inv blocks unless we have on disk and are likely to still have\n             // for some reasonable time window (1 hour) that block relay might require.\n             const int nPrunedBlocksLikelyToHave = MIN_BLOCKS_TO_KEEP - 3600 / chainparams.GetConsensus().nPowTargetSpacing;\n-            if (fPruneMode && (!(pindex->nStatus & BLOCK_HAVE_DATA) || pindex->nHeight <= chainActive.Tip()->nHeight - nPrunedBlocksLikelyToHave))\n-            {\n+            if (fPruneMode && (IsBlockPruned(pindex) || pindex->nHeight <= chainActive.Tip()->nHeight - nPrunedBlocksLikelyToHave)) {",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 6,
    "commit_id": "55e760f54721f320e913f885c89490a9531faaa5",
    "original_commit_id": "106a2a5110665ad7a7ee890c97997e0a50a414b7",
    "user": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done.",
    "created_at": "2018-06-12T07:13:04Z",
    "updated_at": "2018-06-15T03:10:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194634789",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194634789"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194634789"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194634789/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2043,
    "side": "RIGHT",
    "in_reply_to_id": 194308580
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194830636",
    "pull_request_review_id": 128076868,
    "id": 194830636,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDgzMDYzNg==",
    "diff_hunk": "@@ -4281,11 +4281,11 @@ std::shared_ptr<CWallet> CWallet::CreateWalletFromFile(const std::string& name,\n         //We can't rescan beyond non-pruned blocks, stop and throw an error\n         //this might happen if a user uses an old wallet within a pruned node\n         // or if he ran -disablewallet for a longer time, then decided to re-enable\n-        if (fPruneMode)\n-        {\n+        if (fPruneMode) {\n             CBlockIndex *block = chainActive.Tip();\n-            while (block && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA) && block->pprev->nTx > 0 && pindexRescan != block)\n+            while (block && block->pprev && !IsBlockPruned(block->pprev) && pindexRescan != block) {",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 9,
    "commit_id": "55e760f54721f320e913f885c89490a9531faaa5",
    "original_commit_id": "877c92bb9ac62c600576de6cf593842785a95d91",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit, could drop first condition `block && ` and add `assert(block)` before the loop, like https://github.com/bitcoin/bitcoin/pull/13430/files#diff-a0c8f511d90e83aa9b5857e819ced344R1243.",
    "created_at": "2018-06-12T17:47:14Z",
    "updated_at": "2018-06-15T03:10:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194830636",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194830636"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194830636"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194830636/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4286,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194916551",
    "pull_request_review_id": 128181985,
    "id": 194916551,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDkxNjU1MQ==",
    "diff_hunk": "@@ -4281,11 +4281,11 @@ std::shared_ptr<CWallet> CWallet::CreateWalletFromFile(const std::string& name,\n         //We can't rescan beyond non-pruned blocks, stop and throw an error\n         //this might happen if a user uses an old wallet within a pruned node\n         // or if he ran -disablewallet for a longer time, then decided to re-enable\n-        if (fPruneMode)\n-        {\n+        if (fPruneMode) {\n             CBlockIndex *block = chainActive.Tip();\n-            while (block && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA) && block->pprev->nTx > 0 && pindexRescan != block)\n+            while (block && block->pprev && !IsBlockPruned(block->pprev) && pindexRescan != block) {",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 9,
    "commit_id": "55e760f54721f320e913f885c89490a9531faaa5",
    "original_commit_id": "877c92bb9ac62c600576de6cf593842785a95d91",
    "user": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "`block` is updated inside the loop, so that sounds like it could be unsafe. (That said, not sure if there is ever a case where a `CBlockIndex` goes from being set to being unset, except for genesis block...)\r\n\r\nOh, and it is set to the already tested `chainActive.Tip()` so it should always start out non-null.",
    "created_at": "2018-06-12T23:18:03Z",
    "updated_at": "2018-06-15T03:10:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194916551",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194916551"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194916551"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194916551/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4286,
    "side": "RIGHT",
    "in_reply_to_id": 194830636
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194923450",
    "pull_request_review_id": 128189738,
    "id": 194923450,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDkyMzQ1MA==",
    "diff_hunk": "@@ -4281,11 +4281,11 @@ std::shared_ptr<CWallet> CWallet::CreateWalletFromFile(const std::string& name,\n         //We can't rescan beyond non-pruned blocks, stop and throw an error\n         //this might happen if a user uses an old wallet within a pruned node\n         // or if he ran -disablewallet for a longer time, then decided to re-enable\n-        if (fPruneMode)\n-        {\n+        if (fPruneMode) {\n             CBlockIndex *block = chainActive.Tip();\n-            while (block && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA) && block->pprev->nTx > 0 && pindexRescan != block)\n+            while (block && block->pprev && !IsBlockPruned(block->pprev) && pindexRescan != block) {",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 9,
    "commit_id": "55e760f54721f320e913f885c89490a9531faaa5",
    "original_commit_id": "877c92bb9ac62c600576de6cf593842785a95d91",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "`block` is updated to `block->pprev` which is already tested.",
    "created_at": "2018-06-13T00:02:52Z",
    "updated_at": "2018-06-15T03:10:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194923450",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194923450"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194923450"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194923450/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4286,
    "side": "RIGHT",
    "in_reply_to_id": 194830636
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/195624215",
    "pull_request_review_id": 129031568,
    "id": 195624215,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NTYyNDIxNQ==",
    "diff_hunk": "@@ -4281,11 +4281,11 @@ std::shared_ptr<CWallet> CWallet::CreateWalletFromFile(const std::string& name,\n         //We can't rescan beyond non-pruned blocks, stop and throw an error\n         //this might happen if a user uses an old wallet within a pruned node\n         // or if he ran -disablewallet for a longer time, then decided to re-enable\n-        if (fPruneMode)\n-        {\n+        if (fPruneMode) {\n             CBlockIndex *block = chainActive.Tip();\n-            while (block && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA) && block->pprev->nTx > 0 && pindexRescan != block)\n+            while (block && block->pprev && !IsBlockPruned(block->pprev) && pindexRescan != block) {",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 9,
    "commit_id": "55e760f54721f320e913f885c89490a9531faaa5",
    "original_commit_id": "877c92bb9ac62c600576de6cf593842785a95d91",
    "user": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Ah, yes you're right. Done.",
    "created_at": "2018-06-15T03:09:39Z",
    "updated_at": "2018-06-15T03:10:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r195624215",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/195624215"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r195624215"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/195624215/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4286,
    "side": "RIGHT",
    "in_reply_to_id": 194830636
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/198326131",
    "pull_request_review_id": 132238652,
    "id": 198326131,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5ODMyNjEzMQ==",
    "diff_hunk": "@@ -4281,11 +4281,11 @@ std::shared_ptr<CWallet> CWallet::CreateWalletFromFile(const std::string& name,\n         //We can't rescan beyond non-pruned blocks, stop and throw an error\n         //this might happen if a user uses an old wallet within a pruned node\n         // or if he ran -disablewallet for a longer time, then decided to re-enable\n-        if (fPruneMode)\n-        {\n+        if (fPruneMode) {\n             CBlockIndex *block = chainActive.Tip();\n-            while (block && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA) && block->pprev->nTx > 0 && pindexRescan != block)\n+            while (block->pprev && !IsBlockPruned(block->pprev) && pindexRescan != block) {",
    "path": "src/wallet/wallet.cpp",
    "position": 9,
    "original_position": 9,
    "commit_id": "55e760f54721f320e913f885c89490a9531faaa5",
    "original_commit_id": "55e760f54721f320e913f885c89490a9531faaa5",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Why remove `block &&` here?",
    "created_at": "2018-06-26T23:20:13Z",
    "updated_at": "2018-06-26T23:20:13Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r198326131",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/198326131"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r198326131"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/198326131/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 4286,
    "original_line": 4286,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/198327183",
    "pull_request_review_id": 132239893,
    "id": 198327183,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5ODMyNzE4Mw==",
    "diff_hunk": "@@ -4281,11 +4281,11 @@ std::shared_ptr<CWallet> CWallet::CreateWalletFromFile(const std::string& name,\n         //We can't rescan beyond non-pruned blocks, stop and throw an error\n         //this might happen if a user uses an old wallet within a pruned node\n         // or if he ran -disablewallet for a longer time, then decided to re-enable\n-        if (fPruneMode)\n-        {\n+        if (fPruneMode) {\n             CBlockIndex *block = chainActive.Tip();\n-            while (block && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA) && block->pprev->nTx > 0 && pindexRescan != block)\n+            while (block && block->pprev && !IsBlockPruned(block->pprev) && pindexRescan != block) {",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 9,
    "commit_id": "55e760f54721f320e913f885c89490a9531faaa5",
    "original_commit_id": "877c92bb9ac62c600576de6cf593842785a95d91",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "@sipa see above.",
    "created_at": "2018-06-26T23:27:09Z",
    "updated_at": "2018-06-26T23:27:09Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r198327183",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/198327183"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r198327183"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/198327183/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4286,
    "side": "RIGHT",
    "in_reply_to_id": 194830636
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/200180212",
    "pull_request_review_id": 134445685,
    "id": 200180212,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwMDE4MDIxMg==",
    "diff_hunk": "@@ -4281,11 +4281,11 @@ std::shared_ptr<CWallet> CWallet::CreateWalletFromFile(const std::string& name,\n         //We can't rescan beyond non-pruned blocks, stop and throw an error\n         //this might happen if a user uses an old wallet within a pruned node\n         // or if he ran -disablewallet for a longer time, then decided to re-enable\n-        if (fPruneMode)\n-        {\n+        if (fPruneMode) {\n             CBlockIndex *block = chainActive.Tip();\n-            while (block && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA) && block->pprev->nTx > 0 && pindexRescan != block)\n+            while (block->pprev && !IsBlockPruned(block->pprev) && pindexRescan != block) {",
    "path": "src/wallet/wallet.cpp",
    "position": 9,
    "original_position": 9,
    "commit_id": "55e760f54721f320e913f885c89490a9531faaa5",
    "original_commit_id": "55e760f54721f320e913f885c89490a9531faaa5",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "@sipa `.Tip()` is always not null (at this point), and `block->pprev` is next `block` value.",
    "created_at": "2018-07-04T17:36:08Z",
    "updated_at": "2018-07-04T17:36:29Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r200180212",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/200180212"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r200180212"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/200180212/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 4286,
    "original_line": 4286,
    "side": "RIGHT",
    "in_reply_to_id": 198326131
  }
]