DrahtBot,2019-02-20T23:33:15Z,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #18836 (wallet: upgradewallet fixes and additional tests by achow101)\n\nIf you consider this pull request important, plea",https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-465798613,465798613,
Sjors,2019-02-21T09:20:14Z,"Partial Concept ACK on:\n* not creating a default wallet with `bitcoind`\n* storing opened wallets in `bitcoin_rw.conf` (QT only)\n\nConcept On The Fence about making this a breaking change for `bitcoind`. I.e. maybe we should still load an existing `<datadir>/wallet.dat` and `<datadir>/wallet.dat`, but not create one.\n\nConcept NACK on:\n* having QT start with a blank wallet, where the us",https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-465923557,465923557,
achow101,2019-02-21T18:45:11Z,"> An easier but still acceptable solution is a big Create Wallet button in the Overview tab (when no wallet is loaded), as well as point out that they can load an existing wallet (less likely for first time users).\n\nI've done this.\n\n> not loading the default wallet in QT after upgrading: that's a guarantee for user heart attacks\n\nI've changed that back to the original behavior except t",https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-466117889,466117889,
Sjors,2019-02-22T09:04:02Z,"Much better, thanks. Both bitcoind and QT now load the default wallet if it exists, and the QT create button is more clear.\n\nCan you add screenshots of the UX to the PR description?\n\nThe initial download overlay actually hides the wallet functionality, which has the nice side-effect of collecting some entropy. Although I'd rather work on making the initial experience such that users can ge",https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-466325581,466325581,
jnewbery,2019-02-22T13:38:19Z,concept ACK,https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-466398813,466398813,
achow101,2020-06-22T22:46:47Z,Rebased this on top of #15937,https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-647806429,647806429,
achow101,2020-06-25T22:30:21Z,Updated with the changes from #15937 ,https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-649849921,649849921,
Sjors,2020-07-02T19:24:15Z,Could use a fresh rebase in light of discussion in bitcoin-core/gui#26,https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-653182103,653182103,
achow101,2020-07-02T19:30:35Z,"> Could use a fresh rebase in light of discussion in [bitcoin-core/gui#26](https://github.com/bitcoin-core/gui/issues/26)\n\nWaiting on #15937 rebase",https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-653184434,653184434,
achow101,2020-08-17T20:36:25Z,I've changed the way that the GUI handles the `load_on_start` stuff and split it into #19754,https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-675100693,675100693,
Rspigler,2020-08-22T17:50:35Z,"@achow101 I know you mentioned #11082 a couple times in the writing of this.  Does the upcoming closing of that PR, and the merging of the alternative #15935 affect this?",https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-678671117,678671117,
achow101,2020-08-22T20:42:43Z,@Rspigler this PR had since been changed to use `load_on_start` so #11082 is not needed.,https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-678691849,678691849,
Sjors,2020-08-31T18:29:18Z,"Having https://github.com/bitcoin-core/gui/issues/77 implemented would go a long way towards making the ""Create Wallet"" dialog - which all new users have to deal with after this PR - less intimidating.  ",https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-683951713,683951713,
ryanofsky,2020-09-02T00:13:24Z,#19754 isn't really mentioned anywhere here but the first commit in this PR is from #19754 and can be reviewed there,https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-685200009,685200009,
promag,2020-09-03T00:56:45Z,"I guess we can leave https://github.com/bitcoin/bitcoin/pull/19754#issuecomment-685858578 for another PR. But I wonder what the best approach would be. Currently we have:\n```cpp\nauto wallet_client = interfaces::MakeWalletClient(*node.chain, args, args.GetArgs(""-wallet""));\n```\nWhich then calls\n```cpp\nstd::shared_ptr<CWallet> pwallet = CWallet::CreateWalletFromFile(chain, WalletLocation(",https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-686168009,686168009,
ryanofsky,2020-09-03T02:26:52Z,"> I guess we can leave [#19754 (comment)](https://github.com/bitcoin/bitcoin/pull/19754#issuecomment-685858578) for another PR. But I wonder what the best approach would be. Currently we have:\n\nIdeally, I don't think it should be handled in the wallet/init.cpp Construct method. That method was only meant to construct WalletClient object early on startup, not to access the filesystem or do anyt",https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-686194501,686194501,
promag,2020-09-03T02:32:05Z,"> and shown in the GUI in a disabled state\n\nIMO more appropriate is to show a modal dialog on start (for each non existing wallet) asking if it should be removed/forgotten from settings, and if he chooses to keep it then it could be disabled.",https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-686196100,686196100,
ryanofsky,2020-09-03T02:41:15Z,"Matter of taste, I guess. I don't love modal dialogs, and if I have a multiple wallets and some of them are on an encrypted mount or external drive which is unavailable, I would rather just see the wallets listed normally, disabled and unavailable, not have to manually click through a bunch of pop-up dialogs  confirming serially that I still want to load each wallet in the future.",https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-686210149,686210149,
promag,2020-09-03T02:43:16Z,How would you drop disabled wallets (from settings)?,https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-686213316,686213316,
ryanofsky,2020-09-03T02:47:17Z,"> How would you drop disabled wallets (from settings)?\n\nThe same way you drop an enabled wallet from settings. Switch to wallet in drop-down, go to File -> Close Wallet...",https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-686216198,686216198,
promag,2020-09-03T02:51:13Z,"Oh, so it would be possible to switch in the combo (not actually disabled) but then WalletFrame/WalletView should say that wallet is not available or something like that and probably disable send/receive/transactions views.",https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-686217321,686217321,
ryanofsky,2020-09-03T02:59:27Z,"Yes, exactly. I guess the term ""disabled"" is overloaded. But that's just a suggestion. Other approaches (just silently not loading non-existing wallets, silently not loading and also removing from settings, or prompting the user) all seem reasonable and probably easier to implement.",https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-686219674,686219674,
meshcollider,2020-09-07T03:34:39Z,"Error building after #19619 was merged:\n```\nwallet/init.cpp: In member function ‘virtual void WalletInit::Construct(NodeContext&) const’:\nwallet/init.cpp:112:37: error: ‘WalletLocation’ was not declared in this scope\n     if (!args.IsArgSet(""wallet"") && WalletLocation("""").Exists()) {\n                                     ^~~~~~~~~~~~~~\nwallet/init.cpp:112:37: note: suggested alternative",https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-688008168,688008168,
achow101,2020-09-07T05:34:34Z,Rebased,https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-688046599,688046599,
achow101,2020-09-09T01:03:38Z,Squashed in @ryanofsky's commit. Also added release notes.,https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-689234748,689234748,
ryanofsky,2020-09-15T14:21:25Z,"I would really like to see this merged, because I think it's a significant interface change (or at least a notable one)  that a lot of other changes can build on:\n\n- GUI improvements like https://github.com/bitcoin-core/gui/issues/77\n- Fixing bad behavior of `settings.json` wallet list recreating removed wallets https://github.com/bitcoin/bitcoin/pull/19754#issuecomment-685858578\n- Maybe t",https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-692747945,692747945,
jonatack,2020-09-15T14:25:25Z,Will review soon.,https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-692750508,692750508,
instagibbs,2020-09-16T17:00:54Z,also publicly committing to reviewing soon ,https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-693536575,693536575,
jnewbery,2020-09-17T10:49:29Z,"Manual test and very light code review ACK d26f0648f1c0d1115dcb8d76e57195032b88f400\n\nI manually tested:\n\n- default wallet is loaded on startup, even if ""load_on_startup"" is not set for the default wallet.\n- if no default wallet exists, it's not created on startup\n- this doesn't effect whether other wallets are loaded on startup or not.",https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-694152909,694152909,
jonatack,2020-09-17T12:52:51Z,"It seems possible to remove the additional ""-wallet="" extra_arg from a number of the changed tests before finding a couple that fail without it. Passing `-wallet` without a value also seems fine:\n```diff\n-            [""-whitelist=noban@127.0.0.1"", ""-keypool=100"", ""-wallet=""],\n-            [""-whitelist=noban@127.0.0.1"", ""-keypool=100"", ""-wallet=""],\n-            [""-whitelist=noban@127.0.0.1""",https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-694210398,694210398,
meshcollider,2020-09-17T23:42:10Z,"This is fine to go in as-is, as mentioned, we can easily make changes to the release notes when they are collated.",https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-694557744,694557744,
Sjors,2020-09-18T08:25:05Z,"I made some changes to the wallet creation dialog, because I don't think the current iteration is suitable for new users: https://github.com/bitcoin-core/gui/pull/96",https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-694731647,694731647,
Sjors,2020-09-18T10:41:44Z,Forgot the extended tests... fixed in #19971 ,https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-694795112,694795112,
ryanofsky,2020-09-29T19:46:55Z,"re: https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-694210398 & https://github.com/bitcoin/bitcoin/pull/15454#pullrequestreview-490569662\n\n> It seems possible to remove the additional ""-wallet="" extra_arg from a number of the changed tests\n\n#20034 follows this PR up and removes all of these. It also goes further and removes the test framework `-wallet` extra_args mangling, which",https://github.com/bitcoin/bitcoin/pull/15454#issuecomment-700946692,700946692,
promag,2019-02-20T23:58:16Z,"Unless I'm missing something, this is breaking change. Why not change the behavior from ""load or create each -wallet"" to ""just load each -wallet""? Then to create a wallet there is the option in the GUI and `createwallet` in RPC.",https://github.com/bitcoin/bitcoin/pull/15454#discussion_r258728897,258728897,src/wallet/init.cpp
practicalswift,2019-02-25T23:32:57Z,Nit: Redundant initialisation :-),https://github.com/bitcoin/bitcoin/pull/15454#discussion_r260065755,260065755,src/wallet/init.cpp
luke-jr,2019-10-21T20:26:26Z,What if the wallet name has a comma? Would prefer to see rwconf extended to multiple `wallet=` fields...,https://github.com/bitcoin/bitcoin/pull/15454#discussion_r337222306,337222306,src/wallet/load.cpp
luke-jr,2019-10-21T20:26:35Z,Should just use `wallet=`?,https://github.com/bitcoin/bitcoin/pull/15454#discussion_r337222376,337222376,src/wallet/load.cpp
achow101,2019-10-21T21:10:34Z,So would I. I would prefer that #11082 implements it that way instead of requiring me to change it as I am not familiar with that code.,https://github.com/bitcoin/bitcoin/pull/15454#discussion_r337241398,337241398,src/wallet/load.cpp
achow101,2019-10-21T21:11:38Z,"That will cause some problems as is since it would be one string that represents multiple wallets. If/when rwconf allows repeated fields, then it can be `wallet=`.",https://github.com/bitcoin/bitcoin/pull/15454#discussion_r337241833,337241833,src/wallet/load.cpp
ryanofsky,2020-06-25T13:31:14Z,"In commit ""Do not create default wallet"" (6feed9508a225276cc2264b7d19b151a62deecea)\n\nWas experimenting with this PR and would suggest the following fixup: 973bb7e652c4ce10ee536e9967a88c80f6dbe2e0 ([tag](https://github.com/ryanofsky/bitcoin/commits/review.15454.2-edit.1)). SoftSet doesn't really work here for a persistent setting. I'll backport this fixup to #15937 so the diff here will be smal",https://github.com/bitcoin/bitcoin/pull/15454#discussion_r445559622,445559622,src/wallet/init.cpp
ryanofsky,2020-06-25T21:54:29Z,"re: https://github.com/bitcoin/bitcoin/pull/15454#discussion_r445559622\n\n> Was experimenting with this PR and would suggest the following fixup: [973bb7e](https://github.com/bitcoin/bitcoin/commit/973bb7e652c4ce10ee536e9967a88c80f6dbe2e0) ([tag](https://github.com/ryanofsky/bitcoin/commits/review.15454.2-edit.1))\n\nFeel free to steal updated version of this PR with fix above squashed and ne",https://github.com/bitcoin/bitcoin/pull/15454#discussion_r445860284,445860284,src/wallet/init.cpp
flack,2020-08-13T19:12:06Z,"wouldn't it be nicer to just make a `open_wallet_button` here like it is done below for the create button? That would save the user a bit of mousing around. Also, it would remove the headache of making sure that `File > Open Wallet` stays consistent with how the menu items are actually called",https://github.com/bitcoin/bitcoin/pull/15454#discussion_r470186682,470186682,src/qt/walletframe.cpp
achow101,2020-08-13T19:59:00Z,"It would, but the way that opening wallets works now would require more extensive changes with code that I'm not too familiar with.\n\nSomeone who is more familiar with the GUI can make this nicer in the future.",https://github.com/bitcoin/bitcoin/pull/15454#discussion_r470212595,470212595,src/qt/walletframe.cpp
flack,2020-08-13T22:07:16Z,"if this were Javascript, I would simply make a button that clicks the menu item. But I guess that won't fly in Qt :-)",https://github.com/bitcoin/bitcoin/pull/15454#discussion_r470275603,470275603,src/qt/walletframe.cpp
achow101,2020-08-13T22:31:33Z,"The menu item doesn't open a selection dialog, it opens a submenu listing all of the wallets. That doesn't really work here.",https://github.com/bitcoin/bitcoin/pull/15454#discussion_r470284648,470284648,src/qt/walletframe.cpp
promag,2020-08-14T14:11:05Z,Do you think we should replace the submenu with a dialog?,https://github.com/bitcoin/bitcoin/pull/15454#discussion_r470647514,470647514,src/qt/walletframe.cpp
achow101,2020-08-14T15:33:45Z,"I suppose this could just be a dropdown listing all of the available wallets. But, as I said, I leave this up to someone more familiar with the GUI to do.",https://github.com/bitcoin/bitcoin/pull/15454#discussion_r470699957,470699957,src/qt/walletframe.cpp
flack,2020-08-14T15:45:52Z,"if it were up to me I'd say a simple filepicker would totally suffice. It's self-explanatory and flexible, and the more fancy stuff is still available from the menu for those who want it ",https://github.com/bitcoin/bitcoin/pull/15454#discussion_r470706338,470706338,src/qt/walletframe.cpp
achow101,2020-08-14T15:52:51Z,We would need #15204 to do a file picker type thing.,https://github.com/bitcoin/bitcoin/pull/15454#discussion_r470710148,470710148,src/qt/walletframe.cpp
flack,2020-08-14T15:55:03Z,"ah, sorry, I somehow thought that was already merged",https://github.com/bitcoin/bitcoin/pull/15454#discussion_r470711325,470711325,src/qt/walletframe.cpp
promag,2020-08-14T23:47:25Z,@flack see https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-539932726. ,https://github.com/bitcoin/bitcoin/pull/15454#discussion_r470907539,470907539,src/qt/walletframe.cpp
jonatack,2020-09-17T13:00:21Z,"Would it better to do:\n```diff\n-    if (!gArgs.IsArgSet(""wallet"")) {\n+    if (!(gArgs.GetBoolArg(""wallet"", false)) {\n```",https://github.com/bitcoin/bitcoin/pull/15454#discussion_r490224007,490224007,src/wallet/load.cpp
ryanofsky,2020-09-17T13:04:32Z,"re: https://github.com/bitcoin/bitcoin/pull/15454#discussion_r490224007\n\n> Would it better to do:\n> \n> ```diff\n> -    if (!gArgs.IsArgSet(""wallet"")) {\n> +    if (!(gArgs.GetBoolArg(""wallet"", false)) {\n> ```\n\nThis would be bad because it would cause a `-nowallet` setting to load the default wallet.",https://github.com/bitcoin/bitcoin/pull/15454#discussion_r490226736,490226736,src/wallet/load.cpp
instagibbs,2020-09-17T17:08:05Z,"> Bitcoin Core will no longer create an unnamed `""""` wallet by default.\n\nJust stop here. It won't make a default wallet of any kind, whether or not you specify one specifically.",https://github.com/bitcoin/bitcoin/pull/15454#discussion_r490422796,490422796,doc/release-notes-15454.md
achow101,2020-09-17T17:09:47Z,I think you can make an unnamed wallet with `createwallet`,https://github.com/bitcoin/bitcoin/pull/15454#discussion_r490423748,490423748,doc/release-notes-15454.md
instagibbs,2020-09-17T17:12:18Z,"> by default\n\nis the key phrase here. It makes nothing by default.",https://github.com/bitcoin/bitcoin/pull/15454#discussion_r490425207,490425207,doc/release-notes-15454.md
achow101,2020-09-17T17:15:34Z,Meh. Release notes can always be edited when they go up on the dev wiki.,https://github.com/bitcoin/bitcoin/pull/15454#discussion_r490427110,490427110,doc/release-notes-15454.md
instagibbs,2020-09-17T17:19:07Z,Ok we'll just hope our readers are deficient in English ;P,https://github.com/bitcoin/bitcoin/pull/15454#discussion_r490429103,490429103,doc/release-notes-15454.md
flack,2020-09-17T17:23:29Z,"maybe just leave out ""by default""?",https://github.com/bitcoin/bitcoin/pull/15454#discussion_r490431696,490431696,doc/release-notes-15454.md
