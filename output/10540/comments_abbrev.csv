laanwj,2017-06-06T15:18:35Z,"`-salvagewallet` is meant to ""salvage"" - do everything it can - to get something usable from corrupted wallets.\nI think a better approach would be to try with non-aggressive first, and *only if that fails* try aggressively.\nBut disabling aggressive mode completely is throwing away the baby with the bathwater and neutering this mode completely.\n\n>  #8745 (bitcoin-wallet-tool) is the right p",https://github.com/bitcoin/bitcoin/pull/10540#issuecomment-306519754,306519754,
jnewbery,2017-06-06T15:43:13Z,"> neutering this mode completely.\n\nThat doesn't seem to be true from my testing. Running verify without DB_AGGRESSIVE does remove corruption from the wallet.dat file and make the balance available. Perhaps that's only because -salvagewallet is also causing a rescan to happen.\n\nDo you have experience of -salvagewallet recovering a wallet where running a non-aggressive verify would not have ",https://github.com/bitcoin/bitcoin/pull/10540#issuecomment-306527901,306527901,
gmaxwell,2017-06-06T16:59:03Z,"I was going to make pretty much exactly the same post that Wladimir made:   Salvage is supposed to be used on a corrupted file-- thats the whole point, perhaps we should do both, if you think that we shouldn't be working on corrupted files there perhaps we should remove it. (I'd be pretty game to remove it: I think it's mistakenly used by users FAR too often even though it's something of a nuclear",https://github.com/bitcoin/bitcoin/pull/10540#issuecomment-306550642,306550642,
laanwj,2017-06-07T11:19:07Z,"> But in all cases the recovery should probably try all reading methods available and union them.\n\nExcellent comment. Completely agree with this. Would make sense for `-salvagewallet` to try various techniques, then combine the result.\n\n> Keys in the wallet are stored with this terrible der private key encoding that is obvious from orbit... \n\nYes, that would be a good additional strate",https://github.com/bitcoin/bitcoin/pull/10540#issuecomment-306765396,306765396,
jnewbery,2017-06-07T13:31:33Z,"Thanks for the great feedback @laanwj and @gmaxwell . Sounds like there are plenty of improvements we can make here. There are at least three recovery techniques we can use:\n- attempt to salvage non-aggressively\n- attempt to salvage aggressively\n- do a memory scan for DER encoded private keys in the .dat file.\n\nThose operations should be done by a separate tool and not loaded immediately",https://github.com/bitcoin/bitcoin/pull/10540#issuecomment-306795349,306795349,
laanwj,2017-06-07T15:45:48Z,@jnewbery Sounds good to me,https://github.com/bitcoin/bitcoin/pull/10540#issuecomment-306836654,306836654,
jnewbery,2017-06-06T15:09:12Z,Note for reviewers: This branch was impossible to hit since Salvage() was never called with fAggressive set to false,https://github.com/bitcoin/bitcoin/pull/10540#discussion_r120388617,120388617,src/wallet/db.cpp
