glozow,2021-02-23 15:55:41,@MarcoFalke thanks for catching the bug - this should fix it,https://github.com/bitcoin/bitcoin/pull/21280#issuecomment-784303981,784303981,
glozow,2021-02-23 19:33:44,"Cirrus failure is in feature_blockfilterindex_prune.py, which I'm pretty sure is unrelated, given that this is only touching the unit tests",https://github.com/bitcoin/bitcoin/pull/21280#issuecomment-784456759,784456759,
glozow,2021-04-05 17:00:30,"Updates:\nIterate through the values in `mapFlagNames` instead of all bits from 1 to size().\nCheck that all flags in `STANDARD_SCRIPT_VERIFY_FLAGS` are present in `mapFlagNames`. This would cover all relevant flags used for consensus and policy checks.",https://github.com/bitcoin/bitcoin/pull/21280#issuecomment-813504912,813504912,
glozow,2021-04-08 02:04:00,Addressed the compiler warning about unused variable and @jnewbery's comments - thanks!,https://github.com/bitcoin/bitcoin/pull/21280#issuecomment-815391728,815391728,
jnewbery,2021-04-08 08:05:16,utACK b109bde46a8730afbc09c107b802a2c321293f4b,https://github.com/bitcoin/bitcoin/pull/21280#issuecomment-815548255,815548255,
MarcoFalke,2021-02-23 16:11:29,I think the test is testing that an invalid p2sh tx is valid before p2sh activation?,https://github.com/bitcoin/bitcoin/pull/21280#discussion_r581173990,581173990,src/test/data/tx_valid.json
MarcoFalke,2021-02-23 16:11:53,Any reason to re-invent the wheel and avoid `std::set`?,https://github.com/bitcoin/bitcoin/pull/21280#discussion_r581174313,581174313,src/test/transaction_tests.cpp
glozow,2021-02-23 16:26:34,"Nope, I could change it to set.",https://github.com/bitcoin/bitcoin/pull/21280#discussion_r581186635,581186635,src/test/transaction_tests.cpp
glozow,2021-02-23 16:41:26,"With #19698, transaction_tests will check that excluding the `P2SH` flag will cause this test to pass, so it would still be a duplicate test.",https://github.com/bitcoin/bitcoin/pull/21280#discussion_r581199181,581199181,src/test/data/tx_valid.json
glozow,2021-02-23 16:54:36,I've changed it to use a `std::set`,https://github.com/bitcoin/bitcoin/pull/21280#discussion_r581210120,581210120,src/test/transaction_tests.cpp
glozow,2021-02-23 16:54:49,Added this comment to the commit log^,https://github.com/bitcoin/bitcoin/pull/21280#discussion_r581210306,581210306,src/test/data/tx_valid.json
MarcoFalke,2021-03-30 10:46:02,how is the map supposed to be kept up to date? Looks like it is missing SCRIPT_VERIFY_DISCOURAGE_UPGRADABLE_PUBKEYTYPE?,https://github.com/bitcoin/bitcoin/pull/21280#discussion_r603986455,603986455,src/test/transaction_tests.cpp
MarcoFalke,2021-03-30 10:48:22,unrelated nit: Could `Assert(IsValidFlagCombination(flags));`? (Needs #21553),https://github.com/bitcoin/bitcoin/pull/21280#discussion_r603987931,603987931,src/test/transaction_tests.cpp
glozow,2021-03-30 15:08:43,~There are places where we need to fill the flags as well as check that they're a valid combination~,https://github.com/bitcoin/bitcoin/pull/21280#discussion_r604187375,604187375,src/test/transaction_tests.cpp
glozow,2021-03-30 15:19:39,"Hm, is it possible to iterate through all the script verify flags? Could add an assert that they're all present in `mapFlagNames`",https://github.com/bitcoin/bitcoin/pull/21280#discussion_r604196975,604196975,src/test/transaction_tests.cpp
glozow,2021-03-30 15:19:57,"> Looks like it is missing SCRIPT_VERIFY_DISCOURAGE_UPGRADABLE_PUBKEYTYPE?\n\nOop, will add",https://github.com/bitcoin/bitcoin/pull/21280#discussion_r604197281,604197281,src/test/transaction_tests.cpp
MarcoFalke,2021-03-30 17:46:21,"Oh, my comment was just an example. There are more missing than just the one, IIRC",https://github.com/bitcoin/bitcoin/pull/21280#discussion_r604307793,604307793,src/test/transaction_tests.cpp
glozow,2021-03-30 23:56:34,should all be there now,https://github.com/bitcoin/bitcoin/pull/21280#discussion_r604505210,604505210,src/test/transaction_tests.cpp
glozow,2021-03-31 13:33:07,"I completely misread this for some reason ðŸ¤¦ sorry about that\nJust rebased on top of #21553 and added the asserts",https://github.com/bitcoin/bitcoin/pull/21280#discussion_r604900643,604900643,src/test/transaction_tests.cpp
jnewbery,2021-04-01 14:12:26,"This returns a set, not a list.\n\nYou could copy the set into a vector to avoid changing the return type if you really felt like it.\n\n```diff\ndiff --git a/src/test/transaction_tests.cpp b/src/test/transaction_tests.cpp\nindex 3d6ad20b85..235862ec7a 100644\n--- a/src/test/transaction_tests.cpp\n+++ b/src/test/transaction_tests.cpp\n@@ -161,7 +161,7 @@ unsigned int FillFlags(unsigned in",https://github.com/bitcoin/bitcoin/pull/21280#discussion_r605690662,605690662,src/test/transaction_tests.cpp
glozow,2021-04-01 15:46:11,"True, although hopefully it's obvious - will update if I need to retouch. Thanks!",https://github.com/bitcoin/bitcoin/pull/21280#discussion_r605761818,605761818,src/test/transaction_tests.cpp
MarcoFalke,2021-04-01 17:20:17,"I still don't think this is right. A std::map doesn't order its elements based on the order they were inserted. \n\nEven if it did, the values aren't guaranteed to never miss a power of two.\n",https://github.com/bitcoin/bitcoin/pull/21280#discussion_r605822413,605822413,src/test/transaction_tests.cpp
MarcoFalke,2021-04-01 17:20:35,same (and everywhere else),https://github.com/bitcoin/bitcoin/pull/21280#discussion_r605822610,605822610,src/test/transaction_tests.cpp
glozow,2021-04-02 16:54:04,"Sorry, what do you mean? The map `mapFlagNames` is just to identify the flags from strings in the json files. I guess if there wasn't a script verify flag for `1 << i` for some `i`, it would get ignored by the interpreter if we added it. So as long as we have the leftmost flag we should be okay?",https://github.com/bitcoin/bitcoin/pull/21280#discussion_r606322892,606322892,src/test/transaction_tests.cpp
MarcoFalke,2021-04-02 16:59:00,"Let's assume mapFlagNames is only a single entry `{""EXAMPLE"", 1U << 4}` (because for some reason other flags are no longer needed and have been removed).\n\nThe loop will only cover `1U << 1`, a non-existent flag.",https://github.com/bitcoin/bitcoin/pull/21280#discussion_r606326624,606326624,src/test/transaction_tests.cpp
glozow,2021-04-02 22:00:30,Ah true. Is there a way of checking whether an unsigned int corresponds to a script verify flag?,https://github.com/bitcoin/bitcoin/pull/21280#discussion_r606443484,606443484,src/test/transaction_tests.cpp
MarcoFalke,2021-04-03 06:09:41,Just iterate over the map and use the value of the key-value pair?,https://github.com/bitcoin/bitcoin/pull/21280#discussion_r606625407,606625407,src/test/transaction_tests.cpp
glozow,2021-04-05 16:46:43,Fixed,https://github.com/bitcoin/bitcoin/pull/21280#discussion_r607194919,607194919,src/test/transaction_tests.cpp
jnewbery,2021-04-07 08:53:46,"```suggestion\n    for (const auto& [_, flag] : mapFlagNames) {\n```",https://github.com/bitcoin/bitcoin/pull/21280#discussion_r608466620,608466620,src/test/transaction_tests.cpp
jnewbery,2021-04-07 08:54:17,"```suggestion\n    for (const auto& [_, flag] : mapFlagNames) {\n```",https://github.com/bitcoin/bitcoin/pull/21280#discussion_r608467016,608467016,src/test/transaction_tests.cpp
jnewbery,2021-04-07 10:24:47,"This doesn't need `ToString()`:\n\n```suggestion\n                    BOOST_ERROR(""Tx unexpectedly failed with flag "" << flag << "" unset: "" << strTest);\n```\n\nor alternatively, print the name of the flag:\n\n```suggestion\n                    BOOST_ERROR(""Tx unexpectedly failed with flag "" << _ << "" unset: "" << strTest);\n```\n\n(but probably change `_` to `flag_name` or similar)",https://github.com/bitcoin/bitcoin/pull/21280#discussion_r608530055,608530055,src/test/transaction_tests.cpp
jnewbery,2021-04-07 10:25:06,"```suggestion\n            for (const auto& [_, flag] : mapFlagNames) {\n```",https://github.com/bitcoin/bitcoin/pull/21280#discussion_r608530251,608530251,src/test/transaction_tests.cpp
jnewbery,2021-04-07 10:25:19,"Again, `ToString()` is not necessary.",https://github.com/bitcoin/bitcoin/pull/21280#discussion_r608530364,608530364,src/test/transaction_tests.cpp
glozow,2021-04-08 02:03:42,printing name of flag! :D ,https://github.com/bitcoin/bitcoin/pull/21280#discussion_r609207075,609207075,src/test/transaction_tests.cpp
MarcoFalke,2021-04-19 09:27:38,It might be nice to check the exact script reject reason instead of just failure,https://github.com/bitcoin/bitcoin/pull/21280#discussion_r615687816,615687816,src/test/data/tx_invalid.json
