[
  {
    "sha": "22cc797ca5c1e70a4afb8e43f6917b4c9fe74e20",
    "node_id": "C_kwDOABII59oAKDIyY2M3OTdjYTVjMWU3MGE0YWZiOGU0M2Y2OTE3YjRjOWZlNzRlMjA",
    "commit": {
      "author": {
        "name": "Samuel Dobson",
        "email": "dobsonsa68@gmail.com",
        "date": "2021-09-25T22:36:59Z"
      },
      "committer": {
        "name": "Samuel Dobson",
        "email": "dobsonsa68@gmail.com",
        "date": "2021-09-26T01:57:07Z"
      },
      "message": "Add newkeypool RPC to flush the keypool",
      "tree": {
        "sha": "1ca9b6581d7490fc55ee72bd483588f4845cd484",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1ca9b6581d7490fc55ee72bd483588f4845cd484"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/22cc797ca5c1e70a4afb8e43f6917b4c9fe74e20",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/22cc797ca5c1e70a4afb8e43f6917b4c9fe74e20",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/22cc797ca5c1e70a4afb8e43f6917b4c9fe74e20",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/22cc797ca5c1e70a4afb8e43f6917b4c9fe74e20/comments",
    "author": {
      "login": "meshcollider",
      "id": 3211283,
      "node_id": "MDQ6VXNlcjMyMTEyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3211283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meshcollider",
      "html_url": "https://github.com/meshcollider",
      "followers_url": "https://api.github.com/users/meshcollider/followers",
      "following_url": "https://api.github.com/users/meshcollider/following{/other_user}",
      "gists_url": "https://api.github.com/users/meshcollider/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
      "organizations_url": "https://api.github.com/users/meshcollider/orgs",
      "repos_url": "https://api.github.com/users/meshcollider/repos",
      "events_url": "https://api.github.com/users/meshcollider/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meshcollider/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "meshcollider",
      "id": 3211283,
      "node_id": "MDQ6VXNlcjMyMTEyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3211283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meshcollider",
      "html_url": "https://github.com/meshcollider",
      "followers_url": "https://api.github.com/users/meshcollider/followers",
      "following_url": "https://api.github.com/users/meshcollider/following{/other_user}",
      "gists_url": "https://api.github.com/users/meshcollider/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
      "organizations_url": "https://api.github.com/users/meshcollider/orgs",
      "repos_url": "https://api.github.com/users/meshcollider/repos",
      "events_url": "https://api.github.com/users/meshcollider/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meshcollider/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "16ccb3a1cd9125eb24a5b45a98099ff98660767a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/16ccb3a1cd9125eb24a5b45a98099ff98660767a",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/16ccb3a1cd9125eb24a5b45a98099ff98660767a"
      }
    ],
    "stats": {
      "total": 28,
      "additions": 28,
      "deletions": 0
    },
    "files": [
      {
        "sha": "002029d81f4c8068b6db0ff9918d58847edb6824",
        "filename": "src/wallet/rpcwallet.cpp",
        "status": "modified",
        "additions": 28,
        "deletions": 0,
        "changes": 28,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/22cc797ca5c1e70a4afb8e43f6917b4c9fe74e20/src/wallet/rpcwallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/22cc797ca5c1e70a4afb8e43f6917b4c9fe74e20/src/wallet/rpcwallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcwallet.cpp?ref=22cc797ca5c1e70a4afb8e43f6917b4c9fe74e20",
        "patch": "@@ -1892,6 +1892,33 @@ static RPCHelpMan keypoolrefill()\n }\n \n \n+static RPCHelpMan newkeypool()\n+{\n+    return RPCHelpMan{\"newkeypool\",\n+                \"\\nEntirely clears and refills the keypool.\"+\n+            HELP_REQUIRING_PASSPHRASE,\n+                {},\n+                RPCResult{RPCResult::Type::NONE, \"\", \"\"},\n+                RPCExamples{\n+            HelpExampleCli(\"newkeypool\", \"\")\n+            + HelpExampleRpc(\"newkeypool\", \"\")\n+                },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    std::shared_ptr<CWallet> const pwallet = GetWalletForJSONRPCRequest(request);\n+    if (!pwallet) return NullUniValue;\n+\n+    LOCK(pwallet->cs_wallet);\n+\n+    LegacyScriptPubKeyMan& spk_man = EnsureLegacyScriptPubKeyMan(*pwallet, true);\n+    spk_man.NewKeyPool();\n+\n+    return NullUniValue;\n+},\n+    };\n+}\n+\n+\n static RPCHelpMan walletpassphrase()\n {\n     return RPCHelpMan{\"walletpassphrase\",\n@@ -4773,6 +4800,7 @@ static const CRPCCommand commands[] =\n     { \"wallet\",             &listwallets,                    },\n     { \"wallet\",             &loadwallet,                     },\n     { \"wallet\",             &lockunspent,                    },\n+    { \"wallet\",             &newkeypool,                     },\n     { \"wallet\",             &removeprunedfunds,              },\n     { \"wallet\",             &rescanblockchain,               },\n     { \"wallet\",             &send,                           },"
      }
    ]
  },
  {
    "sha": "2434b1078147e71b09c4c1bf0b7ce3f6729a7713",
    "node_id": "C_kwDOABII59oAKDI0MzRiMTA3ODE0N2U3MWIwOWM0YzFiZjBiN2NlM2Y2NzI5YTc3MTM",
    "commit": {
      "author": {
        "name": "Samuel Dobson",
        "email": "dobsonsa68@gmail.com",
        "date": "2021-09-25T22:37:53Z"
      },
      "committer": {
        "name": "Samuel Dobson",
        "email": "dobsonsa68@gmail.com",
        "date": "2021-09-26T01:57:07Z"
      },
      "message": "Fix outdated keypool size default",
      "tree": {
        "sha": "ef574fcdf31cf174aad0ce48cfc5fbff72f1101d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ef574fcdf31cf174aad0ce48cfc5fbff72f1101d"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2434b1078147e71b09c4c1bf0b7ce3f6729a7713",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2434b1078147e71b09c4c1bf0b7ce3f6729a7713",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/2434b1078147e71b09c4c1bf0b7ce3f6729a7713",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2434b1078147e71b09c4c1bf0b7ce3f6729a7713/comments",
    "author": {
      "login": "meshcollider",
      "id": 3211283,
      "node_id": "MDQ6VXNlcjMyMTEyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3211283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meshcollider",
      "html_url": "https://github.com/meshcollider",
      "followers_url": "https://api.github.com/users/meshcollider/followers",
      "following_url": "https://api.github.com/users/meshcollider/following{/other_user}",
      "gists_url": "https://api.github.com/users/meshcollider/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
      "organizations_url": "https://api.github.com/users/meshcollider/orgs",
      "repos_url": "https://api.github.com/users/meshcollider/repos",
      "events_url": "https://api.github.com/users/meshcollider/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meshcollider/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "meshcollider",
      "id": 3211283,
      "node_id": "MDQ6VXNlcjMyMTEyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3211283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meshcollider",
      "html_url": "https://github.com/meshcollider",
      "followers_url": "https://api.github.com/users/meshcollider/followers",
      "following_url": "https://api.github.com/users/meshcollider/following{/other_user}",
      "gists_url": "https://api.github.com/users/meshcollider/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
      "organizations_url": "https://api.github.com/users/meshcollider/orgs",
      "repos_url": "https://api.github.com/users/meshcollider/repos",
      "events_url": "https://api.github.com/users/meshcollider/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meshcollider/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "22cc797ca5c1e70a4afb8e43f6917b4c9fe74e20",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/22cc797ca5c1e70a4afb8e43f6917b4c9fe74e20",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/22cc797ca5c1e70a4afb8e43f6917b4c9fe74e20"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 1,
      "deletions": 1
    },
    "files": [
      {
        "sha": "bc29da82ac4b71651f4f63bcb683b70de07a2612",
        "filename": "src/wallet/rpcwallet.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2434b1078147e71b09c4c1bf0b7ce3f6729a7713/src/wallet/rpcwallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2434b1078147e71b09c4c1bf0b7ce3f6729a7713/src/wallet/rpcwallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcwallet.cpp?ref=2434b1078147e71b09c4c1bf0b7ce3f6729a7713",
        "patch": "@@ -1853,7 +1853,7 @@ static RPCHelpMan keypoolrefill()\n                 \"\\nFills the keypool.\"+\n         HELP_REQUIRING_PASSPHRASE,\n                 {\n-                    {\"newsize\", RPCArg::Type::NUM, RPCArg::Default{100}, \"The new keypool size\"},\n+                    {\"newsize\", RPCArg::Type::NUM, RPCArg::DefaultHint{strprintf(\"%u, or as set by -keypool\", DEFAULT_KEYPOOL_SIZE)}, \"The new keypool size\"},\n                 },\n                 RPCResult{RPCResult::Type::NONE, \"\", \"\"},\n                 RPCExamples{"
      }
    ]
  },
  {
    "sha": "6f6f7bb36c492fa76aeda6513be58ca822ea1968",
    "node_id": "C_kwDOABII59oAKDZmNmY3YmIzNmM0OTJmYTc2YWVkYTY1MTNiZTU4Y2E4MjJlYTE5Njg",
    "commit": {
      "author": {
        "name": "Samuel Dobson",
        "email": "dobsonsa68@gmail.com",
        "date": "2021-09-25T23:00:35Z"
      },
      "committer": {
        "name": "Samuel Dobson",
        "email": "dobsonsa68@gmail.com",
        "date": "2021-09-26T02:35:54Z"
      },
      "message": "Make legacy wallet upgrades from non-HD to HD always flush the keypool",
      "tree": {
        "sha": "b56bf520fca3425dd1409e13c8415f91ca618991",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b56bf520fca3425dd1409e13c8415f91ca618991"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6f6f7bb36c492fa76aeda6513be58ca822ea1968",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6f6f7bb36c492fa76aeda6513be58ca822ea1968",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/6f6f7bb36c492fa76aeda6513be58ca822ea1968",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6f6f7bb36c492fa76aeda6513be58ca822ea1968/comments",
    "author": {
      "login": "meshcollider",
      "id": 3211283,
      "node_id": "MDQ6VXNlcjMyMTEyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3211283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meshcollider",
      "html_url": "https://github.com/meshcollider",
      "followers_url": "https://api.github.com/users/meshcollider/followers",
      "following_url": "https://api.github.com/users/meshcollider/following{/other_user}",
      "gists_url": "https://api.github.com/users/meshcollider/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
      "organizations_url": "https://api.github.com/users/meshcollider/orgs",
      "repos_url": "https://api.github.com/users/meshcollider/repos",
      "events_url": "https://api.github.com/users/meshcollider/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meshcollider/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "meshcollider",
      "id": 3211283,
      "node_id": "MDQ6VXNlcjMyMTEyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3211283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meshcollider",
      "html_url": "https://github.com/meshcollider",
      "followers_url": "https://api.github.com/users/meshcollider/followers",
      "following_url": "https://api.github.com/users/meshcollider/following{/other_user}",
      "gists_url": "https://api.github.com/users/meshcollider/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
      "organizations_url": "https://api.github.com/users/meshcollider/orgs",
      "repos_url": "https://api.github.com/users/meshcollider/repos",
      "events_url": "https://api.github.com/users/meshcollider/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meshcollider/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "2434b1078147e71b09c4c1bf0b7ce3f6729a7713",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2434b1078147e71b09c4c1bf0b7ce3f6729a7713",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/2434b1078147e71b09c4c1bf0b7ce3f6729a7713"
      }
    ],
    "stats": {
      "total": 18,
      "additions": 3,
      "deletions": 15
    },
    "files": [
      {
        "sha": "0840336831779468c8e43ea769f72c481d431baa",
        "filename": "src/wallet/scriptpubkeyman.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6f6f7bb36c492fa76aeda6513be58ca822ea1968/src/wallet/scriptpubkeyman.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6f6f7bb36c492fa76aeda6513be58ca822ea1968/src/wallet/scriptpubkeyman.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/scriptpubkeyman.cpp?ref=6f6f7bb36c492fa76aeda6513be58ca822ea1968",
        "patch": "@@ -489,7 +489,7 @@ bool LegacyScriptPubKeyMan::Upgrade(int prev_version, int new_version, bilingual\n     }\n     // Regenerate the keypool if upgraded to HD\n     if (hd_upgrade) {\n-        if (!TopUp()) {\n+        if (!NewKeyPool()) {\n             error = _(\"Unable to generate keys\");\n             return false;\n         }"
      },
      {
        "sha": "917293ea8c0d657b49f06998e8baddd97fedd108",
        "filename": "test/functional/wallet_upgradewallet.py",
        "status": "modified",
        "additions": 2,
        "deletions": 14,
        "changes": 16,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6f6f7bb36c492fa76aeda6513be58ca822ea1968/test/functional/wallet_upgradewallet.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6f6f7bb36c492fa76aeda6513be58ca822ea1968/test/functional/wallet_upgradewallet.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/wallet_upgradewallet.py?ref=6f6f7bb36c492fa76aeda6513be58ca822ea1968",
        "patch": "@@ -235,12 +235,7 @@ def copy_split_hd():\n         seed_id = bytearray(seed_id)\n         seed_id.reverse()\n         old_kvs = new_kvs\n-        # First 2 keys should still be non-HD\n-        for i in range(0, 2):\n-            info = wallet.getaddressinfo(wallet.getnewaddress())\n-            assert 'hdkeypath' not in info\n-            assert 'hdseedid' not in info\n-        # Next key should be HD\n+        # New keys should be HD (the two old keys have been flushed)\n         info = wallet.getaddressinfo(wallet.getnewaddress())\n         assert_equal(seed_id.hex(), info['hdseedid'])\n         assert_equal('m/0\\'/0\\'/0\\'', info['hdkeypath'])\n@@ -291,14 +286,7 @@ def copy_split_hd():\n         hd_chain_version, external_counter, seed_id, internal_counter = struct.unpack('<iI20sI', hd_chain)\n         assert_equal(2, hd_chain_version)\n         assert_equal(2, internal_counter)\n-        # Drain the keypool by fetching one external key and one change key. Should still be the same keypool\n-        info = wallet.getaddressinfo(wallet.getnewaddress())\n-        assert 'hdseedid' not in info\n-        assert 'hdkeypath' not in info\n-        info = wallet.getaddressinfo(wallet.getrawchangeaddress())\n-        assert 'hdseedid' not in info\n-        assert 'hdkeypath' not in info\n-        # The next addresses are HD and should be on different HD chains\n+        # The next addresses are HD and should be on different HD chains (the one remaining key in each pool should have been flushed)\n         info = wallet.getaddressinfo(wallet.getnewaddress())\n         ext_id = info['hdseedid']\n         assert_equal('m/0\\'/0\\'/0\\'', info['hdkeypath'])"
      }
    ]
  },
  {
    "sha": "f9603ee4e05d7f0bd7d81f5cf24168c1aec8e5b0",
    "node_id": "C_kwDOABII59oAKGY5NjAzZWU0ZTA1ZDdmMGJkN2Q4MWY1Y2YyNDE2OGMxYWVjOGU1YjA",
    "commit": {
      "author": {
        "name": "Samuel Dobson",
        "email": "dobsonsa68@gmail.com",
        "date": "2021-09-26T00:43:55Z"
      },
      "committer": {
        "name": "Samuel Dobson",
        "email": "dobsonsa68@gmail.com",
        "date": "2021-09-26T02:35:54Z"
      },
      "message": "Add test for flushing keypool with newkeypool",
      "tree": {
        "sha": "18ec06ff38aacaef5f5d0f104b3eb32da8f63946",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/18ec06ff38aacaef5f5d0f104b3eb32da8f63946"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f9603ee4e05d7f0bd7d81f5cf24168c1aec8e5b0",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f9603ee4e05d7f0bd7d81f5cf24168c1aec8e5b0",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/f9603ee4e05d7f0bd7d81f5cf24168c1aec8e5b0",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f9603ee4e05d7f0bd7d81f5cf24168c1aec8e5b0/comments",
    "author": {
      "login": "meshcollider",
      "id": 3211283,
      "node_id": "MDQ6VXNlcjMyMTEyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3211283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meshcollider",
      "html_url": "https://github.com/meshcollider",
      "followers_url": "https://api.github.com/users/meshcollider/followers",
      "following_url": "https://api.github.com/users/meshcollider/following{/other_user}",
      "gists_url": "https://api.github.com/users/meshcollider/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
      "organizations_url": "https://api.github.com/users/meshcollider/orgs",
      "repos_url": "https://api.github.com/users/meshcollider/repos",
      "events_url": "https://api.github.com/users/meshcollider/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meshcollider/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "meshcollider",
      "id": 3211283,
      "node_id": "MDQ6VXNlcjMyMTEyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3211283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meshcollider",
      "html_url": "https://github.com/meshcollider",
      "followers_url": "https://api.github.com/users/meshcollider/followers",
      "following_url": "https://api.github.com/users/meshcollider/following{/other_user}",
      "gists_url": "https://api.github.com/users/meshcollider/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
      "organizations_url": "https://api.github.com/users/meshcollider/orgs",
      "repos_url": "https://api.github.com/users/meshcollider/repos",
      "events_url": "https://api.github.com/users/meshcollider/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meshcollider/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "6f6f7bb36c492fa76aeda6513be58ca822ea1968",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6f6f7bb36c492fa76aeda6513be58ca822ea1968",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/6f6f7bb36c492fa76aeda6513be58ca822ea1968"
      }
    ],
    "stats": {
      "total": 10,
      "additions": 10,
      "deletions": 0
    },
    "files": [
      {
        "sha": "627a75085095eaeab73af22daae3741b412c4953",
        "filename": "test/functional/wallet_keypool.py",
        "status": "modified",
        "additions": 10,
        "deletions": 0,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f9603ee4e05d7f0bd7d81f5cf24168c1aec8e5b0/test/functional/wallet_keypool.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f9603ee4e05d7f0bd7d81f5cf24168c1aec8e5b0/test/functional/wallet_keypool.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/wallet_keypool.py?ref=f9603ee4e05d7f0bd7d81f5cf24168c1aec8e5b0",
        "patch": "@@ -138,6 +138,16 @@ def run_test(self):\n             assert_equal(wi['keypoolsize_hd_internal'], 100)\n             assert_equal(wi['keypoolsize'], 100)\n \n+        if not self.options.descriptors:\n+            # Check that newkeypool entirely flushes the keypool\n+            start_keypath = nodes[0].getaddressinfo(nodes[0].getnewaddress())['hdkeypath']\n+            nodes[0].newkeypool()\n+            end_keypath = nodes[0].getaddressinfo(nodes[0].getnewaddress())['hdkeypath']\n+            # The new keypath index should be 100 more than the old one\n+            keypath_prefix = start_keypath.rsplit('/',  1)[0]\n+            new_index = int(start_keypath.rsplit('/',  1)[1][:-1]) + 100\n+            assert_equal(end_keypath, keypath_prefix + '/' + str(new_index) + '\\'')\n+\n         # create a blank wallet\n         nodes[0].createwallet(wallet_name='w2', blank=True, disable_private_keys=True)\n         w2 = nodes[0].get_wallet_rpc('w2')"
      }
    ]
  },
  {
    "sha": "84fa19c77a2c8d0d01add2daf18b42af07c17710",
    "node_id": "C_kwDOABII59oAKDg0ZmExOWM3N2EyYzhkMGQwMWFkZDJkYWYxOGI0MmFmMDdjMTc3MTA",
    "commit": {
      "author": {
        "name": "Samuel Dobson",
        "email": "dobsonsa68@gmail.com",
        "date": "2021-09-25T12:07:14Z"
      },
      "committer": {
        "name": "Samuel Dobson",
        "email": "dobsonsa68@gmail.com",
        "date": "2021-09-26T02:35:54Z"
      },
      "message": "Add release notes for keypool flush changes",
      "tree": {
        "sha": "df933120bf5a0c921f65d980b202d373c05568f0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/df933120bf5a0c921f65d980b202d373c05568f0"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/84fa19c77a2c8d0d01add2daf18b42af07c17710",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/84fa19c77a2c8d0d01add2daf18b42af07c17710",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/84fa19c77a2c8d0d01add2daf18b42af07c17710",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/84fa19c77a2c8d0d01add2daf18b42af07c17710/comments",
    "author": {
      "login": "meshcollider",
      "id": 3211283,
      "node_id": "MDQ6VXNlcjMyMTEyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3211283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meshcollider",
      "html_url": "https://github.com/meshcollider",
      "followers_url": "https://api.github.com/users/meshcollider/followers",
      "following_url": "https://api.github.com/users/meshcollider/following{/other_user}",
      "gists_url": "https://api.github.com/users/meshcollider/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
      "organizations_url": "https://api.github.com/users/meshcollider/orgs",
      "repos_url": "https://api.github.com/users/meshcollider/repos",
      "events_url": "https://api.github.com/users/meshcollider/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meshcollider/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "meshcollider",
      "id": 3211283,
      "node_id": "MDQ6VXNlcjMyMTEyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3211283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meshcollider",
      "html_url": "https://github.com/meshcollider",
      "followers_url": "https://api.github.com/users/meshcollider/followers",
      "following_url": "https://api.github.com/users/meshcollider/following{/other_user}",
      "gists_url": "https://api.github.com/users/meshcollider/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
      "organizations_url": "https://api.github.com/users/meshcollider/orgs",
      "repos_url": "https://api.github.com/users/meshcollider/repos",
      "events_url": "https://api.github.com/users/meshcollider/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meshcollider/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "f9603ee4e05d7f0bd7d81f5cf24168c1aec8e5b0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f9603ee4e05d7f0bd7d81f5cf24168c1aec8e5b0",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/f9603ee4e05d7f0bd7d81f5cf24168c1aec8e5b0"
      }
    ],
    "stats": {
      "total": 11,
      "additions": 11,
      "deletions": 0
    },
    "files": [
      {
        "sha": "68fbaec53c5192300e52064e10093b6fba32afac",
        "filename": "doc/release-notes-23093.md",
        "status": "added",
        "additions": 11,
        "deletions": 0,
        "changes": 11,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/84fa19c77a2c8d0d01add2daf18b42af07c17710/doc/release-notes-23093.md",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/84fa19c77a2c8d0d01add2daf18b42af07c17710/doc/release-notes-23093.md",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/doc/release-notes-23093.md?ref=84fa19c77a2c8d0d01add2daf18b42af07c17710",
        "patch": "@@ -0,0 +1,11 @@\n+Notable changes\n+===============\n+\n+Updated RPCs\n+------------\n+\n+- `upgradewallet` will now automatically flush the keypool if upgrading\n+from a non-HD wallet to an HD wallet, to immediately start using the\n+newly-generated HD keys.\n+- a new RPC `newkeypool` has been added, which will flush (entirely\n+clear and refill) the keypool."
      }
    ]
  },
  {
    "sha": "6531599f422524fbbcc43816121e7536cf79d66c",
    "node_id": "C_kwDOABII59oAKDY1MzE1OTlmNDIyNTI0ZmJiY2M0MzgxNjEyMWU3NTM2Y2Y3OWQ2NmM",
    "commit": {
      "author": {
        "name": "Samuel Dobson",
        "email": "dobsonsa68@gmail.com",
        "date": "2021-10-14T03:52:59Z"
      },
      "committer": {
        "name": "Samuel Dobson",
        "email": "dobsonsa68@gmail.com",
        "date": "2021-10-14T03:52:59Z"
      },
      "message": "test: Add check that newkeypool flushes change addresses too",
      "tree": {
        "sha": "178cbef277746f579c1b901ff232d36b54d73861",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/178cbef277746f579c1b901ff232d36b54d73861"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6531599f422524fbbcc43816121e7536cf79d66c",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6531599f422524fbbcc43816121e7536cf79d66c",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/6531599f422524fbbcc43816121e7536cf79d66c",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6531599f422524fbbcc43816121e7536cf79d66c/comments",
    "author": {
      "login": "meshcollider",
      "id": 3211283,
      "node_id": "MDQ6VXNlcjMyMTEyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3211283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meshcollider",
      "html_url": "https://github.com/meshcollider",
      "followers_url": "https://api.github.com/users/meshcollider/followers",
      "following_url": "https://api.github.com/users/meshcollider/following{/other_user}",
      "gists_url": "https://api.github.com/users/meshcollider/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
      "organizations_url": "https://api.github.com/users/meshcollider/orgs",
      "repos_url": "https://api.github.com/users/meshcollider/repos",
      "events_url": "https://api.github.com/users/meshcollider/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meshcollider/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "meshcollider",
      "id": 3211283,
      "node_id": "MDQ6VXNlcjMyMTEyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3211283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meshcollider",
      "html_url": "https://github.com/meshcollider",
      "followers_url": "https://api.github.com/users/meshcollider/followers",
      "following_url": "https://api.github.com/users/meshcollider/following{/other_user}",
      "gists_url": "https://api.github.com/users/meshcollider/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
      "organizations_url": "https://api.github.com/users/meshcollider/orgs",
      "repos_url": "https://api.github.com/users/meshcollider/repos",
      "events_url": "https://api.github.com/users/meshcollider/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meshcollider/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "84fa19c77a2c8d0d01add2daf18b42af07c17710",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/84fa19c77a2c8d0d01add2daf18b42af07c17710",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/84fa19c77a2c8d0d01add2daf18b42af07c17710"
      }
    ],
    "stats": {
      "total": 14,
      "additions": 9,
      "deletions": 5
    },
    "files": [
      {
        "sha": "79235646b094ea4346e0b1c444b76c39fafa49ee",
        "filename": "test/functional/wallet_keypool.py",
        "status": "modified",
        "additions": 6,
        "deletions": 2,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6531599f422524fbbcc43816121e7536cf79d66c/test/functional/wallet_keypool.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6531599f422524fbbcc43816121e7536cf79d66c/test/functional/wallet_keypool.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/wallet_keypool.py?ref=6531599f422524fbbcc43816121e7536cf79d66c",
        "patch": "@@ -141,12 +141,16 @@ def run_test(self):\n         if not self.options.descriptors:\n             # Check that newkeypool entirely flushes the keypool\n             start_keypath = nodes[0].getaddressinfo(nodes[0].getnewaddress())['hdkeypath']\n+            start_change_keypath = nodes[0].getaddressinfo(nodes[0].getrawchangeaddress())['hdkeypath']\n+            # flush keypool and get new addresses\n             nodes[0].newkeypool()\n             end_keypath = nodes[0].getaddressinfo(nodes[0].getnewaddress())['hdkeypath']\n+            end_change_keypath = nodes[0].getaddressinfo(nodes[0].getrawchangeaddress())['hdkeypath']\n             # The new keypath index should be 100 more than the old one\n-            keypath_prefix = start_keypath.rsplit('/',  1)[0]\n             new_index = int(start_keypath.rsplit('/',  1)[1][:-1]) + 100\n-            assert_equal(end_keypath, keypath_prefix + '/' + str(new_index) + '\\'')\n+            new_change_index = int(start_change_keypath.rsplit('/',  1)[1][:-1]) + 100\n+            assert_equal(end_keypath, \"m/0'/0'/\" + str(new_index) + \"'\")\n+            assert_equal(end_change_keypath, \"m/0'/1'/\" + str(new_change_index) + \"'\")\n \n         # create a blank wallet\n         nodes[0].createwallet(wallet_name='w2', blank=True, disable_private_keys=True)"
      },
      {
        "sha": "5800880830d6377618894572e12c1b5019c70765",
        "filename": "test/functional/wallet_upgradewallet.py",
        "status": "modified",
        "additions": 3,
        "deletions": 3,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6531599f422524fbbcc43816121e7536cf79d66c/test/functional/wallet_upgradewallet.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6531599f422524fbbcc43816121e7536cf79d66c/test/functional/wallet_upgradewallet.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/wallet_upgradewallet.py?ref=6531599f422524fbbcc43816121e7536cf79d66c",
        "patch": "@@ -234,13 +234,13 @@ def copy_split_hd():\n         assert_equal(1, hd_chain_version)\n         seed_id = bytearray(seed_id)\n         seed_id.reverse()\n-        old_kvs = new_kvs\n-        # New keys should be HD (the two old keys have been flushed)\n+\n+        # New keys (including change) should be HD (the two old keys have been flushed)\n         info = wallet.getaddressinfo(wallet.getnewaddress())\n         assert_equal(seed_id.hex(), info['hdseedid'])\n         assert_equal('m/0\\'/0\\'/0\\'', info['hdkeypath'])\n         prev_seed_id = info['hdseedid']\n-        # Change key should be the same keypool\n+        # Change key should be HD and from the same keypool\n         info = wallet.getaddressinfo(wallet.getrawchangeaddress())\n         assert_equal(prev_seed_id, info['hdseedid'])\n         assert_equal('m/0\\'/0\\'/1\\'', info['hdkeypath'])"
      }
    ]
  }
]