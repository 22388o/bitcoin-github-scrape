achow101,2021-09-25 16:47:27,"I would really prefer that we just add a new parameter rather overloading `newsize` with special behavior for `0`. `newsize=0` should really just do nothing rather than be special behavior.\n\nInstead of checking the versions and then calling `NewKeyPool`, it would be simpler and more robust to replace the [`TopUp` call](https://github.com/bitcoin/bitcoin/blob/master/src/wallet/scriptpubkeyman.c",https://github.com/bitcoin/bitcoin/pull/23093#issuecomment-927149995,927149995,
meshcollider,2021-09-25 19:13:18,"@achow101 Sure, do you think the option should default to flushing or not though?",https://github.com/bitcoin/bitcoin/pull/23093#issuecomment-927170163,927170163,
achow101,2021-09-25 19:16:59,"I would prefer to keep the existing behavior as default, so default to not flushing.\n\nEdit: Discussed briefly on IRC, flushing after upgrading to HD is fine. Flushing after every upgrade is not IMO.",https://github.com/bitcoin/bitcoin/pull/23093#issuecomment-927170628,927170628,
katesalazar,2021-09-25 21:14:05,"> There is currently no easy way to flush the keypool other than to call getnewaddress a hundred times or an ugly hack of using a sethdseed call.\n\nhttps://github.com/bitcoin/bitcoin/pull/10831\n\nA thousand times.\n",https://github.com/bitcoin/bitcoin/pull/23093#issuecomment-927183713,927183713,
achow101,2021-09-26 04:52:50,ACK 84fa19c77a2c8d0d01add2daf18b42af07c17710,https://github.com/bitcoin/bitcoin/pull/23093#issuecomment-927231405,927231405,
laanwj,2021-09-27 11:42:26,"> Edit: Discussed briefly on IRC, flushing after upgrading to HD is fine. Flushing after every upgrade is not IMO.\n\nAgree; only once, so that users upgrading can use the new address tyeps. Definitely not for every upgrade.",https://github.com/bitcoin/bitcoin/pull/23093#issuecomment-927791953,927791953,
meshcollider,2021-09-27 12:18:06,"> Agree; only once, so that users upgrading can use the new address tyeps. Definitely not for every upgrade.\n\n👍  (note this is already the behaviour in this PR)",https://github.com/bitcoin/bitcoin/pull/23093#issuecomment-927818017,927818017,
laanwj,2021-09-28 14:40:27,"> +1 (note this is already the behaviour in this PR)\n\nConcept ACK then!",https://github.com/bitcoin/bitcoin/pull/23093#issuecomment-929295764,929295764,
laanwj,2021-10-13 13:49:32,"Code review ACK 84fa19c77a2c8d0d01add2daf18b42af07c17710\n\nre-ACK 6531599f422524fbbcc43816121e7536cf79d66c",https://github.com/bitcoin/bitcoin/pull/23093#issuecomment-942327758,942327758,
instagibbs,2021-10-14 02:22:12,"I'd like coverage of change addresses being flushed and the rewording, otherwise looks correct to me",https://github.com/bitcoin/bitcoin/pull/23093#issuecomment-942887132,942887132,
prayank23,2021-10-14 03:44:32,Concept ACK,https://github.com/bitcoin/bitcoin/pull/23093#issuecomment-942918943,942918943,
meshcollider,2021-10-14 03:55:49,"Added new commit 6531599f422524fbbcc43816121e7536cf79d66c to avoid invalidating previous ACKs.\n\nNew commit adds test that `newkeypool` flushes change addresses too.",https://github.com/bitcoin/bitcoin/pull/23093#issuecomment-942922615,942922615,
harding,2021-10-18 04:18:28,"Sorry for the late comment, but I'm curious about the impact of using the `newkeypool` RPC when it comes to wallet recovery.  If Alice creates a new wallet, backs up the wallet, runs `newkeypool`, runs `getnewaddress`, receives a payment to that address, and then recovers from the earlier wallet backup, will rescanning find the previously received payment?  What if she runs `newkeypool` twice in a",https://github.com/bitcoin/bitcoin/pull/23093#issuecomment-945350003,945350003,
meshcollider,2021-10-23 01:39:29,@harding added in #23341. Thanks for pointing this out.,https://github.com/bitcoin/bitcoin/pull/23093#issuecomment-950037016,950037016,
laanwj,2021-09-28 14:43:07,"We might want to be precise in documenting what ""clears"" means. I understand the keys will not be dealed out anymore by `getnewaddress`. But what happens to the keys in the old keypool? Are they deleted from the wallet, or still considered for incoming transactions? (I guess the latter)",https://github.com/bitcoin/bitcoin/pull/23093#discussion_r717653465,717653465,src/wallet/rpcwallet.cpp
katesalazar,2021-09-28 15:42:44,"> what happens to the keys in the old keypool? Are they deleted from the wallet, or still considered for incoming transactions? (I guess the latter)\n\nFWIW; if the keys in the pool, not extracted using `getnewaddress`, can be queried using some wallet software other than Core, then concept NACK to make it the default behavior (I think I've read that was going to be the topic of a different futu",https://github.com/bitcoin/bitcoin/pull/23093#discussion_r717711444,717711444,src/wallet/rpcwallet.cpp
meshcollider,2021-09-28 20:49:06,"@laanwj they're marked as used and remain stored but won't be returned from getnewaddress. I'll try and improve the helptext.\n\n@katesalazar I'm not sure what you mean about other software retrieving them - do you mean another piece of software that opens Core wallet.dat files? Otherwise no, without opening the wallet file there is no way an external program could ""guess"" what the addresses wer",https://github.com/bitcoin/bitcoin/pull/23093#discussion_r717952756,717952756,src/wallet/rpcwallet.cpp
katesalazar,2021-09-29 13:27:01,"> do you mean another piece of software that opens Core wallet.dat files?\n\nyea",https://github.com/bitcoin/bitcoin/pull/23093#discussion_r718511968,718511968,src/wallet/rpcwallet.cpp
sipa,2021-09-29 13:54:06,"@katesalazar Perhaps I'm not understanding you, because I don't see the relevance.\n\nFor context, Bitcoin Core wallets distinguish between the set of addresses/keys that are considered part of the wallet (i.e., transactions to them will be treated as incoming payments), and addresses that are given out as new addresses for receiving.\n\nWhat this PR does is permit refreshing the new addresses",https://github.com/bitcoin/bitcoin/pull/23093#discussion_r718539526,718539526,src/wallet/rpcwallet.cpp
katesalazar,2021-09-29 17:49:58,"OK, I understand Samuel better now. Thanks.\n",https://github.com/bitcoin/bitcoin/pull/23093#discussion_r718753359,718753359,src/wallet/rpcwallet.cpp
instagibbs,2021-10-14 02:17:16,"I think ""consumes"" is clearer than ""clears"".",https://github.com/bitcoin/bitcoin/pull/23093#discussion_r728578985,728578985,src/wallet/rpcwallet.cpp
instagibbs,2021-10-14 02:20:43,do we test that change addresses have also flushed?,https://github.com/bitcoin/bitcoin/pull/23093#discussion_r728580081,728580081,test/functional/wallet_upgradewallet.py
instagibbs,2021-10-14 02:21:03,let's test for change address flushing too ,https://github.com/bitcoin/bitcoin/pull/23093#discussion_r728580179,728580179,test/functional/wallet_keypool.py
meshcollider,2021-10-14 03:56:31,Done,https://github.com/bitcoin/bitcoin/pull/23093#discussion_r728615965,728615965,test/functional/wallet_keypool.py
meshcollider,2021-10-14 03:56:42,"Yep, clarified comment :)",https://github.com/bitcoin/bitcoin/pull/23093#discussion_r728616014,728616014,test/functional/wallet_upgradewallet.py
