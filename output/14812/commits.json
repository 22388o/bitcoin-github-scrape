[
  {
    "sha": "0cf1632f03cec7ab1f2bfc83315d52ea06c210be",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzowY2YxNjMyZjAzY2VjN2FiMWYyYmZjODMzMTVkNTJlYTA2YzIxMGJl",
    "commit": {
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@gmail.com",
        "date": "2018-11-26T20:14:03Z"
      },
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@gmail.com",
        "date": "2018-11-26T20:14:03Z"
      },
      "message": "qa: fix p2p_invalid_messages on macOS",
      "tree": {
        "sha": "6a1539e8b3915e0ab37a9f43d8a29147ec734407",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6a1539e8b3915e0ab37a9f43d8a29147ec734407"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0cf1632f03cec7ab1f2bfc83315d52ea06c210be",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0cf1632f03cec7ab1f2bfc83315d52ea06c210be",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/0cf1632f03cec7ab1f2bfc83315d52ea06c210be",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0cf1632f03cec7ab1f2bfc83315d52ea06c210be/comments",
    "author": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "b5c3d7affc9890f13dbd2d13967238f798d984a3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b5c3d7affc9890f13dbd2d13967238f798d984a3",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/b5c3d7affc9890f13dbd2d13967238f798d984a3"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 1,
      "deletions": 1
    },
    "files": [
      {
        "sha": "7c99a3663718e6236ac3223d8f533f804b91f93e",
        "filename": "test/functional/p2p_invalid_messages.py",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/0cf1632f03cec7ab1f2bfc83315d52ea06c210be/test/functional/p2p_invalid_messages.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/0cf1632f03cec7ab1f2bfc83315d52ea06c210be/test/functional/p2p_invalid_messages.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/p2p_invalid_messages.py?ref=0cf1632f03cec7ab1f2bfc83315d52ea06c210be",
        "patch": "@@ -66,7 +66,7 @@ def run_test(self):\n         msg_at_size = msg_unrecognized(\"b\" * valid_data_limit)\n         assert len(msg_at_size.serialize()) == msg_limit\n \n-        with node.assert_memory_usage_stable(perc_increase_allowed=0.03):\n+        with node.assert_memory_usage_stable(perc_increase_allowed=0.5):\n             self.log.info(\n                 \"Sending a bunch of large, junk messages to test \"\n                 \"memory exhaustion. May take a bit...\")"
      }
    ]
  },
  {
    "sha": "5a1f57646b34e136051b08f295b6a59aa75241d9",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1YTFmNTc2NDZiMzRlMTM2MDUxYjA4ZjI5NWI2YTU5YWE3NTI0MWQ5",
    "commit": {
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@gmail.com",
        "date": "2018-11-26T20:47:30Z"
      },
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@gmail.com",
        "date": "2018-11-26T20:47:30Z"
      },
      "message": "qa: clean up assert_memory_usage_stable utility",
      "tree": {
        "sha": "4067ecea1ece5cee0e7adbffd2d38466fdcfd292",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4067ecea1ece5cee0e7adbffd2d38466fdcfd292"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5a1f57646b34e136051b08f295b6a59aa75241d9",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5a1f57646b34e136051b08f295b6a59aa75241d9",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/5a1f57646b34e136051b08f295b6a59aa75241d9",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5a1f57646b34e136051b08f295b6a59aa75241d9/comments",
    "author": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "0cf1632f03cec7ab1f2bfc83315d52ea06c210be",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0cf1632f03cec7ab1f2bfc83315d52ea06c210be",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/0cf1632f03cec7ab1f2bfc83315d52ea06c210be"
      }
    ],
    "stats": {
      "total": 18,
      "additions": 11,
      "deletions": 7
    },
    "files": [
      {
        "sha": "3ee67980a444e1947aa6c2912a216641043b14f6",
        "filename": "test/functional/p2p_invalid_messages.py",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5a1f57646b34e136051b08f295b6a59aa75241d9/test/functional/p2p_invalid_messages.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5a1f57646b34e136051b08f295b6a59aa75241d9/test/functional/p2p_invalid_messages.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/p2p_invalid_messages.py?ref=5a1f57646b34e136051b08f295b6a59aa75241d9",
        "patch": "@@ -66,7 +66,7 @@ def run_test(self):\n         msg_at_size = msg_unrecognized(\"b\" * valid_data_limit)\n         assert len(msg_at_size.serialize()) == msg_limit\n \n-        with node.assert_memory_usage_stable(perc_increase_allowed=0.5):\n+        with node.assert_memory_usage_stable(increase_allowed=0.5):\n             self.log.info(\n                 \"Sending a bunch of large, junk messages to test \"\n                 \"memory exhaustion. May take a bit...\")"
      },
      {
        "sha": "27f99c259c6809fee122c8edfbd2ba4c674f08ce",
        "filename": "test/functional/test_framework/test_node.py",
        "status": "modified",
        "additions": 10,
        "deletions": 6,
        "changes": 16,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5a1f57646b34e136051b08f295b6a59aa75241d9/test/functional/test_framework/test_node.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5a1f57646b34e136051b08f295b6a59aa75241d9/test/functional/test_framework/test_node.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/test_framework/test_node.py?ref=5a1f57646b34e136051b08f295b6a59aa75241d9",
        "patch": "@@ -115,7 +115,7 @@ def get_deterministic_priv_key(self):\n         ]\n         return PRIV_KEYS[self.index]\n \n-    def get_mem_rss(self):\n+    def get_mem_rss_kilobytes(self):\n         \"\"\"Get the memory usage (RSS) per `ps`.\n \n         Returns None if `ps` is unavailable.\n@@ -291,26 +291,30 @@ def assert_debug_log(self, expected_msgs):\n                     self._raise_assertion_error('Expected message \"{}\" does not partially match log:\\n\\n{}\\n\\n'.format(expected_msg, print_log))\n \n     @contextlib.contextmanager\n-    def assert_memory_usage_stable(self, perc_increase_allowed=0.03):\n+    def assert_memory_usage_stable(self, *, increase_allowed=0.03):\n         \"\"\"Context manager that allows the user to assert that a node's memory usage (RSS)\n         hasn't increased beyond some threshold percentage.\n+\n+        Args:\n+            increase_allowed (float): the fractional increase in memory allowed until failure;\n+                e.g. `0.12` for up to 12% increase allowed.\n         \"\"\"\n-        before_memory_usage = self.get_mem_rss()\n+        before_memory_usage = self.get_mem_rss_kilobytes()\n \n         yield\n \n-        after_memory_usage = self.get_mem_rss()\n+        after_memory_usage = self.get_mem_rss_kilobytes()\n \n         if not (before_memory_usage and after_memory_usage):\n             self.log.warning(\"Unable to detect memory usage (RSS) - skipping memory check.\")\n             return\n \n         perc_increase_memory_usage = (after_memory_usage / before_memory_usage) - 1\n \n-        if perc_increase_memory_usage > perc_increase_allowed:\n+        if perc_increase_memory_usage > increase_allowed:\n             self._raise_assertion_error(\n                 \"Memory usage increased over threshold of {:.3f}% from {} to {} ({:.3f}%)\".format(\n-                    perc_increase_allowed * 100, before_memory_usage, after_memory_usage,\n+                    increase_allowed * 100, before_memory_usage, after_memory_usage,\n                     perc_increase_memory_usage * 100))\n \n     def assert_start_raises_init_error(self, extra_args=None, expected_msg=None, match=ErrorMatch.FULL_TEXT, *args, **kwargs):"
      }
    ]
  }
]