gmaxwell,2016-07-05T20:50:41Z,"I observed a testnet node persistently stuck (even across restarts) in a case where its best header chain was invalid and the public network has a best valid chain with much more work than the invalid best header chain that I have, but it took more than one headers message to connect it.\n\nSuhas identified this PR as the probable cause, and on revert the node immediately became unstuck. Consideri",https://github.com/bitcoin/bitcoin/pull/8306#issuecomment-230599035,230599035,
sdaftuar,2016-07-05T22:07:04Z,utACK.  We should tag this for 0.13.0.\n,https://github.com/bitcoin/bitcoin/pull/8306#issuecomment-230617290,230617290,
pstratem,2016-07-05T23:28:47Z,"I ran into this problem, this fixed it.\n",https://github.com/bitcoin/bitcoin/pull/8306#issuecomment-230632503,230632503,
gmaxwell,2016-07-06T03:30:56Z,I've run into at least two people on IRC with this issue (in addition to Patrick).\n,https://github.com/bitcoin/bitcoin/pull/8306#issuecomment-230662871,230662871,
domob1812,2016-07-09T11:55:57Z,"Even if the issue my original patch fixed is rare in practice, I would like to see it fixed.  I understand that it is best to roll the change back after finding the issue now before the upcoming release, though.  Can I open an issue to track a ""fixed fix"" for 0.14?  Also, I do not yet fully understand how a node could become stuck with the patch even if it is on an invalid chain.  Does anyone have",https://github.com/bitcoin/bitcoin/pull/8306#issuecomment-231530775,231530775,
sdaftuar,2016-07-10T11:38:59Z,"@domob1812  One example: before reverting this patch, if there are two competing forks with tips A and B, and a node is at tip A and the fork point C between A and B is more than 2000 blocks in the past, and a node already has the first 2000 headers from C to B but no later ones, then it's possible that the hasHeaders check added by #8054 would prevent the node from ever learning about tip B, caus",https://github.com/bitcoin/bitcoin/pull/8306#issuecomment-231584578,231584578,
domob1812,2016-07-13T16:15:23Z,"Thanks @sdaftuar, makes sense.  I'll think about it.\n",https://github.com/bitcoin/bitcoin/pull/8306#issuecomment-232406467,232406467,
DeckerSU,2020-04-16T21:53:38Z,"@sdaftuar i know it's been a long time since initial patch, but how do you think, if we limit initial @domob1812 fix only to IBD, like:\n```\nbool hasNewHeaders = true;\nif (IsInitialBlockDownload()) {\n    hasNewHeaders = (mapBlockIndex.count(headers.back().GetHash()) == 0);\n}\n...\nif (nCount == MAX_HEADERS_RESULTS && pindexLast && hasNewHeaders) {\n...\n    pfrom->PushMessage(""gethead",https://github.com/bitcoin/bitcoin/pull/8306#issuecomment-614916454,614916454,
