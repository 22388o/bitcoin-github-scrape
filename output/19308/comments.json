[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/645675131",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19308#issuecomment-645675131",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19308",
    "id": 645675131,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0NTY3NTEzMQ==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-17T23:18:08Z",
    "updated_at": "2020-06-20T03:48:55Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19335 (wallet: Cleanup and separate BerkeleyDatabase and BerkeleyBatch by achow101)\n* #19334 (wallet: Introduce WalletDatabase abstract class by achow101)\n* #19325 (wallet: Refactor BerkeleyDatabase to introduce DatabaseBatch abstract class by achow101)\n* #19137 (wallettool: Add dump and createfromdump commands by achow101)\n* #19102 (wallet: Introduce and use DummyDatabase instead of dummy BerkeleyDatabase by achow101)\n* #18608 (refactor: Remove CAddressBookData::destdata by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/645675131/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646068957",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19308#issuecomment-646068957",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19308",
    "id": 646068957,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0NjA2ODk1Nw==",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-18T14:49:25Z",
    "updated_at": "2020-06-18T14:49:25Z",
    "author_association": "MEMBER",
    "body": "This does limit flexibility a bit, though I guess one cursor at a time is enough for all our current and future use cases.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646068957/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646075489",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19308#issuecomment-646075489",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19308",
    "id": 646075489,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0NjA3NTQ4OQ==",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?u=9791e96cd4268d48e3517bac41eaf2b1d09759fd&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-18T14:58:28Z",
    "updated_at": "2020-06-18T14:58:28Z",
    "author_association": "MEMBER",
    "body": "> This does limit flexibility a bit, though I guess one cursor at a time is enough for all our current and future use cases.\r\n\r\nIf another cursor was needed, you could use another Batch object. But we barely use cursors, so one is enough for now.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646075489/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646079286",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19308#issuecomment-646079286",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19308",
    "id": 646079286,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0NjA3OTI4Ng==",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-18T15:03:59Z",
    "updated_at": "2020-06-18T15:03:59Z",
    "author_association": "MEMBER",
    "body": "> If another cursor was needed, you could use another Batch object. But we barely use cursors, so one is enough for now.\r\n\r\nOhh! I missed that it's on the batch, not on the database object.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646079286/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442285323",
    "pull_request_review_id": 433361872,
    "id": 442285323,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI4NTMyMw==",
    "diff_hunk": "@@ -861,11 +863,15 @@ DBErrors WalletBatch::FindWalletTx(std::vector<uint256>& vTxHash, std::list<CWal\n             // Read next record\n             CDataStream ssKey(SER_DISK, CLIENT_VERSION);\n             CDataStream ssValue(SER_DISK, CLIENT_VERSION);\n-            int ret = m_batch.ReadAtCursor(pcursor, ssKey, ssValue);\n-            if (ret == DB_NOTFOUND)\n+            bool complete;\n+            bool ret = m_batch.ReadAtCursor(ssKey, ssValue, complete);\n+            if (complete) {\n+                m_batch.CloseCursor();\n                 break;\n-            else if (ret != 0)\n+            }",
    "path": "src/wallet/walletdb.cpp",
    "position": null,
    "original_position": 61,
    "commit_id": "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
    "original_commit_id": "40d31e31820bf2a6675d326d816e6da7b4dc714b",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Nit: coding style `} else if (!ret) {`",
    "created_at": "2020-06-18T14:48:40Z",
    "updated_at": "2020-06-22T19:43:38Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r442285323",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442285323"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r442285323"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442285323/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 871,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442290726",
    "pull_request_review_id": 433368972,
    "id": 442290726,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI5MDcyNg==",
    "diff_hunk": "@@ -738,27 +739,32 @@ void BerkeleyDatabase::ReloadDbEnv()\n     }\n }\n \n-Dbc* BerkeleyBatch::GetCursor()\n+bool BerkeleyBatch::CreateCursor()",
    "path": "src/wallet/bdb.cpp",
    "position": null,
    "original_position": 47,
    "commit_id": "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
    "original_commit_id": "40d31e31820bf2a6675d326d816e6da7b4dc714b",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think `StartCursor` would be a better name, after all, the whole process (including details like whether something is created) is internal.",
    "created_at": "2020-06-18T14:55:50Z",
    "updated_at": "2020-06-22T19:43:38Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r442290726",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442290726"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r442290726"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442290726/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 742,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442291942",
    "pull_request_review_id": 433370582,
    "id": 442291942,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI5MTk0Mg==",
    "diff_hunk": "@@ -861,11 +863,15 @@ DBErrors WalletBatch::FindWalletTx(std::vector<uint256>& vTxHash, std::list<CWal\n             // Read next record\n             CDataStream ssKey(SER_DISK, CLIENT_VERSION);\n             CDataStream ssValue(SER_DISK, CLIENT_VERSION);\n-            int ret = m_batch.ReadAtCursor(pcursor, ssKey, ssValue);\n-            if (ret == DB_NOTFOUND)\n+            bool complete;\n+            bool ret = m_batch.ReadAtCursor(ssKey, ssValue, complete);\n+            if (complete) {\n+                m_batch.CloseCursor();\n                 break;\n-            else if (ret != 0)\n+            }",
    "path": "src/wallet/walletdb.cpp",
    "position": null,
    "original_position": 61,
    "commit_id": "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
    "original_commit_id": "40d31e31820bf2a6675d326d816e6da7b4dc714b",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Fixed.",
    "created_at": "2020-06-18T14:57:28Z",
    "updated_at": "2020-06-22T19:43:38Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r442291942",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442291942"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r442291942"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442291942/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 871,
    "side": "RIGHT",
    "in_reply_to_id": 442285323
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442494190",
    "pull_request_review_id": 433636222,
    "id": 442494190,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ5NDE5MA==",
    "diff_hunk": "@@ -742,8 +745,8 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n             if (!strErr.empty())\n                 pwallet->WalletLogPrintf(\"%s\\n\", strErr);\n         }\n-        pcursor->close();",
    "path": "src/wallet/walletdb.cpp",
    "position": 32,
    "original_position": 33,
    "commit_id": "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
    "original_commit_id": "cda86544ae9de430e4558b87945046d5612202ac",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"walletdb: Handle cursor internally\" (cda86544ae9de430e4558b87945046d5612202ac)\r\n\r\nMinor: I think it'd be a little clearer to keep this close here as m_batch.CloseCursor() so it's more obvious cursor is closed in all cases, and so you don't need to add a new close call in a different place above.",
    "created_at": "2020-06-18T20:49:08Z",
    "updated_at": "2020-06-22T19:43:38Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r442494190",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442494190"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r442494190"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442494190/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 745,
    "original_line": 745,
    "side": "LEFT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443263535",
    "pull_request_review_id": 434538398,
    "id": 443263535,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI2MzUzNQ==",
    "diff_hunk": "@@ -738,27 +739,32 @@ void BerkeleyDatabase::ReloadDbEnv()\n     }\n }\n \n-Dbc* BerkeleyBatch::GetCursor()\n+bool BerkeleyBatch::CreateCursor()\n {\n+    assert(!m_cursor);\n     if (!pdb)\n-        return nullptr;\n-    Dbc* pcursor = nullptr;\n-    int ret = pdb->cursor(nullptr, &pcursor, 0);\n+        return false;\n+    int ret = pdb->cursor(nullptr, &m_cursor, 0);\n     if (ret != 0)\n-        return nullptr;\n-    return pcursor;\n+        return false;\n+    return true;",
    "path": "src/wallet/bdb.cpp",
    "position": null,
    "original_position": 60,
    "commit_id": "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
    "original_commit_id": "cda86544ae9de430e4558b87945046d5612202ac",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit, just `return ret == 0`.",
    "created_at": "2020-06-21T22:41:13Z",
    "updated_at": "2020-06-22T19:43:38Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443263535",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443263535"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443263535"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443263535/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 750,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443265733",
    "pull_request_review_id": 434538398,
    "id": 443265733,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI2NTczMw==",
    "diff_hunk": "@@ -742,8 +745,8 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n             if (!strErr.empty())\n                 pwallet->WalletLogPrintf(\"%s\\n\", strErr);\n         }\n-        pcursor->close();",
    "path": "src/wallet/walletdb.cpp",
    "position": 32,
    "original_position": 33,
    "commit_id": "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
    "original_commit_id": "cda86544ae9de430e4558b87945046d5612202ac",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "But above, in https://github.com/bitcoin/bitcoin/pull/19308/files#diff-e506682270036e4c8e0b8159a34b652dR723, it returns so it needs to be closed there, or am I missing something?",
    "created_at": "2020-06-21T23:12:38Z",
    "updated_at": "2020-06-22T19:44:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443265733",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443265733"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443265733"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443265733/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 745,
    "original_line": 745,
    "side": "LEFT",
    "in_reply_to_id": 442494190
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443785276",
    "pull_request_review_id": 435221277,
    "id": 443785276,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc4NTI3Ng==",
    "diff_hunk": "@@ -738,27 +739,32 @@ void BerkeleyDatabase::ReloadDbEnv()\n     }\n }\n \n-Dbc* BerkeleyBatch::GetCursor()\n+bool BerkeleyBatch::CreateCursor()",
    "path": "src/wallet/bdb.cpp",
    "position": null,
    "original_position": 47,
    "commit_id": "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
    "original_commit_id": "40d31e31820bf2a6675d326d816e6da7b4dc714b",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Renamed to `StartCursor`.",
    "created_at": "2020-06-22T19:43:44Z",
    "updated_at": "2020-06-22T19:43:44Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443785276",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443785276"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443785276"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443785276/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 742,
    "side": "RIGHT",
    "in_reply_to_id": 442290726
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443786075",
    "pull_request_review_id": 435222306,
    "id": 443786075,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc4NjA3NQ==",
    "diff_hunk": "@@ -742,8 +745,8 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n             if (!strErr.empty())\n                 pwallet->WalletLogPrintf(\"%s\\n\", strErr);\n         }\n-        pcursor->close();",
    "path": "src/wallet/walletdb.cpp",
    "position": 32,
    "original_position": 33,
    "commit_id": "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
    "original_commit_id": "cda86544ae9de430e4558b87945046d5612202ac",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I've moved it to after the `catch` block and removed the ones inside the loop except for the ones right before the early return.",
    "created_at": "2020-06-22T19:45:29Z",
    "updated_at": "2020-06-22T19:45:29Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443786075",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443786075"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443786075"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443786075/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 745,
    "original_line": 745,
    "side": "LEFT",
    "in_reply_to_id": 442494190
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443838828",
    "pull_request_review_id": 435289625,
    "id": 443838828,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzgzODgyOA==",
    "diff_hunk": "@@ -738,27 +739,30 @@ void BerkeleyDatabase::ReloadDbEnv()\n     }\n }\n \n-Dbc* BerkeleyBatch::GetCursor()\n+bool BerkeleyBatch::StartCursor()\n {\n+    assert(!m_cursor);\n     if (!pdb)\n-        return nullptr;\n-    Dbc* pcursor = nullptr;\n-    int ret = pdb->cursor(nullptr, &pcursor, 0);\n-    if (ret != 0)\n-        return nullptr;\n-    return pcursor;\n+        return false;\n+    int ret = pdb->cursor(nullptr, &m_cursor, 0);\n+    return ret == 0;\n }\n \n-int BerkeleyBatch::ReadAtCursor(Dbc* pcursor, CDataStream& ssKey, CDataStream& ssValue)\n+bool BerkeleyBatch::ReadAtCursor(CDataStream& ssKey, CDataStream& ssValue, bool& complete)\n {\n+    complete = false;\n+    if (m_cursor == nullptr) return false;",
    "path": "src/wallet/bdb.cpp",
    "position": 73,
    "original_position": 73,
    "commit_id": "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
    "original_commit_id": "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "`assert(m_cursor)`? There was no check for `pcursor`.",
    "created_at": "2020-06-22T21:33:26Z",
    "updated_at": "2020-06-22T21:52:36Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443838828",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443838828"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443838828"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443838828/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 754,
    "original_line": 754,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443838936",
    "pull_request_review_id": 435289625,
    "id": 443838936,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzgzODkzNg==",
    "diff_hunk": "@@ -335,7 +335,7 @@ void BerkeleyEnvironment::CheckpointLSN(const std::string& strFile)\n }\n \n \n-BerkeleyBatch::BerkeleyBatch(BerkeleyDatabase& database, const char* pszMode, bool fFlushOnCloseIn) : pdb(nullptr), activeTxn(nullptr)\n+BerkeleyBatch::BerkeleyBatch(BerkeleyDatabase& database, const char* pszMode, bool fFlushOnCloseIn) : pdb(nullptr), activeTxn(nullptr), m_cursor(nullptr)",
    "path": "src/wallet/bdb.cpp",
    "position": 5,
    "original_position": 5,
    "commit_id": "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
    "original_commit_id": "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit, move these to header.",
    "created_at": "2020-06-22T21:33:43Z",
    "updated_at": "2020-06-22T21:52:36Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443838936",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443838936"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443838936"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443838936/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 338,
    "original_line": 338,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443863984",
    "pull_request_review_id": 435321636,
    "id": 443863984,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg2Mzk4NA==",
    "diff_hunk": "@@ -738,27 +739,32 @@ void BerkeleyDatabase::ReloadDbEnv()\n     }\n }\n \n-Dbc* BerkeleyBatch::GetCursor()\n+bool BerkeleyBatch::CreateCursor()\n {\n+    assert(!m_cursor);\n     if (!pdb)\n-        return nullptr;\n-    Dbc* pcursor = nullptr;\n-    int ret = pdb->cursor(nullptr, &pcursor, 0);\n+        return false;\n+    int ret = pdb->cursor(nullptr, &m_cursor, 0);\n     if (ret != 0)\n-        return nullptr;\n-    return pcursor;\n+        return false;\n+    return true;",
    "path": "src/wallet/bdb.cpp",
    "position": null,
    "original_position": 60,
    "commit_id": "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
    "original_commit_id": "cda86544ae9de430e4558b87945046d5612202ac",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done",
    "created_at": "2020-06-22T22:39:52Z",
    "updated_at": "2020-06-22T22:39:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443863984",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443863984"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443863984"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443863984/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 750,
    "side": "RIGHT",
    "in_reply_to_id": 443263535
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443864251",
    "pull_request_review_id": 435321980,
    "id": 443864251,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg2NDI1MQ==",
    "diff_hunk": "@@ -738,27 +739,30 @@ void BerkeleyDatabase::ReloadDbEnv()\n     }\n }\n \n-Dbc* BerkeleyBatch::GetCursor()\n+bool BerkeleyBatch::StartCursor()\n {\n+    assert(!m_cursor);\n     if (!pdb)\n-        return nullptr;\n-    Dbc* pcursor = nullptr;\n-    int ret = pdb->cursor(nullptr, &pcursor, 0);\n-    if (ret != 0)\n-        return nullptr;\n-    return pcursor;\n+        return false;\n+    int ret = pdb->cursor(nullptr, &m_cursor, 0);\n+    return ret == 0;\n }\n \n-int BerkeleyBatch::ReadAtCursor(Dbc* pcursor, CDataStream& ssKey, CDataStream& ssValue)\n+bool BerkeleyBatch::ReadAtCursor(CDataStream& ssKey, CDataStream& ssValue, bool& complete)\n {\n+    complete = false;\n+    if (m_cursor == nullptr) return false;",
    "path": "src/wallet/bdb.cpp",
    "position": 73,
    "original_position": 73,
    "commit_id": "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
    "original_commit_id": "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I don't think an assert is necessary.",
    "created_at": "2020-06-22T22:40:37Z",
    "updated_at": "2020-06-22T22:40:37Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443864251",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443864251"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443864251"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443864251/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 754,
    "original_line": 754,
    "side": "RIGHT",
    "in_reply_to_id": 443838828
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443864917",
    "pull_request_review_id": 435322973,
    "id": 443864917,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg2NDkxNw==",
    "diff_hunk": "@@ -335,7 +335,7 @@ void BerkeleyEnvironment::CheckpointLSN(const std::string& strFile)\n }\n \n \n-BerkeleyBatch::BerkeleyBatch(BerkeleyDatabase& database, const char* pszMode, bool fFlushOnCloseIn) : pdb(nullptr), activeTxn(nullptr)\n+BerkeleyBatch::BerkeleyBatch(BerkeleyDatabase& database, const char* pszMode, bool fFlushOnCloseIn) : pdb(nullptr), activeTxn(nullptr), m_cursor(nullptr)",
    "path": "src/wallet/bdb.cpp",
    "position": 5,
    "original_position": 5,
    "commit_id": "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
    "original_commit_id": "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I'm pretty sure that won't compile.",
    "created_at": "2020-06-22T22:42:52Z",
    "updated_at": "2020-06-22T22:42:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443864917",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443864917"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443864917"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443864917/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 338,
    "original_line": 338,
    "side": "RIGHT",
    "in_reply_to_id": 443838936
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443867602",
    "pull_request_review_id": 435326710,
    "id": 443867602,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg2NzYwMg==",
    "diff_hunk": "@@ -335,7 +335,7 @@ void BerkeleyEnvironment::CheckpointLSN(const std::string& strFile)\n }\n \n \n-BerkeleyBatch::BerkeleyBatch(BerkeleyDatabase& database, const char* pszMode, bool fFlushOnCloseIn) : pdb(nullptr), activeTxn(nullptr)\n+BerkeleyBatch::BerkeleyBatch(BerkeleyDatabase& database, const char* pszMode, bool fFlushOnCloseIn) : pdb(nullptr), activeTxn(nullptr), m_cursor(nullptr)",
    "path": "src/wallet/bdb.cpp",
    "position": 5,
    "original_position": 5,
    "commit_id": "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
    "original_commit_id": "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I mean 04998ef3cb866b2371bb047a5091787f61692588.",
    "created_at": "2020-06-22T22:51:34Z",
    "updated_at": "2020-06-22T22:51:34Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443867602",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443867602"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443867602"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443867602/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 338,
    "original_line": 338,
    "side": "RIGHT",
    "in_reply_to_id": 443838936
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443872725",
    "pull_request_review_id": 435333578,
    "id": 443872725,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg3MjcyNQ==",
    "diff_hunk": "@@ -335,7 +335,7 @@ void BerkeleyEnvironment::CheckpointLSN(const std::string& strFile)\n }\n \n \n-BerkeleyBatch::BerkeleyBatch(BerkeleyDatabase& database, const char* pszMode, bool fFlushOnCloseIn) : pdb(nullptr), activeTxn(nullptr)\n+BerkeleyBatch::BerkeleyBatch(BerkeleyDatabase& database, const char* pszMode, bool fFlushOnCloseIn) : pdb(nullptr), activeTxn(nullptr), m_cursor(nullptr)",
    "path": "src/wallet/bdb.cpp",
    "position": 5,
    "original_position": 5,
    "commit_id": "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
    "original_commit_id": "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Ah. Maybe if I have to push again.",
    "created_at": "2020-06-22T23:08:16Z",
    "updated_at": "2020-06-22T23:08:16Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443872725",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443872725"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443872725"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443872725/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 338,
    "original_line": 338,
    "side": "RIGHT",
    "in_reply_to_id": 443838936
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444090941",
    "pull_request_review_id": 435607641,
    "id": 444090941,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA5MDk0MQ==",
    "diff_hunk": "@@ -738,27 +739,30 @@ void BerkeleyDatabase::ReloadDbEnv()\n     }\n }\n \n-Dbc* BerkeleyBatch::GetCursor()\n+bool BerkeleyBatch::StartCursor()\n {\n+    assert(!m_cursor);\n     if (!pdb)\n-        return nullptr;\n-    Dbc* pcursor = nullptr;\n-    int ret = pdb->cursor(nullptr, &pcursor, 0);\n-    if (ret != 0)\n-        return nullptr;\n-    return pcursor;\n+        return false;\n+    int ret = pdb->cursor(nullptr, &m_cursor, 0);\n+    return ret == 0;\n }\n \n-int BerkeleyBatch::ReadAtCursor(Dbc* pcursor, CDataStream& ssKey, CDataStream& ssValue)\n+bool BerkeleyBatch::ReadAtCursor(CDataStream& ssKey, CDataStream& ssValue, bool& complete)\n {\n+    complete = false;\n+    if (m_cursor == nullptr) return false;",
    "path": "src/wallet/bdb.cpp",
    "position": 73,
    "original_position": 73,
    "commit_id": "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
    "original_commit_id": "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "If it's something that can't happen then an assertion is fine. Also, it means that `StartCursor` must be called before.",
    "created_at": "2020-06-23T09:31:16Z",
    "updated_at": "2020-06-23T09:31:46Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r444090941",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444090941"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r444090941"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444090941/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 754,
    "original_line": 754,
    "side": "RIGHT",
    "in_reply_to_id": 443838828
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444322405",
    "pull_request_review_id": 435912776,
    "id": 444322405,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMyMjQwNQ==",
    "diff_hunk": "@@ -738,27 +739,30 @@ void BerkeleyDatabase::ReloadDbEnv()\n     }\n }\n \n-Dbc* BerkeleyBatch::GetCursor()\n+bool BerkeleyBatch::StartCursor()\n {\n+    assert(!m_cursor);\n     if (!pdb)\n-        return nullptr;\n-    Dbc* pcursor = nullptr;\n-    int ret = pdb->cursor(nullptr, &pcursor, 0);\n-    if (ret != 0)\n-        return nullptr;\n-    return pcursor;\n+        return false;\n+    int ret = pdb->cursor(nullptr, &m_cursor, 0);\n+    return ret == 0;\n }\n \n-int BerkeleyBatch::ReadAtCursor(Dbc* pcursor, CDataStream& ssKey, CDataStream& ssValue)\n+bool BerkeleyBatch::ReadAtCursor(CDataStream& ssKey, CDataStream& ssValue, bool& complete)\n {\n+    complete = false;\n+    if (m_cursor == nullptr) return false;",
    "path": "src/wallet/bdb.cpp",
    "position": 73,
    "original_position": 73,
    "commit_id": "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
    "original_commit_id": "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "If I have to push again.",
    "created_at": "2020-06-23T15:41:51Z",
    "updated_at": "2020-06-23T15:41:51Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r444322405",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444322405"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r444322405"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444322405/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 754,
    "original_line": 754,
    "side": "RIGHT",
    "in_reply_to_id": 443838828
  }
]