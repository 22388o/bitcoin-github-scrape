[
  {
    "sha": "5cbda4f10f16923910de2bd080152fc7bbc48738",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1Y2JkYTRmMTBmMTY5MjM5MTBkZTJiZDA4MDE1MmZjN2JiYzQ4NzM4",
    "commit": {
      "author": {
        "name": "Ross Nicoll",
        "email": "jrn@jrn.me.uk",
        "date": "2014-08-07T21:58:50Z"
      },
      "committer": {
        "name": "Ross Nicoll",
        "email": "jrn@jrn.me.uk",
        "date": "2014-08-16T14:27:18Z"
      },
      "message": "Changed LevelDB cursors to use scoped pointers to ensure destruction when going out of scope.\n\nThis corrects a bug where an exception thrown reading from the database causes the cursor to\nbe left open, which causes an assertion error to occur when the database is deleted (around\nline 938 of init.cpp).",
      "tree": {
        "sha": "d97408d2785dabf09d3fdbe1d65f9fad799d4c9b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d97408d2785dabf09d3fdbe1d65f9fad799d4c9b"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5cbda4f10f16923910de2bd080152fc7bbc48738",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5cbda4f10f16923910de2bd080152fc7bbc48738",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/5cbda4f10f16923910de2bd080152fc7bbc48738",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5cbda4f10f16923910de2bd080152fc7bbc48738/comments",
    "author": {
      "login": "rnicoll",
      "id": 3513077,
      "node_id": "MDQ6VXNlcjM1MTMwNzc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3513077?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rnicoll",
      "html_url": "https://github.com/rnicoll",
      "followers_url": "https://api.github.com/users/rnicoll/followers",
      "following_url": "https://api.github.com/users/rnicoll/following{/other_user}",
      "gists_url": "https://api.github.com/users/rnicoll/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rnicoll/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rnicoll/subscriptions",
      "organizations_url": "https://api.github.com/users/rnicoll/orgs",
      "repos_url": "https://api.github.com/users/rnicoll/repos",
      "events_url": "https://api.github.com/users/rnicoll/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rnicoll/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "rnicoll",
      "id": 3513077,
      "node_id": "MDQ6VXNlcjM1MTMwNzc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3513077?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rnicoll",
      "html_url": "https://github.com/rnicoll",
      "followers_url": "https://api.github.com/users/rnicoll/followers",
      "following_url": "https://api.github.com/users/rnicoll/following{/other_user}",
      "gists_url": "https://api.github.com/users/rnicoll/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rnicoll/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rnicoll/subscriptions",
      "organizations_url": "https://api.github.com/users/rnicoll/orgs",
      "repos_url": "https://api.github.com/users/rnicoll/repos",
      "events_url": "https://api.github.com/users/rnicoll/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rnicoll/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "003bbd5f7672d7fd4f40478fd57cc4e03c30f933",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/003bbd5f7672d7fd4f40478fd57cc4e03c30f933",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/003bbd5f7672d7fd4f40478fd57cc4e03c30f933"
      }
    ],
    "stats": {
      "total": 6,
      "additions": 2,
      "deletions": 4
    },
    "files": [
      {
        "sha": "d3d05c58d70583b207440703f2a7b434d5ed279f",
        "filename": "src/txdb.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 4,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5cbda4f10f16923910de2bd080152fc7bbc48738/src/txdb.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5cbda4f10f16923910de2bd080152fc7bbc48738/src/txdb.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/txdb.cpp?ref=5cbda4f10f16923910de2bd080152fc7bbc48738",
        "patch": "@@ -103,7 +103,7 @@ bool CBlockTreeDB::ReadLastBlockFile(int &nFile) {\n }\n \n bool CCoinsViewDB::GetStats(CCoinsStats &stats) {\n-    leveldb::Iterator *pcursor = db.NewIterator();\n+    boost::scoped_ptr<leveldb::Iterator> pcursor(db.NewIterator());\n     pcursor->SeekToFirst();\n \n     CHashWriter ss(SER_GETHASH, PROTOCOL_VERSION);\n@@ -146,7 +146,6 @@ bool CCoinsViewDB::GetStats(CCoinsStats &stats) {\n             return error(\"%s : Deserialize or I/O error - %s\", __func__, e.what());\n         }\n     }\n-    delete pcursor;\n     stats.nHeight = mapBlockIndex.find(GetBestBlock())->second->nHeight;\n     stats.hashSerialized = ss.GetHash();\n     stats.nTotalAmount = nTotalAmount;\n@@ -178,7 +177,7 @@ bool CBlockTreeDB::ReadFlag(const std::string &name, bool &fValue) {\n \n bool CBlockTreeDB::LoadBlockIndexGuts()\n {\n-    leveldb::Iterator *pcursor = NewIterator();\n+    boost::scoped_ptr<leveldb::Iterator> pcursor(NewIterator());\n \n     CDataStream ssKeySet(SER_DISK, CLIENT_VERSION);\n     ssKeySet << make_pair('b', uint256(0));\n@@ -224,7 +223,6 @@ bool CBlockTreeDB::LoadBlockIndexGuts()\n             return error(\"%s : Deserialize or I/O error - %s\", __func__, e.what());\n         }\n     }\n-    delete pcursor;\n \n     return true;\n }"
      }
    ]
  }
]