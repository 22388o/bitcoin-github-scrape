[
  {
    "sha": "1d740055daa6e1668f047186d208b0693c6b21ba",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxZDc0MDA1NWRhYTZlMTY2OGYwNDcxODZkMjA4YjA2OTNjNmIyMWJh",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-02-20T19:50:26Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-04-22T01:09:35Z"
      },
      "message": "-loadblock to load from an external blk000?.dat file",
      "tree": {
        "sha": "1462b3f673bd286490b9b527381d3a91167b860c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1462b3f673bd286490b9b527381d3a91167b860c"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1d740055daa6e1668f047186d208b0693c6b21ba",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1d740055daa6e1668f047186d208b0693c6b21ba",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/1d740055daa6e1668f047186d208b0693c6b21ba",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1d740055daa6e1668f047186d208b0693c6b21ba/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "7dbe393629a263675ccfd6fce8e7fc12496c808a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7dbe393629a263675ccfd6fce8e7fc12496c808a",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/7dbe393629a263675ccfd6fce8e7fc12496c808a"
      }
    ],
    "stats": {
      "total": 75,
      "additions": 72,
      "deletions": 3
    },
    "files": [
      {
        "sha": "670f0a876ce7033180739e74694a2e290c525c40",
        "filename": "src/db.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1d740055daa6e1668f047186d208b0693c6b21ba/src/db.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1d740055daa6e1668f047186d208b0693c6b21ba/src/db.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/db.cpp?ref=1d740055daa6e1668f047186d208b0693c6b21ba",
        "patch": "@@ -608,7 +608,7 @@ bool CTxDB::LoadBlockIndex()\n     map<pair<unsigned int, unsigned int>, CBlockIndex*> mapBlockPos;\n     for (CBlockIndex* pindex = pindexBest; pindex && pindex->pprev; pindex = pindex->pprev)\n     {\n-        if (pindex->nHeight < nBestHeight-nCheckDepth)\n+        if (fRequestShutdown || pindex->nHeight < nBestHeight-nCheckDepth)\n             break;\n         CBlock block;\n         if (!block.ReadFromDisk(pindex))\n@@ -710,7 +710,7 @@ bool CTxDB::LoadBlockIndex()\n             }\n         }\n     }\n-    if (pindexFork)\n+    if (pindexFork && !fRequestShutdown)\n     {\n         // Reorg back to the fork\n         printf(\"LoadBlockIndex() : *** moving best chain pointer back to block %d\\n\", pindexFork->nHeight);"
      },
      {
        "sha": "a021e849ff46120640dff802725d4821f8a5d7ab",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 12,
        "deletions": 1,
        "changes": 13,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1d740055daa6e1668f047186d208b0693c6b21ba/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1d740055daa6e1668f047186d208b0693c6b21ba/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=1d740055daa6e1668f047186d208b0693c6b21ba",
        "patch": "@@ -224,7 +224,8 @@ bool AppInit2(int argc, char* argv[])\n             \"  -keypool=<n>     \\t  \"   + _(\"Set key pool size to <n> (default: 100)\") + \"\\n\" +\n             \"  -rescan          \\t  \"   + _(\"Rescan the block chain for missing wallet transactions\") + \"\\n\" +\n             \"  -checkblocks=<n> \\t\\t  \" + _(\"How many blocks to check at startup (default: 2500, 0 = all)\") + \"\\n\" +\n-            \"  -checklevel=<n>  \\t\\t  \" + _(\"How thorough the block verification is (0-6, default: 1)\") + \"\\n\";\n+            \"  -checklevel=<n>  \\t\\t  \" + _(\"How thorough the block verification is (0-6, default: 1)\") + \"\\n\" +\n+            \"  -loadblock=<file>\\t  \"   + _(\"Imports blocks from external blk000?.dat file\") + \"\\n\";\n \n         strUsage += string() +\n             _(\"\\nSSL options: (see the Bitcoin Wiki for SSL setup instructions)\") + \"\\n\" +\n@@ -364,6 +365,16 @@ bool AppInit2(int argc, char* argv[])\n     }\n     printf(\" block index %15\"PRI64d\"ms\\n\", GetTimeMillis() - nStart);\n \n+    if (mapArgs.count(\"-loadblock\"))\n+    {\n+        BOOST_FOREACH(string strFile, mapMultiArgs[\"-loadblock\"])\n+        {\n+            FILE *file = fopen(strFile.c_str(), \"rb\");\n+            if (file)\n+                LoadExternalBlockFile(file);\n+        }\n+    }\n+\n     InitMessage(_(\"Loading wallet...\"));\n     printf(\"Loading wallet...\\n\");\n     nStart = GetTimeMillis();"
      },
      {
        "sha": "e2f1af4091ed1c77a51991dda36729a8d331761b",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 56,
        "deletions": 0,
        "changes": 56,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1d740055daa6e1668f047186d208b0693c6b21ba/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1d740055daa6e1668f047186d208b0693c6b21ba/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=1d740055daa6e1668f047186d208b0693c6b21ba",
        "patch": "@@ -2011,6 +2011,62 @@ void PrintBlockTree()\n     }\n }\n \n+bool LoadExternalBlockFile(FILE* fileIn)\n+{\n+    int nLoaded = 0;\n+    {\n+        LOCK(cs_main);\n+        try {\n+            CAutoFile blkdat(fileIn, SER_DISK, CLIENT_VERSION);\n+            unsigned int nPos = 0;\n+            while (nPos != -1 && blkdat.good() && !fRequestShutdown)\n+            {\n+                unsigned char pchData[65536];\n+                do {\n+                    fseek(blkdat, nPos, SEEK_SET);\n+                    int nRead = fread(pchData, 1, sizeof(pchData), blkdat);\n+                    if (nRead <= 8)\n+                    {\n+                        nPos = -1;\n+                        break;\n+                    }\n+                    void* nFind = memchr(pchData, pchMessageStart[0], nRead+1-sizeof(pchMessageStart));\n+                    if (nFind)\n+                    {\n+                        if (memcmp(nFind, pchMessageStart, sizeof(pchMessageStart))==0)\n+                        {\n+                            nPos += ((unsigned char*)nFind - pchData) + sizeof(pchMessageStart);\n+                            break;\n+                        }\n+                        nPos += ((unsigned char*)nFind - pchData) + 1;\n+                    }\n+                    else\n+                        nPos += sizeof(pchData) - sizeof(pchMessageStart) + 1;\n+                } while(!fRequestShutdown);\n+                if (nPos == -1)\n+                    break;\n+                fseek(blkdat, nPos, SEEK_SET);\n+                unsigned int nSize;\n+                blkdat >> nSize;\n+                if (nSize > 0 && nSize <= MAX_BLOCK_SIZE)\n+                {\n+                    CBlock block;\n+                    blkdat >> block;\n+                    if (ProcessBlock(NULL,&block))\n+                    {\n+                        nLoaded++;\n+                        nPos += 4 + nSize;\n+                    }\n+                }\n+            }\n+        }\n+        catch (std::exception &e) \n+        {\n+        }\n+    }\n+    printf(\"Loaded %i blocks from external file\\n\", nLoaded);\n+    return nLoaded > 0;\n+}\n \n \n "
      },
      {
        "sha": "af294b55c73eed2f7ac3c274f8ca3d5611b23826",
        "filename": "src/main.h",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1d740055daa6e1668f047186d208b0693c6b21ba/src/main.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1d740055daa6e1668f047186d208b0693c6b21ba/src/main.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.h?ref=1d740055daa6e1668f047186d208b0693c6b21ba",
        "patch": "@@ -69,6 +69,7 @@ extern int64 nHPSTimerStart;\n extern int64 nTimeBestReceived;\n extern CCriticalSection cs_setpwalletRegistered;\n extern std::set<CWallet*> setpwalletRegistered;\n+extern unsigned char pchMessageStart[4];\n \n // Settings\n extern int64 nTransactionFee;\n@@ -91,6 +92,7 @@ bool LoadBlockIndex(bool fAllowNew=true);\n void PrintBlockTree();\n bool ProcessMessages(CNode* pfrom);\n bool SendMessages(CNode* pto, bool fSendTrickle);\n+bool LoadExternalBlockFile(FILE* fileIn);\n void GenerateBitcoins(bool fGenerate, CWallet* pwallet);\n CBlock* CreateNewBlock(CReserveKey& reservekey);\n void IncrementExtraNonce(CBlock* pblock, CBlockIndex* pindexPrev, unsigned int& nExtraNonce);"
      }
    ]
  }
]