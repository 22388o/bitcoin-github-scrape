[
  {
    "sha": "75163f4729c10c40d2843da28a8c79ab89193f6a",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo3NTE2M2Y0NzI5YzEwYzQwZDI4NDNkYTI4YThjNzlhYjg5MTkzZjZh",
    "commit": {
      "author": {
        "name": "Karl-Johan Alm",
        "email": "karljohan-alm@garage.co.jp",
        "date": "2020-01-07T13:24:16Z"
      },
      "committer": {
        "name": "Karl-Johan Alm",
        "email": "karljohan-alm@garage.co.jp",
        "date": "2020-01-14T23:56:39Z"
      },
      "message": "bug-fix macos: give free bytes to F_PREALLOCATE\n\nThe macos manpage for fcntl (for F_PEOFPOSMODE) states:\n\n> Allocate from the physical end of file.  In this case, fst_length indicates the number of newly allocated bytes desired.",
      "tree": {
        "sha": "3bdaccbd4a1bdc3e4d74ad846ead5d092d8b3ec2",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3bdaccbd4a1bdc3e4d74ad846ead5d092d8b3ec2"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/75163f4729c10c40d2843da28a8c79ab89193f6a",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEExCr/fGGz5EoUVM01V692LbM1MyIFAl4eVTcACgkQV692LbM1\nMyIuCg/8D936e5HlvMUiR3oOi4VgihezVSP/wPdFzvl6zvSj2MAnRi/esPsiHsZK\nctkUX7LII6e103mISOWPpggNurcwzXyvL7AGH9doKwDSs6xURuwhXwqLWWJvHQY7\nJDefSJiOHYbB/9sxo3i717s8mFR5PIKdSaAlDZJGsZXyK/Kn3M9YzOtzn6gdJyiM\nUWTZnE5wzYiiDLdH4f02sWQbNZ/rRJIzg/35iWNPX3ros3QhXJ/KYhmUZvPP1ajV\n5u7BccTudYIGwFCXPMkCkdnAGvOWdVzcPMnFE+hU+ndYxn9bryhECjpBW9qbbrai\ng4RkqqzixJPv3bP7inoApAiEmkoZxeqtc1OZGDIk5EZTRCJYMex2Zx9LvqC0Pbr5\ngx/0J/5sxfluOA0oUhQjFhSITU8byerSlWSAbVKCtnlXb1p9LMtpeEy/rLqpWQWj\nQ0PZPvavM+NEW6cjJAPxUxYOzEFxKJMx2r3F3YOdmygTyoUgJXyL3CyL7NxdMph1\nPNzrt6e0dQO2valyGTm2Wxt3TLXjp6awI0xtq62pkyOj53cLaPV7vxprxVw7dMh4\nb4g7Di2XVilDj4VCV0tlAGro9XER5uOoyO9WD2aLMTKwVSZFLdLyFpmLtXnNKLBs\ngcSaYZdC5oddlESnSKSkqiqSLGIDrgx3alZKbR82xi0UG6ZwG3k=\n=RA+p\n-----END PGP SIGNATURE-----",
        "payload": "tree 3bdaccbd4a1bdc3e4d74ad846ead5d092d8b3ec2\nparent 816464198c34a373229e865d76f4bc0ca8f127dc\nauthor Karl-Johan Alm <karljohan-alm@garage.co.jp> 1578403456 +0900\ncommitter Karl-Johan Alm <karljohan-alm@garage.co.jp> 1579046199 +0900\n\nbug-fix macos: give free bytes to F_PREALLOCATE\n\nThe macos manpage for fcntl (for F_PEOFPOSMODE) states:\n\n> Allocate from the physical end of file.  In this case, fst_length indicates the number of newly allocated bytes desired.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/75163f4729c10c40d2843da28a8c79ab89193f6a",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/75163f4729c10c40d2843da28a8c79ab89193f6a",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/75163f4729c10c40d2843da28a8c79ab89193f6a/comments",
    "author": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "816464198c34a373229e865d76f4bc0ca8f127dc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/816464198c34a373229e865d76f4bc0ca8f127dc",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/816464198c34a373229e865d76f4bc0ca8f127dc"
      }
    ],
    "stats": {
      "total": 6,
      "additions": 4,
      "deletions": 2
    },
    "files": [
      {
        "sha": "4869b69f9a15e4f2894441d27a1ffa229c7b2ff2",
        "filename": "src/util/system.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 2,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/75163f4729c10c40d2843da28a8c79ab89193f6a/src/util/system.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/75163f4729c10c40d2843da28a8c79ab89193f6a/src/util/system.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/util/system.cpp?ref=75163f4729c10c40d2843da28a8c79ab89193f6a",
        "patch": "@@ -974,17 +974,19 @@ void AllocateFileRange(FILE *file, unsigned int offset, unsigned int length) {\n     SetEndOfFile(hFile);\n #elif defined(MAC_OSX)\n     // OSX specific version\n+    // NOTE: Contrary to other OS versions, the OSX version assumes that\n+    // NOTE: offset is the size of the file.\n     fstore_t fst;\n     fst.fst_flags = F_ALLOCATECONTIG;\n     fst.fst_posmode = F_PEOFPOSMODE;\n     fst.fst_offset = 0;\n-    fst.fst_length = (off_t)offset + length;\n+    fst.fst_length = length; // mac os fst_length takes the # of free bytes to allocate, not desired file size\n     fst.fst_bytesalloc = 0;\n     if (fcntl(fileno(file), F_PREALLOCATE, &fst) == -1) {\n         fst.fst_flags = F_ALLOCATEALL;\n         fcntl(fileno(file), F_PREALLOCATE, &fst);\n     }\n-    ftruncate(fileno(file), fst.fst_length);\n+    ftruncate(fileno(file), static_cast<off_t>(offset) + length);\n #else\n     #if defined(__linux__)\n     // Version using posix_fallocate"
      }
    ]
  }
]