[
  {
    "sha": "9b8f98ad8f41d0e317de067afcdd38a1620fc50b",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5YjhmOThhZDhmNDFkMGUzMTdkZTA2N2FmY2RkMzhhMTYyMGZjNTBi",
    "commit": {
      "author": {
        "name": "John Tobey",
        "email": "John.Tobey@gmail.com",
        "date": "2011-05-19T21:06:17Z"
      },
      "committer": {
        "name": "John Tobey",
        "email": "John.Tobey@gmail.com",
        "date": "2011-05-19T21:06:17Z"
      },
      "message": "importkey and ImportPemFile, sans safeguards",
      "tree": {
        "sha": "eda51ccc902321c2d5bbad1fde35039a3178ccfc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/eda51ccc902321c2d5bbad1fde35039a3178ccfc"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9b8f98ad8f41d0e317de067afcdd38a1620fc50b",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9b8f98ad8f41d0e317de067afcdd38a1620fc50b",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/9b8f98ad8f41d0e317de067afcdd38a1620fc50b",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9b8f98ad8f41d0e317de067afcdd38a1620fc50b/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "813a3b438fe66406f8f0b45665011fd602330965",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/813a3b438fe66406f8f0b45665011fd602330965",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/813a3b438fe66406f8f0b45665011fd602330965"
      }
    ],
    "stats": {
      "total": 49,
      "additions": 49,
      "deletions": 0
    },
    "files": [
      {
        "sha": "9ed1d9dba7f0f0be1930edf76036fb35460022fc",
        "filename": "src/db.cpp",
        "status": "modified",
        "additions": 26,
        "deletions": 0,
        "changes": 26,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9b8f98ad8f41d0e317de067afcdd38a1620fc50b/src/db.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9b8f98ad8f41d0e317de067afcdd38a1620fc50b/src/db.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/db.cpp?ref=9b8f98ad8f41d0e317de067afcdd38a1620fc50b",
        "patch": "@@ -951,6 +951,32 @@ void BackupWallet(const string& strDest)\n     }\n }\n \n+string ImportPemFile(const string& strFile, const string& strAccount)\n+{\n+    FILE* fp = fopen(strFile.c_str(), \"r\");\n+    if (fp == NULL)\n+        throw runtime_error(strprintf(\"ImportPemFile() : failed to open file %s\", strFile.c_str()));\n+\n+    CKey key;\n+    if (!key.SetPrivKeyPem(fp))\n+        throw runtime_error(strprintf(\"ImportPemFile() : failed to read key from file %s\", strFile.c_str()));\n+\n+    string strAddress = PubKeyToAddress(key.GetPubKey());\n+\n+    // XXX AddKey seems to be called with cs_main and cs_mapWallet.  Do we need them?\n+    CRITICAL_BLOCK(cs_main)\n+    CRITICAL_BLOCK(cs_mapWallet)\n+    {\n+        // XXX Should make sure not to overwrite a key.\n+        if (!AddKey(key))\n+            throw runtime_error(\"ImportPemFile() : AddKey failed\");\n+    }\n+\n+    SetAddressBookName(strAddress, strAccount);\n+\n+    return strAddress;\n+}\n+\n \n void CWalletDB::ReserveKeyFromKeyPool(int64& nIndex, CKeyPool& keypool)\n {"
      },
      {
        "sha": "ff590bea410ceb2ccd2048eec01466fbb0d9b039",
        "filename": "src/db.h",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9b8f98ad8f41d0e317de067afcdd38a1620fc50b/src/db.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9b8f98ad8f41d0e317de067afcdd38a1620fc50b/src/db.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/db.h?ref=9b8f98ad8f41d0e317de067afcdd38a1620fc50b",
        "patch": "@@ -471,6 +471,7 @@ class CWalletDB : public CDB\n \n bool LoadWallet(bool& fFirstRunRet);\n void BackupWallet(const std::string& strDest);\n+std::string ImportPemFile(const std::string& strFile, const std::string& strAccount);\n \n inline bool SetAddressBookName(const std::string& strAddress, const std::string& strName)\n {"
      },
      {
        "sha": "87019dd20edd4e3d5e42f853b250b9a0b914ce6c",
        "filename": "src/headers.h",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9b8f98ad8f41d0e317de067afcdd38a1620fc50b/src/headers.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9b8f98ad8f41d0e317de067afcdd38a1620fc50b/src/headers.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/headers.h?ref=9b8f98ad8f41d0e317de067afcdd38a1620fc50b",
        "patch": "@@ -40,6 +40,7 @@\n #include <openssl/rand.h>\n #include <openssl/sha.h>\n #include <openssl/ripemd.h>\n+#include <openssl/pem.h>\n #include <db_cxx.h>\n #include <stdio.h>\n #include <stdlib.h>"
      },
      {
        "sha": "0ae4282457e318e18559b3af7f0e6978e55691d2",
        "filename": "src/key.h",
        "status": "modified",
        "additions": 8,
        "deletions": 0,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9b8f98ad8f41d0e317de067afcdd38a1620fc50b/src/key.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9b8f98ad8f41d0e317de067afcdd38a1620fc50b/src/key.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/key.h?ref=9b8f98ad8f41d0e317de067afcdd38a1620fc50b",
        "patch": "@@ -102,6 +102,14 @@ class CKey\n         return true;\n     }\n \n+    bool SetPrivKeyPem(FILE* file)\n+    {\n+        if (PEM_read_ECPrivateKey(file, &pkey, NULL, NULL) == NULL)\n+            return false;\n+        fSet = true;\n+        return true;\n+    }\n+\n     CPrivKey GetPrivKey() const\n     {\n         unsigned int nSize = i2d_ECPrivateKey(pkey, NULL);"
      },
      {
        "sha": "d77710c0b85d895b23e60690f7d78fa9e835e000",
        "filename": "src/rpc.cpp",
        "status": "modified",
        "additions": 13,
        "deletions": 0,
        "changes": 13,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9b8f98ad8f41d0e317de067afcdd38a1620fc50b/src/rpc.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9b8f98ad8f41d0e317de067afcdd38a1620fc50b/src/rpc.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpc.cpp?ref=9b8f98ad8f41d0e317de067afcdd38a1620fc50b",
        "patch": "@@ -1255,6 +1255,18 @@ Value backupwallet(const Array& params, bool fHelp)\n     return Value::null;\n }\n \n+Value importkey(const Array& params, bool fHelp)\n+{\n+    if (fHelp || params.size() != 2)\n+        throw runtime_error(\n+            \"importkey <file> <account>\\n\"\n+            \"Reads a PEM-encoded keypair from file and adds it to the wallet.\");\n+\n+    string strFile = params[0].get_str();\n+    string strAccount = AccountFromValue(params[1]);\n+    return ImportPemFile(strFile, strAccount);\n+}\n+\n \n Value validateaddress(const Array& params, bool fHelp)\n {\n@@ -1435,6 +1447,7 @@ pair<string, rpcfn_type> pCallTable[] =\n     make_pair(\"listreceivedbyaccount\", &listreceivedbyaccount),\n     make_pair(\"listreceivedbylabel\",   &listreceivedbyaccount), // deprecated\n     make_pair(\"backupwallet\",          &backupwallet),\n+    make_pair(\"importkey\",             &importkey),\n     make_pair(\"validateaddress\",       &validateaddress),\n     make_pair(\"getbalance\",            &getbalance),\n     make_pair(\"move\",                  &movecmd),"
      }
    ]
  },
  {
    "sha": "4ae5c4588dc346a7293d7dbbfc3f939ea57a6993",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0YWU1YzQ1ODhkYzM0NmE3MjkzZDdkYmJmYzNmOTM5ZWE1N2E2OTkz",
    "commit": {
      "author": {
        "name": "John Tobey",
        "email": "John.Tobey@gmail.com",
        "date": "2011-05-19T21:39:31Z"
      },
      "committer": {
        "name": "John Tobey",
        "email": "John.Tobey@gmail.com",
        "date": "2011-05-19T21:39:31Z"
      },
      "message": "importkey: better help text",
      "tree": {
        "sha": "b73b2958a314d4b07099235071615d9fa20832cf",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b73b2958a314d4b07099235071615d9fa20832cf"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4ae5c4588dc346a7293d7dbbfc3f939ea57a6993",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4ae5c4588dc346a7293d7dbbfc3f939ea57a6993",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/4ae5c4588dc346a7293d7dbbfc3f939ea57a6993",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4ae5c4588dc346a7293d7dbbfc3f939ea57a6993/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "9b8f98ad8f41d0e317de067afcdd38a1620fc50b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9b8f98ad8f41d0e317de067afcdd38a1620fc50b",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/9b8f98ad8f41d0e317de067afcdd38a1620fc50b"
      }
    ],
    "stats": {
      "total": 5,
      "additions": 4,
      "deletions": 1
    },
    "files": [
      {
        "sha": "55455430f3f34d63614984ceb5a88f0b7727c470",
        "filename": "src/rpc.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 1,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4ae5c4588dc346a7293d7dbbfc3f939ea57a6993/src/rpc.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4ae5c4588dc346a7293d7dbbfc3f939ea57a6993/src/rpc.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpc.cpp?ref=4ae5c4588dc346a7293d7dbbfc3f939ea57a6993",
        "patch": "@@ -1260,7 +1260,10 @@ Value importkey(const Array& params, bool fHelp)\n     if (fHelp || params.size() != 2)\n         throw runtime_error(\n             \"importkey <file> <account>\\n\"\n-            \"Reads a PEM-encoded keypair from file and adds it to the wallet.\");\n+            \"Reads a PEM-encoded keypair from file and adds it to the wallet.\\n\"\n+            \"To create a keypair with OpenSSL, use:\\n\"\n+            \"    openssl ecparam -name secp256k1 -out NEW_KEY.pem -genkey\\n\"\n+            \"Returns the key's bitcoin address.\");\n \n     string strFile = params[0].get_str();\n     string strAccount = AccountFromValue(params[1]);"
      }
    ]
  },
  {
    "sha": "9a03627f895549c156b968c46de3635e14f92380",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5YTAzNjI3Zjg5NTU0OWMxNTZiOTY4YzQ2ZGUzNjM1ZTE0ZjkyMzgw",
    "commit": {
      "author": {
        "name": "John Tobey",
        "email": "John.Tobey@gmail.com",
        "date": "2011-05-19T23:20:22Z"
      },
      "committer": {
        "name": "John Tobey",
        "email": "John.Tobey@gmail.com",
        "date": "2011-05-19T23:20:22Z"
      },
      "message": "Avoid FILE* leak.",
      "tree": {
        "sha": "245568fcdb18357f56ca56e34e67e2aca5e10503",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/245568fcdb18357f56ca56e34e67e2aca5e10503"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9a03627f895549c156b968c46de3635e14f92380",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9a03627f895549c156b968c46de3635e14f92380",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/9a03627f895549c156b968c46de3635e14f92380",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9a03627f895549c156b968c46de3635e14f92380/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "4ae5c4588dc346a7293d7dbbfc3f939ea57a6993",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4ae5c4588dc346a7293d7dbbfc3f939ea57a6993",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/4ae5c4588dc346a7293d7dbbfc3f939ea57a6993"
      }
    ],
    "stats": {
      "total": 6,
      "additions": 3,
      "deletions": 3
    },
    "files": [
      {
        "sha": "55ce209fb0055d6e8a9590ec593573558575e9a6",
        "filename": "src/db.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 3,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9a03627f895549c156b968c46de3635e14f92380/src/db.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9a03627f895549c156b968c46de3635e14f92380/src/db.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/db.cpp?ref=9a03627f895549c156b968c46de3635e14f92380",
        "patch": "@@ -953,12 +953,12 @@ void BackupWallet(const string& strDest)\n \n string ImportPemFile(const string& strFile, const string& strAccount)\n {\n-    FILE* fp = fopen(strFile.c_str(), \"r\");\n-    if (fp == NULL)\n+    CAutoFile filein = fopen(strFile.c_str(), \"r\");\n+    if (!filein)\n         throw runtime_error(strprintf(\"ImportPemFile() : failed to open file %s\", strFile.c_str()));\n \n     CKey key;\n-    if (!key.SetPrivKeyPem(fp))\n+    if (!key.SetPrivKeyPem(filein))\n         throw runtime_error(strprintf(\"ImportPemFile() : failed to read key from file %s\", strFile.c_str()));\n \n     string strAddress = PubKeyToAddress(key.GetPubKey());"
      }
    ]
  }
]