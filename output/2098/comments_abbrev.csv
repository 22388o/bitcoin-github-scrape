sipa,2012-12-12T19:23:16Z,"Why do you keep insisting on having all block files in a single continuous chunk? I implemented pre-allocating specifically to address the excessive fragmentation the previous mechanism seemed to cause on some platform, but it's unreasonable to want every file to only be one chunk.\n\nI'll consider this if you can show benchmark results that this helps. PS: block and undo files are almost never ac",https://github.com/bitcoin/bitcoin/pull/2098#issuecomment-11304647,11304647,
Diapolo,2012-12-12T20:19:10Z,"Because I have the code and it's working fine, as it does, what it is intended for. Why is something unreasonable, if it's possible to do via some rather simple OS-calls?\n\nI added some code to print to the log when ReadFromDisk() and WriteToDisk() are called and at least ReadFromDisk() seems rather sequential during startup (talking about `Verifying last 2500 blocks at level 1` and `Rescanning l",https://github.com/bitcoin/bitcoin/pull/2098#issuecomment-11307634,11307634,
gavinandresen,2012-12-12T20:38:42Z,NACK. 88 more lines of code to maintain is a greater cost than the potential benefit here.\n,https://github.com/bitcoin/bitcoin/pull/2098#issuecomment-11308362,11308362,
sipa,2012-12-12T20:43:08Z,"First of all, dealing with fragmentation is a reasonable request. It's not Windows-specific by the way - if you don't allocate a file in one go, it will lead to fragmentation on just about every system and every filesystem. Pre-allocation is the solution to this, and it's already implemented. If Windows has a better way for pre-allocating than writing zeroes, sure provide an optimized version for ",https://github.com/bitcoin/bitcoin/pull/2098#issuecomment-11308525,11308525,
Diapolo,2012-12-12T20:49:47Z,"@sipa At least you try to clarify your position... though I don't agree on the 100 fragments part. The undofile size is a reasonable comment, but for blockfiles a to be filled 128MB file is clearly not wasted space. I'll keep using this with my local build, but guess I won't create a pull for that CAutoFile thing as I dislike Gavins dictatorial nature on patches, I put quite some time in...\n",https://github.com/bitcoin/bitcoin/pull/2098#issuecomment-11308767,11308767,
sipa,2012-12-13T11:50:06Z,"@Diapolo my suggestion:\n  1) implement AllocateFileRange for Windows (just inside the function body, using macros) that doesn't try to do more than that function intends.\n  2) If, after benchmarking with 1) you can still observe a noticable slowdown, we can increase the chunk size for Windows - or make it configurable in the first place.\n\nThat should have exactly the same effect as your curren",https://github.com/bitcoin/bitcoin/pull/2098#issuecomment-11331735,11331735,
