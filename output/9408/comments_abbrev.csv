paveljanik,2016-12-23T11:32:53Z,@luke-jr Two value enum aka bool? ;-),https://github.com/bitcoin/bitcoin/pull/9408#issuecomment-268977281,268977281,
MarcoFalke,2016-12-23T11:34:46Z,"I might be missing something here but imo it is intentional to always dump the full mempool. In case the user feels it is taking too long (to load the mempool) on their hardware, they can switch to a smaller mempool with `-maxmempool=`?",https://github.com/bitcoin/bitcoin/pull/9408#issuecomment-268977487,268977487,
paveljanik,2016-12-23T11:40:15Z,@MarcoFalke Imagine `mempool.dat` containing 300M of txs. User quits in the middle of loading it from the file. The mempool now contains ~150M of txs from the .dat file and some more txs from the network... What to do now?,https://github.com/bitcoin/bitcoin/pull/9408#issuecomment-268978096,268978096,
luke-jr,2016-12-23T12:29:47Z,@paveljanik Using an enum would give it clear values which cannot be accidentally cast to/from a number.,https://github.com/bitcoin/bitcoin/pull/9408#issuecomment-268983191,268983191,
jonasschnelli,2016-12-23T12:57:11Z,"From a software design perspective, LoadMempool has three major states...\na) successfully loaded mempool\nb) aborted, only partially loaded\nc) error, something went wrong\n\nThe decision if we should dump during shutdown should probably not be part of `LoadMempool()`.\nOnly a) and c) should result in a dump during shutdown, otherwise, we overwrite a correct dump with a partially loaded mem",https://github.com/bitcoin/bitcoin/pull/9408#issuecomment-268986220,268986220,
sipa,2016-12-23T13:01:05Z,"If you only have a partially loaded mempool file, but your node has been\nrunning for a week after that, we should probably dump again...\n",https://github.com/bitcoin/bitcoin/pull/9408#issuecomment-268986665,268986665,
jonasschnelli,2016-12-23T13:02:57Z,"> If you only have a partially loaded mempool file, but your node has been\nrunning for a week after that, we should probably dump again...\n\nYes. Partially loaded mempool is only possible with a user-triggered shutdown during `LoadMempool()`. This is why I named the stated `LoadMempoolResultUserAborted`.",https://github.com/bitcoin/bitcoin/pull/9408#issuecomment-268986872,268986872,
paveljanik,2016-12-23T13:04:59Z,"@jonasschnelli No, when the file is corrupted in the middle, you end up with partially loaded mempool.",https://github.com/bitcoin/bitcoin/pull/9408#issuecomment-268987109,268987109,
jonasschnelli,2016-12-23T13:21:31Z,"@paveljanik: Yes. Your right, I somehow though the mempool gets clear if a corruption was detected.\nSimplified after recommendation from @sipa. Reverted from enum to bool.",https://github.com/bitcoin/bitcoin/pull/9408#issuecomment-268988941,268988941,
rebroad,2016-12-28T02:39:48Z,testing this. seems to be working well so far.,https://github.com/bitcoin/bitcoin/pull/9408#issuecomment-269415838,269415838,
luke-jr,2017-01-04T19:28:32Z,utACK,https://github.com/bitcoin/bitcoin/pull/9408#issuecomment-270463097,270463097,
sipa,2017-01-04T20:10:28Z,utACK ef479e19e9e9279c8e22cff50227ea0722f59df3,https://github.com/bitcoin/bitcoin/pull/9408#issuecomment-270473489,270473489,
TheBlueMatt,2017-01-06T16:33:58Z,utACK 325e400f9ba89c6f5501c6cedd4dee979a3912b2 I'd call this a pretty bad regression if we cant get this for 0.14.,https://github.com/bitcoin/bitcoin/pull/9408#issuecomment-270943307,270943307,
MarcoFalke,2017-01-06T16:59:45Z,utACK 325e400,https://github.com/bitcoin/bitcoin/pull/9408#issuecomment-270949605,270949605,
paveljanik,2016-12-22T22:19:03Z,"I think this is a bit overkill. `bool` is there already. And returning `true` only in case of successful `mempool.dat` load is enough. The only question is what to return in case of corrupted `mempool.dat`. Returning `true` instead of `false` makes sense here. And when `true` is returned, dump mempool at shutdown.\n",https://github.com/bitcoin/bitcoin/pull/9408#discussion_r93705542,93705542,src/validation.h
jonasschnelli,2016-12-23T07:50:47Z,"IMO a simple `true|false` would not work. You need to distinct between...\n* not yet loaded = don't dump during shutdown\n* user_aborted (shutdown) = don't dump during shutdown\n* failed = dump during shutdown\n* successful = dump during shutdown\n\nReturning `false` in case of a user-triggered shutdown could work, but then you would need to return `true` in case of an input error (somehow n",https://github.com/bitcoin/bitcoin/pull/9408#discussion_r93737243,93737243,src/validation.h
luke-jr,2016-12-23T11:28:40Z,"If user aborts at T=5, and doesn't shut down the node, when it *does* finally shutdown at T=5000, you would want to dump it. This isn't possible, but the enum name doesn't make that clear. So a simply two-value enum with DoNotSave vs PleaseSave might be best?",https://github.com/bitcoin/bitcoin/pull/9408#discussion_r93755735,93755735,src/validation.h
instagibbs,2016-12-23T13:50:28Z,nit: `fDumpMempoolOnShutdown` seems more self-explanatory and precise.,https://github.com/bitcoin/bitcoin/pull/9408#discussion_r93767282,93767282,src/init.cpp
laanwj,2017-01-05T10:08:39Z,"Please don't make the qt shutdown sequence even more complicated :(\n\nWouldn't a better idea be to add StartShutdown here to app.requestShutdown, called from https://github.com/bitcoin/bitcoin/blob/master/src/qt/bitcoin.cpp#L691\n",https://github.com/bitcoin/bitcoin/pull/9408#discussion_r94741970,94741970,src/qt/bitcoingui.cpp
jonasschnelli,2017-01-05T11:41:04Z,"Argh. Yes. This is much simpler. Force push changed.\nRequest retests.",https://github.com/bitcoin/bitcoin/pull/9408#discussion_r94754038,94754038,src/qt/bitcoingui.cpp
