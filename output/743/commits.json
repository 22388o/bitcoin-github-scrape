[
  {
    "sha": "d237f62c2360107235fc75f4533711e98c70e2aa",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpkMjM3ZjYyYzIzNjAxMDcyMzVmYzc1ZjQ1MzM3MTFlOThjNzBlMmFh",
    "commit": {
      "author": {
        "name": "Gavin Andresen",
        "email": "gavinandresen@gmail.com",
        "date": "2012-01-03T20:24:28Z"
      },
      "committer": {
        "name": "Gavin Andresen",
        "email": "gavinandresen@gmail.com",
        "date": "2012-01-03T20:48:59Z"
      },
      "message": "-blocknotify=command argument, implemented using system() and boost::thread",
      "tree": {
        "sha": "cc91ec15cbefb109bc0506f12733a03f173c60a1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/cc91ec15cbefb109bc0506f12733a03f173c60a1"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d237f62c2360107235fc75f4533711e98c70e2aa",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d237f62c2360107235fc75f4533711e98c70e2aa",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/d237f62c2360107235fc75f4533711e98c70e2aa",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d237f62c2360107235fc75f4533711e98c70e2aa/comments",
    "author": {
      "login": "gavinandresen",
      "id": 331997,
      "node_id": "MDQ6VXNlcjMzMTk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/331997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gavinandresen",
      "html_url": "https://github.com/gavinandresen",
      "followers_url": "https://api.github.com/users/gavinandresen/followers",
      "following_url": "https://api.github.com/users/gavinandresen/following{/other_user}",
      "gists_url": "https://api.github.com/users/gavinandresen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gavinandresen/subscriptions",
      "organizations_url": "https://api.github.com/users/gavinandresen/orgs",
      "repos_url": "https://api.github.com/users/gavinandresen/repos",
      "events_url": "https://api.github.com/users/gavinandresen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gavinandresen/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "gavinandresen",
      "id": 331997,
      "node_id": "MDQ6VXNlcjMzMTk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/331997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gavinandresen",
      "html_url": "https://github.com/gavinandresen",
      "followers_url": "https://api.github.com/users/gavinandresen/followers",
      "following_url": "https://api.github.com/users/gavinandresen/following{/other_user}",
      "gists_url": "https://api.github.com/users/gavinandresen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gavinandresen/subscriptions",
      "organizations_url": "https://api.github.com/users/gavinandresen/orgs",
      "repos_url": "https://api.github.com/users/gavinandresen/repos",
      "events_url": "https://api.github.com/users/gavinandresen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gavinandresen/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "96d3bcb99690726d4c0e28355cc87c25e14f4c8d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/96d3bcb99690726d4c0e28355cc87c25e14f4c8d",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/96d3bcb99690726d4c0e28355cc87c25e14f4c8d"
      }
    ],
    "stats": {
      "total": 21,
      "additions": 20,
      "deletions": 1
    },
    "files": [
      {
        "sha": "a2e77b4233445227503e412d36f697b82b5dde9c",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d237f62c2360107235fc75f4533711e98c70e2aa/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d237f62c2360107235fc75f4533711e98c70e2aa/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=d237f62c2360107235fc75f4533711e98c70e2aa",
        "patch": "@@ -227,6 +227,7 @@ bool AppInit2(int argc, char* argv[])\n             \"  -rpcport=<port>  \\t\\t  \" + _(\"Listen for JSON-RPC connections on <port> (default: 8332)\") + \"\\n\" +\n             \"  -rpcallowip=<ip> \\t\\t  \" + _(\"Allow JSON-RPC connections from specified IP address\") + \"\\n\" +\n             \"  -rpcconnect=<ip> \\t  \"   + _(\"Send commands to node running on <ip> (default: 127.0.0.1)\") + \"\\n\" +\n+            \"  -blocknotify=<cmd> \"     + _(\"Execute command when the best block changes (%s in cmd is replaced by block hash)\") + \"\\n\" +\n             \"  -keypool=<n>     \\t  \"   + _(\"Set key pool size to <n> (default: 100)\") + \"\\n\" +\n             \"  -rescan          \\t  \"   + _(\"Rescan the block chain for missing wallet transactions\") + \"\\n\";\n "
      },
      {
        "sha": "52a3c3fde5133124d988c75b8788b776b8879ef8",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 19,
        "deletions": 1,
        "changes": 20,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d237f62c2360107235fc75f4533711e98c70e2aa/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d237f62c2360107235fc75f4533711e98c70e2aa/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=d237f62c2360107235fc75f4533711e98c70e2aa",
        "patch": "@@ -7,6 +7,7 @@\n #include \"db.h\"\n #include \"net.h\"\n #include \"init.h\"\n+#include <boost/algorithm/string/replace.hpp>\n #include <boost/filesystem.hpp>\n #include <boost/filesystem/fstream.hpp>\n \n@@ -1278,6 +1279,14 @@ bool static Reorganize(CTxDB& txdb, CBlockIndex* pindexNew)\n }\n \n \n+static void\n+runCommand(std::string strCommand)\n+{\n+    int nErr = ::system(strCommand.c_str());\n+    if (nErr)\n+        printf(\"runCommand error: system(%s) returned %d\\n\", strCommand.c_str(), nErr);\n+}\n+\n bool CBlock::SetBestChain(CTxDB& txdb, CBlockIndex* pindexNew)\n {\n     uint256 hash = GetHash();\n@@ -1321,7 +1330,8 @@ bool CBlock::SetBestChain(CTxDB& txdb, CBlockIndex* pindexNew)\n     }\n \n     // Update best block in wallet (so we can detect restored wallets)\n-    if (!IsInitialBlockDownload())\n+    bool fIsInitialDownload = IsInitialBlockDownload();\n+    if (!fIsInitialDownload)\n     {\n         const CBlockLocator locator(pindexNew);\n         ::SetBestChain(locator);\n@@ -1336,6 +1346,14 @@ bool CBlock::SetBestChain(CTxDB& txdb, CBlockIndex* pindexNew)\n     nTransactionsUpdated++;\n     printf(\"SetBestChain: new best=%s  height=%d  work=%s\\n\", hashBestChain.ToString().substr(0,20).c_str(), nBestHeight, bnBestChainWork.ToString().c_str());\n \n+    std::string strCmd = GetArg(\"-blocknotify\", \"\");\n+\n+    if (!fIsInitialDownload && !strCmd.empty())\n+    {\n+        boost::replace_all(strCmd, \"%s\", hashBestChain.GetHex());\n+        boost::thread t(runCommand, strCmd); // thread runs free\n+    }\n+\n     return true;\n }\n "
      }
    ]
  }
]