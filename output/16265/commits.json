[
  {
    "sha": "61433f43d25c39638617deab05542257d89d676e",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo2MTQzM2Y0M2QyNWMzOTYzODYxN2RlYWIwNTU0MjI1N2Q4OWQ2NzZl",
    "commit": {
      "author": {
        "name": "Aseem Sood",
        "email": "asood123@yahoo.com",
        "date": "2019-06-21T20:03:36Z"
      },
      "committer": {
        "name": "Aseem Sood",
        "email": "asood123@yahoo.com",
        "date": "2019-07-26T15:24:44Z"
      },
      "message": "Update check disk space in bitcoind",
      "tree": {
        "sha": "19ebdd4ceb3c70f395a0d54f1921c2d5389c667c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/19ebdd4ceb3c70f395a0d54f1921c2d5389c667c"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/61433f43d25c39638617deab05542257d89d676e",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/61433f43d25c39638617deab05542257d89d676e",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/61433f43d25c39638617deab05542257d89d676e",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/61433f43d25c39638617deab05542257d89d676e/comments",
    "author": {
      "login": "asood123",
      "id": 6106941,
      "node_id": "MDQ6VXNlcjYxMDY5NDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6106941?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/asood123",
      "html_url": "https://github.com/asood123",
      "followers_url": "https://api.github.com/users/asood123/followers",
      "following_url": "https://api.github.com/users/asood123/following{/other_user}",
      "gists_url": "https://api.github.com/users/asood123/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/asood123/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/asood123/subscriptions",
      "organizations_url": "https://api.github.com/users/asood123/orgs",
      "repos_url": "https://api.github.com/users/asood123/repos",
      "events_url": "https://api.github.com/users/asood123/events{/privacy}",
      "received_events_url": "https://api.github.com/users/asood123/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "asood123",
      "id": 6106941,
      "node_id": "MDQ6VXNlcjYxMDY5NDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6106941?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/asood123",
      "html_url": "https://github.com/asood123",
      "followers_url": "https://api.github.com/users/asood123/followers",
      "following_url": "https://api.github.com/users/asood123/following{/other_user}",
      "gists_url": "https://api.github.com/users/asood123/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/asood123/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/asood123/subscriptions",
      "organizations_url": "https://api.github.com/users/asood123/orgs",
      "repos_url": "https://api.github.com/users/asood123/repos",
      "events_url": "https://api.github.com/users/asood123/events{/privacy}",
      "received_events_url": "https://api.github.com/users/asood123/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "a54a12046e98c57512715041d30ecf2f0ab8f6dd",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a54a12046e98c57512715041d30ecf2f0ab8f6dd",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/a54a12046e98c57512715041d30ecf2f0ab8f6dd"
      }
    ],
    "stats": {
      "total": 23,
      "additions": 16,
      "deletions": 7
    },
    "files": [
      {
        "sha": "e7ef2c90cb3812acc48c903d4bff3d72ed8a5dea",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/61433f43d25c39638617deab05542257d89d676e/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/61433f43d25c39638617deab05542257d89d676e/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=61433f43d25c39638617deab05542257d89d676e",
        "patch": "@@ -1681,11 +1681,11 @@ bool AppInitMain(InitInterfaces& interfaces)\n \n     // ********************************************************* Step 11: import blocks\n \n-    if (!CheckDiskSpace(GetDataDir())) {\n+    if (!CheckDiskSpace(GetDataDir(), chainparams.AssumedBlockchainSize(), chainparams.AssumedChainStateSize(), nPruneTarget)) {\n         InitError(strprintf(_(\"Error: Disk space is low for %s\").translated, GetDataDir()));\n         return false;\n     }\n-    if (!CheckDiskSpace(GetBlocksDir())) {\n+    if (!CheckDiskSpace(GetBlocksDir(), chainparams.AssumedBlockchainSize(), chainparams.AssumedChainStateSize(), nPruneTarget)) {\n         InitError(strprintf(_(\"Error: Disk space is low for %s\").translated, GetBlocksDir()));\n         return false;\n     }"
      },
      {
        "sha": "94174c57ffb6efad35351525c2f63088b8da2652",
        "filename": "src/util/system.cpp",
        "status": "modified",
        "additions": 13,
        "deletions": 4,
        "changes": 17,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/61433f43d25c39638617deab05542257d89d676e/src/util/system.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/61433f43d25c39638617deab05542257d89d676e/src/util/system.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/util/system.cpp?ref=61433f43d25c39638617deab05542257d89d676e",
        "patch": "@@ -130,12 +130,21 @@ bool DirIsWritable(const fs::path& directory)\n     return true;\n }\n \n-bool CheckDiskSpace(const fs::path& dir, uint64_t additional_bytes)\n+bool CheckDiskSpace(const fs::path& dir, uint64_t blockchain_size, uint64_t chain_state_size, uint64_t prune_target_in_mib)\n {\n-    constexpr uint64_t min_disk_space = 52428800; // 50 MiB\n-\n     uint64_t free_bytes_available = fs::space(dir).available;\n-    return free_bytes_available >= min_disk_space + additional_bytes;\n+    uint64_t required_space = blockchain_size;\n+    constexpr uint64_t GB_BYTES{1000000000};\n+\n+    if (prune_target_in_mib) {\n+        uint64_t pruned_GBs = std::ceil(prune_target_in_mib * 1024 * 1024.0 / GB_BYTES);\n+        if (pruned_GBs <= required_space) {\n+            required_space = pruned_GBs;\n+        }\n+    }\n+    required_space += chain_state_size;\n+\n+    return free_bytes_available >= required_space;\n }\n \n /**"
      },
      {
        "sha": "70f8f46307935ab49f40b17168874df2eaaef6f0",
        "filename": "src/util/system.h",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/61433f43d25c39638617deab05542257d89d676e/src/util/system.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/61433f43d25c39638617deab05542257d89d676e/src/util/system.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/util/system.h?ref=61433f43d25c39638617deab05542257d89d676e",
        "patch": "@@ -59,7 +59,7 @@ bool RenameOver(fs::path src, fs::path dest);\n bool LockDirectory(const fs::path& directory, const std::string lockfile_name, bool probe_only=false);\n void UnlockDirectory(const fs::path& directory, const std::string& lockfile_name);\n bool DirIsWritable(const fs::path& directory);\n-bool CheckDiskSpace(const fs::path& dir, uint64_t additional_bytes = 0);\n+bool CheckDiskSpace(const fs::path& dir, uint64_t blockchain_size = 0, uint64_t chain_state_size = 0, uint64_t prune_target = 0);\n \n /** Release all directory locks. This is used for unit testing only, at runtime\n  * the global destructor will take care of the locks."
      }
    ]
  }
]