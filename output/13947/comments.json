[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/412347828",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#issuecomment-412347828",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13947",
    "id": 412347828,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxMjM0NzgyOA==",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-08-12T14:49:30Z",
    "updated_at": "2018-08-12T14:49:30Z",
    "author_association": "MEMBER",
    "body": "This is completely untested, so TODO:\r\n\r\n* add tests\r\n* use dandelion relay for our wallet txs",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/412347828/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/412356616",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#issuecomment-412356616",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13947",
    "id": 412356616,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxMjM1NjYxNg==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-08-12T17:02:42Z",
    "updated_at": "2018-08-23T22:26:46Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--e57a25ab6845829454e8d69fc972939a-->Note to reviewers: This pull request conflicts with the following ones:\n\n* #14032 (Add p2p layer encryption with ECDH/ChaCha20Poly1305 by jonasschnelli)\n* #13946 (p2p: Clarify control flow in ProcessMessage by MarcoFalke)\n* #13743 (refactor: Replace std/boost::bind with lambda by ken2812221)\n* #13123 (net: Add Clang thread safety annotations for guarded variables in the networking code by practicalswift)\n* #10102 ([experimental] Multiprocess bitcoin by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/412356616/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/412364201",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#issuecomment-412364201",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13947",
    "id": 412364201,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxMjM2NDIwMQ==",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?u=7999a16349f0df0fb273fffa18e5a955c9d3f11c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-08-12T18:57:41Z",
    "updated_at": "2018-08-12T18:57:41Z",
    "author_association": "MEMBER",
    "body": "This code doesn't seem to include a \"stempool\"; how does it deal with dandelion transactions that depend on other dandelion transactions? ATMP will fail for those.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/412364201/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/412368045",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#issuecomment-412368045",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13947",
    "id": 412368045,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxMjM2ODA0NQ==",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-08-12T20:02:45Z",
    "updated_at": "2020-01-16T00:54:59Z",
    "author_association": "MEMBER",
    "body": "> This code doesn't seem to include a \"stempool\"; how does it deal with dandelion transactions that depend on other dandelion transactions? ATMP will fail for those.\r\n\r\nContinued here https://botbot.me/freenode/bitcoin-core-dev/2018-08-12/?msg=103212266&page=2\r\nEDIT by ajtowns: http://www.erisian.com.au/bitcoin-core-dev/log-2018-08-12.html#l-190",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/412368045/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/415981527",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#issuecomment-415981527",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13947",
    "id": 415981527,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxNTk4MTUyNw==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-08-25T16:40:26Z",
    "updated_at": "2018-08-25T16:40:26Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/415981527/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/422705890",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#issuecomment-422705890",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13947",
    "id": 422705890,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyMjcwNTg5MA==",
    "user": {
      "login": "scravy",
      "id": 295504,
      "node_id": "MDQ6VXNlcjI5NTUwNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/295504?u=2a4edf68591d46bd1020f83e83b156ef510cc194&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/scravy",
      "html_url": "https://github.com/scravy",
      "followers_url": "https://api.github.com/users/scravy/followers",
      "following_url": "https://api.github.com/users/scravy/following{/other_user}",
      "gists_url": "https://api.github.com/users/scravy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/scravy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/scravy/subscriptions",
      "organizations_url": "https://api.github.com/users/scravy/orgs",
      "repos_url": "https://api.github.com/users/scravy/repos",
      "events_url": "https://api.github.com/users/scravy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/scravy/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-19T08:22:56Z",
    "updated_at": "2018-09-19T08:22:56Z",
    "author_association": "CONTRIBUTOR",
    "body": "Shouldn't the functional test from the reference implementation (https://github.com/dandelion-org/bitcoin/commit/d043e36bbe9249a78cf751c80b8d876b7d9f07ea#diff-21ab9447686d819eeeb7668ce8011e0d) run more-or-less unchanged on top of this branch?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/422705890/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/426470989",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#issuecomment-426470989",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13947",
    "id": 426470989,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyNjQ3MDk4OQ==",
    "user": {
      "login": "jb55",
      "id": 45598,
      "node_id": "MDQ6VXNlcjQ1NTk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/45598?u=2ba2cccaa0fd357b363507ce5694ce3cf5e56220&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jb55",
      "html_url": "https://github.com/jb55",
      "followers_url": "https://api.github.com/users/jb55/followers",
      "following_url": "https://api.github.com/users/jb55/following{/other_user}",
      "gists_url": "https://api.github.com/users/jb55/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jb55/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jb55/subscriptions",
      "organizations_url": "https://api.github.com/users/jb55/orgs",
      "repos_url": "https://api.github.com/users/jb55/repos",
      "events_url": "https://api.github.com/users/jb55/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jb55/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-10-03T00:08:25Z",
    "updated_at": "2018-10-03T00:08:25Z",
    "author_association": "CONTRIBUTOR",
    "body": "These commits could be documented more in general, I'm finding it hard to review when there are no descriptions about what is being implemented.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/426470989/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/428165411",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#issuecomment-428165411",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13947",
    "id": 428165411,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyODE2NTQxMQ==",
    "user": {
      "login": "AM5800",
      "id": 621585,
      "node_id": "MDQ6VXNlcjYyMTU4NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/621585?u=2850ba85eb6412c9e616a609180d84460bbb3bfe&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AM5800",
      "html_url": "https://github.com/AM5800",
      "followers_url": "https://api.github.com/users/AM5800/followers",
      "following_url": "https://api.github.com/users/AM5800/following{/other_user}",
      "gists_url": "https://api.github.com/users/AM5800/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AM5800/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AM5800/subscriptions",
      "organizations_url": "https://api.github.com/users/AM5800/orgs",
      "repos_url": "https://api.github.com/users/AM5800/repos",
      "events_url": "https://api.github.com/users/AM5800/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AM5800/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-10-09T12:01:52Z",
    "updated_at": "2018-10-09T12:01:52Z",
    "author_association": "NONE",
    "body": "It has been mentioned several times that common stempool might leak dandelion routing information to an adversary. Can someone help me understand how exactly?\r\n\r\nAlso, what is the current status of this issue? I would like to offer some help. For example with tests",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/428165411/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/428173172",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#issuecomment-428173172",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13947",
    "id": 428173172,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyODE3MzE3Mg==",
    "user": {
      "login": "scravy",
      "id": 295504,
      "node_id": "MDQ6VXNlcjI5NTUwNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/295504?u=2a4edf68591d46bd1020f83e83b156ef510cc194&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/scravy",
      "html_url": "https://github.com/scravy",
      "followers_url": "https://api.github.com/users/scravy/followers",
      "following_url": "https://api.github.com/users/scravy/following{/other_user}",
      "gists_url": "https://api.github.com/users/scravy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/scravy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/scravy/subscriptions",
      "organizations_url": "https://api.github.com/users/scravy/orgs",
      "repos_url": "https://api.github.com/users/scravy/repos",
      "events_url": "https://api.github.com/users/scravy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/scravy/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-10-09T12:30:34Z",
    "updated_at": "2018-10-09T12:30:34Z",
    "author_association": "CONTRIBUTOR",
    "body": "@jb55 BIP156 should explain a lot of things.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/428173172/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/428258554",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#issuecomment-428258554",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13947",
    "id": 428258554,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyODI1ODU1NA==",
    "user": {
      "login": "jb55",
      "id": 45598,
      "node_id": "MDQ6VXNlcjQ1NTk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/45598?u=2ba2cccaa0fd357b363507ce5694ce3cf5e56220&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jb55",
      "html_url": "https://github.com/jb55",
      "followers_url": "https://api.github.com/users/jb55/followers",
      "following_url": "https://api.github.com/users/jb55/following{/other_user}",
      "gists_url": "https://api.github.com/users/jb55/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jb55/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jb55/subscriptions",
      "organizations_url": "https://api.github.com/users/jb55/orgs",
      "repos_url": "https://api.github.com/users/jb55/repos",
      "events_url": "https://api.github.com/users/jb55/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jb55/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-10-09T16:24:20Z",
    "updated_at": "2018-10-09T16:24:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "@scravy I'm more interested in documentation of the implementation itself, how each commit relates to a part of the bip, etc. It's much harder to verify an implementation without that, especially with important privacy/security features. I don't think we should be making it harder on reviewers than it needs to be.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/428258554/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/428280624",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#issuecomment-428280624",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13947",
    "id": 428280624,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyODI4MDYyNA==",
    "user": {
      "login": "stevenroose",
      "id": 853468,
      "node_id": "MDQ6VXNlcjg1MzQ2OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/853468?u=f801880316b53c06b8825aa9b422322f832428c0&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stevenroose",
      "html_url": "https://github.com/stevenroose",
      "followers_url": "https://api.github.com/users/stevenroose/followers",
      "following_url": "https://api.github.com/users/stevenroose/following{/other_user}",
      "gists_url": "https://api.github.com/users/stevenroose/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stevenroose/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stevenroose/subscriptions",
      "organizations_url": "https://api.github.com/users/stevenroose/orgs",
      "repos_url": "https://api.github.com/users/stevenroose/repos",
      "events_url": "https://api.github.com/users/stevenroose/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stevenroose/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-10-09T17:30:31Z",
    "updated_at": "2018-10-09T17:30:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "@jb55 Totally agree. All the non-trivial pieces of code should explain themselves, refer to the BIP when relevant, etc..",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/428280624/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/460242540",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#issuecomment-460242540",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13947",
    "id": 460242540,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MDI0MjU0MA==",
    "user": {
      "login": "riclas",
      "id": 87633,
      "node_id": "MDQ6VXNlcjg3NjMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/87633?u=3b2fd73d2b7e4d6e92f5dd70955b4a417eacb712&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/riclas",
      "html_url": "https://github.com/riclas",
      "followers_url": "https://api.github.com/users/riclas/followers",
      "following_url": "https://api.github.com/users/riclas/following{/other_user}",
      "gists_url": "https://api.github.com/users/riclas/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/riclas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/riclas/subscriptions",
      "organizations_url": "https://api.github.com/users/riclas/orgs",
      "repos_url": "https://api.github.com/users/riclas/repos",
      "events_url": "https://api.github.com/users/riclas/events{/privacy}",
      "received_events_url": "https://api.github.com/users/riclas/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-04T13:03:10Z",
    "updated_at": "2019-02-04T13:03:10Z",
    "author_association": "NONE",
    "body": "I believe this explanation of the DDoS possibilities on Dandelion by @sdaftuar belongs here:\r\nhttps://bitcoin.stackexchange.com/questions/81503/what-is-the-tradeoff-between-privacy-and-implementation-complexity-of-dandelion\r\n\r\nregarding option b), maybe dynamically adjusting stem % according to fullness of the stempool/cache could be a solution? at worst, we would fluff all the time just like a regular tx spam attack.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/460242540/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/513858189",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#issuecomment-513858189",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13947",
    "id": 513858189,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxMzg1ODE4OQ==",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-07-22T16:33:59Z",
    "updated_at": "2019-07-22T16:33:59Z",
    "author_association": "MEMBER",
    "body": "I closed this for now because it is non-trivial to allow for all wallet behavior (e.g. cpfp and rbf) while not opening DOS vectors. I think a simpler first step would be to go for \"Dandelion Light\" or \"Dandelion one-hop\".\r\n\r\nThat approach would not need any DOS protection, since the only sender is our own wallet and the next hop would already fluff the tx (and send it back to us, so that our wallet can know it made it into the mempool eventually)",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/513858189/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209457937",
    "pull_request_review_id": 145477144,
    "id": 209457937,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwOTQ1NzkzNw==",
    "diff_hunk": "@@ -755,6 +778,10 @@ class CNode\n     // Our address, as reported by the peer\n     CService addrLocal;\n     mutable CCriticalSection cs_addrLocal;\n+\n+    /** Our current dandelion destination */\n+    CConnman::DandelionPeer* m_dandelion_destination /* GUARDED_BY(CConnman::cs_dandelion_peers) */ {nullptr};",
    "path": "src/net.h",
    "position": 134,
    "original_position": 109,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "fb55529f3004ce7a79873f7ca858e0435f3c5922",
    "user": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Any drawbacks from uncommenting the `GUARDED_BY(\u2026)` annotation?",
    "created_at": "2018-08-12T14:50:34Z",
    "updated_at": "2018-08-21T17:07:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r209457937",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209457937"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r209457937"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209457937/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 800,
    "original_line": 800,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209458447",
    "pull_request_review_id": 145477668,
    "id": 209458447,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwOTQ1ODQ0Nw==",
    "diff_hunk": "@@ -755,6 +778,10 @@ class CNode\n     // Our address, as reported by the peer\n     CService addrLocal;\n     mutable CCriticalSection cs_addrLocal;\n+\n+    /** Our current dandelion destination */\n+    CConnman::DandelionPeer* m_dandelion_destination /* GUARDED_BY(CConnman::cs_dandelion_peers) */ {nullptr};",
    "path": "src/net.h",
    "position": 134,
    "original_position": 109,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "fb55529f3004ce7a79873f7ca858e0435f3c5922",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "The drawback was that it didn't compile for me",
    "created_at": "2018-08-12T15:05:26Z",
    "updated_at": "2018-08-21T17:07:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r209458447",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209458447"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r209458447"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209458447/reactions",
      "total_count": 8,
      "+1": 0,
      "-1": 0,
      "laugh": 8,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 800,
    "original_line": 800,
    "side": "RIGHT",
    "in_reply_to_id": 209457937
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209458535",
    "pull_request_review_id": 145477748,
    "id": 209458535,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwOTQ1ODUzNQ==",
    "diff_hunk": "@@ -1027,6 +1031,12 @@ bool AppInitParameterInteraction()\n         LogPrintf(\"Warning: nMinimumChainWork set below default value of %s\\n\", chainparams.GetConsensus().nMinimumChainWork.GetHex());\n     }\n \n+    {\n+        const int64_t pct = gArgs.GetArg(\"-dandelion\", DEFAULT_DANDELION_STEM_PERCENTAGE);\n+        if (pct < 0 || 100 < pct) return InitError(_(\"-dandelion must be 0 or a percentage less than 100\"));",
    "path": "src/init.cpp",
    "position": null,
    "original_position": 29,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "615b7dc0b03135df5d8102aa2f2b192dc8317b6f",
    "user": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Should `-dandelion=100` generate an error message? From the error message it looks like it should, but not from the logic :-)",
    "created_at": "2018-08-12T15:08:07Z",
    "updated_at": "2018-08-21T17:07:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r209458535",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209458535"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r209458535"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209458535/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1036,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209458598",
    "pull_request_review_id": 145477805,
    "id": 209458598,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwOTQ1ODU5OA==",
    "diff_hunk": "@@ -1027,6 +1031,12 @@ bool AppInitParameterInteraction()\n         LogPrintf(\"Warning: nMinimumChainWork set below default value of %s\\n\", chainparams.GetConsensus().nMinimumChainWork.GetHex());\n     }\n \n+    {\n+        const int64_t pct = gArgs.GetArg(\"-dandelion\", DEFAULT_DANDELION_STEM_PERCENTAGE);\n+        if (pct < 0 || 100 < pct) return InitError(_(\"-dandelion must be 0 or a percentage less than 100\"));",
    "path": "src/init.cpp",
    "position": null,
    "original_position": 29,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "615b7dc0b03135df5d8102aa2f2b192dc8317b6f",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "100% is allowed to always extend the stem by one hop. So the interval is [0, 100]. ",
    "created_at": "2018-08-12T15:10:30Z",
    "updated_at": "2018-08-21T17:07:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r209458598",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209458598"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r209458598"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209458598/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1036,
    "side": "RIGHT",
    "in_reply_to_id": 209458535
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209464321",
    "pull_request_review_id": 145483417,
    "id": 209464321,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwOTQ2NDMyMQ==",
    "diff_hunk": "@@ -33,6 +33,7 @@ BIPs that are implemented by Bitcoin Core (up-to-date up to **v0.17.0**):\n * [`BIP 145`](https://github.com/bitcoin/bips/blob/master/bip-0145.mediawiki): getblocktemplate updates for Segregated Witness as of **v0.13.0** ([PR 8149](https://github.com/bitcoin/bitcoin/pull/8149)).\n * [`BIP 147`](https://github.com/bitcoin/bips/blob/master/bip-0147.mediawiki): NULLDUMMY softfork as of **v0.13.1** ([PR 8636](https://github.com/bitcoin/bitcoin/pull/8636) and [PR 8937](https://github.com/bitcoin/bitcoin/pull/8937)).\n * [`BIP 152`](https://github.com/bitcoin/bips/blob/master/bip-0152.mediawiki): Compact block transfer and related optimizations are used as of **v0.13.0** ([PR 8068](https://github.com/bitcoin/bitcoin/pull/8068)).\n+* [`BIP 156`](https://github.com/bitcoin/bips/blob/master/bip-0156.mediawiki): Dandelion transaction relay is supported as of **v0.18.0** ([PR 13947](https://github.com/bitcoin/bitcoin/pull/13947)).",
    "path": "doc/bips.md",
    "position": 4,
    "original_position": 4,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "615b7dc0b03135df5d8102aa2f2b192dc8317b6f",
    "user": {
      "login": "clodhopp",
      "id": 22253497,
      "node_id": "MDQ6VXNlcjIyMjUzNDk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/22253497?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/clodhopp",
      "html_url": "https://github.com/clodhopp",
      "followers_url": "https://api.github.com/users/clodhopp/followers",
      "following_url": "https://api.github.com/users/clodhopp/following{/other_user}",
      "gists_url": "https://api.github.com/users/clodhopp/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/clodhopp/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/clodhopp/subscriptions",
      "organizations_url": "https://api.github.com/users/clodhopp/orgs",
      "repos_url": "https://api.github.com/users/clodhopp/repos",
      "events_url": "https://api.github.com/users/clodhopp/events{/privacy}",
      "received_events_url": "https://api.github.com/users/clodhopp/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Link https://github.com/bitcoin/bips/blob/master/bip-0156.mediawiki gives error 404 page not found.",
    "created_at": "2018-08-12T18:44:34Z",
    "updated_at": "2018-08-21T17:07:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r209464321",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "NONE",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209464321"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r209464321"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209464321/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 36,
    "original_line": 36,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209514909",
    "pull_request_review_id": 145541678,
    "id": 209514909,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwOTUxNDkwOQ==",
    "diff_hunk": "@@ -33,6 +33,7 @@ BIPs that are implemented by Bitcoin Core (up-to-date up to **v0.17.0**):\n * [`BIP 145`](https://github.com/bitcoin/bips/blob/master/bip-0145.mediawiki): getblocktemplate updates for Segregated Witness as of **v0.13.0** ([PR 8149](https://github.com/bitcoin/bitcoin/pull/8149)).\n * [`BIP 147`](https://github.com/bitcoin/bips/blob/master/bip-0147.mediawiki): NULLDUMMY softfork as of **v0.13.1** ([PR 8636](https://github.com/bitcoin/bitcoin/pull/8636) and [PR 8937](https://github.com/bitcoin/bitcoin/pull/8937)).\n * [`BIP 152`](https://github.com/bitcoin/bips/blob/master/bip-0152.mediawiki): Compact block transfer and related optimizations are used as of **v0.13.0** ([PR 8068](https://github.com/bitcoin/bitcoin/pull/8068)).\n+* [`BIP 156`](https://github.com/bitcoin/bips/blob/master/bip-0156.mediawiki): Dandelion transaction relay is supported as of **v0.18.0** ([PR 13947](https://github.com/bitcoin/bitcoin/pull/13947)).",
    "path": "doc/bips.md",
    "position": 4,
    "original_position": 4,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "615b7dc0b03135df5d8102aa2f2b192dc8317b6f",
    "user": {
      "login": "meshcollider",
      "id": 3211283,
      "node_id": "MDQ6VXNlcjMyMTEyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3211283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meshcollider",
      "html_url": "https://github.com/meshcollider",
      "followers_url": "https://api.github.com/users/meshcollider/followers",
      "following_url": "https://api.github.com/users/meshcollider/following{/other_user}",
      "gists_url": "https://api.github.com/users/meshcollider/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
      "organizations_url": "https://api.github.com/users/meshcollider/orgs",
      "repos_url": "https://api.github.com/users/meshcollider/repos",
      "events_url": "https://api.github.com/users/meshcollider/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meshcollider/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "@clodhopp that's because the BIP PR hasn't been merged, you can see it here: https://github.com/bitcoin/bips/pull/703\r\nOnce merged, the link should work",
    "created_at": "2018-08-13T07:38:29Z",
    "updated_at": "2018-08-21T17:07:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r209514909",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209514909"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r209514909"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209514909/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 36,
    "original_line": 36,
    "side": "RIGHT",
    "in_reply_to_id": 209464321
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209515761",
    "pull_request_review_id": 145542753,
    "id": 209515761,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwOTUxNTc2MQ==",
    "diff_hunk": "@@ -1027,6 +1031,12 @@ bool AppInitParameterInteraction()\n         LogPrintf(\"Warning: nMinimumChainWork set below default value of %s\\n\", chainparams.GetConsensus().nMinimumChainWork.GetHex());\n     }\n \n+    {\n+        const int64_t pct = gArgs.GetArg(\"-dandelion\", DEFAULT_DANDELION_STEM_PERCENTAGE);\n+        if (pct < 0 || 100 < pct) return InitError(_(\"-dandelion must be 0 or a percentage less than 100\"));",
    "path": "src/init.cpp",
    "position": null,
    "original_position": 29,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "615b7dc0b03135df5d8102aa2f2b192dc8317b6f",
    "user": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Then the error message should be `-dandelion must be 0 or a percentage up to 100` or something equivalent?",
    "created_at": "2018-08-13T07:42:44Z",
    "updated_at": "2018-08-21T17:07:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r209515761",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209515761"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r209515761"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209515761/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1036,
    "side": "RIGHT",
    "in_reply_to_id": 209458535
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209656514",
    "pull_request_review_id": 145711271,
    "id": 209656514,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwOTY1NjUxNA==",
    "diff_hunk": "@@ -793,10 +794,13 @@ void InitParameterInteraction()\n             LogPrintf(\"%s: parameter interaction: -externalip set -> setting -discover=0\\n\", __func__);\n     }\n \n-    // disable whitelistrelay in blocksonly mode\n     if (gArgs.GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY)) {\n+        // disable whitelistrelay and dandelion in blocksonly mode\n         if (gArgs.SoftSetBoolArg(\"-whitelistrelay\", false))\n             LogPrintf(\"%s: parameter interaction: -blocksonly=1 -> setting -whitelistrelay=0\\n\", __func__);\n+        if (gArgs.SoftSetBoolArg(\"-dandelion\", false)) {",
    "path": "src/init.cpp",
    "position": 17,
    "original_position": 17,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "fb55529f3004ce7a79873f7ca858e0435f3c5922",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Do we use `SoftSetBoolArg()` like this elsewhere, on arguments that take numeric values?  It was not clear to me that this worked until I saw that SoftSetBoolArg converts the `false` to `std::string(\"0\")`.  (Neat, though.)",
    "created_at": "2018-08-13T15:35:47Z",
    "updated_at": "2018-08-21T17:07:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r209656514",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209656514"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r209656514"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209656514/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 801,
    "original_line": 801,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209723064",
    "pull_request_review_id": 145711271,
    "id": 209723064,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwOTcyMzA2NA==",
    "diff_hunk": "@@ -803,7 +847,19 @@ class CNode\n         nRefCount--;\n     }\n \n+    /** If this peer is not yet connected or soon to be disconnected */\n+    bool IsEphermal() const",
    "path": "src/net.h",
    "position": null,
    "original_position": 144,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "615b7dc0b03135df5d8102aa2f2b192dc8317b6f",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: IsEphemeral",
    "created_at": "2018-08-13T19:03:21Z",
    "updated_at": "2018-08-21T17:07:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r209723064",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209723064"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r209723064"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209723064/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 851,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209724300",
    "pull_request_review_id": 145711271,
    "id": 209724300,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwOTcyNDMwMA==",
    "diff_hunk": "@@ -2187,6 +2251,67 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n     }\n \n \n+    else if (strCommand == NetMsgType::TX_DANDELION) {\n+        // Stop processing the transaction early if\n+        // dandelion is disabled and peer is either not whitelisted or whitelistrelay is off\n+        if (!CNode::IsDandelionEnabled()&& (!pfrom->fWhitelisted || !gArgs.GetBoolArg(\"-whitelistrelay\", DEFAULT_WHITELISTRELAY))) {",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 107,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "615b7dc0b03135df5d8102aa2f2b192dc8317b6f",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Some IRC discussion around not extending whitelist-relay behavior further with dandelion processing:\r\nhttps://botbot.me/freenode/bitcoin-core-dev/2018-08-13/?msg=103271568&page=3",
    "created_at": "2018-08-13T19:07:43Z",
    "updated_at": "2018-08-21T17:07:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r209724300",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209724300"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r209724300"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209724300/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2257,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209725200",
    "pull_request_review_id": 145711271,
    "id": 209725200,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwOTcyNTIwMA==",
    "diff_hunk": "@@ -2187,6 +2251,67 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n     }\n \n \n+    else if (strCommand == NetMsgType::TX_DANDELION) {\n+        // Stop processing the transaction early if\n+        // dandelion is disabled and peer is either not whitelisted or whitelistrelay is off\n+        if (!CNode::IsDandelionEnabled()&& (!pfrom->fWhitelisted || !gArgs.GetBoolArg(\"-whitelistrelay\", DEFAULT_WHITELISTRELAY))) {\n+            LogPrint(BCLog::NET, \"dandelion transaction sent in violation of protocol peer=%d\\n\", pfrom->GetId());\n+            return true;\n+        }\n+\n+        CTransactionRef tx;\n+        vRecv >> tx;\n+\n+        LogPrint(BCLog::DANDELION, \"Dandelion: peer=%d: %s \", pfrom->GetId(), tx->GetHash().ToString()); /* Continued */\n+\n+        if (pfrom->m_cache_dandelion_size > MAX_DANDELION_CACHE_SZ) {\n+            LogPrint(BCLog::DANDELION, \"full cache (size: %d)\\n\", pfrom->m_cache_dandelion_size);\n+            return true;\n+        }\n+\n+        LOCK(cs_main);\n+        if (AlreadyHave(CInv{MSG_TX, tx->GetHash()})) {\n+            LogPrint(BCLog::DANDELION, \"already have\\n\");\n+            return true;\n+        }\n+\n+        CValidationState state;\n+        bool missing_inputs;\n+        if (AcceptToMemoryPool(mempool, state, tx, &missing_inputs, nullptr /* lRemovedTxn */, false /* bypass_limits */, 0 /* nAbsurdFee */, true /* test_accept */)) {\n+            RelayDandelionTransaction(mempool, pfrom, tx, msgMaker, connman);\n+            return true;\n+        }\n+        if (missing_inputs) {\n+            LogPrint(BCLog::DANDELION, \"missing inputs\\n\");\n+            return true;\n+        }\n+\n+        if (pfrom->fWhitelisted && gArgs.GetBoolArg(\"-whitelistforcerelay\", DEFAULT_WHITELISTFORCERELAY)) {",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 139,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "615b7dc0b03135df5d8102aa2f2b192dc8317b6f",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "See above comment about dropping this behavior for whitelisted peers.",
    "created_at": "2018-08-13T19:11:01Z",
    "updated_at": "2018-08-21T17:07:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r209725200",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209725200"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r209725200"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209725200/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2289,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209728695",
    "pull_request_review_id": 145711271,
    "id": 209728695,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwOTcyODY5NQ==",
    "diff_hunk": "@@ -120,6 +120,11 @@ extern const char *GETHEADERS;\n  * @see https://bitcoin.org/en/developer-reference#tx\n  */\n extern const char *TX;\n+/**\n+ * The dandelion tx message transmits a single transaction.\n+ * @see https://github.com/bitcoin/bips/blob/master/bip-0156.mediawiki\n+ */\n+extern const char* TX_DANDELION;",
    "path": "src/protocol.h",
    "position": 8,
    "original_position": 8,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "8c27c3b6bfd6417f1d62a6b25f1afeec0f1c4770",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think in the past, we've usually bumped the protocol version when introducing new p2p messages so that we only send the new messages (like ACCEPT_DANDELION) to peers that are signaling that they've upgraded.  Not sure how important that is...",
    "created_at": "2018-08-13T19:23:54Z",
    "updated_at": "2018-08-21T17:07:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r209728695",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209728695"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r209728695"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209728695/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 127,
    "original_line": 127,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209741626",
    "pull_request_review_id": 145815025,
    "id": 209741626,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwOTc0MTYyNg==",
    "diff_hunk": "@@ -120,6 +120,11 @@ extern const char *GETHEADERS;\n  * @see https://bitcoin.org/en/developer-reference#tx\n  */\n extern const char *TX;\n+/**\n+ * The dandelion tx message transmits a single transaction.\n+ * @see https://github.com/bitcoin/bips/blob/master/bip-0156.mediawiki\n+ */\n+extern const char* TX_DANDELION;",
    "path": "src/protocol.h",
    "position": 8,
    "original_position": 8,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "8c27c3b6bfd6417f1d62a6b25f1afeec0f1c4770",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Note that we'd never send a `TX_DANDELION` to a peer that never sent us `ACCEPT_DANDELION` in the first place. So I don't think this is an issue at all. ",
    "created_at": "2018-08-13T20:09:23Z",
    "updated_at": "2018-08-21T17:07:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r209741626",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209741626"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r209741626"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/209741626/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 127,
    "original_line": 127,
    "side": "RIGHT",
    "in_reply_to_id": 209728695
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/210019853",
    "pull_request_review_id": 146148782,
    "id": 210019853,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMDAxOTg1Mw==",
    "diff_hunk": "@@ -120,6 +120,11 @@ extern const char *GETHEADERS;\n  * @see https://bitcoin.org/en/developer-reference#tx\n  */\n extern const char *TX;\n+/**\n+ * The dandelion tx message transmits a single transaction.\n+ * @see https://github.com/bitcoin/bips/blob/master/bip-0156.mediawiki\n+ */\n+extern const char* TX_DANDELION;",
    "path": "src/protocol.h",
    "position": 8,
    "original_position": 8,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "8c27c3b6bfd6417f1d62a6b25f1afeec0f1c4770",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Perhaps my comment was not placed on the right line of this file; I was thinking of the dandelionacc message.  With sendheaders and I think compact blocks, I believe we bumped the protocol version and only tried to send the new p2p messages (even for handshaking/negotiating the protocol to use) to peers with that higher version?",
    "created_at": "2018-08-14T16:32:46Z",
    "updated_at": "2018-08-21T17:07:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r210019853",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/210019853"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r210019853"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/210019853/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 127,
    "original_line": 127,
    "side": "RIGHT",
    "in_reply_to_id": 209728695
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/210027127",
    "pull_request_review_id": 146157752,
    "id": 210027127,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMDAyNzEyNw==",
    "diff_hunk": "@@ -120,6 +120,11 @@ extern const char *GETHEADERS;\n  * @see https://bitcoin.org/en/developer-reference#tx\n  */\n extern const char *TX;\n+/**\n+ * The dandelion tx message transmits a single transaction.\n+ * @see https://github.com/bitcoin/bips/blob/master/bip-0156.mediawiki\n+ */\n+extern const char* TX_DANDELION;",
    "path": "src/protocol.h",
    "position": 8,
    "original_position": 8,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "8c27c3b6bfd6417f1d62a6b25f1afeec0f1c4770",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Good point. I think it is a lot easier to do this without enforcing a global network version bump.\r\n\r\nNote that the `dandelionacc` message is properly read by all nodes that implement dandelion (regardless of their network protocol version) or choose to ignore that message. And for all other nodes (that are completely unaware of dandelion) they simply treat this as unknown message (once per connection) in their logs. I think this one debug log is not enough reason to go through the hassle of bumping the protocol version.\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/63f8b0128b2aac3b25c6ec4d2f5bda213033162a/src/net_processing.cpp#L2942",
    "created_at": "2018-08-14T16:55:22Z",
    "updated_at": "2018-08-21T17:07:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r210027127",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/210027127"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r210027127"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/210027127/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 127,
    "original_line": 127,
    "side": "RIGHT",
    "in_reply_to_id": 209728695
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/210074699",
    "pull_request_review_id": 146215821,
    "id": 210074699,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMDA3NDY5OQ==",
    "diff_hunk": "@@ -2196,6 +2251,67 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n     }\n \n \n+    else if (strCommand == NetMsgType::TX_DANDELION) {\n+        // Stop processing the transaction early if\n+        // dandelion is disabled and peer is either not whitelisted or whitelistrelay is off\n+        if (!CNode::IsDandelionEnabled()&& (!pfrom->fWhitelisted || !gArgs.GetBoolArg(\"-whitelistrelay\", DEFAULT_WHITELISTRELAY))) {\n+            LogPrint(BCLog::NET, \"dandelion transaction sent in violation of protocol peer=%d\\n\", pfrom->GetId());\n+            return true;\n+        }\n+\n+        CTransactionRef tx;\n+        vRecv >> tx;\n+\n+        LogPrint(BCLog::DANDELION, \"Dandelion: peer=%d: %s \", pfrom->GetId(), tx->GetHash().ToString()); /* Continued */\n+\n+        if (pfrom->m_cache_dandelion_size > MAX_DANDELION_CACHE_SZ) {\n+            LogPrint(BCLog::DANDELION, \"full cache (size: %d)\\n\", pfrom->m_cache_dandelion_size);\n+            return true;\n+        }\n+\n+        LOCK(cs_main);\n+        if (AlreadyHave(CInv{MSG_TX, tx->GetHash()})) {\n+            LogPrint(BCLog::DANDELION, \"already have\\n\");\n+            return true;\n+        }\n+\n+        CValidationState state;\n+        bool missing_inputs;\n+        if (AcceptToMemoryPool(mempool, state, tx, &missing_inputs, nullptr /* lRemovedTxn */, false /* bypass_limits */, 0 /* nAbsurdFee */, true /* test_accept */)) {\n+            RelayDandelionTransaction(mempool, pfrom, tx, msgMaker, connman);",
    "path": "src/net_processing.cpp",
    "position": 130,
    "original_position": 108,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "f8386167e29124d1dddd6e14fb4552a2fea87c29",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think we should queue transactions for relay to a peer, rather than doing a direct send as is done here.  Otherwise transaction relay can fill up our send buffers and delay block relay.\r\n\r\nFurther our current transaction relay system batches transactions for relay and, at each broadcast time, we sort the to-be-relayed transactions for the purposes of prioritising transactions that have fewer ancestors and higher feerate.  I think being able to prioritise transactions with higher feerate for relay is probably useful (to prevent low-feerate transactions from harming propagation times of higher feerate transactions).",
    "created_at": "2018-08-14T19:25:14Z",
    "updated_at": "2018-08-21T17:07:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r210074699",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/210074699"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r210074699"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/210074699/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2280,
    "original_line": 2280,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/210104883",
    "pull_request_review_id": 146253518,
    "id": 210104883,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMDEwNDg4Mw==",
    "diff_hunk": "@@ -1908,6 +1967,11 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n         State(pfrom->GetId())->fPreferHeaders = true;\n     }\n \n+    else if (strCommand == NetMsgType::ACCEPT_DANDELION) {\n+        pfrom->m_accept_dandelion = true;\n+        return true;",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 94,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "615b7dc0b03135df5d8102aa2f2b192dc8317b6f",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Should write something to debug log here.",
    "created_at": "2018-08-14T21:10:39Z",
    "updated_at": "2018-08-21T17:07:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r210104883",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/210104883"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r210104883"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/210104883/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1973,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/210184480",
    "pull_request_review_id": 146345826,
    "id": 210184480,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMDE4NDQ4MA==",
    "diff_hunk": "@@ -2196,6 +2251,67 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n     }\n \n \n+    else if (strCommand == NetMsgType::TX_DANDELION) {\n+        // Stop processing the transaction early if\n+        // dandelion is disabled and peer is either not whitelisted or whitelistrelay is off\n+        if (!CNode::IsDandelionEnabled()&& (!pfrom->fWhitelisted || !gArgs.GetBoolArg(\"-whitelistrelay\", DEFAULT_WHITELISTRELAY))) {\n+            LogPrint(BCLog::NET, \"dandelion transaction sent in violation of protocol peer=%d\\n\", pfrom->GetId());\n+            return true;\n+        }\n+\n+        CTransactionRef tx;\n+        vRecv >> tx;\n+\n+        LogPrint(BCLog::DANDELION, \"Dandelion: peer=%d: %s \", pfrom->GetId(), tx->GetHash().ToString()); /* Continued */\n+\n+        if (pfrom->m_cache_dandelion_size > MAX_DANDELION_CACHE_SZ) {\n+            LogPrint(BCLog::DANDELION, \"full cache (size: %d)\\n\", pfrom->m_cache_dandelion_size);\n+            return true;\n+        }\n+\n+        LOCK(cs_main);\n+        if (AlreadyHave(CInv{MSG_TX, tx->GetHash()})) {\n+            LogPrint(BCLog::DANDELION, \"already have\\n\");\n+            return true;\n+        }\n+\n+        CValidationState state;\n+        bool missing_inputs;\n+        if (AcceptToMemoryPool(mempool, state, tx, &missing_inputs, nullptr /* lRemovedTxn */, false /* bypass_limits */, 0 /* nAbsurdFee */, true /* test_accept */)) {\n+            RelayDandelionTransaction(mempool, pfrom, tx, msgMaker, connman);",
    "path": "src/net_processing.cpp",
    "position": 130,
    "original_position": 108,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "f8386167e29124d1dddd6e14fb4552a2fea87c29",
    "user": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "it's also better for privacy against traffic analysis to batch things.",
    "created_at": "2018-08-15T06:55:29Z",
    "updated_at": "2018-08-21T17:07:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r210184480",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/210184480"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r210184480"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/210184480/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2280,
    "original_line": 2280,
    "side": "RIGHT",
    "in_reply_to_id": 210074699
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211254726",
    "pull_request_review_id": 147635022,
    "id": 211254726,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMTI1NDcyNg==",
    "diff_hunk": "@@ -399,6 +399,7 @@ void SetupServerArgs()\n     gArgs.AddArg(\"-bantime=<n>\", strprintf(\"Number of seconds to keep misbehaving peers from reconnecting (default: %u)\", DEFAULT_MISBEHAVING_BANTIME), false, OptionsCategory::CONNECTION);\n     gArgs.AddArg(\"-bind=<addr>\", \"Bind to given address and always listen on it. Use [host]:port notation for IPv6\", false, OptionsCategory::CONNECTION);\n     gArgs.AddArg(\"-connect=<ip>\", \"Connect only to the specified node; -connect=0 disables automatic connections (the rules for this peer are the same as for -addnode). This option can be specified multiple times to connect to multiple nodes.\", false, OptionsCategory::CONNECTION);\n+    gArgs.AddArg(\"-dandelion\", strprintf(\"Probability to extend the stem in Dandelion transaction relay by one hop (default: %d, 0 to disable dandelion)\", DEFAULT_DANDELION_STEM_PERCENTAGE), false, OptionsCategory::CONNECTION);",
    "path": "src/init.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "b508ed10f519f7a46266f778eabd83fea2b83622",
    "user": {
      "login": "stevenroose",
      "id": 853468,
      "node_id": "MDQ6VXNlcjg1MzQ2OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/853468?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stevenroose",
      "html_url": "https://github.com/stevenroose",
      "followers_url": "https://api.github.com/users/stevenroose/followers",
      "following_url": "https://api.github.com/users/stevenroose/following{/other_user}",
      "gists_url": "https://api.github.com/users/stevenroose/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stevenroose/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stevenroose/subscriptions",
      "organizations_url": "https://api.github.com/users/stevenroose/orgs",
      "repos_url": "https://api.github.com/users/stevenroose/repos",
      "events_url": "https://api.github.com/users/stevenroose/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stevenroose/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "A simple \"probability\" should a number between 0 and 1. The variable used as default and the code below suggest a percentage is used instead. I think it would make sense to document it as such as well.",
    "created_at": "2018-08-20T13:09:20Z",
    "updated_at": "2018-08-21T17:07:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r211254726",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211254726"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r211254726"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211254726/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 402,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211255070",
    "pull_request_review_id": 147635022,
    "id": 211255070,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMTI1NTA3MA==",
    "diff_hunk": "@@ -793,10 +794,13 @@ void InitParameterInteraction()\n             LogPrintf(\"%s: parameter interaction: -externalip set -> setting -discover=0\\n\", __func__);\n     }\n \n-    // disable whitelistrelay in blocksonly mode\n     if (gArgs.GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY)) {\n+        // disable whitelistrelay and dandelion in blocksonly mode\n         if (gArgs.SoftSetBoolArg(\"-whitelistrelay\", false))\n             LogPrintf(\"%s: parameter interaction: -blocksonly=1 -> setting -whitelistrelay=0\\n\", __func__);\n+        if (gArgs.SoftSetBoolArg(\"-dandelion\", false)) {",
    "path": "src/init.cpp",
    "position": 17,
    "original_position": 17,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "fb55529f3004ce7a79873f7ca858e0435f3c5922",
    "user": {
      "login": "stevenroose",
      "id": 853468,
      "node_id": "MDQ6VXNlcjg1MzQ2OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/853468?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stevenroose",
      "html_url": "https://github.com/stevenroose",
      "followers_url": "https://api.github.com/users/stevenroose/followers",
      "following_url": "https://api.github.com/users/stevenroose/following{/other_user}",
      "gists_url": "https://api.github.com/users/stevenroose/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stevenroose/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stevenroose/subscriptions",
      "organizations_url": "https://api.github.com/users/stevenroose/orgs",
      "repos_url": "https://api.github.com/users/stevenroose/repos",
      "events_url": "https://api.github.com/users/stevenroose/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stevenroose/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Just to not mix up values, this should set 0 instead of false, even if false would be converted automatically to 0.",
    "created_at": "2018-08-20T13:10:30Z",
    "updated_at": "2018-08-21T17:07:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r211255070",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211255070"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r211255070"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211255070/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 801,
    "original_line": 801,
    "side": "RIGHT",
    "in_reply_to_id": 209656514
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211263670",
    "pull_request_review_id": 147635022,
    "id": 211263670,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMTI2MzY3MA==",
    "diff_hunk": "@@ -1741,6 +1754,80 @@ int CConnman::GetExtraOutboundCount()\n     return std::max(nOutbound - nMaxOutbound, 0);\n }\n \n+void CConnman::AssignNewDandelionDestination(CNode* from)\n+{\n+    from->m_dandelion_destination = nullptr;\n+\n+    if (!CNode::IsDandelionEnabled()) return;",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 28,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "b508ed10f519f7a46266f778eabd83fea2b83622",
    "user": {
      "login": "stevenroose",
      "id": 853468,
      "node_id": "MDQ6VXNlcjg1MzQ2OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/853468?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stevenroose",
      "html_url": "https://github.com/stevenroose",
      "followers_url": "https://api.github.com/users/stevenroose/followers",
      "following_url": "https://api.github.com/users/stevenroose/following{/other_user}",
      "gists_url": "https://api.github.com/users/stevenroose/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stevenroose/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stevenroose/subscriptions",
      "organizations_url": "https://api.github.com/users/stevenroose/orgs",
      "repos_url": "https://api.github.com/users/stevenroose/repos",
      "events_url": "https://api.github.com/users/stevenroose/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stevenroose/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This check should not be necessary, failing it means there's a bug. I'd suggest either using an assertion or something more severe than this or just removing the check.",
    "created_at": "2018-08-20T13:37:04Z",
    "updated_at": "2018-08-21T17:07:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r211263670",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211263670"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r211263670"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211263670/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1761,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211277688",
    "pull_request_review_id": 147635022,
    "id": 211277688,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMTI3NzY4OA==",
    "diff_hunk": "@@ -317,6 +327,16 @@ class CConnman\n     */\n     int64_t PoissonNextSendInbound(int64_t now, int average_interval_seconds);\n \n+    using DandelionPeer = std::pair<CNode*, /* use count */ unsigned>;",
    "path": "src/net.h",
    "position": 67,
    "original_position": 67,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "b508ed10f519f7a46266f778eabd83fea2b83622",
    "user": {
      "login": "stevenroose",
      "id": 853468,
      "node_id": "MDQ6VXNlcjg1MzQ2OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/853468?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stevenroose",
      "html_url": "https://github.com/stevenroose",
      "followers_url": "https://api.github.com/users/stevenroose/followers",
      "following_url": "https://api.github.com/users/stevenroose/following{/other_user}",
      "gists_url": "https://api.github.com/users/stevenroose/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stevenroose/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stevenroose/subscriptions",
      "organizations_url": "https://api.github.com/users/stevenroose/orgs",
      "repos_url": "https://api.github.com/users/stevenroose/repos",
      "events_url": "https://api.github.com/users/stevenroose/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stevenroose/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Please elaborate a bit more on the documentation of the integer.",
    "created_at": "2018-08-20T14:15:55Z",
    "updated_at": "2018-08-21T17:07:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r211277688",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211277688"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r211277688"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211277688/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 330,
    "original_line": 330,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211300812",
    "pull_request_review_id": 147635022,
    "id": 211300812,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMTMwMDgxMg==",
    "diff_hunk": "@@ -36,13 +36,19 @@\n \n class CScheduler;\n class CNode;\n+class CTransaction;\n+using CTransactionRef = std::shared_ptr<const CTransaction>;\n \n+/** Default for -dandelion stem percentage */\n+static constexpr int64_t DEFAULT_DANDELION_STEM_PERCENTAGE = 90;\n /** Time between pings automatically sent out for latency probing and keepalive (in seconds). */\n static const int PING_INTERVAL = 2 * 60;\n /** Time after which to disconnect, after waiting for a ping response (or inactivity). */\n static const int TIMEOUT_INTERVAL = 20 * 60;\n /** Run the feeler connection loop once every 2 minutes or 120 seconds. **/\n static const int FEELER_INTERVAL = 120;\n+/** Pick new dandelion peers once every 10 minutes or 600 seconds. */\n+static constexpr int INTERVAL_DANDELION = 600;",
    "path": "src/net.h",
    "position": 41,
    "original_position": 41,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "b508ed10f519f7a46266f778eabd83fea2b83622",
    "user": {
      "login": "stevenroose",
      "id": 853468,
      "node_id": "MDQ6VXNlcjg1MzQ2OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/853468?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stevenroose",
      "html_url": "https://github.com/stevenroose",
      "followers_url": "https://api.github.com/users/stevenroose/followers",
      "following_url": "https://api.github.com/users/stevenroose/following{/other_user}",
      "gists_url": "https://api.github.com/users/stevenroose/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stevenroose/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stevenroose/subscriptions",
      "organizations_url": "https://api.github.com/users/stevenroose/orgs",
      "repos_url": "https://api.github.com/users/stevenroose/repos",
      "events_url": "https://api.github.com/users/stevenroose/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stevenroose/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "The convention seems to be `XXX_INTERVAL` instead of `INTERVAL_XXX`.",
    "created_at": "2018-08-20T15:18:28Z",
    "updated_at": "2018-08-21T17:07:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r211300812",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211300812"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r211300812"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211300812/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 51,
    "original_line": 51,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211357301",
    "pull_request_review_id": 147635022,
    "id": 211357301,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMTM1NzMwMQ==",
    "diff_hunk": "@@ -1741,6 +1754,80 @@ int CConnman::GetExtraOutboundCount()\n     return std::max(nOutbound - nMaxOutbound, 0);\n }\n \n+void CConnman::AssignNewDandelionDestination(CNode* from)\n+{\n+    from->m_dandelion_destination = nullptr;\n+\n+    if (!CNode::IsDandelionEnabled()) return;\n+\n+    unsigned min_use{std::numeric_limits<unsigned>::max()};\n+    int max_select = 0;\n+    for (DandelionPeer& peer : m_nodes_dandelion) {\n+        // Skip peers that disconnected and have been replaced\n+        if (!peer.first) continue;\n+\n+        // But consider at most MAX_OUTBOUND_DANDELION peers\n+        ++max_select;\n+        if (max_select > MAX_OUTBOUND_DANDELION) break;\n+\n+        // Src and dst must be different\n+        if (from->GetId() == peer.first->GetId()) continue;\n+\n+        // This is the best candidate so far\n+        if (min_use > peer.second) {\n+            min_use = peer.second;\n+            from->m_dandelion_destination = &peer;\n+            break; // They are sorted by use count, so the first one is one of the best ones\n+        }\n+    }\n+    if (from->m_dandelion_destination) {\n+        // Increase use count\n+        ++(from->m_dandelion_destination->second);\n+    }\n+}\n+\n+void CConnman::ThreadShuffleDandelionDestinations()\n+{\n+    while (!interruptNet) {\n+        auto time_micros = GetTimeMicros();\n+        time_micros = PoissonNextSend(time_micros, INTERVAL_DANDELION) - time_micros;\n+\n+        {\n+            LogPrint(BCLog::DANDELION, \"Dandelion: Shuffle Dandelion Destinations.\\n\");\n+            std::vector<CNode*> all_nodes;\n+            ForEachNode([&](CNode* node) { all_nodes.push_back(node); });\n+\n+            LOCK(cs_dandelion_peers);\n+\n+            // Collect all potential dandelion nodes\n+            m_nodes_dandelion.clear();\n+            for (CNode* node : all_nodes) {\n+                bool full_dandelion = //\n+                    // Ignore node->fRelayTxes here, to allow for dandelion-only nodes\n+                    node->m_accept_dandelion;\n+                bool weak_dandelion = //\n+                    node->fRelayTxes /* ignore peers that reject normal txs */ &&\n+                    !node->fClient /* ignore peers that don't serve blocks */ &&\n+                    !node->nLastTXTime /* ignore peers that never sent us any tx */;",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 78,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "b508ed10f519f7a46266f778eabd83fea2b83622",
    "user": {
      "login": "stevenroose",
      "id": 853468,
      "node_id": "MDQ6VXNlcjg1MzQ2OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/853468?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stevenroose",
      "html_url": "https://github.com/stevenroose",
      "followers_url": "https://api.github.com/users/stevenroose/followers",
      "following_url": "https://api.github.com/users/stevenroose/following{/other_user}",
      "gists_url": "https://api.github.com/users/stevenroose/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stevenroose/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stevenroose/subscriptions",
      "organizations_url": "https://api.github.com/users/stevenroose/orgs",
      "repos_url": "https://api.github.com/users/stevenroose/repos",
      "events_url": "https://api.github.com/users/stevenroose/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stevenroose/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "First, I think this test should be performed as well for Dandelion advertising peers, because they could otherwise deny you service. Furthermore, I think it might be more useful to have a threshold time of last relay instead of just one. Like \"relayed tx in last minute\".\r\n\r\nWith this, a peer could advertise dandelion and never relay anything.",
    "created_at": "2018-08-20T18:10:02Z",
    "updated_at": "2018-08-21T17:07:21Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r211357301",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211357301"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r211357301"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211357301/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1811,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211363696",
    "pull_request_review_id": 147635022,
    "id": 211363696,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMTM2MzY5Ng==",
    "diff_hunk": "@@ -1741,6 +1754,80 @@ int CConnman::GetExtraOutboundCount()\n     return std::max(nOutbound - nMaxOutbound, 0);\n }\n \n+void CConnman::AssignNewDandelionDestination(CNode* from)\n+{\n+    from->m_dandelion_destination = nullptr;\n+\n+    if (!CNode::IsDandelionEnabled()) return;\n+\n+    unsigned min_use{std::numeric_limits<unsigned>::max()};",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 30,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "b508ed10f519f7a46266f778eabd83fea2b83622",
    "user": {
      "login": "stevenroose",
      "id": 853468,
      "node_id": "MDQ6VXNlcjg1MzQ2OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/853468?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stevenroose",
      "html_url": "https://github.com/stevenroose",
      "followers_url": "https://api.github.com/users/stevenroose/followers",
      "following_url": "https://api.github.com/users/stevenroose/following{/other_user}",
      "gists_url": "https://api.github.com/users/stevenroose/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stevenroose/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stevenroose/subscriptions",
      "organizations_url": "https://api.github.com/users/stevenroose/orgs",
      "repos_url": "https://api.github.com/users/stevenroose/repos",
      "events_url": "https://api.github.com/users/stevenroose/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stevenroose/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Please explain how this variable is used and why. I fail to see its function.\r\n\r\nAlso since peers are checked with `min_use > peer.second`, this is an upper limit, not a lower limit. Making the name `min_use` not very telling. ",
    "created_at": "2018-08-20T18:30:50Z",
    "updated_at": "2018-08-21T17:07:21Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r211363696",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211363696"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r211363696"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211363696/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1758,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211366556",
    "pull_request_review_id": 147635022,
    "id": 211366556,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMTM2NjU1Ng==",
    "diff_hunk": "@@ -1741,6 +1754,80 @@ int CConnman::GetExtraOutboundCount()\n     return std::max(nOutbound - nMaxOutbound, 0);\n }\n \n+void CConnman::AssignNewDandelionDestination(CNode* from)",
    "path": "src/net.cpp",
    "position": 23,
    "original_position": 24,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "b508ed10f519f7a46266f778eabd83fea2b83622",
    "user": {
      "login": "stevenroose",
      "id": 853468,
      "node_id": "MDQ6VXNlcjg1MzQ2OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/853468?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stevenroose",
      "html_url": "https://github.com/stevenroose",
      "followers_url": "https://api.github.com/users/stevenroose/followers",
      "following_url": "https://api.github.com/users/stevenroose/following{/other_user}",
      "gists_url": "https://api.github.com/users/stevenroose/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stevenroose/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stevenroose/subscriptions",
      "organizations_url": "https://api.github.com/users/stevenroose/orgs",
      "repos_url": "https://api.github.com/users/stevenroose/repos",
      "events_url": "https://api.github.com/users/stevenroose/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stevenroose/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think this method could use some documentation on the strategy/algorithm used to assign destinations.",
    "created_at": "2018-08-20T18:40:30Z",
    "updated_at": "2018-08-21T17:07:21Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r211366556",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211366556"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r211366556"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211366556/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1756,
    "original_line": 1756,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211369684",
    "pull_request_review_id": 147635022,
    "id": 211369684,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMTM2OTY4NA==",
    "diff_hunk": "@@ -36,13 +36,19 @@\n \n class CScheduler;\n class CNode;\n+class CTransaction;\n+using CTransactionRef = std::shared_ptr<const CTransaction>;\n \n+/** Default for -dandelion stem percentage */\n+static constexpr int64_t DEFAULT_DANDELION_STEM_PERCENTAGE = 90;",
    "path": "src/net.h",
    "position": 33,
    "original_position": 33,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "b508ed10f519f7a46266f778eabd83fea2b83622",
    "user": {
      "login": "stevenroose",
      "id": 853468,
      "node_id": "MDQ6VXNlcjg1MzQ2OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/853468?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stevenroose",
      "html_url": "https://github.com/stevenroose",
      "followers_url": "https://api.github.com/users/stevenroose/followers",
      "following_url": "https://api.github.com/users/stevenroose/following{/other_user}",
      "gists_url": "https://api.github.com/users/stevenroose/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stevenroose/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stevenroose/subscriptions",
      "organizations_url": "https://api.github.com/users/stevenroose/orgs",
      "repos_url": "https://api.github.com/users/stevenroose/repos",
      "events_url": "https://api.github.com/users/stevenroose/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stevenroose/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Why 90? This is like the most important parameter of the dandelion algorithm, I think it deserves some motivation..",
    "created_at": "2018-08-20T18:50:42Z",
    "updated_at": "2018-08-21T17:07:21Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r211369684",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211369684"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r211369684"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211369684/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 43,
    "original_line": 43,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211369762",
    "pull_request_review_id": 147635022,
    "id": 211369762,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMTM2OTc2Mg==",
    "diff_hunk": "@@ -36,13 +36,19 @@\n \n class CScheduler;\n class CNode;\n+class CTransaction;\n+using CTransactionRef = std::shared_ptr<const CTransaction>;\n \n+/** Default for -dandelion stem percentage */\n+static constexpr int64_t DEFAULT_DANDELION_STEM_PERCENTAGE = 90;\n /** Time between pings automatically sent out for latency probing and keepalive (in seconds). */\n static const int PING_INTERVAL = 2 * 60;\n /** Time after which to disconnect, after waiting for a ping response (or inactivity). */\n static const int TIMEOUT_INTERVAL = 20 * 60;\n /** Run the feeler connection loop once every 2 minutes or 120 seconds. **/\n static const int FEELER_INTERVAL = 120;\n+/** Pick new dandelion peers once every 10 minutes or 600 seconds. */\n+static constexpr int INTERVAL_DANDELION = 600;",
    "path": "src/net.h",
    "position": 41,
    "original_position": 41,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "b508ed10f519f7a46266f778eabd83fea2b83622",
    "user": {
      "login": "stevenroose",
      "id": 853468,
      "node_id": "MDQ6VXNlcjg1MzQ2OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/853468?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stevenroose",
      "html_url": "https://github.com/stevenroose",
      "followers_url": "https://api.github.com/users/stevenroose/followers",
      "following_url": "https://api.github.com/users/stevenroose/following{/other_user}",
      "gists_url": "https://api.github.com/users/stevenroose/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stevenroose/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stevenroose/subscriptions",
      "organizations_url": "https://api.github.com/users/stevenroose/orgs",
      "repos_url": "https://api.github.com/users/stevenroose/repos",
      "events_url": "https://api.github.com/users/stevenroose/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stevenroose/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Also, why 10 minutes?",
    "created_at": "2018-08-20T18:50:56Z",
    "updated_at": "2018-08-21T17:07:21Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r211369762",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211369762"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r211369762"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211369762/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 51,
    "original_line": 51,
    "side": "RIGHT",
    "in_reply_to_id": 211300812
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211374669",
    "pull_request_review_id": 147635022,
    "id": 211374669,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMTM3NDY2OQ==",
    "diff_hunk": "@@ -1063,12 +1067,63 @@ bool static AlreadyHave(const CInv& inv) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n static void RelayTransaction(const CTransaction& tx, CConnman* connman)\n {\n     CInv inv(MSG_TX, tx.GetHash());\n-    connman->ForEachNode([&inv](CNode* pnode)\n-    {\n+    connman->ForEachNode([&inv](CNode* pnode) {\n         pnode->PushInventory(inv);\n+        pnode->m_cache_dandelion.erase(inv.hash);\n     });\n }\n \n+static void FluffTransaction(CTxMemPool& tx_pool, const CNode* from, const CTransactionRef& ptx, CConnman* connman)\n+{\n+    LogPrint(BCLog::DANDELION, \"fluff\\n\");",
    "path": "src/net_processing.cpp",
    "position": 25,
    "original_position": 25,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "b508ed10f519f7a46266f778eabd83fea2b83622",
    "user": {
      "login": "stevenroose",
      "id": 853468,
      "node_id": "MDQ6VXNlcjg1MzQ2OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/853468?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stevenroose",
      "html_url": "https://github.com/stevenroose",
      "followers_url": "https://api.github.com/users/stevenroose/followers",
      "following_url": "https://api.github.com/users/stevenroose/following{/other_user}",
      "gists_url": "https://api.github.com/users/stevenroose/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stevenroose/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stevenroose/subscriptions",
      "organizations_url": "https://api.github.com/users/stevenroose/orgs",
      "repos_url": "https://api.github.com/users/stevenroose/repos",
      "events_url": "https://api.github.com/users/stevenroose/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stevenroose/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Perhaps mention txid?",
    "created_at": "2018-08-20T19:06:49Z",
    "updated_at": "2018-08-21T17:07:21Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r211374669",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211374669"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r211374669"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211374669/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1078,
    "original_line": 1078,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211375470",
    "pull_request_review_id": 147635022,
    "id": 211375470,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMTM3NTQ3MA==",
    "diff_hunk": "@@ -1063,12 +1067,63 @@ bool static AlreadyHave(const CInv& inv) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n static void RelayTransaction(const CTransaction& tx, CConnman* connman)\n {\n     CInv inv(MSG_TX, tx.GetHash());\n-    connman->ForEachNode([&inv](CNode* pnode)\n-    {\n+    connman->ForEachNode([&inv](CNode* pnode) {\n         pnode->PushInventory(inv);\n+        pnode->m_cache_dandelion.erase(inv.hash);\n     });\n }\n \n+static void FluffTransaction(CTxMemPool& tx_pool, const CNode* from, const CTransactionRef& ptx, CConnman* connman)\n+{\n+    LogPrint(BCLog::DANDELION, \"fluff\\n\");\n+    CValidationState state;\n+    if (!AcceptToMemoryPool(tx_pool, state, ptx, /* pfMissingInputs */ nullptr, /* plTxnReplaced */ nullptr, /* bypass_limits */ false, /* nAbsurdFee */ 0, /* test_accept */ false)) {\n+        // Should never happen, since we checked for validity\n+        LogPrint(BCLog::DANDELION, \"Dandelion transaction fluff failed due to %s\\n\", FormatStateMessage(state));\n+        return;\n+    }\n+    tx_pool.check(pcoinsTip.get());\n+    RelayTransaction(*ptx, connman);\n+    LogPrint(BCLog::MEMPOOL, \"AcceptToMemoryPool: peer=%d: accepted %s (poolsz %u txn, %u kB)\\n\",\n+        from->GetId(),\n+        ptx->GetHash().ToString(),\n+        tx_pool.size(), tx_pool.DynamicMemoryUsage() / 1000);\n+}\n+\n+static void RelayDandelionTransaction(CTxMemPool& tx_pool, CNode* node_from, const CTransactionRef& ptx, const CNetMsgMaker& msg_maker, CConnman* connman)\n+{\n+    bool fluff = GetRand(100 * 100) / 100. >= CNode::m_dandelion_stem_pct_threshold;\n+    if (fluff) return FluffTransaction(tx_pool, node_from, ptx, connman);",
    "path": "src/net_processing.cpp",
    "position": 43,
    "original_position": 43,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "b508ed10f519f7a46266f778eabd83fea2b83622",
    "user": {
      "login": "stevenroose",
      "id": 853468,
      "node_id": "MDQ6VXNlcjg1MzQ2OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/853468?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stevenroose",
      "html_url": "https://github.com/stevenroose",
      "followers_url": "https://api.github.com/users/stevenroose/followers",
      "following_url": "https://api.github.com/users/stevenroose/following{/other_user}",
      "gists_url": "https://api.github.com/users/stevenroose/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stevenroose/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stevenroose/subscriptions",
      "organizations_url": "https://api.github.com/users/stevenroose/orgs",
      "repos_url": "https://api.github.com/users/stevenroose/repos",
      "events_url": "https://api.github.com/users/stevenroose/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stevenroose/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Should this check also be made for the wallet's own transactions? Or should a forced non-fluff be done in that case?",
    "created_at": "2018-08-20T19:09:43Z",
    "updated_at": "2018-08-21T17:07:21Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r211375470",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211375470"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r211375470"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211375470/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1096,
    "original_line": 1096,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211376927",
    "pull_request_review_id": 147635022,
    "id": 211376927,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMTM3NjkyNw==",
    "diff_hunk": "@@ -1063,12 +1067,63 @@ bool static AlreadyHave(const CInv& inv) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n static void RelayTransaction(const CTransaction& tx, CConnman* connman)\n {\n     CInv inv(MSG_TX, tx.GetHash());\n-    connman->ForEachNode([&inv](CNode* pnode)\n-    {\n+    connman->ForEachNode([&inv](CNode* pnode) {\n         pnode->PushInventory(inv);\n+        pnode->m_cache_dandelion.erase(inv.hash);\n     });\n }\n \n+static void FluffTransaction(CTxMemPool& tx_pool, const CNode* from, const CTransactionRef& ptx, CConnman* connman)\n+{\n+    LogPrint(BCLog::DANDELION, \"fluff\\n\");\n+    CValidationState state;\n+    if (!AcceptToMemoryPool(tx_pool, state, ptx, /* pfMissingInputs */ nullptr, /* plTxnReplaced */ nullptr, /* bypass_limits */ false, /* nAbsurdFee */ 0, /* test_accept */ false)) {\n+        // Should never happen, since we checked for validity\n+        LogPrint(BCLog::DANDELION, \"Dandelion transaction fluff failed due to %s\\n\", FormatStateMessage(state));\n+        return;\n+    }\n+    tx_pool.check(pcoinsTip.get());\n+    RelayTransaction(*ptx, connman);\n+    LogPrint(BCLog::MEMPOOL, \"AcceptToMemoryPool: peer=%d: accepted %s (poolsz %u txn, %u kB)\\n\",\n+        from->GetId(),\n+        ptx->GetHash().ToString(),\n+        tx_pool.size(), tx_pool.DynamicMemoryUsage() / 1000);\n+}\n+\n+static void RelayDandelionTransaction(CTxMemPool& tx_pool, CNode* node_from, const CTransactionRef& ptx, const CNetMsgMaker& msg_maker, CConnman* connman)\n+{\n+    bool fluff = GetRand(100 * 100) / 100. >= CNode::m_dandelion_stem_pct_threshold;\n+    if (fluff) return FluffTransaction(tx_pool, node_from, ptx, connman);\n+\n+    CNode* dest = node_from->GetDandelionDestination(connman);\n+    if (!dest) {\n+        // Just fall back to full fluff at this point\n+        return FluffTransaction(tx_pool, node_from, ptx, connman);\n+    }\n+\n+    // Dandelion relay (at least one hop)\n+    const int64_t now_micros = GetTimeMicros();\n+    const int64_t expiry = now_micros + EXPIRE_DANDELION_CACHE * 1000 * 1000 + PoissonNextSend(now_micros, EXPIRE_DANDELION_CACHE_AVG_ADD);\n+    node_from->m_cache_dandelion.emplace(std::make_pair(ptx->GetWitnessHash(), std::make_pair(ptx, expiry)));\n+    node_from->m_cache_dandelion_size += ptx->GetTotalSize();\n+    node_from->m_cache_expiry.push(expiry);\n+\n+    static constexpr int DANDELION_SEND_FLAGS{0}; // Always send as witness tx\n+\n+    // Check if the next peer would fluff (assume same probability)\n+    bool force_fluff = GetRand(100 * 100) / 100. >= CNode::m_dandelion_stem_pct_threshold;\n+\n+    if (force_fluff || !dest->m_accept_dandelion) {\n+        // The next peer is going to transition into fluff-phase\n+        LogPrint(BCLog::DANDELION, \"one-hop relay to peer=%d\\n\", dest->GetId());\n+        connman->PushMessage(dest, msg_maker.Make(DANDELION_SEND_FLAGS, NetMsgType::TX, *ptx));\n+        return;\n+        }\n+\n+        LogPrint(BCLog::DANDELION, \"dandelion relay to peer=%d\\n\", dest->GetId());\n+        connman->PushMessage(dest, msg_maker.Make(DANDELION_SEND_FLAGS, NetMsgType::TX_DANDELION, *ptx));",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 71,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "b508ed10f519f7a46266f778eabd83fea2b83622",
    "user": {
      "login": "stevenroose",
      "id": 853468,
      "node_id": "MDQ6VXNlcjg1MzQ2OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/853468?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stevenroose",
      "html_url": "https://github.com/stevenroose",
      "followers_url": "https://api.github.com/users/stevenroose/followers",
      "following_url": "https://api.github.com/users/stevenroose/following{/other_user}",
      "gists_url": "https://api.github.com/users/stevenroose/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stevenroose/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stevenroose/subscriptions",
      "organizations_url": "https://api.github.com/users/stevenroose/orgs",
      "repos_url": "https://api.github.com/users/stevenroose/repos",
      "events_url": "https://api.github.com/users/stevenroose/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stevenroose/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Wrong indentation since after return.",
    "created_at": "2018-08-20T19:15:16Z",
    "updated_at": "2018-08-21T17:07:21Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r211376927",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211376927"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r211376927"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211376927/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1124,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211382478",
    "pull_request_review_id": 147635022,
    "id": 211382478,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMTM4MjQ3OA==",
    "diff_hunk": "@@ -120,6 +120,11 @@ extern const char *GETHEADERS;\n  * @see https://bitcoin.org/en/developer-reference#tx\n  */\n extern const char *TX;\n+/**\n+ * The dandelion tx message transmits a single transaction.\n+ * @see https://github.com/bitcoin/bips/blob/master/bip-0156.mediawiki\n+ */\n+extern const char* TX_DANDELION;",
    "path": "src/protocol.h",
    "position": 8,
    "original_position": 8,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "8c27c3b6bfd6417f1d62a6b25f1afeec0f1c4770",
    "user": {
      "login": "stevenroose",
      "id": 853468,
      "node_id": "MDQ6VXNlcjg1MzQ2OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/853468?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stevenroose",
      "html_url": "https://github.com/stevenroose",
      "followers_url": "https://api.github.com/users/stevenroose/followers",
      "following_url": "https://api.github.com/users/stevenroose/following{/other_user}",
      "gists_url": "https://api.github.com/users/stevenroose/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stevenroose/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stevenroose/subscriptions",
      "organizations_url": "https://api.github.com/users/stevenroose/orgs",
      "repos_url": "https://api.github.com/users/stevenroose/repos",
      "events_url": "https://api.github.com/users/stevenroose/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stevenroose/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Why not a service bit?",
    "created_at": "2018-08-20T19:37:05Z",
    "updated_at": "2018-08-21T17:07:21Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r211382478",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211382478"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r211382478"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211382478/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 127,
    "original_line": 127,
    "side": "RIGHT",
    "in_reply_to_id": 209728695
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211437320",
    "pull_request_review_id": 147857638,
    "id": 211437320,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMTQzNzMyMA==",
    "diff_hunk": "@@ -399,6 +399,7 @@ void SetupServerArgs()\n     gArgs.AddArg(\"-bantime=<n>\", strprintf(\"Number of seconds to keep misbehaving peers from reconnecting (default: %u)\", DEFAULT_MISBEHAVING_BANTIME), false, OptionsCategory::CONNECTION);\n     gArgs.AddArg(\"-bind=<addr>\", \"Bind to given address and always listen on it. Use [host]:port notation for IPv6\", false, OptionsCategory::CONNECTION);\n     gArgs.AddArg(\"-connect=<ip>\", \"Connect only to the specified node; -connect=0 disables automatic connections (the rules for this peer are the same as for -addnode). This option can be specified multiple times to connect to multiple nodes.\", false, OptionsCategory::CONNECTION);\n+    gArgs.AddArg(\"-dandelion\", strprintf(\"Probability to extend the stem in Dandelion transaction relay by one hop (default: %d, 0 to disable dandelion)\", DEFAULT_DANDELION_STEM_PERCENTAGE), false, OptionsCategory::CONNECTION);",
    "path": "src/init.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "b508ed10f519f7a46266f778eabd83fea2b83622",
    "user": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I was thinking about this as well: normally I\u2019d expect a probability parameter to be in the interval `[0.0, 1.0]`. Are we trying to be consistent with other parameters taking probabilities as `[0, 100]` here, or what is the rationale? :-)",
    "created_at": "2018-08-20T23:23:29Z",
    "updated_at": "2018-08-21T17:07:21Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r211437320",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211437320"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r211437320"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211437320/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 402,
    "side": "RIGHT",
    "in_reply_to_id": 211254726
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/214537255",
    "pull_request_review_id": 151617543,
    "id": 214537255,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNDUzNzI1NQ==",
    "diff_hunk": "@@ -36,13 +36,19 @@\n \n class CScheduler;\n class CNode;\n+class CTransaction;\n+using CTransactionRef = std::shared_ptr<const CTransaction>;\n \n+/** Default for -dandelion stem percentage */\n+static constexpr int64_t DEFAULT_DANDELION_STEM_PERCENTAGE = 90;",
    "path": "src/net.h",
    "position": 33,
    "original_position": 33,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "b508ed10f519f7a46266f778eabd83fea2b83622",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "@stevenroose the [BIP specifies](https://github.com/bitcoin/bips/blob/master/bip-0156.mediawiki#the-fluff-mechanism) that:\r\n\r\n> When relaying a Dandelion transaction along a Dandelion route, there is a 10% chance that the Dandelion transaction becomes a typical Bitcoin transaction and is therefore relayed via diffusion.",
    "created_at": "2018-09-02T11:28:01Z",
    "updated_at": "2018-09-02T12:10:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r214537255",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/214537255"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r214537255"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/214537255/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 43,
    "original_line": 43,
    "side": "RIGHT",
    "in_reply_to_id": 211369684
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/214537288",
    "pull_request_review_id": 151617543,
    "id": 214537288,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNDUzNzI4OA==",
    "diff_hunk": "@@ -36,13 +36,19 @@\n \n class CScheduler;\n class CNode;\n+class CTransaction;\n+using CTransactionRef = std::shared_ptr<const CTransaction>;\n \n+/** Default for -dandelion stem percentage */\n+static constexpr int64_t DEFAULT_DANDELION_STEM_PERCENTAGE = 90;\n /** Time between pings automatically sent out for latency probing and keepalive (in seconds). */\n static const int PING_INTERVAL = 2 * 60;\n /** Time after which to disconnect, after waiting for a ping response (or inactivity). */\n static const int TIMEOUT_INTERVAL = 20 * 60;\n /** Run the feeler connection loop once every 2 minutes or 120 seconds. **/\n static const int FEELER_INTERVAL = 120;\n+/** Pick new dandelion peers once every 10 minutes or 600 seconds. */\n+static constexpr int INTERVAL_DANDELION = 600;",
    "path": "src/net.h",
    "position": 41,
    "original_position": 41,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "b508ed10f519f7a46266f778eabd83fea2b83622",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "@stevenroose as per the BIP: https://github.com/bitcoin/bips/blob/master/bip-0156.mediawiki#periodic-dandelion-route-shuffling (the value suggested in the BIP is best discussed on the bitcoin-dev mailinglist)",
    "created_at": "2018-09-02T11:29:02Z",
    "updated_at": "2018-09-02T12:10:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r214537288",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/214537288"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r214537288"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/214537288/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 51,
    "original_line": 51,
    "side": "RIGHT",
    "in_reply_to_id": 211300812
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/214837714",
    "pull_request_review_id": 151971595,
    "id": 214837714,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNDgzNzcxNA==",
    "diff_hunk": "@@ -36,13 +36,19 @@\n \n class CScheduler;\n class CNode;\n+class CTransaction;\n+using CTransactionRef = std::shared_ptr<const CTransaction>;\n \n+/** Default for -dandelion stem percentage */\n+static constexpr int64_t DEFAULT_DANDELION_STEM_PERCENTAGE = 90;",
    "path": "src/net.h",
    "position": 33,
    "original_position": 33,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "b508ed10f519f7a46266f778eabd83fea2b83622",
    "user": {
      "login": "stevenroose",
      "id": 853468,
      "node_id": "MDQ6VXNlcjg1MzQ2OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/853468?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stevenroose",
      "html_url": "https://github.com/stevenroose",
      "followers_url": "https://api.github.com/users/stevenroose/followers",
      "following_url": "https://api.github.com/users/stevenroose/following{/other_user}",
      "gists_url": "https://api.github.com/users/stevenroose/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stevenroose/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stevenroose/subscriptions",
      "organizations_url": "https://api.github.com/users/stevenroose/orgs",
      "repos_url": "https://api.github.com/users/stevenroose/repos",
      "events_url": "https://api.github.com/users/stevenroose/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stevenroose/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "@Sjors So I'd suggest referring to the BIP in the comment of that variable.",
    "created_at": "2018-09-04T08:59:56Z",
    "updated_at": "2018-09-04T08:59:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r214837714",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/214837714"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r214837714"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/214837714/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 43,
    "original_line": 43,
    "side": "RIGHT",
    "in_reply_to_id": 211369684
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/214838158",
    "pull_request_review_id": 151972129,
    "id": 214838158,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNDgzODE1OA==",
    "diff_hunk": "@@ -36,13 +36,19 @@\n \n class CScheduler;\n class CNode;\n+class CTransaction;\n+using CTransactionRef = std::shared_ptr<const CTransaction>;\n \n+/** Default for -dandelion stem percentage */\n+static constexpr int64_t DEFAULT_DANDELION_STEM_PERCENTAGE = 90;\n /** Time between pings automatically sent out for latency probing and keepalive (in seconds). */\n static const int PING_INTERVAL = 2 * 60;\n /** Time after which to disconnect, after waiting for a ping response (or inactivity). */\n static const int TIMEOUT_INTERVAL = 20 * 60;\n /** Run the feeler connection loop once every 2 minutes or 120 seconds. **/\n static const int FEELER_INTERVAL = 120;\n+/** Pick new dandelion peers once every 10 minutes or 600 seconds. */\n+static constexpr int INTERVAL_DANDELION = 600;",
    "path": "src/net.h",
    "position": 41,
    "original_position": 41,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "b508ed10f519f7a46266f778eabd83fea2b83622",
    "user": {
      "login": "stevenroose",
      "id": 853468,
      "node_id": "MDQ6VXNlcjg1MzQ2OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/853468?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stevenroose",
      "html_url": "https://github.com/stevenroose",
      "followers_url": "https://api.github.com/users/stevenroose/followers",
      "following_url": "https://api.github.com/users/stevenroose/following{/other_user}",
      "gists_url": "https://api.github.com/users/stevenroose/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stevenroose/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stevenroose/subscriptions",
      "organizations_url": "https://api.github.com/users/stevenroose/orgs",
      "repos_url": "https://api.github.com/users/stevenroose/repos",
      "events_url": "https://api.github.com/users/stevenroose/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stevenroose/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "@Sjors this would do:\r\n`/** As per BIP156, pick new dandelion peers once every 10 minutes or 600 seconds. */`",
    "created_at": "2018-09-04T09:01:08Z",
    "updated_at": "2018-09-04T09:01:08Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r214838158",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/214838158"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r214838158"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/214838158/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 51,
    "original_line": 51,
    "side": "RIGHT",
    "in_reply_to_id": 211300812
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/214839094",
    "pull_request_review_id": 151973260,
    "id": 214839094,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNDgzOTA5NA==",
    "diff_hunk": "@@ -36,13 +36,19 @@\n \n class CScheduler;\n class CNode;\n+class CTransaction;\n+using CTransactionRef = std::shared_ptr<const CTransaction>;\n \n+/** Default for -dandelion stem percentage */\n+static constexpr int64_t DEFAULT_DANDELION_STEM_PERCENTAGE = 90;",
    "path": "src/net.h",
    "position": 33,
    "original_position": 33,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "b508ed10f519f7a46266f778eabd83fea2b83622",
    "user": {
      "login": "stevenroose",
      "id": 853468,
      "node_id": "MDQ6VXNlcjg1MzQ2OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/853468?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stevenroose",
      "html_url": "https://github.com/stevenroose",
      "followers_url": "https://api.github.com/users/stevenroose/followers",
      "following_url": "https://api.github.com/users/stevenroose/following{/other_user}",
      "gists_url": "https://api.github.com/users/stevenroose/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stevenroose/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stevenroose/subscriptions",
      "organizations_url": "https://api.github.com/users/stevenroose/orgs",
      "repos_url": "https://api.github.com/users/stevenroose/repos",
      "events_url": "https://api.github.com/users/stevenroose/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stevenroose/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "What I'm trying to say with this comments is that this is supposed to be an implementation of the BIP, so it should refer to the BIP for logic/params etc. It has happened too often that a BIP is just a description of the implementation.",
    "created_at": "2018-09-04T09:04:10Z",
    "updated_at": "2018-09-04T09:04:10Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r214839094",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/214839094"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r214839094"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/214839094/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 43,
    "original_line": 43,
    "side": "RIGHT",
    "in_reply_to_id": 211369684
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/221477053",
    "pull_request_review_id": 160132341,
    "id": 221477053,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMTQ3NzA1Mw==",
    "diff_hunk": "@@ -1741,6 +1753,79 @@ int CConnman::GetExtraOutboundCount()\n     return std::max(nOutbound - nMaxOutbound, 0);\n }\n \n+void CConnman::AssignNewDandelionDestination(CNode* from)\n+{\n+    unsigned min_use{std::numeric_limits<unsigned>::max()};\n+    int max_select = 0;\n+    for (DandelionPeer& peer : m_nodes_dandelion) {\n+        // Skip peers that disconnected and have been replaced\n+        if (!peer.first) continue;\n+\n+        // But consider at most MAX_OUTBOUND_DANDELION peers\n+        ++max_select;\n+        if (max_select > MAX_OUTBOUND_DANDELION) break;\n+\n+        // Src and dst must be different\n+        if (from->GetId() == peer.first->GetId()) continue;\n+\n+        // This is the best candidate so far\n+        if (min_use > peer.second) {\n+            min_use = peer.second;\n+            from->m_dandelion_destination = &peer;\n+            break; // They are sorted by use count, so the first one is one of the best ones\n+        }\n+    }\n+    if (from->m_dandelion_destination) {\n+        // Increase use count\n+        ++(from->m_dandelion_destination->second);\n+    }\n+}\n+\n+void CConnman::ThreadShuffleDandelionDestinations()\n+{\n+    while (!interruptNet) {\n+        auto time_micros = GetTimeMicros();\n+        time_micros = PoissonNextSend(time_micros, INTERVAL_DANDELION) - time_micros;\n+\n+        LogPrint(BCLog::DANDELION, \"Dandelion: Shuffle Dandelion Destinations.\\n\");\n+        {\n+            LOCK(cs_dandelion_peers);\n+\n+            std::vector<CNode*> all_nodes;\n+            ForEachNode([&](CNode* node) { all_nodes.push_back(node); });\n+\n+            // Collect all potential dandelion nodes\n+            m_nodes_dandelion.clear();\n+            for (CNode* node : all_nodes) {\n+                // Ignore inbound nodes\n+                if (node->fInbound) continue;",
    "path": "src/net.cpp",
    "position": 68,
    "original_position": 68,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "user": {
      "login": "rodasmith",
      "id": 4968956,
      "node_id": "MDQ6VXNlcjQ5Njg5NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4968956?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rodasmith",
      "html_url": "https://github.com/rodasmith",
      "followers_url": "https://api.github.com/users/rodasmith/followers",
      "following_url": "https://api.github.com/users/rodasmith/following{/other_user}",
      "gists_url": "https://api.github.com/users/rodasmith/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rodasmith/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rodasmith/subscriptions",
      "organizations_url": "https://api.github.com/users/rodasmith/orgs",
      "repos_url": "https://api.github.com/users/rodasmith/repos",
      "events_url": "https://api.github.com/users/rodasmith/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rodasmith/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Why ignore inbound nodes? Does this mean non-listening dandelion nodes send only their own transactions and that the peer who receives such will know with undeniable certainty that the non-listening node initiated the transaction?",
    "created_at": "2018-09-30T23:10:01Z",
    "updated_at": "2018-09-30T23:10:02Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r221477053",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/221477053"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r221477053"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/221477053/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1801,
    "original_line": 1801,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/222159317",
    "pull_request_review_id": 160980693,
    "id": 222159317,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMjE1OTMxNw==",
    "diff_hunk": "@@ -1741,6 +1753,79 @@ int CConnman::GetExtraOutboundCount()\n     return std::max(nOutbound - nMaxOutbound, 0);\n }\n \n+void CConnman::AssignNewDandelionDestination(CNode* from)\n+{\n+    unsigned min_use{std::numeric_limits<unsigned>::max()};\n+    int max_select = 0;\n+    for (DandelionPeer& peer : m_nodes_dandelion) {\n+        // Skip peers that disconnected and have been replaced\n+        if (!peer.first) continue;\n+\n+        // But consider at most MAX_OUTBOUND_DANDELION peers\n+        ++max_select;\n+        if (max_select > MAX_OUTBOUND_DANDELION) break;\n+\n+        // Src and dst must be different\n+        if (from->GetId() == peer.first->GetId()) continue;\n+\n+        // This is the best candidate so far\n+        if (min_use > peer.second) {\n+            min_use = peer.second;\n+            from->m_dandelion_destination = &peer;\n+            break; // They are sorted by use count, so the first one is one of the best ones\n+        }\n+    }\n+    if (from->m_dandelion_destination) {\n+        // Increase use count\n+        ++(from->m_dandelion_destination->second);\n+    }\n+}\n+\n+void CConnman::ThreadShuffleDandelionDestinations()\n+{\n+    while (!interruptNet) {\n+        auto time_micros = GetTimeMicros();\n+        time_micros = PoissonNextSend(time_micros, INTERVAL_DANDELION) - time_micros;\n+\n+        LogPrint(BCLog::DANDELION, \"Dandelion: Shuffle Dandelion Destinations.\\n\");\n+        {\n+            LOCK(cs_dandelion_peers);\n+\n+            std::vector<CNode*> all_nodes;\n+            ForEachNode([&](CNode* node) { all_nodes.push_back(node); });\n+\n+            // Collect all potential dandelion nodes\n+            m_nodes_dandelion.clear();\n+            for (CNode* node : all_nodes) {\n+                // Ignore inbound nodes\n+                if (node->fInbound) continue;",
    "path": "src/net.cpp",
    "position": 68,
    "original_position": 68,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "user": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Inbound nodes are much more likely to be snooping peers.\r\n\r\n",
    "created_at": "2018-10-03T01:27:59Z",
    "updated_at": "2018-10-03T01:28:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r222159317",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/222159317"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r222159317"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/222159317/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1801,
    "original_line": 1801,
    "side": "RIGHT",
    "in_reply_to_id": 221477053
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/222193420",
    "pull_request_review_id": 161020033,
    "id": 222193420,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMjE5MzQyMA==",
    "diff_hunk": "@@ -1741,6 +1753,79 @@ int CConnman::GetExtraOutboundCount()\n     return std::max(nOutbound - nMaxOutbound, 0);\n }\n \n+void CConnman::AssignNewDandelionDestination(CNode* from)\n+{\n+    unsigned min_use{std::numeric_limits<unsigned>::max()};\n+    int max_select = 0;\n+    for (DandelionPeer& peer : m_nodes_dandelion) {\n+        // Skip peers that disconnected and have been replaced\n+        if (!peer.first) continue;\n+\n+        // But consider at most MAX_OUTBOUND_DANDELION peers\n+        ++max_select;\n+        if (max_select > MAX_OUTBOUND_DANDELION) break;\n+\n+        // Src and dst must be different\n+        if (from->GetId() == peer.first->GetId()) continue;\n+\n+        // This is the best candidate so far\n+        if (min_use > peer.second) {\n+            min_use = peer.second;\n+            from->m_dandelion_destination = &peer;\n+            break; // They are sorted by use count, so the first one is one of the best ones\n+        }\n+    }\n+    if (from->m_dandelion_destination) {\n+        // Increase use count\n+        ++(from->m_dandelion_destination->second);\n+    }\n+}\n+\n+void CConnman::ThreadShuffleDandelionDestinations()\n+{\n+    while (!interruptNet) {\n+        auto time_micros = GetTimeMicros();\n+        time_micros = PoissonNextSend(time_micros, INTERVAL_DANDELION) - time_micros;\n+\n+        LogPrint(BCLog::DANDELION, \"Dandelion: Shuffle Dandelion Destinations.\\n\");\n+        {\n+            LOCK(cs_dandelion_peers);\n+\n+            std::vector<CNode*> all_nodes;\n+            ForEachNode([&](CNode* node) { all_nodes.push_back(node); });\n+\n+            // Collect all potential dandelion nodes\n+            m_nodes_dandelion.clear();\n+            for (CNode* node : all_nodes) {\n+                // Ignore inbound nodes\n+                if (node->fInbound) continue;",
    "path": "src/net.cpp",
    "position": 68,
    "original_position": 68,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "user": {
      "login": "kek-coin",
      "id": 29149514,
      "node_id": "MDQ6VXNlcjI5MTQ5NTE0",
      "avatar_url": "https://avatars.githubusercontent.com/u/29149514?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kek-coin",
      "html_url": "https://github.com/kek-coin",
      "followers_url": "https://api.github.com/users/kek-coin/followers",
      "following_url": "https://api.github.com/users/kek-coin/following{/other_user}",
      "gists_url": "https://api.github.com/users/kek-coin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kek-coin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kek-coin/subscriptions",
      "organizations_url": "https://api.github.com/users/kek-coin/orgs",
      "repos_url": "https://api.github.com/users/kek-coin/repos",
      "events_url": "https://api.github.com/users/kek-coin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kek-coin/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "While that is true, aren't there solutions that do not make dandelion break firewalled nodes' privacy? For example, send only to outgoing peers if you originated the transaction, but send to incoming as well for forwarded txes? Perhaps weigh the outgoing peers more heavily than incoming peers when selecting a random peer to forward to (either by assigning a weight to individual peers based on incoming/outgoing status, or by first randomly selecting the outgoing or incoming pool with a fixed weighting before selecting a peer from whichever pool).",
    "created_at": "2018-10-03T06:15:38Z",
    "updated_at": "2018-10-03T06:15:38Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r222193420",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "NONE",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/222193420"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r222193420"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/222193420/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1801,
    "original_line": 1801,
    "side": "RIGHT",
    "in_reply_to_id": 221477053
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/222344944",
    "pull_request_review_id": 161207978,
    "id": 222344944,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMjM0NDk0NA==",
    "diff_hunk": "@@ -399,6 +399,7 @@ void SetupServerArgs()\n     gArgs.AddArg(\"-bantime=<n>\", strprintf(\"Number of seconds to keep misbehaving peers from reconnecting (default: %u)\", DEFAULT_MISBEHAVING_BANTIME), false, OptionsCategory::CONNECTION);\n     gArgs.AddArg(\"-bind=<addr>\", \"Bind to given address and always listen on it. Use [host]:port notation for IPv6\", false, OptionsCategory::CONNECTION);\n     gArgs.AddArg(\"-connect=<ip>\", \"Connect only to the specified node; -connect=0 disables automatic connections (the rules for this peer are the same as for -addnode). This option can be specified multiple times to connect to multiple nodes.\", false, OptionsCategory::CONNECTION);\n+    gArgs.AddArg(\"-dandelion\", strprintf(\"Probability to extend the stem in Dandelion transaction relay by one hop (default: %d, 0 to disable dandelion)\", DEFAULT_DANDELION_STEM_PERCENTAGE), false, OptionsCategory::CONNECTION);",
    "path": "src/init.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "b508ed10f519f7a46266f778eabd83fea2b83622",
    "user": {
      "login": "stevenroose",
      "id": 853468,
      "node_id": "MDQ6VXNlcjg1MzQ2OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/853468?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stevenroose",
      "html_url": "https://github.com/stevenroose",
      "followers_url": "https://api.github.com/users/stevenroose/followers",
      "following_url": "https://api.github.com/users/stevenroose/following{/other_user}",
      "gists_url": "https://api.github.com/users/stevenroose/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stevenroose/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stevenroose/subscriptions",
      "organizations_url": "https://api.github.com/users/stevenroose/orgs",
      "repos_url": "https://api.github.com/users/stevenroose/repos",
      "events_url": "https://api.github.com/users/stevenroose/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stevenroose/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "If that is the case, it should at least be mentioned in the help line. \r\n\r\n> Probability in % to extend ..",
    "created_at": "2018-10-03T14:57:32Z",
    "updated_at": "2018-10-03T14:57:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r222344944",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/222344944"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r222344944"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/222344944/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 402,
    "side": "RIGHT",
    "in_reply_to_id": 211254726
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/228066955",
    "pull_request_review_id": 168247887,
    "id": 228066955,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyODA2Njk1NQ==",
    "diff_hunk": "@@ -317,6 +327,16 @@ class CConnman\n     */\n     int64_t PoissonNextSendInbound(int64_t now, int average_interval_seconds);\n \n+    using DandelionPeer = std::pair<CNode*, /* use count */ unsigned>;",
    "path": "src/net.h",
    "position": 67,
    "original_position": 67,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "b508ed10f519f7a46266f778eabd83fea2b83622",
    "user": {
      "login": "AM5800",
      "id": 621585,
      "node_id": "MDQ6VXNlcjYyMTU4NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/621585?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AM5800",
      "html_url": "https://github.com/AM5800",
      "followers_url": "https://api.github.com/users/AM5800/followers",
      "following_url": "https://api.github.com/users/AM5800/following{/other_user}",
      "gists_url": "https://api.github.com/users/AM5800/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AM5800/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AM5800/subscriptions",
      "organizations_url": "https://api.github.com/users/AM5800/orgs",
      "repos_url": "https://api.github.com/users/AM5800/repos",
      "events_url": "https://api.github.com/users/AM5800/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AM5800/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Maybe it is better to create a struct? This integer will look much better with a name. It is very hard to read all those `peer.first` and `peer.second`",
    "created_at": "2018-10-25T07:52:10Z",
    "updated_at": "2018-10-25T07:52:11Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r228066955",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "NONE",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/228066955"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r228066955"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/228066955/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 330,
    "original_line": 330,
    "side": "RIGHT",
    "in_reply_to_id": 211277688
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/228068484",
    "pull_request_review_id": 168249768,
    "id": 228068484,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyODA2ODQ4NA==",
    "diff_hunk": "@@ -1063,12 +1067,63 @@ bool static AlreadyHave(const CInv& inv) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n static void RelayTransaction(const CTransaction& tx, CConnman* connman)\n {\n     CInv inv(MSG_TX, tx.GetHash());\n-    connman->ForEachNode([&inv](CNode* pnode)\n-    {\n+    connman->ForEachNode([&inv](CNode* pnode) {\n         pnode->PushInventory(inv);\n+        pnode->m_cache_dandelion.erase(inv.hash);\n     });\n }\n \n+static void FluffTransaction(CTxMemPool& tx_pool, const CNode* from, const CTransactionRef& ptx, CConnman* connman)",
    "path": "src/net_processing.cpp",
    "position": 23,
    "original_position": 23,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "user": {
      "login": "AM5800",
      "id": 621585,
      "node_id": "MDQ6VXNlcjYyMTU4NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/621585?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AM5800",
      "html_url": "https://github.com/AM5800",
      "followers_url": "https://api.github.com/users/AM5800/followers",
      "following_url": "https://api.github.com/users/AM5800/following{/other_user}",
      "gists_url": "https://api.github.com/users/AM5800/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AM5800/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AM5800/subscriptions",
      "organizations_url": "https://api.github.com/users/AM5800/orgs",
      "repos_url": "https://api.github.com/users/AM5800/repos",
      "events_url": "https://api.github.com/users/AM5800/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AM5800/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I was wandering... FluffTransaction is logically equivalent to receiving a transaction, right?\r\nThen shouldn't we also execute all [this code](https://github.com/bitcoin/bitcoin/blob/423cb37658b81b2cb8475b6fdb08b3122fee51a4/src/net_processing.cpp#L2190) on fluff? \r\n",
    "created_at": "2018-10-25T07:57:04Z",
    "updated_at": "2018-10-25T07:57:04Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r228068484",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "NONE",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/228068484"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r228068484"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/228068484/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1076,
    "original_line": 1076,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/228071077",
    "pull_request_review_id": 168252825,
    "id": 228071077,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyODA3MTA3Nw==",
    "diff_hunk": "@@ -2369,8 +2454,14 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n         return false;\n     }\n-    if (connOptions.m_use_addrman_outgoing || !connOptions.m_specified_outgoing.empty())\n+    if (connOptions.m_use_addrman_outgoing || !connOptions.m_specified_outgoing.empty()) {\n         threadOpenConnections = std::thread(&TraceThread<std::function<void()> >, \"opencon\", std::function<void()>(std::bind(&CConnman::ThreadOpenConnections, this, connOptions.m_specified_outgoing)));\n+    }\n+\n+    if (CNode::IsDandelionEnabled()) {\n+        // Shuffle dandelion destinations\n+        m_thread_shuffle_dandelion = std::thread(&TraceThread<std::function<void()>>, \"dandelionshuff\", [&] { ThreadShuffleDandelionDestinations(); });",
    "path": "src/net.cpp",
    "position": 110,
    "original_position": 110,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "user": {
      "login": "AM5800",
      "id": 621585,
      "node_id": "MDQ6VXNlcjYyMTU4NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/621585?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AM5800",
      "html_url": "https://github.com/AM5800",
      "followers_url": "https://api.github.com/users/AM5800/followers",
      "following_url": "https://api.github.com/users/AM5800/following{/other_user}",
      "gists_url": "https://api.github.com/users/AM5800/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AM5800/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AM5800/subscriptions",
      "organizations_url": "https://api.github.com/users/AM5800/orgs",
      "repos_url": "https://api.github.com/users/AM5800/repos",
      "events_url": "https://api.github.com/users/AM5800/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AM5800/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "When I tried this PR in action - dandelion was turned off for the first epoch. I believe this happens because we do the very first shuffle when there are no connections. Maybe the first shuffle should be delayed until someone connects?",
    "created_at": "2018-10-25T08:05:34Z",
    "updated_at": "2018-10-25T08:05:34Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r228071077",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "NONE",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/228071077"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r228071077"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/228071077/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2463,
    "original_line": 2463,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/228074480",
    "pull_request_review_id": 168257252,
    "id": 228074480,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyODA3NDQ4MA==",
    "diff_hunk": "@@ -2967,8 +3072,68 @@ static bool SendRejectsAndCheckIfBanned(CNode* pnode, CConnman* connman, bool en\n     return false;\n }\n \n+/** Check if any dandelion txs expired. If so, relay them. */\n+static void CheckDandelionExpiry(CNode* from, CTxMemPool& tx_pool, CConnman* connman)\n+{\n+    if (from->m_cache_expiry.empty()) return;\n+\n+    const int64_t now_millis = GetTimeMillis();\n+\n+    // Constant time lookup:\n+    if (from->m_cache_expiry.top() >= now_millis) return;\n+\n+    // Otherwise walk the whole cache to look for the expired tx(s)\n+    do {\n+        from->m_cache_expiry.pop();\n+    } while (from->m_cache_expiry.top() < now_millis);\n+\n+    for (auto it = from->m_cache_dandelion.cbegin(); it != from->m_cache_dandelion.cend(); ++it) {",
    "path": "src/net_processing.cpp",
    "position": 167,
    "original_position": 167,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "user": {
      "login": "AM5800",
      "id": 621585,
      "node_id": "MDQ6VXNlcjYyMTU4NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/621585?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AM5800",
      "html_url": "https://github.com/AM5800",
      "followers_url": "https://api.github.com/users/AM5800/followers",
      "following_url": "https://api.github.com/users/AM5800/following{/other_user}",
      "gists_url": "https://api.github.com/users/AM5800/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AM5800/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AM5800/subscriptions",
      "organizations_url": "https://api.github.com/users/AM5800/orgs",
      "repos_url": "https://api.github.com/users/AM5800/repos",
      "events_url": "https://api.github.com/users/AM5800/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AM5800/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "An idea: if you define `m_cache_expiry` as `std::map<int64_t, CTransactionRef>` - you will get the same 'Constant time lookup' but you won't need to walk the whole cache - expired transactions are already available",
    "created_at": "2018-10-25T08:17:17Z",
    "updated_at": "2018-10-25T08:17:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r228074480",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "NONE",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/228074480"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r228074480"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/228074480/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 3090,
    "original_line": 3090,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/228076220",
    "pull_request_review_id": 168259399,
    "id": 228076220,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyODA3NjIyMA==",
    "diff_hunk": "@@ -1063,12 +1067,63 @@ bool static AlreadyHave(const CInv& inv) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n static void RelayTransaction(const CTransaction& tx, CConnman* connman)\n {\n     CInv inv(MSG_TX, tx.GetHash());\n-    connman->ForEachNode([&inv](CNode* pnode)\n-    {\n+    connman->ForEachNode([&inv](CNode* pnode) {\n         pnode->PushInventory(inv);\n+        pnode->m_cache_dandelion.erase(inv.hash);\n     });\n }\n \n+static void FluffTransaction(CTxMemPool& tx_pool, const CNode* from, const CTransactionRef& ptx, CConnman* connman)\n+{\n+    LogPrint(BCLog::DANDELION, \"fluff\\n\");\n+    CValidationState state;\n+    if (!AcceptToMemoryPool(tx_pool, state, ptx, /* pfMissingInputs */ nullptr, /* plTxnReplaced */ nullptr, /* bypass_limits */ false, /* nAbsurdFee */ 0, /* test_accept */ false)) {\n+        // Should never happen, since we checked for validity\n+        LogPrint(BCLog::DANDELION, \"Dandelion transaction fluff failed due to %s\\n\", FormatStateMessage(state));\n+        return;\n+    }\n+    tx_pool.check(pcoinsTip.get());\n+    RelayTransaction(*ptx, connman);\n+    LogPrint(BCLog::MEMPOOL, \"AcceptToMemoryPool: peer=%d: accepted %s (poolsz %u txn, %u kB)\\n\",\n+        from->GetId(),\n+        ptx->GetHash().ToString(),\n+        tx_pool.size(), tx_pool.DynamicMemoryUsage() / 1000);\n+}\n+\n+static void RelayDandelionTransaction(CTxMemPool& tx_pool, CNode* node_from, const CTransactionRef& ptx, const CNetMsgMaker& msg_maker, CConnman* connman)\n+{\n+    bool fluff = GetRand(100 * 100) / 100. >= CNode::m_dandelion_stem_pct_threshold;\n+    if (fluff) return FluffTransaction(tx_pool, node_from, ptx, connman);\n+\n+    CNode* dest = node_from->GetDandelionDestination(connman);\n+    if (!dest) {\n+        // Just fall back to full fluff at this point\n+        return FluffTransaction(tx_pool, node_from, ptx, connman);\n+    }\n+\n+    // Dandelion relay (at least one hop)\n+    const int64_t now_micros = GetTimeMicros();\n+    const int64_t expiry = now_micros + EXPIRE_DANDELION_CACHE * 1000 * 1000 + PoissonNextSend(now_micros, EXPIRE_DANDELION_CACHE_AVG_ADD);\n+    node_from->m_cache_dandelion.emplace(std::make_pair(ptx->GetWitnessHash(), std::make_pair(ptx, expiry)));",
    "path": "src/net_processing.cpp",
    "position": 54,
    "original_position": 54,
    "commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "original_commit_id": "8b533b25fdd074a32077c339932aab30cb02295f",
    "user": {
      "login": "AM5800",
      "id": 621585,
      "node_id": "MDQ6VXNlcjYyMTU4NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/621585?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AM5800",
      "html_url": "https://github.com/AM5800",
      "followers_url": "https://api.github.com/users/AM5800/followers",
      "following_url": "https://api.github.com/users/AM5800/following{/other_user}",
      "gists_url": "https://api.github.com/users/AM5800/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AM5800/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AM5800/subscriptions",
      "organizations_url": "https://api.github.com/users/AM5800/orgs",
      "repos_url": "https://api.github.com/users/AM5800/repos",
      "events_url": "https://api.github.com/users/AM5800/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AM5800/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Nit:\r\n`node_from->m_cache_dandelion.emplace(ptx->GetWitnessHash(), std::make_pair(ptx, expiry))`\r\ndoes absolutely the same, but shorter.",
    "created_at": "2018-10-25T08:22:39Z",
    "updated_at": "2018-10-25T08:22:39Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r228076220",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947",
    "author_association": "NONE",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/228076220"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13947#discussion_r228076220"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13947"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/228076220/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1107,
    "original_line": 1107,
    "side": "RIGHT"
  }
]