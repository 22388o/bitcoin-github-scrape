gmaxwell,2017-06-28T22:37:41Z,hm this may require carefully auditing every use to determine if the code in question isn't being protected by an assumed holding of cs_vnodes.,https://github.com/bitcoin/bitcoin/pull/10697#issuecomment-311811754,311811754,
TheBlueMatt,2017-06-28T22:48:48Z,"Indeed. I believe it is the case that none of them are needed, but I may be incorrect. Note that folks may want to hold off on review, @cfields indicated he may have a more complete solution to the general mess that is our manual CNode refcounting.",https://github.com/bitcoin/bitcoin/pull/10697#issuecomment-311813625,311813625,
theuni,2017-06-29T02:51:08Z,"No, please go ahead and review. I've worked on this several times now and haven't come up with anything that could be considered an improvement. I'm currently taking another look, but that shouldn't block this unless I manage to come up with something in the next day or so.",https://github.com/bitcoin/bitcoin/pull/10697#issuecomment-311847852,311847852,
promag,2017-10-28T08:27:44Z,"Ping @theuni @TheBlueMatt, are you working on this?",https://github.com/bitcoin/bitcoin/pull/10697#issuecomment-340159490,340159490,
TheBlueMatt,2017-10-31T15:51:07Z,Addressed @sipa's comments.,https://github.com/bitcoin/bitcoin/pull/10697#issuecomment-340807059,340807059,
TheBlueMatt,2017-11-04T00:31:37Z,Superceded by #11604,https://github.com/bitcoin/bitcoin/pull/10697#issuecomment-341858082,341858082,
sipa,2017-10-28T09:26:22Z,This still calls `func` while `cs_vNodes` is held. Is that intentional?,https://github.com/bitcoin/bitcoin/pull/10697#discussion_r147550157,147550157,src/net.cpp
sipa,2017-10-28T09:27:46Z,"Nit: either `{` `}` around if body, or body on the same line (in multiple places).",https://github.com/bitcoin/bitcoin/pull/10697#discussion_r147550190,147550190,src/net.cpp
ryanofsky,2017-11-03T16:13:24Z,"This will leak reference count if func throws. Suggest using RAII helper to prevent this, see NodeRef in eeb85c63cf880bc7344413b266c3af793d5cb8d2. NodeRef also simplifies the ForEachNode implementations there.",https://github.com/bitcoin/bitcoin/pull/10697#discussion_r148827766,148827766,src/net.cpp
ryanofsky,2017-11-03T16:14:50Z,These should just call ForEachNodeThen with a null post functions so this code doesn't have to be repeated so many times. Again see eeb85c63cf880bc7344413b266c3af793d5cb8d2.,https://github.com/bitcoin/bitcoin/pull/10697#discussion_r148828143,148828143,src/net.cpp
ryanofsky,2017-11-03T16:18:28Z,"This should just say LeaveCritical(&(cs)). cs should be parenthesized since it's a macro argument, and the cast is unneeded.",https://github.com/bitcoin/bitcoin/pull/10697#discussion_r148829124,148829124,src/sync.h
