[
  {
    "sha": "4ca92dc6d3f3e487d63286d8871d1829b3d279ff",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0Y2E5MmRjNmQzZjNlNDg3ZDYzMjg2ZDg4NzFkMTgyOWIzZDI3OWZm",
    "commit": {
      "author": {
        "name": "fanquake",
        "email": "fanquake@gmail.com",
        "date": "2020-01-02T06:42:21Z"
      },
      "committer": {
        "name": "fanquake",
        "email": "fanquake@gmail.com",
        "date": "2020-01-02T06:42:21Z"
      },
      "message": "scripts: add MACHO PIE check to security-check.py",
      "tree": {
        "sha": "e3e929049d37d887188101d624ff8236c909e32b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e3e929049d37d887188101d624ff8236c909e32b"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4ca92dc6d3f3e487d63286d8871d1829b3d279ff",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEz7FuIclQ9n+pXlWPLuufXMCVJsEFAl4NkM4ACgkQLuufXMCV\nJsHiPBAAjtR0TzD4vk67UuOYI3zI5I7sXmAtzS1SFZKsyqVmjr44lMvFfetAw8SA\nIgxTcC4MRpQbICC7oBPT4OKJ+jXtGnWXMp5FZytn7A6RtwXTHMJbERKH4gxdQL1f\nNhTIFztT+Po0LBw8ZZVPAcm7hhayD9Cpa8r5O9zwFp4jj/XM2QaLKhObc/irg50k\nZneoXDpWDpgXdWskjimXAOzszNx5pB8ykaZ1XR/bixgCBTZFlj09b8GGzl8NBHai\nE3EH3Gs5ayXcmla9hed4UTRuNU8hL2znL9WC+3GqqrupFUnNOL7o+nhZT9x95Cea\nW2grle8aPrduq4pR31MV98SYh3JaF2ExZj2XWLkQV6GsQ9ftUAkIzHwaaeKh8+Nj\nXO2sgdk379jwfkhx1Jf7+F0fam+gjtDe++qyprP9DMXjMtPhxkFrxe2ZexZeWjjc\nFknbjXBKWlElZmirfupQWFWbF+/hcY/AukpZU3ysBVc7en0inFEvvcxxp932JUgS\nrh/LE/D6EVi778KzwF8yG5nWREnxW6+pCxbKtdCtoaDR4rrIPq1d88y5JSFgyIKA\nD1F7r9b1i1HlzwVb9hbe23Fj4Q1zTBSvKehUJLWPgcWOcpkFk6mRnxSMw3QQiUQd\nj8tXUjZcds4j3HNVZFfBzhh1HWyAjD6suSbU7Mwx5hbHNMxk2J0=\n=cZ7c\n-----END PGP SIGNATURE-----",
        "payload": "tree e3e929049d37d887188101d624ff8236c909e32b\nparent 35fff5be60e853455abc24713481544e91adfedb\nauthor fanquake <fanquake@gmail.com> 1577947341 +0800\ncommitter fanquake <fanquake@gmail.com> 1577947341 +0800\n\nscripts: add MACHO PIE check to security-check.py\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4ca92dc6d3f3e487d63286d8871d1829b3d279ff",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/4ca92dc6d3f3e487d63286d8871d1829b3d279ff",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4ca92dc6d3f3e487d63286d8871d1829b3d279ff/comments",
    "author": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "35fff5be60e853455abc24713481544e91adfedb",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/35fff5be60e853455abc24713481544e91adfedb",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/35fff5be60e853455abc24713481544e91adfedb"
      }
    ],
    "stats": {
      "total": 40,
      "additions": 36,
      "deletions": 4
    },
    "files": [
      {
        "sha": "c35affac59a2a9872d87361d582a6f724a785732",
        "filename": "contrib/devtools/README.md",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4ca92dc6d3f3e487d63286d8871d1829b3d279ff/contrib/devtools/README.md",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4ca92dc6d3f3e487d63286d8871d1829b3d279ff/contrib/devtools/README.md",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/devtools/README.md?ref=4ca92dc6d3f3e487d63286d8871d1829b3d279ff",
        "patch": "@@ -98,7 +98,7 @@ repository (requires pngcrush).\n security-check.py and test-security-check.py\n ============================================\n \n-Perform basic ELF security checks on a series of executables.\n+Perform basic security checks on a series of executables.\n \n symbol-check.py\n ==============="
      },
      {
        "sha": "7a2b925850052ad0135391da062ad7a2666940e5",
        "filename": "contrib/devtools/security-check.py",
        "status": "modified",
        "additions": 33,
        "deletions": 2,
        "changes": 35,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4ca92dc6d3f3e487d63286d8871d1829b3d279ff/contrib/devtools/security-check.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4ca92dc6d3f3e487d63286d8871d1829b3d279ff/contrib/devtools/security-check.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/devtools/security-check.py?ref=4ca92dc6d3f3e487d63286d8871d1829b3d279ff",
        "patch": "@@ -3,17 +3,18 @@\n # Distributed under the MIT software license, see the accompanying\n # file COPYING or http://www.opensource.org/licenses/mit-license.php.\n '''\n-Perform basic ELF security checks on a series of executables.\n+Perform basic security checks on a series of executables.\n Exit status will be 0 if successful, and the program will be silent.\n Otherwise the exit status will be 1 and it will log which executables failed which checks.\n-Needs `readelf` (for ELF) and `objdump` (for PE).\n+Needs `readelf` (for ELF), `objdump` (for PE) and `otool` (for MACHO).\n '''\n import subprocess\n import sys\n import os\n \n READELF_CMD = os.getenv('READELF', '/usr/bin/readelf')\n OBJDUMP_CMD = os.getenv('OBJDUMP', '/usr/bin/objdump')\n+OTOOL_CMD = os.getenv('OTOOL', '/usr/bin/otool')\n NONFATAL = {} # checks which are non-fatal for now but only generate a warning\n \n def check_ELF_PIE(executable):\n@@ -162,6 +163,31 @@ def check_PE_NX(executable):\n     (arch,bits) = get_PE_dll_characteristics(executable)\n     return (bits & IMAGE_DLL_CHARACTERISTICS_NX_COMPAT) == IMAGE_DLL_CHARACTERISTICS_NX_COMPAT\n \n+def get_MACHO_executable_flags(executable):\n+    p = subprocess.Popen([OTOOL_CMD, '-vh', executable], stdout=subprocess.PIPE, stderr=subprocess.PIPE, stdin=subprocess.PIPE, universal_newlines=True)\n+    (stdout, stderr) = p.communicate()\n+    if p.returncode:\n+        raise IOError('Error opening file')\n+\n+    flags = []\n+    for line in stdout.splitlines():\n+        tokens = line.split()\n+        # filter first two header lines\n+        if 'magic' in tokens or 'Mach' in tokens:\n+            continue\n+        # filter ncmds and sizeofcmds values\n+        flags += [t for t in tokens if not t.isdigit()]\n+    return flags\n+\n+def check_MACHO_PIE(executable) -> bool:\n+    '''\n+    Check for position independent executable (PIE), allowing for address space randomization.\n+    '''\n+    flags = get_MACHO_executable_flags(executable)\n+    if 'PIE' in flags:\n+        return True\n+    return False\n+\n CHECKS = {\n 'ELF': [\n     ('PIE', check_ELF_PIE),\n@@ -173,6 +199,9 @@ def check_PE_NX(executable):\n     ('DYNAMIC_BASE', check_PE_DYNAMIC_BASE),\n     ('HIGH_ENTROPY_VA', check_PE_HIGH_ENTROPY_VA),\n     ('NX', check_PE_NX)\n+],\n+'MACHO': [\n+    ('PIE', check_MACHO_PIE),\n ]\n }\n \n@@ -183,6 +212,8 @@ def identify_executable(executable):\n         return 'PE'\n     elif magic.startswith(b'\\x7fELF'):\n         return 'ELF'\n+    elif magic.startswith(b'\\xcf\\xfa'):\n+        return 'MACHO'\n     return None\n \n if __name__ == '__main__':"
      },
      {
        "sha": "75040c137fc09db5b4e9c853a4490adab7611f4c",
        "filename": "contrib/gitian-descriptors/gitian-osx.yml",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4ca92dc6d3f3e487d63286d8871d1829b3d279ff/contrib/gitian-descriptors/gitian-osx.yml",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4ca92dc6d3f3e487d63286d8871d1829b3d279ff/contrib/gitian-descriptors/gitian-osx.yml",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/gitian-descriptors/gitian-osx.yml?ref=4ca92dc6d3f3e487d63286d8871d1829b3d279ff",
        "patch": "@@ -137,6 +137,7 @@ script: |\n \n     CONFIG_SITE=${BASEPREFIX}/${i}/share/config.site ./configure --prefix=/ --disable-ccache --disable-maintainer-mode --disable-dependency-tracking ${CONFIGFLAGS}\n     make ${MAKEOPTS}\n+    make ${MAKEOPTS} -C src check-security\n     make install-strip DESTDIR=${INSTALLPATH}\n \n     make osx_volname"
      },
      {
        "sha": "b2736eed5bb5bf823957ab0705dec0b0586cb437",
        "filename": "src/Makefile.am",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4ca92dc6d3f3e487d63286d8871d1829b3d279ff/src/Makefile.am",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4ca92dc6d3f3e487d63286d8871d1829b3d279ff/src/Makefile.am",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/Makefile.am?ref=4ca92dc6d3f3e487d63286d8871d1829b3d279ff",
        "patch": "@@ -710,7 +710,7 @@ endif\n check-security: $(bin_PROGRAMS)\n if HARDEN\n \t@echo \"Checking binary security...\"\n-\t$(AM_V_at) READELF=$(READELF) OBJDUMP=$(OBJDUMP) $(PYTHON) $(top_srcdir)/contrib/devtools/security-check.py < $(bin_PROGRAMS)\n+\t$(AM_V_at) READELF=$(READELF) OBJDUMP=$(OBJDUMP) OTOOL=$(OTOOL) $(PYTHON) $(top_srcdir)/contrib/devtools/security-check.py < $(bin_PROGRAMS)\n endif\n \n if EMBEDDED_LEVELDB"
      }
    ]
  },
  {
    "sha": "7c9e821c4e6cb186208ead9c8df616d1f393a49a",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo3YzllODIxYzRlNmNiMTg2MjA4ZWFkOWM4ZGY2MTZkMWYzOTNhNDlh",
    "commit": {
      "author": {
        "name": "fanquake",
        "email": "fanquake@gmail.com",
        "date": "2019-12-31T20:58:13Z"
      },
      "committer": {
        "name": "fanquake",
        "email": "fanquake@gmail.com",
        "date": "2020-01-02T06:42:23Z"
      },
      "message": "scripts: add MACHO NOUNDEFS check to security-check.py",
      "tree": {
        "sha": "9b628192d148107c21d6e51ff3c088f0d9231369",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9b628192d148107c21d6e51ff3c088f0d9231369"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7c9e821c4e6cb186208ead9c8df616d1f393a49a",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEz7FuIclQ9n+pXlWPLuufXMCVJsEFAl4NkM8ACgkQLuufXMCV\nJsEtZxAAqtZuuo5QTNw31YGQB6NZ8v/AjSUNs/8ZVhlR7E9yOTjw7gFCmP88VfNf\n2ucYVmZDvGaN0RdVU5YGEI1X+Glf8vA0npnsgWP/3wumMjMkKp8DrMawgoYIh0i1\nx5uq8N9cd4/Zv97KG44MrVAQvRKrL3i5o5RkjgM5vOghZ9SolvPn2/90tjHnEZbd\n5vrnYrLSzhnqzItiEs8BB1/WWstSOUmmrICkbxoGxQ59N3fJKwsuXWxm3dkyEPHk\n5wDw/K1aENO0VUjYka7+me7lrS8MPUWIfBFU2XUqISpO+xr8HQIx0uwt34l16tcH\nY61oUaMSdRWClDHZ0tjcWkjU3ABOEYttvpEl5HTDljbG1rR0TIL+vMm7rg038jEh\ncTKGlDbZb/spHd+Bv3lDOOdPNEKUx5rDZhdxRIK1kX71ERsvynPooPhreCaJHyOy\nW2ZU1MWgmWsQGzUCcHzUo9x7ny7t0HnnpRKMegDD+aGjdfY7m8ISyeBBoqyv1nB8\nkAhpSa+33fFLbvkhwtzK5fiLITzm9hlO+cAXR8Jg7sXNlI12EQiqnivYuTBnmta1\nDZRKiuoeJ1XdFWRfZrm4h8H5XR1AchSSOhYVxuZ2Ya7g17VPnxIZ9eXTS62n6vc4\npfF2EOxno1pyot7VKuagD+/xtVP4z7OMH7VyNo+4VwhWqqUbD2Y=\n=cJP6\n-----END PGP SIGNATURE-----",
        "payload": "tree 9b628192d148107c21d6e51ff3c088f0d9231369\nparent 4ca92dc6d3f3e487d63286d8871d1829b3d279ff\nauthor fanquake <fanquake@gmail.com> 1577825893 +0300\ncommitter fanquake <fanquake@gmail.com> 1577947343 +0800\n\nscripts: add MACHO NOUNDEFS check to security-check.py\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7c9e821c4e6cb186208ead9c8df616d1f393a49a",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/7c9e821c4e6cb186208ead9c8df616d1f393a49a",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7c9e821c4e6cb186208ead9c8df616d1f393a49a/comments",
    "author": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "4ca92dc6d3f3e487d63286d8871d1829b3d279ff",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4ca92dc6d3f3e487d63286d8871d1829b3d279ff",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/4ca92dc6d3f3e487d63286d8871d1829b3d279ff"
      }
    ],
    "stats": {
      "total": 10,
      "additions": 10,
      "deletions": 0
    },
    "files": [
      {
        "sha": "9941c574797fec75eeabaf86325f14bb0e41ed2f",
        "filename": "contrib/devtools/security-check.py",
        "status": "modified",
        "additions": 10,
        "deletions": 0,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7c9e821c4e6cb186208ead9c8df616d1f393a49a/contrib/devtools/security-check.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7c9e821c4e6cb186208ead9c8df616d1f393a49a/contrib/devtools/security-check.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/devtools/security-check.py?ref=7c9e821c4e6cb186208ead9c8df616d1f393a49a",
        "patch": "@@ -188,6 +188,15 @@ def check_MACHO_PIE(executable) -> bool:\n         return True\n     return False\n \n+def check_MACHO_NOUNDEFS(executable) -> bool:\n+    '''\n+    Check for no undefined references.\n+    '''\n+    flags = get_MACHO_executable_flags(executable)\n+    if 'NOUNDEFS' in flags:\n+        return True\n+    return False\n+\n CHECKS = {\n 'ELF': [\n     ('PIE', check_ELF_PIE),\n@@ -202,6 +211,7 @@ def check_MACHO_PIE(executable) -> bool:\n ],\n 'MACHO': [\n     ('PIE', check_MACHO_PIE),\n+    ('NOUNDEFS', check_MACHO_NOUNDEFS),\n ]\n }\n "
      }
    ]
  }
]