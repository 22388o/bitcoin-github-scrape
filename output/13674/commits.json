[
  {
    "sha": "0636f38ad163333319756e865f074a79380dd7ed",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzowNjM2ZjM4YWQxNjMzMzMzMTk3NTZlODY1ZjA3NGE3OTM4MGRkN2Vk",
    "commit": {
      "author": {
        "name": "Leandro Rocha",
        "email": "leko.enc@gmail.com",
        "date": "2018-07-15T08:35:15Z"
      },
      "committer": {
        "name": "Leandro Rocha",
        "email": "leko.enc@gmail.com",
        "date": "2019-05-05T21:08:34Z"
      },
      "message": "Allow GUI to remain responsive during shutdown  when there's a long running RPC call",
      "tree": {
        "sha": "c8cf060772c70a52b34093fd38e2a14f3f28e85f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c8cf060772c70a52b34093fd38e2a14f3f28e85f"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0636f38ad163333319756e865f074a79380dd7ed",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0636f38ad163333319756e865f074a79380dd7ed",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/0636f38ad163333319756e865f074a79380dd7ed",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0636f38ad163333319756e865f074a79380dd7ed/comments",
    "author": {
      "login": "LeandroRocha84",
      "id": 8540640,
      "node_id": "MDQ6VXNlcjg1NDA2NDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8540640?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/LeandroRocha84",
      "html_url": "https://github.com/LeandroRocha84",
      "followers_url": "https://api.github.com/users/LeandroRocha84/followers",
      "following_url": "https://api.github.com/users/LeandroRocha84/following{/other_user}",
      "gists_url": "https://api.github.com/users/LeandroRocha84/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/LeandroRocha84/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LeandroRocha84/subscriptions",
      "organizations_url": "https://api.github.com/users/LeandroRocha84/orgs",
      "repos_url": "https://api.github.com/users/LeandroRocha84/repos",
      "events_url": "https://api.github.com/users/LeandroRocha84/events{/privacy}",
      "received_events_url": "https://api.github.com/users/LeandroRocha84/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "LeandroRocha84",
      "id": 8540640,
      "node_id": "MDQ6VXNlcjg1NDA2NDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8540640?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/LeandroRocha84",
      "html_url": "https://github.com/LeandroRocha84",
      "followers_url": "https://api.github.com/users/LeandroRocha84/followers",
      "following_url": "https://api.github.com/users/LeandroRocha84/following{/other_user}",
      "gists_url": "https://api.github.com/users/LeandroRocha84/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/LeandroRocha84/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LeandroRocha84/subscriptions",
      "organizations_url": "https://api.github.com/users/LeandroRocha84/orgs",
      "repos_url": "https://api.github.com/users/LeandroRocha84/repos",
      "events_url": "https://api.github.com/users/LeandroRocha84/events{/privacy}",
      "received_events_url": "https://api.github.com/users/LeandroRocha84/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "0c9de67f343c0e740a7f488e85270d519a352119",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0c9de67f343c0e740a7f488e85270d519a352119",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/0c9de67f343c0e740a7f488e85270d519a352119"
      }
    ],
    "stats": {
      "total": 34,
      "additions": 24,
      "deletions": 10
    },
    "files": [
      {
        "sha": "0714ff4e16a9f80618fdf0988067b3d055c00501",
        "filename": "src/qt/bitcoingui.cpp",
        "status": "modified",
        "additions": 20,
        "deletions": 9,
        "changes": 29,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/0636f38ad163333319756e865f074a79380dd7ed/src/qt/bitcoingui.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/0636f38ad163333319756e865f074a79380dd7ed/src/qt/bitcoingui.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/bitcoingui.cpp?ref=0636f38ad163333319756e865f074a79380dd7ed",
        "patch": "@@ -548,9 +548,9 @@ void BitcoinGUI::createToolBars()\n \n void BitcoinGUI::setClientModel(ClientModel *_clientModel)\n {\n-    this->clientModel = _clientModel;\n     if(_clientModel)\n     {\n+        this->clientModel = _clientModel;\n         // Create system tray menu (or setup the dock menu) that late to prevent users from calling actions,\n         // while the client has not yet fully loaded\n         createTrayIconMenu();\n@@ -601,15 +601,24 @@ void BitcoinGUI::setClientModel(ClientModel *_clientModel)\n             trayIconMenu->clear();\n         }\n         // Propagate cleared model to child objects\n+        connect(rpcConsole, &RPCConsole::executorThreadFinished, this, &BitcoinGUI::clearChildModels);\n         rpcConsole->setClientModel(nullptr);\n+        // Allow GUI to remain responsive when there's a long running rpc call.\n+        qApp->exec();\n+    }\n+}\n+\n+void BitcoinGUI::clearChildModels()\n+{\n+    this->clientModel = nullptr;\n #ifdef ENABLE_WALLET\n-        if (walletFrame)\n-        {\n-            walletFrame->setClientModel(nullptr);\n-        }\n-#endif // ENABLE_WALLET\n-        unitDisplayControl->setOptionsModel(nullptr);\n+    if (walletFrame)\n+    {\n+        walletFrame->setClientModel(nullptr);\n     }\n+#endif // ENABLE_WALLET\n+    unitDisplayControl->setOptionsModel(nullptr);\n+    qApp->quit();\n }\n \n #ifdef ENABLE_WALLET\n@@ -1115,7 +1124,7 @@ void BitcoinGUI::closeEvent(QCloseEvent *event)\n         {\n             // close rpcConsole in case it was open to make some space for the shutdown window\n             rpcConsole->close();\n-\n+            closeEventRegistered = true;\n             QApplication::quit();\n         }\n         else\n@@ -1311,7 +1320,9 @@ void BitcoinGUI::detectShutdown()\n     {\n         if(rpcConsole)\n             rpcConsole->hide();\n-        qApp->quit();\n+        if(!closeEventRegistered) {\n+            qApp->quit();\n+        }\n     }\n }\n "
      },
      {
        "sha": "abf5cec1f33e82c3f54fad463d106f19660c5bd8",
        "filename": "src/qt/bitcoingui.h",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/0636f38ad163333319756e865f074a79380dd7ed/src/qt/bitcoingui.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/0636f38ad163333319756e865f074a79380dd7ed/src/qt/bitcoingui.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/bitcoingui.h?ref=0636f38ad163333319756e865f074a79380dd7ed",
        "patch": "@@ -161,6 +161,7 @@ class BitcoinGUI : public QMainWindow\n     RPCConsole* rpcConsole = nullptr;\n     HelpMessageDialog* helpMessageDialog = nullptr;\n     ModalOverlay* modalOverlay = nullptr;\n+    bool closeEventRegistered = false;\n \n #ifdef Q_OS_MAC\n     CAppNapInhibitor* m_app_nap_inhibitor = nullptr;\n@@ -220,6 +221,7 @@ public Q_SLOTS:\n        @param[in] ret       pointer to a bool that will be modified to whether Ok was clicked (modal only)\n     */\n     void message(const QString &title, const QString &message, unsigned int style, bool *ret = nullptr);\n+    void clearChildModels();\n \n #ifdef ENABLE_WALLET\n     void setCurrentWallet(WalletModel* wallet_model);"
      },
      {
        "sha": "729be00d99757d560a630381cc53220c684a7808",
        "filename": "src/qt/rpcconsole.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/0636f38ad163333319756e865f074a79380dd7ed/src/qt/rpcconsole.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/0636f38ad163333319756e865f074a79380dd7ed/src/qt/rpcconsole.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/rpcconsole.cpp?ref=0636f38ad163333319756e865f074a79380dd7ed",
        "patch": "@@ -686,8 +686,8 @@ void RPCConsole::setClientModel(ClientModel *model)\n     }\n     if (!model) {\n         // Client model is being set to 0, this means shutdown() is about to be called.\n+        connect(&thread, &QThread::finished, this, &RPCConsole::executorThreadFinished);\n         thread.quit();\n-        thread.wait();\n     }\n }\n "
      },
      {
        "sha": "b1bdd1e63551d621294c85984e4fbf4b01037a85",
        "filename": "src/qt/rpcconsole.h",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/0636f38ad163333319756e865f074a79380dd7ed/src/qt/rpcconsole.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/0636f38ad163333319756e865f074a79380dd7ed/src/qt/rpcconsole.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/rpcconsole.h?ref=0636f38ad163333319756e865f074a79380dd7ed",
        "patch": "@@ -133,6 +133,7 @@ public Q_SLOTS:\n Q_SIGNALS:\n     // For RPC command executor\n     void cmdRequest(const QString &command, const WalletModel* wallet_model);\n+    void executorThreadFinished();\n \n private:\n     void startExecutor();"
      }
    ]
  }
]