[
  {
    "sha": "43cb41859e910797510ef1117644fa2cd3c96fc9",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0M2NiNDE4NTllOTEwNzk3NTEwZWYxMTE3NjQ0ZmEyY2QzYzk2ZmM5",
    "commit": {
      "author": {
        "name": "Manuel Araoz",
        "email": "manuelaraoz@gmail.com",
        "date": "2014-03-28T19:28:13Z"
      },
      "committer": {
        "name": "Manuel Araoz",
        "email": "manuelaraoz@gmail.com",
        "date": "2014-03-31T14:19:19Z"
      },
      "message": "Add sighash tests from data file",
      "tree": {
        "sha": "c0651b1f0ad3c46431d0d2a633d8a55cfabd9ddb",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c0651b1f0ad3c46431d0d2a633d8a55cfabd9ddb"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/43cb41859e910797510ef1117644fa2cd3c96fc9",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/43cb41859e910797510ef1117644fa2cd3c96fc9",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/43cb41859e910797510ef1117644fa2cd3c96fc9",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/43cb41859e910797510ef1117644fa2cd3c96fc9/comments",
    "author": {
      "login": "maraoz",
      "id": 287189,
      "node_id": "MDQ6VXNlcjI4NzE4OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/287189?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/maraoz",
      "html_url": "https://github.com/maraoz",
      "followers_url": "https://api.github.com/users/maraoz/followers",
      "following_url": "https://api.github.com/users/maraoz/following{/other_user}",
      "gists_url": "https://api.github.com/users/maraoz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/maraoz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/maraoz/subscriptions",
      "organizations_url": "https://api.github.com/users/maraoz/orgs",
      "repos_url": "https://api.github.com/users/maraoz/repos",
      "events_url": "https://api.github.com/users/maraoz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/maraoz/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "maraoz",
      "id": 287189,
      "node_id": "MDQ6VXNlcjI4NzE4OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/287189?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/maraoz",
      "html_url": "https://github.com/maraoz",
      "followers_url": "https://api.github.com/users/maraoz/followers",
      "following_url": "https://api.github.com/users/maraoz/following{/other_user}",
      "gists_url": "https://api.github.com/users/maraoz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/maraoz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/maraoz/subscriptions",
      "organizations_url": "https://api.github.com/users/maraoz/orgs",
      "repos_url": "https://api.github.com/users/maraoz/repos",
      "events_url": "https://api.github.com/users/maraoz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/maraoz/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "db3a5e4151a499d94f1738934d280a4163295ff7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/db3a5e4151a499d94f1738934d280a4163295ff7",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/db3a5e4151a499d94f1738934d280a4163295ff7"
      }
    ],
    "stats": {
      "total": 566,
      "additions": 562,
      "deletions": 4
    },
    "files": [
      {
        "sha": "b375ba1306d7a5b34e5c0367ddd320f40ef43dc7",
        "filename": "src/test/Makefile.am",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/43cb41859e910797510ef1117644fa2cd3c96fc9/src/test/Makefile.am",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/43cb41859e910797510ef1117644fa2cd3c96fc9/src/test/Makefile.am",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/Makefile.am?ref=43cb41859e910797510ef1117644fa2cd3c96fc9",
        "patch": "@@ -15,7 +15,8 @@ JSON_TEST_FILES = \\\n   data/base58_keys_invalid.json \\\n   data/script_invalid.json \\\n   data/tx_invalid.json \\\n-  data/tx_valid.json\n+  data/tx_valid.json \\\n+  data/sighash.json\n \n RAW_TEST_FILES = data/alertTests.raw\n "
      },
      {
        "sha": "d66a56ac35bdba08148bcb5db94c11a6df107097",
        "filename": "src/test/data/sighash.json",
        "status": "added",
        "additions": 503,
        "deletions": 0,
        "changes": 503,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/43cb41859e910797510ef1117644fa2cd3c96fc9/src/test/data/sighash.json",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/43cb41859e910797510ef1117644fa2cd3c96fc9/src/test/data/sighash.json",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/data/sighash.json?ref=43cb41859e910797510ef1117644fa2cd3c96fc9"
      },
      {
        "sha": "0cc9bc20b9a12d89fb046a4a6e0b5f8b8c8fbb45",
        "filename": "src/test/sighash_tests.cpp",
        "status": "modified",
        "additions": 57,
        "deletions": 3,
        "changes": 60,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/43cb41859e910797510ef1117644fa2cd3c96fc9/src/test/sighash_tests.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/43cb41859e910797510ef1117644fa2cd3c96fc9/src/test/sighash_tests.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/sighash_tests.cpp?ref=43cb41859e910797510ef1117644fa2cd3c96fc9",
        "patch": "@@ -3,9 +3,20 @@\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n #include <boost/test/unit_test.hpp>\n+#include <iostream>\n \n #include \"main.h\"\n #include \"util.h\"\n+#include \"serialize.h\"\n+#include \"version.h\"\n+#include \"data/sighash.json.h\"\n+\n+#include \"json/json_spirit_reader_template.h\"\n+#include \"json/json_spirit_utils.h\"\n+#include \"json/json_spirit_writer_template.h\"\n+\n+using namespace json_spirit;\n+extern Array read_json(const std::string& jsondata);\n \n extern uint256 SignatureHash(const CScript &scriptCode, const CTransaction& txTo, unsigned int nIn, int nHashType);\n \n@@ -103,7 +114,6 @@ void static RandomTransaction(CTransaction &tx, bool fSingle) {\n }\n \n BOOST_AUTO_TEST_SUITE(sighash_tests)\n-\n BOOST_AUTO_TEST_CASE(sighash_test)\n {\n     seed_insecure_rand(false);\n@@ -115,10 +125,54 @@ BOOST_AUTO_TEST_CASE(sighash_test)\n         CScript scriptCode;\n         RandomScript(scriptCode);\n         int nIn = insecure_rand() % txTo.vin.size();\n-        BOOST_CHECK(SignatureHash(scriptCode, txTo, nIn, nHashType) ==\n-        SignatureHashOld(scriptCode, txTo, nIn, nHashType));\n+\n+        uint256 sh, sho;\n+        sho = SignatureHashOld(scriptCode, txTo, nIn, nHashType);\n+        sh = SignatureHash(scriptCode, txTo, nIn, nHashType);\n+        BOOST_CHECK(sh == sho);\n     }\n }\n \n+// Goal: check that SignatureHash generates correct hash\n+\n+BOOST_AUTO_TEST_CASE(sighash_from_data)\n+{\n+    Array tests = read_json(std::string(json_tests::sighash, json_tests::sighash + sizeof(json_tests::sighash)));\n+\n+    BOOST_FOREACH(Value& tv, tests)\n+    {\n+        Array test = tv.get_array();\n+        std::string strTest = write_string(tv, false);\n+        if (test.size() < 1) // Allow for extra stuff (useful for comments)\n+        {\n+            BOOST_ERROR(\"Bad test: \" << strTest);\n+            continue;\n+        }\n+        if (test.size() == 1) continue; // comment\n+\n+        std::string raw_tx = test[0].get_str();\n+        std::string raw_script = test[1].get_str();\n+        int nIn = test[2].get_int();\n+        int nHashType = test[3].get_int();\n+        std::string sigHashHex = test[4].get_str();\n+\n+        uint256 sh;\n+        CDataStream stream(ParseHex(raw_tx), SER_NETWORK, PROTOCOL_VERSION);\n+        CTransaction tx;\n+        stream >> tx;\n+\n+        CValidationState state;\n+        BOOST_CHECK_MESSAGE(CheckTransaction(tx, state), strTest);\n+        BOOST_CHECK(state.IsValid());\n+\n+        CScript scriptCode = CScript();\n+        std::vector<unsigned char> raw = ParseHex(raw_script);\n+        scriptCode.insert(scriptCode.end(), raw.begin(), raw.end());\n+\n+        sh = SignatureHash(scriptCode, tx, nIn, nHashType);\n+\n+        BOOST_CHECK_MESSAGE(sh.GetHex() == sigHashHex, strTest);\n+    }\n+}\n BOOST_AUTO_TEST_SUITE_END()\n "
      }
    ]
  },
  {
    "sha": "232aa9e034d4d48f4d16dfdc6bc0d56c9274cfd3",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyMzJhYTllMDM0ZDRkNDhmNGQxNmRmZGM2YmMwZDU2YzkyNzRjZmQz",
    "commit": {
      "author": {
        "name": "Manuel Araoz",
        "email": "manuelaraoz@gmail.com",
        "date": "2014-03-31T15:39:32Z"
      },
      "committer": {
        "name": "Manuel Araoz",
        "email": "manuelaraoz@gmail.com",
        "date": "2014-03-31T15:39:32Z"
      },
      "message": "Add code generating data/sighash.json test data",
      "tree": {
        "sha": "82f90605a24d0f2dd2b8ddde06f6efd803b3a347",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/82f90605a24d0f2dd2b8ddde06f6efd803b3a347"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/232aa9e034d4d48f4d16dfdc6bc0d56c9274cfd3",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/232aa9e034d4d48f4d16dfdc6bc0d56c9274cfd3",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/232aa9e034d4d48f4d16dfdc6bc0d56c9274cfd3",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/232aa9e034d4d48f4d16dfdc6bc0d56c9274cfd3/comments",
    "author": {
      "login": "maraoz",
      "id": 287189,
      "node_id": "MDQ6VXNlcjI4NzE4OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/287189?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/maraoz",
      "html_url": "https://github.com/maraoz",
      "followers_url": "https://api.github.com/users/maraoz/followers",
      "following_url": "https://api.github.com/users/maraoz/following{/other_user}",
      "gists_url": "https://api.github.com/users/maraoz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/maraoz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/maraoz/subscriptions",
      "organizations_url": "https://api.github.com/users/maraoz/orgs",
      "repos_url": "https://api.github.com/users/maraoz/repos",
      "events_url": "https://api.github.com/users/maraoz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/maraoz/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "maraoz",
      "id": 287189,
      "node_id": "MDQ6VXNlcjI4NzE4OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/287189?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/maraoz",
      "html_url": "https://github.com/maraoz",
      "followers_url": "https://api.github.com/users/maraoz/followers",
      "following_url": "https://api.github.com/users/maraoz/following{/other_user}",
      "gists_url": "https://api.github.com/users/maraoz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/maraoz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/maraoz/subscriptions",
      "organizations_url": "https://api.github.com/users/maraoz/orgs",
      "repos_url": "https://api.github.com/users/maraoz/repos",
      "events_url": "https://api.github.com/users/maraoz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/maraoz/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "43cb41859e910797510ef1117644fa2cd3c96fc9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/43cb41859e910797510ef1117644fa2cd3c96fc9",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/43cb41859e910797510ef1117644fa2cd3c96fc9"
      }
    ],
    "stats": {
      "total": 33,
      "additions": 30,
      "deletions": 3
    },
    "files": [
      {
        "sha": "9985ad69280154c0790e2cbe336da7f7c3ed6065",
        "filename": "src/test/sighash_tests.cpp",
        "status": "modified",
        "additions": 30,
        "deletions": 3,
        "changes": 33,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/232aa9e034d4d48f4d16dfdc6bc0d56c9274cfd3/src/test/sighash_tests.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/232aa9e034d4d48f4d16dfdc6bc0d56c9274cfd3/src/test/sighash_tests.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/sighash_tests.cpp?ref=232aa9e034d4d48f4d16dfdc6bc0d56c9274cfd3",
        "patch": "@@ -114,11 +114,21 @@ void static RandomTransaction(CTransaction &tx, bool fSingle) {\n }\n \n BOOST_AUTO_TEST_SUITE(sighash_tests)\n+\n BOOST_AUTO_TEST_CASE(sighash_test)\n {\n     seed_insecure_rand(false);\n-\n-    for (int i=0; i<50000; i++) {\n+  \n+    #if defined(PRINT_SIGHASH_JSON)\n+    std::cout << \"[\\n\";\n+    std::cout << \"\\t[\\\"raw_transaction, script, input_index, hashType, signature_hash (result)\\\"],\\n\";\n+    #endif\n+    int nRandomTests = 50000;\n+\n+    #if defined(PRINT_SIGHASH_JSON)\n+    nRandomTests = 500;\n+    #endif\n+    for (int i=0; i<nRandomTests; i++) {\n         int nHashType = insecure_rand();\n         CTransaction txTo;\n         RandomTransaction(txTo, (nHashType & 0x1f) == SIGHASH_SINGLE);\n@@ -129,12 +139,29 @@ BOOST_AUTO_TEST_CASE(sighash_test)\n         uint256 sh, sho;\n         sho = SignatureHashOld(scriptCode, txTo, nIn, nHashType);\n         sh = SignatureHash(scriptCode, txTo, nIn, nHashType);\n+        #if defined(PRINT_SIGHASH_JSON)\n+        CDataStream ss(SER_NETWORK, PROTOCOL_VERSION);\n+        ss << txTo;\n+\n+        std::cout << \"\\t[\\\"\" ;\n+        std::cout << HexStr(ss.begin(), ss.end()) << \"\\\", \\\"\";\n+        std::cout << HexStr(scriptCode) << \"\\\", \";\n+        std::cout << nIn << \", \";\n+        std::cout << nHashType << \", \\\"\";\n+        std::cout << sho.GetHex() << \"\\\"]\";\n+        if (i+1 != nRandomTests) {\n+          std::cout << \",\";\n+        }\n+        std::cout << \"\\n\";\n+        #endif\n         BOOST_CHECK(sh == sho);\n     }\n+    #if defined(PRINT_SIGHASH_JSON)\n+    std::cout << \"]\\n\";\n+    #endif\n }\n \n // Goal: check that SignatureHash generates correct hash\n-\n BOOST_AUTO_TEST_CASE(sighash_from_data)\n {\n     Array tests = read_json(std::string(json_tests::sighash, json_tests::sighash + sizeof(json_tests::sighash)));"
      }
    ]
  },
  {
    "sha": "81bfb5aebf983f999d3de12ca4adf8cd4c4a8ae0",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4MWJmYjVhZWJmOTgzZjk5OWQzZGUxMmNhNGFkZjhjZDRjNGE4YWUw",
    "commit": {
      "author": {
        "name": "Manuel Araoz",
        "email": "manuelaraoz@gmail.com",
        "date": "2014-03-31T18:07:46Z"
      },
      "committer": {
        "name": "Manuel Araoz",
        "email": "manuelaraoz@gmail.com",
        "date": "2014-03-31T18:07:46Z"
      },
      "message": "add checks for deserialization errors",
      "tree": {
        "sha": "1e2cd9ddbef2661a188fd0f4a568011a267089dd",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1e2cd9ddbef2661a188fd0f4a568011a267089dd"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/81bfb5aebf983f999d3de12ca4adf8cd4c4a8ae0",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/81bfb5aebf983f999d3de12ca4adf8cd4c4a8ae0",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/81bfb5aebf983f999d3de12ca4adf8cd4c4a8ae0",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/81bfb5aebf983f999d3de12ca4adf8cd4c4a8ae0/comments",
    "author": {
      "login": "maraoz",
      "id": 287189,
      "node_id": "MDQ6VXNlcjI4NzE4OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/287189?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/maraoz",
      "html_url": "https://github.com/maraoz",
      "followers_url": "https://api.github.com/users/maraoz/followers",
      "following_url": "https://api.github.com/users/maraoz/following{/other_user}",
      "gists_url": "https://api.github.com/users/maraoz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/maraoz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/maraoz/subscriptions",
      "organizations_url": "https://api.github.com/users/maraoz/orgs",
      "repos_url": "https://api.github.com/users/maraoz/repos",
      "events_url": "https://api.github.com/users/maraoz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/maraoz/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "maraoz",
      "id": 287189,
      "node_id": "MDQ6VXNlcjI4NzE4OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/287189?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/maraoz",
      "html_url": "https://github.com/maraoz",
      "followers_url": "https://api.github.com/users/maraoz/followers",
      "following_url": "https://api.github.com/users/maraoz/following{/other_user}",
      "gists_url": "https://api.github.com/users/maraoz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/maraoz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/maraoz/subscriptions",
      "organizations_url": "https://api.github.com/users/maraoz/orgs",
      "repos_url": "https://api.github.com/users/maraoz/repos",
      "events_url": "https://api.github.com/users/maraoz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/maraoz/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "232aa9e034d4d48f4d16dfdc6bc0d56c9274cfd3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/232aa9e034d4d48f4d16dfdc6bc0d56c9274cfd3",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/232aa9e034d4d48f4d16dfdc6bc0d56c9274cfd3"
      }
    ],
    "stats": {
      "total": 41,
      "additions": 25,
      "deletions": 16
    },
    "files": [
      {
        "sha": "353fd60f7b8a7d566ea0ef408c69caee12860595",
        "filename": "src/test/sighash_tests.cpp",
        "status": "modified",
        "additions": 25,
        "deletions": 16,
        "changes": 41,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/81bfb5aebf983f999d3de12ca4adf8cd4c4a8ae0/src/test/sighash_tests.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/81bfb5aebf983f999d3de12ca4adf8cd4c4a8ae0/src/test/sighash_tests.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/sighash_tests.cpp?ref=81bfb5aebf983f999d3de12ca4adf8cd4c4a8ae0",
        "patch": "@@ -177,27 +177,36 @@ BOOST_AUTO_TEST_CASE(sighash_from_data)\n         }\n         if (test.size() == 1) continue; // comment\n \n-        std::string raw_tx = test[0].get_str();\n-        std::string raw_script = test[1].get_str();\n-        int nIn = test[2].get_int();\n-        int nHashType = test[3].get_int();\n-        std::string sigHashHex = test[4].get_str();\n-\n+        std::string raw_tx, raw_script, sigHashHex;\n+        int nIn, nHashType;\n         uint256 sh;\n-        CDataStream stream(ParseHex(raw_tx), SER_NETWORK, PROTOCOL_VERSION);\n         CTransaction tx;\n-        stream >> tx;\n-\n-        CValidationState state;\n-        BOOST_CHECK_MESSAGE(CheckTransaction(tx, state), strTest);\n-        BOOST_CHECK(state.IsValid());\n-\n         CScript scriptCode = CScript();\n-        std::vector<unsigned char> raw = ParseHex(raw_script);\n-        scriptCode.insert(scriptCode.end(), raw.begin(), raw.end());\n \n+        try {\n+          // deserialize test data\n+          raw_tx = test[0].get_str();\n+          raw_script = test[1].get_str();\n+          nIn = test[2].get_int();\n+          nHashType = test[3].get_int();\n+          sigHashHex = test[4].get_str();\n+\n+          uint256 sh;\n+          CDataStream stream(ParseHex(raw_tx), SER_NETWORK, PROTOCOL_VERSION);\n+          stream >> tx;\n+\n+          CValidationState state;\n+          BOOST_CHECK_MESSAGE(CheckTransaction(tx, state), strTest);\n+          BOOST_CHECK(state.IsValid());\n+\n+          std::vector<unsigned char> raw = ParseHex(raw_script);\n+          scriptCode.insert(scriptCode.end(), raw.begin(), raw.end());\n+        } catch (...) {\n+          BOOST_ERROR(\"Bad test, couldn't deserialize data: \" << strTest);\n+          continue;\n+        }\n+        \n         sh = SignatureHash(scriptCode, tx, nIn, nHashType);\n-\n         BOOST_CHECK_MESSAGE(sh.GetHex() == sigHashHex, strTest);\n     }\n }"
      }
    ]
  }
]