[
  {
    "sha": "883cea7dea3cedc9b45b6191f7d4e7be2d9a11ca",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4ODNjZWE3ZGVhM2NlZGM5YjQ1YjYxOTFmN2Q0ZTdiZTJkOWExMWNh",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2020-10-12T21:20:28Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2020-10-12T22:15:28Z"
      },
      "message": "Restore compatibility with old CSubNet serialization",
      "tree": {
        "sha": "10dc409a242a4b877dd79deec941654aca7bb40d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/10dc409a242a4b877dd79deec941654aca7bb40d"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/883cea7dea3cedc9b45b6191f7d4e7be2d9a11ca",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/883cea7dea3cedc9b45b6191f7d4e7be2d9a11ca",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/883cea7dea3cedc9b45b6191f7d4e7be2d9a11ca",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/883cea7dea3cedc9b45b6191f7d4e7be2d9a11ca/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "0b2abaa666d6f3331e3246ffd64dd47946e9dcdf",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0b2abaa666d6f3331e3246ffd64dd47946e9dcdf",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/0b2abaa666d6f3331e3246ffd64dd47946e9dcdf"
      }
    ],
    "stats": {
      "total": 16,
      "additions": 15,
      "deletions": 1
    },
    "files": [
      {
        "sha": "aea08755119270fe9dcd704630cfcffe40db9a8b",
        "filename": "src/netaddress.h",
        "status": "modified",
        "additions": 15,
        "deletions": 1,
        "changes": 16,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/883cea7dea3cedc9b45b6191f7d4e7be2d9a11ca/src/netaddress.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/883cea7dea3cedc9b45b6191f7d4e7be2d9a11ca/src/netaddress.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/netaddress.h?ref=883cea7dea3cedc9b45b6191f7d4e7be2d9a11ca",
        "patch": "@@ -468,7 +468,21 @@ class CSubNet\n         friend bool operator!=(const CSubNet& a, const CSubNet& b) { return !(a == b); }\n         friend bool operator<(const CSubNet& a, const CSubNet& b);\n \n-        SERIALIZE_METHODS(CSubNet, obj) { READWRITE(obj.network, obj.netmask, obj.valid); }\n+        SERIALIZE_METHODS(CSubNet, obj)\n+        {\n+            READWRITE(obj.network);\n+            if (obj.network.IsIPv4()) {\n+                // Before commit 102867c587f5f7954232fb8ed8e85cda78bb4d32, CSubNet used the last 4 bytes of netmask\n+                // to store the relevant bytes for an IPv4 mask. For compatiblity reasons, keep doing so in\n+                // serialized form.\n+                unsigned char dummy[12] = {0};\n+                READWRITE(dummy);\n+                READWRITE(MakeSpan(obj.netmask).first(4));\n+            } else {\n+                READWRITE(obj.netmask);\n+            }\n+            READWRITE(obj.valid);\n+        }\n };\n \n /** A combination of a network address (CNetAddr) and a (TCP) port */"
      }
    ]
  },
  {
    "sha": "886be97af5d4aba338b23a7b20b8560be8156231",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4ODZiZTk3YWY1ZDRhYmEzMzhiMjNhN2IyMGI4NTYwYmU4MTU2MjMx",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2020-10-12T22:35:08Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2020-10-12T22:35:08Z"
      },
      "message": "Ignore incorrectly-serialized banlist.dat entries",
      "tree": {
        "sha": "ccc1c69bdee6c79b398c1e031e81d48a2b54a89a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ccc1c69bdee6c79b398c1e031e81d48a2b54a89a"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/886be97af5d4aba338b23a7b20b8560be8156231",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/886be97af5d4aba338b23a7b20b8560be8156231",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/886be97af5d4aba338b23a7b20b8560be8156231",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/886be97af5d4aba338b23a7b20b8560be8156231/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "883cea7dea3cedc9b45b6191f7d4e7be2d9a11ca",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/883cea7dea3cedc9b45b6191f7d4e7be2d9a11ca",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/883cea7dea3cedc9b45b6191f7d4e7be2d9a11ca"
      }
    ],
    "stats": {
      "total": 17,
      "additions": 16,
      "deletions": 1
    },
    "files": [
      {
        "sha": "995fef3d0768e528e0d008ef8ec4ee7a354992f9",
        "filename": "src/banman.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/886be97af5d4aba338b23a7b20b8560be8156231/src/banman.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/886be97af5d4aba338b23a7b20b8560be8156231/src/banman.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/banman.cpp?ref=886be97af5d4aba338b23a7b20b8560be8156231",
        "patch": "@@ -184,7 +184,7 @@ void BanMan::SweepBanned()\n         while (it != m_banned.end()) {\n             CSubNet sub_net = (*it).first;\n             CBanEntry ban_entry = (*it).second;\n-            if (now > ban_entry.nBanUntil) {\n+            if (!sub_net.IsValid() || now > ban_entry.nBanUntil) {\n                 m_banned.erase(it++);\n                 m_is_dirty = true;\n                 notify_ui = true;"
      },
      {
        "sha": "4e100ff9ca97d304e110223891adc6beed108b72",
        "filename": "src/netaddress.cpp",
        "status": "modified",
        "additions": 11,
        "deletions": 0,
        "changes": 11,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/886be97af5d4aba338b23a7b20b8560be8156231/src/netaddress.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/886be97af5d4aba338b23a7b20b8560be8156231/src/netaddress.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/netaddress.cpp?ref=886be97af5d4aba338b23a7b20b8560be8156231",
        "patch": "@@ -1109,6 +1109,17 @@ bool CSubNet::IsValid() const\n     return valid;\n }\n \n+bool CSubNet::SanityCheck() const\n+{\n+    if (!(network.IsIPv4() || network.IsIPv6())) return false;\n+\n+    for (size_t x = 0; x < network.m_addr.size(); ++x) {\n+        if (network.m_addr[x] & ~netmask[x]) return false;\n+    }\n+\n+    return true;\n+}\n+\n bool operator==(const CSubNet& a, const CSubNet& b)\n {\n     return a.valid == b.valid && a.network == b.network && !memcmp(a.netmask, b.netmask, 16);"
      },
      {
        "sha": "803b00481e004b11b7f59d1f154abce99fdb1d8d",
        "filename": "src/netaddress.h",
        "status": "modified",
        "additions": 4,
        "deletions": 0,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/886be97af5d4aba338b23a7b20b8560be8156231/src/netaddress.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/886be97af5d4aba338b23a7b20b8560be8156231/src/netaddress.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/netaddress.h?ref=886be97af5d4aba338b23a7b20b8560be8156231",
        "patch": "@@ -451,6 +451,8 @@ class CSubNet\n         /// Is this value valid? (only used to signal parse errors)\n         bool valid;\n \n+        bool SanityCheck() const;\n+\n     public:\n         CSubNet();\n         CSubNet(const CNetAddr& addr, uint8_t mask);\n@@ -482,6 +484,8 @@ class CSubNet\n                 READWRITE(obj.netmask);\n             }\n             READWRITE(obj.valid);\n+            // Mark invalid if the result doesn't pass sanity checking.\n+            SER_READ(obj, if (obj.valid) obj.valid = obj.SanityCheck());\n         }\n };\n "
      }
    ]
  }
]