[
  {
    "sha": "8b0e4970281de15472a93a529302f3de15163943",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4YjBlNDk3MDI4MWRlMTU0NzJhOTNhNTI5MzAyZjNkZTE1MTYzOTQz",
    "commit": {
      "author": {
        "name": "Tyler Hardin",
        "email": "th020394@gmail.com",
        "date": "2016-05-12T02:28:02Z"
      },
      "committer": {
        "name": "Tyler Hardin",
        "email": "th020394@gmail.com",
        "date": "2016-05-12T02:28:02Z"
      },
      "message": "Qt: Add option to hide the system tray icon\n\nMy changes leave all tray icon and menu creation/initialization logic\nuntouched. It only shows or hides the icon according to the setting.\n\nA new checkbox was added to the OptionsDialog under the Window tab. A\nbool option named \"hideTrayIcon\" was added to OptionsModel. This\ncheckbox was mapped like other all options to the OptionsModel.\n\nA signal was added to the OptionsModel for broadcasting changes the the\nhideTrayIcon option. This signal was connected to a new slot added to\nBitcoinGUI named setTrayIconVisible(bool). The slot simply hides or\nshows the trayIcon in BitcoinGUI according to the parameter recieved.",
      "tree": {
        "sha": "26f55cc6d7e35cd5597ee1caefc1f503dd9aee5d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/26f55cc6d7e35cd5597ee1caefc1f503dd9aee5d"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8b0e4970281de15472a93a529302f3de15163943",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8b0e4970281de15472a93a529302f3de15163943",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/8b0e4970281de15472a93a529302f3de15163943",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8b0e4970281de15472a93a529302f3de15163943/comments",
    "author": {
      "login": "Tyler-Hardin",
      "id": 5404976,
      "node_id": "MDQ6VXNlcjU0MDQ5NzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5404976?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Tyler-Hardin",
      "html_url": "https://github.com/Tyler-Hardin",
      "followers_url": "https://api.github.com/users/Tyler-Hardin/followers",
      "following_url": "https://api.github.com/users/Tyler-Hardin/following{/other_user}",
      "gists_url": "https://api.github.com/users/Tyler-Hardin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Tyler-Hardin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Tyler-Hardin/subscriptions",
      "organizations_url": "https://api.github.com/users/Tyler-Hardin/orgs",
      "repos_url": "https://api.github.com/users/Tyler-Hardin/repos",
      "events_url": "https://api.github.com/users/Tyler-Hardin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Tyler-Hardin/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "Tyler-Hardin",
      "id": 5404976,
      "node_id": "MDQ6VXNlcjU0MDQ5NzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5404976?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Tyler-Hardin",
      "html_url": "https://github.com/Tyler-Hardin",
      "followers_url": "https://api.github.com/users/Tyler-Hardin/followers",
      "following_url": "https://api.github.com/users/Tyler-Hardin/following{/other_user}",
      "gists_url": "https://api.github.com/users/Tyler-Hardin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Tyler-Hardin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Tyler-Hardin/subscriptions",
      "organizations_url": "https://api.github.com/users/Tyler-Hardin/orgs",
      "repos_url": "https://api.github.com/users/Tyler-Hardin/repos",
      "events_url": "https://api.github.com/users/Tyler-Hardin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Tyler-Hardin/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "42a67533828fe419f021d586495f8266db71b659",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/42a67533828fe419f021d586495f8266db71b659",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/42a67533828fe419f021d586495f8266db71b659"
      }
    ],
    "stats": {
      "total": 67,
      "additions": 65,
      "deletions": 2
    },
    "files": [
      {
        "sha": "99844863640f484acf555515284d9f45e4fd24f6",
        "filename": "src/qt/bitcoingui.cpp",
        "status": "modified",
        "additions": 19,
        "deletions": 1,
        "changes": 20,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/8b0e4970281de15472a93a529302f3de15163943/src/qt/bitcoingui.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/8b0e4970281de15472a93a529302f3de15163943/src/qt/bitcoingui.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/bitcoingui.cpp?ref=8b0e4970281de15472a93a529302f3de15163943",
        "patch": "@@ -474,6 +474,16 @@ void BitcoinGUI::setClientModel(ClientModel *clientModel)\n         }\n #endif // ENABLE_WALLET\n         unitDisplayControl->setOptionsModel(clientModel->getOptionsModel());\n+        \n+        OptionsModel* optionsModel = clientModel->getOptionsModel();\n+        if(optionsModel)\n+        {\n+            // be aware of the tray icon disable state change reported by the OptionsModel object.\n+            connect(optionsModel,SIGNAL(hideTrayIconChanged(bool)),this,SLOT(setTrayIconVisible(bool)));\n+        \n+            // initialize the disable state of the tray icon with the current value in the model.\n+            setTrayIconVisible(optionsModel->getHideTrayIcon());\n+        }\n     } else {\n         // Disable possibility to show main window via action\n         toggleHideAction->setEnabled(false);\n@@ -535,7 +545,7 @@ void BitcoinGUI::createTrayIcon(const NetworkStyle *networkStyle)\n     QString toolTip = tr(\"%1 client\").arg(tr(PACKAGE_NAME)) + \" \" + networkStyle->getTitleAddText();\n     trayIcon->setToolTip(toolTip);\n     trayIcon->setIcon(networkStyle->getTrayAndWindowIcon());\n-    trayIcon->show();\n+    trayIcon->hide();\n #endif\n \n     notificator = new Notificator(QApplication::applicationName(), trayIcon, this);\n@@ -1044,6 +1054,14 @@ void BitcoinGUI::showProgress(const QString &title, int nProgress)\n         progressDialog->setValue(nProgress);\n }\n \n+void BitcoinGUI::setTrayIconVisible(bool fHideTrayIcon)\n+{\n+    if (trayIcon)\n+    {\n+        trayIcon->setVisible(!fHideTrayIcon);\n+    }\n+}\n+\n static bool ThreadSafeMessageBox(BitcoinGUI *gui, const std::string& message, const std::string& caption, unsigned int style)\n {\n     bool modal = (style & CClientUIInterface::MODAL);"
      },
      {
        "sha": "27ef11c75c07953f7da74d6cb28eabcc8c49bd9d",
        "filename": "src/qt/bitcoingui.h",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/8b0e4970281de15472a93a529302f3de15163943/src/qt/bitcoingui.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/8b0e4970281de15472a93a529302f3de15163943/src/qt/bitcoingui.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/bitcoingui.h?ref=8b0e4970281de15472a93a529302f3de15163943",
        "patch": "@@ -218,6 +218,9 @@ private Q_SLOTS:\n \n     /** Show progress dialog e.g. for verifychain */\n     void showProgress(const QString &title, int nProgress);\n+    \n+    /** When hideTrayIcon setting is changed in OptionsModel hide or show the icon accordingly. */\n+    void setTrayIconVisible(bool);\n };\n \n class UnitDisplayStatusBarControl : public QLabel"
      },
      {
        "sha": "0b292018727edc1d7dbd1869936705ffae89b2bb",
        "filename": "src/qt/forms/optionsdialog.ui",
        "status": "modified",
        "additions": 10,
        "deletions": 0,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/8b0e4970281de15472a93a529302f3de15163943/src/qt/forms/optionsdialog.ui",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/8b0e4970281de15472a93a529302f3de15163943/src/qt/forms/optionsdialog.ui",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/forms/optionsdialog.ui?ref=8b0e4970281de15472a93a529302f3de15163943",
        "patch": "@@ -504,6 +504,16 @@\n        <string>&amp;Window</string>\n       </attribute>\n       <layout class=\"QVBoxLayout\" name=\"verticalLayout_Window\">\n+       <item>\n+        <widget class=\"QCheckBox\" name=\"hideTrayIcon\">\n+         <property name=\"toolTip\">\n+          <string>&amp;Hide the icon from the system tray.</string>\n+         </property>\n+         <property name=\"text\">\n+          <string>Hide tray icon</string>\n+         </property>\n+        </widget>\n+       </item>\n        <item>\n         <widget class=\"QCheckBox\" name=\"minimizeToTray\">\n          <property name=\"toolTip\">"
      },
      {
        "sha": "f2db3988991a062e473358286a6f2a891f7bd43e",
        "filename": "src/qt/optionsdialog.cpp",
        "status": "modified",
        "additions": 14,
        "deletions": 0,
        "changes": 14,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/8b0e4970281de15472a93a529302f3de15163943/src/qt/optionsdialog.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/8b0e4970281de15472a93a529302f3de15163943/src/qt/optionsdialog.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/optionsdialog.cpp?ref=8b0e4970281de15472a93a529302f3de15163943",
        "patch": "@@ -198,6 +198,7 @@ void OptionsDialog::setMapper()\n \n     /* Window */\n #ifndef Q_OS_MAC\n+    mapper->addMapping(ui->hideTrayIcon, OptionsModel::HideTrayIcon);\n     mapper->addMapping(ui->minimizeToTray, OptionsModel::MinimizeToTray);\n     mapper->addMapping(ui->minimizeOnClose, OptionsModel::MinimizeOnClose);\n #endif\n@@ -243,6 +244,19 @@ void OptionsDialog::on_cancelButton_clicked()\n     reject();\n }\n \n+void OptionsDialog::on_hideTrayIcon_stateChanged(int fState)\n+{\n+    if(fState)\n+    {\n+        ui->minimizeToTray->setChecked(false);\n+        ui->minimizeToTray->setEnabled(false);\n+    }\n+    else\n+    {\n+        ui->minimizeToTray->setEnabled(true);\n+    }\n+}\n+\n void OptionsDialog::showRestartWarning(bool fPersistent)\n {\n     ui->statusLabel->setStyleSheet(\"QLabel { color: red; }\");"
      },
      {
        "sha": "41b56d138625703ab7587bb303ce17fdf0341f29",
        "filename": "src/qt/optionsdialog.h",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/8b0e4970281de15472a93a529302f3de15163943/src/qt/optionsdialog.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/8b0e4970281de15472a93a529302f3de15163943/src/qt/optionsdialog.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/optionsdialog.h?ref=8b0e4970281de15472a93a529302f3de15163943",
        "patch": "@@ -49,6 +49,8 @@ private Q_SLOTS:\n     void on_resetButton_clicked();\n     void on_okButton_clicked();\n     void on_cancelButton_clicked();\n+    \n+    void on_hideTrayIcon_stateChanged(int fState);\n \n     void showRestartWarning(bool fPersistent = false);\n     void clearStatusLabel();"
      },
      {
        "sha": "cc2cbc0e66419f09434791061fc9255f68a70c02",
        "filename": "src/qt/optionsmodel.cpp",
        "status": "modified",
        "additions": 13,
        "deletions": 1,
        "changes": 14,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/8b0e4970281de15472a93a529302f3de15163943/src/qt/optionsmodel.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/8b0e4970281de15472a93a529302f3de15163943/src/qt/optionsmodel.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/optionsmodel.cpp?ref=8b0e4970281de15472a93a529302f3de15163943",
        "patch": "@@ -51,9 +51,14 @@ void OptionsModel::Init(bool resetSettings)\n     // These are Qt-only settings:\n \n     // Window\n+    if (!settings.contains(\"fHideTrayIcon\"))\n+        settings.setValue(\"fHideTrayIcon\", false);\n+    fHideTrayIcon = settings.value(\"fHideTrayIcon\").toBool();\n+    Q_EMIT hideTrayIconChanged(fHideTrayIcon);\n+    \n     if (!settings.contains(\"fMinimizeToTray\"))\n         settings.setValue(\"fMinimizeToTray\", false);\n-    fMinimizeToTray = settings.value(\"fMinimizeToTray\").toBool();\n+    fMinimizeToTray = settings.value(\"fMinimizeToTray\").toBool() && !fHideTrayIcon;\n \n     if (!settings.contains(\"fMinimizeOnClose\"))\n         settings.setValue(\"fMinimizeOnClose\", false);\n@@ -166,6 +171,8 @@ QVariant OptionsModel::data(const QModelIndex & index, int role) const\n         {\n         case StartAtStartup:\n             return GUIUtil::GetStartOnSystemStartup();\n+        case HideTrayIcon:\n+            return fHideTrayIcon;\n         case MinimizeToTray:\n             return fMinimizeToTray;\n         case MapPortUPnP:\n@@ -242,6 +249,11 @@ bool OptionsModel::setData(const QModelIndex & index, const QVariant & value, in\n         case StartAtStartup:\n             successful = GUIUtil::SetStartOnSystemStartup(value.toBool());\n             break;\n+        case HideTrayIcon:\n+            fHideTrayIcon = value.toBool();\n+            settings.setValue(\"fHideTrayIcon\", fHideTrayIcon);\n+    \t\tQ_EMIT hideTrayIconChanged(fHideTrayIcon);\n+            break;\n         case MinimizeToTray:\n             fMinimizeToTray = value.toBool();\n             settings.setValue(\"fMinimizeToTray\", fMinimizeToTray);"
      },
      {
        "sha": "3b491ceac2cde419c0cfcf03a8514b50de902e8f",
        "filename": "src/qt/optionsmodel.h",
        "status": "modified",
        "additions": 4,
        "deletions": 0,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/8b0e4970281de15472a93a529302f3de15163943/src/qt/optionsmodel.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/8b0e4970281de15472a93a529302f3de15163943/src/qt/optionsmodel.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/optionsmodel.h?ref=8b0e4970281de15472a93a529302f3de15163943",
        "patch": "@@ -28,6 +28,7 @@ class OptionsModel : public QAbstractListModel\n \n     enum OptionID {\n         StartAtStartup,         // bool\n+        HideTrayIcon,           // bool\n         MinimizeToTray,         // bool\n         MapPortUPnP,            // bool\n         MinimizeOnClose,        // bool\n@@ -58,6 +59,7 @@ class OptionsModel : public QAbstractListModel\n     void setDisplayUnit(const QVariant &value);\n \n     /* Explicit getters */\n+    bool getHideTrayIcon() { return fHideTrayIcon; }\n     bool getMinimizeToTray() { return fMinimizeToTray; }\n     bool getMinimizeOnClose() { return fMinimizeOnClose; }\n     int getDisplayUnit() { return nDisplayUnit; }\n@@ -72,6 +74,7 @@ class OptionsModel : public QAbstractListModel\n \n private:\n     /* Qt-only settings */\n+    bool fHideTrayIcon;\n     bool fMinimizeToTray;\n     bool fMinimizeOnClose;\n     QString language;\n@@ -87,6 +90,7 @@ class OptionsModel : public QAbstractListModel\n Q_SIGNALS:\n     void displayUnitChanged(int unit);\n     void coinControlFeaturesChanged(bool);\n+    void hideTrayIconChanged(bool);\n };\n \n #endif // BITCOIN_QT_OPTIONSMODEL_H"
      }
    ]
  }
]