[
  {
    "sha": "c43aa623435a277a692dbde784e8a7146f5573e9",
    "node_id": "C_kwDOABII59oAKGM0M2FhNjIzNDM1YTI3N2E2OTJkYmRlNzg0ZThhNzE0NmY1NTczZTk",
    "commit": {
      "author": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2021-10-30T16:33:09Z"
      },
      "committer": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2021-11-03T09:26:49Z"
      },
      "message": "Avoid excessive lock contention in CCheckQueue::Add",
      "tree": {
        "sha": "5eaeff437fb26d5fcbe632e476093b365a6b72e0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/5eaeff437fb26d5fcbe632e476093b365a6b72e0"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c43aa623435a277a692dbde784e8a7146f5573e9",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE0dvyxLlvLev0wWZUQQEIES5+qB8FAmGCVdkACgkQQQEIES5+\nqB8SsRAAiM16vGffRKzBjSNa6jc1z8vMBn6m4o3J2jaWSnEiNTIX8Y8CYSJGlEMW\nwHtk+rLBfJhaGrz2/373YwOkQaF4xFFas9qtyJL2rXE1FZ25Yn76eD0s7jC6mp+X\nr81V8ozyRJRUjC8X7ePG4jxl053hvrf8HpLemed71TIgfm8DeoytXI1cKcluXGVK\nUCEWeHcxMelgkfBC3c/RAfAm4vMijSF7zVVBlZLylYGCHmF/bFNqQO0+dZ7BtE8z\nidm4jHvm1QjAYiWR/K9eXpGHxFyULPZjSMLkeGqz23eOnlkdx2/EMHqPMgqc887e\nNT5SmIkZ7UBFFOpaF995MZrc/bcIu6oaOma+vRtEXNxuqnhU40y1Gj0ZvAZmWB5P\nkEUm56OoErR4pYyrdM67qVNK7xk7SgXJYL2IUBZm47D4L/qBAB3HfYT9YEFgeeXh\nu/tACWcjw2cvO2ExG0NSXqoMOMei038v+//2XI98wQyDyAsaiUH0mTqN2axLeZKi\n3+C+1mGKNGSudMqhCSj0HlFfgLQAmQ5MoFIj7opQX0icWg+NujhhTIOYvGuFgEhM\nPxagRf5a9XclkzrY+cgigh08rTYbQApXDYxvFjcM07MLhMx5M3YdOA86vsaM/q1b\npy0O8JEOdp8I+wjwrX+aWBjSsZrHeKMlgiZy54IpwI4bx6mCqMg=\n=MJrN\n-----END PGP SIGNATURE-----",
        "payload": "tree 5eaeff437fb26d5fcbe632e476093b365a6b72e0\nparent 7efc628539573af4b4a76d93b853cc46e9e52eae\nauthor Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1635611589 +0300\ncommitter Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1635931609 +0200\n\nAvoid excessive lock contention in CCheckQueue::Add\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c43aa623435a277a692dbde784e8a7146f5573e9",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/c43aa623435a277a692dbde784e8a7146f5573e9",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c43aa623435a277a692dbde784e8a7146f5573e9/comments",
    "author": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "7efc628539573af4b4a76d93b853cc46e9e52eae",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7efc628539573af4b4a76d93b853cc46e9e52eae",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/7efc628539573af4b4a76d93b853cc46e9e52eae"
      }
    ],
    "stats": {
      "total": 13,
      "additions": 8,
      "deletions": 5
    },
    "files": [
      {
        "sha": "d926326a9596a170bc110c0235e0ef309763e22b",
        "filename": "src/checkqueue.h",
        "status": "modified",
        "additions": 8,
        "deletions": 5,
        "changes": 13,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c43aa623435a277a692dbde784e8a7146f5573e9/src/checkqueue.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c43aa623435a277a692dbde784e8a7146f5573e9/src/checkqueue.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/checkqueue.h?ref=c43aa623435a277a692dbde784e8a7146f5573e9",
        "patch": "@@ -167,12 +167,15 @@ class CCheckQueue\n     //! Add a batch of checks to the queue\n     void Add(std::vector<T>& vChecks)\n     {\n-        LOCK(m_mutex);\n-        for (T& check : vChecks) {\n-            queue.push_back(T());\n-            check.swap(queue.back());\n+        {\n+            LOCK(m_mutex);\n+            for (T& check : vChecks) {\n+                queue.emplace_back();\n+                check.swap(queue.back());\n+            }\n+            nTodo += vChecks.size();\n         }\n-        nTodo += vChecks.size();\n+\n         if (vChecks.size() == 1)\n             m_worker_cv.notify_one();\n         else if (vChecks.size() > 1)"
      }
    ]
  },
  {
    "sha": "459e208276a4d1457d37bf41c977e62caf05456d",
    "node_id": "C_kwDOABII59oAKDQ1OWUyMDgyNzZhNGQxNDU3ZDM3YmY0MWM5NzdlNjJjYWYwNTQ1NmQ",
    "commit": {
      "author": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2021-10-30T16:33:09Z"
      },
      "committer": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2021-11-03T09:26:57Z"
      },
      "message": "Exit early for an empty vChecks in CCheckQueue::Add",
      "tree": {
        "sha": "3d4eb0575ba49f171164a907fd5d8eef04c45ee9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3d4eb0575ba49f171164a907fd5d8eef04c45ee9"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/459e208276a4d1457d37bf41c977e62caf05456d",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE0dvyxLlvLev0wWZUQQEIES5+qB8FAmGCVeEACgkQQQEIES5+\nqB8EdRAAl5qJiIg0LuRjYCtC414u+rqhkajwCtznC6ufPxbKe31Kd83BABYeIkak\nftoMyvqJMhwPz5CgAIpnQguITQNzpFqAOna6hD+rhmf0Tn2Q3M07XjBCpk5Xg0lA\nNUWEb3mM9KnPSFvyhnFCoMjzrmnxTNuuWuLqXlocdQHWPwcdQm0haNEenAn5ZTPF\n343VGVPdV8Zy1Wk/ALUlDa7Ktldqyll0+9u0z8a4SAs4E7JtPcBuZKo47HnLl6GD\nH2qh5m99VSUVlN3gQwde0zHiYdnHExeeMUS3DrvYIQliAqe+4Hq28eXejiUx/iFR\nEAKn1A7ZofBsu28aZwii5j8K/tPfhjwF827Y39aLiVsrk9ZHMeagzTnNaFsTN1fW\n0W0VAYZLf8jquctOJLf9HHu6K0fGZW7LFekuA4z/oFmSJfXrbTS0Qj3d26mcIU8a\n3D2wSe+nTtdZ3ftCOEo6uDGc2VvNVOxvJHHqVmFagM1DmBeuj+G6InfqVA1MSOGt\naBXtj5DFFXyhGtiolK1lCOOCBEt2Zbobm12XZupHzltG3pDidNS4y9Eq0+qylHCR\nvC9aPAqxvdVIlVvplaQImeOD01x2ydJA64rSXcWuy1ssdk3SX9DSVyPDYItVQzH/\nyrTJ2HJS+HKnJmO6/iX7sPB9wzYJxUd5Hcyy3Ku7Vnma5mgiBrc=\n=HXBI\n-----END PGP SIGNATURE-----",
        "payload": "tree 3d4eb0575ba49f171164a907fd5d8eef04c45ee9\nparent c43aa623435a277a692dbde784e8a7146f5573e9\nauthor Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1635611589 +0300\ncommitter Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1635931617 +0200\n\nExit early for an empty vChecks in CCheckQueue::Add\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/459e208276a4d1457d37bf41c977e62caf05456d",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/459e208276a4d1457d37bf41c977e62caf05456d",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/459e208276a4d1457d37bf41c977e62caf05456d/comments",
    "author": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "c43aa623435a277a692dbde784e8a7146f5573e9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c43aa623435a277a692dbde784e8a7146f5573e9",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/c43aa623435a277a692dbde784e8a7146f5573e9"
      }
    ],
    "stats": {
      "total": 9,
      "additions": 7,
      "deletions": 2
    },
    "files": [
      {
        "sha": "760dfbddc13cb912573a4ff155de216cef398b55",
        "filename": "src/checkqueue.h",
        "status": "modified",
        "additions": 7,
        "deletions": 2,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/459e208276a4d1457d37bf41c977e62caf05456d/src/checkqueue.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/459e208276a4d1457d37bf41c977e62caf05456d/src/checkqueue.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/checkqueue.h?ref=459e208276a4d1457d37bf41c977e62caf05456d",
        "patch": "@@ -167,6 +167,10 @@ class CCheckQueue\n     //! Add a batch of checks to the queue\n     void Add(std::vector<T>& vChecks)\n     {\n+        if (vChecks.empty()) {\n+            return;\n+        }\n+\n         {\n             LOCK(m_mutex);\n             for (T& check : vChecks) {\n@@ -176,10 +180,11 @@ class CCheckQueue\n             nTodo += vChecks.size();\n         }\n \n-        if (vChecks.size() == 1)\n+        if (vChecks.size() == 1) {\n             m_worker_cv.notify_one();\n-        else if (vChecks.size() > 1)\n+        } else {\n             m_worker_cv.notify_all();\n+        }\n     }\n \n     //! Stop all of the worker threads."
      }
    ]
  }
]