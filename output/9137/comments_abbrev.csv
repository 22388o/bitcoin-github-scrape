jonasschnelli,2016-11-12T08:47:29Z,Conceptual questions:\n- I guess the new `importmulti` call should also be covered in this change?\n- Idea: We could deprecate the other import calls in favor of `importmulti` (which has more features and makes generally more sense).\n- Does spending those incomplete transactions work well? IMO some checks (isFinal()) do read the nSequence value of the (now missing) inputs?\n\nThings that would ne,https://github.com/bitcoin/bitcoin/pull/9137#issuecomment-260110132,260110132,
sipa,2016-11-12T10:32:14Z,"~~NACK when done this way. If you need an incomplete transaction, use CMutableTransaction instead of hacking that functionality around CTransaction.~~\n\nThinking more about the above, this is not useful advice. I said it in response to seeing the suggestion of a CIncompleteTransaction, assuming we were calling SetHash after it became complete.\n\nWhat we want here is a hash that does travel with ",https://github.com/bitcoin/bitcoin/pull/9137#issuecomment-260114312,260114312,
ryanofsky,2016-11-12T13:05:15Z,"Thanks @jonasschnelli, I am planning to get to the various todos you mentioned. The one I might like to know more about is ""Visual attribution in the GUI."" Do you have any thoughts on what this should look like? And what would be the reasons for making the distinction? E.g. are there particular wallet features or RPC calls that won't work with incomplete transaction data? (Asking because I actuall",https://github.com/bitcoin/bitcoin/pull/9137#issuecomment-260121079,260121079,
jonasschnelli,2016-11-12T13:07:18Z,@ryanofsky: I think the GUI stuff can be done in a separate PR after this has been merged.\n,https://github.com/bitcoin/bitcoin/pull/9137#issuecomment-260121171,260121171,
ryanofsky,2016-11-12T13:12:11Z,"Thanks @jonasschnelli, that makes sense. I still would appreciate knowing any thoughts you may have on the GUI implementation either here or in the original issue #8497.\n",https://github.com/bitcoin/bitcoin/pull/9137#issuecomment-260121393,260121393,
sipa,2016-11-12T18:03:03Z,"I'm working on a series of changes to the serialization code, the result of which will be that CTransaction is fully immutable, so UpdateHash will go away.\n",https://github.com/bitcoin/bitcoin/pull/9137#issuecomment-260138143,260138143,
ryanofsky,2016-11-29T21:48:07Z,"This is better tested now and ready to be reviewed and merged. There are a few extra things that could be done based on comments above, but they don't necessarily have to be part of this PR:\n\n- [x] Maybe add test to confirm IsFinal works after an incomplete transaction output is spent. ([jonasschnelli comment](https://github.com/bitcoin/bitcoin/pull/9137#issuecomment-260110132))\n- [ ] Maybe ",https://github.com/bitcoin/bitcoin/pull/9137#issuecomment-263710088,263710088,
ryanofsky,2016-11-30T00:11:47Z,Added test code to `import-rescan.py` to make sure spends of incomplete transactions are picked up by the wallet and finalized.,https://github.com/bitcoin/bitcoin/pull/9137#issuecomment-263742010,263742010,
ryanofsky,2016-12-05T17:05:56Z,Updated to fix conflicts after #8580 merge.,https://github.com/bitcoin/bitcoin/pull/9137#issuecomment-264912477,264912477,
gmaxwell,2016-12-12T23:12:00Z,"rescan=true and importing pruned things are not the same though. Rescan makes sure you get the historical transactions and a utxo scan doesn't.   I think we may want to track a global state for a wallet that indicates if it believes its history is complete or not, and report that.  (e.g. in the GUI there could be a bar at the top of the transaction list ""some historical transactions may be missing",https://github.com/bitcoin/bitcoin/pull/9137#issuecomment-266583702,266583702,
ryanofsky,2016-12-13T18:45:59Z,"Having a gui indication of an incomplete historical transaction list seems like a good idea with this change, but it would probably also be a good idea without this change. (The transaction list will be incomplete now if you import with a key without rescanning, or if you use the removeprunedfunds API.) The goal of this change is to make possible to see and spend balances after importing keys on `",https://github.com/bitcoin/bitcoin/pull/9137#issuecomment-266825238,266825238,
ryanofsky,2016-12-13T18:51:12Z,"I do think it would be a good idea not overload to the meaning of `rescan=true`, though. Maybe `rescan` could be changed from a bool to a string argument where `rescan=""history""` would scan the blockchain and `rescan=""utxo""` would scan the utxo set. `rescan=true` could still be kept for backwards compatibility.",https://github.com/bitcoin/bitcoin/pull/9137#issuecomment-266826654,266826654,
ryanofsky,2017-06-12T19:02:24Z,Haven't worked on this in a while. Will close and reopen if I make more more progress.,https://github.com/bitcoin/bitcoin/pull/9137#issuecomment-307888044,307888044,
sangaman,2017-08-23T05:40:37Z,"This is a feature I'd love to see added. I've been following the progress in this and related issues and PRs. Regarding the most recent comments, I think it would make sense to leave rescan=true as is, and have rescan=utxo only check an address or key against the utxo set and not do a full rescan for historical transactions.\n\nI'm new to contributing to this project but let me know if I can hel",https://github.com/bitcoin/bitcoin/pull/9137#issuecomment-324226789,324226789,
ryanofsky,2017-08-24T21:41:00Z,"@sangaman, it'd be great if you want to pick this up. As mentioned in my last update I haven't worked on this on a while and don't have plans to continue at the moment.",https://github.com/bitcoin/bitcoin/pull/9137#issuecomment-324765352,324765352,
jonasschnelli,2016-11-12T08:31:34Z,Hmm... this would result in not longer coupling the hash with the data-structure. This can result in difficult states for future changes.\nWould a new primitive (maybe `CIncompleteTransaction` or similar) make more sense?\n,https://github.com/bitcoin/bitcoin/pull/9137#discussion_r87689230,87689230,src/primitives/transaction.cpp
jonasschnelli,2016-11-12T08:35:19Z,Would there be a better way to keep the wallet separated from the UTXO set?\nDuring wallet creation (`init.cpp`) it could pass-in a lambda that would take care about finding the corresponding `CCoins`.\n,https://github.com/bitcoin/bitcoin/pull/9137#discussion_r87689280,87689280,src/wallet/wallet.cpp
luke-jr,2016-11-12T11:08:32Z,Shouldn't there be some way to scan for UTXOs on non-pruned nodes?\n,https://github.com/bitcoin/bitcoin/pull/9137#discussion_r87690967,87690967,src/wallet/rpcdump.cpp
luke-jr,2016-11-12T11:10:28Z,These errors leave much to be desired...\n,https://github.com/bitcoin/bitcoin/pull/9137#discussion_r87690997,87690997,src/wallet/wallet.cpp
ryanofsky,2016-11-12T12:39:32Z,"I don't know if @sipa's suggestion of making a new `CTransaction` constructor that accepts a hash would sufficiently address your concern. (It would not eliminate the risk that some code could make a seemingly harmless `UpdateHash()` call on the wallet transaction and overwrite the correct hash).\n\nPersonally, the way I would go about this would be to change `CWalletTx` not to inherit from `CMerk",https://github.com/bitcoin/bitcoin/pull/9137#discussion_r87692076,87692076,src/primitives/transaction.cpp
ryanofsky,2016-11-12T12:40:20Z,"Sounds good, will change.\n",https://github.com/bitcoin/bitcoin/pull/9137#discussion_r87692085,87692085,src/wallet/wallet.cpp
ryanofsky,2016-11-12T12:52:35Z,"I could definitely add it as another option to the RPC. I guess the benefit to the RPC caller would be that if they're importing a key which they already know is unspent, calling `ScanForWalletUTXOs` would be faster than calling `ScanForWalletTransactions`?\n",https://github.com/bitcoin/bitcoin/pull/9137#discussion_r87692241,87692241,src/wallet/rpcdump.cpp
luke-jr,2016-11-13T20:28:38Z,Won't this miss unconfirmed TXOs?\n,https://github.com/bitcoin/bitcoin/pull/9137#discussion_r87720751,87720751,src/wallet/wallet.cpp
ryanofsky,2016-11-14T22:14:01Z,"This doesn't deal with unconfirmed TXOs, but neither does `ScanForWalletTransactions`, which this is just intended to be a lightweight fallback for.\n\nI don't know the wallet code well enough to know how it does deal with unconfirmed TXOs, but I expect that if there are issues tracking them, they would be orthogonal to this change.\n",https://github.com/bitcoin/bitcoin/pull/9137#discussion_r87905166,87905166,src/wallet/wallet.cpp
