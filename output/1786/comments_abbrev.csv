laanwj,2012-09-05T05:26:28Z,"Yes, adding an extra flag should solve the problem too. ACK\n",https://github.com/bitcoin/bitcoin/pull/1786#issuecomment-8288072,8288072,
Diapolo,2012-09-05T06:23:59Z,"This does not fix 10022 spam on Windows, as `WSAEINVAL (10022) is caused by: The time-out value is not valid, or all three descriptor parameters were null.`.\n\nBut I think it is another fix worth to merge in addition to #1772, so ACK.\n",https://github.com/bitcoin/bitcoin/pull/1786#issuecomment-8288796,8288796,
jgarzik,2012-09-05T06:34:10Z,"@Diapolo so you actually tested this on Windows, for the net and !net cases?  I'm not sure the Windows expected behavior matches what you describe...\n",https://github.com/bitcoin/bitcoin/pull/1786#issuecomment-8288946,8288946,
laanwj,2012-09-05T06:38:34Z,"Indeed, that `WSAEINVAL: the time-out value is not valid, or all three descriptor parameters were null` comes from the MS documentation http://msdn.microsoft.com/en-us/library/windows/desktop/ms740141(v=vs.85).aspx \n\nSo yes on Windows you still need the check to prevent error spam. It appears that windows does not allow for using select as simply a timeout. However, now you can check for have_fd",https://github.com/bitcoin/bitcoin/pull/1786#issuecomment-8289022,8289022,
jgarzik,2012-09-05T06:42:51Z,"Yes, I understand it comes from the documentation, but is it actually _seen_ after applying this patch?\n",https://github.com/bitcoin/bitcoin/pull/1786#issuecomment-8289079,8289079,
Diapolo,2012-09-05T06:49:02Z,"The error 10022 is still logged with this and without my patch, as select() returns WSAEINVAL. I tried it :).\n\n@laanwj Yes, a check for `have_fds` is working, I can update my pull after this one is in.\n",https://github.com/bitcoin/bitcoin/pull/1786#issuecomment-8289180,8289180,
laanwj,2012-09-05T07:14:54Z,It makes sense that it still occurs because windows ignores the nfds argument. So this change is a no-op from the viewpoint of winsock. \n\nWe could spare ourselves worrying about all these kinds of low-level OS details if we used an abstraction such as boost::asio (which will also use more efficient mechanisms such as epoll on platforms that support them).\n,https://github.com/bitcoin/bitcoin/pull/1786#issuecomment-8289642,8289642,
Diapolo,2012-09-05T07:24:50Z,"That is what I tried to say @jgarzik, his patch does not prevent the 10022 spam, I read the select() documentation on MSDN more than once to understand what is happening ^^.\n\nI rather sure most part of that network code are still from Satoshi (at least he was the one who merged them to Github at first).\n",https://github.com/bitcoin/bitcoin/pull/1786#issuecomment-8289850,8289850,
jgarzik,2012-09-05T20:04:36Z,"1) Updated to always pass fd sets to select(), even when zero fd's are set.\n2) Use precise have_fds test before squawking on socket error.\n",https://github.com/bitcoin/bitcoin/pull/1786#issuecomment-8312039,8312039,
Diapolo,2012-09-05T20:15:28Z,"Verified to work and fix the 10022 spam on Windows, tried it and closed #1772 in favor of your patch.\n",https://github.com/bitcoin/bitcoin/pull/1786#issuecomment-8312341,8312341,
laanwj,2012-09-06T05:06:37Z,ACK\n,https://github.com/bitcoin/bitcoin/pull/1786#issuecomment-8322696,8322696,
BitcoinPullTester,2012-09-07T07:20:29Z,"Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/2387944782fa61a3137afda91e9e8105d8cc5ddf for binaries and test log.\n",https://github.com/bitcoin/bitcoin/pull/1786#issuecomment-8358019,8358019,
Diapolo,2012-09-05T06:25:26Z,What adds such a line-break to readability?\n,https://github.com/bitcoin/bitcoin/pull/1786#discussion_r1530700,1530700,src/net.cpp
Diapolo,2012-09-05T20:07:58Z,"When making my pulls obsolete, which makes sense here to have 1 instead of 2 to fix this, could you please merge the `WSAGetLastError()` into the printf :)?\n",https://github.com/bitcoin/bitcoin/pull/1786#discussion_r1537572,1537572,src/net.cpp
jgarzik,2012-09-05T20:11:42Z,"It is nicer this way, especially if you are stepping through with a debugger.\n",https://github.com/bitcoin/bitcoin/pull/1786#discussion_r1537620,1537620,src/net.cpp
