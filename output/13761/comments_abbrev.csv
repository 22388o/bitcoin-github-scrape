DrahtBot,2018-07-26T04:10:59Z,"<!--e57a25ab6845829454e8d69fc972939a-->Note to reviewers: This pull request conflicts with the following ones:\n\n* #14074 (Use std::unordered_set instead of set in blockfilter interface by jimpo)\n* #14057 ([Logging] Only log ""Using config file PATH_TO_bitcoin.conf"" message on startup if conf file exists by leishman)\n* #13746 (-masterdatadir for datadir bootstrapping by kallewoof)\n* #13621 (Che",https://github.com/bitcoin/bitcoin/pull/13761#issuecomment-407970662,407970662,
leishman,2018-07-26T05:47:00Z,@ken2812221 updated!,https://github.com/bitcoin/bitcoin/pull/13761#issuecomment-407983525,407983525,
jonasschnelli,2018-07-26T09:59:02Z,I'm conceptually unsure if the daemon binary should take care of the configuration management (if even supporting a template make sense). This seems to be better address on the package manager level.,https://github.com/bitcoin/bitcoin/pull/13761#issuecomment-408045138,408045138,
leishman,2018-07-26T16:37:33Z,"I can understand that point of view, however I think that many users are accustomed to config files being generated automatically for them from a binary. When people see that the `datadir` has been generated they are confused about why there is no config file in there. At the very least we should prevent the daemon output from saying that it is using a conf file that doesn't exist.\n\nOn a highe",https://github.com/bitcoin/bitcoin/pull/13761#issuecomment-408158620,408158620,
sipa,2018-07-27T00:40:22Z,"If `bitcoind` is able to create a datadir, at least I think there should be no problem with it creating a default config file in that directory at the same time.",https://github.com/bitcoin/bitcoin/pull/13761#issuecomment-408276809,408276809,
leishman,2018-07-27T07:03:32Z,I've updated the PR to create the template config file immediately after creation of the datadir.,https://github.com/bitcoin/bitcoin/pull/13761#issuecomment-408331133,408331133,
laanwj,2018-07-30T11:20:50Z,"> I'm conceptually unsure if the daemon binary should take care of the configuration management (if even supporting a template make sense). This seems to be better address on the package manager level.\n\nI tend to agree. Daemons should not write their own configuration file.\nWe can package a default configuration file, but I don't think `bitcoin.conf` should be created.\n(in many cases this ",https://github.com/bitcoin/bitcoin/pull/13761#issuecomment-408830553,408830553,
laanwj,2018-07-30T11:54:40Z,"> If bitcoind is able to create a datadir, at least I think there should be no problem with it creating a default config file in that directory at the same time.\n\nWhat about a compromise: always create a `bitcoin.conf.example` in the data directory. The user can decide to use it by copying it to `bitcoin.conf` (whatever its location) and editing it, or simply ignore it.",https://github.com/bitcoin/bitcoin/pull/13761#issuecomment-408838018,408838018,
leishman,2018-07-30T13:19:25Z,"> What about a compromise: always create a bitcoin.conf.example in the data directory. The user can decide to use it by copying it to bitcoin.conf (whatever its location) and editing it, or simply ignore it.\n\nI like this. I also think we should disable the startup logging message saying a conf file is being used, unless it is actually true. If there is no conf file, then we can print a message",https://github.com/bitcoin/bitcoin/pull/13761#issuecomment-408860189,408860189,
leishman,2018-08-01T01:22:23Z,I've updated things so that a `bitcoin.conf.example` file is created and we only tell the user a conf file is being used if this file actually exists at the time of startup,https://github.com/bitcoin/bitcoin/pull/13761#issuecomment-409418028,409418028,
leishman,2018-08-02T12:57:33Z,"I think it may be more appropriate to make more of an overhaul to the default conf file in a separate PR, since that would involve a change here, a change to `contrib/debian/examples/bitcoin.conf` and a change to the wiki at a minimum. ",https://github.com/bitcoin/bitcoin/pull/13761#issuecomment-409916780,409916780,
Sjors,2018-08-02T13:51:01Z,"One problem with `bitcoin.conf.example` is that QT won't see it here:\n<img width=""436"" alt=""schermafbeelding 2018-08-02 om 15 48 09"" src=""https://user-images.githubusercontent.com/10217/43587865-7999507e-966b-11e8-85c6-8861418752e3.png"">\n\nPerhaps QT could copy the example file over if no `bitcoin.conf` exists and the user clicks on that button?\n\nIs there a way to just copy the file from ",https://github.com/bitcoin/bitcoin/pull/13761#issuecomment-409933100,409933100,
leishman,2018-08-02T13:59:49Z,"I wanted to avoid adding any dependency from `contrib`, but I'm not sure the best practice here. Perhaps we could just remove the file in `contrib` and refer to the new file in `src`? \n\nAlso I think this PR should be separate from changing any conf behaviors with QT. It seems like a somewhat separate issue for the most part. What is the current behavior when clicking that button if no conf fil",https://github.com/bitcoin/bitcoin/pull/13761#issuecomment-409936146,409936146,
Sjors,2018-08-02T14:49:08Z,"@leishman I just noticed there's also a `bitcoin.conf` in `share/examples`, so maybe use (and improve) that one?\n\nIf no file exists, the button opens a blank new file (unsaved).",https://github.com/bitcoin/bitcoin/pull/13761#issuecomment-409953489,409953489,
leishman,2018-08-02T20:57:30Z,"@Sjors While I agree that it would be nice to have one location for a reference `bitcoin.conf` file, I don't like the idea of referencing a file from outside of the `src` directory for something like this. It just seems messy. It's also unclear to me how to include this template file into the compiled binary if it is not defined as a c++ string in a .h or .cpp file. Is this an easy thing to do? I ",https://github.com/bitcoin/bitcoin/pull/13761#issuecomment-410065623,410065623,
Sjors,2018-08-03T15:01:50Z,"It doesn't need to be part of the compiled binary though, just part of the distribution packages. Best practices for that vary per OS and I'm not really familiar with them. Maybe you can just pick just one OS to start? The Windows installer (https://github.com/bitcoin/bitcoin/blob/master/Makefile.am#L72) seems to get some stuff from `/shared`.",https://github.com/bitcoin/bitcoin/pull/13761#issuecomment-410281231,410281231,
leishman,2018-08-09T18:07:16Z,"@Sjors but what if a user is just downloading the bitcoind binary and running it? This binary creates all of the other content in ~/.bitcoin, why shouldn't it create the sample conf file as well?",https://github.com/bitcoin/bitcoin/pull/13761#issuecomment-411846737,411846737,
Sjors,2018-08-09T18:54:58Z,"Afaik you can't download that binary separately from the ""official"" source, and the release signatures don't cover individual files either: https://bitcoincore.org/en/download/",https://github.com/bitcoin/bitcoin/pull/13761#issuecomment-411860721,411860721,
leishman,2018-08-09T19:10:57Z,"They are hosted here: https://bitcoincore.org/bin/bitcoin-core-0.16.2/\n\nAnd when installing the bitcoind package on ubuntu: `sudo apt-get install bitcoind` this does not setup the `~/.bitcoin` directory for you. This directory is created upon execution of the `bitcoind` binary. So it's unclear to me where a static file, like the default conf, could possibly be included. What am I missing?",https://github.com/bitcoin/bitcoin/pull/13761#issuecomment-411865195,411865195,
sipa,2018-08-09T19:28:27Z,It's also not possible. When you do a system wide installation of `bitcoind` it doesn't know which user(s) are going to run it.,https://github.com/bitcoin/bitcoin/pull/13761#issuecomment-411869926,411869926,
Sjors,2018-08-09T19:29:08Z,"@leishman these are packages with multiple files, which you can add files to by tweaking the deploy scripts. Similarly, it should be possible for the ubuntu install script to put this template file somewhere, since it also manages put the icon in /usr/share.",https://github.com/bitcoin/bitcoin/pull/13761#issuecomment-411870099,411870099,
leishman,2018-08-09T20:12:36Z,@sipa so do you think the approach I have taken in this PR is reasonable?,https://github.com/bitcoin/bitcoin/pull/13761#issuecomment-411882174,411882174,
Sjors,2018-08-10T11:11:18Z,"To clarify my position: I prefer a more elegant solution, but I'm OK with doing that later.\n\nI do however recommend adding a functional test to check if this file is indeed created.",https://github.com/bitcoin/bitcoin/pull/13761#issuecomment-412052395,412052395,
leishman,2018-08-11T23:13:24Z,@Sjors ok I'll add in that test,https://github.com/bitcoin/bitcoin/pull/13761#issuecomment-412307576,412307576,
leishman,2018-08-17T19:20:34Z,"@Sjors After digging into the testing framework it looks like testing for this behavior is actually quite tricky. The current functionality only creates a `bitcoin.conf.example` file if the default `datadir` is used and doesn't already exist. In the testing framework, a custom test-specific `datadir` is always used in order to not pollute the global filesystem of the testing machine. ",https://github.com/bitcoin/bitcoin/pull/13761#issuecomment-413964530,413964530,
Sjors,2018-08-20T16:50:02Z,"@jnewbery is there already a test which checks that the `datadir` is created when necessary? If so, perhaps that test can be modified to also check the presence of `bitcoin.conf.example`?",https://github.com/bitcoin/bitcoin/pull/13761#issuecomment-414385764,414385764,
jnewbery,2018-08-24T20:46:43Z,">  is there already a test which checks that the datadir is created when necessary?\n\nI don't think so. See `initialize_datadir()` in util.py and the places it's called. There are various places where the files in the datadir or the datadir itself is removed. See here for example: https://github.com/bitcoin/bitcoin/blob/55c18a45305f9e89a726f8cf82a7b16a2ab7f955/test/functional/feature_blocksdir.",https://github.com/bitcoin/bitcoin/pull/13761#issuecomment-415878017,415878017,
leishman,2018-08-24T21:30:08Z,"Yeah, currently the test framework always puts the `datadir`s in a custom path deep in the system `/tmp` directory. This prevents polluting the $HOME path of the machine running the tests. But because of this, my change is basically untestable, unless we change the way the test framework works or hack something ugly.\n\nTesting default datadir creation could be a testing feature we add in a late",https://github.com/bitcoin/bitcoin/pull/13761#issuecomment-415887616,415887616,
leishman,2018-08-24T22:38:11Z,Pulling out logging update into a separate PR: https://github.com/bitcoin/bitcoin/pull/14057,https://github.com/bitcoin/bitcoin/pull/13761#issuecomment-415900438,415900438,
jnewbery,2018-08-27T13:32:52Z,"> The current functionality only creates a bitcoin.conf.example file if the default datadir is used and doesn't already exist.\n\n> ... my change is basically untestable\n\nWhat do you think about changing the conditional here: https://github.com/bitcoin/bitcoin/pull/13761/files#diff-b7702a084eb00fb47f9800fd68271951R791 to check whether the directory is empty instead of whether the directory e",https://github.com/bitcoin/bitcoin/pull/13761#issuecomment-416227880,416227880,
DrahtBot,2018-09-10T14:15:58Z,<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase,https://github.com/bitcoin/bitcoin/pull/13761#issuecomment-419928378,419928378,
DrahtBot,2018-12-12T19:23:16Z,"<!--5fd3d806e98f4a0ca80977bb178665a0-->There hasn't been much activity lately and the patch still needs rebase, so I am closing this for now. Please let me know when you want to continue working on this, so the pull request can be re-opened.",https://github.com/bitcoin/bitcoin/pull/13761#issuecomment-446711656,446711656,
ken2812221,2018-07-26T04:17:37Z,What's The R and ( for?,https://github.com/bitcoin/bitcoin/pull/13761#discussion_r205327556,205327556,src/bitcoin.conf
ken2812221,2018-07-26T04:17:54Z,What's the ) for ?,https://github.com/bitcoin/bitcoin/pull/13761#discussion_r205327590,205327590,src/bitcoin.conf
ken2812221,2018-07-26T04:19:42Z,I don't think this is a good way to do this. I'd prefer rename to `bitcoin_conf.h` and move `const char ...` into that file.,https://github.com/bitcoin/bitcoin/pull/13761#discussion_r205327808,205327808,src/bitcoind.cpp
leishman,2018-07-26T04:43:22Z,The R() is for being able to `#include` the file. But I like your idea better. I will update. Thanks for the suggestions.,https://github.com/bitcoin/bitcoin/pull/13761#discussion_r205330151,205330151,src/bitcoind.cpp
leishman,2018-07-26T04:53:53Z,Also sorry for not explaining further. R() is for multiline string literal: https://stackoverflow.com/a/20508617/2302781,https://github.com/bitcoin/bitcoin/pull/13761#discussion_r205331236,205331236,src/bitcoind.cpp
practicalswift,2018-08-02T08:02:06Z,Please left-indent this entire block and increase the total line length to say 78 chars. That will make it easier to read.,https://github.com/bitcoin/bitcoin/pull/13761#discussion_r207133891,207133891,src/conf_file.h
practicalswift,2018-08-02T08:03:05Z,Please remove the greeting :-),https://github.com/bitcoin/bitcoin/pull/13761#discussion_r207134150,207134150,src/conf_file.h
practicalswift,2018-08-02T08:05:21Z,Perhaps the `385593` part could be longer and randomized?,https://github.com/bitcoin/bitcoin/pull/13761#discussion_r207134759,207134759,src/conf_file.h
fanquake,2018-08-02T08:21:05Z,"> part could be longer and randomized?\n\nWhat do you mean by this? This is an example password that we'd never want anyone to use, and actually comes from the sample bitcoin.conf on the [wiki](https://en.bitcoin.it/wiki/Running_Bitcoin).",https://github.com/bitcoin/bitcoin/pull/13761#discussion_r207139156,207139156,src/conf_file.h
practicalswift,2018-08-02T08:30:54Z,@fanquake Yes I know but randomizing would make it slighly less painful for newcomers to make the mistake of uncommenting as-is. Perhaps that is overkill though.,https://github.com/bitcoin/bitcoin/pull/13761#discussion_r207142172,207142172,src/conf_file.h
leishman,2018-08-02T12:41:29Z,"@practicalswift I copied this from `contrib/debian/examples/bitcoin.conf`. I'm happy to reformat the file and make these changes, but do you think they should be made in both places? ",https://github.com/bitcoin/bitcoin/pull/13761#discussion_r207210558,207210558,src/conf_file.h
leishman,2018-08-02T12:45:25Z,I think it's overkill. If anything we should remove the term 'Number' from the example pw so people don't think it must be limited to a numeric value. ,https://github.com/bitcoin/bitcoin/pull/13761#discussion_r207211619,207211619,src/conf_file.h
practicalswift,2018-08-02T12:50:49Z,"OK, makes sense!",https://github.com/bitcoin/bitcoin/pull/13761#discussion_r207213171,207213171,src/conf_file.h
practicalswift,2018-08-02T13:01:28Z,Nit: Missing space before `(`,https://github.com/bitcoin/bitcoin/pull/13761#discussion_r207216369,207216369,src/init.cpp
practicalswift,2018-08-02T13:03:04Z,Nit: Redundant comment :-)  Next line says the same thing.,https://github.com/bitcoin/bitcoin/pull/13761#discussion_r207216904,207216904,src/util.cpp
leishman,2018-08-02T13:14:42Z,fixed,https://github.com/bitcoin/bitcoin/pull/13761#discussion_r207220423,207220423,src/init.cpp
leishman,2018-08-02T13:16:07Z,I like the explicit comment here personally. It was there before this PR as part of a larger comment and I wanted to keep it around,https://github.com/bitcoin/bitcoin/pull/13761#discussion_r207220839,207220839,src/util.cpp
