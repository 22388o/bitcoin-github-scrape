[
  {
    "sha": "f19ad404631010a5e2dac2c7cbecd057b005fe2a",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmMTlhZDQwNDYzMTAxMGE1ZTJkYWMyYzdjYmVjZDA1N2IwMDVmZTJh",
    "commit": {
      "author": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2021-09-16T21:53:32Z"
      },
      "committer": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2021-09-16T21:53:32Z"
      },
      "message": "rpc, wallet: Descriptor wallets are no longer experimental",
      "tree": {
        "sha": "aaa17c57d425d3b304ab6a9c94898f18203d7e97",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/aaa17c57d425d3b304ab6a9c94898f18203d7e97"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f19ad404631010a5e2dac2c7cbecd057b005fe2a",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f19ad404631010a5e2dac2c7cbecd057b005fe2a",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/f19ad404631010a5e2dac2c7cbecd057b005fe2a",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f19ad404631010a5e2dac2c7cbecd057b005fe2a/comments",
    "author": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "6ef84e0503994c53f77093e7ea5951a7b0edea7a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6ef84e0503994c53f77093e7ea5951a7b0edea7a",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/6ef84e0503994c53f77093e7ea5951a7b0edea7a"
      }
    ],
    "stats": {
      "total": 1,
      "additions": 0,
      "deletions": 1
    },
    "files": [
      {
        "sha": "4b2aca30784ea3f141ceb9db73ef3ed56bd52e80",
        "filename": "src/wallet/rpcwallet.cpp",
        "status": "modified",
        "additions": 0,
        "deletions": 1,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f19ad404631010a5e2dac2c7cbecd057b005fe2a/src/wallet/rpcwallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f19ad404631010a5e2dac2c7cbecd057b005fe2a/src/wallet/rpcwallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcwallet.cpp?ref=f19ad404631010a5e2dac2c7cbecd057b005fe2a",
        "patch": "@@ -2771,7 +2771,6 @@ static RPCHelpMan createwallet()\n         throw JSONRPCError(RPC_WALLET_ERROR, \"Compiled without sqlite support (required for descriptor wallets)\");\n #endif\n         flags |= WALLET_FLAG_DESCRIPTORS;\n-        warnings.emplace_back(Untranslated(\"Wallet is an experimental descriptor wallet\"));\n     }\n     if (!request.params[7].isNull() && request.params[7].get_bool()) {\n #ifdef ENABLE_EXTERNAL_SIGNER"
      }
    ]
  },
  {
    "sha": "9c1052a5218e191fd23c0d9fc06f2fca34b03411",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5YzEwNTJhNTIxOGUxOTFmZDIzYzBkOWZjMDZmMmZjYTM0YjAzNDEx",
    "commit": {
      "author": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2021-09-16T22:05:44Z"
      },
      "committer": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2021-09-17T17:32:06Z"
      },
      "message": "wallet: Default new wallets to descriptor wallets",
      "tree": {
        "sha": "25711a12887709bacbbe58fa4c291da0ae57fe81",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/25711a12887709bacbbe58fa4c291da0ae57fe81"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9c1052a5218e191fd23c0d9fc06f2fca34b03411",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9c1052a5218e191fd23c0d9fc06f2fca34b03411",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/9c1052a5218e191fd23c0d9fc06f2fca34b03411",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9c1052a5218e191fd23c0d9fc06f2fca34b03411/comments",
    "author": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "f19ad404631010a5e2dac2c7cbecd057b005fe2a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f19ad404631010a5e2dac2c7cbecd057b005fe2a",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/f19ad404631010a5e2dac2c7cbecd057b005fe2a"
      }
    ],
    "stats": {
      "total": 30,
      "additions": 25,
      "deletions": 5
    },
    "files": [
      {
        "sha": "21d4df5b01489d0dbe7f8f11980fa0ba3b8f0e75",
        "filename": "src/bitcoin-wallet.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9c1052a5218e191fd23c0d9fc06f2fca34b03411/src/bitcoin-wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9c1052a5218e191fd23c0d9fc06f2fca34b03411/src/bitcoin-wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bitcoin-wallet.cpp?ref=9c1052a5218e191fd23c0d9fc06f2fca34b03411",
        "patch": "@@ -30,6 +30,7 @@ static void SetupWalletToolArgs(ArgsManager& argsman)\n     argsman.AddArg(\"-dumpfile=<file name>\", \"When used with 'dump', writes out the records to this file. When used with 'createfromdump', loads the records into a new wallet.\", ArgsManager::ALLOW_STRING, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-debug=<category>\", \"Output debugging information (default: 0).\", ArgsManager::ALLOW_ANY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-descriptors\", \"Create descriptors wallet. Only for 'create'\", ArgsManager::ALLOW_BOOL, OptionsCategory::OPTIONS);\n+    argsman.AddArg(\"-legacy\", \"Create legacy wallet. Only for 'create'\", ArgsManager::ALLOW_BOOL, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-format=<format>\", \"The format of the wallet file to create. Either \\\"bdb\\\" or \\\"sqlite\\\". Only used with 'createfromdump'\", ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-printtoconsole\", \"Send trace/debug info to console (default: 1 when no -debug is true, 0 otherwise).\", ArgsManager::ALLOW_ANY, OptionsCategory::DEBUG_TEST);\n "
      },
      {
        "sha": "56adbe17a5ce400a841e63858afb1414d55f67c5",
        "filename": "src/qt/forms/createwalletdialog.ui",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9c1052a5218e191fd23c0d9fc06f2fca34b03411/src/qt/forms/createwalletdialog.ui",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9c1052a5218e191fd23c0d9fc06f2fca34b03411/src/qt/forms/createwalletdialog.ui",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/forms/createwalletdialog.ui?ref=9c1052a5218e191fd23c0d9fc06f2fca34b03411",
        "patch": "@@ -107,6 +107,9 @@\n         <property name=\"text\">\n          <string>Descriptor Wallet</string>\n         </property>\n+        <property name=\"checked\">\n+         <bool>true</bool>\n+        </property>\n        </widget>\n       </item>\n       <item>"
      },
      {
        "sha": "211a33b29ede2492fa0abc18b2ea5a4e4a10d787",
        "filename": "src/wallet/rpcwallet.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9c1052a5218e191fd23c0d9fc06f2fca34b03411/src/wallet/rpcwallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9c1052a5218e191fd23c0d9fc06f2fca34b03411/src/wallet/rpcwallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcwallet.cpp?ref=9c1052a5218e191fd23c0d9fc06f2fca34b03411",
        "patch": "@@ -2724,7 +2724,7 @@ static RPCHelpMan createwallet()\n             {\"blank\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"Create a blank wallet. A blank wallet has no keys or HD seed. One can be set using sethdseed.\"},\n             {\"passphrase\", RPCArg::Type::STR, RPCArg::Optional::OMITTED_NAMED_ARG, \"Encrypt the wallet with this passphrase.\"},\n             {\"avoid_reuse\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"Keep track of coin reuse, and treat dirty and clean coins differently with privacy considerations in mind.\"},\n-            {\"descriptors\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"Create a native descriptor wallet. The wallet will use descriptors internally to handle address creation\"},\n+            {\"descriptors\", RPCArg::Type::BOOL, RPCArg::Default{true}, \"Create a native descriptor wallet. The wallet will use descriptors internally to handle address creation\"},\n             {\"load_on_startup\", RPCArg::Type::BOOL, RPCArg::Optional::OMITTED_NAMED_ARG, \"Save wallet name to persistent settings and load on startup. True to add wallet to startup list, false to remove, null to leave unchanged.\"},\n             {\"external_signer\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"Use an external signer such as a hardware wallet. Requires -signer to be configured. Wallet creation will fail if keys cannot be fetched. Requires disable_private_keys and descriptors set to true.\"},\n         },\n@@ -2766,7 +2766,7 @@ static RPCHelpMan createwallet()\n     if (!request.params[4].isNull() && request.params[4].get_bool()) {\n         flags |= WALLET_FLAG_AVOID_REUSE;\n     }\n-    if (!request.params[5].isNull() && request.params[5].get_bool()) {\n+    if (request.params[5].isNull() || request.params[5].get_bool()) {\n #ifndef USE_SQLITE\n         throw JSONRPCError(RPC_WALLET_ERROR, \"Compiled without sqlite support (required for descriptor wallets)\");\n #endif"
      },
      {
        "sha": "4000c08ea9edcd1df460b939453ca833123a167a",
        "filename": "src/wallet/wallettool.cpp",
        "status": "modified",
        "additions": 17,
        "deletions": 1,
        "changes": 18,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9c1052a5218e191fd23c0d9fc06f2fca34b03411/src/wallet/wallettool.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9c1052a5218e191fd23c0d9fc06f2fca34b03411/src/wallet/wallettool.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallettool.cpp?ref=9c1052a5218e191fd23c0d9fc06f2fca34b03411",
        "patch": "@@ -116,6 +116,10 @@ bool ExecuteWalletToolFunc(const ArgsManager& args, const std::string& command)\n         tfm::format(std::cerr, \"The -descriptors option can only be used with the 'create' command.\\n\");\n         return false;\n     }\n+    if (args.IsArgSet(\"-legacy\") && command != \"create\") {\n+        tfm::format(std::cerr, \"The -legacy option can only be used with the 'create' command.\\n\");\n+        return false;\n+    }\n     if (command == \"create\" && !args.IsArgSet(\"-wallet\")) {\n         tfm::format(std::cerr, \"Wallet name must be provided when creating a new wallet.\\n\");\n         return false;\n@@ -126,7 +130,19 @@ bool ExecuteWalletToolFunc(const ArgsManager& args, const std::string& command)\n     if (command == \"create\") {\n         DatabaseOptions options;\n         options.require_create = true;\n-        if (args.GetBoolArg(\"-descriptors\", false)) {\n+        // If -legacy is set, use it. Otherwise default to false.\n+        bool make_legacy = args.GetBoolArg(\"-legacy\", false);\n+        // If neither -legacy nor -descriptors is set, default to true. If -descriptors is set, use its value.\n+        bool make_descriptors = (!args.IsArgSet(\"-descriptors\") && !args.IsArgSet(\"-legacy\")) || (args.IsArgSet(\"-descriptors\") && args.GetBoolArg(\"-descriptors\", true));\n+        if (make_legacy && make_descriptors) {\n+            tfm::format(std::cerr, \"Only one of -legacy or -descriptors can be set to true, not both\\n\");\n+            return false;\n+        }\n+        if (!make_legacy && !make_descriptors) {\n+            tfm::format(std::cerr, \"One of -legacy or -descriptors must be set to true (or omitted)\\n\");\n+            return false;\n+        }\n+        if (make_descriptors) {\n             options.create_flags |= WALLET_FLAG_DESCRIPTORS;\n             options.require_format = DatabaseFormat::SQLITE;\n         }"
      },
      {
        "sha": "3a0daf04ad7477ecddc23743e0fe3956240dfcbb",
        "filename": "test/functional/tool_wallet.py",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9c1052a5218e191fd23c0d9fc06f2fca34b03411/test/functional/tool_wallet.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9c1052a5218e191fd23c0d9fc06f2fca34b03411/test/functional/tool_wallet.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/tool_wallet.py?ref=9c1052a5218e191fd23c0d9fc06f2fca34b03411",
        "patch": "@@ -31,8 +31,8 @@ def skip_test_if_missing_module(self):\n     def bitcoin_wallet_process(self, *args):\n         binary = self.config[\"environment\"][\"BUILDDIR\"] + '/src/bitcoin-wallet' + self.config[\"environment\"][\"EXEEXT\"]\n         default_args = ['-datadir={}'.format(self.nodes[0].datadir), '-chain=%s' % self.chain]\n-        if self.options.descriptors and 'create' in args:\n-            default_args.append('-descriptors')\n+        if not self.options.descriptors and 'create' in args:\n+            default_args.append('-legacy')\n \n         return subprocess.Popen([binary] + default_args + list(args), stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE, universal_newlines=True)\n "
      }
    ]
  }
]