promag,2019-05-09 17:34:46,"Concept ACK, will test.\n\n> ensures that the auth cookie is still generated in regtest mode on test purposes\n\nIs this necessary for the test framework?",https://github.com/bitcoin/bitcoin/pull/15989#issuecomment-490996609,490996609,
hebasto,2019-05-09 17:41:57,"@promag \n> Is this necessary for the test framework?\n\nYes, it is. See:\nhttps://github.com/bitcoin/bitcoin/blob/de5af41e3567dd9660b3e9734113dccbce394207/test/functional/test_framework/util.py#L314",https://github.com/bitcoin/bitcoin/pull/15989#issuecomment-490999103,490999103,
gmaxwell,2019-05-10 02:46:09,"Unless I'm reading this wrong, this provides no way to keep bitcoin-cli just working if you'd added an rpcauth line to enable use by an application.",https://github.com/bitcoin/bitcoin/pull/15989#issuecomment-491135320,491135320,
hebasto,2019-05-10 08:30:21,"@gmaxwell \n> Unless I'm reading this wrong, this provides no way to keep bitcoin-cli just working if you'd added an rpcauth line to enable use by an application.\n\nIf the client is running with the `-rpcauth` option the `bitcoin-cli` needs authorization (with this PR).\nThe same behavior is for the client with `-rpcuser` and `-rpcpassword` options set (on master).",https://github.com/bitcoin/bitcoin/pull/15989#issuecomment-491206454,491206454,
MarcoFalke,2019-05-10 11:19:17,Is there any downside to having two mechanisms to auth with?,https://github.com/bitcoin/bitcoin/pull/15989#issuecomment-491253982,491253982,
hebasto,2019-05-10 11:43:06,"@MarcoFalke \n> Is there any downside to having two mechanisms to auth with?\n\nThere are _three_ mechanisms to authenticate with:\n- using `.cookie` file\n- providing `-rpcuser` and `-rpcpassword` options to the RPC server (`bitcoind` or `bitcoin-qt`; should be deprecated as a plain text RPC password is exposed)\n- providing `-rpcauth` option to the RPC server (`bitcoind` or `bitcoin-qt`)\",https://github.com/bitcoin/bitcoin/pull/15989#issuecomment-491259711,491259711,
MarcoFalke,2019-05-10 11:52:54,Is there any danger to always create the cookie?,https://github.com/bitcoin/bitcoin/pull/15989#issuecomment-491262131,491262131,
hebasto,2019-05-10 12:02:51,"> Is there any danger to always create the cookie?\n\nI'm not a security expert.\n""_to always create the cookie_"" seems equivalent to giving access to the RPC interface to any non-privileged user (e.g., if `/etc/bitcoin/bitcoin.conf` exists). Is it acceptable for nodes running for business? ",https://github.com/bitcoin/bitcoin/pull/15989#issuecomment-491264583,491264583,
MarcoFalke,2019-05-10 12:06:09,"If they have access to the conf file, they might as well put the rpcauth pair in there and don't need the cookie.",https://github.com/bitcoin/bitcoin/pull/15989#issuecomment-491265463,491265463,
hebasto,2019-05-10 12:14:33,"> ... they might as well put the rpcauth pair in there ...\n\nThis requires write access.\n\nHowever, only read access is needed to read the cookie from `/etc` dir or its subdir.\n\n",https://github.com/bitcoin/bitcoin/pull/15989#issuecomment-491267725,491267725,
hebasto,2019-05-10 12:17:41,"`.cookie` is a plain text file:\n\nhttps://github.com/bitcoin/bitcoin/blob/14959753a424f04be118630f691ecab9b0df7e9e/src/rpc/protocol.cpp#L81\n\nhttps://github.com/bitcoin/bitcoin/blob/14959753a424f04be118630f691ecab9b0df7e9e/src/rpc/protocol.cpp#L93",https://github.com/bitcoin/bitcoin/pull/15989#issuecomment-491268577,491268577,
gmaxwell,2019-05-11 19:34:41,"The cookie is not available to arbitrary non-privileged users. If it is, your configuration is already screwed up.  The cookie is protected by the same mechanism as the filesystems that protect _the wallet_.   Also, being able to read the conf files means that you can read the credentials which we should treat as equivalent to handling them (yes, they're hashed, but that is just belt-and-suspender",https://github.com/bitcoin/bitcoin/pull/15989#issuecomment-491538291,491538291,
promag,2019-05-12 22:43:57,"> However, if -rpcuser and -rpcpassword are provided the .cookie file is not generated.\n\nThen maybe change this? Especially considering these parameters are deprecated.",https://github.com/bitcoin/bitcoin/pull/15989#issuecomment-491635610,491635610,
NicolasDorier,2019-05-13 01:27:04,"NAK.\n\nBy luck I found out this pull request just when this behavior allowed me to fix a bug. If this PR was merged, it would break my use case.\n\nIn a BTCPay Server deployment, we have a bunch of applications connecting to Bitcoin Core RPC.\n\nFor most application, we use cookiefile because it is simpler to configure. The less parameters there is, the less chance to screw up.\n\nHowever",https://github.com/bitcoin/bitcoin/pull/15989#issuecomment-491647746,491647746,
NicolasDorier,2019-05-13 01:33:43,Also notice that the behavior being inconsistent forced me to use rpcauth instead of the deprecrated rpcuser/password. Which is a good thing.,https://github.com/bitcoin/bitcoin/pull/15989#issuecomment-491648551,491648551,
MarcoFalke,2019-05-13 01:46:15,"Thanks for everyone's input. Closing this for now, since it seems too controversial.",https://github.com/bitcoin/bitcoin/pull/15989#issuecomment-491650078,491650078,
promag,2019-05-13 13:54:10,"> Also cookiefile auth is more secure\n\n@NicolasDorier How so?\n\nAFAIK cookie file is just a simple solution for authentication ""inside"" the host - both the server and the client have access to it. Of course the cookie can be shared to other hosts (you can read containers here) but I don't think that's the point.",https://github.com/bitcoin/bitcoin/pull/15989#issuecomment-491831923,491831923,
NicolasDorier,2019-05-15 09:51:35,"@promag say there is 10 000 deployment in the wild of btcpay, and we are using a fixed password. So those 10 000 deployment have same RPC pass. Now if by mistake the RPC ever get exposed, we have 10 000 deployment exposed. At least with cookieauth the deployments don't have the same creds.",https://github.com/bitcoin/bitcoin/pull/15989#issuecomment-492587104,492587104,
