[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/875999127",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#issuecomment-875999127",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22415",
    "id": 875999127,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3NTk5OTEyNw==",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-07T23:24:44Z",
    "updated_at": "2021-07-07T23:24:44Z",
    "author_association": "CONTRIBUTOR",
    "body": "Concept ACK. I think you can drop the second commit and add a `LOCK_RETURNED` helper method to be able to keep using lock annotations when m_mempool is null:\r\n\r\n```c++\r\nRecursiveMutex* MempoolMutex() const LOCK_RETURNED(m_mempool->cs) { return m_mempool ? &m_mempool->cs : nullptr; }\r\n```\r\n\r\nSeems to work for me in commit 8db5953e2d666fb9c25ae8f0df5b4c5c5897cd58\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/875999127/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/876031066",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#issuecomment-876031066",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22415",
    "id": 876031066,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3NjAzMTA2Ng==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-08T00:48:00Z",
    "updated_at": "2021-07-10T11:03:55Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #22371 by MarcoFalke\n* #21526 by jamesob\n* #21464 by JeremyRubin\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/876031066/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/876061371",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#issuecomment-876061371",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22415",
    "id": 876061371,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3NjA2MTM3MQ==",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-08T02:05:13Z",
    "updated_at": "2021-07-08T02:05:13Z",
    "author_association": "MEMBER",
    "body": "Rebased to remove the second commit per Russ' suggestion, which also addresses most of Marco's feedback.\r\n\r\n> Seems to work for me in commit 8db5953\r\n\r\nWow, that was wizardly. Thanks @ryanofsky!\r\n\r\n> I think std::variant can do this\r\n\r\nI'll look into this tomorrow.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/876061371/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/876296570",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#issuecomment-876296570",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22415",
    "id": 876296570,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3NjI5NjU3MA==",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?u=06eb9ae4f9b3f954056098860decccbf1340e40f&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-08T09:46:15Z",
    "updated_at": "2021-07-08T09:46:15Z",
    "author_association": "MEMBER",
    "body": "Light code review ACK b17bb4c37d58ca49e877983a632bfcaa493be993",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/876296570/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/876506636",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#issuecomment-876506636",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22415",
    "id": 876506636,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3NjUwNjYzNg==",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-08T14:52:44Z",
    "updated_at": "2021-07-08T14:52:44Z",
    "author_association": "MEMBER",
    "body": "Concept ACK, will review on next push.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/876506636/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/876568120",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#issuecomment-876568120",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22415",
    "id": 876568120,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3NjU2ODEyMA==",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-08T16:13:08Z",
    "updated_at": "2021-07-08T16:13:08Z",
    "author_association": "MEMBER",
    "body": "Rebased.\r\n\r\n> Note: Naively I'd expect the mempool pointer for the activated snapshot to be non-null, but I guess it could be set later when the snapshot is fully initialized.\r\n\r\nThis is a good point. I'd come up with a commit that implements the `std::variant` feedback (and am glad to have for learning about that), but @ryanofsky's point here makes that change inappropriate: with assumeutxo, we may actually want the snapshot chain to have a non-null mempool if we're in, say, init.cpp and loading a snapshot chainstate that is active but not yet at tip.\r\n\r\nI've covered all of the other feedback aside from the lock assertion for the reasons Russ mentioned; maybe we can get around to it later.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/876568120/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/877340546",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#issuecomment-877340546",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22415",
    "id": 877340546,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3NzM0MDU0Ng==",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-09T17:24:33Z",
    "updated_at": "2021-07-09T17:24:33Z",
    "author_association": "MEMBER",
    "body": "Thanks for the prompt attention, good people. I've pushed a rebase that includes pretty much all of @jnewbery's feedback. This widens the scope of the PR to encompass a bit of refactoring, but I think it's all reasonable stuff to include here.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/877340546/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/877389354",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#issuecomment-877389354",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22415",
    "id": 877389354,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3NzM4OTM1NA==",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-09T18:50:15Z",
    "updated_at": "2021-07-09T18:50:15Z",
    "author_association": "MEMBER",
    "body": "Rebase to incorporate minor changes from @ryanofsky's feedback (https://github.com/bitcoin/bitcoin/pull/22415#discussion_r667134941).",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/877389354/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/879089245",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#issuecomment-879089245",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22415",
    "id": 879089245,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3OTA4OTI0NQ==",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-13T13:29:39Z",
    "updated_at": "2021-07-13T13:29:39Z",
    "author_association": "MEMBER",
    "body": "Anyone have any idea what the deal is with libsecp tests failing on ARM here? \r\n![image](https://user-images.githubusercontent.com/73197/125460328-0c24f2b4-fa8b-4544-ad19-a0c1c1b082ee.png)\r\n\r\nThis doesn't look like a spurious failure.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/879089245/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/879133508",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#issuecomment-879133508",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22415",
    "id": 879133508,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3OTEzMzUwOA==",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-13T14:22:51Z",
    "updated_at": "2021-07-13T14:23:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "@MarcoFalke would probably be most knowledgeable about the qemu-arm coredump https://github.com/bitcoin/bitcoin/pull/22415#issuecomment-879089245 https://cirrus-ci.com/task/6754077301276672?logs=ci#L3494, I was curious about that too. It seems like it is happening in a libsecp256k1 test so not related? But maybe there are ways to debug.\r\n\r\n(I don't want to bikeshed the style issues, since they don't actually matter at all. But just for fun I'll say I do agree with John in not liking mostly spurious `const`. Also would drop `Try` prefix or replace it with `Maybe` since `Try` suggests some kind of failure would be expected. I do think having `this->` prefixes is more readable in current code to distinguish method calls from function calls, but in non-legacy code it'd be cleaner to use `lowerCaseMethod()` and `UpperCaseFunction()` names to avoid the ambiguity.)",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/879133508/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/879147719",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#issuecomment-879147719",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22415",
    "id": 879147719,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3OTE0NzcxOQ==",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-13T14:40:45Z",
    "updated_at": "2021-07-13T14:40:45Z",
    "author_association": "MEMBER",
    "body": "The `(~x[m][shift]) << (64 - (1 << usebits))) == 0` failure is expected: https://github.com/bitcoin-core/secp256k1/issues/610#issuecomment-482803876",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/879147719/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/879148608",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#issuecomment-879148608",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22415",
    "id": 879148608,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3OTE0ODYwOA==",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-13T14:41:52Z",
    "updated_at": "2021-07-13T14:41:52Z",
    "author_association": "MEMBER",
    "body": "Could edit OP to remove the section that no longer applies to make sure it doesn't end up in the final merge commit?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/879148608/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/879176417",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#issuecomment-879176417",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22415",
    "id": 879176417,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3OTE3NjQxNw==",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-13T15:14:52Z",
    "updated_at": "2021-07-13T15:14:52Z",
    "author_association": "MEMBER",
    "body": "Pushed a rebase:\r\n- `TryUpdateMempool...` -> `MaybeUpdateMempool...`\r\n- Removed unnecessary `const`s\r\n- Removed outdated content from OP",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/879176417/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/879187156",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#issuecomment-879187156",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22415",
    "id": 879187156,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3OTE4NzE1Ng==",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-13T15:28:17Z",
    "updated_at": "2021-07-13T15:28:17Z",
    "author_association": "MEMBER",
    "body": "- unnecessary `tx_pool` removed",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/879187156/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/879190309",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#issuecomment-879190309",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22415",
    "id": 879190309,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3OTE5MDMwOQ==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-13T15:32:16Z",
    "updated_at": "2021-07-13T15:32:16Z",
    "author_association": "MEMBER",
    "body": "ACK ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/879190309/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/880518895",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#issuecomment-880518895",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22415",
    "id": 880518895,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg4MDUxODg5NQ==",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?u=06eb9ae4f9b3f954056098860decccbf1340e40f&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-15T08:51:30Z",
    "updated_at": "2021-07-15T08:51:30Z",
    "author_association": "MEMBER",
    "body": "ACK ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/880518895/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665699562",
    "pull_request_review_id": 701438810,
    "id": 665699562,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NTY5OTU2Mg==",
    "diff_hunk": "@@ -2565,12 +2570,12 @@ bool CChainState::ActivateBestChainStep(BlockValidationState& state, CBlockIndex\n         }\n     }\n \n-    if (fBlocksDisconnected) {\n+    if (fBlocksDisconnected && m_mempool) {\n         // If any blocks were disconnected, disconnectpool may be non empty.  Add\n         // any disconnected transactions back to the mempool.\n-        UpdateMempoolForReorg(*this, m_mempool, disconnectpool, true);\n+        mempoolHandleReorg(disconnectpool, false);",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 122,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "349ab2843e7161b960a73eb216c135402cb35b73",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "why the change from `true` -> `false`?",
    "created_at": "2021-07-07T20:54:39Z",
    "updated_at": "2021-07-07T20:58:23Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r665699562",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665699562"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r665699562"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665699562/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2576,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665700194",
    "pull_request_review_id": 701438810,
    "id": 665700194,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NTcwMDE5NA==",
    "diff_hunk": "@@ -2642,7 +2647,8 @@ bool CChainState::ActivateBestChain(BlockValidationState& state, std::shared_ptr\n \n         {\n             LOCK(cs_main);\n-            LOCK(m_mempool.cs); // Lock transaction pool for at least as long as it takes for connectTrace to be consumed\n+            // Lock transaction pool for at least as long as it takes for connectTrace to be consumed\n+            if (m_mempool) LOCK(m_mempool->cs);",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 135,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "349ab2843e7161b960a73eb216c135402cb35b73",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Nice try, but leaving out the `{}` won't prevent the lock from being closed in the same line.",
    "created_at": "2021-07-07T20:55:46Z",
    "updated_at": "2021-07-07T20:58:23Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r665700194",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665700194"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r665700194"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665700194/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2651,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665700380",
    "pull_request_review_id": 701438810,
    "id": 665700380,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NTcwMDM4MA==",
    "diff_hunk": "@@ -2792,7 +2803,9 @@ bool CChainState::InvalidateBlock(BlockValidationState& state, CBlockIndex* pind\n         LimitValidationInterfaceQueue();\n \n         LOCK(cs_main);\n-        LOCK(m_mempool.cs); // Lock for as long as disconnectpool is in scope to make sure UpdateMempoolForReorg is called after DisconnectTip without unlocking in between\n+        // Lock for as long as disconnectpool is in scope to make sure UpdateMempoolForReorg is\n+        // called after DisconnectTip without unlocking in between\n+        if (m_mempool) LOCK(m_mempool->cs);",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 160,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "349ab2843e7161b960a73eb216c135402cb35b73",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "same",
    "created_at": "2021-07-07T20:56:03Z",
    "updated_at": "2021-07-07T20:58:23Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r665700380",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665700380"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r665700380"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665700380/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2808,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665700718",
    "pull_request_review_id": 701438810,
    "id": 665700718,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NTcwMDcxOA==",
    "diff_hunk": "@@ -4492,6 +4506,41 @@ bool CChainState::ResizeCoinsCaches(size_t coinstip_size, size_t coinsdb_size)\n     return ret;\n }\n \n+void CChainState::mempoolHandleReorg(DisconnectedBlockTransactions& disconnectpool, bool add_to_mempool) {",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 191,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "349ab2843e7161b960a73eb216c135402cb35b73",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\nvoid CChainState::mempoolHandleReorg(DisconnectedBlockTransactions& disconnectpool, bool add_to_mempool)\r\n{\r\n```\r\n\r\nproperly format new code?",
    "created_at": "2021-07-07T20:56:41Z",
    "updated_at": "2021-07-07T20:58:23Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r665700718",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665700718"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r665700718"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665700718/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4509,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665701402",
    "pull_request_review_id": 701438810,
    "id": 665701402,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NTcwMTQwMg==",
    "diff_hunk": "@@ -600,7 +601,7 @@ class CChainState\n     //! CChainState instances.\n     BlockManager& m_blockman;\n \n-    explicit CChainState(CTxMemPool& mempool, BlockManager& blockman, std::optional<uint256> from_snapshot_blockhash = std::nullopt);\n+    explicit CChainState(CTxMemPool* mempool, BlockManager& blockman, std::optional<uint256> from_snapshot_blockhash = std::nullopt);",
    "path": "src/validation.h",
    "position": null,
    "original_position": 17,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "349ab2843e7161b960a73eb216c135402cb35b73",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Would it be possible to combine the args so that *either* a mempool, or a hash can be passed, but not both? I think std::variant can do this",
    "created_at": "2021-07-07T20:57:56Z",
    "updated_at": "2021-07-07T20:58:23Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r665701402",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665701402"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r665701402"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665701402/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 604,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665807596",
    "pull_request_review_id": 701567478,
    "id": 665807596,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NTgwNzU5Ng==",
    "diff_hunk": "@@ -2565,12 +2570,12 @@ bool CChainState::ActivateBestChainStep(BlockValidationState& state, CBlockIndex\n         }\n     }\n \n-    if (fBlocksDisconnected) {\n+    if (fBlocksDisconnected && m_mempool) {\n         // If any blocks were disconnected, disconnectpool may be non empty.  Add\n         // any disconnected transactions back to the mempool.\n-        UpdateMempoolForReorg(*this, m_mempool, disconnectpool, true);\n+        mempoolHandleReorg(disconnectpool, false);",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 122,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "349ab2843e7161b960a73eb216c135402cb35b73",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Hey somebody's gotta keep review fun!",
    "created_at": "2021-07-08T01:31:20Z",
    "updated_at": "2021-07-08T01:31:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r665807596",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665807596"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r665807596"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665807596/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2576,
    "side": "RIGHT",
    "in_reply_to_id": 665699562
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665807889",
    "pull_request_review_id": 701567847,
    "id": 665807889,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NTgwNzg4OQ==",
    "diff_hunk": "@@ -2642,7 +2647,8 @@ bool CChainState::ActivateBestChain(BlockValidationState& state, std::shared_ptr\n \n         {\n             LOCK(cs_main);\n-            LOCK(m_mempool.cs); // Lock transaction pool for at least as long as it takes for connectTrace to be consumed\n+            // Lock transaction pool for at least as long as it takes for connectTrace to be consumed\n+            if (m_mempool) LOCK(m_mempool->cs);",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 135,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "349ab2843e7161b960a73eb216c135402cb35b73",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Oh yeah d'oh. Sure could've used those missing annotations there.",
    "created_at": "2021-07-08T01:32:21Z",
    "updated_at": "2021-07-08T01:32:21Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r665807889",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665807889"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r665807889"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665807889/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2651,
    "side": "RIGHT",
    "in_reply_to_id": 665700194
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666040037",
    "pull_request_review_id": 701858949,
    "id": 666040037,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NjA0MDAzNw==",
    "diff_hunk": "@@ -907,7 +913,7 @@ class ChainstateManager\n     //                                  constructor\n     //! @param[in] snapshot_blockhash   If given, signify that this chainstate\n     //!                                 is based on a snapshot.\n-    CChainState& InitializeChainstate(CTxMemPool& mempool, const std::optional<uint256>& snapshot_blockhash = std::nullopt)\n+    CChainState& InitializeChainstate(CTxMemPool* mempool, const std::optional<uint256>& snapshot_blockhash = std::nullopt)",
    "path": "src/validation.h",
    "position": null,
    "original_position": 58,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "b17bb4c37d58ca49e877983a632bfcaa493be993",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Similarly to [this comment](https://github.com/bitcoin/bitcoin/pull/22415/commits/b17bb4c37d58ca49e877983a632bfcaa493be993#r665701402), can we somehow reflect that if mempool is nullptr, the second argument doesn't make sense?",
    "created_at": "2021-07-08T09:45:48Z",
    "updated_at": "2021-07-08T09:45:48Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r666040037",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666040037"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r666040037"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666040037/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 923,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666144964",
    "pull_request_review_id": 701997551,
    "id": 666144964,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NjE0NDk2NA==",
    "diff_hunk": "@@ -798,6 +799,11 @@ class CChainState\n \n     bool LoadBlockIndexDB() EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    //! Indirection necessary to make lock annotations work with an optional mempool.\n+    RecursiveMutex* MempoolMutex() const LOCK_RETURNED(m_mempool->cs) {",
    "path": "src/validation.h",
    "position": null,
    "original_position": 46,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "b17bb4c37d58ca49e877983a632bfcaa493be993",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\n    RecursiveMutex* MempoolMutex() const LOCK_RETURNED(m_mempool->cs)\r\n    {\r\n```\r\n\r\nclang-format?",
    "created_at": "2021-07-08T12:27:09Z",
    "updated_at": "2021-07-08T12:27:49Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r666144964",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666144964"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r666144964"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666144964/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 803,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666249472",
    "pull_request_review_id": 702140548,
    "id": 666249472,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NjI0OTQ3Mg==",
    "diff_hunk": "@@ -1349,7 +1349,7 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n             const int64_t load_block_index_start_time = GetTimeMillis();\n             try {\n                 LOCK(cs_main);\n-                chainman.InitializeChainstate(*Assert(node.mempool));\n+                chainman.InitializeChainstate(Assert(node.mempool).get());",
    "path": "src/init.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "b17bb4c37d58ca49e877983a632bfcaa493be993",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"validation: make CChainState::m_mempool optional\" (b17bb4c37d58ca49e877983a632bfcaa493be993)\r\n\r\nMight be a little more obviously safe to write `Assert(node.mempool.get())` instead of `Assert(node.mempool).get()` since that version looks like the Assert function might be returning a temporary `unique_ptr` that would delete the mempool.",
    "created_at": "2021-07-08T14:31:26Z",
    "updated_at": "2021-07-08T15:08:48Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r666249472",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666249472"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r666249472"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666249472/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1352,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666272104",
    "pull_request_review_id": 702140548,
    "id": 666272104,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NjI3MjEwNA==",
    "diff_hunk": "@@ -2254,7 +2257,7 @@ static void UpdateTip(CTxMemPool& mempool, const CBlockIndex* pindexNew, const C\n bool CChainState::DisconnectTip(BlockValidationState& state, DisconnectedBlockTransactions* disconnectpool)\n {\n     AssertLockHeld(cs_main);\n-    AssertLockHeld(m_mempool.cs);\n+    if (m_mempool) AssertLockHeld(m_mempool->cs);",
    "path": "src/validation.cpp",
    "position": 161,
    "original_position": 49,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "b17bb4c37d58ca49e877983a632bfcaa493be993",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"validation: make CChainState::m_mempool optional\" (b17bb4c37d58ca49e877983a632bfcaa493be993)\r\n\r\nNote: It could be nice to be able to write `AssertLockHeld(MempoolMutex()` for consistency with `LOCK(MempoolMutex())` and to avoid the if statement. But it'd be beyond scope of this PR since it'd require changing `AssertLockHeld` and there are other issues with that function anyway.",
    "created_at": "2021-07-08T14:56:05Z",
    "updated_at": "2021-07-08T15:08:48Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r666272104",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666272104"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r666272104"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666272104/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2252,
    "original_line": 2252,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666275700",
    "pull_request_review_id": 702140548,
    "id": 666275700,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NjI3NTcwMA==",
    "diff_hunk": "@@ -4763,7 +4772,7 @@ bool ChainstateManager::ActivateSnapshot(\n     }\n \n     auto snapshot_chainstate = WITH_LOCK(::cs_main, return std::make_unique<CChainState>(\n-            this->ActiveChainstate().m_mempool, m_blockman, base_blockhash));\n+            nullptr, m_blockman, base_blockhash));",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 183,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "b17bb4c37d58ca49e877983a632bfcaa493be993",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"validation: make CChainState::m_mempool optional\" (b17bb4c37d58ca49e877983a632bfcaa493be993)\r\n\r\nNote: Naively I'd expect the mempool pointer for the activated snapshot to be non-null, but I guess it could be set later when the snapshot is fully initialized.",
    "created_at": "2021-07-08T14:59:59Z",
    "updated_at": "2021-07-08T15:08:48Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r666275700",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666275700"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r666275700"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666275700/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4775,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666340082",
    "pull_request_review_id": 702263693,
    "id": 666340082,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NjM0MDA4Mg==",
    "diff_hunk": "@@ -600,7 +601,7 @@ class CChainState\n     //! CChainState instances.\n     BlockManager& m_blockman;\n \n-    explicit CChainState(CTxMemPool& mempool, BlockManager& blockman, std::optional<uint256> from_snapshot_blockhash = std::nullopt);\n+    explicit CChainState(CTxMemPool* mempool, BlockManager& blockman, std::optional<uint256> from_snapshot_blockhash = std::nullopt);",
    "path": "src/validation.h",
    "position": null,
    "original_position": 17,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "349ab2843e7161b960a73eb216c135402cb35b73",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Not going this route for reasons mentioned in a recent comment: passing both is a valid approach if we are initializing a not-yet-to-tip snapshot chainstate in init.cpp.",
    "created_at": "2021-07-08T16:18:28Z",
    "updated_at": "2021-07-08T16:18:28Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r666340082",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666340082"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r666340082"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666340082/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 604,
    "side": "RIGHT",
    "in_reply_to_id": 665701402
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666340418",
    "pull_request_review_id": 702264178,
    "id": 666340418,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NjM0MDQxOA==",
    "diff_hunk": "@@ -1349,7 +1349,7 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n             const int64_t load_block_index_start_time = GetTimeMillis();\n             try {\n                 LOCK(cs_main);\n-                chainman.InitializeChainstate(*Assert(node.mempool));\n+                chainman.InitializeChainstate(Assert(node.mempool).get());",
    "path": "src/init.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "b17bb4c37d58ca49e877983a632bfcaa493be993",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Fixed, thanks.",
    "created_at": "2021-07-08T16:18:59Z",
    "updated_at": "2021-07-08T16:18:59Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r666340418",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666340418"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r666340418"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666340418/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1352,
    "side": "RIGHT",
    "in_reply_to_id": 666249472
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666368135",
    "pull_request_review_id": 702300732,
    "id": 666368135,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NjM2ODEzNQ==",
    "diff_hunk": "@@ -4763,7 +4772,7 @@ bool ChainstateManager::ActivateSnapshot(\n     }\n \n     auto snapshot_chainstate = WITH_LOCK(::cs_main, return std::make_unique<CChainState>(\n-            this->ActiveChainstate().m_mempool, m_blockman, base_blockhash));\n+            nullptr, m_blockman, base_blockhash));",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 183,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "8511429f3bc480ddeef06c23810b3c47fa8513ee",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "(if you retouch)\r\n```suggestion\r\n            /* mempool */ nullptr, m_blockman, base_blockhash));\r\n```",
    "created_at": "2021-07-08T16:57:50Z",
    "updated_at": "2021-07-08T17:10:05Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r666368135",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666368135"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r666368135"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666368135/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4775,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666708997",
    "pull_request_review_id": 702727979,
    "id": 666708997,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NjcwODk5Nw==",
    "diff_hunk": "@@ -907,7 +914,7 @@ class ChainstateManager\n     //                                  constructor\n     //! @param[in] snapshot_blockhash   If given, signify that this chainstate\n     //!                                 is based on a snapshot.\n-    CChainState& InitializeChainstate(CTxMemPool& mempool, const std::optional<uint256>& snapshot_blockhash = std::nullopt)\n+    CChainState& InitializeChainstate(CTxMemPool* mempool, const std::optional<uint256>& snapshot_blockhash = std::nullopt)",
    "path": "src/validation.h",
    "position": null,
    "original_position": 59,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "8511429f3bc480ddeef06c23810b3c47fa8513ee",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "\r\n\r\nWhat do you think about making this std::optional<CTxMemPool, std::optional>?\r\n\r\nIn this case, snapshot_blockhash can't be possibly specified without mempool, and that's what I originally suggested.\r\n",
    "created_at": "2021-07-09T06:41:51Z",
    "updated_at": "2021-07-09T06:41:51Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r666708997",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666708997"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r666708997"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666708997/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 923,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666864433",
    "pull_request_review_id": 702933845,
    "id": 666864433,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Njg2NDQzMw==",
    "diff_hunk": "@@ -2053,7 +2054,7 @@ bool CChainState::FlushStateToDisk(\n         bool fFlushForPrune = false;\n         bool fDoFullFlush = false;\n \n-        CoinsCacheSizeState cache_state = GetCoinsCacheSizeState(&m_mempool);\n+        CoinsCacheSizeState cache_state = GetCoinsCacheSizeState(m_mempool);",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 24,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "8511429f3bc480ddeef06c23810b3c47fa8513ee",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Since you're updating both call sites for `CChainState::GetCoinsCacheSizeState(const CTxMemPool* tx_pool)`, maybe it makes sense to just remove the argument. There's no need to pass a data member of `CChainState` to a member function of `CChainState` - it can just use its own `m_mempool`.",
    "created_at": "2021-07-09T10:59:54Z",
    "updated_at": "2021-07-09T11:33:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r666864433",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666864433"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r666864433"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666864433/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2057,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666871618",
    "pull_request_review_id": 702933845,
    "id": 666871618,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Njg3MTYxOA==",
    "diff_hunk": "@@ -2288,7 +2291,7 @@ bool CChainState::DisconnectTip(BlockValidationState& state, DisconnectedBlockTr\n         while (disconnectpool->DynamicMemoryUsage() > MAX_DISCONNECTED_TX_POOL_SIZE * 1000) {\n             // Drop the earliest entry, and remove its children from the mempool.\n             auto it = disconnectpool->queuedTx.get<insertion_order>().begin();\n-            m_mempool.removeRecursive(**it, MemPoolRemovalReason::REORG);\n+            if (m_mempool) m_mempool->removeRecursive(**it, MemPoolRemovalReason::REORG);",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 58,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "8511429f3bc480ddeef06c23810b3c47fa8513ee",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This `if (m_mempool)` condition can be at the level of the `if (disconnectpool)` above:\r\n\r\n```diff\r\n         return false;\r\n     }\r\n \r\n-    if (disconnectpool) {\r\n+    if (m_mempool && disconnectpool) {\r\n         // Save transactions to re-add to mempool at end of reorg\r\n         for (auto it = block.vtx.rbegin(); it != block.vtx.rend(); ++it) {\r\n             disconnectpool->addTransaction(*it);\r\n@@ -2291,7 +2291,7 @@ bool CChainState::DisconnectTip(BlockValidationState& state, DisconnectedBlockTr\r\n         while (disconnectpool->DynamicMemoryUsage() > MAX_DISCONNECTED_TX_POOL_SIZE * 1000) {\r\n             // Drop the earliest entry, and remove its children from the mempool.\r\n             auto it = disconnectpool->queuedTx.get<insertion_order>().begin();\r\n-            if (m_mempool) m_mempool->removeRecursive(**it, MemPoolRemovalReason::REORG);\r\n+            m_mempool->removeRecursive(**it, MemPoolRemovalReason::REORG);\r\n             disconnectpool->removeEntry(it);\r\n         }\r\n     }\r\n```\r\n\r\nThat would potentially save some work updating the `disconnectpool` data structure, which will never get used.\r\n\r\nEven better (but not necessarily part of this PR) would be to only create a `DisconnectedBlockTransactions` if `m_mempool` is non-null, and then update ` UpdateMempoolForReorg()` and ` DisconnectedBlockTransactions()` to take optional `DisconnectedBlockTransactions*`. There's no need to create and maintain a `DisconnectedBlockTransactions` if we're never going to use it.",
    "created_at": "2021-07-09T11:13:42Z",
    "updated_at": "2021-07-09T11:33:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r666871618",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666871618"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r666871618"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666871618/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2299,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666874055",
    "pull_request_review_id": 702933845,
    "id": 666874055,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Njg3NDA1NQ==",
    "diff_hunk": "@@ -2205,11 +2206,13 @@ static void AppendWarning(bilingual_str& res, const bilingual_str& warn)\n }\n \n /** Check warning conditions and do some notifications on new chain tip set. */\n-static void UpdateTip(CTxMemPool& mempool, const CBlockIndex* pindexNew, const CChainParams& chainParams, CChainState& active_chainstate)\n+static void UpdateTip(CTxMemPool* mempool, const CBlockIndex* pindexNew, const CChainParams& chainParams, CChainState& active_chainstate)",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 33,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "8511429f3bc480ddeef06c23810b3c47fa8513ee",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This could be a member of `CChainState` to avoid passing `mempool`, `chainParams` and `active_chainstate`.",
    "created_at": "2021-07-09T11:16:59Z",
    "updated_at": "2021-07-09T11:33:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r666874055",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666874055"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r666874055"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666874055/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2209,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666875394",
    "pull_request_review_id": 702933845,
    "id": 666875394,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Njg3NTM5NA==",
    "diff_hunk": "@@ -2401,7 +2404,7 @@ bool CChainState::ConnectTip(BlockValidationState& state, CBlockIndex* pindexNew\n     int64_t nTime5 = GetTimeMicros(); nTimeChainState += nTime5 - nTime4;\n     LogPrint(BCLog::BENCH, \"  - Writing chainstate: %.2fms [%.2fs (%.2fms/blk)]\\n\", (nTime5 - nTime4) * MILLI, nTimeChainState * MICRO, nTimeChainState * MILLI / nBlocksTotal);\n     // Remove conflicting transactions from the mempool.;\n-    m_mempool.removeForBlock(blockConnecting.vtx, pindexNew->nHeight);\n+    if (m_mempool) m_mempool->removeForBlock(blockConnecting.vtx, pindexNew->nHeight);\n     disconnectpool.removeForBlock(blockConnecting.vtx);",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 77,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "8511429f3bc480ddeef06c23810b3c47fa8513ee",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "No need to update `disconnectpool` if the mempool doesn't exist:\r\n\r\n```suggestion\r\n    if (m_mempool) {\r\n        m_mempool->removeForBlock(blockConnecting.vtx, pindexNew->nHeight);\r\n        disconnectpool.removeForBlock(blockConnecting.vtx);\r\n    }\r\n```",
    "created_at": "2021-07-09T11:19:39Z",
    "updated_at": "2021-07-09T11:33:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r666875394",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666875394"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r666875394"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666875394/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 2407,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 2408,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666881091",
    "pull_request_review_id": 702933845,
    "id": 666881091,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Njg4MTA5MQ==",
    "diff_hunk": "@@ -2507,7 +2510,7 @@ bool CChainState::ActivateBestChainStep(BlockValidationState& state, CBlockIndex\n         if (!DisconnectTip(state, &disconnectpool)) {\n             // This is likely a fatal error, but keep the mempool consistent,\n             // just in case. Only remove from the mempool in this case.\n-            UpdateMempoolForReorg(*this, m_mempool, disconnectpool, false);\n+            if (m_mempool) UpdateMempoolForReorg(*this, *m_mempool, disconnectpool, false);",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 94,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "8511429f3bc480ddeef06c23810b3c47fa8513ee",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "What do you think about updating `UpdateMempoolForReorg` to either be a member of `CChainState` or take `CTxMemPool` as an optional pointer, and then return immediately if mempool is null. That would avoid scattering so many `if (m_mempool)` checks across multiple validation functions.",
    "created_at": "2021-07-09T11:30:49Z",
    "updated_at": "2021-07-09T11:33:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r666881091",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666881091"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r666881091"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666881091/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2513,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667100285",
    "pull_request_review_id": 703250886,
    "id": 667100285,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NzEwMDI4NQ==",
    "diff_hunk": "@@ -2053,7 +2054,7 @@ bool CChainState::FlushStateToDisk(\n         bool fFlushForPrune = false;\n         bool fDoFullFlush = false;\n \n-        CoinsCacheSizeState cache_state = GetCoinsCacheSizeState(&m_mempool);\n+        CoinsCacheSizeState cache_state = GetCoinsCacheSizeState(m_mempool);",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 24,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "8511429f3bc480ddeef06c23810b3c47fa8513ee",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Good call! Done. ",
    "created_at": "2021-07-09T17:16:52Z",
    "updated_at": "2021-07-09T17:16:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r667100285",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667100285"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r667100285"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667100285/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2057,
    "side": "RIGHT",
    "in_reply_to_id": 666864433
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667101066",
    "pull_request_review_id": 703251951,
    "id": 667101066,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NzEwMTA2Ng==",
    "diff_hunk": "@@ -2288,7 +2291,7 @@ bool CChainState::DisconnectTip(BlockValidationState& state, DisconnectedBlockTr\n         while (disconnectpool->DynamicMemoryUsage() > MAX_DISCONNECTED_TX_POOL_SIZE * 1000) {\n             // Drop the earliest entry, and remove its children from the mempool.\n             auto it = disconnectpool->queuedTx.get<insertion_order>().begin();\n-            m_mempool.removeRecursive(**it, MemPoolRemovalReason::REORG);\n+            if (m_mempool) m_mempool->removeRecursive(**it, MemPoolRemovalReason::REORG);",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 58,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "8511429f3bc480ddeef06c23810b3c47fa8513ee",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yup, also a good call. Fixed. Initially wasn't sure if there was some other purpose we might be using the disconnectpool for (since it's sometimes passed in as a mutable parameter) but after looking around it's clearly just used for mempool maintenance.",
    "created_at": "2021-07-09T17:18:21Z",
    "updated_at": "2021-07-09T17:18:21Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r667101066",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667101066"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r667101066"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667101066/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2299,
    "side": "RIGHT",
    "in_reply_to_id": 666871618
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667101218",
    "pull_request_review_id": 703252145,
    "id": 667101218,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NzEwMTIxOA==",
    "diff_hunk": "@@ -2205,11 +2206,13 @@ static void AppendWarning(bilingual_str& res, const bilingual_str& warn)\n }\n \n /** Check warning conditions and do some notifications on new chain tip set. */\n-static void UpdateTip(CTxMemPool& mempool, const CBlockIndex* pindexNew, const CChainParams& chainParams, CChainState& active_chainstate)\n+static void UpdateTip(CTxMemPool* mempool, const CBlockIndex* pindexNew, const CChainParams& chainParams, CChainState& active_chainstate)",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 33,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "8511429f3bc480ddeef06c23810b3c47fa8513ee",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Agreed, done.",
    "created_at": "2021-07-09T17:18:37Z",
    "updated_at": "2021-07-09T17:18:37Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r667101218",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667101218"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r667101218"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667101218/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2209,
    "side": "RIGHT",
    "in_reply_to_id": 666874055
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667101302",
    "pull_request_review_id": 703252254,
    "id": 667101302,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NzEwMTMwMg==",
    "diff_hunk": "@@ -2401,7 +2404,7 @@ bool CChainState::ConnectTip(BlockValidationState& state, CBlockIndex* pindexNew\n     int64_t nTime5 = GetTimeMicros(); nTimeChainState += nTime5 - nTime4;\n     LogPrint(BCLog::BENCH, \"  - Writing chainstate: %.2fms [%.2fs (%.2fms/blk)]\\n\", (nTime5 - nTime4) * MILLI, nTimeChainState * MICRO, nTimeChainState * MILLI / nBlocksTotal);\n     // Remove conflicting transactions from the mempool.;\n-    m_mempool.removeForBlock(blockConnecting.vtx, pindexNew->nHeight);\n+    if (m_mempool) m_mempool->removeForBlock(blockConnecting.vtx, pindexNew->nHeight);\n     disconnectpool.removeForBlock(blockConnecting.vtx);",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 77,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "8511429f3bc480ddeef06c23810b3c47fa8513ee",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": ":+1: ",
    "created_at": "2021-07-09T17:18:48Z",
    "updated_at": "2021-07-09T17:18:48Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r667101302",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667101302"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r667101302"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667101302/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 2407,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 2408,
    "side": "RIGHT",
    "in_reply_to_id": 666875394
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667101565",
    "pull_request_review_id": 703252618,
    "id": 667101565,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NzEwMTU2NQ==",
    "diff_hunk": "@@ -2507,7 +2510,7 @@ bool CChainState::ActivateBestChainStep(BlockValidationState& state, CBlockIndex\n         if (!DisconnectTip(state, &disconnectpool)) {\n             // This is likely a fatal error, but keep the mempool consistent,\n             // just in case. Only remove from the mempool in this case.\n-            UpdateMempoolForReorg(*this, m_mempool, disconnectpool, false);\n+            if (m_mempool) UpdateMempoolForReorg(*this, *m_mempool, disconnectpool, false);",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 94,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "8511429f3bc480ddeef06c23810b3c47fa8513ee",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I went ahead and threw it onto `CChainState` since I think that makes sense; can strip off the commit if there are any objections.",
    "created_at": "2021-07-09T17:19:19Z",
    "updated_at": "2021-07-09T17:19:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r667101565",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667101565"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r667101565"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667101565/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2513,
    "side": "RIGHT",
    "in_reply_to_id": 666881091
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667102878",
    "pull_request_review_id": 703254307,
    "id": 667102878,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NzEwMjg3OA==",
    "diff_hunk": "@@ -907,7 +914,7 @@ class ChainstateManager\n     //                                  constructor\n     //! @param[in] snapshot_blockhash   If given, signify that this chainstate\n     //!                                 is based on a snapshot.\n-    CChainState& InitializeChainstate(CTxMemPool& mempool, const std::optional<uint256>& snapshot_blockhash = std::nullopt)\n+    CChainState& InitializeChainstate(CTxMemPool* mempool, const std::optional<uint256>& snapshot_blockhash = std::nullopt)",
    "path": "src/validation.h",
    "position": null,
    "original_position": 59,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "8511429f3bc480ddeef06c23810b3c47fa8513ee",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "There are cases when we want to call this with a snapshot blockhash but not a mempool - during snapshot load time when we need a chainstate instance to populate/validate but don't want to yet make it the active chainstate in case loading the UTXO snapshot fails.",
    "created_at": "2021-07-09T17:21:43Z",
    "updated_at": "2021-07-09T17:21:43Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r667102878",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667102878"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r667102878"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667102878/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 923,
    "side": "RIGHT",
    "in_reply_to_id": 666708997
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667134941",
    "pull_request_review_id": 703295494,
    "id": 667134941,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NzEzNDk0MQ==",
    "diff_hunk": "@@ -342,11 +342,15 @@ static bool IsCurrentForFeeEstimation(CChainState& active_chainstate) EXCLUSIVE_\n  * Passing fAddToMempool=false will skip trying to add the transactions back,\n  * and instead just erase from the mempool as needed.\n  */\n-\n-static void UpdateMempoolForReorg(CChainState& active_chainstate, CTxMemPool& mempool, DisconnectedBlockTransactions& disconnectpool, bool fAddToMempool) EXCLUSIVE_LOCKS_REQUIRED(cs_main, mempool.cs)\n+void CChainState::UpdateMempoolForReorg(\n+    CChainState& active_chainstate,",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 7,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "7cdcd08d665570167b06a93e003369f7fa833cec",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"refactor: move UpdateMempoolForReorg into CChainState\" (7cdcd08d665570167b06a93e003369f7fa833cec)\r\n\r\n`active_chainstate` is always `*this` right? Can the parameter be dropped?",
    "created_at": "2021-07-09T18:21:43Z",
    "updated_at": "2021-07-09T18:28:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r667134941",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667134941"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r667134941"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667134941/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 346,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667148994",
    "pull_request_review_id": 703313303,
    "id": 667148994,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NzE0ODk5NA==",
    "diff_hunk": "@@ -342,11 +342,15 @@ static bool IsCurrentForFeeEstimation(CChainState& active_chainstate) EXCLUSIVE_\n  * Passing fAddToMempool=false will skip trying to add the transactions back,\n  * and instead just erase from the mempool as needed.\n  */\n-\n-static void UpdateMempoolForReorg(CChainState& active_chainstate, CTxMemPool& mempool, DisconnectedBlockTransactions& disconnectpool, bool fAddToMempool) EXCLUSIVE_LOCKS_REQUIRED(cs_main, mempool.cs)\n+void CChainState::UpdateMempoolForReorg(\n+    CChainState& active_chainstate,",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 7,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "7cdcd08d665570167b06a93e003369f7fa833cec",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Good catch, thanks. Always weary to assume active_chainstate == *this, but in this case (as you probably realized) only the active ever has a mempool, so it's a fine substitution.",
    "created_at": "2021-07-09T18:49:27Z",
    "updated_at": "2021-07-09T18:49:27Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r667148994",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667148994"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r667148994"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667148994/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 346,
    "side": "RIGHT",
    "in_reply_to_id": 667134941
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667711900",
    "pull_request_review_id": 703825628,
    "id": 667711900,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NzcxMTkwMA==",
    "diff_hunk": "@@ -2280,15 +2283,15 @@ bool CChainState::DisconnectTip(BlockValidationState& state, DisconnectedBlockTr\n         return false;\n     }\n \n-    if (disconnectpool) {\n+    if (disconnectpool && m_mempool) {\n         // Save transactions to re-add to mempool at end of reorg\n         for (auto it = block.vtx.rbegin(); it != block.vtx.rend(); ++it) {\n             disconnectpool->addTransaction(*it);\n         }\n         while (disconnectpool->DynamicMemoryUsage() > MAX_DISCONNECTED_TX_POOL_SIZE * 1000) {\n             // Drop the earliest entry, and remove its children from the mempool.\n             auto it = disconnectpool->queuedTx.get<insertion_order>().begin();\n-            m_mempool.removeRecursive(**it, MemPoolRemovalReason::REORG);\n+            if (m_mempool) m_mempool->removeRecursive(**it, MemPoolRemovalReason::REORG);",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 67,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "ad911753a1af3a10f9e74a78a066ed4f1e40ce4d",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This new `if` here is not needed, it's augmented by the check you added above (`if (disconnectpool && m_mempool) {`)? ",
    "created_at": "2021-07-12T08:02:52Z",
    "updated_at": "2021-07-12T08:04:05Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r667711900",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667711900"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r667711900"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667711900/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2294,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667716247",
    "pull_request_review_id": 703831648,
    "id": 667716247,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NzcxNjI0Nw==",
    "diff_hunk": "@@ -342,11 +342,14 @@ static bool IsCurrentForFeeEstimation(CChainState& active_chainstate) EXCLUSIVE_\n  * Passing fAddToMempool=false will skip trying to add the transactions back,\n  * and instead just erase from the mempool as needed.\n  */\n-\n-static void UpdateMempoolForReorg(CChainState& active_chainstate, CTxMemPool& mempool, DisconnectedBlockTransactions& disconnectpool, bool fAddToMempool) EXCLUSIVE_LOCKS_REQUIRED(cs_main, mempool.cs)\n+void CChainState::UpdateMempoolForReorg(",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 6,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "1e0262e04093f62b13f83da7c3b2be0b51ddbe1b",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Mixed feelings about this change. I like params reduction, but I think a reader might get confused: \"`UpdateMempoolForReorg`? But I don't have mempool.\"\r\n\r\nI would slightly prefer changing the name to `UpdateMempoolForReorgIfExists` or `TryUpdateMempoolForReorg`, but feel free to ignore.",
    "created_at": "2021-07-12T08:09:50Z",
    "updated_at": "2021-07-12T08:10:08Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r667716247",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667716247"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r667716247"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667716247/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 345,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667833810",
    "pull_request_review_id": 703984078,
    "id": 667833810,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NzgzMzgxMA==",
    "diff_hunk": "@@ -587,8 +587,9 @@ class CChainState\n      */\n     mutable std::atomic<bool> m_cached_finished_ibd{false};\n \n-    //! mempool that is kept in sync with the chain\n-    CTxMemPool& m_mempool;\n+    //! Optional mempool that is kept in sync with the chain.\n+    //! Only the active chainstate has a mempool.\n+    CTxMemPool* m_mempool;",
    "path": "src/validation.h",
    "position": 8,
    "original_position": 8,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "e34a992baedcac7514b82fa27c2c05a720c1df3d",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This could be a const pointer:\r\n\r\n```suggestion\r\n    CTxMemPool* const m_mempool;\r\n```\r\n\r\nsince it's set in the initializer list and never modified.",
    "created_at": "2021-07-12T11:03:22Z",
    "updated_at": "2021-07-12T11:09:24Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r667833810",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667833810"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r667833810"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667833810/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 592,
    "original_line": 592,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667837165",
    "pull_request_review_id": 703984078,
    "id": 667837165,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NzgzNzE2NQ==",
    "diff_hunk": "@@ -4763,7 +4772,7 @@ bool ChainstateManager::ActivateSnapshot(\n     }\n \n     auto snapshot_chainstate = WITH_LOCK(::cs_main, return std::make_unique<CChainState>(\n-            this->ActiveChainstate().m_mempool, m_blockman, base_blockhash));\n+            nullptr, m_blockman, base_blockhash));",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 183,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "b17bb4c37d58ca49e877983a632bfcaa493be993",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I was also surprised by this. Is the snapshot chainstate the one that eventually becomes our tip? In that case, don't we want it to have a mempool?",
    "created_at": "2021-07-12T11:09:24Z",
    "updated_at": "2021-07-12T11:09:24Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r667837165",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667837165"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r667837165"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667837165/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4775,
    "side": "RIGHT",
    "in_reply_to_id": 666275700
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667838641",
    "pull_request_review_id": 703990431,
    "id": 667838641,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NzgzODY0MQ==",
    "diff_hunk": "@@ -329,7 +329,8 @@ static bool IsCurrentForFeeEstimation(CChainState& active_chainstate) EXCLUSIVE_\n     return true;\n }\n \n-/* Make mempool consistent after a reorg, by re-adding or recursively erasing\n+/**",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "e34a992baedcac7514b82fa27c2c05a720c1df3d",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: doxygen function comments should go with the function declaration. Do you mind moving this to the header file now that the declaration is there?",
    "created_at": "2021-07-12T11:11:51Z",
    "updated_at": "2021-07-12T11:18:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r667838641",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667838641"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r667838641"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667838641/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 332,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667842272",
    "pull_request_review_id": 703990431,
    "id": 667842272,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Nzg0MjI3Mg==",
    "diff_hunk": "@@ -798,6 +797,20 @@ class CChainState\n \n     bool LoadBlockIndexDB() EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    //! Indirection necessary to make lock annotations work with an optional mempool.\n+    RecursiveMutex* MempoolMutex() const LOCK_RETURNED(m_mempool->cs)\n+    {\n+        return m_mempool ? &m_mempool->cs : nullptr;\n+    }\n+\n+    void UpdateMempoolForReorg(\n+        DisconnectedBlockTransactions& disconnectpool,\n+        bool fAddToMempool) EXCLUSIVE_LOCKS_REQUIRED(cs_main, m_mempool->cs);\n+\n+    /** Check warning conditions and do some notifications on new chain tip set. */\n+    void UpdateTip(const CBlockIndex* pindexNew, CChainState& active_chainstate)",
    "path": "src/validation.h",
    "position": null,
    "original_position": 68,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "e34a992baedcac7514b82fa27c2c05a720c1df3d",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "No need for the `CChainState& active_chainstate` argument - this is a private method in `CChainState` where the `active_chainstate` arg is always `*this`. You can remove the argument and use the implicit `this` inside the function.",
    "created_at": "2021-07-12T11:18:06Z",
    "updated_at": "2021-07-12T11:18:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r667842272",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667842272"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r667842272"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667842272/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 811,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668111707",
    "pull_request_review_id": 704355399,
    "id": 668111707,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2ODExMTcwNw==",
    "diff_hunk": "@@ -4763,7 +4772,7 @@ bool ChainstateManager::ActivateSnapshot(\n     }\n \n     auto snapshot_chainstate = WITH_LOCK(::cs_main, return std::make_unique<CChainState>(\n-            this->ActiveChainstate().m_mempool, m_blockman, base_blockhash));\n+            nullptr, m_blockman, base_blockhash));",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 183,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "b17bb4c37d58ca49e877983a632bfcaa493be993",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yeah, this is a little confusing absent context, but basically the idea per @ryanofsky's feedback is that mempool presence should be used to indicate chainstate activeness, so we don't want to give the snapshot chainstate a mempool until we consider it active.",
    "created_at": "2021-07-12T17:13:15Z",
    "updated_at": "2021-07-12T17:13:15Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668111707",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668111707"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668111707"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668111707/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4775,
    "side": "RIGHT",
    "in_reply_to_id": 666275700
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668113712",
    "pull_request_review_id": 704358127,
    "id": 668113712,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2ODExMzcxMg==",
    "diff_hunk": "@@ -587,8 +587,9 @@ class CChainState\n      */\n     mutable std::atomic<bool> m_cached_finished_ibd{false};\n \n-    //! mempool that is kept in sync with the chain\n-    CTxMemPool& m_mempool;\n+    //! Optional mempool that is kept in sync with the chain.\n+    //! Only the active chainstate has a mempool.\n+    CTxMemPool* m_mempool;",
    "path": "src/validation.h",
    "position": 8,
    "original_position": 8,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "e34a992baedcac7514b82fa27c2c05a720c1df3d",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "The pointer may actually be nulled out e.g. when we transition the initial IBD chainstate to the background (and give its mempool to the snapshot chainstate, which becomes our active).",
    "created_at": "2021-07-12T17:16:17Z",
    "updated_at": "2021-07-12T17:16:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668113712",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668113712"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668113712"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668113712/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 592,
    "original_line": 592,
    "side": "RIGHT",
    "in_reply_to_id": 667833810
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668125115",
    "pull_request_review_id": 704373007,
    "id": 668125115,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2ODEyNTExNQ==",
    "diff_hunk": "@@ -587,8 +587,9 @@ class CChainState\n      */\n     mutable std::atomic<bool> m_cached_finished_ibd{false};\n \n-    //! mempool that is kept in sync with the chain\n-    CTxMemPool& m_mempool;\n+    //! Optional mempool that is kept in sync with the chain.\n+    //! Only the active chainstate has a mempool.\n+    CTxMemPool* m_mempool;",
    "path": "src/validation.h",
    "position": 8,
    "original_position": 8,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "e34a992baedcac7514b82fa27c2c05a720c1df3d",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "ah, ok! I'm not totally up to date on how the different chainstate objects work in assumeutxo.",
    "created_at": "2021-07-12T17:33:21Z",
    "updated_at": "2021-07-12T17:33:21Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668125115",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668125115"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668125115"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668125115/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 592,
    "original_line": 592,
    "side": "RIGHT",
    "in_reply_to_id": 667833810
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668143212",
    "pull_request_review_id": 704396284,
    "id": 668143212,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2ODE0MzIxMg==",
    "diff_hunk": "@@ -798,6 +797,20 @@ class CChainState\n \n     bool LoadBlockIndexDB() EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    //! Indirection necessary to make lock annotations work with an optional mempool.\n+    RecursiveMutex* MempoolMutex() const LOCK_RETURNED(m_mempool->cs)\n+    {\n+        return m_mempool ? &m_mempool->cs : nullptr;\n+    }\n+\n+    void UpdateMempoolForReorg(\n+        DisconnectedBlockTransactions& disconnectpool,\n+        bool fAddToMempool) EXCLUSIVE_LOCKS_REQUIRED(cs_main, m_mempool->cs);\n+\n+    /** Check warning conditions and do some notifications on new chain tip set. */\n+    void UpdateTip(const CBlockIndex* pindexNew, CChainState& active_chainstate)",
    "path": "src/validation.h",
    "position": null,
    "original_position": 68,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "e34a992baedcac7514b82fa27c2c05a720c1df3d",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Good call - weird, thought I had made that change... maybe lost in rebase shuffle.",
    "created_at": "2021-07-12T18:00:16Z",
    "updated_at": "2021-07-12T18:00:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668143212",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668143212"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668143212"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668143212/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 811,
    "side": "RIGHT",
    "in_reply_to_id": 667842272
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668169676",
    "pull_request_review_id": 704431511,
    "id": 668169676,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2ODE2OTY3Ng==",
    "diff_hunk": "@@ -329,7 +329,8 @@ static bool IsCurrentForFeeEstimation(CChainState& active_chainstate) EXCLUSIVE_\n     return true;\n }\n \n-/* Make mempool consistent after a reorg, by re-adding or recursively erasing\n+/**",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "e34a992baedcac7514b82fa27c2c05a720c1df3d",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Fixed, thanks!",
    "created_at": "2021-07-12T18:42:57Z",
    "updated_at": "2021-07-12T18:42:58Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668169676",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668169676"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668169676"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668169676/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 332,
    "side": "RIGHT",
    "in_reply_to_id": 667838641
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668169812",
    "pull_request_review_id": 704431670,
    "id": 668169812,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2ODE2OTgxMg==",
    "diff_hunk": "@@ -342,11 +342,14 @@ static bool IsCurrentForFeeEstimation(CChainState& active_chainstate) EXCLUSIVE_\n  * Passing fAddToMempool=false will skip trying to add the transactions back,\n  * and instead just erase from the mempool as needed.\n  */\n-\n-static void UpdateMempoolForReorg(CChainState& active_chainstate, CTxMemPool& mempool, DisconnectedBlockTransactions& disconnectpool, bool fAddToMempool) EXCLUSIVE_LOCKS_REQUIRED(cs_main, mempool.cs)\n+void CChainState::UpdateMempoolForReorg(",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 6,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "1e0262e04093f62b13f83da7c3b2be0b51ddbe1b",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Sounds good, fixed.",
    "created_at": "2021-07-12T18:43:09Z",
    "updated_at": "2021-07-12T18:43:09Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668169812",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668169812"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668169812"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668169812/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 345,
    "side": "RIGHT",
    "in_reply_to_id": 667716247
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668169895",
    "pull_request_review_id": 704431781,
    "id": 668169895,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2ODE2OTg5NQ==",
    "diff_hunk": "@@ -2280,15 +2283,15 @@ bool CChainState::DisconnectTip(BlockValidationState& state, DisconnectedBlockTr\n         return false;\n     }\n \n-    if (disconnectpool) {\n+    if (disconnectpool && m_mempool) {\n         // Save transactions to re-add to mempool at end of reorg\n         for (auto it = block.vtx.rbegin(); it != block.vtx.rend(); ++it) {\n             disconnectpool->addTransaction(*it);\n         }\n         while (disconnectpool->DynamicMemoryUsage() > MAX_DISCONNECTED_TX_POOL_SIZE * 1000) {\n             // Drop the earliest entry, and remove its children from the mempool.\n             auto it = disconnectpool->queuedTx.get<insertion_order>().begin();\n-            m_mempool.removeRecursive(**it, MemPoolRemovalReason::REORG);\n+            if (m_mempool) m_mempool->removeRecursive(**it, MemPoolRemovalReason::REORG);",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 67,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "ad911753a1af3a10f9e74a78a066ed4f1e40ce4d",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Good catch, thanks.",
    "created_at": "2021-07-12T18:43:17Z",
    "updated_at": "2021-07-12T18:43:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668169895",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668169895"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668169895"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668169895/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2294,
    "side": "RIGHT",
    "in_reply_to_id": 667711900
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668698941",
    "pull_request_review_id": 705099557,
    "id": 668698941,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2ODY5ODk0MQ==",
    "diff_hunk": "@@ -798,6 +800,33 @@ class CChainState\n \n     bool LoadBlockIndexDB() EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    //! Indirection necessary to make lock annotations work with an optional mempool.\n+    RecursiveMutex* MempoolMutex() const LOCK_RETURNED(m_mempool->cs)\n+    {\n+        return m_mempool ? &m_mempool->cs : nullptr;\n+    }\n+\n+    /**\n+     * Make mempool consistent after a reorg, by re-adding or recursively erasing\n+     * disconnected block transactions from the mempool, and also removing any\n+     * other transactions from the mempool that are no longer valid given the new\n+     * tip/height.\n+     *\n+     * Note: we assume that disconnectpool only contains transactions that are NOT\n+     * confirmed in the current chain nor already in the mempool (otherwise,\n+     * in-mempool descendants of such transactions would be removed).\n+     *\n+     * Passing fAddToMempool=false will skip trying to add the transactions back,\n+     * and instead just erase from the mempool as needed.\n+     */\n+    void TryUpdateMempoolForReorg(",
    "path": "src/validation.h",
    "position": null,
    "original_position": 79,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "c13e832af4a044a5c4beb4694022df53fa2eaf6d",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This new name seems worse to me than the original (`UpdateMempoolForReorg()`). The `Try` suggests that this operation may fail or that it's best-effort. In fact, if a mempool exists then it really will be updated to be internally consistent.",
    "created_at": "2021-07-13T12:06:10Z",
    "updated_at": "2021-07-13T12:55:36Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668698941",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668698941"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668698941"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668698941/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 822,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668701404",
    "pull_request_review_id": 705099557,
    "id": 668701404,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2ODcwMTQwNA==",
    "diff_hunk": "@@ -2218,11 +2213,11 @@ static void UpdateTip(CTxMemPool& mempool, const CBlockIndex* pindexNew, const C\n     }\n \n     bilingual_str warning_messages;\n-    if (!active_chainstate.IsInitialBlockDownload()) {\n+    if (!this->IsInitialBlockDownload()) {",
    "path": "src/validation.cpp",
    "position": 130,
    "original_position": 130,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "c13e832af4a044a5c4beb4694022df53fa2eaf6d",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "There's no need to use `this->` to call member functions. `this->` is implicitly added before the names: https://en.cppreference.com/w/cpp/language/this.",
    "created_at": "2021-07-13T12:09:46Z",
    "updated_at": "2021-07-13T12:55:36Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668701404",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668701404"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668701404"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668701404/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2216,
    "original_line": 2216,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668701559",
    "pull_request_review_id": 705099557,
    "id": 668701559,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2ODcwMTU1OQ==",
    "diff_hunk": "@@ -2237,14 +2232,14 @@ static void UpdateTip(CTxMemPool& mempool, const CBlockIndex* pindexNew, const C\n       pindexNew->GetBlockHash().ToString(), pindexNew->nHeight, pindexNew->nVersion,\n       log(pindexNew->nChainWork.getdouble())/log(2.0), (unsigned long)pindexNew->nChainTx,\n       FormatISO8601DateTime(pindexNew->GetBlockTime()),\n-      GuessVerificationProgress(chainParams.TxData(), pindexNew), active_chainstate.CoinsTip().DynamicMemoryUsage() * (1.0 / (1<<20)), active_chainstate.CoinsTip().GetCacheSize(),\n+      GuessVerificationProgress(m_params.TxData(), pindexNew), this->CoinsTip().DynamicMemoryUsage() * (1.0 / (1<<20)), this->CoinsTip().GetCacheSize(),",
    "path": "src/validation.cpp",
    "position": 144,
    "original_position": 144,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "c13e832af4a044a5c4beb4694022df53fa2eaf6d",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "As above, no need for `this->` here.",
    "created_at": "2021-07-13T12:09:58Z",
    "updated_at": "2021-07-13T12:55:36Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668701559",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668701559"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668701559"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668701559/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2235,
    "original_line": 2235,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668719890",
    "pull_request_review_id": 705099557,
    "id": 668719890,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2ODcxOTg5MA==",
    "diff_hunk": "@@ -600,7 +601,10 @@ class CChainState\n     //! CChainState instances.\n     BlockManager& m_blockman;\n \n-    explicit CChainState(CTxMemPool& mempool, BlockManager& blockman, std::optional<uint256> from_snapshot_blockhash = std::nullopt);\n+    explicit CChainState(\n+        CTxMemPool* const mempool,",
    "path": "src/validation.h",
    "position": null,
    "original_position": 18,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "c13e832af4a044a5c4beb4694022df53fa2eaf6d",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "These new `const` keywords on the `CChainstate::CChainstate` and `InitializeChainstate` arguments are harmless but unnecessary. When you're passing by value (which is what happens when you pass a pointer), making that argument const doesn't change the interface, since the argument is copied to a locally scoped parameter inside the function. It's only when passing by reference that marking arguments const matters.\r\n\r\nYou can tell that it doesn't make a difference because the function declaration here has the first arg as `CTxMemPool* const`, and the function definition in the .cpp file has `CTxMemPool*` (non const pointer). The compiler doesn't complain because the const-ness of a pass by value arg isn't part of the signature.",
    "created_at": "2021-07-13T12:35:32Z",
    "updated_at": "2021-07-13T12:55:36Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668719890",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668719890"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668719890"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668719890/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 605,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668723653",
    "pull_request_review_id": 705099557,
    "id": 668723653,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2ODcyMzY1Mw==",
    "diff_hunk": "@@ -372,12 +365,16 @@ static void UpdateMempoolForReorg(CChainState& active_chainstate, CTxMemPool& me\n     // previously-confirmed transactions back to the mempool.\n     // UpdateTransactionsFromBlock finds descendants of any transactions in\n     // the disconnectpool that were added back and cleans up the mempool state.\n-    mempool.UpdateTransactionsFromBlock(vHashUpdate);\n+    m_mempool->UpdateTransactionsFromBlock(vHashUpdate);\n \n     // We also need to remove any now-immature transactions\n-    mempool.removeForReorg(active_chainstate, STANDARD_LOCKTIME_VERIFY_FLAGS);\n+    m_mempool->removeForReorg(*this, STANDARD_LOCKTIME_VERIFY_FLAGS);\n     // Re-limit mempool size, in case we added any transactions\n-    LimitMempoolSize(mempool, active_chainstate.CoinsTip(), gArgs.GetArg(\"-maxmempool\", DEFAULT_MAX_MEMPOOL_SIZE) * 1000000, std::chrono::hours{gArgs.GetArg(\"-mempoolexpiry\", DEFAULT_MEMPOOL_EXPIRY)});\n+    LimitMempoolSize(\n+        *m_mempool,\n+        this->CoinsTip(),",
    "path": "src/validation.cpp",
    "position": 61,
    "original_position": 61,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "c13e832af4a044a5c4beb4694022df53fa2eaf6d",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "No need for `this->`",
    "created_at": "2021-07-13T12:40:49Z",
    "updated_at": "2021-07-13T12:55:36Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668723653",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668723653"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668723653"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668723653/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 375,
    "original_line": 375,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668725963",
    "pull_request_review_id": 705099557,
    "id": 668725963,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2ODcyNTk2Mw==",
    "diff_hunk": "@@ -20,7 +20,7 @@ BOOST_AUTO_TEST_CASE(getcoinscachesizestate)\n {\n     CTxMemPool mempool;\n     BlockManager blockman{};\n-    CChainState chainstate{mempool, blockman};\n+    CChainState chainstate{&mempool, blockman};",
    "path": "src/test/validation_flush_tests.cpp",
    "position": 5,
    "original_position": 5,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "c13e832af4a044a5c4beb4694022df53fa2eaf6d",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Any idea why there's a different `tx_pool` from `mempool` in this test? It's not used anywhere so presumably can be removed?",
    "created_at": "2021-07-13T12:43:44Z",
    "updated_at": "2021-07-13T12:55:36Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668725963",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668725963"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668725963"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668725963/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 23,
    "original_line": 23,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668761642",
    "pull_request_review_id": 705184542,
    "id": 668761642,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2ODc2MTY0Mg==",
    "diff_hunk": "@@ -2218,11 +2213,11 @@ static void UpdateTip(CTxMemPool& mempool, const CBlockIndex* pindexNew, const C\n     }\n \n     bilingual_str warning_messages;\n-    if (!active_chainstate.IsInitialBlockDownload()) {\n+    if (!this->IsInitialBlockDownload()) {",
    "path": "src/validation.cpp",
    "position": 130,
    "original_position": 130,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "c13e832af4a044a5c4beb4694022df53fa2eaf6d",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I prefer the `this->` prefix to be explicit about a member function call; last time I talked about this with others it was uncontroversial.",
    "created_at": "2021-07-13T13:26:16Z",
    "updated_at": "2021-07-13T13:26:16Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668761642",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668761642"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668761642"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668761642/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2216,
    "original_line": 2216,
    "side": "RIGHT",
    "in_reply_to_id": 668701404
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668765914",
    "pull_request_review_id": 705190391,
    "id": 668765914,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2ODc2NTkxNA==",
    "diff_hunk": "@@ -600,7 +601,10 @@ class CChainState\n     //! CChainState instances.\n     BlockManager& m_blockman;\n \n-    explicit CChainState(CTxMemPool& mempool, BlockManager& blockman, std::optional<uint256> from_snapshot_blockhash = std::nullopt);\n+    explicit CChainState(\n+        CTxMemPool* const mempool,",
    "path": "src/validation.h",
    "position": null,
    "original_position": 18,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "c13e832af4a044a5c4beb4694022df53fa2eaf6d",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Right but at least this makes it clear that we aren't going to do any pointer arithmetic on `mempool` in the body of the function, right?",
    "created_at": "2021-07-13T13:30:59Z",
    "updated_at": "2021-07-13T13:30:59Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668765914",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668765914"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668765914"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668765914/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 605,
    "side": "RIGHT",
    "in_reply_to_id": 668719890
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668775580",
    "pull_request_review_id": 705204038,
    "id": 668775580,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2ODc3NTU4MA==",
    "diff_hunk": "@@ -798,6 +800,33 @@ class CChainState\n \n     bool LoadBlockIndexDB() EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    //! Indirection necessary to make lock annotations work with an optional mempool.\n+    RecursiveMutex* MempoolMutex() const LOCK_RETURNED(m_mempool->cs)\n+    {\n+        return m_mempool ? &m_mempool->cs : nullptr;\n+    }\n+\n+    /**\n+     * Make mempool consistent after a reorg, by re-adding or recursively erasing\n+     * disconnected block transactions from the mempool, and also removing any\n+     * other transactions from the mempool that are no longer valid given the new\n+     * tip/height.\n+     *\n+     * Note: we assume that disconnectpool only contains transactions that are NOT\n+     * confirmed in the current chain nor already in the mempool (otherwise,\n+     * in-mempool descendants of such transactions would be removed).\n+     *\n+     * Passing fAddToMempool=false will skip trying to add the transactions back,\n+     * and instead just erase from the mempool as needed.\n+     */\n+    void TryUpdateMempoolForReorg(",
    "path": "src/validation.h",
    "position": null,
    "original_position": 79,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "c13e832af4a044a5c4beb4694022df53fa2eaf6d",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "If you felt this way it would have been helpful for you to chime in on @naumenkogs's original comment; doing commits back and forth on relatively cosmetic things like method names is not a good use of energy.",
    "created_at": "2021-07-13T13:42:07Z",
    "updated_at": "2021-07-13T13:42:07Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668775580",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668775580"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668775580"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668775580/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 822,
    "side": "RIGHT",
    "in_reply_to_id": 668698941
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668787380",
    "pull_request_review_id": 705220221,
    "id": 668787380,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2ODc4NzM4MA==",
    "diff_hunk": "@@ -20,7 +20,7 @@ BOOST_AUTO_TEST_CASE(getcoinscachesizestate)\n {\n     CTxMemPool mempool;\n     BlockManager blockman{};\n-    CChainState chainstate{mempool, blockman};\n+    CChainState chainstate{&mempool, blockman};",
    "path": "src/test/validation_flush_tests.cpp",
    "position": 5,
    "original_position": 5,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "c13e832af4a044a5c4beb4694022df53fa2eaf6d",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yep, looks like it. I think when I wrote these I wanted to cover the fact that you could pass in a mempool reference that wasn't owned by the chainstate, but I don't think there's any point in doing that now.",
    "created_at": "2021-07-13T13:55:03Z",
    "updated_at": "2021-07-13T13:55:03Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668787380",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668787380"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668787380"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668787380/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 23,
    "original_line": 23,
    "side": "RIGHT",
    "in_reply_to_id": 668725963
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668789480",
    "pull_request_review_id": 705223101,
    "id": 668789480,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2ODc4OTQ4MA==",
    "diff_hunk": "@@ -2218,11 +2213,11 @@ static void UpdateTip(CTxMemPool& mempool, const CBlockIndex* pindexNew, const C\n     }\n \n     bilingual_str warning_messages;\n-    if (!active_chainstate.IsInitialBlockDownload()) {\n+    if (!this->IsInitialBlockDownload()) {",
    "path": "src/validation.cpp",
    "position": 130,
    "original_position": 130,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "c13e832af4a044a5c4beb4694022df53fa2eaf6d",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Curious. I've never come across this style before.",
    "created_at": "2021-07-13T13:57:19Z",
    "updated_at": "2021-07-13T13:57:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668789480",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668789480"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668789480"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668789480/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2216,
    "original_line": 2216,
    "side": "RIGHT",
    "in_reply_to_id": 668701404
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668792472",
    "pull_request_review_id": 705227300,
    "id": 668792472,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2ODc5MjQ3Mg==",
    "diff_hunk": "@@ -600,7 +601,10 @@ class CChainState\n     //! CChainState instances.\n     BlockManager& m_blockman;\n \n-    explicit CChainState(CTxMemPool& mempool, BlockManager& blockman, std::optional<uint256> from_snapshot_blockhash = std::nullopt);\n+    explicit CChainState(\n+        CTxMemPool* const mempool,",
    "path": "src/validation.h",
    "position": null,
    "original_position": 18,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "c13e832af4a044a5c4beb4694022df53fa2eaf6d",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> this makes it clear that we aren't going to do any pointer arithmetic on mempool\r\n\r\n`mempool` inside the function is a copy of the pointer, and so whether or not it's mutated is not part of the contract with the caller, and so doesn't need to be in the function declaration. Like I said it's harmless, but you'll see that there are almost no examples in the code of pass by value parameters being marked const.",
    "created_at": "2021-07-13T14:00:33Z",
    "updated_at": "2021-07-13T14:00:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668792472",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668792472"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668792472"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668792472/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 605,
    "side": "RIGHT",
    "in_reply_to_id": 668719890
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668812004",
    "pull_request_review_id": 705254441,
    "id": 668812004,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2ODgxMjAwNA==",
    "diff_hunk": "@@ -798,6 +800,33 @@ class CChainState\n \n     bool LoadBlockIndexDB() EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    //! Indirection necessary to make lock annotations work with an optional mempool.\n+    RecursiveMutex* MempoolMutex() const LOCK_RETURNED(m_mempool->cs)\n+    {\n+        return m_mempool ? &m_mempool->cs : nullptr;\n+    }\n+\n+    /**\n+     * Make mempool consistent after a reorg, by re-adding or recursively erasing\n+     * disconnected block transactions from the mempool, and also removing any\n+     * other transactions from the mempool that are no longer valid given the new\n+     * tip/height.\n+     *\n+     * Note: we assume that disconnectpool only contains transactions that are NOT\n+     * confirmed in the current chain nor already in the mempool (otherwise,\n+     * in-mempool descendants of such transactions would be removed).\n+     *\n+     * Passing fAddToMempool=false will skip trying to add the transactions back,\n+     * and instead just erase from the mempool as needed.\n+     */\n+    void TryUpdateMempoolForReorg(",
    "path": "src/validation.h",
    "position": null,
    "original_position": 79,
    "commit_id": "ceb7b35a39145717e2d9d356fd382bd1f95d2a5a",
    "original_commit_id": "c13e832af4a044a5c4beb4694022df53fa2eaf6d",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Sorry - I didn't see the original comment. Ultimately it's up to you what you put in your PR. I don't think that renaming this function is necessary, and is actually worse for the reasons I gave here, but if other people prefer the new name, that's also fine!",
    "created_at": "2021-07-13T14:20:59Z",
    "updated_at": "2021-07-13T14:20:59Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668812004",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668812004"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22415#discussion_r668812004"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22415"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668812004/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 822,
    "side": "RIGHT",
    "in_reply_to_id": 668698941
  }
]