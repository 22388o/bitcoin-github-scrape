[
  {
    "sha": "a92d9ce8cf355e18e43e1f207e4be9e42e7ec81a",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzphOTJkOWNlOGNmMzU1ZTE4ZTQzZTFmMjA3ZTRiZTllNDJlN2VjODFh",
    "commit": {
      "author": {
        "name": "Gregory Sanders",
        "email": "gsanders87@gmail.com",
        "date": "2019-05-09T20:31:57Z"
      },
      "committer": {
        "name": "Gregory Sanders",
        "email": "gsanders87@gmail.com",
        "date": "2019-07-26T18:09:03Z"
      },
      "message": "deprecate totalFee argument in bumpfee RPC call",
      "tree": {
        "sha": "57d81e6bc1ed406612b680e5a2a99025740ac4af",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/57d81e6bc1ed406612b680e5a2a99025740ac4af"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a92d9ce8cf355e18e43e1f207e4be9e42e7ec81a",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a92d9ce8cf355e18e43e1f207e4be9e42e7ec81a",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/a92d9ce8cf355e18e43e1f207e4be9e42e7ec81a",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a92d9ce8cf355e18e43e1f207e4be9e42e7ec81a/comments",
    "author": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "4fcccdac785e09ad5627b3bf4811dfba353693e8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4fcccdac785e09ad5627b3bf4811dfba353693e8",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/4fcccdac785e09ad5627b3bf4811dfba353693e8"
      }
    ],
    "stats": {
      "total": 10,
      "additions": 7,
      "deletions": 3
    },
    "files": [
      {
        "sha": "6e724507925891625482060ab253031140a6d3cc",
        "filename": "src/wallet/rpcwallet.cpp",
        "status": "modified",
        "additions": 6,
        "deletions": 3,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/a92d9ce8cf355e18e43e1f207e4be9e42e7ec81a/src/wallet/rpcwallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/a92d9ce8cf355e18e43e1f207e4be9e42e7ec81a/src/wallet/rpcwallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcwallet.cpp?ref=a92d9ce8cf355e18e43e1f207e4be9e42e7ec81a",
        "patch": "@@ -3257,20 +3257,20 @@ static UniValue bumpfee(const JSONRPCRequest& request)\n                 \"\\nBumps the fee of an opt-in-RBF transaction T, replacing it with a new transaction B.\\n\"\n                 \"An opt-in RBF transaction with the given txid must be in the wallet.\\n\"\n                 \"The command will pay the additional fee by reducing change outputs or adding inputs when necessary. It may add a new change output if one does not already exist.\\n\"\n-                \"If `totalFee` is given, adding inputs is not supported, so there must be a single change output that is big enough or it will fail.\\n\"\n+                \"If `totalFee` (DEPRECATED) is given, adding inputs is not supported, so there must be a single change output that is big enough or it will fail.\\n\"\n                 \"All inputs in the original transaction will be included in the replacement transaction.\\n\"\n                 \"The command will fail if the wallet or mempool contains a transaction that spends one of T's outputs.\\n\"\n                 \"By default, the new fee will be calculated automatically using estimatesmartfee.\\n\"\n                 \"The user can specify a confirmation target for estimatesmartfee.\\n\"\n-                \"Alternatively, the user can specify totalFee, or use RPC settxfee to set a higher fee rate.\\n\"\n+                \"Alternatively, the user can specify totalFee (DEPRECATED), or use RPC settxfee to set a higher fee rate.\\n\"\n                 \"At a minimum, the new fee rate must be high enough to pay an additional new relay fee (incrementalfee\\n\"\n                 \"returned by getnetworkinfo) to enter the node's mempool.\\n\",\n                 {\n                     {\"txid\", RPCArg::Type::STR_HEX, RPCArg::Optional::NO, \"The txid to be bumped\"},\n                     {\"options\", RPCArg::Type::OBJ, RPCArg::Optional::OMITTED_NAMED_ARG, \"\",\n                         {\n                             {\"confTarget\", RPCArg::Type::NUM, /* default */ \"fallback to wallet's default\", \"Confirmation target (in blocks)\"},\n-                            {\"totalFee\", RPCArg::Type::NUM, /* default */ \"fallback to 'confTarget'\", \"Total fee (NOT feerate) to pay, in satoshis.\\n\"\n+                            {\"totalFee\", RPCArg::Type::NUM, /* default */ \"fallback to 'confTarget'\", \"Total fee (NOT feerate) to pay, in satoshis. (DEPRECATED)\\n\"\n             \"                         In rare cases, the actual fee paid might be slightly higher than the specified\\n\"\n             \"                         totalFee if the tx change output has to be removed because it is too close to\\n\"\n             \"                         the dust threshold.\"},\n@@ -3325,6 +3325,9 @@ static UniValue bumpfee(const JSONRPCRequest& request)\n         } else if (options.exists(\"confTarget\")) { // TODO: alias this to conf_target\n             coin_control.m_confirm_target = ParseConfirmTarget(options[\"confTarget\"], pwallet->chain().estimateMaxBlocks());\n         } else if (options.exists(\"totalFee\")) {\n+            if (!pwallet->chain().rpcEnableDeprecated(\"totalFee\")) {\n+                throw JSONRPCError(RPC_INVALID_PARAMETER, \"totalFee argument has been deprecated and will be removed in 0.20. Please use -deprecatedrpc=totalFee to continue using this argument until removal.\");\n+            }\n             totalFee = options[\"totalFee\"].get_int64();\n             if (totalFee <= 0) {\n                 throw JSONRPCError(RPC_INVALID_PARAMETER, strprintf(\"Invalid totalFee %s (must be greater than 0)\", FormatMoney(totalFee)));"
      },
      {
        "sha": "bfc01e3f5eb46fc8a0c45e1550e5e2dcd4a28a5b",
        "filename": "test/functional/wallet_bumpfee.py",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/a92d9ce8cf355e18e43e1f207e4be9e42e7ec81a/test/functional/wallet_bumpfee.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/a92d9ce8cf355e18e43e1f207e4be9e42e7ec81a/test/functional/wallet_bumpfee.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/wallet_bumpfee.py?ref=a92d9ce8cf355e18e43e1f207e4be9e42e7ec81a",
        "patch": "@@ -37,6 +37,7 @@ def set_test_params(self):\n         self.extra_args = [[\n             \"-walletrbf={}\".format(i),\n             \"-mintxfee=0.00002\",\n+            \"-deprecatedrpc=totalFee\",\n         ] for i in range(self.num_nodes)]\n \n     def skip_test_if_missing_module(self):"
      }
    ]
  },
  {
    "sha": "2f7eb772f6250442d4a0071318047cb2deeb31fa",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyZjdlYjc3MmY2MjUwNDQyZDRhMDA3MTMxODA0N2NiMmRlZWIzMWZh",
    "commit": {
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2019-05-13T08:09:57Z"
      },
      "committer": {
        "name": "Gregory Sanders",
        "email": "gsanders87@gmail.com",
        "date": "2019-07-26T18:09:03Z"
      },
      "message": "Add RPC bumpfee totalFee deprecation test\n\nNext steps: remove `totalFee` from the wallet_bumpfee functional tests.",
      "tree": {
        "sha": "939da48c55d76c1a033e5dac2fb0061f78a8f642",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/939da48c55d76c1a033e5dac2fb0061f78a8f642"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2f7eb772f6250442d4a0071318047cb2deeb31fa",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2f7eb772f6250442d4a0071318047cb2deeb31fa",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/2f7eb772f6250442d4a0071318047cb2deeb31fa",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2f7eb772f6250442d4a0071318047cb2deeb31fa/comments",
    "author": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "a92d9ce8cf355e18e43e1f207e4be9e42e7ec81a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a92d9ce8cf355e18e43e1f207e4be9e42e7ec81a",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/a92d9ce8cf355e18e43e1f207e4be9e42e7ec81a"
      }
    ],
    "stats": {
      "total": 55,
      "additions": 55,
      "deletions": 0
    },
    "files": [
      {
        "sha": "d83df5de3e6b63b7c37f683a7b29ed8a79700ac5",
        "filename": "test/functional/test_runner.py",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2f7eb772f6250442d4a0071318047cb2deeb31fa/test/functional/test_runner.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2f7eb772f6250442d4a0071318047cb2deeb31fa/test/functional/test_runner.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/test_runner.py?ref=2f7eb772f6250442d4a0071318047cb2deeb31fa",
        "patch": "@@ -173,6 +173,7 @@\n     'rpc_bind.py --nonloopback',\n     'mining_basic.py',\n     'wallet_bumpfee.py',\n+    'wallet_bumpfee_totalfee_deprecation.py',\n     'rpc_named_arguments.py',\n     'wallet_listsinceblock.py',\n     'p2p_leak.py',"
      },
      {
        "sha": "b8e097c32e9b0b5eaa7d135718b940c81471fb68",
        "filename": "test/functional/wallet_bumpfee_totalfee_deprecation.py",
        "status": "added",
        "additions": 54,
        "deletions": 0,
        "changes": 54,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2f7eb772f6250442d4a0071318047cb2deeb31fa/test/functional/wallet_bumpfee_totalfee_deprecation.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2f7eb772f6250442d4a0071318047cb2deeb31fa/test/functional/wallet_bumpfee_totalfee_deprecation.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/wallet_bumpfee_totalfee_deprecation.py?ref=2f7eb772f6250442d4a0071318047cb2deeb31fa",
        "patch": "@@ -0,0 +1,54 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2019 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test deprecation of passing `totalFee` to the bumpfee RPC.\"\"\"\n+from decimal import Decimal\n+\n+from test_framework.messages import BIP125_SEQUENCE_NUMBER\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_raises_rpc_error\n+\n+class BumpFeeWithTotalFeeArgumentDeprecationTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+        self.extra_args = [[\n+            \"-walletrbf={}\".format(i),\n+            \"-mintxfee=0.00002\",\n+        ] for i in range(self.num_nodes)]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        peer_node, rbf_node = self.nodes\n+        peer_node.generate(110)\n+        self.sync_all()\n+        peer_node.sendtoaddress(rbf_node.getnewaddress(), 0.001)\n+        self.sync_all()\n+        peer_node.generate(1)\n+        self.sync_all()\n+        rbfid = spend_one_input(rbf_node, peer_node.getnewaddress())\n+\n+        self.log.info(\"Testing bumpfee with totalFee argument raises RPC error with deprecation message\")\n+        assert_raises_rpc_error(\n+            -8,\n+            \"totalFee argument has been deprecated and will be removed in 0.20. \" +\n+            \"Please use -deprecatedrpc=totalFee to continue using this argument until removal.\",\n+            rbf_node.bumpfee, rbfid, {\"totalFee\": 2000})\n+\n+        self.log.info(\"Testing bumpfee without totalFee argument does not raise\")\n+        rbf_node.bumpfee(rbfid)\n+\n+def spend_one_input(node, dest_address, change_size=Decimal(\"0.00049000\")):\n+    tx_input = dict(sequence=BIP125_SEQUENCE_NUMBER,\n+                    **next(u for u in node.listunspent() if u[\"amount\"] == Decimal(\"0.00100000\")))\n+    destinations = {dest_address: Decimal(\"0.00050000\")}\n+    destinations[node.getrawchangeaddress()] = change_size\n+    rawtx = node.createrawtransaction([tx_input], destinations)\n+    signedtx = node.signrawtransactionwithwallet(rawtx)\n+    txid = node.sendrawtransaction(signedtx[\"hex\"])\n+    return txid\n+\n+if __name__ == \"__main__\":\n+    BumpFeeWithTotalFeeArgumentDeprecationTest().main()"
      }
    ]
  }
]