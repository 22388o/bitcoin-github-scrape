promag,2017-10-31T14:44:14Z,"ACK 3ab545d.\n\nI think all `CAddrMan` members should be guarded by `cs`, so LGTM as it is:\nhttps://github.com/bitcoin/bitcoin/blob/8335cb478183d800e274f6e96f9d7269ae584220/src/addrman.h#L184-L186",https://github.com/bitcoin/bitcoin/pull/11585#issuecomment-340784537,340784537,
practicalswift,2017-10-31T15:45:10Z,"Thanks for the quick review @promag!\n\n@promag, you mean that all of the following should be guarded by `cs`? If so I think we might be missing some additional locks. Let me know and I'll investigate.\n\n```\n    //! last used nId\n    int nIdCount;\n\n    //! table with information about all nIds\n    std::map<int, CAddrInfo> mapInfo;\n\n    //! find an nId based on its network addres",https://github.com/bitcoin/bitcoin/pull/11585#issuecomment-340805016,340805016,
promag,2017-10-31T15:50:30Z,That is what https://github.com/bitcoin/bitcoin/blob/8335cb478183d800e274f6e96f9d7269ae584220/src/addrman.h#L185 says. It seems public methods do lock `cs`.,https://github.com/bitcoin/bitcoin/pull/11585#issuecomment-340806831,340806831,
practicalswift,2017-10-31T16:00:48Z,@promag I'll investigate! :-),https://github.com/bitcoin/bitcoin/pull/11585#issuecomment-340810414,340810414,
practicalswift,2017-10-31T16:41:36Z,@promag You're right! The locking seems to be correct for the other `CAddrMan` members. Thanks!,https://github.com/bitcoin/bitcoin/pull/11585#issuecomment-340824070,340824070,
theuni,2017-11-01T20:32:09Z,"utACK 3ab545d7f8e979e2cabeff6f5f6f1afe94a5c195. I believe the intention is for all public methods to lock the cs, and the privates ones don't need to. That would imply that all vars should be covered under the cs.",https://github.com/bitcoin/bitcoin/pull/11585#issuecomment-341233218,341233218,
TheBlueMatt,2017-11-06T19:06:14Z,utACK 3ab545d7f8e979e2cabeff6f5f6f1afe94a5c195,https://github.com/bitcoin/bitcoin/pull/11585#issuecomment-342251980,342251980,
