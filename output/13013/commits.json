[
  {
    "sha": "962d223e5c22c905d682289b0c489c603983bc4f",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5NjJkMjIzZTVjMjJjOTA1ZDY4MjI4OWIwYzQ4OWM2MDM5ODNiYzRm",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2018-04-17T23:15:46Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2018-04-17T23:51:20Z"
      },
      "message": "bench: Move constructors out of mempool_eviction hot loop",
      "tree": {
        "sha": "fb4b1143a284e3a80a0c04f1bdad667b26e0c094",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/fb4b1143a284e3a80a0c04f1bdad667b26e0c094"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/962d223e5c22c905d682289b0c489c603983bc4f",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/962d223e5c22c905d682289b0c489c603983bc4f",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/962d223e5c22c905d682289b0c489c603983bc4f",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/962d223e5c22c905d682289b0c489c603983bc4f/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "6b46288a0853621bc911c26bb87bba22521059e7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6b46288a0853621bc911c26bb87bba22521059e7",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/6b46288a0853621bc911c26bb87bba22521059e7"
      }
    ],
    "stats": {
      "total": 30,
      "additions": 19,
      "deletions": 11
    },
    "files": [
      {
        "sha": "55507146cff5a01ba1c7878c72369e6e73d64f43",
        "filename": "src/bench/mempool_eviction.cpp",
        "status": "modified",
        "additions": 19,
        "deletions": 11,
        "changes": 30,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/962d223e5c22c905d682289b0c489c603983bc4f/src/bench/mempool_eviction.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/962d223e5c22c905d682289b0c489c603983bc4f/src/bench/mempool_eviction.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bench/mempool_eviction.cpp?ref=962d223e5c22c905d682289b0c489c603983bc4f",
        "patch": "@@ -9,16 +9,16 @@\n #include <list>\n #include <vector>\n \n-static void AddTx(const CMutableTransaction& tx, const CAmount& nFee, CTxMemPool& pool)\n+static void AddTx(const CTransactionRef& tx, const CAmount& nFee, CTxMemPool& pool)\n {\n     int64_t nTime = 0;\n     unsigned int nHeight = 1;\n     bool spendsCoinbase = false;\n     unsigned int sigOpCost = 4;\n     LockPoints lp;\n-    pool.addUnchecked(tx.GetHash(), CTxMemPoolEntry(\n-                                        MakeTransactionRef(tx), nFee, nTime, nHeight,\n-                                        spendsCoinbase, sigOpCost, lp));\n+    pool.addUnchecked(tx->GetHash(), CTxMemPoolEntry(\n+                                         tx, nFee, nTime, nHeight,\n+                                         spendsCoinbase, sigOpCost, lp));\n }\n \n // Right now this is only testing eviction performance in an extremely small\n@@ -97,15 +97,23 @@ static void MempoolEviction(benchmark::State& state)\n     tx7.vout[1].nValue = 10 * COIN;\n \n     CTxMemPool pool;\n+    // Create transaction references outside the \"hot loop\"\n+    const CTransactionRef tx1_r{MakeTransactionRef(tx1)};\n+    const CTransactionRef tx2_r{MakeTransactionRef(tx2)};\n+    const CTransactionRef tx3_r{MakeTransactionRef(tx3)};\n+    const CTransactionRef tx4_r{MakeTransactionRef(tx4)};\n+    const CTransactionRef tx5_r{MakeTransactionRef(tx5)};\n+    const CTransactionRef tx6_r{MakeTransactionRef(tx6)};\n+    const CTransactionRef tx7_r{MakeTransactionRef(tx7)};\n \n     while (state.KeepRunning()) {\n-        AddTx(tx1, 10000LL, pool);\n-        AddTx(tx2, 5000LL, pool);\n-        AddTx(tx3, 20000LL, pool);\n-        AddTx(tx4, 7000LL, pool);\n-        AddTx(tx5, 1000LL, pool);\n-        AddTx(tx6, 1100LL, pool);\n-        AddTx(tx7, 9000LL, pool);\n+        AddTx(tx1_r, 10000LL, pool);\n+        AddTx(tx2_r, 5000LL, pool);\n+        AddTx(tx3_r, 20000LL, pool);\n+        AddTx(tx4_r, 7000LL, pool);\n+        AddTx(tx5_r, 1000LL, pool);\n+        AddTx(tx6_r, 1100LL, pool);\n+        AddTx(tx7_r, 9000LL, pool);\n         pool.TrimToSize(pool.DynamicMemoryUsage() * 3 / 4);\n         pool.TrimToSize(GetVirtualTransactionSize(tx1));\n     }"
      }
    ]
  },
  {
    "sha": "fa3bb183adaf086a70fbbe2bb1981f471a3281ce",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYTNiYjE4M2FkYWYwODZhNzBmYmJlMmJiMTk4MWY0NzFhMzI4MWNl",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2018-04-17T23:33:01Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2018-04-17T23:51:47Z"
      },
      "message": "bench: Amend mempool_eviction test for witness txs",
      "tree": {
        "sha": "0781c8a5366ccf7cc341aae40e04f0a76c4d6537",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0781c8a5366ccf7cc341aae40e04f0a76c4d6537"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fa3bb183adaf086a70fbbe2bb1981f471a3281ce",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGcBAABCgAGBQJa1oiTAAoJEM4rdWl+aaVIz58MAKEusB++Fy3grlmbwh1zjrfh\ndlvxnO5wKol/YbfhkkTIRsTmzNAdAwoH7O05ZLipSjtYkH5gIpX6v8uYEnyCWELn\n8hXJgeEpX2E2+YKpEHQEqOReFSbDmoMq/99609fQUQlEHxwS/NPNT+QDZifYjWig\n6Y1eQPhtsV5Ah4nu8536PrBXnrVS6tzJ5qtmymJVyJ7wlcC14xHP5bWOUtVgIZLM\nZUO7/C3EjudzQia9AwmvI4P47N0dFYQDjeVbwGYkBrK4NAy0z2Yeb/K9WcgErvFc\nZ2qKWQCAv/lRSPUwbptcS/7FzoKRalbZtPQS/HdiPytDJcj9jiaEnQZ7MGTVFDLL\nwzQv8YDSBz5MhOx2dkYLChSJHLuH45oq2Tybv4v7FXHWmPhhEKFvNdw1F2YcDTTy\n04wlswq8O+QccAE8a4p5jEnpFxVmAAssco5yoqknWJqW3FcceVkmze2dygO1KbOm\nEWjxAGsUw0Xo7cpk8Jlo5gNb9BlBqJsDjngSKY/73w==\n=MzEZ\n-----END PGP SIGNATURE-----",
        "payload": "tree 0781c8a5366ccf7cc341aae40e04f0a76c4d6537\nparent 962d223e5c22c905d682289b0c489c603983bc4f\nauthor MarcoFalke <falke.marco@gmail.com> 1524007981 -0400\ncommitter MarcoFalke <falke.marco@gmail.com> 1524009107 -0400\n\nbench: Amend mempool_eviction test for witness txs\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa3bb183adaf086a70fbbe2bb1981f471a3281ce",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fa3bb183adaf086a70fbbe2bb1981f471a3281ce",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa3bb183adaf086a70fbbe2bb1981f471a3281ce/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "962d223e5c22c905d682289b0c489c603983bc4f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/962d223e5c22c905d682289b0c489c603983bc4f",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/962d223e5c22c905d682289b0c489c603983bc4f"
      }
    ],
    "stats": {
      "total": 11,
      "additions": 11,
      "deletions": 0
    },
    "files": [
      {
        "sha": "4c947a519fcf7161f1e72f2d8d0422a6fa8c3ed5",
        "filename": "src/bench/mempool_eviction.cpp",
        "status": "modified",
        "additions": 11,
        "deletions": 0,
        "changes": 11,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa3bb183adaf086a70fbbe2bb1981f471a3281ce/src/bench/mempool_eviction.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa3bb183adaf086a70fbbe2bb1981f471a3281ce/src/bench/mempool_eviction.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bench/mempool_eviction.cpp?ref=fa3bb183adaf086a70fbbe2bb1981f471a3281ce",
        "patch": "@@ -29,13 +29,15 @@ static void MempoolEviction(benchmark::State& state)\n     CMutableTransaction tx1 = CMutableTransaction();\n     tx1.vin.resize(1);\n     tx1.vin[0].scriptSig = CScript() << OP_1;\n+    tx1.vin[0].scriptWitness.stack.push_back({1});\n     tx1.vout.resize(1);\n     tx1.vout[0].scriptPubKey = CScript() << OP_1 << OP_EQUAL;\n     tx1.vout[0].nValue = 10 * COIN;\n \n     CMutableTransaction tx2 = CMutableTransaction();\n     tx2.vin.resize(1);\n     tx2.vin[0].scriptSig = CScript() << OP_2;\n+    tx2.vin[0].scriptWitness.stack.push_back({2});\n     tx2.vout.resize(1);\n     tx2.vout[0].scriptPubKey = CScript() << OP_2 << OP_EQUAL;\n     tx2.vout[0].nValue = 10 * COIN;\n@@ -44,6 +46,7 @@ static void MempoolEviction(benchmark::State& state)\n     tx3.vin.resize(1);\n     tx3.vin[0].prevout = COutPoint(tx2.GetHash(), 0);\n     tx3.vin[0].scriptSig = CScript() << OP_2;\n+    tx3.vin[0].scriptWitness.stack.push_back({3});\n     tx3.vout.resize(1);\n     tx3.vout[0].scriptPubKey = CScript() << OP_3 << OP_EQUAL;\n     tx3.vout[0].nValue = 10 * COIN;\n@@ -52,8 +55,10 @@ static void MempoolEviction(benchmark::State& state)\n     tx4.vin.resize(2);\n     tx4.vin[0].prevout.SetNull();\n     tx4.vin[0].scriptSig = CScript() << OP_4;\n+    tx4.vin[0].scriptWitness.stack.push_back({4});\n     tx4.vin[1].prevout.SetNull();\n     tx4.vin[1].scriptSig = CScript() << OP_4;\n+    tx4.vin[1].scriptWitness.stack.push_back({4});\n     tx4.vout.resize(2);\n     tx4.vout[0].scriptPubKey = CScript() << OP_4 << OP_EQUAL;\n     tx4.vout[0].nValue = 10 * COIN;\n@@ -64,8 +69,10 @@ static void MempoolEviction(benchmark::State& state)\n     tx5.vin.resize(2);\n     tx5.vin[0].prevout = COutPoint(tx4.GetHash(), 0);\n     tx5.vin[0].scriptSig = CScript() << OP_4;\n+    tx5.vin[0].scriptWitness.stack.push_back({4});\n     tx5.vin[1].prevout.SetNull();\n     tx5.vin[1].scriptSig = CScript() << OP_5;\n+    tx5.vin[1].scriptWitness.stack.push_back({5});\n     tx5.vout.resize(2);\n     tx5.vout[0].scriptPubKey = CScript() << OP_5 << OP_EQUAL;\n     tx5.vout[0].nValue = 10 * COIN;\n@@ -76,8 +83,10 @@ static void MempoolEviction(benchmark::State& state)\n     tx6.vin.resize(2);\n     tx6.vin[0].prevout = COutPoint(tx4.GetHash(), 1);\n     tx6.vin[0].scriptSig = CScript() << OP_4;\n+    tx6.vin[0].scriptWitness.stack.push_back({4});\n     tx6.vin[1].prevout.SetNull();\n     tx6.vin[1].scriptSig = CScript() << OP_6;\n+    tx6.vin[1].scriptWitness.stack.push_back({6});\n     tx6.vout.resize(2);\n     tx6.vout[0].scriptPubKey = CScript() << OP_6 << OP_EQUAL;\n     tx6.vout[0].nValue = 10 * COIN;\n@@ -88,8 +97,10 @@ static void MempoolEviction(benchmark::State& state)\n     tx7.vin.resize(2);\n     tx7.vin[0].prevout = COutPoint(tx5.GetHash(), 0);\n     tx7.vin[0].scriptSig = CScript() << OP_5;\n+    tx7.vin[0].scriptWitness.stack.push_back({5});\n     tx7.vin[1].prevout = COutPoint(tx6.GetHash(), 0);\n     tx7.vin[1].scriptSig = CScript() << OP_6;\n+    tx7.vin[1].scriptWitness.stack.push_back({6});\n     tx7.vout.resize(2);\n     tx7.vout[0].scriptPubKey = CScript() << OP_7 << OP_EQUAL;\n     tx7.vout[0].nValue = 10 * COIN;"
      }
    ]
  }
]