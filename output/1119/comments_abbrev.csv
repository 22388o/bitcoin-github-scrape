sipa,2012-04-17T22:50:42Z,Extra information: lsn_reset is not faster when it is run a second time. I assume it needs to traverse the entire database file.\n,https://github.com/bitcoin/bitcoin/pull/1119#issuecomment-5187960,5187960,
laanwj,2012-04-19T05:35:46Z,"Code is ACK\n\nMaybe we could add some text to the description/tooltip that it doesn't affect the safety of the wallet. Somehow this ""rush database shutdown"" manages to creep me out (and that would even more apply to users, I think).\n",https://github.com/bitcoin/bitcoin/pull/1119#issuecomment-5215221,5215221,
sipa,2012-04-19T11:12:12Z,"@laanwj I'm not so sure - I believe many corruptions are caused by people shutting down their computers before lsn_reset has completed, or otherwise killing it because of slow shutdown. Not calling lsn_reset is perfectly safe, only you can't move blkindex.dat to a new environment afterwards. If you do so anyway, if will fail (deterministically) at startup.\n\nEDIT: right, your comment was about us",https://github.com/bitcoin/bitcoin/pull/1119#issuecomment-5219234,5219234,
laanwj,2012-04-19T11:43:31Z,"Another random concern: could this interfere with deleting db logs on\nstartup/shutdown? (i'm not sure we do this but remember reading about it on\nirc) Is the ""unflushed state"" in the log files?\n",https://github.com/bitcoin/bitcoin/pull/1119#issuecomment-5219674,5219674,
sipa,2012-04-19T12:29:57Z,"If you manually delete log files, and no lsn_reset was performed on blkindex.dat, it will fail to load. We call some bdb functions to remove log files automatically, but this only happens when they are safe to be removed.\n",https://github.com/bitcoin/bitcoin/pull/1119#issuecomment-5220373,5220373,
gavinandresen,2012-04-22T00:01:21Z,"A random thought after reading http://dbaspot.com/berkeley-db/266028-database-recovery-no-transaction-logs-sybase-its-termed-suicide-recovery.html\n\nIf the datadir/database directory is empty or missing at startup, could we just leave the DB_RECOVER flag out of the dbenv.open() call and cross our fingers that the .dat files are in a consistent state?  Or maybe do whatever db_verify does and exit ",https://github.com/bitcoin/bitcoin/pull/1119#issuecomment-5264511,5264511,
sipa,2012-04-22T00:37:27Z,"I did a test: close all database files nicely, do a checkpoint, (do not reset lsn's), shutdown the database environment cleanly, delete the log files, restart application without DB_RECOVER. Result: Db::open: Invalid argument.\n\nSo it seems that no matter what, the log file needs to be present. I wonder how db_dump works, because that tool can dump the records without any problems in this situati",https://github.com/bitcoin/bitcoin/pull/1119#issuecomment-5264631,5264631,
gavinandresen,2012-04-23T19:56:51Z,"ACK.\n\ndb_dump calls: dbp->verify(dbp, filename, NULL, stdout,\n                    DB_SALVAGE |\n                    (Rflag ? DB_AGGRESSIVE : 0) |\n                    (pflag ? DB_PRINTABLE : 0));\n",https://github.com/bitcoin/bitcoin/pull/1119#issuecomment-5290193,5290193,
sipa,2012-04-23T20:08:53Z,"Right, not what we want to do by ourself.\n\n@jgarzik and @gmaxwell: what worries do you still have w.r.t. this pullreq?\n",https://github.com/bitcoin/bitcoin/pull/1119#issuecomment-5290451,5290451,
sipa,2012-04-24T19:04:23Z,"@laanwj If i'd change the checkbox to be ""detach block and address databases from environment (slower shutdown)"", and make it default off. Would that sound less alarming?\n",https://github.com/bitcoin/bitcoin/pull/1119#issuecomment-5314001,5314001,
sipa,2012-04-25T20:38:47Z,I swapped -fastshutdown=1 for -detachdb=0. This way of formulating things hopefully sounds less scary.\n,https://github.com/bitcoin/bitcoin/pull/1119#issuecomment-5342193,5342193,
Diapolo,2012-04-25T20:57:34Z,"The blk000x.dat file(s) are not involved here, as you didn't mention it? As addr.dat and blkindex.dat can be rebuild I think it is a nice addition / option. I had to read the description several times to understand what is default now ^^.\n",https://github.com/bitcoin/bitcoin/pull/1119#issuecomment-5342597,5342597,
sipa,2012-04-25T22:34:34Z,Default is the fast shutdown without calling lsn_reset on blkindex.dat and addr.dat. I believe that's what most people want - very few people move these files around between environments.\n\nblk0001.dat is indeed not involved here as it is no database.\n,https://github.com/bitcoin/bitcoin/pull/1119#issuecomment-5345430,5345430,
Diapolo,2012-04-26T04:59:00Z,Thanks for clarifying and ACK ;).\n,https://github.com/bitcoin/bitcoin/pull/1119#issuecomment-5349581,5349581,
laanwj,2012-04-26T05:47:02Z,I like the diplomatic renaming :-) ACK.\n,https://github.com/bitcoin/bitcoin/pull/1119#issuecomment-5350045,5350045,
Diapolo,2012-04-25T21:00:11Z,"If detachdb is a bool value, how can the default be 9?\n",https://github.com/bitcoin/bitcoin/pull/1119#discussion_r735291,735291,src/init.cpp
sipa,2012-04-25T22:32:48Z,"Thanks for noticing, it's a typo :)\n",https://github.com/bitcoin/bitcoin/pull/1119#discussion_r735779,735779,src/init.cpp
