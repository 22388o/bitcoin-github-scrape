eklitzke,2018-03-10T16:25:32Z,"The argument for keeping the block index in the data dir would be that in the vast majority of cases it means the block index will be on the same filesystem as the utxo database, and therefore we can rely on regular filesystem semantics regarding data ordering. If the block index and utxo database are on different filesystems then it's not possible to guarantee that one is ahead of the other witho",https://github.com/bitcoin/bitcoin/pull/12653#issuecomment-372042436,372042436,
jonasschnelli,2018-03-11T04:43:31Z,Added a commit (basically a one-liner) that will make the block index database stick in datadir.,https://github.com/bitcoin/bitcoin/pull/12653#issuecomment-372089163,372089163,
eklitzke,2018-03-11T07:11:58Z,utACK Once you fix the python lint failure.,https://github.com/bitcoin/bitcoin/pull/12653#issuecomment-372094666,372094666,
promag,2018-03-11T19:05:53Z,Concept ACK.,https://github.com/bitcoin/bitcoin/pull/12653#issuecomment-372140158,372140158,
laanwj,2018-03-13T11:27:29Z,"Concept ACK, this would avoid some symlinking gymnastics I'm currently doing.\n(ref; #10922)",https://github.com/bitcoin/bitcoin/pull/12653#issuecomment-372633558,372633558,
hkjn,2018-03-13T13:35:12Z,"ACK 34ec8e3, once lint issues are fixed.\n\nDoes what it says on the tin, seems like a useful feature.",https://github.com/bitcoin/bitcoin/pull/12653#issuecomment-372666695,372666695,
eklitzke,2018-03-15T13:29:57Z,"I might have to retract my earlier statement, as @sipa says [here](https://github.com/bitcoin/bitcoin/pull/10922#issuecomment-317596359) that the blocks index and block files should be on the same filesystem, contradicting my earlier statement. I'm not sure if I understand that reasoning though, as we fsync after writing the block and before committing to the block index, which should be fine acro",https://github.com/bitcoin/bitcoin/pull/12653#issuecomment-373375739,373375739,
laanwj,2018-03-15T13:43:18Z,"~~I think this is almost ready. Will test.~~ However, python-nanny wants you to fix:\n```\n./test/functional/feature_blocksdir.py:20:63: E703 statement ends with a semicolon\n^---- failure generated from contrib/devtools/lint-python.sh\n```",https://github.com/bitcoin/bitcoin/pull/12653#issuecomment-373379810,373379810,
donaloconnor,2018-03-15T22:56:12Z,utACK ,https://github.com/bitcoin/bitcoin/pull/12653#issuecomment-373548896,373548896,
laanwj,2018-03-19T15:09:15Z,"> I might have to retract my earlier statement, as @sipa says here that the blocks index and block files should be on the same filesystem\n\nWouldn't this imply that we're better off without commit https://github.com/bitcoin/bitcoin/pull/12653/commits/4855b9e8365e0037fcd9a4c6796dea04efa019ec? That would keep the block index with the blocks, which is @sipa's preference.",https://github.com/bitcoin/bitcoin/pull/12653#issuecomment-374246044,374246044,
jonasschnelli,2018-03-20T02:36:17Z,">> I might have to retract my earlier statement, as @sipa says here that the blocks index and block files should be on the same filesystem\n\n> Wouldn't this imply that we're better off without commit 4855b9e? That would keep the block index with the blocks, which is @sipa's preference.\n\n@sipa: can you elaborate your concerns of having the index outside of the blocks directory?",https://github.com/bitcoin/bitcoin/pull/12653#issuecomment-374452598,374452598,
sipa,2018-03-20T02:37:43Z,"@jonasschnelli @eklitzke I don't think there's an actual problem with having the blocks and the block index on separate filesystems. I was worried about them going out of sync due to management (you copy one but not the other, etc).",https://github.com/bitcoin/bitcoin/pull/12653#issuecomment-374452816,374452816,
jonasschnelli,2018-03-20T02:39:24Z,"Thanks @sipa.\nI think then we should keep the last commit (a1926362ecb3c354ae338ef7d7020daf78f980c9).",https://github.com/bitcoin/bitcoin/pull/12653#issuecomment-374453089,374453089,
laanwj,2018-03-27T19:06:30Z,"In that case, utACK a1926362ecb3c354ae338ef7d7020daf78f980c9",https://github.com/bitcoin/bitcoin/pull/12653#issuecomment-376639575,376639575,
Sjors,2018-03-29T12:54:03Z,"Sorry I'm late to the party, but I'm seeing some strange behavior on macOS, see #12828. ",https://github.com/bitcoin/bitcoin/pull/12653#issuecomment-377225716,377225716,
opacey,2018-04-03T17:07:43Z,"I ran a little test just to see the effect of putting the entire datadir an external USB 3.0 HDD versus the internal SSD (cross ref #10736):\n  MacBookPro2013 ExternalUSBHDD (NoNetwork) = ~1min, CPU ~35%\n  MacBookPro2013 InternalSSD (NoNetwork) = ~2.0sec, CPU ~120%\n  MacBookPro2017 InternalSSD (NoNetwork) = ~2.0sec, CPU ~120%\n  MacBookPro2017 InternalSSD (NetworkOn) = ~2.5sec, CPU ~120%\n",https://github.com/bitcoin/bitcoin/pull/12653#issuecomment-378324754,378324754,
promag,2018-10-02T09:04:48Z,"> This PR adds a -blocksdir option that allows one to keep the blockfiles and the blockindex external from the data directory (instead of creating symlinks).\n\n@jonasschnelli could you update/fix the PR description?\n\nEdit: Done",https://github.com/bitcoin/bitcoin/pull/12653#issuecomment-426202288,426202288,
Empact,2019-01-07T18:59:14Z,https://github.com/bitcoin/bitcoin/pull/15124,https://github.com/bitcoin/bitcoin/pull/12653#issuecomment-452043082,452043082,
MarcoFalke,2018-03-11T20:13:01Z,"I am wondering why this should be net specific, considering that we have the same concept for wallets and the `GetWalletDir` is not net specific.",https://github.com/bitcoin/bitcoin/pull/12653#discussion_r173667736,173667736,src/util.h
promag,2018-03-12T15:37:23Z,Remove `;`.,https://github.com/bitcoin/bitcoin/pull/12653#discussion_r173841457,173841457,test/functional/feature_blocksdir.py
promag,2018-03-12T15:44:09Z,"Add\n```py\nblocksdir = os.path.join(self.options.tmpdir, ""blocksdir"")\n```\nand reuse here and below.",https://github.com/bitcoin/bitcoin/pull/12653#discussion_r173843918,173843918,test/functional/feature_blocksdir.py
promag,2018-03-12T15:54:39Z,"`""blockindex""`? Should be `""blocks"" / ""index""`?\n\nMaybe add `GetBlockIndexDir()`?",https://github.com/bitcoin/bitcoin/pull/12653#discussion_r173847868,173847868,src/txdb.cpp
laanwj,2018-03-15T13:42:03Z,Isn't the blocks directory *by definition* net specific?,https://github.com/bitcoin/bitcoin/pull/12653#discussion_r174784834,174784834,src/util.h
laanwj,2018-03-15T19:31:54Z,"Yes, this seems wrong.\nI tried providing my existing blocks directory:\n```\n$ src/bitcoind -testnet -blocksdir=/store2/tmp/bitcoin/testnet3/blocks -printtoconsole\n2018-03-15T19:29:04Z Opening LevelDB in /.../.bitcoin/testnet3/blockindex\n2018-03-15T19:29:04Z Opened LevelDB successfully\n...\n2018-03-15T19:29:05Z : Error initializing block database.\nPlease restart with -reindex or -rein",https://github.com/bitcoin/bitcoin/pull/12653#discussion_r174905759,174905759,src/txdb.cpp
jonasschnelli,2018-03-20T02:35:12Z,"Using the same directory looks most obvious correct, though, if you switch the blocks dir to a different path (with `-blocksdir=<path>`) users may run into troubles since the old blocks dir may still be in the datadir...\nBut I agree, lets keep ""block"" / ""Index"" for now... \nfixed.",https://github.com/bitcoin/bitcoin/pull/12653#discussion_r175640919,175640919,src/txdb.cpp
markblundeberg,2019-05-09T18:03:53Z,"What is this conditional for -- why not always just `GetDataDir() / ""blocks"" / ""index""` ?",https://github.com/bitcoin/bitcoin/pull/12653#discussion_r282600933,282600933,src/txdb.cpp
Sjors,2019-05-09T18:43:31Z,"The `-blocksdir` parameter lets you put blocks in a completely different directory, e.g. on a slow cheap magnetic harddrive, keeping the rest on your datadir on SSD. `blocks/index` also needs to be on a fast drive. Ideally tough I think datadir/blocks/index should move to datadir/index/blocks",https://github.com/bitcoin/bitcoin/pull/12653#discussion_r282615414,282615414,src/txdb.cpp
markblundeberg,2019-05-09T21:47:02Z,"Yes, I just mean that no matter whether the `gArgs.IsArgSet(""-blocksdir"") ?` conditional here is True / False, either way it results in using ""DATADIR/blocks/index"". So the conditional seems like just extra code ... though this makes me suspect I'm missing something.",https://github.com/bitcoin/bitcoin/pull/12653#discussion_r282678552,282678552,src/txdb.cpp
Sjors,2019-05-10T13:53:38Z,"`gArgs.IsArgSet(""-blocksdir"") ? GetDataDir() / ""blocks"" / ""index"" : GetBlocksDir() / ""index""`\n\nIf launched without `-blocksdir`:\n```\nfalse -> GetBlocksDir() / ""index"" -> ~/.bitcoin/blocks/index\n```\n\nIf launched with with `-blocksdir=/mnt/magnetic/blocks`:\n```\ntrue -> GetDataDir() / ""blocks"" / ""index"" ->   /mnt/magnetic/blocks/index\n```\n\nNote that `GetBlocksDir()` internally",https://github.com/bitcoin/bitcoin/pull/12653#discussion_r282893333,282893333,src/txdb.cpp
markblundeberg,2019-05-12T19:35:28Z,"Ah sorry, I meant to say either way it uses `GetBlocksDir()/""blocks""/""index""` but wrote DATADIR. Anyway though as you say, the directory check&create does make it slightly different.",https://github.com/bitcoin/bitcoin/pull/12653#discussion_r283150872,283150872,src/txdb.cpp
promag,2019-10-06T13:50:36Z,"> If launched with with `-blocksdir=/mnt/magnetic/blocks`:\n> \n> ```\n> true -> GetDataDir() / ""blocks"" / ""index"" ->   /mnt/magnetic/blocks/index\n> ```\n\nThis is incorrect, right @Sjors?",https://github.com/bitcoin/bitcoin/pull/12653#discussion_r331790650,331790650,src/txdb.cpp
Sjors,2019-10-06T18:58:42Z,I believe it's like this: `-blocksdir=/mnt/magnetic` will put blocks in `/mnt/magnetic/blocks`. The block index will remain at `~/.bitcoin/blocks/index` and `~/.bitcoin/blocks` will otherwise be empty.,https://github.com/bitcoin/bitcoin/pull/12653#discussion_r331804678,331804678,src/txdb.cpp
