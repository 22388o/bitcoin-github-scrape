[
  {
    "sha": "fa918dd537fea775c19a590e5f9161bf51a5839b",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYTkxOGRkNTM3ZmVhNzc1YzE5YTU5MGU1ZjkxNjFiZjUxYTU4Mzli",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2020-12-10T11:35:28Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2020-12-10T11:36:41Z"
      },
      "message": "test: Use Popen.wait instead of RPC in assert_start_raises_init_error",
      "tree": {
        "sha": "b2ecdaadfa77edc3c8e12157764b36d50630d995",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b2ecdaadfa77edc3c8e12157764b36d50630d995"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fa918dd537fea775c19a590e5f9161bf51a5839b",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\npUhiiwv+LYE7uL0h9A/2wwqSZXYmuPBEpwMekweVlU8weIhCsGfBsxSQYKP/RWqx\nzWSsRY5/0Ru4ZG6A1jnxSmUgRJULA0t3y3HX/CfYOTcSEwFGH6iVzszIPZK26QAM\n6v7hMNIi12hpiboip+tNok81FvKizWpCQ7KJqWo5i/DXtUr21bCVj4p//iU16Swl\nYiZ+J8fo0qgG/lip/S92OY+vBZ/dvF4DPq0dgUNNzEO3lAlCPhFQD8g2NYEWDsM9\npFpVY3O3Dh4u3IbO8DKSaCZQevnd4ZbbFAXrTL9RvEKuzV90bBIfTdPjwivsCjV/\nA62imujh/sSYUK8nNqN/8WzM4gqoSp4cP/2y/9TN7PUVjtwdhrjvyhMCnAf8spSZ\nPUyEiK2j12NZ9K6nSQEok7U8CFDLxVe0GnqgnEcGKQ5NGAkPWO3RavBhIm9tvo7L\nypR92xpCRAf7SITGId/lWMMa2CPgIodgtjH5+8Fbhju/PjxDExI3/tp7GVQ+WlUN\nc/rQ/H2j\n=B4w6\n-----END PGP SIGNATURE-----",
        "payload": "tree b2ecdaadfa77edc3c8e12157764b36d50630d995\nparent eb53c03b3680358e2f3c702b7a6b221887ef4762\nauthor MarcoFalke <falke.marco@gmail.com> 1607600128 +0100\ncommitter MarcoFalke <falke.marco@gmail.com> 1607600201 +0100\n\ntest: Use Popen.wait instead of RPC in assert_start_raises_init_error\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa918dd537fea775c19a590e5f9161bf51a5839b",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fa918dd537fea775c19a590e5f9161bf51a5839b",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa918dd537fea775c19a590e5f9161bf51a5839b/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "eb53c03b3680358e2f3c702b7a6b221887ef4762",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/eb53c03b3680358e2f3c702b7a6b221887ef4762",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/eb53c03b3680358e2f3c702b7a6b221887ef4762"
      }
    ],
    "stats": {
      "total": 17,
      "additions": 9,
      "deletions": 8
    },
    "files": [
      {
        "sha": "a618706a770adf729588fd904e741b9d1e4a7f98",
        "filename": "test/functional/test_framework/test_node.py",
        "status": "modified",
        "additions": 9,
        "deletions": 8,
        "changes": 17,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa918dd537fea775c19a590e5f9161bf51a5839b/test/functional/test_framework/test_node.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa918dd537fea775c19a590e5f9161bf51a5839b/test/functional/test_framework/test_node.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/test_framework/test_node.py?ref=fa918dd537fea775c19a590e5f9161bf51a5839b",
        "patch": "@@ -482,11 +482,8 @@ def assert_start_raises_init_error(self, extra_args=None, expected_msg=None, mat\n              tempfile.NamedTemporaryFile(dir=self.stdout_dir, delete=False) as log_stdout:\n             try:\n                 self.start(extra_args, stdout=log_stdout, stderr=log_stderr, *args, **kwargs)\n-                self.wait_for_rpc_connection()\n-                self.stop_node()\n-                self.wait_until_stopped()\n-            except FailedToStartError as e:\n-                self.log.debug('bitcoind failed to start: %s', e)\n+                ret = self.process.wait(timeout=self.rpc_timeout)\n+                self.log.debug(self._node_msg(f'bitcoind exited with status {ret} during initialization'))\n                 self.running = False\n                 self.process = None\n                 # Check stderr for expected message\n@@ -505,11 +502,15 @@ def assert_start_raises_init_error(self, extra_args=None, expected_msg=None, mat\n                         if expected_msg != stderr:\n                             self._raise_assertion_error(\n                                 'Expected message \"{}\" does not fully match stderr:\\n\"{}\"'.format(expected_msg, stderr))\n-            else:\n+            except subprocess.TimeoutExpired:\n+                self.process.kill()\n+                self.running = False\n+                self.process = None\n+                assert_msg = f'bitcoind should have exited within {self.rpc_timeout}s '\n                 if expected_msg is None:\n-                    assert_msg = \"bitcoind should have exited with an error\"\n+                    assert_msg += \"with an error\"\n                 else:\n-                    assert_msg = \"bitcoind should have exited with expected error \" + expected_msg\n+                    assert_msg += \"with expected error \" + expected_msg\n                 self._raise_assertion_error(assert_msg)\n \n     def add_p2p_connection(self, p2p_conn, *, wait_for_verack=True, **kwargs):"
      }
    ]
  }
]