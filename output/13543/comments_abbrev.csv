fanquake,2018-06-27T16:18:42Z,"@laanwj Have you been building with `NO_QT=1`?\n\nI've just tested a `make HOST=riscv64-linux-gnu ` depends build on Ubuntu 18.04, after installing the RISC-V toolchain and am seeing:\n```\nConfiguring qrencode...\nchecking build system type... x86_64-unknown-linux-gnu\nchecking host system type... Invalid configuration `riscv64-linux-gnu': machine `riscv64' not recognized\nconfigure: error",https://github.com/bitcoin/bitcoin/pull/13543#issuecomment-400737637,400737637,
laanwj,2018-06-27T16:32:39Z,"Thanks for testing. Good point: yes, I have built without Qt, same as we do for ARM. Should probably mention that in the documentation, though I don't think there's any RISC-V boards at this time with a capable enough GPU and HDMI/VGA out to run even a desktop GUI (though maybe it's possible to connect one through the PCI-e slot? I don't know).\n\n> I wonder if there's a less verbose patch we co",https://github.com/bitcoin/bitcoin/pull/13543#issuecomment-400743959,400743959,
tmagik,2018-06-27T17:22:23Z,"I can test this on a HiFiveU board next week. The problem with running a full bitcoin main net instance on a physical riscv board is going to be I/O.\n\nIn the meantime, try running in Qemu as it will probably have better I/O",https://github.com/bitcoin/bitcoin/pull/13543#issuecomment-400763899,400763899,
laanwj,2018-06-27T17:25:44Z,"> I can test this on a HiFiveU board next week. The problem with running a full bitcoin main net instance on a physical riscv board is going to be I/O.\n\nRunning `test_bitcoin` would already be helpful, even if you don't want to sync a chain.\n\n> In the meantime, try running in Qemu as it will probably have better I/O\n\nGood idea. I did this for the big-endian support, so it should certai",https://github.com/bitcoin/bitcoin/pull/13543#issuecomment-400764856,400764856,
tmagik,2018-06-27T18:01:16Z,"> Thanks for testing. Good point: yes, I have built without Qt, same as we do for ARM. Should probably mention that in the documentation, though I don't think there's any RISC-V boards at this time with a capable enough GPU and HDMI/VGA out to run even a desktop GUI (though maybe it's possible to connect one through the PCI-e slot? I don't know).\n\nhttps://www.crowdsupply.com/microsemi/hifive-u",https://github.com/bitcoin/bitcoin/pull/13543#issuecomment-400775890,400775890,
laanwj,2018-06-27T18:36:30Z,"This is interesting:\n```\nuser@bionic:~/bitcoin/src$ QEMU_LD_PREFIX=/usr/riscv64-linux-gnu qemu-riscv64 ./test/test_bitcoin\nRunning 291 test cases...\ntest/crypto_tests.cpp(561): error: in ""crypto_tests/sha256d64"": check memcmp(out1, out2, 32 * i) == 0 has failed\ntest/crypto_tests.cpp(561): error: in ""crypto_tests/sha256d64"": check memcmp(out1, out2, 32 * i) == 0 has failed\ntest/crypto_t",https://github.com/bitcoin/bitcoin/pull/13543#issuecomment-400786707,400786707,
sipa,2018-06-27T18:46:26Z,@laanwj That's very strange. It should be using the pure C++ SHA256 implementation. What SHA256 implementation does debug.log report (if you get that far)?,https://github.com/bitcoin/bitcoin/pull/13543#issuecomment-400789568,400789568,
laanwj,2018-06-27T19:21:35Z,"> @laanwj That's very strange. It should be using the pure C++ SHA256 implementation. What SHA256 implementation does debug.log report (if you get that far)?\n\nIt chooses the correct one:\n```\n2018-06-27T19:16:24Z Using the 'standard' SHA256 implementation\n```\nI'll dive into what happens here.",https://github.com/bitcoin/bitcoin/pull/13543#issuecomment-400799431,400799431,
laanwj,2018-06-28T10:14:24Z,"It looks like the beginning of input `in[]` to `SHA256D64` becomes corrupted by\n```c++\n        for (int j = 0; j < i; ++j) {\n            CHash256().Write(in + 64 * j, 64).Finalize(out1 + 32 * j);\n        }\n```\nThe function itself works correctly.\n\nI'm suspecting a miscompilation issue at the moment. It happens with `-O1` and higher but not `-O0`. I'm not able to narrow it down to a",https://github.com/bitcoin/bitcoin/pull/13543#issuecomment-400986006,400986006,
laanwj,2018-06-29T15:34:41Z,"My sync in qemu is at block 270000, and has encountered no issues. I haven't figured out yet why the `crypto_tests/sha256d64` specifically has this issue. Strangely enough, moving the `in` array to the outer scope makes the test pass.\nI intend to try compilng with a more recent version of gcc to see if the test problem is resolved.",https://github.com/bitcoin/bitcoin/pull/13543#issuecomment-401391240,401391240,
tmagik,2018-06-30T23:00:31Z,"I attempted to make a test case, and simplified the following down:\n```\nstatic inline uint64_t InsecureRandBits(int bits) { return insecure_seed++; }\n```\n\nhowever this does not fail, so I'm now highly suspicious of inlining",https://github.com/bitcoin/bitcoin/pull/13543#issuecomment-401571499,401571499,
tmagik,2018-07-01T00:25:39Z,"I can confirm the failure with gcc-7.3.1 on fedora on a HiFive Unleashed as well as gcc-7.3.0 on debian in qemu-user-mode emulation.\n\nTestcase at https://github.com/tmagik/riscv-sha256d-inline-fail/",https://github.com/bitcoin/bitcoin/pull/13543#issuecomment-401575025,401575025,
tmagik,2018-07-01T13:04:42Z,"@laanwj Debian's gcc-8 appears to fix the problem\n```\nriscv64-linux-gnu-gcc-8 --version\nriscv64-linux-gnu-gcc-8 (Debian 8.1.0-8) 8.1.0\n```",https://github.com/bitcoin/bitcoin/pull/13543#issuecomment-401605636,401605636,
laanwj,2018-07-04T13:42:00Z,"@tmagic Thanks for reproducing. Happy to hear it's solved with newer gcc. It might be better to remove the note about using ubuntu's cross-toolchain packages, then, until they have gcc 8 like debian.",https://github.com/bitcoin/bitcoin/pull/13543#issuecomment-402482951,402482951,
DrahtBot,2018-07-06T07:31:12Z,"<!--e57a25ab6845829454e8d69fc972939a-->Note to reviewers: This pull request conflicts with the following ones:\n\n* #13578 ([depends, zmq, doc] upgrade zeromq to 4.2.5 and avoid deprecated zeromq api functions by mruddy)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",https://github.com/bitcoin/bitcoin/pull/13543#issuecomment-402951925,402951925,
fanquake,2018-07-08T16:07:43Z,"I've done some more testing of this using a [branch](https://github.com/fanquake/bitcoin/tree/riscv-depends-no-zmq-patching) that doesn't patch zmq's config.guess/sub, and instead just copies over our local versions, which I've updated from upstream.\n\nre running [`./autogen.sh` after copying](https://github.com/bitcoin/bitcoin/pull/13543#discussion_r200713627). \nWith or without `'./autogen.s",https://github.com/bitcoin/bitcoin/pull/13543#issuecomment-403297954,403297954,
laanwj,2018-07-09T14:07:04Z,"@theuni thanks for review\n@fanquake thanks for making the changes - will take over your branch",https://github.com/bitcoin/bitcoin/pull/13543#issuecomment-403491573,403491573,
laanwj,2018-07-09T14:31:47Z,"Updated branch:\n- Took over @fanquake's branch that copies the autoconf artifacts instead of the big ugly patch\n- Added a comment about the RISC-V compilation issue",https://github.com/bitcoin/bitcoin/pull/13543#issuecomment-403499677,403499677,
theuni,2018-07-09T19:54:47Z,utACK 974f0bf8e684696be7796dbf3d48ff0a41f4ac26.,https://github.com/bitcoin/bitcoin/pull/13543#issuecomment-403600233,403600233,
theuni,2018-07-06T16:57:31Z,"Could we [copy our files](https://github.com/bitcoin/bitcoin/blob/master/depends/packages/bdb.mk#L18) instead, since we have to keep ours up to date anyway?",https://github.com/bitcoin/bitcoin/pull/13543#discussion_r200712382,200712382,depends/packages/zeromq.mk
theuni,2018-07-06T17:02:48Z,"Is it definitely necessary to re-run autogen.sh? Afaik configure just calls out to config.guess/config.sub. Unless there's some weird globbing involved, I should think that replacing those files would be enough.",https://github.com/bitcoin/bitcoin/pull/13543#discussion_r200713627,200713627,depends/packages/zeromq.mk
fanquake,2018-07-08T15:53:14Z,"I've added some commits to a branch that attempt to do that: https://github.com/fanquake/bitcoin/tree/riscv-depends-no-zmq-patching. It also updates the depends config.guess/sub to latest upstream.\n\n@laanwj You can cherry pick from there if you'd like. Note that branch doesn't include re-running `./autogen.sh` like below. I'll comment about that shortly.",https://github.com/bitcoin/bitcoin/pull/13543#discussion_r200844936,200844936,depends/packages/zeromq.mk
