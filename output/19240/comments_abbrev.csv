laanwj,2020-06-11 17:54:29,"> For anyone who's looked at the last PR, this one just has a simpler sdk-gen.sh script that I wrote myself, and includes some .xip unpacking innovations thanks to theuni.\n\nThanks for working on this. This is great news. Maybe can manage to do it myself this time without a Mac :+1: \n",https://github.com/bitcoin/bitcoin/pull/19240#issuecomment-642838529,642838529,
theuni,2020-06-12 19:38:33,"I'm seeing a Qt build failure due to some symlink/hardlink issue:\n```\nkernel/qdnslookup_unix.cpp:52:10: fatal error: 'arpa/nameser.h' file not found\n#include <arpa/nameser.h>\n         ^~~~~~~~~~~~~~~~\n1 error generated.\nMakefile:12337: recipe for target '.obj/qdnslookup_unix.o' failed\n```\nThe link is broken hardlink in the generated sdk:\n```\n $ ls -al MacOSX10.14.sdk/usr/includ",https://github.com/bitcoin/bitcoin/pull/19240#issuecomment-643451337,643451337,
DrahtBot,2020-06-13 03:03:21,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #18288 (build: Add MemorySanitizer (MSan) in Travis to detect use of uninitialized memory by practicalswift)\n* #17919 (de",https://github.com/bitcoin/bitcoin/pull/19240#issuecomment-643559167,643559167,
dongcarl,2020-06-15 13:41:44,Squashed in the fixups!,https://github.com/bitcoin/bitcoin/pull/19240#issuecomment-644142623,644142623,
theuni,2020-06-16 19:07:32,"I discussed this today with @fanquake, and we realized that after this change, we'll also need to bump our SDK in the near-future so that we can begin testing with c++17. And when we do that, it's also a good time to bump our clang/cctools to match.\n\nI hacked that together and tested quickly, and all seems to be working as expected:\nhttps://github.com/theuni/bitcoin/tree/19240\n\nAt the ri",https://github.com/bitcoin/bitcoin/pull/19240#issuecomment-644956672,644956672,
Sjors,2020-06-17 15:29:31,Let's merge this first. As long as the other stuff gets in before 0.21 most people won't be impacted anyway.,https://github.com/bitcoin/bitcoin/pull/19240#issuecomment-645446634,645446634,
dongcarl,2020-06-17 17:33:27,"Thought a bit about what's needed for the steps that are required before 0.21, and it seems like I'll have to redo the entire `gen-sdk.sh` in python for the `tarfile` and `plistlib` modules, so it probably doesn't make sense to merge this in the meantime. Will push up a new version in this PR when I have it.\n\nMany thanks to laanwj, theuni, fanquake, and especially Sjors for reviewing.",https://github.com/bitcoin/bitcoin/pull/19240#issuecomment-645516874,645516874,
theuni,2020-06-17 17:38:02,"> Let's merge this first.\n\nSounds good.\n\nMy only remaining ask for this PR is something @dongcarl and I discussed yesterday: Adding the xcode version string to the (already lengthy!) sdk tarball/dirname. This is to compensate for the fact that Apple updates the SDK in new XCode versions, so unfortunately ""MacOSX10.xy.sdk"" alone doesn't mean much. Adding this string will prevent future clas",https://github.com/bitcoin/bitcoin/pull/19240#issuecomment-645519240,645519240,
theuni,2020-06-19 01:12:37,"@dongcarl Whoa, that was quick!\n\nI haven't really reviewed the new script, but it worked great. Built locally, looks good. I went ahead and uploaded the resulting tarball for Travis so we can see where we stand.\n\nNow that this includes a toolchain bump, mind updating the PR title/description? I think this is ready for in-depth review now.",https://github.com/bitcoin/bitcoin/pull/19240#issuecomment-646381471,646381471,
Sjors,2020-06-19 19:42:48,"re-tACK cbdaa3a179c5011b651cb4c9cbcef482816d822d\n\nGitian build changed, presumable because you rebased (from a79bca2f1fb25f433d6e100a31a3acfde2656ce1 to febe5823b4ae0de5cd0e6da3f69555acd0724267)?\n\n```\n2f13a3069c1608f0e3c5ab0fa561e22273165acf710c8cc2fe399790b4fd56de  bitcoin-cbdaa3a179c5-osx-unsigned.dmg\nfb00a5c1306c33fc54e3aafde51cdc12ab890785eda253717b3924529a6d2366  bitcoin-cbdaa3a17",https://github.com/bitcoin/bitcoin/pull/19240#issuecomment-646833515,646833515,
dongcarl,2020-06-20 02:50:06,"I can reproduce Sjor's results!\n\n```\n- out_manifest: |\n    2f13a3069c1608f0e3c5ab0fa561e22273165acf710c8cc2fe399790b4fd56de  bitcoin-cbdaa3a179c5-osx-unsigned.dmg\n    fb00a5c1306c33fc54e3aafde51cdc12ab890785eda253717b3924529a6d2366  bitcoin-cbdaa3a179c5-osx-unsigned.tar.gz\n    4ea413de539ee7e972a5f4d60108016729d7cb92e6d15d5a2747b083fae87140  bitcoin-cbdaa3a179c5-osx64.tar.gz\n    1173",https://github.com/bitcoin/bitcoin/pull/19240#issuecomment-646925976,646925976,
MarcoFalke,2020-06-20 10:21:16,Let me know when this is ready so I can put the backdoored binary on DrahtBot :),https://github.com/bitcoin/bitcoin/pull/19240#issuecomment-646973288,646973288,
MarcoFalke,2020-06-20 10:52:43,"Before merge, the OP should be edited to remove the historic description, which is accessible through the GitHub history drop-down",https://github.com/bitcoin/bitcoin/pull/19240#issuecomment-646977441,646977441,
MarcoFalke,2020-06-20 11:07:25,the ci failure can be ignored: https://github.com/bitcoin/bitcoin/issues/19329#issuecomment-646979700,https://github.com/bitcoin/bitcoin/pull/19240#issuecomment-646979810,646979810,
MarcoFalke,2020-06-20 11:08:14,Concept ACK cbdaa3a179c5011b651cb4c9cbcef482816d822d (I read the OP and don't disagree),https://github.com/bitcoin/bitcoin/pull/19240#issuecomment-646979912,646979912,
dongcarl,2020-06-20 14:33:16,"@MarcoFalke theuni said he'll run thru it once more on Monday, should be pretty safe after that!",https://github.com/bitcoin/bitcoin/pull/19240#issuecomment-647003262,647003262,
dongcarl,2020-06-22 14:19:24,"2418f739f75824d6689369f326b960cec254cf56 includes fanquake's recommendation [here](https://github.com/bitcoin/bitcoin/pull/19240#discussion_r443187584), and a modification that makes the history more readable (some leftover mistake from my squashing).\n\nShould be ready to merge once theuni takes a last look today.",https://github.com/bitcoin/bitcoin/pull/19240#issuecomment-647549412,647549412,
theuni,2020-06-22 20:53:32,"Actually, after digging through @fanquake's recommendation some more, it looks like the LD64_VERSION_NUM does **not** end up being passed through correctly. We can poke at clang's source to see what it does with that value. One easy-to-demonstrate case can be seen [here](https://github.com/llvm/llvm-project/blob/master/clang/lib/Driver/ToolChains/Darwin.cpp#L217)\n```c++\n  // Newer linkers supp",https://github.com/bitcoin/bitcoin/pull/19240#issuecomment-647764049,647764049,
dongcarl,2020-06-22 21:04:55,Good find! cherry-picked 718180005fb031713445498d89cc0565e5a6f6ec into this PR so that we only nuke depends cache once. @theuni anything else you want to address?,https://github.com/bitcoin/bitcoin/pull/19240#issuecomment-647768758,647768758,
dongcarl,2020-06-22 22:27:42,"Gitian build succeeded locally for me:\n```yml\n- out_manifest: |\n    5eb9795549bc1f3a91cfa4b8901db357343d6386a68c15298009546ed28f3f74  bitcoin-adf543d7144a-osx-unsigned.dmg\n    8f03081ef08035ee91c5fa10e1ddb86842cb318dd62ea923e7346c6f4306cd96  bitcoin-adf543d7144a-osx-unsigned.tar.gz\n    f065ab8d37a473c180bb92f7613de03ba3a1b5f604f0aaa2cd4dd8d9953a9e7f  bitcoin-adf543d7144a-osx64.tar.gz\n ",https://github.com/bitcoin/bitcoin/pull/19240#issuecomment-647800562,647800562,
Sjors,2020-06-23 09:18:50,Post merge: I get the same gitian result as @dongcarl found.,https://github.com/bitcoin/bitcoin/pull/19240#issuecomment-648019165,648019165,
MarcoFalke,2020-06-24 19:39:14,Is the `Xcode-11.3.1-11C505-extracted-SDK-with-libcxx-headers.tar.gz` deterministic and where can I get it without an apple account?,https://github.com/bitcoin/bitcoin/pull/19240#issuecomment-649026668,649026668,
MarcoFalke,2020-06-24 19:40:07,@jonasschnelli https://bitcoin.jonasschnelli.ch/gitian/#nighly also needs the new tar.gz,https://github.com/bitcoin/bitcoin/pull/19240#issuecomment-649027073,649027073,
theuni,2020-06-24 19:42:09,"> Is the `Xcode-11.3.1-11C505-extracted-SDK-with-libcxx-headers.tar.gz` deterministic and where can I get it without an apple account?\n\nThe .tar.gz is not deterministic for the usual tarball reasons, but its contents are.\n\nI'm afraid you'll need an apple account to grab Xcode.",https://github.com/bitcoin/bitcoin/pull/19240#issuecomment-649028022,649028022,
Sjors,2020-06-25 16:29:36,@MarcoFalke you can compare your results with mine: https://github.com/bitcoin/bitcoin/pull/19240#discussion_r442705416,https://github.com/bitcoin/bitcoin/pull/19240#issuecomment-649675463,649675463,
MarcoFalke,2020-06-27 12:58:28,Could someone please upload a mac build.log for me to compare? I get a mismatch,https://github.com/bitcoin/bitcoin/pull/19240#issuecomment-650558108,650558108,
laanwj,2020-06-11 17:56:36,I'm not sure keeping instructions around for previous SDKs is that useful. Only for the release that is used for building. Older information can always be found in git.,https://github.com/bitcoin/bitcoin/pull/19240#discussion_r438971235,438971235,contrib/macdeploy/README.md
dongcarl,2020-06-11 18:55:51,Fixed!,https://github.com/bitcoin/bitcoin/pull/19240#discussion_r439003009,439003009,contrib/macdeploy/README.md
theuni,2020-06-12 18:39:11,"""with the XCODEDIR environment variable pointing to..."",\nor\n""./contrib/macdeploy/gen_sdk_package.sh '/path/to/Xcode.app'""\n\nWhich is it? :)",https://github.com/bitcoin/bitcoin/pull/19240#discussion_r439584224,439584224,contrib/macdeploy/README.md
theuni,2020-06-12 18:40:16,"Can we name this something to indicate that we've included the headers as well?\n\nEdit: expanding on this: since builders presumably already have a different, incompatible MacOSX10.14.sdk in sources, I think it makes sense to rename the unpacked dir (SDK in hosts/darwin.mk) as well as the tarball to avoid clashes/confusion.",https://github.com/bitcoin/bitcoin/pull/19240#discussion_r439584662,439584662,contrib/macdeploy/gen-sdk.sh
theuni,2020-06-12 18:44:08,"gen_sdk_package.sh != gen-sdk.sh\n(below as well)",https://github.com/bitcoin/bitcoin/pull/19240#discussion_r439586410,439586410,contrib/macdeploy/README.md
Sjors,2020-06-15 18:02:19,"If we merge this, I'd like to move that repo over to the `bitcoin-core` org.",https://github.com/bitcoin/bitcoin/pull/19240#discussion_r440351980,440351980,contrib/macdeploy/README.md
Sjors,2020-06-15 18:04:18,"When running the extract tool `41bfaca0db3a900c52fb66b6eae794901b9510cb` on macOS 10.15.5 I'm flooded with:\n```\n../apple-sdk-tools/extract_xcode.py -f Xcode_10.2.1.xip| cpio -d -i\n./Xcode.app/Contents/Developer/Platforms/AppleTVSimulator.platform/Developer/SDKs/AppleTVSimulator.sdk/usr/include/_ctype.h: Can't create 'Xcode.app/Contents/Developer/Platforms/AppleTVSimulator.platform/Developer/",https://github.com/bitcoin/bitcoin/pull/19240#discussion_r440353007,440353007,contrib/macdeploy/README.md
Sjors,2020-06-15 18:31:26,"`0e7fe352b806ed3cd5a735e1aa476edd0b0c7a24918e49c4c4992203dab1ce28  MacOSX10.14-with-libcxx-headers.sdk.tar.gz` when run on macOS, but `6c6319005fe579d0dd174e15ef8d3beab63f1aed4d15e73305eba8c63ffebebb` on Ubuntu.",https://github.com/bitcoin/bitcoin/pull/19240#discussion_r440367430,440367430,contrib/macdeploy/README.md
dongcarl,2020-06-16 18:22:25,Nice!,https://github.com/bitcoin/bitcoin/pull/19240#discussion_r441054717,441054717,contrib/macdeploy/README.md
dongcarl,2020-06-16 18:23:26,"That's somewhat expected, as bsdtar and gnutar (and even different versions of gnutar) might lay out the archive in different ways that all conform to standard. :relaxed: ",https://github.com/bitcoin/bitcoin/pull/19240#discussion_r441055561,441055561,contrib/macdeploy/README.md
Sjors,2020-06-16 19:05:57,"If _you_ can live with a reproducibility issue, it must be fine :-) ",https://github.com/bitcoin/bitcoin/pull/19240#discussion_r441079306,441079306,contrib/macdeploy/README.md
theuni,2020-06-16 19:30:25,"This can be deleted now too, we know where to expect the c++ libs now.",https://github.com/bitcoin/bitcoin/pull/19240#discussion_r441092380,441092380,depends/packages/native_cctools.mk
Sjors,2020-06-19 08:03:22,"The URL is correct, but in my experience it never works directly, not even if you're logged in. I always need to manually navigate to https://developer.apple.com/download/more/ search for the correct Xcode version and then download. Also, maybe use 11.5?",https://github.com/bitcoin/bitcoin/pull/19240#discussion_r442694578,442694578,contrib/macdeploy/README.md
Sjors,2020-06-19 08:16:50,tested on macOS with 70de9bedd37b388cc5b486d4a5785c33896c262d,https://github.com/bitcoin/bitcoin/pull/19240#discussion_r442701121,442701121,contrib/macdeploy/README.md
Sjors,2020-06-19 08:25:27,"shasum, [generated as before](https://github.com/bitcoin/bitcoin/pull/19240#discussion_r440353007):\n`707b24ff63bf31e403ff45e97cbbf7d934c738f3f2aae85a37ecdcd896ca5dbb  shasum_list_sorted.txt`",https://github.com/bitcoin/bitcoin/pull/19240#discussion_r442705416,442705416,contrib/macdeploy/README.md
Sjors,2020-06-19 09:04:03,This is not Python 3.5.6 syntax (try with `pyenv`),https://github.com/bitcoin/bitcoin/pull/19240#discussion_r442720958,442720958,contrib/macdeploy/gen-sdk
fanquake,2020-06-19 09:30:20,">  Also, maybe use 11.5?\n\nNACK. 11.3.1 was picked specifically. It's what is referenced throughout the docs, build  system and  in the tarball name. There's also no guarantee that you'll generate the same tarball between various versions of Xcode.",https://github.com/bitcoin/bitcoin/pull/19240#discussion_r442733582,442733582,contrib/macdeploy/README.md
Sjors,2020-06-19 13:36:36,"What do you mean by ""picked specifically""? It's introduced in this PR. The only other place I see it is on the Travis macOS native machine, but the choice there doesn't matter. ",https://github.com/bitcoin/bitcoin/pull/19240#discussion_r442844818,442844818,contrib/macdeploy/README.md
theuni,2020-06-19 13:41:56,"Sorry for not explaining in more detail in the commit message.\n\n11.3.1 was chosen as the last Xcode version which uses (Apple's version of) clang 8.x.x, for which we have a matching cctools and ld64. Starting with 11.4, they bumped to clang 9.x.x. Once cctools-port has a working matching version for clang 9, we can bump to a newer Xcode version.\n\nEdit: This matters because the sdk/libc++ h",https://github.com/bitcoin/bitcoin/pull/19240#discussion_r442847693,442847693,contrib/macdeploy/README.md
dongcarl,2020-06-19 14:00:41,"A thought: to prevent future confusion, we should follow up this PR with documentation on the reasoning behind how our macOS toolchain is constructed.",https://github.com/bitcoin/bitcoin/pull/19240#discussion_r442857923,442857923,contrib/macdeploy/README.md
Sjors,2020-06-19 14:50:38,"More info would be a good followup. I'm surprised Apple would bump clang 8 to 9 in a minor Xcode version update. But actually that could make sense, because they want to give developers access to SDK's for their next generation(s) OS, without forcing devs to upgrade their production machine to a beta/recent macOS (which Xcode versions tend to track). According to [wikipedia](https://en.wikipedia.o",https://github.com/bitcoin/bitcoin/pull/19240#discussion_r442884871,442884871,contrib/macdeploy/README.md
dongcarl,2020-06-19 16:05:18,"Shame :frowning_face:, I like f-strings! Will redo with `.format`.",https://github.com/bitcoin/bitcoin/pull/19240#discussion_r442925398,442925398,contrib/macdeploy/gen-sdk
dongcarl,2020-06-19 16:19:48,"Done and tested with Python 3.5.9!\n",https://github.com/bitcoin/bitcoin/pull/19240#discussion_r442931980,442931980,contrib/macdeploy/gen-sdk
Sjors,2020-06-19 18:00:53,"This should use `{xcode_version}`, not `{version}`; it broke when you changed the formatting.",https://github.com/bitcoin/bitcoin/pull/19240#discussion_r442977075,442977075,contrib/macdeploy/gen-sdk
dongcarl,2020-06-19 18:36:41,Good catch! Fixed.,https://github.com/bitcoin/bitcoin/pull/19240#discussion_r442991315,442991315,contrib/macdeploy/gen-sdk
fanquake,2020-06-21 06:40:30,"```suggestion\n$(package)_version=4da2f3b485bcf4cef526f30c0b8c0bcda99cdbb4\n```",https://github.com/bitcoin/bitcoin/pull/19240#discussion_r443187584,443187584,depends/packages/native_cctools.mk
dongcarl,2020-06-22 14:17:46,Done!,https://github.com/bitcoin/bitcoin/pull/19240#discussion_r443591269,443591269,depends/packages/native_cctools.mk
theuni,2020-06-22 19:24:18,"Nice spot, thanks.",https://github.com/bitcoin/bitcoin/pull/19240#discussion_r443776097,443776097,depends/packages/native_cctools.mk
