[
  {
    "sha": "9583477288072e203541b747fcffe8d50cfefb8d",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5NTgzNDc3Mjg4MDcyZTIwMzU0MWI3NDdmY2ZmZThkNTBjZmVmYjhk",
    "commit": {
      "author": {
        "name": "Gregory Maxwell",
        "email": "greg@xiph.org",
        "date": "2016-10-17T23:08:52Z"
      },
      "committer": {
        "name": "Gregory Maxwell",
        "email": "greg@xiph.org",
        "date": "2016-10-17T23:08:52Z"
      },
      "message": "Be more aggressive in connecting to peers with relevant services.\n\nOnly allow skipping relevant services until there are four outbound\n connections up.\n\nThis avoids quickly filling up with peers lacking the relevant\n services when addrman has few or none of them.",
      "tree": {
        "sha": "6ef99e228311d612669e8ad7dffc5e84eb8d60b2",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6ef99e228311d612669e8ad7dffc5e84eb8d60b2"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9583477288072e203541b747fcffe8d50cfefb8d",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9583477288072e203541b747fcffe8d50cfefb8d",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/9583477288072e203541b747fcffe8d50cfefb8d",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9583477288072e203541b747fcffe8d50cfefb8d/comments",
    "author": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "763828df499f67c1c9d669d3223bd0636ed2b185",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/763828df499f67c1c9d669d3223bd0636ed2b185",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/763828df499f67c1c9d669d3223bd0636ed2b185"
      }
    ],
    "stats": {
      "total": 4,
      "additions": 2,
      "deletions": 2
    },
    "files": [
      {
        "sha": "de8f8184a28c9e333e7386204bf507f47e71661e",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9583477288072e203541b747fcffe8d50cfefb8d/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9583477288072e203541b747fcffe8d50cfefb8d/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=9583477288072e203541b747fcffe8d50cfefb8d",
        "patch": "@@ -1675,8 +1675,8 @@ void CConnman::ThreadOpenConnections()\n             if (nANow - addr.nLastTry < 600 && nTries < 30)\n                 continue;\n \n-            // only consider nodes missing relevant services after 40 failed attempts\n-            if ((addr.nServices & nRelevantServices) != nRelevantServices && nTries < 40)\n+            // only consider nodes missing relevant services after 40 failed attempts and only if less than half the outbound are up.\n+            if ((addr.nServices & nRelevantServices) != nRelevantServices && (nTries < 40 || nOutbound >= (nMaxOutbound >> 1)))\n                 continue;\n \n             // do not allow non-default ports, unless after 50 invalid addresses selected already"
      }
    ]
  },
  {
    "sha": "46304791353d2bb61004a035869612620c30b4eb",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0NjMwNDc5MTM1M2QyYmI2MTAwNGEwMzU4Njk2MTI2MjBjMzBiNGVi",
    "commit": {
      "author": {
        "name": "Gregory Maxwell",
        "email": "greg@xiph.org",
        "date": "2016-10-17T23:11:35Z"
      },
      "committer": {
        "name": "Gregory Maxwell",
        "email": "greg@xiph.org",
        "date": "2016-10-19T08:07:02Z"
      },
      "message": "Make dnsseed's definition of acute need include relevant services.\n\nWe normally prefer to connect to peers offering the relevant services.\n\nIf we're not connected to enough peers with relevant services, we\n probably don't know about them and could use dnsseed's help.",
      "tree": {
        "sha": "6e3a8a5357a80d877f016ed2f66f35847af67853",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6e3a8a5357a80d877f016ed2f66f35847af67853"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/46304791353d2bb61004a035869612620c30b4eb",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/46304791353d2bb61004a035869612620c30b4eb",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/46304791353d2bb61004a035869612620c30b4eb",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/46304791353d2bb61004a035869612620c30b4eb/comments",
    "author": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "9583477288072e203541b747fcffe8d50cfefb8d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9583477288072e203541b747fcffe8d50cfefb8d",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/9583477288072e203541b747fcffe8d50cfefb8d"
      }
    ],
    "stats": {
      "total": 9,
      "additions": 8,
      "deletions": 1
    },
    "files": [
      {
        "sha": "99f5604ff220e2cf8dd046a4a9a19f841267f5e4",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 8,
        "deletions": 1,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/46304791353d2bb61004a035869612620c30b4eb/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/46304791353d2bb61004a035869612620c30b4eb/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=46304791353d2bb61004a035869612620c30b4eb",
        "patch": "@@ -1462,12 +1462,19 @@ static std::string GetDNSHost(const CDNSSeedData& data, ServiceFlags* requiredSe\n void CConnman::ThreadDNSAddressSeed()\n {\n     // goal: only query DNS seeds if address need is acute\n+    // Avoiding DNS seeds when we don't need them improves user privacy by\n+    //  creating fewer identifying DNS requests, reduces trust by giving seeds\n+    //  less influence on the network topology, and reduces traffic to the seeds.\n     if ((addrman.size() > 0) &&\n         (!GetBoolArg(\"-forcednsseed\", DEFAULT_FORCEDNSSEED))) {\n         MilliSleep(11 * 1000);\n \n         LOCK(cs_vNodes);\n-        if (vNodes.size() >= 2) {\n+        int nRelevant = 0;\n+        for (auto pnode : vNodes) {\n+            nRelevant += pnode->fSuccessfullyConnected && ((pnode->nServices & nRelevantServices) == nRelevantServices);\n+        }\n+        if (nRelevant >= 2) {\n             LogPrintf(\"P2P peers available. Skipped DNS seeding.\\n\");\n             return;\n         }"
      }
    ]
  }
]