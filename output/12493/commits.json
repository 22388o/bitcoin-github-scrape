[
  {
    "sha": "a769461d5e37ddcb771ae836254fdc69177a28c4",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzphNzY5NDYxZDVlMzdkZGNiNzcxYWU4MzYyNTRmZGM2OTE3N2EyOGM0",
    "commit": {
      "author": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2018-07-14T02:15:30Z"
      },
      "committer": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2018-08-09T18:27:39Z"
      },
      "message": "Move BerkeleyEnvironment deletion from internal method to callsite\n\nInstead of having the object destroy itself, having the caller\ndestroy it.",
      "tree": {
        "sha": "e3d465a596a7dedfe0555ddcce113df32c034ca6",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e3d465a596a7dedfe0555ddcce113df32c034ca6"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a769461d5e37ddcb771ae836254fdc69177a28c4",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a769461d5e37ddcb771ae836254fdc69177a28c4",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/a769461d5e37ddcb771ae836254fdc69177a28c4",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a769461d5e37ddcb771ae836254fdc69177a28c4/comments",
    "author": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "f66e1c793eda7a6143fd03400c98512a9b6f00c7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f66e1c793eda7a6143fd03400c98512a9b6f00c7",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/f66e1c793eda7a6143fd03400c98512a9b6f00c7"
      }
    ],
    "stats": {
      "total": 7,
      "additions": 5,
      "deletions": 2
    },
    "files": [
      {
        "sha": "536243be4f0a91863d578bca96a3ea626de5346f",
        "filename": "src/wallet/db.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 2,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/a769461d5e37ddcb771ae836254fdc69177a28c4/src/wallet/db.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/a769461d5e37ddcb771ae836254fdc69177a28c4/src/wallet/db.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/db.cpp?ref=a769461d5e37ddcb771ae836254fdc69177a28c4",
        "patch": "@@ -697,7 +697,6 @@ void BerkeleyEnvironment::Flush(bool fShutdown)\n                 if (!fMockDb) {\n                     fs::remove_all(fs::path(strPath) / \"database\");\n                 }\n-                g_dbenvs.erase(strPath);\n             }\n         }\n     }\n@@ -796,6 +795,10 @@ void BerkeleyDatabase::Flush(bool shutdown)\n {\n     if (!IsDummy()) {\n         env->Flush(shutdown);\n-        if (shutdown) env = nullptr;\n+        if (shutdown) {\n+            LOCK(cs_db);\n+            g_dbenvs.erase(env->Directory().string());\n+            env = nullptr;\n+        }\n     }\n }"
      }
    ]
  },
  {
    "sha": "5d296ac810755dc47f105eb95b52b7e2bcb8aea8",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1ZDI5NmFjODEwNzU1ZGM0N2YxMDVlYjk1YjUyYjdlMmJjYjhhZWE4",
    "commit": {
      "author": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2018-02-20T20:28:42Z"
      },
      "committer": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2018-08-09T18:27:39Z"
      },
      "message": "Add function to close all Db's and reload the databae environment\n\nAdds a ReloadDbEnv function to BerkeleyEnvironment in order to close all Db\ninstances, closes the environment, resets it, and then reopens\nthe BerkeleyEnvironment.\n\nAlso adds a ReloadDbEnv function to BerkeleyDatabase that calls\nBerkeleyEnvironment's ReloadDbEnv.",
      "tree": {
        "sha": "9a3ffe538c0216ee958811d4d1a041c41d7deb72",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9a3ffe538c0216ee958811d4d1a041c41d7deb72"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5d296ac810755dc47f105eb95b52b7e2bcb8aea8",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5d296ac810755dc47f105eb95b52b7e2bcb8aea8",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/5d296ac810755dc47f105eb95b52b7e2bcb8aea8",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5d296ac810755dc47f105eb95b52b7e2bcb8aea8/comments",
    "author": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "a769461d5e37ddcb771ae836254fdc69177a28c4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a769461d5e37ddcb771ae836254fdc69177a28c4",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/a769461d5e37ddcb771ae836254fdc69177a28c4"
      }
    ],
    "stats": {
      "total": 38,
      "additions": 38,
      "deletions": 0
    },
    "files": [
      {
        "sha": "2d57c92ccc90344c5326d07ff44c62242bf16d40",
        "filename": "src/wallet/db.cpp",
        "status": "modified",
        "additions": 34,
        "deletions": 0,
        "changes": 34,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5d296ac810755dc47f105eb95b52b7e2bcb8aea8/src/wallet/db.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5d296ac810755dc47f105eb95b52b7e2bcb8aea8/src/wallet/db.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/db.cpp?ref=5d296ac810755dc47f105eb95b52b7e2bcb8aea8",
        "patch": "@@ -556,6 +556,7 @@ void BerkeleyBatch::Close()\n         LOCK(cs_db);\n         --env->mapFileUseCount[strFile];\n     }\n+    env->m_db_in_use.notify_all();\n }\n \n void BerkeleyEnvironment::CloseDb(const std::string& strFile)\n@@ -572,6 +573,32 @@ void BerkeleyEnvironment::CloseDb(const std::string& strFile)\n     }\n }\n \n+void BerkeleyEnvironment::ReloadDbEnv()\n+{\n+    // Make sure that no Db's are in use\n+    AssertLockNotHeld(cs_db);\n+    std::unique_lock<CCriticalSection> lock(cs_db);\n+    m_db_in_use.wait(lock, [this](){\n+        for (auto& count : mapFileUseCount) {\n+            if (count.second > 0) return false;\n+        }\n+        return true;\n+    });\n+\n+    std::vector<std::string> filenames;\n+    for (auto it : mapDb) {\n+        filenames.push_back(it.first);\n+    }\n+    // Close the individual Db's\n+    for (const std::string& filename : filenames) {\n+        CloseDb(filename);\n+    }\n+    // Reset the environment\n+    Flush(true); // This will flush and close the environment\n+    Reset();\n+    Open(true);\n+}\n+\n bool BerkeleyBatch::Rewrite(BerkeleyDatabase& database, const char* pszSkip)\n {\n     if (database.IsDummy()) {\n@@ -802,3 +829,10 @@ void BerkeleyDatabase::Flush(bool shutdown)\n         }\n     }\n }\n+\n+void BerkeleyDatabase::ReloadDbEnv()\n+{\n+    if (!IsDummy()) {\n+        env->ReloadDbEnv();\n+    }\n+}"
      },
      {
        "sha": "467ed13b450e8570f44d54fb2c6d9d0190003ac2",
        "filename": "src/wallet/db.h",
        "status": "modified",
        "additions": 4,
        "deletions": 0,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5d296ac810755dc47f105eb95b52b7e2bcb8aea8/src/wallet/db.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5d296ac810755dc47f105eb95b52b7e2bcb8aea8/src/wallet/db.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/db.h?ref=5d296ac810755dc47f105eb95b52b7e2bcb8aea8",
        "patch": "@@ -38,6 +38,7 @@ class BerkeleyEnvironment\n     std::unique_ptr<DbEnv> dbenv;\n     std::map<std::string, int> mapFileUseCount;\n     std::map<std::string, Db*> mapDb;\n+    std::condition_variable_any m_db_in_use;\n \n     BerkeleyEnvironment(const fs::path& env_directory);\n     ~BerkeleyEnvironment();\n@@ -75,6 +76,7 @@ class BerkeleyEnvironment\n     void CheckpointLSN(const std::string& strFile);\n \n     void CloseDb(const std::string& strFile);\n+    void ReloadDbEnv();\n \n     DbTxn* TxnBegin(int flags = DB_TXN_WRITE_NOSYNC)\n     {\n@@ -145,6 +147,8 @@ class BerkeleyDatabase\n \n     void IncrementUpdateCounter();\n \n+    void ReloadDbEnv();\n+\n     std::atomic<unsigned int> nUpdateCounter;\n     unsigned int nLastSeen;\n     unsigned int nLastFlushed;"
      }
    ]
  },
  {
    "sha": "d7637c5a3f1d62922594cdfb6272e30dacf60ce9",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpkNzYzN2M1YTNmMWQ2MjkyMjU5NGNkZmI2MjcyZTMwZGFjZjYwY2U5",
    "commit": {
      "author": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2018-02-20T21:08:36Z"
      },
      "committer": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2018-08-09T18:27:39Z"
      },
      "message": "After encrypting the wallet, reload the database environment\n\nCalls ReloadDbEnv after encrypting the wallet so that the database\nenvironment is flushed, closed, and reopened to prevent unencrypted\nkeys from being saved on disk.",
      "tree": {
        "sha": "7b1647fd1c1e26914c1a7a41a7e37ee055df9ce4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7b1647fd1c1e26914c1a7a41a7e37ee055df9ce4"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d7637c5a3f1d62922594cdfb6272e30dacf60ce9",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d7637c5a3f1d62922594cdfb6272e30dacf60ce9",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/d7637c5a3f1d62922594cdfb6272e30dacf60ce9",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d7637c5a3f1d62922594cdfb6272e30dacf60ce9/comments",
    "author": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "5d296ac810755dc47f105eb95b52b7e2bcb8aea8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5d296ac810755dc47f105eb95b52b7e2bcb8aea8",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/5d296ac810755dc47f105eb95b52b7e2bcb8aea8"
      }
    ],
    "stats": {
      "total": 5,
      "additions": 5,
      "deletions": 0
    },
    "files": [
      {
        "sha": "61d068622898007e6a7ef64e4b7c6438b6b1112e",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 0,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d7637c5a3f1d62922594cdfb6272e30dacf60ce9/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d7637c5a3f1d62922594cdfb6272e30dacf60ce9/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=d7637c5a3f1d62922594cdfb6272e30dacf60ce9",
        "patch": "@@ -719,6 +719,11 @@ bool CWallet::EncryptWallet(const SecureString& strWalletPassphrase)\n         // bits of the unencrypted private key in slack space in the database file.\n         database->Rewrite();\n \n+        // BDB seems to have a bad habit of writing old data into\n+        // slack space in .dat files; that is bad if the old data is\n+        // unencrypted private keys. So:\n+        database->ReloadDbEnv();\n+\n     }\n     NotifyStatusChanged(this);\n "
      }
    ]
  },
  {
    "sha": "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpjMWRkZTNhOTQ5YjM2Y2U5YzIxNTU3NzdiM2ZhMTM3MmU3ZWQ5N2Q4",
    "commit": {
      "author": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2018-02-20T21:09:51Z"
      },
      "committer": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2018-08-09T18:28:33Z"
      },
      "message": "No longer shutdown after encrypting the wallet\n\nSince the database environment is flushed, closed, and reopened during\nEncryptWallet, there is no need to shut down the software anymore.",
      "tree": {
        "sha": "9cb5be1a30f907106f3968a384eeb905cef660b9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9cb5be1a30f907106f3968a384eeb905cef660b9"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c1dde3a949b36ce9c2155777b3fa1372e7ed97d8/comments",
    "author": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "d7637c5a3f1d62922594cdfb6272e30dacf60ce9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d7637c5a3f1d62922594cdfb6272e30dacf60ce9",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/d7637c5a3f1d62922594cdfb6272e30dacf60ce9"
      }
    ],
    "stats": {
      "total": 39,
      "additions": 9,
      "deletions": 30
    },
    "files": [
      {
        "sha": "612331523e0e0afa76e7b5bc282f906250cdcb71",
        "filename": "src/qt/askpassphrasedialog.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 3,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c1dde3a949b36ce9c2155777b3fa1372e7ed97d8/src/qt/askpassphrasedialog.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c1dde3a949b36ce9c2155777b3fa1372e7ed97d8/src/qt/askpassphrasedialog.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/askpassphrasedialog.cpp?ref=c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
        "patch": "@@ -123,16 +123,15 @@ void AskPassphraseDialog::accept()\n                 {\n                     QMessageBox::warning(this, tr(\"Wallet encrypted\"),\n                                          \"<qt>\" +\n-                                         tr(\"%1 will close now to finish the encryption process. \"\n+                                         tr(\"Your wallet is now encrypted. \"\n                                          \"Remember that encrypting your wallet cannot fully protect \"\n-                                         \"your bitcoins from being stolen by malware infecting your computer.\").arg(tr(PACKAGE_NAME)) +\n+                                         \"your bitcoins from being stolen by malware infecting your computer.\") +\n                                          \"<br><br><b>\" +\n                                          tr(\"IMPORTANT: Any previous backups you have made of your wallet file \"\n                                          \"should be replaced with the newly generated, encrypted wallet file. \"\n                                          \"For security reasons, previous backups of the unencrypted wallet file \"\n                                          \"will become useless as soon as you start using the new, encrypted wallet.\") +\n                                          \"</b></qt>\");\n-                    QApplication::quit();\n                 }\n                 else\n                 {"
      },
      {
        "sha": "a1d58aba0536bc89f27a1ca2adcf358bbdd31c13",
        "filename": "src/wallet/rpcwallet.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 6,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c1dde3a949b36ce9c2155777b3fa1372e7ed97d8/src/wallet/rpcwallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c1dde3a949b36ce9c2155777b3fa1372e7ed97d8/src/wallet/rpcwallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcwallet.cpp?ref=c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
        "patch": "@@ -2729,7 +2729,6 @@ static UniValue encryptwallet(const JSONRPCRequest& request)\n             \"will require the passphrase to be set prior the making these calls.\\n\"\n             \"Use the walletpassphrase call for this, and then walletlock call.\\n\"\n             \"If the wallet is already encrypted, use the walletpassphrasechange call.\\n\"\n-            \"Note that this will shutdown the server.\\n\"\n             \"\\nArguments:\\n\"\n             \"1. \\\"passphrase\\\"    (string) The pass phrase to encrypt the wallet with. It must be at least 1 character, but should be long.\\n\"\n             \"\\nExamples:\\n\"\n@@ -2767,11 +2766,7 @@ static UniValue encryptwallet(const JSONRPCRequest& request)\n         throw JSONRPCError(RPC_WALLET_ENCRYPTION_FAILED, \"Error: Failed to encrypt the wallet.\");\n     }\n \n-    // BDB seems to have a bad habit of writing old data into\n-    // slack space in .dat files; that is bad if the old data is\n-    // unencrypted private keys. So:\n-    StartShutdown();\n-    return \"wallet encrypted; Bitcoin server stopping, restart to run with encrypted wallet. The keypool has been flushed and a new HD seed was generated (if you are using HD). You need to make a new backup.\";\n+    return \"wallet encrypted; The keypool has been flushed and a new HD seed was generated (if you are using HD). You need to make a new backup.\";\n }\n \n static UniValue lockunspent(const JSONRPCRequest& request)"
      },
      {
        "sha": "a4985a7a18c9f0cdbf2358502c902cf0952a7ed8",
        "filename": "test/functional/rpc_fundrawtransaction.py",
        "status": "modified",
        "additions": 2,
        "deletions": 4,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c1dde3a949b36ce9c2155777b3fa1372e7ed97d8/test/functional/rpc_fundrawtransaction.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c1dde3a949b36ce9c2155777b3fa1372e7ed97d8/test/functional/rpc_fundrawtransaction.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/rpc_fundrawtransaction.py?ref=c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
        "patch": "@@ -475,10 +475,8 @@ def run_test(self):\n \n         ############################################################\n         # locked wallet test\n-        self.stop_node(0)\n-        self.nodes[1].node_encrypt_wallet(\"test\")\n-        self.stop_node(2)\n-        self.stop_node(3)\n+        self.nodes[1].encryptwallet(\"test\")\n+        self.stop_nodes()\n \n         self.start_nodes()\n         # This test is not meant to test fee estimation and we'd like"
      },
      {
        "sha": "792d74de51a0024b8c81a566097ab75df3ef479e",
        "filename": "test/functional/test_framework/test_node.py",
        "status": "modified",
        "additions": 0,
        "deletions": 8,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c1dde3a949b36ce9c2155777b3fa1372e7ed97d8/test/functional/test_framework/test_node.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c1dde3a949b36ce9c2155777b3fa1372e7ed97d8/test/functional/test_framework/test_node.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/test_framework/test_node.py?ref=c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
        "patch": "@@ -268,14 +268,6 @@ def assert_start_raises_init_error(self, extra_args=None, expected_msg=None, mat\n                     assert_msg = \"bitcoind should have exited with expected error \" + expected_msg\n                 self._raise_assertion_error(assert_msg)\n \n-    def node_encrypt_wallet(self, passphrase):\n-        \"\"\"\"Encrypts the wallet.\n-\n-        This causes bitcoind to shutdown, so this method takes\n-        care of cleaning up resources.\"\"\"\n-        self.encryptwallet(passphrase)\n-        self.wait_until_stopped()\n-\n     def add_p2p_connection(self, p2p_conn, *, wait_for_verack=True, **kwargs):\n         \"\"\"Add a p2p connection to the node.\n "
      },
      {
        "sha": "5a7a1375ae2fb35e606952b04781c19bf3445c9c",
        "filename": "test/functional/wallet_bumpfee.py",
        "status": "modified",
        "additions": 1,
        "deletions": 2,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c1dde3a949b36ce9c2155777b3fa1372e7ed97d8/test/functional/wallet_bumpfee.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c1dde3a949b36ce9c2155777b3fa1372e7ed97d8/test/functional/wallet_bumpfee.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/wallet_bumpfee.py?ref=c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
        "patch": "@@ -36,8 +36,7 @@ def set_test_params(self):\n \n     def run_test(self):\n         # Encrypt wallet for test_locked_wallet_fails test\n-        self.nodes[1].node_encrypt_wallet(WALLET_PASSPHRASE)\n-        self.start_node(1)\n+        self.nodes[1].encryptwallet(WALLET_PASSPHRASE)\n         self.nodes[1].walletpassphrase(WALLET_PASSPHRASE, WALLET_PASSPHRASE_TIMEOUT)\n \n         connect_nodes_bi(self.nodes, 0, 1)"
      },
      {
        "sha": "7ddfd2c808b2196fe7648f2c8c6cf03ab5f43ce0",
        "filename": "test/functional/wallet_dump.py",
        "status": "modified",
        "additions": 1,
        "deletions": 2,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c1dde3a949b36ce9c2155777b3fa1372e7ed97d8/test/functional/wallet_dump.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c1dde3a949b36ce9c2155777b3fa1372e7ed97d8/test/functional/wallet_dump.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/wallet_dump.py?ref=c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
        "patch": "@@ -121,8 +121,7 @@ def run_test(self):\n         assert_equal(witness_addr_ret, witness_addr) # p2sh-p2wsh address added to the first key\n \n         #encrypt wallet, restart, unlock and dump\n-        self.nodes[0].node_encrypt_wallet('test')\n-        self.start_node(0)\n+        self.nodes[0].encryptwallet('test')\n         self.nodes[0].walletpassphrase('test', 10)\n         # Should be a no-op:\n         self.nodes[0].keypoolrefill()"
      },
      {
        "sha": "d5e797164bfdfb6dc27b81b11b72deed5d262eb8",
        "filename": "test/functional/wallet_encryption.py",
        "status": "modified",
        "additions": 1,
        "deletions": 2,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c1dde3a949b36ce9c2155777b3fa1372e7ed97d8/test/functional/wallet_encryption.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c1dde3a949b36ce9c2155777b3fa1372e7ed97d8/test/functional/wallet_encryption.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/wallet_encryption.py?ref=c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
        "patch": "@@ -30,8 +30,7 @@ def run_test(self):\n         assert_equal(len(privkey), 52)\n \n         # Encrypt the wallet\n-        self.nodes[0].node_encrypt_wallet(passphrase)\n-        self.start_node(0)\n+        self.nodes[0].encryptwallet(passphrase)\n \n         # Test that the wallet is encrypted\n         assert_raises_rpc_error(-13, \"Please enter the wallet passphrase with walletpassphrase first\", self.nodes[0].dumpprivkey, address)"
      },
      {
        "sha": "1d8e0cdf326d82df7797cd083b8b2f175fce6f73",
        "filename": "test/functional/wallet_keypool.py",
        "status": "modified",
        "additions": 1,
        "deletions": 3,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c1dde3a949b36ce9c2155777b3fa1372e7ed97d8/test/functional/wallet_keypool.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c1dde3a949b36ce9c2155777b3fa1372e7ed97d8/test/functional/wallet_keypool.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/wallet_keypool.py?ref=c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
        "patch": "@@ -20,9 +20,7 @@ def run_test(self):\n         assert(addr_before_encrypting_data['hdseedid'] == wallet_info_old['hdseedid'])\n \n         # Encrypt wallet and wait to terminate\n-        nodes[0].node_encrypt_wallet('test')\n-        # Restart node 0\n-        self.start_node(0)\n+        nodes[0].encryptwallet('test')\n         # Keep creating keys\n         addr = nodes[0].getnewaddress()\n         addr_data = nodes[0].getaddressinfo(addr)"
      }
    ]
  }
]