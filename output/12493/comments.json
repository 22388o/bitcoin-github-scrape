[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/367205750",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#issuecomment-367205750",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12493",
    "id": 367205750,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NzIwNTc1MA==",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?u=9791e96cd4268d48e3517bac41eaf2b1d09759fd&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-21T03:54:36Z",
    "updated_at": "2018-02-21T03:54:36Z",
    "author_association": "MEMBER",
    "body": "@ryanofsky I've implemented something which is basically what you described. It seems to work, although I'm not sure how to test the thread safe-ness of it. Let me know what you think.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/367205750/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/376978070",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#issuecomment-376978070",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12493",
    "id": 376978070,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3Njk3ODA3MA==",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?u=9791e96cd4268d48e3517bac41eaf2b1d09759fd&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-28T17:56:12Z",
    "updated_at": "2018-03-28T17:56:12Z",
    "author_association": "MEMBER",
    "body": "Rebased",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/376978070/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/377704231",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#issuecomment-377704231",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12493",
    "id": 377704231,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NzcwNDIzMQ==",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?u=9791e96cd4268d48e3517bac41eaf2b1d09759fd&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-31T16:16:30Z",
    "updated_at": "2018-03-31T16:16:30Z",
    "author_association": "MEMBER",
    "body": "Fixed travis and rebased again.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/377704231/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/380952269",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#issuecomment-380952269",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12493",
    "id": 380952269,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MDk1MjI2OQ==",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?u=9791e96cd4268d48e3517bac41eaf2b1d09759fd&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-12T21:38:07Z",
    "updated_at": "2018-04-12T21:38:07Z",
    "author_association": "MEMBER",
    "body": "Rebased",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/380952269/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/386778518",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#issuecomment-386778518",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12493",
    "id": 386778518,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4Njc3ODUxOA==",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?u=9791e96cd4268d48e3517bac41eaf2b1d09759fd&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-05-05T04:36:00Z",
    "updated_at": "2018-05-05T04:36:00Z",
    "author_association": "MEMBER",
    "body": "Review beg",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/386778518/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/396685450",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#issuecomment-396685450",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12493",
    "id": 396685450,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NjY4NTQ1MA==",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?u=9791e96cd4268d48e3517bac41eaf2b1d09759fd&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-12T18:17:02Z",
    "updated_at": "2018-06-12T18:17:02Z",
    "author_association": "MEMBER",
    "body": "Review Beg?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/396685450/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/404984674",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#issuecomment-404984674",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12493",
    "id": 404984674,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwNDk4NDY3NA==",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?u=7999a16349f0df0fb273fffa18e5a955c9d3f11c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-14T00:26:57Z",
    "updated_at": "2018-07-14T00:26:57Z",
    "author_association": "MEMBER",
    "body": "utACK 06f17267ddafa089f093cfffc181d8c834d346e7",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/404984674/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/404991778",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#issuecomment-404991778",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12493",
    "id": 404991778,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwNDk5MTc3OA==",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?u=9791e96cd4268d48e3517bac41eaf2b1d09759fd&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-14T02:17:02Z",
    "updated_at": "2018-07-14T02:17:02Z",
    "author_association": "MEMBER",
    "body": "Rebased and added a commit to fix the silent merge conflict (test failure).",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/404991778/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/405052421",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#issuecomment-405052421",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12493",
    "id": 405052421,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwNTA1MjQyMQ==",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?u=7999a16349f0df0fb273fffa18e5a955c9d3f11c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-14T21:57:17Z",
    "updated_at": "2018-07-14T21:57:17Z",
    "author_association": "MEMBER",
    "body": "utACK bdad9c40595c1e4959ebce1b55894060b2d7c146",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/405052421/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/411856214",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#issuecomment-411856214",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12493",
    "id": 411856214,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxMTg1NjIxNA==",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?u=9791e96cd4268d48e3517bac41eaf2b1d09759fd&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-08-09T18:39:30Z",
    "updated_at": "2018-08-09T18:39:30Z",
    "author_association": "MEMBER",
    "body": "Rebased",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/411856214/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/417147646",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#issuecomment-417147646",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12493",
    "id": 417147646,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxNzE0NzY0Ng==",
    "user": {
      "login": "PierreRochard",
      "id": 6299681,
      "node_id": "MDQ6VXNlcjYyOTk2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6299681?u=b01d3339e84633808b268c93a82c7af1b4229b7f&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PierreRochard",
      "html_url": "https://github.com/PierreRochard",
      "followers_url": "https://api.github.com/users/PierreRochard/followers",
      "following_url": "https://api.github.com/users/PierreRochard/following{/other_user}",
      "gists_url": "https://api.github.com/users/PierreRochard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PierreRochard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PierreRochard/subscriptions",
      "organizations_url": "https://api.github.com/users/PierreRochard/orgs",
      "repos_url": "https://api.github.com/users/PierreRochard/repos",
      "events_url": "https://api.github.com/users/PierreRochard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PierreRochard/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-08-30T00:08:26Z",
    "updated_at": "2018-09-03T13:32:59Z",
    "author_association": "CONTRIBUTOR",
    "body": "Tested ACK c1dde3a949b36ce9c2155777b3fa1372e7ed97d8, this is a good UX improvement, thanks @achow101 \r\n\r\nI manually tested that there were indeed private keys in the logs after encrypting with the environment reload commented out, tested that reloading the environment does remove the logs with a lightly modified version of @achow101's script https://github.com/PierreRochard/bitcoin/commit/e9cd31c448622cd9030879706661bae5c4c6f3bb\r\n\r\nI manually tested the thread safety when two wallet Dbs are in the same environment using @ryanofsky's approach https://github.com/PierreRochard/bitcoin/commit/154dd6e147986c7ec8cbd005bb6e8e17a2e45ea7\r\n\r\nNB: I think I found a bug when setting the thread safety test up, the default wallet and a loaded wallet which are in the same directory will be in two different environments because the ~~default wallet's BerkeleyEnvironment object's `strPath` member~~ `walletdir` I passed in the config has a trailing slash but `loadwallet regtest2.dat` results in an environment without the trailing slash:\r\nhttps://gist.github.com/PierreRochard/47ae74e5c0bc618a3b1a3f5ae5443196\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/417147646/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/417152036",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#issuecomment-417152036",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12493",
    "id": 417152036,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxNzE1MjAzNg==",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?u=4a9af998e1a560b3f49c3827f453e1bcbe6a5cfb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-08-30T00:36:55Z",
    "updated_at": "2018-08-30T00:36:55Z",
    "author_association": "MEMBER",
    "body": "@PierreRochard I'll try to reproduce it.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/417152036/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/417439664",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#issuecomment-417439664",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12493",
    "id": 417439664,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxNzQzOTY2NA==",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?u=eab5d0cdbb6cc25087cb61d4ca4a6f85255f42a7&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-08-30T19:30:04Z",
    "updated_at": "2018-08-30T19:30:04Z",
    "author_association": "CONTRIBUTOR",
    "body": "utACK c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/417439664/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/418232427",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#issuecomment-418232427",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12493",
    "id": 418232427,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODIzMjQyNw==",
    "user": {
      "login": "ken2812221",
      "id": 11154118,
      "node_id": "MDQ6VXNlcjExMTU0MTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/11154118?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ken2812221",
      "html_url": "https://github.com/ken2812221",
      "followers_url": "https://api.github.com/users/ken2812221/followers",
      "following_url": "https://api.github.com/users/ken2812221/following{/other_user}",
      "gists_url": "https://api.github.com/users/ken2812221/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ken2812221/subscriptions",
      "organizations_url": "https://api.github.com/users/ken2812221/orgs",
      "repos_url": "https://api.github.com/users/ken2812221/repos",
      "events_url": "https://api.github.com/users/ken2812221/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ken2812221/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-04T03:42:31Z",
    "updated_at": "2018-09-04T03:42:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "Tested ACK c1dde3a",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/418232427/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/475078282",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#issuecomment-475078282",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12493",
    "id": 475078282,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NTA3ODI4Mg==",
    "user": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?u=a0e0040aacd7d4f0787481e8ac30b494fa429e11&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-21T00:29:08Z",
    "updated_at": "2019-03-21T00:29:08Z",
    "author_association": "MEMBER",
    "body": "Release note added in https://github.com/bitcoin-core/bitcoin-devwiki/wiki/0.18.0-Release-Notes-Draft/_compare/f36c2a4%5E...f36c2a4.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/475078282/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169511450",
    "pull_request_review_id": 98049174,
    "id": 169511450,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2OTUxMTQ1MA==",
    "diff_hunk": "@@ -509,6 +509,22 @@ void CDBEnv::CloseDb(const std::string& strFile)\n     }\n }\n \n+void CDBEnv::ReloadDbEnv()\n+{\n+    std::vector<std::string> filenames;\n+    for (auto it : mapDb) {\n+        filenames.push_back(it.first);\n+    }\n+    // Close the individual Db's\n+    for (std::string filename : filenames) {\n+        CloseDb(filename);",
    "path": "src/wallet/db.cpp",
    "position": null,
    "original_position": 12,
    "commit_id": "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "original_commit_id": "6b2b3a76980ab0c3418d46a5df8040eaa160f449",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This is a great start! I don't think think it is thread safe yet, though, because in parallel with this thread, a block connected notification could be coming in, or another another RPC could be being made that is using one of the `Db*` or `DbEnv*` pointers that this closes.\r\n\r\nI think all you need to do to make this thread safe is wait for the `mapFileUseCount` entries to go to zero. You could do this with a condition variable. For example, if you added a `std::condition_variable m_cv_in_use;` member to `CDBEnv` you could trigger it in `CDB::Close`:\r\n\r\n```c++\r\nm_cv_in_use.notify_all()\r\n```\r\n\r\nand wait for it at the top of `CDBEnv::ReloadDbEnv`:\r\n\r\n```c++\r\nWAIT_LOCK(cs_db, lock);\r\nm_cv_in_use.wait(lock, [this](){\r\n    for (count : mapFileUseCount) {\r\n        if (count.second > 0) return false;\r\n    }\r\n    return true;\r\n});\r\n```\r\n\r\nThis is one possible approach. Other approaches may be simpler or better. One drawback of this approach is that if there are a lot of background writes happening in different wallets, ReloadDbEnv could get starved out waiting for all wallets to be simultaneously not in use.",
    "created_at": "2018-02-21T01:16:48Z",
    "updated_at": "2018-08-09T18:39:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169511450",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169511450"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169511450"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169511450/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 594,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169655317",
    "pull_request_review_id": 98215449,
    "id": 169655317,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2OTY1NTMxNw==",
    "diff_hunk": "@@ -35,10 +35,11 @@ class CDBEnv\n     void EnvShutdown();\n \n public:\n-    mutable CCriticalSection cs_db;\n+    std::recursive_mutex cs_db;",
    "path": "src/wallet/db.h",
    "position": null,
    "original_position": 5,
    "commit_id": "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "original_commit_id": "de939869f2513d403568fdc8b828300fe54f0639",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"Replace cs_db with a recursive mutex use with a conditional_variable_any\"\r\n\r\ncs_db is actually already a recursive mutex (it inherits from std::recursive_mutex). I think you could just leave it unchanged, and continue using the LOCK macro instead of std::lock_guard everywhere. This would make the commit smaller & simpler.\r\n\r\n",
    "created_at": "2018-02-21T14:35:40Z",
    "updated_at": "2018-08-09T18:39:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169655317",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169655317"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169655317"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169655317/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 38,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169656355",
    "pull_request_review_id": 98215449,
    "id": 169656355,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2OTY1NjM1NQ==",
    "diff_hunk": "@@ -511,6 +512,15 @@ void CDBEnv::CloseDb(const std::string& strFile)\n \n void CDBEnv::ReloadDbEnv()\n {\n+    // Make sure that no Db's are in use\n+    std::unique_lock<std::recursive_mutex> lock(cs_db);",
    "path": "src/wallet/db.cpp",
    "position": null,
    "original_position": 51,
    "commit_id": "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "original_commit_id": "de939869f2513d403568fdc8b828300fe54f0639",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"Replace cs_db with a recursive mutex use with a conditional_variable_any\"\r\n\r\nWould be good to add an AssertLockNotHeld(cs_db); above this, since it would be a bug if the mutex were held recursively when this was called (wait could hang if the lock wasn't released). ",
    "created_at": "2018-02-21T14:39:03Z",
    "updated_at": "2018-08-09T18:39:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169656355",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169656355"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169656355"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169656355/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 576,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169675054",
    "pull_request_review_id": 98239484,
    "id": 169675054,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2OTY3NTA1NA==",
    "diff_hunk": "@@ -35,10 +35,11 @@ class CDBEnv\n     void EnvShutdown();\n \n public:\n-    mutable CCriticalSection cs_db;\n+    std::recursive_mutex cs_db;",
    "path": "src/wallet/db.h",
    "position": null,
    "original_position": 5,
    "commit_id": "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "original_commit_id": "de939869f2513d403568fdc8b828300fe54f0639",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I tried that, but it kept giving me a compiler error.",
    "created_at": "2018-02-21T15:32:14Z",
    "updated_at": "2018-08-09T18:39:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169675054",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169675054"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169675054"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169675054/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 38,
    "side": "RIGHT",
    "in_reply_to_id": 169655317
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169682192",
    "pull_request_review_id": 98247803,
    "id": 169682192,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2OTY4MjE5Mg==",
    "diff_hunk": "@@ -511,6 +512,15 @@ void CDBEnv::CloseDb(const std::string& strFile)\n \n void CDBEnv::ReloadDbEnv()\n {\n+    // Make sure that no Db's are in use\n+    std::unique_lock<std::recursive_mutex> lock(cs_db);",
    "path": "src/wallet/db.cpp",
    "position": null,
    "original_position": 51,
    "commit_id": "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "original_commit_id": "de939869f2513d403568fdc8b828300fe54f0639",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done",
    "created_at": "2018-02-21T15:51:17Z",
    "updated_at": "2018-08-09T18:39:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169682192",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169682192"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169682192"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169682192/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 576,
    "side": "RIGHT",
    "in_reply_to_id": 169656355
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169721029",
    "pull_request_review_id": 98293675,
    "id": 169721029,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2OTcyMTAyOQ==",
    "diff_hunk": "@@ -35,10 +35,11 @@ class CDBEnv\n     void EnvShutdown();\n \n public:\n-    mutable CCriticalSection cs_db;\n+    std::recursive_mutex cs_db;",
    "path": "src/wallet/db.h",
    "position": null,
    "original_position": 5,
    "commit_id": "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "original_commit_id": "de939869f2513d403568fdc8b828300fe54f0639",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169655317\r\n\r\n> I tried that, but it kept giving me a compiler error.\r\n\r\nWhat is the compiler error? The following compiles for me: c271de2d62881c0880bf64b830d72f686967bbfb (fetchable with `git fetch https://github.com/ryanofsky/bitcoin pr/lreload`).\r\n\r\nI didn't do any real testing with it but it passes python & unit tests.",
    "created_at": "2018-02-21T17:45:49Z",
    "updated_at": "2018-08-09T18:39:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169721029",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169721029"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169721029"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169721029/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 38,
    "side": "RIGHT",
    "in_reply_to_id": 169655317
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169730801",
    "pull_request_review_id": 98305130,
    "id": 169730801,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2OTczMDgwMQ==",
    "diff_hunk": "@@ -35,10 +35,11 @@ class CDBEnv\n     void EnvShutdown();\n \n public:\n-    mutable CCriticalSection cs_db;\n+    std::recursive_mutex cs_db;",
    "path": "src/wallet/db.h",
    "position": null,
    "original_position": 5,
    "commit_id": "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "original_commit_id": "de939869f2513d403568fdc8b828300fe54f0639",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Ah, I was doing something with the macros and CCriticalSection. It was an error about not having an `unlock` method.\r\n\r\nI'll test this out, but from testing I just did with the current code, it looks like it does work, so this should work too.",
    "created_at": "2018-02-21T18:19:54Z",
    "updated_at": "2018-08-09T18:39:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169730801",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169730801"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169730801"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169730801/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 38,
    "side": "RIGHT",
    "in_reply_to_id": 169655317
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169777432",
    "pull_request_review_id": 98359993,
    "id": 169777432,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2OTc3NzQzMg==",
    "diff_hunk": "@@ -35,10 +35,11 @@ class CDBEnv\n     void EnvShutdown();\n \n public:\n-    mutable CCriticalSection cs_db;\n+    std::recursive_mutex cs_db;",
    "path": "src/wallet/db.h",
    "position": null,
    "original_position": 5,
    "commit_id": "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "original_commit_id": "de939869f2513d403568fdc8b828300fe54f0639",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "@ryanofsky I've used your commit.",
    "created_at": "2018-02-21T21:06:22Z",
    "updated_at": "2018-08-09T18:39:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169777432",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169777432"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169777432"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169777432/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 38,
    "side": "RIGHT",
    "in_reply_to_id": 169655317
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169836879",
    "pull_request_review_id": 98428192,
    "id": 169836879,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2OTgzNjg3OQ==",
    "diff_hunk": "@@ -690,6 +690,11 @@ bool CWallet::EncryptWallet(const SecureString& strWalletPassphrase)\n         // bits of the unencrypted private key in slack space in the database file.\n         dbw->Rewrite();\n \n+        // BDB seems to have a bad habit of writing old data into",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "original_commit_id": "b2a0bb97bb3773adce797724fb937e5bd4294f55",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"After encrypting the wallet, reload the database environment\"\r\n\r\nDelayed flushing seems more like a legitimate design tradeoff than a bad habit. Maybe just say something like \"flush and reload the database environment here to clear out any data in memory that might be left behind after the rewrite above.\"",
    "created_at": "2018-02-22T02:05:04Z",
    "updated_at": "2018-08-09T18:39:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169836879",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169836879"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169836879"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169836879/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 722,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169838060",
    "pull_request_review_id": 98428192,
    "id": 169838060,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2OTgzODA2MA==",
    "diff_hunk": "@@ -690,6 +690,11 @@ bool CWallet::EncryptWallet(const SecureString& strWalletPassphrase)\n         // bits of the unencrypted private key in slack space in the database file.\n         dbw->Rewrite();",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 2,
    "commit_id": "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "original_commit_id": "b2a0bb97bb3773adce797724fb937e5bd4294f55",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"After encrypting the wallet, reload the database environment\"\r\n\r\nLooking at the CDB::Rewrite implementation I noticed that it already has a while loop that sleeps until mapFileUseCount (for just one wallet) is 0. You could take advantage of this if you wanted by tweaking the while loop there to wait for all use counts in the environment to be 0 and then calling ReloadDbEnv inside CDB::Rewrite. This would be a simplification since it would let you get rid of the new condition variable, and it would also make the new waiting code more consistent with previous code.\r\n\r\nThis is just a suggestion, though. Your current implementation seems fine, too.",
    "created_at": "2018-02-22T02:14:04Z",
    "updated_at": "2018-08-09T18:39:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169838060",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169838060"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169838060"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169838060/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 681,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169842341",
    "pull_request_review_id": 98434190,
    "id": 169842341,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2OTg0MjM0MQ==",
    "diff_hunk": "@@ -690,6 +690,11 @@ bool CWallet::EncryptWallet(const SecureString& strWalletPassphrase)\n         // bits of the unencrypted private key in slack space in the database file.\n         dbw->Rewrite();\n \n+        // BDB seems to have a bad habit of writing old data into",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "original_commit_id": "b2a0bb97bb3773adce797724fb937e5bd4294f55",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "The comment was just copied over from `rpcwallet.cpp`. ",
    "created_at": "2018-02-22T02:48:38Z",
    "updated_at": "2018-08-09T18:39:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169842341",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169842341"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169842341"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169842341/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 722,
    "side": "RIGHT",
    "in_reply_to_id": 169836879
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169842400",
    "pull_request_review_id": 98434259,
    "id": 169842400,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2OTg0MjQwMA==",
    "diff_hunk": "@@ -690,6 +690,11 @@ bool CWallet::EncryptWallet(const SecureString& strWalletPassphrase)\n         // bits of the unencrypted private key in slack space in the database file.\n         dbw->Rewrite();",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 2,
    "commit_id": "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "original_commit_id": "b2a0bb97bb3773adce797724fb937e5bd4294f55",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I don't want to do anything to `CDB::Rewrite` since it is used in places other than `encryptwallet`.",
    "created_at": "2018-02-22T02:49:05Z",
    "updated_at": "2018-08-09T18:39:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169842400",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169842400"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169842400"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169842400/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 681,
    "side": "RIGHT",
    "in_reply_to_id": 169838060
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169964768",
    "pull_request_review_id": 98575966,
    "id": 169964768,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2OTk2NDc2OA==",
    "diff_hunk": "@@ -690,6 +690,11 @@ bool CWallet::EncryptWallet(const SecureString& strWalletPassphrase)\n         // bits of the unencrypted private key in slack space in the database file.\n         dbw->Rewrite();",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 2,
    "commit_id": "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "original_commit_id": "b2a0bb97bb3773adce797724fb937e5bd4294f55",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169838060\r\n\r\n> I don't want to do anything to CDB::Rewrite since it is used in places other than encryptwallet\r\n\r\nI didn't realize Rewrite was called other places, and the current approach does seem fine. But if you did want to unify the UseCount waiting logic, I think you could do it in a pretty clean way by adding a `bool reload_env` or similar option to CDB::Rewrite. I think in terms code clarity, having the option would actually be an improvement over always reloading.\r\n",
    "created_at": "2018-02-22T14:09:28Z",
    "updated_at": "2018-08-09T18:39:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169964768",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169964768"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r169964768"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169964768/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 681,
    "side": "RIGHT",
    "in_reply_to_id": 169838060
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170101734",
    "pull_request_review_id": 98738206,
    "id": 170101734,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3MDEwMTczNA==",
    "diff_hunk": "@@ -690,6 +690,11 @@ bool CWallet::EncryptWallet(const SecureString& strWalletPassphrase)\n         // bits of the unencrypted private key in slack space in the database file.\n         dbw->Rewrite();",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 2,
    "commit_id": "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "original_commit_id": "b2a0bb97bb3773adce797724fb937e5bd4294f55",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think I'll leave it as it is now.",
    "created_at": "2018-02-22T21:40:17Z",
    "updated_at": "2018-08-09T18:39:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170101734",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170101734"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170101734"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170101734/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 681,
    "side": "RIGHT",
    "in_reply_to_id": 169838060
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170614391",
    "pull_request_review_id": 99325615,
    "id": 170614391,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3MDYxNDM5MQ==",
    "diff_hunk": "@@ -123,7 +123,7 @@ void AskPassphraseDialog::accept()\n                 {\n                     QMessageBox::warning(this, tr(\"Wallet encrypted\"),\n                                          \"<qt>\" +\n-                                         tr(\"%1 will close now to finish the encryption process. \"\n+                                         tr(\"Your wallet is now encrypted. \"\n                                          \"Remember that encrypting your wallet cannot fully protect \"\n                                          \"your bitcoins from being stolen by malware infecting your computer.\").arg(tr(PACKAGE_NAME)) +",
    "path": "src/qt/askpassphrasedialog.cpp",
    "position": null,
    "original_position": 7,
    "commit_id": "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "original_commit_id": "437d2dd56f81a6258243aca6ed137cbca9255b32",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Remove `.arg()` since `%1` was removed.",
    "created_at": "2018-02-26T14:48:46Z",
    "updated_at": "2018-08-09T18:39:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170614391",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170614391"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170614391"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170614391/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 128,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170614682",
    "pull_request_review_id": 99325615,
    "id": 170614682,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3MDYxNDY4Mg==",
    "diff_hunk": "@@ -123,7 +123,7 @@ void AskPassphraseDialog::accept()\n                 {\n                     QMessageBox::warning(this, tr(\"Wallet encrypted\"),",
    "path": "src/qt/askpassphrasedialog.cpp",
    "position": 2,
    "original_position": 2,
    "commit_id": "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "original_commit_id": "437d2dd56f81a6258243aca6ed137cbca9255b32",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "`QMessageBox::information`?",
    "created_at": "2018-02-26T14:49:35Z",
    "updated_at": "2018-08-09T18:39:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170614682",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170614682"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170614682"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170614682/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 124,
    "original_line": 124,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170616888",
    "pull_request_review_id": 99325615,
    "id": 170616888,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3MDYxNjg4OA==",
    "diff_hunk": "@@ -509,6 +510,32 @@ void CDBEnv::CloseDb(const std::string& strFile)\n     }\n }\n \n+void CDBEnv::ReloadDbEnv()\n+{\n+    // Make sure that no Db's are in use\n+    AssertLockNotHeld(cs_db);\n+    std::unique_lock<std::recursive_mutex> lock(cs_db);\n+    m_db_in_use.wait(lock, [this](){\n+        for (auto& count : mapFileUseCount) {\n+            if (count.second > 0) return false;\n+        }\n+        return true;\n+    });\n+\n+    std::vector<std::string> filenames;\n+    for (auto it : mapDb) {",
    "path": "src/wallet/db.cpp",
    "position": 25,
    "original_position": 25,
    "commit_id": "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "original_commit_id": "437d2dd56f81a6258243aca6ed137cbca9255b32",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Remove `filenames` and just iterate once, something like:\r\n```cpp\r\nwhile (!mapDb.empty()) {\r\n  std::string filename = mapDb.begin().first;\r\n  ...\r\n}\r\n```",
    "created_at": "2018-02-26T14:55:36Z",
    "updated_at": "2018-08-09T18:39:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170616888",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170616888"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170616888"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170616888/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 589,
    "original_line": 589,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170616987",
    "pull_request_review_id": 99325615,
    "id": 170616987,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3MDYxNjk4Nw==",
    "diff_hunk": "@@ -733,3 +760,10 @@ void CWalletDBWrapper::Flush(bool shutdown)\n         env->Flush(shutdown);\n     }\n }\n+\n+void CWalletDBWrapper::ReloadDbEnv()\n+{\n+    if(!IsDummy()) {",
    "path": "src/wallet/db.cpp",
    "position": null,
    "original_position": 48,
    "commit_id": "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "original_commit_id": "437d2dd56f81a6258243aca6ed137cbca9255b32",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Nit, space after `if`.",
    "created_at": "2018-02-26T14:55:57Z",
    "updated_at": "2018-08-09T18:39:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170616987",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170616987"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170616987"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170616987/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 766,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170695136",
    "pull_request_review_id": 99420641,
    "id": 170695136,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3MDY5NTEzNg==",
    "diff_hunk": "@@ -123,7 +123,7 @@ void AskPassphraseDialog::accept()\n                 {\n                     QMessageBox::warning(this, tr(\"Wallet encrypted\"),\n                                          \"<qt>\" +\n-                                         tr(\"%1 will close now to finish the encryption process. \"\n+                                         tr(\"Your wallet is now encrypted. \"\n                                          \"Remember that encrypting your wallet cannot fully protect \"\n                                          \"your bitcoins from being stolen by malware infecting your computer.\").arg(tr(PACKAGE_NAME)) +",
    "path": "src/qt/askpassphrasedialog.cpp",
    "position": null,
    "original_position": 7,
    "commit_id": "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "original_commit_id": "437d2dd56f81a6258243aca6ed137cbca9255b32",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done",
    "created_at": "2018-02-26T18:49:13Z",
    "updated_at": "2018-08-09T18:39:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170695136",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170695136"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170695136"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170695136/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 128,
    "side": "RIGHT",
    "in_reply_to_id": 170614391
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170695186",
    "pull_request_review_id": 99420697,
    "id": 170695186,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3MDY5NTE4Ng==",
    "diff_hunk": "@@ -123,7 +123,7 @@ void AskPassphraseDialog::accept()\n                 {\n                     QMessageBox::warning(this, tr(\"Wallet encrypted\"),",
    "path": "src/qt/askpassphrasedialog.cpp",
    "position": 2,
    "original_position": 2,
    "commit_id": "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "original_commit_id": "437d2dd56f81a6258243aca6ed137cbca9255b32",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I don't think it needs to change.",
    "created_at": "2018-02-26T18:49:21Z",
    "updated_at": "2018-08-09T18:39:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170695186",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170695186"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170695186"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170695186/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 124,
    "original_line": 124,
    "side": "RIGHT",
    "in_reply_to_id": 170614682
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170695325",
    "pull_request_review_id": 99420822,
    "id": 170695325,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3MDY5NTMyNQ==",
    "diff_hunk": "@@ -733,3 +760,10 @@ void CWalletDBWrapper::Flush(bool shutdown)\n         env->Flush(shutdown);\n     }\n }\n+\n+void CWalletDBWrapper::ReloadDbEnv()\n+{\n+    if(!IsDummy()) {",
    "path": "src/wallet/db.cpp",
    "position": null,
    "original_position": 48,
    "commit_id": "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "original_commit_id": "437d2dd56f81a6258243aca6ed137cbca9255b32",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done",
    "created_at": "2018-02-26T18:49:43Z",
    "updated_at": "2018-08-09T18:39:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170695325",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170695325"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170695325"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170695325/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 766,
    "side": "RIGHT",
    "in_reply_to_id": 170616987
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170695659",
    "pull_request_review_id": 99421243,
    "id": 170695659,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3MDY5NTY1OQ==",
    "diff_hunk": "@@ -509,6 +510,32 @@ void CDBEnv::CloseDb(const std::string& strFile)\n     }\n }\n \n+void CDBEnv::ReloadDbEnv()\n+{\n+    // Make sure that no Db's are in use\n+    AssertLockNotHeld(cs_db);\n+    std::unique_lock<std::recursive_mutex> lock(cs_db);\n+    m_db_in_use.wait(lock, [this](){\n+        for (auto& count : mapFileUseCount) {\n+            if (count.second > 0) return false;\n+        }\n+        return true;\n+    });\n+\n+    std::vector<std::string> filenames;\n+    for (auto it : mapDb) {",
    "path": "src/wallet/db.cpp",
    "position": 25,
    "original_position": 25,
    "commit_id": "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "original_commit_id": "437d2dd56f81a6258243aca6ed137cbca9255b32",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This doesn't work (causes test failures with encryptwallet). I think it's becauese mapDb is modified by CloseDb too.",
    "created_at": "2018-02-26T18:50:44Z",
    "updated_at": "2018-08-09T18:39:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170695659",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170695659"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r170695659"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170695659/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 589,
    "original_line": 589,
    "side": "RIGHT",
    "in_reply_to_id": 170616888
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202497267",
    "pull_request_review_id": 137219138,
    "id": 202497267,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwMjQ5NzI2Nw==",
    "diff_hunk": "@@ -570,6 +571,16 @@ void BerkeleyEnvironment::CloseDb(const std::string& strFile)\n \n void BerkeleyEnvironment::ReloadDbEnv()\n {\n+    // Make sure that no Db's are in use\n+    AssertLockNotHeld(cs_db);\n+    std::unique_lock<std::recursive_mutex> lock(cs_db);",
    "path": "src/wallet/db.cpp",
    "position": null,
    "original_position": 14,
    "commit_id": "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "original_commit_id": "b766d7bb8ff0494ea3961945f15abaa4b13d0830",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "It would be slightly cleaner to use `std::unique_lock<CCriticalSection>` here.\r\n\r\nAlso, please squash this into the first commit - currently your PR introduces a bug and then fixes it later.\r\n\r\nWe should probably also work on making the sync.h primitives more C++11 compatible, but let's leave that for later.",
    "created_at": "2018-07-14T00:02:24Z",
    "updated_at": "2018-08-09T18:39:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r202497267",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202497267"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r202497267"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202497267/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 576,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202497467",
    "pull_request_review_id": 137219372,
    "id": 202497467,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwMjQ5NzQ2Nw==",
    "diff_hunk": "@@ -570,6 +571,16 @@ void BerkeleyEnvironment::CloseDb(const std::string& strFile)\n \n void BerkeleyEnvironment::ReloadDbEnv()\n {\n+    // Make sure that no Db's are in use\n+    AssertLockNotHeld(cs_db);\n+    std::unique_lock<std::recursive_mutex> lock(cs_db);",
    "path": "src/wallet/db.cpp",
    "position": null,
    "original_position": 14,
    "commit_id": "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "original_commit_id": "b766d7bb8ff0494ea3961945f15abaa4b13d0830",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done",
    "created_at": "2018-07-14T00:04:47Z",
    "updated_at": "2018-08-09T18:39:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r202497467",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202497467"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r202497467"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202497467/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 576,
    "side": "RIGHT",
    "in_reply_to_id": 202497267
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202497854",
    "pull_request_review_id": 137219808,
    "id": 202497854,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwMjQ5Nzg1NA==",
    "diff_hunk": "@@ -551,6 +551,7 @@ void BerkeleyBatch::Close()\n     {\n         LOCK(cs_db);\n         --env->mapFileUseCount[strFile];\n+        env->m_db_in_use.notify_all();",
    "path": "src/wallet/db.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "original_commit_id": "3cdc0ae1048b226bce6cb26d4a182b6593f26594",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Performance nit: notifying while not holding the lock is slightly faster (currently you'll wake the waiting thread, which then immediately needs to sleep again because the lock is still held).",
    "created_at": "2018-07-14T00:09:52Z",
    "updated_at": "2018-08-09T18:39:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r202497854",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202497854"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r202497854"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202497854/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 554,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202497895",
    "pull_request_review_id": 137219808,
    "id": 202497895,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwMjQ5Nzg5NQ==",
    "diff_hunk": "@@ -568,6 +569,32 @@ void BerkeleyEnvironment::CloseDb(const std::string& strFile)\n     }\n }\n \n+void BerkeleyEnvironment::ReloadDbEnv()\n+{\n+    // Make sure that no Db's are in use\n+    AssertLockNotHeld(cs_db);\n+    std::unique_lock<CCriticalSection> lock(cs_db);\n+    m_db_in_use.wait(lock, [this](){\n+        for (auto& count : mapFileUseCount) {\n+            if (count.second > 0) return false;\n+        }\n+        return true;\n+    });\n+\n+    std::vector<std::string> filenames;\n+    for (auto it : mapDb) {\n+        filenames.push_back(it.first);\n+    }\n+    // Close the individual Db's\n+    for (std::string filename : filenames) {",
    "path": "src/wallet/db.cpp",
    "position": null,
    "original_position": 29,
    "commit_id": "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "original_commit_id": "3cdc0ae1048b226bce6cb26d4a182b6593f26594",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Nit: `const std::string& filename`.",
    "created_at": "2018-07-14T00:10:31Z",
    "updated_at": "2018-08-09T18:39:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r202497895",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202497895"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r202497895"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202497895/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 589,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202498649",
    "pull_request_review_id": 137220774,
    "id": 202498649,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwMjQ5ODY0OQ==",
    "diff_hunk": "@@ -551,6 +551,7 @@ void BerkeleyBatch::Close()\n     {\n         LOCK(cs_db);\n         --env->mapFileUseCount[strFile];\n+        env->m_db_in_use.notify_all();",
    "path": "src/wallet/db.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "original_commit_id": "3cdc0ae1048b226bce6cb26d4a182b6593f26594",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done",
    "created_at": "2018-07-14T00:22:29Z",
    "updated_at": "2018-08-09T18:39:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r202498649",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202498649"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r202498649"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202498649/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 554,
    "side": "RIGHT",
    "in_reply_to_id": 202497854
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202498656",
    "pull_request_review_id": 137220779,
    "id": 202498656,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwMjQ5ODY1Ng==",
    "diff_hunk": "@@ -568,6 +569,32 @@ void BerkeleyEnvironment::CloseDb(const std::string& strFile)\n     }\n }\n \n+void BerkeleyEnvironment::ReloadDbEnv()\n+{\n+    // Make sure that no Db's are in use\n+    AssertLockNotHeld(cs_db);\n+    std::unique_lock<CCriticalSection> lock(cs_db);\n+    m_db_in_use.wait(lock, [this](){\n+        for (auto& count : mapFileUseCount) {\n+            if (count.second > 0) return false;\n+        }\n+        return true;\n+    });\n+\n+    std::vector<std::string> filenames;\n+    for (auto it : mapDb) {\n+        filenames.push_back(it.first);\n+    }\n+    // Close the individual Db's\n+    for (std::string filename : filenames) {",
    "path": "src/wallet/db.cpp",
    "position": null,
    "original_position": 29,
    "commit_id": "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "original_commit_id": "3cdc0ae1048b226bce6cb26d4a182b6593f26594",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done",
    "created_at": "2018-07-14T00:22:34Z",
    "updated_at": "2018-08-09T18:39:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r202498656",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202498656"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r202498656"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202498656/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 589,
    "side": "RIGHT",
    "in_reply_to_id": 202497895
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211096962",
    "pull_request_review_id": 147452331,
    "id": 211096962,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMTA5Njk2Mg==",
    "diff_hunk": "@@ -572,6 +573,32 @@ void BerkeleyEnvironment::CloseDb(const std::string& strFile)\n     }\n }\n \n+void BerkeleyEnvironment::ReloadDbEnv()\n+{\n+    // Make sure that no Db's are in use\n+    AssertLockNotHeld(cs_db);\n+    std::unique_lock<CCriticalSection> lock(cs_db);\n+    m_db_in_use.wait(lock, [this](){\n+        for (auto& count : mapFileUseCount) {",
    "path": "src/wallet/db.cpp",
    "position": 18,
    "original_position": 18,
    "commit_id": "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "original_commit_id": "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Don't use iterator references?",
    "created_at": "2018-08-19T09:15:15Z",
    "updated_at": "2018-08-19T21:58:13Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r211096962",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211096962"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r211096962"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211096962/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 582,
    "original_line": 582,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217794290",
    "pull_request_review_id": 155600307,
    "id": 217794290,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNzc5NDI5MA==",
    "diff_hunk": "@@ -697,7 +697,6 @@ void BerkeleyEnvironment::Flush(bool fShutdown)\n                 if (!fMockDb) {\n                     fs::remove_all(fs::path(strPath) / \"database\");\n                 }\n-                g_dbenvs.erase(strPath);",
    "path": "src/wallet/db.cpp",
    "position": 45,
    "original_position": 4,
    "commit_id": "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "original_commit_id": "a769461d5e37ddcb771ae836254fdc69177a28c4",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"Move BerkeleyEnvironment deletion from internal method to callsite\" (a769461d5e37ddcb771ae836254fdc69177a28c4)\r\n\r\n@achow101 do remember if this change was this done for specific reason? It seems like an odd thing to include here.",
    "created_at": "2018-09-14T17:56:48Z",
    "updated_at": "2018-09-14T17:58:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r217794290",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217794290"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r217794290"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217794290/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 700,
    "original_line": 700,
    "side": "LEFT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217806330",
    "pull_request_review_id": 155615333,
    "id": 217806330,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNzgwNjMzMA==",
    "diff_hunk": "@@ -697,7 +697,6 @@ void BerkeleyEnvironment::Flush(bool fShutdown)\n                 if (!fMockDb) {\n                     fs::remove_all(fs::path(strPath) / \"database\");\n                 }\n-                g_dbenvs.erase(strPath);",
    "path": "src/wallet/db.cpp",
    "position": 45,
    "original_position": 4,
    "commit_id": "c1dde3a949b36ce9c2155777b3fa1372e7ed97d8",
    "original_commit_id": "a769461d5e37ddcb771ae836254fdc69177a28c4",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "IIRC there are two reasons for this. The first was that we needed this in the next commit to avoid having a destroyed db environment because we want to reopen it. The second reason that I don't think it is good for an object to destroy its own references as that's what it does here.",
    "created_at": "2018-09-14T18:38:57Z",
    "updated_at": "2018-09-14T18:38:57Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r217806330",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217806330"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12493#discussion_r217806330"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12493"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217806330/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 700,
    "original_line": 700,
    "side": "LEFT",
    "in_reply_to_id": 217794290
  }
]