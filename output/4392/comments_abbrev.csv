laanwj,2014-06-23T14:30:39Z,"Tried testing on wine, but the `RegQueryValueExA(HKEY_PERFORMANCE_DATA)` fails there :( (no such key)\n",https://github.com/bitcoin/bitcoin/pull/4392#issuecomment-46852338,46852338,
laanwj,2014-06-23T15:19:17Z,~~A bitcoind.exe to test with is available here: https://download.visucore.com/bitcoin/bitcoin-win-v0.9.99.0-gbe873f6.zip (gpg sigs https://download.visucore.com/bitcoin/bitcoin-win-v0.9.99.0-gbe873f6.zip.sig)~~\n,https://github.com/bitcoin/bitcoin/pull/4392#issuecomment-46859070,46859070,
leofidus,2014-06-23T18:53:34Z,"Testing on Windows 8 64bit with @laanwj's binary, my log shows\n\n```\n2014-06-23 18:04:36 RandAddSeedPerfmon: Warning: RegQueryValueExA(HKEY_PERFORMANCE_DATA) failed with code 234\n```\n\nI'm not sure how to further debug this. My regular Bitcoin 0.9.1 GUI does not seem to show any randomness-related debug messages (started with `-debug`).\n",https://github.com/bitcoin/bitcoin/pull/4392#issuecomment-46886221,46886221,
laanwj,2014-06-24T07:03:45Z,"@leofidus Thanks for testing!\n\nThe regular client doesn't show any messages if the call fails, only if it succeeds. In the second commit of this pull I added that warning. So - it's failing in 0.9.1 as well.\n\nBut the error is different than mine on wine. Error 234 is `ERROR_MORE_DATA`. I doubt this ever worked at all.\nAccording to [the doc](http://msdn.microsoft.com/en-us/library/windows/desk",https://github.com/bitcoin/bitcoin/pull/4392#issuecomment-46938225,46938225,
Diapolo,2014-06-24T07:22:24Z,"My official 0.9.1 client shows, that it's working here `2014-06-24 07:19:08 RandAddSeed() 219352 bytes`. Didn't yet try this patch...\n",https://github.com/bitcoin/bitcoin/pull/4392#issuecomment-46939393,46939393,
laanwj,2014-06-24T08:29:35Z,"@diapolo Thanks for testing, although at this point I doubt that it depends on this patch. So at least it works in some cases.\n\nDo you perhaps know if HKEY_PERFORMANCE_DATA returns a variable number of bytes that may be >250000?\n\nAh, got it:\n\n> If hKey specifies `HKEY_PERFORMANCE_DATA` and the `lpData` buffer is not large enough to contain all of the returned data, `RegQueryValueEx` returns ",https://github.com/bitcoin/bitcoin/pull/4392#issuecomment-46944857,46944857,
Diapolo,2014-06-24T09:17:42Z,@laanwj See http://msdn.microsoft.com/en-us/library/windows/desktop/ms724911%28v=vs.85%29.aspx for sample code.\n,https://github.com/bitcoin/bitcoin/pull/4392#issuecomment-46949120,46949120,
Diapolo,2014-06-24T09:33:04Z,"@laanwj We had a debate about that part of the code in 09. 2012, see https://bitcointalk.org/index.php?topic=113496.msg1225880#msg1225880\n",https://github.com/bitcoin/bitcoin/pull/4392#issuecomment-46950538,46950538,
Diapolo,2014-06-24T09:43:37Z,@laanwj What do you think about removing that source of entropy and use the debug.log with `RAND_load_file()` (https://www.openssl.org/docs/crypto/RAND_load_file.html)? The data should be quite random after the initial startup.\n,https://github.com/bitcoin/bitcoin/pull/4392#issuecomment-46951520,46951520,
laanwj,2014-06-24T10:07:34Z,"Wut? It is known since 2012? I'm extremely disappointed and surprised here. Why did no one ever fix that or escalate it beyond a silly forum topic? Getting the performance data properly is simple, an example is even given in the MSDN documentation that I link above.\n\nI don't think debug.log is a good source of entropy as it is - up to a point - controllable by the outside world through the netwo",https://github.com/bitcoin/bitcoin/pull/4392#issuecomment-46953613,46953613,
Diapolo,2014-06-24T10:54:26Z,@laanwj I proposed a change (https://bitcointalk.org/index.php?topic=113496.msg1228012#msg1228012) and if I remember correctly also had a pull open for this. It was decided to leave as is.\n,https://github.com/bitcoin/bitcoin/pull/4392#issuecomment-46957300,46957300,
laanwj,2014-06-24T11:35:01Z,"That makes no sense. I can only find one issue with `RandAddSeedPerfmon` in it: this one.\nAnyhow, let's fix it...\nEdit: I see this issue #2942. But it doesn't mention a specific problem with any of our current entropy harvesting functions.\n",https://github.com/bitcoin/bitcoin/pull/4392#issuecomment-46960330,46960330,
Diapolo,2014-06-24T14:10:44Z,"Are you going to rework this to include a loop? I tend to just remove it, but have no strong enough feeling yet.\n",https://github.com/bitcoin/bitcoin/pull/4392#issuecomment-46975559,46975559,
laanwj,2014-06-24T14:14:23Z,"Yes, I'm going to turn it into a loop. We have a dearth of entropy sources on windows so removing any sounds extremely unwise.\n",https://github.com/bitcoin/bitcoin/pull/4392#issuecomment-46976012,46976012,
laanwj,2014-06-24T15:02:40Z,"Ok, it should always collect now unless there is >10MB of performance data.\n\nA bitcoind.exe to test with is available here: https://download.visucore.com/bitcoin/bitcoin-win-v0.9.99.0-g3b8c1da.zip (gpg sigs https://download.visucore.com/bitcoin/bitcoin-win-v0.9.99.0-g3b8c1da.zip.sig)\n",https://github.com/bitcoin/bitcoin/pull/4392#issuecomment-46982725,46982725,
laanwj,2014-06-25T08:20:40Z,"Again, can someone with windows test the above bitcoin-win-v0.9.99.0-g3b8c1da.zip and start with -debug=rand and look for the RandAddSeedPerfmon() XXX bytes message in debug.log?\n",https://github.com/bitcoin/bitcoin/pull/4392#issuecomment-47073113,47073113,
Diapolo,2014-06-26T13:09:08Z,I'm currently testing this...\n,https://github.com/bitcoin/bitcoin/pull/4392#issuecomment-47223060,47223060,
Diapolo,2014-06-26T13:36:08Z,<pre>\n2014-06-26 13:16:33 RandAddSeedPerfmon : 215208 bytes\n2014-06-26 13:26:33 RandAddSeedPerfmon : 205416 bytes\n</pre>\n\nSeems to work :).\n\nACK\n,https://github.com/bitcoin/bitcoin/pull/4392#issuecomment-47225985,47225985,
laanwj,2014-06-26T15:09:46Z,Thanks for testing. I added the 0 initializations. Ready for merge now.\n,https://github.com/bitcoin/bitcoin/pull/4392#issuecomment-47238042,47238042,
BitcoinPullTester,2014-06-26T16:38:21Z,"Automatic sanity-testing: FAILED BUILD/TEST, see http://jenkins.bluematt.me/pull-tester/p4392_8ae973c00cfb02161bb2c2a6c839e510cd409278/ for binaries and test log.\n\nThis could happen for one of several reasons:\n1. It chanages paths in makefile.linux-mingw or otherwise changes build scripts in a way that made them incompatible with the automated testing scripts (please tweak those patches in qa/p",https://github.com/bitcoin/bitcoin/pull/4392#issuecomment-47248900,47248900,
Diapolo,2014-06-26T13:00:11Z,"Nit: Can we define to add a space before the function name :)? Also should this be part of the ""rand"" category or not? Which is a thing I need to consider with my OpenSSL related pulls also...\n",https://github.com/bitcoin/bitcoin/pull/4392#discussion_r14238447,14238447,src/util.cpp
Diapolo,2014-06-26T13:02:51Z,"Nit: I would like to see these 2 vars initialized with 0, what do you think?\n",https://github.com/bitcoin/bitcoin/pull/4392#discussion_r14238529,14238529,src/util.cpp
laanwj,2014-06-26T13:02:59Z,"I don't understand, the function name is at the beginning of the line, adding a space there makes no sense.\n\nAnd this is not in the rand category on purpose because people need to see it. It is not just for debugging. And it only emits the warning once anyway.\n",https://github.com/bitcoin/bitcoin/pull/4392#discussion_r14238538,14238538,src/util.cpp
laanwj,2014-06-26T13:04:01Z,Fine with me...\n,https://github.com/bitcoin/bitcoin/pull/4392#discussion_r14238578,14238578,src/util.cpp
Diapolo,2014-06-26T13:08:45Z,"Just talking about this changed to this anyway:\n`LogPrintf(""%s : Warning: RegQueryValueExA(HKEY_PERFORMANCE_DATA) failed with code %i\n"", __func__, ret);`\n\nWe seem to use that syntax more often.\n",https://github.com/bitcoin/bitcoin/pull/4392#discussion_r14238781,14238781,src/util.cpp
laanwj,2014-06-26T13:12:09Z,"That's inconsistent too. The second `:` has no space before it. Also looks strange to me. In English you write like this: there is never a space before a (semi)colon. Anyhow, I'm not going to waste time discussing the formatting of log messages, sorry.\n",https://github.com/bitcoin/bitcoin/pull/4392#discussion_r14238908,14238908,src/util.cpp
