[
  {
    "sha": "a9ab42ca973e1841ac125b0f64eaa922df240c08",
    "node_id": "C_kwDOABII59oAKGE5YWI0MmNhOTczZTE4NDFhYzEyNWIwZjY0ZWFhOTIyZGYyNDBjMDg",
    "commit": {
      "author": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2020-03-14T19:58:55Z"
      },
      "committer": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2021-11-02T11:12:20Z"
      },
      "message": "util: use stronger-guarantee rename method\n\nUse std::filesystem::rename() instead of std::rename(). We rely on the\ndestination to be overwritten if it exists, but std::rename()'s behavior\nis implementation-defined in this case.",
      "tree": {
        "sha": "e1d2d9313842594519f143ad186f77bbb4061e13",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e1d2d9313842594519f143ad186f77bbb4061e13"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a9ab42ca973e1841ac125b0f64eaa922df240c08",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQQzBAABCAAdFiEE5k2NRWFNsHVF2czBVN8G9ktVy78FAmGBHRYACgkQVN8G9ktV\ny79tYiAAljjzG80B92i4DeVsByWDYFf5HN/W26MAYx/13GAnElxIxM+SHANnmKEJ\nzZgWkq+BpobSYUDJPaLp1j9BOtwaYwStpubOfSnp72uBJGLL4nfalTh/eVHTioxN\nzk7C20jieu+cjyRS54nVlYNi5U6bDp6P5yNJjzAQqUMaPgiEWJiK/QWtbVVLv6CU\nK/sXg/wu32dmd2GFUVXZEsZnddWdcMKiN1b+pggs2ZfmKM+cx+T/ziGfU4WyeG8F\nHauRpMhbc42KPvtwqVjEk1KDtuUlzp727mR1BTFMV6ybTUVuvzXNSlanNY6F2QxM\n4KnDD9lcSmoo8TROhUAiP/mfKWXgrLmR/P0+3Ylyo7yNS1u3GLZCyqituCidsuk2\nV8tOXDVOU0QqKgcpKBRkfUIXlkisRaowB/gGVpOdSQ/wa1TRkJakjxaeageakyKk\nV+qHtzSpjj9RBA7tB0zZJk006jm4vml0i4z5dSWvAFoDRw6F0Qfk2Bq8hghwtCI1\nt9l5HwxNiEyPNkQ4miMP+RFfMfdYQXYwjTKTtLDhHk6wgKUcv8ZG/epysvGP08R2\n0fQbKSagssJQAClcpg4I7EaiDTPjym5R9CdP5LXpXDhKsadMrPsGTI00TTWImlSS\nJGL5+DQ+gm9vhI3KVav/qKLBeKPc5cg3H3/PGHXf9YSsY9FN1FWFi5XNU7jr+tMR\nCDjROjTGbvq5hc2v/3CvhKXMiZDJ/ZyiPbysWk8f64l+dnTLh5zYmrQic1MOd6ab\nOyR4ctPVfP6bPVa4mHxjOyHg1ZdPxDzKqwqR7uqGY1i5H5SZFbBbQ/2W1OfrszxS\nwjISIvBX5Bvfz++KmvAu6/o5tU1O353m69NTaNmEtS/yqCpCY4z3FiMYAReaLklS\ngtT+vG9kZFD08tgR6qRqReX6CqeEQHVMpxwuMWXgWeDzRMPunapS0sxf8oS+aJe1\nhGUCu7yLIHhKlH2bivnLbEdd2chkPmktOQyO4/zOiRB1FLOjLr+RbJy4frbmhIO4\nb75wKmJiuO7C8Ia8E9AX7+PdsQWTwuuoV91EvHtxNMz6Icxt4y9sOmG7zQIeQF7r\nk1+fq6HRid3bLo+yrxblzMjLWZOLymWY/EPpKv5yGYugEjEwhTH4C2U59p8UHixn\nSaOfMlIXKvhNDlwhyRtAFxNHzCwEBZzrpnjioJww1ocJCP2aOhok0bQv4OFZx60T\n8TKaZ5Ou/L8Y7TZArYIdsKphFTBqB1QR8n8DEmFCwLmTxGHf4pmzfhbc2++GIEVU\nWV99IEjiLHsktBtGrpJro4O7nqu5DXoZ876cHpPG0k03CDDO/CyDp/nJWJ+fRnE+\ncXg66Jt+TzM7QHGpiNh5kzJNCvFsxw==\n=LbjX\n-----END PGP SIGNATURE-----",
        "payload": "tree e1d2d9313842594519f143ad186f77bbb4061e13\nparent 76886ce11e85509cd9323fcff541c79e2c26034b\nauthor Vasil Dimov <vd@FreeBSD.org> 1584215935 +0100\ncommitter Vasil Dimov <vd@FreeBSD.org> 1635851540 +0100\n\nutil: use stronger-guarantee rename method\n\nUse std::filesystem::rename() instead of std::rename(). We rely on the\ndestination to be overwritten if it exists, but std::rename()'s behavior\nis implementation-defined in this case.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a9ab42ca973e1841ac125b0f64eaa922df240c08",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/a9ab42ca973e1841ac125b0f64eaa922df240c08",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a9ab42ca973e1841ac125b0f64eaa922df240c08/comments",
    "author": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasild/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasild/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "76886ce11e85509cd9323fcff541c79e2c26034b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/76886ce11e85509cd9323fcff541c79e2c26034b",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/76886ce11e85509cd9323fcff541c79e2c26034b"
      }
    ],
    "stats": {
      "total": 18,
      "additions": 11,
      "deletions": 7
    },
    "files": [
      {
        "sha": "23ce91d6e56294a5c9cee28377bb9c2db01836bb",
        "filename": "src/util/system.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 7,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/a9ab42ca973e1841ac125b0f64eaa922df240c08/src/util/system.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/a9ab42ca973e1841ac125b0f64eaa922df240c08/src/util/system.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/util/system.cpp?ref=a9ab42ca973e1841ac125b0f64eaa922df240c08",
        "patch": "@@ -71,7 +71,9 @@\n #endif\n \n #include <boost/algorithm/string/replace.hpp>\n+#include <filesystem>\n #include <optional>\n+#include <system_error>\n #include <thread>\n #include <typeinfo>\n #include <univalue.h>\n@@ -1064,13 +1066,9 @@ void ArgsManager::LogArgs() const\n \n bool RenameOver(fs::path src, fs::path dest)\n {\n-#ifdef WIN32\n-    return MoveFileExW(src.wstring().c_str(), dest.wstring().c_str(),\n-                       MOVEFILE_REPLACE_EXISTING) != 0;\n-#else\n-    int rc = std::rename(src.c_str(), dest.c_str());\n-    return (rc == 0);\n-#endif /* WIN32 */\n+    std::error_code error;\n+    std::filesystem::rename(src, dest, error);\n+    return !error;\n }\n \n /**"
      },
      {
        "sha": "28fe668c0c1bd480affc93887ca7ecc4f5cc0c89",
        "filename": "src/util/system.h",
        "status": "modified",
        "additions": 6,
        "deletions": 0,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/a9ab42ca973e1841ac125b0f64eaa922df240c08/src/util/system.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/a9ab42ca973e1841ac125b0f64eaa922df240c08/src/util/system.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/util/system.h?ref=a9ab42ca973e1841ac125b0f64eaa922df240c08",
        "patch": "@@ -69,7 +69,13 @@ void DirectoryCommit(const fs::path &dirname);\n bool TruncateFile(FILE *file, unsigned int length);\n int RaiseFileDescriptorLimit(int nMinFD);\n void AllocateFileRange(FILE *file, unsigned int offset, unsigned int length);\n+\n+/**\n+ * Rename src to dest.\n+ * @return true if the rename was successful.\n+ */\n [[nodiscard]] bool RenameOver(fs::path src, fs::path dest);\n+\n bool LockDirectory(const fs::path& directory, const std::string lockfile_name, bool probe_only=false);\n void UnlockDirectory(const fs::path& directory, const std::string& lockfile_name);\n bool DirIsWritable(const fs::path& directory);"
      }
    ]
  }
]