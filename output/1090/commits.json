[
  {
    "sha": "3793fa09ff920fc720dfad3738f105d2c9563662",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozNzkzZmEwOWZmOTIwZmM3MjBkZmFkMzczOGYxMDVkMmM5NTYzNjYy",
    "commit": {
      "author": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@gmail.com",
        "date": "2012-04-13T15:10:50Z"
      },
      "committer": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@gmail.com",
        "date": "2012-05-05T08:20:52Z"
      },
      "message": "Allow Qt to wrap long tooltips (fixes #1063)\n\nImplemented without having to touch any translation: by listening for QEvent::ToolTipChange events, then rewriting the tooltips to prefix `<qt/>` if it is not yet rich text.",
      "tree": {
        "sha": "87e3a01f4fb1dea5c692d87fad087774fa2fbad7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/87e3a01f4fb1dea5c692d87fad087774fa2fbad7"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3793fa09ff920fc720dfad3738f105d2c9563662",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3793fa09ff920fc720dfad3738f105d2c9563662",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/3793fa09ff920fc720dfad3738f105d2c9563662",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3793fa09ff920fc720dfad3738f105d2c9563662/comments",
    "author": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "4c9183e8bb6dc3faf80e301cf07c2d4d3abff405",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4c9183e8bb6dc3faf80e301cf07c2d4d3abff405",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/4c9183e8bb6dc3faf80e301cf07c2d4d3abff405"
      }
    ],
    "stats": {
      "total": 60,
      "additions": 57,
      "deletions": 3
    },
    "files": [
      {
        "sha": "d0a158a02c65d52a75efeb91399242d979a36cef",
        "filename": "src/qt/bitcoin.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 0,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3793fa09ff920fc720dfad3738f105d2c9563662/src/qt/bitcoin.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3793fa09ff920fc720dfad3738f105d2c9563662/src/qt/bitcoin.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/bitcoin.cpp?ref=3793fa09ff920fc720dfad3738f105d2c9563662",
        "patch": "@@ -6,6 +6,7 @@\n #include \"walletmodel.h\"\n #include \"optionsmodel.h\"\n #include \"guiutil.h\"\n+#include \"guiconstants.h\"\n \n #include \"init.h\"\n #include \"ui_interface.h\"\n@@ -164,6 +165,9 @@ int main(int argc, char *argv[])\n     Q_INIT_RESOURCE(bitcoin);\n     QApplication app(argc, argv);\n \n+    // Install global event filter that makes sure that long tooltips can be word-wrapped\n+    app.installEventFilter(new GUIUtil::ToolTipToRichTextFilter(TOOLTIP_WRAP_THRESHOLD, &app));\n+\n     // Command-line options take precedence:\n     ParseParameters(argc, argv);\n "
      },
      {
        "sha": "db0ddf453fdefb5a7f3a137b7cf41cca94c69860",
        "filename": "src/qt/bitcoingui.cpp",
        "status": "modified",
        "additions": 6,
        "deletions": 3,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3793fa09ff920fc720dfad3738f105d2c9563662/src/qt/bitcoingui.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3793fa09ff920fc720dfad3738f105d2c9563662/src/qt/bitcoingui.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/bitcoingui.cpp?ref=3793fa09ff920fc720dfad3738f105d2c9563662",
        "patch": "@@ -551,22 +551,25 @@ void BitcoinGUI::setNumBlocks(int count)\n     // Set icon state: spinning if catching up, tick otherwise\n     if(secs < 90*60 && count >= nTotalBlocks)\n     {\n-        tooltip = tr(\"Up to date\") + QString(\".\\n\") + tooltip;\n+        tooltip = tr(\"Up to date\") + QString(\".<br>\") + tooltip;\n         labelBlocksIcon->setPixmap(QIcon(\":/icons/synced\").pixmap(STATUSBAR_ICONSIZE, STATUSBAR_ICONSIZE));\n     }\n     else\n     {\n-        tooltip = tr(\"Catching up...\") + QString(\"\\n\") + tooltip;\n+        tooltip = tr(\"Catching up...\") + QString(\"<br>\") + tooltip;\n         labelBlocksIcon->setMovie(syncIconMovie);\n         syncIconMovie->start();\n     }\n \n     if(!text.isEmpty())\n     {\n-        tooltip += QString(\"\\n\");\n+        tooltip += QString(\"<br>\");\n         tooltip += tr(\"Last received block was generated %1.\").arg(text);\n     }\n \n+    // Don't word-wrap this (fixed-width) tooltip\n+    tooltip = QString(\"<nobr>\") + tooltip + QString(\"</nobr>\");\n+\n     labelBlocksIcon->setToolTip(tooltip);\n     progressBarLabel->setToolTip(tooltip);\n     progressBar->setToolTip(tooltip);"
      },
      {
        "sha": "54e9d644fe2d90c8c26fa879b33bd457eb56e9e4",
        "filename": "src/qt/guiconstants.h",
        "status": "modified",
        "additions": 5,
        "deletions": 0,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3793fa09ff920fc720dfad3738f105d2c9563662/src/qt/guiconstants.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3793fa09ff920fc720dfad3738f105d2c9563662/src/qt/guiconstants.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/guiconstants.h?ref=3793fa09ff920fc720dfad3738f105d2c9563662",
        "patch": "@@ -20,4 +20,9 @@ static const int STATUSBAR_ICONSIZE = 16;\n /* Transaction list -- bare address (without label) */\n #define COLOR_BAREADDRESS QColor(140, 140, 140)\n \n+/* Tooltips longer than this (in characters) are converted into rich text,\n+   so that they can be word-wrapped.\n+ */\n+static const int TOOLTIP_WRAP_THRESHOLD = 80;\n+\n #endif // GUICONSTANTS_H"
      },
      {
        "sha": "3b8f8c76f8cadade4aab68f2316af837f7b51e28",
        "filename": "src/qt/guiutil.cpp",
        "status": "modified",
        "additions": 24,
        "deletions": 0,
        "changes": 24,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3793fa09ff920fc720dfad3738f105d2c9563662/src/qt/guiutil.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3793fa09ff920fc720dfad3738f105d2c9563662/src/qt/guiutil.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/guiutil.cpp?ref=3793fa09ff920fc720dfad3738f105d2c9563662",
        "patch": "@@ -214,5 +214,29 @@ bool isObscured(QWidget *w)\n            && checkPoint(QPoint(w->width()/2, w->height()/2), w));\n }\n \n+ToolTipToRichTextFilter::ToolTipToRichTextFilter(int size_threshold, QObject *parent):\n+    size_threshold(size_threshold), QObject(parent)\n+{\n+\n+}\n+\n+bool ToolTipToRichTextFilter::eventFilter(QObject *obj, QEvent *evt)\n+{\n+    if(evt->type() == QEvent::ToolTipChange)\n+    {\n+        QWidget *widget = static_cast<QWidget*>(obj);\n+        QString tooltip = widget->toolTip();\n+        if(!Qt::mightBeRichText(tooltip) && tooltip.size() > size_threshold)\n+        {\n+            // Prefix <qt/> to make sure Qt detects this as rich text\n+            // Escape the current message as HTML and replace \\n by <br>\n+            tooltip = \"<qt/>\" + HtmlEscape(tooltip, true);\n+            widget->setToolTip(tooltip);\n+            return true;\n+        }\n+    }\n+    return QObject::eventFilter(obj, evt);\n+}\n+\n } // namespace GUIUtil\n "
      },
      {
        "sha": "8e9aae1cb03844630c16691f406eb082bd9d4a90",
        "filename": "src/qt/guiutil.h",
        "status": "modified",
        "additions": 18,
        "deletions": 0,
        "changes": 18,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3793fa09ff920fc720dfad3738f105d2c9563662/src/qt/guiutil.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3793fa09ff920fc720dfad3738f105d2c9563662/src/qt/guiutil.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/guiutil.h?ref=3793fa09ff920fc720dfad3738f105d2c9563662",
        "patch": "@@ -2,6 +2,7 @@\n #define GUIUTIL_H\n \n #include <QString>\n+#include <QObject>\n \n QT_BEGIN_NAMESPACE\n class QFont;\n@@ -69,6 +70,23 @@ namespace GUIUtil\n     // Determine whether a widget is hidden behind other windows\n     bool isObscured(QWidget *w);\n \n+    /** Qt event filter that intercepts ToolTipChange events, and replaces the tooltip with a rich text\n+      representation if needed. This assures that Qt can word-wrap long tooltip messages.\n+      Tooltips longer than the provided size threshold (in characters) are wrapped.\n+     */\n+    class ToolTipToRichTextFilter: public QObject\n+    {\n+        Q_OBJECT\n+    public:\n+        ToolTipToRichTextFilter(int size_threshold, QObject *parent);\n+\n+    protected:\n+        bool eventFilter(QObject *obj, QEvent *evt);\n+\n+    private:\n+        int size_threshold;\n+    };\n+\n } // namespace GUIUtil\n \n #endif // GUIUTIL_H"
      }
    ]
  }
]