[
  {
    "sha": "315a4d36f716341a38bc4e4de8630b3246d27dbc",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozMTVhNGQzNmY3MTYzNDFhMzhiYzRlNGRlODYzMGIzMjQ2ZDI3ZGJj",
    "commit": {
      "author": {
        "name": "fanquake",
        "email": "fanquake@gmail.com",
        "date": "2020-04-19T02:05:29Z"
      },
      "committer": {
        "name": "fanquake",
        "email": "fanquake@gmail.com",
        "date": "2020-04-19T02:05:29Z"
      },
      "message": "build: fix ASLR for bitcoin-cli on Windows\n\nASLR is not currently working for the bitcoin-cli.exe binary. This is\ndue to it not having a .reloc section, which is stripped by default by\nthe mingw-w64 ld we use for gitian builds. A good summary of issues with\nld and mingw-w64 is available in this thread:\nhttps://sourceware.org/bugzilla/show_bug.cgi?id=19011.\n\nAll other Windows binaries that we distribute (bitcoind, bitcoin-qt,\nbitcoin-wallet, bitcoin-tx and test_bitcoin) do not suffer this issue,\nand currently having working ASLR. This is due to them exporting\n(inadvertent or not) libsecp256k1 symbols, and, as a result, the .reloc\nsection is not stripped by ld.\n\nThis change is a temporary workaround, also the same one described here:\nhttps://www.kb.cert.org/vuls/id/307144/, that causes main() to be\nexported. Exporting a symbol will mean that the .reloc section is not\nstripped, and ASLR will function correctly.",
      "tree": {
        "sha": "0bf528b6cbc87120f6c70b3ba620b20ce5aa0f48",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0bf528b6cbc87120f6c70b3ba620b20ce5aa0f48"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/315a4d36f716341a38bc4e4de8630b3246d27dbc",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEz7FuIclQ9n+pXlWPLuufXMCVJsEFAl6buQQACgkQLuufXMCV\nJsFy8Q/+PHxlQ8zEZ6vgedhJ+CEYmO6qkZgNP4Jqzqwb1MTm01HUb1rtsfYvbMFE\nv+W0Iu/VlVsPWmt/OiL6/uDeeRutmyddfsN0E0WGnUH4SjsIuras3dvxVdziDVID\nMMevllEOyK5dQyvQcqcBEcUJD6vOBS0BMZBqGCHMy1n6gySN7Sm8Bz5U5OEDK9kn\nRdHjqHsFtxmcWY+uDeAG/VMu7zZN0LTR95O98bJR5rdVYQy2XYtMfycYnkjFzf4z\nN2eGZo945Y5FBpcUTpkhq/LQ+q1uLed3Ei78/Koa/VQeuc6ayZe++Y+1WjIHx5Rh\n7V2ptmRSaJHG9Le0L4gJYvD9PfMN5/lCAXD8GKkpEiL69oLqObRxXw4/1vlMpMBL\n1Y6n571L8Acf9Bk+K4KXmMTyRJVqLf/Ww1SKdsesYgbhDmKWSB0f5wbiKsJnD+Jt\nFiK+AEzfPdCM/9B0OlPNyKKz9mk7wwB+Y8KmVyl+a6lfg4cHNaBRlHmwjvEmkf0Q\nhZ9TRuAv0mI283RN5ZepTBDjFyagq4U/rwjEKl4WHYJJiIxS1y0n5NZzA1MU8J2I\nRJPmWmlgPL0eW8xvP06toWiWjzEBds4T7ZiOvy7GuRskGbpeLwoMQPfiEuFtreVb\nb5K8OITj60gohFQJ6a8kDDhD3sHFppY0WDmHEUF/3Es1foEVQGI=\n=x+35\n-----END PGP SIGNATURE-----",
        "payload": "tree 0bf528b6cbc87120f6c70b3ba620b20ce5aa0f48\nparent 6ae99aab5d97b06d46ff940111b290f1eeb90045\nauthor fanquake <fanquake@gmail.com> 1587261929 +0800\ncommitter fanquake <fanquake@gmail.com> 1587261929 +0800\n\nbuild: fix ASLR for bitcoin-cli on Windows\n\nASLR is not currently working for the bitcoin-cli.exe binary. This is\ndue to it not having a .reloc section, which is stripped by default by\nthe mingw-w64 ld we use for gitian builds. A good summary of issues with\nld and mingw-w64 is available in this thread:\nhttps://sourceware.org/bugzilla/show_bug.cgi?id=19011.\n\nAll other Windows binaries that we distribute (bitcoind, bitcoin-qt,\nbitcoin-wallet, bitcoin-tx and test_bitcoin) do not suffer this issue,\nand currently having working ASLR. This is due to them exporting\n(inadvertent or not) libsecp256k1 symbols, and, as a result, the .reloc\nsection is not stripped by ld.\n\nThis change is a temporary workaround, also the same one described here:\nhttps://www.kb.cert.org/vuls/id/307144/, that causes main() to be\nexported. Exporting a symbol will mean that the .reloc section is not\nstripped, and ASLR will function correctly.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/315a4d36f716341a38bc4e4de8630b3246d27dbc",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/315a4d36f716341a38bc4e4de8630b3246d27dbc",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/315a4d36f716341a38bc4e4de8630b3246d27dbc/comments",
    "author": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "6ae99aab5d97b06d46ff940111b290f1eeb90045",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6ae99aab5d97b06d46ff940111b290f1eeb90045",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/6ae99aab5d97b06d46ff940111b290f1eeb90045"
      }
    ],
    "stats": {
      "total": 12,
      "additions": 10,
      "deletions": 2
    },
    "files": [
      {
        "sha": "cdaabd6fab1658ed059f1d8c11b47805ee4874cc",
        "filename": "src/bitcoin-cli.cpp",
        "status": "modified",
        "additions": 10,
        "deletions": 2,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/315a4d36f716341a38bc4e4de8630b3246d27dbc/src/bitcoin-cli.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/315a4d36f716341a38bc4e4de8630b3246d27dbc/src/bitcoin-cli.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bitcoin-cli.cpp?ref=315a4d36f716341a38bc4e4de8630b3246d27dbc",
        "patch": "@@ -551,11 +551,19 @@ static int CommandLineRPC(int argc, char *argv[])\n     return nRet;\n }\n \n-int main(int argc, char* argv[])\n-{\n #ifdef WIN32\n+// Export main() and ensure working ASLR on Windows.\n+// Exporting a symbol will prevent the linker from stripping\n+// the .reloc section from the binary, which is a requirement\n+// for ASLR. This is a temporary workaround until a fixed\n+// version of binutils is used for releases.\n+__declspec(dllexport) int main(int argc, char* argv[])\n+{\n     util::WinCmdLineArgs winArgs;\n     std::tie(argc, argv) = winArgs.get();\n+#else\n+int main(int argc, char* argv[])\n+{\n #endif\n     SetupEnvironment();\n     if (!SetupNetworking()) {"
      }
    ]
  }
]