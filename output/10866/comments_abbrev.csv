TheBlueMatt,2017-07-18T20:57:21Z,"Do we actually enforce that on Travis? Its nice to have the auto-checker stuff, but AFAIR its (barely) hooked up anywhere?",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-316195434,316195434,
practicalswift,2017-07-18T21:24:58Z,"@TheBlueMatt Travis is currently not compiling with [Clang Thread Safety Analysis](https://clang.llvm.org/docs/ThreadSafetyAnalysis.html) warnings (`-Wthread-safety-analysis`) enabled. (Do we want to change that?)\n\nPersonally I build daily using `clang` with `-Wthread-safety-analysis` enabled.\n\nIn the general case we want to fix all warnings emitted when compiling with `-Wthread-safety-ana",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-316202564,316202564,
sipa,2017-07-19T00:39:43Z,"If we're going to revive this safety checking infrastructure (it was introduced in #2003, and I don't think updated much since), there are probably many other places to add annotations.",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-316238630,316238630,
jonasschnelli,2017-07-19T09:49:55Z,"Agree with @sipa.\n@practicalswift whats the reason of only add the safety checking infrastructure to `AddToCompactExtraTransactions`?",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-316332960,316332960,
practicalswift,2017-07-19T14:50:24Z,"The reason I'm starting with `AddToCompactExtraTransactions(…)` is simply to fix the only current warning when building with `clang`'s `-Wthread-safety-analysis` enabled:\n\n```\nnet_processing.cpp:587:10: warning: reading variable 'vExtraTxnForCompact' requires holding mutex 'cs_main' [-Wthread-safety-analysis]\n```\n\nThe reason for the warning is that `vExtraTxnForCompact` is marked as gu",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-316412165,316412165,
practicalswift,2017-07-19T15:06:16Z,"Additional reading: The [""C/C++ Thread Safety Analysis""](https://research.google.com/pubs/archive/42958.pdf) paper (Hutchins, Ballman & Sutherland, 2014) paper describing `clang` thread-safety analysis and how it is used for the Google C++ codebase:\n\n> They essentially provide a static type system for threads, and can detect potential race conditions and deadlocks. This paper describes Clang T",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-316417209,316417209,
TheBlueMatt,2017-07-19T22:12:48Z,"Ah! Didn't realize its to fix a warning, yea, lets a) do this and b) can you add a -Werror=thread-safety-analysis here, too? I was informed travis already does a clang build for OSX, so it should be able to catch errors here :).",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-316533985,316533985,
practicalswift,2017-07-19T22:26:02Z,@TheBlueMatt Sure! I've updated the PR title to make things more clear :-),https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-316537015,316537015,
TheBlueMatt,2017-07-24T15:31:16Z,"I think we really should make travis enforce this. It shouldnt be hard cause we already have --enable-werror by default, just need to hook up -Werror=thread-safety-analysis if the compiler supports it (which our clang-osx build should).",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-317460836,317460836,
practicalswift,2017-07-24T15:56:49Z,"@TheBlueMatt Would something along the lines of the following do the trick for Travis?\n\n```diff\ndiff --git a/.travis.yml b/.travis.yml\nindex a79428f..423b04e 100644\n--- a/.travis.yml\n+++ b/.travis.yml\n@@ -34,7 +34,7 @@ env:\n # No wallet\n     - HOST=x86_64-unknown-linux-gnu PACKAGES=""python3"" DEP_OPTS=""NO_WALLET=1"" RUN_TESTS=true GOAL=""install"" BITCOIN_CONFIG=""--enable-glibc-back-",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-317468538,317468538,
TheBlueMatt,2017-07-24T20:57:04Z,"@practicalswift I was referring to the -Werror support we already have in configure.ac. Best to use that, I'd think.",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-317552353,317552353,
practicalswift,2017-07-24T21:57:59Z,"@TheBlueMatt Got it! What about this:\n\n```diff\ndiff --git a/configure.ac b/configure.ac\nindex aea5d71..ec3877d 100644\n--- a/configure.ac\n+++ b/configure.ac\n@@ -241,6 +241,7 @@ if test ""x$enable_werror"" = ""xyes""; then\n     AC_MSG_ERROR(""enable-werror set but -Werror is not usable"")\n   fi\n   AX_CHECK_COMPILE_FLAG([-Werror=vla],[ERROR_CXXFLAGS=""$ERROR_CXXFLAGS -Werror=vla""],,[[$CX",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-317567066,317567066,
TheBlueMatt,2017-07-25T20:00:30Z,"Heh, I figured you'd incldue it in this PR. Anyway, utACK this pr by itself.",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-317854805,317854805,
theuni,2017-07-31T14:18:24Z,utACK ef2aca6c12efc48ce557a87c90ecf2d96ad4885e,https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-319080566,319080566,
TheBlueMatt,2017-08-01T15:01:57Z,"utACK ef2aca6c12efc48ce557a87c90ecf2d96ad4885e, though its useful to hold off merging this until #10923 is ready as a test for #10923.",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-319397367,319397367,
practicalswift,2017-08-18T13:50:17Z,"Cherry-picked 9df85380aae4219920ccca80efac2bdf408519d8 into this PR as suggested by @TheBlueMatt in #10923!\n\n@TheBlueMatt, looks good? :-)",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-323359026,323359026,
TheBlueMatt,2017-08-18T21:40:37Z,"@ptracticalswift maybe rebase on #10923 and take the patches from https://github.com/TheBlueMatt/bitcoin/commits/2017-08-test-10923 (squashed, of course)?",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-323467121,323467121,
practicalswift,2017-08-19T17:07:41Z,@TheBlueMatt Does this PR look good now? Please check my attempt to summarize your changes in the commit message for https://github.com/bitcoin/bitcoin/pull/10866/commits/695fe315e8c4191bd5e9e98a8ce6d2be8c6aff96. Let me know if anything should be changed or if you'd rather squash your commits in your branch and have me cherry pick the resulting commit as-is :-),https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-323535396,323535396,
practicalswift,2017-08-23T15:30:57Z,"@MarcoFalke Thanks! Rebased on top of `master`, so the already merged commit is now excluded from this PR :-)",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-324373178,324373178,
danra,2017-08-30T19:06:10Z,"@practicalswift \nNACK\n1) Transaction time check was changed:\n-            checktxtime = boost::get_system_time() + boost::posix_time::minutes(1);\n +            checktxtime = std::chrono::steady_clock::now() + std::chrono::seconds(1);\n\n2) IMO there are too many things going on in the first commit at once, making it hard to review and bug-prone. Switching the primitives in the sync modul",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-326088724,326088724,
practicalswift,2017-09-01T07:42:35Z,"@danra Are you referring to @TheBlueMatt:s commit f01ea9326bc69d4f731a5904881740308c5e4271?\n\nThis PR contains three commits. Please consider reviewing d77d9ccd1ad35f550c8dcdc3b83e65bad8c51c48 and 0c7115c56fdbe25257aee23ae002dc5af3238bb7 too :-)",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-326513048,326513048,
practicalswift,2017-09-01T07:46:30Z,"@sipa @TheBlueMatt @jonasschnelli @theuni I have some follow-up work which depends on this PR. Do you have time reviewing this PR?\n\nThe follow-up work is a PR adding `GUARDED_BY(…)` and `EXCLUSIVE_LOCKS_REQUIRED(…)` annotations where appropriate.",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-326513832,326513832,
danra,2017-09-01T09:26:06Z,"@practicalswift Yes, referring to f01ea93",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-326534428,326534428,
practicalswift,2017-09-01T09:29:19Z,@TheBlueMatt Do you have any input on @danra:s review?,https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-326535153,326535153,
practicalswift,2017-09-03T17:04:05Z,Please see #11226 for the follow-up PR which adds `GUARDED_BY(…)` and `EXCLUSIVE_LOCKS_REQUIRED(…)` annotations.,https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-326817382,326817382,
TheBlueMatt,2017-09-04T22:16:16Z,"@danra Indeed, the minutes -> seconds change was a mistake, should probably be fixed. Indeed, the first commit was originally several different commits, but they werent logically split up so it was easier to squash them than to manually re-split them. Personally I find the first commit not-too-hard to review cause the changes are pretty clearly along file boundaries, but then I also wrote it, so I",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-327033991,327033991,
practicalswift,2017-09-05T06:17:07Z,@TheBlueMatt I've now added a commit fixing the minutes/seconds mix-up. Looks good? :-),https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-327081361,327081361,
TheBlueMatt,2017-09-06T00:50:51Z,"Yup, needs a squash though.",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-327342903,327342903,
practicalswift,2017-09-06T07:06:33Z,@TheBlueMatt Squashed! Looks good? :-),https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-327394883,327394883,
practicalswift,2017-09-15T12:51:44Z,"Anyone willing to review? :-)\n\nHaving this PR merged would simplify the work on follow-up PR:s such as #11226.",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-329773866,329773866,
TheBlueMatt,2017-09-15T19:18:14Z,"@practicalswift generally, when squashing, please try to avoid rebasing as it makes it much easier for reviewers to track which changes you made between two commits of a PR.\n\nre-utACK b22210337da62047290fcb2658b2c45117c7efa9",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-329875597,329875597,
danra,2017-09-15T21:28:37Z,"@TheBlueMatt \n> Personally I find the first commit not-too-hard to review cause the changes are pretty clearly along file boundaries, but then I also wrote it, so I cant speak....\n\nIMHO the fact that there were a few utACKs before fixing the minutes-seconds bug demonstrates that the commit was doing too many things at once to review easily.\n\nSo it's still a NACK from me until it's split ",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-329908560,329908560,
theuni,2017-09-15T21:37:11Z,"utACK ~~other than my comment above~~. I think the commits here are ok. Either way, with #11199 or this one, we're going to need some follow-ups to tidy up afterwards.",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-329910036,329910036,
practicalswift,2017-09-19T21:29:27Z,"@TheBlueMatt Thanks for the utACK. I'll avoid rebasing when squashing going forward. Thanks for the suggestion!\n\n@theuni Thanks for the utACK.\n\nAnyone else who has time to review? Having this merged would help my annotations work a lot :-)",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-330679204,330679204,
practicalswift,2017-10-09T14:27:28Z,@ryanofsky Thanks for the review. I've now added two commits addressing the two issues raised. Additionally I found a boost include that is no longer needed. Would you mind re-reviewing and confirming that your feedback was properly addressed? :-),https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-335174802,335174802,
practicalswift,2017-10-09T19:23:13Z,@ryanofsky Good point regarding combining the related commits. Could you please re-review? :-),https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-335261421,335261421,
theuni,2017-10-09T19:36:47Z,"utACK 7ab7662dc067951fc9fd1364bd6d1446c8770305. I suspect that we may run into symbol collisions at some point by using the generic ""Mutex"" name, but it'll be obvious if that happens.",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-335264524,335264524,
practicalswift,2017-10-09T20:56:41Z,@ryanofsky Thanks for re-reviewing! Feedback address. Would you mind re-reviewing again? :-),https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-335285582,335285582,
practicalswift,2017-10-09T21:09:41Z,"@ryanofsky Sorry, fixed. Would you mind re-reviewing? :-)",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-335290284,335290284,
TheBlueMatt,2017-11-01T17:12:37Z,"Not sure how I feel about renaming CMutexLock type in the same commit that changes a bunch of stuff from boost -> std, let alone in a commit people were complaining was already too large.",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-341172890,341172890,
practicalswift,2017-11-02T09:42:00Z,"@TheBlueMatt Should I revert it by doing a `s/RecursiveLock/CMutexLock/` and squash, or should I keep the rename but put it in a separate commit? Please advice :-)",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-341367475,341367475,
ryanofsky,2017-11-02T09:58:14Z,"CMutexLock is only mentioned in 5 lines of code, all of them in sync.h. Sometimes it's nice to make changes in separate commits, but I think this particular rename makes more sense in context, and doesn't seem make the PR more complicated to review. But maybe I'm missing something because this entire change is only 47 lines and seems pretty straightforward to me.",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-341371700,341371700,
practicalswift,2017-11-02T17:10:15Z,@TheBlueMatt @ryanofsky I'll let you guys find consensus. I'll happily adjust :-),https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-341492327,341492327,
TheBlueMatt,2017-11-02T19:57:35Z,"@ryanofsky in this case the PR adds a compatibility typedef to allow places to keep using CCriticalSection, renaming the underlying type and then mapping the old typename to the new one. I agree it should be renamed, but we should actually rename it instead of halfway-renaming it (using scripted-diff =D).",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-341539815,341539815,
ryanofsky,2017-11-02T20:12:57Z,Agree scripted diff would improve upon the typedef.,https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-341544000,341544000,
TheBlueMatt,2017-11-02T20:15:43Z,"In the interest of getting this very-important PR merged sooner rather than later, can we skip it for now?",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-341544718,341544718,
ryanofsky,2017-11-02T20:17:21Z,SGTM,https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-341545191,341545191,
theuni,2017-11-02T20:25:10Z,+1,https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-341547267,341547267,
practicalswift,2017-11-02T22:10:31Z,Please review the latest commit added - does that revert the rename as suggested? Everyone happy? :-),https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-341573294,341573294,
ryanofsky,2017-11-02T22:20:47Z,"@practicalswift, ~~~I think you can drop the ""Revert CMutexLock rename"" commit.~~~ (EDIT: Actually should be kept and squashed)\n\nWhat Matt is asking you to do is remove the two typedefs:\n\n```diff\n+typedef RecursiveMutex CCriticalSection;\n+typedef Mutex CWaitableCriticalSection\n```\n\nWhich will require replacing RecursiveMutex to CCriticalSection and Mutex to CWaitableCriticalSecti",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-341575399,341575399,
practicalswift,2017-11-02T22:56:27Z,@ryanofsky Could you take a look at `Revert [wip]`? :-),https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-341582192,341582192,
ryanofsky,2017-11-02T23:07:27Z,"That looks close. Here is another commit that builds on top of yours and gets rid of more unnecessary renames & diffs: 17ebad7b47a2567a75e5a701780a261bf1a3275d (I was wrong above when I asked you to drop CMutexLock commit). If you squash both of these into ""Fix -Wthread-safety-analysis warnings"" and edit the commit message to remove mention of renames, this should be good to go.",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-341584330,341584330,
ryanofsky,2017-11-02T23:19:32Z,"Here is a combined branch: https://github.com/ryanofsky/bitcoin/commits/pr/locks\n\nYou can fetch & apply it with\n\n```sh\ngit fetch -n https://github.com/ryanofsky/bitcoin pr/locks:ryanofsky-locks\ngit reset --hard ryanofsky-locks\n```",https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-341586429,341586429,
practicalswift,2017-11-03T00:12:38Z,@ryanofsky Looks good now? :-),https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-341594641,341594641,
practicalswift,2017-11-06T16:43:38Z,@ryanofsky @TheBlueMatt Name change patch applied. Squashed and pushed. Could you please re-review? :-),https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-342208555,342208555,
TheBlueMatt,2017-11-06T16:52:19Z,utACK 76ea17c7964c15dd90e10c2c257cdeb5847b3d69,https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-342211472,342211472,
sipa,2017-11-07T18:20:49Z,utACK 76ea17c7964c15dd90e10c2c257cdeb5847b3d69. Nice to see some further unboostification.,https://github.com/bitcoin/bitcoin/pull/10866#issuecomment-342574505,342574505,
MarcoFalke,2017-08-23T13:10:55Z,This change is already in master,https://github.com/bitcoin/bitcoin/pull/10866#discussion_r134746407,134746407,.travis.yml
theuni,2017-09-15T21:19:12Z,"cvBlockChange needs to be notified in Interrupt() in init, otherwise we'll hang here at shutdown.",https://github.com/bitcoin/bitcoin/pull/10866#discussion_r139252430,139252430,src/rpc/mining.cpp
practicalswift,2017-09-19T18:51:09Z,"@theuni Something like this? :-)\n\n```diff\ndiff --git a/src/init.cpp b/src/init.cpp\nindex 25b8caf..73f4860 100644\n--- a/src/init.cpp\n+++ b/src/init.cpp\n@@ -167,6 +167,7 @@ void Interrupt(boost::thread_group& threadGroup)\n     if (g_connman)\n         g_connman->Interrupt();\n     threadGroup.interrupt_all();\n+    cvBlockChange.notify_all();\n }\n\n void Shutdown()\n```",https://github.com/bitcoin/bitcoin/pull/10866#discussion_r139783317,139783317,src/rpc/mining.cpp
theuni,2017-09-19T19:06:37Z,"Looking deeper, I think this is actually ok (though circuitous) as-is.\n```\nStopRPC() -> g_rpcSignals.Stopped() -> OnRPCStopped() -> cvBlockChange.notify_all()\n```\nSo, nevermind my comment.",https://github.com/bitcoin/bitcoin/pull/10866#discussion_r139787328,139787328,src/rpc/mining.cpp
ryanofsky,2017-10-06T21:01:50Z,Comment above still mentions boost.,https://github.com/bitcoin/bitcoin/pull/10866#discussion_r143293506,143293506,src/sync.h
ryanofsky,2017-10-06T21:02:13Z,"In commit ""Fix -Wthread-safety-analysis warnings.""\n\nComment above still mentions boost.",https://github.com/bitcoin/bitcoin/pull/10866#discussion_r143293593,143293593,src/sync.h
ryanofsky,2017-10-06T21:17:43Z,"In commit ""Fix -Wthread-safety-analysis warnings.""\n\nThe naming here doesn't seem very consistent:\n\nRecursive mutex: **CCriticalSection** (unchanged)\nRecursive lock: **CCriticalBlock** (previously _CMutexLock_)\nNon-recursive mutex: **CWaitableCriticalSection** (unchanged)\nNon-recursive lock: **CWaitableLock** (previously didn't exist)\n\nI don't see why we wouldn't just follow the s",https://github.com/bitcoin/bitcoin/pull/10866#discussion_r143296309,143296309,src/sync.h
ryanofsky,2017-10-09T20:41:00Z,Could s/CWaitableCriticalSection/Mutex,https://github.com/bitcoin/bitcoin/pull/10866#discussion_r143571665,143571665,src/init.cpp
ryanofsky,2017-10-09T20:42:37Z,Comment is a little misleading since it's a wrapper around std::unique_lock\<RecursiveMutex>,https://github.com/bitcoin/bitcoin/pull/10866#discussion_r143572014,143572014,src/sync.h
TheBlueMatt,2017-11-01T17:09:38Z,"Hmm, that feels weird? We now have CCriticalSection and Mutex which mean two different things, but its not clear /what/ they mean without looking at what they're typedef'd to? Can we just do this as a scripted diff in a separate commit?",https://github.com/bitcoin/bitcoin/pull/10866#discussion_r148322160,148322160,src/init.cpp
ryanofsky,2017-11-03T12:19:44Z,"> Hmm, that feels weird? We now have CCriticalSection and Mutex which mean two different things, but its not clear /what/ they mean without looking at what they're typedef'd to? Can we just do this as a scripted diff in a separate commit?\n\nScripted-diff renaming followup is at https://github.com/bitcoin/bitcoin/pull/11599",https://github.com/bitcoin/bitcoin/pull/10866#discussion_r148768092,148768092,src/init.cpp
TheBlueMatt,2017-11-03T21:17:45Z,"I'd really rather we *not* call this a ""Lock"" - its not intended to be the thing used across the codebase as any lock (though we could maybe do so if we add DEBUG_LOCKORDER support here).",https://github.com/bitcoin/bitcoin/pull/10866#discussion_r148895433,148895433,src/sync.h
ryanofsky,2017-11-03T21:27:46Z,"You always say what you don't want instead of saying what you do want ;). What would you like instead? If you've seen https://github.com/bitcoin/bitcoin/pull/11599, the name should make more sense in this context. I think Lock and Mutex are the right names because they match the standard. As you mentioned, you can implement DEBUG_LOCKORDER with them and also do other things useful for debugging, l",https://github.com/bitcoin/bitcoin/pull/10866#discussion_r148897091,148897091,src/sync.h
TheBlueMatt,2017-11-03T21:36:02Z,"The original name (CWaitableCriticalSection) was nice and specific - I'm happy to make it more in-line with the more-accepted ""lock"" terminology, but pointing out that it has only a narrow use-case in our codebase is important.",https://github.com/bitcoin/bitcoin/pull/10866#discussion_r148898390,148898390,src/sync.h
ryanofsky,2017-11-03T21:48:21Z,"Ok, but I don't think non-recursive locks should have a narrow usecase in our codebase. I thought everybody agreed non-recursivelocks should be preferred to recursive locks.",https://github.com/bitcoin/bitcoin/pull/10866#discussion_r148900396,148900396,src/sync.h
ryanofsky,2017-11-03T21:49:15Z,Also CWaitableCriticalSection was not the original name for this. There was no original name for this. Previously code just used boost::unique_lock directly.,https://github.com/bitcoin/bitcoin/pull/10866#discussion_r148900530,148900530,src/sync.h
TheBlueMatt,2017-11-03T21:51:04Z,"Heh, I meant in the original patch in this PR. I mean we use locks in lots of different ways, for new subsystems that have very careful locking models, obviously non-recursive locks are preferred, but I'm skeptical every new thing we add will use them.",https://github.com/bitcoin/bitcoin/pull/10866#discussion_r148900795,148900795,src/sync.h
practicalswift,2017-11-03T21:53:14Z,@ryanofsky @TheBlueMatt Could you provide a diff with your suggested change?,https://github.com/bitcoin/bitcoin/pull/10866#discussion_r148901104,148901104,src/sync.h
ryanofsky,2017-11-03T21:59:35Z,I think Matt basically wants the typedef to be called ScaryLock instead of Lock. But I'm fine with whatever is proposed here given there is already a PR open for renaming.,https://github.com/bitcoin/bitcoin/pull/10866#discussion_r148902104,148902104,src/sync.h
practicalswift,2017-11-04T11:07:05Z,"OK, I'll fix. @TheBlueMatt, what is your suggested name instead of `Lock`? :-)",https://github.com/bitcoin/bitcoin/pull/10866#discussion_r148927933,148927933,src/sync.h
TheBlueMatt,2017-11-04T18:58:01Z,I was fine with the WaitableCriticalSection (or WaitableLock or whatever) version that was there originally.,https://github.com/bitcoin/bitcoin/pull/10866#discussion_r148938734,148938734,src/sync.h
practicalswift,2017-11-06T12:26:40Z,"@TheBlueMatt @ryanofsky The following diff would work?\n\n```diff\ndiff --git a/src/init.cpp b/src/init.cpp\nindex dd64602..9e3eb6b 100644\n--- a/src/init.cpp\n+++ b/src/init.cpp\n@@ -551,7 +551,7 @@ static void BlockNotifyGenesisWait(bool, const CBlockIndex *pBlockIndex)\n {\n     if (pBlockIndex != nullptr) {\n         {\n-            Lock lock_GenesisWait(cs_GenesisWait);\n+        ",https://github.com/bitcoin/bitcoin/pull/10866#discussion_r149066098,149066098,src/sync.h
ryanofsky,2017-11-06T12:58:29Z,"> @TheBlueMatt @ryanofsky The following diff would work?\n\nYes for me. (As I mentioned in my last comment I am happy with any naming in this pr since #11599 can clean up any inconsistencies.)",https://github.com/bitcoin/bitcoin/pull/10866#discussion_r149071967,149071967,src/sync.h
practicalswift,2017-11-06T13:02:37Z,@ryanofsky Excellent! OK with you @TheBlueMatt? :-),https://github.com/bitcoin/bitcoin/pull/10866#discussion_r149072680,149072680,src/sync.h
TheBlueMatt,2017-11-06T16:38:04Z,"Yea, looks good, thanks!",https://github.com/bitcoin/bitcoin/pull/10866#discussion_r149132084,149132084,src/sync.h
