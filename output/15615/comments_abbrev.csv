promag,2019-03-17T23:52:27Z,"Tested ACK 4e74875. Sample output with `-testnet`:\n\n```\n2019-03-17T23:49:45Z Synchronizing blockheaders, height: 1153998 (~92.96%)\n2019-03-17T23:49:45Z more getheaders (1153998) to end to peer=0 (startheight:1485065)\n2019-03-17T23:49:45Z sending getheaders (1061 bytes) peer=0\n2019-03-17T23:49:45Z received: headers (162003 bytes) peer=0\n2019-03-17T23:49:45Z Synchronizing blockheaders,",https://github.com/bitcoin/bitcoin/pull/15615#issuecomment-473728431,473728431,
practicalswift,2019-03-18T10:31:16Z,"Can we find a way to make it so that the non-debug output is non-quiet but not spammy?\n\nI'm afraid the total number of logged lines would be substantial if merged as is. This in turn would educe the signal-to-noise ratio and reduce the value of the log.\n\nLogging too much to the non-debug log is almost as bad as logging too little :-)",https://github.com/bitcoin/bitcoin/pull/15615#issuecomment-473854909,473854909,
jonasschnelli,2019-03-18T10:54:22Z,"> Can we find a way to make it so that the non-debug output is non-quiet but not spammy?\n\nI don't think its spammy... At current height, it logs around 284 lines for the header sync... seems acceptable compared to >567000 lines from UpdateTip during IBD.",https://github.com/bitcoin/bitcoin/pull/15615#issuecomment-473862461,473862461,
practicalswift,2019-03-18T10:57:07Z,"@jonasschnelli I'm not very fond of the `UpdateTip` logging during IBD either :-)\n\nCan you think of a smart way to reduce the number of logged lines while achieving the stated goals?\n\nLet's not forget that this is the logging meeting a first-time `bitcoind` user: let's give a nice first usability impression :-)",https://github.com/bitcoin/bitcoin/pull/15615#issuecomment-473863363,473863363,
sipa,2019-03-25T23:37:23Z,"> Let's not forget that this is the logging meeting a first-time bitcoind user: let's give a nice first usability impression\n\nIt's called a debug log. I don't think the criterion to optimize for is usability, but a tradeoff between disk usage and ability to diagnose problems (by an expert user or developer).",https://github.com/bitcoin/bitcoin/pull/15615#issuecomment-476417919,476417919,
practicalswift,2019-03-26T09:06:43Z,"@sipa Clarification: When talking about usability I was referring the ""write to standard output for immediate consumption"" aspect of `LogPrintf(…)` and not the ""write to `debug.log` on disk for later consumption"" aspect.\n\nGenerally I think we print too much debug information to standard output resulting in a low signal-to-noise ratio for the end-user invoking `bitcoind`.\n\nPerhaps this coul",https://github.com/bitcoin/bitcoin/pull/15615#issuecomment-476534211,476534211,
laanwj,2019-06-13T14:24:28Z,"Concept ACK, I think it's better to log something. Could add logic to log only every so many %, but this is a good start.\n\nIt does fail to build here, might need rebase for recent changes:\n```\n/.../bitcoin/src/validation.cpp: In function ‘bool ProcessNewBlockHeaders(const std::vector<CBlockHeader>&, CValidationState&, const CChainParams&, const CBlockIndex**, CBlockHeader*)’:\n/.../bitcoi",https://github.com/bitcoin/bitcoin/pull/15615#issuecomment-501725483,501725483,
jonasschnelli,2019-06-13T14:39:24Z,"Thanks @laanwj!\nFixed.",https://github.com/bitcoin/bitcoin/pull/15615#issuecomment-501731964,501731964,
fanquake,2019-06-14T07:46:54Z,"Concept ACK https://github.com/bitcoin/bitcoin/pull/15615/commits/d75e704ac08fb43320e3ebcdde0d2a5392fdec9f\n\nAgree with @sipa:\n> It's called a debug log. I don't think the criterion to optimize for is usability, but a tradeoff between disk usage and ability to diagnose problems (by an expert user or developer).\n\nTested on top of master (7524376a81a1955f4da4adb23005f2122b18a270) using -tes",https://github.com/bitcoin/bitcoin/pull/15615#issuecomment-502006256,502006256,
practicalswift,2019-06-14T09:09:58Z,"@fanquake \n\nAgain: the problem is not what we're writing to disk. The problem is that this will also be written to standard output.\n\nI'm afraid such verbose logging will flood the console and effectively hide any important non- `blockheaders` issues.\n\nI'm not convinced this will be a net win if merged as is: sure, we'll have plenty of information about any `blockheaders` issue at the c",https://github.com/bitcoin/bitcoin/pull/15615#issuecomment-502033490,502033490,
jonasschnelli,2019-06-14T10:43:18Z,"@practicalswift:\nWe are speaking around 280 lines mainly happening once before the initial IBD (later probably due to falling out of sync, but much less lines). I don't think this is noise rather it's a great help to figure out what's going on in general and if you are slowed down during a single-peer header sync.",https://github.com/bitcoin/bitcoin/pull/15615#issuecomment-502061864,502061864,
practicalswift,2019-06-14T12:56:40Z,"@jonasschnelli Sorry: my last comment was written under the incorrect assumption that the number of lines that would be printed was ~5000 judging from @fanquake's posted gist. I read the output as 5000 lines written at a speed of 10 lines/second during the first ten minutes of operation. I now understand that this is incorrect :-)\n\nI guess 280 lines is a bit more than I'd like personally but i",https://github.com/bitcoin/bitcoin/pull/15615#issuecomment-502098973,502098973,
MarcoFalke,2019-03-17T19:25:42Z,`ppindex` is nullptr for some calls,https://github.com/bitcoin/bitcoin/pull/15615#discussion_r266254816,266254816,src/validation.cpp
promag,2019-03-17T19:25:42Z,Isn't cs_main required for pindexBestHeader?,https://github.com/bitcoin/bitcoin/pull/15615#discussion_r266254817,266254817,src/validation.cpp
jonasschnelli,2019-03-17T19:46:11Z,Hhhmp.. fixed.,https://github.com/bitcoin/bitcoin/pull/15615#discussion_r266255712,266255712,src/validation.cpp
jonasschnelli,2019-03-17T19:46:17Z,Fixed.,https://github.com/bitcoin/bitcoin/pull/15615#discussion_r266255716,266255716,src/validation.cpp
practicalswift,2019-03-21T13:16:12Z,"```suggestion\n            static int last_logged_block_header_height = 0;\n            if (last_logged_block_header_height == 0 || (*ppindex)->nHeight - last_logged_block_header_height >= 100000) {\n                LogPrintf(""Synchronizing block headers: height=%d (~%.2f%%)\n"", (*ppindex)->nHeight, 100.0/((*ppindex)->nHeight+(GetAdjustedTime() - (*ppindex)->GetBlockTime()) / Params().GetConsen",https://github.com/bitcoin/bitcoin/pull/15615#discussion_r267749958,267749958,src/validation.cpp
promag,2019-03-21T13:27:36Z,Why?,https://github.com/bitcoin/bitcoin/pull/15615#discussion_r267754883,267754883,src/validation.cpp
practicalswift,2019-03-21T13:59:35Z,@promag See previous discussion in this PR regarding user-friendly logging.,https://github.com/bitcoin/bitcoin/pull/15615#discussion_r267769219,267769219,src/validation.cpp
promag,2019-03-24T11:10:10Z,"These are logs and come at a good pace, I'd merge this as it is.",https://github.com/bitcoin/bitcoin/pull/15615#discussion_r268428620,268428620,src/validation.cpp
MarcoFalke,2019-03-24T14:32:32Z,"Could add a comment why you are checking for `pindexBestHeader`, which is unused below.",https://github.com/bitcoin/bitcoin/pull/15615#discussion_r268436513,268436513,src/validation.cpp
jonasschnelli,2019-05-09T18:31:49Z,It's a relict and not necessary. Removed it just now. ,https://github.com/bitcoin/bitcoin/pull/15615#discussion_r282611221,282611221,src/validation.cpp
