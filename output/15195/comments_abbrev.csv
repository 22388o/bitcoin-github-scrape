IlyasRidhuan,2019-01-18T05:39:22Z,"Ack https://github.com/bitcoin/bitcoin/pull/15195/commits/2fef1852cfacd5a435d78cee51c0059061941dc0\nTested open and close wallet behaviour with multiple wallets loaded",https://github.com/bitcoin/bitcoin/pull/15195#issuecomment-455433740,455433740,
hebasto,2019-01-18T09:27:11Z,Concept ACK.,https://github.com/bitcoin/bitcoin/pull/15195#issuecomment-455481484,455481484,
harding,2019-01-18T11:53:42Z,"Tested works for me on Debian stable.  Code not reviewed.  I did get some compiler warnings:\n\n<details>\n\n\n      CXX      interfaces/libbitcoin_server_a-node.o\n    interfaces/node.cpp:42:10: warning: redundant redeclaration of ‘boost::filesystem::path GetWalletDir()’ in same scope [-Wredundant-decls]\n     fs::path GetWalletDir();\n              ^~~~~~~~~~~~\n    In file included fro",https://github.com/bitcoin/bitcoin/pull/15195#issuecomment-455521881,455521881,
flack,2019-01-18T20:42:07Z,"Is it possible to visually separate the wallet name from the question text in the confirmation dialog? For example by putting quotes around it or adding a line break before. \n\nSilly example: A wallet named `??!?` would currently render\n\n```\nAre you sure you wish to close wallet ??!??\n```\nThis would look slightly less confusing:\n```\nAre you sure you wish to close wallet ""??!?""?\n",https://github.com/bitcoin/bitcoin/pull/15195#issuecomment-455681027,455681027,
promag,2019-01-18T20:47:40Z,"@flack good point, I'll see other examples too. ",https://github.com/bitcoin/bitcoin/pull/15195#issuecomment-455682565,455682565,
DrahtBot,2019-01-18T22:42:55Z,<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.,https://github.com/bitcoin/bitcoin/pull/15195#issuecomment-455711773,455711773,
Sjors,2019-01-19T07:37:46Z,"Concept ACK.\n\nWhen the node is pruned, can you add a warning that closing the wallet for too long can result in having to resync the entire chain?",https://github.com/bitcoin/bitcoin/pull/15195#issuecomment-455757697,455757697,
Sjors,2019-02-12T18:26:49Z,Needs rebase now that open wallet is merged.,https://github.com/bitcoin/bitcoin/pull/15195#issuecomment-462876735,462876735,
promag,2019-02-12T23:03:35Z,"@flack currently the wallet name is in italic.\n\n@practicalswift you reviewed commits that belong #15153, but I'll take them into account once I touch that code again.\n\n@hebasto changed to property based.\n\n@Sjors rebased and added your suggestion.",https://github.com/bitcoin/bitcoin/pull/15195#issuecomment-462975557,462975557,
promag,2019-02-12T23:07:42Z,"Note to reviewers, closing the wallet doesn't explicitly unloads it, just tries to drop all references to the wallet - in other words, it doesn't wait for some RPC worker thread, if any, to finish its job.\n\nPlease give feedback if this should unload the wallet, like `unloadwallet` RPC. ",https://github.com/bitcoin/bitcoin/pull/15195#issuecomment-462976998,462976998,
Sjors,2019-02-13T09:39:34Z,"Eventually it should unload the wallet, because an advanced user may want to be able to move files around. It would also make it consistent with the RPC if they both call `UnloadWallet()` (which would have to added to an interface).\n\nIt can be done later as long as it doesn't break stuff. I was able to open and close the same wallet multiple times without a crash, so that's good.\n\nMuch mor",https://github.com/bitcoin/bitcoin/pull/15195#issuecomment-463128328,463128328,
gwillen,2019-02-13T09:45:10Z,"Tested on OS X, seems to work great. tACK 94086fb, notwithstanding the kibbitz below about unloading.\n\nAs to unloading, am I correctly understanding the process: the unloadwallet RPC will block until the wallet is unloaded, which could take time if someone has taken a reference to the shared_ptr<CWallet>, because UnloadWallet will block until they drop it. The approach taken in this PR is not ",https://github.com/bitcoin/bitcoin/pull/15195#issuecomment-463130359,463130359,
promag,2019-02-13T10:11:13Z,"@Sjors right, I thought the same. In order to not block UI with `UnloadWallet` I have to create a `CloseWalletActivity`, so IMO definitely something to improve later - I mean, can be improved even after feature freeze (I think?).",https://github.com/bitcoin/bitcoin/pull/15195#issuecomment-463139671,463139671,
promag,2019-02-13T22:14:38Z,@jonasschnelli @ryanofsky WDYT about https://github.com/bitcoin/bitcoin/pull/15195#issuecomment-462976998?,https://github.com/bitcoin/bitcoin/pull/15195#issuecomment-463397322,463397322,
ryanofsky,2019-02-13T22:35:19Z,"If the question is what do I think should happen when a wallet is slow to unload, it's the same as what I wrote in https://github.com/bitcoin/bitcoin/pull/15153#discussion_r256556392 about what should I think should happen when a wallet is slow to load. Wallet display should show ""Unloading wallet X..."" while the wallet is unloading, and when it's done unloading, the wallet should be removed from ",https://github.com/bitcoin/bitcoin/pull/15195#issuecomment-463403600,463403600,
jonasschnelli,2019-02-14T01:45:22Z,"I agree with @ryanofsky. As a long term goal. Unsure if this can be broken down to simpler steps. A wallet can – currently –  consume a decent amount of memory (and eventually CPU) and closing a wallet should IMO unload the wallet (graceful).\n\nI haven't looked at the code yet,... is there a reason to not unload the wallet synchronously as a first step (blocking the GUI as an initial close seem",https://github.com/bitcoin/bitcoin/pull/15195#issuecomment-463451365,463451365,
promag,2019-02-14T15:07:21Z,"@jonasschnelli IMO currently it's not so easily done, it's not the same as the RPC `unloadwallet` where there is only a `std::shared_ptr<CWallet>`. Here we have `interfaces::Wallet` which has a member `CWallet&`. \n\n```cpp\nvoid WalletImpl::unload() override\n{\n    RemoveWallet(m_shared_wallet);\n    UnloadWallet(std::move(m_shred_wallet));\n    // now m_wallet is invalid, and this interf",https://github.com/bitcoin/bitcoin/pull/15195#issuecomment-463661073,463661073,
jonasschnelli,2019-02-14T20:46:40Z,"Tested ACK 94086fb59d1a05eb9a2960c2aae242e49c0a9103\nThis is a good first step.",https://github.com/bitcoin/bitcoin/pull/15195#issuecomment-463788921,463788921,
ryanofsky,2019-02-14T20:54:37Z,"> @ryanofsky what do you suggest to fix the above?\n\nWhat you suggested looks good, but `WalletImpl` class should just have a single `std::shared_ptr<CWallet> m_wallet` member, not two wallet members.",https://github.com/bitcoin/bitcoin/pull/15195#issuecomment-463791974,463791974,
practicalswift,2019-01-19T14:19:46Z,Isn't this declaration redundant?,https://github.com/bitcoin/bitcoin/pull/15195#discussion_r249246262,249246262,src/wallet/rpcwallet.cpp
practicalswift,2019-01-19T14:20:23Z,`path` should be const reference?,https://github.com/bitcoin/bitcoin/pull/15195#discussion_r249246281,249246281,src/qt/bitcoingui.cpp
practicalswift,2019-01-19T14:27:52Z,Nit: Shadows function `error` from `system.h`.,https://github.com/bitcoin/bitcoin/pull/15195#discussion_r249246482,249246482,src/qt/walletcontroller.cpp
hebasto,2019-01-20T19:57:53Z,"It could be written without `button` variable:\n```\n    if (QMessageBox::Yes != QMessageBox::question(parent, tr(""Close wallet""),\n        tr(""Are you sure you wish to close wallet %1?"").arg(wallet_model->getDisplayName()),\n        QMessageBox::Yes|QMessageBox::Cancel,\n        QMessageBox::Yes)) return;\n```\n\nAlso [Qt docs](https://doc.qt.io/qt-5/qmessagebox.html#details) do not recom",https://github.com/bitcoin/bitcoin/pull/15195#discussion_r249293181,249293181,src/qt/walletcontroller.cpp
promag,2019-02-12T23:03:02Z,Done.,https://github.com/bitcoin/bitcoin/pull/15195#discussion_r256184471,256184471,src/qt/walletcontroller.cpp
