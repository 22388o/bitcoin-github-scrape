[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/303404590",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10403#issuecomment-303404590",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10403",
    "id": 303404590,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwMzQwNDU5MA==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-05-23T13:52:09Z",
    "updated_at": "2017-05-23T13:52:09Z",
    "author_association": "MEMBER",
    "body": "Looks good. Tested ACK https://github.com/bitcoin/bitcoin/commit/2e041dd247c19a47700b1e1b181c7f8a1b5b109b. It'd be nice to have tests covering the edge cases (block time the same for two consecutive blocks and block time decreasing), but that can be left for a future PR.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/303404590/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/303634220",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10403#issuecomment-303634220",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10403",
    "id": 303634220,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwMzYzNDIyMA==",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?u=eab5d0cdbb6cc25087cb61d4ca4a6f85255f42a7&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-05-24T06:51:18Z",
    "updated_at": "2017-05-24T06:51:18Z",
    "author_association": "CONTRIBUTOR",
    "body": "utACK 4d2d6045a4784d576d56299244b9f76a5909904b\r\nVery verbose error description texts (but great explanation).",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/303634220/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/306204960",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10403#issuecomment-306204960",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10403",
    "id": 306204960,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNjIwNDk2MA==",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-06-05T14:40:49Z",
    "updated_at": "2017-06-05T14:40:49Z",
    "author_association": "MEMBER",
    "body": "utACK 4d2d604",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/306204960/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/117753201",
    "pull_request_review_id": 39485191,
    "id": 117753201,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNzc1MzIwMQ==",
    "diff_hunk": "@@ -1137,12 +1137,12 @@ UniValue importmulti(const JSONRPCRequest& mainRequest)\n                 // range, or if the import result already has an error set, let\n                 // the result stand unmodified. Otherwise replace the result\n                 // with an error message.\n-                if (GetImportTimestamp(request, now) - TIMESTAMP_WINDOW >= scannedRange->GetBlockTimeMax() || results.at(i).exists(\"error\")) {\n+                if (GetImportTimestamp(request, now) - TIMESTAMP_WINDOW > scanFailed->GetBlockTimeMax() || results.at(i).exists(\"error\")) {\n                     response.push_back(results.at(i));\n                 } else {\n                     UniValue result = UniValue(UniValue::VOBJ);\n                     result.pushKV(\"success\", UniValue(false));\n-                    result.pushKV(\"error\", JSONRPCError(RPC_MISC_ERROR, strprintf(\"Failed to rescan before time %d, transactions may be missing.\", scannedRange->GetBlockTimeMax())));\n+                    result.pushKV(\"error\", JSONRPCError(RPC_MISC_ERROR, strprintf(\"Failed to rescan before time %d, transactions may be missing.\", scanFailed->GetBlockTimeMax() + 1)));",
    "path": "src/wallet/rpcdump.cpp",
    "position": null,
    "original_position": 28,
    "commit_id": "4d2d6045a4784d576d56299244b9f76a5909904b",
    "original_commit_id": "b4919d0b60d2acd67c421486d9eea76297a2eb23",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "As it scans forward (increasing date / block numbers), and scanFailed returns the first block that could not be scanned, shouldn't this be \"after time\"?",
    "created_at": "2017-05-22T14:06:05Z",
    "updated_at": "2017-05-23T13:16:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10403#discussion_r117753201",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/117753201"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10403#discussion_r117753201"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/117753201/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1145,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/117755972",
    "pull_request_review_id": 39488432,
    "id": 117755972,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNzc1NTk3Mg==",
    "diff_hunk": "@@ -1137,12 +1137,12 @@ UniValue importmulti(const JSONRPCRequest& mainRequest)\n                 // range, or if the import result already has an error set, let\n                 // the result stand unmodified. Otherwise replace the result\n                 // with an error message.\n-                if (GetImportTimestamp(request, now) - TIMESTAMP_WINDOW >= scannedRange->GetBlockTimeMax() || results.at(i).exists(\"error\")) {\n+                if (GetImportTimestamp(request, now) - TIMESTAMP_WINDOW > scanFailed->GetBlockTimeMax() || results.at(i).exists(\"error\")) {",
    "path": "src/wallet/rpcdump.cpp",
    "position": 22,
    "original_position": 22,
    "commit_id": "4d2d6045a4784d576d56299244b9f76a5909904b",
    "original_commit_id": "b4919d0b60d2acd67c421486d9eea76297a2eb23",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "So this checks that the birthday of the imported key is after most recent block that could not be scanned, in which case the current result will be returned?\r\nThis seems to disagree with the comment \"key creation date is within the successfully scanned range\".\r\nWhat am I misunderstanding here?",
    "created_at": "2017-05-22T14:17:37Z",
    "updated_at": "2017-05-23T13:16:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10403#discussion_r117755972",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/117755972"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10403#discussion_r117755972"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/117755972/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1140,
    "original_line": 1140,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/117760307",
    "pull_request_review_id": 39493352,
    "id": 117760307,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNzc2MDMwNw==",
    "diff_hunk": "@@ -1137,12 +1137,12 @@ UniValue importmulti(const JSONRPCRequest& mainRequest)\n                 // range, or if the import result already has an error set, let\n                 // the result stand unmodified. Otherwise replace the result\n                 // with an error message.\n-                if (GetImportTimestamp(request, now) - TIMESTAMP_WINDOW >= scannedRange->GetBlockTimeMax() || results.at(i).exists(\"error\")) {\n+                if (GetImportTimestamp(request, now) - TIMESTAMP_WINDOW > scanFailed->GetBlockTimeMax() || results.at(i).exists(\"error\")) {\n                     response.push_back(results.at(i));\n                 } else {\n                     UniValue result = UniValue(UniValue::VOBJ);\n                     result.pushKV(\"success\", UniValue(false));\n-                    result.pushKV(\"error\", JSONRPCError(RPC_MISC_ERROR, strprintf(\"Failed to rescan before time %d, transactions may be missing.\", scannedRange->GetBlockTimeMax())));\n+                    result.pushKV(\"error\", JSONRPCError(RPC_MISC_ERROR, strprintf(\"Failed to rescan before time %d, transactions may be missing.\", scanFailed->GetBlockTimeMax() + 1)));",
    "path": "src/wallet/rpcdump.cpp",
    "position": null,
    "original_position": 28,
    "commit_id": "4d2d6045a4784d576d56299244b9f76a5909904b",
    "original_commit_id": "b4919d0b60d2acd67c421486d9eea76297a2eb23",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> As it scans forward (increasing date / block numbers), and scanFailed returns the first block that could not be scanned, shouldn't this be \"after time\"?\r\n\r\nscanFailed returns the last block that could not be scanned, not the first block that couldn't be scanned. To take a concrete example, say there are two blocks in a row with GetBlockTimeMax() == 1000, and the first block fails to scan, and the second block succeeds, and later blocks also succeed. If there are any keys created at time 1000 or earlier, there could be transactions missing that pertain to those keys, so those keys should return errors. If there are any keys created at time 1001 or higher, they should technically be ok (even though they will still return errors for birthdays up to 1000 + TIMESTAMP_WINDOW).\r\n\r\nThe error returned for the problem keys will be \"Failed to rescan before time 1001, transactions may be missing.\" which I think makes sense if \"before\" implies \"less than\" rather than \"less than or equal\".\r\n\r\n\r\n",
    "created_at": "2017-05-22T14:34:44Z",
    "updated_at": "2017-05-23T13:16:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10403#discussion_r117760307",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10403",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/117760307"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10403#discussion_r117760307"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/117760307/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1145,
    "side": "RIGHT",
    "in_reply_to_id": 117753201
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/117763436",
    "pull_request_review_id": 39493352,
    "id": 117763436,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNzc2MzQzNg==",
    "diff_hunk": "@@ -1137,12 +1137,12 @@ UniValue importmulti(const JSONRPCRequest& mainRequest)\n                 // range, or if the import result already has an error set, let\n                 // the result stand unmodified. Otherwise replace the result\n                 // with an error message.\n-                if (GetImportTimestamp(request, now) - TIMESTAMP_WINDOW >= scannedRange->GetBlockTimeMax() || results.at(i).exists(\"error\")) {\n+                if (GetImportTimestamp(request, now) - TIMESTAMP_WINDOW > scanFailed->GetBlockTimeMax() || results.at(i).exists(\"error\")) {",
    "path": "src/wallet/rpcdump.cpp",
    "position": 22,
    "original_position": 22,
    "commit_id": "4d2d6045a4784d576d56299244b9f76a5909904b",
    "original_commit_id": "b4919d0b60d2acd67c421486d9eea76297a2eb23",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> So this checks that the birthday of the imported key is after most recent block that could not be scanned, in which case the current result will be returned?\r\n\r\nYes, if the key birthday is after the GetBlockTimeMax of the most recent block that could not be scanned + TIMESTAMP_WINDOW, the rescan for that key's transactions is considered successful, and the result is not replaced.\r\n\r\n> This seems to disagree with the comment \"key creation date is within the successfully scanned range\".\r\nWhat am I misunderstanding here?\r\n\r\nI may be misunderstanding something, but the comment seems right to me. If the most recent block that could not be scanned has GetBlockTimeMax == 1000, then any key created at timestamp 1001 or higher is in the \"successfully scanned range\", because all the blocks that were bad or missing are older than the key, and therefore not relevant.",
    "created_at": "2017-05-22T14:46:32Z",
    "updated_at": "2017-05-23T13:16:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10403#discussion_r117763436",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10403",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/117763436"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10403#discussion_r117763436"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/117763436/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1140,
    "original_line": 1140,
    "side": "RIGHT",
    "in_reply_to_id": 117755972
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/117865547",
    "pull_request_review_id": 39607155,
    "id": 117865547,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNzg2NTU0Nw==",
    "diff_hunk": "@@ -1137,12 +1137,12 @@ UniValue importmulti(const JSONRPCRequest& mainRequest)\n                 // range, or if the import result already has an error set, let\n                 // the result stand unmodified. Otherwise replace the result\n                 // with an error message.\n-                if (GetImportTimestamp(request, now) - TIMESTAMP_WINDOW >= scannedRange->GetBlockTimeMax() || results.at(i).exists(\"error\")) {\n+                if (GetImportTimestamp(request, now) - TIMESTAMP_WINDOW > scanFailed->GetBlockTimeMax() || results.at(i).exists(\"error\")) {\n                     response.push_back(results.at(i));\n                 } else {\n                     UniValue result = UniValue(UniValue::VOBJ);\n                     result.pushKV(\"success\", UniValue(false));\n-                    result.pushKV(\"error\", JSONRPCError(RPC_MISC_ERROR, strprintf(\"Failed to rescan before time %d, transactions may be missing.\", scannedRange->GetBlockTimeMax())));\n+                    result.pushKV(\"error\", JSONRPCError(RPC_MISC_ERROR, strprintf(\"Failed to rescan before time %d, transactions may be missing.\", scanFailed->GetBlockTimeMax() + 1)));",
    "path": "src/wallet/rpcdump.cpp",
    "position": null,
    "original_position": 28,
    "commit_id": "4d2d6045a4784d576d56299244b9f76a5909904b",
    "original_commit_id": "b4919d0b60d2acd67c421486d9eea76297a2eb23",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I spent some time thinking about edge cases here, and I've basically convinced myself that this is ok, because:\r\n\r\n- the `TIMESTAMP_WINDOW` means that we have a good safety window between the address's birthday and the block timestamp (ie we're safe even if an address appears in a block with a timestamp before its birthday).\r\n- the monotonically increasing `GetBlockTimeMax()` means that this error message gives the most conservative value (ie if a block B's time has moved back from its parent block A and we couldn't scan block B then the error will say that we couldn't scan before Block A's timestamp. That's fine)\r\n\r\nI think it might be useful for the user if there was a bit more information in the error message. Up to you how verbose you want to go, but a couple of things that might be good to include:\r\n\r\n- how does the user fix this problem (reindex, which will cause a full chain download if this is a pruning node)\r\n- what if the `Failed to rescan before time <time>` is for a time before the user specified as the address birthday? eg what if the user set the birthday to 10am, and we failed to scan a block at 9:55am. We'd return an error  saying `Failed to rescan before time 9:55am` and the user might thing \"that's ok, my key's birthday is 10am\". In fact it's not ok, because the 9:55am block may include a transaction for that address, since block time is not canonical or monotonic.",
    "created_at": "2017-05-22T23:10:11Z",
    "updated_at": "2017-05-23T13:16:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10403#discussion_r117865547",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/117865547"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10403#discussion_r117865547"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/117865547/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1145,
    "side": "RIGHT",
    "in_reply_to_id": 117753201
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/117986594",
    "pull_request_review_id": 39736658,
    "id": 117986594,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNzk4NjU5NA==",
    "diff_hunk": "@@ -1137,12 +1137,12 @@ UniValue importmulti(const JSONRPCRequest& mainRequest)\n                 // range, or if the import result already has an error set, let\n                 // the result stand unmodified. Otherwise replace the result\n                 // with an error message.\n-                if (GetImportTimestamp(request, now) - TIMESTAMP_WINDOW >= scannedRange->GetBlockTimeMax() || results.at(i).exists(\"error\")) {\n+                if (GetImportTimestamp(request, now) - TIMESTAMP_WINDOW > scanFailed->GetBlockTimeMax() || results.at(i).exists(\"error\")) {\n                     response.push_back(results.at(i));\n                 } else {\n                     UniValue result = UniValue(UniValue::VOBJ);\n                     result.pushKV(\"success\", UniValue(false));\n-                    result.pushKV(\"error\", JSONRPCError(RPC_MISC_ERROR, strprintf(\"Failed to rescan before time %d, transactions may be missing.\", scannedRange->GetBlockTimeMax())));\n+                    result.pushKV(\"error\", JSONRPCError(RPC_MISC_ERROR, strprintf(\"Failed to rescan before time %d, transactions may be missing.\", scanFailed->GetBlockTimeMax() + 1)));",
    "path": "src/wallet/rpcdump.cpp",
    "position": null,
    "original_position": 28,
    "commit_id": "4d2d6045a4784d576d56299244b9f76a5909904b",
    "original_commit_id": "b4919d0b60d2acd67c421486d9eea76297a2eb23",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks, expanded error message in 2e041dd247c19a47700b1e1b181c7f8a1b5b109b",
    "created_at": "2017-05-23T13:13:27Z",
    "updated_at": "2017-05-23T13:17:44Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10403#discussion_r117986594",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10403",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/117986594"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10403#discussion_r117986594"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/117986594/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1145,
    "side": "RIGHT",
    "in_reply_to_id": 117753201
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/118222038",
    "pull_request_review_id": 39991196,
    "id": 118222038,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExODIyMjAzOA==",
    "diff_hunk": "@@ -1137,12 +1137,12 @@ UniValue importmulti(const JSONRPCRequest& mainRequest)\n                 // range, or if the import result already has an error set, let\n                 // the result stand unmodified. Otherwise replace the result\n                 // with an error message.\n-                if (GetImportTimestamp(request, now) - TIMESTAMP_WINDOW >= scannedRange->GetBlockTimeMax() || results.at(i).exists(\"error\")) {\n+                if (GetImportTimestamp(request, now) - TIMESTAMP_WINDOW > scanFailed->GetBlockTimeMax() || results.at(i).exists(\"error\")) {",
    "path": "src/wallet/rpcdump.cpp",
    "position": 22,
    "original_position": 22,
    "commit_id": "4d2d6045a4784d576d56299244b9f76a5909904b",
    "original_commit_id": "b4919d0b60d2acd67c421486d9eea76297a2eb23",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> because all the blocks that were bad or missing are older than the key, and therefore not relevant.\r\n\r\nThat's the part I'm not sure about: aren't the blocks *at and after* that point missing, instead of before that point? After all it's the point where it failed in a linear forward scan?",
    "created_at": "2017-05-24T10:56:50Z",
    "updated_at": "2017-05-24T10:57:29Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10403#discussion_r118222038",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10403",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/118222038"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10403#discussion_r118222038"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/118222038/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1140,
    "original_line": 1140,
    "side": "RIGHT",
    "in_reply_to_id": 117755972
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/118230184",
    "pull_request_review_id": 40000226,
    "id": 118230184,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExODIzMDE4NA==",
    "diff_hunk": "@@ -1137,12 +1137,12 @@ UniValue importmulti(const JSONRPCRequest& mainRequest)\n                 // range, or if the import result already has an error set, let\n                 // the result stand unmodified. Otherwise replace the result\n                 // with an error message.\n-                if (GetImportTimestamp(request, now) - TIMESTAMP_WINDOW >= scannedRange->GetBlockTimeMax() || results.at(i).exists(\"error\")) {\n+                if (GetImportTimestamp(request, now) - TIMESTAMP_WINDOW > scanFailed->GetBlockTimeMax() || results.at(i).exists(\"error\")) {",
    "path": "src/wallet/rpcdump.cpp",
    "position": 22,
    "original_position": 22,
    "commit_id": "4d2d6045a4784d576d56299244b9f76a5909904b",
    "original_commit_id": "b4919d0b60d2acd67c421486d9eea76297a2eb23",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> That's the part I'm not sure about: aren't the blocks at and after that point missing, instead of before that point?\r\n\r\nBecause it returns a pointer to the last block that couldn't be scanned,  it means that any blocks after the pointer were scanned successfully.\r\n\r\n> After all it's the point where it failed in a linear forward scan?\r\n\r\nThe scan does keep going even if individual blocks couldn't be read. There might be a smarter way to handle this, but the behavior has been around a while. Only the error reporting is fairly new.\r\n",
    "created_at": "2017-05-24T11:46:55Z",
    "updated_at": "2017-05-24T11:46:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10403#discussion_r118230184",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10403",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/118230184"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10403#discussion_r118230184"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10403"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/118230184/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1140,
    "original_line": 1140,
    "side": "RIGHT",
    "in_reply_to_id": 117755972
  }
]