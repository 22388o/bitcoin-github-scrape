[
  {
    "sha": "965628a5c09fad10bfd40e397720daa9e6555512",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5NjU2MjhhNWMwOWZhZDEwYmZkNDBlMzk3NzIwZGFhOWU2NTU1NTEy",
    "commit": {
      "author": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2018-11-02T14:18:15Z"
      },
      "committer": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2020-04-01T13:24:52Z"
      },
      "message": "rpc: Add min_conf option to fundrawtransaction and walletcreatefundedpsbt",
      "tree": {
        "sha": "c8c536567cd9b8223ce1db5c9012892d3062af20",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c8c536567cd9b8223ce1db5c9012892d3062af20"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/965628a5c09fad10bfd40e397720daa9e6555512",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/965628a5c09fad10bfd40e397720daa9e6555512",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/965628a5c09fad10bfd40e397720daa9e6555512",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/965628a5c09fad10bfd40e397720daa9e6555512/comments",
    "author": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "965c0c37d54c727bee50920fdfa62f8174a94280",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/965c0c37d54c727bee50920fdfa62f8174a94280",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/965c0c37d54c727bee50920fdfa62f8174a94280"
      }
    ],
    "stats": {
      "total": 6,
      "additions": 6,
      "deletions": 0
    },
    "files": [
      {
        "sha": "9259c94a2f7ef808c41128e101af48c5859a157e",
        "filename": "src/wallet/rpcwallet.cpp",
        "status": "modified",
        "additions": 6,
        "deletions": 0,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/965628a5c09fad10bfd40e397720daa9e6555512/src/wallet/rpcwallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/965628a5c09fad10bfd40e397720daa9e6555512/src/wallet/rpcwallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcwallet.cpp?ref=965628a5c09fad10bfd40e397720daa9e6555512",
        "patch": "@@ -3044,6 +3044,7 @@ void FundTransaction(CWallet* const pwallet, CMutableTransaction& tx, CAmount& f\n                 {\"subtractFeeFromOutputs\", UniValueType(UniValue::VARR)},\n                 {\"replaceable\", UniValueType(UniValue::VBOOL)},\n                 {\"conf_target\", UniValueType(UniValue::VNUM)},\n+                {\"min_conf\", UniValueType(UniValue::VNUM)},\n                 {\"estimate_mode\", UniValueType(UniValue::VSTR)},\n             },\n             true, true);\n@@ -3094,6 +3095,9 @@ void FundTransaction(CWallet* const pwallet, CMutableTransaction& tx, CAmount& f\n             }\n             coinControl.m_confirm_target = ParseConfirmTarget(options[\"conf_target\"], pwallet->chain().estimateMaxBlocks());\n         }\n+        if (options.exists(\"min_conf\")) {\n+            coinControl.m_min_depth = options[\"min_conf\"].get_int();\n+        }\n         if (options.exists(\"estimate_mode\")) {\n             if (options.exists(\"feeRate\")) {\n                 throw JSONRPCError(RPC_INVALID_PARAMETER, \"Cannot specify both estimate_mode and feeRate\");\n@@ -3176,6 +3180,7 @@ static UniValue fundrawtransaction(const JSONRPCRequest& request)\n                             {\"replaceable\", RPCArg::Type::BOOL, /* default */ \"wallet default\", \"Marks this transaction as BIP125 replaceable.\\n\"\n                             \"                              Allows this transaction to be replaced by a transaction with higher fees\"},\n                             {\"conf_target\", RPCArg::Type::NUM, /* default */ \"wallet default\", \"Confirmation target (in blocks)\"},\n+                            {\"min_conf\", RPCArg::Type::NUM, /* default */ \"0\", \"The minimum confirmations to filter\"},\n                             {\"estimate_mode\", RPCArg::Type::STR, /* default */ \"UNSET\", \"The fee estimate mode, must be one of:\\n\"\n                             \"         \\\"UNSET\\\"\\n\"\n                             \"         \\\"ECONOMICAL\\\"\\n\"\n@@ -4173,6 +4178,7 @@ UniValue walletcreatefundedpsbt(const JSONRPCRequest& request)\n                             {\"replaceable\", RPCArg::Type::BOOL, /* default */ \"wallet default\", \"Marks this transaction as BIP125 replaceable.\\n\"\n                             \"                              Allows this transaction to be replaced by a transaction with higher fees\"},\n                             {\"conf_target\", RPCArg::Type::NUM, /* default */ \"fall back to wallet's confirmation target (txconfirmtarget)\", \"Confirmation target (in blocks)\"},\n+                            {\"min_conf\", RPCArg::Type::NUM, /* default */ \"0\", \"The minimum confirmations to filter\"},\n                             {\"estimate_mode\", RPCArg::Type::STR, /* default */ \"UNSET\", \"The fee estimate mode, must be one of:\\n\"\n                             \"         \\\"UNSET\\\"\\n\"\n                             \"         \\\"ECONOMICAL\\\"\\n\""
      }
    ]
  },
  {
    "sha": "55a0b4c0f90190dd717abc3e50d4c376c5a302a7",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1NWEwYjRjMGY5MDE5MGRkNzE3YWJjM2U1MGQ0YzM3NmM1YTMwMmE3",
    "commit": {
      "author": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2018-12-04T16:12:07Z"
      },
      "committer": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2020-04-01T13:25:21Z"
      },
      "message": "qa: Test fundrawtransaction and walletcreatefundedpsbt with min_conf",
      "tree": {
        "sha": "c08c58602209bfd8dd7a418259ae15e02ee00ca9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c08c58602209bfd8dd7a418259ae15e02ee00ca9"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/55a0b4c0f90190dd717abc3e50d4c376c5a302a7",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/55a0b4c0f90190dd717abc3e50d4c376c5a302a7",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/55a0b4c0f90190dd717abc3e50d4c376c5a302a7",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/55a0b4c0f90190dd717abc3e50d4c376c5a302a7/comments",
    "author": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "965628a5c09fad10bfd40e397720daa9e6555512",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/965628a5c09fad10bfd40e397720daa9e6555512",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/965628a5c09fad10bfd40e397720daa9e6555512"
      }
    ],
    "stats": {
      "total": 10,
      "additions": 9,
      "deletions": 1
    },
    "files": [
      {
        "sha": "d63456d770944898477472b82eb3ef9a9fd2b230",
        "filename": "test/functional/rpc_fundrawtransaction.py",
        "status": "modified",
        "additions": 7,
        "deletions": 0,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/55a0b4c0f90190dd717abc3e50d4c376c5a302a7/test/functional/rpc_fundrawtransaction.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/55a0b4c0f90190dd717abc3e50d4c376c5a302a7/test/functional/rpc_fundrawtransaction.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/rpc_fundrawtransaction.py?ref=55a0b4c0f90190dd717abc3e50d4c376c5a302a7",
        "patch": "@@ -742,6 +742,13 @@ def test_option_subtract_fee_from_outputs(self):\n         # The total subtracted from the outputs is equal to the fee.\n         assert_equal(share[0] + share[2] + share[3], result[0]['fee'])\n \n+        # test funding with custom min_conf\n+        inputs = []\n+        outputs = {self.nodes[2].getnewaddress(): 1}\n+        rawtx = self.nodes[3].createrawtransaction(inputs, outputs)\n+        assert_raises_rpc_error(-4, \"Insufficient funds\", self.nodes[3].fundrawtransaction, rawtx,  {'min_conf': 2})\n+        result = self.nodes[3].fundrawtransaction(rawtx, {'min_conf': 1})\n+\n     def test_subtract_fee_with_presets(self):\n         self.log.info(\"Test fundrawtxn subtract fee from outputs with preset inputs that are sufficient\")\n "
      },
      {
        "sha": "b1cb98dce32263e877ba34d9d9942c41c2f65ba0",
        "filename": "test/functional/rpc_psbt.py",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/55a0b4c0f90190dd717abc3e50d4c376c5a302a7/test/functional/rpc_psbt.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/55a0b4c0f90190dd717abc3e50d4c376c5a302a7/test/functional/rpc_psbt.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/rpc_psbt.py?ref=55a0b4c0f90190dd717abc3e50d4c376c5a302a7",
        "patch": "@@ -78,7 +78,8 @@ def test_utxo_conversion(self):\n \n     def run_test(self):\n         # Create and fund a raw tx for sending 10 BTC\n-        psbtx1 = self.nodes[0].walletcreatefundedpsbt([], {self.nodes[2].getnewaddress():10})['psbt']\n+        assert_raises_rpc_error(-4, \"Insufficient funds\", self.nodes[0].walletcreatefundedpsbt, inputs=[], outputs={self.nodes[2].getnewaddress():1}, options={'min_conf': 201})\n+        psbtx1 = self.nodes[0].walletcreatefundedpsbt(inputs=[], outputs={self.nodes[2].getnewaddress():11}, options={'min_conf': 200})['psbt']\n \n         # Node 1 should not be able to add anything to it but still return the psbtx same as before\n         psbtx = self.nodes[1].walletprocesspsbt(psbtx1)['psbt']"
      }
    ]
  }
]