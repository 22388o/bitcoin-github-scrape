jtimon,2017-03-23T17:22:18Z,"Concept ACK, this includes all the targets we discussed and more.\n",https://github.com/bitcoin/bitcoin/pull/10044#issuecomment-288795478,288795478,
sipa,2017-03-24T20:22:09Z,"@theuni Can you update your ""Changes requested"" review if they no longer apply?",https://github.com/bitcoin/bitcoin/pull/10044#issuecomment-289133353,289133353,
jnewbery,2017-03-24T20:55:29Z,"This builds locally and on travis. I'm still happy to receive input on the following:\n\n- are people happy with the new target names `make unit_tests`, `make functional_tests`, `make all_functional_tests`, `make util_tests` and the new behaviour of `make check`?\n- are people happy with the list of functional tests I've chosen?\n- this currently calls into the test_runner with multiple test c",https://github.com/bitcoin/bitcoin/pull/10044#issuecomment-289140595,289140595,
MarcoFalke,2017-03-25T13:01:52Z,Shouldn't `make check -j 2` pass down the number of jobs?,https://github.com/bitcoin/bitcoin/pull/10044#issuecomment-289210326,289210326,
jnewbery,2017-03-25T13:47:17Z,"@MarcoFalke I haven't tested. By default test_runner.py will run 4 tests in parallel, but I don't know how that compares with make starting 4 different instances of test_runner.py, each running a single test.",https://github.com/bitcoin/bitcoin/pull/10044#issuecomment-289212692,289212692,
MarcoFalke,2017-03-25T13:50:48Z,"No, running several instances of test_runner is not supported. What I meant is that `make check -j 2` will call `./test_runner.py --jobs 2` instead of `./test_rnner.py (--jobs 4)`, which is the default. (I choose 4 as the default because it was the best performing option on travis at that time)",https://github.com/bitcoin/bitcoin/pull/10044#issuecomment-289212876,289212876,
JeremyRubin,2017-03-28T18:27:23Z,"utack, I reviewed the changeset and it seems reasonable (but I don't know Make well enough to fully Ack).\n\n@MarcoFalke `-j` is for the number of jobs allocated across the Make DAG traversal build process, not for sub-processes; that should be handled somehow else.",https://github.com/bitcoin/bitcoin/pull/10044#issuecomment-289861487,289861487,
TheBlueMatt,2017-03-28T19:39:40Z,"Concept ACK. I have no ability to judge whether the makefile changes are sane, but do wonder about removing the various caches in test, eg test/__pycache__ and test/tmp, as clean should usually restore the state of the directory to what it was pre-make, afaiu.",https://github.com/bitcoin/bitcoin/pull/10044#issuecomment-289881377,289881377,
jnewbery,2017-03-28T20:37:13Z,"@TheBlueMatt good catch. I'd added these to the CLEANFILES variable, but that only cleans files, not directories! I've restored the previous clean-local: target now.",https://github.com/bitcoin/bitcoin/pull/10044#issuecomment-289896684,289896684,
fanquake,2017-04-02T10:47:01Z,"Started testing this on top of fbf36cae3a4613e289cec6c5eaeb1395d362a037 . Just ran `make` initially, then:\n`make unit_tests`\n```\nbash-3.2$ make unit_tests\n/Applications/Xcode.app/Contents/Developer/usr/bin/make -C src unit_tests\n  CC       src/tests-tests.o\n  CCLD     tests\n  CC       src/exhaustive_tests-tests_exhaustive.o\n  CCLD     exhaustive_tests\n/Applications/Xcode.app/Cont",https://github.com/bitcoin/bitcoin/pull/10044#issuecomment-290978453,290978453,
jnewbery,2017-04-03T13:08:19Z,nits addressed and commits squashed,https://github.com/bitcoin/bitcoin/pull/10044#issuecomment-291137412,291137412,
fanquake,2017-04-04T02:51:26Z,"Both linux builds failed with:\n```\nTraceback (most recent call last):\n  File ""test/functional/test_runner.py"", line 435, in <module>\n    main()\n  File ""test/functional/test_runner.py"", line 231, in main\n    run_tests(test_list, config[""environment""][""SRCDIR""], config[""environment""][""BUILDDIR""], config[""environment""][""EXEEXT""], args.jobs, args.coverage, passon_args)\n  File ""test/funct",https://github.com/bitcoin/bitcoin/pull/10044#issuecomment-291379675,291379675,
ryanofsky,2017-04-04T12:48:43Z,There are a lot of targets to keep track of here. It would be nice at some point to add a `make help` rule that would describe common targets you expect people will want to run.,https://github.com/bitcoin/bitcoin/pull/10044#issuecomment-291489083,291489083,
jnewbery,2017-04-04T18:23:10Z,thanks @fanquake . This was a bad merge that github wasn't warning about. Hopefully should work now that I've rebased.,https://github.com/bitcoin/bitcoin/pull/10044#issuecomment-291588896,291588896,
theuni,2017-04-13T22:24:43Z,"As travis runs ""make check"" as well as the functional tests, I believe it will be running some of these twice now? If so, I'm afraid we'll need yet another target that means either check+all_functional_tests, or check - functional_tests.",https://github.com/bitcoin/bitcoin/pull/10044#issuecomment-294037347,294037347,
jnewbery,2017-04-17T13:56:59Z,"@theuni I really don't want to add yet another make target. As @ryanofsky has pointed out there are already too many to reasonably keep track of. Ideally the functional tests run by make check should be so fast that it doesn't matter that travis is running them twice.\n\nThinking about this a little bit more, I think it might make sense to have a new basic_tests.py functional test script specifi",https://github.com/bitcoin/bitcoin/pull/10044#issuecomment-294490124,294490124,
MarcoFalke,2017-04-17T14:36:04Z,"So the basic test is a single test script with excerpts taken from the other test scripts, and is exclusively run by `make check`?\n\nAn alternative would be to unfiddle the `make check` on travis into ` make unit_tests &&  make util_tests`.",https://github.com/bitcoin/bitcoin/pull/10044#issuecomment-294497607,294497607,
jnewbery,2017-04-17T14:57:56Z,"> So the basic test is a single test script with excerpts taken from the other test scripts, and is exclusively run by make check?\n\nThat's basically the idea, yes. Not exactly copy-and-pasted from those other tests, but modified slightly to ensure good functional coverage, fast execution, and low resource demands.",https://github.com/bitcoin/bitcoin/pull/10044#issuecomment-294503110,294503110,
jtimon,2017-04-18T18:27:09Z,"> As travis runs ""make check"" as well as the functional tests, I believe it will be running some of these twice now? If so, I'm afraid we'll need yet another target that means either check+all_functional_tests, or check - functional_tests.\n\nWhat about just excluding the tests in FUNCTIONAL_TESTS for travis? We have the exclude option now, it seems we just need a file that both the makefile and",https://github.com/bitcoin/bitcoin/pull/10044#issuecomment-294937721,294937721,
sipa,2017-05-05T20:14:53Z,What is needed here to fix Travis?,https://github.com/bitcoin/bitcoin/pull/10044#issuecomment-299564976,299564976,
jnewbery,2017-05-05T20:33:03Z,This PR breaks whenever functional tests are added/renamed. In this instance `nodehandling.py` was renamed `disconnect_ban.py`. I haven't fixed it because there didn't seem to be much general interest in reviewing or providing concept feedback so I've been focusing on other things.,https://github.com/bitcoin/bitcoin/pull/10044#issuecomment-299568725,299568725,
TheBlueMatt,2017-05-09T15:57:22Z,"I think we should be happy to let make check go for 10/30 minutes, we wouldnt be the only project to do so, and its good to get test coverage during package building (which, really, is the largest make check user). My vote would be for moving all the test running into make, then we also dont have the double-file-listing of alll the tests in the makefile and in the test_runner.",https://github.com/bitcoin/bitcoin/pull/10044#issuecomment-300210630,300210630,
jnewbery,2017-05-09T20:13:59Z,"@TheBlueMatt - I'm not sure that we should run all the test in make. Some of them have quite high memory/CPU/disk requirements - for example pruning.py runs 6 nodes concurrently and uses > 4GiB of disk space. We don't want make check to fail for users with lower powered systems.\n\nI also don't think this resolves the double-file-listing issue. The functional tests need to be listed in EXTRA_DIS",https://github.com/bitcoin/bitcoin/pull/10044#issuecomment-300287611,300287611,
TheBlueMatt,2017-05-09T21:53:26Z,"@jnewbery indeed, I meant that we should avoid the travis issue by putting everything that normally runs in travis in make check, essentially. if we then had a second make target (extended-tests), we could drop test_runner.py and then we dont need to double-list anything :).",https://github.com/bitcoin/bitcoin/pull/10044#issuecomment-300312909,300312909,
jnewbery,2017-05-09T22:04:53Z,"test_runner is doing more than you think. For one, we can't run multiple tests in parallel without providing a different port seed to each (otherwise they'll fight over ports). There are various other checks and nice things (such as logging) that it does. I don't think we can remove it and rely on make.",https://github.com/bitcoin/bitcoin/pull/10044#issuecomment-300315300,300315300,
sipa,2017-05-09T22:30:23Z,"Why not just invoke test_runner.py in Travis/make check, then? test_runner already distinguishes between normal and extended tests.",https://github.com/bitcoin/bitcoin/pull/10044#issuecomment-300320443,300320443,
jnewbery,2017-05-16T15:06:28Z,"> Why not just invoke test_runner.py in Travis/make check, then? test_runner already distinguishes between normal and extended tests.\n\nBecause I don't want `make check` to become impossible or unusably slow for people running on constrained hardware. There are tests in the normal tests which fire up multiple versions of bitcoind or create long blockchains. Systems with limited memory could eas",https://github.com/bitcoin/bitcoin/pull/10044#issuecomment-301812072,301812072,
jnewbery,2017-09-14T15:09:08Z,Closing for now. I'll pick this up again at some point,https://github.com/bitcoin/bitcoin/pull/10044#issuecomment-329512708,329512708,
theuni,2017-03-22T19:21:02Z,Please enumerate the files here as before so that it remains deterministic.,https://github.com/bitcoin/bitcoin/pull/10044#discussion_r107507967,107507967,test/Makefile.include
theuni,2017-03-22T19:27:41Z,"I like this! But please make a var for it so that we can have obvious diffs when we add tests. Something like:\n```\nFUNCTIONAL_TESTS =\nFUNCTIONAL_TESTS += nodehandling\nFUNCTIONAL_TESTS += httpbasics\n...\n$(top_builddir)/test/functional/test_runner.py $(FUNCTIONAL_TESTS)\n```\n\nGoing even further, as a later step, we may be able to use test_runner.py as an automake test launcher, so t",https://github.com/bitcoin/bitcoin/pull/10044#discussion_r107509404,107509404,test/Makefile.include
theuni,2017-03-22T19:41:04Z,"I think all of these can just be (builddir), since this file is included rather than invoked recursively.",https://github.com/bitcoin/bitcoin/pull/10044#discussion_r107512216,107512216,test/Makefile.include
theuni,2017-03-22T19:48:10Z,"As you mentioned in the OP, the python tests will only be run now when running 'make check' from the root dir.\n\nI was going to suggest adding a target ""check-full"" or so, to run the python checks from src/, but that would effectively give us 3 levels of checking, confusion, and lots more bikeshedding.\n\nSo I think it would be wise to not differentiate what ""make check"" does based on your pw",https://github.com/bitcoin/bitcoin/pull/10044#discussion_r107513752,107513752,src/Makefile.test.include
jnewbery,2017-03-23T16:15:06Z,done,https://github.com/bitcoin/bitcoin/pull/10044#discussion_r107713159,107713159,test/Makefile.include
jnewbery,2017-03-23T16:15:18Z,done,https://github.com/bitcoin/bitcoin/pull/10044#discussion_r107713213,107713213,test/Makefile.include
jnewbery,2017-03-23T16:15:28Z,done,https://github.com/bitcoin/bitcoin/pull/10044#discussion_r107713252,107713252,test/Makefile.include
jnewbery,2017-03-23T16:15:38Z,done,https://github.com/bitcoin/bitcoin/pull/10044#discussion_r107713309,107713309,src/Makefile.test.include
fanquake,2017-04-02T10:48:13Z,Should `functional/test_framework/__pycache__` and `util/__pycache__` be included here?,https://github.com/bitcoin/bitcoin/pull/10044#discussion_r109305733,109305733,Makefile.am
jnewbery,2017-04-03T13:08:04Z,"Yes, I think you're right. Thanks.",https://github.com/bitcoin/bitcoin/pull/10044#discussion_r109411761,109411761,Makefile.am
jtimon,2017-04-18T18:20:39Z,"why these targets need to be here in the new file instead of alongside unit_tests and check-local?\nIt seems nice for EXTRA_DIST and FUNCTIONAL_TESTS, but that's it IMO.",https://github.com/bitcoin/bitcoin/pull/10044#discussion_r112027720,112027720,test/Makefile.include
