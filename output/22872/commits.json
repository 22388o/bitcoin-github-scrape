[
  {
    "sha": "325da75a5396f3161a6eade74b349105ed5722ab",
    "node_id": "C_kwDOABII59oAKDMyNWRhNzVhNTM5NmYzMTYxYTZlYWRlNzRiMzQ5MTA1ZWQ1NzIyYWI",
    "commit": {
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-09-11T18:32:58Z"
      },
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-10-05T15:27:54Z"
      },
      "message": "log, timer: allow not repeating log message on completion",
      "tree": {
        "sha": "8c9d6d508a617a62c298e87353346d75a87d563d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8c9d6d508a617a62c298e87353346d75a87d563d"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/325da75a5396f3161a6eade74b349105ed5722ab",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEd6u7+MhX7zEv6RP5T1chs9Djkh0FAmFcbvsACgkQT1chs9Dj\nkh1E8g//YUPmHGom9vrieLhpF62Z/7HA29BKs18aBv9HjWTDyBIaoTQbuBiFnNno\nK2SdzJR0lAzu3otqewFavlAO6by15t31Gb0teyUDY+OpMovmlnLG0f5q6TmgP40p\nNIfMP+gFuqJZZFpuwv0YFyoeIChXGb3lse7tgkPzG+gs90cGd3wP+cc5WP9sAd7N\nLPzJ1/EiI2DzUJSY96P/OOMU0sVMcSojwFEE2pdg3z3xLvirzRs2YfPDKDj6rUle\nYSMjGbPPHAa/eskHwj1DVNUlT/9CqXqjWdhEoh9KyhBiQcPfF0Hdc2tYj/a9rgdX\nKayCD4To69FYW17geVHd8pCy/2gCYPfdcBJwPg67KuOzK3hR4Kf6nhUBwdZ1OmPD\nBBQ5uOB4jXjLI0+O/QsjZO4i0X5V89IUS9hd/hOLWXHaAoNIzckp5R0c27xrD/Ww\n0cDenJ98fg0oob2ixGihFzN+F5k6xIODFyR7Snfm9a5BpfIGQwJemw31s1oI7C1a\nnkt5kJRbL/UVDt2l3tthEIdZrPlB6rawyMxbTHcnxwPJPnbqPbra73GqZzF6f2Am\nXHgQ4MunmwMKhoSNxtp+X4CtFFKZSZeCjQQUoVXz+s6fIDcBKnvghG3wkHtxZS9+\n8ZCTqL+rK0cHWZxEvum0DPLG9RpcvrLgXAdW4NVTKLlvyPltA5Y=\n=Zb9B\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwIIhjx9HAFG642LKVUrYEAccUQZkXZKEiZkUV8999D9OICP/wEEnHrF6FrE/O\n40s6JH58kzAI8QRhXG798AheNSvLrJ3G2ACD3+MNLvkMji4taHR0cHM6Ly9hbGlj\nZS5idGMuY2FsZW5kYXIub3BlbnRpbWVzdGFtcHMub3Jn//AQmXG1hcgtw1y8e5RJ\n7KUdAAjxBGFcbv7wCFif1o1stU/uAIPf4w0u+QyOIyJodHRwczovL2J0Yy5jYWxl\nbmRhci5jYXRhbGxheHkuY29t8BDny9wyDQpckhszTAhDHVJICPEEYVxu/PAInjMi\nv5Ew0pQAg9/jDS75DI4sK2h0dHBzOi8vYm9iLmJ0Yy5jYWxlbmRhci5vcGVudGlt\nZXN0YW1wcy5vcmc=\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----",
        "payload": "tree 8c9d6d508a617a62c298e87353346d75a87d563d\nparent 113b863f0773999497f952daa6539a03a66a9de3\nauthor Jon Atack <jon@atack.com> 1631385178 +0200\ncommitter Jon Atack <jon@atack.com> 1633447674 +0200\n\nlog, timer: allow not repeating log message on completion\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/325da75a5396f3161a6eade74b349105ed5722ab",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/325da75a5396f3161a6eade74b349105ed5722ab",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/325da75a5396f3161a6eade74b349105ed5722ab/comments",
    "author": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "113b863f0773999497f952daa6539a03a66a9de3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/113b863f0773999497f952daa6539a03a66a9de3",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/113b863f0773999497f952daa6539a03a66a9de3"
      }
    ],
    "stats": {
      "total": 21,
      "additions": 15,
      "deletions": 6
    },
    "files": [
      {
        "sha": "6725c71a9597a70d7993df5b90862ba3836f934f",
        "filename": "src/logging/timer.h",
        "status": "modified",
        "additions": 15,
        "deletions": 6,
        "changes": 21,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/325da75a5396f3161a6eade74b349105ed5722ab/src/logging/timer.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/325da75a5396f3161a6eade74b349105ed5722ab/src/logging/timer.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/logging/timer.h?ref=325da75a5396f3161a6eade74b349105ed5722ab",
        "patch": "@@ -27,18 +27,24 @@ class Timer\n     Timer(\n         std::string prefix,\n         std::string end_msg,\n-        BCLog::LogFlags log_category = BCLog::LogFlags::ALL) :\n+        BCLog::LogFlags log_category = BCLog::LogFlags::ALL,\n+        bool msg_on_completion = true) :\n             m_prefix(std::move(prefix)),\n             m_title(std::move(end_msg)),\n-            m_log_category(log_category)\n+            m_log_category(log_category),\n+            m_message_on_completion(msg_on_completion)\n     {\n         this->Log(strprintf(\"%s started\", m_title));\n         m_start_t = GetTime<std::chrono::microseconds>();\n     }\n \n     ~Timer()\n     {\n-        this->Log(strprintf(\"%s completed\", m_title));\n+        if (m_message_on_completion) {\n+            this->Log(strprintf(\"%s completed\", m_title));\n+        } else {\n+            this->Log(\"completed\");\n+        }\n     }\n \n     void Log(const std::string& msg)\n@@ -74,14 +80,17 @@ class Timer\n     std::chrono::microseconds m_start_t{};\n \n     //! Log prefix; usually the name of the function this was created in.\n-    const std::string m_prefix{};\n+    const std::string m_prefix;\n \n     //! A descriptive message of what is being timed.\n-    const std::string m_title{};\n+    const std::string m_title;\n \n     //! Forwarded on to LogPrint if specified - has the effect of only\n     //! outputting the timing log when a particular debug= category is specified.\n-    const BCLog::LogFlags m_log_category{};\n+    const BCLog::LogFlags m_log_category;\n+\n+    //! Whether to output the message again on completion.\n+    const bool m_message_on_completion;\n };\n \n } // namespace BCLog"
      }
    ]
  },
  {
    "sha": "ec65bed00ee2e403e39b3c5977caf4abd31ccc87",
    "node_id": "C_kwDOABII59oAKGVjNjViZWQwMGVlMmU0MDNlMzliM2M1OTc3Y2FmNGFiZDMxY2NjODc",
    "commit": {
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-09-11T18:47:07Z"
      },
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-10-05T15:28:02Z"
      },
      "message": "log, timer: add LOG_TIME_MILLIS_WITH_CATEGORY_MSG_ONCE macro\n\nthat prints the descriptive message when logging the start\nbut not when logging the completion.",
      "tree": {
        "sha": "4cbcf925cb1aab1d4d9656ac66c458c1092c39a5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4cbcf925cb1aab1d4d9656ac66c458c1092c39a5"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ec65bed00ee2e403e39b3c5977caf4abd31ccc87",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEd6u7+MhX7zEv6RP5T1chs9Djkh0FAmFcbwIACgkQT1chs9Dj\nkh0kqRAApBU6/6iXi3VIM+/z/ibPo4Y5VioMjCZGMpV/q3LOMoRCBaEGNm0FI/v3\nGGUNieHCZ9incjrv7RCwJp0PeKkBZpX0mex5GsA/MstFbFowAoTRlgJOIKSuOKxY\ntdGznyQs/EKgA6rJnr0fx/j600B0IoNDeyX4psB2gjEbSDn5yGOtOkNTbCE17ljE\nPG+mZ2bq5ApuDGCZh4ChJscwY1ueLw+8HSGz2TtJa6GNxUDHXV2tV7+LrbUuNimr\n9/8buc42Z6209B0KZTUmK3L95o5pGt0fdsDFQ1h6xDfRVf9PXBK0kHsqrTDWRMho\n3IlySsvbBzsxh8D5f5eGgEpGZg7UQ3pgB/nF8C4zfKXRdTR+3M5R6dt11RlX908e\nYfsMO0Wr0o0vmpBudl9+VIyXJOoKaT1sn+y2gPKtyYxh+hVwGB/+mQP4V18X77FL\nv3KSKwSDbz0XfLsrNnd3fg9fGVLBt9m0wBBKOnW2NxZnNzknMMjiA/DKqL4a3daO\nT8SxHl9u1pGjILi0qZ2XTPlHEqQkCz6g/wcBxftBPuEWfNN2AUCODgAWF4C9Rb/c\n1vHiVSM3RoduBQKrqpGWDPFi7zwT6yB43/XY+hP203xwtCSQ+94kKQuP4MkiNQ1b\n0sbpWPbJHeQakLO+0+b+fLZIOGqGGe9jvCXh5tHRpTwYpgLQe9E=\n=OzaI\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwIHFE1puYkiYl9almimyWMljHG+blgCUyPeD5wyrXrNlQCP/wEEcMzV+L2w0L\nqbROv7crbM8I8QRhXG8E8AhG6zuFU9l4aACD3+MNLvkMjiMiaHR0cHM6Ly9idGMu\nY2FsZW5kYXIuY2F0YWxsYXh5LmNvbf/wEKA4/7lJ8DFI0q737UP48yMI8QRhXG8E\n8AhXQ/JdDr1/gQCD3+MNLvkMjiwraHR0cHM6Ly9ib2IuYnRjLmNhbGVuZGFyLm9w\nZW50aW1lc3RhbXBzLm9yZ//wEOjd9KPNIIGonojFsGG6Z+cI8QRhXG8E8AhBYakF\nf63/zgCD3+MNLvkMji4taHR0cHM6Ly9hbGljZS5idGMuY2FsZW5kYXIub3BlbnRp\nbWVzdGFtcHMub3Jn8BDpVqNbr4H8+FpCEtwXI4JHCPEEYVxvBPAIDb10nwOST4gA\ng9/jDS75DI4pKGh0dHBzOi8vZmlubmV5LmNhbGVuZGFyLmV0ZXJuaXR5d2FsbC5j\nb20=\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----",
        "payload": "tree 4cbcf925cb1aab1d4d9656ac66c458c1092c39a5\nparent 325da75a5396f3161a6eade74b349105ed5722ab\nauthor Jon Atack <jon@atack.com> 1631386027 +0200\ncommitter Jon Atack <jon@atack.com> 1633447682 +0200\n\nlog, timer: add LOG_TIME_MILLIS_WITH_CATEGORY_MSG_ONCE macro\n\nthat prints the descriptive message when logging the start\nbut not when logging the completion.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ec65bed00ee2e403e39b3c5977caf4abd31ccc87",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/ec65bed00ee2e403e39b3c5977caf4abd31ccc87",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ec65bed00ee2e403e39b3c5977caf4abd31ccc87/comments",
    "author": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "325da75a5396f3161a6eade74b349105ed5722ab",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/325da75a5396f3161a6eade74b349105ed5722ab",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/325da75a5396f3161a6eade74b349105ed5722ab"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 2,
      "deletions": 0
    },
    "files": [
      {
        "sha": "b77a0e17c7c618c4a8921fb819f34f75b5c76021",
        "filename": "src/logging/timer.h",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/ec65bed00ee2e403e39b3c5977caf4abd31ccc87/src/logging/timer.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/ec65bed00ee2e403e39b3c5977caf4abd31ccc87/src/logging/timer.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/logging/timer.h?ref=ec65bed00ee2e403e39b3c5977caf4abd31ccc87",
        "patch": "@@ -100,6 +100,8 @@ class Timer\n     BCLog::Timer<std::chrono::microseconds> PASTE2(logging_timer, __COUNTER__)(__func__, end_msg, log_category)\n #define LOG_TIME_MILLIS_WITH_CATEGORY(end_msg, log_category) \\\n     BCLog::Timer<std::chrono::milliseconds> PASTE2(logging_timer, __COUNTER__)(__func__, end_msg, log_category)\n+#define LOG_TIME_MILLIS_WITH_CATEGORY_MSG_ONCE(end_msg, log_category) \\\n+    BCLog::Timer<std::chrono::milliseconds> PASTE2(logging_timer, __COUNTER__)(__func__, end_msg, log_category, /* msg_on_completion=*/false)\n #define LOG_TIME_SECONDS(end_msg) \\\n     BCLog::Timer<std::chrono::seconds> PASTE2(logging_timer, __COUNTER__)(__func__, end_msg)\n "
      }
    ]
  },
  {
    "sha": "22b44fc696dc1078c40d17e2d497c74c7b4ae750",
    "node_id": "C_kwDOABII59oAKDIyYjQ0ZmM2OTZkYzEwNzhjNDBkMTdlMmQ0OTdjNzRjN2I0YWU3NTA",
    "commit": {
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-09-03T00:01:31Z"
      },
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-10-05T16:34:22Z"
      },
      "message": "p2p: improve checkaddrman logging with duration in milliseconds\n\nand update the function name to CheckAddrman (drop \"Force\") for\nnicer log output as it is prefixed to each of these log messages:\n\n2021-09-21T18:42:50Z [opencon] CheckAddrman: new 64864, tried 1690, total 66554 started\n2021-09-21T18:42:50Z [opencon] CheckAddrman: completed (76.21ms)\n\nThe existing Doxygen documentation on the function already makes\nclear that it is unaffected by m_consistency_check_ratio.",
      "tree": {
        "sha": "18b7b63290bfa959e197c8ae87b58a45e6278c59",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/18b7b63290bfa959e197c8ae87b58a45e6278c59"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/22b44fc696dc1078c40d17e2d497c74c7b4ae750",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEd6u7+MhX7zEv6RP5T1chs9Djkh0FAmFcfpoACgkQT1chs9Dj\nkh14Ag//Q+nI9VmnMp65NMN6tRRqPaV0Uhc7R/N2FnfdpCyktpAGUX5HgTKclLLk\nX5DucsJISXKrgOUprpW8vVAuTS+B9sBlswniun9WiaGhGDeiUV7V3TWgyMVpHWeD\nM2i89hPKtyks80ysYko3x237DPjDBdaVF/J3C1xdSpH35YKufCjUYzWU87rvA87h\nsLbJ3u1C/CFv8ikt3+IvvAHZUUV1yN7FjcIWGwH5Yt5ME5K4PsRBJ018bad21wDY\nEJjhLxWpUD2+P4RkGXif1vbnIkK4jsGeW8jeb5/ACUYvx42jMBTr4WdHVjkzqU7H\ngKlTDaNrfxiX4I2f3jmCp/bOz4I6qZD6AeAZT1041lo8KrQJ9QVP+oKOLQg0dAM/\nyO114boeCJgMb8C0Aqr/g56039gWYdKyW3As2E05zhQOB9Ke5GVd+Lx79DWNZ6xx\nK3yGE26dpbsYFvU+GGBzpDuoClraJMARq/1bCzhFLWRPbi0B00VOkZa+MhDPN7wF\nKKBUKQsGczY9QZFXslN2pj7L1TJd4dAXZxQkaMZ5lIgsU7SRNWVvAKBmqkx1Q4lo\nwCcJazDxYDUQFxNXpKtObiaWNOw72lOz0bvjmAGYaXCOtAmdzIBYFaTGuS/Xr6EP\ntf/g+x6sld/ko0UuAyhhiLtJNjKFlHNcX9VoG7Hp9OaJQT7MNsI=\n=WVKx\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwIJ8z95a5Pk+t9LRcdjcUwU+4RZVku67f0s7MJHChSeJuCP/wEAujgjnf3yzB\n+84B7tF5YkkI8QRhXH6d8AgPvcIrQ5xObgCD3+MNLvkMjikoaHR0cHM6Ly9maW5u\nZXkuY2FsZW5kYXIuZXRlcm5pdHl3YWxsLmNvbf/wEFeRA1YOscOaa+FjxbGC8kUI\n8SC8U6G49RFJuHlBsCCjb9GkLRdyqxv/YDe+10m5rQyTPQjxBGFcfpzwCBptrb6s\nh/OOAIPf4w0u+QyOLi1odHRwczovL2FsaWNlLmJ0Yy5jYWxlbmRhci5vcGVudGlt\nZXN0YW1wcy5vcmf/8BB8Y0VG6G7UBI707VxZkaTKCPEEYVx+nfAIR35sbBI38FoA\ng9/jDS75DI4jImh0dHBzOi8vYnRjLmNhbGVuZGFyLmNhdGFsbGF4eS5jb23wELKi\noEmJFqc+a6ZbLqQ9xhwI8QRhXH6d8AjVKynvS2JCUACD3+MNLvkMjiwraHR0cHM6\nLy9ib2IuYnRjLmNhbGVuZGFyLm9wZW50aW1lc3RhbXBzLm9yZw==\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----",
        "payload": "tree 18b7b63290bfa959e197c8ae87b58a45e6278c59\nparent ec65bed00ee2e403e39b3c5977caf4abd31ccc87\nauthor Jon Atack <jon@atack.com> 1630627291 +0200\ncommitter Jon Atack <jon@atack.com> 1633451662 +0200\n\np2p: improve checkaddrman logging with duration in milliseconds\n\nand update the function name to CheckAddrman (drop \"Force\") for\nnicer log output as it is prefixed to each of these log messages:\n\n2021-09-21T18:42:50Z [opencon] CheckAddrman: new 64864, tried 1690, total 66554 started\n2021-09-21T18:42:50Z [opencon] CheckAddrman: completed (76.21ms)\n\nThe existing Doxygen documentation on the function already makes\nclear that it is unaffected by m_consistency_check_ratio.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/22b44fc696dc1078c40d17e2d497c74c7b4ae750",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/22b44fc696dc1078c40d17e2d497c74c7b4ae750",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/22b44fc696dc1078c40d17e2d497c74c7b4ae750/comments",
    "author": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "ec65bed00ee2e403e39b3c5977caf4abd31ccc87",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ec65bed00ee2e403e39b3c5977caf4abd31ccc87",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/ec65bed00ee2e403e39b3c5977caf4abd31ccc87"
      }
    ],
    "stats": {
      "total": 26,
      "additions": 15,
      "deletions": 11
    },
    "files": [
      {
        "sha": "c040b0ae5c47caafcf5afe23a19fb66137138f19",
        "filename": "src/addrman.cpp",
        "status": "modified",
        "additions": 7,
        "deletions": 5,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/22b44fc696dc1078c40d17e2d497c74c7b4ae750/src/addrman.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/22b44fc696dc1078c40d17e2d497c74c7b4ae750/src/addrman.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrman.cpp?ref=22b44fc696dc1078c40d17e2d497c74c7b4ae750",
        "patch": "@@ -7,6 +7,8 @@\n #include <addrman_impl.h>\n \n #include <hash.h>\n+#include <logging.h>\n+#include <logging/timer.h>\n #include <netaddress.h>\n #include <protocol.h>\n #include <random.h>\n@@ -393,7 +395,7 @@ void AddrManImpl::Unserialize(Stream& s_)\n         LogPrint(BCLog::ADDRMAN, \"addrman lost %i new and %i tried addresses due to collisions or invalid addresses\\n\", nLostUnk, nLost);\n     }\n \n-    const int check_code{ForceCheckAddrman()};\n+    const int check_code{CheckAddrman()};\n     if (check_code != 0) {\n         throw std::ios_base::failure(strprintf(\n             \"Corrupt data. Consistency check failed with code %s\",\n@@ -923,18 +925,19 @@ void AddrManImpl::Check() const\n     if (m_consistency_check_ratio == 0) return;\n     if (insecure_rand.randrange(m_consistency_check_ratio) >= 1) return;\n \n-    const int err{ForceCheckAddrman()};\n+    const int err{CheckAddrman()};\n     if (err) {\n         LogPrintf(\"ADDRMAN CONSISTENCY CHECK FAILED!!! err=%i\\n\", err);\n         assert(false);\n     }\n }\n \n-int AddrManImpl::ForceCheckAddrman() const\n+int AddrManImpl::CheckAddrman() const\n {\n     AssertLockHeld(cs);\n \n-    LogPrint(BCLog::ADDRMAN, \"Addrman checks started: new %i, tried %i, total %u\\n\", nNew, nTried, vRandom.size());\n+    LOG_TIME_MILLIS_WITH_CATEGORY_MSG_ONCE(\n+        strprintf(\"new %i, tried %i, total %u\", nNew, nTried, vRandom.size()), BCLog::ADDRMAN);\n \n     std::unordered_set<int> setTried;\n     std::unordered_map<int, int> mapNew;\n@@ -1014,7 +1017,6 @@ int AddrManImpl::ForceCheckAddrman() const\n     if (nKey.IsNull())\n         return -16;\n \n-    LogPrint(BCLog::ADDRMAN, \"Addrman checks completed successfully\\n\");\n     return 0;\n }\n "
      },
      {
        "sha": "5bab8bc0e82ee7eee7fe046b48805aa5131a3b43",
        "filename": "src/addrman_impl.h",
        "status": "modified",
        "additions": 4,
        "deletions": 2,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/22b44fc696dc1078c40d17e2d497c74c7b4ae750/src/addrman_impl.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/22b44fc696dc1078c40d17e2d497c74c7b4ae750/src/addrman_impl.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrman_impl.h?ref=22b44fc696dc1078c40d17e2d497c74c7b4ae750",
        "patch": "@@ -6,6 +6,7 @@\n #define BITCOIN_ADDRMAN_IMPL_H\n \n #include <logging.h>\n+#include <logging/timer.h>\n #include <netaddress.h>\n #include <protocol.h>\n #include <serialize.h>\n@@ -260,12 +261,13 @@ class AddrManImpl\n \n     std::pair<CAddress, int64_t> SelectTriedCollision_() EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n-    //! Consistency check, taking into account m_consistency_check_ratio. Will std::abort if an inconsistency is detected.\n+    //! Consistency check, taking into account m_consistency_check_ratio.\n+    //! Will std::abort if an inconsistency is detected.\n     void Check() const EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n     //! Perform consistency check, regardless of m_consistency_check_ratio.\n     //! @returns an error code or zero.\n-    int ForceCheckAddrman() const EXCLUSIVE_LOCKS_REQUIRED(cs);\n+    int CheckAddrman() const EXCLUSIVE_LOCKS_REQUIRED(cs);\n };\n \n #endif // BITCOIN_ADDRMAN_IMPL_H"
      },
      {
        "sha": "02c000eb950d44521eee81265755182e58ae3e6b",
        "filename": "test/functional/feature_asmap.py",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/22b44fc696dc1078c40d17e2d497c74c7b4ae750/test/functional/feature_asmap.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/22b44fc696dc1078c40d17e2d497c74c7b4ae750/test/functional/feature_asmap.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/feature_asmap.py?ref=22b44fc696dc1078c40d17e2d497c74c7b4ae750",
        "patch": "@@ -89,8 +89,8 @@ def test_asmap_interaction_with_addrman_containing_entries(self):\n         self.restart_node(0, [\"-asmap\", \"-checkaddrman=1\"])\n         with self.node.assert_debug_log(\n             expected_msgs=[\n-                \"Addrman checks started: new 1, tried 1, total 2\",\n-                \"Addrman checks completed successfully\",\n+                \"CheckAddrman: new 1, tried 1, total 2 started\",\n+                \"CheckAddrman: completed\",\n             ]\n         ):\n             self.node.getnodeaddresses()  # getnodeaddresses re-runs the addrman checks"
      },
      {
        "sha": "93a7fc3137d221f830b90666655200adff060244",
        "filename": "test/functional/rpc_net.py",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/22b44fc696dc1078c40d17e2d497c74c7b4ae750/test/functional/rpc_net.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/22b44fc696dc1078c40d17e2d497c74c7b4ae750/test/functional/rpc_net.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/rpc_net.py?ref=22b44fc696dc1078c40d17e2d497c74c7b4ae750",
        "patch": "@@ -260,7 +260,7 @@ def test_addpeeraddress(self):\n \n         self.log.debug(\"Test that adding a valid address to the tried table succeeds\")\n         assert_equal(node.addpeeraddress(address=\"1.2.3.4\", tried=True, port=8333), {\"success\": True})\n-        with node.assert_debug_log(expected_msgs=[\"Addrman checks started: new 0, tried 1, total 1\"]):\n+        with node.assert_debug_log(expected_msgs=[\"CheckAddrman: new 0, tried 1, total 1 started\"]):\n             addrs = node.getnodeaddresses(count=0)  # getnodeaddresses re-runs the addrman checks\n             assert_equal(len(addrs), 1)\n             assert_equal(addrs[0][\"address\"], \"1.2.3.4\")\n@@ -273,7 +273,7 @@ def test_addpeeraddress(self):\n \n         self.log.debug(\"Test that adding a second address, this time to the new table, succeeds\")\n         assert_equal(node.addpeeraddress(address=\"2.0.0.0\", port=8333), {\"success\": True})\n-        with node.assert_debug_log(expected_msgs=[\"Addrman checks started: new 1, tried 1, total 2\"]):\n+        with node.assert_debug_log(expected_msgs=[\"CheckAddrman: new 1, tried 1, total 2 started\"]):\n             addrs = node.getnodeaddresses(count=0)  # getnodeaddresses re-runs the addrman checks\n             assert_equal(len(addrs), 2)\n "
      }
    ]
  }
]