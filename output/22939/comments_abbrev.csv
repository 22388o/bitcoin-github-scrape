mzumsande,2021-09-10 19:15:58,"Concept ACK. \n\nI'd understand if it's beyond the scope of this PR, but I think that a second `ForceCheckAddrman()`  at the end of the  `addrman` fuzz target (which isn't caught but can actually lead to crashes) would be really helpful - probably better than activating  `consistency_check_ratio` during fuzzing which could make the fuzzer slow if called in too many steps.",https://github.com/bitcoin/bitcoin/pull/22939#issuecomment-917149441,917149441,
DrahtBot,2021-09-11 02:43:16,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#22950](https://github.com/bitcoin/bitcoin/pull/22950) ([p2p] Pimpl AddrMan to abstract implementation details by amitiut",https://github.com/bitcoin/bitcoin/pull/22939#issuecomment-917324206,917324206,
MarcoFalke,2021-09-11 07:07:22,"> a second ForceCheckAddrman() at the end of the addrman fuzz target\n\nGood idea. Wanted to do it in a follow-up, but it is just a one-line fix, so I added the commit here.",https://github.com/bitcoin/bitcoin/pull/22939#issuecomment-917356366,917356366,
vasild,2021-09-14 11:12:28,"```suggestion\n    //! Consistency check, taking into account m_consistency_check_ratio. Will abort(2) if an inconsistency is detected.\n```",https://github.com/bitcoin/bitcoin/pull/22939#discussion_r708162942,708162942,src/addrman.h
vasild,2021-09-14 11:15:18,"```suggestion\n    //! Perform consistency check, regardless of `m_consistency_check_ratio`.\n    //! @returns an error code or zero.\n```",https://github.com/bitcoin/bitcoin/pull/22939#discussion_r708164692,708164692,src/addrman.h
vasild,2021-09-14 11:19:39,"What about moving this unconditional check inside, at the end of `CAddrMan::Unserialize()`? We never want to continue if this check fails after unserialize and it is not too expensive to check once per unserialize.\n\nRight now we have the conditional `Check()` at the end of `Unserialize()`.",https://github.com/bitcoin/bitcoin/pull/22939#discussion_r708167539,708167539,src/test/fuzz/addrman.cpp
MarcoFalke,2021-09-14 11:23:18,This is what #22734 is doing. Happy to close this fuzz-only pull and rebase the other.,https://github.com/bitcoin/bitcoin/pull/22939#discussion_r708169942,708169942,src/test/fuzz/addrman.cpp
vasild,2021-09-15 08:08:00,"Up to you (and other reviewers). I ""voted"" for the other PR :)",https://github.com/bitcoin/bitcoin/pull/22939#discussion_r708943418,708943418,src/test/fuzz/addrman.cpp
