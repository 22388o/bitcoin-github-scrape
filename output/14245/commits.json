[
  {
    "sha": "f3155ea50ce4c085cc37d243508ab235fe71a6f9",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmMzE1NWVhNTBjZTRjMDg1Y2MzN2QyNDM1MDhhYjIzNWZlNzFhNmY5",
    "commit": {
      "author": {
        "name": "Johnson Lau",
        "email": "jl2012@xbt.hk",
        "date": "2018-09-17T18:20:07Z"
      },
      "committer": {
        "name": "Johnson Lau",
        "email": "jl2012@xbt.hk",
        "date": "2018-09-17T18:20:07Z"
      },
      "message": "Minimize vfExec counting in script handling",
      "tree": {
        "sha": "9baa2c777571330bef74b93e61b44aeae4a55297",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9baa2c777571330bef74b93e61b44aeae4a55297"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f3155ea50ce4c085cc37d243508ab235fe71a6f9",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f3155ea50ce4c085cc37d243508ab235fe71a6f9",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/f3155ea50ce4c085cc37d243508ab235fe71a6f9",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f3155ea50ce4c085cc37d243508ab235fe71a6f9/comments",
    "author": {
      "login": "jl2012",
      "id": 8403418,
      "node_id": "MDQ6VXNlcjg0MDM0MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8403418?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jl2012",
      "html_url": "https://github.com/jl2012",
      "followers_url": "https://api.github.com/users/jl2012/followers",
      "following_url": "https://api.github.com/users/jl2012/following{/other_user}",
      "gists_url": "https://api.github.com/users/jl2012/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jl2012/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jl2012/subscriptions",
      "organizations_url": "https://api.github.com/users/jl2012/orgs",
      "repos_url": "https://api.github.com/users/jl2012/repos",
      "events_url": "https://api.github.com/users/jl2012/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jl2012/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jl2012",
      "id": 8403418,
      "node_id": "MDQ6VXNlcjg0MDM0MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8403418?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jl2012",
      "html_url": "https://github.com/jl2012",
      "followers_url": "https://api.github.com/users/jl2012/followers",
      "following_url": "https://api.github.com/users/jl2012/following{/other_user}",
      "gists_url": "https://api.github.com/users/jl2012/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jl2012/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jl2012/subscriptions",
      "organizations_url": "https://api.github.com/users/jl2012/orgs",
      "repos_url": "https://api.github.com/users/jl2012/repos",
      "events_url": "https://api.github.com/users/jl2012/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jl2012/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "2d4749b366c4cae3da19017d6658f11349634303",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2d4749b366c4cae3da19017d6658f11349634303",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/2d4749b366c4cae3da19017d6658f11349634303"
      }
    ],
    "stats": {
      "total": 6,
      "additions": 4,
      "deletions": 2
    },
    "files": [
      {
        "sha": "78e9b7e19fd34ead48798571cc499319a3120f07",
        "filename": "src/script/interpreter.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 2,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f3155ea50ce4c085cc37d243508ab235fe71a6f9/src/script/interpreter.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f3155ea50ce4c085cc37d243508ab235fe71a6f9/src/script/interpreter.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/script/interpreter.cpp?ref=f3155ea50ce4c085cc37d243508ab235fe71a6f9",
        "patch": "@@ -294,6 +294,7 @@ bool EvalScript(std::vector<std::vector<unsigned char> >& stack, const CScript&\n     opcodetype opcode;\n     valtype vchPushValue;\n     std::vector<bool> vfExec;\n+    bool fExec = true;\n     std::vector<valtype> altstack;\n     set_error(serror, SCRIPT_ERR_UNKNOWN_ERROR);\n     if (script.size() > MAX_SCRIPT_SIZE)\n@@ -305,8 +306,6 @@ bool EvalScript(std::vector<std::vector<unsigned char> >& stack, const CScript&\n     {\n         while (pc < pend)\n         {\n-            bool fExec = !count(vfExec.begin(), vfExec.end(), false);\n-\n             //\n             // Read instruction\n             //\n@@ -485,6 +484,7 @@ bool EvalScript(std::vector<std::vector<unsigned char> >& stack, const CScript&\n                         if (opcode == OP_NOTIF)\n                             fValue = !fValue;\n                         popstack(stack);\n+                        fExec = fValue;\n                     }\n                     vfExec.push_back(fValue);\n                 }\n@@ -495,6 +495,7 @@ bool EvalScript(std::vector<std::vector<unsigned char> >& stack, const CScript&\n                     if (vfExec.empty())\n                         return set_error(serror, SCRIPT_ERR_UNBALANCED_CONDITIONAL);\n                     vfExec.back() = !vfExec.back();\n+                    fExec = fExec ? false : !count(vfExec.begin(), vfExec.end(), false);\n                 }\n                 break;\n \n@@ -503,6 +504,7 @@ bool EvalScript(std::vector<std::vector<unsigned char> >& stack, const CScript&\n                     if (vfExec.empty())\n                         return set_error(serror, SCRIPT_ERR_UNBALANCED_CONDITIONAL);\n                     vfExec.pop_back();\n+                    fExec = fExec ? true : !count(vfExec.begin(), vfExec.end(), false);\n                 }\n                 break;\n "
      }
    ]
  }
]