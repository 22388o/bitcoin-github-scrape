[
  {
    "sha": "17f15678d399275a093be496914c59b463929fe4",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxN2YxNTY3OGQzOTkyNzVhMDkzYmU0OTY5MTRjNTliNDYzOTI5ZmU0",
    "commit": {
      "author": {
        "name": "Alex Morcos",
        "email": "morcos@chaincode.com",
        "date": "2014-07-26T01:21:10Z"
      },
      "committer": {
        "name": "Alex Morcos",
        "email": "morcos@chaincode.com",
        "date": "2014-07-28T01:41:13Z"
      },
      "message": "Fixed a bug with index bounds checking",
      "tree": {
        "sha": "abf40a511e264e008003b02266a730da1befbc81",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/abf40a511e264e008003b02266a730da1befbc81"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/17f15678d399275a093be496914c59b463929fe4",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/17f15678d399275a093be496914c59b463929fe4",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/17f15678d399275a093be496914c59b463929fe4",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/17f15678d399275a093be496914c59b463929fe4/comments",
    "author": {
      "login": "morcos",
      "id": 4360349,
      "node_id": "MDQ6VXNlcjQzNjAzNDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/morcos",
      "html_url": "https://github.com/morcos",
      "followers_url": "https://api.github.com/users/morcos/followers",
      "following_url": "https://api.github.com/users/morcos/following{/other_user}",
      "gists_url": "https://api.github.com/users/morcos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/morcos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
      "organizations_url": "https://api.github.com/users/morcos/orgs",
      "repos_url": "https://api.github.com/users/morcos/repos",
      "events_url": "https://api.github.com/users/morcos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/morcos/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "morcos",
      "id": 4360349,
      "node_id": "MDQ6VXNlcjQzNjAzNDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/morcos",
      "html_url": "https://github.com/morcos",
      "followers_url": "https://api.github.com/users/morcos/followers",
      "following_url": "https://api.github.com/users/morcos/following{/other_user}",
      "gists_url": "https://api.github.com/users/morcos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/morcos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
      "organizations_url": "https://api.github.com/users/morcos/orgs",
      "repos_url": "https://api.github.com/users/morcos/repos",
      "events_url": "https://api.github.com/users/morcos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/morcos/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "3955c3940eff83518c186facfec6f50545b5aab5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3955c3940eff83518c186facfec6f50545b5aab5",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/3955c3940eff83518c186facfec6f50545b5aab5"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 1,
      "deletions": 1
    },
    "files": [
      {
        "sha": "0725441fba3fe58c72f8a6c6e19294b15971f6d0",
        "filename": "src/txmempool.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/17f15678d399275a093be496914c59b463929fe4/src/txmempool.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/17f15678d399275a093be496914c59b463929fe4/src/txmempool.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/txmempool.cpp?ref=17f15678d399275a093be496914c59b463929fe4",
        "patch": "@@ -299,7 +299,7 @@ class CMinerPolicyEstimator\n         size_t nPrevSize = 0;\n         for (int i = 0; i < nBlocksToConfirm; i++)\n             nPrevSize += history.at(i).PrioritySamples();\n-        size_t index = min(nPrevSize + nBucketSize/2, sortedFeeSamples.size()-1);\n+        size_t index = min(nPrevSize + nBucketSize/2, sortedPrioritySamples.size()-1);\n         return sortedPrioritySamples[index];\n     }\n "
      }
    ]
  },
  {
    "sha": "961ae93c85cee96c5dca3d44fbfb829243607f65",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5NjFhZTkzYzg1Y2VlOTZjNWRjYTNkNDRmYmZiODI5MjQzNjA3ZjY1",
    "commit": {
      "author": {
        "name": "Alex Morcos",
        "email": "morcos@chaincode.com",
        "date": "2014-07-26T01:29:54Z"
      },
      "committer": {
        "name": "Alex Morcos",
        "email": "morcos@chaincode.com",
        "date": "2014-07-28T14:52:54Z"
      },
      "message": "Fix minor bug which only affected log messages.",
      "tree": {
        "sha": "abfa7c96a3b0b5c4e399db1ac98601c90ecf4697",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/abfa7c96a3b0b5c4e399db1ac98601c90ecf4697"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/961ae93c85cee96c5dca3d44fbfb829243607f65",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/961ae93c85cee96c5dca3d44fbfb829243607f65",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/961ae93c85cee96c5dca3d44fbfb829243607f65",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/961ae93c85cee96c5dca3d44fbfb829243607f65/comments",
    "author": {
      "login": "morcos",
      "id": 4360349,
      "node_id": "MDQ6VXNlcjQzNjAzNDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/morcos",
      "html_url": "https://github.com/morcos",
      "followers_url": "https://api.github.com/users/morcos/followers",
      "following_url": "https://api.github.com/users/morcos/following{/other_user}",
      "gists_url": "https://api.github.com/users/morcos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/morcos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
      "organizations_url": "https://api.github.com/users/morcos/orgs",
      "repos_url": "https://api.github.com/users/morcos/repos",
      "events_url": "https://api.github.com/users/morcos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/morcos/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "morcos",
      "id": 4360349,
      "node_id": "MDQ6VXNlcjQzNjAzNDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/morcos",
      "html_url": "https://github.com/morcos",
      "followers_url": "https://api.github.com/users/morcos/followers",
      "following_url": "https://api.github.com/users/morcos/following{/other_user}",
      "gists_url": "https://api.github.com/users/morcos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/morcos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
      "organizations_url": "https://api.github.com/users/morcos/orgs",
      "repos_url": "https://api.github.com/users/morcos/repos",
      "events_url": "https://api.github.com/users/morcos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/morcos/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "17f15678d399275a093be496914c59b463929fe4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/17f15678d399275a093be496914c59b463929fe4",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/17f15678d399275a093be496914c59b463929fe4"
      }
    ],
    "stats": {
      "total": 8,
      "additions": 6,
      "deletions": 2
    },
    "files": [
      {
        "sha": "a06de7a947380ac1836fd379cd971e27b95bad37",
        "filename": "src/txmempool.cpp",
        "status": "modified",
        "additions": 6,
        "deletions": 2,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/961ae93c85cee96c5dca3d44fbfb829243607f65/src/txmempool.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/961ae93c85cee96c5dca3d44fbfb829243607f65/src/txmempool.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/txmempool.cpp?ref=961ae93c85cee96c5dca3d44fbfb829243607f65",
        "patch": "@@ -225,15 +225,19 @@ class CMinerPolicyEstimator\n                 seenTxConfirm(feeRate, minRelayFee, dPriority, i);\n             }\n         }\n+\n+        //After new samples are added, we have to clear the sorted lists,\n+        //so they'll be resorted the next time someone asks for an estimate\n+        sortedFeeSamples.clear();\n+        sortedPrioritySamples.clear();\n+\n         for (size_t i = 0; i < history.size(); i++) {\n             if (history[i].FeeSamples() + history[i].PrioritySamples() > 0)\n                 LogPrint(\"estimatefee\", \"estimates: for confirming within %d blocks based on %d/%d samples, fee=%s, prio=%g\\n\", \n                          i,\n                          history[i].FeeSamples(), history[i].PrioritySamples(),\n                          estimateFee(i+1).ToString(), estimatePriority(i+1));\n         }\n-        sortedFeeSamples.clear();\n-        sortedPrioritySamples.clear();\n     }\n \n     // Can return CFeeRate(0) if we don't have any data for that many blocks back. nBlocksToConfirm is 1 based."
      }
    ]
  },
  {
    "sha": "e59441f0863d20c6f205c4854a37507267183863",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzplNTk0NDFmMDg2M2QyMGM2ZjIwNWM0ODU0YTM3NTA3MjY3MTgzODYz",
    "commit": {
      "author": {
        "name": "Alex Morcos",
        "email": "morcos@chaincode.com",
        "date": "2014-07-29T04:09:57Z"
      },
      "committer": {
        "name": "Alex Morcos",
        "email": "morcos@chaincode.com",
        "date": "2014-07-29T17:58:08Z"
      },
      "message": "Process fee estimate file into temporary vector first to let sanity checking complete.",
      "tree": {
        "sha": "f965485719127f07219f9fe7bf3398662360c6b4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f965485719127f07219f9fe7bf3398662360c6b4"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e59441f0863d20c6f205c4854a37507267183863",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e59441f0863d20c6f205c4854a37507267183863",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/e59441f0863d20c6f205c4854a37507267183863",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e59441f0863d20c6f205c4854a37507267183863/comments",
    "author": {
      "login": "morcos",
      "id": 4360349,
      "node_id": "MDQ6VXNlcjQzNjAzNDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/morcos",
      "html_url": "https://github.com/morcos",
      "followers_url": "https://api.github.com/users/morcos/followers",
      "following_url": "https://api.github.com/users/morcos/following{/other_user}",
      "gists_url": "https://api.github.com/users/morcos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/morcos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
      "organizations_url": "https://api.github.com/users/morcos/orgs",
      "repos_url": "https://api.github.com/users/morcos/repos",
      "events_url": "https://api.github.com/users/morcos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/morcos/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "morcos",
      "id": 4360349,
      "node_id": "MDQ6VXNlcjQzNjAzNDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/morcos",
      "html_url": "https://github.com/morcos",
      "followers_url": "https://api.github.com/users/morcos/followers",
      "following_url": "https://api.github.com/users/morcos/following{/other_user}",
      "gists_url": "https://api.github.com/users/morcos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/morcos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
      "organizations_url": "https://api.github.com/users/morcos/orgs",
      "repos_url": "https://api.github.com/users/morcos/repos",
      "events_url": "https://api.github.com/users/morcos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/morcos/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "961ae93c85cee96c5dca3d44fbfb829243607f65",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/961ae93c85cee96c5dca3d44fbfb829243607f65",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/961ae93c85cee96c5dca3d44fbfb829243607f65"
      }
    ],
    "stats": {
      "total": 19,
      "additions": 15,
      "deletions": 4
    },
    "files": [
      {
        "sha": "29924fff09c24abfbc1df7f845fdb13cb26cf1d6",
        "filename": "src/txmempool.cpp",
        "status": "modified",
        "additions": 15,
        "deletions": 4,
        "changes": 19,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e59441f0863d20c6f205c4854a37507267183863/src/txmempool.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e59441f0863d20c6f205c4854a37507267183863/src/txmempool.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/txmempool.cpp?ref=e59441f0863d20c6f205c4854a37507267183863",
        "patch": "@@ -206,7 +206,7 @@ class CMinerPolicyEstimator\n             }\n             if ((delta-1) >= (int)history.size())\n                 delta = history.size(); // Last bucket is catch-all\n-            entriesByConfirmations[delta-1].push_back(&entry);\n+            entriesByConfirmations.at(delta-1).push_back(&entry);\n         }\n         for (size_t i = 0; i < entriesByConfirmations.size(); i++)\n         {\n@@ -319,16 +319,27 @@ class CMinerPolicyEstimator\n \n     void Read(CAutoFile& filein, const CFeeRate& minRelayFee)\n     {\n-        filein >> nBestSeenHeight;\n+        int nFileBestSeenHeight;\n+        filein >> nFileBestSeenHeight;\n         size_t numEntries;\n         filein >> numEntries;\n-        history.clear();\n+        if (numEntries <= 0 || numEntries > 10000)\n+            throw runtime_error(\"Corrupt estimates file.  Must have between 1 and 10k entires.\");\n+\n+        std::vector<CBlockAverage> fileHistory;\n+        \n         for (size_t i = 0; i < numEntries; i++)\n         {\n             CBlockAverage entry;\n             entry.Read(filein, minRelayFee);\n-            history.push_back(entry);\n+            fileHistory.push_back(entry);\n         }\n+\n+        //Now that we've processed the entire fee estimate data file and not\n+        //thrown any errors, we can copy it to our history\n+        nBestSeenHeight = nFileBestSeenHeight;\n+        history = fileHistory;\n+        assert(history.size() > 0);\n     }\n };\n "
      }
    ]
  }
]