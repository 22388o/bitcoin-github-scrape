gavinandresen,2014-07-28T17:55:38Z,"ACK, good catches!\n",https://github.com/bitcoin/bitcoin/pull/4598#issuecomment-50373673,50373673,
laanwj,2014-07-28T18:46:12Z,Untested ACK\n,https://github.com/bitcoin/bitcoin/pull/4598#issuecomment-50380763,50380763,
cozz,2014-07-29T02:18:48Z,"unrelated, but I just got several segmentation faults. It turned out that the code below caused the problem.\nThe scenario was delta=1 and history.size()=0.\nIf I read the code correctly, this results in -1 index access in the last line.\nMaybe we can fix that in this pull request, so I dont have to submit another 'Fix feeestimate'.\n(EDIT: I guess for history to be empty, the file fee_estimates.d",https://github.com/bitcoin/bitcoin/pull/4598#issuecomment-50427118,50427118,
morcos,2014-07-29T04:10:09Z,"I'd be happy to update the PR, but not sure what the right solution is. I could change the line that seg faulted to: \n\n```\nif (delta > 0)\n    entriesByConfirmations.at(delta-1).push_back(&entry);\n```\n\nAnd I _think_ that there isn't anywhere else that would throw an exception, but it seems like the code is not really designed for a history of 0 size.  \n\nWas this the result of reading a cor",https://github.com/bitcoin/bitcoin/pull/4598#issuecomment-50432607,50432607,
gavinandresen,2014-07-29T14:31:41Z,"@cozz : the mystery is how history.size() could ever become zero. Looking at the code, I agree with @morcos -- your estimates.dat file must have been corrupted somehow.\n\nThere are already sanity checks in CBlockAverage::Read; adding a sanity check in CMinerPolicyEstimator::Read() like:\n\n```\n    filein >> numEntries;\n    if (numEntries <= 0 || numEntries > ...uh, some large value...)\n       ",https://github.com/bitcoin/bitcoin/pull/4598#issuecomment-50483560,50483560,
cozz,2014-07-29T15:59:36Z,"The problem is gone after deleting fee_estimates.dat. I assume I was using an old incompatible fee_estimates.dat. So lets not bother much, your suggested sanity checks/asserts sound good to me.\n",https://github.com/bitcoin/bitcoin/pull/4598#issuecomment-50497100,50497100,
morcos,2014-07-29T18:14:55Z,"I just added another commit to sanity check the reading of the file.  I read fee_estimates.dat into a temporary history vector first, because otherwise the sanity checking could have failed in reading the individual CBlockAverage's and still left an inconsistent state, so I didn't want to replace the state we were initialized with unless we knew processing the whole file succeeded.\n",https://github.com/bitcoin/bitcoin/pull/4598#issuecomment-50515960,50515960,
BitcoinPullTester,2014-07-29T18:25:56Z,"Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/p4598_e59441f0863d20c6f205c4854a37507267183863/ for binaries and test log.\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.log is moving at http://jenkins.bluematt.me/pull-te",https://github.com/bitcoin/bitcoin/pull/4598#issuecomment-50517486,50517486,
laanwj,2014-08-06T07:55:11Z,"Thanks a lot for this, it seems to have solved quite some crashes that people were experiencing, especially on testnet.\n",https://github.com/bitcoin/bitcoin/pull/4598#issuecomment-51304130,51304130,
