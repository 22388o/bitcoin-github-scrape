[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/721281373",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-721281373",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 721281373,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyMTI4MTM3Mw==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-03T17:47:09Z",
    "updated_at": "2021-12-01T08:14:12Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#23599](https://github.com/bitcoin/bitcoin/pull/23599) (Tidy up RPCTxSerializationFlags by MarcoFalke)\n* [#23497](https://github.com/bitcoin/bitcoin/pull/23497) (Add `src/node/` and `src/wallet/` code to `node::` and `wallet::` namespaces by ryanofsky)\n* [#22776](https://github.com/bitcoin/bitcoin/pull/22776) (rpc/wallet: add optional transaction(s) to getbalances by kallewoof)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/721281373/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/723228594",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-723228594",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 723228594,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyMzIyODU5NA==",
    "user": {
      "login": "Fi3",
      "id": 6207037,
      "node_id": "MDQ6VXNlcjYyMDcwMzc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6207037?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Fi3",
      "html_url": "https://github.com/Fi3",
      "followers_url": "https://api.github.com/users/Fi3/followers",
      "following_url": "https://api.github.com/users/Fi3/following{/other_user}",
      "gists_url": "https://api.github.com/users/Fi3/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Fi3/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Fi3/subscriptions",
      "organizations_url": "https://api.github.com/users/Fi3/orgs",
      "repos_url": "https://api.github.com/users/Fi3/repos",
      "events_url": "https://api.github.com/users/Fi3/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Fi3/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-06T18:20:08Z",
    "updated_at": "2020-11-06T18:20:08Z",
    "author_association": "NONE",
    "body": "@Sjors Please note that I'm very new to C++ and I'm here only to learn.\r\n\r\nConcept AKN, IMO can also be useful if the user need info about a pruned block.\r\n\r\nNot sure if `getblockfrompeer` should persist the block, maybe just print it. For consistency the interface of `getblock` (verbosity 0, 1, 2) could be reused.\r\nMaybe `getblockfrompeer` could just be a flag of `getblock`.\r\n\r\nAlso, IMO `GetBlockChecked` should notify the user to use `getblockfrompeer` for block that are not on disk.\r\n\r\n**Check if the node is connected**\r\nChecking for connectivity could be done with `connman->GetNodeCount` as in [mining.cpp](https://github.com/bitcoin/bitcoin/blob/master/src/rpc/mining.cpp#L666).\r\n\r\n**Mark the block as in flight**\r\nInstead of mark the block as in flight and persist the block, I would add 2 fields to the public interface of `CNode` the first to notify `ProcessMessage` that a block with a certain hash is  expected, the second to check (in a loop) for the requested block.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/723228594/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/725359736",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-725359736",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 725359736,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyNTM1OTczNg==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-11T11:06:48Z",
    "updated_at": "2020-11-11T11:06:48Z",
    "author_association": "MEMBER",
    "body": "@Fi3 being able to (temporarily) retrieve pruned blocks is useful too indeed.\r\n\r\nIt can be difficult to find nodes that still have a stale block, so I'd rather hold on to it. That also allows inspection using the regular methods, `getblock`, `getchaintips` and `getrawtransaction` (e.g. to learn about a specific doublespend). Pruned nodes will toss it automatically after a while (IIUC).\r\n\r\nI also want to be able to fully validate the block. It's very time consuming, but it works: call `invalidateblock` on the main chain block for the same height, so reorgs to the block you just downloaded and verified it. Then call `reconsiderblock` to sync to the tip again.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/725359736/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/725438758",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-725438758",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 725438758,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyNTQzODc1OA==",
    "user": {
      "login": "BitMEXResearch",
      "id": 42411042,
      "node_id": "MDQ6VXNlcjQyNDExMDQy",
      "avatar_url": "https://avatars.githubusercontent.com/u/42411042?u=966dcadcf85c2008f7532062957ab2b82b7975d8&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/BitMEXResearch",
      "html_url": "https://github.com/BitMEXResearch",
      "followers_url": "https://api.github.com/users/BitMEXResearch/followers",
      "following_url": "https://api.github.com/users/BitMEXResearch/following{/other_user}",
      "gists_url": "https://api.github.com/users/BitMEXResearch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/BitMEXResearch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/BitMEXResearch/subscriptions",
      "organizations_url": "https://api.github.com/users/BitMEXResearch/orgs",
      "repos_url": "https://api.github.com/users/BitMEXResearch/repos",
      "events_url": "https://api.github.com/users/BitMEXResearch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/BitMEXResearch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-11T13:59:42Z",
    "updated_at": "2020-11-11T13:59:42Z",
    "author_association": "NONE",
    "body": "Concept ACK\r\n\r\nThis would be useful for https://forkmonitor.info/ to assess the validity of shorter chains\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/725438758/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/725742916",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-725742916",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 725742916,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyNTc0MjkxNg==",
    "user": {
      "login": "benthecarman",
      "id": 15256660,
      "node_id": "MDQ6VXNlcjE1MjU2NjYw",
      "avatar_url": "https://avatars.githubusercontent.com/u/15256660?u=eab48576b7831944b8ce7f04fcdff4154a853d50&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/benthecarman",
      "html_url": "https://github.com/benthecarman",
      "followers_url": "https://api.github.com/users/benthecarman/followers",
      "following_url": "https://api.github.com/users/benthecarman/following{/other_user}",
      "gists_url": "https://api.github.com/users/benthecarman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/benthecarman/subscriptions",
      "organizations_url": "https://api.github.com/users/benthecarman/orgs",
      "repos_url": "https://api.github.com/users/benthecarman/repos",
      "events_url": "https://api.github.com/users/benthecarman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/benthecarman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-12T00:30:20Z",
    "updated_at": "2020-11-12T00:30:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "Concept ACK\r\n\r\nThis would be very useful for testing",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/725742916/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/726741734",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-726741734",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 726741734,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyNjc0MTczNA==",
    "user": {
      "login": "Fi3",
      "id": 6207037,
      "node_id": "MDQ6VXNlcjYyMDcwMzc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6207037?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Fi3",
      "html_url": "https://github.com/Fi3",
      "followers_url": "https://api.github.com/users/Fi3/followers",
      "following_url": "https://api.github.com/users/Fi3/following{/other_user}",
      "gists_url": "https://api.github.com/users/Fi3/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Fi3/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Fi3/subscriptions",
      "organizations_url": "https://api.github.com/users/Fi3/orgs",
      "repos_url": "https://api.github.com/users/Fi3/repos",
      "events_url": "https://api.github.com/users/Fi3/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Fi3/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-13T12:37:46Z",
    "updated_at": "2020-11-13T12:37:46Z",
    "author_association": "NONE",
    "body": "@Sjors \r\n\r\n> It can be difficult to find nodes that still have a stale block, so I'd rather hold on to it. \r\n\r\nI agree, didn't consider it.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/726741734/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/726929962",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-726929962",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 726929962,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyNjkyOTk2Mg==",
    "user": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-13T18:09:54Z",
    "updated_at": "2020-11-13T18:09:54Z",
    "author_association": "MEMBER",
    "body": "Concept -1\r\n\r\nI think it would be better to just do the right thing if you `getblock` a block you don't have... Don't make users figure out which peer has it...?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/726929962/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/727200935",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-727200935",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 727200935,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyNzIwMDkzNQ==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-14T12:31:18Z",
    "updated_at": "2020-11-14T12:31:18Z",
    "author_association": "MEMBER",
    "body": "@luke-jr my thinking was to expand it later, to try all peers: `getblockfrompeer HASH *`. Overloading `getblock` in a way that could make it unresponsive would seem controversial. Adding a `fetch_from_peer` argument to `getblock` could make sense as an alternative.\r\n\r\nIn practice none of the existing peers might have it, so you'll have to:\r\n* manually connect to new peers and retry; or\r\n* add an argument with an array of IPs to try (but not keep as a peer); or\r\n* go through peers.dat entries\r\n\r\nThis could get complicated, so a fresh RPC seemed like a more future proof approach.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/727200935/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/741878271",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-741878271",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 741878271,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0MTg3ODI3MQ==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-09T16:15:12Z",
    "updated_at": "2020-12-09T16:15:12Z",
    "author_association": "MEMBER",
    "body": "I moved `FetchBlock` to the PeerManager while rebasing on #19910. Not sure if that's the right home for it, cc @jnewbery.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/741878271/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/808460439",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-808460439",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 808460439,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgwODQ2MDQzOQ==",
    "user": {
      "login": "prusnak",
      "id": 42201,
      "node_id": "MDQ6VXNlcjQyMjAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/42201?u=24bd00b1856db9374d16f863f8f66fabe0d93341&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prusnak",
      "html_url": "https://github.com/prusnak",
      "followers_url": "https://api.github.com/users/prusnak/followers",
      "following_url": "https://api.github.com/users/prusnak/following{/other_user}",
      "gists_url": "https://api.github.com/users/prusnak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prusnak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prusnak/subscriptions",
      "organizations_url": "https://api.github.com/users/prusnak/orgs",
      "repos_url": "https://api.github.com/users/prusnak/repos",
      "events_url": "https://api.github.com/users/prusnak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prusnak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-26T19:25:01Z",
    "updated_at": "2021-03-26T19:25:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "Does this work with the pruned node too? If yes, then this implements option 2) of https://github.com/bitcoin/bitcoin/issues/19312\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/808460439/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/809216580",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-809216580",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 809216580,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgwOTIxNjU4MA==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-29T09:16:04Z",
    "updated_at": "2021-03-29T09:16:04Z",
    "author_association": "MEMBER",
    "body": "It does, however I'm not sure how quickly the node re-prunes it.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/809216580/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/811786284",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-811786284",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 811786284,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgxMTc4NjI4NA==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-01T09:36:52Z",
    "updated_at": "2021-04-01T09:36:52Z",
    "author_association": "MEMBER",
    "body": "Rebased. No longer needs to haul the mempool around.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/811786284/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/823861952",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-823861952",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 823861952,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyMzg2MTk1Mg==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-21T07:59:18Z",
    "updated_at": "2021-04-21T07:59:18Z",
    "author_association": "MEMBER",
    "body": "Rebased after #21719",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/823861952/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/823869122",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-823869122",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 823869122,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyMzg2OTEyMg==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-21T08:09:37Z",
    "updated_at": "2021-04-21T08:10:37Z",
    "author_association": "MEMBER",
    "body": "Linter:\r\n> A new circular dependency in the form of \"rpc/blockchain -> rpc/net -> rpc/blockchain\" appears to have been introduced.\r\n\r\n@MarcoFalke any thoughts on how to avoid that? I could move this new RPC method to `rpc/net`, or maybe the `EnsurePeerman` and `EnsureConnman` helpers should be in their own file?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/823869122/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/823910779",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-823910779",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 823910779,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyMzkxMDc3OQ==",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-21T09:14:08Z",
    "updated_at": "2021-04-21T09:14:08Z",
    "author_association": "MEMBER",
    "body": "I guess by moving the `Ensure*` helpers to `rpc/util` (or a new module)?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/823910779/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/823970129",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-823970129",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 823970129,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyMzk3MDEyOQ==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-21T10:54:58Z",
    "updated_at": "2021-04-21T10:54:58Z",
    "author_association": "MEMBER",
    "body": "> I moved FetchBlock to the PeerManager while rebasing on #19910. Not sure if that's the right home for it, cc @jnewbery.\r\n\r\nIt's exactly the right place for it. `PeerManager` is the node's interface to net_processing.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/823970129/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/824145867",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-824145867",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 824145867,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyNDE0NTg2Nw==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-21T15:18:32Z",
    "updated_at": "2021-04-21T15:18:32Z",
    "author_association": "MEMBER",
    "body": "Thanks for the feedback! I moved the Ensure* helpers to `util.h` and addressed the above comments.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/824145867/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/824307731",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-824307731",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 824307731,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyNDMwNzczMQ==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-21T19:38:00Z",
    "updated_at": "2021-04-21T19:38:00Z",
    "author_association": "MEMBER",
    "body": "I added `server_util.cpp`. This seems to make the linker happy.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/824307731/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/824600917",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-824600917",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 824600917,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyNDYwMDkxNw==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-22T07:14:01Z",
    "updated_at": "2021-04-22T07:14:01Z",
    "author_association": "MEMBER",
    "body": "Comments addressed.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/824600917/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/824632537",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-824632537",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 824632537,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyNDYzMjUzNw==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-22T08:04:55Z",
    "updated_at": "2021-04-22T08:04:55Z",
    "author_association": "MEMBER",
    "body": "The includes could be improved to include what's needed and not include what's not needed:\r\n\r\n```diff\r\ndiff --git a/src/rpc/server_util.cpp b/src/rpc/server_util.cpp\r\nindex dfe07f5c3d..046a630b51 100644\r\n--- a/src/rpc/server_util.cpp\r\n+++ b/src/rpc/server_util.cpp\r\n@@ -2,12 +2,18 @@\r\n // Distributed under the MIT software license, see the accompanying\r\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\r\n \r\n+#include <rpc/server_util.h>\r\n+\r\n #include <net_processing.h>\r\n #include <node/context.h>\r\n-#include <rpc/server_util.h>\r\n+#include <policy/fees.h>\r\n+#include <rpc/protocol.h>\r\n+#include <rpc/request.h>\r\n+#include <txmempool.h>\r\n #include <util/system.h>\r\n #include <validation.h>\r\n-#include <validationinterface.h>\r\n+\r\n+#include <any>\r\n \r\n NodeContext& EnsureAnyNodeContext(const std::any& context)\r\n {\r\ndiff --git a/src/rpc/server_util.h b/src/rpc/server_util.h\r\nindex c330efd0e6..dd8e8a6042 100644\r\n--- a/src/rpc/server_util.h\r\n+++ b/src/rpc/server_util.h\r\n@@ -5,11 +5,11 @@\r\n #ifndef BITCOIN_RPC_SERVER_UTIL_H\r\n #define BITCOIN_RPC_SERVER_UTIL_H\r\n \r\n-#include <rpc/protocol.h>\r\n-#include <rpc/request.h>\r\n+#include <any>\r\n \r\n class CBlockPolicyEstimator;\r\n class CConnman;\r\n+class ChainstateManager;\r\n class CTxMemPool;\r\n struct NodeContext;\r\n class PeerManager;\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/824632537/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/824644479",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-824644479",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 824644479,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyNDY0NDQ3OQ==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-22T08:23:24Z",
    "updated_at": "2021-04-22T08:23:24Z",
    "author_association": "MEMBER",
    "body": "Also done.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/824644479/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/840223499",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-840223499",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 840223499,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MDIyMzQ5OQ==",
    "user": {
      "login": "prayank23",
      "id": 13405205,
      "node_id": "MDQ6VXNlcjEzNDA1MjA1",
      "avatar_url": "https://avatars.githubusercontent.com/u/13405205?u=03240c7cca7b55e5b9239eeab7a5914663a42b91&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prayank23",
      "html_url": "https://github.com/prayank23",
      "followers_url": "https://api.github.com/users/prayank23/followers",
      "following_url": "https://api.github.com/users/prayank23/following{/other_user}",
      "gists_url": "https://api.github.com/users/prayank23/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prayank23/subscriptions",
      "organizations_url": "https://api.github.com/users/prayank23/orgs",
      "repos_url": "https://api.github.com/users/prayank23/repos",
      "events_url": "https://api.github.com/users/prayank23/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prayank23/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-13T01:41:02Z",
    "updated_at": "2021-05-13T01:41:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "> I think it would be better to just do the right thing if you `getblock` a block you don't have... Don't make users figure out which peer has it...?\r\n\r\nI agree with @luke-jr \r\n\r\nOr this RPC can make sense if all peers would reject such request by _default_ but if someone is okay with it, can save something like `allowgetblockfrompeer=1` in bitcoin.conf",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/840223499/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/840484248",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-840484248",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 840484248,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MDQ4NDI0OA==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-13T11:02:15Z",
    "updated_at": "2021-05-13T11:03:59Z",
    "author_association": "MEMBER",
    "body": "It's not that simple. Do we fetch the block from all peers at once? That's a huge bandwidth waste if you have 100 connection. Do we ask them one by one in sequence? What's the timeout? Do we do in parallel? Hence my suggestion to leave that to a followup.\r\n\r\n> `allowgetblockfrompeer=1`\r\n\r\nPeers will have no idea someone used this RPC call so that's not a concern. Nodes request blocks from each other all the time. This PR does not introduce a new p2p message.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/840484248/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/840578711",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-840578711",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 840578711,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MDU3ODcxMQ==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-13T13:56:32Z",
    "updated_at": "2021-05-13T13:56:32Z",
    "author_association": "MEMBER",
    "body": "Rebased, dropped requirement for local node to have the header, dropped redundant `GetPeerRef`, dropped requirement for other node to be at the right height.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/840578711/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/840691118",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-840691118",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 840691118,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MDY5MTExOA==",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?u=7999a16349f0df0fb273fffa18e5a955c9d3f11c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-13T16:53:15Z",
    "updated_at": "2021-05-13T16:53:15Z",
    "author_association": "MEMBER",
    "body": "Is it really necessary to make this specify which peer? It doesn't sound too hard to make the existing block fetching logic support extra requested blocks, I think.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/840691118/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/840695083",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-840695083",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 840695083,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MDY5NTA4Mw==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-13T17:00:10Z",
    "updated_at": "2021-05-13T17:00:10Z",
    "author_association": "MEMBER",
    "body": "@sipa the current block fetching logic is buried deep inside net_processing. A `MSG_BLOCK` is generated when processing received headers:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/4741aec1dd28829f45abcc529cddaa0ff04d07a0/src/net_processing.cpp#L2011-L2021\r\n\r\nOr when receiving a block:\r\nhttps://github.com/bitcoin/bitcoin/blob/4741aec1dd28829f45abcc529cddaa0ff04d07a0/src/net_processing.cpp#L1733-L1739\r\n\r\nThere doesn't seem to be a queue of blocks to fetch that's distributed over peers and checked in a background process.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/840695083/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/840695885",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-840695885",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 840695885,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MDY5NTg4NQ==",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?u=7999a16349f0df0fb273fffa18e5a955c9d3f11c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-13T17:01:29Z",
    "updated_at": "2021-05-13T17:01:29Z",
    "author_association": "MEMBER",
    "body": "@Sjors Sure, but that doesn't sound too hard to add. And doing it that way sounds a lot more useful.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/840695885/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/840702994",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-840702994",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 840702994,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MDcwMjk5NA==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-13T17:13:14Z",
    "updated_at": "2021-05-13T17:13:50Z",
    "author_association": "MEMBER",
    "body": "In practice I'm already able to use this PR to fetch stale blocks by simply looping over my peers and \"spamming\" them all. I then disconnect if the block doesn't show up, connect to random new peers and then try again. But those are behaviors we probably shouldn't implement here.\r\n\r\nSo although the current incarnation is not ideal, it's already useful. A revamp of `ProcessHeadersMessage` with a separate block download manager sounds doesn't sound easy to me. It also needs different timeout rules than IBD, because most of the time a peer won't have the block.\r\n\r\nThe use case of re-fetching pruned blocks is more similar to IBD, since you can expect every non-pruned node  with sufficiently high `pindexLastCommonBlock` to have it.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/840702994/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/840712874",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-840712874",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 840712874,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MDcxMjg3NA==",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?u=7999a16349f0df0fb273fffa18e5a955c9d3f11c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-13T17:30:06Z",
    "updated_at": "2021-05-13T17:31:02Z",
    "author_association": "MEMBER",
    "body": "Yes, I imagine it'd use the \"background' fetching logic in SendMessages, not the direct fetch in response to an announcement one.\n\nWhy would it need different timeout, or why would most blocks not have it? We know which peers are pruned.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/840712874/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/840738472",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-840738472",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 840738472,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MDczODQ3Mg==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-13T18:13:46Z",
    "updated_at": "2021-05-13T18:14:41Z",
    "author_association": "MEMBER",
    "body": "@sipa we don't fetch a block if we already have (a valid) one for that height. So if you're trying retrieve the losing block from a race, most likely your peers also saw it later and didn't fetch it.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/840738472/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/840756999",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-840756999",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 840756999,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MDc1Njk5OQ==",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?u=7999a16349f0df0fb273fffa18e5a955c9d3f11c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-13T18:45:43Z",
    "updated_at": "2021-05-13T18:45:43Z",
    "author_association": "MEMBER",
    "body": "Oh, I see. I missed that fetching non-main-chain blocks was a goal here.\n\nWhy would you want that?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/840756999/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/840759391",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-840759391",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 840759391,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MDc1OTM5MQ==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-13T18:48:30Z",
    "updated_at": "2021-05-13T18:49:52Z",
    "author_association": "MEMBER",
    "body": "That's indeed the main reason I wrote this, though I can see how it's useful for redownloading pruned blocks too.\r\n\r\nI'm using this for ForkMonitor to fetch stale blocks and compare the transactions, to see if there was a double-spend: https://forkmonitor.info/stale/btc/679823 (we haven't found a proper one in the past few months)",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/840759391/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/853632954",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-853632954",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 853632954,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1MzYzMjk1NA==",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-03T07:11:51Z",
    "updated_at": "2021-06-03T07:11:51Z",
    "author_association": "MEMBER",
    "body": "Error: RPC command \"getblockfrompeer\" not found in RPC_COMMANDS_SAFE_FOR_FUZZING or RPC_COMMANDS_NOT_SAFE_FOR_FUZZING. Please update test/fuzz/rpc.cpp.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/853632954/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/854032885",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-854032885",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 854032885,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1NDAzMjg4NQ==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-03T17:02:51Z",
    "updated_at": "2021-06-03T17:02:51Z",
    "author_association": "MEMBER",
    "body": "Rebased and marked safe for fuzzing (but I haven't tried that).",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/854032885/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/854675957",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-854675957",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 854675957,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1NDY3NTk1Nw==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-04T12:35:12Z",
    "updated_at": "2021-06-04T12:35:12Z",
    "author_association": "MEMBER",
    "body": "ACK 1df0fd9aceaeaf8b45cb0474ce44135418c7d5b7",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/854675957/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/858730120",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-858730120",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 858730120,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1ODczMDEyMA==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-10T15:40:39Z",
    "updated_at": "2021-06-10T15:40:39Z",
    "author_association": "MEMBER",
    "body": "Rebased due to silent merge conflict with #22141, which I randomly caught while looking at IRC notifications :-) But it's a welcome simplification.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/858730120/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/860238151",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-860238151",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 860238151,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2MDIzODE1MQ==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-13T16:32:55Z",
    "updated_at": "2021-06-13T16:32:55Z",
    "author_association": "MEMBER",
    "body": "Rebased after some `Ensure*` methods were renamed in #21391.\r\n\r\nIn addition since #22221, `BlockRequested` no longer takes a pointer. Which means we can't call it for blocks for which we don't have a header. Paging @MarcoFalke to check if that was indeed the intention.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/860238151/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/888895395",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-888895395",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 888895395,
    "node_id": "IC_kwDOABII5840-3ej",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-29T08:04:32Z",
    "updated_at": "2021-07-29T08:04:32Z",
    "author_association": "MEMBER",
    "body": "See also #10794 ",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/888895395/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/889244846",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-889244846",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 889244846,
    "node_id": "IC_kwDOABII5841AMyu",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-29T15:31:15Z",
    "updated_at": "2021-07-29T15:31:15Z",
    "author_association": "MEMBER",
    "body": "@MarcoFalke specifically its `requestblock` RPC? There's been too much refactoring to simply cherry-pick it, but it could contain inspiration for improvement.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/889244846/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/889285858",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-889285858",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 889285858,
    "node_id": "IC_kwDOABII5841AWzi",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-29T16:21:54Z",
    "updated_at": "2021-07-29T16:21:54Z",
    "author_association": "MEMBER",
    "body": "Yes, just left the comment to remind myself that this has been worked on in the past already. No need to change anything here, but if someone wants to read some related threads, it might be helpful.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/889285858/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/897202731",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-897202731",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 897202731,
    "node_id": "IC_kwDOABII5841ejor",
    "user": {
      "login": "mzumsande",
      "id": 48763452,
      "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
      "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mzumsande",
      "html_url": "https://github.com/mzumsande",
      "followers_url": "https://api.github.com/users/mzumsande/followers",
      "following_url": "https://api.github.com/users/mzumsande/following{/other_user}",
      "gists_url": "https://api.github.com/users/mzumsande/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
      "organizations_url": "https://api.github.com/users/mzumsande/orgs",
      "repos_url": "https://api.github.com/users/mzumsande/repos",
      "events_url": "https://api.github.com/users/mzumsande/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mzumsande/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-11T22:27:02Z",
    "updated_at": "2021-08-11T22:27:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "> What do you think about restricting this RPC to where the node already has the header, by returning in `getblockfrompeer()` if `LookupBlockIndex()` fails?\r\n\r\nI agree that this would make sense. My understanding is that if we'd request a block for which we don't  have the header and which has less work than our tip, then `getblockfrompeer` would currently signal success, we might also get the block delivered by the peer, but then `AcceptBlock()` would never store it because `fRequested` and `fHasMoreOrSameWork` would be false ([code](https://github.com/bitcoin/bitcoin/blob/e614cc8cd808902c843568f1790730622d619620/src/validation.cpp#L3421-L3431 ))\r\nBut if we cannot accept the block, I don't think it makes sense to request it in the first place (and we should instead report an RPC error).\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/897202731/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/897616547",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-897616547",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 897616547,
    "node_id": "IC_kwDOABII5841gIqj",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-12T12:56:43Z",
    "updated_at": "2021-08-12T14:20:13Z",
    "author_association": "MEMBER",
    "body": "Yesterdays PR Review Club covered this PR, thanks everyone! https://bitcoincore.reviews/20295\r\n\r\nRebased and addressed feedback.\r\n\r\n@jnewbery in the use case I have in mind the node already has the header. We could always add a `getheaderfrompeer` RPC method if anyone needs it, though that seems a bit tedious to use. Alternative we can later expand `getblockfrompeer` to be smart about fetching headers first. For now I'll add the check you suggested so the user gets a clear error when requesting a block for which we don't have a header.\r\n\r\nI'll ponder this a bit, but for now I just added a line to the TODO warning about potentially breaking `getblockfrompeer`.\r\n<img width=\"1104\" alt=\"Schermafbeelding 2021-08-12 om 13 49 18\" src=\"https://user-images.githubusercontent.com/10217/129199510-c8bdfb75-95c5-43de-a2a6-d63a9b39b067.png\">",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/897616547/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/899528289",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-899528289",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 899528289,
    "node_id": "IC_kwDOABII5841nbZh",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-16T13:51:39Z",
    "updated_at": "2021-08-16T13:51:39Z",
    "author_association": "MEMBER",
    "body": "I reverted back to returning an empty object as per the [developer notes](https://github.com/bitcoin/bitcoin/blob/master/doc/developer-notes.md#rpc-interface-guidelines) \"Try to make the RPC response a JSON object\".\r\n\r\nAlso made `FetchBlock` take `CBlockIndex` as a reference rather than a pointer, since it's now mandatory.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/899528289/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/899531341",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-899531341",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 899531341,
    "node_id": "IC_kwDOABII5841ncJN",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-16T13:55:40Z",
    "updated_at": "2021-08-16T13:55:40Z",
    "author_association": "MEMBER",
    "body": "reACK 29263ae14a81d4cc55de61f51db981edf54399d0",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/899531341/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/899535444",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-899535444",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 899535444,
    "node_id": "IC_kwDOABII5841ndJU",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-16T14:01:26Z",
    "updated_at": "2021-08-16T14:01:26Z",
    "author_association": "MEMBER",
    "body": "Concept ACK",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/899535444/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/920772012",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-920772012",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 920772012,
    "node_id": "IC_kwDOABII58424d2s",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-16T10:14:38Z",
    "updated_at": "2021-09-16T10:14:38Z",
    "author_association": "MEMBER",
    "body": "Thanks for the thorough testing @0xB10C.\r\n\r\nRegarding (3) and (6): if a peer doesn't give us the block, there's nothing we can do. Since the call is not asynchronous, we can't give the user much useful feedback either. Changing p2p behavior for peers to give us a block before it's evaluated, or one it considers invalid, is beyond the scope of this PR.\r\n\r\n> Requesting an unavailable block from a peer `A` multiple times in a row fails with the error message `Failed to fetch block from peer` starting with the second request. A `getdata` message is only send to the peer on the first attempt.\r\n\r\nInteresting. I'd rather not make the RPC aware of too much internal magic of netmanager. If the user calls an RPC again after an error message, I guess they're on their own :-)\r\n\r\n> The error message is not displayed when requesting from a peer `B` in between the requests to peer `A`.\r\n\r\nThe only reason I can think of for requesting a block from multiple peers, is that the user is happy as long as at least one succeeds. So this is probably not a huge deal, but still strange. I could add a recommendation to the help that it's safer to call this method in sequence with a few second delay?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/920772012/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/929951709",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-929951709",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 929951709,
    "node_id": "IC_kwDOABII5843be_d",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-29T08:22:10Z",
    "updated_at": "2021-09-29T08:22:10Z",
    "author_association": "MEMBER",
    "body": "Rebased after #22650 (trivial conflict with first commit).",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/929951709/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/931074173",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-931074173",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 931074173,
    "node_id": "IC_kwDOABII5843fxB9",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-30T08:54:56Z",
    "updated_at": "2021-09-30T08:54:56Z",
    "author_association": "MEMBER",
    "body": "reACK 4096e6fb013aa3fbe3463d24b70310ad8517da5f",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/931074173/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/937590001",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-937590001",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 937590001,
    "node_id": "IC_kwDOABII58434nzx",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-07T08:54:20Z",
    "updated_at": "2021-10-07T08:54:20Z",
    "author_association": "MEMBER",
    "body": "Rebased once more (dd8f7f250095e58bbf4cd4effb481b52143bd1ed touched `PeerManager::make` directly under the new `FetchBlock`, though I'm disappointed Git couldn't figure that out).",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/937590001/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/937621235",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-937621235",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 937621235,
    "node_id": "IC_kwDOABII58434vbz",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-07T09:34:21Z",
    "updated_at": "2021-10-07T09:34:21Z",
    "author_association": "MEMBER",
    "body": "trivial reACK 9181e2e217\r\n\r\nConfirmed with `git rangediff` that the only conflict was for touching lines.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/937621235/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/946796031",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-946796031",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 946796031,
    "node_id": "IC_kwDOABII5844bvX_",
    "user": {
      "login": "prusnak",
      "id": 42201,
      "node_id": "MDQ6VXNlcjQyMjAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/42201?u=24bd00b1856db9374d16f863f8f66fabe0d93341&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prusnak",
      "html_url": "https://github.com/prusnak",
      "followers_url": "https://api.github.com/users/prusnak/followers",
      "following_url": "https://api.github.com/users/prusnak/following{/other_user}",
      "gists_url": "https://api.github.com/users/prusnak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prusnak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prusnak/subscriptions",
      "organizations_url": "https://api.github.com/users/prusnak/orgs",
      "repos_url": "https://api.github.com/users/prusnak/repos",
      "events_url": "https://api.github.com/users/prusnak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prusnak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-19T14:42:39Z",
    "updated_at": "2021-10-19T14:42:39Z",
    "author_association": "CONTRIBUTOR",
    "body": "I'd love to see this merged in. \ud83d\udc4d \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/946796031/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/971961777",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#issuecomment-971961777",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20295",
    "id": 971961777,
    "node_id": "IC_kwDOABII58457vWx",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-17T20:26:07Z",
    "updated_at": "2021-11-17T20:26:07Z",
    "author_association": "MEMBER",
    "body": "Concept ACK, will review in the next few days.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/971961777/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617408180",
    "pull_request_review_id": 640903582,
    "id": 617408180,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNzQwODE4MA==",
    "diff_hunk": "@@ -246,6 +246,7 @@ class PeerManagerImpl final : public PeerManager\n \n     /** Implement PeerManager */\n     void CheckForStaleTipAndEvictPeers() override;\n+    bool FetchBlock(const NodeId nodeid, const CBlockIndex* pindex) override;",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "f8d9dbf7960f3bf40ef3f87501cf903b5a4115d0",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "No need to make the pass-by-value `NodeId nodeid` const.\r\n\r\nStyle guide is to use snake_case and not hungarian notation for parameter names:\r\n\r\n```suggestion\r\n    bool FetchBlock(const NodeId id, const CBlockIndex* index) override;\r\n```",
    "created_at": "2021-04-21T10:24:40Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617408180",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617408180"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617408180"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617408180/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 249,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617411027",
    "pull_request_review_id": 640903582,
    "id": 617411027,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNzQxMTAyNw==",
    "diff_hunk": "@@ -1252,6 +1253,33 @@ bool PeerManagerImpl::BlockRequestAllowed(const CBlockIndex* pindex)\n            (GetBlockProofEquivalentTime(*pindexBestHeader, *pindex, *pindexBestHeader, m_chainparams.GetConsensus()) < STALE_RELAY_AGE_LIMIT);\n }\n \n+bool PeerManagerImpl::FetchBlock(const NodeId nodeid, const CBlockIndex* pindex) EXCLUSIVE_LOCKS_REQUIRED(cs_main)",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 12,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "f8d9dbf7960f3bf40ef3f87501cf903b5a4115d0",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I don't think this `EXCLUSIVE_LOCKS_REQUIRED(cs_main)` is doing anything. This function is being called without `cs_main` (by `getblockfrompeer()`).\r\n\r\nI think it's better to remove this annotation and lock `cs_main` within this function.",
    "created_at": "2021-04-21T10:27:29Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617411027",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617411027"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617411027"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617411027/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1256,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617412992",
    "pull_request_review_id": 640903582,
    "id": 617412992,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNzQxMjk5Mg==",
    "diff_hunk": "@@ -1252,6 +1253,33 @@ bool PeerManagerImpl::BlockRequestAllowed(const CBlockIndex* pindex)\n            (GetBlockProofEquivalentTime(*pindexBestHeader, *pindex, *pindexBestHeader, m_chainparams.GetConsensus()) < STALE_RELAY_AGE_LIMIT);\n }\n \n+bool PeerManagerImpl::FetchBlock(const NodeId nodeid, const CBlockIndex* pindex) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    PeerRef peer = GetPeerRef(nodeid);\n+    if (peer == nullptr) return false;\n+    uint32_t nFetchFlags = 0;",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 16,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "f8d9dbf7960f3bf40ef3f87501cf903b5a4115d0",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Move this down to where it's first used, and make const:\r\n\r\n```suggestion\r\n    const uint32_t nFetchFlags = state->fHaveWitness ? MSG_WITNESS_FLAG : 0;\r\n```",
    "created_at": "2021-04-21T10:29:27Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617412992",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617412992"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617412992"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617412992/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1260,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617422387",
    "pull_request_review_id": 640903582,
    "id": 617422387,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNzQyMjM4Nw==",
    "diff_hunk": "@@ -1252,6 +1253,33 @@ bool PeerManagerImpl::BlockRequestAllowed(const CBlockIndex* pindex)\n            (GetBlockProofEquivalentTime(*pindexBestHeader, *pindex, *pindexBestHeader, m_chainparams.GetConsensus()) < STALE_RELAY_AGE_LIMIT);\n }\n \n+bool PeerManagerImpl::FetchBlock(const NodeId nodeid, const CBlockIndex* pindex) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    PeerRef peer = GetPeerRef(nodeid);\n+    if (peer == nullptr) return false;\n+    uint32_t nFetchFlags = 0;\n+    CNodeState* state = State(nodeid);\n+    if (state == nullptr) {\n+        return false;\n+    }\n+    const int node_sync_height = state->pindexBestKnownBlock ? state->pindexBestKnownBlock->nHeight : -1;\n+    if (pindex->nHeight > node_sync_height) {\n+        return false;\n+    }\n+    if (state->fHaveWitness) {\n+        nFetchFlags |= MSG_WITNESS_FLAG;\n+    }\n+    std::vector<CInv> vInv(1);\n+    vInv[0] = CInv(MSG_BLOCK | nFetchFlags, pindex->GetBlockHash());",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 29,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "f8d9dbf7960f3bf40ef3f87501cf903b5a4115d0",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Use initializer list ctor:\r\n\r\n```suggestion\r\n    std::vector<CInv> vInv{CInv(MSG_BLOCK | nFetchFlags, pindex->GetBlockHash())};\r\n```",
    "created_at": "2021-04-21T10:42:56Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617422387",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617422387"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617422387"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617422387/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 1272,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 1273,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617422621",
    "pull_request_review_id": 640903582,
    "id": 617422621,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNzQyMjYyMQ==",
    "diff_hunk": "@@ -1252,6 +1253,33 @@ bool PeerManagerImpl::BlockRequestAllowed(const CBlockIndex* pindex)\n            (GetBlockProofEquivalentTime(*pindexBestHeader, *pindex, *pindexBestHeader, m_chainparams.GetConsensus()) < STALE_RELAY_AGE_LIMIT);\n }\n \n+bool PeerManagerImpl::FetchBlock(const NodeId nodeid, const CBlockIndex* pindex) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{",
    "path": "src/net_processing.cpp",
    "position": 13,
    "original_position": 13,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "f8d9dbf7960f3bf40ef3f87501cf903b5a4115d0",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Perhaps return false if we're importing or reindexing (since the received `block` message will be ignored)",
    "created_at": "2021-04-21T10:43:22Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617422621",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617422621"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617422621"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617422621/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1431,
    "original_line": 1431,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617423719",
    "pull_request_review_id": 640903582,
    "id": 617423719,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNzQyMzcxOQ==",
    "diff_hunk": "@@ -1252,6 +1253,33 @@ bool PeerManagerImpl::BlockRequestAllowed(const CBlockIndex* pindex)\n            (GetBlockProofEquivalentTime(*pindexBestHeader, *pindex, *pindexBestHeader, m_chainparams.GetConsensus()) < STALE_RELAY_AGE_LIMIT);\n }\n \n+bool PeerManagerImpl::FetchBlock(const NodeId nodeid, const CBlockIndex* pindex) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    PeerRef peer = GetPeerRef(nodeid);\n+    if (peer == nullptr) return false;\n+    uint32_t nFetchFlags = 0;\n+    CNodeState* state = State(nodeid);\n+    if (state == nullptr) {\n+        return false;\n+    }\n+    const int node_sync_height = state->pindexBestKnownBlock ? state->pindexBestKnownBlock->nHeight : -1;\n+    if (pindex->nHeight > node_sync_height) {\n+        return false;\n+    }\n+    if (state->fHaveWitness) {",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 25,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "f8d9dbf7960f3bf40ef3f87501cf903b5a4115d0",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Perhaps just return false if the peer doesn't have `MSG_WITNESS_FLAG`. It's 2021. Receiving a block without witnesses isn't going to be useful.",
    "created_at": "2021-04-21T10:45:21Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617423719",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617423719"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617423719"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617423719/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1269,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617425121",
    "pull_request_review_id": 640903582,
    "id": 617425121,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNzQyNTEyMQ==",
    "diff_hunk": "@@ -1252,6 +1253,33 @@ bool PeerManagerImpl::BlockRequestAllowed(const CBlockIndex* pindex)\n            (GetBlockProofEquivalentTime(*pindexBestHeader, *pindex, *pindexBestHeader, m_chainparams.GetConsensus()) < STALE_RELAY_AGE_LIMIT);\n }\n \n+bool PeerManagerImpl::FetchBlock(const NodeId nodeid, const CBlockIndex* pindex) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    PeerRef peer = GetPeerRef(nodeid);\n+    if (peer == nullptr) return false;\n+    uint32_t nFetchFlags = 0;\n+    CNodeState* state = State(nodeid);\n+    if (state == nullptr) {\n+        return false;\n+    }\n+    const int node_sync_height = state->pindexBestKnownBlock ? state->pindexBestKnownBlock->nHeight : -1;\n+    if (pindex->nHeight > node_sync_height) {\n+        return false;\n+    }\n+    if (state->fHaveWitness) {\n+        nFetchFlags |= MSG_WITNESS_FLAG;\n+    }\n+    std::vector<CInv> vInv(1);\n+    vInv[0] = CInv(MSG_BLOCK | nFetchFlags, pindex->GetBlockHash());\n+    bool success = m_connman.ForNode(nodeid, [this, vInv](CNode* pnode) {\n+        const CNetMsgMaker msgMaker(pnode->GetCommonVersion());\n+        this->m_connman.PushMessage(pnode, msgMaker.Make(NetMsgType::GETDATA, vInv));\n+        return true;\n+    });\n+    MarkBlockAsInFlight(nodeid, pindex->GetBlockHash(), pindex);",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 35,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "f8d9dbf7960f3bf40ef3f87501cf903b5a4115d0",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Perhaps move this above the `ForNode()` call and don't send the `getdata` if it returns false, since that indicates that the block is already in flight. We don't want a faulty RPC client causing us to spam a peer with multiple requests for the same block.",
    "created_at": "2021-04-21T10:47:36Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617425121",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617425121"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617425121"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617425121/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1279,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617425468",
    "pull_request_review_id": 640903582,
    "id": 617425468,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNzQyNTQ2OA==",
    "diff_hunk": "@@ -1252,6 +1253,33 @@ bool PeerManagerImpl::BlockRequestAllowed(const CBlockIndex* pindex)\n            (GetBlockProofEquivalentTime(*pindexBestHeader, *pindex, *pindexBestHeader, m_chainparams.GetConsensus()) < STALE_RELAY_AGE_LIMIT);\n }\n \n+bool PeerManagerImpl::FetchBlock(const NodeId nodeid, const CBlockIndex* pindex) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    PeerRef peer = GetPeerRef(nodeid);\n+    if (peer == nullptr) return false;\n+    uint32_t nFetchFlags = 0;\n+    CNodeState* state = State(nodeid);\n+    if (state == nullptr) {\n+        return false;\n+    }\n+    const int node_sync_height = state->pindexBestKnownBlock ? state->pindexBestKnownBlock->nHeight : -1;\n+    if (pindex->nHeight > node_sync_height) {\n+        return false;\n+    }\n+    if (state->fHaveWitness) {\n+        nFetchFlags |= MSG_WITNESS_FLAG;\n+    }\n+    std::vector<CInv> vInv(1);\n+    vInv[0] = CInv(MSG_BLOCK | nFetchFlags, pindex->GetBlockHash());\n+    bool success = m_connman.ForNode(nodeid, [this, vInv](CNode* pnode) {",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 30,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "f8d9dbf7960f3bf40ef3f87501cf903b5a4115d0",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Maybe add a log if the message is sent.",
    "created_at": "2021-04-21T10:48:11Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617425468",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617425468"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617425468"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617425468/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1274,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617425832",
    "pull_request_review_id": 640903582,
    "id": 617425832,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNzQyNTgzMg==",
    "diff_hunk": "@@ -1252,6 +1253,33 @@ bool PeerManagerImpl::BlockRequestAllowed(const CBlockIndex* pindex)\n            (GetBlockProofEquivalentTime(*pindexBestHeader, *pindex, *pindexBestHeader, m_chainparams.GetConsensus()) < STALE_RELAY_AGE_LIMIT);\n }\n \n+bool PeerManagerImpl::FetchBlock(const NodeId nodeid, const CBlockIndex* pindex) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    PeerRef peer = GetPeerRef(nodeid);\n+    if (peer == nullptr) return false;\n+    uint32_t nFetchFlags = 0;\n+    CNodeState* state = State(nodeid);\n+    if (state == nullptr) {\n+        return false;\n+    }\n+    const int node_sync_height = state->pindexBestKnownBlock ? state->pindexBestKnownBlock->nHeight : -1;\n+    if (pindex->nHeight > node_sync_height) {\n+        return false;\n+    }\n+    if (state->fHaveWitness) {\n+        nFetchFlags |= MSG_WITNESS_FLAG;\n+    }\n+    std::vector<CInv> vInv(1);",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 28,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "f8d9dbf7960f3bf40ef3f87501cf903b5a4115d0",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "style guide:\r\n\r\n```suggestion\r\n    std::vector<CInv> invs(1);\r\n```",
    "created_at": "2021-04-21T10:48:46Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617425832",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617425832"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617425832"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617425832/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1272,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617426187",
    "pull_request_review_id": 640903582,
    "id": 617426187,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNzQyNjE4Nw==",
    "diff_hunk": "@@ -764,6 +767,46 @@ static RPCHelpMan getmempoolentry()\n     };\n }\n \n+static RPCHelpMan getblockfrompeer()\n+{\n+    return RPCHelpMan{\"getblockfrompeer\",\n+                \"\\nAttempts to fetch block from a given peer.\\n\",\n+                {\n+                    {\"blockhash\", RPCArg::Type::STR_HEX, RPCArg::Optional::NO, \"The block hash\"},\n+                    {\"nodeid\", RPCArg::Type::NUM, RPCArg::Optional::NO, \"The node ID (see getpeerinfo for node IDs)\"},\n+                },\n+                RPCResult{RPCResult::Type::NONE, \"\", \"\"},\n+                RPCExamples{\n+                    HelpExampleCli(\"getblockfrompeer\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 0\")\n+                + HelpExampleRpc(\"getblockfrompeer\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 0\")\n+                },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    uint256 hash(ParseHashV(request.params[0], \"hash\"));\n+\n+    const CBlockIndex* pblockindex;\n+    {\n+        LOCK(cs_main);\n+        pblockindex = g_chainman.m_blockman.LookupBlockIndex(hash);",
    "path": "src/rpc/blockchain.cpp",
    "position": null,
    "original_position": 41,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "f8d9dbf7960f3bf40ef3f87501cf903b5a4115d0",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Don't use the global chainman - use `EnsureChainman()`",
    "created_at": "2021-04-21T10:49:20Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617426187",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617426187"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617426187"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617426187/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 790,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617426660",
    "pull_request_review_id": 640903582,
    "id": 617426660,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNzQyNjY2MA==",
    "diff_hunk": "@@ -764,6 +767,46 @@ static RPCHelpMan getmempoolentry()\n     };\n }\n \n+static RPCHelpMan getblockfrompeer()\n+{\n+    return RPCHelpMan{\"getblockfrompeer\",\n+                \"\\nAttempts to fetch block from a given peer.\\n\",\n+                {\n+                    {\"blockhash\", RPCArg::Type::STR_HEX, RPCArg::Optional::NO, \"The block hash\"},\n+                    {\"nodeid\", RPCArg::Type::NUM, RPCArg::Optional::NO, \"The node ID (see getpeerinfo for node IDs)\"},\n+                },\n+                RPCResult{RPCResult::Type::NONE, \"\", \"\"},\n+                RPCExamples{\n+                    HelpExampleCli(\"getblockfrompeer\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 0\")\n+                + HelpExampleRpc(\"getblockfrompeer\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 0\")\n+                },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    uint256 hash(ParseHashV(request.params[0], \"hash\"));\n+\n+    const CBlockIndex* pblockindex;\n+    {\n+        LOCK(cs_main);\n+        pblockindex = g_chainman.m_blockman.LookupBlockIndex(hash);\n+    }\n+\n+    if (!pblockindex) {\n+        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Block not found\");\n+    }\n+\n+    const UniValue &id_arg = request.params[1];\n+    const NodeId nodeid = (NodeId) id_arg.get_int64();\n+    const NodeContext& node = EnsureAnyNodeContext(request.context);\n+    PeerManager& peerman = EnsurePeerman(node);",
    "path": "src/rpc/blockchain.cpp",
    "position": null,
    "original_position": 51,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "f8d9dbf7960f3bf40ef3f87501cf903b5a4115d0",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Move these to the top of the function - if these assumptions fail we should throw immediately instead of taking cs_main and looking up the block.",
    "created_at": "2021-04-21T10:50:05Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617426660",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617426660"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617426660"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617426660/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 798,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 800,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617427542",
    "pull_request_review_id": 640903582,
    "id": 617427542,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNzQyNzU0Mg==",
    "diff_hunk": "@@ -764,6 +767,46 @@ static RPCHelpMan getmempoolentry()\n     };\n }\n \n+static RPCHelpMan getblockfrompeer()\n+{\n+    return RPCHelpMan{\"getblockfrompeer\",\n+                \"\\nAttempts to fetch block from a given peer.\\n\",\n+                {\n+                    {\"blockhash\", RPCArg::Type::STR_HEX, RPCArg::Optional::NO, \"The block hash\"},\n+                    {\"nodeid\", RPCArg::Type::NUM, RPCArg::Optional::NO, \"The node ID (see getpeerinfo for node IDs)\"},\n+                },\n+                RPCResult{RPCResult::Type::NONE, \"\", \"\"},\n+                RPCExamples{\n+                    HelpExampleCli(\"getblockfrompeer\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 0\")\n+                + HelpExampleRpc(\"getblockfrompeer\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 0\")\n+                },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    uint256 hash(ParseHashV(request.params[0], \"hash\"));\n+\n+    const CBlockIndex* pblockindex;\n+    {\n+        LOCK(cs_main);\n+        pblockindex = g_chainman.m_blockman.LookupBlockIndex(hash);\n+    }",
    "path": "src/rpc/blockchain.cpp",
    "position": null,
    "original_position": 42,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "f8d9dbf7960f3bf40ef3f87501cf903b5a4115d0",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\n    const CBlockIndex* const pblockindex = WITH_LOCK(cs_main, return g_chainman.m_blockman.LookupBlockIndex(hash););\r\n```",
    "created_at": "2021-04-21T10:51:38Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617427542",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617427542"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617427542"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617427542/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 787,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 785,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617427934",
    "pull_request_review_id": 640903582,
    "id": 617427934,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNzQyNzkzNA==",
    "diff_hunk": "@@ -764,6 +767,46 @@ static RPCHelpMan getmempoolentry()\n     };\n }\n \n+static RPCHelpMan getblockfrompeer()\n+{\n+    return RPCHelpMan{\"getblockfrompeer\",\n+                \"\\nAttempts to fetch block from a given peer.\\n\",\n+                {\n+                    {\"blockhash\", RPCArg::Type::STR_HEX, RPCArg::Optional::NO, \"The block hash\"},\n+                    {\"nodeid\", RPCArg::Type::NUM, RPCArg::Optional::NO, \"The node ID (see getpeerinfo for node IDs)\"},\n+                },\n+                RPCResult{RPCResult::Type::NONE, \"\", \"\"},",
    "path": "src/rpc/blockchain.cpp",
    "position": null,
    "original_position": 29,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "f8d9dbf7960f3bf40ef3f87501cf903b5a4115d0",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Return an empty object in case we want to extend the API in the future.",
    "created_at": "2021-04-21T10:52:17Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617427934",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617427934"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617427934"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617427934/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 762,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617428096",
    "pull_request_review_id": 640903582,
    "id": 617428096,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNzQyODA5Ng==",
    "diff_hunk": "@@ -764,6 +767,46 @@ static RPCHelpMan getmempoolentry()\n     };\n }\n \n+static RPCHelpMan getblockfrompeer()\n+{\n+    return RPCHelpMan{\"getblockfrompeer\",\n+                \"\\nAttempts to fetch block from a given peer.\\n\",",
    "path": "src/rpc/blockchain.cpp",
    "position": null,
    "original_position": 24,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "f8d9dbf7960f3bf40ef3f87501cf903b5a4115d0",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Imperative mood:\r\n\r\n```suggestion\r\n                \"\\nAttempt to fetch block from a given peer.\\n\",\r\n```",
    "created_at": "2021-04-21T10:52:34Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617428096",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617428096"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617428096"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617428096/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 773,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617620994",
    "pull_request_review_id": 641190502,
    "id": 617620994,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNzYyMDk5NA==",
    "diff_hunk": "@@ -1252,6 +1253,33 @@ bool PeerManagerImpl::BlockRequestAllowed(const CBlockIndex* pindex)\n            (GetBlockProofEquivalentTime(*pindexBestHeader, *pindex, *pindexBestHeader, m_chainparams.GetConsensus()) < STALE_RELAY_AGE_LIMIT);\n }\n \n+bool PeerManagerImpl::FetchBlock(const NodeId nodeid, const CBlockIndex* pindex) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    PeerRef peer = GetPeerRef(nodeid);\n+    if (peer == nullptr) return false;\n+    uint32_t nFetchFlags = 0;",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 16,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "f8d9dbf7960f3bf40ef3f87501cf903b5a4115d0",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I followed your suggestion below to just ignore pre-segwit nodes, so no need to have `nFetchFlags` around...",
    "created_at": "2021-04-21T14:49:56Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617620994",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617620994"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617620994"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617620994/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1260,
    "side": "RIGHT",
    "in_reply_to_id": 617412992
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617647027",
    "pull_request_review_id": 641225145,
    "id": 617647027,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNzY0NzAyNw==",
    "diff_hunk": "@@ -1252,6 +1253,33 @@ bool PeerManagerImpl::BlockRequestAllowed(const CBlockIndex* pindex)\n            (GetBlockProofEquivalentTime(*pindexBestHeader, *pindex, *pindexBestHeader, m_chainparams.GetConsensus()) < STALE_RELAY_AGE_LIMIT);\n }\n \n+bool PeerManagerImpl::FetchBlock(const NodeId nodeid, const CBlockIndex* pindex) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    PeerRef peer = GetPeerRef(nodeid);\n+    if (peer == nullptr) return false;\n+    uint32_t nFetchFlags = 0;\n+    CNodeState* state = State(nodeid);\n+    if (state == nullptr) {\n+        return false;\n+    }\n+    const int node_sync_height = state->pindexBestKnownBlock ? state->pindexBestKnownBlock->nHeight : -1;\n+    if (pindex->nHeight > node_sync_height) {\n+        return false;\n+    }\n+    if (state->fHaveWitness) {\n+        nFetchFlags |= MSG_WITNESS_FLAG;\n+    }\n+    std::vector<CInv> vInv(1);\n+    vInv[0] = CInv(MSG_BLOCK | nFetchFlags, pindex->GetBlockHash());\n+    bool success = m_connman.ForNode(nodeid, [this, vInv](CNode* pnode) {\n+        const CNetMsgMaker msgMaker(pnode->GetCommonVersion());\n+        this->m_connman.PushMessage(pnode, msgMaker.Make(NetMsgType::GETDATA, vInv));\n+        return true;\n+    });\n+    MarkBlockAsInFlight(nodeid, pindex->GetBlockHash(), pindex);",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 35,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "f8d9dbf7960f3bf40ef3f87501cf903b5a4115d0",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Not sure if I got this right now...",
    "created_at": "2021-04-21T15:19:02Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617647027",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617647027"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617647027"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617647027/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1279,
    "side": "RIGHT",
    "in_reply_to_id": 617425121
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617676009",
    "pull_request_review_id": 641263501,
    "id": 617676009,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNzY3NjAwOQ==",
    "diff_hunk": "@@ -764,6 +716,43 @@ static RPCHelpMan getmempoolentry()\n     };\n }\n \n+static RPCHelpMan getblockfrompeer()\n+{\n+    return RPCHelpMan{\"getblockfrompeer\",\n+                \"\\nAttempt to fetch block from a given peer.\\n\",\n+                {\n+                    {\"blockhash\", RPCArg::Type::STR_HEX, RPCArg::Optional::NO, \"The block hash\"},\n+                    {\"nodeid\", RPCArg::Type::NUM, RPCArg::Optional::NO, \"The node ID (see getpeerinfo for node IDs)\"},\n+                },\n+                RPCResult{RPCResult::Type::ANY, \"\", \"\"},\n+                RPCExamples{\n+                    HelpExampleCli(\"getblockfrompeer\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 0\")\n+                + HelpExampleRpc(\"getblockfrompeer\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 0\")\n+                },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    const UniValue &id_arg = request.params[1];\n+    const NodeId nodeid = (NodeId) id_arg.get_int64();",
    "path": "src/rpc/blockchain.cpp",
    "position": null,
    "original_position": 93,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "91abc3760e8eff5ee30fa0b29b93754438ba16d2",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Prefer a named cast to c-style casts (https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#es49-if-you-must-use-a-cast-use-a-named-cast)\r\n\r\n```suggestion\r\n    const NodeId nodeid = static_cast<NodeId>(id_arg.get_int64());\r\n```",
    "created_at": "2021-04-21T15:52:52Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617676009",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617676009"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617676009"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617676009/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 735,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617677445",
    "pull_request_review_id": 641263501,
    "id": 617677445,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNzY3NzQ0NQ==",
    "diff_hunk": "@@ -764,6 +716,43 @@ static RPCHelpMan getmempoolentry()\n     };\n }\n \n+static RPCHelpMan getblockfrompeer()\n+{\n+    return RPCHelpMan{\"getblockfrompeer\",\n+                \"\\nAttempt to fetch block from a given peer.\\n\",\n+                {\n+                    {\"blockhash\", RPCArg::Type::STR_HEX, RPCArg::Optional::NO, \"The block hash\"},\n+                    {\"nodeid\", RPCArg::Type::NUM, RPCArg::Optional::NO, \"The node ID (see getpeerinfo for node IDs)\"},\n+                },\n+                RPCResult{RPCResult::Type::ANY, \"\", \"\"},\n+                RPCExamples{\n+                    HelpExampleCli(\"getblockfrompeer\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 0\")\n+                + HelpExampleRpc(\"getblockfrompeer\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 0\")\n+                },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    const UniValue &id_arg = request.params[1];\n+    const NodeId nodeid = (NodeId) id_arg.get_int64();\n+    const NodeContext& node = EnsureAnyNodeContext(request.context);\n+    ChainstateManager& chainman = EnsureChainman(node);\n+    PeerManager& peerman = EnsurePeerman(node);\n+\n+    uint256 hash(ParseHashV(request.params[0], \"hash\"));",
    "path": "src/rpc/blockchain.cpp",
    "position": null,
    "original_position": 98,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "91abc3760e8eff5ee30fa0b29b93754438ba16d2",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This ordering seems weird to me (read param 1, then state assumptions, then read param 0). I'd suggest:\r\n\r\n```suggestion\r\n    const NodeContext& node = EnsureAnyNodeContext(request.context);\r\n    ChainstateManager& chainman = EnsureChainman(node);\r\n    PeerManager& peerman = EnsurePeerman(node);\r\n\r\n    uint256 hash(ParseHashV(request.params[0], \"hash\"));\r\n\r\n    const UniValue &id_arg = request.params[1];\r\n    const NodeId nodeid = (NodeId) id_arg.get_int64();\r\n```",
    "created_at": "2021-04-21T15:54:36Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617677445",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617677445"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617677445"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617677445/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 734,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 778,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617684847",
    "pull_request_review_id": 641263501,
    "id": 617684847,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNzY4NDg0Nw==",
    "diff_hunk": "@@ -764,6 +716,43 @@ static RPCHelpMan getmempoolentry()\n     };\n }\n \n+static RPCHelpMan getblockfrompeer()\n+{\n+    return RPCHelpMan{\"getblockfrompeer\",\n+                \"\\nAttempt to fetch block from a given peer.\\n\",\n+                {\n+                    {\"blockhash\", RPCArg::Type::STR_HEX, RPCArg::Optional::NO, \"The block hash\"},\n+                    {\"nodeid\", RPCArg::Type::NUM, RPCArg::Optional::NO, \"The node ID (see getpeerinfo for node IDs)\"},\n+                },\n+                RPCResult{RPCResult::Type::ANY, \"\", \"\"},\n+                RPCExamples{\n+                    HelpExampleCli(\"getblockfrompeer\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 0\")\n+                + HelpExampleRpc(\"getblockfrompeer\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 0\")\n+                },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    const UniValue &id_arg = request.params[1];\n+    const NodeId nodeid = (NodeId) id_arg.get_int64();",
    "path": "src/rpc/blockchain.cpp",
    "position": null,
    "original_position": 93,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "91abc3760e8eff5ee30fa0b29b93754438ba16d2",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Perhaps join these two lines. No point in having a `id_arg` var that just gets used once and thrown away:\r\n\r\n```suggestion\r\n    const NodeId nodeid = static_cast<NodeId>(request.params[1].get_int64());\r\n```",
    "created_at": "2021-04-21T16:03:31Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617684847",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617684847"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617684847"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617684847/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 734,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 735,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617809637",
    "pull_request_review_id": 641437093,
    "id": 617809637,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNzgwOTYzNw==",
    "diff_hunk": "@@ -20,6 +25,71 @@\n const std::string UNIX_EPOCH_TIME = \"UNIX epoch time\";\n const std::string EXAMPLE_ADDRESS[2] = {\"bc1q09vm5lfy0j5reeulh4x5752q25uqqvz34hufdl\", \"bc1q02ad21edsxd23d32dfgqqsz4vv4nmtfzuklhy3\"};\n \n+NodeContext& EnsureAnyNodeContext(const std::any& context)\n+{\n+    auto node_context = util::AnyPtr<NodeContext>(context);\n+    if (!node_context) {\n+        throw JSONRPCError(RPC_INTERNAL_ERROR, \"Node context not found\");\n+    }\n+    return *node_context;\n+}\n+\n+CTxMemPool& EnsureMemPool(const NodeContext& node)\n+{\n+    if (!node.mempool) {\n+        throw JSONRPCError(RPC_CLIENT_MEMPOOL_DISABLED, \"Mempool disabled or instance not found\");\n+    }\n+    return *node.mempool;\n+}\n+\n+CTxMemPool& EnsureAnyMemPool(const std::any& context)\n+{\n+    return EnsureMemPool(EnsureAnyNodeContext(context));\n+}\n+\n+ChainstateManager& EnsureChainman(const NodeContext& node)\n+{\n+    if (!node.chainman) {\n+        throw JSONRPCError(RPC_INTERNAL_ERROR, \"Node chainman not found\");\n+    }\n+    WITH_LOCK(::cs_main, CHECK_NONFATAL(std::addressof(g_chainman) == std::addressof(*node.chainman)));",
    "path": "src/rpc/util.cpp",
    "position": null,
    "original_position": 50,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "065540ad54940bd5b03c4275b7ea16001b91b80b",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This causes a link failure for libbitcoin_common.\r\n\r\nPerhaps move these `Ensure*` functions to a new `src/rpc/server_util.cpp` which is part of libbitcoin_server. `src/rpc/util` is for utility functions that are shared between server and client.",
    "created_at": "2021-04-21T19:10:36Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617809637",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617809637"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617809637"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617809637/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 55,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617812676",
    "pull_request_review_id": 641441176,
    "id": 617812676,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNzgxMjY3Ng==",
    "diff_hunk": "@@ -20,6 +25,71 @@\n const std::string UNIX_EPOCH_TIME = \"UNIX epoch time\";\n const std::string EXAMPLE_ADDRESS[2] = {\"bc1q09vm5lfy0j5reeulh4x5752q25uqqvz34hufdl\", \"bc1q02ad21edsxd23d32dfgqqsz4vv4nmtfzuklhy3\"};\n \n+NodeContext& EnsureAnyNodeContext(const std::any& context)\n+{\n+    auto node_context = util::AnyPtr<NodeContext>(context);\n+    if (!node_context) {\n+        throw JSONRPCError(RPC_INTERNAL_ERROR, \"Node context not found\");\n+    }\n+    return *node_context;\n+}\n+\n+CTxMemPool& EnsureMemPool(const NodeContext& node)\n+{\n+    if (!node.mempool) {\n+        throw JSONRPCError(RPC_CLIENT_MEMPOOL_DISABLED, \"Mempool disabled or instance not found\");\n+    }\n+    return *node.mempool;\n+}\n+\n+CTxMemPool& EnsureAnyMemPool(const std::any& context)\n+{\n+    return EnsureMemPool(EnsureAnyNodeContext(context));\n+}\n+\n+ChainstateManager& EnsureChainman(const NodeContext& node)\n+{\n+    if (!node.chainman) {\n+        throw JSONRPCError(RPC_INTERNAL_ERROR, \"Node chainman not found\");\n+    }\n+    WITH_LOCK(::cs_main, CHECK_NONFATAL(std::addressof(g_chainman) == std::addressof(*node.chainman)));",
    "path": "src/rpc/util.cpp",
    "position": null,
    "original_position": 50,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "065540ad54940bd5b03c4275b7ea16001b91b80b",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I see. For some reason macOS is totally happy with it, but on Linux I can see it blow up.",
    "created_at": "2021-04-21T19:16:03Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617812676",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617812676"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617812676"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617812676/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 55,
    "side": "RIGHT",
    "in_reply_to_id": 617809637
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617840061",
    "pull_request_review_id": 641475969,
    "id": 617840061,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNzg0MDA2MQ==",
    "diff_hunk": "@@ -199,12 +199,12 @@ BITCOIN_CORE_H = \\\n   rpc/blockchain.h \\\n   rpc/client.h \\\n   rpc/mining.h \\\n-  rpc/net.h \\\n   rpc/protocol.h \\\n   rpc/rawtransaction_util.h \\\n   rpc/register.h \\\n   rpc/request.h \\\n   rpc/server.h \\\n+\trpc/server_util.h \\",
    "path": "src/Makefile.am",
    "position": null,
    "original_position": 10,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "f2208cf5d416a3c334e3d9833f41eb29e53ac5f4",
    "user": {
      "login": "prusnak",
      "id": 42201,
      "node_id": "MDQ6VXNlcjQyMjAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/42201?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prusnak",
      "html_url": "https://github.com/prusnak",
      "followers_url": "https://api.github.com/users/prusnak/followers",
      "following_url": "https://api.github.com/users/prusnak/following{/other_user}",
      "gists_url": "https://api.github.com/users/prusnak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prusnak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prusnak/subscriptions",
      "organizations_url": "https://api.github.com/users/prusnak/orgs",
      "repos_url": "https://api.github.com/users/prusnak/repos",
      "events_url": "https://api.github.com/users/prusnak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prusnak/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "use spaces, not tab",
    "created_at": "2021-04-21T20:02:50Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617840061",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617840061"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617840061"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617840061/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 207,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617840149",
    "pull_request_review_id": 641475969,
    "id": 617840149,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNzg0MDE0OQ==",
    "diff_hunk": "@@ -345,6 +345,7 @@ libbitcoin_server_a_SOURCES = \\\n   rpc/net.cpp \\\n   rpc/rawtransaction.cpp \\\n   rpc/server.cpp \\\n+\trpc/server_util.cpp \\",
    "path": "src/Makefile.am",
    "position": null,
    "original_position": 18,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "f2208cf5d416a3c334e3d9833f41eb29e53ac5f4",
    "user": {
      "login": "prusnak",
      "id": 42201,
      "node_id": "MDQ6VXNlcjQyMjAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/42201?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prusnak",
      "html_url": "https://github.com/prusnak",
      "followers_url": "https://api.github.com/users/prusnak/followers",
      "following_url": "https://api.github.com/users/prusnak/following{/other_user}",
      "gists_url": "https://api.github.com/users/prusnak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prusnak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prusnak/subscriptions",
      "organizations_url": "https://api.github.com/users/prusnak/orgs",
      "repos_url": "https://api.github.com/users/prusnak/repos",
      "events_url": "https://api.github.com/users/prusnak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prusnak/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "use spaces, not tab",
    "created_at": "2021-04-21T20:02:57Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617840149",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617840149"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617840149"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617840149/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 348,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617840256",
    "pull_request_review_id": 641475969,
    "id": 617840256,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNzg0MDI1Ng==",
    "diff_hunk": "@@ -534,7 +535,7 @@ libbitcoin_common_a_SOURCES = \\\n   psbt.cpp \\\n   rpc/rawtransaction_util.cpp \\\n   rpc/external_signer.cpp \\\n-  rpc/util.cpp \\\n+\trpc/util.cpp \\",
    "path": "src/Makefile.am",
    "position": null,
    "original_position": 27,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "f2208cf5d416a3c334e3d9833f41eb29e53ac5f4",
    "user": {
      "login": "prusnak",
      "id": 42201,
      "node_id": "MDQ6VXNlcjQyMjAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/42201?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prusnak",
      "html_url": "https://github.com/prusnak",
      "followers_url": "https://api.github.com/users/prusnak/followers",
      "following_url": "https://api.github.com/users/prusnak/following{/other_user}",
      "gists_url": "https://api.github.com/users/prusnak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prusnak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prusnak/subscriptions",
      "organizations_url": "https://api.github.com/users/prusnak/orgs",
      "repos_url": "https://api.github.com/users/prusnak/repos",
      "events_url": "https://api.github.com/users/prusnak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prusnak/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "use spaces, not tab",
    "created_at": "2021-04-21T20:03:09Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617840256",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617840256"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r617840256"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617840256/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 538,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618109487",
    "pull_request_review_id": 641812202,
    "id": 618109487,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxODEwOTQ4Nw==",
    "diff_hunk": "@@ -0,0 +1,30 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_RPC_SERVER_UTIL_H\n+#define BITCOIN_RPC_SERVER_UTIL_H\n+\n+#include <rpc/protocol.h>\n+#include <rpc/request.h>\n+\n+class CBlockPolicyEstimator;\n+class CConnman;\n+class CTxMemPool;\n+struct NodeContext;\n+class PeerManager;\n+\n+/**\n+ * Ensure* helpers\n+ */",
    "path": "src/rpc/server_util.h",
    "position": null,
    "original_position": 19,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "f2208cf5d416a3c334e3d9833f41eb29e53ac5f4",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Can remove this comment? The code is already self-documenting and one can see that all helpers in this section start with `Ensure`.",
    "created_at": "2021-04-22T06:18:33Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618109487",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618109487"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618109487"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618109487/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 19,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618283846",
    "pull_request_review_id": 642040116,
    "id": 618283846,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxODI4Mzg0Ng==",
    "diff_hunk": "@@ -1252,6 +1253,39 @@ bool PeerManagerImpl::BlockRequestAllowed(const CBlockIndex* pindex)\n            (GetBlockProofEquivalentTime(*pindexBestHeader, *pindex, *pindexBestHeader, m_chainparams.GetConsensus()) < STALE_RELAY_AGE_LIMIT);\n }\n \n+bool PeerManagerImpl::FetchBlock(NodeId id, const CBlockIndex* index)",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 12,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "7544381c2e755a418b1648a2d8b14ca1c39c5345",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "If you're taking a pointer, you should check that it's non-null before dereferencing it. Even better, pass by reference to communicate that this *must* be called with a valid `CBlockIndex`:\r\n\r\n<details>\r\n<summary>Diff</summary>\r\n\r\n```diff\r\ndiff --git a/src/net_processing.cpp b/src/net_processing.cpp\r\nindex a822960dc2..f552aa36b5 100644\r\n--- a/src/net_processing.cpp\r\n+++ b/src/net_processing.cpp\r\n@@ -246,7 +246,7 @@ public:\r\n \r\n     /** Implement PeerManager */\r\n     void CheckForStaleTipAndEvictPeers() override;\r\n-    bool FetchBlock(NodeId id, const CBlockIndex* index) override;\r\n+    bool FetchBlock(NodeId id, const CBlockIndex& index) override;\r\n     bool GetNodeStateStats(NodeId nodeid, CNodeStateStats& stats) const override;\r\n     bool IgnoresIncomingTxs() override { return m_ignore_incoming_txs; }\r\n     void SendPings() override;\r\n@@ -1253,7 +1253,7 @@ bool PeerManagerImpl::BlockRequestAllowed(const CBlockIndex* pindex)\r\n            (GetBlockProofEquivalentTime(*pindexBestHeader, *pindex, *pindexBestHeader, m_chainparams.GetConsensus()) < STALE_RELAY_AGE_LIMIT);\r\n }\r\n \r\n-bool PeerManagerImpl::FetchBlock(NodeId id, const CBlockIndex* index)\r\n+bool PeerManagerImpl::FetchBlock(NodeId id, const CBlockIndex& index)\r\n {\r\n     PeerRef peer = GetPeerRef(id);\r\n     if (peer == nullptr) return false;\r\n@@ -1263,12 +1263,12 @@ bool PeerManagerImpl::FetchBlock(NodeId id, const CBlockIndex* index)\r\n     if (state == nullptr) return false;\r\n     if (!state->fHaveWitness) return false;\r\n     const int node_sync_height = state->pindexBestKnownBlock ? state->pindexBestKnownBlock->nHeight : -1;\r\n-    if (index->nHeight > node_sync_height) {\r\n+    if (index.nHeight > node_sync_height) {\r\n         return false;\r\n     }\r\n-    std::vector<CInv> invs{CInv(MSG_BLOCK | MSG_WITNESS_FLAG, index->GetBlockHash())};\r\n+    std::vector<CInv> invs{CInv(MSG_BLOCK | MSG_WITNESS_FLAG, index.GetBlockHash())};\r\n     // Mark block as in-flight unless it already is\r\n-    if (!MarkBlockAsInFlight(id, index->GetBlockHash(), index)) return false;\r\n+    if (!MarkBlockAsInFlight(id, index.GetBlockHash(), &index)) return false;\r\n     bool success = m_connman.ForNode(id, [this, invs](CNode* pnode) {\r\n         const CNetMsgMaker msgMaker(pnode->GetCommonVersion());\r\n         this->m_connman.PushMessage(pnode, msgMaker.Make(NetMsgType::GETDATA, invs));\r\n@@ -1276,12 +1276,12 @@ bool PeerManagerImpl::FetchBlock(NodeId id, const CBlockIndex* index)\r\n     });\r\n     if (success) {\r\n         LogPrint(BCLog::NET, \"Requesting block %s from peer=%d\\n\",\r\n-                index->GetBlockHash().ToString(), id);\r\n+                index.GetBlockHash().ToString(), id);\r\n     } else {\r\n         // Remove block from in-flight\r\n-        MarkBlockAsReceived(index->GetBlockHash());\r\n+        MarkBlockAsReceived(index.GetBlockHash());\r\n         LogPrint(BCLog::NET, \"Failed to request block %s from peer=%d\\n\",\r\n-                index->GetBlockHash().ToString(), id);\r\n+                index.GetBlockHash().ToString(), id);\r\n     }\r\n     return success;\r\n }\r\ndiff --git a/src/net_processing.h b/src/net_processing.h\r\nindex 577c925562..659504397f 100644\r\n--- a/src/net_processing.h\r\n+++ b/src/net_processing.h\r\n@@ -43,7 +43,7 @@ public:\r\n     virtual ~PeerManager() { }\r\n \r\n     /** Attempt to manually fetch block from a given node. */\r\n-    virtual bool FetchBlock(const NodeId nodeid, const CBlockIndex* pindex) = 0;\r\n+    virtual bool FetchBlock(const NodeId nodeid, const CBlockIndex& pindex) = 0;\r\n \r\n     /** Get statistics from node state */\r\n     virtual bool GetNodeStateStats(NodeId nodeid, CNodeStateStats& stats) const = 0;\r\ndiff --git a/src/rpc/blockchain.cpp b/src/rpc/blockchain.cpp\r\nindex aa6b216ab1..cb3f2f3abc 100644\r\n--- a/src/rpc/blockchain.cpp\r\n+++ b/src/rpc/blockchain.cpp\r\n@@ -746,7 +746,7 @@ static RPCHelpMan getblockfrompeer()\r\n         throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Block not found\");\r\n     }\r\n \r\n-    if (!peerman.FetchBlock(nodeid, pblockindex)) {\r\n+    if (!peerman.FetchBlock(nodeid, *pblockindex)) {\r\n         throw JSONRPCError(RPC_MISC_ERROR, \"Failed to fetch block from peer\");\r\n     }\r\n     return UniValue::VOBJ;\r\n```\r\n\r\n</details>",
    "created_at": "2021-04-22T10:35:23Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618283846",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618283846"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618283846"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618283846/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1256,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618284866",
    "pull_request_review_id": 642041410,
    "id": 618284866,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxODI4NDg2Ng==",
    "diff_hunk": "@@ -1252,6 +1253,39 @@ bool PeerManagerImpl::BlockRequestAllowed(const CBlockIndex* pindex)\n            (GetBlockProofEquivalentTime(*pindexBestHeader, *pindex, *pindexBestHeader, m_chainparams.GetConsensus()) < STALE_RELAY_AGE_LIMIT);\n }\n \n+bool PeerManagerImpl::FetchBlock(NodeId id, const CBlockIndex* index)\n+{",
    "path": "src/net_processing.cpp",
    "position": 13,
    "original_position": 13,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "7544381c2e755a418b1648a2d8b14ca1c39c5345",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Consider adding some line breaks to this function to split up the units of logic. It's a bit of a wall of text right now.",
    "created_at": "2021-04-22T10:36:57Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618284866",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618284866"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618284866"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618284866/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1431,
    "original_line": 1431,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618364702",
    "pull_request_review_id": 642149407,
    "id": 618364702,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxODM2NDcwMg==",
    "diff_hunk": "@@ -1252,6 +1253,39 @@ bool PeerManagerImpl::BlockRequestAllowed(const CBlockIndex* pindex)\n            (GetBlockProofEquivalentTime(*pindexBestHeader, *pindex, *pindexBestHeader, m_chainparams.GetConsensus()) < STALE_RELAY_AGE_LIMIT);\n }\n \n+bool PeerManagerImpl::FetchBlock(NodeId id, const CBlockIndex* index)\n+{",
    "path": "src/net_processing.cpp",
    "position": 13,
    "original_position": 13,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "7544381c2e755a418b1648a2d8b14ca1c39c5345",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I added some line breaks and prose.",
    "created_at": "2021-04-22T12:42:12Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618364702",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618364702"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618364702"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618364702/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1431,
    "original_line": 1431,
    "side": "RIGHT",
    "in_reply_to_id": 618284866
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618443929",
    "pull_request_review_id": 642260079,
    "id": 618443929,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxODQ0MzkyOQ==",
    "diff_hunk": "@@ -1252,6 +1253,47 @@ bool PeerManagerImpl::BlockRequestAllowed(const CBlockIndex* pindex)\n            (GetBlockProofEquivalentTime(*pindexBestHeader, *pindex, *pindexBestHeader, m_chainparams.GetConsensus()) < STALE_RELAY_AGE_LIMIT);\n }\n \n+bool PeerManagerImpl::FetchBlock(NodeId id, const CBlockIndex& index)\n+{\n+    PeerRef peer = GetPeerRef(id);\n+    if (peer == nullptr) return false;",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 15,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "c8df3f32386e677ef7b84882d398a6f6c3ea348a",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "`peer` isn't used. You can remove it.",
    "created_at": "2021-04-22T14:17:16Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618443929",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618443929"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618443929"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618443929/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 1258,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 1264,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618445093",
    "pull_request_review_id": 642260079,
    "id": 618445093,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxODQ0NTA5Mw==",
    "diff_hunk": "@@ -1252,6 +1253,47 @@ bool PeerManagerImpl::BlockRequestAllowed(const CBlockIndex* pindex)\n            (GetBlockProofEquivalentTime(*pindexBestHeader, *pindex, *pindexBestHeader, m_chainparams.GetConsensus()) < STALE_RELAY_AGE_LIMIT);\n }\n \n+bool PeerManagerImpl::FetchBlock(NodeId id, const CBlockIndex& index)\n+{\n+    PeerRef peer = GetPeerRef(id);\n+    if (peer == nullptr) return false;\n+    if (fImporting && !fReindex) return false;",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 16,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "c8df3f32386e677ef7b84882d398a6f6c3ea348a",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Why not match the logic in `ProcessMessage()` when receiving a block:\r\n\r\n```suggestion\r\n    if (fImporting || fReindex) return false;\r\n```",
    "created_at": "2021-04-22T14:18:33Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618445093",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618445093"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618445093"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618445093/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1260,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618452192",
    "pull_request_review_id": 642260079,
    "id": 618452192,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxODQ1MjE5Mg==",
    "diff_hunk": "@@ -42,6 +42,9 @@ class PeerManager : public CValidationInterface, public NetEventsInterface\n                                              CTxMemPool& pool, bool ignore_incoming_txs);\n     virtual ~PeerManager() { }\n \n+    /** Attempt to manually fetch block from a given node. */\n+    virtual bool FetchBlock(const NodeId nodeid, const CBlockIndex& pindex) = 0;",
    "path": "src/net_processing.h",
    "position": null,
    "original_position": 5,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "c8df3f32386e677ef7b84882d398a6f6c3ea348a",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Remove `const` from the pass-by-value argument:\r\n\r\n```suggestion\r\n    virtual bool FetchBlock(NodeId nodeid, const CBlockIndex& pindex) = 0;\r\n```",
    "created_at": "2021-04-22T14:26:16Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618452192",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618452192"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618452192"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618452192/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 46,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618464212",
    "pull_request_review_id": 642260079,
    "id": 618464212,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxODQ2NDIxMg==",
    "diff_hunk": "@@ -1252,6 +1253,47 @@ bool PeerManagerImpl::BlockRequestAllowed(const CBlockIndex* pindex)\n            (GetBlockProofEquivalentTime(*pindexBestHeader, *pindex, *pindexBestHeader, m_chainparams.GetConsensus()) < STALE_RELAY_AGE_LIMIT);\n }\n \n+bool PeerManagerImpl::FetchBlock(NodeId id, const CBlockIndex& index)\n+{\n+    PeerRef peer = GetPeerRef(id);\n+    if (peer == nullptr) return false;\n+    if (fImporting && !fReindex) return false;\n+\n+    // Ignore pre-segwit peers\n+    LOCK(cs_main);\n+    CNodeState* state = State(id);\n+    if (state == nullptr) return false;\n+    if (!state->fHaveWitness) return false;\n+\n+    // Ensure the peer has blocks at the height we need\n+    const int node_sync_height = state->pindexBestKnownBlock ? state->pindexBestKnownBlock->nHeight : -1;\n+    if (index.nHeight > node_sync_height) return false;\n+\n+    // Construct message to request the block\n+    std::vector<CInv> invs{CInv(MSG_BLOCK | MSG_WITNESS_FLAG, index.GetBlockHash())};\n+\n+    // Mark block as in-flight unless it already is\n+    if (!MarkBlockAsInFlight(id, index.GetBlockHash(), &index)) return false;\n+\n+    // Send block request message to the peer\n+    bool success = m_connman.ForNode(id, [this, invs](CNode* pnode) {",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 35,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "c8df3f32386e677ef7b84882d398a6f6c3ea348a",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Prefer to capture `invs` by reference than making a copy:\r\n\r\n```suggestion\r\n    bool success = m_connman.ForNode(id, [this, &invs](CNode* pnode) {\r\n```\r\n\r\nAlso maybe rename pnode to node if you're touching this part again.",
    "created_at": "2021-04-22T14:39:42Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618464212",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618464212"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618464212"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618464212/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1279,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618464833",
    "pull_request_review_id": 642260079,
    "id": 618464833,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxODQ2NDgzMw==",
    "diff_hunk": "@@ -0,0 +1,58 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test the getblockfrompeer RPC.\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_raises_rpc_error,\n+)\n+\n+import time",
    "path": "test/functional/rpc_getblockfrompeer.py",
    "position": null,
    "original_position": 13,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "c8df3f32386e677ef7b84882d398a6f6c3ea348a",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Import standard library modules first, then local modules.",
    "created_at": "2021-04-22T14:40:26Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618464833",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618464833"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618464833"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618464833/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 13,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618465902",
    "pull_request_review_id": 642260079,
    "id": 618465902,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxODQ2NTkwMg==",
    "diff_hunk": "@@ -0,0 +1,58 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test the getblockfrompeer RPC.\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_raises_rpc_error,\n+)\n+\n+import time\n+\n+\n+class GetBlockFromPeerTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def run_test(self):\n+        self.log.info(\"Mine 4 blocks on Node 0\")\n+        self.nodes[0].generatetoaddress(4, self.nodes[0].get_deterministic_priv_key().address)",
    "path": "test/functional/rpc_getblockfrompeer.py",
    "position": null,
    "original_position": 25,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "c8df3f32386e677ef7b84882d398a6f6c3ea348a",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\n        self.nodes[0].generate(4)\r\n```\r\n\r\nSame below.",
    "created_at": "2021-04-22T14:41:40Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618465902",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618465902"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618465902"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618465902/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 25,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618468253",
    "pull_request_review_id": 642260079,
    "id": 618468253,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxODQ2ODI1Mw==",
    "diff_hunk": "@@ -0,0 +1,58 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test the getblockfrompeer RPC.\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_raises_rpc_error,\n+)\n+\n+import time\n+\n+\n+class GetBlockFromPeerTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def run_test(self):\n+        self.log.info(\"Mine 4 blocks on Node 0\")\n+        self.nodes[0].generatetoaddress(4, self.nodes[0].get_deterministic_priv_key().address)\n+        assert_equal(self.nodes[0].getblockcount(), 204)\n+\n+        self.log.info(\"Mine competing 3 blocks on Node 1\")\n+        self.nodes[1].generatetoaddress(3, self.nodes[1].get_deterministic_priv_key().address)\n+        assert_equal(self.nodes[1].getblockcount(), 203)\n+        short_tip = self.nodes[1].getbestblockhash()\n+\n+        self.log.info(\"Connect nodes to sync headers\")\n+        self.connect_nodes(0, 1)\n+        self.sync_blocks(self.nodes[0:2])",
    "path": "test/functional/rpc_getblockfrompeer.py",
    "position": null,
    "original_position": 35,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "c8df3f32386e677ef7b84882d398a6f6c3ea348a",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\n        self.sync_blocks()\r\n```",
    "created_at": "2021-04-22T14:44:21Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618468253",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618468253"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618468253"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618468253/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 35,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618469828",
    "pull_request_review_id": 642260079,
    "id": 618469828,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxODQ2OTgyOA==",
    "diff_hunk": "@@ -0,0 +1,58 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test the getblockfrompeer RPC.\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_raises_rpc_error,\n+)\n+\n+import time\n+\n+\n+class GetBlockFromPeerTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def run_test(self):\n+        self.log.info(\"Mine 4 blocks on Node 0\")\n+        self.nodes[0].generatetoaddress(4, self.nodes[0].get_deterministic_priv_key().address)\n+        assert_equal(self.nodes[0].getblockcount(), 204)\n+\n+        self.log.info(\"Mine competing 3 blocks on Node 1\")\n+        self.nodes[1].generatetoaddress(3, self.nodes[1].get_deterministic_priv_key().address)\n+        assert_equal(self.nodes[1].getblockcount(), 203)\n+        short_tip = self.nodes[1].getbestblockhash()\n+\n+        self.log.info(\"Connect nodes to sync headers\")\n+        self.connect_nodes(0, 1)\n+        self.sync_blocks(self.nodes[0:2])\n+\n+        self.log.info(\"Node 0 should only have the header for node 1's block 3\")\n+        short_tip_synced = False\n+        for x in self.nodes[0].getchaintips():\n+            if x['hash'] == short_tip:\n+                assert_equal(x['status'], \"headers-only\")\n+                short_tip_synced = True\n+        assert short_tip_synced\n+        assert_raises_rpc_error(-1, \"Block not found on disk\", self.nodes[0].getblock, short_tip)\n+\n+        self.log.info(\"Fetch block from node 1\")\n+        peers = self.nodes[0].getpeerinfo()\n+        assert_equal(len(peers), 1)\n+        peer_0_peer_1_id = peers[0][\"id\"]\n+        self.nodes[0].getblockfrompeer(short_tip, peer_0_peer_1_id)\n+        time.sleep(1)\n+        self.nodes[0].getblock(short_tip)",
    "path": "test/functional/rpc_getblockfrompeer.py",
    "position": null,
    "original_position": 52,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "c8df3f32386e677ef7b84882d398a6f6c3ea348a",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Perhaps poll with `wait_until` rather than a sleep (sleep will take needlessly long on a fast system and may time out on a slow system).",
    "created_at": "2021-04-22T14:46:07Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618469828",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618469828"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618469828"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618469828/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 51,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 52,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618470758",
    "pull_request_review_id": 642260079,
    "id": 618470758,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxODQ3MDc1OA==",
    "diff_hunk": "@@ -1252,6 +1253,47 @@ bool PeerManagerImpl::BlockRequestAllowed(const CBlockIndex* pindex)\n            (GetBlockProofEquivalentTime(*pindexBestHeader, *pindex, *pindexBestHeader, m_chainparams.GetConsensus()) < STALE_RELAY_AGE_LIMIT);\n }\n \n+bool PeerManagerImpl::FetchBlock(NodeId id, const CBlockIndex& index)\n+{\n+    PeerRef peer = GetPeerRef(id);\n+    if (peer == nullptr) return false;\n+    if (fImporting && !fReindex) return false;\n+\n+    // Ignore pre-segwit peers\n+    LOCK(cs_main);\n+    CNodeState* state = State(id);\n+    if (state == nullptr) return false;\n+    if (!state->fHaveWitness) return false;\n+\n+    // Ensure the peer has blocks at the height we need\n+    const int node_sync_height = state->pindexBestKnownBlock ? state->pindexBestKnownBlock->nHeight : -1;\n+    if (index.nHeight > node_sync_height) return false;\n+\n+    // Construct message to request the block\n+    std::vector<CInv> invs{CInv(MSG_BLOCK | MSG_WITNESS_FLAG, index.GetBlockHash())};\n+\n+    // Mark block as in-flight unless it already is\n+    if (!MarkBlockAsInFlight(id, index.GetBlockHash(), &index)) return false;\n+\n+    // Send block request message to the peer\n+    bool success = m_connman.ForNode(id, [this, invs](CNode* pnode) {\n+        const CNetMsgMaker msgMaker(pnode->GetCommonVersion());\n+        this->m_connman.PushMessage(pnode, msgMaker.Make(NetMsgType::GETDATA, invs));\n+        return true;\n+    });\n+\n+    if (success) {\n+        LogPrint(BCLog::NET, \"Requesting block %s from peer=%d\\n\",\n+                index.GetBlockHash().ToString(), id);",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 43,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "c8df3f32386e677ef7b84882d398a6f6c3ea348a",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\n                 index.GetBlockHash().ToString(), id);\r\n```",
    "created_at": "2021-04-22T14:47:07Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618470758",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618470758"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618470758"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618470758/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1287,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618470858",
    "pull_request_review_id": 642260079,
    "id": 618470858,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxODQ3MDg1OA==",
    "diff_hunk": "@@ -1252,6 +1253,47 @@ bool PeerManagerImpl::BlockRequestAllowed(const CBlockIndex* pindex)\n            (GetBlockProofEquivalentTime(*pindexBestHeader, *pindex, *pindexBestHeader, m_chainparams.GetConsensus()) < STALE_RELAY_AGE_LIMIT);\n }\n \n+bool PeerManagerImpl::FetchBlock(NodeId id, const CBlockIndex& index)\n+{\n+    PeerRef peer = GetPeerRef(id);\n+    if (peer == nullptr) return false;\n+    if (fImporting && !fReindex) return false;\n+\n+    // Ignore pre-segwit peers\n+    LOCK(cs_main);\n+    CNodeState* state = State(id);\n+    if (state == nullptr) return false;\n+    if (!state->fHaveWitness) return false;\n+\n+    // Ensure the peer has blocks at the height we need\n+    const int node_sync_height = state->pindexBestKnownBlock ? state->pindexBestKnownBlock->nHeight : -1;\n+    if (index.nHeight > node_sync_height) return false;\n+\n+    // Construct message to request the block\n+    std::vector<CInv> invs{CInv(MSG_BLOCK | MSG_WITNESS_FLAG, index.GetBlockHash())};\n+\n+    // Mark block as in-flight unless it already is\n+    if (!MarkBlockAsInFlight(id, index.GetBlockHash(), &index)) return false;\n+\n+    // Send block request message to the peer\n+    bool success = m_connman.ForNode(id, [this, invs](CNode* pnode) {\n+        const CNetMsgMaker msgMaker(pnode->GetCommonVersion());\n+        this->m_connman.PushMessage(pnode, msgMaker.Make(NetMsgType::GETDATA, invs));\n+        return true;\n+    });\n+\n+    if (success) {\n+        LogPrint(BCLog::NET, \"Requesting block %s from peer=%d\\n\",\n+                index.GetBlockHash().ToString(), id);\n+    } else {\n+        // Remove block from in-flight\n+        MarkBlockAsReceived(index.GetBlockHash());\n+        LogPrint(BCLog::NET, \"Failed to request block %s from peer=%d\\n\",\n+                index.GetBlockHash().ToString(), id);",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 48,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "c8df3f32386e677ef7b84882d398a6f6c3ea348a",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\n                 index.GetBlockHash().ToString(), id);\r\n```",
    "created_at": "2021-04-22T14:47:14Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618470858",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618470858"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618470858"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618470858/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1292,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618649847",
    "pull_request_review_id": 642551234,
    "id": 618649847,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxODY0OTg0Nw==",
    "diff_hunk": "@@ -1252,6 +1253,47 @@ bool PeerManagerImpl::BlockRequestAllowed(const CBlockIndex* pindex)\n            (GetBlockProofEquivalentTime(*pindexBestHeader, *pindex, *pindexBestHeader, m_chainparams.GetConsensus()) < STALE_RELAY_AGE_LIMIT);\n }\n \n+bool PeerManagerImpl::FetchBlock(NodeId id, const CBlockIndex& index)\n+{\n+    PeerRef peer = GetPeerRef(id);\n+    if (peer == nullptr) return false;\n+    if (fImporting && !fReindex) return false;",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 16,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "c8df3f32386e677ef7b84882d398a6f6c3ea348a",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think I copied this one from another method. But fewer negations make sense.",
    "created_at": "2021-04-22T18:37:53Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618649847",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618649847"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618649847"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618649847/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1260,
    "side": "RIGHT",
    "in_reply_to_id": 618445093
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618652918",
    "pull_request_review_id": 642555182,
    "id": 618652918,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxODY1MjkxOA==",
    "diff_hunk": "@@ -1252,6 +1253,47 @@ bool PeerManagerImpl::BlockRequestAllowed(const CBlockIndex* pindex)\n            (GetBlockProofEquivalentTime(*pindexBestHeader, *pindex, *pindexBestHeader, m_chainparams.GetConsensus()) < STALE_RELAY_AGE_LIMIT);\n }\n \n+bool PeerManagerImpl::FetchBlock(NodeId id, const CBlockIndex& index)\n+{\n+    PeerRef peer = GetPeerRef(id);\n+    if (peer == nullptr) return false;",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 15,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "c8df3f32386e677ef7b84882d398a6f6c3ea348a",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This is the only place where we check that this peer actually exists (i.e. wasn't disconnected). I'll add a comment.",
    "created_at": "2021-04-22T18:42:39Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618652918",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618652918"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618652918"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618652918/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 1258,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 1264,
    "side": "RIGHT",
    "in_reply_to_id": 618443929
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618670004",
    "pull_request_review_id": 642576966,
    "id": 618670004,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxODY3MDAwNA==",
    "diff_hunk": "@@ -0,0 +1,58 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test the getblockfrompeer RPC.\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_raises_rpc_error,\n+)\n+\n+import time\n+\n+\n+class GetBlockFromPeerTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def run_test(self):\n+        self.log.info(\"Mine 4 blocks on Node 0\")\n+        self.nodes[0].generatetoaddress(4, self.nodes[0].get_deterministic_priv_key().address)\n+        assert_equal(self.nodes[0].getblockcount(), 204)\n+\n+        self.log.info(\"Mine competing 3 blocks on Node 1\")\n+        self.nodes[1].generatetoaddress(3, self.nodes[1].get_deterministic_priv_key().address)\n+        assert_equal(self.nodes[1].getblockcount(), 203)\n+        short_tip = self.nodes[1].getbestblockhash()\n+\n+        self.log.info(\"Connect nodes to sync headers\")\n+        self.connect_nodes(0, 1)\n+        self.sync_blocks(self.nodes[0:2])\n+\n+        self.log.info(\"Node 0 should only have the header for node 1's block 3\")\n+        short_tip_synced = False\n+        for x in self.nodes[0].getchaintips():\n+            if x['hash'] == short_tip:\n+                assert_equal(x['status'], \"headers-only\")\n+                short_tip_synced = True\n+        assert short_tip_synced\n+        assert_raises_rpc_error(-1, \"Block not found on disk\", self.nodes[0].getblock, short_tip)\n+\n+        self.log.info(\"Fetch block from node 1\")\n+        peers = self.nodes[0].getpeerinfo()\n+        assert_equal(len(peers), 1)\n+        peer_0_peer_1_id = peers[0][\"id\"]\n+        self.nodes[0].getblockfrompeer(short_tip, peer_0_peer_1_id)\n+        time.sleep(1)\n+        self.nodes[0].getblock(short_tip)",
    "path": "test/functional/rpc_getblockfrompeer.py",
    "position": null,
    "original_position": 52,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "c8df3f32386e677ef7b84882d398a6f6c3ea348a",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done, though it's rather involved afaik there's no one-liner to say \"True if x doesn't throw\"",
    "created_at": "2021-04-22T19:09:31Z",
    "updated_at": "2021-04-30T17:07:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618670004",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618670004"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r618670004"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/618670004/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 51,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 52,
    "side": "RIGHT",
    "in_reply_to_id": 618469828
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631787712",
    "pull_request_review_id": 658871950,
    "id": 631787712,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMTc4NzcxMg==",
    "diff_hunk": "@@ -0,0 +1,62 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test the getblockfrompeer RPC.\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.authproxy import JSONRPCException",
    "path": "test/functional/rpc_getblockfrompeer.py",
    "position": null,
    "original_position": 8,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "73c49b6d836dec448c219468fc6b392b0be807d7",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "sort",
    "created_at": "2021-05-13T12:54:44Z",
    "updated_at": "2021-05-13T13:10:47Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r631787712",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631787712"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r631787712"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631787712/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 7,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 7,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631796608",
    "pull_request_review_id": 658871950,
    "id": 631796608,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMTc5NjYwOA==",
    "diff_hunk": "@@ -792,6 +745,43 @@ static RPCHelpMan getmempoolentry()\n     };\n }\n \n+static RPCHelpMan getblockfrompeer()\n+{\n+    return RPCHelpMan{\"getblockfrompeer\",\n+                \"\\nAttempt to fetch block from a given peer.\\n\",",
    "path": "src/rpc/blockchain.cpp",
    "position": null,
    "original_position": 88,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "73c49b6d836dec448c219468fc6b392b0be807d7",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Perhaps document that this node must already have the block header in order to fetch the block (or relax that requirement?)",
    "created_at": "2021-05-13T13:09:11Z",
    "updated_at": "2021-05-13T13:10:47Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r631796608",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631796608"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r631796608"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631796608/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 755,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631797759",
    "pull_request_review_id": 658871950,
    "id": 631797759,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMTc5Nzc1OQ==",
    "diff_hunk": "@@ -0,0 +1,58 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test the getblockfrompeer RPC.\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_raises_rpc_error,\n+)\n+\n+import time\n+\n+\n+class GetBlockFromPeerTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def run_test(self):\n+        self.log.info(\"Mine 4 blocks on Node 0\")\n+        self.nodes[0].generatetoaddress(4, self.nodes[0].get_deterministic_priv_key().address)\n+        assert_equal(self.nodes[0].getblockcount(), 204)\n+\n+        self.log.info(\"Mine competing 3 blocks on Node 1\")\n+        self.nodes[1].generatetoaddress(3, self.nodes[1].get_deterministic_priv_key().address)\n+        assert_equal(self.nodes[1].getblockcount(), 203)\n+        short_tip = self.nodes[1].getbestblockhash()\n+\n+        self.log.info(\"Connect nodes to sync headers\")\n+        self.connect_nodes(0, 1)\n+        self.sync_blocks(self.nodes[0:2])\n+\n+        self.log.info(\"Node 0 should only have the header for node 1's block 3\")\n+        short_tip_synced = False\n+        for x in self.nodes[0].getchaintips():\n+            if x['hash'] == short_tip:\n+                assert_equal(x['status'], \"headers-only\")\n+                short_tip_synced = True\n+        assert short_tip_synced\n+        assert_raises_rpc_error(-1, \"Block not found on disk\", self.nodes[0].getblock, short_tip)\n+\n+        self.log.info(\"Fetch block from node 1\")\n+        peers = self.nodes[0].getpeerinfo()\n+        assert_equal(len(peers), 1)\n+        peer_0_peer_1_id = peers[0][\"id\"]\n+        self.nodes[0].getblockfrompeer(short_tip, peer_0_peer_1_id)\n+        time.sleep(1)\n+        self.nodes[0].getblock(short_tip)",
    "path": "test/functional/rpc_getblockfrompeer.py",
    "position": null,
    "original_position": 52,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "c8df3f32386e677ef7b84882d398a6f6c3ea348a",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Change looks good. Thanks!",
    "created_at": "2021-05-13T13:10:47Z",
    "updated_at": "2021-05-13T13:10:47Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r631797759",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631797759"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r631797759"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631797759/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 51,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 52,
    "side": "RIGHT",
    "in_reply_to_id": 618469828
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631799792",
    "pull_request_review_id": 658888346,
    "id": 631799792,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMTc5OTc5Mg==",
    "diff_hunk": "@@ -1252,6 +1253,47 @@ bool PeerManagerImpl::BlockRequestAllowed(const CBlockIndex* pindex)\n            (GetBlockProofEquivalentTime(*pindexBestHeader, *pindex, *pindexBestHeader, m_chainparams.GetConsensus()) < STALE_RELAY_AGE_LIMIT);\n }\n \n+bool PeerManagerImpl::FetchBlock(NodeId id, const CBlockIndex& index)\n+{\n+    PeerRef peer = GetPeerRef(id);\n+    if (peer == nullptr) return false;",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 15,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "c8df3f32386e677ef7b84882d398a6f6c3ea348a",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Actually, you check below that a `CNodeState` exists, which can only happen if the peer isn't disconnected, which makes this check redundant.",
    "created_at": "2021-05-13T13:14:02Z",
    "updated_at": "2021-05-13T13:14:03Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r631799792",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631799792"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r631799792"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631799792/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 1258,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 1264,
    "side": "RIGHT",
    "in_reply_to_id": 618443929
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631817337",
    "pull_request_review_id": 658912388,
    "id": 631817337,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMTgxNzMzNw==",
    "diff_hunk": "@@ -792,6 +745,43 @@ static RPCHelpMan getmempoolentry()\n     };\n }\n \n+static RPCHelpMan getblockfrompeer()\n+{\n+    return RPCHelpMan{\"getblockfrompeer\",\n+                \"\\nAttempt to fetch block from a given peer.\\n\",",
    "path": "src/rpc/blockchain.cpp",
    "position": null,
    "original_position": 88,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "73c49b6d836dec448c219468fc6b392b0be807d7",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "By \"this node\" you mean the node itself? What happens when you fetch a block that you don't have the header for?",
    "created_at": "2021-05-13T13:39:57Z",
    "updated_at": "2021-05-13T13:39:57Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r631817337",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631817337"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r631817337"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631817337/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 755,
    "side": "RIGHT",
    "in_reply_to_id": 631796608
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631820873",
    "pull_request_review_id": 658917211,
    "id": 631820873,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMTgyMDg3Mw==",
    "diff_hunk": "@@ -792,6 +745,43 @@ static RPCHelpMan getmempoolentry()\n     };\n }\n \n+static RPCHelpMan getblockfrompeer()\n+{\n+    return RPCHelpMan{\"getblockfrompeer\",\n+                \"\\nAttempt to fetch block from a given peer.\\n\",",
    "path": "src/rpc/blockchain.cpp",
    "position": null,
    "original_position": 88,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "73c49b6d836dec448c219468fc6b392b0be807d7",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I see `MarkBlockAsInFlight` can handle a `nullprtr` index. It might indeed be simpler to drop this requirement, as well as the `index.nHeight > node_sync_height` check.",
    "created_at": "2021-05-13T13:44:58Z",
    "updated_at": "2021-05-13T13:45:04Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r631820873",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631820873"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r631820873"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631820873/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 755,
    "side": "RIGHT",
    "in_reply_to_id": 631796608
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631826325",
    "pull_request_review_id": 658924794,
    "id": 631826325,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMTgyNjMyNQ==",
    "diff_hunk": "@@ -1252,6 +1253,47 @@ bool PeerManagerImpl::BlockRequestAllowed(const CBlockIndex* pindex)\n            (GetBlockProofEquivalentTime(*pindexBestHeader, *pindex, *pindexBestHeader, m_chainparams.GetConsensus()) < STALE_RELAY_AGE_LIMIT);\n }\n \n+bool PeerManagerImpl::FetchBlock(NodeId id, const CBlockIndex& index)\n+{\n+    PeerRef peer = GetPeerRef(id);\n+    if (peer == nullptr) return false;",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 15,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "c8df3f32386e677ef7b84882d398a6f6c3ea348a",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Ok, I'll remove it then.",
    "created_at": "2021-05-13T13:52:33Z",
    "updated_at": "2021-05-13T13:52:34Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r631826325",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631826325"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r631826325"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631826325/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 1258,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 1264,
    "side": "RIGHT",
    "in_reply_to_id": 618443929
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631845232",
    "pull_request_review_id": 658951770,
    "id": 631845232,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMTg0NTIzMg==",
    "diff_hunk": "@@ -792,6 +745,43 @@ static RPCHelpMan getmempoolentry()\n     };\n }\n \n+static RPCHelpMan getblockfrompeer()\n+{\n+    return RPCHelpMan{\"getblockfrompeer\",\n+                \"\\nAttempt to fetch block from a given peer.\\n\",",
    "path": "src/rpc/blockchain.cpp",
    "position": null,
    "original_position": 88,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "73c49b6d836dec448c219468fc6b392b0be807d7",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Sorry, yes I meant \"we\" as \"this node\" (the node that you're running this command on)",
    "created_at": "2021-05-13T14:19:07Z",
    "updated_at": "2021-05-13T14:19:07Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r631845232",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631845232"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r631845232"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631845232/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 755,
    "side": "RIGHT",
    "in_reply_to_id": 631796608
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631850675",
    "pull_request_review_id": 658959454,
    "id": 631850675,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMTg1MDY3NQ==",
    "diff_hunk": "@@ -247,6 +247,7 @@ class PeerManagerImpl final : public PeerManager\n \n     /** Implement PeerManager */\n     void CheckForStaleTipAndEvictPeers() override;\n+    bool FetchBlock(NodeId id, uint256 hash, const CBlockIndex* index) override;",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "803d2f568f7f24557543f61bf9d5a73952caedb5",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Consider passing `uint256` by const reference (to avoid unnecessary copying, generally only basic types should be passed by value).",
    "created_at": "2021-05-13T14:26:31Z",
    "updated_at": "2021-05-13T14:28:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r631850675",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631850675"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r631850675"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631850675/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 250,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631852281",
    "pull_request_review_id": 658959454,
    "id": 631852281,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMTg1MjI4MQ==",
    "diff_hunk": "@@ -247,6 +247,7 @@ class PeerManagerImpl final : public PeerManager\n \n     /** Implement PeerManager */\n     void CheckForStaleTipAndEvictPeers() override;\n+    bool FetchBlock(NodeId id, uint256 hash, const CBlockIndex* index) override;",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "803d2f568f7f24557543f61bf9d5a73952caedb5",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Maybe document that `index` may be null here?",
    "created_at": "2021-05-13T14:28:35Z",
    "updated_at": "2021-05-13T14:28:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r631852281",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631852281"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r631852281"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631852281/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 250,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631955833",
    "pull_request_review_id": 659102663,
    "id": 631955833,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMTk1NTgzMw==",
    "diff_hunk": "@@ -247,6 +247,7 @@ class PeerManagerImpl final : public PeerManager\n \n     /** Implement PeerManager */\n     void CheckForStaleTipAndEvictPeers() override;\n+    bool FetchBlock(NodeId id, uint256 hash, const CBlockIndex* index) override;",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "803d2f568f7f24557543f61bf9d5a73952caedb5",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Added function documentation.",
    "created_at": "2021-05-13T16:52:40Z",
    "updated_at": "2021-05-13T16:52:41Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r631955833",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631955833"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r631955833"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631955833/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 250,
    "side": "RIGHT",
    "in_reply_to_id": 631852281
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686938856",
    "pull_request_review_id": 727630680,
    "id": 686938856,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NjkzODg1Ng==",
    "diff_hunk": "@@ -795,6 +749,39 @@ static RPCHelpMan getmempoolentry()\n     };\n }\n \n+static RPCHelpMan getblockfrompeer()\n+{\n+    return RPCHelpMan{\"getblockfrompeer\",\n+                \"\\nAttempt to fetch block from a given peer.\\n\",\n+                {\n+                    {\"blockhash\", RPCArg::Type::STR_HEX, RPCArg::Optional::NO, \"The block hash\"},\n+                    {\"nodeid\", RPCArg::Type::NUM, RPCArg::Optional::NO, \"The node ID (see getpeerinfo for node IDs)\"},\n+                },\n+                RPCResult{RPCResult::Type::ANY, \"\", \"\"},\n+                RPCExamples{\n+                    HelpExampleCli(\"getblockfrompeer\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 0\")\n+                + HelpExampleRpc(\"getblockfrompeer\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 0\")\n+                },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    const NodeContext& node = EnsureAnyNodeContext(request.context);\n+    ChainstateManager& chainman = EnsureChainman(node);\n+    PeerManager& peerman = EnsurePeerman(node);\n+\n+    uint256 hash(ParseHashV(request.params[0], \"hash\"));\n+\n+    const NodeId nodeid = static_cast<NodeId>(request.params[1].get_int64());\n+\n+    const CBlockIndex* const pblockindex = WITH_LOCK(cs_main, return chainman.m_blockman.LookupBlockIndex(hash););",
    "path": "src/rpc/blockchain.cpp",
    "position": null,
    "original_position": 107,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "30e2ba6c4cef9248c53542faeb8ec768079fc5fb",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\n    const CBlockIndex* const index = WITH_LOCK(cs_main, return chainman.m_blockman.LookupBlockIndex(hash););\r\n```\r\n\r\n(we no longer use hungarian notation to show what type the variable is)",
    "created_at": "2021-08-11T15:25:28Z",
    "updated_at": "2021-08-11T15:31:46Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r686938856",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686938856"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r686938856"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686938856/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 775,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686972430",
    "pull_request_review_id": 727674987,
    "id": 686972430,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4Njk3MjQzMA==",
    "diff_hunk": "@@ -747,6 +749,39 @@ static RPCHelpMan getmempoolentry()\n     };\n }\n \n+static RPCHelpMan getblockfrompeer()\n+{\n+    return RPCHelpMan{\"getblockfrompeer\",\n+                \"\\nAttempt to fetch block from a given peer.\\n\",\n+                {\n+                    {\"blockhash\", RPCArg::Type::STR_HEX, RPCArg::Optional::NO, \"The block hash\"},\n+                    {\"nodeid\", RPCArg::Type::NUM, RPCArg::Optional::NO, \"The node ID (see getpeerinfo for node IDs)\"},\n+                },\n+                RPCResult{RPCResult::Type::ANY, \"\", \"\"},\n+                RPCExamples{\n+                    HelpExampleCli(\"getblockfrompeer\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 0\")\n+                + HelpExampleRpc(\"getblockfrompeer\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 0\")\n+                },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    const NodeContext& node = EnsureAnyNodeContext(request.context);\n+    ChainstateManager& chainman = EnsureChainman(node);\n+    PeerManager& peerman = EnsurePeerman(node);\n+\n+    uint256 hash(ParseHashV(request.params[0], \"hash\"));\n+\n+    const NodeId nodeid = static_cast<NodeId>(request.params[1].get_int64());\n+\n+    const CBlockIndex* const pblockindex = WITH_LOCK(cs_main, return chainman.m_blockman.LookupBlockIndex(hash););\n+\n+    if (!peerman.FetchBlock(nodeid, hash, pblockindex)) {\n+        throw JSONRPCError(RPC_MISC_ERROR, \"Failed to fetch block from peer\");\n+    }\n+    return UniValue::VOBJ;",
    "path": "src/rpc/blockchain.cpp",
    "position": null,
    "original_position": 41,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "30e2ba6c4cef9248c53542faeb8ec768079fc5fb",
    "user": {
      "login": "LarryRuane",
      "id": 8321330,
      "node_id": "MDQ6VXNlcjgzMjEzMzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8321330?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/LarryRuane",
      "html_url": "https://github.com/LarryRuane",
      "followers_url": "https://api.github.com/users/LarryRuane/followers",
      "following_url": "https://api.github.com/users/LarryRuane/following{/other_user}",
      "gists_url": "https://api.github.com/users/LarryRuane/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LarryRuane/subscriptions",
      "organizations_url": "https://api.github.com/users/LarryRuane/orgs",
      "repos_url": "https://api.github.com/users/LarryRuane/repos",
      "events_url": "https://api.github.com/users/LarryRuane/events{/privacy}",
      "received_events_url": "https://api.github.com/users/LarryRuane/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Why do we not return `NullUniValue` here? Returning `UniValue::VOBJ` causes `bitcoin-cli` to print empty JSON object; returning `NullUniValue` would print nothing (as many other RPCs do). Is it to make this more backward-compatible if we later make it return something, like the block?",
    "created_at": "2021-08-11T16:04:35Z",
    "updated_at": "2021-08-11T16:56:28Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r686972430",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686972430"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r686972430"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686972430/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 786,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686993091",
    "pull_request_review_id": 727674987,
    "id": 686993091,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4Njk5MzA5MQ==",
    "diff_hunk": "@@ -0,0 +1,62 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test the getblockfrompeer RPC.\"\"\"\n+\n+from test_framework.authproxy import JSONRPCException\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_raises_rpc_error,\n+)\n+\n+class GetBlockFromPeerTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def check_for_block(self, hash):\n+        try:\n+            self.nodes[0].getblock(hash)\n+            return True\n+        except JSONRPCException:\n+            return False\n+\n+    def run_test(self):\n+        self.log.info(\"Mine 4 blocks on Node 0\")\n+        self.nodes[0].generate(4)\n+        assert_equal(self.nodes[0].getblockcount(), 204)\n+\n+        self.log.info(\"Mine competing 3 blocks on Node 1\")\n+        self.nodes[1].generate(3)\n+        assert_equal(self.nodes[1].getblockcount(), 203)\n+        short_tip = self.nodes[1].getbestblockhash()\n+\n+        self.log.info(\"Connect nodes to sync headers\")\n+        self.connect_nodes(0, 1)\n+        self.sync_blocks()\n+\n+        self.log.info(\"Node 0 should only have the header for node 1's block 3\")\n+        short_tip_synced = False\n+        for x in self.nodes[0].getchaintips():\n+            if x['hash'] == short_tip:\n+                assert_equal(x['status'], \"headers-only\")\n+                short_tip_synced = True\n+        assert short_tip_synced",
    "path": "test/functional/rpc_getblockfrompeer.py",
    "position": null,
    "original_position": 48,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "30e2ba6c4cef9248c53542faeb8ec768079fc5fb",
    "user": {
      "login": "LarryRuane",
      "id": 8321330,
      "node_id": "MDQ6VXNlcjgzMjEzMzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8321330?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/LarryRuane",
      "html_url": "https://github.com/LarryRuane",
      "followers_url": "https://api.github.com/users/LarryRuane/followers",
      "following_url": "https://api.github.com/users/LarryRuane/following{/other_user}",
      "gists_url": "https://api.github.com/users/LarryRuane/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LarryRuane/subscriptions",
      "organizations_url": "https://api.github.com/users/LarryRuane/orgs",
      "repos_url": "https://api.github.com/users/LarryRuane/repos",
      "events_url": "https://api.github.com/users/LarryRuane/events{/privacy}",
      "received_events_url": "https://api.github.com/users/LarryRuane/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\n        for x in self.nodes[0].getchaintips():\r\n            if x['hash'] == short_tip:\r\n                assert_equal(x['status'], \"headers-only\")\r\n                break\r\n        else:\r\n            raise AssertionError(\"short tip not synced\")\r\n```",
    "created_at": "2021-08-11T16:30:48Z",
    "updated_at": "2021-08-11T16:56:28Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r686993091",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686993091"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r686993091"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686993091/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 43,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 48,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687009270",
    "pull_request_review_id": 727674987,
    "id": 687009270,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NzAwOTI3MA==",
    "diff_hunk": "@@ -0,0 +1,62 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test the getblockfrompeer RPC.\"\"\"\n+\n+from test_framework.authproxy import JSONRPCException\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_raises_rpc_error,\n+)\n+\n+class GetBlockFromPeerTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def check_for_block(self, hash):\n+        try:\n+            self.nodes[0].getblock(hash)\n+            return True\n+        except JSONRPCException:\n+            return False\n+\n+    def run_test(self):\n+        self.log.info(\"Mine 4 blocks on Node 0\")\n+        self.nodes[0].generate(4)\n+        assert_equal(self.nodes[0].getblockcount(), 204)\n+\n+        self.log.info(\"Mine competing 3 blocks on Node 1\")\n+        self.nodes[1].generate(3)\n+        assert_equal(self.nodes[1].getblockcount(), 203)\n+        short_tip = self.nodes[1].getbestblockhash()\n+\n+        self.log.info(\"Connect nodes to sync headers\")\n+        self.connect_nodes(0, 1)\n+        self.sync_blocks()\n+\n+        self.log.info(\"Node 0 should only have the header for node 1's block 3\")\n+        short_tip_synced = False\n+        for x in self.nodes[0].getchaintips():\n+            if x['hash'] == short_tip:\n+                assert_equal(x['status'], \"headers-only\")\n+                short_tip_synced = True\n+        assert short_tip_synced\n+        assert_raises_rpc_error(-1, \"Block not found on disk\", self.nodes[0].getblock, short_tip)\n+\n+        self.log.info(\"Fetch block from node 1\")\n+        peers = self.nodes[0].getpeerinfo()\n+        assert_equal(len(peers), 1)\n+        peer_0_peer_1_id = peers[0][\"id\"]\n+        self.nodes[0].getblockfrompeer(short_tip, peer_0_peer_1_id)\n+        self.wait_until(lambda: self.check_for_block(short_tip), timeout=1)",
    "path": "test/functional/rpc_getblockfrompeer.py",
    "position": null,
    "original_position": 56,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "30e2ba6c4cef9248c53542faeb8ec768079fc5fb",
    "user": {
      "login": "LarryRuane",
      "id": 8321330,
      "node_id": "MDQ6VXNlcjgzMjEzMzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8321330?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/LarryRuane",
      "html_url": "https://github.com/LarryRuane",
      "followers_url": "https://api.github.com/users/LarryRuane/followers",
      "following_url": "https://api.github.com/users/LarryRuane/following{/other_user}",
      "gists_url": "https://api.github.com/users/LarryRuane/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LarryRuane/subscriptions",
      "organizations_url": "https://api.github.com/users/LarryRuane/orgs",
      "repos_url": "https://api.github.com/users/LarryRuane/repos",
      "events_url": "https://api.github.com/users/LarryRuane/events{/privacy}",
      "received_events_url": "https://api.github.com/users/LarryRuane/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Suggestions for additional tests:\r\n```\r\n        self.log.info(\"No error if block is not found in the index\")\r\n        assert_equal(self.nodes[0].getblockfrompeer(\"12\" * 32, peer_0_peer_1_id), None)\r\n        self.log.info(\"Non-existent peer generates error\")\r\n        assert_raises_rpc_error(-1, \"Failed to fetch block from peer\", self.nodes[0].getblockfrompeer, short_tip, peer_0_peer_1_id + 1)\r\n```",
    "created_at": "2021-08-11T16:53:02Z",
    "updated_at": "2021-08-11T16:56:28Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r687009270",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687009270"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r687009270"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687009270/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 56,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687551109",
    "pull_request_review_id": 728387355,
    "id": 687551109,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NzU1MTEwOQ==",
    "diff_hunk": "@@ -0,0 +1,62 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test the getblockfrompeer RPC.\"\"\"\n+\n+from test_framework.authproxy import JSONRPCException\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_raises_rpc_error,\n+)\n+\n+class GetBlockFromPeerTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def check_for_block(self, hash):\n+        try:\n+            self.nodes[0].getblock(hash)\n+            return True\n+        except JSONRPCException:\n+            return False\n+\n+    def run_test(self):\n+        self.log.info(\"Mine 4 blocks on Node 0\")\n+        self.nodes[0].generate(4)\n+        assert_equal(self.nodes[0].getblockcount(), 204)\n+\n+        self.log.info(\"Mine competing 3 blocks on Node 1\")\n+        self.nodes[1].generate(3)\n+        assert_equal(self.nodes[1].getblockcount(), 203)\n+        short_tip = self.nodes[1].getbestblockhash()\n+\n+        self.log.info(\"Connect nodes to sync headers\")\n+        self.connect_nodes(0, 1)\n+        self.sync_blocks()\n+\n+        self.log.info(\"Node 0 should only have the header for node 1's block 3\")\n+        short_tip_synced = False\n+        for x in self.nodes[0].getchaintips():\n+            if x['hash'] == short_tip:\n+                assert_equal(x['status'], \"headers-only\")\n+                short_tip_synced = True\n+        assert short_tip_synced",
    "path": "test/functional/rpc_getblockfrompeer.py",
    "position": null,
    "original_position": 48,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "30e2ba6c4cef9248c53542faeb8ec768079fc5fb",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Much more pythonic :+1: ",
    "created_at": "2021-08-12T09:35:54Z",
    "updated_at": "2021-08-12T09:35:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r687551109",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687551109"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r687551109"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687551109/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 43,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 48,
    "side": "RIGHT",
    "in_reply_to_id": 686993091
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687684521",
    "pull_request_review_id": 728562035,
    "id": 687684521,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NzY4NDUyMQ==",
    "diff_hunk": "@@ -747,6 +749,39 @@ static RPCHelpMan getmempoolentry()\n     };\n }\n \n+static RPCHelpMan getblockfrompeer()\n+{\n+    return RPCHelpMan{\"getblockfrompeer\",\n+                \"\\nAttempt to fetch block from a given peer.\\n\",\n+                {\n+                    {\"blockhash\", RPCArg::Type::STR_HEX, RPCArg::Optional::NO, \"The block hash\"},\n+                    {\"nodeid\", RPCArg::Type::NUM, RPCArg::Optional::NO, \"The node ID (see getpeerinfo for node IDs)\"},\n+                },\n+                RPCResult{RPCResult::Type::ANY, \"\", \"\"},\n+                RPCExamples{\n+                    HelpExampleCli(\"getblockfrompeer\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 0\")\n+                + HelpExampleRpc(\"getblockfrompeer\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 0\")\n+                },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    const NodeContext& node = EnsureAnyNodeContext(request.context);\n+    ChainstateManager& chainman = EnsureChainman(node);\n+    PeerManager& peerman = EnsurePeerman(node);\n+\n+    uint256 hash(ParseHashV(request.params[0], \"hash\"));\n+\n+    const NodeId nodeid = static_cast<NodeId>(request.params[1].get_int64());\n+\n+    const CBlockIndex* const pblockindex = WITH_LOCK(cs_main, return chainman.m_blockman.LookupBlockIndex(hash););\n+\n+    if (!peerman.FetchBlock(nodeid, hash, pblockindex)) {\n+        throw JSONRPCError(RPC_MISC_ERROR, \"Failed to fetch block from peer\");\n+    }\n+    return UniValue::VOBJ;",
    "path": "src/rpc/blockchain.cpp",
    "position": null,
    "original_position": 41,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "30e2ba6c4cef9248c53542faeb8ec768079fc5fb",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "The first version of this PR included a `success` boolean, but that didn't make sense because we don't know if we actually get the block. So I guess I made the response an empty VOBJ. I'll switch to Null.",
    "created_at": "2021-08-12T12:55:17Z",
    "updated_at": "2021-08-12T12:55:18Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r687684521",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687684521"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r687684521"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687684521/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 786,
    "side": "RIGHT",
    "in_reply_to_id": 686972430
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687754011",
    "pull_request_review_id": 728657049,
    "id": 687754011,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4Nzc1NDAxMQ==",
    "diff_hunk": "@@ -0,0 +1,62 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test the getblockfrompeer RPC.\"\"\"\n+\n+from test_framework.authproxy import JSONRPCException\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_raises_rpc_error,\n+)\n+\n+class GetBlockFromPeerTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def check_for_block(self, hash):\n+        try:\n+            self.nodes[0].getblock(hash)\n+            return True\n+        except JSONRPCException:\n+            return False\n+\n+    def run_test(self):\n+        self.log.info(\"Mine 4 blocks on Node 0\")\n+        self.nodes[0].generate(4)\n+        assert_equal(self.nodes[0].getblockcount(), 204)\n+\n+        self.log.info(\"Mine competing 3 blocks on Node 1\")\n+        self.nodes[1].generate(3)\n+        assert_equal(self.nodes[1].getblockcount(), 203)\n+        short_tip = self.nodes[1].getbestblockhash()\n+\n+        self.log.info(\"Connect nodes to sync headers\")\n+        self.connect_nodes(0, 1)\n+        self.sync_blocks()\n+\n+        self.log.info(\"Node 0 should only have the header for node 1's block 3\")\n+        short_tip_synced = False\n+        for x in self.nodes[0].getchaintips():\n+            if x['hash'] == short_tip:\n+                assert_equal(x['status'], \"headers-only\")\n+                short_tip_synced = True\n+        assert short_tip_synced",
    "path": "test/functional/rpc_getblockfrompeer.py",
    "position": null,
    "original_position": 48,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "30e2ba6c4cef9248c53542faeb8ec768079fc5fb",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Tastes the same to me, but changed...",
    "created_at": "2021-08-12T14:14:42Z",
    "updated_at": "2021-08-12T14:14:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r687754011",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687754011"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r687754011"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687754011/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 43,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 48,
    "side": "RIGHT",
    "in_reply_to_id": 686993091
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687756311",
    "pull_request_review_id": 728659861,
    "id": 687756311,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4Nzc1NjMxMQ==",
    "diff_hunk": "@@ -0,0 +1,62 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test the getblockfrompeer RPC.\"\"\"\n+\n+from test_framework.authproxy import JSONRPCException\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_raises_rpc_error,\n+)\n+\n+class GetBlockFromPeerTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def check_for_block(self, hash):\n+        try:\n+            self.nodes[0].getblock(hash)\n+            return True\n+        except JSONRPCException:\n+            return False\n+\n+    def run_test(self):\n+        self.log.info(\"Mine 4 blocks on Node 0\")\n+        self.nodes[0].generate(4)\n+        assert_equal(self.nodes[0].getblockcount(), 204)\n+\n+        self.log.info(\"Mine competing 3 blocks on Node 1\")\n+        self.nodes[1].generate(3)\n+        assert_equal(self.nodes[1].getblockcount(), 203)\n+        short_tip = self.nodes[1].getbestblockhash()\n+\n+        self.log.info(\"Connect nodes to sync headers\")\n+        self.connect_nodes(0, 1)\n+        self.sync_blocks()\n+\n+        self.log.info(\"Node 0 should only have the header for node 1's block 3\")\n+        short_tip_synced = False\n+        for x in self.nodes[0].getchaintips():\n+            if x['hash'] == short_tip:\n+                assert_equal(x['status'], \"headers-only\")\n+                short_tip_synced = True\n+        assert short_tip_synced\n+        assert_raises_rpc_error(-1, \"Block not found on disk\", self.nodes[0].getblock, short_tip)\n+\n+        self.log.info(\"Fetch block from node 1\")\n+        peers = self.nodes[0].getpeerinfo()\n+        assert_equal(len(peers), 1)\n+        peer_0_peer_1_id = peers[0][\"id\"]\n+        self.nodes[0].getblockfrompeer(short_tip, peer_0_peer_1_id)\n+        self.wait_until(lambda: self.check_for_block(short_tip), timeout=1)",
    "path": "test/functional/rpc_getblockfrompeer.py",
    "position": null,
    "original_position": 56,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "30e2ba6c4cef9248c53542faeb8ec768079fc5fb",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks, added the second one.",
    "created_at": "2021-08-12T14:16:57Z",
    "updated_at": "2021-08-12T14:16:58Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r687756311",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687756311"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r687756311"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687756311/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 56,
    "side": "RIGHT",
    "in_reply_to_id": 687009270
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709528521",
    "pull_request_review_id": 755562997,
    "id": 709528521,
    "node_id": "PRRC_kwDOABII584qSovJ",
    "diff_hunk": "@@ -18,6 +18,8 @@\n #include <hash.h>\n #include <index/blockfilterindex.h>\n #include <index/coinstatsindex.h>\n+#include <net.h> // For NodeId",
    "path": "src/rpc/blockchain.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "29263ae14a81d4cc55de61f51db981edf54399d0",
    "user": {
      "login": "0xB10C",
      "id": 19157360,
      "node_id": "MDQ6VXNlcjE5MTU3MzYw",
      "avatar_url": "https://avatars.githubusercontent.com/u/19157360?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0xB10C",
      "html_url": "https://github.com/0xB10C",
      "followers_url": "https://api.github.com/users/0xB10C/followers",
      "following_url": "https://api.github.com/users/0xB10C/following{/other_user}",
      "gists_url": "https://api.github.com/users/0xB10C/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/0xB10C/subscriptions",
      "organizations_url": "https://api.github.com/users/0xB10C/orgs",
      "repos_url": "https://api.github.com/users/0xB10C/repos",
      "events_url": "https://api.github.com/users/0xB10C/events{/privacy}",
      "received_events_url": "https://api.github.com/users/0xB10C/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: not sure if there is need for a `// For NodeId` comment here. I think comments like these tend to be overlooked when adding something else that needs `net.h` and thus out-dating the comment.",
    "created_at": "2021-09-15T19:55:53Z",
    "updated_at": "2021-09-15T19:55:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r709528521",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709528521"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r709528521"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709528521/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 21,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709530801",
    "pull_request_review_id": 755566003,
    "id": 709530801,
    "node_id": "PRRC_kwDOABII584qSpSx",
    "diff_hunk": "@@ -748,6 +750,44 @@ static RPCHelpMan getmempoolentry()\n     };\n }\n \n+static RPCHelpMan getblockfrompeer()\n+{\n+    return RPCHelpMan{\"getblockfrompeer\",\n+                \"\\nAttempt to fetch block from a given peer.\\n\"",
    "path": "src/rpc/blockchain.cpp",
    "position": 87,
    "original_position": 16,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "29263ae14a81d4cc55de61f51db981edf54399d0",
    "user": {
      "login": "0xB10C",
      "id": 19157360,
      "node_id": "MDQ6VXNlcjE5MTU3MzYw",
      "avatar_url": "https://avatars.githubusercontent.com/u/19157360?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0xB10C",
      "html_url": "https://github.com/0xB10C",
      "followers_url": "https://api.github.com/users/0xB10C/followers",
      "following_url": "https://api.github.com/users/0xB10C/following{/other_user}",
      "gists_url": "https://api.github.com/users/0xB10C/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/0xB10C/subscriptions",
      "organizations_url": "https://api.github.com/users/0xB10C/orgs",
      "repos_url": "https://api.github.com/users/0xB10C/repos",
      "events_url": "https://api.github.com/users/0xB10C/events{/privacy}",
      "received_events_url": "https://api.github.com/users/0xB10C/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "As a user I'd expect some documentation that the RPC call returns `{}` once the block-request has been successfully scheduled and that I have to manually check if my node now has the block.  ",
    "created_at": "2021-09-15T19:59:28Z",
    "updated_at": "2021-09-15T20:22:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r709530801",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709530801"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r709530801"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709530801/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 756,
    "original_line": 756,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709533364",
    "pull_request_review_id": 755566003,
    "id": 709533364,
    "node_id": "PRRC_kwDOABII584qSp60",
    "diff_hunk": "@@ -748,6 +750,44 @@ static RPCHelpMan getmempoolentry()\n     };\n }\n \n+static RPCHelpMan getblockfrompeer()\n+{\n+    return RPCHelpMan{\"getblockfrompeer\",\n+                \"\\nAttempt to fetch block from a given peer.\\n\"\n+                \"\\nWe must have the header for this block, e.g. using submitheader.\\n\",\n+                {\n+                    {\"blockhash\", RPCArg::Type::STR_HEX, RPCArg::Optional::NO, \"The block hash\"},\n+                    {\"nodeid\", RPCArg::Type::NUM, RPCArg::Optional::NO, \"The node ID (see getpeerinfo for node IDs)\"},\n+                },\n+                RPCResult{RPCResult::Type::ANY, \"\", \"\"},\n+                RPCExamples{\n+                    HelpExampleCli(\"getblockfrompeer\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 0\")\n+                + HelpExampleRpc(\"getblockfrompeer\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 0\")\n+                },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    const NodeContext& node = EnsureAnyNodeContext(request.context);\n+    ChainstateManager& chainman = EnsureChainman(node);\n+    PeerManager& peerman = EnsurePeerman(node);\n+\n+    uint256 hash(ParseHashV(request.params[0], \"hash\"));\n+\n+    const NodeId nodeid = static_cast<NodeId>(request.params[1].get_int64());\n+\n+    const CBlockIndex* const index = WITH_LOCK(cs_main, return chainman.m_blockman.LookupBlockIndex(hash););\n+\n+    if (!index) {\n+        throw JSONRPCError(RPC_MISC_ERROR, \"Block header missing\");\n+    }\n+",
    "path": "src/rpc/blockchain.cpp",
    "position": 123,
    "original_position": 42,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "29263ae14a81d4cc55de61f51db981edf54399d0",
    "user": {
      "login": "0xB10C",
      "id": 19157360,
      "node_id": "MDQ6VXNlcjE5MTU3MzYw",
      "avatar_url": "https://avatars.githubusercontent.com/u/19157360?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0xB10C",
      "html_url": "https://github.com/0xB10C",
      "followers_url": "https://api.github.com/users/0xB10C/followers",
      "following_url": "https://api.github.com/users/0xB10C/following{/other_user}",
      "gists_url": "https://api.github.com/users/0xB10C/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/0xB10C/subscriptions",
      "organizations_url": "https://api.github.com/users/0xB10C/orgs",
      "repos_url": "https://api.github.com/users/0xB10C/repos",
      "events_url": "https://api.github.com/users/0xB10C/events{/privacy}",
      "received_events_url": "https://api.github.com/users/0xB10C/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "optional but maybe worthwile: could check if the block is already available and return true if it is. Could reduce bandwidth usage in cases where users spam/iterate their all their peers with a `getblockfrompeer`.",
    "created_at": "2021-09-15T20:03:47Z",
    "updated_at": "2021-09-15T20:22:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r709533364",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709533364"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r709533364"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709533364/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 792,
    "original_line": 792,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709685368",
    "pull_request_review_id": 755750895,
    "id": 709685368,
    "node_id": "PRRC_kwDOABII584qTPB4",
    "diff_hunk": "@@ -18,6 +18,8 @@\n #include <hash.h>\n #include <index/blockfilterindex.h>\n #include <index/coinstatsindex.h>\n+#include <net.h> // For NodeId",
    "path": "src/rpc/blockchain.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "29263ae14a81d4cc55de61f51db981edf54399d0",
    "user": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yea, please don't add comments like these.",
    "created_at": "2021-09-16T01:30:46Z",
    "updated_at": "2021-09-16T01:30:46Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r709685368",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709685368"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r709685368"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709685368/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 21,
    "side": "RIGHT",
    "in_reply_to_id": 709528521
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709953863",
    "pull_request_review_id": 756079368,
    "id": 709953863,
    "node_id": "PRRC_kwDOABII584qUQlH",
    "diff_hunk": "@@ -748,6 +750,44 @@ static RPCHelpMan getmempoolentry()\n     };\n }\n \n+static RPCHelpMan getblockfrompeer()\n+{\n+    return RPCHelpMan{\"getblockfrompeer\",\n+                \"\\nAttempt to fetch block from a given peer.\\n\"",
    "path": "src/rpc/blockchain.cpp",
    "position": 87,
    "original_position": 16,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "29263ae14a81d4cc55de61f51db981edf54399d0",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I added a sentence to the RPC doc.",
    "created_at": "2021-09-16T09:37:06Z",
    "updated_at": "2021-09-16T09:37:06Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r709953863",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709953863"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r709953863"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709953863/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 756,
    "original_line": 756,
    "side": "RIGHT",
    "in_reply_to_id": 709530801
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709972875",
    "pull_request_review_id": 756104742,
    "id": 709972875,
    "node_id": "PRRC_kwDOABII584qUVOL",
    "diff_hunk": "@@ -748,6 +750,44 @@ static RPCHelpMan getmempoolentry()\n     };\n }\n \n+static RPCHelpMan getblockfrompeer()\n+{\n+    return RPCHelpMan{\"getblockfrompeer\",\n+                \"\\nAttempt to fetch block from a given peer.\\n\"\n+                \"\\nWe must have the header for this block, e.g. using submitheader.\\n\",\n+                {\n+                    {\"blockhash\", RPCArg::Type::STR_HEX, RPCArg::Optional::NO, \"The block hash\"},\n+                    {\"nodeid\", RPCArg::Type::NUM, RPCArg::Optional::NO, \"The node ID (see getpeerinfo for node IDs)\"},\n+                },\n+                RPCResult{RPCResult::Type::ANY, \"\", \"\"},\n+                RPCExamples{\n+                    HelpExampleCli(\"getblockfrompeer\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 0\")\n+                + HelpExampleRpc(\"getblockfrompeer\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 0\")\n+                },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    const NodeContext& node = EnsureAnyNodeContext(request.context);\n+    ChainstateManager& chainman = EnsureChainman(node);\n+    PeerManager& peerman = EnsurePeerman(node);\n+\n+    uint256 hash(ParseHashV(request.params[0], \"hash\"));\n+\n+    const NodeId nodeid = static_cast<NodeId>(request.params[1].get_int64());\n+\n+    const CBlockIndex* const index = WITH_LOCK(cs_main, return chainman.m_blockman.LookupBlockIndex(hash););\n+\n+    if (!index) {\n+        throw JSONRPCError(RPC_MISC_ERROR, \"Block header missing\");\n+    }\n+",
    "path": "src/rpc/blockchain.cpp",
    "position": 123,
    "original_position": 42,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "29263ae14a81d4cc55de61f51db981edf54399d0",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "The result now includes a warning if we already had the block. This seems better than throwing an error, since an RPC client might attempt fetching for multiple peers in parallel.",
    "created_at": "2021-09-16T10:02:27Z",
    "updated_at": "2021-09-16T10:02:28Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r709972875",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709972875"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r709972875"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709972875/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 792,
    "original_line": 792,
    "side": "RIGHT",
    "in_reply_to_id": 709533364
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741610324",
    "pull_request_review_id": 796102007,
    "id": 741610324,
    "node_id": "PRRC_kwDOABII584sNBNU",
    "diff_hunk": "@@ -1426,6 +1427,41 @@ bool PeerManagerImpl::BlockRequestAllowed(const CBlockIndex* pindex)\n            (GetBlockProofEquivalentTime(*pindexBestHeader, *pindex, *pindexBestHeader, m_chainparams.GetConsensus()) < STALE_RELAY_AGE_LIMIT);\n }\n \n+bool PeerManagerImpl::FetchBlock(NodeId id, const uint256& hash, const CBlockIndex& index)\n+{\n+    if (fImporting || fReindex) return false;\n+\n+    LOCK(cs_main);\n+    // Ensure this peer exists and hasn't been disconnected\n+    CNodeState* state = State(id);\n+    if (state == nullptr) return false;\n+    // Ignore pre-segwit peers\n+    if (!state->fHaveWitness) return false;\n+\n+    // Construct message to request the block\n+    std::vector<CInv> invs{CInv(MSG_BLOCK | MSG_WITNESS_FLAG, hash)};",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 24,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "9181e2e217955fff5f726b0e011afb78fb90af8f",
    "user": {
      "login": "LarryRuane",
      "id": 8321330,
      "node_id": "MDQ6VXNlcjgzMjEzMzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8321330?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/LarryRuane",
      "html_url": "https://github.com/LarryRuane",
      "followers_url": "https://api.github.com/users/LarryRuane/followers",
      "following_url": "https://api.github.com/users/LarryRuane/following{/other_user}",
      "gists_url": "https://api.github.com/users/LarryRuane/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LarryRuane/subscriptions",
      "organizations_url": "https://api.github.com/users/LarryRuane/orgs",
      "repos_url": "https://api.github.com/users/LarryRuane/repos",
      "events_url": "https://api.github.com/users/LarryRuane/events{/privacy}",
      "received_events_url": "https://api.github.com/users/LarryRuane/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit, if you have a chance to retouch, could this be moved down to just before it's first used by the `m_connman.ForNode()` call below?",
    "created_at": "2021-11-03T04:15:22Z",
    "updated_at": "2021-11-03T04:21:34Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r741610324",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741610324"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r741610324"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741610324/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1442,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/753897686",
    "pull_request_review_id": 812022352,
    "id": 753897686,
    "node_id": "PRRC_kwDOABII584s75DW",
    "diff_hunk": "@@ -796,6 +750,52 @@ static RPCHelpMan getmempoolentry()\n     };\n }\n \n+static RPCHelpMan getblockfrompeer()\n+{\n+    return RPCHelpMan{\"getblockfrompeer\",\n+                \"\\nAttempt to fetch block from a given peer.\\n\"\n+                \"\\nWe must have the header for this block, e.g. using submitheader.\\n\"\n+                \"\\nReturns {} if a block-request was successfully scheduled\\n\",\n+                {\n+                    {\"blockhash\", RPCArg::Type::STR_HEX, RPCArg::Optional::NO, \"The block hash\"},\n+                    {\"nodeid\", RPCArg::Type::NUM, RPCArg::Optional::NO, \"The node ID (see getpeerinfo for node IDs)\"},\n+                },\n+                RPCResult{RPCResult::Type::OBJ, \"\", \"\",\n+                {\n+                    {RPCResult::Type::STR, \"warnings\", \"any warnings\"}\n+                }},\n+                RPCExamples{\n+                    HelpExampleCli(\"getblockfrompeer\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 0\")\n+                + HelpExampleRpc(\"getblockfrompeer\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 0\")\n+                },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    const NodeContext& node = EnsureAnyNodeContext(request.context);\n+    ChainstateManager& chainman = EnsureChainman(node);\n+    PeerManager& peerman = EnsurePeerman(node);\n+\n+    uint256 hash(ParseHashV(request.params[0], \"hash\"));\n+\n+    const NodeId nodeid = static_cast<NodeId>(request.params[1].get_int64());\n+\n+    const CBlockIndex* const index = WITH_LOCK(cs_main, return chainman.m_blockman.LookupBlockIndex(hash););\n+\n+    if (!index) {\n+        throw JSONRPCError(RPC_MISC_ERROR, \"Block header missing\");\n+    }\n+\n+    UniValue result = UniValue::VOBJ;\n+\n+    if (index->nStatus & BLOCK_HAVE_DATA) {\n+        result.pushKV(\"warnings\", \"Block already downloaded\");",
    "path": "src/rpc/blockchain.cpp",
    "position": 127,
    "original_position": 121,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "9181e2e217955fff5f726b0e011afb78fb90af8f",
    "user": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Is it intentional that this succeeds even with an invalid nodeid?\r\n\r\nPerhaps the tests should check for the expected behaviour.",
    "created_at": "2021-11-22T02:05:03Z",
    "updated_at": "2021-11-22T02:05:03Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r753897686",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/753897686"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r753897686"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/753897686/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 796,
    "original_line": 796,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/754202663",
    "pull_request_review_id": 812434330,
    "id": 754202663,
    "node_id": "PRRC_kwDOABII584s9Dgn",
    "diff_hunk": "@@ -796,6 +750,52 @@ static RPCHelpMan getmempoolentry()\n     };\n }\n \n+static RPCHelpMan getblockfrompeer()\n+{\n+    return RPCHelpMan{\"getblockfrompeer\",\n+                \"\\nAttempt to fetch block from a given peer.\\n\"\n+                \"\\nWe must have the header for this block, e.g. using submitheader.\\n\"\n+                \"\\nReturns {} if a block-request was successfully scheduled\\n\",\n+                {\n+                    {\"blockhash\", RPCArg::Type::STR_HEX, RPCArg::Optional::NO, \"The block hash\"},\n+                    {\"nodeid\", RPCArg::Type::NUM, RPCArg::Optional::NO, \"The node ID (see getpeerinfo for node IDs)\"},\n+                },\n+                RPCResult{RPCResult::Type::OBJ, \"\", \"\",\n+                {\n+                    {RPCResult::Type::STR, \"warnings\", \"any warnings\"}\n+                }},\n+                RPCExamples{\n+                    HelpExampleCli(\"getblockfrompeer\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 0\")\n+                + HelpExampleRpc(\"getblockfrompeer\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 0\")\n+                },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    const NodeContext& node = EnsureAnyNodeContext(request.context);\n+    ChainstateManager& chainman = EnsureChainman(node);\n+    PeerManager& peerman = EnsurePeerman(node);\n+\n+    uint256 hash(ParseHashV(request.params[0], \"hash\"));\n+\n+    const NodeId nodeid = static_cast<NodeId>(request.params[1].get_int64());\n+\n+    const CBlockIndex* const index = WITH_LOCK(cs_main, return chainman.m_blockman.LookupBlockIndex(hash););\n+\n+    if (!index) {\n+        throw JSONRPCError(RPC_MISC_ERROR, \"Block header missing\");\n+    }\n+\n+    UniValue result = UniValue::VOBJ;\n+\n+    if (index->nStatus & BLOCK_HAVE_DATA) {\n+        result.pushKV(\"warnings\", \"Block already downloaded\");",
    "path": "src/rpc/blockchain.cpp",
    "position": 127,
    "original_position": 121,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "9181e2e217955fff5f726b0e011afb78fb90af8f",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "It's probably a good sanity check to add. I could call `GetNodeStateStats` on the peer as a way to find out if it's valid, though that's not strictly what that PeerMan function is for. @jnewbery?",
    "created_at": "2021-11-22T11:57:56Z",
    "updated_at": "2021-11-22T11:58:03Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r754202663",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/754202663"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r754202663"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/754202663/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 796,
    "original_line": 796,
    "side": "RIGHT",
    "in_reply_to_id": 753897686
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/757816731",
    "pull_request_review_id": 817157738,
    "id": 757816731,
    "node_id": "PRRC_kwDOABII584tK12b",
    "diff_hunk": "@@ -748,6 +750,52 @@ static RPCHelpMan getmempoolentry()\n     };\n }\n \n+static RPCHelpMan getblockfrompeer()\n+{\n+    return RPCHelpMan{\"getblockfrompeer\",\n+                \"\\nAttempt to fetch block from a given peer.\\n\"\n+                \"\\nWe must have the header for this block, e.g. using submitheader.\\n\"\n+                \"\\nReturns {} if a block-request was successfully scheduled\\n\",",
    "path": "src/rpc/blockchain.cpp",
    "position": 89,
    "original_position": 18,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "9181e2e217955fff5f726b0e011afb78fb90af8f",
    "user": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjahr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think it would be good to add more information for pruned node users of how long the block will be around. If my understanding is correct, something like this: `Note: On a pruned node this block will be pruned again when the pruneheight surpasses the blockheight at the time of fetching the block.`",
    "created_at": "2021-11-27T20:19:31Z",
    "updated_at": "2021-11-27T22:14:21Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r757816731",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/757816731"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r757816731"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/757816731/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 758,
    "original_line": 758,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/757818887",
    "pull_request_review_id": 817159578,
    "id": 757818887,
    "node_id": "PRRC_kwDOABII584tK2YH",
    "diff_hunk": "@@ -748,6 +750,52 @@ static RPCHelpMan getmempoolentry()\n     };\n }\n \n+static RPCHelpMan getblockfrompeer()\n+{\n+    return RPCHelpMan{\"getblockfrompeer\",\n+                \"\\nAttempt to fetch block from a given peer.\\n\"\n+                \"\\nWe must have the header for this block, e.g. using submitheader.\\n\"\n+                \"\\nReturns {} if a block-request was successfully scheduled\\n\",",
    "path": "src/rpc/blockchain.cpp",
    "position": 89,
    "original_position": 18,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "9181e2e217955fff5f726b0e011afb78fb90af8f",
    "user": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Even that is not guaranteed at the moment (albeit very likely to hold in practice).\r\n\r\nCombined with #19463, the caller could set a prune lock to ensure it doesn't get re-pruned before the caller is done with it.",
    "created_at": "2021-11-27T22:18:28Z",
    "updated_at": "2021-11-27T22:18:28Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r757818887",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/757818887"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r757818887"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/757818887/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 758,
    "original_line": 758,
    "side": "RIGHT",
    "in_reply_to_id": 757816731
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/760200854",
    "pull_request_review_id": 820279950,
    "id": 760200854,
    "node_id": "PRRC_kwDOABII584tT76W",
    "diff_hunk": "@@ -796,6 +750,52 @@ static RPCHelpMan getmempoolentry()\n     };\n }\n \n+static RPCHelpMan getblockfrompeer()\n+{\n+    return RPCHelpMan{\"getblockfrompeer\",\n+                \"\\nAttempt to fetch block from a given peer.\\n\"\n+                \"\\nWe must have the header for this block, e.g. using submitheader.\\n\"\n+                \"\\nReturns {} if a block-request was successfully scheduled\\n\",\n+                {\n+                    {\"blockhash\", RPCArg::Type::STR_HEX, RPCArg::Optional::NO, \"The block hash\"},\n+                    {\"nodeid\", RPCArg::Type::NUM, RPCArg::Optional::NO, \"The node ID (see getpeerinfo for node IDs)\"},\n+                },\n+                RPCResult{RPCResult::Type::OBJ, \"\", \"\",\n+                {\n+                    {RPCResult::Type::STR, \"warnings\", \"any warnings\"}\n+                }},\n+                RPCExamples{\n+                    HelpExampleCli(\"getblockfrompeer\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 0\")\n+                + HelpExampleRpc(\"getblockfrompeer\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 0\")\n+                },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    const NodeContext& node = EnsureAnyNodeContext(request.context);\n+    ChainstateManager& chainman = EnsureChainman(node);\n+    PeerManager& peerman = EnsurePeerman(node);\n+\n+    uint256 hash(ParseHashV(request.params[0], \"hash\"));\n+\n+    const NodeId nodeid = static_cast<NodeId>(request.params[1].get_int64());\n+\n+    const CBlockIndex* const index = WITH_LOCK(cs_main, return chainman.m_blockman.LookupBlockIndex(hash););\n+\n+    if (!index) {\n+        throw JSONRPCError(RPC_MISC_ERROR, \"Block header missing\");\n+    }\n+\n+    UniValue result = UniValue::VOBJ;\n+\n+    if (index->nStatus & BLOCK_HAVE_DATA) {\n+        result.pushKV(\"warnings\", \"Block already downloaded\");",
    "path": "src/rpc/blockchain.cpp",
    "position": 127,
    "original_position": 121,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "9181e2e217955fff5f726b0e011afb78fb90af8f",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "You could use `CConnman::ForNode()` to determine whether the peer with that nodeid exists. Here's the diff (with the required changes to make the tests run on master):\r\n\r\n```diff\r\ndiff --git a/src/rpc/blockchain.cpp b/src/rpc/blockchain.cpp\r\nindex 9fc586c122..fdbfe55aaf 100644\r\n--- a/src/rpc/blockchain.cpp\r\n+++ b/src/rpc/blockchain.cpp\r\n@@ -780,11 +780,17 @@ static RPCHelpMan getblockfrompeer()\r\n     const NodeContext& node = EnsureAnyNodeContext(request.context);\r\n     ChainstateManager& chainman = EnsureChainman(node);\r\n     PeerManager& peerman = EnsurePeerman(node);\r\n+    CConnman& connman = EnsureConnman(node);\r\n \r\n     uint256 hash(ParseHashV(request.params[0], \"hash\"));\r\n \r\n     const NodeId nodeid = static_cast<NodeId>(request.params[1].get_int64());\r\n \r\n+    // Check that the peer with nodeid exists\r\n+    if (!connman.ForNode(nodeid, [](CNode* node) {return true;})) {\r\n+        throw JSONRPCError(RPC_MISC_ERROR, strprintf(\"Peer nodeid %d does not exist\", nodeid));\r\n+    }\r\n+\r\n     const CBlockIndex* const index = WITH_LOCK(cs_main, return chainman.m_blockman.LookupBlockIndex(hash););\r\n \r\n     if (!index) {\r\ndiff --git a/test/functional/rpc_getblockfrompeer.py b/test/functional/rpc_getblockfrompeer.py\r\nindex ec562c94f9..e841cba70e 100755\r\n--- a/test/functional/rpc_getblockfrompeer.py\r\n+++ b/test/functional/rpc_getblockfrompeer.py\r\n@@ -27,11 +27,11 @@ class GetBlockFromPeerTest(BitcoinTestFramework):\r\n \r\n     def run_test(self):\r\n         self.log.info(\"Mine 4 blocks on Node 0\")\r\n-        self.nodes[0].generate(4)\r\n+        self.generate(self.nodes[0], 4, sync_fun=self.no_op)\r\n         assert_equal(self.nodes[0].getblockcount(), 204)\r\n \r\n         self.log.info(\"Mine competing 3 blocks on Node 1\")\r\n-        self.nodes[1].generate(3)\r\n+        self.generate(self.nodes[1], 3, sync_fun=self.no_op)\r\n         assert_equal(self.nodes[1].getblockcount(), 203)\r\n         short_tip = self.nodes[1].getbestblockhash()\r\n \r\n@@ -60,7 +60,7 @@ class GetBlockFromPeerTest(BitcoinTestFramework):\r\n         assert_raises_rpc_error(-1, \"Block header missing\", self.nodes[0].getblockfrompeer, \"00\" * 32, 0)\r\n \r\n         self.log.info(\"Non-existent peer generates error\")\r\n-        assert_raises_rpc_error(-1, \"Failed to fetch block from peer\", self.nodes[0].getblockfrompeer, short_tip, peer_0_peer_1_id + 1)\r\n+        assert_raises_rpc_error(-1, f\"Peer nodeid {peer_0_peer_1_id + 1} does not exist\", self.nodes[0].getblockfrompeer, short_tip, peer_0_peer_1_id + 1)\r\n \r\n         self.log.info(\"Successful fetch\")\r\n         result = self.nodes[0].getblockfrompeer(short_tip, peer_0_peer_1_id)\r\n```",
    "created_at": "2021-12-01T13:49:43Z",
    "updated_at": "2021-12-01T13:49:43Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r760200854",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/760200854"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r760200854"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/760200854/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 796,
    "original_line": 796,
    "side": "RIGHT",
    "in_reply_to_id": 753897686
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/760236497",
    "pull_request_review_id": 820330991,
    "id": 760236497,
    "node_id": "PRRC_kwDOABII584tUEnR",
    "diff_hunk": "@@ -1426,6 +1427,41 @@ bool PeerManagerImpl::BlockRequestAllowed(const CBlockIndex* pindex)\n            (GetBlockProofEquivalentTime(*pindexBestHeader, *pindex, *pindexBestHeader, m_chainparams.GetConsensus()) < STALE_RELAY_AGE_LIMIT);\n }\n \n+bool PeerManagerImpl::FetchBlock(NodeId id, const uint256& hash, const CBlockIndex& index)\n+{\n+    if (fImporting || fReindex) return false;\n+\n+    LOCK(cs_main);\n+    // Ensure this peer exists and hasn't been disconnected\n+    CNodeState* state = State(id);\n+    if (state == nullptr) return false;\n+    // Ignore pre-segwit peers\n+    if (!state->fHaveWitness) return false;\n+\n+    // Construct message to request the block\n+    std::vector<CInv> invs{CInv(MSG_BLOCK | MSG_WITNESS_FLAG, hash)};",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 24,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "9181e2e217955fff5f726b0e011afb78fb90af8f",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I moved it down a bit.",
    "created_at": "2021-12-01T14:29:03Z",
    "updated_at": "2021-12-01T14:31:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r760236497",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/760236497"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r760236497"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/760236497/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1442,
    "side": "RIGHT",
    "in_reply_to_id": 741610324
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/760236809",
    "pull_request_review_id": 820331448,
    "id": 760236809,
    "node_id": "PRRC_kwDOABII584tUEsJ",
    "diff_hunk": "@@ -796,6 +750,52 @@ static RPCHelpMan getmempoolentry()\n     };\n }\n \n+static RPCHelpMan getblockfrompeer()\n+{\n+    return RPCHelpMan{\"getblockfrompeer\",\n+                \"\\nAttempt to fetch block from a given peer.\\n\"\n+                \"\\nWe must have the header for this block, e.g. using submitheader.\\n\"\n+                \"\\nReturns {} if a block-request was successfully scheduled\\n\",\n+                {\n+                    {\"blockhash\", RPCArg::Type::STR_HEX, RPCArg::Optional::NO, \"The block hash\"},\n+                    {\"nodeid\", RPCArg::Type::NUM, RPCArg::Optional::NO, \"The node ID (see getpeerinfo for node IDs)\"},\n+                },\n+                RPCResult{RPCResult::Type::OBJ, \"\", \"\",\n+                {\n+                    {RPCResult::Type::STR, \"warnings\", \"any warnings\"}\n+                }},\n+                RPCExamples{\n+                    HelpExampleCli(\"getblockfrompeer\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 0\")\n+                + HelpExampleRpc(\"getblockfrompeer\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 0\")\n+                },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    const NodeContext& node = EnsureAnyNodeContext(request.context);\n+    ChainstateManager& chainman = EnsureChainman(node);\n+    PeerManager& peerman = EnsurePeerman(node);\n+\n+    uint256 hash(ParseHashV(request.params[0], \"hash\"));\n+\n+    const NodeId nodeid = static_cast<NodeId>(request.params[1].get_int64());\n+\n+    const CBlockIndex* const index = WITH_LOCK(cs_main, return chainman.m_blockman.LookupBlockIndex(hash););\n+\n+    if (!index) {\n+        throw JSONRPCError(RPC_MISC_ERROR, \"Block header missing\");\n+    }\n+\n+    UniValue result = UniValue::VOBJ;\n+\n+    if (index->nStatus & BLOCK_HAVE_DATA) {\n+        result.pushKV(\"warnings\", \"Block already downloaded\");",
    "path": "src/rpc/blockchain.cpp",
    "position": 127,
    "original_position": 121,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "9181e2e217955fff5f726b0e011afb78fb90af8f",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done. I left out the `sync_fun=self.no_op` bit, as it results in: `AttributeError: 'GetBlockFromPeerTest' object has no attribute 'no_op'`",
    "created_at": "2021-12-01T14:29:22Z",
    "updated_at": "2021-12-01T14:36:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r760236809",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/760236809"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r760236809"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/760236809/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 796,
    "original_line": 796,
    "side": "RIGHT",
    "in_reply_to_id": 753897686
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/760249680",
    "pull_request_review_id": 820349016,
    "id": 760249680,
    "node_id": "PRRC_kwDOABII584tUH1Q",
    "diff_hunk": "@@ -796,6 +750,52 @@ static RPCHelpMan getmempoolentry()\n     };\n }\n \n+static RPCHelpMan getblockfrompeer()\n+{\n+    return RPCHelpMan{\"getblockfrompeer\",\n+                \"\\nAttempt to fetch block from a given peer.\\n\"\n+                \"\\nWe must have the header for this block, e.g. using submitheader.\\n\"\n+                \"\\nReturns {} if a block-request was successfully scheduled\\n\",\n+                {\n+                    {\"blockhash\", RPCArg::Type::STR_HEX, RPCArg::Optional::NO, \"The block hash\"},\n+                    {\"nodeid\", RPCArg::Type::NUM, RPCArg::Optional::NO, \"The node ID (see getpeerinfo for node IDs)\"},\n+                },\n+                RPCResult{RPCResult::Type::OBJ, \"\", \"\",\n+                {\n+                    {RPCResult::Type::STR, \"warnings\", \"any warnings\"}\n+                }},\n+                RPCExamples{\n+                    HelpExampleCli(\"getblockfrompeer\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 0\")\n+                + HelpExampleRpc(\"getblockfrompeer\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 0\")\n+                },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    const NodeContext& node = EnsureAnyNodeContext(request.context);\n+    ChainstateManager& chainman = EnsureChainman(node);\n+    PeerManager& peerman = EnsurePeerman(node);\n+\n+    uint256 hash(ParseHashV(request.params[0], \"hash\"));\n+\n+    const NodeId nodeid = static_cast<NodeId>(request.params[1].get_int64());\n+\n+    const CBlockIndex* const index = WITH_LOCK(cs_main, return chainman.m_blockman.LookupBlockIndex(hash););\n+\n+    if (!index) {\n+        throw JSONRPCError(RPC_MISC_ERROR, \"Block header missing\");\n+    }\n+\n+    UniValue result = UniValue::VOBJ;\n+\n+    if (index->nStatus & BLOCK_HAVE_DATA) {\n+        result.pushKV(\"warnings\", \"Block already downloaded\");",
    "path": "src/rpc/blockchain.cpp",
    "position": 127,
    "original_position": 121,
    "commit_id": "434dbbce705ba4c4743d2a6760893bfe077cab5e",
    "original_commit_id": "9181e2e217955fff5f726b0e011afb78fb90af8f",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This branch currently has a silent merge conflict with master. You'll need to rebase and take the `sync_fun=self.no_op` bit before merge.",
    "created_at": "2021-12-01T14:42:19Z",
    "updated_at": "2021-12-01T14:42:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r760249680",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/760249680"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20295#discussion_r760249680"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20295"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/760249680/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 796,
    "original_line": 796,
    "side": "RIGHT",
    "in_reply_to_id": 753897686
  }
]