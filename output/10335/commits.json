[
  {
    "sha": "062c7c1541d29cf213fcb5f59f99f18febb9ed9d",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzowNjJjN2MxNTQxZDI5Y2YyMTNmY2I1ZjU5Zjk5ZjE4ZmViYjllZDlk",
    "commit": {
      "author": {
        "name": "Cory Fields",
        "email": "cory-nospam-@coryfields.com",
        "date": "2017-05-04T16:53:42Z"
      },
      "committer": {
        "name": "Cory Fields",
        "email": "cory-nospam-@coryfields.com",
        "date": "2017-05-04T17:39:37Z"
      },
      "message": "random: make the DevURandom fallback available to all OSs\n\nAdditionally, ensure that getentropy uses the fallback in the event that it's\nunsupported at runtime.",
      "tree": {
        "sha": "f4210bed950d58d22eea0ccfc836747e97f817b1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f4210bed950d58d22eea0ccfc836747e97f817b1"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/062c7c1541d29cf213fcb5f59f99f18febb9ed9d",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/062c7c1541d29cf213fcb5f59f99f18febb9ed9d",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/062c7c1541d29cf213fcb5f59f99f18febb9ed9d",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/062c7c1541d29cf213fcb5f59f99f18febb9ed9d/comments",
    "author": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "35da2aeed7d4000dde93957c3b6e048ab83c4f2b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/35da2aeed7d4000dde93957c3b6e048ab83c4f2b",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/35da2aeed7d4000dde93957c3b6e048ab83c4f2b"
      }
    ],
    "stats": {
      "total": 20,
      "additions": 15,
      "deletions": 5
    },
    "files": [
      {
        "sha": "58d40c1f5867cd0cc9fd384479e48f209f74dcaf",
        "filename": "src/random.cpp",
        "status": "modified",
        "additions": 15,
        "deletions": 5,
        "changes": 20,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/062c7c1541d29cf213fcb5f59f99f18febb9ed9d/src/random.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/062c7c1541d29cf213fcb5f59f99f18febb9ed9d/src/random.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/random.cpp?ref=062c7c1541d29cf213fcb5f59f99f18febb9ed9d",
        "patch": "@@ -102,12 +102,12 @@ static void RandAddSeedPerfmon()\n #endif\n }\n \n-#ifndef WIN32\n /** Fallback: get 32 bytes of system entropy from /dev/urandom. The most\n  * compatible way to get cryptographic randomness on UNIX-ish platforms.\n  */\n void GetDevURandom(unsigned char *ent32)\n {\n+#ifndef WIN32\n     int f = open(\"/dev/urandom\", O_RDONLY);\n     if (f == -1) {\n         RandFailure();\n@@ -121,12 +121,15 @@ void GetDevURandom(unsigned char *ent32)\n         have += n;\n     } while (have < NUM_OS_RANDOM_BYTES);\n     close(f);\n-}\n+#else\n+    RandFailure();\n #endif\n+}\n \n /** Get 32 bytes of system entropy. */\n void GetOSRand(unsigned char *ent32)\n {\n+    bool fUseFallback = false;\n #if defined(WIN32)\n     HCRYPTPROV hProvider;\n     int ret = CryptAcquireContextW(&hProvider, NULL, NULL, PROV_RSA_FULL, CRYPT_VERIFYCONTEXT);\n@@ -151,7 +154,7 @@ void GetOSRand(unsigned char *ent32)\n              * ENOSYS if the syscall is not available, in that case fall back\n              * to /dev/urandom.\n              */\n-            GetDevURandom(ent32);\n+            fUseFallback = true;\n         } else {\n             RandFailure();\n         }\n@@ -162,7 +165,11 @@ void GetOSRand(unsigned char *ent32)\n      * The call cannot return less than the requested number of bytes.\n      */\n     if (getentropy(ent32, NUM_OS_RANDOM_BYTES) != 0) {\n-        RandFailure();\n+        if (errno == ENOSYS) {\n+            fUseFallback = true;\n+        } else {\n+            RandFailure();\n+        }\n     }\n #elif defined(HAVE_SYSCTL_ARND)\n     /* FreeBSD and similar. It is possible for the call to return less\n@@ -181,8 +188,11 @@ void GetOSRand(unsigned char *ent32)\n     /* Fall back to /dev/urandom if there is no specific method implemented to\n      * get system entropy for this OS.\n      */\n-    GetDevURandom(ent32);\n+    fUseFallback = true;\n #endif\n+    if (fUseFallback) {\n+        GetDevURandom(ent32);\n+    }\n }\n \n void GetRandBytes(unsigned char* buf, int num)"
      }
    ]
  },
  {
    "sha": "e596faf8efa211b3b17a555beba81a34dc68d55d",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzplNTk2ZmFmOGVmYTIxMWIzYjE3YTU1NWJlYmE4MWEzNGRjNjhkNTVk",
    "commit": {
      "author": {
        "name": "Cory Fields",
        "email": "cory-nospam-@coryfields.com",
        "date": "2017-05-04T01:01:10Z"
      },
      "committer": {
        "name": "Cory Fields",
        "email": "cory-nospam-@coryfields.com",
        "date": "2017-05-04T17:39:37Z"
      },
      "message": "back-compat: add getentropy stub\n\ngetentropy was added in glibc 2.25. This ensures that binaries linked against\nlater versions have a runtime fallback.\n\nThis fallback simply returns ENOSYS, indicating that /dev/urandom should be\nused instead.",
      "tree": {
        "sha": "9d5f57d486c0a4e9cd7d21a45a163d672ac8ab1a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9d5f57d486c0a4e9cd7d21a45a163d672ac8ab1a"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e596faf8efa211b3b17a555beba81a34dc68d55d",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e596faf8efa211b3b17a555beba81a34dc68d55d",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/e596faf8efa211b3b17a555beba81a34dc68d55d",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e596faf8efa211b3b17a555beba81a34dc68d55d/comments",
    "author": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "062c7c1541d29cf213fcb5f59f99f18febb9ed9d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/062c7c1541d29cf213fcb5f59f99f18febb9ed9d",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/062c7c1541d29cf213fcb5f59f99f18febb9ed9d"
      }
    ],
    "stats": {
      "total": 9,
      "additions": 9,
      "deletions": 0
    },
    "files": [
      {
        "sha": "99eb3759b024998ee8b3b6e4e487fa5e1717cf30",
        "filename": "src/compat/glibc_compat.cpp",
        "status": "modified",
        "additions": 9,
        "deletions": 0,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e596faf8efa211b3b17a555beba81a34dc68d55d/src/compat/glibc_compat.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e596faf8efa211b3b17a555beba81a34dc68d55d/src/compat/glibc_compat.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/compat/glibc_compat.cpp?ref=e596faf8efa211b3b17a555beba81a34dc68d55d",
        "patch": "@@ -7,6 +7,7 @@\n #endif\n \n #include <cstddef>\n+#include <errno.h>\n \n #if defined(HAVE_SYS_SELECT_H)\n #include <sys/select.h>\n@@ -27,3 +28,11 @@ extern \"C\" FDELT_TYPE __fdelt_warn(FDELT_TYPE a)\n     return a / __NFDBITS;\n }\n extern \"C\" FDELT_TYPE __fdelt_chk(FDELT_TYPE) __attribute__((weak, alias(\"__fdelt_warn\")));\n+\n+/* getentropy was introduced with glibc 2.25 */\n+extern \"C\" int int_getentropy(void *buf, size_t buflen)\n+{\n+    errno = ENOSYS;\n+    return -1;\n+}\n+extern \"C\" int getentropy(void *buf, size_t buflen) __attribute__((weak, alias(\"int_getentropy\")));"
      }
    ]
  }
]