[
  {
    "sha": "469a5bc4fa74d70556cce454efbc38fb7945acd8",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0NjlhNWJjNGZhNzRkNzA1NTZjY2U0NTRlZmJjMzhmYjc5NDVhY2Q4",
    "commit": {
      "author": {
        "name": "fanquake",
        "email": "fanquake@gmail.com",
        "date": "2021-05-09T03:32:59Z"
      },
      "committer": {
        "name": "fanquake",
        "email": "fanquake@gmail.com",
        "date": "2021-05-09T05:38:48Z"
      },
      "message": "build: build Boost with -fcf-protection when targeting Darwin\n\nThe LLVM Clang we use for cross-compilation supports this option, and it's expected\nthat any builders on macOS will also be using an Apple Clang that supports it.",
      "tree": {
        "sha": "307292279fbc11f9f00dbcaa23e6c7265e99998b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/307292279fbc11f9f00dbcaa23e6c7265e99998b"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/469a5bc4fa74d70556cce454efbc38fb7945acd8",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEz7FuIclQ9n+pXlWPLuufXMCVJsEFAmCXdWgACgkQLuufXMCV\nJsF9FQ/+JJVywdyq+QYPNh+z8H3z2K4KGmLGfyXp/HapsBFBHl7LWzluar61fSEa\n+Jriy3NhWjU+THlNAo9GEd9nmcHjfkHZd2Ql7UeM41E/82tvVVbcNgUCUkzCWqAA\nKP+UJpIUfR3/sTc9+gkVMTiTyIUWPMgYoYumCqDczPy/zSfuQjzrup3Qs3YCfFLE\nckgBkvWf1eKE2pewNzjT3N+ZukUeIJwnxOIyEEM8hZgdv4UHdybqb2T9j5bHkwML\nNbLs1ALBTOwwKeDjrfI3Gf73xDWVREKMFRyCyEDVpMYBL7FWFVZFpbVwBQTJJFHe\nBBM2umebw3ixQYpS1x08pTac9USB+2dd9NyAsR/2SsGxEDGFq/ZhM4l5IBsMyIzU\nxS7pq6k4680YiGuddMLjSv1RJUlxiM63Bb17Zuk52sm/C3PaR3Uk+sx4vVuhKRNR\nbSfLbwIc8OTA1A63On6XwbEnNcCFt0XYbvycAzjkBmobGiBXSVRnFqfSMjpyiVE0\nwgqmLE8spTYwr8GyeAsbRmzRXhYQaeitJMz7UJWj5MhLIYwzGFNzgTgCdP0Xkv98\nYAjAKJPeBlcYuQE+Yi2aff3qReWja7eNueEDwSD7yIa7+ZzjFlKAYZ8XzRED8SLy\n+DzEmzcuZ63W1FyK4oJJfJGwoATbeeW2sDd6F+GH16hw4EGKiFA=\n=kKWW\n-----END PGP SIGNATURE-----",
        "payload": "tree 307292279fbc11f9f00dbcaa23e6c7265e99998b\nparent 5925f1e652768a9502831b9ccf78d16cf3c37d29\nauthor fanquake <fanquake@gmail.com> 1620531179 +0800\ncommitter fanquake <fanquake@gmail.com> 1620538728 +0800\n\nbuild: build Boost with -fcf-protection when targeting Darwin\n\nThe LLVM Clang we use for cross-compilation supports this option, and it's expected\nthat any builders on macOS will also be using an Apple Clang that supports it.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/469a5bc4fa74d70556cce454efbc38fb7945acd8",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/469a5bc4fa74d70556cce454efbc38fb7945acd8",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/469a5bc4fa74d70556cce454efbc38fb7945acd8/comments",
    "author": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "5925f1e652768a9502831b9ccf78d16cf3c37d29",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5925f1e652768a9502831b9ccf78d16cf3c37d29",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/5925f1e652768a9502831b9ccf78d16cf3c37d29"
      }
    ],
    "stats": {
      "total": 1,
      "additions": 1,
      "deletions": 0
    },
    "files": [
      {
        "sha": "6b3b293140341cacea478df293b1eb72f68cc2a5",
        "filename": "depends/packages/boost.mk",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/469a5bc4fa74d70556cce454efbc38fb7945acd8/depends/packages/boost.mk",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/469a5bc4fa74d70556cce454efbc38fb7945acd8/depends/packages/boost.mk",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/depends/packages/boost.mk?ref=469a5bc4fa74d70556cce454efbc38fb7945acd8",
        "patch": "@@ -26,6 +26,7 @@ $(package)_config_libraries=filesystem,system,test\n $(package)_cxxflags=-std=c++17 -fvisibility=hidden\n $(package)_cxxflags_linux=-fPIC\n $(package)_cxxflags_android=-fPIC\n+$(package)_cxxflags_darwin=-fcf-protection=full\n endef\n \n define $(package)_preprocess_cmds"
      }
    ]
  },
  {
    "sha": "42b589d18fed5e2b3cb6ac9937e3333619967a6c",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0MmI1ODlkMThmZWQ1ZTJiM2NiNmFjOTkzN2UzMzMzNjE5OTY3YTZj",
    "commit": {
      "author": {
        "name": "fanquake",
        "email": "fanquake@gmail.com",
        "date": "2021-05-09T03:33:41Z"
      },
      "committer": {
        "name": "fanquake",
        "email": "fanquake@gmail.com",
        "date": "2021-05-09T06:26:09Z"
      },
      "message": "scripts: test for MACHO control flow instrumentation",
      "tree": {
        "sha": "1ba0197ed8fe7ef3690782637cf890ad6e43d1e1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1ba0197ed8fe7ef3690782637cf890ad6e43d1e1"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/42b589d18fed5e2b3cb6ac9937e3333619967a6c",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEz7FuIclQ9n+pXlWPLuufXMCVJsEFAmCXgIEACgkQLuufXMCV\nJsGIGg/6A+IJO6ugcR1tBQo7oTJoZA0fZbWYnNavvYRxRku80XcYccMznl1ZdiuN\nkHgPSUYeB+cLayzf+e19V/1MXcplLUOn/B7B015AH8ifrcIQEZc7e+g6Q8TqWEVl\nC0N1EIf9/JgUMWSj4IvtF3xTAtXtLipzAfFXL9fvasnZUnYi0MNWB50X2C1Cxhhg\nuGYl2W4bhetzbBnuxCfgb1bMZQKD8RnaaFyDrzcyOQKGfU+rsR4krkwSrZaW9WAG\nlVsnG9B3m/ORy13rpF+pB2cVdAgu/0j9PtKGXs/QoHdyK0ZikJjiyOVfmunECtTv\nnBkl+VgH3tFTcJwCS4O/8g/JBZtQ1w48zHs5YkOQtSmuTBakVSKviQFwLPqUkqx6\n/ebZXhXGiJ+WjEHJl/Z7BqZoaJCXTSsKcNV8WvUrrc0hEKXNcw42lBa5bIxsRVye\n216rfcbUvJq0zwg4y8Id0cuUt5yGM+XSZcVqqIdo1XRMUjv3t38iPOWIamY12rHX\n1KtXiBN3cqdq2IEhzNFZTABL4eUOp8iToEapIlIOL2fjt4hbo26GDocUAWS7SHyK\nJh1bpMena3I51b4pBdLVUVBP/BM5Oqtbz3Q7TjwjWXBd4XbhO4DGmPKUxpl/nrcO\nGIZdptLpcsSQNn/AJ5UJURZjPgIwqXdW6CKQLA2OpSnwMaIb82w=\n=Qr1v\n-----END PGP SIGNATURE-----",
        "payload": "tree 1ba0197ed8fe7ef3690782637cf890ad6e43d1e1\nparent 469a5bc4fa74d70556cce454efbc38fb7945acd8\nauthor fanquake <fanquake@gmail.com> 1620531221 +0800\ncommitter fanquake <fanquake@gmail.com> 1620541569 +0800\n\nscripts: test for MACHO control flow instrumentation\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/42b589d18fed5e2b3cb6ac9937e3333619967a6c",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/42b589d18fed5e2b3cb6ac9937e3333619967a6c",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/42b589d18fed5e2b3cb6ac9937e3333619967a6c/comments",
    "author": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "469a5bc4fa74d70556cce454efbc38fb7945acd8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/469a5bc4fa74d70556cce454efbc38fb7945acd8",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/469a5bc4fa74d70556cce454efbc38fb7945acd8"
      }
    ],
    "stats": {
      "total": 28,
      "additions": 22,
      "deletions": 6
    },
    "files": [
      {
        "sha": "0b59d8eada682c7d84313cfdb110ef9b85892f33",
        "filename": "contrib/devtools/security-check.py",
        "status": "modified",
        "additions": 15,
        "deletions": 1,
        "changes": 16,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/42b589d18fed5e2b3cb6ac9937e3333619967a6c/contrib/devtools/security-check.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/42b589d18fed5e2b3cb6ac9937e3333619967a6c/contrib/devtools/security-check.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/devtools/security-check.py?ref=42b589d18fed5e2b3cb6ac9937e3333619967a6c",
        "patch": "@@ -188,6 +188,19 @@ def check_NX(executable) -> bool:\n     binary = lief.parse(executable)\n     return binary.has_nx\n \n+def check_control_flow(executable) -> bool:\n+    '''\n+    Check for control flow instrumentation\n+    '''\n+    binary = lief.parse(executable)\n+\n+    content = binary.get_content_from_virtual_address(binary.entrypoint, 4, lief.Binary.VA_TYPES.AUTO)\n+\n+    if content == [243, 15, 30, 250]: # endbr64\n+        return True\n+    return False\n+\n+\n CHECKS = {\n 'ELF': [\n     ('PIE', check_ELF_PIE),\n@@ -208,7 +221,8 @@ def check_NX(executable) -> bool:\n     ('NOUNDEFS', check_MACHO_NOUNDEFS),\n     ('NX', check_NX),\n     ('LAZY_BINDINGS', check_MACHO_LAZY_BINDINGS),\n-    ('Canary', check_MACHO_Canary)\n+    ('Canary', check_MACHO_Canary),\n+    ('CONTROL_FLOW', check_control_flow),\n ]\n }\n "
      },
      {
        "sha": "c079fe5b4d11e6bd6c7d0a367c54aff6b1fd821a",
        "filename": "contrib/devtools/test-security-check.py",
        "status": "modified",
        "additions": 7,
        "deletions": 5,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/42b589d18fed5e2b3cb6ac9937e3333619967a6c/contrib/devtools/test-security-check.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/42b589d18fed5e2b3cb6ac9937e3333619967a6c/contrib/devtools/test-security-check.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/devtools/test-security-check.py?ref=42b589d18fed5e2b3cb6ac9937e3333619967a6c",
        "patch": "@@ -77,16 +77,18 @@ def test_MACHO(self):\n         write_testcode(source)\n \n         self.assertEqual(call_security_check(cc, source, executable, ['-Wl,-no_pie','-Wl,-flat_namespace','-Wl,-allow_stack_execute','-fno-stack-protector']),\n-            (1, executable+': failed PIE NOUNDEFS NX LAZY_BINDINGS Canary'))\n+            (1, executable+': failed PIE NOUNDEFS NX LAZY_BINDINGS Canary CONTROL_FLOW'))\n         self.assertEqual(call_security_check(cc, source, executable, ['-Wl,-no_pie','-Wl,-flat_namespace','-Wl,-allow_stack_execute','-fstack-protector-all']),\n-            (1, executable+': failed PIE NOUNDEFS NX LAZY_BINDINGS'))\n+            (1, executable+': failed PIE NOUNDEFS NX LAZY_BINDINGS CONTROL_FLOW'))\n         self.assertEqual(call_security_check(cc, source, executable, ['-Wl,-no_pie','-Wl,-flat_namespace','-fstack-protector-all']),\n-            (1, executable+': failed PIE NOUNDEFS LAZY_BINDINGS'))\n+            (1, executable+': failed PIE NOUNDEFS LAZY_BINDINGS CONTROL_FLOW'))\n         self.assertEqual(call_security_check(cc, source, executable, ['-Wl,-no_pie','-fstack-protector-all']),\n-            (1, executable+': failed PIE LAZY_BINDINGS'))\n+            (1, executable+': failed PIE LAZY_BINDINGS CONTROL_FLOW'))\n         self.assertEqual(call_security_check(cc, source, executable, ['-Wl,-no_pie','-Wl,-bind_at_load','-fstack-protector-all']),\n+            (1, executable+': failed PIE CONTROL_FLOW'))\n+        self.assertEqual(call_security_check(cc, source, executable, ['-Wl,-no_pie','-Wl,-bind_at_load','-fstack-protector-all', '-fcf-protection=full']),\n             (1, executable+': failed PIE'))\n-        self.assertEqual(call_security_check(cc, source, executable, ['-Wl,-pie','-Wl,-bind_at_load','-fstack-protector-all']),\n+        self.assertEqual(call_security_check(cc, source, executable, ['-Wl,-pie','-Wl,-bind_at_load','-fstack-protector-all', '-fcf-protection=full']),\n             (0, ''))\n \n         clean_files(source, executable)"
      }
    ]
  }
]