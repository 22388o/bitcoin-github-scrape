MarcoFalke,2020-06-12 18:25:26,"Concept ACK. There shouldn't be a reason for a node to send filterclear when we haven't offered them bloom services to them.\n\nSee also BIP 111: \n\n> If a node does not support bloom filters but receives a ""filterload"", ""filteradd"", or ""filterclear"" message from a peer the node should disconnect that peer immediately\n\nhttps://github.com/bitcoin/bips/blob/master/bip-0111.mediawiki\n\nni",https://github.com/bitcoin/bitcoin/pull/19260#issuecomment-643422188,643422188,
DrahtBot,2020-06-13 02:50:10,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19252 (test: wait for disconnect in disconnect_p2ps + bloomfilter test followups by gzhao408)\n\nIf you consider this pul",https://github.com/bitcoin/bitcoin/pull/19260#issuecomment-643557995,643557995,
jnewbery,2020-06-14 00:42:40,"Code review ACK 18a2e0a3f7071b8df6b20ecc1b34b3f2abb13cfc\n\nGreat tidy-up. Thanks Gloria!",https://github.com/bitcoin/bitcoin/pull/19260#issuecomment-643701023,643701023,
naumenkogs,2020-06-14 07:35:55,"utACK 18a2e0a\n\nI was somewhat confused by the last commit, because the description of the PR is about `filterclear`, but the last commit has absolutely nothing to do with `filterclear`.\nNot sure if we want to do anything about it :)",https://github.com/bitcoin/bitcoin/pull/19260#issuecomment-643730843,643730843,
MarcoFalke,2020-06-15 10:59:19,"re-ACK 3a10d935ac only change is replacing false with true üöù\n\n<details><summary>Show signature and timestamp</summary>\n\nSignature:\n\n```\n-----BEGIN PGP SIGNED MESSAGE-----\nHash: SHA512\n\nre-ACK 3a10d935ac only change is replacing false with true üöù\n-----BEGIN PGP SIGNATURE-----\n\niQGzBAEBCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\npUiicAwAuImcvIy26lnaw4VoTkzdS0",https://github.com/bitcoin/bitcoin/pull/19260#issuecomment-644058579,644058579,
jnewbery,2020-06-15 13:21:25,Code review ACK 3a10d935ac8ebabdfd336569d943f042ff84b13e,https://github.com/bitcoin/bitcoin/pull/19260#issuecomment-644131218,644131218,
gillichu,2020-06-15 17:16:36,"Concept ACK, I just learned a lot about how bloom filters are used in Bitcoin. ",https://github.com/bitcoin/bitcoin/pull/19260#issuecomment-644262136,644262136,
gillichu,2020-06-15 18:46:58,tested ACK: quick test_runner on macOS [`3a10d93`](https://github.com/bitcoin/bitcoin/commit/3a10d935ac8ebabdfd336569d943f042ff84b13e),https://github.com/bitcoin/bitcoin/pull/19260#issuecomment-644312380,644312380,
glozow,2020-06-15 18:49:25,"üòÇ  Thanks @gillichu, I really appreciate the effort üôè  \n\nIt's \[\`commit\`\]\(link\)",https://github.com/bitcoin/bitcoin/pull/19260#issuecomment-644313610,644313610,
jnewbery,2020-06-15 20:53:32,"> It's \[\`commit\`\]\(link\)\n\nNo need to use markdown for links to the commit hash. Just paste the full hash and github will automatically convert it to a link to commit.",https://github.com/bitcoin/bitcoin/pull/19260#issuecomment-644383655,644383655,
glozow,2020-06-15 21:36:03,"> Just paste the full hash and github will automatically convert it to a link to commit.\n\nWHAT I've been using markdown this whole time üò≠ ",https://github.com/bitcoin/bitcoin/pull/19260#issuecomment-644403226,644403226,
naumenkogs,2020-06-16 06:39:42,utACK 3a10d93,https://github.com/bitcoin/bitcoin/pull/19260#issuecomment-644563951,644563951,
rebroad,2021-05-03 07:24:11,"> Concept ACK. There shouldn't be a reason for a node to send filterclear when we haven't offered them bloom services to them.\n> \n> See also BIP 111:\n> \n> > If a node does not support bloom filters but receives a ""filterload"", ""filteradd"", or ""filterclear"" message from a peer the node should disconnect that peer immediately\n> \n> https://github.com/bitcoin/bips/blob/master/bip-0111.medi",https://github.com/bitcoin/bitcoin/pull/19260#issuecomment-831076188,831076188,
MarcoFalke,2021-05-03 07:52:48,"@rebroad Please, there is no reason to leave comments on three pull requests to ask questions. The thread you created in #21839 is sufficient.",https://github.com/bitcoin/bitcoin/pull/19260#issuecomment-831090015,831090015,
glozow,2020-06-12 21:11:59,This code block is repeated 3 times and bloats the `ProcessMessage` function. Would a helper function like `MaybePunishNodeForBloom` be appropriate or is this fine?,https://github.com/bitcoin/bitcoin/pull/19260#discussion_r439644235,439644235,src/net_processing.cpp
jnewbery,2020-06-13 02:39:41,"Yes, but I think you can also just reduce the complexity here. I don't think there's any benefit to calling `Misbehaving()` on a peer that sends us a `FILTER*` message. Calling `Misbehaving(100)` results in us disconnecting the peer and then marking it discouraged (see #19219). Discouragement is a mechanism to prevent our limited connection slots being used up by incompatible or broken peers.\n\",https://github.com/bitcoin/bitcoin/pull/19260#discussion_r439701965,439701965,src/net_processing.cpp
MarcoFalke,2020-06-13 11:46:46,"In theory it is possible to set `-banscore=101` to not disconnect a 100-misbehaving peer. Though, that would only kick down the can by one more message. I can't see a use case for that and encouraging users to change banscore to accomodate misbehaving light clients seems ill-advised. So I agree with the suggestion made by @jnewbery (simply make an fDisconnect)",https://github.com/bitcoin/bitcoin/pull/19260#discussion_r439732937,439732937,src/net_processing.cpp
jnewbery,2020-06-13 14:50:39,We should remove `-banscore` entirely. It's not useful user configuration.,https://github.com/bitcoin/bitcoin/pull/19260#discussion_r439744787,439744787,src/net_processing.cpp
glozow,2020-06-13 20:05:15,Thanks for the suggestion! I've updated it but I think Travis timed out on one of the builds.,https://github.com/bitcoin/bitcoin/pull/19260#discussion_r439765489,439765489,src/net_processing.cpp
MarcoFalke,2020-06-14 13:05:22,"in commit 294b96772b7d184a0cd6f56bd76ef118f4c78cc6:\n\nAny reason to return false here? The only effect is that it will log a line with `FAILED` with the NET debug category. However, it should be pretty clear from the log already that receiving a filterclear message and then disconnecting a peer means the message was ignored.",https://github.com/bitcoin/bitcoin/pull/19260#discussion_r439828128,439828128,src/net_processing.cpp
MarcoFalke,2020-06-14 13:07:37,"in commit 18a2e0a3f7071b8df6b20ecc1b34b3f2abb13cfc:\n\nSame",https://github.com/bitcoin/bitcoin/pull/19260#discussion_r439828305,439828305,src/net_processing.cpp
naumenkogs,2020-06-14 13:53:37,"I was confused here too, but it seems like this is a common thing to do. Many occurences of \n``\n             pfrom.fDisconnect = true;\n            return false; \n``",https://github.com/bitcoin/bitcoin/pull/19260#discussion_r439832289,439832289,src/net_processing.cpp
MarcoFalke,2020-06-14 14:02:09,The majority of disconnects is followed by a `return true;`. The ones that don't should be changed too. And longer term the return value should be removed completely.,https://github.com/bitcoin/bitcoin/pull/19260#discussion_r439833059,439833059,src/net_processing.cpp
glozow,2020-06-14 18:54:22,"Thanks! Yup, my reasoning was that's what it looked like in other places üòÖ ",https://github.com/bitcoin/bitcoin/pull/19260#discussion_r439857807,439857807,src/net_processing.cpp
