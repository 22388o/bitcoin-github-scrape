[
  {
    "sha": "e4ef4b459548b4032b9da03b3103525f935acb82",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzplNGVmNGI0NTk1NDhiNDAzMmI5ZGEwM2IzMTAzNTI1ZjkzNWFjYjgy",
    "commit": {
      "author": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2018-09-12T14:05:00Z"
      },
      "committer": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2018-09-13T13:37:37Z"
      },
      "message": "[build] remove #ifdef ENABLE_WALLET from interfaces/node\n\nRemoves the final #ifdef ENABLE_WALLET from libbitcoin_server by calling\ng_wallet_init_interface.HasWalletSupport(), and redifining GetWallets()\nand MakeWallet() in dummywallet.cpp.",
      "tree": {
        "sha": "fd50dca509852d8a1765da3ab50adf8b71a4d842",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/fd50dca509852d8a1765da3ab50adf8b71a4d842"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e4ef4b459548b4032b9da03b3103525f935acb82",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e4ef4b459548b4032b9da03b3103525f935acb82",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/e4ef4b459548b4032b9da03b3103525f935acb82",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e4ef4b459548b4032b9da03b3103525f935acb82/comments",
    "author": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "8f464549c46db2954d7b64d1feb200eb35f2e7e8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8f464549c46db2954d7b64d1feb200eb35f2e7e8",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/8f464549c46db2954d7b64d1feb200eb35f2e7e8"
      }
    ],
    "stats": {
      "total": 42,
      "additions": 27,
      "deletions": 15
    },
    "files": [
      {
        "sha": "3714187a9640de92625f72fb0ccbd85dd54a5fd7",
        "filename": "src/dummywallet.cpp",
        "status": "modified",
        "additions": 18,
        "deletions": 0,
        "changes": 18,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e4ef4b459548b4032b9da03b3103525f935acb82/src/dummywallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e4ef4b459548b4032b9da03b3103525f935acb82/src/dummywallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/dummywallet.cpp?ref=e4ef4b459548b4032b9da03b3103525f935acb82",
        "patch": "@@ -6,6 +6,8 @@\n #include <util.h>\n #include <walletinitinterface.h>\n \n+class CWallet;\n+\n class DummyWalletInit : public WalletInitInterface {\n public:\n \n@@ -31,3 +33,19 @@ void DummyWalletInit::AddWalletOptions() const\n }\n \n const WalletInitInterface& g_wallet_init_interface = DummyWalletInit();\n+\n+std::vector<std::shared_ptr<CWallet>> GetWallets()\n+{\n+    throw std::logic_error(\"Wallet function called in non-wallet build.\");\n+}\n+\n+namespace interfaces {\n+\n+class Wallet;\n+\n+std::unique_ptr<Wallet> MakeWallet(const std::shared_ptr<CWallet>& wallet)\n+{\n+    throw std::logic_error(\"Wallet function called in non-wallet build.\");\n+}\n+\n+} // namespace interfaces"
      },
      {
        "sha": "d95b41657ce29b289c384c75102f21354716fc29",
        "filename": "src/interfaces/node.cpp",
        "status": "modified",
        "additions": 7,
        "deletions": 13,
        "changes": 20,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e4ef4b459548b4032b9da03b3103525f935acb82/src/interfaces/node.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e4ef4b459548b4032b9da03b3103525f935acb82/src/interfaces/node.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/interfaces/node.cpp?ref=e4ef4b459548b4032b9da03b3103525f935acb82",
        "patch": "@@ -32,19 +32,18 @@\n #if defined(HAVE_CONFIG_H)\n #include <config/bitcoin-config.h>\n #endif\n-#ifdef ENABLE_WALLET\n-#include <wallet/fees.h>\n-#include <wallet/wallet.h>\n-#define CHECK_WALLET(x) x\n-#else\n-#define CHECK_WALLET(x) throw std::logic_error(\"Wallet function called in non-wallet build.\")\n-#endif\n \n #include <atomic>\n #include <boost/thread/thread.hpp>\n #include <univalue.h>\n \n+class CWallet;\n+std::vector<std::shared_ptr<CWallet>> GetWallets();\n+\n namespace interfaces {\n+\n+class Wallet;\n+\n namespace {\n \n class NodeImpl : public Node\n@@ -221,15 +220,11 @@ class NodeImpl : public Node\n     }\n     std::vector<std::unique_ptr<Wallet>> getWallets() override\n     {\n-#ifdef ENABLE_WALLET\n         std::vector<std::unique_ptr<Wallet>> wallets;\n         for (const std::shared_ptr<CWallet>& wallet : GetWallets()) {\n             wallets.emplace_back(MakeWallet(wallet));\n         }\n         return wallets;\n-#else\n-        throw std::logic_error(\"Node::getWallets() called in non-wallet build.\");\n-#endif\n     }\n     std::unique_ptr<Handler> handleInitMessage(InitMessageFn fn) override\n     {\n@@ -249,8 +244,7 @@ class NodeImpl : public Node\n     }\n     std::unique_ptr<Handler> handleLoadWallet(LoadWalletFn fn) override\n     {\n-        CHECK_WALLET(\n-            return MakeHandler(::uiInterface.LoadWallet_connect([fn](std::shared_ptr<CWallet> wallet) { fn(MakeWallet(wallet)); })));\n+        return MakeHandler(::uiInterface.LoadWallet_connect([fn](std::shared_ptr<CWallet> wallet) { fn(MakeWallet(wallet)); }));\n     }\n     std::unique_ptr<Handler> handleNotifyNumConnectionsChanged(NotifyNumConnectionsChangedFn fn) override\n     {"
      },
      {
        "sha": "7aa91f37e10843f5c6611c4daf46129aaf9081cc",
        "filename": "src/interfaces/wallet.h",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e4ef4b459548b4032b9da03b3103525f935acb82/src/interfaces/wallet.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e4ef4b459548b4032b9da03b3103525f935acb82/src/interfaces/wallet.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/interfaces/wallet.h?ref=e4ef4b459548b4032b9da03b3103525f935acb82",
        "patch": "@@ -366,8 +366,8 @@ struct WalletTxOut\n     bool is_spent = false;\n };\n \n-//! Return implementation of Wallet interface. This function will be undefined\n-//! in builds where ENABLE_WALLET is false.\n+//! Return implementation of Wallet interface. This function is defined in\n+//! dummywallet.cpp and throws if the wallet component is not compiled.\n std::unique_ptr<Wallet> MakeWallet(const std::shared_ptr<CWallet>& wallet);\n \n } // namespace interfaces"
      }
    ]
  }
]