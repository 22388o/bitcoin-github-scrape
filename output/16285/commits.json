[
  {
    "sha": "fc0c410d6e19dd8e3abbc9b0fc13c836e6678750",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYzBjNDEwZDZlMTlkZDhlM2FiYmM5YjBmYzEzYzgzNmU2Njc4NzUw",
    "commit": {
      "author": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2019-06-25T16:02:59Z"
      },
      "committer": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2019-09-08T23:51:31Z"
      },
      "message": "rpc: Improve scantxoutset response and help message",
      "tree": {
        "sha": "c6bfe923830a0530b77ec5e37416b389d5938407",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c6bfe923830a0530b77ec5e37416b389d5938407"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fc0c410d6e19dd8e3abbc9b0fc13c836e6678750",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fc0c410d6e19dd8e3abbc9b0fc13c836e6678750",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fc0c410d6e19dd8e3abbc9b0fc13c836e6678750",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fc0c410d6e19dd8e3abbc9b0fc13c836e6678750/comments",
    "author": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "332c6134bb15384e5b91c631e821fe52a591d3bc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/332c6134bb15384e5b91c631e821fe52a591d3bc",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/332c6134bb15384e5b91c631e821fe52a591d3bc"
      }
    ],
    "stats": {
      "total": 29,
      "additions": 19,
      "deletions": 10
    },
    "files": [
      {
        "sha": "8a541ecde180c1e45ea919294e19bd727bf5ab5a",
        "filename": "src/rpc/blockchain.cpp",
        "status": "modified",
        "additions": 19,
        "deletions": 10,
        "changes": 29,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fc0c410d6e19dd8e3abbc9b0fc13c836e6678750/src/rpc/blockchain.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fc0c410d6e19dd8e3abbc9b0fc13c836e6678750/src/rpc/blockchain.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpc/blockchain.cpp?ref=fc0c410d6e19dd8e3abbc9b0fc13c836e6678750",
        "patch": "@@ -2199,17 +2199,21 @@ UniValue scantxoutset(const JSONRPCRequest& request)\n                 },\n                 RPCResult{\n             \"{\\n\"\n+            \"  \\\"success\\\": true|false,         (boolean) Whether the scan was completed\\n\"\n+            \"  \\\"txouts\\\": n,                   (numeric) The number of unspent transaction outputs scanned\\n\"\n+            \"  \\\"height\\\": n,                   (numeric) The current block height (index)\\n\"\n+            \"  \\\"bestblock\\\": \\\"hex\\\",            (string) The hash of the block at the tip of the chain\\n\"\n             \"  \\\"unspents\\\": [\\n\"\n-            \"    {\\n\"\n-            \"    \\\"txid\\\" : \\\"transactionid\\\",     (string) The transaction id\\n\"\n-            \"    \\\"vout\\\": n,                    (numeric) the vout value\\n\"\n-            \"    \\\"scriptPubKey\\\" : \\\"script\\\",    (string) the script key\\n\"\n-            \"    \\\"desc\\\" : \\\"descriptor\\\",        (string) A specialized descriptor for the matched scriptPubKey\\n\"\n-            \"    \\\"amount\\\" : x.xxx,             (numeric) The total amount in \" + CURRENCY_UNIT + \" of the unspent output\\n\"\n-            \"    \\\"height\\\" : n,                 (numeric) Height of the unspent transaction output\\n\"\n+            \"   {\\n\"\n+            \"    \\\"txid\\\": \\\"hash\\\",              (string) The transaction id\\n\"\n+            \"    \\\"vout\\\": n,                   (numeric) The vout value\\n\"\n+            \"    \\\"scriptPubKey\\\": \\\"script\\\",    (string) The script key\\n\"\n+            \"    \\\"desc\\\": \\\"descriptor\\\",        (string) A specialized descriptor for the matched scriptPubKey\\n\"\n+            \"    \\\"amount\\\": x.xxx,             (numeric) The total amount in \" + CURRENCY_UNIT + \" of the unspent output\\n\"\n+            \"    \\\"height\\\": n,                 (numeric) Height of the unspent transaction output\\n\"\n             \"   }\\n\"\n-            \"   ,...], \\n\"\n-            \" \\\"total_amount\\\" : x.xxx,          (numeric) The total amount of all found unspent outputs in \" + CURRENCY_UNIT + \"\\n\"\n+            \"   ,...],\\n\"\n+            \"  \\\"total_amount\\\": x.xxx,          (numeric) The total amount of all found unspent outputs in \" + CURRENCY_UNIT + \"\\n\"\n             \"]\\n\"\n                 },\n                 RPCExamples{\"\"},\n@@ -2293,15 +2297,20 @@ UniValue scantxoutset(const JSONRPCRequest& request)\n         g_scan_progress = 0;\n         int64_t count = 0;\n         std::unique_ptr<CCoinsViewCursor> pcursor;\n+        CBlockIndex* tip;\n         {\n             LOCK(cs_main);\n             ::ChainstateActive().ForceFlushStateToDisk();\n             pcursor = std::unique_ptr<CCoinsViewCursor>(pcoinsdbview->Cursor());\n             assert(pcursor);\n+            tip = ::ChainActive().Tip();\n+            assert(tip);\n         }\n         bool res = FindScriptPubKey(g_scan_progress, g_should_abort_scan, count, pcursor.get(), needles, coins);\n         result.pushKV(\"success\", res);\n-        result.pushKV(\"searched_items\", count);\n+        result.pushKV(\"txouts\", count);\n+        result.pushKV(\"height\", tip->nHeight);\n+        result.pushKV(\"bestblock\", tip->GetBlockHash().GetHex());\n \n         for (const auto& it : coins) {\n             const COutPoint& outpoint = it.first;"
      }
    ]
  },
  {
    "sha": "bdd6a4fd5da44c2575be9195ecb4213a13e74511",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiZGQ2YTRmZDVkYTQ0YzI1NzViZTkxOTVlY2I0MjEzYTEzZTc0NTEx",
    "commit": {
      "author": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2019-06-25T16:03:50Z"
      },
      "committer": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2019-09-08T23:51:31Z"
      },
      "message": "qa: Check scantxoutset result against gettxoutsetinfo",
      "tree": {
        "sha": "98e96b83962f851c9c745142866aff7ebf425f74",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/98e96b83962f851c9c745142866aff7ebf425f74"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/bdd6a4fd5da44c2575be9195ecb4213a13e74511",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bdd6a4fd5da44c2575be9195ecb4213a13e74511",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/bdd6a4fd5da44c2575be9195ecb4213a13e74511",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bdd6a4fd5da44c2575be9195ecb4213a13e74511/comments",
    "author": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "fc0c410d6e19dd8e3abbc9b0fc13c836e6678750",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fc0c410d6e19dd8e3abbc9b0fc13c836e6678750",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/fc0c410d6e19dd8e3abbc9b0fc13c836e6678750"
      }
    ],
    "stats": {
      "total": 7,
      "additions": 7,
      "deletions": 0
    },
    "files": [
      {
        "sha": "9f94d11a93f23e9196ca60c5cd914a7b47e5033d",
        "filename": "test/functional/rpc_scantxoutset.py",
        "status": "modified",
        "additions": 7,
        "deletions": 0,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/bdd6a4fd5da44c2575be9195ecb4213a13e74511/test/functional/rpc_scantxoutset.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/bdd6a4fd5da44c2575be9195ecb4213a13e74511/test/functional/rpc_scantxoutset.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/rpc_scantxoutset.py?ref=bdd6a4fd5da44c2575be9195ecb4213a13e74511",
        "patch": "@@ -58,6 +58,13 @@ def run_test(self):\n         self.start_node(0)\n         self.nodes[0].generate(110)\n \n+        scan = self.nodes[0].scantxoutset(\"start\", [])\n+        info = self.nodes[0].gettxoutsetinfo()\n+        assert_equal(scan['success'], True)\n+        assert_equal(scan['height'], info['height'])\n+        assert_equal(scan['txouts'], info['txouts'])\n+        assert_equal(scan['bestblock'], info['bestblock'])\n+\n         self.restart_node(0, ['-nowallet'])\n         self.log.info(\"Test if we have found the non HD unspent outputs.\")\n         assert_equal(self.nodes[0].scantxoutset(\"start\", [ \"pkh(\" + pubk1 + \")\", \"pkh(\" + pubk2 + \")\", \"pkh(\" + pubk3 + \")\"])['total_amount'], Decimal(\"0.002\"))"
      }
    ]
  }
]