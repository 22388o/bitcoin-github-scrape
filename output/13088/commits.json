[
  {
    "sha": "4348366585c83d55b68077409c062648b03bdfdf",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0MzQ4MzY2NTg1YzgzZDU1YjY4MDc3NDA5YzA2MjY0OGIwM2JkZmRm",
    "commit": {
      "author": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2018-05-03T00:14:01Z"
      },
      "committer": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2018-09-03T07:46:23Z"
      },
      "message": "Replace OpenDebugLog() with StartLogging()\n\nStartLogging() is used to mark the start of logging generically, whether\nusing -printtoconsole or -debuglogfile.",
      "tree": {
        "sha": "bcc4d9808871d6435218c489b99481860a36c451",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/bcc4d9808871d6435218c489b99481860a36c451"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4348366585c83d55b68077409c062648b03bdfdf",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4348366585c83d55b68077409c062648b03bdfdf",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/4348366585c83d55b68077409c062648b03bdfdf",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4348366585c83d55b68077409c062648b03bdfdf/comments",
    "author": {
      "login": "ajtowns",
      "id": 127186,
      "node_id": "MDQ6VXNlcjEyNzE4Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajtowns",
      "html_url": "https://github.com/ajtowns",
      "followers_url": "https://api.github.com/users/ajtowns/followers",
      "following_url": "https://api.github.com/users/ajtowns/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajtowns/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
      "organizations_url": "https://api.github.com/users/ajtowns/orgs",
      "repos_url": "https://api.github.com/users/ajtowns/repos",
      "events_url": "https://api.github.com/users/ajtowns/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajtowns/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "ajtowns",
      "id": 127186,
      "node_id": "MDQ6VXNlcjEyNzE4Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajtowns",
      "html_url": "https://github.com/ajtowns",
      "followers_url": "https://api.github.com/users/ajtowns/followers",
      "following_url": "https://api.github.com/users/ajtowns/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajtowns/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
      "organizations_url": "https://api.github.com/users/ajtowns/orgs",
      "repos_url": "https://api.github.com/users/ajtowns/repos",
      "events_url": "https://api.github.com/users/ajtowns/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajtowns/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "68f3c7eb080e461cfeac37f8db7034fe507241d0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/68f3c7eb080e461cfeac37f8db7034fe507241d0",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/68f3c7eb080e461cfeac37f8db7034fe507241d0"
      }
    ],
    "stats": {
      "total": 13,
      "additions": 7,
      "deletions": 6
    },
    "files": [
      {
        "sha": "08a8536573ebaa3b5980189abbbf98cd656de72d",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 4,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4348366585c83d55b68077409c062648b03bdfdf/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4348366585c83d55b68077409c062648b03bdfdf/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=4348366585c83d55b68077409c062648b03bdfdf",
        "patch": "@@ -1233,10 +1233,10 @@ bool AppInitMain()\n             // and because this needs to happen before any other debug.log printing\n             g_logger->ShrinkDebugFile();\n         }\n-        if (!g_logger->OpenDebugLog()) {\n-            return InitError(strprintf(\"Could not open debug log file %s\",\n-                                       g_logger->m_file_path.string()));\n-        }\n+    }\n+    if (!g_logger->StartLogging()) {\n+        return InitError(strprintf(\"Could not open debug log file %s\",\n+                                   g_logger->m_file_path.string()));\n     }\n \n     if (!g_logger->m_log_timestamps)"
      },
      {
        "sha": "a54739be9b948b5010ca279bbc2979d61331d572",
        "filename": "src/logging.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4348366585c83d55b68077409c062648b03bdfdf/src/logging.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4348366585c83d55b68077409c062648b03bdfdf/src/logging.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/logging.cpp?ref=4348366585c83d55b68077409c062648b03bdfdf",
        "patch": "@@ -30,9 +30,10 @@ static int FileWriteStr(const std::string &str, FILE *fp)\n     return fwrite(str.data(), 1, str.size(), fp);\n }\n \n-bool BCLog::Logger::OpenDebugLog()\n+bool BCLog::Logger::StartLogging()\n {\n     std::lock_guard<std::mutex> scoped_lock(m_file_mutex);\n+    if (!m_print_to_file) return true;\n \n     assert(m_fileout == nullptr);\n     assert(!m_file_path.empty());"
      },
      {
        "sha": "f163bd0ad5e149dbe7852642b03988c9c780c8c0",
        "filename": "src/logging.h",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4348366585c83d55b68077409c062648b03bdfdf/src/logging.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4348366585c83d55b68077409c062648b03bdfdf/src/logging.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/logging.h?ref=4348366585c83d55b68077409c062648b03bdfdf",
        "patch": "@@ -91,7 +91,7 @@ namespace BCLog {\n         /** Returns whether logs will be written to any output */\n         bool Enabled() const { return m_print_to_console || m_print_to_file; }\n \n-        bool OpenDebugLog();\n+        bool StartLogging();\n         void ShrinkDebugFile();\n \n         uint32_t GetCategoryMask() const { return m_categories.load(); }"
      }
    ]
  },
  {
    "sha": "bf6c20da4c0c86cd2c887712e19e01189eb66aec",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiZjZjMjBkYTRjMGM4NmNkMmM4ODc3MTJlMTllMDExODllYjY2YWVj",
    "commit": {
      "author": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2018-05-03T01:09:28Z"
      },
      "committer": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2018-09-03T07:48:57Z"
      },
      "message": "Log early messages with -printtoconsole\n\nThis ensures log messages prior to StartLogging() are replayed to\nthe console as well as to the debug log file.",
      "tree": {
        "sha": "409750988fe4900f7d1fc061f03d62954278ff85",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/409750988fe4900f7d1fc061f03d62954278ff85"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/bf6c20da4c0c86cd2c887712e19e01189eb66aec",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bf6c20da4c0c86cd2c887712e19e01189eb66aec",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/bf6c20da4c0c86cd2c887712e19e01189eb66aec",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bf6c20da4c0c86cd2c887712e19e01189eb66aec/comments",
    "author": {
      "login": "ajtowns",
      "id": 127186,
      "node_id": "MDQ6VXNlcjEyNzE4Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajtowns",
      "html_url": "https://github.com/ajtowns",
      "followers_url": "https://api.github.com/users/ajtowns/followers",
      "following_url": "https://api.github.com/users/ajtowns/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajtowns/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
      "organizations_url": "https://api.github.com/users/ajtowns/orgs",
      "repos_url": "https://api.github.com/users/ajtowns/repos",
      "events_url": "https://api.github.com/users/ajtowns/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajtowns/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "ajtowns",
      "id": 127186,
      "node_id": "MDQ6VXNlcjEyNzE4Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajtowns",
      "html_url": "https://github.com/ajtowns",
      "followers_url": "https://api.github.com/users/ajtowns/followers",
      "following_url": "https://api.github.com/users/ajtowns/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajtowns/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
      "organizations_url": "https://api.github.com/users/ajtowns/orgs",
      "repos_url": "https://api.github.com/users/ajtowns/repos",
      "events_url": "https://api.github.com/users/ajtowns/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajtowns/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "4348366585c83d55b68077409c062648b03bdfdf",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4348366585c83d55b68077409c062648b03bdfdf",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/4348366585c83d55b68077409c062648b03bdfdf"
      }
    ],
    "stats": {
      "total": 70,
      "additions": 40,
      "deletions": 30
    },
    "files": [
      {
        "sha": "91ccadb2873de83b4227b225e53c64959573b24f",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 0,
        "deletions": 5,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/bf6c20da4c0c86cd2c887712e19e01189eb66aec/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/bf6c20da4c0c86cd2c887712e19e01189eb66aec/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=bf6c20da4c0c86cd2c887712e19e01189eb66aec",
        "patch": "@@ -826,11 +826,6 @@ void InitLogging()\n     g_logger->m_print_to_file = !gArgs.IsArgNegated(\"-debuglogfile\");\n     g_logger->m_file_path = AbsPathForConfigVal(gArgs.GetArg(\"-debuglogfile\", DEFAULT_DEBUGLOGFILE));\n \n-    // Add newlines to the logfile to distinguish this execution from the last\n-    // one; called before console logging is set up, so this is only sent to\n-    // debug.log.\n-    LogPrintf(\"\\n\\n\\n\\n\\n\");\n-\n     g_logger->m_print_to_console = gArgs.GetBoolArg(\"-printtoconsole\", !gArgs.GetBoolArg(\"-daemon\", false));\n     g_logger->m_log_timestamps = gArgs.GetBoolArg(\"-logtimestamps\", DEFAULT_LOGTIMESTAMPS);\n     g_logger->m_log_time_micros = gArgs.GetBoolArg(\"-logtimemicros\", DEFAULT_LOGTIMEMICROS);"
      },
      {
        "sha": "a01a4cc79c0fcabb196eff4f02349f0ee0765cdd",
        "filename": "src/logging.cpp",
        "status": "modified",
        "additions": 38,
        "deletions": 24,
        "changes": 62,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/bf6c20da4c0c86cd2c887712e19e01189eb66aec/src/logging.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/bf6c20da4c0c86cd2c887712e19e01189eb66aec/src/logging.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/logging.cpp?ref=bf6c20da4c0c86cd2c887712e19e01189eb66aec",
        "patch": "@@ -33,22 +33,35 @@ static int FileWriteStr(const std::string &str, FILE *fp)\n bool BCLog::Logger::StartLogging()\n {\n     std::lock_guard<std::mutex> scoped_lock(m_file_mutex);\n-    if (!m_print_to_file) return true;\n \n+    assert(m_buffering);\n     assert(m_fileout == nullptr);\n     assert(!m_file_path.empty());\n \n-    m_fileout = fsbridge::fopen(m_file_path, \"a\");\n-    if (!m_fileout) {\n-        return false;\n+    if (m_print_to_file) {\n+        m_fileout = fsbridge::fopen(m_file_path, \"a\");\n+        if (!m_fileout) {\n+            return false;\n+        }\n+\n+        setbuf(m_fileout, nullptr); // unbuffered\n+\n+        // Add newlines to the logfile to distinguish this execution from the\n+        // last one.\n+        FileWriteStr(\"\\n\\n\\n\\n\\n\", m_fileout);\n     }\n \n-    setbuf(m_fileout, nullptr); // unbuffered\n     // dump buffered messages from before we opened the log\n+    m_buffering = false;\n     while (!m_msgs_before_open.empty()) {\n-        FileWriteStr(m_msgs_before_open.front(), m_fileout);\n+        const std::string& s = m_msgs_before_open.front();\n+\n+        if (m_print_to_file) FileWriteStr(s, m_fileout);\n+        if (m_print_to_console) fwrite(s.data(), 1, s.size(), stdout);\n+\n         m_msgs_before_open.pop_front();\n     }\n+    if (m_print_to_console) fflush(stdout);\n \n     return true;\n }\n@@ -201,34 +214,35 @@ std::string BCLog::Logger::LogTimestampStr(const std::string &str)\n \n void BCLog::Logger::LogPrintStr(const std::string &str)\n {\n+    std::lock_guard<std::mutex> scoped_lock(m_file_mutex);\n     std::string strTimestamped = LogTimestampStr(str);\n \n+    if (m_buffering) {\n+        // buffer if we haven't started logging yet\n+        m_msgs_before_open.push_back(strTimestamped);\n+        return;\n+    }\n+\n     if (m_print_to_console) {\n         // print to console\n         fwrite(strTimestamped.data(), 1, strTimestamped.size(), stdout);\n         fflush(stdout);\n     }\n     if (m_print_to_file) {\n-        std::lock_guard<std::mutex> scoped_lock(m_file_mutex);\n-\n-        // buffer if we haven't opened the log yet\n-        if (m_fileout == nullptr) {\n-            m_msgs_before_open.push_back(strTimestamped);\n-        }\n-        else\n-        {\n-            // reopen the log file, if requested\n-            if (m_reopen_file) {\n-                m_reopen_file = false;\n-                FILE* new_fileout = fsbridge::fopen(m_file_path, \"a\");\n-                if (new_fileout) {\n-                    setbuf(new_fileout, nullptr); // unbuffered\n-                    fclose(m_fileout);\n-                    m_fileout = new_fileout;\n-                }\n+        assert(m_fileout != nullptr);\n+\n+        // reopen the log file, if requested\n+        if (m_reopen_file) {\n+            m_reopen_file = false;\n+            FILE* new_fileout = fsbridge::fopen(m_file_path, \"a\");\n+            if (new_fileout) {\n+                setbuf(new_fileout, nullptr); // unbuffered\n+                fclose(m_fileout);\n+                m_fileout = new_fileout;\n             }\n-            FileWriteStr(strTimestamped, m_fileout);\n         }\n+\n+        FileWriteStr(strTimestamped, m_fileout);\n     }\n }\n "
      },
      {
        "sha": "40207db2dcc18b20bddc5f5d22d80e21ae25592f",
        "filename": "src/logging.h",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/bf6c20da4c0c86cd2c887712e19e01189eb66aec/src/logging.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/bf6c20da4c0c86cd2c887712e19e01189eb66aec/src/logging.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/logging.h?ref=bf6c20da4c0c86cd2c887712e19e01189eb66aec",
        "patch": "@@ -62,6 +62,7 @@ namespace BCLog {\n         FILE* m_fileout = nullptr;\n         std::mutex m_file_mutex;\n         std::list<std::string> m_msgs_before_open;\n+        bool m_buffering = true;\n \n         /**\n          * m_started_new_line is a state variable that will suppress printing of\n@@ -89,7 +90,7 @@ namespace BCLog {\n         void LogPrintStr(const std::string &str);\n \n         /** Returns whether logs will be written to any output */\n-        bool Enabled() const { return m_print_to_console || m_print_to_file; }\n+        bool Enabled() const { return m_buffering || m_print_to_console || m_print_to_file; }\n \n         bool StartLogging();\n         void ShrinkDebugFile();"
      }
    ]
  },
  {
    "sha": "383e923372b9efeb914c8982518583c78ea553c6",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozODNlOTIzMzcyYjllZmViOTE0Yzg5ODI1MTg1ODNjNzhlYTU1M2M2",
    "commit": {
      "author": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2018-05-03T10:57:17Z"
      },
      "committer": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2018-09-03T07:48:59Z"
      },
      "message": "logging.cpp: use CCriticalSection instead of std::mutex\n\nNote: this introduces a circular dependency between logging and sync,\nsince sync does logging, and logging does synchronisation.",
      "tree": {
        "sha": "76f161cedf9d67e01ad41eebdbc91eeec64587d5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/76f161cedf9d67e01ad41eebdbc91eeec64587d5"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/383e923372b9efeb914c8982518583c78ea553c6",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/383e923372b9efeb914c8982518583c78ea553c6",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/383e923372b9efeb914c8982518583c78ea553c6",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/383e923372b9efeb914c8982518583c78ea553c6/comments",
    "author": {
      "login": "ajtowns",
      "id": 127186,
      "node_id": "MDQ6VXNlcjEyNzE4Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajtowns",
      "html_url": "https://github.com/ajtowns",
      "followers_url": "https://api.github.com/users/ajtowns/followers",
      "following_url": "https://api.github.com/users/ajtowns/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajtowns/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
      "organizations_url": "https://api.github.com/users/ajtowns/orgs",
      "repos_url": "https://api.github.com/users/ajtowns/repos",
      "events_url": "https://api.github.com/users/ajtowns/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajtowns/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "ajtowns",
      "id": 127186,
      "node_id": "MDQ6VXNlcjEyNzE4Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajtowns",
      "html_url": "https://github.com/ajtowns",
      "followers_url": "https://api.github.com/users/ajtowns/followers",
      "following_url": "https://api.github.com/users/ajtowns/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajtowns/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
      "organizations_url": "https://api.github.com/users/ajtowns/orgs",
      "repos_url": "https://api.github.com/users/ajtowns/repos",
      "events_url": "https://api.github.com/users/ajtowns/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajtowns/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "bf6c20da4c0c86cd2c887712e19e01189eb66aec",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bf6c20da4c0c86cd2c887712e19e01189eb66aec",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/bf6c20da4c0c86cd2c887712e19e01189eb66aec"
      }
    ],
    "stats": {
      "total": 13,
      "additions": 8,
      "deletions": 5
    },
    "files": [
      {
        "sha": "25965c6a97d3182dd526dc7c2519a5877bf78a0c",
        "filename": "src/logging.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/383e923372b9efeb914c8982518583c78ea553c6/src/logging.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/383e923372b9efeb914c8982518583c78ea553c6/src/logging.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/logging.cpp?ref=383e923372b9efeb914c8982518583c78ea553c6",
        "patch": "@@ -32,7 +32,7 @@ static int FileWriteStr(const std::string &str, FILE *fp)\n \n bool BCLog::Logger::StartLogging()\n {\n-    std::lock_guard<std::mutex> scoped_lock(m_file_mutex);\n+    LOCK(m_cs_log);\n \n     assert(m_buffering);\n     assert(m_fileout == nullptr);\n@@ -214,7 +214,7 @@ std::string BCLog::Logger::LogTimestampStr(const std::string &str)\n \n void BCLog::Logger::LogPrintStr(const std::string &str)\n {\n-    std::lock_guard<std::mutex> scoped_lock(m_file_mutex);\n+    LOCK(m_cs_log);\n     std::string strTimestamped = LogTimestampStr(str);\n \n     if (m_buffering) {"
      },
      {
        "sha": "91b88017e664f614413130a0f32be88bb469d272",
        "filename": "src/logging.h",
        "status": "modified",
        "additions": 5,
        "deletions": 3,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/383e923372b9efeb914c8982518583c78ea553c6/src/logging.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/383e923372b9efeb914c8982518583c78ea553c6/src/logging.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/logging.h?ref=383e923372b9efeb914c8982518583c78ea553c6",
        "patch": "@@ -7,7 +7,9 @@\n #define BITCOIN_LOGGING_H\n \n #include <fs.h>\n+#include <sync.h>\n #include <tinyformat.h>\n+#include <threadsafety.h>\n \n #include <atomic>\n #include <cstdint>\n@@ -59,9 +61,9 @@ namespace BCLog {\n     class Logger\n     {\n     private:\n-        FILE* m_fileout = nullptr;\n-        std::mutex m_file_mutex;\n-        std::list<std::string> m_msgs_before_open;\n+        CCriticalSection m_cs_log;\n+        FILE* m_fileout GUARDED_BY(m_cs_log) = nullptr;\n+        std::list<std::string> m_msgs_before_open GUARDED_BY(m_cs_log);\n         bool m_buffering = true;\n \n         /**"
      },
      {
        "sha": "8cb57f99388a3b9199eb04fbce697061dd8d00d2",
        "filename": "test/lint/lint-circular-dependencies.sh",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/383e923372b9efeb914c8982518583c78ea553c6/test/lint/lint-circular-dependencies.sh",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/383e923372b9efeb914c8982518583c78ea553c6/test/lint/lint-circular-dependencies.sh",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/lint/lint-circular-dependencies.sh?ref=383e923372b9efeb914c8982518583c78ea553c6",
        "patch": "@@ -12,6 +12,7 @@ EXPECTED_CIRCULAR_DEPENDENCIES=(\n     \"chainparamsbase -> util -> chainparamsbase\"\n     \"checkpoints -> validation -> checkpoints\"\n     \"index/txindex -> validation -> index/txindex\"\n+    \"logging -> sync -> logging\"\n     \"policy/fees -> txmempool -> policy/fees\"\n     \"policy/policy -> validation -> policy/policy\"\n     \"qt/addresstablemodel -> qt/walletmodel -> qt/addresstablemodel\""
      }
    ]
  }
]