[
  {
    "sha": "eea02be70ee37b845f2719b3c08e5baf4b6f51f6",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzplZWEwMmJlNzBlZTM3Yjg0NWYyNzE5YjNjMDhlNWJhZjRiNmY1MWY2",
    "commit": {
      "author": {
        "name": "practicalswift",
        "email": "practicalswift@users.noreply.github.com",
        "date": "2019-01-19T13:49:29Z"
      },
      "committer": {
        "name": "practicalswift",
        "email": "practicalswift@users.noreply.github.com",
        "date": "2019-01-19T17:23:53Z"
      },
      "message": "Add locking annotation for vNodes. vNodes is guarded by cs_vNodes.",
      "tree": {
        "sha": "0223ed7ec339fa7d73d0e0d9f5d4a0873c8cb18f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0223ed7ec339fa7d73d0e0d9f5d4a0873c8cb18f"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/eea02be70ee37b845f2719b3c08e5baf4b6f51f6",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/eea02be70ee37b845f2719b3c08e5baf4b6f51f6",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/eea02be70ee37b845f2719b3c08e5baf4b6f51f6",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/eea02be70ee37b845f2719b3c08e5baf4b6f51f6/comments",
    "author": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "63144335becb705a233b32fb8d63f37b7d62071a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/63144335becb705a233b32fb8d63f37b7d62071a",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/63144335becb705a233b32fb8d63f37b7d62071a"
      }
    ],
    "stats": {
      "total": 15,
      "additions": 13,
      "deletions": 2
    },
    "files": [
      {
        "sha": "bb567ad2c4d989b5e10a7110c162526257db2f21",
        "filename": "src/net.h",
        "status": "modified",
        "additions": 13,
        "deletions": 2,
        "changes": 15,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/eea02be70ee37b845f2719b3c08e5baf4b6f51f6/src/net.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/eea02be70ee37b845f2719b3c08e5baf4b6f51f6/src/net.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.h?ref=eea02be70ee37b845f2719b3c08e5baf4b6f51f6",
        "patch": "@@ -177,7 +177,18 @@ class CConnman\n     CConnman(uint64_t seed0, uint64_t seed1);\n     ~CConnman();\n     bool Start(CScheduler& scheduler, const Options& options);\n-    void Stop();\n+\n+    // TODO: Remove NO_THREAD_SAFETY_ANALYSIS. Lock cs_vNodes before reading the variable vNodes.\n+    //\n+    // When removing NO_THREAD_SAFETY_ANALYSIS be aware of the following lock order requirements:\n+    // * CheckForStaleTipAndEvictPeers locks cs_main before indirectly calling GetExtraOutboundCount\n+    //   which locks cs_vNodes.\n+    // * ProcessMessage locks cs_main and g_cs_orphans before indirectly calling ForEachNode which\n+    //   locks cs_vNodes.\n+    //\n+    // Thus the implicit locking order requirement is: (1) cs_main, (2) g_cs_orphans, (3) cs_vNodes.\n+    void Stop() NO_THREAD_SAFETY_ANALYSIS;\n+\n     void Interrupt();\n     bool GetNetworkActive() const { return fNetworkActive; };\n     bool GetUseAddrmanOutgoing() const { return m_use_addrman_outgoing; };\n@@ -418,7 +429,7 @@ class CConnman\n     CCriticalSection cs_vOneShots;\n     std::vector<std::string> vAddedNodes GUARDED_BY(cs_vAddedNodes);\n     CCriticalSection cs_vAddedNodes;\n-    std::vector<CNode*> vNodes;\n+    std::vector<CNode*> vNodes GUARDED_BY(cs_vNodes);\n     std::list<CNode*> vNodesDisconnected;\n     mutable CCriticalSection cs_vNodes;\n     std::atomic<NodeId> nLastNodeId{0};"
      }
    ]
  }
]