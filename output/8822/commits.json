[
  {
    "sha": "41e58faf043864a64a6db08a8df527fa5fd1ec5b",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0MWU1OGZhZjA0Mzg2NGE2NGE2ZGIwOGE4ZGY1MjdmYTVmZDFlYzVi",
    "commit": {
      "author": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@gmail.com",
        "date": "2016-09-27T12:05:24Z"
      },
      "committer": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@gmail.com",
        "date": "2016-09-28T10:44:13Z"
      },
      "message": "net: Consistent checksum handling\n\nIn principle, the checksums of P2P packets are simply 4-byte blobs which\nare the first four bytes of SHA256(SHA256(payload)).\n\nCurrently they are handled as little-endian 32-bit integers half of the\ntime, as blobs the other half, sometimes copying the one to the other,\nresulting in somewhat confused code.\n\nThis PR changes the handling to be consistent both at packet creation\nand receiving, making it (I think) easier to understand.",
      "tree": {
        "sha": "dbe0c6c2dee6615abee3d97d6b8af98c66effc47",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/dbe0c6c2dee6615abee3d97d6b8af98c66effc47"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/41e58faf043864a64a6db08a8df527fa5fd1ec5b",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/41e58faf043864a64a6db08a8df527fa5fd1ec5b",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/41e58faf043864a64a6db08a8df527fa5fd1ec5b",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/41e58faf043864a64a6db08a8df527fa5fd1ec5b/comments",
    "author": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "920ca1f0bf0b786250e3119a05984e0c2af1350a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/920ca1f0bf0b786250e3119a05984e0c2af1350a",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/920ca1f0bf0b786250e3119a05984e0c2af1350a"
      }
    ],
    "stats": {
      "total": 23,
      "additions": 11,
      "deletions": 12
    },
    "files": [
      {
        "sha": "ab672197144e67dc221194359480430c5657c73f",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 4,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/41e58faf043864a64a6db08a8df527fa5fd1ec5b/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/41e58faf043864a64a6db08a8df527fa5fd1ec5b/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=41e58faf043864a64a6db08a8df527fa5fd1ec5b",
        "patch": "@@ -6253,11 +6253,12 @@ bool ProcessMessages(CNode* pfrom, CConnman& connman)\n         // Checksum\n         CDataStream& vRecv = msg.vRecv;\n         uint256 hash = Hash(vRecv.begin(), vRecv.begin() + nMessageSize);\n-        unsigned int nChecksum = ReadLE32((unsigned char*)&hash);\n-        if (nChecksum != hdr.nChecksum)\n+        if (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) != 0)\n         {\n-            LogPrintf(\"%s(%s, %u bytes): CHECKSUM ERROR nChecksum=%08x hdr.nChecksum=%08x\\n\", __func__,\n-               SanitizeString(strCommand), nMessageSize, nChecksum, hdr.nChecksum);\n+            LogPrintf(\"%s(%s, %u bytes): CHECKSUM ERROR expected %s was %s\\n\", __func__,\n+               SanitizeString(strCommand), nMessageSize,\n+               HexStr(hash.begin(), hash.begin()+CMessageHeader::CHECKSUM_SIZE),\n+               HexStr(hdr.pchChecksum, hdr.pchChecksum+CMessageHeader::CHECKSUM_SIZE));\n             continue;\n         }\n "
      },
      {
        "sha": "770e2d2959998efe2ab9f63436cbdbda440c476b",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 4,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/41e58faf043864a64a6db08a8df527fa5fd1ec5b/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/41e58faf043864a64a6db08a8df527fa5fd1ec5b/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=41e58faf043864a64a6db08a8df527fa5fd1ec5b",
        "patch": "@@ -2661,10 +2661,8 @@ void CNode::EndMessage(const char* pszCommand) UNLOCK_FUNCTION(cs_vSend)\n \n     // Set the checksum\n     uint256 hash = Hash(ssSend.begin() + CMessageHeader::HEADER_SIZE, ssSend.end());\n-    unsigned int nChecksum = 0;\n-    memcpy(&nChecksum, &hash, sizeof(nChecksum));\n-    assert(ssSend.size () >= CMessageHeader::CHECKSUM_OFFSET + sizeof(nChecksum));\n-    memcpy((char*)&ssSend[CMessageHeader::CHECKSUM_OFFSET], &nChecksum, sizeof(nChecksum));\n+    assert(ssSend.size () >= CMessageHeader::CHECKSUM_OFFSET + CMessageHeader::CHECKSUM_SIZE);\n+    memcpy((char*)&ssSend[CMessageHeader::CHECKSUM_OFFSET], hash.begin(), CMessageHeader::CHECKSUM_SIZE);\n \n     LogPrint(\"net\", \"(%d bytes) peer=%d\\n\", nSize, id);\n "
      },
      {
        "sha": "54ad62b1a2a95db08b8e31a0c38440707ef14d63",
        "filename": "src/protocol.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/41e58faf043864a64a6db08a8df527fa5fd1ec5b/src/protocol.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/41e58faf043864a64a6db08a8df527fa5fd1ec5b/src/protocol.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/protocol.cpp?ref=41e58faf043864a64a6db08a8df527fa5fd1ec5b",
        "patch": "@@ -79,7 +79,7 @@ CMessageHeader::CMessageHeader(const MessageStartChars& pchMessageStartIn)\n     memcpy(pchMessageStart, pchMessageStartIn, MESSAGE_START_SIZE);\n     memset(pchCommand, 0, sizeof(pchCommand));\n     nMessageSize = -1;\n-    nChecksum = 0;\n+    memset(pchChecksum, 0, CHECKSUM_SIZE);\n }\n \n CMessageHeader::CMessageHeader(const MessageStartChars& pchMessageStartIn, const char* pszCommand, unsigned int nMessageSizeIn)\n@@ -88,7 +88,7 @@ CMessageHeader::CMessageHeader(const MessageStartChars& pchMessageStartIn, const\n     memset(pchCommand, 0, sizeof(pchCommand));\n     strncpy(pchCommand, pszCommand, COMMAND_SIZE);\n     nMessageSize = nMessageSizeIn;\n-    nChecksum = 0;\n+    memset(pchChecksum, 0, CHECKSUM_SIZE);\n }\n \n std::string CMessageHeader::GetCommand() const"
      },
      {
        "sha": "177d74530815cc226d205d297c9c84e6d1393d79",
        "filename": "src/protocol.h",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/41e58faf043864a64a6db08a8df527fa5fd1ec5b/src/protocol.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/41e58faf043864a64a6db08a8df527fa5fd1ec5b/src/protocol.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/protocol.h?ref=41e58faf043864a64a6db08a8df527fa5fd1ec5b",
        "patch": "@@ -45,7 +45,7 @@ class CMessageHeader\n         READWRITE(FLATDATA(pchMessageStart));\n         READWRITE(FLATDATA(pchCommand));\n         READWRITE(nMessageSize);\n-        READWRITE(nChecksum);\n+        READWRITE(FLATDATA(pchChecksum));\n     }\n \n     // TODO: make private (improves encapsulation)\n@@ -62,7 +62,7 @@ class CMessageHeader\n     char pchMessageStart[MESSAGE_START_SIZE];\n     char pchCommand[COMMAND_SIZE];\n     unsigned int nMessageSize;\n-    unsigned int nChecksum;\n+    uint8_t pchChecksum[CHECKSUM_SIZE];\n };\n \n /**"
      }
    ]
  },
  {
    "sha": "305087bdf640a5c0b3eeeb90d33ee255d2456eba",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozMDUwODdiZGY2NDBhNWMwYjNlZWViOTBkMzNlZTI1NWQyNDU2ZWJh",
    "commit": {
      "author": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@gmail.com",
        "date": "2016-09-28T13:33:45Z"
      },
      "committer": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@gmail.com",
        "date": "2016-09-28T13:33:45Z"
      },
      "message": "net: Hardcode protocol sizes and use fixed-size types\n\nThe P2P network uses a fixed protocol, these sizes shouldn't change\nbased on what happens to be the architecture.",
      "tree": {
        "sha": "e832201928094545f43fb0b6e45f60dc9c286120",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e832201928094545f43fb0b6e45f60dc9c286120"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/305087bdf640a5c0b3eeeb90d33ee255d2456eba",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/305087bdf640a5c0b3eeeb90d33ee255d2456eba",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/305087bdf640a5c0b3eeeb90d33ee255d2456eba",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/305087bdf640a5c0b3eeeb90d33ee255d2456eba/comments",
    "author": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "41e58faf043864a64a6db08a8df527fa5fd1ec5b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/41e58faf043864a64a6db08a8df527fa5fd1ec5b",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/41e58faf043864a64a6db08a8df527fa5fd1ec5b"
      }
    ],
    "stats": {
      "total": 6,
      "additions": 3,
      "deletions": 3
    },
    "files": [
      {
        "sha": "1bc1c25b3714f3459586f1584c47ba6021d7371f",
        "filename": "src/protocol.h",
        "status": "modified",
        "additions": 3,
        "deletions": 3,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/305087bdf640a5c0b3eeeb90d33ee255d2456eba/src/protocol.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/305087bdf640a5c0b3eeeb90d33ee255d2456eba/src/protocol.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/protocol.h?ref=305087bdf640a5c0b3eeeb90d33ee255d2456eba",
        "patch": "@@ -52,16 +52,16 @@ class CMessageHeader\n public:\n     enum {\n         COMMAND_SIZE = 12,\n-        MESSAGE_SIZE_SIZE = sizeof(int),\n-        CHECKSUM_SIZE = sizeof(int),\n+        MESSAGE_SIZE_SIZE = 4,\n+        CHECKSUM_SIZE = 4,\n \n         MESSAGE_SIZE_OFFSET = MESSAGE_START_SIZE + COMMAND_SIZE,\n         CHECKSUM_OFFSET = MESSAGE_SIZE_OFFSET + MESSAGE_SIZE_SIZE,\n         HEADER_SIZE = MESSAGE_START_SIZE + COMMAND_SIZE + MESSAGE_SIZE_SIZE + CHECKSUM_SIZE\n     };\n     char pchMessageStart[MESSAGE_START_SIZE];\n     char pchCommand[COMMAND_SIZE];\n-    unsigned int nMessageSize;\n+    uint32_t nMessageSize;\n     uint8_t pchChecksum[CHECKSUM_SIZE];\n };\n "
      }
    ]
  }
]