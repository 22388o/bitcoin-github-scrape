sipa,2014-12-24T15:35:43Z,"Added a -relaypriority option to disable the priority requirement, and use it as a workaround in pulltester (which is mainly intended to test block validity rules anyway).\n",https://github.com/bitcoin/bitcoin/pull/5535#issuecomment-68058985,68058985,
petertodd,2014-12-25T08:36:32Z,utACK\n,https://github.com/bitcoin/bitcoin/pull/5535#issuecomment-68093966,68093966,
laanwj,2014-12-27T04:19:25Z,"Thinking of this, was the reason for including too-low-priority transactions in the mempool is that they may gain a sufficient priority over time? \n\nIt has always been possible to submit transactions that would not immediately be mined, but would likely be included in a block eventually.\n\nThis change is for the better, but rejecting transactions that cannot be mined the next block changes this",https://github.com/bitcoin/bitcoin/pull/5535#issuecomment-68168205,68168205,
gmaxwell,2014-12-27T07:52:01Z,"@laanwj I had the same thought about increasing 1 to N. Though it does add a lot more state-space you can consume with chains of unconfirmed.  Really it's ungrounded for another reason, they're already very unreliable because of the limiter.\n\nTo some extent not relaying and not mempooling a very low priority transaction is doing the user a favour because it's easier to get a conflict mined.\n\nA",https://github.com/bitcoin/bitcoin/pull/5535#issuecomment-68171855,68171855,
gmaxwell,2014-12-27T09:17:28Z,"That this adds another error() which shows up as a frequent user complaint generating ""ERROR"" in the logs might be a bit concerning.\n",https://github.com/bitcoin/bitcoin/pull/5535#issuecomment-68173440,68173440,
sipa,2014-12-30T01:04:58Z,"Updated, and removed the error message.\n\nI think we should generally avoid reserve ERROR for actually failed user requests or necessary behaviour. Not for normal network activity.\n",https://github.com/bitcoin/bitcoin/pull/5535#issuecomment-68320723,68320723,
gmaxwell,2014-12-30T04:41:42Z,(still) ACK.\n,https://github.com/bitcoin/bitcoin/pull/5535#issuecomment-68329792,68329792,
petertodd,2015-01-03T04:40:44Z,utACK\n,https://github.com/bitcoin/bitcoin/pull/5535#issuecomment-68583231,68583231,
jgarzik,2015-01-06T15:16:57Z,"ACK\n\nNit: Considering that the error is `REJECT_INSUFFICIENTFEE`, I think the description of ""rate limited free transaction"" seems inadequate.  Perhaps ""insufficient fee for low priority"" or somesuch.\n",https://github.com/bitcoin/bitcoin/pull/5535#issuecomment-68877795,68877795,
sipa,2015-01-06T15:21:59Z,"@jgarzik well we're limited to the existing reject codes (and I don't really care much about those; I consider REJECT_INSUFFICIENTFEE to generally mean 'rejected by local relay policy', with the string clarifying the actual reason). That ""rate limited free transaction"" means: your transaction had a too low fee to be considered as a non-zero-fee one, so it is considered as a free one, but we've exc",https://github.com/bitcoin/bitcoin/pull/5535#issuecomment-68878531,68878531,
sipa,2015-01-06T15:24:19Z,Better clarification string suggestions welcome of course.\n,https://github.com/bitcoin/bitcoin/pull/5535#issuecomment-68878883,68878883,
jgarzik,2015-01-06T15:24:34Z,"Well the reason for rejection is ultimately low fee. The error constant does reflect that, but the string does not.\n",https://github.com/bitcoin/bitcoin/pull/5535#issuecomment-68878923,68878923,
sipa,2015-01-06T15:27:06Z,"Sure, all 3 checks that can result in failure to relay here are ultimately ""too low fee"", as more fee would make the transaction not subject to the free transaction policy. A more specific string doesn't hurt though.\n\nI still don't understand ""insufficient fee for low priority"" - if the fee was more, the priority wouldn't matter.\n\nMaybe ""rate-limited low-fee transaction""?\n",https://github.com/bitcoin/bitcoin/pull/5535#issuecomment-68879319,68879319,
laanwj,2015-01-07T12:00:58Z,"As this is a blocker for 0.10, I'm not going to hold merging this up on discussion about the error message, if you have a better suggestion you can change it later.\n",https://github.com/bitcoin/bitcoin/pull/5535#issuecomment-69013017,69013017,
mikehearn,2015-01-12T12:59:04Z,"This change will almost certainly break existing software that generates free transactions, who don't know about this new rule. The assumption that you can generate a free transaction and it will get mined at some point is one that has been valid since the start of Bitcoin. \n\nI don't see any measurements of how much breakage this will cause (the cost), or what the rationale is, what the benefits",https://github.com/bitcoin/bitcoin/pull/5535#issuecomment-69565961,69565961,
jgarzik,2015-01-12T13:02:23Z,@mikehearn eh? Current versions of bitcoind will similarly neglect to relay low priority -- spam -- transactions.\n,https://github.com/bitcoin/bitcoin/pull/5535#issuecomment-69566314,69566314,
mikehearn,2015-01-12T14:57:04Z,That's what this change does. Previously there was a rate limiter and size constraints only. You could post a low priority transaction and it'd hang around until it reached a high enough priority.\n\nThe idea here is that it gets a little bit closer to a size limited mempool. But you can still fill up memory by attaching a fee. 1 BTC buys you about 100mb of mempool space. Adding another special ca,https://github.com/bitcoin/bitcoin/pull/5535#issuecomment-69581279,69581279,
gmaxwell,2015-01-12T15:05:52Z,> Previously there was a rate limiter and size constraints only. You could post a low priority transaction and it'd hang around until it reached a high enough priority\n\nPreviously the behavior was non-determinstic depending on where you hit the rate limiters. You'd announce something and it would have very poor propagation. The fact that it reached a few nodes would not help you if those nodes w,https://github.com/bitcoin/bitcoin/pull/5535#issuecomment-69582724,69582724,
mikehearn,2015-01-12T15:25:38Z,"Yes, that's true. Perhaps the rate limiter can be removed then, as this new rule would supersede it.\n",https://github.com/bitcoin/bitcoin/pull/5535#issuecomment-69585995,69585995,
morcos,2015-01-15T21:52:13Z,"I ran a little study over the transactions my node received in the last 6 weeks of 2014.   There were 14,600 transactions that would have been rejected by this code,  on average about 1 transaction every 5 minutes.  But maybe of greater concern, 126 of these transactions (or about 3 a day) were for over 1000 BTC.   Transactions for that much value had to depend on inputs in the mempool to not imme",https://github.com/bitcoin/bitcoin/pull/5535#issuecomment-70169123,70169123,
sipa,2015-01-15T22:38:04Z,"Alex, do you have a way to find out whether a higher limit (e.g. ""would\nconfirm in 6 blocks"" rather in 1 block) would have eliminated a significant\nnumber of these?\n",https://github.com/bitcoin/bitcoin/pull/5535#issuecomment-70176107,70176107,
sipa,2015-01-15T22:46:16Z,"So that it rejects some transactions is indeed expected (though I wasn't\nexpecting such numbers to be honest). The question is really whether that\nhad any effect on them confirming (would they have been rebroadcast, for\nexample).\n",https://github.com/bitcoin/bitcoin/pull/5535#issuecomment-70177246,70177246,
morcos,2015-01-15T23:07:22Z,"I'm rerunning the analysis now to answer about 6 (or other block numbers).  But part of the problem is that sometimes (especially for higher value tx's) they depend on unconfirmed inputs and so may not increase in priority if you project a few blocks ahead.  \n\nMy concern was that if the network is a mix of upgraded and not, rebroadcasting might not work very well.   Does it matter whether you ar",https://github.com/bitcoin/bitcoin/pull/5535#issuecomment-70180155,70180155,
morcos,2015-01-16T01:41:12Z,"Projecting out to 6 blocks doesn't help, still 12,700 txs rejected, and 25 blocks is still 11,800.   Worse yet, it makes almost no difference to high value txs (of over 100 or 1000 BTC).   \n",https://github.com/bitcoin/bitcoin/pull/5535#issuecomment-70195810,70195810,
gmaxwell,2015-01-16T01:47:59Z,@morcos  These transactions are already subject to the rate limiter; which gives them very intermittent propagation (I frequently see the rate limiter being hit on my nodes). They're also not mined by default.  Fair enough to have a release note on it; I'm not sure if there is any reason for concern beyond that point.\n,https://github.com/bitcoin/bitcoin/pull/5535#issuecomment-70196376,70196376,
mikehearn,2015-01-16T14:40:26Z,"A simpler way to address the underlying concern without breaking things was already proposed up thread. After receiving inserting a new transaction into the mem pool run:\n\nwhile (mempool_size > 100mb) {\n  drop lowest priority transaction;\n}\n\nWe know the mempool wasn't at excessive sizes during the period Alex analysed (otherwise we'd have noticed nodes falling over), so this change would hav",https://github.com/bitcoin/bitcoin/pull/5535#issuecomment-70262248,70262248,
gmaxwell,2015-01-16T14:45:52Z,"@mikehearn as explained up thread: that fix causes problems by making the behavior less deterministic, and leaving you with things like no way to tell if the transaction is actually propagated, creates difficulty rebroadcasting, and incentives for people to flood the mempool to push transactions out of it.  It also doesn't address the relay / rate limiter capacity getting chewed up by very low pri",https://github.com/bitcoin/bitcoin/pull/5535#issuecomment-70262965,70262965,
mikehearn,2015-01-16T15:16:56Z,"Alex's analysis provides data which quantifies the amount of breakage.\n\nI think the reason my proposed fix may _seem_ less deterministic than this change, is that this change doesn't really address the underlying issue. For instance, can it be bypassed by just creating lots of free transactions that are all of sufficient priority to be mined in the next block? I think yes, so it's hard to have c",https://github.com/bitcoin/bitcoin/pull/5535#issuecomment-70267584,70267584,
laanwj,2015-01-16T15:21:56Z,"There needs to be a maximum mempool size _as well_. Let's not pretend it's one or the other.\n\nWhat is nice about this change, though, is that it gives immediate feedback to the sender that the transaction is rejected.\n",https://github.com/bitcoin/bitcoin/pull/5535#issuecomment-70268386,70268386,
gmaxwell,2015-01-16T15:22:25Z,"The problem this is addressing are two-fold possible to use capacity-- in the form of relay bandwidth, and mempool space-- on the entire network with no cost to the attacker. Both fees and priorities are cost; and because the existing ineffective protections (which are actually inconsistent with the public documentation about the behavior; see https://en.bitcoin.it/wiki/Transaction_fees) are non-d",https://github.com/bitcoin/bitcoin/pull/5535#issuecomment-70268476,70268476,
jgarzik,2015-01-16T16:06:30Z,"Related: #3753 (mempool periodic sweep). \n\nIn-implementation it is easier to have a separate sweep, than adding the delete-tx-from-mempool loop to the add-tx-to-mempool functionality.\n\nThe main blocker is tagging transactions as ""significant to my local wallet"" so that they are not tossed out with the bathwater.\n",https://github.com/bitcoin/bitcoin/pull/5535#issuecomment-70275837,70275837,
Diapolo,2015-01-07T14:10:23Z,Also we choose once to sort the options in alphabetical order (at least) this is now also not true anymore -_-.\n,https://github.com/bitcoin/bitcoin/pull/5535#discussion_r22587121,22587121,src/init.cpp
