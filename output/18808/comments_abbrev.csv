DrahtBot,2020-04-29 02:40:50,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #17303 (p2p: Stop relaying non-mempool txs, improve tx privacy slightly by MarcoFalke)\n\nIf you consider this pull reques",https://github.com/bitcoin/bitcoin/pull/18808#issuecomment-620960726,620960726,
MarcoFalke,2020-04-29 13:20:34,Concept ACK,https://github.com/bitcoin/bitcoin/pull/18808#issuecomment-621200305,621200305,
naumenkogs,2020-04-29 16:33:40,"Concept ACK, light code review ack",https://github.com/bitcoin/bitcoin/pull/18808#issuecomment-621324519,621324519,
jnewbery,2020-04-29 23:31:45,"> Why did you choose the former / are there legitimate constellations in which peers would send us unknown GETDATA but be worth staying connected to?\n\nJust conservatism. Better to not let a logic bug turn into a peer disconnect if possible. In the adversarial case, there are messages that a peer can send us that would be much costlier for us to process, so no need to punish for something that ",https://github.com/bitcoin/bitcoin/pull/18808#issuecomment-621523231,621523231,
laanwj,2020-04-30 08:34:08,"Concept ACK, though I think disconnecting the peer because the application doesn't know how to handle a request would be slightly preferable in this case.\nIt indicates a bug at the side of the peer and explicit error handling is better to track down errors.\nI could understand the ignore behavior as a kind of extension mechanism, however, I think in case of a protocol extension it needs to be n",https://github.com/bitcoin/bitcoin/pull/18808#issuecomment-621694651,621694651,
brakmic,2020-04-30 16:16:00,"ACK https://github.com/bitcoin/bitcoin/commit/9847e205bf7edcac4c30ce4b6d62f482aa7bc1b7\n\nBuilt, run and tested on macOS Catalina 10.15.4.\nFunctional test `p2p_getdata` successful. ",https://github.com/bitcoin/bitcoin/pull/18808#issuecomment-621954752,621954752,
jnewbery,2020-04-30 16:58:18,">  I think disconnecting the peer because the application doesn't know how to handle a request would be slightly preferable in this case.\n> It indicates a bug at the side of the peer and explicit error handling is better to track down errors.\n\nThere are lots of p2p messages that indicate bugs in the peer which we just silently drop, eg if a peer sends us multiple VERACKs, multiple SENDHEADER",https://github.com/bitcoin/bitcoin/pull/18808#issuecomment-621978212,621978212,
luke-jr,2020-05-02 22:06:21,">Why did you choose the former / are there legitimate constellations in which peers would send us unknown GETDATA but be worth staying connected to?\n\nIt's generally important to avoid splitting the p2p network. Even if peers are implementing different rules allowing invalid stuff (eg, an old node after a softfork), they still need to get the blocks from updated peers...",https://github.com/bitcoin/bitcoin/pull/18808#issuecomment-623021660,623021660,
laanwj,2020-05-06 12:23:07,">if a peer sends us multiple VERACKs, multiple SENDHEADERs, a GETDATA with no items, etc. I think if the cost to process those messages is low, then dropping and not disconnecting is the safer thing to do.\n\nI think those are different in that they are quantitatively different not qualitatively. There may be spurious messages (or lack of messages) but the messages that are sent have a known mea",https://github.com/bitcoin/bitcoin/pull/18808#issuecomment-624617288,624617288,
jnewbery,2020-05-06 13:50:08,"> In this case the type is unknown and it is completely unknown how to handle it.\n\nYes, and so the most cautious action is to drop it. We already drop unknown message types:\n\nhttps://github.com/bitcoin/bitcoin/blob/60091d20f9bb6bb2d57b634567ba63b4f0e458d0/src/net_processing.cpp#L3299-L3301\n\nI could use the same extensibility argument here. It's possible that in future another P2P clien",https://github.com/bitcoin/bitcoin/pull/18808#issuecomment-624661388,624661388,
sipa,2020-05-08 02:22:20,utACK 9847e205bf7edcac4c30ce4b6d62f482aa7bc1b7,https://github.com/bitcoin/bitcoin/pull/18808#issuecomment-625592620,625592620,
naumenkogs,2020-05-08 14:50:48,utACK 9847e20,https://github.com/bitcoin/bitcoin/pull/18808#issuecomment-625853037,625853037,
MarcoFalke,2020-05-23 14:11:46,Post merge ACK 9847e205bf7edcac4c30ce4b6d62f482aa7bc1b7,https://github.com/bitcoin/bitcoin/pull/18808#issuecomment-633061479,633061479,
MarcoFalke,2020-04-29 13:19:46,Why is it ok to remove the nullptr check? This line crashes the node.,https://github.com/bitcoin/bitcoin/pull/18808#discussion_r417307258,417307258,src/net_processing.cpp
jnewbery,2020-04-29 14:57:01,Thanks. Fixed.,https://github.com/bitcoin/bitcoin/pull/18808#discussion_r417382259,417382259,src/net_processing.cpp
naumenkogs,2020-04-29 16:38:13,"What's the worst local processing delay we may expect if 2 blocks are generated within 5 seconds (and got queued together), but we process them separately?\nThe probability of this is definitely non-zero.\n",https://github.com/bitcoin/bitcoin/pull/18808#discussion_r417455006,417455006,src/net_processing.cpp
jnewbery,2020-04-29 20:36:44,Usually milliseconds. However long it takes to do one round of the messagehandler thread. We won't pause processing for 100ms because there's more work to do for this peer.,https://github.com/bitcoin/bitcoin/pull/18808#discussion_r417595662,417595662,src/net_processing.cpp
mzumsande,2020-04-29 22:12:20,What's the purpose of this override? (No invs seem to be sent in the test),https://github.com/bitcoin/bitcoin/pull/18808#discussion_r417643531,417643531,test/functional/p2p_getdata.py
jnewbery,2020-04-29 23:29:50,no reason. Bad copy-paste. Fixed. Thanks!,https://github.com/bitcoin/bitcoin/pull/18808#discussion_r417671022,417671022,test/functional/p2p_getdata.py
ajtowns,2020-05-11 15:47:20,"Seems mildly wasteful to grab the `cs_main` lock just to skip over `MSG_TX` and `MSG_WITNESS_TX`. I think this patch (""ignore tx GETDATA from blocks only peers"") could be dropped entirely, allowing the ""ignore unknown INV types in GETDATA messages"" patch's handling to cover it instead.",https://github.com/bitcoin/bitcoin/pull/18808#discussion_r423137297,423137297,src/net_processing.cpp
jnewbery,2020-05-11 18:33:25,"Yeah, it's _slightly_ wasteful, but I think it's clearer to have tx and non-tx handling fully separated in different parts of the functions, and explicitly have a code path/comment documenting behaviour, rather than having to think ""so what happens if we receive a request for a tx from a blocks-relay-only peer? Oh, it falls through here and then we handle it below as if it were an unknown type"".",https://github.com/bitcoin/bitcoin/pull/18808#discussion_r423238089,423238089,src/net_processing.cpp
