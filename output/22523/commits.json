[
  {
    "sha": "ce4e90629ed70f4d45906d7e79563b2f7ad6493e",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpjZTRlOTA2MjllZDcwZjRkNDU5MDZkN2U3OTU2M2IyZjdhZDY0OTNl",
    "commit": {
      "author": {
        "name": "lsilva01",
        "email": "84432093+lsilva01@users.noreply.github.com",
        "date": "2021-07-22T03:28:17Z"
      },
      "committer": {
        "name": "lsilva01",
        "email": "lsilva01@protonmail.com",
        "date": "2021-08-17T12:40:47Z"
      },
      "message": "Document about wallet backup and restoration\n\nThis PR adds a document about backing up and restoring the Bitcoin Core wallet as suggested in the issue https://github.com/bitcoin/bitcoin/issues/20149 .",
      "tree": {
        "sha": "297d269c4aab15c430f73eb8165a4cd6b35156dd",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/297d269c4aab15c430f73eb8165a4cd6b35156dd"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ce4e90629ed70f4d45906d7e79563b2f7ad6493e",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ce4e90629ed70f4d45906d7e79563b2f7ad6493e",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/ce4e90629ed70f4d45906d7e79563b2f7ad6493e",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ce4e90629ed70f4d45906d7e79563b2f7ad6493e/comments",
    "author": {
      "login": "lsilva01",
      "id": 84432093,
      "node_id": "MDQ6VXNlcjg0NDMyMDkz",
      "avatar_url": "https://avatars.githubusercontent.com/u/84432093?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lsilva01",
      "html_url": "https://github.com/lsilva01",
      "followers_url": "https://api.github.com/users/lsilva01/followers",
      "following_url": "https://api.github.com/users/lsilva01/following{/other_user}",
      "gists_url": "https://api.github.com/users/lsilva01/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lsilva01/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lsilva01/subscriptions",
      "organizations_url": "https://api.github.com/users/lsilva01/orgs",
      "repos_url": "https://api.github.com/users/lsilva01/repos",
      "events_url": "https://api.github.com/users/lsilva01/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lsilva01/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "lsilva01",
      "id": 84432093,
      "node_id": "MDQ6VXNlcjg0NDMyMDkz",
      "avatar_url": "https://avatars.githubusercontent.com/u/84432093?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lsilva01",
      "html_url": "https://github.com/lsilva01",
      "followers_url": "https://api.github.com/users/lsilva01/followers",
      "following_url": "https://api.github.com/users/lsilva01/following{/other_user}",
      "gists_url": "https://api.github.com/users/lsilva01/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lsilva01/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lsilva01/subscriptions",
      "organizations_url": "https://api.github.com/users/lsilva01/orgs",
      "repos_url": "https://api.github.com/users/lsilva01/repos",
      "events_url": "https://api.github.com/users/lsilva01/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lsilva01/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "fdd80b0a53b4af0b29cb6e03118e2456d053a757",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fdd80b0a53b4af0b29cb6e03118e2456d053a757",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/fdd80b0a53b4af0b29cb6e03118e2456d053a757"
      }
    ],
    "stats": {
      "total": 125,
      "additions": 125,
      "deletions": 0
    },
    "files": [
      {
        "sha": "aab6d131bd5905180a5b6e49131bb417d06fbae2",
        "filename": "doc/managing-wallets.md",
        "status": "added",
        "additions": 125,
        "deletions": 0,
        "changes": 125,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/ce4e90629ed70f4d45906d7e79563b2f7ad6493e/doc/managing-wallets.md",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/ce4e90629ed70f4d45906d7e79563b2f7ad6493e/doc/managing-wallets.md",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/doc/managing-wallets.md?ref=ce4e90629ed70f4d45906d7e79563b2f7ad6493e",
        "patch": "@@ -0,0 +1,125 @@\n+# Managing the Wallet\n+\n+## 1. Backing Up and Restoring The Wallet\n+\n+### 1.1 Creating the Wallet\n+\n+Since version 0.21, Bitcoin Core no longer has a default wallet.\n+Wallets can be created with the `createwallet` RPC or with the `Create wallet` GUI menu item.\n+\n+In the GUI, the `Create a new wallet` button is displayed on the main screen when there is no wallet loaded. Alternatively, there is the option `File` ->`Create wallet`.\n+\n+The following command, for example, creates a descriptor wallet. More information about this command may be found by running `bitcoin-cli help createwallet`.\n+\n+```\n+$ bitcoin-cli -named createwallet wallet_name=\"wallet-01\" descriptors=true\n+```\n+\n+The `descriptors` parameter can be omitted if the intention is to create a legacy wallet. For now, the default type is the legacy wallet, but that is expected to change in a future release.\n+\n+By default, wallets are created in the `wallets` folder of the data directory, which varies by operating system, as shown below. The user can change the default by using the `-datadir` or `-walletdir` initialization parameters.\n+\n+| Operating System | Default wallet directory                                    |\n+| -----------------|:------------------------------------------------------------|\n+| Linux            | `/home/<user>/.bitcoin/wallets`                             |\n+| Windows          | `C:\\Users\\<user>\\AppData\\Roaming\\Bitcoin\\wallets`           |\n+| macOS            | `/Users/<user>/Library/Application Support/Bitcoin/wallets` |\n+\n+### 1.2 Encrypting the Wallet\n+\n+The `wallet.dat` file is not encrypted by default and is, therefore, vulnerable if an attacker gains access to the device where the wallet or the backups are stored.\n+\n+Wallet encryption may prevent unauthorized access. However, this significantly increases the risk of losing coins due to forgotten passphrases. There is no way to recover a passphrase. This tradeoff should be well thought out by the user.\n+\n+Wallet encryption may also not protect against more sophisticated attacks. An attacker can, for example, obtain the password by installing a keylogger on the user's machine.\n+\n+After encrypting the wallet or changing the passphrase, a new backup needs to be created immediately. The reason is that the keypool is flushed and a new HD seed is generated after encryption. Any bitcoins received by the new seed cannot be recovered from the previous backups.\n+\n+The wallet's private key may be encrypted with the following command:\n+\n+```\n+$ bitcoin-cli -rpcwallet=\"wallet-01\" encryptwallet \"passphrase\"\n+```\n+\n+Once encrypted, the passphrase can be changed with the `walletpassphrasechange` command.\n+\n+```\n+$ bitcoin-cli -rpcwallet=\"wallet-01\" walletpassphrasechange \"oldpassphrase\" \"newpassphrase\"\n+```\n+\n+The argument passed to `-rpcwallet` is the name of the wallet to be encrypted.\n+\n+Only the wallet's private key is encrypted. All other wallet information, such as transactions, is still visible.\n+\n+The wallet's private key can also be encrypted in the `createwallet` command via the `passphrase` argument:\n+\n+```\n+$ bitcoin-cli -named createwallet wallet_name=\"wallet-01\" descriptors=true passphrase=\"passphrase\"\n+```\n+\n+Note that if the passphrase is lost, all the coins in the wallet will also be lost forever.\n+\n+### 1.3 Unlocking the Wallet\n+\n+If the wallet is encrypted and the user tries any operation related to private keys, such as sending bitcoins, an error message will be displayed.\n+\n+```\n+$ bitcoin-cli -rpcwallet=\"wallet-01\" sendtoaddress \"tb1qw508d6qejxtdg4y5r3zarvary0c5xw7kxpjzsx\" 0.01\n+error code: -13\n+error message:\n+Error: Please enter the wallet passphrase with walletpassphrase first.\n+```\n+\n+To unlock the wallet and allow it to run these operations, the `walletpassphrase` RPC is required.\n+\n+This command takes the passphrase and an argument called `timeout`, which specifies the time in seconds that the wallet decryption key is stored in memory. After this period expires, the user needs to execute this RPC again.\n+\n+```\n+$ bitcoin-cli -rpcwallet=\"wallet-01\" walletpassphrase \"passphrase\" 120\n+```\n+\n+In the GUI, there is no specific menu item to unlock the wallet. When the user sends bitcoins, the passphrase will be prompted automatically.\n+\n+### 1.4 Backing Up the Wallet\n+\n+To backup the wallet, the `backupwallet` RPC or the `Backup Wallet` GUI menu item must be used to ensure the file is in a safe state when the copy is made.\n+\n+In the RPC, the destination parameter must include the name of the file. Otherwise, the command will return an error message like \"Error: Wallet backup failed!\" for descriptor wallets. If it is a legacy wallet, it will be copied and a file will be created with the default file name `wallet.dat`.\n+\n+```\n+$ bitcoin-cli -rpcwallet=\"wallet-01\" backupwallet /home/node01/Backups/backup-01.dat\n+```\n+\n+In the GUI, the wallet is selected in the `Wallet` drop-down list in the upper right corner. If this list is not present, the wallet can be loaded in `File` ->`Open wallet` if necessary. Then, the backup can be done in `File` -> `Backup Wallet...`.\n+\n+This backup file can be stored on one or multiple offline devices, which must be reliable enough to work in an emergency and be malware free. Backup files can be regularly tested to avoid problems in the future.\n+\n+If the computer has malware, it can compromise the wallet when recovering the backup file. One way to minimize this is to not connect the backup to an online device.\n+\n+If both the wallet and all backups are lost for any reason, the bitcoins related to this wallet will become permanently inaccessible.\n+\n+### 1.5 Backup Frequency\n+\n+The original Bitcoin Core wallet was a collection of unrelated private keys. If a non-HD wallet had received funds to an address and then was restored from a backup made before the address was generated, then any funds sent to that address would have been lost because there was no deterministic mechanism to derive the address again.\n+\n+Bitcoin Core [version 0.13](https://github.com/bitcoin/bitcoin/blob/master/doc/release-notes/release-notes-0.13.0.md) introduced HD wallets with deterministic key derivation. With HD wallets, users no longer lose funds when restoring old backups because all addresses are derived from the HD wallet seed.\n+\n+This means that a single backup is enough to recover the coins at any time. It is still recommended to make regular backups (once a week) or after a significant number of new transactions to maintain the metadata, such as labels. Metadata cannot be retrieved from a blockchain rescan, so if the backup is too old, the metadata will be lost forever.\n+\n+Wallets created before version 0.13 are not HD and must be backed up every 100 keys used since the previous backup, or even more often to maintain the metadata.\n+\n+### 1.6 Restoring the Wallet From a Backup\n+\n+To restore a wallet, the `restorewallet` RPC must be used.\n+\n+```\n+$ bitcoin-cli restorewallet \"restored-wallet\" /home/node01/Backups/backup-01.dat\n+```\n+\n+After that, `getwalletinfo` can be used to check if the wallet has been fully restored.\n+\n+```\n+$ bitcoin-cli -rpcwallet=\"restored-wallet\" getwalletinfo\n+```\n+\n+The restored wallet can also be loaded in the GUI via `File` ->`Open wallet`.\n\\ No newline at end of file"
      }
    ]
  }
]