DrahtBot,2020-12-25 00:10:11,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20877 (netinfo: user help and argument parsing improvements by jonatack)\n* #20685 (Add I2P support using I2P SAM by vasi",https://github.com/bitcoin/bitcoin/pull/20764#issuecomment-751133051,751133051,
sipa,2020-12-27 05:21:54,Concept ACK,https://github.com/bitcoin/bitcoin/pull/20764#issuecomment-751427870,751427870,
michaelfolkson,2020-12-27 15:11:45,Concept ACK. Is this ready to move out of draft? Would perhaps get more review if out of draft?,https://github.com/bitcoin/bitcoin/pull/20764#issuecomment-751478688,751478688,
practicalswift,2020-12-27 19:58:20,"Concept ACK\n\n`-netinfo` is great! :)",https://github.com/bitcoin/bitcoin/pull/20764#issuecomment-751509553,751509553,
jonatack,2020-12-27 23:07:45,"Moved out of draft and ready for review with updated PR description and ""how to test"" suggestions. The last commit that adds displaying BIP152 high-bandwidth peers can't be backported to rc4, but the other commits, including the user help, could be if desired.\n\n<details><summary>New help doc</summary><p>\n\n```\n$ ./src/bitcoin-cli -netinfo help\n-netinfo level ""help"" \n\nReturns a netwo",https://github.com/bitcoin/bitcoin/pull/20764#issuecomment-751526571,751526571,
jonasschnelli,2020-12-28 20:06:02,"Neat!\nConcept ACK",https://github.com/bitcoin/bitcoin/pull/20764#issuecomment-751848049,751848049,
jonatack,2020-12-29 21:28:59,"Thanks for your ideas @glozow!\n\n> The second table should be mentioned in `help` imo, and in general just seems really weird to me. We have a column _after_ the ""overall totals"" and it has a slot for inbound block-relay-only, which doesn't exist afaik? Seems like it would make more sense for block/manual to be rows instead or have a separate table or something.\n\nThis is valuable, as I don'",https://github.com/bitcoin/bitcoin/pull/20764#issuecomment-752248132,752248132,
jonatack,2020-12-29 23:10:18,"Updated:\n- Rewrote the help, adding suggestions by @glozow and improved formatting\n- Display the block relay and manual counts in the outbound row only",https://github.com/bitcoin/bitcoin/pull/20764#issuecomment-752271655,752271655,
jonatack,2020-12-29 23:13:04,"<details><summary>Updated help doc</summary><p>\n\n```\n$ ./src/bitcoin-cli -netinfo help\n-netinfo level|""help"" \n\nReturns a network peer connections dashboard with information from the remote server.\nUnder the hood, -netinfo fetches the data by calling getpeerinfo and getnetworkinfo.\nAn optional integer argument from 0 to 4 can be passed for different peers listings.\nPass ""help"" to ",https://github.com/bitcoin/bitcoin/pull/20764#issuecomment-752272201,752272201,
theStack,2021-01-04 13:28:16,"Very nice that Santa Claus also came to present a gift to Bitcoin Core ;) 🎅 \nConcept ACK, plan to review this within the next days.",https://github.com/bitcoin/bitcoin/pull/20764#issuecomment-753974611,753974611,
jonatack,2021-01-05 22:58:10,"Rebased on top of #20829 (the first commit, ""netinfo: add user help documentation"").",https://github.com/bitcoin/bitcoin/pull/20764#issuecomment-754952435,754952435,
jonatack,2021-01-06 16:46:39,Rebased after the merge of #20829. The diff is now much smaller and this should be ready for final review.,https://github.com/bitcoin/bitcoin/pull/20764#issuecomment-755419157,755419157,
jonatack,2021-01-10 19:31:04,"Dropped commit 97127a870 ""netinfo: only display outbound block relay peers count.""",https://github.com/bitcoin/bitcoin/pull/20764#issuecomment-757530396,757530396,
jonatack,2021-01-18 19:40:44,"Added a commit to support displaying connections to peers via the I2P network. An `i2p` peer counts column is displayed if the user is connected to any I2P peers. Otherwise there is no user-facing change, and this change is compatible with current master.\n",https://github.com/bitcoin/bitcoin/pull/20764#issuecomment-762438934,762438934,
jonatack,2021-02-02 15:47:12,"Updated connection type handling to display inbounds without a ""full"" or ""block"" type description from fRelayTxes.\n\nWill give this a few days and if still no ACKs will close in favor of proposing the changes individually in separate pulls.",https://github.com/bitcoin/bitcoin/pull/20764#issuecomment-771730000,771730000,
michaelfolkson,2021-02-02 17:31:18,You haven't started splitting this into separate pulls have you @jonatack? If no I will review this tomorrow. Otherwise I will wait for the separate pulls.,https://github.com/bitcoin/bitcoin/pull/20764#issuecomment-771820535,771820535,
jonatack,2021-02-02 17:42:04,"Thanks 🙏 leaving as-is for now, one merge is easier than several 🐇 🐢 ",https://github.com/bitcoin/bitcoin/pull/20764#issuecomment-771829904,771829904,
laanwj,2021-02-03 08:16:39,"Code review and shallowly tested ACK ~~9628f9953d81c380c780046ef30a2f61c96d4966~~\nre-ACK 747cb5b9949f80b3b4516f382a0ce80e41f3f5a6\n\nI am a bit divided on adding I2P support here before #20685 is merged, but also don't see it as a problem that the client can already handle this.",https://github.com/bitcoin/bitcoin/pull/20764#issuecomment-772322486,772322486,
jonatack,2021-02-03 13:42:27,"Updated the last commit to only display block relay peer counts in the *outbound* row, and simplified it and commit *netinfo: display manual peers count* by persisting the counts in a member variable instead of in the `m_counts` 2D array.\n\n@laanwj Thanks for reviewing! I apologize for pushing again after. I think this is finally done.",https://github.com/bitcoin/bitcoin/pull/20764#issuecomment-772514793,772514793,
michaelfolkson,2021-02-04 17:39:03,"ACK 747cb5b9949f80b3b4516f382a0ce80e41f3f5a6\n\nI really like it (obviously) and I've only done limited testing (no Tor or I2P connections)\n\n> display high-bandwidth BIP152 compact block relay peers (hb column, to . and from *)\n\nMaybe it is just me but I feel as if I'm going to have to look at the help every time to remember what `.` and `*` represents. Presumably there were no better op",https://github.com/bitcoin/bitcoin/pull/20764#issuecomment-773484690,773484690,
jonatack,2021-02-04 21:40:04,"Thanks @michaelfolkson for reviewing! The idea is `.` for an outgoing signal (""to""; we selected the peer) and `*` for an inbound signal (""from""; the peer selected us). Kind of like a train with a bright headlight and a muted tail light. Though if you see them as starships instead I suppose an argument could be made for the inverse :smile: \n \n![Screenshot from 2020-12-29](https://user-images.gi",https://github.com/bitcoin/bitcoin/pull/20764#issuecomment-773621186,773621186,
jonasschnelli,2021-02-05 08:42:19,"~~Should this also be compatible with `-testnet` (and eventually `-regtest`)?~~\n\nnever-mind: it is.",https://github.com/bitcoin/bitcoin/pull/20764#issuecomment-773885731,773885731,
glozow,2020-12-28 23:50:54,nit: this can be a lot cleaner as a switch statement,https://github.com/bitcoin/bitcoin/pull/20764#discussion_r549521034,549521034,src/bitcoin-cli.cpp
glozow,2020-12-28 23:51:32,"""Latest ping time"" would be more accurate imo",https://github.com/bitcoin/bitcoin/pull/20764#discussion_r549521118,549521118,src/bitcoin-cli.cpp
glozow,2020-12-28 23:55:49,"Perhaps worth keeping, e.g. might need it again for something like #20726",https://github.com/bitcoin/bitcoin/pull/20764#discussion_r549521784,549521784,src/bitcoin-cli.cpp
jonatack,2020-12-29 00:27:50,"Yes, if an integral or enum connection type was exposed, but getpeerinfo provides it as a string, so this is the best we can do, I think. \n\nhttps://en.cppreference.com/w/cpp/language/switch",https://github.com/bitcoin/bitcoin/pull/20764#discussion_r549527068,549527068,src/bitcoin-cli.cpp
jonatack,2020-12-29 00:30:44,"(Client side, I think we have to make do data-wise with what the server side rpc provides. We can't hook in here to CNodeStats; it would be a layer violation).",https://github.com/bitcoin/bitcoin/pull/20764#discussion_r549527516,549527516,src/bitcoin-cli.cpp
jonatack,2020-12-29 20:32:29,"Thanks @glozow, changed to ""Last observed ping time."" Should go well with its neighbor, ""Minimum observed ping time.""",https://github.com/bitcoin/bitcoin/pull/20764#discussion_r549838214,549838214,src/bitcoin-cli.cpp
laanwj,2021-01-07 12:22:53,"Yea it's too bad that C++ doesn't have case pattern matching on strings, otherwise that'd be a lot cleaner.\n(this applies to some other places as well such as the P2P message dispatch)",https://github.com/bitcoin/bitcoin/pull/20764#discussion_r553295561,553295561,src/bitcoin-cli.cpp
jonatack,2021-01-10 19:23:17,"Yes, dropped the commit in order to keep `is_block_relay` and reworked the connection type logic to distinguish between inbound full relay (based on `fRelayTxes` like in `AttemptToEvictConnection`) and outbound block relay (based on `m_conn_type`).",https://github.com/bitcoin/bitcoin/pull/20764#discussion_r554611079,554611079,src/bitcoin-cli.cpp
MarcoFalke,2021-02-03 08:49:11,"In your screenshot an i2p inbound peer will print ""full"", which is short for ""outbound-full-relay"". Is this something wrong with i2p or with this pull?",https://github.com/bitcoin/bitcoin/pull/20764#discussion_r569230530,569230530,src/bitcoin-cli.cpp
jonatack,2021-02-03 08:51:18,The screenshot in the PR description was not the latest version. Removed it.,https://github.com/bitcoin/bitcoin/pull/20764#discussion_r569231903,569231903,src/bitcoin-cli.cpp
jonatack,2021-02-03 08:55:57,The inbound handling was updated after the i2p screenshot. Removed the i2p screenshot.,https://github.com/bitcoin/bitcoin/pull/20764#discussion_r569235008,569235008,src/bitcoin-cli.cpp
