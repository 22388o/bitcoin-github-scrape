[
  {
    "sha": "1f951c67a4d1e94895783d2c6b9bd235b2bf66b8",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxZjk1MWM2N2E0ZDFlOTQ4OTU3ODNkMmM2YjliZDIzNWIyYmY2NmI4",
    "commit": {
      "author": {
        "name": "R E Broadley",
        "email": "rebroad+github@gmail.com",
        "date": "2016-09-13T02:10:22Z"
      },
      "committer": {
        "name": "R E Broadley",
        "email": "rebroad+github@gmail.com",
        "date": "2016-09-13T02:10:22Z"
      },
      "message": "Allow filterclear messages for enabling TX relay only.\n\nAn example of where this might be useful is allowing a node to connect blocksonly during IBD but then becoming a full-node once caught up with the latest block. This might also even want to be the default behaviour since during IBD most TXs appear to be orphans, and are routinely dropped (for example when a node disconnects). Therefore, this can waste a lot of bandwidth.\n\nAdditionally, another pull could be written to stop relaying of TXs to nodes that are clearly far behind the latest block and are running a node that doesn't store many orphan TXs, such as recent versions of Bitcoin Core.",
      "tree": {
        "sha": "25065e51684468cbd8f8a0ad713378e1ee60b114",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/25065e51684468cbd8f8a0ad713378e1ee60b114"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1f951c67a4d1e94895783d2c6b9bd235b2bf66b8",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1f951c67a4d1e94895783d2c6b9bd235b2bf66b8",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/1f951c67a4d1e94895783d2c6b9bd235b2bf66b8",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1f951c67a4d1e94895783d2c6b9bd235b2bf66b8/comments",
    "author": {
      "login": "rebroad",
      "id": 1530283,
      "node_id": "MDQ6VXNlcjE1MzAyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rebroad",
      "html_url": "https://github.com/rebroad",
      "followers_url": "https://api.github.com/users/rebroad/followers",
      "following_url": "https://api.github.com/users/rebroad/following{/other_user}",
      "gists_url": "https://api.github.com/users/rebroad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
      "organizations_url": "https://api.github.com/users/rebroad/orgs",
      "repos_url": "https://api.github.com/users/rebroad/repos",
      "events_url": "https://api.github.com/users/rebroad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rebroad/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "rebroad",
      "id": 1530283,
      "node_id": "MDQ6VXNlcjE1MzAyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rebroad",
      "html_url": "https://github.com/rebroad",
      "followers_url": "https://api.github.com/users/rebroad/followers",
      "following_url": "https://api.github.com/users/rebroad/following{/other_user}",
      "gists_url": "https://api.github.com/users/rebroad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
      "organizations_url": "https://api.github.com/users/rebroad/orgs",
      "repos_url": "https://api.github.com/users/rebroad/repos",
      "events_url": "https://api.github.com/users/rebroad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rebroad/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "2a0836f6d5e7c1d7e97bedb0e0ea33dcaf981f77",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2a0836f6d5e7c1d7e97bedb0e0ea33dcaf981f77",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/2a0836f6d5e7c1d7e97bedb0e0ea33dcaf981f77"
      }
    ],
    "stats": {
      "total": 9,
      "additions": 5,
      "deletions": 4
    },
    "files": [
      {
        "sha": "6e3f9daf45ed154d78efd1321f76d1b407fb25d8",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 4,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1f951c67a4d1e94895783d2c6b9bd235b2bf66b8/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1f951c67a4d1e94895783d2c6b9bd235b2bf66b8/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=1f951c67a4d1e94895783d2c6b9bd235b2bf66b8",
        "patch": "@@ -4941,8 +4941,7 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n \n     if (!(pfrom->GetLocalServices() & NODE_BLOOM) &&\n               (strCommand == NetMsgType::FILTERLOAD ||\n-               strCommand == NetMsgType::FILTERADD ||\n-               strCommand == NetMsgType::FILTERCLEAR))\n+               strCommand == NetMsgType::FILTERADD))\n     {\n         if (pfrom->nVersion >= NO_BLOOM_VERSION) {\n             LOCK(cs_main);\n@@ -6128,8 +6127,10 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n     else if (strCommand == NetMsgType::FILTERCLEAR)\n     {\n         LOCK(pfrom->cs_filter);\n-        delete pfrom->pfilter;\n-        pfrom->pfilter = new CBloomFilter();\n+        if (pfrom->GetLocalServices() & NODE_BLOOM) {\n+            delete pfrom->pfilter;\n+            pfrom->pfilter = new CBloomFilter();\n+        }\n         pfrom->fRelayTxes = true;\n     }\n "
      }
    ]
  }
]