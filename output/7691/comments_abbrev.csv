MarcoFalke,2016-03-15T12:26:02Z,Concept ACK. Please remove the parameter interaction code from init; it seems you forgot to do this.\n,https://github.com/bitcoin/bitcoin/pull/7691#issuecomment-196797425,196797425,
jonasschnelli,2016-03-15T12:37:53Z,@MarcoFalke: thanks! Fixed.\n,https://github.com/bitcoin/bitcoin/pull/7691#issuecomment-196801028,196801028,
paveljanik,2016-03-15T19:42:29Z,New warning:\n\n```\nwallet/wallet.cpp:3222:1: warning: control may reach end of non-void function [-Wreturn-type]\n}\n^\n1 warning generated.\n```\n,https://github.com/bitcoin/bitcoin/pull/7691#issuecomment-196990354,196990354,
jtimon,2016-03-16T18:27:22Z,"Could `CWallet::ParameterInteraction()` take a `const std::map<std::string, std::string>& mapArgs` as parameter instead of using the mapArgs global from util.h  like in https://github.com/jtimon/bitcoin/commit/3d03f15126b79bd9f22ccd27f1d8ca43d9e16bf5 ?\n\nIn fact, I believe I got the idea from one of your older versions of this (and then @luke-jr suggested some improvements to std::vector<std::pai",https://github.com/bitcoin/bitcoin/pull/7691#issuecomment-197473358,197473358,
MarcoFalke,2016-03-18T17:44:28Z,You forgot to remove `AmountErrMsg` from init as well. Maybe it would help to create two separate commits or even pulls: One addressing the move-only and the other the refactoring Warning/Error messages?\n\nI really want to get this merged quick but I am concerned that reviewers are turned off by the diff containing both moves and refactors.\n,https://github.com/bitcoin/bitcoin/pull/7691#issuecomment-198467236,198467236,
mrbandrews,2016-03-21T15:37:53Z,"AmountErrMsg still used once in init.cpp at line 937 of the revised file.  So it's defined as a static function in both wallet.cpp and init.cpp, which seems to work fine, although I don't know whether it's the best way to do it (maybe it is) \n",https://github.com/bitcoin/bitcoin/pull/7691#issuecomment-199344233,199344233,
mrbandrews,2016-03-21T17:44:11Z,"Other than a couple of nits, this looks good to me.  Code review ACK, concept ACK, and I tested it with an unpruned node, pruned node with wallet, and a pruned node with an outdated wallet - meaning it should suggest a reindex (qt) or shut down (bitcoind) - with no problems.  So it's an ACK from me. \n",https://github.com/bitcoin/bitcoin/pull/7691#issuecomment-199397734,199397734,
jonasschnelli,2016-03-22T07:48:38Z,Fixed nits.\nShould be ready for merge.\n,https://github.com/bitcoin/bitcoin/pull/7691#issuecomment-199682411,199682411,
morcos,2016-03-22T13:58:19Z,"@jonasschnelli I don't necessarily object to this but it seems like if you're eventually going to change these from static functions to methods called on pWalletMain, that you might as well make all those changes now instead of having to review twice.\nIf you feel like its cleaner to break it up, perhaps it could be 2 commits in the same PR, but why not move closer to where you're trying to go.\n",https://github.com/bitcoin/bitcoin/pull/7691#issuecomment-199827445,199827445,
jonasschnelli,2016-03-23T09:47:48Z,Okay. Fair enough.\nAdded two commits.\nFirst added commit will refactor the static methods to take them into the CWallet instance context. This looks much cleaner now.\n\nSecond commit is a cosmetic BDB version logprint change.\n\nA migration from the global `pwalletMain` (called from everywhere) to a singleton is out-of-scope for now.\n\nThanks for the reviews!\n,https://github.com/bitcoin/bitcoin/pull/7691#issuecomment-200272188,200272188,
jonasschnelli,2016-03-24T20:00:25Z,Rejecting @morcos proposal to integrate the static-to-context change. Rolling back to original commit. This would get to big and not enough reviews. Further refactor can be done after this PR.\n,https://github.com/bitcoin/bitcoin/pull/7691#issuecomment-200995354,200995354,
MarcoFalke,2016-03-24T20:01:50Z,"Great, thanks for addressing the other nits.\n\nutACK 25340b7\n",https://github.com/bitcoin/bitcoin/pull/7691#issuecomment-200996413,200996413,
jtimon,2016-03-29T12:55:53Z,"utACK, all my nits can be solved later.\n",https://github.com/bitcoin/bitcoin/pull/7691#issuecomment-202879084,202879084,
laanwj,2016-04-02T06:22:16Z,"utACK  25340b7\n\n> A migration from the global pwalletMain (called from everywhere) to a singleton is out-of-scope for now.\n\nSeems like a useless intermediate step to me.\nSingletons are just nicely dressed-up globals.\nBut we'd like to _get rid_ of a single, global wallet, in any form. Just pass the thing around when you need it.\n",https://github.com/bitcoin/bitcoin/pull/7691#issuecomment-204656254,204656254,
jtimon,2016-03-16T18:30:38Z,Why static instead of calling it from the pwalletMain global (which could be moved to wallet)?\nOr are we turning the global into a singleton?\n,https://github.com/bitcoin/bitcoin/pull/7691#discussion_r56389752,56389752,src/wallet/wallet.h
jonasschnelli,2016-03-17T07:57:41Z,"> Why static instead of calling it from the pwalletMain global (which could be moved to wallet)?\n> Or are we turning the global into a singleton?\n\nRight. This is the direction where I'm heading to. But I work in very tiny steps (as you can see). For now it just moves ""static code"" to a static function in CWallet. Later it should be within the `pwalletMain` context.\n",https://github.com/bitcoin/bitcoin/pull/7691#discussion_r56466945,56466945,src/wallet/wallet.h
MarcoFalke,2016-03-17T10:32:07Z,You can't drop the return value here.\n,https://github.com/bitcoin/bitcoin/pull/7691#discussion_r56483765,56483765,src/init.cpp
jonasschnelli,2016-03-17T12:10:49Z,Right. Fixed.\n,https://github.com/bitcoin/bitcoin/pull/7691#discussion_r56493737,56493737,src/init.cpp
mrbandrews,2016-03-21T15:32:44Z,"I think this should be void, as the return value is not used as far as I can tell. \n",https://github.com/bitcoin/bitcoin/pull/7691#discussion_r56842251,56842251,src/wallet/wallet.cpp
MarcoFalke,2016-03-21T16:24:35Z,"It is mirroring `bool static InitWarning()`, so probably fine. Still, the code duplication could be avoided somehow.\n",https://github.com/bitcoin/bitcoin/pull/7691#discussion_r56851531,56851531,src/wallet/wallet.cpp
jonasschnelli,2016-03-21T16:37:12Z,"I have thought about that and if we want to decouple the wallet, we probably need to accept short term duplications of some code. In that case, the factored out shared code is `uiInterface.ThreadSafeMessageBox`. A duplicated entry point only used by CWallet should be okay.\n\nBut I agree with @mrbandrews: the return code should be switched to `void` (for `UIWarning`, keep it for `UIError` for now)",https://github.com/bitcoin/bitcoin/pull/7691#discussion_r56853773,56853773,src/wallet/wallet.cpp
mrbandrews,2016-03-21T17:29:19Z,I think this line can be removed... the wallet file name is read at the beginning of InitLoadWallet.\n,https://github.com/bitcoin/bitcoin/pull/7691#discussion_r56861782,56861782,src/wallet/wallet.cpp
mrbandrews,2016-03-21T17:34:17Z,Nit:  this local variable has the same name as the class member variable (I guess it is not a problem here since the compiler knows it can't access the class member from a static method?)  Not a big deal but maybe want to give it a different name. \n,https://github.com/bitcoin/bitcoin/pull/7691#discussion_r56862703,56862703,src/wallet/wallet.cpp
jtimon,2016-03-29T12:51:41Z,Why not pass mapArgs as parameter here?\n,https://github.com/bitcoin/bitcoin/pull/7691#discussion_r57717187,57717187,src/wallet/wallet.cpp
jonasschnelli,2016-03-29T12:54:27Z,The goal was it to keep it at a tiny scope (almost moveonly). I would strongly advise to keep this PR as it is and refactor later.\n,https://github.com/bitcoin/bitcoin/pull/7691#discussion_r57717528,57717528,src/wallet/wallet.cpp
MarcoFalke,2016-03-29T12:55:18Z,Appears out of scope for this pull.\n,https://github.com/bitcoin/bitcoin/pull/7691#discussion_r57717650,57717650,src/wallet/wallet.cpp
jtimon,2016-03-29T12:55:32Z,"Never mind, it won't make much sense until you can explicitly pass it to GetArg(), like in https://github.com/bitcoin/bitcoin/pull/6423/commits/3d03f15126b79bd9f22ccd27f1d8ca43d9e16bf5#diff-b7702a084eb00fb47f9800fd68271951R315\n",https://github.com/bitcoin/bitcoin/pull/7691#discussion_r57717677,57717677,src/wallet/wallet.cpp
