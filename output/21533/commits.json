[
  {
    "sha": "05d053cee3852f68213008efda575e90cf4d9787",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzowNWQwNTNjZWUzODUyZjY4MjEzMDA4ZWZkYTU3NWU5MGNmNGQ5Nzg3",
    "commit": {
      "author": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2021-03-27T09:16:43Z"
      },
      "committer": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2021-03-30T08:06:29Z"
      },
      "message": "[rpc] Remove extra_nonce argument from GenerateBlock()\n\nIt's always called with extra_nonce=0",
      "tree": {
        "sha": "423e49db8ce8a247fdb89df979027c17955c56e2",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/423e49db8ce8a247fdb89df979027c17955c56e2"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/05d053cee3852f68213008efda575e90cf4d9787",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/05d053cee3852f68213008efda575e90cf4d9787",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/05d053cee3852f68213008efda575e90cf4d9787",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/05d053cee3852f68213008efda575e90cf4d9787/comments",
    "author": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "3ececa76b70cbc5b0eaba3a0ddf72f9bd681d906",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3ececa76b70cbc5b0eaba3a0ddf72f9bd681d906",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/3ececa76b70cbc5b0eaba3a0ddf72f9bd681d906"
      }
    ],
    "stats": {
      "total": 9,
      "additions": 4,
      "deletions": 5
    },
    "files": [
      {
        "sha": "a365b673b7a22615001886094444a638e4d8fdef",
        "filename": "src/rpc/mining.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 5,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/05d053cee3852f68213008efda575e90cf4d9787/src/rpc/mining.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/05d053cee3852f68213008efda575e90cf4d9787/src/rpc/mining.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpc/mining.cpp?ref=05d053cee3852f68213008efda575e90cf4d9787",
        "patch": "@@ -105,9 +105,10 @@ static RPCHelpMan getnetworkhashps()\n     };\n }\n \n-static bool GenerateBlock(ChainstateManager& chainman, CBlock& block, uint64_t& max_tries, unsigned int& extra_nonce, uint256& block_hash)\n+static bool GenerateBlock(ChainstateManager& chainman, CBlock& block, uint64_t& max_tries, uint256& block_hash)\n {\n     block_hash.SetNull();\n+    unsigned int extra_nonce{0};\n \n     {\n         LOCK(cs_main);\n@@ -146,7 +147,6 @@ static UniValue generateBlocks(ChainstateManager& chainman, const CTxMemPool& me\n         nHeight = ::ChainActive().Height();\n         nHeightEnd = nHeight+nGenerate;\n     }\n-    unsigned int nExtraNonce = 0;\n     UniValue blockHashes(UniValue::VARR);\n     while (nHeight < nHeightEnd && !ShutdownRequested())\n     {\n@@ -156,7 +156,7 @@ static UniValue generateBlocks(ChainstateManager& chainman, const CTxMemPool& me\n         CBlock *pblock = &pblocktemplate->block;\n \n         uint256 block_hash;\n-        if (!GenerateBlock(chainman, *pblock, nMaxTries, nExtraNonce, block_hash)) {\n+        if (!GenerateBlock(chainman, *pblock, nMaxTries, block_hash)) {\n             break;\n         }\n \n@@ -382,9 +382,8 @@ static RPCHelpMan generateblock()\n \n     uint256 block_hash;\n     uint64_t max_tries{DEFAULT_MAX_TRIES};\n-    unsigned int extra_nonce{0};\n \n-    if (!GenerateBlock(EnsureChainman(request.context), block, max_tries, extra_nonce, block_hash) || block_hash.IsNull()) {\n+    if (!GenerateBlock(EnsureChainman(request.context), block, max_tries, block_hash) || block_hash.IsNull()) {\n         throw JSONRPCError(RPC_MISC_ERROR, \"Failed to make block.\");\n     }\n "
      }
    ]
  },
  {
    "sha": "5a0379f0aa06e5adb918f6c359f9f11ac45a2f6d",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1YTAzNzlmMGFhMDZlNWFkYjkxOGY2YzM1OWY5ZjExYWM0NWEyZjZk",
    "commit": {
      "author": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2021-03-27T09:20:07Z"
      },
      "committer": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2021-03-30T08:06:29Z"
      },
      "message": "[mining] Remove nExtraNonce argument from IncrementExtraNonce()\n\nIt's always called with 0.",
      "tree": {
        "sha": "3e632f1f1934c764b134fbde472a4a9bf553de47",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3e632f1f1934c764b134fbde472a4a9bf553de47"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5a0379f0aa06e5adb918f6c359f9f11ac45a2f6d",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5a0379f0aa06e5adb918f6c359f9f11ac45a2f6d",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/5a0379f0aa06e5adb918f6c359f9f11ac45a2f6d",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5a0379f0aa06e5adb918f6c359f9f11ac45a2f6d/comments",
    "author": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "05d053cee3852f68213008efda575e90cf4d9787",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/05d053cee3852f68213008efda575e90cf4d9787",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/05d053cee3852f68213008efda575e90cf4d9787"
      }
    ],
    "stats": {
      "total": 13,
      "additions": 5,
      "deletions": 8
    },
    "files": [
      {
        "sha": "28a4d94f9b332794b55818ab99e851e4f2dff8f9",
        "filename": "src/miner.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 3,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5a0379f0aa06e5adb918f6c359f9f11ac45a2f6d/src/miner.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5a0379f0aa06e5adb918f6c359f9f11ac45a2f6d/src/miner.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/miner.cpp?ref=5a0379f0aa06e5adb918f6c359f9f11ac45a2f6d",
        "patch": "@@ -434,13 +434,12 @@ void BlockAssembler::addPackageTxs(int &nPackagesSelected, int &nDescendantsUpda\n     }\n }\n \n-void IncrementExtraNonce(CBlock* pblock, const CBlockIndex* pindexPrev, unsigned int& nExtraNonce)\n+void IncrementExtraNonce(CBlock* pblock, const CBlockIndex* pindexPrev)\n {\n-    // Update nExtraNonce\n+    unsigned int nExtraNonce{0};\n     static uint256 hashPrevBlock;\n     if (hashPrevBlock != pblock->hashPrevBlock)\n     {\n-        nExtraNonce = 0;\n         hashPrevBlock = pblock->hashPrevBlock;\n     }\n     ++nExtraNonce;"
      },
      {
        "sha": "b4e0205adc9d06db1c1f65cbce0ffc04b0da5f32",
        "filename": "src/miner.h",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5a0379f0aa06e5adb918f6c359f9f11ac45a2f6d/src/miner.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5a0379f0aa06e5adb918f6c359f9f11ac45a2f6d/src/miner.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/miner.h?ref=5a0379f0aa06e5adb918f6c359f9f11ac45a2f6d",
        "patch": "@@ -198,7 +198,7 @@ class BlockAssembler\n };\n \n /** Modify the extranonce in a block */\n-void IncrementExtraNonce(CBlock* pblock, const CBlockIndex* pindexPrev, unsigned int& nExtraNonce);\n+void IncrementExtraNonce(CBlock* pblock, const CBlockIndex* pindexPrev);\n int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParams, const CBlockIndex* pindexPrev);\n \n /** Update an old GenerateCoinbaseCommitment from CreateNewBlock after the block txs have changed */"
      },
      {
        "sha": "a37e7a40072e23845e1cc07d6944f058902458da",
        "filename": "src/rpc/mining.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 2,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5a0379f0aa06e5adb918f6c359f9f11ac45a2f6d/src/rpc/mining.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5a0379f0aa06e5adb918f6c359f9f11ac45a2f6d/src/rpc/mining.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpc/mining.cpp?ref=5a0379f0aa06e5adb918f6c359f9f11ac45a2f6d",
        "patch": "@@ -108,11 +108,10 @@ static RPCHelpMan getnetworkhashps()\n static bool GenerateBlock(ChainstateManager& chainman, CBlock& block, uint64_t& max_tries, uint256& block_hash)\n {\n     block_hash.SetNull();\n-    unsigned int extra_nonce{0};\n \n     {\n         LOCK(cs_main);\n-        IncrementExtraNonce(&block, ::ChainActive().Tip(), extra_nonce);\n+        IncrementExtraNonce(&block, ::ChainActive().Tip());\n     }\n \n     CChainParams chainparams(Params());"
      },
      {
        "sha": "45e5fbddf514a6457473b69182721283e5c6e37e",
        "filename": "src/test/blockfilter_index_tests.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 2,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5a0379f0aa06e5adb918f6c359f9f11ac45a2f6d/src/test/blockfilter_index_tests.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5a0379f0aa06e5adb918f6c359f9f11ac45a2f6d/src/test/blockfilter_index_tests.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/blockfilter_index_tests.cpp?ref=5a0379f0aa06e5adb918f6c359f9f11ac45a2f6d",
        "patch": "@@ -73,8 +73,7 @@ CBlock BuildChainTestingSetup::CreateBlock(const CBlockIndex* prev,\n         block.vtx.push_back(MakeTransactionRef(tx));\n     }\n     // IncrementExtraNonce creates a valid coinbase and merkleRoot\n-    unsigned int extraNonce = 0;\n-    IncrementExtraNonce(&block, prev, extraNonce);\n+    IncrementExtraNonce(&block, prev);\n \n     while (!CheckProofOfWork(block.GetHash(), block.nBits, chainparams.GetConsensus())) ++block.nNonce;\n "
      }
    ]
  },
  {
    "sha": "dd5c07e97ee06e9fbdde253c2989fe12c58bc5e2",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpkZDVjMDdlOTdlZTA2ZTlmYmRkZTI1M2MyOTg5ZmUxMmM1OGJjNWUy",
    "commit": {
      "author": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2021-03-27T09:30:52Z"
      },
      "committer": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2021-03-30T08:06:29Z"
      },
      "message": "[mining] Remove nExtraNonce variable from IncrementExtraNonce\n\nIt's always set to 1 and never changed. Just use a integer literal.",
      "tree": {
        "sha": "e51ec91478155d15d7240a63cb9ff3e6898b9fac",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e51ec91478155d15d7240a63cb9ff3e6898b9fac"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/dd5c07e97ee06e9fbdde253c2989fe12c58bc5e2",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/dd5c07e97ee06e9fbdde253c2989fe12c58bc5e2",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/dd5c07e97ee06e9fbdde253c2989fe12c58bc5e2",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/dd5c07e97ee06e9fbdde253c2989fe12c58bc5e2/comments",
    "author": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "5a0379f0aa06e5adb918f6c359f9f11ac45a2f6d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5a0379f0aa06e5adb918f6c359f9f11ac45a2f6d",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/5a0379f0aa06e5adb918f6c359f9f11ac45a2f6d"
      }
    ],
    "stats": {
      "total": 10,
      "additions": 6,
      "deletions": 4
    },
    "files": [
      {
        "sha": "7a9e3ad87191ae528031937d7fa0e16367278ffc",
        "filename": "src/miner.cpp",
        "status": "modified",
        "additions": 6,
        "deletions": 4,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/dd5c07e97ee06e9fbdde253c2989fe12c58bc5e2/src/miner.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/dd5c07e97ee06e9fbdde253c2989fe12c58bc5e2/src/miner.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/miner.cpp?ref=dd5c07e97ee06e9fbdde253c2989fe12c58bc5e2",
        "patch": "@@ -436,16 +436,18 @@ void BlockAssembler::addPackageTxs(int &nPackagesSelected, int &nDescendantsUpda\n \n void IncrementExtraNonce(CBlock* pblock, const CBlockIndex* pindexPrev)\n {\n-    unsigned int nExtraNonce{0};\n     static uint256 hashPrevBlock;\n     if (hashPrevBlock != pblock->hashPrevBlock)\n     {\n         hashPrevBlock = pblock->hashPrevBlock;\n     }\n-    ++nExtraNonce;\n-    unsigned int nHeight = pindexPrev->nHeight+1; // Height first in coinbase required for block.version=2\n+\n     CMutableTransaction txCoinbase(*pblock->vtx[0]);\n-    txCoinbase.vin[0].scriptSig = (CScript() << nHeight << CScriptNum(nExtraNonce));\n+\n+    // Coinbase scriptSig contains height first (required for block.version=2)\n+    // followed by an extra nonce (1).\n+    unsigned int nHeight = pindexPrev->nHeight + 1; \n+    txCoinbase.vin[0].scriptSig = (CScript() << nHeight << CScriptNum(1));\n     assert(txCoinbase.vin[0].scriptSig.size() <= 100);\n \n     pblock->vtx[0] = MakeTransactionRef(std::move(txCoinbase));"
      }
    ]
  },
  {
    "sha": "b971c6c538cf275d57e6a9bd467b80df060022e0",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiOTcxYzZjNTM4Y2YyNzVkNTdlNmE5YmQ0NjdiODBkZjA2MDAyMmUw",
    "commit": {
      "author": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2021-03-27T09:32:47Z"
      },
      "committer": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2021-03-30T08:06:29Z"
      },
      "message": "[mining] Remove hashPrevBlock static variable from IncrementExtraNonce\n\nIt's unused.",
      "tree": {
        "sha": "a6dbe7672621732cad0133d6ba90ff1351ce622a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a6dbe7672621732cad0133d6ba90ff1351ce622a"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b971c6c538cf275d57e6a9bd467b80df060022e0",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b971c6c538cf275d57e6a9bd467b80df060022e0",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/b971c6c538cf275d57e6a9bd467b80df060022e0",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b971c6c538cf275d57e6a9bd467b80df060022e0/comments",
    "author": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "dd5c07e97ee06e9fbdde253c2989fe12c58bc5e2",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/dd5c07e97ee06e9fbdde253c2989fe12c58bc5e2",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/dd5c07e97ee06e9fbdde253c2989fe12c58bc5e2"
      }
    ],
    "stats": {
      "total": 6,
      "additions": 0,
      "deletions": 6
    },
    "files": [
      {
        "sha": "e03d9381a7c7ffb5b5c8b1005b7065f55372fdab",
        "filename": "src/miner.cpp",
        "status": "modified",
        "additions": 0,
        "deletions": 6,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/b971c6c538cf275d57e6a9bd467b80df060022e0/src/miner.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/b971c6c538cf275d57e6a9bd467b80df060022e0/src/miner.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/miner.cpp?ref=b971c6c538cf275d57e6a9bd467b80df060022e0",
        "patch": "@@ -436,12 +436,6 @@ void BlockAssembler::addPackageTxs(int &nPackagesSelected, int &nDescendantsUpda\n \n void IncrementExtraNonce(CBlock* pblock, const CBlockIndex* pindexPrev)\n {\n-    static uint256 hashPrevBlock;\n-    if (hashPrevBlock != pblock->hashPrevBlock)\n-    {\n-        hashPrevBlock = pblock->hashPrevBlock;\n-    }\n-\n     CMutableTransaction txCoinbase(*pblock->vtx[0]);\n \n     // Coinbase scriptSig contains height first (required for block.version=2)"
      }
    ]
  },
  {
    "sha": "2214b41fd34dcdcf7eac0a4e11f69cc804ae4f83",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyMjE0YjQxZmQzNGRjZGNmN2VhYzBhNGUxMWY2OWNjODA0YWU0Zjgz",
    "commit": {
      "author": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2021-03-27T09:56:03Z"
      },
      "committer": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2021-03-30T08:06:29Z"
      },
      "message": "[mining] Rename IncrementExtraNonce to SetCoinbaseScriptSig",
      "tree": {
        "sha": "c24061cdb6a615d843315cd72fb7e5754b522472",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c24061cdb6a615d843315cd72fb7e5754b522472"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2214b41fd34dcdcf7eac0a4e11f69cc804ae4f83",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2214b41fd34dcdcf7eac0a4e11f69cc804ae4f83",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/2214b41fd34dcdcf7eac0a4e11f69cc804ae4f83",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2214b41fd34dcdcf7eac0a4e11f69cc804ae4f83/comments",
    "author": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "b971c6c538cf275d57e6a9bd467b80df060022e0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b971c6c538cf275d57e6a9bd467b80df060022e0",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/b971c6c538cf275d57e6a9bd467b80df060022e0"
      }
    ],
    "stats": {
      "total": 12,
      "additions": 6,
      "deletions": 6
    },
    "files": [
      {
        "sha": "68238e25434c4337f50356227293aa06030bbd3f",
        "filename": "src/miner.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2214b41fd34dcdcf7eac0a4e11f69cc804ae4f83/src/miner.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2214b41fd34dcdcf7eac0a4e11f69cc804ae4f83/src/miner.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/miner.cpp?ref=2214b41fd34dcdcf7eac0a4e11f69cc804ae4f83",
        "patch": "@@ -434,7 +434,7 @@ void BlockAssembler::addPackageTxs(int &nPackagesSelected, int &nDescendantsUpda\n     }\n }\n \n-void IncrementExtraNonce(CBlock* pblock, const CBlockIndex* pindexPrev)\n+void SetCoinbaseScriptSig(CBlock* pblock, const CBlockIndex* pindexPrev)\n {\n     CMutableTransaction txCoinbase(*pblock->vtx[0]);\n "
      },
      {
        "sha": "8a74d45d9c49b3a187a1dd90b417d52b5c257329",
        "filename": "src/miner.h",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2214b41fd34dcdcf7eac0a4e11f69cc804ae4f83/src/miner.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2214b41fd34dcdcf7eac0a4e11f69cc804ae4f83/src/miner.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/miner.h?ref=2214b41fd34dcdcf7eac0a4e11f69cc804ae4f83",
        "patch": "@@ -197,8 +197,8 @@ class BlockAssembler\n     int UpdatePackagesForAdded(const CTxMemPool::setEntries& alreadyAdded, indexed_modified_transaction_set& mapModifiedTx) EXCLUSIVE_LOCKS_REQUIRED(m_mempool.cs);\n };\n \n-/** Modify the extranonce in a block */\n-void IncrementExtraNonce(CBlock* pblock, const CBlockIndex* pindexPrev);\n+/** Resets the coinbase scriptSig to be valid according to BIP 30 and recalculates the merkle root. */\n+void SetCoinbaseScriptSig(CBlock* pblock, const CBlockIndex* pindexPrev);\n int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParams, const CBlockIndex* pindexPrev);\n \n /** Update an old GenerateCoinbaseCommitment from CreateNewBlock after the block txs have changed */"
      },
      {
        "sha": "0da5a9e83857e1da0e6f753c04efe8fde0661ca7",
        "filename": "src/rpc/mining.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2214b41fd34dcdcf7eac0a4e11f69cc804ae4f83/src/rpc/mining.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2214b41fd34dcdcf7eac0a4e11f69cc804ae4f83/src/rpc/mining.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpc/mining.cpp?ref=2214b41fd34dcdcf7eac0a4e11f69cc804ae4f83",
        "patch": "@@ -111,7 +111,7 @@ static bool GenerateBlock(ChainstateManager& chainman, CBlock& block, uint64_t&\n \n     {\n         LOCK(cs_main);\n-        IncrementExtraNonce(&block, ::ChainActive().Tip());\n+        SetCoinbaseScriptSig(&block, ::ChainActive().Tip());\n     }\n \n     CChainParams chainparams(Params());"
      },
      {
        "sha": "a3ee4032c8d20b69ca7a06a30f5cdcd077c850e0",
        "filename": "src/test/blockfilter_index_tests.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2214b41fd34dcdcf7eac0a4e11f69cc804ae4f83/src/test/blockfilter_index_tests.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2214b41fd34dcdcf7eac0a4e11f69cc804ae4f83/src/test/blockfilter_index_tests.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/blockfilter_index_tests.cpp?ref=2214b41fd34dcdcf7eac0a4e11f69cc804ae4f83",
        "patch": "@@ -72,8 +72,8 @@ CBlock BuildChainTestingSetup::CreateBlock(const CBlockIndex* prev,\n     for (const CMutableTransaction& tx : txns) {\n         block.vtx.push_back(MakeTransactionRef(tx));\n     }\n-    // IncrementExtraNonce creates a valid coinbase and merkleRoot\n-    IncrementExtraNonce(&block, prev);\n+    // SetCoinbaseScriptSig creates a valid coinbase and merkleRoot\n+    SetCoinbaseScriptSig(&block, prev);\n \n     while (!CheckProofOfWork(block.GetHash(), block.nBits, chainparams.GetConsensus())) ++block.nNonce;\n "
      }
    ]
  },
  {
    "sha": "b97a35b3b7fc1bc09f5f38516dadf0afaed6a6e7",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiOTdhMzViM2I3ZmMxYmMwOWY1ZjM4NTE2ZGFkZjBhZmFlZDZhNmU3",
    "commit": {
      "author": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2021-03-27T10:04:57Z"
      },
      "committer": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2021-03-30T08:30:08Z"
      },
      "message": "[miner] Update SetCoinbaseScriptSig to take height\n\nTakes the height of the desired block instead of the *CBlockIndex of the\nprevious block.",
      "tree": {
        "sha": "cf4c765964693c10ab8e6b9180d7eb2023207c02",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/cf4c765964693c10ab8e6b9180d7eb2023207c02"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b97a35b3b7fc1bc09f5f38516dadf0afaed6a6e7",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b97a35b3b7fc1bc09f5f38516dadf0afaed6a6e7",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/b97a35b3b7fc1bc09f5f38516dadf0afaed6a6e7",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b97a35b3b7fc1bc09f5f38516dadf0afaed6a6e7/comments",
    "author": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "2214b41fd34dcdcf7eac0a4e11f69cc804ae4f83",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2214b41fd34dcdcf7eac0a4e11f69cc804ae4f83",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/2214b41fd34dcdcf7eac0a4e11f69cc804ae4f83"
      }
    ],
    "stats": {
      "total": 16,
      "additions": 7,
      "deletions": 9
    },
    "files": [
      {
        "sha": "37ce3dadde4a93fb52d1cc5a8b4ace900dd53779",
        "filename": "src/miner.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 3,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/b97a35b3b7fc1bc09f5f38516dadf0afaed6a6e7/src/miner.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/b97a35b3b7fc1bc09f5f38516dadf0afaed6a6e7/src/miner.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/miner.cpp?ref=b97a35b3b7fc1bc09f5f38516dadf0afaed6a6e7",
        "patch": "@@ -434,14 +434,14 @@ void BlockAssembler::addPackageTxs(int &nPackagesSelected, int &nDescendantsUpda\n     }\n }\n \n-void SetCoinbaseScriptSig(CBlock* pblock, const CBlockIndex* pindexPrev)\n+void SetCoinbaseScriptSig(CBlock* pblock, int32_t height)\n {\n+    assert(height > 0);\n     CMutableTransaction txCoinbase(*pblock->vtx[0]);\n \n     // Coinbase scriptSig contains height first (required for block.version=2)\n     // followed by an extra nonce (1).\n-    unsigned int nHeight = pindexPrev->nHeight + 1; \n-    txCoinbase.vin[0].scriptSig = (CScript() << nHeight << CScriptNum(1));\n+    txCoinbase.vin[0].scriptSig = (CScript() << height << CScriptNum(1));\n     assert(txCoinbase.vin[0].scriptSig.size() <= 100);\n \n     pblock->vtx[0] = MakeTransactionRef(std::move(txCoinbase));"
      },
      {
        "sha": "a9fede070d8a6fc614c52ca7dec6292741d7a886",
        "filename": "src/miner.h",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/b97a35b3b7fc1bc09f5f38516dadf0afaed6a6e7/src/miner.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/b97a35b3b7fc1bc09f5f38516dadf0afaed6a6e7/src/miner.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/miner.h?ref=b97a35b3b7fc1bc09f5f38516dadf0afaed6a6e7",
        "patch": "@@ -198,7 +198,7 @@ class BlockAssembler\n };\n \n /** Resets the coinbase scriptSig to be valid according to BIP 30 and recalculates the merkle root. */\n-void SetCoinbaseScriptSig(CBlock* pblock, const CBlockIndex* pindexPrev);\n+void SetCoinbaseScriptSig(CBlock* pblock, int32_t height);\n int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParams, const CBlockIndex* pindexPrev);\n \n /** Update an old GenerateCoinbaseCommitment from CreateNewBlock after the block txs have changed */"
      },
      {
        "sha": "dc50bb2f3a5c472a1e7bcfbe5153b23ed461096f",
        "filename": "src/rpc/mining.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 4,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/b97a35b3b7fc1bc09f5f38516dadf0afaed6a6e7/src/rpc/mining.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/b97a35b3b7fc1bc09f5f38516dadf0afaed6a6e7/src/rpc/mining.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpc/mining.cpp?ref=b97a35b3b7fc1bc09f5f38516dadf0afaed6a6e7",
        "patch": "@@ -109,10 +109,8 @@ static bool GenerateBlock(ChainstateManager& chainman, CBlock& block, uint64_t&\n {\n     block_hash.SetNull();\n \n-    {\n-        LOCK(cs_main);\n-        SetCoinbaseScriptSig(&block, ::ChainActive().Tip());\n-    }\n+    const int32_t height = chainman.ActiveHeight() + 1;\n+    SetCoinbaseScriptSig(&block, height);\n \n     CChainParams chainparams(Params());\n "
      },
      {
        "sha": "7e9cec1cc8d4235c30e2fa019434325af184b764",
        "filename": "src/test/blockfilter_index_tests.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/b97a35b3b7fc1bc09f5f38516dadf0afaed6a6e7/src/test/blockfilter_index_tests.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/b97a35b3b7fc1bc09f5f38516dadf0afaed6a6e7/src/test/blockfilter_index_tests.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/blockfilter_index_tests.cpp?ref=b97a35b3b7fc1bc09f5f38516dadf0afaed6a6e7",
        "patch": "@@ -73,7 +73,7 @@ CBlock BuildChainTestingSetup::CreateBlock(const CBlockIndex* prev,\n         block.vtx.push_back(MakeTransactionRef(tx));\n     }\n     // SetCoinbaseScriptSig creates a valid coinbase and merkleRoot\n-    SetCoinbaseScriptSig(&block, prev);\n+    SetCoinbaseScriptSig(&block, prev->nHeight + 1);\n \n     while (!CheckProofOfWork(block.GetHash(), block.nBits, chainparams.GetConsensus())) ++block.nNonce;\n "
      }
    ]
  },
  {
    "sha": "fcc0b525e212c3c2b5ff58de9c19cc4c152720f6",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmY2MwYjUyNWUyMTJjM2MyYjVmZjU4ZGU5YzE5Y2M0YzE1MjcyMGY2",
    "commit": {
      "author": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2021-03-27T10:17:27Z"
      },
      "committer": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2021-03-30T08:30:10Z"
      },
      "message": "[rpc] Remove block_hash out param from GenerateBlock\n\nIt's redundant with the block in/out param.",
      "tree": {
        "sha": "9a35b7f4c8426120446230e19b7c6fc5f5f6271e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9a35b7f4c8426120446230e19b7c6fc5f5f6271e"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fcc0b525e212c3c2b5ff58de9c19cc4c152720f6",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fcc0b525e212c3c2b5ff58de9c19cc4c152720f6",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fcc0b525e212c3c2b5ff58de9c19cc4c152720f6",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fcc0b525e212c3c2b5ff58de9c19cc4c152720f6/comments",
    "author": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "b97a35b3b7fc1bc09f5f38516dadf0afaed6a6e7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b97a35b3b7fc1bc09f5f38516dadf0afaed6a6e7",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/b97a35b3b7fc1bc09f5f38516dadf0afaed6a6e7"
      }
    ],
    "stats": {
      "total": 23,
      "additions": 10,
      "deletions": 13
    },
    "files": [
      {
        "sha": "18ff943547be3c62e9d740eca4408a670036a123",
        "filename": "src/rpc/mining.cpp",
        "status": "modified",
        "additions": 10,
        "deletions": 13,
        "changes": 23,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fcc0b525e212c3c2b5ff58de9c19cc4c152720f6/src/rpc/mining.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fcc0b525e212c3c2b5ff58de9c19cc4c152720f6/src/rpc/mining.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpc/mining.cpp?ref=fcc0b525e212c3c2b5ff58de9c19cc4c152720f6",
        "patch": "@@ -105,10 +105,8 @@ static RPCHelpMan getnetworkhashps()\n     };\n }\n \n-static bool GenerateBlock(ChainstateManager& chainman, CBlock& block, uint64_t& max_tries, uint256& block_hash)\n+static bool GenerateBlock(ChainstateManager& chainman, CBlock& block, uint64_t& max_tries)\n {\n-    block_hash.SetNull();\n-\n     const int32_t height = chainman.ActiveHeight() + 1;\n     SetCoinbaseScriptSig(&block, height);\n \n@@ -130,7 +128,10 @@ static bool GenerateBlock(ChainstateManager& chainman, CBlock& block, uint64_t&\n         throw JSONRPCError(RPC_INTERNAL_ERROR, \"ProcessNewBlock, block not accepted\");\n     }\n \n-    block_hash = block.GetHash();\n+    if (block.GetHash().IsNull()) {\n+        throw JSONRPCError(RPC_MISC_ERROR, \"Failed to make block.\");\n+    }\n+\n     return true;\n }\n \n@@ -152,15 +153,12 @@ static UniValue generateBlocks(ChainstateManager& chainman, const CTxMemPool& me\n             throw JSONRPCError(RPC_INTERNAL_ERROR, \"Couldn't create new block\");\n         CBlock *pblock = &pblocktemplate->block;\n \n-        uint256 block_hash;\n-        if (!GenerateBlock(chainman, *pblock, nMaxTries, block_hash)) {\n+        if (!GenerateBlock(chainman, *pblock, nMaxTries)) {\n             break;\n         }\n \n-        if (!block_hash.IsNull()) {\n-            ++nHeight;\n-            blockHashes.push_back(block_hash.GetHex());\n-        }\n+        blockHashes.push_back(pblock->GetHash().GetHex());\n+        ++nHeight;\n     }\n     return blockHashes;\n }\n@@ -377,15 +375,14 @@ static RPCHelpMan generateblock()\n         }\n     }\n \n-    uint256 block_hash;\n     uint64_t max_tries{DEFAULT_MAX_TRIES};\n \n-    if (!GenerateBlock(EnsureChainman(request.context), block, max_tries, block_hash) || block_hash.IsNull()) {\n+    if (!GenerateBlock(EnsureChainman(request.context), block, max_tries)) {\n         throw JSONRPCError(RPC_MISC_ERROR, \"Failed to make block.\");\n     }\n \n     UniValue obj(UniValue::VOBJ);\n-    obj.pushKV(\"hash\", block_hash.GetHex());\n+    obj.pushKV(\"hash\", block.GetHash().GetHex());\n     return obj;\n },\n     };"
      }
    ]
  }
]