dcousens,2016-08-25T23:55:33Z,"@gmaxwell how does this impact on the connectivity of those [non-incoming] nodes? (that is, does it hinder them at all?)\n",https://github.com/bitcoin/bitcoin/pull/8594#issuecomment-242582502,242582502,
pstratem,2016-08-26T01:03:25Z,utACK 53f8f226bd1d627c4a6dec5862a1d4ea5a933e45\n\ntravis is borked\n,https://github.com/bitcoin/bitcoin/pull/8594#issuecomment-242591646,242591646,
rebroad,2016-08-26T04:06:05Z,utACK\n,https://github.com/bitcoin/bitcoin/pull/8594#issuecomment-242625387,242625387,
sipa,2016-08-26T07:12:02Z,@EthanHeilman any comments here?\n,https://github.com/bitcoin/bitcoin/pull/8594#issuecomment-242648082,242648082,
laanwj,2016-08-26T09:19:30Z,"utACK, this has bothered me before\n",https://github.com/bitcoin/bitcoin/pull/8594#issuecomment-242676784,242676784,
sipa,2016-08-26T13:01:51Z,utACK\n,https://github.com/bitcoin/bitcoin/pull/8594#issuecomment-242729060,242729060,
sipa,2016-08-26T13:06:22Z,Can we backport this to 0.13?\n,https://github.com/bitcoin/bitcoin/pull/8594#issuecomment-242730040,242730040,
EthanHeilman,2016-08-26T15:20:27Z,"@sipa @gmaxwell Reading [main.cpp:5033](https://github.com/bitcoin/bitcoin/blob/master/src/main.cpp#L5033), my understanding is that incoming connections are only added to the tried table if the source IP address of the TCP connection is the same as the IP address supplied in the version message. [The assumption here is that if the peer's IP in the version message is the same as the IP in TCP conn",https://github.com/bitcoin/bitcoin/pull/8594#issuecomment-242765325,242765325,
laanwj,2016-08-26T15:29:05Z,"> Reading main.cpp:5033, my understanding is that incoming connections are only added to the tried table if the source IP address of the TCP connection is the same as the IP address supplied in the version message.\n\nDo we leak internal LAN IPs here, or is that prevented some way? Nodes should probably not advertise their address at all on outgoing connections, certainly not if they don't want / ",https://github.com/bitcoin/bitcoin/pull/8594#issuecomment-242767752,242767752,
EthanHeilman,2016-08-26T16:18:52Z,> Do we leak internal LAN IPs here.\n\nWhen sending a version message you include your local IP address (see [net.cpp:503](https://github.com/bitcoin/bitcoin/blob/53f8f226bd1d627c4a6dec5862a1d4ea5a933e45/src/net.cpp#L503)) but the logic which determines this is fairly complicated (see [net.cpp:13](https://github.com/bitcoin/bitcoin/blob/026c6edac947eccb6d6e544468080af9c53593a8/src/net.cpp#L132)). ,https://github.com/bitcoin/bitcoin/pull/8594#issuecomment-242781076,242781076,
sipa,2016-08-26T16:47:05Z,"@EthanHeilman It seems dangerous to me to let an attacker directly enter their IP addresses into our tried table. By murmuring addresses they're certainly able to get into the known table, but the tried table should be reserved for IPs which we selected ourselves. Feel free to contradict my intuition here if you have numbers that show otherwise, though.\n",https://github.com/bitcoin/bitcoin/pull/8594#issuecomment-242788078,242788078,
EthanHeilman,2016-08-26T17:28:57Z,@sipa Its an interesting question and I'm not sure what the right answer is.\n\n> It seems dangerous to me to let an attacker basically enter their IP addresses into our tried table [..] the tried table should be reserved for IPs which we selected ourselves.\n\nIf tried addresses are only added when we select them I agree it would make it harder for an attacker to control tried but it would also h,https://github.com/bitcoin/bitcoin/pull/8594#issuecomment-242798577,242798577,
sipa,2016-08-26T17:30:17Z,I would be fine with adding them to the new table... that is identical to what would happen (and likely happens anyway) when they send us an addr message after connecting.\n,https://github.com/bitcoin/bitcoin/pull/8594#issuecomment-242798932,242798932,
gmaxwell,2016-08-26T20:12:55Z,"@EthanHeilman  hosts already send an addr message on connect (see the above stanza), which will add it to new.  So I think also doing it there doesn't add anything new except making it more likely that they'll advertise themselves accidentally. \n\nThe fact that it was ever added to tried at all was a mistake that violated the design of the system, tried table was supposed to be protected against ",https://github.com/bitcoin/bitcoin/pull/8594#issuecomment-242839289,242839289,
luke-jr,2016-08-27T03:26:40Z,"> I've checked a bunch of older bitcoind logs and it appears that when the host is behind a NAT it sets the IP address in the version message to either 0.0.0.0 or 127.0.0.1. Not sure if that is always true. Can someone who is behind a NAT confirm this behavior in more recent code?\n\nWireshark tells me I am sending my _local-scope_ IPv6 address, when connecting over IPv4 (behind NAT)... :/\n",https://github.com/bitcoin/bitcoin/pull/8594#issuecomment-242892770,242892770,
sipa,2016-08-27T17:51:34Z,@luke-jr Can you open a separate issue for that? We should never send local addresses out.\n,https://github.com/bitcoin/bitcoin/pull/8594#issuecomment-242931105,242931105,
gmaxwell,2016-09-01T07:28:21Z,Where are we on this?\n,https://github.com/bitcoin/bitcoin/pull/8594#issuecomment-243998285,243998285,
sipa,2016-09-01T10:41:26Z,"@EthanHeilman Since we are announcing our own address as soon as we're past IBD anyway, and there is nothing to prevent other nodes from doing the same, what value does this suggested call to `addrMan.Add(addr, addr)` have?\n",https://github.com/bitcoin/bitcoin/pull/8594#issuecomment-244042189,244042189,
laanwj,2016-09-01T13:08:19Z,"> Where are we on this?\n\nI still think we should continue with this change. I think it would be good eventually to deprecate ""addrFrom"" in `version` messages completely: to just send a dummy value and ignore what is sent there. It's a nest of potential privacy and spoofing issues (akin to the `X-Forwarded-For` header the for HTTP proxies). Also from a protocol point of view advertisement should ",https://github.com/bitcoin/bitcoin/pull/8594#issuecomment-244073014,244073014,
gmaxwell,2016-09-03T09:31:41Z,"@laanwj  Yes, I agree, I think we should do something when we receive address advertisements to up-weight self ones-- probably by giving the source a time penalty of zero for it's own address in CAddrMan::Add.  But I think that makes sense as a separate PR. (I'll go do that now).\n",https://github.com/bitcoin/bitcoin/pull/8594#issuecomment-244536894,244536894,
gmaxwell,2016-09-06T00:52:13Z,@laanwj  PR #8661 now applies that heuristic for self announcements in addr messages. \n,https://github.com/bitcoin/bitcoin/pull/8594#issuecomment-244826501,244826501,
EthanHeilman,2016-09-06T21:09:52Z,"@gmaxwell After thinking about this PR more and performing some back of the envelope calculations I am no longer opposed to this change. To understand the trade-offs I performed a short analysis.\n\nEclipse attackers have two resources: \n1. time the attack requires,\n2. and attacker controlled IPs in different IP groups (\16 prefixes). \n\nThis PR helps attackers by reducing the number of IP addr",https://github.com/bitcoin/bitcoin/pull/8594#issuecomment-245092554,245092554,
sipa,2016-09-07T11:15:52Z,@EthanHeilman Thanks a lot for the analysis.\n,https://github.com/bitcoin/bitcoin/pull/8594#issuecomment-245249914,245249914,
