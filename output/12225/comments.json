[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/359144267",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12225#issuecomment-359144267",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12225",
    "id": 359144267,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1OTE0NDI2Nw==",
    "user": {
      "login": "meshcollider",
      "id": 3211283,
      "node_id": "MDQ6VXNlcjMyMTEyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3211283?u=447cdc9e2966cbee415545c8ff452954ee1209af&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meshcollider",
      "html_url": "https://github.com/meshcollider",
      "followers_url": "https://api.github.com/users/meshcollider/followers",
      "following_url": "https://api.github.com/users/meshcollider/following{/other_user}",
      "gists_url": "https://api.github.com/users/meshcollider/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
      "organizations_url": "https://api.github.com/users/meshcollider/orgs",
      "repos_url": "https://api.github.com/users/meshcollider/repos",
      "events_url": "https://api.github.com/users/meshcollider/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meshcollider/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-20T04:23:39Z",
    "updated_at": "2018-01-20T04:23:39Z",
    "author_association": "MEMBER",
    "body": "utACK https://github.com/bitcoin/bitcoin/commit/16a8389bb14a892c204efe0d39580b4c1458e098",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/359144267/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/359493121",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12225#issuecomment-359493121",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12225",
    "id": 359493121,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1OTQ5MzEyMQ==",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-22T17:03:00Z",
    "updated_at": "2018-01-22T17:03:00Z",
    "author_association": "MEMBER",
    "body": "@promag After further investigation, it looks like FlushUnconfirmed() doesn't need the mempool at all, so I re-wrote it a bit.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/359493121/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/360634570",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12225#issuecomment-360634570",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12225",
    "id": 360634570,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MDYzNDU3MA==",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-25T23:24:38Z",
    "updated_at": "2018-01-25T23:24:38Z",
    "author_association": "MEMBER",
    "body": "Squashed [12225.1](https://github.com/sdaftuar/bitcoin/commits/12225.1) -> 669c943",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/360634570/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/362816749",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12225#issuecomment-362816749",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12225",
    "id": 362816749,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MjgxNjc0OQ==",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?u=4a9af998e1a560b3f49c3827f453e1bcbe6a5cfb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-03T14:48:05Z",
    "updated_at": "2018-02-03T14:48:05Z",
    "author_association": "MEMBER",
    "body": "utACK 669c943.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/362816749/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/364249295",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12225#issuecomment-364249295",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12225",
    "id": 364249295,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NDI0OTI5NQ==",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-08T21:10:26Z",
    "updated_at": "2018-02-08T21:10:26Z",
    "author_association": "MEMBER",
    "body": "utACK 669c943",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/364249295/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162785977",
    "pull_request_review_id": 90307148,
    "id": 162785977,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2Mjc4NTk3Nw==",
    "diff_hunk": "@@ -984,10 +984,9 @@ bool CBlockPolicyEstimator::Read(CAutoFile& filein)\n void CBlockPolicyEstimator::FlushUnconfirmed(CTxMemPool& pool) {\n     int64_t startclear = GetTimeMicros();\n     std::vector<uint256> txids;",
    "path": "src/policy/fees.cpp",
    "position": null,
    "original_position": 3,
    "commit_id": "669c9433cfbc6bc25243fcdb550009b2d4180cc9",
    "original_commit_id": "16a8389bb14a892c204efe0d39580b4c1458e098",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Remove?",
    "created_at": "2018-01-20T15:58:26Z",
    "updated_at": "2018-01-25T23:23:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12225#discussion_r162785977",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12225",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162785977"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12225#discussion_r162785977"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12225"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162785977/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 986,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162786011",
    "pull_request_review_id": 90307148,
    "id": 162786011,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2Mjc4NjAxMQ==",
    "diff_hunk": "@@ -984,10 +984,9 @@ bool CBlockPolicyEstimator::Read(CAutoFile& filein)\n void CBlockPolicyEstimator::FlushUnconfirmed(CTxMemPool& pool) {\n     int64_t startclear = GetTimeMicros();\n     std::vector<uint256> txids;\n-    pool.queryHashes(txids);\n-    LOCK(cs_feeEstimator);\n-    for (auto& txid : txids) {\n-        removeTx(txid, false);\n+    LOCK2(pool.cs, cs_feeEstimator);\n+    for (auto mi=pool.mapTx.begin(); mi != pool.mapTx.end(); ++mi) {",
    "path": "src/policy/fees.cpp",
    "position": null,
    "original_position": 9,
    "commit_id": "669c9433cfbc6bc25243fcdb550009b2d4180cc9",
    "original_commit_id": "16a8389bb14a892c204efe0d39580b4c1458e098",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Nit, can early exit loop if `mapMemPoolTxs` is empty.",
    "created_at": "2018-01-20T16:00:08Z",
    "updated_at": "2018-01-25T23:23:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12225#discussion_r162786011",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12225",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162786011"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12225#discussion_r162786011"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12225"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162786011/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 988,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162786072",
    "pull_request_review_id": 90307148,
    "id": 162786072,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2Mjc4NjA3Mg==",
    "diff_hunk": "@@ -984,10 +984,9 @@ bool CBlockPolicyEstimator::Read(CAutoFile& filein)\n void CBlockPolicyEstimator::FlushUnconfirmed(CTxMemPool& pool) {\n     int64_t startclear = GetTimeMicros();\n     std::vector<uint256> txids;\n-    pool.queryHashes(txids);\n-    LOCK(cs_feeEstimator);\n-    for (auto& txid : txids) {\n-        removeTx(txid, false);\n+    LOCK2(pool.cs, cs_feeEstimator);\n+    for (auto mi=pool.mapTx.begin(); mi != pool.mapTx.end(); ++mi) {\n+        removeTx(mi->GetTx().GetHash(), false);\n     }\n     int64_t endclear = GetTimeMicros();\n     LogPrint(BCLog::ESTIMATEFEE, \"Recorded %u unconfirmed txs from mempool in %gs\\n\",txids.size(), (endclear - startclear)*0.000001);",
    "path": "src/policy/fees.cpp",
    "position": null,
    "original_position": 13,
    "commit_id": "669c9433cfbc6bc25243fcdb550009b2d4180cc9",
    "original_commit_id": "16a8389bb14a892c204efe0d39580b4c1458e098",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "`txids` is empty, update logging.",
    "created_at": "2018-01-20T16:03:27Z",
    "updated_at": "2018-01-25T23:23:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12225#discussion_r162786072",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12225",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162786072"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12225#discussion_r162786072"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12225"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162786072/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 992,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163065783",
    "pull_request_review_id": 90623112,
    "id": 163065783,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2MzA2NTc4Mw==",
    "diff_hunk": "@@ -981,16 +981,17 @@ bool CBlockPolicyEstimator::Read(CAutoFile& filein)\n     return true;\n }\n \n-void CBlockPolicyEstimator::FlushUnconfirmed(CTxMemPool& pool) {\n+void CBlockPolicyEstimator::FlushUnconfirmed() {\n     int64_t startclear = GetTimeMicros();\n-    std::vector<uint256> txids;\n-    pool.queryHashes(txids);\n     LOCK(cs_feeEstimator);\n-    for (auto& txid : txids) {\n-        removeTx(txid, false);\n+    size_t num_entries = mapMemPoolTxs.size();\n+    // Remove every entry in mapMemPoolTxs\n+    while (!mapMemPoolTxs.empty()) {\n+        auto mi = mapMemPoolTxs.begin();\n+        removeTx(mi->first, false); // this calls erase() on mapMemPoolTxs",
    "path": "src/policy/fees.cpp",
    "position": 16,
    "original_position": 16,
    "commit_id": "669c9433cfbc6bc25243fcdb550009b2d4180cc9",
    "original_commit_id": "bd5260956b2a4698c35aef6ebc1991a230eed54d",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "IMO decreasing one by one is avoidable when the end result is to be empty. Prefer something like?\r\n```cpp\r\nLOCK(cs_feeEstimator);\r\nsize_t num_entries = mapMemPoolTxs.size();\r\nfor (const auto& it = mapMemPoolTxs.begin(); it != mapMemPoolTxs.end(); ++it) {\r\n    const auto& stat = it->second;\r\n    feeStats->removeTx(stat.blockHeight, nBestSeenHeight, stat.bucketIndex, false);\r\n    shortStats->removeTx(stat.blockHeight, nBestSeenHeight, stat.bucketIndex, false);\r\n    longStats->removeTx(stat.blockHeight, nBestSeenHeight, stat.bucketIndex, false);\r\n}\r\nmapMemPoolTxs.clear();\r\n```",
    "created_at": "2018-01-22T20:56:56Z",
    "updated_at": "2018-01-25T23:23:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12225#discussion_r163065783",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12225",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163065783"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12225#discussion_r163065783"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12225"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163065783/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 991,
    "original_line": 991,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163325957",
    "pull_request_review_id": 90921502,
    "id": 163325957,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2MzMyNTk1Nw==",
    "diff_hunk": "@@ -981,16 +981,17 @@ bool CBlockPolicyEstimator::Read(CAutoFile& filein)\n     return true;\n }\n \n-void CBlockPolicyEstimator::FlushUnconfirmed(CTxMemPool& pool) {\n+void CBlockPolicyEstimator::FlushUnconfirmed() {\n     int64_t startclear = GetTimeMicros();\n-    std::vector<uint256> txids;\n-    pool.queryHashes(txids);\n     LOCK(cs_feeEstimator);\n-    for (auto& txid : txids) {\n-        removeTx(txid, false);\n+    size_t num_entries = mapMemPoolTxs.size();\n+    // Remove every entry in mapMemPoolTxs\n+    while (!mapMemPoolTxs.empty()) {\n+        auto mi = mapMemPoolTxs.begin();\n+        removeTx(mi->first, false); // this calls erase() on mapMemPoolTxs",
    "path": "src/policy/fees.cpp",
    "position": 16,
    "original_position": 16,
    "commit_id": "669c9433cfbc6bc25243fcdb550009b2d4180cc9",
    "original_commit_id": "bd5260956b2a4698c35aef6ebc1991a230eed54d",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I didn't want to duplicate the code in `removeTx()` or figure out how to refactor it to be more efficient for this purpose -- since `FlushUnconfirmed()` is only called in shutdown, I don't think the performance savings here from more code changes is worth the review/maintenance burden.\r\n\r\nIf you'd rather see a bigger refactor here to clean things up, I think I'd prefer to just remove this commit and someone can take it on in a new PR...",
    "created_at": "2018-01-23T17:58:04Z",
    "updated_at": "2018-01-25T23:23:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12225#discussion_r163325957",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12225",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163325957"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12225#discussion_r163325957"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12225"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163325957/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 991,
    "original_line": 991,
    "side": "RIGHT",
    "in_reply_to_id": 163065783
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163414631",
    "pull_request_review_id": 91024726,
    "id": 163414631,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2MzQxNDYzMQ==",
    "diff_hunk": "@@ -981,16 +981,17 @@ bool CBlockPolicyEstimator::Read(CAutoFile& filein)\n     return true;\n }\n \n-void CBlockPolicyEstimator::FlushUnconfirmed(CTxMemPool& pool) {\n+void CBlockPolicyEstimator::FlushUnconfirmed() {\n     int64_t startclear = GetTimeMicros();\n-    std::vector<uint256> txids;\n-    pool.queryHashes(txids);\n     LOCK(cs_feeEstimator);\n-    for (auto& txid : txids) {\n-        removeTx(txid, false);\n+    size_t num_entries = mapMemPoolTxs.size();\n+    // Remove every entry in mapMemPoolTxs\n+    while (!mapMemPoolTxs.empty()) {\n+        auto mi = mapMemPoolTxs.begin();\n+        removeTx(mi->first, false); // this calls erase() on mapMemPoolTxs",
    "path": "src/policy/fees.cpp",
    "position": 16,
    "original_position": 16,
    "commit_id": "669c9433cfbc6bc25243fcdb550009b2d4180cc9",
    "original_commit_id": "bd5260956b2a4698c35aef6ebc1991a230eed54d",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think it's fine as it is. I'll take note to measure an alternative implementation.",
    "created_at": "2018-01-23T23:52:32Z",
    "updated_at": "2018-01-25T23:23:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12225#discussion_r163414631",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12225",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163414631"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12225#discussion_r163414631"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12225"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163414631/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 991,
    "original_line": 991,
    "side": "RIGHT",
    "in_reply_to_id": 163065783
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163415565",
    "pull_request_review_id": 91025367,
    "id": 163415565,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2MzQxNTU2NQ==",
    "diff_hunk": "@@ -242,14 +242,17 @@ class CompareTxMemPoolEntryByDescendantScore\n /** \\class CompareTxMemPoolEntryByScore\n  *\n  *  Sort by score of entry ((fee+delta)/size) in descending order",
    "path": "src/txmempool.h",
    "position": null,
    "original_position": 3,
    "commit_id": "669c9433cfbc6bc25243fcdb550009b2d4180cc9",
    "original_commit_id": "bd5260956b2a4698c35aef6ebc1991a230eed54d",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Remove `+delta`?",
    "created_at": "2018-01-23T23:56:10Z",
    "updated_at": "2018-01-25T23:23:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12225#discussion_r163415565",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12225",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163415565"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12225#discussion_r163415565"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12225"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163415565/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 244,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163994414",
    "pull_request_review_id": 91702575,
    "id": 163994414,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2Mzk5NDQxNA==",
    "diff_hunk": "@@ -242,14 +242,17 @@ class CompareTxMemPoolEntryByDescendantScore\n /** \\class CompareTxMemPoolEntryByScore\n  *\n  *  Sort by score of entry ((fee+delta)/size) in descending order",
    "path": "src/txmempool.h",
    "position": null,
    "original_position": 3,
    "commit_id": "669c9433cfbc6bc25243fcdb550009b2d4180cc9",
    "original_commit_id": "bd5260956b2a4698c35aef6ebc1991a230eed54d",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Fixed!",
    "created_at": "2018-01-25T23:03:25Z",
    "updated_at": "2018-01-25T23:23:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/12225#discussion_r163994414",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12225",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163994414"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/12225#discussion_r163994414"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/12225"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163994414/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 244,
    "side": "RIGHT",
    "in_reply_to_id": 163415565
  }
]