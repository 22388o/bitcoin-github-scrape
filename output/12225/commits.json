[
  {
    "sha": "09754063e0605429680f4c58a85967777ad87cc1",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzowOTc1NDA2M2UwNjA1NDI5NjgwZjRjNThhODU5Njc3NzdhZDg3Y2Mx",
    "commit": {
      "author": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@gmail.com",
        "date": "2018-01-19T14:58:21Z"
      },
      "committer": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@gmail.com",
        "date": "2018-01-19T14:58:21Z"
      },
      "message": "Correct mempool mapTx comment",
      "tree": {
        "sha": "beee32fa4e312ad4b4361403c8481c61f4d1bb75",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/beee32fa4e312ad4b4361403c8481c61f4d1bb75"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/09754063e0605429680f4c58a85967777ad87cc1",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/09754063e0605429680f4c58a85967777ad87cc1",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/09754063e0605429680f4c58a85967777ad87cc1",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/09754063e0605429680f4c58a85967777ad87cc1/comments",
    "author": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "9a97f39afaa890caa7987c6bc001b9a66e3e74e8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9a97f39afaa890caa7987c6bc001b9a66e3e74e8",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/9a97f39afaa890caa7987c6bc001b9a66e3e74e8"
      }
    ],
    "stats": {
      "total": 3,
      "additions": 2,
      "deletions": 1
    },
    "files": [
      {
        "sha": "d25d9c50bb90b9b0b18380993a0a12f4968e9020",
        "filename": "src/txmempool.h",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/09754063e0605429680f4c58a85967777ad87cc1/src/txmempool.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/09754063e0605429680f4c58a85967777ad87cc1/src/txmempool.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/txmempool.h?ref=09754063e0605429680f4c58a85967777ad87cc1",
        "patch": "@@ -379,8 +379,9 @@ class SaltedTxidHasher\n  *\n  * mapTx is a boost::multi_index that sorts the mempool on 4 criteria:\n  * - transaction hash\n- * - feerate [we use max(feerate of tx, feerate of tx with all descendants)]\n+ * - descendant feerate [we use max(feerate of tx, feerate of tx with all descendants)]\n  * - time in mempool\n+ * - ancestor feerate [we use min(feerate of tx, feerate of tx with all unconfirmed ancestors)]\n  *\n  * Note: the term \"descendant\" refers to in-mempool transactions that depend on\n  * this one, while \"ancestor\" refers to in-mempool transactions that a given"
      }
    ]
  },
  {
    "sha": "e868b22917aee4c888f843bd86a2bf8ea29530eb",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzplODY4YjIyOTE3YWVlNGM4ODhmODQzYmQ4NmEyYmY4ZWEyOTUzMGVi",
    "commit": {
      "author": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@gmail.com",
        "date": "2018-01-19T15:38:58Z"
      },
      "committer": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@gmail.com",
        "date": "2018-01-25T23:02:24Z"
      },
      "message": "fee estimator: avoid sorting mempool on shutdown",
      "tree": {
        "sha": "c559264548ee7734ad583af45329688fbf88e21e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c559264548ee7734ad583af45329688fbf88e21e"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e868b22917aee4c888f843bd86a2bf8ea29530eb",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e868b22917aee4c888f843bd86a2bf8ea29530eb",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/e868b22917aee4c888f843bd86a2bf8ea29530eb",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e868b22917aee4c888f843bd86a2bf8ea29530eb/comments",
    "author": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "09754063e0605429680f4c58a85967777ad87cc1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/09754063e0605429680f4c58a85967777ad87cc1",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/09754063e0605429680f4c58a85967777ad87cc1"
      }
    ],
    "stats": {
      "total": 17,
      "additions": 9,
      "deletions": 8
    },
    "files": [
      {
        "sha": "564b2b3328100ae08c42dec7f9fde9e72bf0fd68",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e868b22917aee4c888f843bd86a2bf8ea29530eb/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e868b22917aee4c888f843bd86a2bf8ea29530eb/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=e868b22917aee4c888f843bd86a2bf8ea29530eb",
        "patch": "@@ -205,7 +205,7 @@ void Shutdown()\n \n     if (fFeeEstimatesInitialized)\n     {\n-        ::feeEstimator.FlushUnconfirmed(::mempool);\n+        ::feeEstimator.FlushUnconfirmed();\n         fs::path est_path = GetDataDir() / FEE_ESTIMATES_FILENAME;\n         CAutoFile est_fileout(fsbridge::fopen(est_path, \"wb\"), SER_DISK, CLIENT_VERSION);\n         if (!est_fileout.IsNull())"
      },
      {
        "sha": "79b450e3e674d249d0fd2631e266f41bdba191da",
        "filename": "src/policy/fees.cpp",
        "status": "modified",
        "additions": 7,
        "deletions": 6,
        "changes": 13,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e868b22917aee4c888f843bd86a2bf8ea29530eb/src/policy/fees.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e868b22917aee4c888f843bd86a2bf8ea29530eb/src/policy/fees.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/policy/fees.cpp?ref=e868b22917aee4c888f843bd86a2bf8ea29530eb",
        "patch": "@@ -981,16 +981,17 @@ bool CBlockPolicyEstimator::Read(CAutoFile& filein)\n     return true;\n }\n \n-void CBlockPolicyEstimator::FlushUnconfirmed(CTxMemPool& pool) {\n+void CBlockPolicyEstimator::FlushUnconfirmed() {\n     int64_t startclear = GetTimeMicros();\n-    std::vector<uint256> txids;\n-    pool.queryHashes(txids);\n     LOCK(cs_feeEstimator);\n-    for (auto& txid : txids) {\n-        removeTx(txid, false);\n+    size_t num_entries = mapMemPoolTxs.size();\n+    // Remove every entry in mapMemPoolTxs\n+    while (!mapMemPoolTxs.empty()) {\n+        auto mi = mapMemPoolTxs.begin();\n+        removeTx(mi->first, false); // this calls erase() on mapMemPoolTxs\n     }\n     int64_t endclear = GetTimeMicros();\n-    LogPrint(BCLog::ESTIMATEFEE, \"Recorded %u unconfirmed txs from mempool in %gs\\n\",txids.size(), (endclear - startclear)*0.000001);\n+    LogPrint(BCLog::ESTIMATEFEE, \"Recorded %u unconfirmed txs from mempool in %gs\\n\", num_entries, (endclear - startclear)*0.000001);\n }\n \n FeeFilterRounder::FeeFilterRounder(const CFeeRate& minIncrementalFee)"
      },
      {
        "sha": "5f69e989c17180b81085c119e4b62ad3d28a0df4",
        "filename": "src/policy/fees.h",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e868b22917aee4c888f843bd86a2bf8ea29530eb/src/policy/fees.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e868b22917aee4c888f843bd86a2bf8ea29530eb/src/policy/fees.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/policy/fees.h?ref=e868b22917aee4c888f843bd86a2bf8ea29530eb",
        "patch": "@@ -223,7 +223,7 @@ class CBlockPolicyEstimator\n     bool Read(CAutoFile& filein);\n \n     /** Empty mempool transactions on shutdown to record failure to confirm for txs still in mempool */\n-    void FlushUnconfirmed(CTxMemPool& pool);\n+    void FlushUnconfirmed();\n \n     /** Calculation of highest target that estimates are tracked for */\n     unsigned int HighestTargetTracked(FeeEstimateHorizon horizon) const;"
      }
    ]
  },
  {
    "sha": "669c9433cfbc6bc25243fcdb550009b2d4180cc9",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo2NjljOTQzM2NmYmM2YmMyNTI0M2ZjZGI1NTAwMDliMmQ0MTgwY2M5",
    "commit": {
      "author": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@gmail.com",
        "date": "2018-01-19T15:53:55Z"
      },
      "committer": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@gmail.com",
        "date": "2018-01-25T23:02:24Z"
      },
      "message": "Avoid leaking prioritization information when relaying transactions",
      "tree": {
        "sha": "164c8ab2d48325d96a903877fd6b722e5d2dc1c3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/164c8ab2d48325d96a903877fd6b722e5d2dc1c3"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/669c9433cfbc6bc25243fcdb550009b2d4180cc9",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/669c9433cfbc6bc25243fcdb550009b2d4180cc9",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/669c9433cfbc6bc25243fcdb550009b2d4180cc9",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/669c9433cfbc6bc25243fcdb550009b2d4180cc9/comments",
    "author": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "e868b22917aee4c888f843bd86a2bf8ea29530eb",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e868b22917aee4c888f843bd86a2bf8ea29530eb",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/e868b22917aee4c888f843bd86a2bf8ea29530eb"
      }
    ],
    "stats": {
      "total": 9,
      "additions": 6,
      "deletions": 3
    },
    "files": [
      {
        "sha": "c6a1bf08ce1eb181a408c27742e8e0611fe82339",
        "filename": "src/txmempool.h",
        "status": "modified",
        "additions": 6,
        "deletions": 3,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/669c9433cfbc6bc25243fcdb550009b2d4180cc9/src/txmempool.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/669c9433cfbc6bc25243fcdb550009b2d4180cc9/src/txmempool.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/txmempool.h?ref=669c9433cfbc6bc25243fcdb550009b2d4180cc9",
        "patch": "@@ -241,15 +241,18 @@ class CompareTxMemPoolEntryByDescendantScore\n \n /** \\class CompareTxMemPoolEntryByScore\n  *\n- *  Sort by score of entry ((fee+delta)/size) in descending order\n+ *  Sort by feerate of entry (fee/size) in descending order\n+ *  This is only used for transaction relay, so we use GetFee()\n+ *  instead of GetModifiedFee() to avoid leaking prioritization\n+ *  information via the sort order.\n  */\n class CompareTxMemPoolEntryByScore\n {\n public:\n     bool operator()(const CTxMemPoolEntry& a, const CTxMemPoolEntry& b) const\n     {\n-        double f1 = (double)a.GetModifiedFee() * b.GetTxSize();\n-        double f2 = (double)b.GetModifiedFee() * a.GetTxSize();\n+        double f1 = (double)a.GetFee() * b.GetTxSize();\n+        double f2 = (double)b.GetFee() * a.GetTxSize();\n         if (f1 == f2) {\n             return b.GetTx().GetHash() < a.GetTx().GetHash();\n         }"
      }
    ]
  }
]