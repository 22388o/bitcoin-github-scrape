sdaftuar,2018-04-06T13:54:27Z,"I triggered this issue while running the tests on the 0.16 branch:\n\n```\n[1mfeature_dbcrash.py[0m failed, Duration: 1185 s\n\n[1mstdout:\n[0m2018-04-05 17:05:30.803000 TestFramework (INFO): Initializing test directory /tmp/bitcoin_test_runner_20180405_130431/feature_dbcrash_170\n2018-04-05 17:06:08.451000 TestFramework (INFO): Prepped 5001 utxo entries\n2018-04-05 17:06:59.908000 Tes",https://github.com/bitcoin/bitcoin/pull/12902#issuecomment-379260451,379260451,
MarcoFalke,2018-04-06T14:48:35Z,"Considering that we usually clean up the datadir when the test was successful, wouldn't it make more sense to delete the cookie when it was left behind due to a crash? That would also limit the changes to `feature_dbcrash`, the only place where the fix would be needed, it seems... Just a thought, no strong opinion.\n\nConcept ACK",https://github.com/bitcoin/bitcoin/pull/12902#issuecomment-379276702,379276702,
sdaftuar,2018-04-06T14:58:10Z,"@MarcoFalke I did consider that as well, also I considered changing the way we use the test framework so that if a cookie file is already present we instruct bitcoind to use it...  None of these options seems all that great to me as this is pretty messy, but I figure that changing `wait_for_rpc_connection` is more robust (ie if other tests end up getting written that need something like this), ver",https://github.com/bitcoin/bitcoin/pull/12902#issuecomment-379279775,379279775,
laanwj,2018-04-09T14:01:54Z,"> Considering that we usually clean up the datadir when the test was successful, wouldn't it make more sense to delete the cookie when it was left behind due to a crash? \n\nThat was my initial response to this as well.\nIf the test framework makes sure that no cookie file is left behind, the race will not trigger in the first place, and we don't have to special-case it.\n\n> Edit: I should a",https://github.com/bitcoin/bitcoin/pull/12902#issuecomment-379762747,379762747,
sdaftuar,2018-04-09T18:58:00Z,"@laanwj @MarcoFalke I reworked this PR to delete cookie files, if present, as suggested.  I avoided putting this logic directly in `feature_dbcrash.py`, since the authentication logic lives in the test framework (and the test is unaware of cookie files or RPC authentication in the first place), but let me know if you think I should move it.\n\nOriginal version of this PR is here for comparison: ",https://github.com/bitcoin/bitcoin/pull/12902#issuecomment-379857698,379857698,
MarcoFalke,2018-04-09T19:21:02Z,utACK 75d0e4c5444249f0cf81ed0494e2c2717170b695,https://github.com/bitcoin/bitcoin/pull/12902#issuecomment-379864151,379864151,
jnewbery,2018-04-09T19:33:57Z,"Tested ACK 75d0e4c5444249f0cf81ed0494e2c2717170b695.\n\nI'd be tempted to put the new functionality directly into `TestNode.start()`, since that's the only place it gets called, but this is also fine.",https://github.com/bitcoin/bitcoin/pull/12902#issuecomment-379868177,379868177,
sdaftuar,2018-04-09T21:08:37Z,">I'd be tempted to put the new functionality directly into TestNode.start(), since that's the only place it gets called, but this is also fine.\n\nNo strong opinion, but it looked like `util.py` is the only place in the test framework that currently knows where cookie files live exactly, so I figured might as well continue to restrict that knowledge to one area of the codebase.",https://github.com/bitcoin/bitcoin/pull/12902#issuecomment-379894739,379894739,
laanwj,2018-04-10T08:17:30Z,post-utACK 75d0e4c5444249f0cf81ed0494e2c2717170b695,https://github.com/bitcoin/bitcoin/pull/12902#issuecomment-380014889,380014889,
jnewbery,2018-04-06T20:13:51Z,"Perhaps log, since this is an unexpected condition?",https://github.com/bitcoin/bitcoin/pull/12902#discussion_r179864429,179864429,test/functional/test_framework/test_node.py
