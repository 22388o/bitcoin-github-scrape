[
  {
    "sha": "75d0e4c5444249f0cf81ed0494e2c2717170b695",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo3NWQwZTRjNTQ0NDI0OWYwY2Y4MWVkMDQ5NGUyYzI3MTcxNzBiNjk1",
    "commit": {
      "author": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@gmail.com",
        "date": "2018-04-09T18:07:47Z"
      },
      "committer": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@gmail.com",
        "date": "2018-04-09T18:35:09Z"
      },
      "message": "[qa] Delete cookie file before starting node\n\nIf a cookie file exists in a datadir prior to node startup, it must have\nbeen leftover from a prior unclean shutdown. As bitcoind will overwrite\nit anyway, delete it before starting up to prevent the test framework\nfrom inadvertently trying to connect using stale credentials.",
      "tree": {
        "sha": "ff787d226b0b904a08bef79e3d5af3ff3420ec7c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ff787d226b0b904a08bef79e3d5af3ff3420ec7c"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/75d0e4c5444249f0cf81ed0494e2c2717170b695",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/75d0e4c5444249f0cf81ed0494e2c2717170b695",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/75d0e4c5444249f0cf81ed0494e2c2717170b695",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/75d0e4c5444249f0cf81ed0494e2c2717170b695/comments",
    "author": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "2b54155a459c235626fddc4495bb681b93d3dbc5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2b54155a459c235626fddc4495bb681b93d3dbc5",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/2b54155a459c235626fddc4495bb681b93d3dbc5"
      }
    ],
    "stats": {
      "total": 11,
      "additions": 11,
      "deletions": 0
    },
    "files": [
      {
        "sha": "9436ae0d3af64aa7ad72cb9819243ba94072a3a1",
        "filename": "test/functional/test_framework/test_node.py",
        "status": "modified",
        "additions": 5,
        "deletions": 0,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/75d0e4c5444249f0cf81ed0494e2c2717170b695/test/functional/test_framework/test_node.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/75d0e4c5444249f0cf81ed0494e2c2717170b695/test/functional/test_framework/test_node.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/test_framework/test_node.py?ref=75d0e4c5444249f0cf81ed0494e2c2717170b695",
        "patch": "@@ -20,6 +20,7 @@\n from .util import (\n     append_config,\n     assert_equal,\n+    delete_cookie_file,\n     get_rpc_proxy,\n     rpc_url,\n     wait_until,\n@@ -105,6 +106,10 @@ def start(self, extra_args=None, stderr=None, *args, **kwargs):\n             extra_args = self.extra_args\n         if stderr is None:\n             stderr = self.stderr\n+        # Delete any existing cookie file -- if such a file exists (eg due to\n+        # unclean shutdown), it will get overwritten anyway by bitcoind, and\n+        # potentially interfere with our attempt to authenticate\n+        delete_cookie_file(self.datadir)\n         self.process = subprocess.Popen(self.args + extra_args, stderr=stderr, *args, **kwargs)\n         self.running = True\n         self.log.debug(\"bitcoind started, waiting for RPC to come up\")"
      },
      {
        "sha": "f22322fbbce1ceea4873952e381a5440a016078a",
        "filename": "test/functional/test_framework/util.py",
        "status": "modified",
        "additions": 6,
        "deletions": 0,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/75d0e4c5444249f0cf81ed0494e2c2717170b695/test/functional/test_framework/util.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/75d0e4c5444249f0cf81ed0494e2c2717170b695/test/functional/test_framework/util.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/test_framework/util.py?ref=75d0e4c5444249f0cf81ed0494e2c2717170b695",
        "patch": "@@ -332,6 +332,12 @@ def get_auth_cookie(datadir):\n         raise ValueError(\"No RPC credentials\")\n     return user, password\n \n+# If a cookie file exists in the given datadir, delete it.\n+def delete_cookie_file(datadir):\n+    if os.path.isfile(os.path.join(datadir, \"regtest\", \".cookie\")):\n+        logger.debug(\"Deleting leftover cookie file\")\n+        os.remove(os.path.join(datadir, \"regtest\", \".cookie\"))\n+\n def get_bip9_status(node, key):\n     info = node.getblockchaininfo()\n     return info['bip9_softforks'][key]"
      }
    ]
  }
]