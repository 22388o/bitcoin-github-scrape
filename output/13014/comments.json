[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/382695431",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13014#issuecomment-382695431",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13014",
    "id": 382695431,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MjY5NTQzMQ==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-19T11:04:08Z",
    "updated_at": "2018-04-19T11:04:08Z",
    "author_association": "MEMBER",
    "body": "Does this work on top of #11857?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/382695431/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/382707420",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13014#issuecomment-382707420",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13014",
    "id": 382707420,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MjcwNzQyMA==",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?u=eab5d0cdbb6cc25087cb61d4ca4a6f85255f42a7&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-19T11:56:20Z",
    "updated_at": "2018-04-19T11:56:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "@sjors: I originally developed this on top of 11857... it's a trivial offset. So yes. It works on top of that.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/382707420/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/385119422",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13014#issuecomment-385119422",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13014",
    "id": 385119422,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4NTExOTQyMg==",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-27T23:37:43Z",
    "updated_at": "2018-04-27T23:37:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "Seems there's lots of debate on the utility here. Concept ACK/NACK discussion is at #12651, so should probably hold off review here so as to avoid splitting the discussion.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/385119422/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/419643642",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13014#issuecomment-419643642",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13014",
    "id": 419643642,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxOTY0MzY0Mg==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-08T13:54:11Z",
    "updated_at": "2018-09-08T13:54:11Z",
    "author_association": "MEMBER",
    "body": "There should be tests to cover the scenario where:\r\n1. an index exists and a block gets pruned\r\n2. an already pruned node is launched with `-txindex` (this should probably fail)\r\n\r\nThe documentation should make it more clear that all transaction hashes since genesis are kept. Normally the index is about 17 GB on mainnet, does this PR make it smaller?\r\n\r\nAn alternative to this PR could be to drop old transactions from the index, though that reduces utility (perhaps better discussed in #12651).\r\n\r\nNeeds (not super difficult) rebase to work with the new `txindex` structure from #13033.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/419643642/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/446711712",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13014#issuecomment-446711712",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13014",
    "id": 446711712,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0NjcxMTcxMg==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-12-12T19:23:24Z",
    "updated_at": "2018-12-12T19:23:24Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--5fd3d806e98f4a0ca80977bb178665a0-->There hasn't been much activity lately and the patch still needs rebase, so I am closing this for now. Please let me know when you want to continue working on this, so the pull request can be re-opened.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/446711712/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/182407413",
    "pull_request_review_id": 113194812,
    "id": 182407413,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4MjQwNzQxMw==",
    "diff_hunk": "@@ -278,7 +278,14 @@ void ThreadScriptCheck();\n /** Check whether we are doing an initial block download (synchronizing from disk or network) */\n bool IsInitialBlockDownload();\n /** Retrieve a transaction (from memory pool, or from disk, if possible) */\n-bool GetTransaction(const uint256& hash, CTransactionRef& tx, const Consensus::Params& params, uint256& hashBlock, bool fAllowSlow = false, CBlockIndex* blockIndex = nullptr);\n+enum class GetTransactionResult\n+{\n+    LOAD_OK,",
    "path": "src/validation.h",
    "position": 7,
    "original_position": 7,
    "commit_id": "ce86c1aa6fbe4c4ccf86033a31f08ebfbec7a1db",
    "original_commit_id": "ce86c1aa6fbe4c4ccf86033a31f08ebfbec7a1db",
    "user": {
      "login": "Empact",
      "id": 5470,
      "node_id": "MDQ6VXNlcjU0NzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5470?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Empact",
      "html_url": "https://github.com/Empact",
      "followers_url": "https://api.github.com/users/Empact/followers",
      "following_url": "https://api.github.com/users/Empact/following{/other_user}",
      "gists_url": "https://api.github.com/users/Empact/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Empact/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Empact/subscriptions",
      "organizations_url": "https://api.github.com/users/Empact/orgs",
      "repos_url": "https://api.github.com/users/Empact/repos",
      "events_url": "https://api.github.com/users/Empact/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Empact/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "`OK` seems sufficient",
    "created_at": "2018-04-18T12:27:47Z",
    "updated_at": "2018-04-18T12:27:47Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13014#discussion_r182407413",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13014",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/182407413"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13014#discussion_r182407413"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13014"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/182407413/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 283,
    "original_line": 283,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/182766138",
    "pull_request_review_id": 113630319,
    "id": 182766138,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4Mjc2NjEzOA==",
    "diff_hunk": "@@ -1016,31 +1016,45 @@ bool GetTransaction(const uint256& hash, CTransactionRef& txOut, const Consensus\n         CTransactionRef ptx = mempool.get(hash);\n         if (ptx) {\n             txOut = ptx;\n-            return true;\n+            return GetTransactionResult::LOAD_OK;\n         }\n \n         if (fTxIndex) {\n             CDiskTxPos postx;\n             if (pblocktree->ReadTxIndex(hash, postx)) {\n+                if (postx.nFile == std::numeric_limits<int>::max()) {\n+                    // blockfile is not available (pruned), CDiskTxPos.nPos points to the blockheight\n+                    // lookup blockindex via height from txindex and set hashBlock\n+                    CBlockIndex *p_index_possible = chainActive[postx.nPos];\n+                    if (p_index_possible) {\n+                        hashBlock = *p_index_possible->phashBlock;",
    "path": "src/validation.cpp",
    "position": 36,
    "original_position": 36,
    "commit_id": "ce86c1aa6fbe4c4ccf86033a31f08ebfbec7a1db",
    "original_commit_id": "ce86c1aa6fbe4c4ccf86033a31f08ebfbec7a1db",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "`hashBlock` is only updated if block index is found. Either `assert(hashBlock.IsNull())` before or just call `hashBlock.SetNull()`.",
    "created_at": "2018-04-19T14:29:03Z",
    "updated_at": "2018-04-19T14:40:04Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13014#discussion_r182766138",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13014",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/182766138"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13014#discussion_r182766138"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13014"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/182766138/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1030,
    "original_line": 1030,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/182766375",
    "pull_request_review_id": 113630319,
    "id": 182766375,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4Mjc2NjM3NQ==",
    "diff_hunk": "@@ -169,13 +169,23 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n \n     CTransactionRef tx;\n     uint256 hash_block;\n-    if (!GetTransaction(hash, tx, Params().GetConsensus(), hash_block, true, blockindex)) {\n+    GetTransactionResult res = GetTransaction(hash, tx, Params().GetConsensus(), hash_block, true, blockindex);\n+    if (res != GetTransactionResult::LOAD_OK) {\n         std::string errmsg;\n         if (blockindex) {\n             if (!(blockindex->nStatus & BLOCK_HAVE_DATA)) {\n                 throw JSONRPCError(RPC_MISC_ERROR, \"Block not available\");\n             }\n             errmsg = \"No such transaction found in the provided block\";\n+        } else if (res == GetTransactionResult::BLOCK_PRUNED) {\n+            //TODO: fetch block via peers, wait for download and return transaction\n+            //see https://github.com/bitcoin/bitcoin/pull/10794\n+            UniValue result(UniValue::VOBJ);\n+            result.pushKV(\"status\", \"pruned\");\n+            result.pushKV(\"inblock\", hash_block.GetHex());",
    "path": "src/rpc/rawtransaction.cpp",
    "position": 18,
    "original_position": 18,
    "commit_id": "ce86c1aa6fbe4c4ccf86033a31f08ebfbec7a1db",
    "original_commit_id": "ce86c1aa6fbe4c4ccf86033a31f08ebfbec7a1db",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "`hash_block` can be null, should display it?",
    "created_at": "2018-04-19T14:29:43Z",
    "updated_at": "2018-04-19T14:40:04Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13014#discussion_r182766375",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13014",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/182766375"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13014#discussion_r182766375"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13014"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/182766375/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 185,
    "original_line": 185,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/182766939",
    "pull_request_review_id": 113630319,
    "id": 182766939,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4Mjc2NjkzOQ==",
    "diff_hunk": "@@ -3544,13 +3558,41 @@ uint64_t CalculateCurrentUsage()\n }\n \n /* Prune a block file (modify associated database entries)*/\n-void PruneOneBlockFile(const int fileNumber)\n+void PruneOneBlockFile(const int fileNumber, CValidationState &state)\n {\n+    AssertLockHeld(cs_main);\n     LOCK(cs_LastBlockFile);\n \n+    int64_t txindex_migration_totaltime = 0;\n     for (const auto& entry : mapBlockIndex) {\n         CBlockIndex* pindex = entry.second;\n         if (pindex->nFile == fileNumber) {\n+            if (fTxIndex && (pindex->nStatus & BLOCK_HAVE_DATA)) {\n+                int64_t time_start = GetTimeMicros();\n+                // migrate pruned txindex data\n+                // txindex entries of pruned blocks will move its CDiskTxPos value to:\n+                //        nFile = INT_MAX <-- indicator that this block is no longer available\n+                //        nPos = block-height in chainActive (assumed reorg safe since prune min target is 288 blocks)\n+                //        nTxOffset = index of transaction position in block (not to confused with data offset)\n+                LogPrintf(\"txindex block pruning: %s migrate txindex data from block %s\\n\", __func__, pindex->GetBlockHash().GetHex());\n+                CBlock block;\n+                if (!ReadBlockFromDisk(block, pindex, Params().GetConsensus())) {\n+                    AbortNode(state, \"Failed to read block\");\n+                    return;\n+                }\n+                std::vector<std::pair<uint256, CDiskTxPos>> vPos;\n+                unsigned int txpos = 0;\n+                for(const auto& tx : block.vtx)",
    "path": "src/validation.cpp",
    "position": 131,
    "original_position": 131,
    "commit_id": "ce86c1aa6fbe4c4ccf86033a31f08ebfbec7a1db",
    "original_commit_id": "ce86c1aa6fbe4c4ccf86033a31f08ebfbec7a1db",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Missing space after `for`. `{` in this line. ",
    "created_at": "2018-04-19T14:31:13Z",
    "updated_at": "2018-04-19T14:40:04Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13014#discussion_r182766939",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13014",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/182766939"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13014#discussion_r182766939"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13014"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/182766939/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 3585,
    "original_line": 3585,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/183538600",
    "pull_request_review_id": 114557040,
    "id": 183538600,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4MzUzODYwMA==",
    "diff_hunk": "@@ -3544,13 +3558,41 @@ uint64_t CalculateCurrentUsage()\n }\n \n /* Prune a block file (modify associated database entries)*/\n-void PruneOneBlockFile(const int fileNumber)\n+void PruneOneBlockFile(const int fileNumber, CValidationState &state)\n {\n+    AssertLockHeld(cs_main);\n     LOCK(cs_LastBlockFile);\n \n+    int64_t txindex_migration_totaltime = 0;\n     for (const auto& entry : mapBlockIndex) {\n         CBlockIndex* pindex = entry.second;\n         if (pindex->nFile == fileNumber) {\n+            if (fTxIndex && (pindex->nStatus & BLOCK_HAVE_DATA)) {\n+                int64_t time_start = GetTimeMicros();\n+                // migrate pruned txindex data\n+                // txindex entries of pruned blocks will move its CDiskTxPos value to:\n+                //        nFile = INT_MAX <-- indicator that this block is no longer available\n+                //        nPos = block-height in chainActive (assumed reorg safe since prune min target is 288 blocks)\n+                //        nTxOffset = index of transaction position in block (not to confused with data offset)\n+                LogPrintf(\"txindex block pruning: %s migrate txindex data from block %s\\n\", __func__, pindex->GetBlockHash().GetHex());\n+                CBlock block;\n+                if (!ReadBlockFromDisk(block, pindex, Params().GetConsensus())) {\n+                    AbortNode(state, \"Failed to read block\");\n+                    return;\n+                }\n+                std::vector<std::pair<uint256, CDiskTxPos>> vPos;\n+                unsigned int txpos = 0;\n+                for(const auto& tx : block.vtx)",
    "path": "src/validation.cpp",
    "position": 131,
    "original_position": 131,
    "commit_id": "ce86c1aa6fbe4c4ccf86033a31f08ebfbec7a1db",
    "original_commit_id": "ce86c1aa6fbe4c4ccf86033a31f08ebfbec7a1db",
    "user": {
      "login": "Empact",
      "id": 5470,
      "node_id": "MDQ6VXNlcjU0NzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5470?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Empact",
      "html_url": "https://github.com/Empact",
      "followers_url": "https://api.github.com/users/Empact/followers",
      "following_url": "https://api.github.com/users/Empact/following{/other_user}",
      "gists_url": "https://api.github.com/users/Empact/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Empact/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Empact/subscriptions",
      "organizations_url": "https://api.github.com/users/Empact/orgs",
      "repos_url": "https://api.github.com/users/Empact/repos",
      "events_url": "https://api.github.com/users/Empact/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Empact/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "clang-format will fix this and maybe more.",
    "created_at": "2018-04-23T21:09:40Z",
    "updated_at": "2018-04-23T21:09:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13014#discussion_r183538600",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13014",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/183538600"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13014#discussion_r183538600"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13014"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/183538600/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 3585,
    "original_line": 3585,
    "side": "RIGHT",
    "in_reply_to_id": 182766939
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194871802",
    "pull_request_review_id": 128127809,
    "id": 194871802,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDg3MTgwMg==",
    "diff_hunk": "@@ -169,13 +169,23 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n \n     CTransactionRef tx;\n     uint256 hash_block;\n-    if (!GetTransaction(hash, tx, Params().GetConsensus(), hash_block, true, blockindex)) {\n+    GetTransactionResult res = GetTransaction(hash, tx, Params().GetConsensus(), hash_block, true, blockindex);\n+    if (res != GetTransactionResult::LOAD_OK) {\n         std::string errmsg;\n         if (blockindex) {\n             if (!(blockindex->nStatus & BLOCK_HAVE_DATA)) {\n                 throw JSONRPCError(RPC_MISC_ERROR, \"Block not available\");\n             }\n             errmsg = \"No such transaction found in the provided block\";\n+        } else if (res == GetTransactionResult::BLOCK_PRUNED) {\n+            //TODO: fetch block via peers, wait for download and return transaction\n+            //see https://github.com/bitcoin/bitcoin/pull/10794\n+            UniValue result(UniValue::VOBJ);\n+            result.pushKV(\"status\", \"pruned\");\n+            result.pushKV(\"inblock\", hash_block.GetHex());",
    "path": "src/rpc/rawtransaction.cpp",
    "position": 18,
    "original_position": 18,
    "commit_id": "ce86c1aa6fbe4c4ccf86033a31f08ebfbec7a1db",
    "original_commit_id": "ce86c1aa6fbe4c4ccf86033a31f08ebfbec7a1db",
    "user": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Should be `\"blockhash\"`",
    "created_at": "2018-06-12T20:07:50Z",
    "updated_at": "2018-06-12T20:07:50Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/13014#discussion_r194871802",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13014",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194871802"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/13014#discussion_r194871802"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/13014"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194871802/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 185,
    "original_line": 185,
    "side": "RIGHT"
  }
]