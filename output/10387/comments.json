[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/321078772",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-321078772",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
    "id": 321078772,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyMTA3ODc3Mg==",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?u=eab5d0cdbb6cc25087cb61d4ca4a6f85255f42a7&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-08-08T20:53:51Z",
    "updated_at": "2017-12-11T19:58:26Z",
    "author_association": "CONTRIBUTOR",
    "body": "~~Rebased, overhauled and removed WIP tag.\r\nConforms now to BIP159.\r\nAdded 0.16 milestone tag.~~",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/321078772/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/321900407",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-321900407",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
    "id": 321900407,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyMTkwMDQwNw==",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?u=eab5d0cdbb6cc25087cb61d4ca4a6f85255f42a7&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-08-11T19:34:37Z",
    "updated_at": "2017-12-11T19:58:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "~~Added a fingerprinting counter-measure which protects from leaking the prune depth by finding it through getdata requests (21c347c8c1a9ee4803b8f8f124185c218e01db76).~~",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/321900407/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/332722581",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-332722581",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
    "id": 332722581,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzMjcyMjU4MQ==",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?u=eab5d0cdbb6cc25087cb61d4ca4a6f85255f42a7&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-09-28T04:10:43Z",
    "updated_at": "2017-09-28T04:10:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "Fixed travis trailing whitespace in test issue.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/332722581/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/333018185",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-333018185",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
    "id": 333018185,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzMzAxODE4NQ==",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?u=eab5d0cdbb6cc25087cb61d4ca4a6f85255f42a7&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-09-29T02:56:13Z",
    "updated_at": "2017-12-11T19:58:50Z",
    "author_association": "CONTRIBUTOR",
    "body": "~~Thanks for the review @TheBlueMatt. I agree with all you points and most things can now go away since the NODE_NETWORK_LIMITED_HIGH flag (1152 blocks minimum) is gone.~~\r\n\r\n~~Will overhaul and simplify it now.~~",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/333018185/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/333352493",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-333352493",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
    "id": 333352493,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzMzM1MjQ5Mw==",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?u=eab5d0cdbb6cc25087cb61d4ca4a6f85255f42a7&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-10-01T04:22:37Z",
    "updated_at": "2017-10-01T04:22:37Z",
    "author_association": "CONTRIBUTOR",
    "body": "Simplified the PR and addressed @TheBlueMatt and @fanquake points.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/333352493/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/334043193",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-334043193",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
    "id": 334043193,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzNDA0MzE5Mw==",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?u=eab5d0cdbb6cc25087cb61d4ca4a6f85255f42a7&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-10-04T03:53:25Z",
    "updated_at": "2017-10-04T03:53:25Z",
    "author_association": "CONTRIBUTOR",
    "body": "> This change prefers connecting to full nodes rather than pruned nodes even if fully synced. Why is that the desired approach?\r\n> [...]\r\n> I find that the required services/relevant services/alternative services stuff is getting confusing. If I'm reading it right, the order of preference is... [...]\r\n\r\nWe probably should avoid an abrupt change for pruned peers. This approach (alternative services) would result is a slow usage of the current deployed (and then upgraded) pruned peers. Otherwise, pruned peers may see a significant overall usage (bandwidth / CPU / disk-usage) bump.\r\n\r\nSince there is no toggle to disable NODE_NETWORK_LIMITED signalling in pruned mode, I think this (slow) approach would be wise.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/334043193/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/334053167",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-334053167",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
    "id": 334053167,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzNDA1MzE2Nw==",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?u=eab5d0cdbb6cc25087cb61d4ca4a6f85255f42a7&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-10-04T05:25:14Z",
    "updated_at": "2017-10-04T05:25:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "Addressed @theuni & @TheBlueMatt points. Now mentions BIP159 in `protocol.h` (found by @jimpo).",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/334053167/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/334289031",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-334289031",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
    "id": 334289031,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzNDI4OTAzMQ==",
    "user": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-10-04T21:04:42Z",
    "updated_at": "2017-10-04T21:04:42Z",
    "author_association": "MEMBER",
    "body": "\"Set NODE_NETWORK_LIMITED bit in pruned mode\" commit message is confusing now. Mind rewording it to reflect the new behavior?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/334289031/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/334292226",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-334292226",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
    "id": 334292226,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzNDI5MjIyNg==",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?u=eab5d0cdbb6cc25087cb61d4ca4a6f85255f42a7&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-10-04T21:17:37Z",
    "updated_at": "2017-10-04T21:17:37Z",
    "author_association": "CONTRIBUTOR",
    "body": "@theuni: overhauled that commit message.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/334292226/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/334490761",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-334490761",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
    "id": 334490761,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzNDQ5MDc2MQ==",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-10-05T14:55:34Z",
    "updated_at": "2017-10-05T14:55:34Z",
    "author_association": "CONTRIBUTOR",
    "body": "The nRelevantServices stuff is somewhat already a mess, and trying to work within the current code is just getting messier :/. I spent a bit of time rewriting it and (mostly) like the outcome, its at https://github.com/TheBlueMatt/bitcoin/commit/2017-09-service-flags-cleanups - and I think basing this PR on it would simplify this one a lot. It sucks to add some functions to protocol.h/cpp, especially if they have knowledge of IBD state, but that should be able to move soon once @theuni makes net.cpp not aware of service bits.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/334490761/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/334492023",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-334492023",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
    "id": 334492023,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzNDQ5MjAyMw==",
    "user": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-10-05T14:59:29Z",
    "updated_at": "2017-10-05T14:59:29Z",
    "author_association": "MEMBER",
    "body": "Agree with @TheBlueMatt on taking that as a starting point. We discussed it a little, and I think defining functions for the filtered use-cases makes life much easier. @jonasschnelli it's kinda intrusive on the PR, but would it be possible to work that in?\r\n\r\nAs for making net not aware of service bits, I'm working on breaking addrman out right now. Should be pretty painless and a nice improvement.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/334492023/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/336610623",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-336610623",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
    "id": 336610623,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzNjYxMDYyMw==",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?u=eab5d0cdbb6cc25087cb61d4ca4a6f85255f42a7&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-10-14T05:05:40Z",
    "updated_at": "2017-10-14T05:05:40Z",
    "author_association": "CONTRIBUTOR",
    "body": "Rebased (since #11456 is now merged). Tried to keep calls to `InitialBlockDownload()` to a minimum, therefore added `initialBlockDownloadCompleted` (bool) to `protocol.h`. Not sure if this is the best idea (ping @TheBlueMatt & @theuni).",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/336610623/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/341883431",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-341883431",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
    "id": 341883431,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0MTg4MzQzMQ==",
    "user": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?u=a0e0040aacd7d4f0787481e8ac30b494fa429e11&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-04T09:25:45Z",
    "updated_at": "2017-11-04T09:25:45Z",
    "author_association": "MEMBER",
    "body": "This needs a rebase.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/341883431/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/343357330",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-343357330",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
    "id": 343357330,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0MzM1NzMzMA==",
    "user": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?u=63e5c438c242094837a9deeda775d77988b508bf&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-10T02:33:17Z",
    "updated_at": "2017-11-10T02:33:17Z",
    "author_association": "CONTRIBUTOR",
    "body": "Perhaps this should be split into \"set the limited flag\" PR and make use of it, the setting is ultra trivial and could even be considered for backport, esp since the anti-fingerprinting part is a bugfix.\r\n\r\nThe actual use of the flag in our connection I think needs work,  we should be using our current time and our current headers to decide if LIMITED peers are likely useful to us. IsInitialBlockDownload is a very vague and general criteria and isn't the one we want here.\r\n\r\nI think what we want is a function that tells us if we expect limited peers to be useful.   If the headers we have say that there are more than 280 blocks missing,  limited is not useful for us. Or if our best header timestamp is more than (say) 1.75 days old, we should assume they're not useful to us.    When we connect, we'll learn headers, so if for example we're 300 blocks behind we'll find out then, and then not consider limited peers anymore until we catch up.\r\n\r\nFor deciding on fetching, we should already have headers, and so the fetch should perhaps just only be checking if the peer block is more than 280 blocks back (again, giving 8 blocks slack to cover cases where the peer gets blocks where we haven't heard of the headers yet).\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/343357330/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/344722807",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-344722807",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
    "id": 344722807,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NDcyMjgwNw==",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?u=eab5d0cdbb6cc25087cb61d4ca4a6f85255f42a7&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-15T20:45:30Z",
    "updated_at": "2017-11-15T20:45:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "Rebased and worked in @TheBlueMatt and @gmaxwell point.\r\nIt's still based on `IsInitialBlockDownload()` but I have plans to implement @gmaxwell idea (which makes sense to me) to rely on out time and headers. ",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/344722807/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345766694",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-345766694",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
    "id": 345766694,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NTc2NjY5NA==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-20T17:24:21Z",
    "updated_at": "2017-11-20T17:26:31Z",
    "author_association": "MEMBER",
    "body": "This 288 blocks limit seems a bit overzealous, but I suppose it can be expanded later if nodes just assume 288 for un-upgraded peers.\r\n\r\nI couldn't find the discussion that led to that [change in BIP159](https://github.com/bitcoin/bips/commit/ee45bbc7c4962d4b551d730469749bb35df18757#diff-6535b2c529c4fce0dc36d586cc0b05f4), so maybe this was already brought up.\r\n\r\nThe node on my laptop is pruned to 10 GB, Bitseed and Raspberry Pie nodes might be pruned to 100-200 GB. They can be of use to nodes even during IBD. To prevent fingerprinting and still allow more flexibility in sharing data, perhaps `NODE_NETWORK_LIMITED_MIN_BLOCKS` can be made configurable and somehow communicated? The default could still be 288, with a number of specific suggestions in bitcoin.conf.\r\n\r\nThe setting could be sanity checked against `prune=` and - better, but not sure if possible - automatically chosen based on the worst case for `prune=` (again, limited options, e.g. ..., 1 GB, 10 GB, 100 GB, ...).\r\n\r\nAlso, what happens if a node has a prune= setting that's above the current blockchain size? Does it advertise as NODE_NETWORK_LIMITED? Ideally it wouldn't. Perhaps this can be added to the BIP?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345766694/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345770763",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-345770763",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
    "id": 345770763,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NTc3MDc2Mw==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-20T17:38:26Z",
    "updated_at": "2017-11-20T17:38:34Z",
    "author_association": "MEMBER",
    "body": "Found this (Google is more helpful when you search by name than by BIP number): https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014314.html (should be added to the References section in the BIP?)\r\n\r\nFrom that discussion:\r\n> The peak at syncing is at ~24 hours\r\n\r\nThis explains why even 288 is very useful (worth mentioning in the BIP).\r\n\r\nThere was some discussion around which sizes to allow, but it was mostly focussed on not using more service bits than needed (or states). I wouldn't want to waste those of course. Can a node simply disclose the pruning depth when asked (within a limited set of choices to prevent fingerprinting), or would that open a can of worms?\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345770763/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345814463",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-345814463",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
    "id": 345814463,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NTgxNDQ2Mw==",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?u=eab5d0cdbb6cc25087cb61d4ca4a6f85255f42a7&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-20T20:05:47Z",
    "updated_at": "2017-11-20T20:05:47Z",
    "author_association": "CONTRIBUTOR",
    "body": "I think we should only discuss the implementation here. The BIP discussion belongs to the mailing list (https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/thread.html#14315).\r\n\r\nRevealing the prune depth is considered a fingerprinting weakness.\r\n\r\nThe current BIP and implementation is extendable. I'd like to start with a sane buffer 24h of blocks (144) + 144 block reorganisation buffer. It is possible to extend this later with more differentiated depths.\r\n\r\nIt would also be possible to bypass the anti-fingerprinting hard 288blocks limit when whitelisting the peer (or once we have BIP150) (not in scope for this PR).",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345814463/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/351171415",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-351171415",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
    "id": 351171415,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MTE3MTQxNQ==",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?u=eab5d0cdbb6cc25087cb61d4ca4a6f85255f42a7&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-12T19:42:48Z",
    "updated_at": "2017-12-12T19:42:48Z",
    "author_association": "CONTRIBUTOR",
    "body": "Rebased and removed the now merged signalling part.\r\nThis PR adds address relay and eventually connecting to NODE_NETWORK_LIMITED if we are out of IBD.\r\nNot sure, but maybe @gmaxwell [idea ](https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-343357330) should be implemented later?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/351171415/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/351626166",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-351626166",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
    "id": 351626166,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MTYyNjE2Ng==",
    "user": {
      "login": "NicolasDorier",
      "id": 3020646,
      "node_id": "MDQ6VXNlcjMwMjA2NDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3020646?u=256d78207f88d303d61b62060a309657276cf6cb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NicolasDorier",
      "html_url": "https://github.com/NicolasDorier",
      "followers_url": "https://api.github.com/users/NicolasDorier/followers",
      "following_url": "https://api.github.com/users/NicolasDorier/following{/other_user}",
      "gists_url": "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NicolasDorier/subscriptions",
      "organizations_url": "https://api.github.com/users/NicolasDorier/orgs",
      "repos_url": "https://api.github.com/users/NicolasDorier/repos",
      "events_url": "https://api.github.com/users/NicolasDorier/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NicolasDorier/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-14T07:03:22Z",
    "updated_at": "2017-12-14T07:03:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "Code review ACK. Might need in a follow up PR to kick limited peers when we go back in IBD though.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/351626166/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/356197529",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-356197529",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
    "id": 356197529,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1NjE5NzUyOQ==",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?u=eab5d0cdbb6cc25087cb61d4ca4a6f85255f42a7&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-09T07:01:36Z",
    "updated_at": "2018-01-09T07:01:36Z",
    "author_association": "CONTRIBUTOR",
    "body": "Rebased (needed due to the the node network test overhaul).\r\nFixed @jimpo's points.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/356197529/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/364375158",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-364375158",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
    "id": 364375158,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NDM3NTE1OA==",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?u=eab5d0cdbb6cc25087cb61d4ca4a6f85255f42a7&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-09T09:02:11Z",
    "updated_at": "2018-02-09T09:02:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "Rebased.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/364375158/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/365658285",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-365658285",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
    "id": 365658285,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NTY1ODI4NQ==",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-14T16:15:37Z",
    "updated_at": "2018-02-14T16:15:37Z",
    "author_association": "MEMBER",
    "body": "utACK 3f56df5",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/365658285/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/366432079",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-366432079",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
    "id": 366432079,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NjQzMjA3OQ==",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?u=eab5d0cdbb6cc25087cb61d4ca4a6f85255f42a7&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-17T10:30:41Z",
    "updated_at": "2018-02-17T10:30:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "Added a commit that hides the new `protocol.h/.cpp` global (`g_initial_block_download_completed`) behinds a setter (@laanwj / https://github.com/bitcoin/bitcoin/pull/10387#discussion_r168228007).",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/366432079/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/140946427",
    "pull_request_review_id": 65089115,
    "id": 140946427,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0MDk0NjQyNw==",
    "diff_hunk": "@@ -1006,6 +1020,13 @@ void static ProcessGetData(CNode* pfrom, const Consensus::Params& consensusParam\n                     pfrom->fDisconnect = true;\n                     send = false;\n                 }\n+                // Avoid leaking prune-height by never send blocks below the NODE_NETWORK_LIMITED threshold",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 25,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "3fedeac1dbb845e5529dbe6ba7e0929abcf299c6",
    "user": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: sending",
    "created_at": "2017-09-26T02:46:55Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r140946427",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/140946427"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r140946427"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/140946427/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1019,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/140946594",
    "pull_request_review_id": 65089320,
    "id": 140946594,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0MDk0NjU5NA==",
    "diff_hunk": "@@ -203,6 +203,8 @@ extern bool fPruneMode;\n extern uint64_t nPruneTarget;\n /** Block files containing a block-height within MIN_BLOCKS_TO_KEEP of chainActive.Tip() will not be pruned. */\n static const unsigned int MIN_BLOCKS_TO_KEEP = 288;\n+/** Minimum blocks to must be available to signal NODE_NETWORK_LIMITED */",
    "path": "src/validation.h",
    "position": null,
    "original_position": 4,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "3fedeac1dbb845e5529dbe6ba7e0929abcf299c6",
    "user": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "s/to must be available/required",
    "created_at": "2017-09-26T02:48:51Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r140946594",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/140946594"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r140946594"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/140946594/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 206,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141752640",
    "pull_request_review_id": 66018463,
    "id": 141752640,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0MTc1MjY0MA==",
    "diff_hunk": "@@ -61,4 +61,17 @@ bool GetNodeStateStats(NodeId nodeid, CNodeStateStats &stats);\n /** Increase a node's misbehavior score. */\n void Misbehaving(NodeId nodeid, int howmuch);\n \n+/** Process protocol messages received from a given node */\n+bool ProcessMessages(CNode* pfrom, CConnman& connman, const std::atomic<bool>& interrupt);\n+/**\n+ * Send queued protocol messages to be sent to a give node.\n+ *\n+ * @param[in]   pto             The node which we are sending messages to.\n+ * @param[in]   connman         The connection manager for that node.\n+ * @param[in]   interrupt       Interrupt condition for processing threads\n+ * @return                      True if there is more work to be done\n+ */\n+bool SendMessages(CNode* pto, CConnman& connman, const std::atomic<bool>& interrupt);",
    "path": "src/net_processing.h",
    "position": null,
    "original_position": 14,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "837ef7497f2e0e0d3530d0de9bdbd59a9acc8946",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Looks like a rebase error - these functions were moved to the PeerLogicValidation.",
    "created_at": "2017-09-28T22:35:51Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141752640",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141752640"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141752640"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141752640/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 74,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141753062",
    "pull_request_review_id": 66018463,
    "id": 141753062,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0MTc1MzA2Mg==",
    "diff_hunk": "@@ -3305,6 +3314,43 @@ bool PeerLogicValidation::SendMessages(CNode* pto, std::atomic<bool>& interruptM\n     return true;\n }\n \n+void CheckLocalServices(ServiceFlags& nLocalServices) {\n+    if (fPruneMode) {\n+        LOCK(cs_main);\n+\n+        // make sure NODE_NETWORK is disabled\n+        nLocalServices = ServiceFlags(nLocalServices & ~NODE_NETWORK);\n+\n+        // don't signal NODE_NETWORK_LIMITED during initial block download\n+        if (IsInitialBlockDownload()) {",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 28,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "837ef7497f2e0e0d3530d0de9bdbd59a9acc8946",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Hmm, this feels pretty strange to me. Service bits indicate a commitment to provide certain services, not your current state. More importantly, IBD is always neccessarily fuzzy - we can't know how \"in sync\" we are.",
    "created_at": "2017-09-28T22:38:53Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141753062",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141753062"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141753062"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141753062/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 3325,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141753516",
    "pull_request_review_id": 66018463,
    "id": 141753516,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0MTc1MzUxNg==",
    "diff_hunk": "@@ -3305,6 +3314,43 @@ bool PeerLogicValidation::SendMessages(CNode* pto, std::atomic<bool>& interruptM\n     return true;\n }\n \n+void CheckLocalServices(ServiceFlags& nLocalServices) {\n+    if (fPruneMode) {\n+        LOCK(cs_main);\n+\n+        // make sure NODE_NETWORK is disabled\n+        nLocalServices = ServiceFlags(nLocalServices & ~NODE_NETWORK);\n+\n+        // don't signal NODE_NETWORK_LIMITED during initial block download\n+        if (IsInitialBlockDownload()) {\n+            return;\n+        }\n+\n+        // check how many blocks we have available (backwards from tip)\n+        // don't go futher down then chainActive.Height()-NODE_NETWORK_LIMITED\n+        CBlockIndex *block = chainActive.Tip();\n+        unsigned int chainHeight = (unsigned int) chainActive.Height();\n+        while (block && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA) && block->pprev->nTx > 0 && chainHeight - block->nHeight < (NODE_NETWORK_LIMITED_MIN_BLOCKS + 1)) {\n+            block = block->pprev;\n+        }\n+        unsigned int height = (unsigned int) block->nHeight;\n+\n+        // set NODE_NETWORK_LIMITED flag based on the available blocks\n+        if (chainHeight - height >= NODE_NETWORK_LIMITED_MIN_BLOCKS) {\n+            nLocalServices = ServiceFlags(nLocalServices | NODE_NETWORK_LIMITED);\n+        }\n+\n+        // don't set NODE_NETWORK if manual pruning is enabled and no blocks have been pruned.\n+        // A manual prune will be very likely\n+    }\n+    else {\n+        // currently, the prune mode can't be changed during runtime\n+        // implement the service bit switch for possible future flexibility\n+        nLocalServices = ServiceFlags(nLocalServices | NODE_NETWORK);\n+        nLocalServices = ServiceFlags(nLocalServices & ~NODE_NETWORK_LIMITED);",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 53,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "837ef7497f2e0e0d3530d0de9bdbd59a9acc8946",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Why? The BIP seems somewhat unclear here, but I'd stronlgy prefer that NODE_NETWORK_LIMITED simply be always set to indicate that we can always provide the most recent 288 blocks, irrespective of if we're pruned or not.",
    "created_at": "2017-09-28T22:42:05Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141753516",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141753516"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141753516"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141753516/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 3350,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141754105",
    "pull_request_review_id": 66018463,
    "id": 141754105,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0MTc1NDEwNQ==",
    "diff_hunk": "@@ -3305,6 +3314,43 @@ bool PeerLogicValidation::SendMessages(CNode* pto, std::atomic<bool>& interruptM\n     return true;\n }\n \n+void CheckLocalServices(ServiceFlags& nLocalServices) {\n+    if (fPruneMode) {\n+        LOCK(cs_main);\n+\n+        // make sure NODE_NETWORK is disabled\n+        nLocalServices = ServiceFlags(nLocalServices & ~NODE_NETWORK);\n+\n+        // don't signal NODE_NETWORK_LIMITED during initial block download\n+        if (IsInitialBlockDownload()) {\n+            return;\n+        }\n+\n+        // check how many blocks we have available (backwards from tip)\n+        // don't go futher down then chainActive.Height()-NODE_NETWORK_LIMITED",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 33,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "837ef7497f2e0e0d3530d0de9bdbd59a9acc8946",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This seems entirely redundant - even if by super rare chance we end up due to reorg short of 288 blocks, we won't be *very* short of 288 blocks, and will be caught back up within the next block or two, might as well just always set NODE_NETWORK_LIMITED (you can static_assert MIN_BLOCKS_TO_KEEP is at least 288 if you really want to have a check).",
    "created_at": "2017-09-28T22:45:31Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141754105",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141754105"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141754105"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141754105/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 3330,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141755077",
    "pull_request_review_id": 66018463,
    "id": 141755077,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0MTc1NTA3Nw==",
    "diff_hunk": "@@ -250,8 +250,8 @@ enum ServiceFlags : uint64_t {\n     // Nothing\n     NODE_NONE = 0,\n     // NODE_NETWORK means that the node is capable of serving the block chain. It is currently\n-    // set by all Bitcoin Core nodes, and is unset by SPV clients or other peers that just want\n-    // network services but don't provide them.\n+    // set by all Bitcoin Core non pruned nodes, and is unset by SPV clients or other peers\n+    // that just want network services but don't provide them.",
    "path": "src/protocol.h",
    "position": null,
    "original_position": 7,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "e08e49f8991564d2e9115a074b7d38af3af11664",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "If you're gonna update this maybe overhaul the text? The concept of \"want network services but don't provide them\" doesn't really make sense anymore (especially with NODE_NETWORK_LIMITED). Maybe just say \"indicates peer is capable of serving the full historical block chain\".",
    "created_at": "2017-09-28T22:52:04Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141755077",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141755077"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141755077"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141755077/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 254,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141755735",
    "pull_request_review_id": 66018463,
    "id": 141755735,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0MTc1NTczNQ==",
    "diff_hunk": "@@ -2672,6 +2672,11 @@ ServiceFlags CConnman::GetLocalServices() const\n     return nLocalServices;\n }\n \n+void CConnman::SetLocalServices(ServiceFlags flagsIn)",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "62cdcc6ec2facdcd50fea9a20a268d94bb981d19",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I'm entirely unconvinced NODE_NETWORK_LIMITED needs this (and would prefer to avoid adding it until we need it, though its no big deal to add it).",
    "created_at": "2017-09-28T22:55:49Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141755735",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141755735"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141755735"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141755735/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2675,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141755926",
    "pull_request_review_id": 66018463,
    "id": 141755926,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0MTc1NTkyNg==",
    "diff_hunk": "@@ -895,6 +897,13 @@ UniValue pruneblockchain(const JSONRPCRequest& request)\n     }\n \n     PruneBlockFilesManual(height);\n+\n+    // check if we need to change the local service flags in order to signal NODE_NETWORK_LIMITED flags\n+    if(g_connman) {\n+        ServiceFlags nFlags = g_connman->GetLocalServices();\n+        CheckLocalServices(nFlags);",
    "path": "src/rpc/blockchain.cpp",
    "position": null,
    "original_position": 17,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "6aae1785542eb7f79d5c08e53862476e22ac46c6",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Why do we need to do this? You can't prune deeper than 128 and NODE_NETWORK is already unset for manually-pruned nodes.",
    "created_at": "2017-09-28T22:56:51Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141755926",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141755926"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141755926"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141755926/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 904,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141756696",
    "pull_request_review_id": 66018463,
    "id": 141756696,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0MTc1NjY5Ng==",
    "diff_hunk": "@@ -1020,6 +1020,13 @@ void static ProcessGetData(CNode* pfrom, const Consensus::Params& consensusParam\n                     pfrom->fDisconnect = true;\n                     send = false;\n                 }\n+                // Avoid leaking prune-height by never send blocks below the NODE_NETWORK_LIMITED threshold\n+                if (send && !pfrom->fWhitelisted && (\n+                        (((connman->GetLocalServices() & NODE_NETWORK_LIMITED) == NODE_NETWORK_LIMITED) && (chainActive.Tip()->nHeight - mi->second->nHeight > (int)NODE_NETWORK_LIMITED_MIN_BLOCKS) )",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 6,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "39926136e6fb8d38e3da8b9aee697cd5c4c4a04c",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This should use pfrom->GetLocalServices() not connman->GetLocalServices() - our decisions should be based on what we told the peer we support, not what we would tell a new peer to support.",
    "created_at": "2017-09-28T23:01:50Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141756696",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141756696"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141756696"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141756696/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1021,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142410638",
    "pull_request_review_id": 66766749,
    "id": 142410638,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0MjQxMDYzOA==",
    "diff_hunk": "@@ -1590,6 +1590,8 @@ bool AppInitMain(boost::thread_group& threadGroup, CScheduler& scheduler)\n     if (fPruneMode) {\n         LogPrintf(\"Unsetting NODE_NETWORK on prune mode\\n\");\n         nLocalServices = ServiceFlags(nLocalServices & ~NODE_NETWORK);\n+        // always set NODE_NETWORK_LIMITED (BIP159) in pruned mode\n+        nLocalServices = ServiceFlags(nLocalServices | NODE_NETWORK_LIMITED);",
    "path": "src/init.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "78011f7e2a703afc17a7c53923d89729ce3be91a",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Hmm, I thought we were just going to alays set this? Why bother *only* setting it when pruned - a node that is not pruned is also capable of serving the last 288 blocks, which is the way I read the definition of NODE_NETWORK_LIMITED.",
    "created_at": "2017-10-03T14:02:04Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142410638",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142410638"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142410638"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142410638/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1594,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142469469",
    "pull_request_review_id": 66835442,
    "id": 142469469,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0MjQ2OTQ2OQ==",
    "diff_hunk": "@@ -1590,6 +1590,8 @@ bool AppInitMain(boost::thread_group& threadGroup, CScheduler& scheduler)\n     if (fPruneMode) {\n         LogPrintf(\"Unsetting NODE_NETWORK on prune mode\\n\");\n         nLocalServices = ServiceFlags(nLocalServices & ~NODE_NETWORK);\n+        // always set NODE_NETWORK_LIMITED (BIP159) in pruned mode\n+        nLocalServices = ServiceFlags(nLocalServices | NODE_NETWORK_LIMITED);",
    "path": "src/init.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "78011f7e2a703afc17a7c53923d89729ce3be91a",
    "user": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I agree. Came to complain about the same thing.\r\n\r\nNODE_NETWORK implies NODE_NETWORK_LIMITED, so _LIMITED should always be set.\r\nOtherwise, we're introducing negative service flags, which is a bad idea imo.",
    "created_at": "2017-10-03T17:34:14Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142469469",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142469469"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142469469"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142469469/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1594,
    "side": "RIGHT",
    "in_reply_to_id": 142410638
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142472985",
    "pull_request_review_id": 66839562,
    "id": 142472985,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0MjQ3Mjk4NQ==",
    "diff_hunk": "@@ -267,6 +266,9 @@ enum ServiceFlags : uint64_t {\n     // NODE_XTHIN means the node supports Xtreme Thinblocks\n     // If this is turned off then the node will not service nor make xthin requests\n     NODE_XTHIN = (1 << 4),\n+    // NODE_NETWORK_LIMITED means the same as NODE_NETWORK with the limitation of only\n+    // serving the last 288 (2 day) blocks",
    "path": "src/protocol.h",
    "position": null,
    "original_position": 17,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "71d9aafb07e39548240dd3f75526225a4df2f70e",
    "user": {
      "login": "jimpo",
      "id": 881253,
      "node_id": "MDQ6VXNlcjg4MTI1Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/881253?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimpo",
      "html_url": "https://github.com/jimpo",
      "followers_url": "https://api.github.com/users/jimpo/followers",
      "following_url": "https://api.github.com/users/jimpo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimpo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimpo/subscriptions",
      "organizations_url": "https://api.github.com/users/jimpo/orgs",
      "repos_url": "https://api.github.com/users/jimpo/repos",
      "events_url": "https://api.github.com/users/jimpo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimpo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Perhaps reference BIP 159 in the comment here for additional explanation?",
    "created_at": "2017-10-03T17:47:51Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142472985",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142472985"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142472985"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142472985/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 268,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142473809",
    "pull_request_review_id": 66839562,
    "id": 142473809,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0MjQ3MzgwOQ==",
    "diff_hunk": "@@ -818,6 +818,16 @@ void PeerLogicValidation::UpdatedBlockTip(const CBlockIndex *pindexNew, const CB\n     }\n \n     nTimeBestReceived = GetTime();\n+\n+    // update service flags\n+    {\n+        LOCK(cs_main);",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 7,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "d1ce50c1bc9843792ddf93f8bb5a43c9af677c62",
    "user": {
      "login": "jimpo",
      "id": 881253,
      "node_id": "MDQ6VXNlcjg4MTI1Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/881253?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimpo",
      "html_url": "https://github.com/jimpo",
      "followers_url": "https://api.github.com/users/jimpo/followers",
      "following_url": "https://api.github.com/users/jimpo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimpo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimpo/subscriptions",
      "organizations_url": "https://api.github.com/users/jimpo/orgs",
      "repos_url": "https://api.github.com/users/jimpo/repos",
      "events_url": "https://api.github.com/users/jimpo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimpo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "We can avoid obtaining this lock if the alternative services is already NODE_NETWORK_LIMITED.",
    "created_at": "2017-10-03T17:51:01Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142473809",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142473809"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142473809"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142473809/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 824,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142475171",
    "pull_request_review_id": 66842269,
    "id": 142475171,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0MjQ3NTE3MQ==",
    "diff_hunk": "@@ -1302,7 +1312,7 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n             pfrom->cleanSubVer = cleanSubVer;\n         }\n         pfrom->nStartingHeight = nStartingHeight;\n-        pfrom->fClient = !(nServices & NODE_NETWORK);\n+        pfrom->fClient = (!(nServices & NODE_NETWORK) && !(nServices & NODE_NETWORK_LIMITED));",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 22,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "d1ce50c1bc9843792ddf93f8bb5a43c9af677c62",
    "user": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I'd rather not use fClient as a proxy for NODE_NETWORK_LIMITED. It deserves its own classification.",
    "created_at": "2017-10-03T17:56:20Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142475171",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142475171"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142475171"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142475171/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1648,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142478180",
    "pull_request_review_id": 66845874,
    "id": 142478180,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0MjQ3ODE4MA==",
    "diff_hunk": "@@ -221,19 +221,24 @@ def ToHex(obj):\n \n class CAddress(object):\n     def __init__(self):\n+        self.time = 0\n         self.nServices = 1\n         self.pchReserved = b\"\\x00\" * 10 + b\"\\xff\" * 2\n         self.ip = \"0.0.0.0\"\n         self.port = 0\n \n-    def deserialize(self, f):\n+    def deserialize(self, f, without_time=False):",
    "path": "test/functional/test_framework/mininode.py",
    "position": null,
    "original_position": 11,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "f63c723953f64a4d9b7527acc45274ff0f8b8c69",
    "user": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: a default of without_foo = False isn't no bad thing for nobody.\r\n\r\nwith_time=True please :)",
    "created_at": "2017-10-03T18:07:24Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142478180",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142478180"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142478180"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142478180/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 230,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142478386",
    "pull_request_review_id": 66839562,
    "id": 142478386,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0MjQ3ODM4Ng==",
    "diff_hunk": "@@ -1819,13 +1823,19 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n                 continue;\n \n             // only connect to full nodes\n-            if ((addr.nServices & REQUIRED_SERVICES) != REQUIRED_SERVICES)\n+            if ( ((addr.nServices & NODE_NETWORK) != NODE_NETWORK)\n+                 && ((addr.nServices & NODE_NETWORK_LIMITED) != NODE_NETWORK_LIMITED)) {\n                 continue;\n+            }\n \n             // only consider very recently tried nodes after 30 failed attempts\n             if (nANow - addr.nLastTry < 600 && nTries < 30)\n                 continue;\n \n+            // only consider nodes matching alternative and missing relevant services after 10 failed attempts and only if less than a fourth of the outbound are up.\n+            if ( ((addr.nServices & nAlternativeServices) == nAlternativeServices) && (addr.nServices & nRelevantServices) != nRelevantServices && (nTries < 20 || nOutbound >= (nMaxOutbound >> 2)))\n+                continue;\n+\n             // only consider nodes missing relevant services after 40 failed attempts and only if less than half the outbound are up.\n             ServiceFlags nRequiredServices = nRelevantServices;\n             if (nTries >= 40 && nOutbound < (nMaxOutbound >> 1)) {",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 40,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "abd60f63ac533c6b984cadbec56155b940f7fb9e",
    "user": {
      "login": "jimpo",
      "id": 881253,
      "node_id": "MDQ6VXNlcjg4MTI1Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/881253?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimpo",
      "html_url": "https://github.com/jimpo",
      "followers_url": "https://api.github.com/users/jimpo/followers",
      "following_url": "https://api.github.com/users/jimpo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimpo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimpo/subscriptions",
      "organizations_url": "https://api.github.com/users/jimpo/orgs",
      "repos_url": "https://api.github.com/users/jimpo/repos",
      "events_url": "https://api.github.com/users/jimpo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimpo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In this clause, should `nRequiredServices` get set to NODE_NETWORK_LIMITED if peer is in sync? Essentially, replace `REQUIRED_SERVICES` below with a value that goes from NODE_NETWORK to NODE_NETWORK_LIMITED when peer is out of IBD.",
    "created_at": "2017-10-03T18:08:14Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142478386",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142478386"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142478386"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142478386/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1841,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142486951",
    "pull_request_review_id": 66856046,
    "id": 142486951,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0MjQ4Njk1MQ==",
    "diff_hunk": "@@ -1302,7 +1312,7 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n             pfrom->cleanSubVer = cleanSubVer;\n         }\n         pfrom->nStartingHeight = nStartingHeight;\n-        pfrom->fClient = !(nServices & NODE_NETWORK);\n+        pfrom->fClient = (!(nServices & NODE_NETWORK) && !(nServices & NODE_NETWORK_LIMITED));",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 22,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "d1ce50c1bc9843792ddf93f8bb5a43c9af677c62",
    "user": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yes, this needs its own bool so that fClient gets checked when testing for our initial headers-sync peer. Then, fPreferredDownload is only set to false if we're still in IBD.\r\n\r\nThat way, we request from this peer as if they were a regular full node as long as we're synced.",
    "created_at": "2017-10-03T18:40:13Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142486951",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142486951"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142486951"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142486951/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1648,
    "side": "RIGHT",
    "in_reply_to_id": 142475171
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142575819",
    "pull_request_review_id": 66955052,
    "id": 142575819,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0MjU3NTgxOQ==",
    "diff_hunk": "@@ -1590,6 +1590,8 @@ bool AppInitMain(boost::thread_group& threadGroup, CScheduler& scheduler)\n     if (fPruneMode) {\n         LogPrintf(\"Unsetting NODE_NETWORK on prune mode\\n\");\n         nLocalServices = ServiceFlags(nLocalServices & ~NODE_NETWORK);\n+        // always set NODE_NETWORK_LIMITED (BIP159) in pruned mode\n+        nLocalServices = ServiceFlags(nLocalServices | NODE_NETWORK_LIMITED);",
    "path": "src/init.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "78011f7e2a703afc17a7c53923d89729ce3be91a",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Okay. Agree... will change it.",
    "created_at": "2017-10-04T03:46:38Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142575819",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142575819"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142575819"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142575819/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1594,
    "side": "RIGHT",
    "in_reply_to_id": 142410638
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142576781",
    "pull_request_review_id": 66956158,
    "id": 142576781,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0MjU3Njc4MQ==",
    "diff_hunk": "@@ -818,6 +818,16 @@ void PeerLogicValidation::UpdatedBlockTip(const CBlockIndex *pindexNew, const CB\n     }\n \n     nTimeBestReceived = GetTime();\n+\n+    // update service flags\n+    {\n+        LOCK(cs_main);",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 7,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "d1ce50c1bc9843792ddf93f8bb5a43c9af677c62",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think we should not connect to NODE_NETWORK_LIMITED peers if IBD is still ongoing. NODE_NETWORK_LIMITED implementations really should make sure to not serve deeper then >288 blocks (fingerprinted). Seems useless to me connect until clear IBD.",
    "created_at": "2017-10-04T04:00:01Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142576781",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142576781"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142576781"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142576781/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 824,
    "side": "RIGHT",
    "in_reply_to_id": 142473809
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142581998",
    "pull_request_review_id": 66961718,
    "id": 142581998,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0MjU4MTk5OA==",
    "diff_hunk": "@@ -1302,7 +1312,7 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n             pfrom->cleanSubVer = cleanSubVer;\n         }\n         pfrom->nStartingHeight = nStartingHeight;\n-        pfrom->fClient = !(nServices & NODE_NETWORK);\n+        pfrom->fClient = (!(nServices & NODE_NETWORK) && !(nServices & NODE_NETWORK_LIMITED));",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 22,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "d1ce50c1bc9843792ddf93f8bb5a43c9af677c62",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "IMO we want pruned peers for header sync... but right, we need a protection to not request blocks from limited peers during IBD.\r\nWhat about adding an `fLimitedNode` bool and check it at the point we populate vGetData with block requests?\r\n\r\nSeems also simpler and more constant (NODE_NETWORK_LIMITED is not really a \"client\").\r\n\r\nI changed this PR and applied my approach which I have written above.",
    "created_at": "2017-10-04T05:11:40Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142581998",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142581998"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142581998"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142581998/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1648,
    "side": "RIGHT",
    "in_reply_to_id": 142475171
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142797136",
    "pull_request_review_id": 67212434,
    "id": 142797136,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0Mjc5NzEzNg==",
    "diff_hunk": "@@ -818,6 +818,16 @@ void PeerLogicValidation::UpdatedBlockTip(const CBlockIndex *pindexNew, const CB\n     }\n \n     nTimeBestReceived = GetTime();\n+\n+    // update service flags\n+    {\n+        LOCK(cs_main);",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 7,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "d1ce50c1bc9843792ddf93f8bb5a43c9af677c62",
    "user": {
      "login": "jimpo",
      "id": 881253,
      "node_id": "MDQ6VXNlcjg4MTI1Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/881253?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimpo",
      "html_url": "https://github.com/jimpo",
      "followers_url": "https://api.github.com/users/jimpo/followers",
      "following_url": "https://api.github.com/users/jimpo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimpo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimpo/subscriptions",
      "organizations_url": "https://api.github.com/users/jimpo/orgs",
      "repos_url": "https://api.github.com/users/jimpo/repos",
      "events_url": "https://api.github.com/users/jimpo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimpo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yeah, I understand that, but unless I'm missing something, this code is run every time there is a new block after IBD is done instead of happening only once. It seems possible to change the logic to exit before obtaining the lock if AlternativeServices has already been switched from NODE_NETWORK to NODE_NETWORK_LIMITED.",
    "created_at": "2017-10-04T21:25:56Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142797136",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142797136"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142797136"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142797136/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 824,
    "side": "RIGHT",
    "in_reply_to_id": 142473809
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142800110",
    "pull_request_review_id": 67215746,
    "id": 142800110,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0MjgwMDExMA==",
    "diff_hunk": "@@ -1819,13 +1823,19 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n                 continue;\n \n             // only connect to full nodes\n-            if ((addr.nServices & REQUIRED_SERVICES) != REQUIRED_SERVICES)\n+            if ( ((addr.nServices & NODE_NETWORK) != NODE_NETWORK)\n+                 && ((addr.nServices & NODE_NETWORK_LIMITED) != NODE_NETWORK_LIMITED)) {\n                 continue;\n+            }\n \n             // only consider very recently tried nodes after 30 failed attempts\n             if (nANow - addr.nLastTry < 600 && nTries < 30)\n                 continue;\n \n+            // only consider nodes matching alternative and missing relevant services after 10 failed attempts and only if less than a fourth of the outbound are up.\n+            if ( ((addr.nServices & nAlternativeServices) == nAlternativeServices) && (addr.nServices & nRelevantServices) != nRelevantServices && (nTries < 20 || nOutbound >= (nMaxOutbound >> 2)))",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 35,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
    "user": {
      "login": "jimpo",
      "id": 881253,
      "node_id": "MDQ6VXNlcjg4MTI1Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/881253?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimpo",
      "html_url": "https://github.com/jimpo",
      "followers_url": "https://api.github.com/users/jimpo/followers",
      "following_url": "https://api.github.com/users/jimpo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimpo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimpo/subscriptions",
      "organizations_url": "https://api.github.com/users/jimpo/orgs",
      "repos_url": "https://api.github.com/users/jimpo/repos",
      "events_url": "https://api.github.com/users/jimpo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimpo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Seems that we would never connect to limited nodes because of the code on lines 1840-1847. `nRequiredServices` is set to either `nRelevantServices` or `REQUIRED_SERVICES`, never `nAlternativeServices`.",
    "created_at": "2017-10-04T21:39:32Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142800110",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142800110"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142800110"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142800110/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1836,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326141",
    "pull_request_review_id": 67828631,
    "id": 143326141,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0MzMyNjE0MQ==",
    "diff_hunk": "@@ -221,19 +221,24 @@ def ToHex(obj):\n \n class CAddress(object):\n     def __init__(self):\n+        self.time = 0\n         self.nServices = 1\n         self.pchReserved = b\"\\x00\" * 10 + b\"\\xff\" * 2\n         self.ip = \"0.0.0.0\"\n         self.port = 0\n \n-    def deserialize(self, f):\n+    def deserialize(self, f, with_time=True):\n+        if with_time == True:",
    "path": "test/functional/test_framework/mininode.py",
    "position": null,
    "original_position": 12,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Remove `== True`.",
    "created_at": "2017-10-07T08:35:09Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r143326141",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326141"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r143326141"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326141/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 231,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326146",
    "pull_request_review_id": 67828631,
    "id": 143326146,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0MzMyNjE0Ng==",
    "diff_hunk": "@@ -221,19 +221,24 @@ def ToHex(obj):\n \n class CAddress(object):\n     def __init__(self):\n+        self.time = 0\n         self.nServices = 1\n         self.pchReserved = b\"\\x00\" * 10 + b\"\\xff\" * 2\n         self.ip = \"0.0.0.0\"\n         self.port = 0\n \n-    def deserialize(self, f):\n+    def deserialize(self, f, with_time=True):\n+        if with_time == True:\n+            self.time = struct.unpack(\"<i\", f.read(4))[0]\n         self.nServices = struct.unpack(\"<Q\", f.read(8))[0]\n         self.pchReserved = f.read(12)\n         self.ip = socket.inet_ntoa(f.read(4))\n         self.port = struct.unpack(\">H\", f.read(2))[0]\n \n-    def serialize(self):\n+    def serialize(self, with_time=True):\n         r = b\"\"\n+        if with_time == True:",
    "path": "test/functional/test_framework/mininode.py",
    "position": null,
    "original_position": 22,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Remove `== True`.",
    "created_at": "2017-10-07T08:35:27Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r143326146",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326146"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r143326146"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326146/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 240,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326148",
    "pull_request_review_id": 67828631,
    "id": 143326148,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0MzMyNjE0OA==",
    "diff_hunk": "@@ -183,6 +183,10 @@ void AdvertiseLocal(CNode *pnode)\n     if (fListen && pnode->fSuccessfullyConnected)\n     {\n         CAddress addrLocal = GetLocalAddress(&pnode->addr, pnode->GetLocalServices());\n+        if (gArgs.GetBoolArg(\"-addrmantest\", false) == true) {",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Remove `== true`.",
    "created_at": "2017-10-07T08:35:38Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r143326148",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326148"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r143326148"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326148/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 186,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326152",
    "pull_request_review_id": 67828631,
    "id": 143326152,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0MzMyNjE1Mg==",
    "diff_hunk": "@@ -191,7 +195,7 @@ void AdvertiseLocal(CNode *pnode)\n         {\n             addrLocal.SetIP(pnode->GetAddrLocal());\n         }\n-        if (addrLocal.IsRoutable())\n+        if (addrLocal.IsRoutable() || gArgs.GetBoolArg(\"-addrmantest\", false) == true)",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 16,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Remove `== true`.",
    "created_at": "2017-10-07T08:35:46Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r143326152",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326152"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r143326152"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326152/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 198,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326166",
    "pull_request_review_id": 67828631,
    "id": 143326166,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0MzMyNjE2Ng==",
    "diff_hunk": "@@ -0,0 +1,107 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+from test_framework.mininode import *\n+\n+class BaseNode(NodeConnCB):\n+    nServices = 0\n+    firstAddrnServices = 0\n+    def on_version(self, conn, message):\n+        self.nServices = message.nServices\n+    def on_addr(self, conn, message):\n+        self.firstAddrnServices = message.addrs[0].nServices\n+    def wait_for_addr(self, timeout=60):\n+        test_function = lambda: self.last_message.get(\"addr\")\n+        wait_until(test_function, timeout=timeout, lock=mininode_lock)\n+\n+class NodeNetworkLimitedTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+        self.extra_args = [['-prune=550', '-addrmantest']]\n+\n+    def getSignaledServiceFlags(self):\n+        node = BaseNode()\n+        connection = NodeConn('127.0.0.1', p2p_port(0), self.nodes[0], node)\n+        node.add_connection(connection)\n+        NetworkThread().start()\n+        node.wait_for_verack()\n+        services = node.nServices\n+        connection.disconnect_node()\n+        node.wait_for_disconnect()\n+        del node\n+        return services\n+\n+    def tryGetBlockViaGetData(self, blockhash, result):\n+        node = BaseNode()\n+        connection = NodeConn('127.0.0.1', p2p_port(0), self.nodes[0], node)\n+        node.add_connection(connection)\n+        NetworkThread().start()\n+        node.wait_for_verack()\n+        node.send_message(msg_verack())\n+        getdata_request = msg_getdata()\n+        getdata_request.inv.append(CInv(2, int(blockhash, 16)))\n+        node.send_message(getdata_request)\n+        #check if we the peer sends us the block",
    "path": "test/functional/node_network_limited.py",
    "position": null,
    "original_position": 48,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Nit, space after `#` here and below.",
    "created_at": "2017-10-07T08:36:35Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r143326166",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326166"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r143326166"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326166/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 48,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326177",
    "pull_request_review_id": 67828631,
    "id": 143326177,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0MzMyNjE3Nw==",
    "diff_hunk": "@@ -0,0 +1,107 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+from test_framework.mininode import *\n+\n+class BaseNode(NodeConnCB):\n+    nServices = 0\n+    firstAddrnServices = 0\n+    def on_version(self, conn, message):\n+        self.nServices = message.nServices\n+    def on_addr(self, conn, message):\n+        self.firstAddrnServices = message.addrs[0].nServices\n+    def wait_for_addr(self, timeout=60):\n+        test_function = lambda: self.last_message.get(\"addr\")\n+        wait_until(test_function, timeout=timeout, lock=mininode_lock)\n+\n+class NodeNetworkLimitedTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+        self.extra_args = [['-prune=550', '-addrmantest']]\n+\n+    def getSignaledServiceFlags(self):\n+        node = BaseNode()\n+        connection = NodeConn('127.0.0.1', p2p_port(0), self.nodes[0], node)\n+        node.add_connection(connection)\n+        NetworkThread().start()\n+        node.wait_for_verack()\n+        services = node.nServices\n+        connection.disconnect_node()\n+        node.wait_for_disconnect()\n+        del node\n+        return services\n+\n+    def tryGetBlockViaGetData(self, blockhash, result):\n+        node = BaseNode()\n+        connection = NodeConn('127.0.0.1', p2p_port(0), self.nodes[0], node)\n+        node.add_connection(connection)\n+        NetworkThread().start()\n+        node.wait_for_verack()\n+        node.send_message(msg_verack())\n+        getdata_request = msg_getdata()\n+        getdata_request.inv.append(CInv(2, int(blockhash, 16)))\n+        node.send_message(getdata_request)\n+        #check if we the peer sends us the block\n+        res = False\n+        try:\n+            node.wait_for_block(int(blockhash, 16), 3)\n+            res = True\n+        except:\n+            pass\n+        assert_equal(res, result)\n+        connection.disconnect_node()\n+        node.wait_for_disconnect()\n+        del node\n+\n+    def run_test(self):\n+        #NODE_BLOOM & NODE_WITNESS & NODE_NETWORK_LIMITED must now be signaled\n+        assert_equal(self.getSignaledServiceFlags(), 1036) #1036 == 0x40C == 0100 0000 1100\n+#                                                                              |        ||\n+#                                                                              |        |^--- NODE_BLOOM\n+#                                                                              |        ^---- NODE_WITNESS\n+#                                                                              ^-- NODE_NETWORK_LIMITED\n+\n+        #now mine some blocks over the NODE_NETWORK_LIMITED target\n+        firstblock = self.nodes[0].generate(1)[0]\n+        blocks = self.nodes[0].generate(290)\n+        blockWithinLimitedRange = blocks[-1]\n+\n+        #make sure we can max retrive block at tip-288\n+        #requesting block at height 2 (tip-289) must fail (ignored)\n+        self.tryGetBlockViaGetData(firstblock, False)\n+        self.tryGetBlockViaGetData(blocks[1], True)\n+        self.tryGetBlockViaGetData(blocks[0], False)\n+\n+        #NODE_NETWORK_LIMITED must still be signaled after restart\n+        self.stop_node(0)\n+        self.start_node(0, extra_args=self.extra_args[0])",
    "path": "test/functional/node_network_limited.py",
    "position": null,
    "original_position": 81,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "`self.restart_node(0)`.",
    "created_at": "2017-10-07T08:37:06Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r143326177",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326177"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r143326177"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326177/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 81,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/149217800",
    "pull_request_review_id": 74578594,
    "id": 149217800,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0OTIxNzgwMA==",
    "diff_hunk": "@@ -297,6 +299,9 @@ enum ServiceFlags : uint64_t {\n  * Thus, generally, avoid calling with peerServices == NODE_NONE.\n  */\n static ServiceFlags GetDesirableServiceFlags(ServiceFlags services) {\n+    if (initialBlockDownloadCompleted) {\n+        return ServiceFlags(NODE_NETWORK_LIMITED | NODE_WITNESS);",
    "path": "src/protocol.h",
    "position": null,
    "original_position": 21,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "cef6bc63ec8c1c0cca5755b17a9cd88b033ce6d4",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This would result in us *only* connecting to NODE_NETWORK_LIMITED after IBD - I think this should be:\r\n```\r\nif (services & NODE_NETWORK_LIMITED && initialBlockDownloadCompleted) return ServiceFlags(NODE_NETWORK_LIMITED | NODE_WITNESS);\r\nreturn ServiceFlags(NODE_NETWORK | NODE_WITNESS);\r\n```",
    "created_at": "2017-11-06T22:05:22Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r149217800",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/149217800"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r149217800"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/149217800/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 308,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/149224854",
    "pull_request_review_id": 74578594,
    "id": 149224854,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0OTIyNDg1NA==",
    "diff_hunk": "@@ -311,10 +311,10 @@ static inline bool HasAllDesirableServiceFlags(ServiceFlags services) {\n \n /**\n  * Checks if a peer with the given service flags may be capable of having a\n- * robust address-storage DB. Currently an alias for checking NODE_NETWORK.\n+ * robust address-storage DB.\n  */\n static inline bool MayHaveUsefulAddressDB(ServiceFlags services) {\n-    return services & NODE_NETWORK;\n+    return (services & NODE_NETWORK) || (services & NODE_NETWORK_LIMITED);",
    "path": "src/protocol.h",
    "position": 31,
    "original_position": 9,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "005fafdaa99b900d4a3ed0320e73e0a4863abf87",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "The commit message is weird here - this function is intended to be used to decide whether a node may be a useful feeler, and thus the commit message should be about relayed addresses *from* nodes with NODE_NETWORK_LIMITED set. But since we also use it in ADDR message processing, it kinda means both - I think we should change the ADDR message processing to MayHaveUsefulAddressDB || HasAllDesirableServiceFlags to clarify things (which will not actually be a chahnge, but thats fine).",
    "created_at": "2017-11-06T22:36:49Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r149224854",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/149224854"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r149224854"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/149224854/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 324,
    "original_line": 327,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/150142173",
    "pull_request_review_id": 75650507,
    "id": 150142173,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1MDE0MjE3Mw==",
    "diff_hunk": "@@ -1059,6 +1059,13 @@ void static ProcessGetData(CNode* pfrom, const Consensus::Params& consensusParam\n                     pfrom->fDisconnect = true;\n                     send = false;\n                 }\n+                // Avoid leaking prune-height by never sending blocks below the NODE_NETWORK_LIMITED threshold\n+                if (send && !pfrom->fWhitelisted && (\n+                        (((pfrom->GetLocalServices() & NODE_NETWORK_LIMITED) == NODE_NETWORK_LIMITED) && ((pfrom->GetLocalServices() & NODE_NETWORK) != NODE_NETWORK) && (chainActive.Tip()->nHeight - mi->second->nHeight > (int)NODE_NETWORK_LIMITED_MIN_BLOCKS) )\n+                   )) {\n+                    LogPrint(BCLog::NET, \"Ignore block request below NODE_NETWORK_LIMITED threshold from peer=%d\\n\", pfrom->GetId());\n+                    send = false;",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 9,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "2d6893ad63f081772bde00d339061143058b060b",
    "user": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This needs to disconnect, I think.  Otherwise we DOS attack our peer, causing them to take a 20 minute timeout on their attempted request to fetch a block they think we're doing to provide.",
    "created_at": "2017-11-10T02:34:00Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r150142173",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/150142173"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r150142173"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/150142173/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1103,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153672196",
    "pull_request_review_id": 79712340,
    "id": 153672196,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1MzY3MjE5Ng==",
    "diff_hunk": "@@ -33,3 +33,4 @@ BIPs that are implemented by Bitcoin Core (up-to-date up to **v0.13.0**):\n * [`BIP 145`](https://github.com/bitcoin/bips/blob/master/bip-0145.mediawiki): getblocktemplate updates for Segregated Witness as of **v0.13.0** ([PR 8149](https://github.com/bitcoin/bitcoin/pull/8149)).\n * [`BIP 147`](https://github.com/bitcoin/bips/blob/master/bip-0147.mediawiki): NULLDUMMY softfork as of **v0.13.1** ([PR 8636](https://github.com/bitcoin/bitcoin/pull/8636) and [PR 8937](https://github.com/bitcoin/bitcoin/pull/8937)).\n * [`BIP 152`](https://github.com/bitcoin/bips/blob/master/bip-0152.mediawiki): Compact block transfer and related optimizations are used as of **v0.13.0** ([PR 8068](https://github.com/bitcoin/bitcoin/pull/8068)).\n+* [`BIP 159`](https://github.com/bitcoin/bips/blob/master/bip-0159.mediawiki): NODE_NETWORK_LIMITED service bits are supported as of **v0.16.0** ([PR 10387](https://github.com/bitcoin/bitcoin/pull/10387)).",
    "path": "doc/bips.md",
    "position": null,
    "original_position": 4,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "e89dbb67bfcc2cc96e1ac745fc61464ebff40943",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "service bit (singular)?",
    "created_at": "2017-11-29T01:21:25Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r153672196",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153672196"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r153672196"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153672196/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 36,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153672712",
    "pull_request_review_id": 79712340,
    "id": 153672712,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1MzY3MjcxMg==",
    "diff_hunk": "@@ -0,0 +1,100 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+from test_framework.mininode import *\n+\n+class BaseNode(NodeConnCB):\n+    nServices = 0\n+    firstAddrnServices = 0\n+    def on_version(self, conn, message):\n+        self.nServices = message.nServices\n+    def on_addr(self, conn, message):\n+        self.firstAddrnServices = message.addrs[0].nServices\n+    def wait_for_addr(self, timeout=60):\n+        test_function = lambda: self.last_message.get(\"addr\")\n+        wait_until(test_function, timeout=timeout, lock=mininode_lock)\n+\n+class NodeNetworkLimitedTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+        self.extra_args = [['-prune=550', '-addrmantest']]\n+\n+    def getSignaledServiceFlags(self):\n+        node = self.nodes[0].add_p2p_connection(BaseNode())\n+        NetworkThread().start()\n+        node.wait_for_verack()\n+        services = node.nServices\n+        self.nodes[0].disconnect_p2ps()\n+        node.wait_for_disconnect()\n+        return services\n+\n+    def tryGetBlockViaGetData(self, blockhash, result):\n+        node = self.nodes[0].add_p2p_connection(BaseNode())\n+        NetworkThread().start()\n+        node.wait_for_verack()\n+        node.send_message(msg_verack())\n+        getdata_request = msg_getdata()\n+        getdata_request.inv.append(CInv(2, int(blockhash, 16)))\n+        node.send_message(getdata_request)\n+        # check if we the peer sends us the block\n+        res = False\n+        try:\n+            node.wait_for_block(int(blockhash, 16), 3)\n+            res = True\n+        except:\n+            pass\n+        assert_equal(res, result)\n+        self.nodes[0].disconnect_p2ps()\n+        node.wait_for_disconnect()\n+\n+    def run_test(self):\n+        #NODE_BLOOM & NODE_WITNESS & NODE_NETWORK_LIMITED must now be signaled\n+        assert_equal(self.getSignaledServiceFlags(), 1036) #1036 == 0x40C == 0100 0000 1100",
    "path": "test/functional/node_network_limited.py",
    "position": null,
    "original_position": 56,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "e89dbb67bfcc2cc96e1ac745fc61464ebff40943",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Add space after `#` so that the arrows below point to the correct bits.",
    "created_at": "2017-11-29T01:25:45Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r153672712",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153672712"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r153672712"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153672712/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 67,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156467289",
    "pull_request_review_id": 82949126,
    "id": 156467289,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1NjQ2NzI4OQ==",
    "diff_hunk": "@@ -938,11 +938,12 @@ void PeerLogicValidation::BlockChecked(const CBlock& block, const CValidationSta\n     // 3. This is currently the best block we're aware of. We haven't updated\n     //    the tip yet so we have no way to check this directly here. Instead we\n     //    just check that there are currently no other blocks in flight.\n-    else if (state.IsValid() &&\n-             !IsInitialBlockDownload() &&\n-             mapBlocksInFlight.count(hash) == mapBlocksInFlight.size()) {\n-        if (it != mapBlockSource.end()) {\n-            MaybeSetPeerAsAnnouncingHeaderAndIDs(it->second.first, connman);\n+    else if (state.IsValid()) {\n+        initialBlockDownloadCompleted = !IsInitialBlockDownload();",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 10,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "8a3ecc90185ff36ea118fe98a7e514c1ba101e5b",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Can you move this update to UpdatedBlockTip? (it already has an fInitialDownload instead of having to call IsInitialDownload, even).",
    "created_at": "2017-12-12T19:16:31Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r156467289",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156467289"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r156467289"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156467289/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 942,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156474035",
    "pull_request_review_id": 82956881,
    "id": 156474035,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1NjQ3NDAzNQ==",
    "diff_hunk": "@@ -938,11 +938,12 @@ void PeerLogicValidation::BlockChecked(const CBlock& block, const CValidationSta\n     // 3. This is currently the best block we're aware of. We haven't updated\n     //    the tip yet so we have no way to check this directly here. Instead we\n     //    just check that there are currently no other blocks in flight.\n-    else if (state.IsValid() &&\n-             !IsInitialBlockDownload() &&\n-             mapBlocksInFlight.count(hash) == mapBlocksInFlight.size()) {\n-        if (it != mapBlockSource.end()) {\n-            MaybeSetPeerAsAnnouncingHeaderAndIDs(it->second.first, connman);\n+    else if (state.IsValid()) {\n+        initialBlockDownloadCompleted = !IsInitialBlockDownload();",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 10,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "8a3ecc90185ff36ea118fe98a7e514c1ba101e5b",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This code part doesn't add a new call, it just preserves the state of the result of `IsInitialBlockDownload()` in the new `IsInitialBlockDownload` variable.",
    "created_at": "2017-12-12T19:40:09Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r156474035",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156474035"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r156474035"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156474035/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 942,
    "side": "RIGHT",
    "in_reply_to_id": 156467289
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156474256",
    "pull_request_review_id": 82957115,
    "id": 156474256,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1NjQ3NDI1Ng==",
    "diff_hunk": "@@ -311,10 +311,10 @@ static inline bool HasAllDesirableServiceFlags(ServiceFlags services) {\n \n /**\n  * Checks if a peer with the given service flags may be capable of having a\n- * robust address-storage DB. Currently an alias for checking NODE_NETWORK.\n+ * robust address-storage DB.\n  */\n static inline bool MayHaveUsefulAddressDB(ServiceFlags services) {\n-    return services & NODE_NETWORK;\n+    return (services & NODE_NETWORK) || (services & NODE_NETWORK_LIMITED);",
    "path": "src/protocol.h",
    "position": 31,
    "original_position": 9,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "005fafdaa99b900d4a3ed0320e73e0a4863abf87",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Fixed",
    "created_at": "2017-12-12T19:40:53Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r156474256",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156474256"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r156474256"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156474256/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 324,
    "original_line": 327,
    "side": "RIGHT",
    "in_reply_to_id": 149224854
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156552549",
    "pull_request_review_id": 83048534,
    "id": 156552549,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1NjU1MjU0OQ==",
    "diff_hunk": "@@ -294,6 +296,7 @@ enum ServiceFlags : uint64_t {\n  * Thus, generally, avoid calling with peerServices == NODE_NONE.\n  */\n static ServiceFlags GetDesirableServiceFlags(ServiceFlags services) {\n+    if (services & NODE_NETWORK_LIMITED && initialBlockDownloadCompleted) return ServiceFlags(NODE_NETWORK_LIMITED | NODE_WITNESS);",
    "path": "src/protocol.h",
    "position": null,
    "original_position": 20,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "8a3ecc90185ff36ea118fe98a7e514c1ba101e5b",
    "user": {
      "login": "NicolasDorier",
      "id": 3020646,
      "node_id": "MDQ6VXNlcjMwMjA2NDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3020646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NicolasDorier",
      "html_url": "https://github.com/NicolasDorier",
      "followers_url": "https://api.github.com/users/NicolasDorier/followers",
      "following_url": "https://api.github.com/users/NicolasDorier/following{/other_user}",
      "gists_url": "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NicolasDorier/subscriptions",
      "organizations_url": "https://api.github.com/users/NicolasDorier/orgs",
      "repos_url": "https://api.github.com/users/NicolasDorier/repos",
      "events_url": "https://api.github.com/users/NicolasDorier/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NicolasDorier/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "On https://github.com/bitcoin/bitcoin/pull/10387/files#diff-eff7adeaec73a769788bb78858815c91R1625 you are defining a limitedPeer as one which does not have `NODE_NETWORK` and which have `NODE_NETWORK_LIMITED`. Which is different from this logic which check only if `NODE_NETWORK_LIMITED` is available. I think the logic should be consistent.",
    "created_at": "2017-12-13T02:44:44Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r156552549",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156552549"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r156552549"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156552549/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 299,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156571525",
    "pull_request_review_id": 83069775,
    "id": 156571525,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1NjU3MTUyNQ==",
    "diff_hunk": "@@ -294,6 +296,7 @@ enum ServiceFlags : uint64_t {\n  * Thus, generally, avoid calling with peerServices == NODE_NONE.\n  */\n static ServiceFlags GetDesirableServiceFlags(ServiceFlags services) {\n+    if (services & NODE_NETWORK_LIMITED && initialBlockDownloadCompleted) return ServiceFlags(NODE_NETWORK_LIMITED | NODE_WITNESS);",
    "path": "src/protocol.h",
    "position": null,
    "original_position": 20,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "8a3ecc90185ff36ea118fe98a7e514c1ba101e5b",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I can't follow you comment.\r\n`pfrom->fLimitedNode` is set to true if the peer does not signal `NODE_NETWORK` but signals `NODE_NETWORK_LIMITED`.\r\nAt this point `GetDesirableServiceFlags()`, we should return `NODE_NETWORK_LIMITED` (not `NODE_NETWORK`) if we are out of IBD. I think this is correct,... ",
    "created_at": "2017-12-13T06:12:59Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r156571525",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156571525"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r156571525"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156571525/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 299,
    "side": "RIGHT",
    "in_reply_to_id": 156552549
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156573530",
    "pull_request_review_id": 83072060,
    "id": 156573530,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1NjU3MzUzMA==",
    "diff_hunk": "@@ -294,6 +296,7 @@ enum ServiceFlags : uint64_t {\n  * Thus, generally, avoid calling with peerServices == NODE_NONE.\n  */\n static ServiceFlags GetDesirableServiceFlags(ServiceFlags services) {\n+    if (services & NODE_NETWORK_LIMITED && initialBlockDownloadCompleted) return ServiceFlags(NODE_NETWORK_LIMITED | NODE_WITNESS);",
    "path": "src/protocol.h",
    "position": null,
    "original_position": 20,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "8a3ecc90185ff36ea118fe98a7e514c1ba101e5b",
    "user": {
      "login": "NicolasDorier",
      "id": 3020646,
      "node_id": "MDQ6VXNlcjMwMjA2NDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3020646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NicolasDorier",
      "html_url": "https://github.com/NicolasDorier",
      "followers_url": "https://api.github.com/users/NicolasDorier/followers",
      "following_url": "https://api.github.com/users/NicolasDorier/following{/other_user}",
      "gists_url": "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NicolasDorier/subscriptions",
      "organizations_url": "https://api.github.com/users/NicolasDorier/orgs",
      "repos_url": "https://api.github.com/users/NicolasDorier/repos",
      "events_url": "https://api.github.com/users/NicolasDorier/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NicolasDorier/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I am not talking about the return value, in other words, this is what I would have done:\r\n\r\n```\r\nvar limited =  (!(services & NODE_NETWORK) && (services & NODE_NETWORK_LIMITED));\r\nif (limited && initialBlockDownloadCompleted) return ServiceFlags(NODE_NETWORK_LIMITED | NODE_WITNESS);\r\nreturn ServiceFlags(NODE_NETWORK | NODE_WITNESS);\r\n```\r\n\r\nThe reason is that this is how you define if a peer is limited from his services flags [before]( https://github.com/bitcoin/bitcoin/pull/10387/files#diff-eff7adeaec73a769788bb78858815c91R1625), I don't understand why you are using different logic here.\r\n\r\n",
    "created_at": "2017-12-13T06:32:43Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r156573530",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156573530"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r156573530"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156573530/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 299,
    "side": "RIGHT",
    "in_reply_to_id": 156552549
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156575785",
    "pull_request_review_id": 83074586,
    "id": 156575785,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1NjU3NTc4NQ==",
    "diff_hunk": "@@ -294,6 +296,7 @@ enum ServiceFlags : uint64_t {\n  * Thus, generally, avoid calling with peerServices == NODE_NONE.\n  */\n static ServiceFlags GetDesirableServiceFlags(ServiceFlags services) {\n+    if (services & NODE_NETWORK_LIMITED && initialBlockDownloadCompleted) return ServiceFlags(NODE_NETWORK_LIMITED | NODE_WITNESS);",
    "path": "src/protocol.h",
    "position": null,
    "original_position": 20,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "8a3ecc90185ff36ea118fe98a7e514c1ba101e5b",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I don't think we should check for `!(services & NODE_NETWORK)` because we also want to connect to NODE_NETWORK peers... but we are also happy by connecting to a peer that has `NODE_NETWORK_LIMITED` but not `NODE_NETWORK`.",
    "created_at": "2017-12-13T06:52:34Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r156575785",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156575785"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r156575785"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156575785/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 299,
    "side": "RIGHT",
    "in_reply_to_id": 156552549
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156581389",
    "pull_request_review_id": 83080946,
    "id": 156581389,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1NjU4MTM4OQ==",
    "diff_hunk": "@@ -294,6 +296,7 @@ enum ServiceFlags : uint64_t {\n  * Thus, generally, avoid calling with peerServices == NODE_NONE.\n  */\n static ServiceFlags GetDesirableServiceFlags(ServiceFlags services) {\n+    if (services & NODE_NETWORK_LIMITED && initialBlockDownloadCompleted) return ServiceFlags(NODE_NETWORK_LIMITED | NODE_WITNESS);",
    "path": "src/protocol.h",
    "position": null,
    "original_position": 20,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "8a3ecc90185ff36ea118fe98a7e514c1ba101e5b",
    "user": {
      "login": "NicolasDorier",
      "id": 3020646,
      "node_id": "MDQ6VXNlcjMwMjA2NDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3020646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NicolasDorier",
      "html_url": "https://github.com/NicolasDorier",
      "followers_url": "https://api.github.com/users/NicolasDorier/followers",
      "following_url": "https://api.github.com/users/NicolasDorier/following{/other_user}",
      "gists_url": "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NicolasDorier/subscriptions",
      "organizations_url": "https://api.github.com/users/NicolasDorier/orgs",
      "repos_url": "https://api.github.com/users/NicolasDorier/repos",
      "events_url": "https://api.github.com/users/NicolasDorier/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NicolasDorier/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Imagine the following scenario:\r\n\r\n* You are not in IBD, connect to peers only with `NODE_NETWORK|NODE_NETWORK_LIMITED`\r\n* For some reason, you start being in IBD once again.\r\n\r\nNow your node is stuck because of [this](https://github.com/bitcoin/bitcoin/pull/10387/files#diff-eff7adeaec73a769788bb78858815c91R3598).\r\n\r\nAn alternative fix would be to only check for `NODE_NETWORK_LIMITED` [here](https://github.com/bitcoin/bitcoin/pull/10387/files#diff-eff7adeaec73a769788bb78858815c91R1625).\r\n\r\nIn general I think it is weird that we treat differently `NODE_NETWORK|NODE_NETWORK_LIMITED` peer from `NODE_NETWORK` peers.",
    "created_at": "2017-12-13T07:38:15Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r156581389",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156581389"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r156581389"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156581389/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 299,
    "side": "RIGHT",
    "in_reply_to_id": 156552549
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156716617",
    "pull_request_review_id": 83240088,
    "id": 156716617,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1NjcxNjYxNw==",
    "diff_hunk": "@@ -938,11 +938,12 @@ void PeerLogicValidation::BlockChecked(const CBlock& block, const CValidationSta\n     // 3. This is currently the best block we're aware of. We haven't updated\n     //    the tip yet so we have no way to check this directly here. Instead we\n     //    just check that there are currently no other blocks in flight.\n-    else if (state.IsValid() &&\n-             !IsInitialBlockDownload() &&\n-             mapBlocksInFlight.count(hash) == mapBlocksInFlight.size()) {\n-        if (it != mapBlockSource.end()) {\n-            MaybeSetPeerAsAnnouncingHeaderAndIDs(it->second.first, connman);\n+    else if (state.IsValid()) {\n+        initialBlockDownloadCompleted = !IsInitialBlockDownload();",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 10,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "8a3ecc90185ff36ea118fe98a7e514c1ba101e5b",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yes, I'm suggesting you move the update of initialBlockDownloadCompleted to UpdatedBlockTip instead of BlockChecked.",
    "created_at": "2017-12-13T16:50:10Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r156716617",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156716617"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r156716617"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156716617/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 942,
    "side": "RIGHT",
    "in_reply_to_id": 156467289
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156759256",
    "pull_request_review_id": 83290625,
    "id": 156759256,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Njc1OTI1Ng==",
    "diff_hunk": "@@ -294,6 +296,7 @@ enum ServiceFlags : uint64_t {\n  * Thus, generally, avoid calling with peerServices == NODE_NONE.\n  */\n static ServiceFlags GetDesirableServiceFlags(ServiceFlags services) {\n+    if (services & NODE_NETWORK_LIMITED && initialBlockDownloadCompleted) return ServiceFlags(NODE_NETWORK_LIMITED | NODE_WITNESS);",
    "path": "src/protocol.h",
    "position": null,
    "original_position": 20,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "8a3ecc90185ff36ea118fe98a7e514c1ba101e5b",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> In general I think it is weird that we treat differently NODE_NETWORK|NODE_NETWORK_LIMITED peer from NODE_NETWORK peers.\r\n\r\nI think we have to. Otherwise we would never connect to pruned peers... what we want is also considering connecting to pruned if we are not deeper then 144 blocks from the expected tip.\r\n\r\n> For some reason, you start being in IBD once again.\r\n\r\nI think there you are right. When switching back to IBD below say 144*1.5 blocks from the tip, we eventually hit a peer stalling us. Though it should be detected by the stalling logic and should get disconnected. The free slow should be then be re-used with a peer that must have `NODE_NETWORK` (because `GetDesirableServiceFlags()` will required `NODE_NETWORK` again at this point).\r\n\r\nBut I agree that disconnecting pruned (`NODE_NETWORK_LIMITED` only) peers once we fallback to IBD should be something we implement.",
    "created_at": "2017-12-13T19:32:01Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r156759256",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156759256"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r156759256"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156759256/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 299,
    "side": "RIGHT",
    "in_reply_to_id": 156552549
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156759517",
    "pull_request_review_id": 83290938,
    "id": 156759517,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Njc1OTUxNw==",
    "diff_hunk": "@@ -938,11 +938,12 @@ void PeerLogicValidation::BlockChecked(const CBlock& block, const CValidationSta\n     // 3. This is currently the best block we're aware of. We haven't updated\n     //    the tip yet so we have no way to check this directly here. Instead we\n     //    just check that there are currently no other blocks in flight.\n-    else if (state.IsValid() &&\n-             !IsInitialBlockDownload() &&\n-             mapBlocksInFlight.count(hash) == mapBlocksInFlight.size()) {\n-        if (it != mapBlockSource.end()) {\n-            MaybeSetPeerAsAnnouncingHeaderAndIDs(it->second.first, connman);\n+    else if (state.IsValid()) {\n+        initialBlockDownloadCompleted = !IsInitialBlockDownload();",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 10,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "8a3ecc90185ff36ea118fe98a7e514c1ba101e5b",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I see. Fixed.",
    "created_at": "2017-12-13T19:33:00Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r156759517",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156759517"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r156759517"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156759517/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 942,
    "side": "RIGHT",
    "in_reply_to_id": 156467289
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156848811",
    "pull_request_review_id": 83391784,
    "id": 156848811,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Njg0ODgxMQ==",
    "diff_hunk": "@@ -294,6 +296,7 @@ enum ServiceFlags : uint64_t {\n  * Thus, generally, avoid calling with peerServices == NODE_NONE.\n  */\n static ServiceFlags GetDesirableServiceFlags(ServiceFlags services) {\n+    if (services & NODE_NETWORK_LIMITED && initialBlockDownloadCompleted) return ServiceFlags(NODE_NETWORK_LIMITED | NODE_WITNESS);",
    "path": "src/protocol.h",
    "position": null,
    "original_position": 20,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "8a3ecc90185ff36ea118fe98a7e514c1ba101e5b",
    "user": {
      "login": "NicolasDorier",
      "id": 3020646,
      "node_id": "MDQ6VXNlcjMwMjA2NDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3020646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NicolasDorier",
      "html_url": "https://github.com/NicolasDorier",
      "followers_url": "https://api.github.com/users/NicolasDorier/followers",
      "following_url": "https://api.github.com/users/NicolasDorier/following{/other_user}",
      "gists_url": "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NicolasDorier/subscriptions",
      "organizations_url": "https://api.github.com/users/NicolasDorier/orgs",
      "repos_url": "https://api.github.com/users/NicolasDorier/repos",
      "events_url": "https://api.github.com/users/NicolasDorier/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NicolasDorier/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "`NODE_NETWORK|NODE_NETWORK_LIMITED` makes no sense to me. I was under the impression that if a peer was serving only limited block it would be `NODE_NETWORK_LIMITED`. If the peer can serve more, it would be `NODE_NETWORK`.\r\n\r\nSo what is the meaning of a peer `NODE_NETWORK|NODE_NETWORK_LIMITED` ? I would argue that this mean they can serve historical blocks, so they should be considered as if they were `NODE_NETWORK` only. Is there another meaning to it?",
    "created_at": "2017-12-14T03:54:02Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r156848811",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156848811"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r156848811"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156848811/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 299,
    "side": "RIGHT",
    "in_reply_to_id": 156552549
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156861038",
    "pull_request_review_id": 83405103,
    "id": 156861038,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Njg2MTAzOA==",
    "diff_hunk": "@@ -294,6 +296,7 @@ enum ServiceFlags : uint64_t {\n  * Thus, generally, avoid calling with peerServices == NODE_NONE.\n  */\n static ServiceFlags GetDesirableServiceFlags(ServiceFlags services) {\n+    if (services & NODE_NETWORK_LIMITED && initialBlockDownloadCompleted) return ServiceFlags(NODE_NETWORK_LIMITED | NODE_WITNESS);",
    "path": "src/protocol.h",
    "position": null,
    "original_position": 20,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "8a3ecc90185ff36ea118fe98a7e514c1ba101e5b",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "As of BIP159, `NODE_NETWORK_LIMITED` signals that a peer has the last 288 blocks. This is \"always\" true for a NODE_NETWORK peer. This was chosen because services are a bit-set and bits should not depend on each other.\r\n\r\nConclusion:\r\n* `NODE_NETWORK` (unpruned peer, can serve the complete history)\r\n* `NODE_NETWORK_LIMITED ^NODE_NETWORK` (no NODE_NETWORK) (can serve the last 288 blocks but can't serve the complete history)\r\n* `NODE_NETWORK | NODE_NETWORK_LIMITED` (can serve the complete history and the last 288 blocks [which is obvious])",
    "created_at": "2017-12-14T06:06:54Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r156861038",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156861038"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r156861038"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156861038/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 299,
    "side": "RIGHT",
    "in_reply_to_id": 156552549
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156866958",
    "pull_request_review_id": 83411885,
    "id": 156866958,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Njg2Njk1OA==",
    "diff_hunk": "@@ -294,6 +296,7 @@ enum ServiceFlags : uint64_t {\n  * Thus, generally, avoid calling with peerServices == NODE_NONE.\n  */\n static ServiceFlags GetDesirableServiceFlags(ServiceFlags services) {\n+    if (services & NODE_NETWORK_LIMITED && initialBlockDownloadCompleted) return ServiceFlags(NODE_NETWORK_LIMITED | NODE_WITNESS);",
    "path": "src/protocol.h",
    "position": null,
    "original_position": 20,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "8a3ecc90185ff36ea118fe98a7e514c1ba101e5b",
    "user": {
      "login": "NicolasDorier",
      "id": 3020646,
      "node_id": "MDQ6VXNlcjMwMjA2NDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3020646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NicolasDorier",
      "html_url": "https://github.com/NicolasDorier",
      "followers_url": "https://api.github.com/users/NicolasDorier/followers",
      "following_url": "https://api.github.com/users/NicolasDorier/following{/other_user}",
      "gists_url": "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NicolasDorier/subscriptions",
      "organizations_url": "https://api.github.com/users/NicolasDorier/orgs",
      "repos_url": "https://api.github.com/users/NicolasDorier/repos",
      "events_url": "https://api.github.com/users/NicolasDorier/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NicolasDorier/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "OK I got it now. Thanks for explanation, this is fine to me.",
    "created_at": "2017-12-14T07:01:39Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r156866958",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156866958"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r156866958"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156866958/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 299,
    "side": "RIGHT",
    "in_reply_to_id": 156552549
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/159598321",
    "pull_request_review_id": 86572532,
    "id": 159598321,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1OTU5ODMyMQ==",
    "diff_hunk": "@@ -277,6 +278,7 @@ enum ServiceFlags : uint64_t {\n     // BIP process.\n };\n \n+extern std::atomic<bool> initialBlockDownloadCompleted;",
    "path": "src/protocol.h",
    "position": null,
    "original_position": 12,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "ee864311342b4c8720855f46af56e1fe267ba275",
    "user": {
      "login": "jimpo",
      "id": 881253,
      "node_id": "MDQ6VXNlcjg4MTI1Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/881253?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimpo",
      "html_url": "https://github.com/jimpo",
      "followers_url": "https://api.github.com/users/jimpo/followers",
      "following_url": "https://api.github.com/users/jimpo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimpo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimpo/subscriptions",
      "organizations_url": "https://api.github.com/users/jimpo/orgs",
      "repos_url": "https://api.github.com/users/jimpo/repos",
      "events_url": "https://api.github.com/users/jimpo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimpo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: I believe it should be `g_initial_block_download_completed` per style guidelines.",
    "created_at": "2018-01-04T08:22:07Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r159598321",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/159598321"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r159598321"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/159598321/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 281,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/159598539",
    "pull_request_review_id": 86572532,
    "id": 159598539,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1OTU5ODUzOQ==",
    "diff_hunk": "@@ -643,6 +643,7 @@ class CNode\n     bool fOneShot;\n     bool m_manual_connection;\n     bool fClient;\n+    bool fLimitedNode; //after BIP159",
    "path": "src/net.h",
    "position": null,
    "original_position": 4,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "ee864311342b4c8720855f46af56e1fe267ba275",
    "user": {
      "login": "jimpo",
      "id": 881253,
      "node_id": "MDQ6VXNlcjg4MTI1Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/881253?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimpo",
      "html_url": "https://github.com/jimpo",
      "followers_url": "https://api.github.com/users/jimpo/followers",
      "following_url": "https://api.github.com/users/jimpo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimpo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimpo/subscriptions",
      "organizations_url": "https://api.github.com/users/jimpo/orgs",
      "repos_url": "https://api.github.com/users/jimpo/repos",
      "events_url": "https://api.github.com/users/jimpo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimpo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: `m_limited_node`?",
    "created_at": "2018-01-04T08:23:51Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r159598539",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/159598539"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r159598539"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/159598539/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 646,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/159599631",
    "pull_request_review_id": 86572532,
    "id": 159599631,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1OTU5OTYzMQ==",
    "diff_hunk": "@@ -294,6 +296,7 @@ enum ServiceFlags : uint64_t {\n  * Thus, generally, avoid calling with peerServices == NODE_NONE.\n  */\n static ServiceFlags GetDesirableServiceFlags(ServiceFlags services) {\n+    if (services & NODE_NETWORK_LIMITED && initialBlockDownloadCompleted) return ServiceFlags(NODE_NETWORK_LIMITED | NODE_WITNESS);",
    "path": "src/protocol.h",
    "position": null,
    "original_position": 20,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "ee864311342b4c8720855f46af56e1fe267ba275",
    "user": {
      "login": "jimpo",
      "id": 881253,
      "node_id": "MDQ6VXNlcjg4MTI1Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/881253?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimpo",
      "html_url": "https://github.com/jimpo",
      "followers_url": "https://api.github.com/users/jimpo/followers",
      "following_url": "https://api.github.com/users/jimpo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimpo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimpo/subscriptions",
      "organizations_url": "https://api.github.com/users/jimpo/orgs",
      "repos_url": "https://api.github.com/users/jimpo/repos",
      "events_url": "https://api.github.com/users/jimpo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimpo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: Please put parentheses around `services & NODE_NETWORK_LIMITED` so it's easier to visually parse. And put the return on the next line as this one is rather long.",
    "created_at": "2018-01-04T08:32:08Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r159599631",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/159599631"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r159599631"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/159599631/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 299,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/159738970",
    "pull_request_review_id": 86572532,
    "id": 159738970,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1OTczODk3MA==",
    "diff_hunk": "@@ -849,11 +854,11 @@ def deserialize(self, f):\n         self.nServices = struct.unpack(\"<Q\", f.read(8))[0]\n         self.nTime = struct.unpack(\"<q\", f.read(8))[0]\n         self.addrTo = CAddress()\n-        self.addrTo.deserialize(f)\n+        self.addrTo.deserialize(f, False)",
    "path": "test/functional/test_framework/messages.py",
    "position": 32,
    "original_position": 32,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "ddba9453c216a6572bca96a9d045615fcae841be",
    "user": {
      "login": "jimpo",
      "id": 881253,
      "node_id": "MDQ6VXNlcjg4MTI1Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/881253?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimpo",
      "html_url": "https://github.com/jimpo",
      "followers_url": "https://api.github.com/users/jimpo/followers",
      "following_url": "https://api.github.com/users/jimpo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimpo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimpo/subscriptions",
      "organizations_url": "https://api.github.com/users/jimpo/orgs",
      "repos_url": "https://api.github.com/users/jimpo/repos",
      "events_url": "https://api.github.com/users/jimpo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimpo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think it's more clear to call with keyword arguments for boolean options: `deserialize(f, with_time=False)`. Same for invocations below.\r\n  ",
    "created_at": "2018-01-04T19:45:18Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r159738970",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/159738970"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r159738970"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/159738970/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 861,
    "original_line": 861,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/168225372",
    "pull_request_review_id": 96557879,
    "id": 168225372,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2ODIyNTM3Mg==",
    "diff_hunk": "@@ -849,11 +854,11 @@ def deserialize(self, f):\n         self.nServices = struct.unpack(\"<Q\", f.read(8))[0]\n         self.nTime = struct.unpack(\"<q\", f.read(8))[0]\n         self.addrTo = CAddress()\n-        self.addrTo.deserialize(f)\n+        self.addrTo.deserialize(f, False)",
    "path": "test/functional/test_framework/messages.py",
    "position": 32,
    "original_position": 32,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "ddba9453c216a6572bca96a9d045615fcae841be",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Agree; using a named argument would make this code more readable.",
    "created_at": "2018-02-14T16:13:26Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r168225372",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/168225372"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r168225372"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/168225372/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 861,
    "original_line": 861,
    "side": "RIGHT",
    "in_reply_to_id": 159738970
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/168228007",
    "pull_request_review_id": 96560983,
    "id": 168228007,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2ODIyODAwNw==",
    "diff_hunk": "@@ -277,6 +278,7 @@ enum ServiceFlags : uint64_t {\n     // BIP process.\n };\n \n+extern std::atomic<bool> g_initial_block_download_completed;",
    "path": "src/protocol.h",
    "position": null,
    "original_position": 12,
    "commit_id": "eb9183535d5fc2dfe8c0e26378f2621d3473c303",
    "original_commit_id": "3f56df5b7564878330ddddddec8afa923a4f8390",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I don't like that we need to introduce a global here, especially one that has to be accessible externally (in the header file).\r\nAny drawback to moving `GetDesirableServiceFlags` to the .cpp instead?",
    "created_at": "2018-02-14T16:19:39Z",
    "updated_at": "2018-02-17T10:29:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r168228007",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/168228007"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r168228007"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/168228007/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 281,
    "side": "RIGHT"
  }
]