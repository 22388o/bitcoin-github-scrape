[
  {
    "sha": "d32036a47d9ccdc38628a7a75bb8b711af462e4f",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpkMzIwMzZhNDdkOWNjZGMzODYyOGE3YTc1YmI4YjcxMWFmNDYyZTRm",
    "commit": {
      "author": {
        "name": "Gregory Maxwell",
        "email": "greg@xiph.org",
        "date": "2016-11-01T00:08:47Z"
      },
      "committer": {
        "name": "Gregory Maxwell",
        "email": "greg@xiph.org",
        "date": "2016-11-01T00:11:52Z"
      },
      "message": "Use RelevantServices instead of node_network in AttemptToEvict.\n\nUse of node_network here is really meant to be a proxy of \"likely to\n send us blocks in the future\".  RelevantServices is the right criteria\n now.",
      "tree": {
        "sha": "92390008858cc6b437ae8e38db6fb69c645c7049",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/92390008858cc6b437ae8e38db6fb69c645c7049"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d32036a47d9ccdc38628a7a75bb8b711af462e4f",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d32036a47d9ccdc38628a7a75bb8b711af462e4f",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/d32036a47d9ccdc38628a7a75bb8b711af462e4f",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d32036a47d9ccdc38628a7a75bb8b711af462e4f/comments",
    "author": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "3d69ecb4edeb80003a1a41442e320898a30dbd9c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3d69ecb4edeb80003a1a41442e320898a30dbd9c",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/3d69ecb4edeb80003a1a41442e320898a30dbd9c"
      }
    ],
    "stats": {
      "total": 7,
      "additions": 4,
      "deletions": 3
    },
    "files": [
      {
        "sha": "6020da16f91e5470a69f2397239386f2374c2ff0",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 3,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d32036a47d9ccdc38628a7a75bb8b711af462e4f/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d32036a47d9ccdc38628a7a75bb8b711af462e4f/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=d32036a47d9ccdc38628a7a75bb8b711af462e4f",
        "patch": "@@ -825,7 +825,7 @@ struct NodeEvictionCandidate\n     int64_t nMinPingUsecTime;\n     int64_t nLastBlockTime;\n     int64_t nLastTXTime;\n-    bool fNetworkNode;\n+    bool fRelevantServices;\n     bool fRelayTxes;\n     bool fBloomFilter;\n     CAddress addr;\n@@ -850,7 +850,7 @@ static bool CompareNodeBlockTime(const NodeEvictionCandidate &a, const NodeEvict\n {\n     // There is a fall-through here because it is common for a node to have many peers which have not yet relayed a block.\n     if (a.nLastBlockTime != b.nLastBlockTime) return a.nLastBlockTime < b.nLastBlockTime;\n-    if (a.fNetworkNode != b.fNetworkNode) return b.fNetworkNode;\n+    if (a.fRelevantServices != b.fRelevantServices) return b.fRelevantServices;\n     return a.nTimeConnected > b.nTimeConnected;\n }\n \n@@ -885,7 +885,8 @@ bool CConnman::AttemptToEvictConnection()\n             if (node->fDisconnect)\n                 continue;\n             NodeEvictionCandidate candidate = {node->id, node->nTimeConnected, node->nMinPingUsecTime,\n-                                               node->nLastBlockTime, node->nLastTXTime, node->fNetworkNode,\n+                                               node->nLastBlockTime, node->nLastTXTime,\n+                                               (node->nServices & nRelevantServices) == nRelevantServices,\n                                                node->fRelayTxes, node->pfilter != NULL, node->addr, node->nKeyedNetGroup};\n             vEvictionCandidates.push_back(candidate);\n         }"
      }
    ]
  }
]