EthanHeilman,2016-10-28T21:54:29Z,This is the test-before-evict feature originally proposed in #6355.\n,https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-257038295,257038295,
EthanHeilman,2016-10-28T22:04:46Z,One issue which needs to be address in my code above is that I read from mapInfo via [ ]. This violates the very sensible coding style guide requirement that [ ] is never used for map reads. I could use an assert as is used in other code in addrman:\n\n``` cpp\nassert(mapInfo.count(nId) == 1);\n```\n\nInstead I'd prefer to create a private method for accessing mapInfo elements by nId similar to CA,https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-257040021,257040021,
EthanHeilman,2016-11-01T19:38:43Z,I added some extra checks to ensure that if setTriedCollisions points to a key which doesn't exist in mapInfo it just removes that bad key.\n,https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-257671470,257671470,
EthanHeilman,2016-11-21T23:36:37Z,Is this good to merge? Any changes I should make?,https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-262102202,262102202,
EthanHeilman,2016-12-09T00:38:23Z,Fixed a merge conflict.,https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-265899420,265899420,
EthanHeilman,2016-12-18T20:51:39Z,@sipa Any suggestions or improvements I can make to this?,https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-267845720,267845720,
sipa,2017-04-09T15:45:17Z,"utACK\n\n@EthanHeilman Sorry for the delay here. I think we should try to get this in for 0.15. Would you mind rebasing again?",https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-292793699,292793699,
EthanHeilman,2017-04-10T17:05:06Z,@sipa Will rebase today or tomorrow.,https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-293014073,293014073,
EthanHeilman,2017-04-13T13:43:08Z,"@sipa rebased, also updated some of the log statement to follow the new format.",https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-293899032,293899032,
EthanHeilman,2017-07-27T08:35:43Z,Updated to obey new Bitcoin coding style guide,https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-318296882,318296882,
EthanHeilman,2017-08-10T20:48:05Z,ping @theuni ,https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-321668922,321668922,
theuni,2017-08-16T21:51:25Z,@EthanHeilman Thanks for adapting the style. I'll review thoroughly soon.,https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-322909931,322909931,
sdaftuar,2018-03-05T20:55:52Z,"Code review ACK, though I  haven't reviewed the tests.  (Also I am new to this code, but I tried to come up with all the ways I thought this could be broken, and failed to come up with anything.)\n\nEDIT: travis error is some sort of whitespace issue:\n\n```\nThis diff appears to have added new lines with trailing whitespace.\nThe following changes were suspected:\ndiff --git a/src/addrman.",https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-370562158,370562158,
EthanHeilman,2018-03-05T21:48:28Z,@sdaftuar I've been trying to find the whitespace error for a while now. I can't seem to find it. The line number identified seems to just be a carriage return. Any help?,https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-370578539,370578539,
sipa,2018-03-06T15:20:58Z,@EthanHeilman It seems the unit tests fail now.,https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-370816124,370816124,
sdaftuar,2018-03-06T18:50:27Z,I've reviewed the tests and the last change; utACK e68172ed9fd0e35d4e848142e9b36ffcc41de254 ,https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-370887072,370887072,
sipa,2018-03-06T20:07:59Z,utACK e68172ed9fd0e35d4e848142e9b36ffcc41de254,https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-370911152,370911152,
kallewoof,2018-03-06T20:28:10Z,utACK e68172e,https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-370916835,370916835,
theuni,2018-03-06T20:33:16Z,utACK modulo the log comment.,https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-370918346,370918346,
kazcw,2016-10-28T22:27:57Z,"Lock is held, could use Good_\n",https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85620289,85620289,src/addrman.cpp
kazcw,2016-10-28T22:28:22Z,Lock held as above\n,https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85620319,85620319,src/addrman.cpp
kazcw,2016-10-28T22:29:00Z,Nit: is this cast necessary?\n,https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85620371,85620371,src/addrman.cpp
kazcw,2016-10-28T23:15:27Z,Nit: I think std::advance would be clearer than a loop for picking one element\n,https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85624346,85624346,src/addrman.cpp
EthanHeilman,2016-10-30T02:00:06Z,Good call!\n,https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85651668,85651668,src/addrman.cpp
EthanHeilman,2016-10-30T02:00:34Z,"Nope, removed it.\n",https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85651671,85651671,src/addrman.cpp
kallewoof,2018-02-20T01:19:43Z,"Nit: The above if case looks misleadingly like a single-no-curling-brace-block (I misread it as such) until you realize the thing below the comment (`// The position...`) is actually ending the block.\n\nMaybe move the comment inside and indented inside the else block? ",https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169199359,169199359,src/addrman.cpp
kallewoof,2018-02-20T01:20:47Z,"Same here, in case you address the above indentation/readability concern.\n\n",https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169199460,169199460,src/addrman.cpp
kallewoof,2018-02-20T01:24:31Z,"It seems like you can reduce the lines below by defaulting to `true` here, as several cases simply turn it on. Unless it is too complicated to swap.",https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169199786,169199786,src/addrman.cpp
kallewoof,2018-02-20T01:26:23Z,Comment mentions old name (`newId`).,https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169199943,169199943,src/addrman.cpp
kallewoof,2018-02-20T01:27:00Z,Maybe just `return mapInfo[id_old];`?,https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169199994,169199994,src/addrman.cpp
kallewoof,2018-02-20T01:29:01Z,(Tests so maybe no biggie but) use `std::to_string()` not `boost::to_string()`,https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169200154,169200154,src/test/addrman_tests.cpp
kallewoof,2018-02-20T01:29:27Z,`std::to_string`,https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169200207,169200207,src/test/addrman_tests.cpp
EthanHeilman,2018-02-20T22:16:03Z,Let me fix these and all push later tonight,https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169478260,169478260,src/test/addrman_tests.cpp
EthanHeilman,2018-02-26T02:23:26Z,"I appreciate this comment, but I'm concerned it would be more confusing to read if I shortened it.",https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170482138,170482138,src/addrman.cpp
EthanHeilman,2018-02-26T02:24:40Z,"Good catch, thanks!",https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170482224,170482224,src/addrman.cpp
EthanHeilman,2018-02-26T02:28:25Z,It looked weird below the else if and in a brief search I couldn't find any other examples of that style in code. Instead I moved it to right of the if else.,https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170482515,170482515,src/addrman.cpp
EthanHeilman,2018-02-26T02:28:30Z,done,https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170482524,170482524,src/addrman.cpp
EthanHeilman,2018-02-26T02:36:18Z,Fixed,https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170483181,170483181,src/test/addrman_tests.cpp
kallewoof,2018-02-26T02:37:32Z,"There are plenty of examples of this, I think.\n\nE.g. https://github.com/bitcoin/bitcoin/blob/bf3353de90598f08a68d966c50b57ceaeb5b5d96/src/validation.cpp#L1399-L1402\n\nhttps://github.com/bitcoin/bitcoin/blob/bf3353de90598f08a68d966c50b57ceaeb5b5d96/src/validation.cpp#L2416-L2418\n",https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170483292,170483292,src/addrman.cpp
kallewoof,2018-02-26T02:39:36Z,Nit: remove space in `=%d \n`,https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170483474,170483474,src/addrman.cpp
kallewoof,2018-02-26T02:40:12Z,Always use `{}` brackets for multiline `if`s (new convention as of a while ago).,https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170483534,170483534,src/addrman.cpp
kallewoof,2018-02-26T02:41:56Z,"Nit: IMO nix newline (I understand that you want to space out for readability but this isn't usually done, and some argue that more compact gives a better overview).",https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170483707,170483707,src/addrman.cpp
kallewoof,2018-02-26T02:42:12Z,"Nit: see above (your call, of course)",https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170483732,170483732,src/addrman.cpp
kallewoof,2018-02-26T02:42:32Z,-'-,https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170483760,170483760,src/addrman.cpp
kallewoof,2018-02-26T02:43:29Z,Use `{}` for multiline `if`,https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170483841,170483841,src/addrman.cpp
kallewoof,2018-02-26T02:46:58Z,Why the extra `{}`?,https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170484146,170484146,src/addrman.h
kallewoof,2018-02-26T02:47:12Z,Same question here (why double `{}`?),https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170484170,170484170,src/addrman.h
kallewoof,2018-02-26T02:47:28Z,"Nit: space after `()` before `{`. I think functions actually put the `{` on the next line, which you did in other cases.",https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170484201,170484201,src/addrman.h
kallewoof,2018-02-26T02:48:24Z,Nit on `(){` (add space or newline),https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170484273,170484273,src/addrman.h
kallewoof,2018-02-26T02:48:44Z,"Same Q on `{}`. The lock will go out of scope before `ret`, but I don't think it will matter here as the lock will go out of scope on `return` regardless.",https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170484299,170484299,src/addrman.h
kallewoof,2018-02-26T02:50:00Z,Remove extra newline.,https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170484378,170484378,src/net.cpp
kallewoof,2018-02-26T02:50:15Z,Wrap multiline `if` in `{}`.,https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170484407,170484407,src/net.cpp
kallewoof,2018-02-26T02:50:25Z,Space or newline before `{`,https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170484420,170484420,src/test/addrman_tests.cpp
EthanHeilman,2018-03-03T16:51:49Z,Keeping new lines between code and comments as it more clearly distinguishes which line the comment is associated with. Removing newlines in other circumstances,https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172022014,172022014,src/addrman.cpp
EthanHeilman,2018-03-03T16:54:50Z,What does -'- mean?,https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172022097,172022097,src/addrman.cpp
EthanHeilman,2018-03-03T16:58:05Z,I reread the style guide more carefully and now I see what you mean,https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172022177,172022177,src/addrman.cpp
EthanHeilman,2018-03-03T17:05:15Z,"Not sure, Bitcoin used to have a second set of braces there when this pull request was originally created. They have been removed in the latest version.\n\nhttps://github.com/bitcoin/bitcoin/blob/fb26bf0ea3822638b10a783f054c280fc053a2b5/src/addrman.h#L526",https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172022385,172022385,src/addrman.h
EthanHeilman,2018-03-03T17:12:27Z,I just double checked the style guide and you are correct current style is `{` on a new line for methods.,https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172022517,172022517,src/addrman.h
EthanHeilman,2018-03-03T17:17:35Z,"I'm using the pattern from select. Since they essentially do the same thing they should look the same.\nhttps://github.com/bitcoin/bitcoin/blob/master/src/addrman.h#L562",https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172022646,172022646,src/addrman.h
EthanHeilman,2018-03-03T17:18:39Z,done,https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172022666,172022666,src/net.cpp
kallewoof,2018-03-04T21:54:05Z,"Sorry, it means ""same as above"". Like ""Ditto mark"".",https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172066218,172066218,src/addrman.cpp
kallewoof,2018-03-04T21:56:54Z,Indent `LogPrint` line? If you get a lot of indentation-only changes you can suggest people add `?w=1` to the diff page to ignore whitespace only changes.,https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172066296,172066296,src/addrman.cpp
kallewoof,2018-03-04T21:59:43Z,"It's not clear to me what this function's name is an abbreviation of. ""Simulate connection failure?"" Is it for testing/debugging?",https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172066408,172066408,src/test/addrman_tests.cpp
EthanHeilman,2018-03-05T17:27:40Z,Added comment,https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172265214,172265214,src/test/addrman_tests.cpp
EthanHeilman,2018-03-05T17:34:00Z,"But yes, it is for testing. The test before evict logic needs connections to fail to exercise the eviction code. This allows when we test a particular addresses to force it to fail.",https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172267038,172267038,src/test/addrman_tests.cpp
sipa,2018-03-05T21:52:03Z,The trailing spaces are on this line.,https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172340917,172340917,src/addrman.cpp
sdaftuar,2018-03-06T16:04:46Z,"Changing this to: `Attempt(addr, count_failure, GetAdjustedTime() - 90);` fixes the unit test failure.\n\nnit: the indentation is off on the line right below",https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172567424,172567424,src/test/addrman_tests.cpp
theuni,2018-03-06T20:32:16Z,"I'm assuming this was a rebase issue, but the ""addrman"" param is unnecessary here. It's actually not clear to me what this would do.",https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172650285,172650285,src/addrman.cpp
sipa,2018-03-06T20:33:30Z,"I think it will log ""addrman"" and nothing more.",https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172650588,172650588,src/addrman.cpp
laanwj,2018-03-06T20:43:30Z,"Whoops, sorry @theuni.\nI think it will log ""Error not enough conversion specifiers while formatting log message: addrman""",https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172653321,172653321,src/addrman.cpp
laanwj,2018-03-06T21:02:46Z,See #12622,https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172658609,172658609,src/addrman.cpp
