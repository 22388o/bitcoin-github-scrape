laanwj,2016-05-30T11:26:57Z,"This is a more invasive change than #8097, but concept ACK.\n\n> Untested.\n\nLooks like we don't have any RPC tests for `getaddednodeinfo`, nor `addnode` besides `onetry` mode.\n",https://github.com/bitcoin/bitcoin/pull/8113#issuecomment-222472213,222472213,
sipa,2016-05-30T12:39:43Z,"Basic testing for getaddednodeinfo/addnode should certainly be added, but the specific case being changed here would be very hard to test without beind able to mock out name resolving...\n",https://github.com/bitcoin/bitcoin/pull/8113#issuecomment-222483981,222483981,
laanwj,2016-05-31T13:15:55Z,"Yes, agreed. Maybe that's a future possibility after the net refactor. IMO the most important privacy invariant for DNS changes is that we don't ever do DNS queries when `-dns=0` is set. Would be nice to have an auto test of some kind for that.\n\nIn any case that's a tangent. I think #8097 was nice in that it was only a local change to an (apparently rarely used) RPC call. This involves some regr",https://github.com/bitcoin/bitcoin/pull/8113#issuecomment-222684582,222684582,
theuni,2016-05-31T15:39:59Z,"Concept ACK. Thanks, @sipa!\n\nWill review in detail.\n",https://github.com/bitcoin/bitcoin/pull/8113#issuecomment-222728761,222728761,
theuni,2016-06-01T00:21:54Z,"This looks great. A few notes:\n- GetAddedNodeInfo() doesn't check for pnode->fDisconnect. I'm not sure if it needs to bother (probably not).\n- ConnectSocketByName() only tries 1 of the resolved results, which seems to conflict with the PR description. Unless I'm reading incorrectly, adding ""foo.com"" which resolves to 10 ips will mean 2 min between tries for its ips, with random collisions mixed ",https://github.com/bitcoin/bitcoin/pull/8113#issuecomment-222859601,222859601,
sipa,2016-06-01T13:44:16Z,"> GetAddedNodeInfo() doesn't check for pnode->fDisconnect. I'm not sure if it needs to bother (probably not).\n\nI don't think that matters. If fDisconnect is set, it tends to be processed quickly.\n\n> ConnectSocketByName() only tries 1 of the resolved results, which seems to conflict with the PR description. Unless I'm reading incorrectly, adding ""foo.com"" which resolves to 10 ips will mean 2 mi",https://github.com/bitcoin/bitcoin/pull/8113#issuecomment-222996363,222996363,
theuni,2016-06-01T16:24:19Z,"Yikes, yet another misreading of this code on my part. I misunderstood the connection logic post-resolve. So nevermind the ConnectSocketByName comment.\n\nYes, the condvar can come later.\n",https://github.com/bitcoin/bitcoin/pull/8113#issuecomment-223047415,223047415,
theuni,2016-06-04T01:04:12Z,"@sipa This needs https://github.com/theuni/bitcoin/commit/c22dc8eb0a4a598c159559e7a3140bc6af653c56 in order for 'getaddednodeinfo' to properly report the connected ip.\n\nTested (via RPC, at least) ACK with the fix above. The rest looks sane. Though I suspect @TheBlueMatt will object to the behavioral change here. IMO it's more sane in that it lines up with my expectations of how this would work, ",https://github.com/bitcoin/bitcoin/pull/8113#issuecomment-223726876,223726876,
sipa,2016-06-08T12:23:08Z,"Rebased, and incorporated @theuni's fix to the RPC output.\n",https://github.com/bitcoin/bitcoin/pull/8113#issuecomment-224572793,224572793,
laanwj,2016-06-09T06:32:06Z,@TheBlueMatt can you give your OK on whether this still supports your use case?\n,https://github.com/bitcoin/bitcoin/pull/8113#issuecomment-224811365,224811365,
sipa,2016-06-13T21:59:20Z,Rebased.\n,https://github.com/bitcoin/bitcoin/pull/8113#issuecomment-225721556,225721556,
laanwj,2016-06-14T10:28:30Z,Nit: let's make the `dummy` argument optional.\n,https://github.com/bitcoin/bitcoin/pull/8113#issuecomment-225841921,225841921,
laanwj,2016-06-14T11:32:43Z,"I don't have any luck using it to connect to hostnames. E.g. when trying to add a testnet seed (which I know for fact is returing valid addresses most of the time):\n\n```\n13:31:26 getaddednodeinfo false\n\n13:31:26\n[\n  {\n    ""addednode"": ""testnet-seed.bitcoin.petertodd.org"",\n    ""connected"": false,\n    ""addresses"": [\n    ]\n  }\n]\n```\n",https://github.com/bitcoin/bitcoin/pull/8113#issuecomment-225854445,225854445,
laanwj,2016-06-14T11:46:48Z,"Got it to work now, after setting up a fake hostname instead of using a seed, and prodding it a bit:\n\n```\n  {\n    ""addednode"": ""testnettest.com"",\n    ""connected"": true,\n    ""addresses"": [\n      {\n        ""address"": ""52.72.156.74:18333"",\n        ""connected"": ""outbound""\n      }\n    ]\n  }\n```\n",https://github.com/bitcoin/bitcoin/pull/8113#issuecomment-225857197,225857197,
TheBlueMatt,2016-06-14T19:38:51Z,"I'm really not a huge fan of not following DNS changes until after the previous connection dies, but it does not effect me, personally. In any case, all of the addnode logic needs to be better documented somewhere.\n",https://github.com/bitcoin/bitcoin/pull/8113#issuecomment-225992741,225992741,
gmaxwell,2016-06-15T10:17:00Z,utACK. I think the new behavior is more useful and explicable.\n,https://github.com/bitcoin/bitcoin/pull/8113#issuecomment-226146475,226146475,
MarcoFalke,2016-06-17T15:03:00Z,"Not sure if related but this was reported on IRC by @jonasschnelli:\n\n```\n2016-06-13 23:42:03 receive version message: /bitcoinj:0.14.1/: version 70001, blocks=0, us=127.0.0.1:8333, peer=12469\n2016-06-13 23:42:03 AdvertiseLocal: advertising address [2a01:4f8:172:10da::2]:8333\n2016-06-13 23:42:05 receive version message: /bitcoinj:0.14.2/Bitcoin Wallet:4.55/: version 70001, blocks=416193, us=12",https://github.com/bitcoin/bitcoin/pull/8113#issuecomment-226793701,226793701,
theuni,2016-06-04T01:42:32Z,What Release()s this?\n,https://github.com/bitcoin/bitcoin/pull/8113#discussion_r65795028,65795028,src/net.cpp
sipa,2016-06-06T22:42:53Z,"I just copied the behaviour of the ""// Look for existing connection"" logic above. I assume that ConnectNode always returns something with an incremented refcount that the caller is supposed to deal with.\n",https://github.com/bitcoin/bitcoin/pull/8113#discussion_r65982938,65982938,src/net.cpp
theuni,2016-06-08T16:15:09Z,"Ok. I was already suspicious of the current refcounting logic, but copying the current behavior makes sense. I'll look into that separately.\n",https://github.com/bitcoin/bitcoin/pull/8113#discussion_r66287389,66287389,src/net.cpp
