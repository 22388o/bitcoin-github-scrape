[
  {
    "sha": "3f77dfdaf0f0bfe0c4662a616d6943f31bdd5bf4",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozZjc3ZGZkYWYwZjBiZmUwYzQ2NjJhNjE2ZDY5NDNmMzFiZGQ1YmY0",
    "commit": {
      "author": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2019-10-18T04:02:50Z"
      },
      "committer": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2021-08-01T23:38:47Z"
      },
      "message": "Expose ancestorsize and ancestorfees via getTransactionAncestry",
      "tree": {
        "sha": "a2e4fab1809e89366d2355404229a384514c2303",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a2e4fab1809e89366d2355404229a384514c2303"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3f77dfdaf0f0bfe0c4662a616d6943f31bdd5bf4",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3f77dfdaf0f0bfe0c4662a616d6943f31bdd5bf4",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/3f77dfdaf0f0bfe0c4662a616d6943f31bdd5bf4",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3f77dfdaf0f0bfe0c4662a616d6943f31bdd5bf4/comments",
    "author": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "42af9596ce85a541988abee54eed8a9b271a46a1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/42af9596ce85a541988abee54eed8a9b271a46a1",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/42af9596ce85a541988abee54eed8a9b271a46a1"
      }
    ],
    "stats": {
      "total": 14,
      "additions": 9,
      "deletions": 5
    },
    "files": [
      {
        "sha": "bb218cf12d279d84239c6a48e1af40e6a6affef1",
        "filename": "src/interfaces/chain.h",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3f77dfdaf0f0bfe0c4662a616d6943f31bdd5bf4/src/interfaces/chain.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3f77dfdaf0f0bfe0c4662a616d6943f31bdd5bf4/src/interfaces/chain.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/interfaces/chain.h?ref=3f77dfdaf0f0bfe0c4662a616d6943f31bdd5bf4",
        "patch": "@@ -174,7 +174,7 @@ class Chain\n         std::string& err_string) = 0;\n \n     //! Calculate mempool ancestor and descendant counts for the given transaction.\n-    virtual void getTransactionAncestry(const uint256& txid, size_t& ancestors, size_t& descendants) = 0;\n+    virtual void getTransactionAncestry(const uint256& txid, size_t& ancestors, size_t& descendants, size_t* ancestorsize = nullptr, CAmount* ancestorfees = nullptr) = 0;\n \n     //! Get the node's package limits.\n     //! Currently only returns the ancestor and descendant count limits, but could be enhanced to"
      },
      {
        "sha": "e4c0dc9491ca39104fea635556b014e20aee375c",
        "filename": "src/node/interfaces.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3f77dfdaf0f0bfe0c4662a616d6943f31bdd5bf4/src/node/interfaces.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3f77dfdaf0f0bfe0c4662a616d6943f31bdd5bf4/src/node/interfaces.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/node/interfaces.cpp?ref=3f77dfdaf0f0bfe0c4662a616d6943f31bdd5bf4",
        "patch": "@@ -574,11 +574,11 @@ class ChainImpl : public Chain\n         // that Chain clients do not need to know about.\n         return TransactionError::OK == err;\n     }\n-    void getTransactionAncestry(const uint256& txid, size_t& ancestors, size_t& descendants) override\n+    void getTransactionAncestry(const uint256& txid, size_t& ancestors, size_t& descendants, size_t* ancestorsize, CAmount* ancestorfees) override\n     {\n         ancestors = descendants = 0;\n         if (!m_node.mempool) return;\n-        m_node.mempool->GetTransactionAncestry(txid, ancestors, descendants);\n+        m_node.mempool->GetTransactionAncestry(txid, ancestors, descendants, ancestorsize, ancestorfees);\n     }\n     void getPackageLimits(unsigned int& limit_ancestor_count, unsigned int& limit_descendant_count) override\n     {"
      },
      {
        "sha": "93ad35312721d16ec52dfb683e7a08ce23f2997e",
        "filename": "src/txmempool.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 1,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3f77dfdaf0f0bfe0c4662a616d6943f31bdd5bf4/src/txmempool.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3f77dfdaf0f0bfe0c4662a616d6943f31bdd5bf4/src/txmempool.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/txmempool.cpp?ref=3f77dfdaf0f0bfe0c4662a616d6943f31bdd5bf4",
        "patch": "@@ -1116,12 +1116,14 @@ uint64_t CTxMemPool::CalculateDescendantMaximum(txiter entry) const {\n     return maximum;\n }\n \n-void CTxMemPool::GetTransactionAncestry(const uint256& txid, size_t& ancestors, size_t& descendants) const {\n+void CTxMemPool::GetTransactionAncestry(const uint256& txid, size_t& ancestors, size_t& descendants, size_t* const ancestorsize, CAmount* const ancestorfees) const {\n     LOCK(cs);\n     auto it = mapTx.find(txid);\n     ancestors = descendants = 0;\n     if (it != mapTx.end()) {\n         ancestors = it->GetCountWithAncestors();\n+        if (ancestorsize) *ancestorsize = it->GetSizeWithAncestors();\n+        if (ancestorfees) *ancestorfees = it->GetModFeesWithAncestors();\n         descendants = CalculateDescendantMaximum(it);\n     }\n }"
      },
      {
        "sha": "ea1d62d32d7e0b85255319589725013f2e1151f5",
        "filename": "src/txmempool.h",
        "status": "modified",
        "additions": 3,
        "deletions": 1,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3f77dfdaf0f0bfe0c4662a616d6943f31bdd5bf4/src/txmempool.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3f77dfdaf0f0bfe0c4662a616d6943f31bdd5bf4/src/txmempool.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/txmempool.h?ref=3f77dfdaf0f0bfe0c4662a616d6943f31bdd5bf4",
        "patch": "@@ -706,8 +706,10 @@ class CTxMemPool\n     /**\n      * Calculate the ancestor and descendant count for the given transaction.\n      * The counts include the transaction itself.\n+     * When ancestors is non-zero (ie, the transaction itself is in the mempool),\n+     * ancestorsize and ancestorfees will also be set to the appropriate values.\n      */\n-    void GetTransactionAncestry(const uint256& txid, size_t& ancestors, size_t& descendants) const;\n+    void GetTransactionAncestry(const uint256& txid, size_t& ancestors, size_t& descendants, size_t* ancestorsize = nullptr, CAmount* ancestorfees = nullptr) const;\n \n     /** @returns true if the mempool is fully loaded */\n     bool IsLoaded() const;"
      }
    ]
  },
  {
    "sha": "6966e80f453c46d5d0a923118205f19ac2f4e336",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo2OTY2ZTgwZjQ1M2M0NmQ1ZDBhOTIzMTE4MjA1ZjE5YWMyZjRlMzM2",
    "commit": {
      "author": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2018-03-12T17:59:50Z"
      },
      "committer": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2021-09-16T20:34:49Z"
      },
      "message": "RPC: Add ancestor{count,size,fees} to listunspent output",
      "tree": {
        "sha": "d3b613cde23bf95bd4cd8953f04d3f4aee401950",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d3b613cde23bf95bd4cd8953f04d3f4aee401950"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6966e80f453c46d5d0a923118205f19ac2f4e336",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6966e80f453c46d5d0a923118205f19ac2f4e336",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/6966e80f453c46d5d0a923118205f19ac2f4e336",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6966e80f453c46d5d0a923118205f19ac2f4e336/comments",
    "author": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "3f77dfdaf0f0bfe0c4662a616d6943f31bdd5bf4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3f77dfdaf0f0bfe0c4662a616d6943f31bdd5bf4",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/3f77dfdaf0f0bfe0c4662a616d6943f31bdd5bf4"
      }
    ],
    "stats": {
      "total": 13,
      "additions": 13,
      "deletions": 0
    },
    "files": [
      {
        "sha": "30677c0192012ccbba578829fb2ce4f7d44e2f00",
        "filename": "src/wallet/rpcwallet.cpp",
        "status": "modified",
        "additions": 13,
        "deletions": 0,
        "changes": 13,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6966e80f453c46d5d0a923118205f19ac2f4e336/src/wallet/rpcwallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6966e80f453c46d5d0a923118205f19ac2f4e336/src/wallet/rpcwallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcwallet.cpp?ref=6966e80f453c46d5d0a923118205f19ac2f4e336",
        "patch": "@@ -2880,6 +2880,9 @@ static RPCHelpMan listunspent()\n                             {RPCResult::Type::STR, \"scriptPubKey\", \"the script key\"},\n                             {RPCResult::Type::STR_AMOUNT, \"amount\", \"the transaction output amount in \" + CURRENCY_UNIT},\n                             {RPCResult::Type::NUM, \"confirmations\", \"The number of confirmations\"},\n+                            {RPCResult::Type::NUM, \"ancestorcount\", /* optional */ true, \"The number of in-mempool ancestor transactions, including this one (if transaction is in the mempool)\"},\n+                            {RPCResult::Type::NUM, \"ancestorsize\", /* optional */ true, \"The virtual transaction size of in-mempool ancestors, including this one (if transaction is in the mempool)\"},\n+                            {RPCResult::Type::STR_AMOUNT, \"ancestorfees\", /* optional */ true, \"The total fees of in-mempool ancestors (including this one) with fee deltas used for mining priority in \" + CURRENCY_ATOM + \" (if transaction is in the mempool)\"},\n                             {RPCResult::Type::STR_HEX, \"redeemScript\", \"The redeemScript if scriptPubKey is P2SH\"},\n                             {RPCResult::Type::STR, \"witnessScript\", \"witnessScript if the scriptPubKey is P2WSH or P2SH-P2WSH\"},\n                             {RPCResult::Type::BOOL, \"spendable\", \"Whether we have the private keys to spend this output\"},\n@@ -3046,6 +3049,16 @@ static RPCHelpMan listunspent()\n         entry.pushKV(\"scriptPubKey\", HexStr(scriptPubKey));\n         entry.pushKV(\"amount\", ValueFromAmount(out.tx->tx->vout[out.i].nValue));\n         entry.pushKV(\"confirmations\", out.nDepth);\n+        if (!out.nDepth) {\n+            size_t ancestor_count, descendant_count, ancestor_size;\n+            CAmount ancestor_fees;\n+            pwallet->chain().getTransactionAncestry(out.tx->GetHash(), ancestor_count, descendant_count, &ancestor_size, &ancestor_fees);\n+            if (ancestor_count) {\n+                entry.pushKV(\"ancestorcount\", uint64_t(ancestor_count));\n+                entry.pushKV(\"ancestorsize\", uint64_t(ancestor_size));\n+                entry.pushKV(\"ancestorfees\", uint64_t(ancestor_fees));\n+            }\n+        }\n         entry.pushKV(\"spendable\", out.fSpendable);\n         entry.pushKV(\"solvable\", out.fSolvable);\n         if (out.fSolvable) {"
      }
    ]
  },
  {
    "sha": "0be2f17ef5649c2d77efbbbdd9222332b2ebf0d2",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzowYmUyZjE3ZWY1NjQ5YzJkNzdlZmJiYmRkOTIyMjMzMmIyZWJmMGQy",
    "commit": {
      "author": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2020-06-18T18:25:04Z"
      },
      "committer": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2021-09-16T20:34:49Z"
      },
      "message": "QA: Add tests for listunspent ancestor{count,size,fees} to mempool_packages",
      "tree": {
        "sha": "a63ac643c99e4add3d9aee29900eff4ce9ad5864",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a63ac643c99e4add3d9aee29900eff4ce9ad5864"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0be2f17ef5649c2d77efbbbdd9222332b2ebf0d2",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0be2f17ef5649c2d77efbbbdd9222332b2ebf0d2",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/0be2f17ef5649c2d77efbbbdd9222332b2ebf0d2",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0be2f17ef5649c2d77efbbbdd9222332b2ebf0d2/comments",
    "author": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "6966e80f453c46d5d0a923118205f19ac2f4e336",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6966e80f453c46d5d0a923118205f19ac2f4e336",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/6966e80f453c46d5d0a923118205f19ac2f4e336"
      }
    ],
    "stats": {
      "total": 20,
      "additions": 17,
      "deletions": 3
    },
    "files": [
      {
        "sha": "0bbe4525a8fc31df4353e8cd84513a30db17b73e",
        "filename": "test/functional/mempool_packages.py",
        "status": "modified",
        "additions": 17,
        "deletions": 3,
        "changes": 20,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/0be2f17ef5649c2d77efbbbdd9222332b2ebf0d2/test/functional/mempool_packages.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/0be2f17ef5649c2d77efbbbdd9222332b2ebf0d2/test/functional/mempool_packages.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/mempool_packages.py?ref=0be2f17ef5649c2d77efbbbdd9222332b2ebf0d2",
        "patch": "@@ -51,12 +51,17 @@ def run_test(self):\n         txid = utxo[0]['txid']\n         vout = utxo[0]['vout']\n         value = utxo[0]['amount']\n+        assert 'ancestorcount' not in utxo[0]\n+        assert 'ancestorsize' not in utxo[0]\n+        assert 'ancestorfees' not in utxo[0]\n \n         fee = Decimal(\"0.0001\")\n         # MAX_ANCESTORS transactions off a confirmed tx should be fine\n         chain = []\n         witness_chain = []\n-        for _ in range(MAX_ANCESTORS):\n+        ancestor_vsize = 0\n+        ancestor_fees = Decimal(0)\n+        for i in range(MAX_ANCESTORS):\n             (txid, sent_value) = chain_transaction(self.nodes[0], [txid], [0], value, fee, 1)\n             value = sent_value\n             chain.append(txid)\n@@ -65,6 +70,15 @@ def run_test(self):\n             witnesstx = self.nodes[0].decoderawtransaction(fulltx, True)\n             witness_chain.append(witnesstx['hash'])\n \n+            # Check that listunspent ancestor{count, size, fees} yield the correct results\n+            wallet_unspent = self.nodes[0].listunspent(minconf=0)\n+            this_unspent = next(utxo_info for utxo_info in wallet_unspent if utxo_info['txid'] == txid)\n+            assert_equal(this_unspent['ancestorcount'], i + 1)\n+            ancestor_vsize += self.nodes[0].getrawtransaction(txid=txid, verbose=True)['vsize']\n+            assert_equal(this_unspent['ancestorsize'], ancestor_vsize)\n+            ancestor_fees -= self.nodes[0].gettransaction(txid=txid)['fee']\n+            assert_equal(this_unspent['ancestorfees'], ancestor_fees * COIN)\n+\n         # Wait until mempool transactions have passed initial broadcast (sent inv and received getdata)\n         # Otherwise, getrawmempool may be inconsistent with getmempoolentry if unbroadcast changes in between\n         peer_inv_store.wait_for_broadcast(witness_chain)\n@@ -77,9 +91,9 @@ def run_test(self):\n         descendant_fees = 0\n         descendant_vsize = 0\n \n-        ancestor_vsize = sum([mempool[tx]['vsize'] for tx in mempool])\n+        assert_equal(ancestor_vsize, sum([mempool[tx]['vsize'] for tx in mempool]))\n         ancestor_count = MAX_ANCESTORS\n-        ancestor_fees = sum([mempool[tx]['fee'] for tx in mempool])\n+        assert_equal(ancestor_fees, sum([mempool[tx]['fee'] for tx in mempool]))\n \n         descendants = []\n         ancestors = list(chain)"
      }
    ]
  },
  {
    "sha": "6cb60f3e6d652ffa4cf570426a7cf1f690d15c45",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo2Y2I2MGYzZTZkNjUyZmZhNGNmNTcwNDI2YTdjZjFmNjkwZDE1YzQ1",
    "commit": {
      "author": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2020-08-09T19:39:54Z"
      },
      "committer": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2021-09-16T20:34:49Z"
      },
      "message": "doc/release-notes: Add new listunspent fields",
      "tree": {
        "sha": "a87d822cede9176bf96b55348422245abc4dcfc3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a87d822cede9176bf96b55348422245abc4dcfc3"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6cb60f3e6d652ffa4cf570426a7cf1f690d15c45",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6cb60f3e6d652ffa4cf570426a7cf1f690d15c45",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/6cb60f3e6d652ffa4cf570426a7cf1f690d15c45",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6cb60f3e6d652ffa4cf570426a7cf1f690d15c45/comments",
    "author": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "0be2f17ef5649c2d77efbbbdd9222332b2ebf0d2",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0be2f17ef5649c2d77efbbbdd9222332b2ebf0d2",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/0be2f17ef5649c2d77efbbbdd9222332b2ebf0d2"
      }
    ],
    "stats": {
      "total": 8,
      "additions": 8,
      "deletions": 0
    },
    "files": [
      {
        "sha": "d6fea9eae7e1cd9158a722c35b0b95ef8080c7c9",
        "filename": "doc/release-notes-12677.md",
        "status": "added",
        "additions": 8,
        "deletions": 0,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6cb60f3e6d652ffa4cf570426a7cf1f690d15c45/doc/release-notes-12677.md",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6cb60f3e6d652ffa4cf570426a7cf1f690d15c45/doc/release-notes-12677.md",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/doc/release-notes-12677.md?ref=6cb60f3e6d652ffa4cf570426a7cf1f690d15c45",
        "patch": "@@ -0,0 +1,8 @@\n+Notable changes\n+===============\n+\n+Updated RPCs\n+------------\n+\n+- `listunspent` now includes `ancestorcount`, `ancestorsize`, and\n+`ancestorfees` for each transaction output that is still in the mempool."
      }
    ]
  }
]