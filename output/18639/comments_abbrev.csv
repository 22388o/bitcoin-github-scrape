hebasto,2020-04-14 22:16:45,"Updated 9b4b3c9442f5b2ccdce8d70161a355aec5402cef  -> fe187562ef9765942d7c7d801e04d70d294d5aef ([pr18639.01](https://github.com/hebasto/bitcoin/commits/pr18639.01) -> [pr18639.02](https://github.com/hebasto/bitcoin/commits/pr18639.02), [diff](https://github.com/hebasto/bitcoin/compare/pr18639.01..pr18639.02)):\n\n- addressed @MarcoFalke's [comment](https://github.com/bitcoin/bitcoin/pull/18639#di",https://github.com/bitcoin/bitcoin/pull/18639#issuecomment-613708604,613708604,
hebasto,2020-04-17 00:21:13,"Updated fe187562ef9765942d7c7d801e04d70d294d5aef  -> 18f0cb80c0cea7c9bc0b69a0f1fe0ca6cae8cde1 ([pr18639.02](https://github.com/hebasto/bitcoin/commits/pr18639.02) -> [pr18639.03](https://github.com/hebasto/bitcoin/commits/pr18639.03), [diff](https://github.com/hebasto/bitcoin/compare/pr18639.02..pr18639.03)):\n\nanalogous changes added for:\n- `UnloadBlockIndex()`\n- `CChainState::ReplayBlocks",https://github.com/bitcoin/bitcoin/pull/18639#issuecomment-614965279,614965279,
MarcoFalke,2020-04-17 10:47:31,What problem is this solving?,https://github.com/bitcoin/bitcoin/pull/18639#issuecomment-615178763,615178763,
hebasto,2020-04-17 11:07:59,"@MarcoFalke \n> What problem is this solving?\n\nCurrently, `::cs_main` has type `RecursiveMutex` which derives from `std::recursive_mutex`.\n\nBut I'm agree with the following `TODO` statement:\nhttps://github.com/bitcoin/bitcoin/blob/4a71c469058b824ed6c5132ab9901e194fa8aae1/src/sync.h#L106-L110",https://github.com/bitcoin/bitcoin/pull/18639#issuecomment-615186500,615186500,
DrahtBot,2020-04-18 17:03:02,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #18731 ([WIP] refactor: Make CCheckQueue RAII-styled by hebasto)\n* #18710 (Add local thread pool to CCheckQueue by hebast",https://github.com/bitcoin/bitcoin/pull/18639#issuecomment-615904295,615904295,
MarcoFalke,2020-04-18 17:20:10,"Ok, Concept ACK based on that motivation, but OP should probably mention that. Some general notes, though:\n\n* I am not sure if we can ever make `cs_main` not recursive. There might be circular dependencies in similar ways to how `csPathCached` can not be made a Mutex right now.\n* We currently have no mechanism to prevent double locking a Mutex. This is undefined behavior and currently happen",https://github.com/bitcoin/bitcoin/pull/18639#issuecomment-615906858,615906858,
hebasto,2020-04-18 17:25:44,">* We currently have no mechanism to prevent double locking a Mutex. This is undefined behavior and currently happens on some of the Mutexes we have. Someone should probably fix that.\n\nThanks for reminding :)",https://github.com/bitcoin/bitcoin/pull/18639#issuecomment-615907787,615907787,
MarcoFalke,2020-04-18 17:35:45,tsan should detect those: https://github.com/llvm/llvm-project/blame/master/compiler-rt/test/tsan/mutex_double_lock.cpp,https://github.com/bitcoin/bitcoin/pull/18639#issuecomment-615909337,615909337,
promag,2020-04-26 22:05:34,"Code review ACK e09b98605f6fdd2ad3bcdf4c68d229905f7a29cd.\n\nI don't see much value in this change especially because a) it's touching validation b) it's not fixing a problem.",https://github.com/bitcoin/bitcoin/pull/18639#issuecomment-619632174,619632174,
MarcoFalke,2020-04-14 21:29:28,Removed locks are generally replaced with `AssertLockHeld(cs_main);` and the corresponding compiler annotations,https://github.com/bitcoin/bitcoin/pull/18639#discussion_r408447328,408447328,src/validation.cpp
hebasto,2020-04-14 22:17:09,[Updated](https://github.com/bitcoin/bitcoin/pull/18639#issuecomment-613708604).,https://github.com/bitcoin/bitcoin/pull/18639#discussion_r408468690,408468690,src/validation.cpp
MarcoFalke,2020-04-14 23:31:00,"Please also add the annotation in the header\n\n\n EXCLUSIVE_LOCKS_REQUIRED(cs_main)",https://github.com/bitcoin/bitcoin/pull/18639#discussion_r408494642,408494642,src/validation.cpp
hebasto,2020-04-15 00:04:26,"> Please also add the annotation in the header\n> \n> EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n\nIt is already done: https://github.com/bitcoin/bitcoin/blob/fe187562ef9765942d7c7d801e04d70d294d5aef/src/validation.h#L671-L675",https://github.com/bitcoin/bitcoin/pull/18639#discussion_r408505088,408505088,src/validation.cpp
