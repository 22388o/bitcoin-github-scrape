DrahtBot,2018-08-25T10:08:21Z,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#13686](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/13686.html) (ZMQ: Small cleanups in the ZMQ code by domo",https://github.com/bitcoin/bitcoin/pull/14060#issuecomment-415958559,415958559,
mruddy,2018-08-25T10:29:26Z,"@domob1812 sure, added `hwm` to `getzmqnotifications`",https://github.com/bitcoin/bitcoin/pull/14060#issuecomment-415959629,415959629,
promag,2018-08-25T10:59:47Z,"Shouldn't set the option per address, not per notification type?",https://github.com/bitcoin/bitcoin/pull/14060#issuecomment-415961291,415961291,
mruddy,2018-08-25T12:36:03Z,"@promag there can only be one of each of the notification types and each can have only one address. i updated the messages to show the address too. while i was doing that, i also made all of the zmq log messages prefix with ""zmq: "" because some were missing that.",https://github.com/bitcoin/bitcoin/pull/14060#issuecomment-415966415,415966415,
mruddy,2018-08-25T14:07:23Z,"for what it's worth, i tested synching a bitcoin core node that was 5 days behind with a zmqpubhashtx tcp socket that PUBlished to a ODROID-C1+ SUBscriber across town (with roughly 15-20ms ping RTT) and -zmqpubhashtxhwm=20000 allowed me to get no gaps in transaction hashes. i had gaps (i.e.- dropped messages) with zmqpubhashtxhwm=10000. this is by no means scientific, but does give some idea of wh",https://github.com/bitcoin/bitcoin/pull/14060#issuecomment-415971685,415971685,
promag,2018-08-27T22:12:17Z,"> @promag there can only be one of each of the notification types and each can have only one address. \n\n@mruddy right, at some point I was going to add support for multiple notifications of the same type but for some reason I don't remember why I quit that, so that got me confused.\n\nMy suggestion for the long term is to extend the existing argument, like:\n```\n-zmqpubhashtx=tcp://127.0.",https://github.com/bitcoin/bitcoin/pull/14060#issuecomment-416385997,416385997,
mruddy,2018-09-17T13:15:50Z,rebased and updated the functional test just a moment ago,https://github.com/bitcoin/bitcoin/pull/14060#issuecomment-422011143,422011143,
mruddy,2018-09-20T10:37:40Z,rebased and added a comma in the getzmqnotifications help message,https://github.com/bitcoin/bitcoin/pull/14060#issuecomment-423134285,423134285,
mruddy,2018-10-12T11:46:04Z,rebased,https://github.com/bitcoin/bitcoin/pull/14060#issuecomment-429298791,429298791,
sipa,2018-10-12T19:45:56Z,"Will this make ZMQ publishing blocking on the `bitcoind` side when used? If so, that needs clear documentation.",https://github.com/bitcoin/bitcoin/pull/14060#issuecomment-429442000,429442000,
mruddy,2018-10-13T10:08:56Z,"> Will this make ZMQ publishing blocking on the `bitcoind` side when used? If so, that needs clear documentation.\n\nNo, it will not. To add more color, without this PR, the SNDHWM is 1000. These new options just allow changing that value to something else. The drop/block behavior does not change. The motivation for this change was dropped messages. And from the ZMQ API docs, we see that the doc",https://github.com/bitcoin/bitcoin/pull/14060#issuecomment-429528080,429528080,
jmcorgan,2018-10-18T22:00:12Z,ACK,https://github.com/bitcoin/bitcoin/pull/14060#issuecomment-431178705,431178705,
mruddy,2018-10-19T11:42:29Z,@jmcorgan thanks for reviewing! also i just wanted to mention that i just removed a single whitespace in the help text for `getzmqnotifications` to make the member descriptions align. that's the only change for the latest commit.,https://github.com/bitcoin/bitcoin/pull/14060#issuecomment-431335636,431335636,
reel,2018-10-20T16:06:31Z,Tested. Works great,https://github.com/bitcoin/bitcoin/pull/14060#issuecomment-431594658,431594658,
Sjors,2018-12-08T18:17:35Z,"Came across this while seeing a flood of (apparently innocuous) ""Unable to receive ZMQ rawtx message: ...""  messages from Lnd. Can you add a release note in a followup PR?",https://github.com/bitcoin/bitcoin/pull/14060#issuecomment-445478984,445478984,
domob1812,2018-08-25T10:05:15Z,"I don't really like the duplication here (one argument for each publisher cross (address, hwm)), but I think it is probably the easiest solution.  At least I don't see a good alternative that would not be over-engineered if we want the HWM configurable for each publisher separately.",https://github.com/bitcoin/bitcoin/pull/14060#discussion_r212794755,212794755,src/init.cpp
mruddy,2018-08-25T10:30:42Z,"yeah, i figured that at least it fit a pattern and was easy to code and review. unless someone has a better idea, i think i'll leave it simple.",https://github.com/bitcoin/bitcoin/pull/14060#discussion_r212795279,212795279,src/init.cpp
reel,2018-08-25T11:19:53Z,Maybe one flag to set them all would be interesting?,https://github.com/bitcoin/bitcoin/pull/14060#discussion_r212796175,212796175,src/init.cpp
mruddy,2018-08-25T12:37:26Z,that was how it was originally done in the other PR and then someone wanted it broken out i believe. it makes sense to me to have them separate because the tx publishes definitely need way more message capacity than the block pubs.,https://github.com/bitcoin/bitcoin/pull/14060#discussion_r212797541,212797541,src/init.cpp
domob1812,2018-08-25T16:18:06Z,"Perhaps there could be just two (not four) HWMs, one for tx (raw and hash) and one for blocks?  (But that's just a thought - having all four is totally fine for me if someone has use for separate values.)",https://github.com/bitcoin/bitcoin/pull/14060#discussion_r212802587,212802587,src/init.cpp
domob1812,2018-08-25T16:19:38Z,"I think this change makes sense - but it is unrelated to your other change, so perhaps move it at least to a separate commit?",https://github.com/bitcoin/bitcoin/pull/14060#discussion_r212802618,212802618,src/zmq/zmqnotificationinterface.cpp
mruddy,2018-08-25T16:27:05Z,"like a separate pull request? i know what you mean, and for a personal repo i would, but my past experience here is that if i have more than one commit, nothing will get merged until i squash it down to one.",https://github.com/bitcoin/bitcoin/pull/14060#discussion_r212802776,212802776,src/zmq/zmqnotificationinterface.cpp
mruddy,2018-08-25T16:29:00Z,"there is still a big potential message size difference between just hash and raw{block,tx} so i think having them separate still is better. it just gives people the most flexibility. btw, thanks for the review!",https://github.com/bitcoin/bitcoin/pull/14060#discussion_r212802826,212802826,src/init.cpp
promag,2018-08-27T21:57:13Z,"That's not true, just look at merged PR's. In this case I agree that a commit with this change is fine. However I would prefer to have it in a separate PR, precisely to avoid noise like this. Generally if a commit is not required in a PR, then I push it in a different PR.",https://github.com/bitcoin/bitcoin/pull/14060#discussion_r213128947,213128947,src/zmq/zmqnotificationinterface.cpp
luke-jr,2018-08-30T12:49:42Z,`-zmqpubrawtx=<address>;hwm=<hwm>` perhaps?,https://github.com/bitcoin/bitcoin/pull/14060#discussion_r214016813,214016813,src/init.cpp
promag,2018-08-30T16:45:48Z,@luke-jr FYI https://github.com/bitcoin/bitcoin/pull/14060#issuecomment-416385997,https://github.com/bitcoin/bitcoin/pull/14060#discussion_r214102546,214102546,src/init.cpp
practicalswift,2018-09-05T07:33:35Z,`outbound_message_high_water_mark` not initialized in the constructor?,https://github.com/bitcoin/bitcoin/pull/14060#discussion_r215162716,215162716,src/zmq/zmqabstractnotifier.h
mruddy,2018-09-11T22:29:44Z,"thanks. it was set, just not by the constructor. i changed things around to address that. i also found that CZMQAbstractPublishNotifier.nSequence was not initialized, so i initialized that too now.",https://github.com/bitcoin/bitcoin/pull/14060#discussion_r216844607,216844607,src/zmq/zmqabstractnotifier.h
practicalswift,2018-09-25T19:43:52Z,"```\n2018-09-25 21:25:16 clang(pr=14060): zmq/zmqabstractnotifier.h:35:38: warning: result of comparison 'const int' <= 2147483647 is always true [-Wtautological-type-limit-compare]\n```\n\nUse `static_assert` instead?",https://github.com/bitcoin/bitcoin/pull/14060#discussion_r220329451,220329451,src/zmq/zmqabstractnotifier.h
practicalswift,2018-09-25T19:44:17Z,"```\n2018-09-25 21:25:16 clang(pr=14060): zmq/zmqnotificationinterface.cpp:62:61: warning: implicit conversion loses integer precision: 'int64_t' (aka 'long') to 'int' [-Wshorten-64-to-32]\n```",https://github.com/bitcoin/bitcoin/pull/14060#discussion_r220329584,220329584,src/zmq/zmqnotificationinterface.cpp
mruddy,2018-09-26T00:11:42Z,explicit cast added,https://github.com/bitcoin/bitcoin/pull/14060#discussion_r220393499,220393499,src/zmq/zmqnotificationinterface.cpp
mruddy,2018-09-26T00:11:46Z,"ok, i'll just check it like zmq checks it: https://github.com/zeromq/libzmq/blob/master/src/options.cpp#L310-L315\n\nalso rebased. thanks!",https://github.com/bitcoin/bitcoin/pull/14060#discussion_r220393514,220393514,src/zmq/zmqabstractnotifier.h
