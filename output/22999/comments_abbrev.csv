jonatack,2021-09-16 16:08:09,"@martinus please let me know if this is ok, as the `-quiet` arg makes some minor changes to `nanobench.h` to allow the equivalent of `NANOBENCH_SUPPRESS_WARNINGS=1` as an arg listed in the help.",https://github.com/bitcoin/bitcoin/pull/22999#issuecomment-921036707,921036707,
theStack,2021-09-16 20:41:30,"Strong Concept ACK on introducing an `-iters` parameter, after also having reviewed #22974 :)\nAs for `-quiet` I'm less convinced about the usefulness, I think the warnings and recommendations almost always make sense and I personally wouldn't see a need to silence them -- if a result is marked as ""Unstable"" I'm usually throwing it away, assuming that it only has a limited value. (Note though tha",https://github.com/bitcoin/bitcoin/pull/22999#issuecomment-921230050,921230050,
jonatack,2021-09-16 21:02:06,"Thanks! The -quiet arg was actually my first motivation, to be able to less painfully compare results or share them, most of which for me have the verbose >5% err unstable warnings even when all the recommendations are followed, and it takes an annoying amount of time to edit out all the warnings by hand. People can see the %err, so for sharing results the noisy warnings are quite pollutive and it",https://github.com/bitcoin/bitcoin/pull/22999#issuecomment-921242306,921242306,
fanquake,2021-09-17 02:47:54,"I don't think adding more code, and modifying a dependency, just to replicate functionality that already exists is a good idea. What's the problem with using `NANOBENCH_SUPPRESS_WARNINGS`? In almost all cases I'm sure we'd rather people heed the warnings, and produce more useful benchmarks, than just ignore them.\n\n> and it takes an annoying amount of time to edit out all the warnings by hand.",https://github.com/bitcoin/bitcoin/pull/22999#issuecomment-921412428,921412428,
jonatack,2021-09-17 13:22:08,"I'm going to close and use these features for my own Bitcoin Core benchmarking. If anyone else would like to use them, they can cherry-pick this branch for their own use.\n\nThanks for your replies, @martinus.  Feel free to add bench documentation as you suggest in https://github.com/bitcoin/bitcoin/pull/22999#discussion_r710827860 and I'll be happy to review it. ",https://github.com/bitcoin/bitcoin/pull/22999#issuecomment-921793212,921793212,
martinus,2021-09-17 07:31:16,"I don't think that warning should ever be hidden. It shows that the value you are seeing is not reliable because the error is too high. If you regularly see that warning in a benchmark, the benchmark should be improved or the machine should be somehow stabilized.",https://github.com/bitcoin/bitcoin/pull/22999#discussion_r710820743,710820743,src/bench/nanobench.h
martinus,2021-09-17 07:42:43,"I'm not sure about adding support for this though, because this can already be done with the environment variable `NANOBENCH_SUPPRESS_WARNINGS` and it is not obvious which of these setting should override the other. Maybe it would be better to just add documentation for `NANOBENCH_SUPPRESS_WARNINGS` and also `NANOBENCH_ENDLESS` into the usage documentation?\n\nIf we really want that, in nanobenc",https://github.com/bitcoin/bitcoin/pull/22999#discussion_r710827860,710827860,src/bench/nanobench.h
martinus,2021-09-17 08:21:01,"I do not think adding an iterations argument that work like that is a good idea. `nanobench` itself already has the ability to perform multiple measurements (called ""epoch"" in `nanobench`), in fact each benchmark is already measured 11 times. That way it is able to show a measurement error. The number of iterations in each of the measurements is determined automatically, based on the computer's cl",https://github.com/bitcoin/bitcoin/pull/22999#discussion_r710854078,710854078,src/bench/bench.cpp
jonatack,2021-09-17 13:01:27,"Yes, unfortunately many to most of the benchmarks have the warning for me, despite taking the steps to stabilize the machine.  Encountered this extensively while working on #22284 and every time I run benchmarks to test pulls. I now use `NANOBENCH_SUPPRESS_WARNINGS` to be able to share my results without running a bench dozens of times to have a few without the warnings. ",https://github.com/bitcoin/bitcoin/pull/22999#discussion_r711035851,711035851,src/bench/nanobench.h
jonatack,2021-09-17 13:02:03,Makes sense.,https://github.com/bitcoin/bitcoin/pull/22999#discussion_r711036290,711036290,src/bench/nanobench.h
jonatack,2021-09-17 13:04:29,"Yes. I've gone through these things. In practice, what I'm seeing people doing to share and compare results in PR reviews is run a benchmark repeatedly, for which the `iters=<n>` proposal here is a handy convenience.",https://github.com/bitcoin/bitcoin/pull/22999#discussion_r711037897,711037897,src/bench/bench.cpp
