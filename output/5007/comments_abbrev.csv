domob1812,2014-09-30T10:52:30Z,"I guess this ""breaks"" `-rpcwait`.  `bitcoin-cli -rpcwait` should treat the new warmup error like a connection error.  I will modify the code accordingly.\n",https://github.com/bitcoin/bitcoin/pull/5007#issuecomment-57296421,57296421,
BitcoinPullTester,2014-09-30T12:10:55Z,"Automatic sanity-testing: FAILED BUILD/TEST, see http://jenkins.bluematt.me/pull-tester/p5007_0ba552b68d7db8aeb9280beca7f80e777f76aefb/ for binaries and test log.\n\nThis could happen for one of several reasons:\n1. It chanages paths in makefile.linux-mingw or otherwise changes build scripts in a way that made them incompatible with the automated testing scripts (please tweak those patches in qa/p",https://github.com/bitcoin/bitcoin/pull/5007#issuecomment-57303873,57303873,
jgarzik,2014-09-30T19:29:38Z,There's still a window when the code is active but the server is not.\n,https://github.com/bitcoin/bitcoin/pull/5007#issuecomment-57368785,57368785,
domob1812,2014-10-01T05:46:52Z,"That's true, but it is much shorter than before.  Do you suggest to start the server even earlier?\n",https://github.com/bitcoin/bitcoin/pull/5007#issuecomment-57421663,57421663,
laanwj,2014-10-01T06:54:35Z,You cannot go much earlier; be careful not to start the RPC server before we have the lock on the data directory.\n,https://github.com/bitcoin/bitcoin/pull/5007#issuecomment-57425785,57425785,
sipa,2014-10-02T02:10:40Z,"I remember this was suggested a (very) long time ago, and chosen not to do. I can't remember why though. Does anyone? @jgarzik @gavinandresen?\n",https://github.com/bitcoin/bitcoin/pull/5007#issuecomment-57571349,57571349,
jgarzik,2014-10-02T02:15:46Z,"@sipa It introduced various crashes, because certain RPCs expected the program to be further along in initializatoin.  It became a game of whack-a-mole to audit each RPC, perhaps gatewaying based on init progress.\n\nIn general, it starts something early, and then doesn't use it until much later.\n",https://github.com/bitcoin/bitcoin/pull/5007#issuecomment-57571792,57571792,
laanwj,2014-10-02T07:13:35Z,Indeed. Auditing all RPCs would be the wrong way to go at it. It should just disallow all RPCs until the init process is finished. Which (on a quick skim) seems to be what this pull does.\n,https://github.com/bitcoin/bitcoin/pull/5007#issuecomment-57592169,57592169,
domob1812,2014-10-02T10:21:46Z,"Yes, this patch disables all RPC until everything is initialised (at least it is intended to do that).  I've updated the patch to use a new flag `fRPCInWarmup` in addition to the string `rpcWarmupStatus`, as suggested.\n",https://github.com/bitcoin/bitcoin/pull/5007#issuecomment-57609495,57609495,
domob1812,2014-10-07T11:28:43Z,Updated to connect to `uiInterface.InitMessage` instead of updating the RPC status in parallel.\n,https://github.com/bitcoin/bitcoin/pull/5007#issuecomment-58170472,58170472,
laanwj,2014-10-08T06:57:32Z,utACK except for threading nit.\n,https://github.com/bitcoin/bitcoin/pull/5007#issuecomment-58317926,58317926,
gmaxwell,2014-10-08T08:22:36Z,"Needs to be loudly released noted, as it may break some HA schemes (e.g. pass traffic to the first bitcoind that accepts a connection).  Not something we should avoid breaking, but it should be visible.\n",https://github.com/bitcoin/bitcoin/pull/5007#issuecomment-58325290,58325290,
laanwj,2014-10-08T08:37:09Z,"Agreed @gmaxwell, we need to announce it in the release notes as it breaks some expectations that clients may make at the moment. Luckily this is something that is extremely apparent (every RPC call failing), I don't expect it to introduce sneaky problems.\n",https://github.com/bitcoin/bitcoin/pull/5007#issuecomment-58326740,58326740,
domob1812,2014-10-08T11:12:49Z,"Done, thanks for the hint!  (Since the status was only ever set from `false` to `true`, I thought it wasn't too critical - but it is better this way, of course.  Also not sure about whether the `std::string` could cause problems if not synchronised.)\n\nIf the patch is accepted, I will squash the commits properly.\n",https://github.com/bitcoin/bitcoin/pull/5007#issuecomment-58342591,58342591,
laanwj,2014-10-09T12:27:43Z,"Works for me. Tested ACK.\n\n@domob1812 mind adding a short piece in doc/release-notes.md telling people about this RPC warmup mode, and how this change can affect them? (can be based on the OP here)\n",https://github.com/bitcoin/bitcoin/pull/5007#issuecomment-58501602,58501602,
domob1812,2014-10-10T08:02:59Z,"Done.  Is the formulation fine or should I extend/shorten it in any way?\n\nLet me know when the patch has a ""final ACK"" - I will then rebase and squash it.\n",https://github.com/bitcoin/bitcoin/pull/5007#issuecomment-58624288,58624288,
laanwj,2014-10-22T14:59:10Z,The release notes look good to me\n\nI'd like to see at least one other ACK before merging.\n,https://github.com/bitcoin/bitcoin/pull/5007#issuecomment-60098335,60098335,
gavinandresen,2014-10-28T18:15:02Z,"utACK, but needs rebase.\n",https://github.com/bitcoin/bitcoin/pull/5007#issuecomment-60804142,60804142,
domob1812,2014-10-28T20:09:19Z,Rebased and squashed the commits.\n,https://github.com/bitcoin/bitcoin/pull/5007#issuecomment-60822660,60822660,
domob1812,2014-10-29T17:12:32Z,Fixed the typo.\n,https://github.com/bitcoin/bitcoin/pull/5007#issuecomment-60964507,60964507,
sipa,2014-11-04T14:07:58Z,Needs rebase.\n,https://github.com/bitcoin/bitcoin/pull/5007#issuecomment-61643735,61643735,
domob1812,2014-11-04T15:13:12Z,Done.\n,https://github.com/bitcoin/bitcoin/pull/5007#issuecomment-61654038,61654038,
laanwj,2014-10-02T07:14:21Z,"Please don't double-use a `const char*` as a flag. Add another boolean (for ex.) `fRPCInWarmup`.\n\nNit2: also better to use a std::string, so that it's possible to pass dynamic messages if necessary (for example if progress is to be reported at some point).\n",https://github.com/bitcoin/bitcoin/pull/5007#discussion_r18325003,18325003,src/rpcserver.cpp
laanwj,2014-10-02T10:43:24Z,I see a duplication here; you could subscribe SetRPCWarmupStatus to uiInterface.InitMessage signals and avoid it.\n,https://github.com/bitcoin/bitcoin/pull/5007#discussion_r18332269,18332269,src/init.cpp
domob1812,2014-10-02T10:46:12Z,I thought about that and decided not to do it (at least for the first proposal) because the init message is translated and the RPC status message (if it is kept generic) might be interpreted by clients in other ways than just presenting it to a user literally.  (Think:  RPC is an interface for machines not (only) humans.)  But I'm definitely open to changing that if you think it is better to reuse,https://github.com/bitcoin/bitcoin/pull/5007#discussion_r18332353,18332353,src/init.cpp
laanwj,2014-10-02T11:23:12Z,"Yes I do think it is better to do it that way. The translation is a bit of a red herring - for bitcoind _() is a no-op. But in general If you intend this to be machine-readable, you need a status byte/word. A message can be changed at any time and should not be used as stable interface.\n\nEdit: IE, I mean passing an `enum InitStage` as well as the message to `InitMessage` and exposing that on the",https://github.com/bitcoin/bitcoin/pull/5007#discussion_r18333444,18333444,src/init.cpp
laanwj,2014-10-02T11:34:08Z,BTW: You could also give more detailed progress reporting by hooking uiInterface.ShowProgress.\n,https://github.com/bitcoin/bitcoin/pull/5007#discussion_r18333726,18333726,src/init.cpp
laanwj,2014-10-08T06:56:34Z,"You'll have to protect these with a mutex (CCriticalSection), as setting and reading them is done from different threads.\n",https://github.com/bitcoin/bitcoin/pull/5007#discussion_r18566456,18566456,src/rpcserver.cpp
Diapolo,2014-10-08T11:16:49Z,Nit: Can you make this look like (indentation is wrong):\n\n<pre>\nexplicit inline CConnectionFailed(const std::string& msg) :\n    std::runtime_error(msg)\n{}\n</pre>\n,https://github.com/bitcoin/bitcoin/pull/5007#discussion_r18575594,18575594,src/bitcoin-cli.cpp
Diapolo,2014-10-08T11:20:03Z,Nit: Can you remove the space after the assert please.\n,https://github.com/bitcoin/bitcoin/pull/5007#discussion_r18575694,18575694,src/rpcserver.cpp
domob1812,2014-10-08T11:39:32Z,Ah yes.  I usually use a different formatting style (which I honestly like better) but tried to adapt to Bitcoin's.  It seems I missed some pieces.  I'll correct them.\n,https://github.com/bitcoin/bitcoin/pull/5007#discussion_r18576310,18576310,src/rpcserver.cpp
Diapolo,2014-10-08T11:43:06Z,"Great, thank you :).\n",https://github.com/bitcoin/bitcoin/pull/5007#discussion_r18576453,18576453,src/rpcserver.cpp
laanwj,2014-10-29T11:15:36Z,"btw I'm not native English but is 'modus' the correct word to use here, not 'mode'?\n",https://github.com/bitcoin/bitcoin/pull/5007#discussion_r19531095,19531095,src/init.cpp
domob1812,2014-10-29T11:30:08Z,"Neither am I, but I think you are right.  If noone has any other suggestions, I'll change it accordingly.\n",https://github.com/bitcoin/bitcoin/pull/5007#discussion_r19531667,19531667,src/init.cpp
