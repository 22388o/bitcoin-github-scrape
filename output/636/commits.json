[
  {
    "sha": "8d0923109deb1d6c92c5f56fe660b2594b67297d",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4ZDA5MjMxMDlkZWIxZDZjOTJjNWY1NmZlNjYwYjI1OTRiNjcyOTdk",
    "commit": {
      "author": {
        "name": "Gavin Andresen",
        "email": "gavinandresen@gmail.com",
        "date": "2011-11-15T19:30:15Z"
      },
      "committer": {
        "name": "Gavin Andresen",
        "email": "gavinandresen@gmail.com",
        "date": "2011-11-15T19:30:24Z"
      },
      "message": "Fix crash-on-osx-on-shutdown bug. And cleanup CDB handling in Rewrite.",
      "tree": {
        "sha": "3071e823f9d19d4fd08ca969ea4fc6be01ba37b2",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3071e823f9d19d4fd08ca969ea4fc6be01ba37b2"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8d0923109deb1d6c92c5f56fe660b2594b67297d",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8d0923109deb1d6c92c5f56fe660b2594b67297d",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/8d0923109deb1d6c92c5f56fe660b2594b67297d",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8d0923109deb1d6c92c5f56fe660b2594b67297d/comments",
    "author": {
      "login": "gavinandresen",
      "id": 331997,
      "node_id": "MDQ6VXNlcjMzMTk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/331997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gavinandresen",
      "html_url": "https://github.com/gavinandresen",
      "followers_url": "https://api.github.com/users/gavinandresen/followers",
      "following_url": "https://api.github.com/users/gavinandresen/following{/other_user}",
      "gists_url": "https://api.github.com/users/gavinandresen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gavinandresen/subscriptions",
      "organizations_url": "https://api.github.com/users/gavinandresen/orgs",
      "repos_url": "https://api.github.com/users/gavinandresen/repos",
      "events_url": "https://api.github.com/users/gavinandresen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gavinandresen/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "gavinandresen",
      "id": 331997,
      "node_id": "MDQ6VXNlcjMzMTk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/331997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gavinandresen",
      "html_url": "https://github.com/gavinandresen",
      "followers_url": "https://api.github.com/users/gavinandresen/followers",
      "following_url": "https://api.github.com/users/gavinandresen/following{/other_user}",
      "gists_url": "https://api.github.com/users/gavinandresen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gavinandresen/subscriptions",
      "organizations_url": "https://api.github.com/users/gavinandresen/orgs",
      "repos_url": "https://api.github.com/users/gavinandresen/repos",
      "events_url": "https://api.github.com/users/gavinandresen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gavinandresen/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "709c1b267fcf4992ede95e7aff3ed333c068dfa5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/709c1b267fcf4992ede95e7aff3ed333c068dfa5",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/709c1b267fcf4992ede95e7aff3ed333c068dfa5"
      }
    ],
    "stats": {
      "total": 19,
      "additions": 13,
      "deletions": 6
    },
    "files": [
      {
        "sha": "643ed1f7a73fc176f4de34c8c2f5f366d5a2c041",
        "filename": "src/db.cpp",
        "status": "modified",
        "additions": 13,
        "deletions": 6,
        "changes": 19,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/8d0923109deb1d6c92c5f56fe660b2594b67297d/src/db.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/8d0923109deb1d6c92c5f56fe660b2594b67297d/src/db.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/db.cpp?ref=8d0923109deb1d6c92c5f56fe660b2594b67297d",
        "patch": "@@ -34,7 +34,14 @@ static void EnvShutdown(bool fRemoveLogFiles)\n         return;\n \n     fDbEnvInit = false;\n-    dbenv.close(0);\n+    try\n+    {\n+        dbenv.close(0);\n+    }\n+    catch (const DbException& e)\n+    {\n+        printf(\"EnvShutdown exception: %s (%d)\\n\", e.what(), e.get_errno());\n+    }\n     DbEnv(0).remove(GetDataDir().c_str(), 0);\n \n     if (fRemoveLogFiles)\n@@ -229,7 +236,10 @@ bool CDB::Rewrite(const string& strFile, const char* pszSkip)\n                         CDataStream ssValue;\n                         int ret = db.ReadAtCursor(pcursor, ssKey, ssValue, DB_NEXT);\n                         if (ret == DB_NOTFOUND)\n+                        {\n+                            pcursor->close();\n                             break;\n+                        }\n                         else if (ret != 0)\n                         {\n                             pcursor->close();\n@@ -253,14 +263,11 @@ bool CDB::Rewrite(const string& strFile, const char* pszSkip)\n                     }\n                 if (fSuccess)\n                 {\n-                    Db* pdb = mapDb[strFile];\n-                    if (pdb->close(0))\n-                        fSuccess = false;\n+                    db.Close();\n+                    CloseDb(strFile);\n                     if (pdbCopy->close(0))\n                         fSuccess = false;\n-                    delete pdb;\n                     delete pdbCopy;\n-                    mapDb[strFile] = NULL;\n                 }\n                 if (fSuccess)\n                 {"
      }
    ]
  },
  {
    "sha": "c4de918478dbcf72a9f76b27435bd1d892e1e339",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpjNGRlOTE4NDc4ZGJjZjcyYTlmNzZiMjc0MzViZDFkODkyZTFlMzM5",
    "commit": {
      "author": {
        "name": "Gavin Andresen",
        "email": "gavinandresen@gmail.com",
        "date": "2011-11-15T19:28:51Z"
      },
      "committer": {
        "name": "Gavin Andresen",
        "email": "gavinandresen@gmail.com",
        "date": "2011-11-15T19:30:24Z"
      },
      "message": "Tweak handling of boost filesystem versions",
      "tree": {
        "sha": "c9d7ad5fc70eac52351d22048f135c1169a8219d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c9d7ad5fc70eac52351d22048f135c1169a8219d"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c4de918478dbcf72a9f76b27435bd1d892e1e339",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c4de918478dbcf72a9f76b27435bd1d892e1e339",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/c4de918478dbcf72a9f76b27435bd1d892e1e339",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c4de918478dbcf72a9f76b27435bd1d892e1e339/comments",
    "author": {
      "login": "gavinandresen",
      "id": 331997,
      "node_id": "MDQ6VXNlcjMzMTk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/331997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gavinandresen",
      "html_url": "https://github.com/gavinandresen",
      "followers_url": "https://api.github.com/users/gavinandresen/followers",
      "following_url": "https://api.github.com/users/gavinandresen/following{/other_user}",
      "gists_url": "https://api.github.com/users/gavinandresen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gavinandresen/subscriptions",
      "organizations_url": "https://api.github.com/users/gavinandresen/orgs",
      "repos_url": "https://api.github.com/users/gavinandresen/repos",
      "events_url": "https://api.github.com/users/gavinandresen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gavinandresen/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "gavinandresen",
      "id": 331997,
      "node_id": "MDQ6VXNlcjMzMTk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/331997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gavinandresen",
      "html_url": "https://github.com/gavinandresen",
      "followers_url": "https://api.github.com/users/gavinandresen/followers",
      "following_url": "https://api.github.com/users/gavinandresen/following{/other_user}",
      "gists_url": "https://api.github.com/users/gavinandresen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gavinandresen/subscriptions",
      "organizations_url": "https://api.github.com/users/gavinandresen/orgs",
      "repos_url": "https://api.github.com/users/gavinandresen/repos",
      "events_url": "https://api.github.com/users/gavinandresen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gavinandresen/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "8d0923109deb1d6c92c5f56fe660b2594b67297d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8d0923109deb1d6c92c5f56fe660b2594b67297d",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/8d0923109deb1d6c92c5f56fe660b2594b67297d"
      }
    ],
    "stats": {
      "total": 4,
      "additions": 2,
      "deletions": 2
    },
    "files": [
      {
        "sha": "e7adabe7561e40066865ab4a64e3e67884c5e15b",
        "filename": "bitcoin-qt.pro",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c4de918478dbcf72a9f76b27435bd1d892e1e339/bitcoin-qt.pro",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c4de918478dbcf72a9f76b27435bd1d892e1e339/bitcoin-qt.pro",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/bitcoin-qt.pro?ref=c4de918478dbcf72a9f76b27435bd1d892e1e339",
        "patch": "@@ -256,7 +256,7 @@ windows:RC_FILE = src/qt/res/bitcoin-qt.rc\n macx:HEADERS += src/qt/macdockiconhandler.h\n macx:OBJECTIVE_SOURCES += src/qt/macdockiconhandler.mm\n macx:LIBS += -framework Foundation -framework ApplicationServices -framework AppKit\n-macx:DEFINES += MAC_OSX MSG_NOSIGNAL=0 BOOST_FILESYSTEM_VERSION=3\n+macx:DEFINES += MAC_OSX MSG_NOSIGNAL=0\n macx:ICON = src/qt/res/icons/bitcoin.icns\n macx:TARGET = \"Bitcoin-Qt\"\n "
      },
      {
        "sha": "efd2a375efd92cf0020d5f7fb6f4a4b7491cef3b",
        "filename": "src/db.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c4de918478dbcf72a9f76b27435bd1d892e1e339/src/db.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c4de918478dbcf72a9f76b27435bd1d892e1e339/src/db.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/db.cpp?ref=c4de918478dbcf72a9f76b27435bd1d892e1e339",
        "patch": "@@ -51,7 +51,7 @@ static void EnvShutdown(bool fRemoveLogFiles)\n         while (it != filesystem::directory_iterator())\n         {\n             const filesystem::path& p = it->path();\n-#if BOOST_FILESYSTEM_VERSION == 3\n+#if BOOST_FILESYSTEM_VERSION >= 3\n             std::string f = p.filename().generic_string();\n #else\n             std::string f = p.filename();"
      }
    ]
  }
]