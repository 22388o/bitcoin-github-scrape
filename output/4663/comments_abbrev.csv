theuni,2014-08-08T19:05:04Z,"Grr, build failures are due to pull-tester's ancient boost.\nSee https://svn.boost.org/trac/boost/ticket/2309\n\nChanged it to be disabled by default.\n",https://github.com/bitcoin/bitcoin/pull/4663#issuecomment-51644524,51644524,
BitcoinPullTester,2014-08-08T19:17:21Z,"Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/p4663_938371c2805d3a3090faf416703e1cf942e77b29/ for binaries and test log.\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.log is moving at http://jenkins.bluematt.me/pull-te",https://github.com/bitcoin/bitcoin/pull/4663#issuecomment-51645811,51645811,
gmaxwell,2014-08-10T00:49:59Z,"Why don't we do this by default?  Tagging exported functions is not a ton of work, and making it a default would avoid increasing the number of configurations which are not heavily tested.\n",https://github.com/bitcoin/bitcoin/pull/4663#issuecomment-51702740,51702740,
sipa,2014-08-10T07:30:30Z,The default was set to false because ancient Boost (used by pulltester)\nfails with default visibility=hidden.\n,https://github.com/bitcoin/bitcoin/pull/4663#issuecomment-51708425,51708425,
theuni,2014-08-11T01:23:53Z,"Right, the issue is that if an exception is thrown across a dso boundary, the receiver's symbol must be exported in order to catch it. In practice, due to the boost bug, that'd mean that we have to export all functions that may need to catch a boost exception. Imo that's not reasonable, especially since it's due to a faulty lib.\n\nThis wouldn't affect any of our final releases, though, as they're",https://github.com/bitcoin/bitcoin/pull/4663#issuecomment-51734216,51734216,
theuni,2014-08-11T01:25:35Z,s/export/specify default visibility/\n,https://github.com/bitcoin/bitcoin/pull/4663#issuecomment-51734287,51734287,
gmaxwell,2014-08-11T01:47:35Z,"Well we could make it a default and just use a flag to switch it off where it doesn't work. It could also autodetect that its going to fail (E.g. with an autotools compile and link test).  I am generally apposed to using autotools autodetection in ways that change user (/caller) visible functionality, but leaking private symbols is not 'functionality'. :)   The only harm I see with this is that we",https://github.com/bitcoin/bitcoin/pull/4663#issuecomment-51735184,51735184,
theuni,2014-08-11T03:01:38Z,"@gmaxwell It's ugly, but I could get on board with that. I'm not sure a link test would be enough though, I think we'd actually have to dump the resulting symbols and verify (as opposed to a try_run which would break on cross). If that's the case, it may end up being more reasonable to just use a version test.\n\nI'll give it a shot.\n",https://github.com/bitcoin/bitcoin/pull/4663#issuecomment-51738015,51738015,
theuni,2014-08-11T03:19:51Z,"Using a doctored recent boost to test, I think I've come up with a link-test using a phony intermediary shared lib. I'll push it up tomorrow after playing some more.\n",https://github.com/bitcoin/bitcoin/pull/4663#issuecomment-51738665,51738665,
theuni,2014-08-15T21:45:25Z,"As discussed with @gmaxwell on IRC. Unfortunately, there's just no way to reliably test for broken boost visibility. Instead, I've added a check to disable reducing exports if boost is < 1.49. It's not pretty, but gets the job done.\n\nSo now reduce-exports is back to being enabled by default, and disabled if any of the criteria aren't met.\n\nAlso, added a check for default visibility attribute, ",https://github.com/bitcoin/bitcoin/pull/4663#issuecomment-52361306,52361306,
laanwj,2014-08-16T08:50:46Z,"Looks good to me.\n\nThough the reason that I used a linker script in the gitian build instead of these switches is that even with `-fvisibility=hidden` and `-Wl,--exclude-libs,ALL` some symbols exports 'leaked' out of the executable.\nSo without verification I'm not convinced that this can replace it.\n\nIt could be verified by running `contrib/devtools/symbol-check.py` on the gitian executables ",https://github.com/bitcoin/bitcoin/pull/4663#issuecomment-52387855,52387855,
theuni,2014-08-16T19:19:23Z,"Yea, works as intended. Full output is:\n\n```\nbin/test_bitcoin: symbol clock_gettime from unsupported version GLIBC_2.17\nbin/bitcoin-qt: export of symbol _edata not allowed\nbin/bitcoin-qt: export of symbol _end not allowed\nbin/bitcoin-qt: export of symbol _init not allowed\nbin/bitcoin-qt: export of symbol __bss_start not allowed\nbin/bitcoin-qt: export of symbol _fini not allowed\nbin/bitcoi",https://github.com/bitcoin/bitcoin/pull/4663#issuecomment-52403161,52403161,
theuni,2014-08-16T20:25:56Z,"The clock_gettime actually comes in from my system since it's a newer glibc (that dump above is from my dev env using our depends, not from gitian). Gitian's glibc is 2.15, so that's actually not a problem until we move gitian to trusty.\n\nI haven't tested with gitian, but it will work exactly the same as above once we start using the new depends. I guess there's no reason to hold off on that now",https://github.com/bitcoin/bitcoin/pull/4663#issuecomment-52404852,52404852,
theuni,2014-08-17T02:39:53Z,"@laanwj Ok, I gave it a go on gitian, and got (presumably) the same results as you. I dug around for a bit and it looks like precise’s default linker (bfd) has busted support for “—exclude-libs ALL”. Most distros these days have switched to gold anyway. I installed that and it worked as it should’ve.\n\nSo basically, all is good if you add “binutils-gold” to the packages list in the descriptor. I’",https://github.com/bitcoin/bitcoin/pull/4663#issuecomment-52411945,52411945,
laanwj,2014-08-17T06:26:51Z,"@theuni Thanks for checking. Agreed - the base symbols such as _edata, _end, _init, __bss_start, and _fini could be ignored by the checker. There's no harm in exporting them, and requiring them to be filtered too is just undue maintenance work.\n",https://github.com/bitcoin/bitcoin/pull/4663#issuecomment-52414771,52414771,
theuni,2014-08-17T16:26:35Z,"Thanks. I'm prepared for a few reports of build problems after this (not sure what, but something's bound to come up). If so, I'll try to get 'em worked out asap.\n",https://github.com/bitcoin/bitcoin/pull/4663#issuecomment-52427026,52427026,
laanwj,2014-08-18T11:50:25Z,@theuni OOPS - seems the pulltester is failing now\nhttp://jenkins.bluematt.me/pull-tester/p4718_88fe88cf3640caede5222380383d0816a42a73b7/test.log\nAnd I notice that it's compiling with `-fvisibility=hidden`.\nMaybe the boost check isn't working :(\n,https://github.com/bitcoin/bitcoin/pull/4663#issuecomment-52481994,52481994,
