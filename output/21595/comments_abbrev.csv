DrahtBot,2021-04-04 17:05:09,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #21158 (lib: Add Taproot support to libconsensus by jrawsthorne)\n\nIf you consider this pull request important, please al",https://github.com/bitcoin/bitcoin/pull/21595#issuecomment-813066028,813066028,
practicalswift,2021-04-04 21:29:58,Concept ACK: nice! :),https://github.com/bitcoin/bitcoin/pull/21595#issuecomment-813102291,813102291,
jonatack,2021-04-05 11:10:12,"Thanks!\n\n> Question: Why make this a CLI command and not an RPC command? Seems useful as an RPC command.\n\nIt could, or a third path could be to add a boolean `totals` arg to the `getnodeaddresses` RPC to toggle a ""totals mode"" (that said, it might be a bit obscure/hard to discover).\n\nGenerally, CLI commands batch or wrap one or multiple RPC commands and are easier to change and improve",https://github.com/bitcoin/bitcoin/pull/21595#issuecomment-813342416,813342416,
jonatack,2021-04-05 11:13:40,"Not sure, but it's maybe more flexible to start life as a CLI and then become an RPC if there's a good reason, than vice-versa.",https://github.com/bitcoin/bitcoin/pull/21595#issuecomment-813343583,813343583,
laanwj,2021-04-05 12:25:29,"Concept ACK\n\n> Question: Why make this a CLI command and not an RPC command? Seems useful as an RPC command.\n\nMinimalism. I think it's a good choice to put functionality in the client that can be done client-side. Adding things server-side adds maintenance burden, means having to commit to a certain (machine parseable) interface, etc. And this is clearly functionality aimed at end users. A",https://github.com/bitcoin/bitcoin/pull/21595#issuecomment-813367693,813367693,
jarolrod,2021-04-05 17:37:14,"@laanwj @jonatack Thanks for answering my question. Maybe this information, when a command should be a CLI or RPC command, should be added to the [developer-notes](https://github.com/bitcoin/bitcoin/blob/master/doc/developer-notes.md#rpc-interface-guidelines). ",https://github.com/bitcoin/bitcoin/pull/21595#issuecomment-813526176,813526176,
jonatack,2021-04-07 10:41:55,"> I would be in favor of implementing this on the server so we get it right for all clients, GUI included.\n \nThe GUI is a good point, and performance could also be better (not sure if it would be noticeable) as an RPC.\n\n> I'm also not fond of the name `-addressinfo` as it looks like something specific to an address only, I would name it `-nodestats` or something like that.\n\nI proposed ",https://github.com/bitcoin/bitcoin/pull/21595#issuecomment-814808014,814808014,
jonatack,2021-04-07 10:43:41,"Note to self: as a CLI this needs a server version check like the one in `-netinfo` to gracefully raise if the server is earlier than v22, due to this depending on the network field in `getnodeaddresses`.",https://github.com/bitcoin/bitcoin/pull/21595#issuecomment-814808970,814808970,
jonatack,2021-04-08 16:34:14,"- Rebased following the merge of #21594\n- Took review feedback where applicable\n- Re ""-nodestats"", I couldn't get command names beginning with ""-node"" to work (e.g. `-nodestats`, `-nodeinfo`); it compiles, but when run: ""Error parsing command line arguments: Invalid parameter -nodestats""...not sure why. OTOH, `-peerstats` does work.\n- Shortened the command from `-addressinfo` to `-addrinfo`,",https://github.com/bitcoin/bitcoin/pull/21595#issuecomment-815970020,815970020,
jonatack,2021-04-12 19:47:31,"Good find! I agree this isn't great, will look at fixing.",https://github.com/bitcoin/bitcoin/pull/21595#issuecomment-818092764,818092764,
jonatack,2021-04-12 20:17:59,"Thanks again for finding that @jarolrod. Fixed in the last commit per `git diff c0986af edf3167`. Much better.\n\n```diff\n@@ -256,6 +256,7 @@ public:\n \n     UniValue ProcessReply(const UniValue& reply) override\n     {\n+        if (!reply[""error""].isNull()) return reply;\n         const std::vector<UniValue>& nodes{reply[""result""].getValues()};\n```\n```\n$ bitcoin-cli -addrinfo\ne",https://github.com/bitcoin/bitcoin/pull/21595#issuecomment-818156765,818156765,
laanwj,2021-04-12 20:18:49,"> I would be in favor of implementing this on the server so we get it right for all clients, GUI included.\n\nI'm not 100% convinced this is worth adding server side. Also not against it, but I don't think we should add a lot of ""would be nice"" RPC commands. Yes, doing it client side is slower but how often are you going to call this ?\n\nAs for the GUI I wonder if we can share some things bet",https://github.com/bitcoin/bitcoin/pull/21595#issuecomment-818158465,818158465,
jonatack,2021-04-12 20:46:43,"Right, and the fields returned here will probably change...more BIP155 networks may be on the way...and we may want to replace ""torv2"" and ""torv3"" with ""onion"" a year from now, IDK...adding fields is easier than removing or reorganizing them, but we'll have more flexibility to do needed updates as a CLI.",https://github.com/bitcoin/bitcoin/pull/21595#issuecomment-818216239,818216239,
jonatack,2021-04-13 14:33:08,"I'm at **2842** torv3 peers known now, up from ~1800 ten days ago and still finding more...good to see.\n```\n{\n  ""addresses_known"": {\n    ""ipv4"": 14398,\n    ""ipv6"": 2509,\n    ""torv2"": 5561,\n    ""torv3"": 2842,\n    ""i2p"": 8,\n    ""total"": 25318\n  }\n}\n```\n",https://github.com/bitcoin/bitcoin/pull/21595#issuecomment-818784935,818784935,
jonatack,2021-04-13 14:35:31,And one more i2p peer as well!,https://github.com/bitcoin/bitcoin/pull/21595#issuecomment-818786751,818786751,
laanwj,2021-04-20 11:51:10,"Tested ACK 06c43201a714b0426cc68b2fd5c681e5df10af99\n```javascript\n% cli -addrinfo\n{\n  ""addresses_known"": {\n    ""ipv4"": 52404,\n    ""ipv6"": 10827,\n    ""torv2"": 4987,\n    ""torv3"": 94,\n    ""i2p"": 5,\n    ""total"": 68317\n  }\n}\n```\n",https://github.com/bitcoin/bitcoin/pull/21595#issuecomment-823210810,823210810,
promag,2021-04-07 08:17:26,"57eb71ce0f27c0353ea0742a696c6d04ce048e15\n\nIMO avoid spaces in keys.",https://github.com/bitcoin/bitcoin/pull/21595#discussion_r608439638,608439638,src/bitcoin-cli.cpp
promag,2021-04-07 08:21:28,"57eb71ce0f27c0353ea0742a696c6d04ce048e15\n\nNo need to have `m_networks` and `m_total` as members.",https://github.com/bitcoin/bitcoin/pull/21595#discussion_r608442632,608442632,src/bitcoin-cli.cpp
promag,2021-04-07 08:22:53,"57eb71ce0f27c0353ea0742a696c6d04ce048e15\n\nDrop, and use `m_networks` size?",https://github.com/bitcoin/bitcoin/pull/21595#discussion_r608443683,608443683,src/bitcoin-cli.cpp
promag,2021-04-07 08:24:31,"57eb71ce0f27c0353ea0742a696c6d04ce048e15\n\nI think you can omit template arguments, see https://stackoverflow.com/a/61371266/1978589.",https://github.com/bitcoin/bitcoin/pull/21595#discussion_r608444785,608444785,src/bitcoin-cli.cpp
jonatack,2021-04-07 10:34:08,"Thanks, will give it a try in the next push.",https://github.com/bitcoin/bitcoin/pull/21595#discussion_r608535653,608535653,src/bitcoin-cli.cpp
jonatack,2021-04-07 10:36:55,"Good point, will snakecase it if this remains in JSON format. I wonder if it should drop the JSON format (like `-netinfo`) for the client side. ",https://github.com/bitcoin/bitcoin/pull/21595#discussion_r608537421,608537421,src/bitcoin-cli.cpp
jonatack,2021-04-08 16:21:05,done,https://github.com/bitcoin/bitcoin/pull/21595#discussion_r609874577,609874577,src/bitcoin-cli.cpp
jonatack,2021-04-08 16:23:04,Changed `m_counts` and `m_total` to be local variables instead (`counts` and `total`). ,https://github.com/bitcoin/bitcoin/pull/21595#discussion_r609876337,609876337,src/bitcoin-cli.cpp
jonatack,2021-04-08 16:23:39,Couldn't get that to compile (clang 11).,https://github.com/bitcoin/bitcoin/pull/21595#discussion_r609876937,609876937,src/bitcoin-cli.cpp
jonatack,2021-04-08 16:40:24,I would if could omit the template arguments.,https://github.com/bitcoin/bitcoin/pull/21595#discussion_r609892324,609892324,src/bitcoin-cli.cpp
promag,2021-04-19 23:57:18,"Does the following work?\n```cpp\nstatic constexpr std::array m_networks{""ipv4"", ""ipv6"", ""torv2"", ""torv3"", ""i2p""};\n```",https://github.com/bitcoin/bitcoin/pull/21595#discussion_r616251674,616251674,src/bitcoin-cli.cpp
jonatack,2021-04-20 08:40:44,"Thanks! I think I hadn't dropped the type specifier, only the size arg. Took your suggestions and updated the file in 06c43201a714b0426cc68b2fd5c681e5df10af99.",https://github.com/bitcoin/bitcoin/pull/21595#discussion_r616472982,616472982,src/bitcoin-cli.cpp
promag,2021-04-20 09:59:33,Cool üëç ,https://github.com/bitcoin/bitcoin/pull/21595#discussion_r616533600,616533600,src/bitcoin-cli.cpp
