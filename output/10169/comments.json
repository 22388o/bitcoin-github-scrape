[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/294967889",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10169#issuecomment-294967889",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10169",
    "id": 294967889,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5NDk2Nzg4OQ==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-18T20:18:00Z",
    "updated_at": "2017-04-18T20:18:00Z",
    "author_association": "MEMBER",
    "body": "Thanks for the excellent review @jimmysong . I've responded to most of your points. I'm just running the extended test suite locally before pushing up to github.\r\n\r\nI've decided to remove the `sync()` method from NodeConnCB entirely for now, since it's just duplicating the functionality of `wait_until()` and doesn't actually need to be a method. I'm still not entirely happy with `wait_until()`, but I think it's better to not duplicate code for no good reason in this PR.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/294967889/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/294972967",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10169#issuecomment-294972967",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10169",
    "id": 294972967,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5NDk3Mjk2Nw==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-18T20:34:09Z",
    "updated_at": "2017-04-18T20:34:09Z",
    "author_association": "MEMBER",
    "body": "rebased, review comments addressed and pushed",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/294972967/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/294992812",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10169#issuecomment-294992812",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10169",
    "id": 294992812,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5NDk5MjgxMg==",
    "user": {
      "login": "jimmysong",
      "id": 524761,
      "node_id": "MDQ6VXNlcjUyNDc2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/524761?u=3ee7561b631dfa6e8e465ad9a556bec78cfc84e8&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimmysong",
      "html_url": "https://github.com/jimmysong",
      "followers_url": "https://api.github.com/users/jimmysong/followers",
      "following_url": "https://api.github.com/users/jimmysong/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimmysong/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimmysong/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimmysong/subscriptions",
      "organizations_url": "https://api.github.com/users/jimmysong/orgs",
      "repos_url": "https://api.github.com/users/jimmysong/repos",
      "events_url": "https://api.github.com/users/jimmysong/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimmysong/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-18T21:45:18Z",
    "updated_at": "2017-04-18T21:45:18Z",
    "author_association": "CONTRIBUTOR",
    "body": "ACK 2a52ae63bfdde948250df1c876dcdd5af99f03b5",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/294992812/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111800001",
    "pull_request_review_id": 33066718,
    "id": 111800001,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMTgwMDAwMQ==",
    "diff_hunk": "@@ -1548,44 +1579,69 @@ def on_version(self, conn, message):\n             conn.ver_recv = conn.ver_send\n         conn.nServices = message.nServices\n \n-    # Helper functions\n-    ##################\n+    # Connection helper methods\n \n     def add_connection(self, conn):\n         self.connection = conn\n \n-    # Wrapper for the NodeConn's send_message function\n+    def wait_for_disconnect(self, timeout=60):\n+        test_function = lambda: not self.connected\n+        assert wait_until(test_function, timeout=timeout)\n+\n+    # Message receiving helper methods\n+\n+    def sync(self, test_function, timeout=60):",
    "path": "test/functional/test_framework/mininode.py",
    "position": null,
    "original_position": 160,
    "commit_id": "2a52ae63bfdde948250df1c876dcdd5af99f03b5",
    "original_commit_id": "e74cf5028bbe6bc7fe520647860590f855eb8b3e",
    "user": {
      "login": "jimmysong",
      "id": 524761,
      "node_id": "MDQ6VXNlcjUyNDc2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/524761?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimmysong",
      "html_url": "https://github.com/jimmysong",
      "followers_url": "https://api.github.com/users/jimmysong/followers",
      "following_url": "https://api.github.com/users/jimmysong/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimmysong/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimmysong/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimmysong/subscriptions",
      "organizations_url": "https://api.github.com/users/jimmysong/orgs",
      "repos_url": "https://api.github.com/users/jimmysong/repos",
      "events_url": "https://api.github.com/users/jimmysong/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimmysong/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This function seems to duplicate a lot of what `wait_until` above does. Maybe it makes sense to do something like:\r\n\r\n    def sync(self, test_function, timeout=60):\r\n        if not wait_until(test_function, timeout=timeout):\r\n            AssertionError(\"Sync failed to complete\")\r\n",
    "created_at": "2017-04-17T19:11:47Z",
    "updated_at": "2017-04-18T21:20:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r111800001",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111800001"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r111800001"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111800001/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1593,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111801053",
    "pull_request_review_id": 33066718,
    "id": 111801053,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMTgwMTA1Mw==",
    "diff_hunk": "@@ -1548,44 +1579,69 @@ def on_version(self, conn, message):\n             conn.ver_recv = conn.ver_send\n         conn.nServices = message.nServices\n \n-    # Helper functions\n-    ##################\n+    # Connection helper methods\n \n     def add_connection(self, conn):\n         self.connection = conn\n \n-    # Wrapper for the NodeConn's send_message function\n+    def wait_for_disconnect(self, timeout=60):\n+        test_function = lambda: not self.connected\n+        assert wait_until(test_function, timeout=timeout)\n+\n+    # Message receiving helper methods\n+\n+    def sync(self, test_function, timeout=60):\n+        while timeout > 0:\n+            with mininode_lock:\n+                if test_function():\n+                    return\n+            time.sleep(0.05)\n+            timeout -= 0.05\n+        raise AssertionError(\"Sync failed to complete\")\n+\n+    def wait_for_block(self, blockhash, timeout=60):\n+        test_function = lambda: self.last_message.get(\"block\") and self.last_message[\"block\"].block.rehash() == blockhash\n+        self.sync(test_function, timeout)\n+\n+    def wait_for_getdata(self, timeout=60):\n+        test_function = lambda: self.last_message.get(\"getdata\")\n+        self.sync(test_function, timeout)\n+\n+    def wait_for_getheaders(self, timeout=60):\n+        test_function = lambda: self.last_message.get(\"getheaders\")\n+        self.sync(test_function, timeout)\n+\n+    def wait_for_inv(self, expected_inv, timeout=60):\n+        test_function = lambda: self.last_message.get(\"inv\") and self.last_message[\"inv\"] != expected_inv\n+        self.sync(test_function, timeout)\n+\n+    def wait_for_verack(self, timeout=60):\n+        test_function = lambda: self.message_count[\"verack\"]\n+        self.sync(test_function, timeout)\n+\n+    # Message sending helper functions\n+\n     def send_message(self, message):\n-        self.connection.send_message(message)\n+        if self.connection:\n+            self.connection.send_message(message)\n+        else:\n+            logger.error(\"Cannot send message. No connection to node!\")\n \n     def send_and_ping(self, message):\n         self.send_message(message)\n         self.sync_with_ping()\n \n     # Sync up with the node\n     def sync_with_ping(self, timeout=60):\n-        def received_pong():\n-            return (self.last_pong.nonce == self.ping_counter)\n         self.send_message(msg_ping(nonce=self.ping_counter))\n-        success = wait_until(received_pong, timeout=timeout)\n+        test_function = lambda: self.last_message.get(\"pong\") and self.last_message[\"pong\"].nonce == self.ping_counter\n+        success = wait_until(test_function, timeout = timeout)",
    "path": "test/functional/test_framework/mininode.py",
    "position": null,
    "original_position": 209,
    "commit_id": "2a52ae63bfdde948250df1c876dcdd5af99f03b5",
    "original_commit_id": "e74cf5028bbe6bc7fe520647860590f855eb8b3e",
    "user": {
      "login": "jimmysong",
      "id": 524761,
      "node_id": "MDQ6VXNlcjUyNDc2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/524761?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimmysong",
      "html_url": "https://github.com/jimmysong",
      "followers_url": "https://api.github.com/users/jimmysong/followers",
      "following_url": "https://api.github.com/users/jimmysong/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimmysong/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimmysong/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimmysong/subscriptions",
      "organizations_url": "https://api.github.com/users/jimmysong/orgs",
      "repos_url": "https://api.github.com/users/jimmysong/repos",
      "events_url": "https://api.github.com/users/jimmysong/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimmysong/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Also looks like it should use `self.sync` instead and maybe get rid of the `if not success` below.",
    "created_at": "2017-04-17T19:17:55Z",
    "updated_at": "2017-04-18T21:20:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r111801053",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111801053"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r111801053"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111801053/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1638,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111801707",
    "pull_request_review_id": 33066718,
    "id": 111801707,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMTgwMTcwNw==",
    "diff_hunk": "@@ -192,9 +192,7 @@ def disconnected():\n         return wait_until(disconnected, timeout=10)\n \n     def wait_for_verack(self):\n-        def veracked():\n-            return all(node.verack_received for node in self.test_nodes)\n-        return wait_until(veracked, timeout=10)\n+        [node.wait_for_verack() for node in self.test_nodes]",
    "path": "test/functional/test_framework/comptool.py",
    "position": null,
    "original_position": 7,
    "commit_id": "2a52ae63bfdde948250df1c876dcdd5af99f03b5",
    "original_commit_id": "e74cf5028bbe6bc7fe520647860590f855eb8b3e",
    "user": {
      "login": "jimmysong",
      "id": 524761,
      "node_id": "MDQ6VXNlcjUyNDc2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/524761?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimmysong",
      "html_url": "https://github.com/jimmysong",
      "followers_url": "https://api.github.com/users/jimmysong/followers",
      "following_url": "https://api.github.com/users/jimmysong/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimmysong/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimmysong/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimmysong/subscriptions",
      "organizations_url": "https://api.github.com/users/jimmysong/orgs",
      "repos_url": "https://api.github.com/users/jimmysong/repos",
      "events_url": "https://api.github.com/users/jimmysong/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimmysong/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Any reason not to return the value like this?\r\n\r\n    return all(node.wait_for_verack() for node in self.test_nodes)\r\n\r\n",
    "created_at": "2017-04-17T19:22:12Z",
    "updated_at": "2017-04-18T21:20:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r111801707",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111801707"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r111801707"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111801707/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 195,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111803781",
    "pull_request_review_id": 33066718,
    "id": 111803781,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMTgwMzc4MQ==",
    "diff_hunk": "@@ -581,25 +536,21 @@ def run_test(self):\n         for i in range(5*MAX_UNCONNECTING_HEADERS - 1):\n             # Send a header that doesn't connect, check that we get a getheaders.\n             with mininode_lock:\n-                test_node.last_getheaders = None\n+                test_node.last_message.pop(\"getheaders\", None)\n             test_node.send_header_for_blocks([blocks[i%len(blocks)]])\n             test_node.wait_for_getheaders(timeout=1)\n \n         # Eventually this stops working.\n-        with mininode_lock:\n-            self.last_getheaders = None",
    "path": "test/functional/sendheaders.py",
    "position": 228,
    "original_position": 228,
    "commit_id": "2a52ae63bfdde948250df1c876dcdd5af99f03b5",
    "original_commit_id": "e74cf5028bbe6bc7fe520647860590f855eb8b3e",
    "user": {
      "login": "jimmysong",
      "id": 524761,
      "node_id": "MDQ6VXNlcjUyNDc2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/524761?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimmysong",
      "html_url": "https://github.com/jimmysong",
      "followers_url": "https://api.github.com/users/jimmysong/followers",
      "following_url": "https://api.github.com/users/jimmysong/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimmysong/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimmysong/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimmysong/subscriptions",
      "organizations_url": "https://api.github.com/users/jimmysong/orgs",
      "repos_url": "https://api.github.com/users/jimmysong/repos",
      "events_url": "https://api.github.com/users/jimmysong/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimmysong/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Any reason to get rid of this and the one 5 lines below? I expected `self.last_message.pop`.",
    "created_at": "2017-04-17T19:34:17Z",
    "updated_at": "2017-04-18T21:20:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r111803781",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111803781"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r111803781"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111803781/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 590,
    "original_line": 590,
    "side": "LEFT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111804160",
    "pull_request_review_id": 33066718,
    "id": 111804160,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMTgwNDE2MA==",
    "diff_hunk": "@@ -35,79 +35,21 @@ def get_virtual_size(witness_block):\n class TestNode(NodeConnCB):\n     def __init__(self):\n         super().__init__()\n-        self.connection = None\n-        self.ping_counter = 1\n-        self.last_pong = msg_pong(0)\n-        self.sleep_time = 0.05\n         self.getdataset = set()\n-        self.last_reject = None\n-\n-    def add_connection(self, conn):\n-        self.connection = conn\n-\n-    # Wrapper for the NodeConn's send_message function\n-    def send_message(self, message):\n-        self.connection.send_message(message)\n-\n-    def on_inv(self, conn, message):\n-        self.last_inv = message\n-\n-    def on_block(self, conn, message):\n-        self.last_block = message.block\n-        self.last_block.calc_sha256()\n \n     def on_getdata(self, conn, message):\n         for inv in message.inv:\n             self.getdataset.add(inv.hash)\n-        self.last_getdata = message\n-\n-    def on_getheaders(self, conn, message):\n-        self.last_getheaders = message\n-\n-    def on_pong(self, conn, message):\n-        self.last_pong = message\n-\n-    def on_reject(self, conn, message):\n-        self.last_reject = message\n-\n-    # Syncing helpers\n-    def sync(self, test_function, timeout=60):\n-        while timeout > 0:\n-            with mininode_lock:\n-                if test_function():\n-                    return\n-            time.sleep(self.sleep_time)\n-            timeout -= self.sleep_time\n-        raise AssertionError(\"Sync failed to complete\")\n-        \n-    def wait_for_block(self, blockhash, timeout=60):\n-        test_function = lambda: self.last_block != None and self.last_block.sha256 == blockhash\n-        self.sync(test_function, timeout)\n-        return\n-\n-    def wait_for_getdata(self, timeout=60):\n-        test_function = lambda: self.last_getdata != None\n-        self.sync(test_function, timeout)\n-\n-    def wait_for_getheaders(self, timeout=60):\n-        test_function = lambda: self.last_getheaders != None\n-        self.sync(test_function, timeout)\n-\n-    def wait_for_inv(self, expected_inv, timeout=60):\n-        test_function = lambda: self.last_inv != expected_inv\n-        self.sync(test_function, timeout)\n \n     def announce_tx_and_wait_for_getdata(self, tx, timeout=60):\n         with mininode_lock:\n-            self.last_getdata = None\n+            self.last_message.pop(\"getdata\", None)\n         self.send_message(msg_inv(inv=[CInv(1, tx.sha256)]))\n         self.wait_for_getdata(timeout)\n-        return\n \n     def announce_block_and_wait_for_getdata(self, block, use_header, timeout=60):\n         with mininode_lock:\n-            self.last_getdata = None\n-            self.last_getheaders = None\n+            self.last_message.pop(\"getdata\", None)",
    "path": "test/functional/p2p-segwit.py",
    "position": 78,
    "original_position": 78,
    "commit_id": "2a52ae63bfdde948250df1c876dcdd5af99f03b5",
    "original_commit_id": "e74cf5028bbe6bc7fe520647860590f855eb8b3e",
    "user": {
      "login": "jimmysong",
      "id": 524761,
      "node_id": "MDQ6VXNlcjUyNDc2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/524761?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimmysong",
      "html_url": "https://github.com/jimmysong",
      "followers_url": "https://api.github.com/users/jimmysong/followers",
      "following_url": "https://api.github.com/users/jimmysong/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimmysong/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimmysong/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimmysong/subscriptions",
      "organizations_url": "https://api.github.com/users/jimmysong/orgs",
      "repos_url": "https://api.github.com/users/jimmysong/repos",
      "events_url": "https://api.github.com/users/jimmysong/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimmysong/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "how about `getheaders`?",
    "created_at": "2017-04-17T19:36:39Z",
    "updated_at": "2017-04-18T21:20:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r111804160",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111804160"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r111804160"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111804160/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 52,
    "original_line": 52,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111804710",
    "pull_request_review_id": 33066718,
    "id": 111804710,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMTgwNDcxMA==",
    "diff_hunk": "@@ -78,7 +72,7 @@ def run_test(self):\n         test_node.clear_invs()\n \n         # Set a filter of 15 sat/byte\n-        test_node.send_filter(15000)\n+        test_node.send_and_ping(msg_feefilter(15001))",
    "path": "test/functional/p2p-feefilter.py",
    "position": null,
    "original_position": 25,
    "commit_id": "2a52ae63bfdde948250df1c876dcdd5af99f03b5",
    "original_commit_id": "e74cf5028bbe6bc7fe520647860590f855eb8b3e",
    "user": {
      "login": "jimmysong",
      "id": 524761,
      "node_id": "MDQ6VXNlcjUyNDc2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/524761?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimmysong",
      "html_url": "https://github.com/jimmysong",
      "followers_url": "https://api.github.com/users/jimmysong/followers",
      "following_url": "https://api.github.com/users/jimmysong/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimmysong/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimmysong/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimmysong/subscriptions",
      "organizations_url": "https://api.github.com/users/jimmysong/orgs",
      "repos_url": "https://api.github.com/users/jimmysong/repos",
      "events_url": "https://api.github.com/users/jimmysong/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimmysong/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Why did the constant change from 15000 to 15001?",
    "created_at": "2017-04-17T19:39:43Z",
    "updated_at": "2017-04-18T21:20:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r111804710",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111804710"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r111804710"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111804710/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 75,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111805087",
    "pull_request_review_id": 33066718,
    "id": 111805087,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMTgwNTA4Nw==",
    "diff_hunk": "@@ -43,51 +35,33 @@ def on_close(self, conn):\n     def on_sendcmpct(self, conn, message):\n         self.last_sendcmpct.append(message)\n \n-    def on_block(self, conn, message):\n-        self.last_block = message\n-\n     def on_cmpctblock(self, conn, message):\n-        self.last_cmpctblock = message\n         self.block_announced = True\n-        self.last_cmpctblock.header_and_shortids.header.calc_sha256()\n-        self.set_announced_blockhashes.add(self.last_cmpctblock.header_and_shortids.header.sha256)\n+        self.last_message[\"cmpctblock\"].header_and_shortids.header.calc_sha256()\n+        self.set_announced_blockhashes.add(self.last_message[\"cmpctblock\"].header_and_shortids.header.sha256)",
    "path": "test/functional/p2p-compactblocks.py",
    "position": null,
    "original_position": 29,
    "commit_id": "2a52ae63bfdde948250df1c876dcdd5af99f03b5",
    "original_commit_id": "e74cf5028bbe6bc7fe520647860590f855eb8b3e",
    "user": {
      "login": "jimmysong",
      "id": 524761,
      "node_id": "MDQ6VXNlcjUyNDc2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/524761?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimmysong",
      "html_url": "https://github.com/jimmysong",
      "followers_url": "https://api.github.com/users/jimmysong/followers",
      "following_url": "https://api.github.com/users/jimmysong/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimmysong/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimmysong/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimmysong/subscriptions",
      "organizations_url": "https://api.github.com/users/jimmysong/orgs",
      "repos_url": "https://api.github.com/users/jimmysong/repos",
      "events_url": "https://api.github.com/users/jimmysong/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimmysong/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Please let me know if this is inappropriate, but the object attribute `set_announced_blockhashes` is a bit confusing. Would changing the name to something like `announced_blockhashes_set` be appropriate here?",
    "created_at": "2017-04-17T19:41:36Z",
    "updated_at": "2017-04-18T21:20:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r111805087",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111805087"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r111805087"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111805087/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 41,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111805255",
    "pull_request_review_id": 33066718,
    "id": 111805255,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMTgwNTI1NQ==",
    "diff_hunk": "@@ -214,14 +187,14 @@ def check_announcement_of_new_block(node, peer, predicate):\n             with mininode_lock:\n                 assert predicate(peer), (\n                     \"block_hash={!r}, cmpctblock={!r}, inv={!r}\".format(\n-                        block_hash, peer.last_cmpctblock, peer.last_inv))\n+                        block_hash, peer.last_message.get(\"cmpctblock\", None), peer.last_message.pop(\"inv\", None)))",
    "path": "test/functional/p2p-compactblocks.py",
    "position": null,
    "original_position": 90,
    "commit_id": "2a52ae63bfdde948250df1c876dcdd5af99f03b5",
    "original_commit_id": "e74cf5028bbe6bc7fe520647860590f855eb8b3e",
    "user": {
      "login": "jimmysong",
      "id": 524761,
      "node_id": "MDQ6VXNlcjUyNDc2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/524761?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimmysong",
      "html_url": "https://github.com/jimmysong",
      "followers_url": "https://api.github.com/users/jimmysong/followers",
      "following_url": "https://api.github.com/users/jimmysong/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimmysong/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimmysong/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimmysong/subscriptions",
      "organizations_url": "https://api.github.com/users/jimmysong/orgs",
      "repos_url": "https://api.github.com/users/jimmysong/repos",
      "events_url": "https://api.github.com/users/jimmysong/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimmysong/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Why `pop` instead of `get` for the inv message?",
    "created_at": "2017-04-17T19:42:39Z",
    "updated_at": "2017-04-18T21:20:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r111805255",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111805255"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r111805255"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111805255/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 190,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111805963",
    "pull_request_review_id": 33066718,
    "id": 111805963,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMTgwNTk2Mw==",
    "diff_hunk": "@@ -192,33 +153,26 @@ def run_test(self):\n         stop_node(self.nodes[0], 0)\n         self.nodes[0] = start_node(0, self.options.tmpdir, [\"-whitelist=127.0.0.1\", \"-maxuploadtarget=1\", \"-blockmaxsize=999000\"])\n \n-        #recreate/reconnect 3 test nodes\n-        test_nodes = []\n-        connections = []\n-\n-        for i in range(3):\n-            test_nodes.append(TestNode())\n-            connections.append(NodeConn('127.0.0.1', p2p_port(0), self.nodes[0], test_nodes[i]))\n-            test_nodes[i].add_connection(connections[i])",
    "path": "test/functional/maxuploadtarget.py",
    "position": 79,
    "original_position": 79,
    "commit_id": "2a52ae63bfdde948250df1c876dcdd5af99f03b5",
    "original_commit_id": "e74cf5028bbe6bc7fe520647860590f855eb8b3e",
    "user": {
      "login": "jimmysong",
      "id": 524761,
      "node_id": "MDQ6VXNlcjUyNDc2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/524761?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimmysong",
      "html_url": "https://github.com/jimmysong",
      "followers_url": "https://api.github.com/users/jimmysong/followers",
      "following_url": "https://api.github.com/users/jimmysong/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimmysong/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimmysong/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimmysong/subscriptions",
      "organizations_url": "https://api.github.com/users/jimmysong/orgs",
      "repos_url": "https://api.github.com/users/jimmysong/repos",
      "events_url": "https://api.github.com/users/jimmysong/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimmysong/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Am I correct in assuming you're creating 1 node instead of 3 because the other two aren't being used?",
    "created_at": "2017-04-17T19:46:26Z",
    "updated_at": "2017-04-18T21:20:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r111805963",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111805963"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r111805963"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111805963/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 202,
    "original_line": 202,
    "side": "LEFT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112023795",
    "pull_request_review_id": 33307208,
    "id": 112023795,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMjAyMzc5NQ==",
    "diff_hunk": "@@ -192,33 +153,26 @@ def run_test(self):\n         stop_node(self.nodes[0], 0)\n         self.nodes[0] = start_node(0, self.options.tmpdir, [\"-whitelist=127.0.0.1\", \"-maxuploadtarget=1\", \"-blockmaxsize=999000\"])\n \n-        #recreate/reconnect 3 test nodes\n-        test_nodes = []\n-        connections = []\n-\n-        for i in range(3):\n-            test_nodes.append(TestNode())\n-            connections.append(NodeConn('127.0.0.1', p2p_port(0), self.nodes[0], test_nodes[i]))\n-            test_nodes[i].add_connection(connections[i])",
    "path": "test/functional/maxuploadtarget.py",
    "position": 79,
    "original_position": 79,
    "commit_id": "2a52ae63bfdde948250df1c876dcdd5af99f03b5",
    "original_commit_id": "e74cf5028bbe6bc7fe520647860590f855eb8b3e",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "correct. I was altering this line anyway, so I thought I'd optimize while I was here.",
    "created_at": "2017-04-18T18:05:09Z",
    "updated_at": "2017-04-18T21:20:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r112023795",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112023795"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r112023795"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112023795/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 202,
    "original_line": 202,
    "side": "LEFT",
    "in_reply_to_id": 111805963
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112024546",
    "pull_request_review_id": 33307208,
    "id": 112024546,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMjAyNDU0Ng==",
    "diff_hunk": "@@ -43,51 +35,33 @@ def on_close(self, conn):\n     def on_sendcmpct(self, conn, message):\n         self.last_sendcmpct.append(message)\n \n-    def on_block(self, conn, message):\n-        self.last_block = message\n-\n     def on_cmpctblock(self, conn, message):\n-        self.last_cmpctblock = message\n         self.block_announced = True\n-        self.last_cmpctblock.header_and_shortids.header.calc_sha256()\n-        self.set_announced_blockhashes.add(self.last_cmpctblock.header_and_shortids.header.sha256)\n+        self.last_message[\"cmpctblock\"].header_and_shortids.header.calc_sha256()\n+        self.set_announced_blockhashes.add(self.last_message[\"cmpctblock\"].header_and_shortids.header.sha256)",
    "path": "test/functional/p2p-compactblocks.py",
    "position": null,
    "original_position": 29,
    "commit_id": "2a52ae63bfdde948250df1c876dcdd5af99f03b5",
    "original_commit_id": "e74cf5028bbe6bc7fe520647860590f855eb8b3e",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yes, agreed. Absolutely fine to point this out even though the variable name wasn't changed by this PR. I've gone ahead and changed it to `announced_blockhashes`. No need for the variable name to contain the name of the data structure.",
    "created_at": "2017-04-18T18:08:02Z",
    "updated_at": "2017-04-18T21:20:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r112024546",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112024546"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r112024546"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112024546/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 41,
    "side": "RIGHT",
    "in_reply_to_id": 111805087
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112024839",
    "pull_request_review_id": 33307208,
    "id": 112024839,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMjAyNDgzOQ==",
    "diff_hunk": "@@ -214,14 +187,14 @@ def check_announcement_of_new_block(node, peer, predicate):\n             with mininode_lock:\n                 assert predicate(peer), (\n                     \"block_hash={!r}, cmpctblock={!r}, inv={!r}\".format(\n-                        block_hash, peer.last_cmpctblock, peer.last_inv))\n+                        block_hash, peer.last_message.get(\"cmpctblock\", None), peer.last_message.pop(\"inv\", None)))",
    "path": "test/functional/p2p-compactblocks.py",
    "position": null,
    "original_position": 90,
    "commit_id": "2a52ae63bfdde948250df1c876dcdd5af99f03b5",
    "original_commit_id": "e74cf5028bbe6bc7fe520647860590f855eb8b3e",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "bad search-and-replace I think. It doesn't really matter, since this block would only get executed if the assert failed, in which case the test case has failed. I've fixed it anyway.",
    "created_at": "2017-04-18T18:09:16Z",
    "updated_at": "2017-04-18T21:20:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r112024839",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112024839"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r112024839"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112024839/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 190,
    "side": "RIGHT",
    "in_reply_to_id": 111805255
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112024907",
    "pull_request_review_id": 33307208,
    "id": 112024907,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMjAyNDkwNw==",
    "diff_hunk": "@@ -78,7 +72,7 @@ def run_test(self):\n         test_node.clear_invs()\n \n         # Set a filter of 15 sat/byte\n-        test_node.send_filter(15000)\n+        test_node.send_and_ping(msg_feefilter(15001))",
    "path": "test/functional/p2p-feefilter.py",
    "position": null,
    "original_position": 25,
    "commit_id": "2a52ae63bfdde948250df1c876dcdd5af99f03b5",
    "original_commit_id": "e74cf5028bbe6bc7fe520647860590f855eb8b3e",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "bah. My mistake. Fixed",
    "created_at": "2017-04-18T18:09:33Z",
    "updated_at": "2017-04-18T21:20:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r112024907",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112024907"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r112024907"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112024907/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 75,
    "side": "RIGHT",
    "in_reply_to_id": 111804710
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112025814",
    "pull_request_review_id": 33307208,
    "id": 112025814,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMjAyNTgxNA==",
    "diff_hunk": "@@ -35,79 +35,21 @@ def get_virtual_size(witness_block):\n class TestNode(NodeConnCB):\n     def __init__(self):\n         super().__init__()\n-        self.connection = None\n-        self.ping_counter = 1\n-        self.last_pong = msg_pong(0)\n-        self.sleep_time = 0.05\n         self.getdataset = set()\n-        self.last_reject = None\n-\n-    def add_connection(self, conn):\n-        self.connection = conn\n-\n-    # Wrapper for the NodeConn's send_message function\n-    def send_message(self, message):\n-        self.connection.send_message(message)\n-\n-    def on_inv(self, conn, message):\n-        self.last_inv = message\n-\n-    def on_block(self, conn, message):\n-        self.last_block = message.block\n-        self.last_block.calc_sha256()\n \n     def on_getdata(self, conn, message):\n         for inv in message.inv:\n             self.getdataset.add(inv.hash)\n-        self.last_getdata = message\n-\n-    def on_getheaders(self, conn, message):\n-        self.last_getheaders = message\n-\n-    def on_pong(self, conn, message):\n-        self.last_pong = message\n-\n-    def on_reject(self, conn, message):\n-        self.last_reject = message\n-\n-    # Syncing helpers\n-    def sync(self, test_function, timeout=60):\n-        while timeout > 0:\n-            with mininode_lock:\n-                if test_function():\n-                    return\n-            time.sleep(self.sleep_time)\n-            timeout -= self.sleep_time\n-        raise AssertionError(\"Sync failed to complete\")\n-        \n-    def wait_for_block(self, blockhash, timeout=60):\n-        test_function = lambda: self.last_block != None and self.last_block.sha256 == blockhash\n-        self.sync(test_function, timeout)\n-        return\n-\n-    def wait_for_getdata(self, timeout=60):\n-        test_function = lambda: self.last_getdata != None\n-        self.sync(test_function, timeout)\n-\n-    def wait_for_getheaders(self, timeout=60):\n-        test_function = lambda: self.last_getheaders != None\n-        self.sync(test_function, timeout)\n-\n-    def wait_for_inv(self, expected_inv, timeout=60):\n-        test_function = lambda: self.last_inv != expected_inv\n-        self.sync(test_function, timeout)\n \n     def announce_tx_and_wait_for_getdata(self, tx, timeout=60):\n         with mininode_lock:\n-            self.last_getdata = None\n+            self.last_message.pop(\"getdata\", None)\n         self.send_message(msg_inv(inv=[CInv(1, tx.sha256)]))\n         self.wait_for_getdata(timeout)\n-        return\n \n     def announce_block_and_wait_for_getdata(self, block, use_header, timeout=60):\n         with mininode_lock:\n-            self.last_getdata = None\n-            self.last_getheaders = None\n+            self.last_message.pop(\"getdata\", None)",
    "path": "test/functional/p2p-segwit.py",
    "position": 78,
    "original_position": 78,
    "commit_id": "2a52ae63bfdde948250df1c876dcdd5af99f03b5",
    "original_commit_id": "e74cf5028bbe6bc7fe520647860590f855eb8b3e",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yes. My mistake. Fixed",
    "created_at": "2017-04-18T18:12:40Z",
    "updated_at": "2017-04-18T21:20:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r112025814",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112025814"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r112025814"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112025814/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 52,
    "original_line": 52,
    "side": "RIGHT",
    "in_reply_to_id": 111804160
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112026717",
    "pull_request_review_id": 33307208,
    "id": 112026717,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMjAyNjcxNw==",
    "diff_hunk": "@@ -581,25 +536,21 @@ def run_test(self):\n         for i in range(5*MAX_UNCONNECTING_HEADERS - 1):\n             # Send a header that doesn't connect, check that we get a getheaders.\n             with mininode_lock:\n-                test_node.last_getheaders = None\n+                test_node.last_message.pop(\"getheaders\", None)\n             test_node.send_header_for_blocks([blocks[i%len(blocks)]])\n             test_node.wait_for_getheaders(timeout=1)\n \n         # Eventually this stops working.\n-        with mininode_lock:\n-            self.last_getheaders = None",
    "path": "test/functional/sendheaders.py",
    "position": 228,
    "original_position": 228,
    "commit_id": "2a52ae63bfdde948250df1c876dcdd5af99f03b5",
    "original_commit_id": "e74cf5028bbe6bc7fe520647860590f855eb8b3e",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "because we're never testing `last_getheaders` after this, so these lines are just setting a variable that never gets used.",
    "created_at": "2017-04-18T18:16:22Z",
    "updated_at": "2017-04-18T21:20:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r112026717",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112026717"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r112026717"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112026717/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 590,
    "original_line": 590,
    "side": "LEFT",
    "in_reply_to_id": 111803781
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112027098",
    "pull_request_review_id": 33307208,
    "id": 112027098,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMjAyNzA5OA==",
    "diff_hunk": "@@ -192,9 +192,7 @@ def disconnected():\n         return wait_until(disconnected, timeout=10)\n \n     def wait_for_verack(self):\n-        def veracked():\n-            return all(node.verack_received for node in self.test_nodes)\n-        return wait_until(veracked, timeout=10)\n+        [node.wait_for_verack() for node in self.test_nodes]",
    "path": "test/functional/test_framework/comptool.py",
    "position": null,
    "original_position": 7,
    "commit_id": "2a52ae63bfdde948250df1c876dcdd5af99f03b5",
    "original_commit_id": "e74cf5028bbe6bc7fe520647860590f855eb8b3e",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "yes, that's much better. Changed, thanks.",
    "created_at": "2017-04-18T18:18:02Z",
    "updated_at": "2017-04-18T21:20:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r112027098",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112027098"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r112027098"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112027098/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 195,
    "side": "RIGHT",
    "in_reply_to_id": 111801707
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112063492",
    "pull_request_review_id": 33350706,
    "id": 112063492,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMjA2MzQ5Mg==",
    "diff_hunk": "@@ -581,25 +536,21 @@ def run_test(self):\n         for i in range(5*MAX_UNCONNECTING_HEADERS - 1):\n             # Send a header that doesn't connect, check that we get a getheaders.\n             with mininode_lock:\n-                test_node.last_getheaders = None\n+                test_node.last_message.pop(\"getheaders\", None)\n             test_node.send_header_for_blocks([blocks[i%len(blocks)]])\n             test_node.wait_for_getheaders(timeout=1)\n \n         # Eventually this stops working.\n-        with mininode_lock:\n-            self.last_getheaders = None",
    "path": "test/functional/sendheaders.py",
    "position": 228,
    "original_position": 228,
    "commit_id": "2a52ae63bfdde948250df1c876dcdd5af99f03b5",
    "original_commit_id": "e74cf5028bbe6bc7fe520647860590f855eb8b3e",
    "user": {
      "login": "jimmysong",
      "id": 524761,
      "node_id": "MDQ6VXNlcjUyNDc2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/524761?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimmysong",
      "html_url": "https://github.com/jimmysong",
      "followers_url": "https://api.github.com/users/jimmysong/followers",
      "following_url": "https://api.github.com/users/jimmysong/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimmysong/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimmysong/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimmysong/subscriptions",
      "organizations_url": "https://api.github.com/users/jimmysong/orgs",
      "repos_url": "https://api.github.com/users/jimmysong/repos",
      "events_url": "https://api.github.com/users/jimmysong/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimmysong/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "makes sense.",
    "created_at": "2017-04-18T21:03:45Z",
    "updated_at": "2017-04-18T21:20:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r112063492",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112063492"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r112063492"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112063492/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 590,
    "original_line": 590,
    "side": "LEFT",
    "in_reply_to_id": 111803781
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112064436",
    "pull_request_review_id": 33350706,
    "id": 112064436,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMjA2NDQzNg==",
    "diff_hunk": "@@ -78,7 +72,7 @@ def run_test(self):\n         test_node.clear_invs()\n \n         # Set a filter of 15 sat/byte\n-        test_node.send_filter(15000)\n+        test_node.send_and_ping(msg_feefilter(15001))",
    "path": "test/functional/p2p-feefilter.py",
    "position": null,
    "original_position": 25,
    "commit_id": "2a52ae63bfdde948250df1c876dcdd5af99f03b5",
    "original_commit_id": "e74cf5028bbe6bc7fe520647860590f855eb8b3e",
    "user": {
      "login": "jimmysong",
      "id": 524761,
      "node_id": "MDQ6VXNlcjUyNDc2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/524761?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimmysong",
      "html_url": "https://github.com/jimmysong",
      "followers_url": "https://api.github.com/users/jimmysong/followers",
      "following_url": "https://api.github.com/users/jimmysong/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimmysong/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimmysong/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimmysong/subscriptions",
      "organizations_url": "https://api.github.com/users/jimmysong/orgs",
      "repos_url": "https://api.github.com/users/jimmysong/repos",
      "events_url": "https://api.github.com/users/jimmysong/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimmysong/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I don't see this yet? Maybe missing a changeset or I'm missing something?",
    "created_at": "2017-04-18T21:08:06Z",
    "updated_at": "2017-04-18T21:20:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r112064436",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112064436"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r112064436"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112064436/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 75,
    "side": "RIGHT",
    "in_reply_to_id": 111804710
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112067269",
    "pull_request_review_id": 33354596,
    "id": 112067269,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExMjA2NzI2OQ==",
    "diff_hunk": "@@ -78,7 +72,7 @@ def run_test(self):\n         test_node.clear_invs()\n \n         # Set a filter of 15 sat/byte\n-        test_node.send_filter(15000)\n+        test_node.send_and_ping(msg_feefilter(15001))",
    "path": "test/functional/p2p-feefilter.py",
    "position": null,
    "original_position": 25,
    "commit_id": "2a52ae63bfdde948250df1c876dcdd5af99f03b5",
    "original_commit_id": "e74cf5028bbe6bc7fe520647860590f855eb8b3e",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "argh! Fixed now",
    "created_at": "2017-04-18T21:20:44Z",
    "updated_at": "2017-04-18T21:20:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r112067269",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112067269"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r112067269"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112067269/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 75,
    "side": "RIGHT",
    "in_reply_to_id": 111804710
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114389770",
    "pull_request_review_id": 35851747,
    "id": 114389770,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNDM4OTc3MA==",
    "diff_hunk": "@@ -1548,43 +1579,56 @@ def on_version(self, conn, message):\n             conn.ver_recv = conn.ver_send\n         conn.nServices = message.nServices\n \n-    # Helper functions\n-    ##################\n+    # Connection helper methods\n \n     def add_connection(self, conn):\n         self.connection = conn\n \n-    # Wrapper for the NodeConn's send_message function\n+    def wait_for_disconnect(self, timeout=60):\n+        test_function = lambda: not self.connected\n+        assert wait_until(test_function, timeout=timeout)\n+\n+    # Message receiving helper methods\n+\n+    def wait_for_block(self, blockhash, timeout=60):\n+        test_function = lambda: self.last_message.get(\"block\") and self.last_message[\"block\"].block.rehash() == blockhash\n+        assert wait_until(test_function, timeout=timeout)\n+\n+    def wait_for_getdata(self, timeout=60):\n+        test_function = lambda: self.last_message.get(\"getdata\")\n+        assert wait_until(test_function, timeout=timeout)\n+\n+    def wait_for_getheaders(self, timeout=60):\n+        test_function = lambda: self.last_message.get(\"getheaders\")\n+        assert wait_until(test_function, timeout=timeout)\n+\n+    def wait_for_inv(self, expected_inv, timeout=60):\n+        test_function = lambda: self.last_message.get(\"inv\") and self.last_message[\"inv\"] != expected_inv",
    "path": "test/functional/test_framework/mininode.py",
    "position": 173,
    "original_position": 173,
    "commit_id": "2a52ae63bfdde948250df1c876dcdd5af99f03b5",
    "original_commit_id": "2a52ae63bfdde948250df1c876dcdd5af99f03b5",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "@jnewbery Can you explain why the second operand is `!=` and not `==`?",
    "created_at": "2017-05-02T18:26:16Z",
    "updated_at": "2017-05-02T18:26:16Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r114389770",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114389770"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r114389770"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114389770/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1606,
    "original_line": 1606,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114419023",
    "pull_request_review_id": 35883664,
    "id": 114419023,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNDQxOTAyMw==",
    "diff_hunk": "@@ -1548,43 +1579,56 @@ def on_version(self, conn, message):\n             conn.ver_recv = conn.ver_send\n         conn.nServices = message.nServices\n \n-    # Helper functions\n-    ##################\n+    # Connection helper methods\n \n     def add_connection(self, conn):\n         self.connection = conn\n \n-    # Wrapper for the NodeConn's send_message function\n+    def wait_for_disconnect(self, timeout=60):\n+        test_function = lambda: not self.connected\n+        assert wait_until(test_function, timeout=timeout)\n+\n+    # Message receiving helper methods\n+\n+    def wait_for_block(self, blockhash, timeout=60):\n+        test_function = lambda: self.last_message.get(\"block\") and self.last_message[\"block\"].block.rehash() == blockhash\n+        assert wait_until(test_function, timeout=timeout)\n+\n+    def wait_for_getdata(self, timeout=60):\n+        test_function = lambda: self.last_message.get(\"getdata\")\n+        assert wait_until(test_function, timeout=timeout)\n+\n+    def wait_for_getheaders(self, timeout=60):\n+        test_function = lambda: self.last_message.get(\"getheaders\")\n+        assert wait_until(test_function, timeout=timeout)\n+\n+    def wait_for_inv(self, expected_inv, timeout=60):\n+        test_function = lambda: self.last_message.get(\"inv\") and self.last_message[\"inv\"] != expected_inv",
    "path": "test/functional/test_framework/mininode.py",
    "position": 173,
    "original_position": 173,
    "commit_id": "2a52ae63bfdde948250df1c876dcdd5af99f03b5",
    "original_commit_id": "2a52ae63bfdde948250df1c876dcdd5af99f03b5",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This was a code move from p2p-segwit.py to here, but you're right that this is a bug.\r\n\r\nFix here: #10318",
    "created_at": "2017-05-02T20:37:50Z",
    "updated_at": "2017-05-02T20:37:51Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r114419023",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114419023"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/10169#discussion_r114419023"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10169"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114419023/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1606,
    "original_line": 1606,
    "side": "RIGHT",
    "in_reply_to_id": 114389770
  }
]