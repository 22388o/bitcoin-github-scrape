[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/903765978",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-903765978",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
    "id": 903765978,
    "node_id": "IC_kwDOABII58413l_a",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-23T13:25:10Z",
    "updated_at": "2021-11-27T11:32:59Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#23604](https://github.com/bitcoin/bitcoin/pull/23604) (Use Sock in CNode by vasild)\n* [#23575](https://github.com/bitcoin/bitcoin/pull/23575) (fuzz: Rework FillNode by MarcoFalke)\n* [#23546](https://github.com/bitcoin/bitcoin/pull/23546) (scripted-diff: Use clang-tidy syntax for C++ named arguments (tests only) by MarcoFalke)\n* [#22777](https://github.com/bitcoin/bitcoin/pull/22777) (net processing: don't request tx relay on feeler connections by jnewbery)\n* [#22053](https://github.com/bitcoin/bitcoin/pull/22053) (refactor: Release cs_main before MaybeSendFeefilter by MarcoFalke)\n* [#21878](https://github.com/bitcoin/bitcoin/pull/21878) (Make all networking code mockable by vasild)\n* [#21515](https://github.com/bitcoin/bitcoin/pull/21515) (Erlay: bandwidth-efficient transaction relay protocol by naumenkogs)\n* [#21160](https://github.com/bitcoin/bitcoin/pull/21160) (net/net processing: Move tx inventory into net_processing by jnewbery)\n* [#19499](https://github.com/bitcoin/bitcoin/pull/19499) (p2p: Make timeout mockable and type safe, speed up test by MarcoFalke)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/903765978/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/907031918",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-907031918",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
    "id": 907031918,
    "node_id": "IC_kwDOABII5842EDVu",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-27T08:37:56Z",
    "updated_at": "2021-08-27T08:37:56Z",
    "author_association": "MEMBER",
    "body": "I've pushed a new branch that simplifies the implementation a bit. I'd previously wanted to amalgamate the various mutexes and atomics in `Peer::TxRelay` as part of this PR, but it's easier to wait until #21527 to do that, otherwise there are all kinds of lock ordering/inversion issues to work around.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/907031918/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/907082695",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-907082695",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
    "id": 907082695,
    "node_id": "IC_kwDOABII5842EPvH",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-27T10:00:21Z",
    "updated_at": "2021-08-27T10:00:21Z",
    "author_association": "MEMBER",
    "body": "rebased",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/907082695/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910429435",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-910429435",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
    "id": 910429435,
    "node_id": "IC_kwDOABII5842RAz7",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?u=06eb9ae4f9b3f954056098860decccbf1340e40f&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-01T16:04:03Z",
    "updated_at": "2021-09-01T16:04:03Z",
    "author_association": "MEMBER",
    "body": "Concept ACK",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910429435/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/926544378",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-926544378",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
    "id": 926544378,
    "node_id": "IC_kwDOABII5843OfH6",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-24T11:13:26Z",
    "updated_at": "2021-09-24T11:13:37Z",
    "author_association": "MEMBER",
    "body": "Rebased on the latest #21160",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/926544378/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/930958812",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-930958812",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
    "id": 930958812,
    "node_id": "IC_kwDOABII5843fU3c",
    "user": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?u=d06d2903ce6ad8b9d0c66ef9225fa21adfe22c7f&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasild/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-30T07:49:24Z",
    "updated_at": "2021-09-30T07:49:24Z",
    "author_association": "CONTRIBUTOR",
    "body": "Some rough estimates on how much this will save:\r\n\r\n```\r\n(gdb) p sizeof(CNode::TxRelay)\r\n$1 = 152\r\n```\r\n\r\nAssuming 50 incoming connections and 20% of them being block-only, that makes 10 peers will benefit from this. 152 bytes each, so 1520 bytes will be saved.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/930958812/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 1,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/930996031",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-930996031",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
    "id": 930996031,
    "node_id": "IC_kwDOABII5843fd8_",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-30T08:11:50Z",
    "updated_at": "2021-09-30T08:11:50Z",
    "author_association": "MEMBER",
    "body": "> Some rough estimates on how much this will save...\r\n\r\n@vasild This seems completely wrong. `TxRelay` contains a CRollingBloomFilter parametrized by `{50000, 0.000001}`. According to this code comment:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/419afa93419e6840f78cb94b4a39d826eb10e139/src/bloom.h#L94-L98\r\n\r\nthe storage requirement for just that rolling bloom filter is ~1.8 * 50,000 * 6 = 540kB",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/930996031/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/931172782",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-931172782",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
    "id": 931172782,
    "node_id": "IC_kwDOABII5843gJGu",
    "user": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?u=d06d2903ce6ad8b9d0c66ef9225fa21adfe22c7f&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasild/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-30T09:56:48Z",
    "updated_at": "2021-09-30T09:56:48Z",
    "author_association": "CONTRIBUTOR",
    "body": "Well, I said \"rough\", but did not mean _that_ rough. Somehow I wrongly assumed that none of the constructors allocate extra memory from the heap :disappointed:. Now I checked that `CRollingBloomFilter{50000, 0.000001}` creates and fills a vector of 67'396 `uint64_t` elements, or 539'168 bytes. For 10 peers that would save ~5MB.\r\n\r\nI wonder if it would make sense to delay the creation of `CRollingBloomFilter::data` until it is actually needed (e.g. create it in the first insert, rather than in the constructor, would be changes isolated solely inside `CRollingBloomFilter`). `CRollingBloomFilter` is also used here:\r\n\r\n* `BanMan::m_discouraged`, would benefit from lazy creation because we may never ban anybody, but is just one filter per program instance.\r\n* `Peer::m_addr_known`, looks like if created then it will be certainly used, one per peer.\r\n* `PeerManagerImpl::m_recent_rejects` and `PeerManagerImpl::m_recent_confirmed_transactions`, likely to be used, one per program instance.\r\n* `CNodeState::m_recently_announced_invs`, would benefit like `CNode::TxRelay::filterInventoryKnown`, one per peer.\r\n\r\nMaybe only `CNodeState::m_recently_announced_invs` is worth considering?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/931172782/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/932108560",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-932108560",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
    "id": 932108560,
    "node_id": "IC_kwDOABII5843jtkQ",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-01T10:24:19Z",
    "updated_at": "2021-10-01T10:24:19Z",
    "author_association": "MEMBER",
    "body": "> @vasild  e.g. create it in the first insert, rather than in the constructor\r\n\r\nSee discussion at https://github.com/bitcoin/bitcoin/pull/22778#discussion_r693960652",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/932108560/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/937954634",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-937954634",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
    "id": 937954634,
    "node_id": "IC_kwDOABII58436A1K",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-07T16:25:09Z",
    "updated_at": "2021-10-07T16:25:09Z",
    "author_association": "MEMBER",
    "body": "Thanks for the reviews @naumenkogs and @vasild. I believe I've addressed all of your review comments.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/937954634/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/938450206",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-938450206",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
    "id": 938450206,
    "node_id": "IC_kwDOABII5843750e",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?u=06eb9ae4f9b3f954056098860decccbf1340e40f&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-08T08:30:15Z",
    "updated_at": "2021-10-08T08:30:15Z",
    "author_association": "MEMBER",
    "body": "ACK 7ef58ab5ca3e0652442eaf56c5c91ce192df324a",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/938450206/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949631654",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-949631654",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
    "id": 949631654,
    "node_id": "IC_kwDOABII5844mjqm",
    "user": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?u=d06d2903ce6ad8b9d0c66ef9225fa21adfe22c7f&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasild/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-22T13:27:17Z",
    "updated_at": "2021-10-22T13:27:17Z",
    "author_association": "CONTRIBUTOR",
    "body": "This PR includes #21160. The extra commits that this PR includes, on top of #21160, look good to me. I have some [reservations for #21160](https://github.com/bitcoin/bitcoin/pull/21160#pullrequestreview-733743042), so I skip ACKing this one too.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949631654/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949633314",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-949633314",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
    "id": 949633314,
    "node_id": "IC_kwDOABII5844mkEi",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-22T13:29:17Z",
    "updated_at": "2021-10-22T13:29:17Z",
    "author_association": "MEMBER",
    "body": "Rebased on master",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949633314/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949802803",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-949802803",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
    "id": 949802803,
    "node_id": "IC_kwDOABII5844nNcz",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-22T16:51:34Z",
    "updated_at": "2021-10-22T16:51:34Z",
    "author_association": "MEMBER",
    "body": "rebased",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949802803/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693960652",
    "pull_request_review_id": 736105932,
    "id": 693960652,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5Mzk2MDY1Mg==",
    "diff_hunk": "@@ -2643,10 +2642,17 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        LOCK(peer->m_tx_relay_mutex);\n-        if (peer->m_tx_relay != nullptr) {\n+        // We don't initialize the m_tx_relay data structure if:\n+        // - this is an outbound block-relay-only connection; or\n+        // - fRelay=false and we're not offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)",
    "path": "src/net_processing.cpp",
    "position": 332,
    "original_position": 38,
    "commit_id": "c431a74e4bed4b80d943001c992becfeac304633",
    "original_commit_id": "238ce0b02b1f7ac78c8c0466cef33628c6d49359",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "in 238ce0b02b1f7ac78c8c0466cef33628c6d49359:\r\n\r\nIf it is turned on later, we could keep it a nullptr until then and only initialize if and when we receive a `filter*` message?",
    "created_at": "2021-08-23T13:15:15Z",
    "updated_at": "2021-08-23T13:15:25Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r693960652",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693960652"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r693960652"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693960652/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2674,
    "original_line": 2674,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/694001534",
    "pull_request_review_id": 736162717,
    "id": 694001534,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NDAwMTUzNA==",
    "diff_hunk": "@@ -2643,10 +2642,17 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        LOCK(peer->m_tx_relay_mutex);\n-        if (peer->m_tx_relay != nullptr) {\n+        // We don't initialize the m_tx_relay data structure if:\n+        // - this is an outbound block-relay-only connection; or\n+        // - fRelay=false and we're not offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)",
    "path": "src/net_processing.cpp",
    "position": 332,
    "original_position": 38,
    "commit_id": "c431a74e4bed4b80d943001c992becfeac304633",
    "original_commit_id": "238ce0b02b1f7ac78c8c0466cef33628c6d49359",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Perhaps, but I think it's better to allocate resources for the worst-case scenario up front, rather than try to reduce resource usage and later find out that you need to allocate a new structure.",
    "created_at": "2021-08-23T14:02:54Z",
    "updated_at": "2021-08-23T14:02:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r694001534",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/694001534"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r694001534"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/694001534/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2674,
    "original_line": 2674,
    "side": "RIGHT",
    "in_reply_to_id": 693960652
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719247282",
    "pull_request_review_id": 767644909,
    "id": 719247282,
    "node_id": "PRRC_kwDOABII584q3tey",
    "diff_hunk": "@@ -227,28 +227,45 @@ struct Peer {\n     std::atomic<bool> m_wtxid_relay{false};\n \n     struct TxRelay {\n+        /** Protects m_bloom_filter and the m_relay_txs flag. */\n         mutable RecursiveMutex m_bloom_filter_mutex;\n-        // We use m_relay_txs for two purposes -\n-        // a) it allows us to not relay tx invs before receiving the peer's version message\n-        // b) the peer may tell us in its version message that we should not relay tx invs\n-        //    unless it loads a bloom filter.\n+        /** Whether the peer wishes to receive transaction announements.\n+         *\n+         * This is initially set based on the fRelay flag in the received\n+         * `version` message. If initially set to false, it can only be flipped\n+         * to true if we have offered the peer NODE_BLOOM services and it sends\n+         * us a `filterload` or `filterclear` message. See BIP37. */\n         bool m_relay_txs GUARDED_BY(m_bloom_filter_mutex){false};\n+        /** A bloom filter for which transactions to announce to the peer. See BIP37. */\n         std::unique_ptr<CBloomFilter> m_bloom_filter PT_GUARDED_BY(m_bloom_filter_mutex) GUARDED_BY(m_bloom_filter_mutex){nullptr};\n \n+        /** Protects m_tx_inventory_known and the m_send_mempool flag */\n         mutable RecursiveMutex m_tx_inventory_mutex;\n+        /** A filter of all the txids and wtxids that the peer has announced to\n+         *  us or we have announced to the peer. We use this to avoid announcing\n+         *  the same txid/wtxid to a peer that already has the transaction. */\n         CRollingBloomFilter m_tx_inventory_known_filter GUARDED_BY(m_tx_inventory_mutex){50000, 0.000001};\n-        // Set of transaction ids we still have to announce.\n-        // They are sorted by the mempool before relay, so the order is not important.\n+        /** Set of transaction ids we still have to announce (txid for\n+         *  non-wtxid-relay peers, wtxid for wtxid-relay peers). We use the\n+         *  mempool to sort transactions in dependency order before relay, so\n+         *  this does not have to be sorted. */",
    "path": "src/net_processing.cpp",
    "position": 29,
    "original_position": 31,
    "commit_id": "c431a74e4bed4b80d943001c992becfeac304633",
    "original_commit_id": "48c896ee7fa504690f15dea7c6c61797500c1add",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "At first I was thinking we could leave a TODO here for switching to unordered_set, but when I'm looking how it's used, it seems we can just leave it like this, right?",
    "created_at": "2021-09-30T09:53:26Z",
    "updated_at": "2021-09-30T09:53:27Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r719247282",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719247282"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r719247282"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719247282/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 252,
    "original_line": 252,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719250125",
    "pull_request_review_id": 767648820,
    "id": 719250125,
    "node_id": "PRRC_kwDOABII584q3uLN",
    "diff_hunk": "@@ -227,28 +227,45 @@ struct Peer {\n     std::atomic<bool> m_wtxid_relay{false};\n \n     struct TxRelay {\n+        /** Protects m_bloom_filter and the m_relay_txs flag. */\n         mutable RecursiveMutex m_bloom_filter_mutex;\n-        // We use m_relay_txs for two purposes -\n-        // a) it allows us to not relay tx invs before receiving the peer's version message\n-        // b) the peer may tell us in its version message that we should not relay tx invs\n-        //    unless it loads a bloom filter.\n+        /** Whether the peer wishes to receive transaction announements.\n+         *\n+         * This is initially set based on the fRelay flag in the received\n+         * `version` message. If initially set to false, it can only be flipped\n+         * to true if we have offered the peer NODE_BLOOM services and it sends\n+         * us a `filterload` or `filterclear` message. See BIP37. */\n         bool m_relay_txs GUARDED_BY(m_bloom_filter_mutex){false};\n+        /** A bloom filter for which transactions to announce to the peer. See BIP37. */\n         std::unique_ptr<CBloomFilter> m_bloom_filter PT_GUARDED_BY(m_bloom_filter_mutex) GUARDED_BY(m_bloom_filter_mutex){nullptr};\n \n+        /** Protects m_tx_inventory_known and the m_send_mempool flag */\n         mutable RecursiveMutex m_tx_inventory_mutex;\n+        /** A filter of all the txids and wtxids that the peer has announced to\n+         *  us or we have announced to the peer. We use this to avoid announcing\n+         *  the same txid/wtxid to a peer that already has the transaction. */\n         CRollingBloomFilter m_tx_inventory_known_filter GUARDED_BY(m_tx_inventory_mutex){50000, 0.000001};\n-        // Set of transaction ids we still have to announce.\n-        // They are sorted by the mempool before relay, so the order is not important.\n+        /** Set of transaction ids we still have to announce (txid for\n+         *  non-wtxid-relay peers, wtxid for wtxid-relay peers). We use the\n+         *  mempool to sort transactions in dependency order before relay, so\n+         *  this does not have to be sorted. */\n         std::set<uint256> m_tx_inventory_to_send;\n-        // Used for BIP35 mempool sending\n+        /** Whether the peer has requested us to send our complete mempool. Only\n+         *  permitted if the peer has NetPermissionFlags::Mempool. See BIP35. */\n         bool m_send_mempool GUARDED_BY(m_tx_inventory_mutex){false};\n-        // Last time a \"MEMPOOL\" request was serviced.\n+        /** The last time a BIP35 `mempool` request was serviced. */\n         std::atomic<std::chrono::seconds> m_last_mempool_req{0s};\n+        /** The next time after which we will send an `inv` message containing\n+         *  transaction announcements to this peer. */\n         std::chrono::microseconds m_next_inv_send_time{0};\n \n-        /** Minimum fee rate with which to filter inv's to this node */\n+        /** Minimum fee rate with which to filter transaction announcements to this node */",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 45,
    "commit_id": "c431a74e4bed4b80d943001c992becfeac304633",
    "original_commit_id": "48c896ee7fa504690f15dea7c6c61797500c1add",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This also could mention BIP133, or perhaps be flipped with the next variable referencing it :)",
    "created_at": "2021-09-30T09:57:08Z",
    "updated_at": "2021-09-30T09:57:15Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r719250125",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719250125"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r719250125"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719250125/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 262,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719251357",
    "pull_request_review_id": 767650419,
    "id": 719251357,
    "node_id": "PRRC_kwDOABII584q3ued",
    "diff_hunk": "@@ -227,28 +227,45 @@ struct Peer {\n     std::atomic<bool> m_wtxid_relay{false};\n \n     struct TxRelay {\n+        /** Protects m_bloom_filter and the m_relay_txs flag. */\n         mutable RecursiveMutex m_bloom_filter_mutex;\n-        // We use m_relay_txs for two purposes -\n-        // a) it allows us to not relay tx invs before receiving the peer's version message\n-        // b) the peer may tell us in its version message that we should not relay tx invs\n-        //    unless it loads a bloom filter.\n+        /** Whether the peer wishes to receive transaction announements.\n+         *\n+         * This is initially set based on the fRelay flag in the received\n+         * `version` message. If initially set to false, it can only be flipped\n+         * to true if we have offered the peer NODE_BLOOM services and it sends\n+         * us a `filterload` or `filterclear` message. See BIP37. */\n         bool m_relay_txs GUARDED_BY(m_bloom_filter_mutex){false};\n+        /** A bloom filter for which transactions to announce to the peer. See BIP37. */\n         std::unique_ptr<CBloomFilter> m_bloom_filter PT_GUARDED_BY(m_bloom_filter_mutex) GUARDED_BY(m_bloom_filter_mutex){nullptr};\n \n+        /** Protects m_tx_inventory_known and the m_send_mempool flag */\n         mutable RecursiveMutex m_tx_inventory_mutex;\n+        /** A filter of all the txids and wtxids that the peer has announced to\n+         *  us or we have announced to the peer. We use this to avoid announcing\n+         *  the same txid/wtxid to a peer that already has the transaction. */\n         CRollingBloomFilter m_tx_inventory_known_filter GUARDED_BY(m_tx_inventory_mutex){50000, 0.000001};\n-        // Set of transaction ids we still have to announce.\n-        // They are sorted by the mempool before relay, so the order is not important.\n+        /** Set of transaction ids we still have to announce (txid for\n+         *  non-wtxid-relay peers, wtxid for wtxid-relay peers). We use the\n+         *  mempool to sort transactions in dependency order before relay, so\n+         *  this does not have to be sorted. */\n         std::set<uint256> m_tx_inventory_to_send;\n-        // Used for BIP35 mempool sending\n+        /** Whether the peer has requested us to send our complete mempool. Only\n+         *  permitted if the peer has NetPermissionFlags::Mempool. See BIP35. */\n         bool m_send_mempool GUARDED_BY(m_tx_inventory_mutex){false};\n-        // Last time a \"MEMPOOL\" request was serviced.\n+        /** The last time a BIP35 `mempool` request was serviced. */\n         std::atomic<std::chrono::seconds> m_last_mempool_req{0s};\n+        /** The next time after which we will send an `inv` message containing\n+         *  transaction announcements to this peer. */\n         std::chrono::microseconds m_next_inv_send_time{0};\n \n-        /** Minimum fee rate with which to filter inv's to this node */\n+        /** Minimum fee rate with which to filter transaction announcements to this node */\n         std::atomic<CAmount> m_fee_filter_received{0};\n+        /** Fee rate below which we requested our peer not send us transaction\n+         *  announcements. It is *not* a p2p protocol violation for the peer to\n+         *  send us transactions with a lower fee rate than this. See BIP133. */\n         CAmount m_fee_filter_sent{0};\n+        /** The next time after which we will send a `feefilter` message to this peer. */",
    "path": "src/net_processing.cpp",
    "position": 46,
    "original_position": 51,
    "commit_id": "c431a74e4bed4b80d943001c992becfeac304633",
    "original_commit_id": "48c896ee7fa504690f15dea7c6c61797500c1add",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think this comment is not very useful currently w.r.t. why we would update feefilter at all, and why it has to be scheduled.",
    "created_at": "2021-09-30T09:58:41Z",
    "updated_at": "2021-09-30T09:58:41Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r719251357",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719251357"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r719251357"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719251357/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 269,
    "original_line": 269,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719259735",
    "pull_request_review_id": 767661806,
    "id": 719259735,
    "node_id": "PRRC_kwDOABII584q3whX",
    "diff_hunk": "@@ -2643,10 +2642,17 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        LOCK(peer->m_tx_relay_mutex);\n-        if (peer->m_tx_relay != nullptr) {\n+        // We don't initialize the m_tx_relay data structure if:\n+        // - this is an outbound block-relay-only connection; or\n+        // - fRelay=false and we're not offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)",
    "path": "src/net_processing.cpp",
    "position": 332,
    "original_position": 38,
    "commit_id": "c431a74e4bed4b80d943001c992becfeac304633",
    "original_commit_id": "238ce0b02b1f7ac78c8c0466cef33628c6d49359",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": ">rather than try to reduce resource usage and later find out that you need to allocate a new structure\r\n\r\nWhat exactly is difficult about this?",
    "created_at": "2021-09-30T10:09:56Z",
    "updated_at": "2021-09-30T10:09:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r719259735",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719259735"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r719259735"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719259735/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2674,
    "original_line": 2674,
    "side": "RIGHT",
    "in_reply_to_id": 693960652
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719262565",
    "pull_request_review_id": 767665482,
    "id": 719262565,
    "node_id": "PRRC_kwDOABII584q3xNl",
    "diff_hunk": "@@ -2658,8 +2657,15 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        {\n+        // We don't initialize the m_tx_relay data structure if:\n+        // - this is an outbound block-relay-only connection; or\n+        // - fRelay=false and we're not offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)\n+        const bool disable_tx_relay = pfrom.IsBlockOnlyConn() ||",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 39,
    "commit_id": "c431a74e4bed4b80d943001c992becfeac304633",
    "original_commit_id": "bb89747af06ab39ce8ed7b595535f43129741541",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Inverted this could be:\r\n`const bool enable_tx_relay = !pfrom.IsBlockOnlyConn() && (fRelay || (pfrom.GetLocalServices() & NODE_BLOOM))`.\r\n\r\nDon't you think it's better?\r\n\r\n",
    "created_at": "2021-09-30T10:13:45Z",
    "updated_at": "2021-09-30T10:13:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r719262565",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719262565"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r719262565"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719262565/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2664,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720133129",
    "pull_request_review_id": 768805349,
    "id": 720133129,
    "node_id": "PRRC_kwDOABII584q7FwJ",
    "diff_hunk": "@@ -2643,10 +2642,17 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        LOCK(peer->m_tx_relay_mutex);\n-        if (peer->m_tx_relay != nullptr) {\n+        // We don't initialize the m_tx_relay data structure if:\n+        // - this is an outbound block-relay-only connection; or\n+        // - fRelay=false and we're not offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)",
    "path": "src/net_processing.cpp",
    "position": 332,
    "original_position": 38,
    "commit_id": "c431a74e4bed4b80d943001c992becfeac304633",
    "original_commit_id": "238ce0b02b1f7ac78c8c0466cef33628c6d49359",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> What exactly is difficult about this?\r\n\r\nI think I agree with John that there is little benefit (or even a risk) when giving remote peers the option to force you to allocate MBs of memory by sending a single msg, instead of allocating the memory on startup/creation of the connection.",
    "created_at": "2021-10-01T10:27:55Z",
    "updated_at": "2021-10-01T10:27:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r720133129",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720133129"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r720133129"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720133129/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2674,
    "original_line": 2674,
    "side": "RIGHT",
    "in_reply_to_id": 693960652
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720168415",
    "pull_request_review_id": 768852157,
    "id": 720168415,
    "node_id": "PRRC_kwDOABII584q7OXf",
    "diff_hunk": "@@ -2643,10 +2642,17 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        LOCK(peer->m_tx_relay_mutex);\n-        if (peer->m_tx_relay != nullptr) {\n+        // We don't initialize the m_tx_relay data structure if:\n+        // - this is an outbound block-relay-only connection; or\n+        // - fRelay=false and we're not offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)",
    "path": "src/net_processing.cpp",
    "position": 332,
    "original_position": 38,
    "commit_id": "c431a74e4bed4b80d943001c992becfeac304633",
    "original_commit_id": "238ce0b02b1f7ac78c8c0466cef33628c6d49359",
    "user": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasild/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Hmm, allocating upfront is like giving a remote peer the option and he always exercises it immediately after connecting, no?\r\n\r\nIf there is a chance that the peer would not exercise the option (not send `filter*` message) and we never allocate the MBs, that is to be preferred?",
    "created_at": "2021-10-01T11:29:34Z",
    "updated_at": "2021-10-01T11:33:24Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r720168415",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720168415"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r720168415"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720168415/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2674,
    "original_line": 2674,
    "side": "RIGHT",
    "in_reply_to_id": 693960652
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720171634",
    "pull_request_review_id": 768856490,
    "id": 720171634,
    "node_id": "PRRC_kwDOABII584q7PJy",
    "diff_hunk": "@@ -2643,10 +2642,17 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        LOCK(peer->m_tx_relay_mutex);\n-        if (peer->m_tx_relay != nullptr) {\n+        // We don't initialize the m_tx_relay data structure if:\n+        // - this is an outbound block-relay-only connection; or\n+        // - fRelay=false and we're not offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)",
    "path": "src/net_processing.cpp",
    "position": 332,
    "original_position": 38,
    "commit_id": "c431a74e4bed4b80d943001c992becfeac304633",
    "original_commit_id": "238ce0b02b1f7ac78c8c0466cef33628c6d49359",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yes, and I think this is preferable because there are less (late) surprises. Neither on the live network, nor when developing. For example, `massif` will display the real usage from the start. Or, imagine someone under-estimating the resource usage and thus increasing the maxconnections count, then running into OOM later on.",
    "created_at": "2021-10-01T11:35:31Z",
    "updated_at": "2021-10-01T11:35:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r720171634",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720171634"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r720171634"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720171634/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2674,
    "original_line": 2674,
    "side": "RIGHT",
    "in_reply_to_id": 693960652
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720184968",
    "pull_request_review_id": 768874295,
    "id": 720184968,
    "node_id": "PRRC_kwDOABII584q7SaI",
    "diff_hunk": "@@ -2643,10 +2642,17 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        LOCK(peer->m_tx_relay_mutex);\n-        if (peer->m_tx_relay != nullptr) {\n+        // We don't initialize the m_tx_relay data structure if:\n+        // - this is an outbound block-relay-only connection; or\n+        // - fRelay=false and we're not offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)",
    "path": "src/net_processing.cpp",
    "position": 332,
    "original_position": 38,
    "commit_id": "c431a74e4bed4b80d943001c992becfeac304633",
    "original_commit_id": "238ce0b02b1f7ac78c8c0466cef33628c6d49359",
    "user": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasild/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "The counter scenario is somebody running into OOM because MBs of memory were allocated needlessly (allocated but never used because the peer(s) never sent `filter*`).",
    "created_at": "2021-10-01T11:58:48Z",
    "updated_at": "2021-10-01T11:58:48Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r720184968",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720184968"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r720184968"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720184968/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2674,
    "original_line": 2674,
    "side": "RIGHT",
    "in_reply_to_id": 693960652
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720200693",
    "pull_request_review_id": 768895812,
    "id": 720200693,
    "node_id": "PRRC_kwDOABII584q7WP1",
    "diff_hunk": "@@ -2643,10 +2642,17 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        LOCK(peer->m_tx_relay_mutex);\n-        if (peer->m_tx_relay != nullptr) {\n+        // We don't initialize the m_tx_relay data structure if:\n+        // - this is an outbound block-relay-only connection; or\n+        // - fRelay=false and we're not offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)",
    "path": "src/net_processing.cpp",
    "position": 332,
    "original_position": 38,
    "commit_id": "c431a74e4bed4b80d943001c992becfeac304633",
    "original_commit_id": "238ce0b02b1f7ac78c8c0466cef33628c6d49359",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think if you want to reduce memory usage, you should disable bip37, not enable it with the hope that no one (or only a small fraction of your incoming peers) will use it.",
    "created_at": "2021-10-01T12:24:03Z",
    "updated_at": "2021-10-01T12:24:03Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r720200693",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720200693"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r720200693"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720200693/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2674,
    "original_line": 2674,
    "side": "RIGHT",
    "in_reply_to_id": 693960652
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724043654",
    "pull_request_review_id": 773710857,
    "id": 724043654,
    "node_id": "PRRC_kwDOABII584rKAeG",
    "diff_hunk": "@@ -2590,9 +2657,18 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        if (pfrom.m_tx_relay != nullptr) {\n-            LOCK(pfrom.m_tx_relay->cs_filter);\n-            pfrom.m_tx_relay->fRelayTxes = fRelay; // set to true after we get the first filter* message\n+        // We don't initialize the m_tx_relay data structure if:\n+        // - this is an outbound block-relay-only connection; or\n+        // - fRelay=false and we're not offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)\n+        const bool disable_tx_relay = pfrom.IsBlockOnlyConn() ||\n+                                      (!fRelay && !(pfrom.GetLocalServices() & NODE_BLOOM));\n+        if (!disable_tx_relay) {\n+            LOCK(peer->m_tx_relay_mutex);\n+            peer->m_tx_relay = std::make_unique<Peer::TxRelay>();",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 337,
    "commit_id": "c431a74e4bed4b80d943001c992becfeac304633",
    "original_commit_id": "bb89747af06ab39ce8ed7b595535f43129741541",
    "user": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasild/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "If this can be executed concurrently by two threads, then the allocation may happen twice - thread1:lock,alloc,unlock, thread2:lock,alloc,unlock.\r\n\r\nIf this cannot be executed concurrently then the mutex is not needed. I think this is the case because message processing is single threaded and we would have quit earlier if we received a second VERSION message.\r\n\r\nIf, for some reason, the mutex is deemed necessary then the pattern should be:\r\n```cpp\r\nLOCK(peer->m_tx_relay_mutex);\r\nif (peer->m_tx_relay != nullptr) {\r\n    peer->m_tx_relay = std::make_unique<Peer::TxRelay>();\r\n}\r\n// unlock\r\n```",
    "created_at": "2021-10-07T10:13:50Z",
    "updated_at": "2021-10-07T10:13:51Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724043654",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724043654"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724043654"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724043654/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 2667,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 2668,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724189368",
    "pull_request_review_id": 773920354,
    "id": 724189368,
    "node_id": "PRRC_kwDOABII584rKkC4",
    "diff_hunk": "@@ -227,28 +227,45 @@ struct Peer {\n     std::atomic<bool> m_wtxid_relay{false};\n \n     struct TxRelay {\n+        /** Protects m_bloom_filter and the m_relay_txs flag. */\n         mutable RecursiveMutex m_bloom_filter_mutex;\n-        // We use m_relay_txs for two purposes -\n-        // a) it allows us to not relay tx invs before receiving the peer's version message\n-        // b) the peer may tell us in its version message that we should not relay tx invs\n-        //    unless it loads a bloom filter.\n+        /** Whether the peer wishes to receive transaction announements.\n+         *\n+         * This is initially set based on the fRelay flag in the received\n+         * `version` message. If initially set to false, it can only be flipped\n+         * to true if we have offered the peer NODE_BLOOM services and it sends\n+         * us a `filterload` or `filterclear` message. See BIP37. */\n         bool m_relay_txs GUARDED_BY(m_bloom_filter_mutex){false};\n+        /** A bloom filter for which transactions to announce to the peer. See BIP37. */\n         std::unique_ptr<CBloomFilter> m_bloom_filter PT_GUARDED_BY(m_bloom_filter_mutex) GUARDED_BY(m_bloom_filter_mutex){nullptr};\n \n+        /** Protects m_tx_inventory_known and the m_send_mempool flag */\n         mutable RecursiveMutex m_tx_inventory_mutex;\n+        /** A filter of all the txids and wtxids that the peer has announced to\n+         *  us or we have announced to the peer. We use this to avoid announcing\n+         *  the same txid/wtxid to a peer that already has the transaction. */\n         CRollingBloomFilter m_tx_inventory_known_filter GUARDED_BY(m_tx_inventory_mutex){50000, 0.000001};\n-        // Set of transaction ids we still have to announce.\n-        // They are sorted by the mempool before relay, so the order is not important.\n+        /** Set of transaction ids we still have to announce (txid for\n+         *  non-wtxid-relay peers, wtxid for wtxid-relay peers). We use the\n+         *  mempool to sort transactions in dependency order before relay, so\n+         *  this does not have to be sorted. */",
    "path": "src/net_processing.cpp",
    "position": 29,
    "original_position": 31,
    "commit_id": "c431a74e4bed4b80d943001c992becfeac304633",
    "original_commit_id": "48c896ee7fa504690f15dea7c6c61797500c1add",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think that the size of this set is typically small enough that the complexity of insertion (lg(n) -vs- constant for an unordered_set) is not important.",
    "created_at": "2021-10-07T13:38:09Z",
    "updated_at": "2021-10-07T13:38:10Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724189368",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724189368"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724189368"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724189368/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 252,
    "original_line": 252,
    "side": "RIGHT",
    "in_reply_to_id": 719247282
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724190716",
    "pull_request_review_id": 773922307,
    "id": 724190716,
    "node_id": "PRRC_kwDOABII584rKkX8",
    "diff_hunk": "@@ -227,28 +227,45 @@ struct Peer {\n     std::atomic<bool> m_wtxid_relay{false};\n \n     struct TxRelay {\n+        /** Protects m_bloom_filter and the m_relay_txs flag. */\n         mutable RecursiveMutex m_bloom_filter_mutex;\n-        // We use m_relay_txs for two purposes -\n-        // a) it allows us to not relay tx invs before receiving the peer's version message\n-        // b) the peer may tell us in its version message that we should not relay tx invs\n-        //    unless it loads a bloom filter.\n+        /** Whether the peer wishes to receive transaction announements.\n+         *\n+         * This is initially set based on the fRelay flag in the received\n+         * `version` message. If initially set to false, it can only be flipped\n+         * to true if we have offered the peer NODE_BLOOM services and it sends\n+         * us a `filterload` or `filterclear` message. See BIP37. */\n         bool m_relay_txs GUARDED_BY(m_bloom_filter_mutex){false};\n+        /** A bloom filter for which transactions to announce to the peer. See BIP37. */\n         std::unique_ptr<CBloomFilter> m_bloom_filter PT_GUARDED_BY(m_bloom_filter_mutex) GUARDED_BY(m_bloom_filter_mutex){nullptr};\n \n+        /** Protects m_tx_inventory_known and the m_send_mempool flag */\n         mutable RecursiveMutex m_tx_inventory_mutex;\n+        /** A filter of all the txids and wtxids that the peer has announced to\n+         *  us or we have announced to the peer. We use this to avoid announcing\n+         *  the same txid/wtxid to a peer that already has the transaction. */\n         CRollingBloomFilter m_tx_inventory_known_filter GUARDED_BY(m_tx_inventory_mutex){50000, 0.000001};\n-        // Set of transaction ids we still have to announce.\n-        // They are sorted by the mempool before relay, so the order is not important.\n+        /** Set of transaction ids we still have to announce (txid for\n+         *  non-wtxid-relay peers, wtxid for wtxid-relay peers). We use the\n+         *  mempool to sort transactions in dependency order before relay, so\n+         *  this does not have to be sorted. */\n         std::set<uint256> m_tx_inventory_to_send;\n-        // Used for BIP35 mempool sending\n+        /** Whether the peer has requested us to send our complete mempool. Only\n+         *  permitted if the peer has NetPermissionFlags::Mempool. See BIP35. */\n         bool m_send_mempool GUARDED_BY(m_tx_inventory_mutex){false};\n-        // Last time a \"MEMPOOL\" request was serviced.\n+        /** The last time a BIP35 `mempool` request was serviced. */\n         std::atomic<std::chrono::seconds> m_last_mempool_req{0s};\n+        /** The next time after which we will send an `inv` message containing\n+         *  transaction announcements to this peer. */\n         std::chrono::microseconds m_next_inv_send_time{0};\n \n-        /** Minimum fee rate with which to filter inv's to this node */\n+        /** Minimum fee rate with which to filter transaction announcements to this node */",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 45,
    "commit_id": "c431a74e4bed4b80d943001c992becfeac304633",
    "original_commit_id": "48c896ee7fa504690f15dea7c6c61797500c1add",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done!",
    "created_at": "2021-10-07T13:39:38Z",
    "updated_at": "2021-10-07T13:39:38Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724190716",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724190716"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724190716"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724190716/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 262,
    "side": "RIGHT",
    "in_reply_to_id": 719250125
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724191876",
    "pull_request_review_id": 773923815,
    "id": 724191876,
    "node_id": "PRRC_kwDOABII584rKkqE",
    "diff_hunk": "@@ -227,28 +227,45 @@ struct Peer {\n     std::atomic<bool> m_wtxid_relay{false};\n \n     struct TxRelay {\n+        /** Protects m_bloom_filter and the m_relay_txs flag. */\n         mutable RecursiveMutex m_bloom_filter_mutex;\n-        // We use m_relay_txs for two purposes -\n-        // a) it allows us to not relay tx invs before receiving the peer's version message\n-        // b) the peer may tell us in its version message that we should not relay tx invs\n-        //    unless it loads a bloom filter.\n+        /** Whether the peer wishes to receive transaction announements.\n+         *\n+         * This is initially set based on the fRelay flag in the received\n+         * `version` message. If initially set to false, it can only be flipped\n+         * to true if we have offered the peer NODE_BLOOM services and it sends\n+         * us a `filterload` or `filterclear` message. See BIP37. */\n         bool m_relay_txs GUARDED_BY(m_bloom_filter_mutex){false};\n+        /** A bloom filter for which transactions to announce to the peer. See BIP37. */\n         std::unique_ptr<CBloomFilter> m_bloom_filter PT_GUARDED_BY(m_bloom_filter_mutex) GUARDED_BY(m_bloom_filter_mutex){nullptr};\n \n+        /** Protects m_tx_inventory_known and the m_send_mempool flag */\n         mutable RecursiveMutex m_tx_inventory_mutex;\n+        /** A filter of all the txids and wtxids that the peer has announced to\n+         *  us or we have announced to the peer. We use this to avoid announcing\n+         *  the same txid/wtxid to a peer that already has the transaction. */\n         CRollingBloomFilter m_tx_inventory_known_filter GUARDED_BY(m_tx_inventory_mutex){50000, 0.000001};\n-        // Set of transaction ids we still have to announce.\n-        // They are sorted by the mempool before relay, so the order is not important.\n+        /** Set of transaction ids we still have to announce (txid for\n+         *  non-wtxid-relay peers, wtxid for wtxid-relay peers). We use the\n+         *  mempool to sort transactions in dependency order before relay, so\n+         *  this does not have to be sorted. */\n         std::set<uint256> m_tx_inventory_to_send;\n-        // Used for BIP35 mempool sending\n+        /** Whether the peer has requested us to send our complete mempool. Only\n+         *  permitted if the peer has NetPermissionFlags::Mempool. See BIP35. */\n         bool m_send_mempool GUARDED_BY(m_tx_inventory_mutex){false};\n-        // Last time a \"MEMPOOL\" request was serviced.\n+        /** The last time a BIP35 `mempool` request was serviced. */\n         std::atomic<std::chrono::seconds> m_last_mempool_req{0s};\n+        /** The next time after which we will send an `inv` message containing\n+         *  transaction announcements to this peer. */\n         std::chrono::microseconds m_next_inv_send_time{0};\n \n-        /** Minimum fee rate with which to filter inv's to this node */\n+        /** Minimum fee rate with which to filter transaction announcements to this node */\n         std::atomic<CAmount> m_fee_filter_received{0};\n+        /** Fee rate below which we requested our peer not send us transaction\n+         *  announcements. It is *not* a p2p protocol violation for the peer to\n+         *  send us transactions with a lower fee rate than this. See BIP133. */\n         CAmount m_fee_filter_sent{0};\n+        /** The next time after which we will send a `feefilter` message to this peer. */",
    "path": "src/net_processing.cpp",
    "position": 46,
    "original_position": 51,
    "commit_id": "c431a74e4bed4b80d943001c992becfeac304633",
    "original_commit_id": "48c896ee7fa504690f15dea7c6c61797500c1add",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think that kind of comment would be more at home on or in the `MaybeSendFeefilter()` function.",
    "created_at": "2021-10-07T13:40:47Z",
    "updated_at": "2021-10-07T13:40:47Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724191876",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724191876"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724191876"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724191876/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 269,
    "original_line": 269,
    "side": "RIGHT",
    "in_reply_to_id": 719251357
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724195101",
    "pull_request_review_id": 773928668,
    "id": 724195101,
    "node_id": "PRRC_kwDOABII584rKlcd",
    "diff_hunk": "@@ -2658,8 +2657,15 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        {\n+        // We don't initialize the m_tx_relay data structure if:\n+        // - this is an outbound block-relay-only connection; or\n+        // - fRelay=false and we're not offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)\n+        const bool disable_tx_relay = pfrom.IsBlockOnlyConn() ||",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 39,
    "commit_id": "c431a74e4bed4b80d943001c992becfeac304633",
    "original_commit_id": "bb89747af06ab39ce8ed7b595535f43129741541",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I actually think it's clearer this way, since it matches the english language comment above, and enabling tx relay is the default. I tried inverting the boolean, but it didn't seem any better to me.\r\n\r\nThat said, if other contributors also think it'd be clearer to invert the boolean logic here, I'm happy to switch it.",
    "created_at": "2021-10-07T13:44:25Z",
    "updated_at": "2021-10-07T13:44:26Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724195101",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724195101"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724195101"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724195101/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2664,
    "side": "RIGHT",
    "in_reply_to_id": 719262565
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724208016",
    "pull_request_review_id": 773947269,
    "id": 724208016,
    "node_id": "PRRC_kwDOABII584rKomQ",
    "diff_hunk": "@@ -2658,8 +2657,15 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        {\n+        // We don't initialize the m_tx_relay data structure if:\n+        // - this is an outbound block-relay-only connection; or\n+        // - fRelay=false and we're not offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)\n+        const bool disable_tx_relay = pfrom.IsBlockOnlyConn() ||",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 39,
    "commit_id": "c431a74e4bed4b80d943001c992becfeac304633",
    "original_commit_id": "bb89747af06ab39ce8ed7b595535f43129741541",
    "user": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasild/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think `if (enabled)` is clearer than `if (!disabled)`. @naumenkogs's variant has less `!`. Can the English comment can be reworded: we only initialize this if not block-only and ...?",
    "created_at": "2021-10-07T13:58:03Z",
    "updated_at": "2021-10-07T13:58:03Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724208016",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724208016"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724208016"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724208016/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2664,
    "side": "RIGHT",
    "in_reply_to_id": 719262565
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724212963",
    "pull_request_review_id": 773954403,
    "id": 724212963,
    "node_id": "PRRC_kwDOABII584rKpzj",
    "diff_hunk": "@@ -2590,9 +2657,18 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        if (pfrom.m_tx_relay != nullptr) {\n-            LOCK(pfrom.m_tx_relay->cs_filter);\n-            pfrom.m_tx_relay->fRelayTxes = fRelay; // set to true after we get the first filter* message\n+        // We don't initialize the m_tx_relay data structure if:\n+        // - this is an outbound block-relay-only connection; or\n+        // - fRelay=false and we're not offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)\n+        const bool disable_tx_relay = pfrom.IsBlockOnlyConn() ||\n+                                      (!fRelay && !(pfrom.GetLocalServices() & NODE_BLOOM));\n+        if (!disable_tx_relay) {\n+            LOCK(peer->m_tx_relay_mutex);\n+            peer->m_tx_relay = std::make_unique<Peer::TxRelay>();",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 337,
    "commit_id": "c431a74e4bed4b80d943001c992becfeac304633",
    "original_commit_id": "bb89747af06ab39ce8ed7b595535f43129741541",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "It's impossible for the `if (msg_type == NetMsgType::VERSION) {` block of code to be executed  more than once, so it would be logically impossible for the `m_tx_relay` member to be allocated twice. However, I've updated the code to check for nullness first so it's immediately obvious from looking at this code that it can't be allocated twice.",
    "created_at": "2021-10-07T14:03:00Z",
    "updated_at": "2021-10-07T14:03:01Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724212963",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724212963"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724212963"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724212963/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 2667,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 2668,
    "side": "RIGHT",
    "in_reply_to_id": 724043654
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724339822",
    "pull_request_review_id": 774135472,
    "id": 724339822,
    "node_id": "PRRC_kwDOABII584rLIxu",
    "diff_hunk": "@@ -2658,8 +2657,15 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        {\n+        // We don't initialize the m_tx_relay data structure if:\n+        // - this is an outbound block-relay-only connection; or\n+        // - fRelay=false and we're not offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)\n+        const bool disable_tx_relay = pfrom.IsBlockOnlyConn() ||",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 39,
    "commit_id": "c431a74e4bed4b80d943001c992becfeac304633",
    "original_commit_id": "bb89747af06ab39ce8ed7b595535f43129741541",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done!",
    "created_at": "2021-10-07T16:22:26Z",
    "updated_at": "2021-10-07T16:22:27Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724339822",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724339822"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724339822"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724339822/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2664,
    "side": "RIGHT",
    "in_reply_to_id": 719262565
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724341411",
    "pull_request_review_id": 774137749,
    "id": 724341411,
    "node_id": "PRRC_kwDOABII584rLJKj",
    "diff_hunk": "@@ -2643,10 +2642,17 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        LOCK(peer->m_tx_relay_mutex);\n-        if (peer->m_tx_relay != nullptr) {\n+        // We don't initialize the m_tx_relay data structure if:\n+        // - this is an outbound block-relay-only connection; or\n+        // - fRelay=false and we're not offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)",
    "path": "src/net_processing.cpp",
    "position": 332,
    "original_position": 38,
    "commit_id": "c431a74e4bed4b80d943001c992becfeac304633",
    "original_commit_id": "238ce0b02b1f7ac78c8c0466cef33628c6d49359",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I agree with @MarcoFalke that if memory consumption is a concern, then you shouldn't enable BIP37 bloom filters for public peers.",
    "created_at": "2021-10-07T16:24:26Z",
    "updated_at": "2021-10-07T16:24:26Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724341411",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724341411"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r724341411"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/724341411/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2674,
    "original_line": 2674,
    "side": "RIGHT",
    "in_reply_to_id": 693960652
  }
]