MarcoFalke,2021-04-14 14:50:08,"cr ACK 89cfa592df3f8c27ee8c8ebd81afcaa45d3c60ca if CI is green\n\n\nLocally I am trying to reproduce the libevent race, but I fail to do so on clang-12. Maybe this fixed itself?",https://github.com/bitcoin/bitcoin/pull/21680#issuecomment-819578341,819578341,
hebasto,2021-04-14 15:29:14,"> Locally I am trying to reproduce the libevent race, but I fail to do so on clang-12. Maybe this fixed itself?\n\nThe same for me. Looking into https://github.com/llvm/llvm-project/blob/main/compiler-rt/lib/tsan/rtl/tsan_interceptors_posix.cpp does not reveal obvious changes that could fix this issue. The changes that directly touch `epoll` parts are years old.",https://github.com/bitcoin/bitcoin/pull/21680#issuecomment-819608999,819608999,
DrahtBot,2021-04-14 20:45:10,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #15719 (Wallet passive startup by ryanofsky)\n\nIf you consider this pull request important, please also help to review th",https://github.com/bitcoin/bitcoin/pull/21680#issuecomment-819820047,819820047,
MarcoFalke,2021-04-15 05:37:28,"cr ACK 83507dd1729cdc10c5f57725c544a462614c2568 ci is green\n\nwill run locally a bit",https://github.com/bitcoin/bitcoin/pull/21680#issuecomment-820128364,820128364,
MarcoFalke,2021-04-15 05:59:18,"Sorry, still doesn't pass locally:\n\n:man_shrugging: \n\n```\n==================\nWARNING: ThreadSanitizer: data race (pid=469770)\n  Write of size 8 at 0x7b20004eaa60 by thread T13 (mutexes: write M131785, write M131813):\n    #0 memcpy <null> (bitcoind+0x9554e)\n    #1 __lock_getobj <null> (bitcoind+0x9e14b4)\n    #2 bool DatabaseBatch::Exists<std::__1::basic_string<char, std::__1::ch",https://github.com/bitcoin/bitcoin/pull/21680#issuecomment-820137854,820137854,
hebasto,2021-04-15 06:06:30,"Thanks @MarcoFalke for testing!\n\nClosing.",https://github.com/bitcoin/bitcoin/pull/21680#issuecomment-820141285,820141285,
MarcoFalke,2021-04-15 08:10:16,"Maybe I was doing something wrong, because the ci did seem to pass on all commits",https://github.com/bitcoin/bitcoin/pull/21680#issuecomment-820217548,820217548,
MarcoFalke,2021-04-15 08:11:42,"Ah, nvm. It failed on epoll_ctl https://cirrus-ci.com/task/6612431473475584?logs=ci#L3559",https://github.com/bitcoin/bitcoin/pull/21680#issuecomment-820218513,820218513,
MarcoFalke,2021-04-14 14:31:14,Would it help to build depends with instrumentation?,https://github.com/bitcoin/bitcoin/pull/21680#discussion_r613301084,613301084,test/sanitizer_suppressions/tsan
hebasto,2021-04-14 14:33:09,Good question. Did not try it yet.,https://github.com/bitcoin/bitcoin/pull/21680#discussion_r613302755,613302755,test/sanitizer_suppressions/tsan
hebasto,2021-04-14 14:38:09,"> Would it help to build depends with instrumentation?\n\nWe could end with suppressions in that libraries. It is very plausible for the old Berkeley DB.\nI don't think we really want it, no?",https://github.com/bitcoin/bitcoin/pull/21680#discussion_r613307171,613307171,test/sanitizer_suppressions/tsan
MarcoFalke,2021-04-14 14:47:27,"I think eventually we don't want libraries that are broken, but we can look into this after bdb is removed",https://github.com/bitcoin/bitcoin/pull/21680#discussion_r613315501,613315501,test/sanitizer_suppressions/tsan
MarcoFalke,2021-04-14 15:40:14,Maybe still remove if it is not needed?,https://github.com/bitcoin/bitcoin/pull/21680#discussion_r613361675,613361675,test/sanitizer_suppressions/tsan
hebasto,2021-04-14 15:43:01,Ok. I'll push an updated branch after the current one finishes its CI jobs (to be sure in it).,https://github.com/bitcoin/bitcoin/pull/21680#discussion_r613364048,613364048,test/sanitizer_suppressions/tsan
MarcoFalke,2021-04-14 16:27:52,"It didn't pass locally, fyi",https://github.com/bitcoin/bitcoin/pull/21680#discussion_r613398821,613398821,test/sanitizer_suppressions/tsan
hebasto,2021-04-14 16:29:35,"> It didn't pass locally, fyi\n\nThe current branch or without `called_from_lib:libevent`?",https://github.com/bitcoin/bitcoin/pull/21680#discussion_r613400044,613400044,test/sanitizer_suppressions/tsan
MarcoFalke,2021-04-14 17:37:20,"The branch as is, IIRC",https://github.com/bitcoin/bitcoin/pull/21680#discussion_r613446572,613446572,test/sanitizer_suppressions/tsan
