[
  {
    "sha": "2e280311b87ac95a765edd3cac05096e48c73545",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyZTI4MDMxMWI4N2FjOTVhNzY1ZWRkM2NhYzA1MDk2ZTQ4YzczNTQ1",
    "commit": {
      "author": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@gmail.com",
        "date": "2014-08-27T07:20:33Z"
      },
      "committer": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@gmail.com",
        "date": "2014-08-27T07:20:33Z"
      },
      "message": "Perform CVerifyDB on pcoinsdbview instead of pcoinsTip\n\nBypassing the main coins cache allows more thorough checking with the same\nmemory budget.\n\nThis has no effect on performance because everything ends up in the child\ncache created by VerifyDB itself.\n\nIt has bugged me ever since #4675, which effectively reduced the\nnumber of checked blocks to reduce peak memory usage.\n\n- Pass the coinsview to use as argument to VerifyDB\n\n- This also avoids that the first `pcoinsTip->Flush()` after VerifyDB\n  writes a large slew of unchanged coin records back to the database.",
      "tree": {
        "sha": "bfccbc856a40296f9d64566053604f91abc076c1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/bfccbc856a40296f9d64566053604f91abc076c1"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2e280311b87ac95a765edd3cac05096e48c73545",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQEcBAABCgAGBQJT/YgUAAoJEHSBCwEjRsmmibMH/3Ew50SswE0F2DKotIG8/zNR\nhpzJPO9RVGX18HNPaeuImz0e3W4nTMq1Q/LxB9Evj3ZHvVzc2OMBVsftkiQLtTGw\nUkshR8ElX6c0YBWAe1sjyroLZSazU3PnFOshD88vkbEcwxLikcx9FLse2xwTu/r2\nCGKlM0+xQdsYceqsZeC1Pds0HzOgjOO1c5n4w627wyw7BU9UQPq+D+dm0j1e7loa\nacdvW6FzG1j72qQTei4TmPvxrRglnmoqXcs5dafPZ94NzLvLJmNgFmKJkWWNaVtO\nu6B3RIE23OztCA9zqZt+MqYbSe6otLK5W4NgeLWDEEaiOK7c+k4uawmV7BWozPY=\n=9mSs\n-----END PGP SIGNATURE-----",
        "payload": "tree bfccbc856a40296f9d64566053604f91abc076c1\nparent f30801afbde7598318a5b03de9812c58a6a34f33\nauthor Wladimir J. van der Laan <laanwj@gmail.com> 1409124033 +0200\ncommitter Wladimir J. van der Laan <laanwj@gmail.com> 1409124033 +0200\n\nPerform CVerifyDB on pcoinsdbview instead of pcoinsTip\n\nBypassing the main coins cache allows more thorough checking with the same\nmemory budget.\n\nThis has no effect on performance because everything ends up in the child\ncache created by VerifyDB itself.\n\nIt has bugged me ever since #4675, which effectively reduced the\nnumber of checked blocks to reduce peak memory usage.\n\n- Pass the coinsview to use as argument to VerifyDB\n\n- This also avoids that the first `pcoinsTip->Flush()` after VerifyDB\n  writes a large slew of unchanged coin records back to the database.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2e280311b87ac95a765edd3cac05096e48c73545",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/2e280311b87ac95a765edd3cac05096e48c73545",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2e280311b87ac95a765edd3cac05096e48c73545/comments",
    "author": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "f30801afbde7598318a5b03de9812c58a6a34f33",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f30801afbde7598318a5b03de9812c58a6a34f33",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/f30801afbde7598318a5b03de9812c58a6a34f33"
      }
    ],
    "stats": {
      "total": 10,
      "additions": 5,
      "deletions": 5
    },
    "files": [
      {
        "sha": "7b1318654fc7958a811b3bf9003c41b20eb7649c",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2e280311b87ac95a765edd3cac05096e48c73545/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2e280311b87ac95a765edd3cac05096e48c73545/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=2e280311b87ac95a765edd3cac05096e48c73545",
        "patch": "@@ -969,7 +969,7 @@ bool AppInit2(boost::thread_group& threadGroup)\n                 }\n \n                 uiInterface.InitMessage(_(\"Verifying blocks...\"));\n-                if (!CVerifyDB().VerifyDB(GetArg(\"-checklevel\", 3),\n+                if (!CVerifyDB().VerifyDB(pcoinsdbview, GetArg(\"-checklevel\", 3),\n                               GetArg(\"-checkblocks\", 288))) {\n                     strLoadError = _(\"Corrupted block database detected\");\n                     break;"
      },
      {
        "sha": "de5730a388491b085ce87256268e1a381e1244b1",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2e280311b87ac95a765edd3cac05096e48c73545/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2e280311b87ac95a765edd3cac05096e48c73545/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=2e280311b87ac95a765edd3cac05096e48c73545",
        "patch": "@@ -3018,7 +3018,7 @@ CVerifyDB::~CVerifyDB()\n     uiInterface.ShowProgress(\"\", 100);\n }\n \n-bool CVerifyDB::VerifyDB(int nCheckLevel, int nCheckDepth)\n+bool CVerifyDB::VerifyDB(CCoinsView *coinsview, int nCheckLevel, int nCheckDepth)\n {\n     LOCK(cs_main);\n     if (chainActive.Tip() == NULL || chainActive.Tip()->pprev == NULL)\n@@ -3031,7 +3031,7 @@ bool CVerifyDB::VerifyDB(int nCheckLevel, int nCheckDepth)\n         nCheckDepth = chainActive.Height();\n     nCheckLevel = std::max(0, std::min(4, nCheckLevel));\n     LogPrintf(\"Verifying last %i blocks at level %i\\n\", nCheckDepth, nCheckLevel);\n-    CCoinsViewCache coins(*pcoinsTip, true);\n+    CCoinsViewCache coins(*coinsview, true);\n     CBlockIndex* pindexState = chainActive.Tip();\n     CBlockIndex* pindexFailure = NULL;\n     int nGoodTransactions = 0;"
      },
      {
        "sha": "fae8990d20f7fe474eaac4f0357c61f0a6319ce2",
        "filename": "src/main.h",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2e280311b87ac95a765edd3cac05096e48c73545/src/main.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2e280311b87ac95a765edd3cac05096e48c73545/src/main.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.h?ref=2e280311b87ac95a765edd3cac05096e48c73545",
        "patch": "@@ -942,7 +942,7 @@ class CVerifyDB {\n public:\n     CVerifyDB();\n     ~CVerifyDB();\n-    bool VerifyDB(int nCheckLevel, int nCheckDepth);\n+    bool VerifyDB(CCoinsView *coinsview, int nCheckLevel, int nCheckDepth);\n };\n \n /** An in-memory indexed chain of blocks. */"
      },
      {
        "sha": "b71d5a080436918b3b66bffe1fe48324fa7d7854",
        "filename": "src/rpcblockchain.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2e280311b87ac95a765edd3cac05096e48c73545/src/rpcblockchain.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2e280311b87ac95a765edd3cac05096e48c73545/src/rpcblockchain.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpcblockchain.cpp?ref=2e280311b87ac95a765edd3cac05096e48c73545",
        "patch": "@@ -430,7 +430,7 @@ Value verifychain(const Array& params, bool fHelp)\n     if (params.size() > 1)\n         nCheckDepth = params[1].get_int();\n \n-    return CVerifyDB().VerifyDB(nCheckLevel, nCheckDepth);\n+    return CVerifyDB().VerifyDB(pcoinsTip, nCheckLevel, nCheckDepth);\n }\n \n Value getblockchaininfo(const Array& params, bool fHelp)"
      }
    ]
  }
]