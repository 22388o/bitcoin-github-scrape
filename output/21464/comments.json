[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/802225625",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#issuecomment-802225625",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21464",
    "id": 802225625,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgwMjIyNTYyNQ==",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-18T19:26:08Z",
    "updated_at": "2021-03-18T19:26:08Z",
    "author_association": "MEMBER",
    "body": "Interesting on first look, will review.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/802225625/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/814514448",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#issuecomment-814514448",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21464",
    "id": 814514448,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgxNDUxNDQ0OA==",
    "user": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?u=8cdd8653982252593843d7369ecfebe432b89768&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-07T00:20:15Z",
    "updated_at": "2021-04-07T00:20:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "pushed an update to simplify setRemove to hold txids instead of tx reference_wrappers, which eliminated the confusing ownership thing. should make review simpler.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/814514448/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/817540843",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#issuecomment-817540843",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21464",
    "id": 817540843,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgxNzU0MDg0Mw==",
    "user": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-12T06:58:47Z",
    "updated_at": "2021-04-12T06:58:47Z",
    "author_association": "MEMBER",
    "body": "utACK https://github.com/bitcoin/bitcoin/pull/21464/commits/e8dafeb7004e4b0ed896ef08383bb22d9087a749\r\n\r\ngoing to dive into tests next to upgrade to tACK",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/817540843/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/821099740",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#issuecomment-821099740",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21464",
    "id": 821099740,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyMTA5OTc0MA==",
    "user": {
      "login": "rebroad",
      "id": 1530283,
      "node_id": "MDQ6VXNlcjE1MzAyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1530283?u=6a4a31aaddbc438e053c52d084a698a5f622f1ea&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rebroad",
      "html_url": "https://github.com/rebroad",
      "followers_url": "https://api.github.com/users/rebroad/followers",
      "following_url": "https://api.github.com/users/rebroad/following{/other_user}",
      "gists_url": "https://api.github.com/users/rebroad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
      "organizations_url": "https://api.github.com/users/rebroad/orgs",
      "repos_url": "https://api.github.com/users/rebroad/repos",
      "events_url": "https://api.github.com/users/rebroad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rebroad/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-16T11:06:36Z",
    "updated_at": "2021-04-16T11:06:36Z",
    "author_association": "CONTRIBUTOR",
    "body": "@JeremyRubin could you explain what this does in more layman's terms please? Is this pull anything to do with helping to fill the mempool in a way that reduces filling it with TXs that will get deleted later (due to mempool becoming full)?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/821099740/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/821101091",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#issuecomment-821101091",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21464",
    "id": 821101091,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyMTEwMTA5MQ==",
    "user": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-16T11:09:19Z",
    "updated_at": "2021-04-16T11:09:19Z",
    "author_association": "MEMBER",
    "body": "This is an optimization for the case where a reorg puts an ancestor transaction(package) back into the mempool, thus temporarily busting the transaction chain limits of the mempool.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/821101091/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/831142326",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#issuecomment-831142326",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21464",
    "id": 831142326,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgzMTE0MjMyNg==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-03T09:33:16Z",
    "updated_at": "2021-05-03T09:33:16Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--4a62be1de6b64f3ed646cdc7932c8cf5-->\n\ud83d\udd75\ufe0f @hebasto @sipa have been requested to review this pull request as specified in the REVIEWERS file.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/831142326/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/877649701",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#issuecomment-877649701",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21464",
    "id": 877649701,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3NzY0OTcwMQ==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-10T14:49:21Z",
    "updated_at": "2021-10-25T23:58:03Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#21436](https://github.com/bitcoin/bitcoin/pull/21436) (doc: Fix several references in txmempool comments by kiminuo)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/877649701/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/877704718",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#issuecomment-877704718",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21464",
    "id": 877704718,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3NzcwNDcxOA==",
    "user": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?u=8cdd8653982252593843d7369ecfebe432b89768&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-10T21:09:06Z",
    "updated_at": "2021-07-10T21:09:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "Addressed style/doc stuff in a separate commit to preserve ACKs (squashable)\r\n\r\nI also introcuded a new removal reason in a separate commit, this should not be squashed as it is ortho to the main change.\r\n\r\n@laanwj anything else you'd like to see here?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/877704718/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/878212035",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#issuecomment-878212035",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21464",
    "id": 878212035,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3ODIxMjAzNQ==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-12T11:47:15Z",
    "updated_at": "2021-07-12T11:47:15Z",
    "author_association": "MEMBER",
    "body": "> Addressed style/doc stuff in a separate commit to preserve ACKs (squashable)\r\n\r\nI don't understand this. The head commit is what needs ACKs, and that's changed now that there are new commits. I'm very happy to re-review once you've squashed commits and rebased on master.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/878212035/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/881063252",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#issuecomment-881063252",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21464",
    "id": 881063252,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg4MTA2MzI1Mg==",
    "user": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?u=8cdd8653982252593843d7369ecfebe432b89768&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-15T23:02:02Z",
    "updated_at": "2021-07-15T23:02:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "Ok, made changes requested by @jnewbery and squashed. Will open a followup PR with the validation interface after as requested by @ariard. Thanks.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/881063252/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/917707120",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#issuecomment-917707120",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21464",
    "id": 917707120,
    "node_id": "IC_kwDOABII5842sxlw",
    "user": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?u=8cdd8653982252593843d7369ecfebe432b89768&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-12T20:44:03Z",
    "updated_at": "2021-09-12T20:44:03Z",
    "author_association": "CONTRIBUTOR",
    "body": "Addressed all feedback; keeping tests separate from changes for easier A/B comparison. However, I have reordered them so Tests come first which is more practical.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/917707120/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/962507007",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#issuecomment-962507007",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21464",
    "id": 962507007,
    "node_id": "IC_kwDOABII5845XrD_",
    "user": {
      "login": "Talkless",
      "id": 292191,
      "node_id": "MDQ6VXNlcjI5MjE5MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/292191?u=d9debc4e87d0036b59d7d56a02f7f0728a8a76e2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Talkless",
      "html_url": "https://github.com/Talkless",
      "followers_url": "https://api.github.com/users/Talkless/followers",
      "following_url": "https://api.github.com/users/Talkless/following{/other_user}",
      "gists_url": "https://api.github.com/users/Talkless/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Talkless/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Talkless/subscriptions",
      "organizations_url": "https://api.github.com/users/Talkless/orgs",
      "repos_url": "https://api.github.com/users/Talkless/repos",
      "events_url": "https://api.github.com/users/Talkless/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Talkless/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-06T20:39:27Z",
    "updated_at": "2021-11-06T20:39:27Z",
    "author_association": "NONE",
    "body": "Weak ACK 81efedb60e1e88f806adb010c926b4edd04393b8. Weak because of my limited mempool knowledge, though code looks OK, and I successfully ran unit and extended functional tests.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/962507007/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/969129360",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#issuecomment-969129360",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21464",
    "id": 969129360,
    "node_id": "IC_kwDOABII5845w72Q",
    "user": {
      "login": "mjdietzx",
      "id": 7217256,
      "node_id": "MDQ6VXNlcjcyMTcyNTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7217256?u=6e534b25446a57600514192504756c77c2637aae&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mjdietzx",
      "html_url": "https://github.com/mjdietzx",
      "followers_url": "https://api.github.com/users/mjdietzx/followers",
      "following_url": "https://api.github.com/users/mjdietzx/following{/other_user}",
      "gists_url": "https://api.github.com/users/mjdietzx/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mjdietzx/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mjdietzx/subscriptions",
      "organizations_url": "https://api.github.com/users/mjdietzx/orgs",
      "repos_url": "https://api.github.com/users/mjdietzx/repos",
      "events_url": "https://api.github.com/users/mjdietzx/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mjdietzx/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-15T17:15:18Z",
    "updated_at": "2021-11-15T17:19:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "When I read the commit:\r\n> Often when we're updating mempool entries we update entries that we\r\nultimately end up removing the updated entries shortly thereafter. This\r\npatch makes it so that we filter for such entries a bit earlier in\r\nprocessing\r\n\r\nbased on the wording, I assumed that we were \"filtering\" these entries out _before_ adding them to the mempool. However, after reviewing the PR it seems that these entries are still added to the mempool, state is still calculated/updated and cached, it's just that we are now (pre-emptively) removing `descendants_to_remove` right away at the end of `UpdateTransactionsFromBlock`\r\n\r\nIs my understanding correct? If so, it makes me wonder where the performance improvement is coming from. To me it seems all the same work is done before/after this PR, just earlier.\r\n\r\n---\r\n\r\nRe: my [review comment](https://github.com/bitcoin/bitcoin/pull/21464/commits/92647669428bdaca44813b958e33513958644227#r749526368) 92647669428bdaca44813b958e33513958644227, `mempool_updatefromblock.py` (which I agree is a great benchmark test for this optimization) is running in the ~same time before/after this PR. So I am curious if we are actually seeing any speedup from this optimization",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/969129360/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/610216193",
    "pull_request_review_id": 631926982,
    "id": 610216193,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMDIxNjE5Mw==",
    "diff_hunk": "@@ -146,7 +153,16 @@ void CTxMemPool::UpdateTransactionsFromBlock(const std::vector<uint256> &vHashes\n                 }\n             }\n         } // release epoch guard for UpdateForDescendants\n-        UpdateForDescendants(it, mapMemPoolDescendantsToUpdate, setAlreadyIncluded);\n+        UpdateForDescendants(it, mapMemPoolDescendantsToUpdate, setAlreadyIncluded, setRemove, ancestor_size_limit, ancestor_limit);\n+    }\n+\n+    for (auto& txid : setRemove) {\n+        // this guard is safe because we know that all to_remove *were* in the mempool before we\n+        // began iterating here, so this only serves to de-duplicate calls to removeRecursive.\n+        // Otherwise, removeRecursive should be called whether or not the hash is in the mempool.\n+        const std::optional<txiter> txiter_opt = GetIter(txid);\n+        if (txiter_opt)",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 52,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "590fb3ef432a14ca8801c3e2f6d79e7707117e40",
    "user": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "brackets",
    "created_at": "2021-04-09T00:03:32Z",
    "updated_at": "2021-04-12T02:00:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r610216193",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/610216193"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r610216193"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/610216193/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 163,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/610216318",
    "pull_request_review_id": 631926982,
    "id": 610216318,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMDIxNjMxOA==",
    "diff_hunk": "@@ -117,6 +122,8 @@ void CTxMemPool::UpdateTransactionsFromBlock(const std::vector<uint256> &vHashes\n     // accounted for in the state of their ancestors)\n     std::set<uint256> setAlreadyIncluded(vHashesToUpdate.begin(), vHashesToUpdate.end());\n \n+    std::set<uint256> setRemove;",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 34,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "590fb3ef432a14ca8801c3e2f6d79e7707117e40",
    "user": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: snake_case for new vars",
    "created_at": "2021-04-09T00:03:47Z",
    "updated_at": "2021-04-12T02:00:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r610216318",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/610216318"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r610216318"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/610216318/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 125,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/610231049",
    "pull_request_review_id": 631926982,
    "id": 610231049,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMDIzMTA0OQ==",
    "diff_hunk": "@@ -95,6 +96,10 @@ void CTxMemPool::UpdateForDescendants(txiter updateIt, cacheMap &cachedDescendan\n             cachedDescendants[updateIt].insert(mapTx.iterator_to(descendant));\n             // Update ancestor state for each descendant\n             mapTx.modify(mapTx.iterator_to(descendant), update_ancestor_state(updateIt->GetTxSize(), updateIt->GetModifiedFee(), 1, updateIt->GetSigOpCost()));\n+\n+            if (descendant.GetCountWithAncestors() > ancestor_limit || descendant.GetSizeWithAncestors() > ancestor_size_limit) {",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 15,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "590fb3ef432a14ca8801c3e2f6d79e7707117e40",
    "user": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This probably warrants a comment since it's an opportunistic check that is not about updating the descendant map",
    "created_at": "2021-04-09T00:28:12Z",
    "updated_at": "2021-04-12T02:00:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r610231049",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/610231049"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r610231049"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/610231049/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 102,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/610231499",
    "pull_request_review_id": 631926982,
    "id": 610231499,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMDIzMTQ5OQ==",
    "diff_hunk": "@@ -146,7 +153,16 @@ void CTxMemPool::UpdateTransactionsFromBlock(const std::vector<uint256> &vHashes\n                 }\n             }\n         } // release epoch guard for UpdateForDescendants\n-        UpdateForDescendants(it, mapMemPoolDescendantsToUpdate, setAlreadyIncluded);\n+        UpdateForDescendants(it, mapMemPoolDescendantsToUpdate, setAlreadyIncluded, setRemove, ancestor_size_limit, ancestor_limit);\n+    }\n+\n+    for (auto& txid : setRemove) {\n+        // this guard is safe because we know that all to_remove *were* in the mempool before we",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 48,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "590fb3ef432a14ca8801c3e2f6d79e7707117e40",
    "user": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "what's `to_remove`?",
    "created_at": "2021-04-09T00:28:59Z",
    "updated_at": "2021-04-12T02:00:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r610231499",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/610231499"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r610231499"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/610231499/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 160,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/610233276",
    "pull_request_review_id": 631926982,
    "id": 610233276,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMDIzMzI3Ng==",
    "diff_hunk": "@@ -146,7 +153,16 @@ void CTxMemPool::UpdateTransactionsFromBlock(const std::vector<uint256> &vHashes\n                 }\n             }\n         } // release epoch guard for UpdateForDescendants\n-        UpdateForDescendants(it, mapMemPoolDescendantsToUpdate, setAlreadyIncluded);\n+        UpdateForDescendants(it, mapMemPoolDescendantsToUpdate, setAlreadyIncluded, setRemove, ancestor_size_limit, ancestor_limit);\n+    }\n+\n+    for (auto& txid : setRemove) {\n+        // this guard is safe because we know that all to_remove *were* in the mempool before we",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 48,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "590fb3ef432a14ca8801c3e2f6d79e7707117e40",
    "user": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Also I don't really understand the comment block in general",
    "created_at": "2021-04-09T00:32:04Z",
    "updated_at": "2021-04-12T02:00:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r610233276",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/610233276"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r610233276"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/610233276/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 160,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611279803",
    "pull_request_review_id": 631926982,
    "id": 611279803,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTI3OTgwMw==",
    "diff_hunk": "@@ -95,6 +96,10 @@ void CTxMemPool::UpdateForDescendants(txiter updateIt, cacheMap &cachedDescendan\n             cachedDescendants[updateIt].insert(mapTx.iterator_to(descendant));\n             // Update ancestor state for each descendant\n             mapTx.modify(mapTx.iterator_to(descendant), update_ancestor_state(updateIt->GetTxSize(), updateIt->GetModifiedFee(), 1, updateIt->GetSigOpCost()));\n+\n+            if (descendant.GetCountWithAncestors() > ancestor_limit || descendant.GetSizeWithAncestors() > ancestor_size_limit) {",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 15,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "590fb3ef432a14ca8801c3e2f6d79e7707117e40",
    "user": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "overall I wish we could be much more compartmentalized about these limit checks. \r\n\r\nno good suggestion; just a complaint",
    "created_at": "2021-04-12T01:31:44Z",
    "updated_at": "2021-04-12T02:00:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r611279803",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611279803"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r611279803"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611279803/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 102,
    "side": "RIGHT",
    "in_reply_to_id": 610231049
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611280586",
    "pull_request_review_id": 633085129,
    "id": 611280586,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTI4MDU4Ng==",
    "diff_hunk": "@@ -146,7 +153,16 @@ void CTxMemPool::UpdateTransactionsFromBlock(const std::vector<uint256> &vHashes\n                 }\n             }\n         } // release epoch guard for UpdateForDescendants\n-        UpdateForDescendants(it, mapMemPoolDescendantsToUpdate, setAlreadyIncluded);\n+        UpdateForDescendants(it, mapMemPoolDescendantsToUpdate, setAlreadyIncluded, setRemove, ancestor_size_limit, ancestor_limit);\n+    }\n+\n+    for (auto& txid : setRemove) {\n+        // this guard is safe because we know that all to_remove *were* in the mempool before we",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 48,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "590fb3ef432a14ca8801c3e2f6d79e7707117e40",
    "user": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "right; stale comment on the prior version. Before i was using txiters + CTransactionRefs and had to use a second vec before removing (otherwise you'd have use after free on the txiters).\r\n\r\nFixed the comment.",
    "created_at": "2021-04-12T01:36:01Z",
    "updated_at": "2021-04-12T02:00:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r611280586",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611280586"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r611280586"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611280586/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 160,
    "side": "RIGHT",
    "in_reply_to_id": 610231499
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611280629",
    "pull_request_review_id": 633085162,
    "id": 611280629,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTI4MDYyOQ==",
    "diff_hunk": "@@ -146,7 +153,16 @@ void CTxMemPool::UpdateTransactionsFromBlock(const std::vector<uint256> &vHashes\n                 }\n             }\n         } // release epoch guard for UpdateForDescendants\n-        UpdateForDescendants(it, mapMemPoolDescendantsToUpdate, setAlreadyIncluded);\n+        UpdateForDescendants(it, mapMemPoolDescendantsToUpdate, setAlreadyIncluded, setRemove, ancestor_size_limit, ancestor_limit);\n+    }\n+\n+    for (auto& txid : setRemove) {\n+        // this guard is safe because we know that all to_remove *were* in the mempool before we",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 48,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "590fb3ef432a14ca8801c3e2f6d79e7707117e40",
    "user": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "ibid",
    "created_at": "2021-04-12T01:36:08Z",
    "updated_at": "2021-04-12T02:00:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r611280629",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611280629"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r611280629"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611280629/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 160,
    "side": "RIGHT",
    "in_reply_to_id": 610233276
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611285428",
    "pull_request_review_id": 633090496,
    "id": 611285428,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTI4NTQyOA==",
    "diff_hunk": "@@ -117,6 +122,8 @@ void CTxMemPool::UpdateTransactionsFromBlock(const std::vector<uint256> &vHashes\n     // accounted for in the state of their ancestors)\n     std::set<uint256> setAlreadyIncluded(vHashesToUpdate.begin(), vHashesToUpdate.end());\n \n+    std::set<uint256> setRemove;",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 34,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "590fb3ef432a14ca8801c3e2f6d79e7707117e40",
    "user": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "renamed",
    "created_at": "2021-04-12T01:58:00Z",
    "updated_at": "2021-04-12T02:00:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r611285428",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611285428"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r611285428"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611285428/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 125,
    "side": "RIGHT",
    "in_reply_to_id": 610216318
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611285528",
    "pull_request_review_id": 633090599,
    "id": 611285528,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTI4NTUyOA==",
    "diff_hunk": "@@ -95,6 +96,10 @@ void CTxMemPool::UpdateForDescendants(txiter updateIt, cacheMap &cachedDescendan\n             cachedDescendants[updateIt].insert(mapTx.iterator_to(descendant));\n             // Update ancestor state for each descendant\n             mapTx.modify(mapTx.iterator_to(descendant), update_ancestor_state(updateIt->GetTxSize(), updateIt->GetModifiedFee(), 1, updateIt->GetSigOpCost()));\n+\n+            if (descendant.GetCountWithAncestors() > ancestor_limit || descendant.GetSizeWithAncestors() > ancestor_size_limit) {",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 15,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "590fb3ef432a14ca8801c3e2f6d79e7707117e40",
    "user": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "will clarify why doing it here makes sense; good point.",
    "created_at": "2021-04-12T01:58:25Z",
    "updated_at": "2021-04-12T02:00:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r611285528",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611285528"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r611285528"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611285528/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 102,
    "side": "RIGHT",
    "in_reply_to_id": 610231049
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613563758",
    "pull_request_review_id": 636049781,
    "id": 613563758,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMzU2Mzc1OA==",
    "diff_hunk": "@@ -667,7 +667,8 @@ class CTxMemPool\n      *  for).  Note: vHashesToUpdate should be the set of transactions from the\n      *  disconnected block that have been accepted back into the mempool.\n      */\n-    void UpdateTransactionsFromBlock(const std::vector<uint256>& vHashesToUpdate) EXCLUSIVE_LOCKS_REQUIRED(cs, cs_main) LOCKS_EXCLUDED(m_epoch);\n+    void UpdateTransactionsFromBlock(const std::vector<uint256>& vHashesToUpdate,\n+            uint64_t ancestor_size_limit, uint64_t ancestor_limit) EXCLUSIVE_LOCKS_REQUIRED(cs, cs_main) LOCKS_EXCLUDED(m_epoch);",
    "path": "src/txmempool.h",
    "position": null,
    "original_position": 6,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "e8dafeb7004e4b0ed896ef08383bb22d9087a749",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Should update the doxygen comments, something like\r\n\r\n```c++\r\n* @param[out]    set_should_remove          Populated with the txids of entries that exceed ancestor limits. It's the responsibility of the caller to removeRecursive them.\r\n```",
    "created_at": "2021-04-14T20:25:54Z",
    "updated_at": "2021-04-14T21:48:34Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r613563758",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613563758"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r613563758"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613563758/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 669,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 671,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613565697",
    "pull_request_review_id": 636049781,
    "id": 613565697,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMzU2NTY5Nw==",
    "diff_hunk": "@@ -806,7 +807,7 @@ class CTxMemPool\n      */\n     void UpdateForDescendants(txiter updateIt,\n             cacheMap &cachedDescendants,\n-            const std::set<uint256> &setExclude) EXCLUSIVE_LOCKS_REQUIRED(cs);\n+            const std::set<uint256> &setExclude, std::set<uint256>& set_should_remove, uint64_t ancestor_size_limit, uint64_t ancestor_limit) EXCLUSIVE_LOCKS_REQUIRED(cs);",
    "path": "src/txmempool.h",
    "position": null,
    "original_position": 15,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "e8dafeb7004e4b0ed896ef08383bb22d9087a749",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Small naming suggestion; \"count\" removes any ambiguity about which limit this is.\r\n```suggestion\r\n            const std::set<uint256> &setExclude, std::set<uint256>& set_should_remove, uint64_t ancestor_size_limit, uint64_t ancestor_count_limit) EXCLUSIVE_LOCKS_REQUIRED(cs);\r\n```",
    "created_at": "2021-04-14T20:29:09Z",
    "updated_at": "2021-04-14T21:48:34Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r613565697",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613565697"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r613565697"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613565697/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 810,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613575751",
    "pull_request_review_id": 636049781,
    "id": 613575751,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMzU3NTc1MQ==",
    "diff_hunk": "@@ -146,7 +155,16 @@ void CTxMemPool::UpdateTransactionsFromBlock(const std::vector<uint256> &vHashes\n                 }\n             }\n         } // release epoch guard for UpdateForDescendants\n-        UpdateForDescendants(it, mapMemPoolDescendantsToUpdate, setAlreadyIncluded);",
    "path": "src/txmempool.cpp",
    "position": 52,
    "original_position": 45,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "e8dafeb7004e4b0ed896ef08383bb22d9087a749",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Question: Would it be correct/better to also add children to `mapMemPoolDescendantsToUpdate` in the code block above?",
    "created_at": "2021-04-14T20:46:47Z",
    "updated_at": "2021-04-14T22:00:11Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r613575751",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613575751"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r613575751"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613575751/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 150,
    "original_line": 150,
    "side": "LEFT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613700241",
    "pull_request_review_id": 636205098,
    "id": 613700241,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMzcwMDI0MQ==",
    "diff_hunk": "@@ -806,7 +807,7 @@ class CTxMemPool\n      */\n     void UpdateForDescendants(txiter updateIt,\n             cacheMap &cachedDescendants,\n-            const std::set<uint256> &setExclude) EXCLUSIVE_LOCKS_REQUIRED(cs);\n+            const std::set<uint256> &setExclude, std::set<uint256>& set_should_remove, uint64_t ancestor_size_limit, uint64_t ancestor_limit) EXCLUSIVE_LOCKS_REQUIRED(cs);",
    "path": "src/txmempool.h",
    "position": null,
    "original_position": 15,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "e8dafeb7004e4b0ed896ef08383bb22d9087a749",
    "user": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "will clean this up if I touch it.",
    "created_at": "2021-04-15T01:42:47Z",
    "updated_at": "2021-04-15T01:42:47Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r613700241",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613700241"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r613700241"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613700241/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 810,
    "side": "RIGHT",
    "in_reply_to_id": 613565697
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613700281",
    "pull_request_review_id": 636205154,
    "id": 613700281,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMzcwMDI4MQ==",
    "diff_hunk": "@@ -667,7 +667,8 @@ class CTxMemPool\n      *  for).  Note: vHashesToUpdate should be the set of transactions from the\n      *  disconnected block that have been accepted back into the mempool.\n      */\n-    void UpdateTransactionsFromBlock(const std::vector<uint256>& vHashesToUpdate) EXCLUSIVE_LOCKS_REQUIRED(cs, cs_main) LOCKS_EXCLUDED(m_epoch);\n+    void UpdateTransactionsFromBlock(const std::vector<uint256>& vHashesToUpdate,\n+            uint64_t ancestor_size_limit, uint64_t ancestor_limit) EXCLUSIVE_LOCKS_REQUIRED(cs, cs_main) LOCKS_EXCLUDED(m_epoch);",
    "path": "src/txmempool.h",
    "position": null,
    "original_position": 6,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "e8dafeb7004e4b0ed896ef08383bb22d9087a749",
    "user": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "will clean it up if I touch.",
    "created_at": "2021-04-15T01:42:56Z",
    "updated_at": "2021-04-15T01:42:57Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r613700281",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613700281"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r613700281"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613700281/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 669,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 671,
    "side": "RIGHT",
    "in_reply_to_id": 613563758
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613700816",
    "pull_request_review_id": 636205801,
    "id": 613700816,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMzcwMDgxNg==",
    "diff_hunk": "@@ -146,7 +155,16 @@ void CTxMemPool::UpdateTransactionsFromBlock(const std::vector<uint256> &vHashes\n                 }\n             }\n         } // release epoch guard for UpdateForDescendants\n-        UpdateForDescendants(it, mapMemPoolDescendantsToUpdate, setAlreadyIncluded);",
    "path": "src/txmempool.cpp",
    "position": 52,
    "original_position": 45,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "e8dafeb7004e4b0ed896ef08383bb22d9087a749",
    "user": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Nah; mapMemPoolDescendantsToUpdate is a cache for UpdateForDescendants where each line in the cache is all the desc, not just children, so if you added it prematurely it would uncache incorrectly in UpdateForDescednants",
    "created_at": "2021-04-15T01:44:48Z",
    "updated_at": "2021-04-15T01:44:48Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r613700816",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613700816"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r613700816"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613700816/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 150,
    "original_line": 150,
    "side": "LEFT",
    "in_reply_to_id": 613575751
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622022051",
    "pull_request_review_id": 646866817,
    "id": 622022051,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMjAyMjA1MQ==",
    "diff_hunk": "@@ -667,7 +667,8 @@ class CTxMemPool\n      *  for).  Note: vHashesToUpdate should be the set of transactions from the\n      *  disconnected block that have been accepted back into the mempool.\n      */\n-    void UpdateTransactionsFromBlock(const std::vector<uint256>& vHashesToUpdate) EXCLUSIVE_LOCKS_REQUIRED(cs, cs_main) LOCKS_EXCLUDED(m_epoch);\n+    void UpdateTransactionsFromBlock(const std::vector<uint256>& vHashesToUpdate,\n+            uint64_t ancestor_size_limit, uint64_t ancestor_limit) EXCLUSIVE_LOCKS_REQUIRED(cs, cs_main) LOCKS_EXCLUDED(m_epoch);",
    "path": "src/txmempool.h",
    "position": null,
    "original_position": 6,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "e8dafeb7004e4b0ed896ef08383bb22d9087a749",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Definitely agree that changes to signature functions should be documented in the doxygen comments.",
    "created_at": "2021-04-28T10:00:22Z",
    "updated_at": "2021-04-28T10:00:22Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r622022051",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622022051"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r622022051"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622022051/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 669,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 671,
    "side": "RIGHT",
    "in_reply_to_id": 613563758
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622149124",
    "pull_request_review_id": 647023794,
    "id": 622149124,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMjE0OTEyNA==",
    "diff_hunk": "@@ -667,7 +667,8 @@ class CTxMemPool\n      *  for).  Note: vHashesToUpdate should be the set of transactions from the\n      *  disconnected block that have been accepted back into the mempool.\n      */\n-    void UpdateTransactionsFromBlock(const std::vector<uint256>& vHashesToUpdate) EXCLUSIVE_LOCKS_REQUIRED(cs, cs_main) LOCKS_EXCLUDED(m_epoch);\n+    void UpdateTransactionsFromBlock(const std::vector<uint256>& vHashesToUpdate,\n+            uint64_t ancestor_size_limit, uint64_t ancestor_limit) EXCLUSIVE_LOCKS_REQUIRED(cs, cs_main) LOCKS_EXCLUDED(m_epoch);",
    "path": "src/txmempool.h",
    "position": null,
    "original_position": 6,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "e8dafeb7004e4b0ed896ef08383bb22d9087a749",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This function only ever gets called in one place, with ancestor_size_limit set to `-limitancestorsize` and ancestor_limit set to `-limitancestorcount`.\r\n\r\nWhat do you think about parameterizing the `CTxMemPool` constructor with those values? They don't change during runtime and it'd mean you'd be making no changes to validation.\r\n\r\nSee the last two commits in https://github.com/jnewbery/bitcoin/tree/pr21464.1.",
    "created_at": "2021-04-28T12:53:35Z",
    "updated_at": "2021-04-28T16:46:37Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r622149124",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622149124"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r622149124"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622149124/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 671,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622151298",
    "pull_request_review_id": 647023794,
    "id": 622151298,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMjE1MTI5OA==",
    "diff_hunk": "@@ -806,7 +807,7 @@ class CTxMemPool\n      */\n     void UpdateForDescendants(txiter updateIt,\n             cacheMap &cachedDescendants,\n-            const std::set<uint256> &setExclude) EXCLUSIVE_LOCKS_REQUIRED(cs);\n+            const std::set<uint256> &setExclude, std::set<uint256>& set_should_remove, uint64_t ancestor_size_limit, uint64_t ancestor_limit) EXCLUSIVE_LOCKS_REQUIRED(cs);",
    "path": "src/txmempool.h",
    "position": null,
    "original_position": 15,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "e8dafeb7004e4b0ed896ef08383bb22d9087a749",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This style seems like the worst of all worlds. Including linebreaks, but making the last line too long for side-by-side diff tools. How about:\r\n\r\n```c++\r\n    void UpdateForDescendants(txiter updateIt, cacheMap &cachedDescendants, const std::set<uint256> &setExclude,\r\n                              std::set<uint256>& set_should_remove, uint64_t ancestor_size_limit,\r\n                              uint64_t ancestor_limit) EXCLUSIVE_LOCKS_REQUIRED(cs);\r\n```",
    "created_at": "2021-04-28T12:56:17Z",
    "updated_at": "2021-04-28T16:46:37Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r622151298",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622151298"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r622151298"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622151298/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 810,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622223859",
    "pull_request_review_id": 647023794,
    "id": 622223859,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMjIyMzg1OQ==",
    "diff_hunk": "@@ -117,6 +124,8 @@ void CTxMemPool::UpdateTransactionsFromBlock(const std::vector<uint256> &vHashes\n     // accounted for in the state of their ancestors)\n     std::set<uint256> setAlreadyIncluded(vHashesToUpdate.begin(), vHashesToUpdate.end());\n \n+    std::set<uint256> set_should_remove;",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 36,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "e8dafeb7004e4b0ed896ef08383bb22d9087a749",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "current style is to not include the type in the variable name. Consider:\r\n\r\n```suggestion\r\n    std::set<uint256> txs_to_remove;\r\n```",
    "created_at": "2021-04-28T14:16:13Z",
    "updated_at": "2021-04-28T16:46:37Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r622223859",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622223859"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r622223859"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622223859/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 127,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622233487",
    "pull_request_review_id": 647023794,
    "id": 622233487,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMjIzMzQ4Nw==",
    "diff_hunk": "@@ -146,7 +155,16 @@ void CTxMemPool::UpdateTransactionsFromBlock(const std::vector<uint256> &vHashes\n                 }\n             }\n         } // release epoch guard for UpdateForDescendants\n-        UpdateForDescendants(it, mapMemPoolDescendantsToUpdate, setAlreadyIncluded);\n+        UpdateForDescendants(it, mapMemPoolDescendantsToUpdate, setAlreadyIncluded, set_should_remove, ancestor_size_limit, ancestor_limit);\n+    }\n+\n+    for (auto& txid : set_should_remove) {\n+        // This txid may have been removed already in a prior call to removeRecursive.\n+        // Therefore we ensure it is not yet removed already.\n+        const std::optional<txiter> txiter_opt = GetIter(txid);\n+        if (txiter_opt) {\n+            removeRecursive((*txiter_opt)->GetTx(), MemPoolRemovalReason::SIZELIMIT);",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 54,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "e8dafeb7004e4b0ed896ef08383bb22d9087a749",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Consider using c++17 if statement initializer:\r\n\r\n```suggestion\r\n        if (const auto txiter_opt = GetIter(txid)) {\r\n            removeRecursive((*txiter_opt)->GetTx(), MemPoolRemovalReason::SIZELIMIT);\r\n```\r\n\r\nof if you want to be a bit more explicit:\r\n\r\n```suggestion\r\n        if (const auto txiter_opt = GetIter(txid); txiter_opt) {\r\n            removeRecursive((*txiter_opt)->GetTx(), MemPoolRemovalReason::SIZELIMIT);\r\n\r\n```\r\n\r\nalso, perhaps remove `opt` from the variable name - project style is to not include types in variable names.",
    "created_at": "2021-04-28T14:26:04Z",
    "updated_at": "2021-04-28T16:46:37Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r622233487",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622233487"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r622233487"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622233487/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 164,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 166,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622237291",
    "pull_request_review_id": 647023794,
    "id": 622237291,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMjIzNzI5MQ==",
    "diff_hunk": "@@ -95,6 +96,12 @@ void CTxMemPool::UpdateForDescendants(txiter updateIt, cacheMap &cachedDescendan\n             cachedDescendants[updateIt].insert(mapTx.iterator_to(descendant));\n             // Update ancestor state for each descendant\n             mapTx.modify(mapTx.iterator_to(descendant), update_ancestor_state(updateIt->GetTxSize(), updateIt->GetModifiedFee(), 1, updateIt->GetSigOpCost()));\n+            // don't directly remove the transaction here -- doing so would invalidate iterators in",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 14,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "e8dafeb7004e4b0ed896ef08383bb22d9087a749",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\n            // Don't directly remove the transaction here -- doing so would invalidate iterators in\r\n```",
    "created_at": "2021-04-28T14:29:51Z",
    "updated_at": "2021-04-28T16:46:37Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r622237291",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622237291"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r622237291"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622237291/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 99,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622237977",
    "pull_request_review_id": 647023794,
    "id": 622237977,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMjIzNzk3Nw==",
    "diff_hunk": "@@ -95,6 +96,12 @@ void CTxMemPool::UpdateForDescendants(txiter updateIt, cacheMap &cachedDescendan\n             cachedDescendants[updateIt].insert(mapTx.iterator_to(descendant));\n             // Update ancestor state for each descendant\n             mapTx.modify(mapTx.iterator_to(descendant), update_ancestor_state(updateIt->GetTxSize(), updateIt->GetModifiedFee(), 1, updateIt->GetSigOpCost()));\n+            // don't directly remove the transaction here -- doing so would invalidate iterators in\n+            // cachedDescendants. Mark it for removal by inserting into set_should_remove here as an\n+            // optimization so we don't have to scan for its removal later.",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 16,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "e8dafeb7004e4b0ed896ef08383bb22d9087a749",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\n            // cachedDescendants. Mark it for removal by inserting into set_should_remove.\r\n```",
    "created_at": "2021-04-28T14:30:29Z",
    "updated_at": "2021-04-28T16:46:37Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r622237977",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622237977"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r622237977"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622237977/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 100,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 101,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622238142",
    "pull_request_review_id": 647023794,
    "id": 622238142,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMjIzODE0Mg==",
    "diff_hunk": "@@ -58,7 +58,8 @@ size_t CTxMemPoolEntry::GetTxSize() const\n // Update the given tx for any in-mempool descendants.\n // Assumes that CTxMemPool::m_children is correct for the given tx and all\n // descendants.\n-void CTxMemPool::UpdateForDescendants(txiter updateIt, cacheMap &cachedDescendants, const std::set<uint256> &setExclude)\n+void CTxMemPool::UpdateForDescendants(txiter updateIt, cacheMap &cachedDescendants, const std::set<uint256> &setExclude,\n+        std::set<uint256> &set_should_remove, uint64_t ancestor_size_limit, uint64_t ancestor_limit)",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 6,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "e8dafeb7004e4b0ed896ef08383bb22d9087a749",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\n        std::set<uint256>& set_should_remove, uint64_t ancestor_size_limit, uint64_t ancestor_limit)\r\n```",
    "created_at": "2021-04-28T14:30:37Z",
    "updated_at": "2021-04-28T16:46:37Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r622238142",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622238142"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r622238142"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622238142/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 62,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622464539",
    "pull_request_review_id": 647426146,
    "id": 622464539,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMjQ2NDUzOQ==",
    "diff_hunk": "@@ -667,7 +667,8 @@ class CTxMemPool\n      *  for).  Note: vHashesToUpdate should be the set of transactions from the\n      *  disconnected block that have been accepted back into the mempool.\n      */\n-    void UpdateTransactionsFromBlock(const std::vector<uint256>& vHashesToUpdate) EXCLUSIVE_LOCKS_REQUIRED(cs, cs_main) LOCKS_EXCLUDED(m_epoch);\n+    void UpdateTransactionsFromBlock(const std::vector<uint256>& vHashesToUpdate,\n+            uint64_t ancestor_size_limit, uint64_t ancestor_limit) EXCLUSIVE_LOCKS_REQUIRED(cs, cs_main) LOCKS_EXCLUDED(m_epoch);",
    "path": "src/txmempool.h",
    "position": null,
    "original_position": 6,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "e8dafeb7004e4b0ed896ef08383bb22d9087a749",
    "user": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "mmmm maybe. In general in the mempool I think the functions accept parameters with limits as opposed to being static in the mempool, and I think it would be confusing to be inconsistent. I like that passing in limits makes it explicit what the code will do, and forces any caller to consider what limit they should use.\r\n\r\nWhere these limits get enforced later they are set by reading configuration parameter at the time of transaction acceptance rather than on startup, so altering this behavior could lead to an inconsistency down the line if someone at runtime increased the setting.",
    "created_at": "2021-04-28T19:11:07Z",
    "updated_at": "2021-04-28T19:11:08Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r622464539",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622464539"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r622464539"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622464539/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 671,
    "side": "RIGHT",
    "in_reply_to_id": 622149124
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622465499",
    "pull_request_review_id": 647427272,
    "id": 622465499,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMjQ2NTQ5OQ==",
    "diff_hunk": "@@ -667,7 +667,8 @@ class CTxMemPool\n      *  for).  Note: vHashesToUpdate should be the set of transactions from the\n      *  disconnected block that have been accepted back into the mempool.\n      */\n-    void UpdateTransactionsFromBlock(const std::vector<uint256>& vHashesToUpdate) EXCLUSIVE_LOCKS_REQUIRED(cs, cs_main) LOCKS_EXCLUDED(m_epoch);\n+    void UpdateTransactionsFromBlock(const std::vector<uint256>& vHashesToUpdate,\n+            uint64_t ancestor_size_limit, uint64_t ancestor_limit) EXCLUSIVE_LOCKS_REQUIRED(cs, cs_main) LOCKS_EXCLUDED(m_epoch);",
    "path": "src/txmempool.h",
    "position": null,
    "original_position": 6,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "e8dafeb7004e4b0ed896ef08383bb22d9087a749",
    "user": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Saying as this function doesn't have doxygen comments is this a request to doxygen comment it?\r\n\r\nIf I set default values for these params would that be better so as not to disrupt the fsig?",
    "created_at": "2021-04-28T19:12:34Z",
    "updated_at": "2021-04-28T19:12:34Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r622465499",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622465499"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r622465499"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622465499/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 669,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 671,
    "side": "RIGHT",
    "in_reply_to_id": 613563758
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622788810",
    "pull_request_review_id": 647875983,
    "id": 622788810,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMjc4ODgxMA==",
    "diff_hunk": "@@ -667,7 +667,8 @@ class CTxMemPool\n      *  for).  Note: vHashesToUpdate should be the set of transactions from the\n      *  disconnected block that have been accepted back into the mempool.\n      */\n-    void UpdateTransactionsFromBlock(const std::vector<uint256>& vHashesToUpdate) EXCLUSIVE_LOCKS_REQUIRED(cs, cs_main) LOCKS_EXCLUDED(m_epoch);\n+    void UpdateTransactionsFromBlock(const std::vector<uint256>& vHashesToUpdate,\n+            uint64_t ancestor_size_limit, uint64_t ancestor_limit) EXCLUSIVE_LOCKS_REQUIRED(cs, cs_main) LOCKS_EXCLUDED(m_epoch);",
    "path": "src/txmempool.h",
    "position": null,
    "original_position": 6,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "e8dafeb7004e4b0ed896ef08383bb22d9087a749",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> In general in the mempool I think the functions accept parameters with limits\r\n\r\nI think that's more a historical artifact that until #19556, the mempool was a global that was constructed before `main()`. If we were building this from scratch, I think we'd make any mempool parameters that can't be changed at runtime const and set in the ctor, rather than using globals.\r\n\r\n> lead to an inconsistency down the line if someone at runtime increased the setting.\r\n\r\nChanging these limits during runtime seems like a terrible idea! There would be all kinds of edge-cases where it'd be difficult to ensure that invariants aren't being invalidated.\r\n\r\nAnyway, your choice. This is just a suggestion and could be done after this PR. Whenever I see function arguments where the same value is always passed (eg `UpdateTransactionsFromBlock()` in this PR), then it suggests to me that the interface can be simplified.",
    "created_at": "2021-04-29T07:12:36Z",
    "updated_at": "2021-04-29T07:12:36Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r622788810",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622788810"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r622788810"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622788810/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 671,
    "side": "RIGHT",
    "in_reply_to_id": 622149124
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622791296",
    "pull_request_review_id": 647879109,
    "id": 622791296,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMjc5MTI5Ng==",
    "diff_hunk": "@@ -667,7 +667,8 @@ class CTxMemPool\n      *  for).  Note: vHashesToUpdate should be the set of transactions from the\n      *  disconnected block that have been accepted back into the mempool.\n      */\n-    void UpdateTransactionsFromBlock(const std::vector<uint256>& vHashesToUpdate) EXCLUSIVE_LOCKS_REQUIRED(cs, cs_main) LOCKS_EXCLUDED(m_epoch);\n+    void UpdateTransactionsFromBlock(const std::vector<uint256>& vHashesToUpdate,\n+            uint64_t ancestor_size_limit, uint64_t ancestor_limit) EXCLUSIVE_LOCKS_REQUIRED(cs, cs_main) LOCKS_EXCLUDED(m_epoch);",
    "path": "src/txmempool.h",
    "position": null,
    "original_position": 6,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "e8dafeb7004e4b0ed896ef08383bb22d9087a749",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> Changing these limits during runtime seems like a terrible idea!\r\n\r\nAgree. Though, the tx_pool fuzz targets do this and they haven't (yet) crashed :grimacing: ",
    "created_at": "2021-04-29T07:16:49Z",
    "updated_at": "2021-04-29T07:16:49Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r622791296",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622791296"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r622791296"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/622791296/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 671,
    "side": "RIGHT",
    "in_reply_to_id": 622149124
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/641895223",
    "pull_request_review_id": 671717995,
    "id": 641895223,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MTg5NTIyMw==",
    "diff_hunk": "@@ -117,6 +124,8 @@ void CTxMemPool::UpdateTransactionsFromBlock(const std::vector<uint256> &vHashes\n     // accounted for in the state of their ancestors)\n     std::set<uint256> setAlreadyIncluded(vHashesToUpdate.begin(), vHashesToUpdate.end());\n \n+    std::set<uint256> set_should_remove;",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 36,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "e8dafeb7004e4b0ed896ef08383bb22d9087a749",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Even more speaking `descendants_to_remove`",
    "created_at": "2021-05-29T05:53:48Z",
    "updated_at": "2021-05-29T06:05:41Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r641895223",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/641895223"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r641895223"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/641895223/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 127,
    "side": "RIGHT",
    "in_reply_to_id": 622223859
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/641895417",
    "pull_request_review_id": 671717995,
    "id": 641895417,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MTg5NTQxNw==",
    "diff_hunk": "@@ -146,7 +155,16 @@ void CTxMemPool::UpdateTransactionsFromBlock(const std::vector<uint256> &vHashes\n                 }\n             }\n         } // release epoch guard for UpdateForDescendants\n-        UpdateForDescendants(it, mapMemPoolDescendantsToUpdate, setAlreadyIncluded);\n+        UpdateForDescendants(it, mapMemPoolDescendantsToUpdate, setAlreadyIncluded, set_should_remove, ancestor_size_limit, ancestor_limit);\n+    }\n+\n+    for (auto& txid : set_should_remove) {\n+        // This txid may have been removed already in a prior call to removeRecursive.\n+        // Therefore we ensure it is not yet removed already.\n+        const std::optional<txiter> txiter_opt = GetIter(txid);\n+        if (txiter_opt) {\n+            removeRecursive((*txiter_opt)->GetTx(), MemPoolRemovalReason::SIZELIMIT);",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 54,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "e8dafeb7004e4b0ed896ef08383bb22d9087a749",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "You could even introduce a new `MemPoolRemovalReason::ANCESTORLIMIT`. This check is different than the one applied by `TrimToSize` on absolute mempool size.\r\n\r\nIt would be a clearer message for listeners of validation interface.",
    "created_at": "2021-05-29T05:55:55Z",
    "updated_at": "2021-05-29T06:05:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r641895417",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/641895417"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r641895417"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/641895417/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 166,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/641895672",
    "pull_request_review_id": 671717995,
    "id": 641895672,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MTg5NTY3Mg==",
    "diff_hunk": "@@ -414,7 +414,9 @@ static void UpdateMempoolForReorg(CChainState& active_chainstate, CTxMemPool& me\n     // previously-confirmed transactions back to the mempool.\n     // UpdateTransactionsFromBlock finds descendants of any transactions in\n     // the disconnectpool that were added back and cleans up the mempool state.\n-    mempool.UpdateTransactionsFromBlock(vHashUpdate);\n+    uint64_t ancestor_limit = gArgs.GetArg(\"-limitancestorcount\", DEFAULT_ANCESTOR_LIMIT);\n+    uint64_t ancestor_limit_size = gArgs.GetArg(\"-limitancestorsize\", DEFAULT_ANCESTOR_SIZE_LIMIT) * 1000;",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 6,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "e8dafeb7004e4b0ed896ef08383bb22d9087a749",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "What do you think about hardcoded ancestor_limit/ancestor_limit_size, instead of relying on node operators settings ?\r\n\r\nAs it's a performance optimization it might be easier to get predictable improvements with invariants.",
    "created_at": "2021-05-29T05:59:37Z",
    "updated_at": "2021-05-29T06:05:41Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r641895672",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/641895672"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r641895672"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/641895672/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 369,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/647504001",
    "pull_request_review_id": 678604304,
    "id": 647504001,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NzUwNDAwMQ==",
    "diff_hunk": "@@ -414,7 +414,9 @@ static void UpdateMempoolForReorg(CChainState& active_chainstate, CTxMemPool& me\n     // previously-confirmed transactions back to the mempool.\n     // UpdateTransactionsFromBlock finds descendants of any transactions in\n     // the disconnectpool that were added back and cleans up the mempool state.\n-    mempool.UpdateTransactionsFromBlock(vHashUpdate);\n+    uint64_t ancestor_limit = gArgs.GetArg(\"-limitancestorcount\", DEFAULT_ANCESTOR_LIMIT);\n+    uint64_t ancestor_limit_size = gArgs.GetArg(\"-limitancestorsize\", DEFAULT_ANCESTOR_SIZE_LIMIT) * 1000;",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 6,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "e8dafeb7004e4b0ed896ef08383bb22d9087a749",
    "user": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think that would lead to miners to custom compiling to configure rather than running releases -- maybe we need a survey of what settings mining node operators are using?",
    "created_at": "2021-06-08T14:34:26Z",
    "updated_at": "2021-06-08T14:34:26Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r647504001",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/647504001"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r647504001"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/647504001/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 369,
    "side": "RIGHT",
    "in_reply_to_id": 641895672
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667385626",
    "pull_request_review_id": 703529830,
    "id": 667385626,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NzM4NTYyNg==",
    "diff_hunk": "@@ -146,7 +155,16 @@ void CTxMemPool::UpdateTransactionsFromBlock(const std::vector<uint256> &vHashes\n                 }\n             }\n         } // release epoch guard for UpdateForDescendants\n-        UpdateForDescendants(it, mapMemPoolDescendantsToUpdate, setAlreadyIncluded);\n+        UpdateForDescendants(it, mapMemPoolDescendantsToUpdate, setAlreadyIncluded, set_should_remove, ancestor_size_limit, ancestor_limit);\n+    }\n+\n+    for (auto& txid : set_should_remove) {\n+        // This txid may have been removed already in a prior call to removeRecursive.\n+        // Therefore we ensure it is not yet removed already.\n+        const std::optional<txiter> txiter_opt = GetIter(txid);\n+        if (txiter_opt) {\n+            removeRecursive((*txiter_opt)->GetTx(), MemPoolRemovalReason::SIZELIMIT);",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 54,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "e8dafeb7004e4b0ed896ef08383bb22d9087a749",
    "user": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "done",
    "created_at": "2021-07-10T21:09:30Z",
    "updated_at": "2021-07-10T21:09:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r667385626",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667385626"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r667385626"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667385626/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 166,
    "side": "RIGHT",
    "in_reply_to_id": 641895417
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667858736",
    "pull_request_review_id": 704016126,
    "id": 667858736,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Nzg1ODczNg==",
    "diff_hunk": "@@ -146,7 +155,16 @@ void CTxMemPool::UpdateTransactionsFromBlock(const std::vector<uint256> &vHashes\n                 }\n             }\n         } // release epoch guard for UpdateForDescendants\n-        UpdateForDescendants(it, mapMemPoolDescendantsToUpdate, setAlreadyIncluded);\n+        UpdateForDescendants(it, mapMemPoolDescendantsToUpdate, setAlreadyIncluded, set_should_remove, ancestor_size_limit, ancestor_limit);\n+    }\n+\n+    for (auto& txid : set_should_remove) {\n+        // This txid may have been removed already in a prior call to removeRecursive.\n+        // Therefore we ensure it is not yet removed already.\n+        const std::optional<txiter> txiter_opt = GetIter(txid);\n+        if (txiter_opt) {\n+            removeRecursive((*txiter_opt)->GetTx(), MemPoolRemovalReason::SIZELIMIT);",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 54,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "e8dafeb7004e4b0ed896ef08383bb22d9087a749",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I don't think this change is necessary for this PR. Unless there's a validation interface client that uses the new `MemPoolRemovalReason::ANCESTORLIMIT`, then it's just broadening that interface for no benefit. If we find that a client needs to use this in future, it'll be easy to add it at that point.",
    "created_at": "2021-07-12T11:44:55Z",
    "updated_at": "2021-07-12T11:44:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r667858736",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667858736"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r667858736"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667858736/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 166,
    "side": "RIGHT",
    "in_reply_to_id": 641895417
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/670856144",
    "pull_request_review_id": 707881561,
    "id": 670856144,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MDg1NjE0NA==",
    "diff_hunk": "@@ -146,7 +155,16 @@ void CTxMemPool::UpdateTransactionsFromBlock(const std::vector<uint256> &vHashes\n                 }\n             }\n         } // release epoch guard for UpdateForDescendants\n-        UpdateForDescendants(it, mapMemPoolDescendantsToUpdate, setAlreadyIncluded);\n+        UpdateForDescendants(it, mapMemPoolDescendantsToUpdate, setAlreadyIncluded, set_should_remove, ancestor_size_limit, ancestor_limit);\n+    }\n+\n+    for (auto& txid : set_should_remove) {\n+        // This txid may have been removed already in a prior call to removeRecursive.\n+        // Therefore we ensure it is not yet removed already.\n+        const std::optional<txiter> txiter_opt = GetIter(txid);\n+        if (txiter_opt) {\n+            removeRecursive((*txiter_opt)->GetTx(), MemPoolRemovalReason::SIZELIMIT);",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 54,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "e8dafeb7004e4b0ed896ef08383bb22d9087a749",
    "user": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I will drop this commit and open a new PR with it for @ariard.",
    "created_at": "2021-07-15T22:56:09Z",
    "updated_at": "2021-07-15T22:56:09Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r670856144",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/670856144"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r670856144"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/670856144/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 166,
    "side": "RIGHT",
    "in_reply_to_id": 641895417
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/671306152",
    "pull_request_review_id": 708453240,
    "id": 671306152,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MTMwNjE1Mg==",
    "diff_hunk": "@@ -794,19 +802,28 @@ class CTxMemPool\n     /** UpdateForDescendants is used by UpdateTransactionsFromBlock to update\n      *  the descendants for a single transaction that has been added to the\n      *  mempool but may have child transactions in the mempool, eg during a\n-     *  chain reorg.  setExclude is the set of descendant transactions in the\n-     *  mempool that must not be accounted for (because any descendants in\n-     *  setExclude were added to the mempool after the transaction being\n-     *  updated and hence their state is already reflected in the parent\n-     *  state).\n+     *  chain reorg.\n      *\n-     *  cachedDescendants will be updated with the descendants of the transaction\n-     *  being updated, so that future invocations don't need to walk the\n-     *  same transaction again, if encountered in another transaction chain.\n+     * @param[in] updateIt the entry to update for it's descendants\n+     * @param[in] cachedDescendants a cache where each line corresponds to all\n+     *     descendants. It will be updated with the descendants of the transaction\n+     *     being updated, so that future invocations don't need to walk the same\n+     *     transaction again, if encountered in another transaction chain.\n+     * @param[in] setExclude the set of descendant transactions in the mempool\n+     *     that must not be accounted for (because any descendants in setExclude\n+     *     were added to the mempool after the transaction being updated and hence\n+     *     their state is already reflected in the parent state).\n+     * @param[out] descendants_to_remove Populated with the txids of entries that\n+     *     exceed ancestor limits. It's the responsibility of the caller to\n+     *     removeRecursive them.\n+     * @param[in] ancestor_size_limit the max number of ancestral bytes allowed\n+     *     for any descendant\n+     * @param[in] ancestor_count_limit the max number of ancestor transactions\n+     *     allowed for any descendant",
    "path": "src/txmempool.h",
    "position": 74,
    "original_position": 51,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "2820b04797e3c9d58cd5d9ea4d4aec00c8b5f074",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Limits are inclusive and apply to all entries\r\n\r\n```suggestion\r\n     * @param[in] ancestor_size_limit      The maximum allowed size in virtual bytes of an entry and its ancestors\r\n     * @param[in] ancestor_count_limit     The maximum allowed number of transactions including the entry and its ancestors.\r\n\r\n```",
    "created_at": "2021-07-16T14:37:29Z",
    "updated_at": "2021-07-16T14:42:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r671306152",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/671306152"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r671306152"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/671306152/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 830,
    "original_start_line": 819,
    "start_side": "RIGHT",
    "line": 833,
    "original_line": 833,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/676474898",
    "pull_request_review_id": 714677390,
    "id": 676474898,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3NjQ3NDg5OA==",
    "diff_hunk": "@@ -794,19 +802,28 @@ class CTxMemPool\n     /** UpdateForDescendants is used by UpdateTransactionsFromBlock to update\n      *  the descendants for a single transaction that has been added to the\n      *  mempool but may have child transactions in the mempool, eg during a\n-     *  chain reorg.  setExclude is the set of descendant transactions in the\n-     *  mempool that must not be accounted for (because any descendants in\n-     *  setExclude were added to the mempool after the transaction being\n-     *  updated and hence their state is already reflected in the parent\n-     *  state).\n+     *  chain reorg.\n      *\n-     *  cachedDescendants will be updated with the descendants of the transaction\n-     *  being updated, so that future invocations don't need to walk the\n-     *  same transaction again, if encountered in another transaction chain.\n+     * @param[in] updateIt the entry to update for it's descendants\n+     * @param[in] cachedDescendants a cache where each line corresponds to all\n+     *     descendants. It will be updated with the descendants of the transaction\n+     *     being updated, so that future invocations don't need to walk the same\n+     *     transaction again, if encountered in another transaction chain.\n+     * @param[in] setExclude the set of descendant transactions in the mempool\n+     *     that must not be accounted for (because any descendants in setExclude\n+     *     were added to the mempool after the transaction being updated and hence\n+     *     their state is already reflected in the parent state).\n+     * @param[out] descendants_to_remove Populated with the txids of entries that\n+     *     exceed ancestor limits. It's the responsibility of the caller to\n+     *     removeRecursive them.\n+     * @param[in] ancestor_size_limit the max number of ancestral bytes allowed\n+     *     for any descendant\n+     * @param[in] ancestor_count_limit the max number of ancestor transactions\n+     *     allowed for any descendant",
    "path": "src/txmempool.h",
    "position": 74,
    "original_position": 51,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "2820b04797e3c9d58cd5d9ea4d4aec00c8b5f074",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "(also much prefer this formatting style with a visual gap between the parameter name and the documentation).",
    "created_at": "2021-07-26T10:17:51Z",
    "updated_at": "2021-07-26T11:31:53Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r676474898",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/676474898"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r676474898"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/676474898/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 830,
    "original_start_line": 819,
    "start_side": "RIGHT",
    "line": 833,
    "original_line": 833,
    "side": "RIGHT",
    "in_reply_to_id": 671306152
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/676475637",
    "pull_request_review_id": 714677390,
    "id": 676475637,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3NjQ3NTYzNw==",
    "diff_hunk": "@@ -664,10 +664,18 @@ class CTxMemPool\n      *  UpdateTransactionsFromBlock() will find child transactions and update the\n      *  descendant state for each transaction in vHashesToUpdate (excluding any\n      *  child transactions present in vHashesToUpdate, which are already accounted\n-     *  for).  Note: vHashesToUpdate should be the set of transactions from the\n-     *  disconnected block that have been accepted back into the mempool.\n+     *  for).\n+     *\n+     * @param[in] vHashesToUpdate should be the set of transactions IDs from",
    "path": "src/txmempool.h",
    "position": null,
    "original_position": 8,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "2820b04797e3c9d58cd5d9ea4d4aec00c8b5f074",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "\"should be\" implies that this function could be called with a different set of transactions. In fact, `vHashesToUpdate` is always the set of transactions from the disconnected block that have been added back to the mempool:\r\n\r\n```suggestion\r\n     * @param[in] vHashesToUpdate   the set of txids from\r\n```",
    "created_at": "2021-07-26T10:19:01Z",
    "updated_at": "2021-07-26T11:31:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r676475637",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/676475637"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r676475637"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/676475637/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 669,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/676476269",
    "pull_request_review_id": 714677390,
    "id": 676476269,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3NjQ3NjI2OQ==",
    "diff_hunk": "@@ -794,19 +802,28 @@ class CTxMemPool\n     /** UpdateForDescendants is used by UpdateTransactionsFromBlock to update\n      *  the descendants for a single transaction that has been added to the\n      *  mempool but may have child transactions in the mempool, eg during a\n-     *  chain reorg.  setExclude is the set of descendant transactions in the\n-     *  mempool that must not be accounted for (because any descendants in\n-     *  setExclude were added to the mempool after the transaction being\n-     *  updated and hence their state is already reflected in the parent\n-     *  state).\n+     *  chain reorg.\n      *\n-     *  cachedDescendants will be updated with the descendants of the transaction\n-     *  being updated, so that future invocations don't need to walk the\n-     *  same transaction again, if encountered in another transaction chain.\n+     * @param[in] updateIt the entry to update for it's descendants",
    "path": "src/txmempool.h",
    "position": null,
    "original_position": 36,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "2820b04797e3c9d58cd5d9ea4d4aec00c8b5f074",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\n     * @param[in] updateIt the entry to update for its descendants\r\n```",
    "created_at": "2021-07-26T10:20:01Z",
    "updated_at": "2021-07-26T11:31:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r676476269",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/676476269"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r676476269"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/676476269/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 807,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/676478069",
    "pull_request_review_id": 714677390,
    "id": 676478069,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3NjQ3ODA2OQ==",
    "diff_hunk": "@@ -106,7 +114,7 @@ void CTxMemPool::UpdateForDescendants(txiter updateIt, cacheMap &cachedDescendan\n // for each entry, look for descendants that are outside vHashesToUpdate, and\n // add fee/size information for such descendants to the parent.\n // for each such descendant, also update the ancestor state to include the parent.\n-void CTxMemPool::UpdateTransactionsFromBlock(const std::vector<uint256> &vHashesToUpdate)\n+void CTxMemPool::UpdateTransactionsFromBlock(const std::vector<uint256> &vHashesToUpdate, uint64_t ancestor_size_limit, uint64_t ancestor_count_limit)",
    "path": "src/txmempool.cpp",
    "position": 35,
    "original_position": 29,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "2820b04797e3c9d58cd5d9ea4d4aec00c8b5f074",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Perhaps remove the comment above this function definition (it's redundant with the doxygen comment above the declaration)",
    "created_at": "2021-07-26T10:22:49Z",
    "updated_at": "2021-07-26T11:31:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r676478069",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/676478069"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r676478069"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/676478069/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 109,
    "original_line": 109,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/676479733",
    "pull_request_review_id": 714677390,
    "id": 676479733,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3NjQ3OTczMw==",
    "diff_hunk": "@@ -794,19 +802,28 @@ class CTxMemPool\n     /** UpdateForDescendants is used by UpdateTransactionsFromBlock to update\n      *  the descendants for a single transaction that has been added to the\n      *  mempool but may have child transactions in the mempool, eg during a\n-     *  chain reorg.  setExclude is the set of descendant transactions in the\n-     *  mempool that must not be accounted for (because any descendants in\n-     *  setExclude were added to the mempool after the transaction being\n-     *  updated and hence their state is already reflected in the parent\n-     *  state).\n+     *  chain reorg.\n      *\n-     *  cachedDescendants will be updated with the descendants of the transaction\n-     *  being updated, so that future invocations don't need to walk the\n-     *  same transaction again, if encountered in another transaction chain.\n+     * @param[in] updateIt the entry to update for it's descendants\n+     * @param[in] cachedDescendants a cache where each line corresponds to all",
    "path": "src/txmempool.h",
    "position": null,
    "original_position": 37,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "2820b04797e3c9d58cd5d9ea4d4aec00c8b5f074",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\n     * @param[in/out] cachedDescendants a cache where each line corresponds to all\r\n```",
    "created_at": "2021-07-26T10:25:19Z",
    "updated_at": "2021-07-26T11:31:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r676479733",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/676479733"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r676479733"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/676479733/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 808,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/677825052",
    "pull_request_review_id": 716409057,
    "id": 677825052,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3NzgyNTA1Mg==",
    "diff_hunk": "@@ -17,7 +17,7 @@\n class MempoolUpdateFromBlockTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.num_nodes = 1\n-        self.extra_args = [['-limitdescendantsize=1000', '-limitancestorsize=1000']]\n+        self.extra_args = [['-limitdescendantsize=1000', '-limitancestorsize=1000', '-limitancestorcount=100']]",
    "path": "test/functional/mempool_updatefromblock.py",
    "position": 5,
    "original_position": 5,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "2820b04797e3c9d58cd5d9ea4d4aec00c8b5f074",
    "user": {
      "login": "reemuru",
      "id": 13033037,
      "node_id": "MDQ6VXNlcjEzMDMzMDM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/13033037?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/reemuru",
      "html_url": "https://github.com/reemuru",
      "followers_url": "https://api.github.com/users/reemuru/followers",
      "following_url": "https://api.github.com/users/reemuru/following{/other_user}",
      "gists_url": "https://api.github.com/users/reemuru/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/reemuru/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/reemuru/subscriptions",
      "organizations_url": "https://api.github.com/users/reemuru/orgs",
      "repos_url": "https://api.github.com/users/reemuru/repos",
      "events_url": "https://api.github.com/users/reemuru/events{/privacy}",
      "received_events_url": "https://api.github.com/users/reemuru/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Is this change necessary? I'm currently updating the functional test for MiniWallet compatibility",
    "created_at": "2021-07-27T21:50:26Z",
    "updated_at": "2021-07-27T21:57:37Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r677825052",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "NONE",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/677825052"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r677825052"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/677825052/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 20,
    "original_line": 20,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/680418371",
    "pull_request_review_id": 719607659,
    "id": 680418371,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4MDQxODM3MQ==",
    "diff_hunk": "@@ -17,7 +17,7 @@\n class MempoolUpdateFromBlockTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.num_nodes = 1\n-        self.extra_args = [['-limitdescendantsize=1000', '-limitancestorsize=1000']]\n+        self.extra_args = [['-limitdescendantsize=1000', '-limitancestorsize=1000', '-limitancestorcount=100']]",
    "path": "test/functional/mempool_updatefromblock.py",
    "position": 5,
    "original_position": 5,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "2820b04797e3c9d58cd5d9ea4d4aec00c8b5f074",
    "user": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "yes",
    "created_at": "2021-07-31T22:41:26Z",
    "updated_at": "2021-07-31T22:41:27Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r680418371",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/680418371"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r680418371"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/680418371/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 20,
    "original_line": 20,
    "side": "RIGHT",
    "in_reply_to_id": 677825052
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690304785",
    "pull_request_review_id": 731677906,
    "id": 690304785,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MDMwNDc4NQ==",
    "diff_hunk": "@@ -365,7 +365,9 @@ void CChainState::MaybeUpdateMempoolForReorg(\n     // previously-confirmed transactions back to the mempool.\n     // UpdateTransactionsFromBlock finds descendants of any transactions in\n     // the disconnectpool that were added back and cleans up the mempool state.\n-    m_mempool->UpdateTransactionsFromBlock(vHashUpdate);\n+    uint64_t ancestor_limit = gArgs.GetArg(\"-limitancestorcount\", DEFAULT_ANCESTOR_LIMIT);",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "2820b04797e3c9d58cd5d9ea4d4aec00c8b5f074",
    "user": {
      "login": "Talkless",
      "id": 292191,
      "node_id": "MDQ6VXNlcjI5MjE5MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/292191?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Talkless",
      "html_url": "https://github.com/Talkless",
      "followers_url": "https://api.github.com/users/Talkless/followers",
      "following_url": "https://api.github.com/users/Talkless/following{/other_user}",
      "gists_url": "https://api.github.com/users/Talkless/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Talkless/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Talkless/subscriptions",
      "organizations_url": "https://api.github.com/users/Talkless/orgs",
      "repos_url": "https://api.github.com/users/Talkless/repos",
      "events_url": "https://api.github.com/users/Talkless/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Talkless/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Maybe worth renaming `ancestor_limit` into `ancestor_limit_count`, to be more symmetrical with `ancestor_limit_size`/`limitancestorsize` pair?\r\n\r\nAlso, `UpdateTransactionsFromBlock` and `UpdateForDescendants` has these parameters phrased a bit differently with `ancestor_size_limit` and `ancestor_count_limit` (\"limit\" goes last). Maybe worth unifying all these new names?",
    "created_at": "2021-08-17T12:04:56Z",
    "updated_at": "2021-08-17T12:15:36Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r690304785",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "NONE",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690304785"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r690304785"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690304785/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 368,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690305089",
    "pull_request_review_id": 731677906,
    "id": 690305089,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MDMwNTA4OQ==",
    "diff_hunk": "@@ -365,7 +365,9 @@ void CChainState::MaybeUpdateMempoolForReorg(\n     // previously-confirmed transactions back to the mempool.\n     // UpdateTransactionsFromBlock finds descendants of any transactions in\n     // the disconnectpool that were added back and cleans up the mempool state.\n-    m_mempool->UpdateTransactionsFromBlock(vHashUpdate);\n+    uint64_t ancestor_limit = gArgs.GetArg(\"-limitancestorcount\", DEFAULT_ANCESTOR_LIMIT);",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "2820b04797e3c9d58cd5d9ea4d4aec00c8b5f074",
    "user": {
      "login": "Talkless",
      "id": 292191,
      "node_id": "MDQ6VXNlcjI5MjE5MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/292191?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Talkless",
      "html_url": "https://github.com/Talkless",
      "followers_url": "https://api.github.com/users/Talkless/followers",
      "following_url": "https://api.github.com/users/Talkless/following{/other_user}",
      "gists_url": "https://api.github.com/users/Talkless/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Talkless/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Talkless/subscriptions",
      "organizations_url": "https://api.github.com/users/Talkless/orgs",
      "repos_url": "https://api.github.com/users/Talkless/repos",
      "events_url": "https://api.github.com/users/Talkless/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Talkless/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Also, `ancestor_limit` and `ancestor_limit_size` could be `const`.",
    "created_at": "2021-08-17T12:05:24Z",
    "updated_at": "2021-08-17T12:15:36Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r690305089",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "NONE",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690305089"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r690305089"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690305089/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 368,
    "side": "RIGHT",
    "in_reply_to_id": 690304785
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690305816",
    "pull_request_review_id": 731677906,
    "id": 690305816,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MDMwNTgxNg==",
    "diff_hunk": "@@ -147,7 +157,15 @@ void CTxMemPool::UpdateTransactionsFromBlock(const std::vector<uint256> &vHashes\n                 }\n             }\n         } // release epoch guard for UpdateForDescendants\n-        UpdateForDescendants(it, mapMemPoolDescendantsToUpdate, setAlreadyIncluded);\n+        UpdateForDescendants(it, mapMemPoolDescendantsToUpdate, setAlreadyIncluded, descendants_to_remove, ancestor_size_limit, ancestor_count_limit);\n+    }\n+\n+    for (auto& txid : descendants_to_remove) {",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 50,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "2820b04797e3c9d58cd5d9ea4d4aec00c8b5f074",
    "user": {
      "login": "Talkless",
      "id": 292191,
      "node_id": "MDQ6VXNlcjI5MjE5MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/292191?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Talkless",
      "html_url": "https://github.com/Talkless",
      "followers_url": "https://api.github.com/users/Talkless/followers",
      "following_url": "https://api.github.com/users/Talkless/following{/other_user}",
      "gists_url": "https://api.github.com/users/Talkless/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Talkless/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Talkless/subscriptions",
      "organizations_url": "https://api.github.com/users/Talkless/orgs",
      "repos_url": "https://api.github.com/users/Talkless/repos",
      "events_url": "https://api.github.com/users/Talkless/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Talkless/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "could be `const auto& txid`.",
    "created_at": "2021-08-17T12:06:35Z",
    "updated_at": "2021-08-17T12:15:36Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r690305816",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "NONE",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690305816"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r690305816"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690305816/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 163,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706874757",
    "pull_request_review_id": 752185040,
    "id": 706874757,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNjg3NDc1Nw==",
    "diff_hunk": "@@ -794,19 +802,28 @@ class CTxMemPool\n     /** UpdateForDescendants is used by UpdateTransactionsFromBlock to update\n      *  the descendants for a single transaction that has been added to the\n      *  mempool but may have child transactions in the mempool, eg during a\n-     *  chain reorg.  setExclude is the set of descendant transactions in the\n-     *  mempool that must not be accounted for (because any descendants in\n-     *  setExclude were added to the mempool after the transaction being\n-     *  updated and hence their state is already reflected in the parent\n-     *  state).\n+     *  chain reorg.\n      *\n-     *  cachedDescendants will be updated with the descendants of the transaction\n-     *  being updated, so that future invocations don't need to walk the\n-     *  same transaction again, if encountered in another transaction chain.\n+     * @param[in] updateIt the entry to update for it's descendants\n+     * @param[in] cachedDescendants a cache where each line corresponds to all\n+     *     descendants. It will be updated with the descendants of the transaction\n+     *     being updated, so that future invocations don't need to walk the same\n+     *     transaction again, if encountered in another transaction chain.\n+     * @param[in] setExclude the set of descendant transactions in the mempool\n+     *     that must not be accounted for (because any descendants in setExclude\n+     *     were added to the mempool after the transaction being updated and hence\n+     *     their state is already reflected in the parent state).\n+     * @param[out] descendants_to_remove Populated with the txids of entries that\n+     *     exceed ancestor limits. It's the responsibility of the caller to\n+     *     removeRecursive them.\n+     * @param[in] ancestor_size_limit the max number of ancestral bytes allowed\n+     *     for any descendant\n+     * @param[in] ancestor_count_limit the max number of ancestor transactions\n+     *     allowed for any descendant",
    "path": "src/txmempool.h",
    "position": 74,
    "original_position": 51,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "2820b04797e3c9d58cd5d9ea4d4aec00c8b5f074",
    "user": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "fwiw if you use a text editor which understands doxygen you get something which looks fine without a visual gap.\r\n<img width=\"588\" alt=\"image\" src=\"https://user-images.githubusercontent.com/886523/132998517-30b6dee2-137e-46c6-8a26-307a5cdea93c.png\">\r\n",
    "created_at": "2021-09-12T18:21:54Z",
    "updated_at": "2021-09-12T18:21:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r706874757",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706874757"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r706874757"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706874757/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 830,
    "original_start_line": 819,
    "start_side": "RIGHT",
    "line": 833,
    "original_line": 833,
    "side": "RIGHT",
    "in_reply_to_id": 671306152
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706876738",
    "pull_request_review_id": 752186267,
    "id": 706876738,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNjg3NjczOA==",
    "diff_hunk": "@@ -794,19 +802,28 @@ class CTxMemPool\n     /** UpdateForDescendants is used by UpdateTransactionsFromBlock to update\n      *  the descendants for a single transaction that has been added to the\n      *  mempool but may have child transactions in the mempool, eg during a\n-     *  chain reorg.  setExclude is the set of descendant transactions in the\n-     *  mempool that must not be accounted for (because any descendants in\n-     *  setExclude were added to the mempool after the transaction being\n-     *  updated and hence their state is already reflected in the parent\n-     *  state).\n+     *  chain reorg.\n      *\n-     *  cachedDescendants will be updated with the descendants of the transaction\n-     *  being updated, so that future invocations don't need to walk the\n-     *  same transaction again, if encountered in another transaction chain.\n+     * @param[in] updateIt the entry to update for it's descendants\n+     * @param[in] cachedDescendants a cache where each line corresponds to all",
    "path": "src/txmempool.h",
    "position": null,
    "original_position": 37,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "2820b04797e3c9d58cd5d9ea4d4aec00c8b5f074",
    "user": {
      "login": "JeremyRubin",
      "id": 886523,
      "node_id": "MDQ6VXNlcjg4NjUyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRubin",
      "html_url": "https://github.com/JeremyRubin",
      "followers_url": "https://api.github.com/users/JeremyRubin/followers",
      "following_url": "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
      "repos_url": "https://api.github.com/users/JeremyRubin/repos",
      "events_url": "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Is proper syntax is comma not slash?",
    "created_at": "2021-09-12T18:39:15Z",
    "updated_at": "2021-09-12T18:39:15Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r706876738",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706876738"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r706876738"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706876738/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 808,
    "side": "RIGHT",
    "in_reply_to_id": 676479733
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706878222",
    "pull_request_review_id": 752187245,
    "id": 706878222,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNjg3ODIyMg==",
    "diff_hunk": "@@ -794,19 +802,28 @@ class CTxMemPool\n     /** UpdateForDescendants is used by UpdateTransactionsFromBlock to update\n      *  the descendants for a single transaction that has been added to the\n      *  mempool but may have child transactions in the mempool, eg during a\n-     *  chain reorg.  setExclude is the set of descendant transactions in the\n-     *  mempool that must not be accounted for (because any descendants in\n-     *  setExclude were added to the mempool after the transaction being\n-     *  updated and hence their state is already reflected in the parent\n-     *  state).\n+     *  chain reorg.\n      *\n-     *  cachedDescendants will be updated with the descendants of the transaction\n-     *  being updated, so that future invocations don't need to walk the\n-     *  same transaction again, if encountered in another transaction chain.\n+     * @param[in] updateIt the entry to update for it's descendants\n+     * @param[in] cachedDescendants a cache where each line corresponds to all",
    "path": "src/txmempool.h",
    "position": null,
    "original_position": 37,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "2820b04797e3c9d58cd5d9ea4d4aec00c8b5f074",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yes, per https://www.doxygen.nl/manual/commands.html#cmdparam\r\n\r\n\"Possible values are \"[in]\", \"[in,out]\", and \"[out]\", note the [square] brackets in this description. When a parameter is both input and output, [in,out] is used as attribute.\"\r\n",
    "created_at": "2021-09-12T18:52:40Z",
    "updated_at": "2021-09-12T18:52:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r706878222",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706878222"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r706878222"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706878222/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 808,
    "side": "RIGHT",
    "in_reply_to_id": 676479733
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/749526368",
    "pull_request_review_id": 806341029,
    "id": 749526368,
    "node_id": "PRRC_kwDOABII584srN1g",
    "diff_hunk": "@@ -17,7 +17,7 @@\n class MempoolUpdateFromBlockTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.num_nodes = 1\n-        self.extra_args = [['-limitdescendantsize=1000', '-limitancestorsize=1000']]\n+        self.extra_args = [['-limitdescendantsize=1000', '-limitancestorsize=1000', '-limitancestorcount=100']]",
    "path": "test/functional/mempool_updatefromblock.py",
    "position": 5,
    "original_position": 5,
    "commit_id": "81efedb60e1e88f806adb010c926b4edd04393b8",
    "original_commit_id": "2820b04797e3c9d58cd5d9ea4d4aec00c8b5f074",
    "user": {
      "login": "mjdietzx",
      "id": 7217256,
      "node_id": "MDQ6VXNlcjcyMTcyNTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7217256?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mjdietzx",
      "html_url": "https://github.com/mjdietzx",
      "followers_url": "https://api.github.com/users/mjdietzx/followers",
      "following_url": "https://api.github.com/users/mjdietzx/following{/other_user}",
      "gists_url": "https://api.github.com/users/mjdietzx/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mjdietzx/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mjdietzx/subscriptions",
      "organizations_url": "https://api.github.com/users/mjdietzx/orgs",
      "repos_url": "https://api.github.com/users/mjdietzx/repos",
      "events_url": "https://api.github.com/users/mjdietzx/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mjdietzx/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I see that you are increasing the node's allowed `limitancestorcount` here, but I don't think it's being utilized? Bc the test params are hard-coded at L119 `self.transaction_graph_test(size=100, n_tx_to_mine=[25, 50, 75])`, and don't make use of the increased limit here. So you'd need to update that as well, right?",
    "created_at": "2021-11-15T17:11:42Z",
    "updated_at": "2021-11-15T17:15:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r749526368",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/749526368"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/21464#discussion_r749526368"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21464"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/749526368/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 20,
    "original_line": 20,
    "side": "RIGHT",
    "in_reply_to_id": 677825052
  }
]