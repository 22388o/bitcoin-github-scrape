DrahtBot,2019-01-18T22:38:34Z,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#16963](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16963.html) (wallet: Fix unique_ptr usage in boost::sign",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-455710836,455710836,
Sjors,2019-01-19T15:12:40Z,"Concept ACK, but let's put this in the Open Wallet sub menu. You could put a separator underneath the list of known wallets and then call the menu item ""Open file..."". I don't like the word ""External"" because it could get confusing if we add (e.g.) hardware wallet support.",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-455788450,455788450,
promag,2019-01-19T16:05:24Z,"@Sjors yes that was already brought up by @jnewbery and in IRC I suggested ""File -> Open Wallet -> Other..."" On the end of the menu.",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-455792468,455792468,
promag,2019-01-19T17:36:39Z,"@Sjors how about:\n<img width=""481"" alt=""screenshot 2019-01-19 at 17 26 36"" src=""https://user-images.githubusercontent.com/3534524/51430274-bc8e2f00-1c10-11e9-82b9-c736d5d43ef6.png"">\n",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-455799571,455799571,
jnewbery,2019-01-19T17:49:28Z,"> @Sjors how about:\n\nYes, this looks ideal to me",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-455800625,455800625,
promag,2019-01-19T21:10:39Z,Updated.,https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-455815438,455815438,
promag,2019-02-12T23:09:10Z,"Updated, still rebased on #15195.",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-462977537,462977537,
Sjors,2019-02-13T09:50:18Z,"tACK b537d29, but note that you can only open directory based wallets",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-463132136,463132136,
promag,2019-02-13T10:17:23Z,"@Sjors right, and it looks like a pain to try to open both with Qt ðŸ˜• ",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-463141747,463141747,
promag,2019-02-14T20:55:24Z,Is this for 0.18?,https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-463792296,463792296,
Sjors,2019-02-15T14:55:41Z,"Needs rebase because Open Wallet got merged. That shouldn't impact my earlier tACK, ~so we might be able to add this to 0.18 today~ (update: too late).",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-464078513,464078513,
jonasschnelli,2019-05-18T11:08:24Z,Needs rebase,https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-493668660,493668660,
fanquake,2019-09-08T09:00:36Z,"@promag Given that this is tagged for `0.19.0`, can you rebase?",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-529183976,529183976,
promag,2019-09-08T10:25:54Z,"Sure, in a couple of hours.",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-529189549,529189549,
fanquake,2019-09-08T12:52:42Z,"@promag I prefer the previous version, with the action in the wallet menu. Will let others weigh in.",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-529199805,529199805,
promag,2019-09-08T13:18:31Z,"You mean the open menu with:\n - no wallets available\n - separator\n - other...",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-529201811,529201811,
fanquake,2019-09-08T13:25:41Z,The [one currently in the PR description](https://user-images.githubusercontent.com/3534524/51430274-bc8e2f00-1c10-11e9-82b9-c736d5d43ef6.png) and [in this comment](https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-455799571).,https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-529202689,529202689,
jnewbery,2019-09-08T14:34:39Z,I agree with @fanquake that keeping it in the 'Open Wallet' submenu makes more sense.,https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-529208142,529208142,
promag,2019-09-08T17:17:55Z,"Thanks, also updated OP.",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-529223270,529223270,
meshcollider,2019-09-09T23:36:46Z,Concept ACK,https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-529707272,529707272,
jonatack,2019-09-13T19:46:06Z,"Concept ACK, will review this weekend.",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-531367778,531367778,
instagibbs,2019-09-13T20:09:58Z,"got this message on stderr on qt startup with this PR:\n`Gtk-Message: 16:07:25.804: GtkDialog mapped without a transient parent. This is discouraged.`\n\nI tried opening up a random wallet filed I had, but it was greyed out in the file selection? Am I missing something?",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-531374747,531374747,
promag,2019-09-13T20:20:07Z,@instaggibbs see https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-463132136,https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-531377651,531377651,
instagibbs,2019-09-13T20:28:47Z,ok that's going to have to be communicated in some obvious way...,https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-531380346,531380346,
instagibbs,2019-09-13T20:29:17Z,"what does `directory based wallets` even mean i.e., how is this detected? ",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-531380514,531380514,
ryanofsky,2019-09-13T22:35:34Z,"> what does `directory based wallets` even mean i.e., how is this detected?\n\nThe underlying wallet code can only open:\n\n1) Wallet files named wallet.dat\n2) Wallet files with names other than `wallet.dat` that are located directly in the top level wallet_dir\n\nIt hasn't been possible since #11687 to even create wallet files named anything other than `wallet.dat` so the second option ju",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-531411741,531411741,
ryanofsky,2019-09-13T22:57:18Z,"Haven't tested this but looking at the implementation it seems like this might be lacking the error checking from the `loadwallet` RPC that ensures that the wallet which the user is trying to open actually exists, and that CreateWalletFromFIle code will not go and create at new empty wallet at the specified location:\n\nhttps://github.com/bitcoin/bitcoin/blob/fb4f5beb6ede4aadeaff779cd67a0f666541",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-531415764,531415764,
promag,2019-09-15T09:43:30Z,"> Could be a pretty scary user experience to try to load an existing wallet but choose the wrong path, and see a new completely empty wallet instead of a ""location does not contain wallet.dat"" error.\n\n@ryanofsky indeed, currently it's like ""load or create"" :trollface: will change accordingly.\n\n> ok that's going to have to be communicated in some obvious way...\n\n@instagibbs you mean in ",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-531550840,531550840,
instagibbs,2019-09-15T19:20:10Z,"oh.... you have to click ""open"" while in the right directory or after clicking once on that directory holding the wallet file?\n\nthat's not even close to intuitive :grimacing: ",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-531591960,531591960,
instagibbs,2019-09-15T19:21:30Z,"So this either needs an extensive explanation before the user ventures to use it, or it should allow the user to click and open a wallet.dat in a directory, in addition to the directory itself. Latter seems to make most sense?",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-531592039,531592039,
promag,2019-09-15T22:07:44Z,"@instagibbs mind testing again? Now you can select the wallet.dat or the parent directory.\n\n@ryanofsky now it doesn't create the wallet, thanks!\n\n\n\n\n",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-531603505,531603505,
Sjors,2019-09-16T08:48:09Z,"On macOS, when I select a directory ~/temp/A it complains:\n\n<img width=""427"" alt=""Schermafbeelding 2019-09-16 om 10 45 08"" src=""https://user-images.githubusercontent.com/10217/64944730-4a3d1f80-d86f-11e9-9d7e-0a1c007d5273.png"">\n\nWhen I double click on the directory A (so it shows the wallet.dat file, etc) it still gives the above error.\n\nIt only works when I select the wallet.dat file.",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-531690858,531690858,
MarcoFalke,2019-09-16T13:53:24Z,This has missed the deadline in #15940,https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-531786574,531786574,
jnewbery,2019-09-16T15:54:58Z,"I don't think the wallet name should display the path to that wallet:\n\n![Screenshot from 2019-09-16 11-54-07](https://user-images.githubusercontent.com/1063656/64973301-c851f400-d878-11e9-9d73-c97b76d94fa8.png)\n![Screenshot from 2019-09-16 11-54-27](https://user-images.githubusercontent.com/1063656/64973302-c851f400-d878-11e9-941f-c20d2464583f.png)\n",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-531840241,531840241,
ryanofsky,2019-09-16T16:42:20Z,"> So this either needs an extensive explanation before the user ventures to use it, or it should allow the user to click and open a wallet.dat in a directory, in addition to the directory itself. Latter seems to make most sense?\n\nAllowing opening of wallet.dat files seems good. Would just need to strip the last `wallet.dat` component to make the path a wallet location. Another option would be ",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-531859019,531859019,
promag,2019-09-16T21:26:28Z,"> Would just need to strip the last wallet.dat component to make the path a wallet location \n\nThat's done here: https://github.com/bitcoin/bitcoin/pull/15204/commits/9e1fdd7f94161ecfbe7a4247fb2a672d5190ff83#diff-dc8c2957962a3032071c55c70e120932R331 but apparently shouldn't be done for directories.\n\n> I don't think the wallet name should display the path to that wallet:\n\n@jnewbery this ",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-531964905,531964905,
promag,2019-09-16T21:38:09Z,"BTW I'm avoiding `QFileDialog` static methods, such as [QFileDialog::getOpenFileName](https://doc.qt.io/qt-5/qfiledialog.html#getOpenFileName), which have the following drawback (from the doc):\n> Warning: Do not delete parent during the execution of the dialog. If you want to do this, you should create the dialog yourself using one of the QFileDialog constructors.\n\n#15310 is related to this ",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-531968511,531968511,
Sjors,2019-09-17T13:01:09Z,"In 91d6e0b I'm able to to open a wallet by just selecting the directory. Opening the directory and opening the wallet.dat file work as well.\n\nAgree with @jnewbery about using the wallet name instead of the full path. Since the RPC has the same problem, we can deal with that in a followup. ",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-532210017,532210017,
instagibbs,2019-09-17T13:13:38Z,ACK on punting the full path issue until a followup,https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-532214731,532214731,
instagibbs,2019-09-17T14:16:14Z,"Now when I use it, I can only open the wallet by selecting a file within a directory with a `wallet.dat` present. It lets me ""open"" any file in that directory, but it opens up the specific `wallet.dat` that is in the same directory, I think.",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-532241025,532241025,
promag,2019-09-17T14:20:35Z,I'm tempted to allow selecting either wallet.dat or a directory.,https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-532242958,532242958,
ryanofsky,2019-09-17T14:35:59Z,"> I'm tempted to allow selecting either wallet.dat or a directory.\n\nIf I were implementing this, I'd use a folder selector (https://stackoverflow.com/questions/13299283/folder-browser-dialog-in-qt ), not a file selector, and only allow choosing directories containing wallet.dat files (disable the choose / select button for other directories).\n\nBut if there's a reason to list files as well ",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-532249721,532249721,
instagibbs,2019-09-17T14:41:49Z,"> I'd use a folder selector\n\nconcept ACK on this suggestion. I don't think I would have been overly confused with this originally.",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-532252291,532252291,
promag,2019-09-17T15:45:40Z,"Done, now can only select folders.",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-532280300,532280300,
instagibbs,2019-09-17T15:54:46Z,"ok, this is much more natural. quick tACK https://github.com/bitcoin/bitcoin/pull/15204/commits/4e8cb3fd5efe2d108d8cf4017d197fb3e7c8eb40",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-532284120,532284120,
Sjors,2019-09-17T17:08:53Z,Agree the behavior in 4e8cb3f is nicer. I haven't reviewed the code.,https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-532312741,532312741,
jonatack,2019-09-18T16:10:09Z,"> I don't like the word ""External"" because it could get confusing if we add (e.g.) hardware wallet support.\n\nI'm hesitant as well with the ambiguity of the word ""external"" -- should we be more precise?",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-532755566,532755566,
instagibbs,2019-09-18T16:15:31Z,"How about ""wallet in external directory"" and variations thereof",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-532757638,532757638,
ryanofsky,2019-09-18T16:23:11Z,"> How about ""wallet in external directory"" and variations thereof\n\nI like the ""Open a wallet in an external directory"" Jon suggested",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-532760570,532760570,
michaelfolkson,2019-09-18T16:37:36Z,"The multiple wallets should be in separate directories by default? In which case why not just ""Other wallet"" or ""Additional wallet""? I don't think attention should be brought to it being in an external directory if that is the default. ",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-532766023,532766023,
ryanofsky,2019-09-18T16:52:49Z,"> The multiple wallets should be in separate directories by default? In which case why not just ""Other wallet"" or ""Additional wallet""? I don't think attention should be brought to it being in an external directory if that is the default.\n\nExternal means outside the bitcoin wallet dir (`~/.bitcoin/wallets` on linux) where the list of wallets comes from. I like your ""Open other wallet..."" sugges",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-532771823,532771823,
jonatack,2019-09-18T16:57:58Z,"Maybe ""Open a wallet located in a different directory""",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-532773833,532773833,
jonatack,2019-09-18T21:43:50Z,"Will test more and re-review. Some edge case test ideas from today's PR review meeting:\n- no wallet in directory\n- multiple wallets in directory\n- a non-wallet file named wallet.dat\n- deleting the wallet file while trying to load it\n\n",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-532879015,532879015,
promag,2019-09-18T21:57:55Z,"> Will test more and re-review. Some edge case test ideas from today's PR review meeting:\n> \n> * no wallet in directory\n\nit already fails:\n\n<img width=""532"" alt=""Screenshot 2019-09-18 at 22 50 05"" src=""https://user-images.githubusercontent.com/3534524/65188604-b3d34e80-da66-11e9-8c64-3188da5a7a47.png"">\n\n\n> * multiple wallets in directory\n\nnot supported - it's already the case",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-532883296,532883296,
fanquake,2019-09-19T05:24:09Z,"re-Concept ACK. Here's the dialog on macOS:\n\n![open_dialog](https://user-images.githubusercontent.com/863730/65215446-1b79b000-dae0-11e9-820a-41997c3f95a4.png)\n\nA few thoughts:\n\nIt'd be good if the GUI realised when we opened a wallet that's actually inside our wallet directory via the `Other...` menu, otherwise you end up with the wallet loaded, but not greyed out:\n![open](https://u",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-532971028,532971028,
promag,2019-09-19T07:06:36Z,"> It'd be good if the GUI realised when we opened a wallet that's actually inside our wallet directory via the `Other...` menu, otherwise you end up with the wallet loaded, but not greyed out:\n\nYes, different PR I guess.",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-532997928,532997928,
jonatack,2019-09-19T10:36:18Z,"@promag Thanks for the update. While testing f60f80e599284b4f098b54766e2221ebcd11f587, I reproduced the [issue mentioned above](https://github.com/bitcoin/bitcoin/pull/15204/#discussion_r325757097) on  Debian 4.19.37-5+deb10u2 (2019-08-08) x86_64 GNU/Linux. Opening a wallet-less folder causes the GUI to display the error (all good) but then a second later the GUI attempts to open the wallet anyway",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-533071707,533071707,
jonatack,2019-09-19T10:51:51Z,"Copying a wallet dir elsewhere with a different name but same wallet files inside, and attempting to load it in the GUI (EDIT: this is a separate issue that has been reported and a PR has been proposed):\n```\n$ qt/bitcoin-qt -testnet\nterminate called after throwing an instance of 'std::runtime_error'\n  what():  BerkeleyBatch: Can't open database wallet.dat (duplicates fileid c4003e0100fe000",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-533076341,533076341,
promag,2019-09-19T13:07:52Z,"@jonatack regarding the ""duplicates fileid "" crash see https://github.com/bitcoin/bitcoin/issues/16776#issuecomment-528672904",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-533122343,533122343,
promag,2019-09-27T21:14:11Z,"@jonatack just to be sure, if you repeat the above tests with `loadwallet` in the console you would get the same problems?",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-536098612,536098612,
jonasschnelli,2019-10-09T10:03:37Z,"Tested a bit.\nWhat I think is hard to understand is that one needs to select a folder rather than a wallet.dat file.\n\nI think either we allow to select wallet.dat files or inform the user that only wallet-directories are allowed (""select a wallet folder"").",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-539932726,539932726,
promag,2019-10-09T10:24:14Z,"> select a wallet folder\n\nI like that.",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-539939846,539939846,
Sjors,2019-12-16T12:14:59Z,"If you make `OpenExternalWalletActivity` a subclass of `OpenWalletActivity` it would save duplicate code, which is especially nice in `Open[External]WalletActivity::open()` with its `QTimer::singleShot`.",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-566036321,566036321,
DrahtBot,2020-01-08T16:22:05Z,<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase,https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-572145470,572145470,
jonasschnelli,2020-05-29T07:23:50Z,Needs addressing comments or should otherwise be closed.,https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-635808195,635808195,
promag,2020-08-17T00:06:58Z,Will rebase and open in gui repo.,https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-674596734,674596734,
promag,2020-08-30T23:52:50Z,"> Tested a bit.\n> What I think is hard to understand is that one needs to select a folder rather than a wallet.dat file.\n> \n> I think either we allow to select wallet.dat files or inform the user that only wallet-directories are allowed (""select a wallet folder"").\n\nI've tried to support selecting files and folders but this kind of sucks because in order be intuitive it needs non native f",https://github.com/bitcoin/bitcoin/pull/15204#issuecomment-683487892,683487892,
jonatack,2019-09-18T15:41:37Z,"Suggestions: s/on/in an/... or ""Open an externally-located wallet""... or ""Open a wallet in an external directory"", etc.",https://github.com/bitcoin/bitcoin/pull/15204#discussion_r325751642,325751642,src/qt/bitcoingui.cpp
jonatack,2019-09-18T15:46:33Z,"Combine the first two conditionals to one since they return the same result? Or, should the first result return a different message along the lines of ""No wallet file found""?",https://github.com/bitcoin/bitcoin/pull/15204#discussion_r325754309,325754309,src/qt/walletcontroller.cpp
jonatack,2019-09-18T15:47:31Z,"s/External/external/ as per the other changes with lowercased ""external""",https://github.com/bitcoin/bitcoin/pull/15204#discussion_r325754816,325754816,src/qt/walletcontroller.cpp
jonatack,2019-09-18T15:49:07Z,`toHtmlEscaped()`: I manually verified that the wallet name is properly escaped :heavy_check_mark: ,https://github.com/bitcoin/bitcoin/pull/15204#discussion_r325755667,325755667,src/qt/walletcontroller.cpp
jonatack,2019-09-18T15:51:59Z,"While manually testing selecting a directory with no wallet file, after clicking OK at this dialog, I seemed to encounter a strange behavior where the GUI appeared to be trying to load a wallet. Will test further to re-reproduce/confirm.",https://github.com/bitcoin/bitcoin/pull/15204#discussion_r325757097,325757097,src/wallet/wallet.cpp
promag,2019-09-18T21:16:39Z,"Picked ""Open a wallet in an external directory"".",https://github.com/bitcoin/bitcoin/pull/15204#discussion_r325896230,325896230,src/qt/bitcoingui.cpp
promag,2019-09-18T21:17:44Z,"Changed to ""Open Wallet"", I think it's enough.",https://github.com/bitcoin/bitcoin/pull/15204#discussion_r325896719,325896719,src/qt/walletcontroller.cpp
promag,2019-09-18T21:28:01Z,"Can't reproduce, please let me know if you hit it again.",https://github.com/bitcoin/bitcoin/pull/15204#discussion_r325900591,325900591,src/wallet/wallet.cpp
