[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/245822058",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8680#issuecomment-245822058",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8680",
    "id": 245822058,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0NTgyMjA1OA==",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-09-09T05:21:32Z",
    "updated_at": "2016-09-09T05:21:32Z",
    "author_association": "MEMBER",
    "body": "These RPCs happen to also wait for wallet processing at this point, but that will change if wallet processing becomes asynchronous.\n\nACK on this as a stopgap measure to prevent the synchronization issues.\n\nBut I think there should be a warning in their help to not rely on this behavior \"as the tests do\".\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/245822058/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/245830060",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8680#issuecomment-245830060",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8680",
    "id": 245830060,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0NTgzMDA2MA==",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?u=eab5d0cdbb6cc25087cb61d4ca4a6f85255f42a7&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-09-09T06:26:13Z",
    "updated_at": "2016-09-09T06:26:13Z",
    "author_association": "CONTRIBUTOR",
    "body": "Concept ACK.\nI like this approach. Also, it's a preform of longpoll RPC notifications proposed in https://github.com/bitcoin/bitcoin/pull/7949 which I think are generally useful.\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/245830060/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/245831377",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8680#issuecomment-245831377",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8680",
    "id": 245831377,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0NTgzMTM3Nw==",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-09-09T06:33:49Z",
    "updated_at": "2016-09-09T06:33:49Z",
    "author_association": "MEMBER",
    "body": "Gah I'm just going to go ahead and merge this, I need the tests to pass, it's low-risk (largest risk is to break the tests even more, well...) and fixups can be done later.\nutACK d6a5dc4\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/245831377/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/245964182",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8680#issuecomment-245964182",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8680",
    "id": 245964182,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0NTk2NDE4Mg==",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-09-09T16:24:39Z",
    "updated_at": "2016-09-09T16:24:39Z",
    "author_association": "MEMBER",
    "body": "Just to be sure: The new rpc calls are not meant for general consumption but serve as a temporary fix for the tests?\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/245964182/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/247719602",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8680#issuecomment-247719602",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8680",
    "id": 247719602,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0NzcxOTYwMg==",
    "user": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-09-16T22:03:53Z",
    "updated_at": "2016-09-16T22:03:53Z",
    "author_association": "MEMBER",
    "body": "Does this need a backport?\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/247719602/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/247756536",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8680#issuecomment-247756536",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8680",
    "id": 247756536,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0Nzc1NjUzNg==",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-09-17T08:07:53Z",
    "updated_at": "2016-09-17T08:07:53Z",
    "author_association": "MEMBER",
    "body": "@luke-jr No, the commit that reworked the locks is only in master\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/247756536/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/248374706",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8680#issuecomment-248374706",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8680",
    "id": 248374706,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0ODM3NDcwNg==",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-09-20T17:37:51Z",
    "updated_at": "2016-09-20T17:37:51Z",
    "author_association": "MEMBER",
    "body": "This will also break the tests, when an old binary is used for comp. checks.\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/248374706/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/248374912",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8680#issuecomment-248374912",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8680",
    "id": 248374912,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0ODM3NDkxMg==",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-09-20T17:38:32Z",
    "updated_at": "2016-09-20T17:38:32Z",
    "author_association": "MEMBER",
    "body": "There were suggestions by @morcos and @TheBlueMatt to address the failures in a less breaking way during one of the last meetings, but I couldn't find any follow ups.\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/248374912/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/78133809",
    "pull_request_review_id": null,
    "id": 78133809,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDc4MTMzODA5",
    "diff_hunk": "@@ -168,6 +180,138 @@ UniValue getbestblockhash(const UniValue& params, bool fHelp)\n     return chainActive.Tip()->GetBlockHash().GetHex();\n }\n \n+void RPCNotifyBlockChange(bool ibd, const CBlockIndex * pindex)\n+{\n+    if(pindex) {\n+        std::lock_guard<std::mutex> lock(cs_blockchange);\n+        latestblock.hash = pindex->GetBlockHash();\n+        latestblock.height = pindex->nHeight;\n+    }\n+\tcond_blockchange.notify_all();\n+}\n+\n+UniValue waitfornewblock(const UniValue& params, bool fHelp)\n+{\n+    if (fHelp || params.size() > 1)\n+        throw runtime_error(\n+            \"waitfornewblock\\n\"\n+            \"\\nWaits for a specific new block and returns useful info about it.\\n\"\n+            \"\\nReturns the current block on timeout or exit.\\n\"\n+            \"\\nArguments:\\n\"\n+            \"1. timeout (milliseconds) (int, optional, default=false)\\n\"\n+            \"\\nResult::\\n\"\n+            \"{                           (json object)\\n\"\n+            \"  \\\"hash\\\" : {       (string) The blockhash\\n\"\n+            \"  \\\"height\\\" : {     (int) Block height\\n\"\n+            \"}\\n\"\n+            \"\\nExamples\\n\"\n+            + HelpExampleCli(\"waitfornewblock\", \"1000\")\n+            + HelpExampleRpc(\"waitfornewblock\", \"1000\")\n+        );\n+    int timeout = 0;\n+    if (params.size() > 0)\n+        timeout = params[0].get_int();\n+\n+    CUpdatedBlock block;\n+    {\n+        std::unique_lock<std::mutex> lock(cs_blockchange);\n+        block = latestblock;\n+        if(timeout)\n+            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&block]{return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n+        else\n+            cond_blockchange.wait(lock, [&block]{return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n+        block = latestblock;\n+    }\n+    UniValue ret(UniValue::VOBJ);\n+    ret.push_back(Pair(\"hash\", block.hash.GetHex()));\n+    ret.push_back(Pair(\"height\", block.height));\n+    return ret;\n+}\n+\n+UniValue waitforblock(const UniValue& params, bool fHelp)\n+{\n+    if (fHelp || params.size() < 1 || params.size() > 2)\n+        throw runtime_error(\n+            \"waitforblock\\n\"",
    "path": "src/rpc/blockchain.cpp",
    "position": 77,
    "original_position": 77,
    "commit_id": "d6a5dc4a2eaa0d7348804254ca09e75fc3a858ab",
    "original_commit_id": "d6a5dc4a2eaa0d7348804254ca09e75fc3a858ab",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: `s/waitforblock/waitforblock <blockhash> <timeout>`\nI guess most commands help have it like this.\n",
    "created_at": "2016-09-09T06:24:07Z",
    "updated_at": "2016-09-09T06:24:07Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8680#discussion_r78133809",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8680",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/78133809"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/8680#discussion_r78133809"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8680"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/78133809/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 235,
    "original_line": 235,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/78208206",
    "pull_request_review_id": null,
    "id": 78208206,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDc4MjA4MjA2",
    "diff_hunk": "@@ -125,12 +125,16 @@ def sync_blocks(rpc_connections, wait=1, timeout=60):\n     \"\"\"\n     Wait until everybody has the same tip\n     \"\"\"\n+    maxheight = 0\n     while timeout > 0:\n-        tips = [ x.getbestblockhash() for x in rpc_connections ]\n+        tips = [ x.waitforblockheight(maxheight, int(wait * 1000)) for x in rpc_connections ]\n+        heights = [ x[\"height\"] for x in tips ]\n         if tips == [ tips[0] ]*len(tips):\n             return True\n-        time.sleep(wait)\n+        if heights == [ heights[0] ]*len(heights): #heights are the same but hashes are not\n+            raise AssertionError(\"Block sync failed\")",
    "path": "qa/rpc-tests/test_framework/util.py",
    "position": 13,
    "original_position": 13,
    "commit_id": "d6a5dc4a2eaa0d7348804254ca09e75fc3a858ab",
    "original_commit_id": "d6a5dc4a2eaa0d7348804254ca09e75fc3a858ab",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Nit: `mempool_packages.py` relies on this not being thrown.\n",
    "created_at": "2016-09-09T16:21:35Z",
    "updated_at": "2016-09-09T16:21:35Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8680#discussion_r78208206",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8680",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/78208206"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/8680#discussion_r78208206"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8680"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/78208206/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 135,
    "original_line": 135,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/78209060",
    "pull_request_review_id": null,
    "id": 78209060,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDc4MjA5MDYw",
    "diff_hunk": "@@ -125,12 +125,16 @@ def sync_blocks(rpc_connections, wait=1, timeout=60):\n     \"\"\"\n     Wait until everybody has the same tip\n     \"\"\"\n+    maxheight = 0\n     while timeout > 0:\n-        tips = [ x.getbestblockhash() for x in rpc_connections ]\n+        tips = [ x.waitforblockheight(maxheight, int(wait * 1000)) for x in rpc_connections ]\n+        heights = [ x[\"height\"] for x in tips ]\n         if tips == [ tips[0] ]*len(tips):\n             return True\n-        time.sleep(wait)\n+        if heights == [ heights[0] ]*len(heights): #heights are the same but hashes are not\n+            raise AssertionError(\"Block sync failed\")",
    "path": "qa/rpc-tests/test_framework/util.py",
    "position": 13,
    "original_position": 13,
    "commit_id": "d6a5dc4a2eaa0d7348804254ca09e75fc3a858ab",
    "original_commit_id": "d6a5dc4a2eaa0d7348804254ca09e75fc3a858ab",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "There's a slightly bigger issue that @morcos just noticed, which is that the block notification signals doesn't quite work with invalidateblock right now.\n\nI think we can work around it by having the invalidateblock rpc handler explicitly call the ui signals in this case (which is probably the right thing to do in general).\n",
    "created_at": "2016-09-09T16:27:42Z",
    "updated_at": "2016-09-09T16:27:42Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8680#discussion_r78209060",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8680",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/78209060"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/8680#discussion_r78209060"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8680"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/78209060/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 135,
    "original_line": 135,
    "side": "RIGHT",
    "in_reply_to_id": 78208206
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/81468942",
    "pull_request_review_id": 2448042,
    "id": 81468942,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDgxNDY4OTQy",
    "diff_hunk": "@@ -168,6 +180,138 @@ UniValue getbestblockhash(const UniValue& params, bool fHelp)\n     return chainActive.Tip()->GetBlockHash().GetHex();\n }\n \n+void RPCNotifyBlockChange(bool ibd, const CBlockIndex * pindex)\n+{\n+    if(pindex) {\n+        std::lock_guard<std::mutex> lock(cs_blockchange);\n+        latestblock.hash = pindex->GetBlockHash();\n+        latestblock.height = pindex->nHeight;\n+    }\n+\tcond_blockchange.notify_all();\n+}\n+\n+UniValue waitfornewblock(const UniValue& params, bool fHelp)\n+{\n+    if (fHelp || params.size() > 1)\n+        throw runtime_error(\n+            \"waitfornewblock\\n\"\n+            \"\\nWaits for a specific new block and returns useful info about it.\\n\"\n+            \"\\nReturns the current block on timeout or exit.\\n\"\n+            \"\\nArguments:\\n\"\n+            \"1. timeout (milliseconds) (int, optional, default=false)\\n\"\n+            \"\\nResult::\\n\"\n+            \"{                           (json object)\\n\"\n+            \"  \\\"hash\\\" : {       (string) The blockhash\\n\"\n+            \"  \\\"height\\\" : {     (int) Block height\\n\"\n+            \"}\\n\"\n+            \"\\nExamples\\n\"\n+            + HelpExampleCli(\"waitfornewblock\", \"1000\")\n+            + HelpExampleRpc(\"waitfornewblock\", \"1000\")\n+        );\n+    int timeout = 0;\n+    if (params.size() > 0)\n+        timeout = params[0].get_int();\n+\n+    CUpdatedBlock block;\n+    {\n+        std::unique_lock<std::mutex> lock(cs_blockchange);\n+        block = latestblock;\n+        if(timeout)\n+            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&block]{return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n+        else\n+            cond_blockchange.wait(lock, [&block]{return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n+        block = latestblock;\n+    }\n+    UniValue ret(UniValue::VOBJ);\n+    ret.push_back(Pair(\"hash\", block.hash.GetHex()));\n+    ret.push_back(Pair(\"height\", block.height));\n+    return ret;\n+}\n+\n+UniValue waitforblock(const UniValue& params, bool fHelp)\n+{\n+    if (fHelp || params.size() < 1 || params.size() > 2)\n+        throw runtime_error(\n+            \"waitforblock\\n\"\n+            \"\\nWaits for a specific new block and returns useful info about it.\\n\"\n+            \"\\nReturns the current block on timeout or exit.\\n\"\n+            \"\\nArguments:\\n\"\n+            \"1. blockhash to wait for (string)\\n\"\n+            \"2. timeout (milliseconds) (int, optional, default=false)\\n\"\n+            \"\\nResult::\\n\"\n+            \"{                           (json object)\\n\"\n+            \"  \\\"hash\\\" : {       (string) The blockhash\\n\"\n+            \"  \\\"height\\\" : {     (int) Block height\\n\"\n+            \"}\\n\"\n+            \"\\nExamples\\n\"\n+            + HelpExampleCli(\"waitforblock\", \"\\\"0000000000079f8ef3d2c688c244eb7a4570b24c9ed7b4a8c619eb02596f8862\\\", 1000\")\n+            + HelpExampleRpc(\"waitforblock\", \"\\\"0000000000079f8ef3d2c688c244eb7a4570b24c9ed7b4a8c619eb02596f8862\\\", 1000\")\n+        );\n+    int timeout = 0;\n+\n+    uint256 hash = uint256S(params[0].get_str());\n+\n+    if (params.size() > 1)\n+        timeout = params[1].get_int();\n+\n+    CUpdatedBlock block;\n+    {\n+        std::unique_lock<std::mutex> lock(cs_blockchange);\n+        if(timeout)\n+            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&hash]{return latestblock.hash == hash || !IsRPCRunning();});\n+        else\n+            cond_blockchange.wait(lock, [&hash]{return latestblock.hash == hash || !IsRPCRunning(); });\n+        block = latestblock;\n+    }\n+\n+    UniValue ret(UniValue::VOBJ);\n+    ret.push_back(Pair(\"hash\", block.hash.GetHex()));\n+    ret.push_back(Pair(\"height\", block.height));\n+    return ret;\n+}\n+\n+UniValue waitforblockheight(const UniValue& params, bool fHelp)\n+{\n+    if (fHelp || params.size() < 1 || params.size() > 2)\n+        throw runtime_error(\n+            \"waitforblock\\n\"",
    "path": "src/rpc/blockchain.cpp",
    "position": 119,
    "original_position": 119,
    "commit_id": "d6a5dc4a2eaa0d7348804254ca09e75fc3a858ab",
    "original_commit_id": "d6a5dc4a2eaa0d7348804254ca09e75fc3a858ab",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "waitforblockheight\n\nAlso there is a spurious opening `{` some lines below.\n",
    "created_at": "2016-10-02T11:56:57Z",
    "updated_at": "2016-11-07T20:30:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8680#discussion_r81468942",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8680",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/81468942"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/8680#discussion_r81468942"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8680"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/81468942/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 277,
    "original_line": 277,
    "side": "RIGHT"
  }
]