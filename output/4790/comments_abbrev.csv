theuni,2014-08-30T02:07:10Z,This looks like a typical fail-safe for avoiding pegging the cpu in a tight loop. Are you sure there are no cases where the the thread ends up looping without a stall? There are plenty of cases where a select can return immediately without error.\n,https://github.com/bitcoin/bitcoin/pull/4790#issuecomment-53945969,53945969,
pstratem,2014-08-30T02:29:53Z,@theuni This handles all cases.\n\ntimeout - essentially MilliSleep(50)\nerror - MilliSleep(50)\nfd's ready - we dont want to sleep!\n,https://github.com/bitcoin/bitcoin/pull/4790#issuecomment-53946385,53946385,
sipa,2014-08-30T11:15:58Z,Untested ACK\n,https://github.com/bitcoin/bitcoin/pull/4790#issuecomment-53955633,53955633,
theuni,2014-08-30T20:44:58Z,"@pstratem No problem. I didn't mean to imply that it really is needed, only that it may have a non-obvious use.\n",https://github.com/bitcoin/bitcoin/pull/4790#issuecomment-53970013,53970013,
pstratem,2014-09-02T18:29:36Z,"@theuni I didn't take offense, sanity checking even the most trivial looking changes makes perfect sense.\n",https://github.com/bitcoin/bitcoin/pull/4790#issuecomment-54196230,54196230,
gmaxwell,2014-09-03T02:41:21Z,"For those following at home. There are currently two sleeps in the network handling code— one in the thread with the select. One in the threadmessagehandler. The latter is necessary (or at least must be replaced with a semaphor) to prevent a busy loop.   This one is not— it should be superfluous to the select,  except— perhaps— if there are no connections.\n\n(Posix select is defined to sleep when",https://github.com/bitcoin/bitcoin/pull/4790#issuecomment-54245480,54245480,
pstratem,2014-09-03T02:45:46Z,"should behave correctly with no connections, select() should sleep for the timeout period (select manpage specifically references calling select like this to get a high precision sleep function).\n",https://github.com/bitcoin/bitcoin/pull/4790#issuecomment-54245743,54245743,
pstratem,2014-09-03T02:46:48Z,"tested on debian 7.6, ./bitcoind -connect=10.1.1.1 does not result in a busy loop\n",https://github.com/bitcoin/bitcoin/pull/4790#issuecomment-54245806,54245806,
jgarzik,2014-09-03T02:49:15Z,"Yah, that's fine on *nix.  Windows is the key platform to test, for select() behavior.  it is already quite odd on windows, only working for some types of handles (sockets).  No-socket behavior is precisely the area windows would be annoying ;p\n",https://github.com/bitcoin/bitcoin/pull/4790#issuecomment-54245939,54245939,
pstratem,2014-09-03T02:55:40Z,@jgarzik yes windows immediately returns WSAEINVAL if the three sets are empty\n\nThis triggers the MilliSleep in the error handler\n\nThere is only an issue if select returns a value other than -1 without blocking.\n\nThat doesn't appear to happen on any platform.\n,https://github.com/bitcoin/bitcoin/pull/4790#issuecomment-54246295,54246295,
gmaxwell,2014-09-03T02:57:16Z,"Okay, seems (according to the interwebs) that— indeed— windows returns an error instead of sleeping in the no socket case. But we already have a sleep in the error handling path.\n\nI've tested this on Linux with and without connections. ACK on the change— But I'd like to hear that this was tested with and without any connections (e.g. -connect=0.0.0.0, and check if Bitcoin is pegging the cpu) on ",https://github.com/bitcoin/bitcoin/pull/4790#issuecomment-54246381,54246381,
BitcoinPullTester,2014-09-03T04:44:32Z,"Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/p4790_9189f5fe4df1ac7ea6ca75ceada867beafda90a9/ for binaries and test log.\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.log is moving at http://jenkins.bluematt.me/pull-te",https://github.com/bitcoin/bitcoin/pull/4790#issuecomment-54251564,54251564,
laanwj,2014-09-03T10:34:58Z,Never knew that -connect=0.0.0.0 could be used to not connect to any nodes. Having a way to not connect was one of my reasons for being in favor of #4687.\n,https://github.com/bitcoin/bitcoin/pull/4790#issuecomment-54278580,54278580,
gavinandresen,2014-09-03T13:15:21Z,"ACK, tested on OSX with -connect=0.0.0.0\n",https://github.com/bitcoin/bitcoin/pull/4790#issuecomment-54294404,54294404,
gmaxwell,2014-09-03T20:46:34Z,@pstratem Can you get this crazy merge commit out of here? (just rewrite against master and force push)  this could be fixed on merge too but it might safe someone a few minutes to fix it yourself.\n,https://github.com/bitcoin/bitcoin/pull/4790#issuecomment-54363847,54363847,
pstratem,2014-09-03T20:48:01Z,@gmaxwell i did... last night..?\n,https://github.com/bitcoin/bitcoin/pull/4790#issuecomment-54364131,54364131,
gmaxwell,2014-09-04T00:35:26Z,"@pstratem Weird, github must have been displaying stale data for me.\n",https://github.com/bitcoin/bitcoin/pull/4790#issuecomment-54389143,54389143,
pstratem,2014-09-04T00:36:25Z,@gmaxwell I've found their caching to be consistently overly aggressive.\n,https://github.com/bitcoin/bitcoin/pull/4790#issuecomment-54389223,54389223,
