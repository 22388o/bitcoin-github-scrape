[
  {
    "sha": "cbede7dbfde83d53ef38d257e9940af5f163b03c",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpjYmVkZTdkYmZkZTgzZDUzZWYzOGQyNTdlOTk0MGFmNWYxNjNiMDNj",
    "commit": {
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2018-05-15T10:46:19Z"
      },
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2018-05-15T10:46:19Z"
      },
      "message": "[qt] OptionsDialog: add prune setting",
      "tree": {
        "sha": "58a7bc2640256aed11a19995d7c116548abbf159",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/58a7bc2640256aed11a19995d7c116548abbf159"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/cbede7dbfde83d53ef38d257e9940af5f163b03c",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAlr6uoIACgkQV/+b28ww\nEAnr0Q/8DSbOiCJd7T3mT6r+Gmc8iJnI+VLsaQkUzaPDXHnbHipeXE9IsLf6Y2h+\nywgzEwkDJBcLzvzbmG2AaZ5+sOzvdmzE1ndyw0mh1UUZ0YRJD5niOFbCMNcp/RSb\nrWRFlXMeeSWfH4aZpSrmsE4lYtcQJpXOdjqVQchD9Gp2A3pMN0CwrjYvjqrFIEQv\nBaVbJ7KwjgE03nkUJMvN2oCezMPBSk0OzrKeoei8sotZI3TR2cBczYTDPv+LopXC\nSxTnO9+I3vNeQeHCk/Mmtd0Dhh1JdjITYlJ9xFZz+8r0/Q6iZ7BbZqkC4p0cks/6\naOsVwV1kt6GBEOowt+bzGq+rpwY1zY9FRn1tYUwnvEaSgfkHLzWzMjNK5CAs49FN\nh63CerGfsijfnUpwU+zut0eeWYj7c0AZ+t3ySoXDHLA/gWvaMIDzqWnk+VbEBcFW\npS63cc+3HelDiXzIMK1b0++sekPoCZvicIKElROeMa4s3coQB7O7QfxnuPWd/O1t\nz2HX0feqjbAA/2AjX/qQGhRDuSeO5GmJTwX5hQQAsfLJ8nwfBKJqq+K8v1/h8wkM\n3HW92mQXgHU3VAcX4Y7rXzk/HnmbbChsh+m2vkiZffucA8kicZwZprOXOPR0SNx3\nJacT0e7eMVt//VPBwOHcJZP3Jl+ASqlAbtNco0gbwZqyedkRxLQ=\n=S8pk\n-----END PGP SIGNATURE-----",
        "payload": "tree 58a7bc2640256aed11a19995d7c116548abbf159\nparent 3b84ebb5bc0d55d488ce2626ac3232729535eca8\nauthor Sjors Provoost <sjors@sprovoost.nl> 1526381179 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1526381179 +0200\n\n[qt] OptionsDialog: add prune setting\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/cbede7dbfde83d53ef38d257e9940af5f163b03c",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/cbede7dbfde83d53ef38d257e9940af5f163b03c",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/cbede7dbfde83d53ef38d257e9940af5f163b03c/comments",
    "author": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "3b84ebb5bc0d55d488ce2626ac3232729535eca8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3b84ebb5bc0d55d488ce2626ac3232729535eca8",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/3b84ebb5bc0d55d488ce2626ac3232729535eca8"
      }
    ],
    "stats": {
      "total": 120,
      "additions": 118,
      "deletions": 2
    },
    "files": [
      {
        "sha": "e1bb84cca9e25ed41d512ece67ba2302dac825d8",
        "filename": "doc/release-notes.md",
        "status": "modified",
        "additions": 5,
        "deletions": 0,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/cbede7dbfde83d53ef38d257e9940af5f163b03c/doc/release-notes.md",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/cbede7dbfde83d53ef38d257e9940af5f163b03c/doc/release-notes.md",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/doc/release-notes.md?ref=cbede7dbfde83d53ef38d257e9940af5f163b03c",
        "patch": "@@ -56,6 +56,11 @@ frequently tested on them.\n Notable changes\n ===============\n \n+GUI changes\n+-----------\n+\n+- Block storage can be limited under Preferences, in the Main tab. Undoing this setting requires downloading the full blockchain again. This mode is incompatible with -txindex and -rescan.\n+\n RPC changes\n ------------\n "
      },
      {
        "sha": "8f34e6bc827ed0ae2c2ae5acf60792d63e3aaddf",
        "filename": "src/qt/forms/optionsdialog.ui",
        "status": "modified",
        "additions": 65,
        "deletions": 2,
        "changes": 67,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/cbede7dbfde83d53ef38d257e9940af5f163b03c/src/qt/forms/optionsdialog.ui",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/cbede7dbfde83d53ef38d257e9940af5f163b03c/src/qt/forms/optionsdialog.ui",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/forms/optionsdialog.ui?ref=cbede7dbfde83d53ef38d257e9940af5f163b03c",
        "patch": "@@ -37,6 +37,69 @@\n          </property>\n         </widget>\n        </item>\n+       <item>\n+        <spacer name=\"horizontalSpacer_0_Main\">\n+         <property name=\"orientation\">\n+          <enum>Qt::Horizontal</enum>\n+         </property>\n+         <property name=\"sizeHint\" stdset=\"0\">\n+          <size>\n+           <width>40</width>\n+           <height>5</height>\n+          </size>\n+         </property>\n+        </spacer>\n+       </item>\n+       <item>\n+       <layout class=\"QHBoxLayout\" name=\"horizontalLayout_Main_Prune\">\n+        <item>\n+         <widget class=\"QCheckBox\" name=\"prune\">\n+          <property name=\"toolTip\">\n+           <string>Disables some advanced features but all blocks will still be fully validated. Reverting this setting requires re-downloading the entire blockchain. Actual disk usage may be somewhat higher.</string>\n+          </property>\n+          <property name=\"text\">\n+           <string>Prune &amp;block storage to</string>\n+          </property>\n+         </widget>\n+        </item>\n+        <item>\n+         <widget class=\"QSpinBox\" name=\"pruneSize\"/>\n+        </item>\n+         <item>\n+          <widget class=\"QLabel\" name=\"pruneSizeUnitLabel\">\n+           <property name=\"text\">\n+            <string>GB</string>\n+           </property>\n+           <property name=\"textFormat\">\n+            <enum>Qt::PlainText</enum>\n+           </property>\n+          </widget>\n+         </item>\n+         <item>\n+          <spacer name=\"horizontalSpacer_Main_Prune\">\n+           <property name=\"orientation\">\n+            <enum>Qt::Horizontal</enum>\n+           </property>\n+           <property name=\"sizeHint\" stdset=\"0\">\n+            <size>\n+             <width>40</width>\n+             <height>20</height>\n+            </size>\n+           </property>\n+          </spacer>\n+         </item>\n+        </layout>\n+       </item>\n+       <item>\n+        <widget class=\"QLabel\" name=\"pruneWarning\">\n+         <property name=\"text\">\n+          <string>Reverting this setting requires re-downloading the entire blockchain.</string>\n+         </property>\n+         <property name=\"textFormat\">\n+          <enum>Qt::PlainText</enum>\n+         </property>\n+        </widget>\n+       </item>\n        <item>\n         <layout class=\"QHBoxLayout\" name=\"horizontalLayout_2_Main\">\n          <item>\n@@ -81,7 +144,7 @@\n         </layout>\n        </item>\n        <item>\n-        <layout class=\"QHBoxLayout\" name=\"horizontalLayout_3_Main\">\n+        <layout class=\"QHBoxLayout\" name=\"horizontalLayout_Main_VerifyLabel\">\n          <item>\n           <widget class=\"QLabel\" name=\"threadsScriptVerifLabel\">\n            <property name=\"text\">\n@@ -103,7 +166,7 @@\n           </widget>\n          </item>\n          <item>\n-          <spacer name=\"horizontalSpacer_3_Main\">\n+          <spacer name=\"horizontalSpacer_Main_Threads\">\n            <property name=\"orientation\">\n             <enum>Qt::Horizontal</enum>\n            </property>"
      },
      {
        "sha": "108aa4f99c1e961e7795d35f23e9ab570b9769cf",
        "filename": "src/qt/optionsdialog.cpp",
        "status": "modified",
        "additions": 19,
        "deletions": 0,
        "changes": 19,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/cbede7dbfde83d53ef38d257e9940af5f163b03c/src/qt/optionsdialog.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/cbede7dbfde83d53ef38d257e9940af5f163b03c/src/qt/optionsdialog.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/optionsdialog.cpp?ref=cbede7dbfde83d53ef38d257e9940af5f163b03c",
        "patch": "@@ -36,8 +36,17 @@ OptionsDialog::OptionsDialog(QWidget *parent, bool enableWallet) :\n     /* Main elements init */\n     ui->databaseCache->setMinimum(nMinDbCache);\n     ui->databaseCache->setMaximum(nMaxDbCache);\n+    static const uint64_t GiB = 1024 * 1024 * 1024;\n+    static const uint64_t nMinDiskSpace = MIN_DISK_SPACE_FOR_BLOCK_FILES / GiB +\n+                          (MIN_DISK_SPACE_FOR_BLOCK_FILES % GiB) ? 1 : 0;\n+    ui->pruneSize->setMinimum(nMinDiskSpace);\n     ui->threadsScriptVerif->setMinimum(-GetNumCores());\n     ui->threadsScriptVerif->setMaximum(MAX_SCRIPTCHECK_THREADS);\n+    ui->pruneWarning->setVisible(false);\n+    ui->pruneWarning->setStyleSheet(\"QLabel { color: red; }\");\n+\n+    ui->pruneSize->setEnabled(false);\n+    connect(ui->prune, SIGNAL(toggled(bool)), ui->pruneSize, SLOT(setEnabled(bool)));\n \n     /* Network elements init */\n #ifndef USE_UPNP\n@@ -157,6 +166,9 @@ void OptionsDialog::setModel(OptionsModel *_model)\n     /* warn when one of the following settings changes by user action (placed here so init via mapper doesn't trigger them) */\n \n     /* Main */\n+    connect(ui->prune, SIGNAL(clicked(bool)), this, SLOT(showRestartWarning()));\n+    connect(ui->prune, SIGNAL(clicked(bool)), this, SLOT(togglePruneWarning(bool)));\n+    connect(ui->pruneSize, SIGNAL(valueChanged(int)), this, SLOT(showRestartWarning()));\n     connect(ui->databaseCache, SIGNAL(valueChanged(int)), this, SLOT(showRestartWarning()));\n     connect(ui->threadsScriptVerif, SIGNAL(valueChanged(int)), this, SLOT(showRestartWarning()));\n     /* Wallet */\n@@ -176,6 +188,8 @@ void OptionsDialog::setMapper()\n     mapper->addMapping(ui->bitcoinAtStartup, OptionsModel::StartAtStartup);\n     mapper->addMapping(ui->threadsScriptVerif, OptionsModel::ThreadsScriptVerif);\n     mapper->addMapping(ui->databaseCache, OptionsModel::DatabaseCache);\n+    mapper->addMapping(ui->prune, OptionsModel::Prune);\n+    mapper->addMapping(ui->pruneSize, OptionsModel::PruneSize);\n \n     /* Wallet */\n     mapper->addMapping(ui->spendZeroConfChange, OptionsModel::SpendZeroConfChange);\n@@ -266,6 +280,11 @@ void OptionsDialog::on_hideTrayIcon_stateChanged(int fState)\n     }\n }\n \n+void OptionsDialog::togglePruneWarning(bool enabled)\n+{\n+    ui->pruneWarning->setVisible(!ui->pruneWarning->isVisible());\n+}\n+\n void OptionsDialog::showRestartWarning(bool fPersistent)\n {\n     ui->statusLabel->setStyleSheet(\"QLabel { color: red; }\");"
      },
      {
        "sha": "5aad484ce7751196bbf16b006eb5488d839d0b2e",
        "filename": "src/qt/optionsdialog.h",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/cbede7dbfde83d53ef38d257e9940af5f163b03c/src/qt/optionsdialog.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/cbede7dbfde83d53ef38d257e9940af5f163b03c/src/qt/optionsdialog.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/optionsdialog.h?ref=cbede7dbfde83d53ef38d257e9940af5f163b03c",
        "patch": "@@ -53,6 +53,7 @@ private Q_SLOTS:\n     \n     void on_hideTrayIcon_stateChanged(int fState);\n \n+    void togglePruneWarning(bool enabled);\n     void showRestartWarning(bool fPersistent = false);\n     void clearStatusLabel();\n     void updateProxyValidationState();"
      },
      {
        "sha": "31a85f4e235fb07f7a39d82362fdee9502544dd8",
        "filename": "src/qt/optionsmodel.cpp",
        "status": "modified",
        "additions": 26,
        "deletions": 0,
        "changes": 26,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/cbede7dbfde83d53ef38d257e9940af5f163b03c/src/qt/optionsmodel.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/cbede7dbfde83d53ef38d257e9940af5f163b03c/src/qt/optionsmodel.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/optionsmodel.cpp?ref=cbede7dbfde83d53ef38d257e9940af5f163b03c",
        "patch": "@@ -88,6 +88,16 @@ void OptionsModel::Init(bool resetSettings)\n     // by command-line and show this in the UI.\n \n     // Main\n+    if (!settings.contains(\"bPrune\"))\n+        settings.setValue(\"bPrune\", false);\n+    if (!settings.contains(\"nPruneSize\"))\n+        settings.setValue(\"nPruneSize\", 2);\n+    // Convert prune size to MB:\n+    const uint64_t nPruneSizeMB = settings.value(\"nPruneSize\").toInt() * 1000;\n+    if (!m_node.softSetArg(\"-prune\", settings.value(\"bPrune\").toBool() ? std::to_string(nPruneSizeMB) : \"0\")) {\n+      addOverriddenOption(\"-prune\");\n+    }\n+\n     if (!settings.contains(\"nDatabaseCache\"))\n         settings.setValue(\"nDatabaseCache\", (qint64)nDefaultDbCache);\n     if (!m_node.softSetArg(\"-dbcache\", settings.value(\"nDatabaseCache\").toString().toStdString()))\n@@ -281,6 +291,10 @@ QVariant OptionsModel::data(const QModelIndex & index, int role) const\n             return settings.value(\"language\");\n         case CoinControlFeatures:\n             return fCoinControlFeatures;\n+        case Prune:\n+            return settings.value(\"bPrune\");\n+        case PruneSize:\n+            return settings.value(\"nPruneSize\");\n         case DatabaseCache:\n             return settings.value(\"nDatabaseCache\");\n         case ThreadsScriptVerif:\n@@ -405,6 +419,18 @@ bool OptionsModel::setData(const QModelIndex & index, const QVariant & value, in\n             settings.setValue(\"fCoinControlFeatures\", fCoinControlFeatures);\n             Q_EMIT coinControlFeaturesChanged(fCoinControlFeatures);\n             break;\n+        case Prune:\n+            if (settings.value(\"bPrune\") != value) {\n+                settings.setValue(\"bPrune\", value);\n+                setRestartRequired(true);\n+            }\n+            break;\n+        case PruneSize:\n+            if (settings.value(\"nPruneSize\") != value) {\n+                settings.setValue(\"nPruneSize\", value);\n+                setRestartRequired(true);\n+            }\n+            break;\n         case DatabaseCache:\n             if (settings.value(\"nDatabaseCache\") != value) {\n                 settings.setValue(\"nDatabaseCache\", value);"
      },
      {
        "sha": "2777cbeaf2cdcb07d476d991826ab441c31be916",
        "filename": "src/qt/optionsmodel.h",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/cbede7dbfde83d53ef38d257e9940af5f163b03c/src/qt/optionsmodel.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/cbede7dbfde83d53ef38d257e9940af5f163b03c/src/qt/optionsmodel.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/optionsmodel.h?ref=cbede7dbfde83d53ef38d257e9940af5f163b03c",
        "patch": "@@ -50,6 +50,8 @@ class OptionsModel : public QAbstractListModel\n         Language,               // QString\n         CoinControlFeatures,    // bool\n         ThreadsScriptVerif,     // int\n+        Prune,                  // bool\n+        PruneSize,              // int\n         DatabaseCache,          // int\n         SpendZeroConfChange,    // bool\n         Listen,                 // bool"
      }
    ]
  }
]