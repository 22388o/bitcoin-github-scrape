[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/986688016",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#issuecomment-986688016",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23683",
    "id": 986688016,
    "node_id": "IC_kwDOABII5846z6oQ",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?u=3e27bc6589085f3450be1b0e969d04008cc77565&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-06T11:27:25Z",
    "updated_at": "2021-12-06T11:27:25Z",
    "author_association": "CONTRIBUTOR",
    "body": "cc @MarcoFalke, thanks for catching my bug :bug:",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/986688016/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/987752880",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#issuecomment-987752880",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23683",
    "id": 987752880,
    "node_id": "IC_kwDOABII58463-mw",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?u=06eb9ae4f9b3f954056098860decccbf1340e40f&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-07T09:53:08Z",
    "updated_at": "2021-12-07T09:53:08Z",
    "author_association": "MEMBER",
    "body": "utACK 28b60ce3122b29ffad2c60790d3bfe9a2ede2471\r\n\r\nThe bug is pretty scary, good thing we found it this soon, and the fix is straightforward.\r\nThe test looks correct.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/987752880/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/987771707",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#issuecomment-987771707",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23683",
    "id": 987771707,
    "node_id": "IC_kwDOABII58464DM7",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-07T10:13:32Z",
    "updated_at": "2021-12-07T10:13:32Z",
    "author_association": "MEMBER",
    "body": "> Too bad this can't properly be tested on regtest. I guess the only way is via a pre-mined main-chain?\r\n\r\nAh no. I don't think this is possible to test at all. The lockpoints are just a cache and if it is outdated, evaluating it will always return false, in which case the lockpoints are re-evaluated. So this is not fixing a behaviour bug, but potentially improving performance a bit?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/987771707/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/987829408",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#issuecomment-987829408",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23683",
    "id": 987829408,
    "node_id": "IC_kwDOABII58464RSg",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?u=3e27bc6589085f3450be1b0e969d04008cc77565&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-07T11:18:07Z",
    "updated_at": "2021-12-07T11:18:07Z",
    "author_association": "CONTRIBUTOR",
    "body": "> > Too bad this can't properly be tested on regtest. I guess the only way is via a pre-mined main-chain?\r\n\r\n> Ah no. I don't think this is possible to test at all. The lockpoints are just a cache and if it is outdated, evaluating it will always return false, in which case the lockpoints are re-evaluated. So this is not fixing a behaviour bug, but potentially improving performance a bit?\r\n\r\nThe \"natural reorg to a new chain that is shorter (but has more work)\" is probably not possible without significant changes to regtest chainparams, I think. Since this PR adds assertions for the lockpoints, making sure they're updated is testable. And true, I suppose outdated lockpoints are not _that_ bad, though now I'm wondering if it's worth adding the assertions if it's relatively harmless.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/987829408/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/987998795",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#issuecomment-987998795",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23683",
    "id": 987998795,
    "node_id": "IC_kwDOABII584646pL",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-07T14:52:28Z",
    "updated_at": "2021-12-07T14:52:28Z",
    "author_association": "MEMBER",
    "body": "> Since this PR adds assertions for the lockpoints\r\n\r\nI was hoping there was a way to test this on current master without modifying the code, but yeah...",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/987998795/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762930383",
    "pull_request_review_id": 823847626,
    "id": 762930383,
    "node_id": "PRRC_kwDOABII584teWTP",
    "diff_hunk": "@@ -106,8 +106,45 @@ def run_test(self):\n \n         self.log.info(\"Check that the mempool is empty\")\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n+        assert_equal(set(self.nodes[1].getrawmempool()), set())",
    "path": "test/functional/mempool_reorg.py",
    "position": null,
    "original_position": 4,
    "commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
    "original_commit_id": "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: Why is this needed? The `self.sync_all()` in the next line should take care of that already. I think it should be fine to remove either this line or the next.",
    "created_at": "2021-12-06T11:39:47Z",
    "updated_at": "2021-12-06T11:43:07Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762930383",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762930383"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762930383"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762930383/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 109,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762930557",
    "pull_request_review_id": 823847626,
    "id": 762930557,
    "node_id": "PRRC_kwDOABII584teWV9",
    "diff_hunk": "@@ -106,8 +106,45 @@ def run_test(self):\n \n         self.log.info(\"Check that the mempool is empty\")\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n+        assert_equal(set(self.nodes[1].getrawmempool()), set())\n         self.sync_all()\n \n \n+        self.log.info(\"Simulate natural reorg\")\n+        self.connect_nodes(0, 1)",
    "path": "test/functional/mempool_reorg.py",
    "position": 5,
    "original_position": 9,
    "commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
    "original_commit_id": "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: Why is this needed? Are they not connected already?",
    "created_at": "2021-12-06T11:40:05Z",
    "updated_at": "2021-12-06T11:43:07Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762930557",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762930557"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762930557"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762930557/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 112,
    "original_line": 112,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762931172",
    "pull_request_review_id": 823847626,
    "id": 762931172,
    "node_id": "PRRC_kwDOABII584teWfk",
    "diff_hunk": "@@ -106,8 +106,45 @@ def run_test(self):\n \n         self.log.info(\"Check that the mempool is empty\")\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n+        assert_equal(set(self.nodes[1].getrawmempool()), set())\n         self.sync_all()\n \n \n+        self.log.info(\"Simulate natural reorg\")\n+        self.connect_nodes(0, 1)\n+        assert_equal(self.nodes[0].getblockcount(), self.nodes[1].getblockcount())\n+        assert_equal(set(self.nodes[0].getrawmempool()), set(self.nodes[0].getrawmempool()))",
    "path": "test/functional/mempool_reorg.py",
    "position": null,
    "original_position": 11,
    "commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
    "original_commit_id": "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: Why are the asserts needed? The implicit `self.sync_all` in the next line should assert this already.",
    "created_at": "2021-12-06T11:41:02Z",
    "updated_at": "2021-12-06T11:43:07Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762931172",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762931172"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762931172"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762931172/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 116,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762931588",
    "pull_request_review_id": 823847626,
    "id": 762931588,
    "node_id": "PRRC_kwDOABII584teWmE",
    "diff_hunk": "@@ -106,8 +106,45 @@ def run_test(self):\n \n         self.log.info(\"Check that the mempool is empty\")\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n+        assert_equal(set(self.nodes[1].getrawmempool()), set())\n         self.sync_all()\n \n \n+        self.log.info(\"Simulate natural reorg\")\n+        self.connect_nodes(0, 1)\n+        assert_equal(self.nodes[0].getblockcount(), self.nodes[1].getblockcount())\n+        assert_equal(set(self.nodes[0].getrawmempool()), set(self.nodes[0].getrawmempool()))\n+        self.generate(self.nodes[0], 3)\n+        # Create another transaction which is time-locked to two blocks in the future\n+        utxo = wallet.get_utxo()\n+        timelock_tx_2 = wallet.create_self_transfer(\n+            from_node=self.nodes[0],\n+            utxo_to_spend=utxo,",
    "path": "test/functional/mempool_reorg.py",
    "position": null,
    "original_position": 17,
    "commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
    "original_commit_id": "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: Why is this needed? The wallet will pick a utxo by itself.",
    "created_at": "2021-12-06T11:41:37Z",
    "updated_at": "2021-12-06T11:43:07Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762931588",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762931588"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762931588"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762931588/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 122,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762931929",
    "pull_request_review_id": 823847626,
    "id": 762931929,
    "node_id": "PRRC_kwDOABII584teWrZ",
    "diff_hunk": "@@ -106,8 +106,45 @@ def run_test(self):\n \n         self.log.info(\"Check that the mempool is empty\")\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n+        assert_equal(set(self.nodes[1].getrawmempool()), set())\n         self.sync_all()\n \n \n+        self.log.info(\"Simulate natural reorg\")\n+        self.connect_nodes(0, 1)\n+        assert_equal(self.nodes[0].getblockcount(), self.nodes[1].getblockcount())\n+        assert_equal(set(self.nodes[0].getrawmempool()), set(self.nodes[0].getrawmempool()))\n+        self.generate(self.nodes[0], 3)\n+        # Create another transaction which is time-locked to two blocks in the future\n+        utxo = wallet.get_utxo()\n+        timelock_tx_2 = wallet.create_self_transfer(\n+            from_node=self.nodes[0],\n+            utxo_to_spend=utxo,\n+            mempool_valid=False,\n+            locktime=self.nodes[0].getblockcount() + 2\n+        )['hex']\n+        # Check that the time-locked transaction is too immature to spend\n+        assert_raises_rpc_error(-26, \"non-final\", self.nodes[0].sendrawtransaction, timelock_tx_2)\n+        assert_raises_rpc_error(-26, \"non-final\", self.nodes[1].sendrawtransaction, timelock_tx_2)\n+\n+        self.log.info(\"Disconnect nodes and mine separate forks\")\n+        self.disconnect_nodes(0, 1)\n+        # Don't try to sync nodes because they are disconnected\n+        no_sync_func = lambda: True",
    "path": "test/functional/mempool_reorg.py",
    "position": null,
    "original_position": 28,
    "commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
    "original_commit_id": "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: Why is this needed? You can use `self.no_op`",
    "created_at": "2021-12-06T11:42:08Z",
    "updated_at": "2021-12-06T11:43:07Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762931929",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762931929"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762931929"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762931929/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 133,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762965682",
    "pull_request_review_id": 823895457,
    "id": 762965682,
    "node_id": "PRRC_kwDOABII584tee6y",
    "diff_hunk": "@@ -106,8 +106,45 @@ def run_test(self):\n \n         self.log.info(\"Check that the mempool is empty\")\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n+        assert_equal(set(self.nodes[1].getrawmempool()), set())\n         self.sync_all()\n \n \n+        self.log.info(\"Simulate natural reorg\")\n+        self.connect_nodes(0, 1)",
    "path": "test/functional/mempool_reorg.py",
    "position": 5,
    "original_position": 9,
    "commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
    "original_commit_id": "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "They don't stay in sync if I don't call `connect_nodes` here... it also doesn't work if I call `connect_nodes(1, 0)` instead. So my guess is that this creation of a manual connection from node0 to node1 adds a permission that we need.",
    "created_at": "2021-12-06T12:32:45Z",
    "updated_at": "2021-12-06T12:32:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762965682",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762965682"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762965682"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762965682/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 112,
    "original_line": 112,
    "side": "RIGHT",
    "in_reply_to_id": 762930557
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762965737",
    "pull_request_review_id": 823895535,
    "id": 762965737,
    "node_id": "PRRC_kwDOABII584tee7p",
    "diff_hunk": "@@ -106,8 +106,45 @@ def run_test(self):\n \n         self.log.info(\"Check that the mempool is empty\")\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n+        assert_equal(set(self.nodes[1].getrawmempool()), set())\n         self.sync_all()\n \n \n+        self.log.info(\"Simulate natural reorg\")\n+        self.connect_nodes(0, 1)\n+        assert_equal(self.nodes[0].getblockcount(), self.nodes[1].getblockcount())\n+        assert_equal(set(self.nodes[0].getrawmempool()), set(self.nodes[0].getrawmempool()))",
    "path": "test/functional/mempool_reorg.py",
    "position": null,
    "original_position": 11,
    "commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
    "original_commit_id": "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "removed",
    "created_at": "2021-12-06T12:32:50Z",
    "updated_at": "2021-12-06T12:32:51Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762965737",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762965737"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762965737"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762965737/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 116,
    "side": "RIGHT",
    "in_reply_to_id": 762931172
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762965821",
    "pull_request_review_id": 823895638,
    "id": 762965821,
    "node_id": "PRRC_kwDOABII584tee89",
    "diff_hunk": "@@ -106,8 +106,45 @@ def run_test(self):\n \n         self.log.info(\"Check that the mempool is empty\")\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n+        assert_equal(set(self.nodes[1].getrawmempool()), set())\n         self.sync_all()\n \n \n+        self.log.info(\"Simulate natural reorg\")\n+        self.connect_nodes(0, 1)\n+        assert_equal(self.nodes[0].getblockcount(), self.nodes[1].getblockcount())\n+        assert_equal(set(self.nodes[0].getrawmempool()), set(self.nodes[0].getrawmempool()))\n+        self.generate(self.nodes[0], 3)\n+        # Create another transaction which is time-locked to two blocks in the future\n+        utxo = wallet.get_utxo()\n+        timelock_tx_2 = wallet.create_self_transfer(\n+            from_node=self.nodes[0],\n+            utxo_to_spend=utxo,",
    "path": "test/functional/mempool_reorg.py",
    "position": null,
    "original_position": 17,
    "commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
    "original_commit_id": "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "removed",
    "created_at": "2021-12-06T12:32:57Z",
    "updated_at": "2021-12-06T12:32:57Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762965821",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762965821"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762965821"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762965821/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 122,
    "side": "RIGHT",
    "in_reply_to_id": 762931588
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762965966",
    "pull_request_review_id": 823895859,
    "id": 762965966,
    "node_id": "PRRC_kwDOABII584tee_O",
    "diff_hunk": "@@ -106,8 +106,45 @@ def run_test(self):\n \n         self.log.info(\"Check that the mempool is empty\")\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n+        assert_equal(set(self.nodes[1].getrawmempool()), set())\n         self.sync_all()\n \n \n+        self.log.info(\"Simulate natural reorg\")\n+        self.connect_nodes(0, 1)\n+        assert_equal(self.nodes[0].getblockcount(), self.nodes[1].getblockcount())\n+        assert_equal(set(self.nodes[0].getrawmempool()), set(self.nodes[0].getrawmempool()))\n+        self.generate(self.nodes[0], 3)\n+        # Create another transaction which is time-locked to two blocks in the future\n+        utxo = wallet.get_utxo()\n+        timelock_tx_2 = wallet.create_self_transfer(\n+            from_node=self.nodes[0],\n+            utxo_to_spend=utxo,\n+            mempool_valid=False,\n+            locktime=self.nodes[0].getblockcount() + 2\n+        )['hex']\n+        # Check that the time-locked transaction is too immature to spend\n+        assert_raises_rpc_error(-26, \"non-final\", self.nodes[0].sendrawtransaction, timelock_tx_2)\n+        assert_raises_rpc_error(-26, \"non-final\", self.nodes[1].sendrawtransaction, timelock_tx_2)\n+\n+        self.log.info(\"Disconnect nodes and mine separate forks\")\n+        self.disconnect_nodes(0, 1)\n+        # Don't try to sync nodes because they are disconnected\n+        no_sync_func = lambda: True",
    "path": "test/functional/mempool_reorg.py",
    "position": null,
    "original_position": 28,
    "commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
    "original_commit_id": "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "ahh, didn't know about that - fixed",
    "created_at": "2021-12-06T12:33:11Z",
    "updated_at": "2021-12-06T12:33:11Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762965966",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762965966"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762965966"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762965966/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 133,
    "side": "RIGHT",
    "in_reply_to_id": 762931929
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762966229",
    "pull_request_review_id": 823896117,
    "id": 762966229,
    "node_id": "PRRC_kwDOABII584tefDV",
    "diff_hunk": "@@ -106,8 +106,45 @@ def run_test(self):\n \n         self.log.info(\"Check that the mempool is empty\")\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n+        assert_equal(set(self.nodes[1].getrawmempool()), set())",
    "path": "test/functional/mempool_reorg.py",
    "position": null,
    "original_position": 4,
    "commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
    "original_commit_id": "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "removed",
    "created_at": "2021-12-06T12:33:28Z",
    "updated_at": "2021-12-06T12:33:29Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762966229",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762966229"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762966229"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762966229/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 109,
    "side": "RIGHT",
    "in_reply_to_id": 762930383
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763013572",
    "pull_request_review_id": 823962604,
    "id": 763013572,
    "node_id": "PRRC_kwDOABII584teqnE",
    "diff_hunk": "@@ -312,6 +312,19 @@ class CompareTxMemPoolEntryByAncestorFee\n     }\n };\n \n+/**\n+ * Update LockPoints in a mempool entry for which the caller only has a const iterator to.",
    "path": "src/txmempool.h",
    "position": null,
    "original_position": 5,
    "commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
    "original_commit_id": "034f13a14a180ee5c060879b686972230d748a22",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think this comment can be removed. Mutable iterators in the mempool don't exist and the function name is self-explanatory.",
    "created_at": "2021-12-06T13:38:44Z",
    "updated_at": "2021-12-06T14:56:15Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763013572",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763013572"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763013572"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763013572/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 316,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763015410",
    "pull_request_review_id": 823962604,
    "id": 763015410,
    "node_id": "PRRC_kwDOABII584terDy",
    "diff_hunk": "@@ -378,6 +378,8 @@ void CChainState::MaybeUpdateMempoolForReorg(\n                 }",
    "path": "src/validation.cpp",
    "position": 1,
    "original_position": 1,
    "commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
    "original_commit_id": "f1f3f19f84da6bc5a157d9bf2e5c0500f53ae614",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "in the second commit: Maybe mention that the bug was introduces in commit  bedf246 ?",
    "created_at": "2021-12-06T13:41:05Z",
    "updated_at": "2021-12-06T14:56:15Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763015410",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763015410"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763015410"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763015410/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 378,
    "original_line": 378,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763037472",
    "pull_request_review_id": 823962604,
    "id": 763037472,
    "node_id": "PRRC_kwDOABII584tewcg",
    "diff_hunk": "@@ -108,6 +108,37 @@ def run_test(self):\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n         self.sync_all()\n \n+        self.log.info(\"Simulate a natural reorg where mempool transaction stays valid but on a different block\")\n+        self.connect_nodes(0, 1)\n+        # Mine a block to create mature coinbase\n+        self.generate(self.nodes[0], 2)\n+        # Create another transaction which is time-locked to two blocks in the future\n+        timelock_tx_2 = wallet.create_self_transfer(\n+            from_node=self.nodes[0],\n+            mempool_valid=False,\n+            locktime=self.nodes[0].getblockcount() + 2",
    "path": "test/functional/mempool_reorg.py",
    "position": null,
    "original_position": 12,
    "commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
    "original_commit_id": "bd716bf774d21956ec7ae616d06a2a896568ed18",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: missing trailing `,`.",
    "created_at": "2021-12-06T14:07:54Z",
    "updated_at": "2021-12-06T14:56:15Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763037472",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763037472"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763037472"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763037472/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 119,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763051867",
    "pull_request_review_id": 823962604,
    "id": 763051867,
    "node_id": "PRRC_kwDOABII584tez9b",
    "diff_hunk": "@@ -106,8 +106,45 @@ def run_test(self):\n \n         self.log.info(\"Check that the mempool is empty\")\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n+        assert_equal(set(self.nodes[1].getrawmempool()), set())\n         self.sync_all()\n \n \n+        self.log.info(\"Simulate natural reorg\")\n+        self.connect_nodes(0, 1)",
    "path": "test/functional/mempool_reorg.py",
    "position": 5,
    "original_position": 9,
    "commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
    "original_commit_id": "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Ah ok, it is not possible to use compact blocks during IBD",
    "created_at": "2021-12-06T14:24:09Z",
    "updated_at": "2021-12-06T14:56:15Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763051867",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763051867"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763051867"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763051867/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 112,
    "original_line": 112,
    "side": "RIGHT",
    "in_reply_to_id": 762930557
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763115678",
    "pull_request_review_id": 824105584,
    "id": 763115678,
    "node_id": "PRRC_kwDOABII584tfDie",
    "diff_hunk": "@@ -378,6 +378,8 @@ void CChainState::MaybeUpdateMempoolForReorg(\n                 }",
    "path": "src/validation.cpp",
    "position": 1,
    "original_position": 1,
    "commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
    "original_commit_id": "f1f3f19f84da6bc5a157d9bf2e5c0500f53ae614",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "added",
    "created_at": "2021-12-06T15:32:13Z",
    "updated_at": "2021-12-06T15:32:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763115678",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763115678"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763115678"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763115678/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 378,
    "original_line": 378,
    "side": "RIGHT",
    "in_reply_to_id": 763015410
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763115781",
    "pull_request_review_id": 824105729,
    "id": 763115781,
    "node_id": "PRRC_kwDOABII584tfDkF",
    "diff_hunk": "@@ -108,6 +108,37 @@ def run_test(self):\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n         self.sync_all()\n \n+        self.log.info(\"Simulate a natural reorg where mempool transaction stays valid but on a different block\")\n+        self.connect_nodes(0, 1)\n+        # Mine a block to create mature coinbase\n+        self.generate(self.nodes[0], 2)\n+        # Create another transaction which is time-locked to two blocks in the future\n+        timelock_tx_2 = wallet.create_self_transfer(\n+            from_node=self.nodes[0],\n+            mempool_valid=False,\n+            locktime=self.nodes[0].getblockcount() + 2",
    "path": "test/functional/mempool_reorg.py",
    "position": null,
    "original_position": 12,
    "commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
    "original_commit_id": "bd716bf774d21956ec7ae616d06a2a896568ed18",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "added",
    "created_at": "2021-12-06T15:32:20Z",
    "updated_at": "2021-12-06T15:32:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763115781",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763115781"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763115781"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763115781/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 119,
    "side": "RIGHT",
    "in_reply_to_id": 763037472
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763115892",
    "pull_request_review_id": 824105858,
    "id": 763115892,
    "node_id": "PRRC_kwDOABII584tfDl0",
    "diff_hunk": "@@ -312,6 +312,19 @@ class CompareTxMemPoolEntryByAncestorFee\n     }\n };\n \n+/**\n+ * Update LockPoints in a mempool entry for which the caller only has a const iterator to.",
    "path": "src/txmempool.h",
    "position": null,
    "original_position": 5,
    "commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
    "original_commit_id": "034f13a14a180ee5c060879b686972230d748a22",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "removed",
    "created_at": "2021-12-06T15:32:25Z",
    "updated_at": "2021-12-06T15:32:26Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763115892",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763115892"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763115892"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763115892/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 316,
    "side": "RIGHT",
    "in_reply_to_id": 763013572
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763794040",
    "pull_request_review_id": 824999003,
    "id": 763794040,
    "node_id": "PRRC_kwDOABII584thpJ4",
    "diff_hunk": "@@ -378,6 +378,8 @@ void CChainState::MaybeUpdateMempoolForReorg(\n                 }\n             }\n         }\n+        // CheckSequenceLocks updates lp. Update the mempool entry LockPoints.\n+        if (!validLP) m_mempool->mapTx.modify(it, update_lock_points(lp));",
    "path": "src/validation.cpp",
    "position": 5,
    "original_position": 5,
    "commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
    "original_commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I was thinking \"what if we skip those transactions with `should_remove=true` here?\". I guess, we'll have the same original problem: they won't be cleared because we would mistakenly think they have valid `lp` in `removeForReorg`?\r\n\r\nPerhaps this deserves a comment extension, saying that txs to be removed must be updated here.",
    "created_at": "2021-12-07T09:21:39Z",
    "updated_at": "2021-12-07T09:22:02Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763794040",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763794040"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763794040"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763794040/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 382,
    "original_line": 382,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763810771",
    "pull_request_review_id": 825021997,
    "id": 763810771,
    "node_id": "PRRC_kwDOABII584thtPT",
    "diff_hunk": "@@ -378,6 +378,8 @@ void CChainState::MaybeUpdateMempoolForReorg(\n                 }\n             }\n         }\n+        // CheckSequenceLocks updates lp. Update the mempool entry LockPoints.\n+        if (!validLP) m_mempool->mapTx.modify(it, update_lock_points(lp));",
    "path": "src/validation.cpp",
    "position": 5,
    "original_position": 5,
    "commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
    "original_commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "No, they'll still be cleared - `removeForReorg` just applies `check_final_and_mature` on all entries and removes them if it returns true, it doesn't check whether the `lp` is valid. I'm not 100% sure if we could skip the `should_remove=true` ones, but I think it would be fine. The `CheckSequenceLocks` function doesn't guarantee `lp` to be reliable if it returns false, and the function doesn't even get executed if `CheckFinalTx` returns false.",
    "created_at": "2021-12-07T09:41:07Z",
    "updated_at": "2021-12-07T09:41:08Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763810771",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763810771"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763810771"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763810771/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 382,
    "original_line": 382,
    "side": "RIGHT",
    "in_reply_to_id": 763794040
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763836593",
    "pull_request_review_id": 825058969,
    "id": 763836593,
    "node_id": "PRRC_kwDOABII584thzix",
    "diff_hunk": "@@ -378,6 +378,8 @@ void CChainState::MaybeUpdateMempoolForReorg(\n                 }\n             }\n         }\n+        // CheckSequenceLocks updates lp. Update the mempool entry LockPoints.\n+        if (!validLP) m_mempool->mapTx.modify(it, update_lock_points(lp));",
    "path": "src/validation.cpp",
    "position": 5,
    "original_position": 5,
    "commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
    "original_commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I agree that it is safe to skip if the tx will be removed anyway. When this was introduced in commit 14d6324a248df50cb79fbeb5b60a978687a3b64e it updates unconditionally.",
    "created_at": "2021-12-07T10:09:13Z",
    "updated_at": "2021-12-07T10:09:13Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763836593",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763836593"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763836593"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763836593/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 382,
    "original_line": 382,
    "side": "RIGHT",
    "in_reply_to_id": 763794040
  }
]