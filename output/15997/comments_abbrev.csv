DrahtBot,2019-05-12 19:18:25,<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.,https://github.com/bitcoin/bitcoin/pull/15997#issuecomment-491621549,491621549,
promag,2019-05-21 10:10:07,Updated to use `WITH_LOCK(...)`.,https://github.com/bitcoin/bitcoin/pull/15997#issuecomment-494328657,494328657,
MarcoFalke,2019-05-21 10:54:58,Should remove the (no longer applicable?) comment that was added in 90ba2df11b5bc943ac48b49b5da8023864dc842d?,https://github.com/bitcoin/bitcoin/pull/15997#issuecomment-494342367,494342367,
promag,2019-05-21 11:03:46,Done.,https://github.com/bitcoin/bitcoin/pull/15997#issuecomment-494344833,494344833,
MarcoFalke,2019-05-21 11:08:57,"Also, should update OP to why https://github.com/bitcoin/bitcoin/pull/12287#discussion_r164518333 does not apply",https://github.com/bitcoin/bitcoin/pull/15997#issuecomment-494346549,494346549,
promag,2019-06-30 09:32:58,@MarcoFalke all done here no?,https://github.com/bitcoin/bitcoin/pull/15997#issuecomment-507021971,507021971,
promag,2019-08-19 00:40:33,Rebased due to #16443.,https://github.com/bitcoin/bitcoin/pull/15997#issuecomment-522374103,522374103,
laanwj,2019-09-30 12:53:37,Can you clarify (in the PR title) whether this is a bug fix or refactor?,https://github.com/bitcoin/bitcoin/pull/15997#issuecomment-536547350,536547350,
promag,2019-09-30 13:58:30,"Well this changes behavior so I'd say a fix.\n\nAlso note that `interfaces::Chain::guessVerificationProgress` should probably move to `interfaces::Chain::Lock`, but considering https://github.com/bitcoin/bitcoin/blob/c3a8e097b1afe27bce2f71817fd23cb857236d9d/src/interfaces/chain.h#L59-L64\nI'd like to know first if it's ok cc @ryanofsky ",https://github.com/bitcoin/bitcoin/pull/15997#issuecomment-536573688,536573688,
MarcoFalke,2019-09-30 14:05:02,"This is not a bugfix. See:\n\n```cpp\nsrc/validation.cpp://! require cs_main if pindex has not been validated yet (because nChainTx might be unset)\n",https://github.com/bitcoin/bitcoin/pull/15997#issuecomment-536576811,536576811,
ryanofsky,2019-09-30 14:35:39,"> Also note that `interfaces::Chain::guessVerificationProgress` should probably move to `interfaces::Chain::Lock`\n\nAs the code comment you linked to suggests, it would not be good to add another method to Chain::Lock, and @ariard has PR to completely remove it in #16426\n\nNew wallet code should be written in a more asynchronous way that locks cs_main intermittently instead of bringing the n",https://github.com/bitcoin/bitcoin/pull/15997#issuecomment-536591129,536591129,
promag,2019-09-30 14:41:04,"Stepping back then in favor of #16426.\n\n`interfaces::Node::getVerificationProgress` already locks so GVP can be called with the lock held. As for `NotifyBlockTip` and `NotifyHeaderTip`, these could also notify the the verification progress.",https://github.com/bitcoin/bitcoin/pull/15997#issuecomment-536593638,536593638,
MarcoFalke,2019-05-10 12:34:51,"```suggestion\n          WITH_LOCK(cs_main, GuessVerificationProgress(chainParams.TxData(), pindexNew)), pcoinsTip->DynamicMemoryUsage() * (1.0 / (1<<20)), pcoinsTip->GetCacheSize());\n```",https://github.com/bitcoin/bitcoin/pull/15997#discussion_r282864183,282864183,src/validation.cpp
promag,2019-05-10 12:54:38,I think it should also have the lock while reading `nChainTx`?,https://github.com/bitcoin/bitcoin/pull/15997#discussion_r282870826,282870826,src/validation.cpp
MarcoFalke,2019-05-10 13:27:51,"cs_main is already held in `UpdateTip`, so no need to take it again",https://github.com/bitcoin/bitcoin/pull/15997#discussion_r282883177,282883177,src/validation.cpp
promag,2019-05-12 17:33:46,"Travis last job failed with:\n```\nvalidation.cpp:2284:7: error: calling function 'GuessVerificationProgress' requires holding mutex 'cs_main' exclusively [-Werror,-Wthread-safety-analysis]\n      GuessVerificationProgress(chainParams.TxData(), pindexNew), pcoinsTip->DynamicMemoryUsage() * (1.0 / (1<<20)), pcoinsTip->GetCacheSize());\n```\nAdded\n```diff\n /** Check warning conditions and d",https://github.com/bitcoin/bitcoin/pull/15997#discussion_r283146451,283146451,src/validation.cpp
MarcoFalke,2019-05-21 11:06:42,Should move this comment to the header or remove it?,https://github.com/bitcoin/bitcoin/pull/15997#discussion_r285969626,285969626,src/validation.cpp
promag,2019-05-21 11:34:09,Removed.,https://github.com/bitcoin/bitcoin/pull/15997#discussion_r285978412,285978412,src/validation.cpp
