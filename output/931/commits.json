[
  {
    "sha": "21e875c9586ac98c8de79bfa75c5731ee4c62f3d",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyMWU4NzVjOTU4NmFjOThjOGRlNzliZmE3NWM1NzMxZWU0YzYyZjNk",
    "commit": {
      "author": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2012-03-11T21:57:44Z"
      },
      "committer": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2012-03-11T21:57:47Z"
      },
      "message": "Print wallet load errors (to debug.log)",
      "tree": {
        "sha": "f6d8e8816db6fdda0f943c1cac4ee210eadce2e0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f6d8e8816db6fdda0f943c1cac4ee210eadce2e0"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/21e875c9586ac98c8de79bfa75c5731ee4c62f3d",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/21e875c9586ac98c8de79bfa75c5731ee4c62f3d",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/21e875c9586ac98c8de79bfa75c5731ee4c62f3d",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/21e875c9586ac98c8de79bfa75c5731ee4c62f3d/comments",
    "author": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "4585d828b490f826cf863353d1cdf41ec4cb0724",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4585d828b490f826cf863353d1cdf41ec4cb0724",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/4585d828b490f826cf863353d1cdf41ec4cb0724"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 2,
      "deletions": 0
    },
    "files": [
      {
        "sha": "a5db20b908f113d1f1183f7bf03cec701fbf5f0c",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/21e875c9586ac98c8de79bfa75c5731ee4c62f3d/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/21e875c9586ac98c8de79bfa75c5731ee4c62f3d/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=21e875c9586ac98c8de79bfa75c5731ee4c62f3d",
        "patch": "@@ -370,12 +370,14 @@ bool AppInit2(int argc, char* argv[])\n         else if (nLoadWalletRet == DB_NEED_REWRITE)\n         {\n             strErrors << _(\"Wallet needed to be rewritten: restart Bitcoin to complete\") << \"\\n\";\n+            printf(\"%s\", strErrors.str().c_str());\n             wxMessageBox(strErrors.str(), \"Bitcoin\", wxOK | wxICON_ERROR);\n             return false;\n         }\n         else\n             strErrors << _(\"Error loading wallet.dat\") << \"\\n\";\n     }\n+    printf(\"%s\", strErrors.str().c_str());\n     printf(\" wallet      %15\"PRI64d\"ms\\n\", GetTimeMillis() - nStart);\n \n     RegisterWallet(pwalletMain);"
      }
    ]
  },
  {
    "sha": "3cc06249322bac5c495848a3f97be508153dc5d9",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozY2MwNjI0OTMyMmJhYzVjNDk1ODQ4YTNmOTdiZTUwODE1M2RjNWQ5",
    "commit": {
      "author": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2012-03-11T22:07:40Z"
      },
      "committer": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2012-03-12T18:01:15Z"
      },
      "message": "Print more diagnostic info for the various DB_CORRUPT conditions",
      "tree": {
        "sha": "e9f0097aea7db052ae1dd72c7e224d6a237685d5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e9f0097aea7db052ae1dd72c7e224d6a237685d5"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3cc06249322bac5c495848a3f97be508153dc5d9",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3cc06249322bac5c495848a3f97be508153dc5d9",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/3cc06249322bac5c495848a3f97be508153dc5d9",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3cc06249322bac5c495848a3f97be508153dc5d9/comments",
    "author": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "21e875c9586ac98c8de79bfa75c5731ee4c62f3d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/21e875c9586ac98c8de79bfa75c5731ee4c62f3d",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/21e875c9586ac98c8de79bfa75c5731ee4c62f3d"
      }
    ],
    "stats": {
      "total": 38,
      "additions": 36,
      "deletions": 2
    },
    "files": [
      {
        "sha": "0344c7960cd526b66ed890b708b17d5daffe4c56",
        "filename": "src/db.cpp",
        "status": "modified",
        "additions": 36,
        "deletions": 2,
        "changes": 38,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3cc06249322bac5c495848a3f97be508153dc5d9/src/db.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3cc06249322bac5c495848a3f97be508153dc5d9/src/db.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/db.cpp?ref=3cc06249322bac5c495848a3f97be508153dc5d9",
        "patch": "@@ -774,7 +774,10 @@ int CWalletDB::LoadWallet(CWallet* pwallet)\n         // Get cursor\n         Dbc* pcursor = GetCursor();\n         if (!pcursor)\n+        {\n+            printf(\"Error getting wallet database cursor\\n\");\n             return DB_CORRUPT;\n+        }\n \n         loop\n         {\n@@ -785,7 +788,10 @@ int CWalletDB::LoadWallet(CWallet* pwallet)\n             if (ret == DB_NOTFOUND)\n                 break;\n             else if (ret != 0)\n+            {\n+                printf(\"Error reading next record from wallet database\\n\");\n                 return DB_CORRUPT;\n+            }\n \n             // Unserialize\n             // Taking advantage of the fact that pair serialization\n@@ -856,20 +862,39 @@ int CWalletDB::LoadWallet(CWallet* pwallet)\n                     ssValue >> pkey;\n                     key.SetPubKey(vchPubKey);\n                     key.SetPrivKey(pkey);\n-                    if (key.GetPubKey() != vchPubKey || !key.IsValid())\n+                    if (key.GetPubKey() != vchPubKey)\n+                    {\n+                        printf(\"Error reading wallet database: CPrivKey pubkey inconsistency\\n\");\n                         return DB_CORRUPT;\n+                    }\n+                    if (!key.IsValid())\n+                    {\n+                        printf(\"Error reading wallet database: invalid CPrivKey\\n\");\n+                        return DB_CORRUPT;\n+                    }\n                 }\n                 else\n                 {\n                     CWalletKey wkey;\n                     ssValue >> wkey;\n                     key.SetPubKey(vchPubKey);\n                     key.SetPrivKey(wkey.vchPrivKey);\n-                    if (key.GetPubKey() != vchPubKey || !key.IsValid())\n+                    if (key.GetPubKey() != vchPubKey)\n+                    {\n+                        printf(\"Error reading wallet database: CWalletKey pubkey inconsistency\\n\");\n+                        return DB_CORRUPT;\n+                    }\n+                    if (!key.IsValid())\n+                    {\n+                        printf(\"Error reading wallet database: invalid CWalletKey\\n\");\n                         return DB_CORRUPT;\n+                    }\n                 }\n                 if (!pwallet->LoadKey(key))\n+                {\n+                    printf(\"Error reading wallet database: LoadKey failed\\n\");\n                     return DB_CORRUPT;\n+                }\n             }\n             else if (strType == \"mkey\")\n             {\n@@ -878,7 +903,10 @@ int CWalletDB::LoadWallet(CWallet* pwallet)\n                 CMasterKey kMasterKey;\n                 ssValue >> kMasterKey;\n                 if(pwallet->mapMasterKeys.count(nID) != 0)\n+                {\n+                    printf(\"Error reading wallet database: duplicate CMasterKey id %u\\n\", nID);\n                     return DB_CORRUPT;\n+                }\n                 pwallet->mapMasterKeys[nID] = kMasterKey;\n                 if (pwallet->nMasterKeyMaxID < nID)\n                     pwallet->nMasterKeyMaxID = nID;\n@@ -890,7 +918,10 @@ int CWalletDB::LoadWallet(CWallet* pwallet)\n                 vector<unsigned char> vchPrivKey;\n                 ssValue >> vchPrivKey;\n                 if (!pwallet->LoadCryptedKey(vchPubKey, vchPrivKey))\n+                {\n+                    printf(\"Error reading wallet database: LoadCryptedKey failed\\n\");\n                     return DB_CORRUPT;\n+                }\n                 fIsEncrypted = true;\n             }\n             else if (strType == \"defaultkey\")\n@@ -924,7 +955,10 @@ int CWalletDB::LoadWallet(CWallet* pwallet)\n                 CScript script;\n                 ssValue >> script;\n                 if (!pwallet->LoadCScript(script))\n+                {\n+                    printf(\"Error reading wallet database: LoadCScript failed\\n\");\n                     return DB_CORRUPT;\n+                }\n             }\n         }\n         pcursor->close();"
      }
    ]
  }
]