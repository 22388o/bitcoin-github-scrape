[
  {
    "sha": "0445e1a1a5064ed954b1d2fbae626bfcd7b5c928",
    "node_id": "C_kwDOABII59oAKDA0NDVlMWExYTUwNjRlZDk1NGIxZDJmYmFlNjI2YmZjZDdiNWM5Mjg",
    "commit": {
      "author": {
        "name": "fanquake",
        "email": "fanquake@gmail.com",
        "date": "2021-11-17T01:43:01Z"
      },
      "committer": {
        "name": "fanquake",
        "email": "fanquake@gmail.com",
        "date": "2021-11-17T08:12:47Z"
      },
      "message": "build: use -fcf-protection=full when building Windows Boost in depends",
      "tree": {
        "sha": "daf4b64e6dec779bd90578efaf00cdc600c4baab",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/daf4b64e6dec779bd90578efaf00cdc600c4baab"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0445e1a1a5064ed954b1d2fbae626bfcd7b5c928",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEz7FuIclQ9n+pXlWPLuufXMCVJsEFAmGUuX8ACgkQLuufXMCV\nJsE33A/9He/4CNxmIlYcs6IRF+MjlgUQJMigrmf3Lc5a8OZOeUZBk5WlEz7AdTi7\nLeuIwF5JKokwYRvMdPD/M9rEzTURAIfrmefm7DIqCR3q2jBKsEyOmvIoQEoUT04s\nNn6dzgal6VuvoO1A5kanPem3hPrDwZv1G32+AsoU8xTj8JJnT+XD+ApGwDaGWtBd\n9C2BlmFV6bJWeohkg8ohjJPqzt3CSHXY7cyf4peNcjOiGmK/NN+4gHSsahEOSOyP\nlftZqqWBjPCkwHTf1HhHU/ULErcvvrasfjqlkc90kPGmMp0LCVCDIvWjPcfkes62\nFPSw1NcnDAFMm44b0Rx44PREKnNvexL05DjnZgyJuhR/KfwAcWaN/MR7CNWZJwXW\nCRhHpiO6BZNUn1qbfXOddri2eIfyXirJ/DR0yYP79Kei4PNuAC+A89ny/SdMjDn3\nPgLmL4Ppg+g5TeCHGXJBZEIdAw134vcam3ShCQsfdXxaZmYShcFEZguS4lpNUfRt\nFZ6sv84V/Z4nJgRZSHyb825KwlIfugUEWRxAZ18kotyG0Bb0v7/lyCEa37u5KkwK\nNSPKrxLyl+ti5qZX5xGdYO7/V9obkkGKx/f9S/zmZfCfXxXCQHiTvIdKjC6cgd2i\nXLhZsmNuJVzhrZpXEwjnMlM3gjpig6bdQMWVZPuPMTHvJw+/KjM=\n=7XZ3\n-----END PGP SIGNATURE-----",
        "payload": "tree daf4b64e6dec779bd90578efaf00cdc600c4baab\nparent 398fd63356db9023665396c371d67a8c76edeb4d\nauthor fanquake <fanquake@gmail.com> 1637113381 +0800\ncommitter fanquake <fanquake@gmail.com> 1637136767 +0800\n\nbuild: use -fcf-protection=full when building Windows Boost in depends\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0445e1a1a5064ed954b1d2fbae626bfcd7b5c928",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/0445e1a1a5064ed954b1d2fbae626bfcd7b5c928",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0445e1a1a5064ed954b1d2fbae626bfcd7b5c928/comments",
    "author": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "398fd63356db9023665396c371d67a8c76edeb4d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/398fd63356db9023665396c371d67a8c76edeb4d",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/398fd63356db9023665396c371d67a8c76edeb4d"
      }
    ],
    "stats": {
      "total": 1,
      "additions": 1,
      "deletions": 0
    },
    "files": [
      {
        "sha": "5fe2b2bbb80896f570fa3c9a250880c16e16ba22",
        "filename": "depends/packages/boost.mk",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/0445e1a1a5064ed954b1d2fbae626bfcd7b5c928/depends/packages/boost.mk",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/0445e1a1a5064ed954b1d2fbae626bfcd7b5c928/depends/packages/boost.mk",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/depends/packages/boost.mk?ref=0445e1a1a5064ed954b1d2fbae626bfcd7b5c928",
        "patch": "@@ -27,6 +27,7 @@ $(package)_cxxflags+=-std=c++17\n $(package)_cxxflags_linux=-fPIC\n $(package)_cxxflags_android=-fPIC\n $(package)_cxxflags_x86_64_darwin=-fcf-protection=full\n+$(package)_cxxflags_mingw32=-fcf-protection=full\n endef\n \n define $(package)_preprocess_cmds"
      }
    ]
  },
  {
    "sha": "f31d4bd21401228799d78aab70de881ea39f99f2",
    "node_id": "C_kwDOABII59oAKGYzMWQ0YmQyMTQwMTIyODc5OWQ3OGFhYjcwZGU4ODFlYTM5Zjk5ZjI",
    "commit": {
      "author": {
        "name": "fanquake",
        "email": "fanquake@gmail.com",
        "date": "2021-05-17T03:58:45Z"
      },
      "committer": {
        "name": "fanquake",
        "email": "fanquake@gmail.com",
        "date": "2021-11-17T08:12:47Z"
      },
      "message": "scripts: test for PE control flow instrumentation",
      "tree": {
        "sha": "f6a3f9f13d77c730ae53ae7f3a07bdee60615ca9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f6a3f9f13d77c730ae53ae7f3a07bdee60615ca9"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f31d4bd21401228799d78aab70de881ea39f99f2",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEz7FuIclQ9n+pXlWPLuufXMCVJsEFAmGUuYAACgkQLuufXMCV\nJsFqVQ//VeuHG/tWwyXKH0ODmgdIQ+rwK24EqYr8bohf07fFivbOFxn/Thri+vLZ\nGmjeuMTDd2ZpyKBVepzOtkcJRu30fWVFn00fiVZho8Daw/F0/0+2eC+TxTI+Dlnx\nT66DBk5wtE0Ma5l/t4WoRhyQ1j1wcJFN1eEy6xqqsuwlxSc+yXg8TfRdRYgmQ2mm\nv7SzFeSKRxO/udWzgMIDeLj8k1IQov70/gvfOsZ2gHDjqVoHymabVpOTMJe4mx7W\nFCnM7rEGEexapd/SIxpHglixMz/DXDY7FFe3q3blwiDZYPAGY0siXDvs7Do/aCwM\ndsbXXZHcXSe6iS1vGCp2IWaTeq8N8r6q2nn0ZD+tv51XwA0SAr+54WGcgAz1KSWF\nca2s1FGj46vvXLTBUbnMtH9xm7APQvFSK8HdQ23UKiV6QEeJZHp4BomCZXEF+zIO\nQiqKKTEp+LG0uz3vLZ7YkPDu3Z8vECw/sNyS2meKlk4ixacZG4sscgEWfNrcpibN\ns/JzENh9rBi6njMIN968iwFW2C2EMAYn6HLo+I1pkaJmJudTLGiMtYMRON4mQ1ZJ\nO4tCCQNvDr0F2RSesjK59QbbiVra4ktKw4Nx0vJFWZ6qsr29L+JJ0Pt+j4ZMduxL\nQbdFxD59P4aKpKcICCw+K5YJa+pePFmSG7XkhisBJGg8pxyD4hg=\n=6Fpj\n-----END PGP SIGNATURE-----",
        "payload": "tree f6a3f9f13d77c730ae53ae7f3a07bdee60615ca9\nparent 0445e1a1a5064ed954b1d2fbae626bfcd7b5c928\nauthor fanquake <fanquake@gmail.com> 1621223925 +1000\ncommitter fanquake <fanquake@gmail.com> 1637136767 +0800\n\nscripts: test for PE control flow instrumentation\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f31d4bd21401228799d78aab70de881ea39f99f2",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/f31d4bd21401228799d78aab70de881ea39f99f2",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f31d4bd21401228799d78aab70de881ea39f99f2/comments",
    "author": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "0445e1a1a5064ed954b1d2fbae626bfcd7b5c928",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0445e1a1a5064ed954b1d2fbae626bfcd7b5c928",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/0445e1a1a5064ed954b1d2fbae626bfcd7b5c928"
      }
    ],
    "stats": {
      "total": 30,
      "additions": 24,
      "deletions": 6
    },
    "files": [
      {
        "sha": "677557b8fa61f526f13ecb2cb984b144b7bacc9b",
        "filename": "contrib/devtools/security-check.py",
        "status": "modified",
        "additions": 17,
        "deletions": 1,
        "changes": 18,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f31d4bd21401228799d78aab70de881ea39f99f2/contrib/devtools/security-check.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f31d4bd21401228799d78aab70de881ea39f99f2/contrib/devtools/security-check.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/devtools/security-check.py?ref=f31d4bd21401228799d78aab70de881ea39f99f2",
        "patch": "@@ -121,6 +121,21 @@ def check_PE_RELOC_SECTION(binary) -> bool:\n     '''Check for a reloc section. This is required for functional ASLR.'''\n     return binary.has_relocations\n \n+def check_PE_control_flow(binary) -> bool:\n+    '''\n+    Check for control flow instrumentation\n+    '''\n+    main = binary.get_symbol('main').value\n+\n+    section_addr = binary.section_from_rva(main).virtual_address\n+    virtual_address = binary.optional_header.imagebase + section_addr + main\n+\n+    content = binary.get_content_from_virtual_address(virtual_address, 4, lief.Binary.VA_TYPES.VA)\n+\n+    if content == [243, 15, 30, 250]: # endbr64\n+        return True\n+    return False\n+\n def check_MACHO_NOUNDEFS(binary) -> bool:\n     '''\n     Check for no undefined references.\n@@ -177,7 +192,8 @@ def check_control_flow(binary) -> bool:\n     ('DYNAMIC_BASE', check_PE_DYNAMIC_BASE),\n     ('HIGH_ENTROPY_VA', check_PE_HIGH_ENTROPY_VA),\n     ('NX', check_NX),\n-    ('RELOC_SECTION', check_PE_RELOC_SECTION)\n+    ('RELOC_SECTION', check_PE_RELOC_SECTION),\n+    ('CONTROL_FLOW', check_PE_control_flow),\n ],\n 'MACHO': [\n     ('PIE', check_PIE),"
      },
      {
        "sha": "01df863ac0474bccdaf487d16970026b9ac0051c",
        "filename": "contrib/devtools/test-security-check.py",
        "status": "modified",
        "additions": 7,
        "deletions": 5,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f31d4bd21401228799d78aab70de881ea39f99f2/contrib/devtools/test-security-check.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f31d4bd21401228799d78aab70de881ea39f99f2/contrib/devtools/test-security-check.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/devtools/test-security-check.py?ref=f31d4bd21401228799d78aab70de881ea39f99f2",
        "patch": "@@ -70,16 +70,18 @@ def test_PE(self):\n         write_testcode(source)\n \n         self.assertEqual(call_security_check(cc, source, executable, ['-Wl,--no-nxcompat','-Wl,--disable-reloc-section','-Wl,--no-dynamicbase','-Wl,--no-high-entropy-va','-no-pie','-fno-PIE']),\n-            (1, executable+': failed PIE DYNAMIC_BASE HIGH_ENTROPY_VA NX RELOC_SECTION'))\n+            (1, executable+': failed PIE DYNAMIC_BASE HIGH_ENTROPY_VA NX RELOC_SECTION CONTROL_FLOW'))\n         self.assertEqual(call_security_check(cc, source, executable, ['-Wl,--nxcompat','-Wl,--disable-reloc-section','-Wl,--no-dynamicbase','-Wl,--no-high-entropy-va','-no-pie','-fno-PIE']),\n-            (1, executable+': failed PIE DYNAMIC_BASE HIGH_ENTROPY_VA RELOC_SECTION'))\n+            (1, executable+': failed PIE DYNAMIC_BASE HIGH_ENTROPY_VA RELOC_SECTION CONTROL_FLOW'))\n         self.assertEqual(call_security_check(cc, source, executable, ['-Wl,--nxcompat','-Wl,--enable-reloc-section','-Wl,--no-dynamicbase','-Wl,--no-high-entropy-va','-no-pie','-fno-PIE']),\n-            (1, executable+': failed PIE DYNAMIC_BASE HIGH_ENTROPY_VA'))\n+            (1, executable+': failed PIE DYNAMIC_BASE HIGH_ENTROPY_VA CONTROL_FLOW'))\n         self.assertEqual(call_security_check(cc, source, executable, ['-Wl,--nxcompat','-Wl,--enable-reloc-section','-Wl,--no-dynamicbase','-Wl,--no-high-entropy-va','-pie','-fPIE']),\n-            (1, executable+': failed PIE DYNAMIC_BASE HIGH_ENTROPY_VA'))  # -pie -fPIE does nothing unless --dynamicbase is also supplied\n+            (1, executable+': failed PIE DYNAMIC_BASE HIGH_ENTROPY_VA CONTROL_FLOW'))  # -pie -fPIE does nothing unless --dynamicbase is also supplied\n         self.assertEqual(call_security_check(cc, source, executable, ['-Wl,--nxcompat','-Wl,--enable-reloc-section','-Wl,--dynamicbase','-Wl,--no-high-entropy-va','-pie','-fPIE']),\n-            (1, executable+': failed HIGH_ENTROPY_VA'))\n+            (1, executable+': failed HIGH_ENTROPY_VA CONTROL_FLOW'))\n         self.assertEqual(call_security_check(cc, source, executable, ['-Wl,--nxcompat','-Wl,--enable-reloc-section','-Wl,--dynamicbase','-Wl,--high-entropy-va','-pie','-fPIE']),\n+            (1, executable+': failed CONTROL_FLOW'))\n+        self.assertEqual(call_security_check(cc, source, executable, ['-Wl,--nxcompat','-Wl,--enable-reloc-section','-Wl,--dynamicbase','-Wl,--high-entropy-va','-pie','-fPIE', '-fcf-protection=full']),\n             (0, ''))\n \n         clean_files(source, executable)"
      }
    ]
  }
]