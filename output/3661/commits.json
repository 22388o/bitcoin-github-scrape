[
  {
    "sha": "b7b8fd5d31593dc44ea610ea7614545c69e7ee87",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiN2I4ZmQ1ZDMxNTkzZGM0NGVhNjEwZWE3NjE0NTQ1YzY5ZTdlZTg3",
    "commit": {
      "author": {
        "name": "Gavin Andresen",
        "email": "gavinandresen@gmail.com",
        "date": "2014-02-13T02:33:00Z"
      },
      "committer": {
        "name": "Gavin Andresen",
        "email": "gavinandresen@gmail.com",
        "date": "2014-02-13T15:44:55Z"
      },
      "message": "Make qa/rpc-tests/ compatible with OSX\n\nReworked send.sh, so it works properly on my Mac (killall send.sh\ndoesn't work, because the process name is 'bash' not 'send.sh').\nSo now send.sh writes a .send.pid file, and invoking it as\nsend.sh -STOP (as the bitcoind -walletnotify) signals that PID.",
      "tree": {
        "sha": "c60281f428c9af4f001c217c8ae1f78af1e6bdec",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c60281f428c9af4f001c217c8ae1f78af1e6bdec"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b7b8fd5d31593dc44ea610ea7614545c69e7ee87",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b7b8fd5d31593dc44ea610ea7614545c69e7ee87",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/b7b8fd5d31593dc44ea610ea7614545c69e7ee87",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b7b8fd5d31593dc44ea610ea7614545c69e7ee87/comments",
    "author": {
      "login": "gavinandresen",
      "id": 331997,
      "node_id": "MDQ6VXNlcjMzMTk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/331997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gavinandresen",
      "html_url": "https://github.com/gavinandresen",
      "followers_url": "https://api.github.com/users/gavinandresen/followers",
      "following_url": "https://api.github.com/users/gavinandresen/following{/other_user}",
      "gists_url": "https://api.github.com/users/gavinandresen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gavinandresen/subscriptions",
      "organizations_url": "https://api.github.com/users/gavinandresen/orgs",
      "repos_url": "https://api.github.com/users/gavinandresen/repos",
      "events_url": "https://api.github.com/users/gavinandresen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gavinandresen/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "gavinandresen",
      "id": 331997,
      "node_id": "MDQ6VXNlcjMzMTk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/331997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gavinandresen",
      "html_url": "https://github.com/gavinandresen",
      "followers_url": "https://api.github.com/users/gavinandresen/followers",
      "following_url": "https://api.github.com/users/gavinandresen/following{/other_user}",
      "gists_url": "https://api.github.com/users/gavinandresen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gavinandresen/subscriptions",
      "organizations_url": "https://api.github.com/users/gavinandresen/orgs",
      "repos_url": "https://api.github.com/users/gavinandresen/repos",
      "events_url": "https://api.github.com/users/gavinandresen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gavinandresen/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "ea062655e045b68d568d2faf7abe946deb00d46d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ea062655e045b68d568d2faf7abe946deb00d46d",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/ea062655e045b68d568d2faf7abe946deb00d46d"
      }
    ],
    "stats": {
      "total": 16,
      "additions": 15,
      "deletions": 1
    },
    "files": [
      {
        "sha": "2c0d5375c063f6e105cf2e46834ecd07158e86a3",
        "filename": "qa/rpc-tests/send.sh",
        "status": "modified",
        "additions": 14,
        "deletions": 0,
        "changes": 14,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/b7b8fd5d31593dc44ea610ea7614545c69e7ee87/qa/rpc-tests/send.sh",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/b7b8fd5d31593dc44ea610ea7614545c69e7ee87/qa/rpc-tests/send.sh",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/qa/rpc-tests/send.sh?ref=b7b8fd5d31593dc44ea610ea7614545c69e7ee87",
        "patch": "@@ -1,14 +1,28 @@\n #!/bin/bash\n TIMEOUT=10\n SIGNAL=HUP\n+PIDFILE=.send.pid\n if [ $# -eq 0 ]; then\n   echo -e \"Usage:\\t$0 <cmd>\"\n   echo -e \"\\tRuns <cmd> and wait ${TIMEOUT} seconds or until SIG${SIGNAL} is received.\"\n   echo -e \"\\tReturns: 0 if SIG${SIGNAL} is received, 1 otherwise.\"\n+  echo -e \"Or:\\t$0 -STOP\"\n+  echo -e \"\\tsends SIG${SIGNAL} to running send.sh\"\n   exit 0\n fi\n+\n+if [ $1 == \"-STOP\" ]; then\n+  if [ -s ${PIDFILE} ]; then\n+      kill -s ${SIGNAL} $(<${PIDFILE})\n+  fi\n+  exit 0\n+fi\n+\n trap '[[ ${PID} ]] && kill ${PID}' ${SIGNAL}\n+trap 'rm -f ${PIDFILE}' EXIT\n+echo $$ > ${PIDFILE}\n \"$@\"\n sleep ${TIMEOUT} & PID=$!\n wait ${PID} && exit 1\n+\n exit 0"
      },
      {
        "sha": "d1e4c941cc1a80c07720d9e376bcaa68dd904a33",
        "filename": "qa/rpc-tests/util.sh",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/b7b8fd5d31593dc44ea610ea7614545c69e7ee87/qa/rpc-tests/util.sh",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/b7b8fd5d31593dc44ea610ea7614545c69e7ee87/qa/rpc-tests/util.sh",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/qa/rpc-tests/util.sh?ref=b7b8fd5d31593dc44ea610ea7614545c69e7ee87",
        "patch": "@@ -23,7 +23,7 @@ function CreateDataDir {\n   echo \"rpcuser=rt\" >> $CONF\n   echo \"rpcpassword=rt\" >> $CONF\n   echo \"rpcwait=1\" >> $CONF\n-  echo \"walletnotify=killall -HUP `basename ${SENDANDWAIT}`\" >> $CONF\n+  echo \"walletnotify=${SENDANDWAIT} -STOP\" >> $CONF\n   shift\n   while (( \"$#\" )); do\n       echo $1 >> $CONF"
      }
    ]
  },
  {
    "sha": "f0898f67b5633210ab826a484d1e9be5f2e3f6d2",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmMDg5OGY2N2I1NjMzMjEwYWI4MjZhNDg0ZDFlOWJlNWYyZTNmNmQy",
    "commit": {
      "author": {
        "name": "Gavin Andresen",
        "email": "gavinandresen@gmail.com",
        "date": "2014-02-12T18:43:07Z"
      },
      "committer": {
        "name": "Gavin Andresen",
        "email": "gavinandresen@gmail.com",
        "date": "2014-02-13T17:28:09Z"
      },
      "message": "Handle \"dead\" transactions properly\n\nExtend CMerkleTx::GetDepthInMainChain with the concept of\na \"dead\" transaction-- a transaction generated by the wallet\nthat is not in the main chain or in the mempool, and, therefore,\nwill likely never be confirmed.\n\nGetDepthInMainChain() now returns -1 for dead transactions\n(0 for unconfirmed-but-in-the-mempool, and >1 for confirmed).\n\nThis makes getbalance, getbalance '*', and listunspent all agree when there are\nmutated transactions in the wallet.\n\nBefore:\n listunspent: one 49BTC output\n getbalance: 96 BTC (change counted twice)\n getbalance '*': 46 BTC (spends counted twice)\n\nAfter: all agree, 49 BTC available to spend.",
      "tree": {
        "sha": "d438d83bdede1db233d28681f79755ffc57994f5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d438d83bdede1db233d28681f79755ffc57994f5"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f0898f67b5633210ab826a484d1e9be5f2e3f6d2",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f0898f67b5633210ab826a484d1e9be5f2e3f6d2",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/f0898f67b5633210ab826a484d1e9be5f2e3f6d2",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f0898f67b5633210ab826a484d1e9be5f2e3f6d2/comments",
    "author": {
      "login": "gavinandresen",
      "id": 331997,
      "node_id": "MDQ6VXNlcjMzMTk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/331997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gavinandresen",
      "html_url": "https://github.com/gavinandresen",
      "followers_url": "https://api.github.com/users/gavinandresen/followers",
      "following_url": "https://api.github.com/users/gavinandresen/following{/other_user}",
      "gists_url": "https://api.github.com/users/gavinandresen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gavinandresen/subscriptions",
      "organizations_url": "https://api.github.com/users/gavinandresen/orgs",
      "repos_url": "https://api.github.com/users/gavinandresen/repos",
      "events_url": "https://api.github.com/users/gavinandresen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gavinandresen/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "gavinandresen",
      "id": 331997,
      "node_id": "MDQ6VXNlcjMzMTk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/331997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gavinandresen",
      "html_url": "https://github.com/gavinandresen",
      "followers_url": "https://api.github.com/users/gavinandresen/followers",
      "following_url": "https://api.github.com/users/gavinandresen/following{/other_user}",
      "gists_url": "https://api.github.com/users/gavinandresen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gavinandresen/subscriptions",
      "organizations_url": "https://api.github.com/users/gavinandresen/orgs",
      "repos_url": "https://api.github.com/users/gavinandresen/repos",
      "events_url": "https://api.github.com/users/gavinandresen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gavinandresen/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "b7b8fd5d31593dc44ea610ea7614545c69e7ee87",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b7b8fd5d31593dc44ea610ea7614545c69e7ee87",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/b7b8fd5d31593dc44ea610ea7614545c69e7ee87"
      }
    ],
    "stats": {
      "total": 197,
      "additions": 188,
      "deletions": 9
    },
    "files": [
      {
        "sha": "7aca5f36dfbd5e0a7ba5356850f3a97ae6ff3e09",
        "filename": "qa/rpc-tests/txnmall.sh",
        "status": "added",
        "additions": 144,
        "deletions": 0,
        "changes": 144,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f0898f67b5633210ab826a484d1e9be5f2e3f6d2/qa/rpc-tests/txnmall.sh",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f0898f67b5633210ab826a484d1e9be5f2e3f6d2/qa/rpc-tests/txnmall.sh",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/qa/rpc-tests/txnmall.sh?ref=f0898f67b5633210ab826a484d1e9be5f2e3f6d2",
        "patch": "@@ -0,0 +1,144 @@\n+#!/usr/bin/env bash\n+\n+# Test block generation and basic wallet sending\n+\n+if [ $# -lt 1 ]; then\n+        echo \"Usage: $0 path_to_binaries\"\n+        echo \"e.g. $0 ../../src\"\n+        exit 1\n+fi\n+\n+BITCOIND=${1}/bitcoind\n+CLI=${1}/bitcoin-cli\n+\n+DIR=\"${BASH_SOURCE%/*}\"\n+SENDANDWAIT=\"${DIR}/send.sh\"\n+if [[ ! -d \"$DIR\" ]]; then DIR=\"$PWD\"; fi\n+. \"$DIR/util.sh\"\n+\n+D=$(mktemp -d test.XXXXX)\n+\n+# Two nodes; one will play the part of merchant, the\n+# other an evil transaction-mutating miner.\n+\n+D1=${D}/node1\n+CreateDataDir $D1 port=11000 rpcport=11001\n+B1ARGS=\"-datadir=$D1 -debug\"\n+$BITCOIND $B1ARGS &\n+B1PID=$!\n+\n+D2=${D}/node2\n+CreateDataDir $D2 port=11010 rpcport=11011\n+B2ARGS=\"-datadir=$D2 -debug\"\n+$BITCOIND $B2ARGS &\n+B2PID=$!\n+\n+trap \"kill -9 $B1PID $B2PID; rm -rf $D\" EXIT\n+\n+# Wait until all four nodes are at the same block number\n+function WaitBlocks {\n+    while :\n+    do\n+        sleep 1\n+        BLOCKS1=$( GetBlocks $B1ARGS )\n+        BLOCKS2=$( GetBlocks $B2ARGS )\n+        if (( $BLOCKS1 == $BLOCKS2 ))\n+        then\n+            break\n+        fi\n+    done\n+}\n+\n+# Wait until node has $N peers\n+function WaitPeers {\n+    while :\n+    do\n+        PEERS=$( $CLI $1 getconnectioncount )\n+        if (( \"$PEERS\" == $2 ))\n+        then\n+            break\n+        fi\n+        sleep 1\n+    done\n+}\n+\n+# Start with B2 connected to B1:\n+$CLI $B2ARGS addnode 127.0.0.1:11000 onetry\n+WaitPeers \"$B1ARGS\" 1\n+\n+# 1 block, 50 XBT each == 50 XBT\n+$CLI $B1ARGS setgenerate true 1\n+\n+WaitBlocks\n+# 100 blocks, 0 mature == 0 XBT\n+$CLI $B2ARGS setgenerate true 100\n+WaitBlocks\n+\n+CheckBalance $B1ARGS 50\n+CheckBalance $B2ARGS 0\n+\n+# restart B2 with no connection\n+$CLI $B2ARGS stop > /dev/null 2>&1\n+wait $B2PID\n+$BITCOIND $B2ARGS &\n+B2PID=$!\n+\n+B2ADDRESS=$( $CLI $B2ARGS getnewaddress )\n+\n+# Have B1 create two transactions; second will\n+# spend change from first, since B1 starts with only a single\n+# 50 bitcoin output:\n+TXID1=$( $CLI $B1ARGS sendtoaddress $B2ADDRESS 1.0 )\n+TXID2=$( $CLI $B1ARGS sendtoaddress $B2ADDRESS 2.0 )\n+\n+# Mutate TXID1 and add it to B2's memory pool:\n+RAWTX1=$( $CLI $B1ARGS getrawtransaction $TXID1 )\n+RAWTX2=$( $CLI $B1ARGS getrawtransaction $TXID2 )\n+# ... mutate RAWTX1:\n+# RAWTX1 is hex-encoded, serialized transaction. So each\n+# byte is two characters; we'll prepend the first\n+# \"push\" in the scriptsig with OP_PUSHDATA1 (0x4c),\n+# and add one to the length of the signature.\n+# Fields are fixed; from the beginning:\n+# 4-byte version\n+# 1-byte varint number-of inputs (one in this case)\n+# 32-byte previous txid\n+# 4-byte previous output\n+# 1-byte varint length-of-scriptsig\n+# 1-byte PUSH this many bytes onto stack\n+#  ... etc\n+# So: to mutate, we want to get byte 41 (hex characters 82-83),\n+# increment it, and insert 0x4c after it.\n+L=${RAWTX1:82:2}\n+NEWLEN=$( printf \"%x\" $(( 16#$L + 1 )) )\n+MUTATEDTX1=${RAWTX1:0:82}${NEWLEN}4c${RAWTX1:84}\n+# ... give mutated tx1 to B2:\n+MUTATEDTXID=$( $CLI $B2ARGS sendrawtransaction $MUTATEDTX1 )\n+\n+echo \"TXID1: \" $TXID1\n+echo \"Mutated: \" $MUTATEDTXID\n+\n+# Re-connect nodes, and have B2 mine a block\n+$CLI $B2ARGS addnode 127.0.0.1:11000 onetry\n+WaitPeers \"$B1ARGS\" 1\n+\n+$CLI $B2ARGS setgenerate true 1\n+WaitBlocks\n+\n+$CLI $B2ARGS stop > /dev/null 2>&1\n+wait $B2PID\n+$CLI $B1ARGS stop > /dev/null 2>&1\n+wait $B1PID\n+\n+trap \"\" EXIT\n+\n+echo \"Done, bitcoind's shut down. To rerun/poke around:\"\n+echo \"${1}/bitcoind -datadir=$D1 -daemon\"\n+echo \"${1}/bitcoind -datadir=$D2 -daemon -connect=127.0.0.1:11000\"\n+echo \"To cleanup:\"\n+echo \"killall bitcoind; rm -rf test.*\"\n+exit 0\n+\n+echo \"Tests successful, cleaning up\"\n+rm -rf $D\n+exit 0"
      },
      {
        "sha": "36dd03a2b1b31142d2180058a1ef50d17aa964bc",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 9,
        "deletions": 1,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f0898f67b5633210ab826a484d1e9be5f2e3f6d2/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f0898f67b5633210ab826a484d1e9be5f2e3f6d2/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=f0898f67b5633210ab826a484d1e9be5f2e3f6d2",
        "patch": "@@ -872,7 +872,7 @@ bool AcceptToMemoryPool(CTxMemPool& pool, CValidationState &state, const CTransa\n }\n \n \n-int CMerkleTx::GetDepthInMainChain(CBlockIndex* &pindexRet) const\n+int CMerkleTx::GetDepthInMainChainINTERNAL(CBlockIndex* &pindexRet) const\n {\n     if (hashBlock == 0 || nIndex == -1)\n         return 0;\n@@ -897,6 +897,14 @@ int CMerkleTx::GetDepthInMainChain(CBlockIndex* &pindexRet) const\n     return chainActive.Height() - pindex->nHeight + 1;\n }\n \n+int CMerkleTx::GetDepthInMainChain(CBlockIndex* &pindexRet) const\n+{\n+    int nResult = GetDepthInMainChainINTERNAL(pindexRet);\n+    if (nResult == 0 && !mempool.exists(GetHash()))\n+        return -1; // Not in chain, not in mempool\n+\n+    return nResult;\n+}\n \n int CMerkleTx::GetBlocksToMaturity() const\n {"
      },
      {
        "sha": "317c3cc95b0c7dc5b0bf021838906c956322e4f0",
        "filename": "src/main.h",
        "status": "modified",
        "additions": 8,
        "deletions": 1,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f0898f67b5633210ab826a484d1e9be5f2e3f6d2/src/main.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f0898f67b5633210ab826a484d1e9be5f2e3f6d2/src/main.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.h?ref=f0898f67b5633210ab826a484d1e9be5f2e3f6d2",
        "patch": "@@ -423,6 +423,8 @@ class CScriptCheck\n /** A transaction with a merkle branch linking it to the block chain. */\n class CMerkleTx : public CTransaction\n {\n+private:\n+    int GetDepthInMainChainINTERNAL(CBlockIndex* &pindexRet) const;\n public:\n     uint256 hashBlock;\n     std::vector<uint256> vMerkleBranch;\n@@ -461,9 +463,14 @@ class CMerkleTx : public CTransaction\n \n \n     int SetMerkleBranch(const CBlock* pblock=NULL);\n+\n+    // Return depth of transaction in blockchain:\n+    // -1 : not in blockchain, and not in memory pool (dead transaction)\n+    // 0 : in memory pool, waiting to be included in a block\n+    // >1 : this many blocks deep in the main chain\n     int GetDepthInMainChain(CBlockIndex* &pindexRet) const;\n     int GetDepthInMainChain() const { CBlockIndex *pindexRet; return GetDepthInMainChain(pindexRet); }\n-    bool IsInMainChain() const { return GetDepthInMainChain() > 0; }\n+    bool IsInMainChain() const { CBlockIndex *pindexRet; return GetDepthInMainChainINTERNAL(pindexRet) > 0; }\n     int GetBlocksToMaturity() const;\n     bool AcceptToMemoryPool(bool fLimitFree=true);\n };"
      },
      {
        "sha": "5d796199715b0e1d8a689acd7effa150bc827c1f",
        "filename": "src/qt/transactiondesc.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 1,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f0898f67b5633210ab826a484d1e9be5f2e3f6d2/src/qt/transactiondesc.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f0898f67b5633210ab826a484d1e9be5f2e3f6d2/src/qt/transactiondesc.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/transactiondesc.cpp?ref=f0898f67b5633210ab826a484d1e9be5f2e3f6d2",
        "patch": "@@ -30,7 +30,9 @@ QString TransactionDesc::FormatTxStatus(const CWalletTx& wtx)\n     else\n     {\n         int nDepth = wtx.GetDepthInMainChain();\n-        if (GetAdjustedTime() - wtx.nTimeReceived > 2 * 60 && wtx.GetRequestCount() == 0)\n+        if (nDepth < 0)\n+            return tr(\"dead\");\n+        else if (GetAdjustedTime() - wtx.nTimeReceived > 2 * 60 && wtx.GetRequestCount() == 0)\n             return tr(\"%1/offline\").arg(nDepth);\n         else if (nDepth < 6)\n             return tr(\"%1/unconfirmed\").arg(nDepth);"
      },
      {
        "sha": "4fe96168bc6a7124366c42878a94e87e6c8ef052",
        "filename": "src/rpcwallet.cpp",
        "status": "modified",
        "additions": 11,
        "deletions": 3,
        "changes": 14,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f0898f67b5633210ab826a484d1e9be5f2e3f6d2/src/rpcwallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f0898f67b5633210ab826a484d1e9be5f2e3f6d2/src/rpcwallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpcwallet.cpp?ref=f0898f67b5633210ab826a484d1e9be5f2e3f6d2",
        "patch": "@@ -45,7 +45,7 @@ void WalletTxToJSON(const CWalletTx& wtx, Object& entry)\n     entry.push_back(Pair(\"confirmations\", confirms));\n     if (wtx.IsCoinBase())\n         entry.push_back(Pair(\"generated\", true));\n-    if (confirms)\n+    if (confirms > 0)\n     {\n         entry.push_back(Pair(\"blockhash\", wtx.hashBlock.GetHex()));\n         entry.push_back(Pair(\"blockindex\", wtx.nIndex));\n@@ -1109,7 +1109,10 @@ void ListTransactions(const CWalletTx& wtx, const string& strAccount, int nMinDe\n             Object entry;\n             entry.push_back(Pair(\"account\", strSentAccount));\n             MaybePushAddress(entry, s.first);\n-            entry.push_back(Pair(\"category\", \"send\"));\n+            if (wtx.GetDepthInMainChain() < 0)\n+                entry.push_back(Pair(\"category\", \"dead\"));\n+            else\n+                entry.push_back(Pair(\"category\", \"send\"));\n             entry.push_back(Pair(\"amount\", ValueFromAmount(-s.second)));\n             entry.push_back(Pair(\"fee\", ValueFromAmount(-nFee)));\n             if (fLong)\n@@ -1141,7 +1144,12 @@ void ListTransactions(const CWalletTx& wtx, const string& strAccount, int nMinDe\n                         entry.push_back(Pair(\"category\", \"generate\"));\n                 }\n                 else\n-                    entry.push_back(Pair(\"category\", \"receive\"));\n+                {\n+                    if (wtx.GetDepthInMainChain() < 0)\n+                        entry.push_back(Pair(\"category\", \"dead\"));\n+                    else\n+                        entry.push_back(Pair(\"category\", \"receive\"));\n+                }\n                 entry.push_back(Pair(\"amount\", ValueFromAmount(r.second)));\n                 if (fLong)\n                     WalletTxToJSON(wtx, entry);"
      },
      {
        "sha": "d82830cdc4079df868b3f88b834acdeb02bd63b9",
        "filename": "src/wallet.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 1,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f0898f67b5633210ab826a484d1e9be5f2e3f6d2/src/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f0898f67b5633210ab826a484d1e9be5f2e3f6d2/src/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet.cpp?ref=f0898f67b5633210ab826a484d1e9be5f2e3f6d2",
        "patch": "@@ -1021,11 +1021,15 @@ void CWallet::AvailableCoins(vector<COutput>& vCoins, bool fOnlyConfirmed, const\n             if (pcoin->IsCoinBase() && pcoin->GetBlocksToMaturity() > 0)\n                 continue;\n \n+            int nDepth = pcoin->GetDepthInMainChain();\n+            if (nDepth < 0)\n+                continue;\n+\n             for (unsigned int i = 0; i < pcoin->vout.size(); i++) {\n                 if (!(pcoin->IsSpent(i)) && IsMine(pcoin->vout[i]) &&\n                     !IsLockedCoin((*it).first, i) && pcoin->vout[i].nValue > 0 &&\n                     (!coinControl || !coinControl->HasSelected() || coinControl->IsSelected((*it).first, i)))\n-                        vCoins.push_back(COutput(pcoin, i, pcoin->GetDepthInMainChain()));\n+                        vCoins.push_back(COutput(pcoin, i, nDepth));\n             }\n         }\n     }"
      },
      {
        "sha": "c8173ee45693b87f82880e7cea9b44f3202fa5a3",
        "filename": "src/wallet.h",
        "status": "modified",
        "additions": 8,
        "deletions": 2,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f0898f67b5633210ab826a484d1e9be5f2e3f6d2/src/wallet.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f0898f67b5633210ab826a484d1e9be5f2e3f6d2/src/wallet.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet.h?ref=f0898f67b5633210ab826a484d1e9be5f2e3f6d2",
        "patch": "@@ -700,8 +700,11 @@ class CWalletTx : public CMerkleTx\n         // Quick answer in most cases\n         if (!IsFinalTx(*this))\n             return false;\n-        if (GetDepthInMainChain() >= 1)\n+        int nDepth = GetDepthInMainChain();\n+        if (nDepth >= 1)\n             return true;\n+        if (nDepth < 0)\n+            return false;\n         if (!bSpendZeroConfChange || !IsFromMe()) // using wtx's cached debit\n             return false;\n \n@@ -717,8 +720,11 @@ class CWalletTx : public CMerkleTx\n \n             if (!IsFinalTx(*ptx))\n                 return false;\n-            if (ptx->GetDepthInMainChain() >= 1)\n+            int nPDepth = ptx->GetDepthInMainChain();\n+            if (nPDepth >= 1)\n                 continue;\n+            if (nPDepth < 0)\n+                return false;\n             if (!pwallet->IsFromMe(*ptx))\n                 return false;\n "
      }
    ]
  }
]