[
  {
    "sha": "2d83013dc54320b3f0c978475517da6156f7b50d",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyZDgzMDEzZGM1NDMyMGIzZjBjOTc4NDc1NTE3ZGE2MTU2ZjdiNTBk",
    "commit": {
      "author": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2016-05-21T21:55:22Z"
      },
      "committer": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2016-05-25T12:57:24Z"
      },
      "message": "Add support for dnsseeds with option to filter by servicebits",
      "tree": {
        "sha": "5d5648c31b3093367cfe694eeea072f1895d3662",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/5d5648c31b3093367cfe694eeea072f1895d3662"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2d83013dc54320b3f0c978475517da6156f7b50d",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "expired_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQIcBAABAgAGBQJXRaE1AAoJECnUvLZBb1PsXZwQAJMsD0r8KLfReIgMQDwF2Nfl\ndw5MGcErWbS0U1adszkx80bUACdZV5r/NGs1MT701N7vfjM9LLzppcCdqyYcG4dc\nk+FNDn8ESVhbywdLey2zvcP1wCW0Umj8/H4awj2Gp4jDrdd/W3zQKJDoWqbBK4dT\npEeI/vZbgbN/v7UnM4X44IC767rd1e0kPNmaiv1Wqro7IPaxQEp3o4PP43qa8srM\nj24mxTjFajItyi/ORjXpOeda/T4jfvmI3DU4m2JkHVzVq4yDcVQd/zwApQyPT4hE\naX7Ol6kWyd/wtTfCFlKafQTOYcIPBmbgNsvByVFFCu5jEKg9M3shtSOKbfsvm5Br\nnliTfLYLBB0kWsPQtNPCZqct6YsxmILn1lmV+Qk3bI0dbKy1Toar8cjboLca4NLH\nW9i6q4xBQwjg8QE13qYdIdEqj2ICFnVMH82dTO+B+YPmpjhIm4ZTelshj17iqkUm\nJosuXvmRRNRhB1jygKPoiSjo1bAGM+FewXBqetjKkv56/YOWLG8LtfuXJxCvC8eX\nWzQeKUoGB+gefKaccu5zddUQBUK/R6C3XUqfSh8mJlJyl/3ga583vqaucxxN8bKF\nPhbSwg75iVJFaqZOfA+B3muNUfRsQaufbuUxVVOyqbV+QOKC9B4kks1VmCs8EcSD\no8PwDrWZKEgZ0nhBqFYJ\n=GF7y\n-----END PGP SIGNATURE-----",
        "payload": "tree 5d5648c31b3093367cfe694eeea072f1895d3662\nparent 37f9a1f627c0995d89b62923e75cd092600894f9\nauthor Jonas Schnelli <dev@jonasschnelli.ch> 1463867722 +0200\ncommitter Jonas Schnelli <dev@jonasschnelli.ch> 1464181044 +0200\n\nAdd support for dnsseeds with option to filter by servicebits\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2d83013dc54320b3f0c978475517da6156f7b50d",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/2d83013dc54320b3f0c978475517da6156f7b50d",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2d83013dc54320b3f0c978475517da6156f7b50d/comments",
    "author": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "37f9a1f627c0995d89b62923e75cd092600894f9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/37f9a1f627c0995d89b62923e75cd092600894f9",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/37f9a1f627c0995d89b62923e75cd092600894f9"
      }
    ],
    "stats": {
      "total": 22,
      "additions": 18,
      "deletions": 4
    },
    "files": [
      {
        "sha": "00051156711221765cfdeb3668f45eb6d8669179",
        "filename": "src/chainparams.cpp",
        "status": "modified",
        "additions": 10,
        "deletions": 0,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2d83013dc54320b3f0c978475517da6156f7b50d/src/chainparams.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2d83013dc54320b3f0c978475517da6156f7b50d/src/chainparams.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/chainparams.cpp?ref=2d83013dc54320b3f0c978475517da6156f7b50d",
        "patch": "@@ -16,6 +16,14 @@\n \n #include \"chainparamsseeds.h\"\n \n+std::string CDNSSeedData::getHost(uint64_t requiredServiceBits) const {\n+    //use default host for non-filter-capable seeds or if we use the default service bits (NODE_NETWORK)\n+    if (!supportsServiceBitsFiltering || requiredServiceBits == NODE_NETWORK)\n+        return host;\n+    \n+    return strprintf(\"x%x.%s\", requiredServiceBits, host);\n+}\n+\n static CBlock CreateGenesisBlock(const char* pszTimestamp, const CScript& genesisOutputScript, uint32_t nTime, uint32_t nNonce, uint32_t nBits, int32_t nVersion, const CAmount& genesisReward)\n {\n     CMutableTransaction txNew;\n@@ -197,6 +205,8 @@ class CTestNetParams : public CChainParams {\n \n         vFixedSeeds.clear();\n         vSeeds.clear();\n+        // nodes with support for servicebits filtering should be at the top\n+        vSeeds.push_back(CDNSSeedData(\"testnetbitcoin.jonasschnelli.ch\", \"testnet-seed.bitcoin.jonasschnelli.ch\", true));\n         vSeeds.push_back(CDNSSeedData(\"bitcoin.petertodd.org\", \"testnet-seed.bitcoin.petertodd.org\"));\n         vSeeds.push_back(CDNSSeedData(\"bluematt.me\", \"testnet-seed.bluematt.me\"));\n         vSeeds.push_back(CDNSSeedData(\"bitcoin.schildbach.de\", \"testnet-seed.bitcoin.schildbach.de\"));"
      },
      {
        "sha": "7168daaf4347cdcbb238ddecdbafd74c896664ae",
        "filename": "src/chainparams.h",
        "status": "modified",
        "additions": 5,
        "deletions": 2,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2d83013dc54320b3f0c978475517da6156f7b50d/src/chainparams.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2d83013dc54320b3f0c978475517da6156f7b50d/src/chainparams.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/chainparams.h?ref=2d83013dc54320b3f0c978475517da6156f7b50d",
        "patch": "@@ -13,9 +13,12 @@\n \n #include <vector>\n \n-struct CDNSSeedData {\n+class CDNSSeedData {\n+public:\n     std::string name, host;\n-    CDNSSeedData(const std::string &strName, const std::string &strHost) : name(strName), host(strHost) {}\n+    bool supportsServiceBitsFiltering;\n+    std::string getHost(uint64_t requiredServiceBits) const;\n+    CDNSSeedData(const std::string &strName, const std::string &strHost, bool supportsServiceBitsFilteringIn = false) : name(strName), host(strHost), supportsServiceBitsFiltering(supportsServiceBitsFilteringIn) {}\n };\n \n struct SeedSpec6 {"
      },
      {
        "sha": "54d14a7234d2f05266f467a50445767d39d6a92c",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 2,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2d83013dc54320b3f0c978475517da6156f7b50d/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2d83013dc54320b3f0c978475517da6156f7b50d/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=2d83013dc54320b3f0c978475517da6156f7b50d",
        "patch": "@@ -1466,12 +1466,13 @@ void ThreadDNSAddressSeed()\n         } else {\n             std::vector<CNetAddr> vIPs;\n             std::vector<CAddress> vAdd;\n-            if (LookupHost(seed.host.c_str(), vIPs, 0, true))\n+            uint64_t requiredServiceBits = NODE_NETWORK;\n+            if (LookupHost(seed.getHost(requiredServiceBits).c_str(), vIPs, 0, true))\n             {\n                 BOOST_FOREACH(const CNetAddr& ip, vIPs)\n                 {\n                     int nOneDay = 24*3600;\n-                    CAddress addr = CAddress(CService(ip, Params().GetDefaultPort()));\n+                    CAddress addr = CAddress(CService(ip, Params().GetDefaultPort()), requiredServiceBits);\n                     addr.nTime = GetTime() - 3*nOneDay - GetRand(4*nOneDay); // use a random age between 3 and 7 days old\n                     vAdd.push_back(addr);\n                     found++;"
      }
    ]
  }
]