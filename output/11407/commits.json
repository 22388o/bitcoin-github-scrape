[
  {
    "sha": "1088b5322d0e7a8366a285e2baa49c766a9ba5bd",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxMDg4YjUzMjJkMGU3YTgzNjZhMjg1ZTJiYWE0OWM3NjZhOWJhNWJk",
    "commit": {
      "author": {
        "name": "Gregory Sanders",
        "email": "gsanders87@gmail.com",
        "date": "2017-09-26T21:24:26Z"
      },
      "committer": {
        "name": "Gregory Sanders",
        "email": "gsanders87@gmail.com",
        "date": "2017-09-29T15:29:38Z"
      },
      "message": "add functional test for mempoolreplacement command line arg",
      "tree": {
        "sha": "c58ff3bb8a5d76f666768052a92e25118d219cc5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c58ff3bb8a5d76f666768052a92e25118d219cc5"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1088b5322d0e7a8366a285e2baa49c766a9ba5bd",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1088b5322d0e7a8366a285e2baa49c766a9ba5bd",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/1088b5322d0e7a8366a285e2baa49c766a9ba5bd",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1088b5322d0e7a8366a285e2baa49c766a9ba5bd/comments",
    "author": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "a72003d794f39230db476d4f358eb244b7cb2d36",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a72003d794f39230db476d4f358eb244b7cb2d36",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/a72003d794f39230db476d4f358eb244b7cb2d36"
      }
    ],
    "stats": {
      "total": 17,
      "additions": 15,
      "deletions": 2
    },
    "files": [
      {
        "sha": "75f3d77c138089febe524fab11228dad83ea7d7b",
        "filename": "test/functional/replace-by-fee.py",
        "status": "modified",
        "additions": 15,
        "deletions": 2,
        "changes": 17,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1088b5322d0e7a8366a285e2baa49c766a9ba5bd/test/functional/replace-by-fee.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1088b5322d0e7a8366a285e2baa49c766a9ba5bd/test/functional/replace-by-fee.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/replace-by-fee.py?ref=1088b5322d0e7a8366a285e2baa49c766a9ba5bd",
        "patch": "@@ -62,13 +62,14 @@ def make_utxo(node, amount, confirmed=True, scriptPubKey=CScript([1])):\n class ReplaceByFeeTest(BitcoinTestFramework):\n \n     def set_test_params(self):\n-        self.num_nodes = 1\n+        self.num_nodes = 2\n         self.extra_args= [[\"-maxorphantx=1000\",\n                            \"-whitelist=127.0.0.1\",\n                            \"-limitancestorcount=50\",\n                            \"-limitancestorsize=101\",\n                            \"-limitdescendantcount=200\",\n-                           \"-limitdescendantsize=101\"]]\n+                           \"-limitdescendantsize=101\"],\n+                           [\"-mempoolreplacement=0\"]]\n \n     def run_test(self):\n         make_utxo(self.nodes[0], 1*COIN)\n@@ -115,6 +116,8 @@ def test_simple_doublespend(self):\n         tx1a_hex = txToHex(tx1a)\n         tx1a_txid = self.nodes[0].sendrawtransaction(tx1a_hex, True)\n \n+        self.sync_all([self.nodes])\n+\n         # Should fail because we haven't changed the fee\n         tx1b = CTransaction()\n         tx1b.vin = [CTxIn(tx0_outpoint, nSequence=0)]\n@@ -123,12 +126,17 @@ def test_simple_doublespend(self):\n \n         # This will raise an exception due to insufficient fee\n         assert_raises_jsonrpc(-26, \"insufficient fee\", self.nodes[0].sendrawtransaction, tx1b_hex, True)\n+        # This will raise an exception due to transaction replacement being disabled\n+        assert_raises_jsonrpc(-26, \"txn-mempool-conflict\", self.nodes[1].sendrawtransaction, tx1b_hex, True)\n \n         # Extra 0.1 BTC fee\n         tx1b = CTransaction()\n         tx1b.vin = [CTxIn(tx0_outpoint, nSequence=0)]\n         tx1b.vout = [CTxOut(int(0.9*COIN), CScript([b'b']))]\n         tx1b_hex = txToHex(tx1b)\n+        # Replacement still disabled even with \"enough fee\"\n+        assert_raises_jsonrpc(-26, \"txn-mempool-conflict\", self.nodes[1].sendrawtransaction, tx1b_hex, True)\n+        # Works when enabled\n         tx1b_txid = self.nodes[0].sendrawtransaction(tx1b_hex, True)\n \n         mempool = self.nodes[0].getrawmempool()\n@@ -138,6 +146,11 @@ def test_simple_doublespend(self):\n \n         assert_equal(tx1b_hex, self.nodes[0].getrawtransaction(tx1b_txid))\n \n+        # Second node is running mempoolreplacement=0, will not replace originally-seen txn\n+        mempool = self.nodes[1].getrawmempool()\n+        assert tx1a_txid in mempool\n+        assert tx1b_txid not in mempool\n+\n     def test_doublespend_chain(self):\n         \"\"\"Doublespend of a long chain\"\"\"\n "
      }
    ]
  }
]