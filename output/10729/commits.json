[
  {
    "sha": "33e2c48ec4bdb058941b8bccc84532ebe82d88b7",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozM2UyYzQ4ZWM0YmRiMDU4OTQxYjhiY2NjODQ1MzJlYmU4MmQ4OGI3",
    "commit": {
      "author": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2017-06-28T22:05:56Z"
      },
      "committer": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2018-11-03T09:24:53Z"
      },
      "message": "script/interpreter: Wrap EvalScript in a ScriptExecution class",
      "tree": {
        "sha": "4e872c085efe7651f24e09beae58b47c0ed19b46",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4e872c085efe7651f24e09beae58b47c0ed19b46"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/33e2c48ec4bdb058941b8bccc84532ebe82d88b7",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/33e2c48ec4bdb058941b8bccc84532ebe82d88b7",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/33e2c48ec4bdb058941b8bccc84532ebe82d88b7",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/33e2c48ec4bdb058941b8bccc84532ebe82d88b7/comments",
    "author": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "8a9ffec0a257da659ba54c5073bfc820986ae9c1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8a9ffec0a257da659ba54c5073bfc820986ae9c1",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/8a9ffec0a257da659ba54c5073bfc820986ae9c1"
      }
    ],
    "stats": {
      "total": 29,
      "additions": 27,
      "deletions": 2
    },
    "files": [
      {
        "sha": "06768a8ff2fbdc911415968a13a3e0eca4872ebf",
        "filename": "src/script/interpreter.cpp",
        "status": "modified",
        "additions": 6,
        "deletions": 1,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/33e2c48ec4bdb058941b8bccc84532ebe82d88b7/src/script/interpreter.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/33e2c48ec4bdb058941b8bccc84532ebe82d88b7/src/script/interpreter.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/script/interpreter.cpp?ref=33e2c48ec4bdb058941b8bccc84532ebe82d88b7",
        "patch": "@@ -278,7 +278,12 @@ int FindAndDelete(CScript& script, const CScript& b)\n     return nFound;\n }\n \n-bool EvalScript(std::vector<std::vector<unsigned char> >& stack, const CScript& script, unsigned int flags, const BaseSignatureChecker& checker, SigVersion sigversion, ScriptError* serror)\n+ScriptExecution::ScriptExecution(StackType& stack_in, const CScript& script_in, unsigned int flags_in, const BaseSignatureChecker& checker_in, SigVersion sigversion_in) :\n+    script(script_in), stack(stack_in), flags(flags_in), checker(checker_in), sigversion(sigversion_in)\n+{\n+}\n+\n+bool ScriptExecution::Eval(ScriptError* serror)\n {\n     static const CScriptNum bnZero(0);\n     static const CScriptNum bnOne(1);"
      },
      {
        "sha": "7d3d3b6306b267bcf2036d5831956e05ebd442c1",
        "filename": "src/script/interpreter.h",
        "status": "modified",
        "additions": 21,
        "deletions": 1,
        "changes": 22,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/33e2c48ec4bdb058941b8bccc84532ebe82d88b7/src/script/interpreter.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/33e2c48ec4bdb058941b8bccc84532ebe82d88b7/src/script/interpreter.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/script/interpreter.h?ref=33e2c48ec4bdb058941b8bccc84532ebe82d88b7",
        "patch": "@@ -185,7 +185,27 @@ class GenericTransactionSignatureChecker : public BaseSignatureChecker\n using TransactionSignatureChecker = GenericTransactionSignatureChecker<CTransaction>;\n using MutableTransactionSignatureChecker = GenericTransactionSignatureChecker<CMutableTransaction>;\n \n-bool EvalScript(std::vector<std::vector<unsigned char> >& stack, const CScript& script, unsigned int flags, const BaseSignatureChecker& checker, SigVersion sigversion, ScriptError* error = nullptr);\n+class ScriptExecution {\n+public:\n+    typedef std::vector<unsigned char> StackElementType;\n+    typedef std::vector<StackElementType> StackType;\n+\n+    const CScript& script;\n+    StackType& stack;\n+    unsigned int flags;\n+    const BaseSignatureChecker& checker;\n+    SigVersion sigversion;\n+\n+    ScriptExecution(StackType& stack, const CScript&, unsigned int flags, const BaseSignatureChecker&, SigVersion);\n+\n+    bool Eval(ScriptError* error = nullptr);\n+};\n+\n+inline bool EvalScript(std::vector<std::vector<unsigned char> >& stack, const CScript& script, unsigned int flags, const BaseSignatureChecker& checker, SigVersion sigversion, ScriptError* error = nullptr)\n+{\n+    return ScriptExecution(stack, script, flags, checker, sigversion).Eval(error);\n+}\n+\n bool VerifyScript(const CScript& scriptSig, const CScript& scriptPubKey, const CScriptWitness* witness, unsigned int flags, const BaseSignatureChecker& checker, ScriptError* serror = nullptr);\n \n size_t CountWitnessSigOps(const CScript& scriptSig, const CScript& scriptPubKey, const CScriptWitness* witness, unsigned int flags);"
      }
    ]
  },
  {
    "sha": "1887155ef22d27439307439b8c067f65d86fb463",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxODg3MTU1ZWYyMmQyNzQzOTMwNzQzOWI4YzA2N2Y2NWQ4NmZiNDYz",
    "commit": {
      "author": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2017-06-28T23:41:57Z"
      },
      "committer": {
        "name": "Luke Dashjr",
        "email": "luke-jr+git@utopios.org",
        "date": "2018-11-03T09:24:53Z"
      },
      "message": "script/interpreter: Move useful evaluation variables to ScriptExecution class",
      "tree": {
        "sha": "fd8c1985f660fcfa039a72302581c6f7eee66898",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/fd8c1985f660fcfa039a72302581c6f7eee66898"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1887155ef22d27439307439b8c067f65d86fb463",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1887155ef22d27439307439b8c067f65d86fb463",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/1887155ef22d27439307439b8c067f65d86fb463",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1887155ef22d27439307439b8c067f65d86fb463/comments",
    "author": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "33e2c48ec4bdb058941b8bccc84532ebe82d88b7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/33e2c48ec4bdb058941b8bccc84532ebe82d88b7",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/33e2c48ec4bdb058941b8bccc84532ebe82d88b7"
      }
    ],
    "stats": {
      "total": 16,
      "additions": 9,
      "deletions": 7
    },
    "files": [
      {
        "sha": "72a00eec16a64634ed765160b1e3534a0c8dd4f5",
        "filename": "src/script/interpreter.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 7,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1887155ef22d27439307439b8c067f65d86fb463/src/script/interpreter.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1887155ef22d27439307439b8c067f65d86fb463/src/script/interpreter.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/script/interpreter.cpp?ref=1887155ef22d27439307439b8c067f65d86fb463",
        "patch": "@@ -279,7 +279,7 @@ int FindAndDelete(CScript& script, const CScript& b)\n }\n \n ScriptExecution::ScriptExecution(StackType& stack_in, const CScript& script_in, unsigned int flags_in, const BaseSignatureChecker& checker_in, SigVersion sigversion_in) :\n-    script(script_in), stack(stack_in), flags(flags_in), checker(checker_in), sigversion(sigversion_in)\n+    script(script_in), stack(stack_in), flags(flags_in), checker(checker_in), sigversion(sigversion_in), pc(script.begin()), pbegincodehash(script.begin()), nOpCount(0)\n {\n }\n \n@@ -293,17 +293,12 @@ bool ScriptExecution::Eval(ScriptError* serror)\n     // static const valtype vchZero(0);\n     static const valtype vchTrue(1, 1);\n \n-    CScript::const_iterator pc = script.begin();\n-    CScript::const_iterator pend = script.end();\n-    CScript::const_iterator pbegincodehash = script.begin();\n+    const CScript::const_iterator pend = script.end();\n     opcodetype opcode;\n     valtype vchPushValue;\n-    std::vector<bool> vfExec;\n-    std::vector<valtype> altstack;\n     set_error(serror, SCRIPT_ERR_UNKNOWN_ERROR);\n     if (script.size() > MAX_SCRIPT_SIZE)\n         return set_error(serror, SCRIPT_ERR_SCRIPT_SIZE);\n-    int nOpCount = 0;\n     bool fRequireMinimal = (flags & SCRIPT_VERIFY_MINIMALDATA) != 0;\n \n     try"
      },
      {
        "sha": "712dd4fa43e2c213cccfab5e004a3f42f63b9a18",
        "filename": "src/script/interpreter.h",
        "status": "modified",
        "additions": 7,
        "deletions": 0,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1887155ef22d27439307439b8c067f65d86fb463/src/script/interpreter.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1887155ef22d27439307439b8c067f65d86fb463/src/script/interpreter.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/script/interpreter.h?ref=1887155ef22d27439307439b8c067f65d86fb463",
        "patch": "@@ -196,6 +196,13 @@ class ScriptExecution {\n     const BaseSignatureChecker& checker;\n     SigVersion sigversion;\n \n+    CScript::const_iterator pc;\n+    CScript::const_iterator pbegincodehash;\n+\n+    std::vector<bool> vfExec;\n+    StackType altstack;\n+    int nOpCount;\n+\n     ScriptExecution(StackType& stack, const CScript&, unsigned int flags, const BaseSignatureChecker&, SigVersion);\n \n     bool Eval(ScriptError* error = nullptr);"
      }
    ]
  }
]