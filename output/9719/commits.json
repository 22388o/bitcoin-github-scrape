[
  {
    "sha": "8eab85cf672b8ea2fb5f721aff71de9aec15a43b",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4ZWFiODVjZjY3MmI4ZWEyZmI1ZjcyMWFmZjcxZGU5YWVjMTVhNDNi",
    "commit": {
      "author": {
        "name": "R E Broadley",
        "email": "rebroad+github@gmail.com",
        "date": "2017-02-01T07:45:17Z"
      },
      "committer": {
        "name": "R E Broadley",
        "email": "rebroad+github@gmail.com",
        "date": "2017-02-07T08:00:45Z"
      },
      "message": "Allow abortion of ConnectBlock() when shutdown requested.",
      "tree": {
        "sha": "751d5c53297425d498853037b2c3864ab5dbfcfd",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/751d5c53297425d498853037b2c3864ab5dbfcfd"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8eab85cf672b8ea2fb5f721aff71de9aec15a43b",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "expired_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQIcBAABAgAGBQJYmX6tAAoJEJYWlWnKgEH5bZkP/04HPM7+b3x+7GjqLed/lNei\nGPt4vPkL1BEpK/Nmy9mpdd5s7m2Kw5/cmdEga1rbAeV39PYh0Q/K4qtDJDqL+ebt\nVj9yhLfNcH+p3bHJIS9RYf9uidSmYWzHZ4uGzxw1SUf2e8XZtsQyEYEG92+mPate\noTLcLCXEfk0/FeC/7LYlBX9c/TH/nOkM4O06eahgRTtHw0rsed2Gegx7F0DPGglY\nqBuz5acbyJY4rbmSNb9/kQ2F/SLf+gEt+F0m2Zo8I3VmFqQ9dwH3qRlJi26UNOiA\nQudvcYvEieFcQz9XXqdhJtBsilOyUDXHwSbwSmiX9sEAxC38tnJmP/v6Qw8AyTDh\n0HTmeT/+okUwDHPLqDk4dS+XPWjRltfpBUAGsv/gKcbenfHhR3rEgUT277jtUbZO\nN+EwrN4tQ2SkBYNA2zpuNbrbv15HA5pHXOTYlI1+zNUp+N3rWh1ZsvyNrBu3yrfQ\nzNbCNPnJEvon4ZYDOcOCnKdgbOSDUnqbtAgQE59vTnIE25sMPnZDDzsl+SnGuA/Z\nDFrvv6Pd4MPF21r21KArCBxXsq+/Hc3/OJtmvUrZ0FGoY+ViI7Bok3920Y1NIY3o\nDTnkVchj7zNzCav7AoYhni0OVUuVrlduu60Hyn1qp6R2SbFRav/I3wbMOLrzd+yH\nLUAp9KhsGi1rplfscIBJ\n=LDug\n-----END PGP SIGNATURE-----",
        "payload": "tree 751d5c53297425d498853037b2c3864ab5dbfcfd\nparent 1c2edd9f6707d16c03ecfba094b1cfec2ddc4dce\nauthor R E Broadley <rebroad+github@gmail.com> 1485935117 +0800\ncommitter R E Broadley <rebroad+github@gmail.com> 1486454445 +0800\n\nAllow abortion of ConnectBlock() when shutdown requested.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8eab85cf672b8ea2fb5f721aff71de9aec15a43b",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/8eab85cf672b8ea2fb5f721aff71de9aec15a43b",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8eab85cf672b8ea2fb5f721aff71de9aec15a43b/comments",
    "author": {
      "login": "rebroad",
      "id": 1530283,
      "node_id": "MDQ6VXNlcjE1MzAyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rebroad",
      "html_url": "https://github.com/rebroad",
      "followers_url": "https://api.github.com/users/rebroad/followers",
      "following_url": "https://api.github.com/users/rebroad/following{/other_user}",
      "gists_url": "https://api.github.com/users/rebroad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
      "organizations_url": "https://api.github.com/users/rebroad/orgs",
      "repos_url": "https://api.github.com/users/rebroad/repos",
      "events_url": "https://api.github.com/users/rebroad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rebroad/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "rebroad",
      "id": 1530283,
      "node_id": "MDQ6VXNlcjE1MzAyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rebroad",
      "html_url": "https://github.com/rebroad",
      "followers_url": "https://api.github.com/users/rebroad/followers",
      "following_url": "https://api.github.com/users/rebroad/following{/other_user}",
      "gists_url": "https://api.github.com/users/rebroad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
      "organizations_url": "https://api.github.com/users/rebroad/orgs",
      "repos_url": "https://api.github.com/users/rebroad/repos",
      "events_url": "https://api.github.com/users/rebroad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rebroad/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "1c2edd9f6707d16c03ecfba094b1cfec2ddc4dce",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1c2edd9f6707d16c03ecfba094b1cfec2ddc4dce",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/1c2edd9f6707d16c03ecfba094b1cfec2ddc4dce"
      }
    ],
    "stats": {
      "total": 8,
      "additions": 7,
      "deletions": 1
    },
    "files": [
      {
        "sha": "e3288b7a7def87d4f2f5f0d41426c2b324659af0",
        "filename": "src/validation.cpp",
        "status": "modified",
        "additions": 7,
        "deletions": 1,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/8eab85cf672b8ea2fb5f721aff71de9aec15a43b/src/validation.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/8eab85cf672b8ea2fb5f721aff71de9aec15a43b/src/validation.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/validation.cpp?ref=8eab85cf672b8ea2fb5f721aff71de9aec15a43b",
        "patch": "@@ -1870,6 +1870,10 @@ bool ConnectBlock(const CBlock& block, CValidationState& state, CBlockIndex* pin\n     txdata.reserve(block.vtx.size()); // Required so that pointers to individual PrecomputedTransactionData don't get invalidated\n     for (unsigned int i = 0; i < block.vtx.size(); i++)\n     {\n+        if (ShutdownRequested()) {\n+            LogPrint(\"block\", \"%s: Shutdown requested. Aborting at %d%%.\\n\", __func__, i * 100 / block.vtx.size());\n+            return false;\n+        }\n         const CTransaction &tx = *(block.vtx[i]);\n \n         nInputs += tx.vin.size();\n@@ -2269,7 +2273,9 @@ bool static ConnectTip(CValidationState& state, const CChainParams& chainparams,\n         if (!rv) {\n             if (state.IsInvalid())\n                 InvalidBlockFound(pindexNew, state);\n-            return error(\"ConnectTip(): ConnectBlock %s failed\", pindexNew->GetBlockHash().ToString());\n+            if (!ShutdownRequested())\n+                error(\"ConnectTip(): ConnectBlock %s failed.\", pindexNew->GetBlockHash().ToString());\n+            return false;\n         }\n         nTime3 = GetTimeMicros(); nTimeConnectTotal += nTime3 - nTime2;\n         LogPrint(\"bench\", \"  - Connect total: %.2fms [%.2fs]\\n\", (nTime3 - nTime2) * 0.001, nTimeConnectTotal * 0.000001);"
      }
    ]
  }
]