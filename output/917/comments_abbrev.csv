sipa,2012-03-05T22:45:04Z,Will this compile on windows/OSX/...?\n,https://github.com/bitcoin/bitcoin/pull/917#issuecomment-4333739,4333739,
mndrix,2012-03-05T23:18:15Z,"It does compile on OS X.  I don't have a Windows build machine, but [Microsoft documentation suggests](http://technet.microsoft.com/en-us/library/bb463209.aspx) that they support the necessary APIs.\n",https://github.com/bitcoin/bitcoin/pull/917#issuecomment-4334336,4334336,
luke-jr,2012-03-14T05:08:27Z,"""Microsoft Windows Services for UNIX"" != Windows. flockfile is not available on Windows (or at least not for MingW), and compiling it in next-test fails...\n",https://github.com/bitcoin/bitcoin/pull/917#issuecomment-4492403,4492403,
mndrix,2012-03-14T14:54:42Z,"I'll update the pull request to only activate `flockfile` and `funlockfile` when `#ifndef WIN32`.  We already do that for signal handlers.\n\nOne could also try using `CreateMutex` and `WaitForSingleObject` to support similar locking semantics on Windows.  I don't have a Windows development machine, so I'd be coding blind trying to implement that approach.\n",https://github.com/bitcoin/bitcoin/pull/917#issuecomment-4499630,4499630,
luke-jr,2012-03-14T15:03:06Z,"""Nobody"" has a Windows development machine. Windows builds are produced with gitian on Ubuntu.\n",https://github.com/bitcoin/bitcoin/pull/917#issuecomment-4499813,4499813,
mndrix,2012-03-14T22:30:42Z,I've updated the branch so that it's a noop on Windows\n,https://github.com/bitcoin/bitcoin/pull/917#issuecomment-4509778,4509778,
mndrix,2012-04-13T16:38:40Z,Thanks to ee12c3d60c4bb7b25e06709e92344d2d8b2c581e the problem @luke-jr mentioned is no longer an issue.  I've updated the pull request accordingly.\n,https://github.com/bitcoin/bitcoin/pull/917#issuecomment-5118533,5118533,
luke-jr,2012-04-14T19:48:05Z,ACK. Planning to (user-optionally) merge this in Gentoo for logrotate support.\n,https://github.com/bitcoin/bitcoin/pull/917#issuecomment-5133980,5133980,
laanwj,2012-04-16T07:58:52Z,Looks like a useful feature.\n\nHow does this interact with the log rotation / debug.log size-limiting inside bitcoin itself? I remember seeing some code for that.\n,https://github.com/bitcoin/bitcoin/pull/917#issuecomment-5147444,5147444,
mndrix,2012-04-16T14:36:03Z,"I don't know of any log rotation code inside bitcoin, but this code works well with the size limiting code.  `ShrinkDebugFile()` runs only during startup before debug.log is opened for writing.\n",https://github.com/bitcoin/bitcoin/pull/917#issuecomment-5153522,5153522,
laanwj,2012-04-16T16:03:14Z,"Ok, so that only runs at startup. That's good.\n\nACK\n",https://github.com/bitcoin/bitcoin/pull/917#issuecomment-5155722,5155722,
rebroad,2012-04-17T22:55:45Z,"-1 from me. I think bitcoin should re-examine the bitcoin.conf file upon receiving a HUP. This, AFAIK is the more standard thing to happen on Unix, isn't it?\n",https://github.com/bitcoin/bitcoin/pull/917#issuecomment-5188036,5188036,
laanwj,2012-04-18T05:53:46Z,The one does not exclude the other. And keep your -1/+1 out of here please.\n,https://github.com/bitcoin/bitcoin/pull/917#issuecomment-5192355,5192355,
rebroad,2012-04-18T09:19:19Z,@laanwj You mean rotate the log file and re-parse bitcoin.conf? -0.99999 to that one ;)\n,https://github.com/bitcoin/bitcoin/pull/917#issuecomment-5194750,5194750,
laanwj,2012-04-18T09:33:40Z,Yes. That's what most daemons do AFAIK and is sane. Both reopening the log\nfile and re-reading the config file are no-ops if nothing changed to the\nlog file and configuration file respectively.\n,https://github.com/bitcoin/bitcoin/pull/917#issuecomment-5194960,5194960,
rebroad,2012-04-18T10:10:48Z,"I think it makes more sense to have a config option to specify how many logs files to keep and how often to rotate them. Having the log file rotated every time you want to re-read the config would be not very useful IMHO, as there may be 10000 lines added since the last config change or only 10 lines.\n",https://github.com/bitcoin/bitcoin/pull/917#issuecomment-5195477,5195477,
laanwj,2012-04-18T10:26:57Z,"I see no reason at all to include log rotation into bitcoin itself.\n\nThere are excellent log rotation tools in common use. The only support they\nrequire of the application is reopening the log on a signal (like this pull\nrequest does). These have settings to rotate by size, by time, to\nautocompress old files, and so on.\n",https://github.com/bitcoin/bitcoin/pull/917#issuecomment-5195693,5195693,
rebroad,2012-04-18T11:39:35Z,"@laanwj I'm not aware of many people using Windows XP (for example) that use log rotation tools, and even if they did, are the tools able to rotate the logs at exactly midnight so that entries from either side of midnight don't end up in the wrong log file?\n",https://github.com/bitcoin/bitcoin/pull/917#issuecomment-5196589,5196589,
Flowdalic,2012-04-18T14:33:07Z,I would recommend using SIGHUP for config file reloading and SIGUSR1 for logrotation. This is how [most daemons do it](http://stackoverflow.com/a/480499/194894) and how it should be used with [logrotate](https://fedorahosted.org/logrotate/). That's whats needed for the Gentoo ebuild logrotate use flag and I am sure other distributions would benefit from it too. Rotation of log files should not be ,https://github.com/bitcoin/bitcoin/pull/917#issuecomment-5199882,5199882,
mndrix,2012-04-18T15:08:55Z,"All three examples in the [logrotate man page](http://linux.die.net/man/8/logrotate) use SIGHUP.  The default signal for [newsyslog](http://www.freebsd.org/cgi/man.cgi?query=newsyslog.conf&sektion=5) (used on OS X and other BSDs) is SIGHUP.  As best I can tell, that's the closest thing to a standard that exists.\n",https://github.com/bitcoin/bitcoin/pull/917#issuecomment-5200770,5200770,
Flowdalic,2012-04-18T15:25:39Z,"On the other hand, many prominent FOSS uses SIGUSR1:\n- apache \n- mongodb\n- dovecot\n\nAnd my expectation about signals and daemons is that SIGHUP reloads the config file and SIGUSR1 re-opens the log file. Since both actions are not really related to each other, this seems to be a saner approach. And the stackoverflow answer shows that the community thinks so too.\n",https://github.com/bitcoin/bitcoin/pull/917#issuecomment-5201171,5201171,
luke-jr,2012-04-18T15:28:34Z,"All those FOSS you just listed also use USR1 for reloading configs...\n\nBut can we just pick one, any one, or maybe even both, and not spend pages discussing the pros/cons of each?\n",https://github.com/bitcoin/bitcoin/pull/917#issuecomment-5201255,5201255,
davout,2012-04-18T18:25:23Z,IMHO configuration hot-reload isn't very useful... just my two satoshis...\nOn the other hand log file reopening would be really nice to have\n,https://github.com/bitcoin/bitcoin/pull/917#issuecomment-5205273,5205273,
rebroad,2012-04-18T21:17:38Z,"@davout I agree that at present config reload isn't very useful. I'm tempted to suggest that SIGHUP be reserved for that possibly functionality in future though, and going with SIGUSR1 for the logfile rotation, if that's the agreed standard. e.g. how does ""tor"" do things?\n\nI still think it's not unreasonable for bitcoin to offer to do it's own log rotation though - people can still choose to use",https://github.com/bitcoin/bitcoin/pull/917#issuecomment-5209036,5209036,
davout,2012-04-18T21:27:45Z,@rebroad it is unreasonable to reinvent the wheel. if you don't care about log rotation you'll be fine with the log size limit. if you do care you'll use logrotate.\n,https://github.com/bitcoin/bitcoin/pull/917#issuecomment-5209232,5209232,
laanwj,2012-04-19T05:55:30Z,"@rebroad: We want to reduce the complexity of the core, not increase it. Anything that can (sanely) be handled by external utilities, should be. If your platform does not have these utilities, you can port them or switch platform.\n\nNote that log rotation is only useful for servers and services, in which you'd like to keep the old data for auditing purposes. Windows XP users tend to be normal end",https://github.com/bitcoin/bitcoin/pull/917#issuecomment-5215395,5215395,
jgarzik,2012-05-08T23:22:56Z,"1) Reloading config file is very common daemon behavior\n2) Reloading config file is very complex, and far beyond the scope of this pull request\n3) Log rotation is beyond the scope of this pull request.\n4) ACK this pull request, in concept.  See code comments for minor nits.\n\nLet's get this merged.\n",https://github.com/bitcoin/bitcoin/pull/917#issuecomment-5589197,5589197,
jgarzik,2012-05-08T23:27:21Z,"Code review comments:\n\n1) Is freopen(3) guaranteed to always return orig_stream?   It seems unwise to discard the !NULL return value, if not downright incorrect.\n\n2) The ""locking"" is definitely disappointing...  using file locks, which often depend on filesystem-specific behavior, due to lack of CRITICAL_SECTION() is decidedly suboptimal.  I'm certain that boost has a thread locking primitive ",https://github.com/bitcoin/bitcoin/pull/917#issuecomment-5589263,5589263,
laanwj,2012-05-09T05:29:01Z,"I assumed that the point of using file locks is you can block the logger from your log rotation tool, so you don't lose log records during the transition?\n",https://github.com/bitcoin/bitcoin/pull/917#issuecomment-5593084,5593084,
mndrix,2012-05-09T14:46:41Z,"<blockquote>\n1) Is freopen(3) guaranteed to always return orig_stream?\n</blockquote>\n\n\nMy understanding of the documentation on Linux and OS X, leads me to say yes.\n\n<blockquote>\nI'm certain that boost has a thread locking primitive that may be statically initialized, and available immediately at startup\n</blockquote>\n\n\nI've not found such a primitive in the Boost libraries, but may no",https://github.com/bitcoin/bitcoin/pull/917#issuecomment-5601794,5601794,
jgarzik,2012-05-15T14:50:00Z,"1) Agreed, freopen(stream) returns stream.  ACK there.\n\n2) As one would expect, boost::mutex is a proper C++ class, and is available properly initialized (unlocked) as soon as the class is instantiated.  Here is a non-threaded working example: https://gist.github.com/2702335\n",https://github.com/bitcoin/bitcoin/pull/917#issuecomment-5717714,5717714,
mndrix,2012-05-18T17:50:23Z,Rebased and updated to use `boost::mutex`\n,https://github.com/bitcoin/bitcoin/pull/917#issuecomment-5791758,5791758,
jgarzik,2012-05-18T19:38:30Z,"Changes look good, except for one:  you made 'fileout' a global variable, when the existing, more narrowly-scoped 'static' declaration is preferred.\n\nMight consider making that static mutex more narrowly scoped like 'fileout', too.\n",https://github.com/bitcoin/bitcoin/pull/917#issuecomment-5793893,5793893,
mndrix,2012-05-18T22:40:56Z,Good suggestions.  Updated.\n,https://github.com/bitcoin/bitcoin/pull/917#issuecomment-5797258,5797258,
jgarzik,2012-05-18T22:44:50Z,"ACK, looks perfect to me.  Thanks for your patience.\n",https://github.com/bitcoin/bitcoin/pull/917#issuecomment-5797306,5797306,
luke-jr,2012-04-10T16:57:32Z,Won't the std::string temporary from GetDebugLogName() free pszFile before it is used?\n,https://github.com/bitcoin/bitcoin/pull/917#discussion_r666425,666425,src/util.cpp
mndrix,2012-04-10T17:28:23Z,"I don't know.  I've not encountered any problems running with this code. My C++ chops are weak, so I'll gladly do this differently if there's a better way.\n",https://github.com/bitcoin/bitcoin/pull/917#discussion_r666628,666628,src/util.cpp
luke-jr,2012-04-10T17:44:18Z,"This is the equivalent of (in C):\n\n```\nchar *s = malloc(8);\nmemcpy(s, ""testing"", 8);\nfree(s);\nfopen(s, ""a"");\n```\n\nTry this:\n\n```\nstd::string file = GetDebugLogName();\nfileout = fopen(file.c_str(), ""a"");\n```\n",https://github.com/bitcoin/bitcoin/pull/917#discussion_r666733,666733,src/util.cpp
