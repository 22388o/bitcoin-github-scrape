[
  {
    "sha": "fea25712ca54c4715f874cf3d871e84bbfd83352",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmZWEyNTcxMmNhNTRjNDcxNWY4NzRjZjNkODcxZTg0YmJmZDgzMzUy",
    "commit": {
      "author": {
        "name": "Michael Hendricks",
        "email": "michael@ndrix.org",
        "date": "2012-03-02T19:24:38Z"
      },
      "committer": {
        "name": "Michael Hendricks",
        "email": "michael@ndrix.org",
        "date": "2012-05-18T22:19:09Z"
      },
      "message": "Serialize access to debug.log stream\n\nAcquire an exclusive, advisory lock before sending output to debug.log\nand release it when we're done. This should avoid output from multiple\nthreads being interspersed in the log file.\n\nWe can't use CRITICAL_SECTION machinery for this because the debug log\nis written during startup and shutdown when that machinery is not\navailable.\n\n(Thanks to Gavin for pointing out the CRITICAL_SECTION problems based\non his earlier work in this area)",
      "tree": {
        "sha": "71b57a6f144ed0596007d0a89caddc9b1df72b30",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/71b57a6f144ed0596007d0a89caddc9b1df72b30"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fea25712ca54c4715f874cf3d871e84bbfd83352",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fea25712ca54c4715f874cf3d871e84bbfd83352",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fea25712ca54c4715f874cf3d871e84bbfd83352",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fea25712ca54c4715f874cf3d871e84bbfd83352/comments",
    "author": {
      "login": "mndrix",
      "id": 43997,
      "node_id": "MDQ6VXNlcjQzOTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/43997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mndrix",
      "html_url": "https://github.com/mndrix",
      "followers_url": "https://api.github.com/users/mndrix/followers",
      "following_url": "https://api.github.com/users/mndrix/following{/other_user}",
      "gists_url": "https://api.github.com/users/mndrix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mndrix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mndrix/subscriptions",
      "organizations_url": "https://api.github.com/users/mndrix/orgs",
      "repos_url": "https://api.github.com/users/mndrix/repos",
      "events_url": "https://api.github.com/users/mndrix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mndrix/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "mndrix",
      "id": 43997,
      "node_id": "MDQ6VXNlcjQzOTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/43997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mndrix",
      "html_url": "https://github.com/mndrix",
      "followers_url": "https://api.github.com/users/mndrix/followers",
      "following_url": "https://api.github.com/users/mndrix/following{/other_user}",
      "gists_url": "https://api.github.com/users/mndrix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mndrix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mndrix/subscriptions",
      "organizations_url": "https://api.github.com/users/mndrix/orgs",
      "repos_url": "https://api.github.com/users/mndrix/repos",
      "events_url": "https://api.github.com/users/mndrix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mndrix/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "660ff174f299a6dfb28f7725dfbb08f140a5474b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/660ff174f299a6dfb28f7725dfbb08f140a5474b",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/660ff174f299a6dfb28f7725dfbb08f140a5474b"
      }
    ],
    "stats": {
      "total": 3,
      "additions": 3,
      "deletions": 0
    },
    "files": [
      {
        "sha": "d143306aecf083021a55d911746d8e2c941f0994",
        "filename": "src/util.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fea25712ca54c4715f874cf3d871e84bbfd83352/src/util.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fea25712ca54c4715f874cf3d871e84bbfd83352/src/util.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/util.cpp?ref=fea25712ca54c4715f874cf3d871e84bbfd83352",
        "patch": "@@ -25,6 +25,7 @@ namespace boost {\n #include <boost/filesystem.hpp>\n #include <boost/filesystem/fstream.hpp>\n #include <boost/foreach.hpp>\n+#include <boost/thread.hpp>\n #include <openssl/crypto.h>\n #include <openssl/rand.h>\n #include <stdarg.h>\n@@ -209,6 +210,8 @@ inline int OutputDebugStringF(const char* pszFormat, ...)\n         if (fileout)\n         {\n             static bool fStartedNewLine = true;\n+            static boost::mutex mutexDebugLog;\n+            boost::mutex::scoped_lock scoped_lock(mutexDebugLog);\n \n             // Debug print useful for profiling\n             if (fLogTimestamps && fStartedNewLine)"
      }
    ]
  },
  {
    "sha": "9af080c351c40a4f56d37174253d33a9f4ffdb69",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5YWYwODBjMzUxYzQwYTRmNTZkMzcxNzQyNTNkMzNhOWY0ZmZkYjY5",
    "commit": {
      "author": {
        "name": "Michael Hendricks",
        "email": "michael@ndrix.org",
        "date": "2012-03-02T19:31:16Z"
      },
      "committer": {
        "name": "Michael Hendricks",
        "email": "michael@ndrix.org",
        "date": "2012-05-18T22:20:03Z"
      },
      "message": "Reopen debug.log on SIGHUP\n\nThe best log rotation method formerly available was to configure\nlogrotate with the copytruncate option.  As described in the logrotate\ndocumentation, \"there is a very small time slice between copying the\nfile and truncating it, so some logging data might be lost\".\n\nBy sending SIGHUP to the server process, one can now reopen the debug\nlog file without losing any data.",
      "tree": {
        "sha": "b3b9f85c0f7cbca2ca880ba36a5e4bbca8e006d0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b3b9f85c0f7cbca2ca880ba36a5e4bbca8e006d0"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9af080c351c40a4f56d37174253d33a9f4ffdb69",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9af080c351c40a4f56d37174253d33a9f4ffdb69",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/9af080c351c40a4f56d37174253d33a9f4ffdb69",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9af080c351c40a4f56d37174253d33a9f4ffdb69/comments",
    "author": {
      "login": "mndrix",
      "id": 43997,
      "node_id": "MDQ6VXNlcjQzOTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/43997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mndrix",
      "html_url": "https://github.com/mndrix",
      "followers_url": "https://api.github.com/users/mndrix/followers",
      "following_url": "https://api.github.com/users/mndrix/following{/other_user}",
      "gists_url": "https://api.github.com/users/mndrix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mndrix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mndrix/subscriptions",
      "organizations_url": "https://api.github.com/users/mndrix/orgs",
      "repos_url": "https://api.github.com/users/mndrix/repos",
      "events_url": "https://api.github.com/users/mndrix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mndrix/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "mndrix",
      "id": 43997,
      "node_id": "MDQ6VXNlcjQzOTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/43997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mndrix",
      "html_url": "https://github.com/mndrix",
      "followers_url": "https://api.github.com/users/mndrix/followers",
      "following_url": "https://api.github.com/users/mndrix/following{/other_user}",
      "gists_url": "https://api.github.com/users/mndrix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mndrix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mndrix/subscriptions",
      "organizations_url": "https://api.github.com/users/mndrix/orgs",
      "repos_url": "https://api.github.com/users/mndrix/repos",
      "events_url": "https://api.github.com/users/mndrix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mndrix/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "fea25712ca54c4715f874cf3d871e84bbfd83352",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fea25712ca54c4715f874cf3d871e84bbfd83352",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/fea25712ca54c4715f874cf3d871e84bbfd83352"
      }
    ],
    "stats": {
      "total": 22,
      "additions": 21,
      "deletions": 1
    },
    "files": [
      {
        "sha": "726950bdb60bd4325e46bc50fbc716bae3e37ca4",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 11,
        "deletions": 1,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9af080c351c40a4f56d37174253d33a9f4ffdb69/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9af080c351c40a4f56d37174253d33a9f4ffdb69/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=9af080c351c40a4f56d37174253d33a9f4ffdb69",
        "patch": "@@ -80,6 +80,10 @@ void HandleSIGTERM(int)\n     fRequestShutdown = true;\n }\n \n+void HandleSIGHUP(int)\n+{\n+    fReopenDebugLog = true;\n+}\n \n \n \n@@ -285,7 +289,13 @@ bool AppInit2()\n     sa.sa_flags = 0;\n     sigaction(SIGTERM, &sa, NULL);\n     sigaction(SIGINT, &sa, NULL);\n-    sigaction(SIGHUP, &sa, NULL);\n+\n+    // Reopen debug.log on SIGHUP\n+    struct sigaction sa_hup;\n+    sa_hup.sa_handler = HandleSIGHUP;\n+    sigemptyset(&sa_hup.sa_mask);\n+    sa_hup.sa_flags = 0;\n+    sigaction(SIGHUP, &sa_hup, NULL);\n #endif\n \n     fTestNet = GetBoolArg(\"-testnet\");"
      },
      {
        "sha": "e3a49dcbcf27616eed2a4b83fc4ce19902146f20",
        "filename": "src/util.cpp",
        "status": "modified",
        "additions": 9,
        "deletions": 0,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9af080c351c40a4f56d37174253d33a9f4ffdb69/src/util.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9af080c351c40a4f56d37174253d33a9f4ffdb69/src/util.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/util.cpp?ref=9af080c351c40a4f56d37174253d33a9f4ffdb69",
        "patch": "@@ -70,6 +70,7 @@ bool fTestNet = false;\n bool fNoListen = false;\n bool fLogTimestamps = false;\n CMedianFilter<int64> vTimeOffsets(200,0);\n+bool fReopenDebugLog = false;\n \n // Init openssl library multithreading support\n static CCriticalSection** ppmutexOpenSSL;\n@@ -213,6 +214,14 @@ inline int OutputDebugStringF(const char* pszFormat, ...)\n             static boost::mutex mutexDebugLog;\n             boost::mutex::scoped_lock scoped_lock(mutexDebugLog);\n \n+            // reopen the log file, if requested\n+            if (fReopenDebugLog) {\n+                fReopenDebugLog = false;\n+                boost::filesystem::path pathDebug = GetDataDir() / \"debug.log\";\n+                if (freopen(pathDebug.string().c_str(),\"a\",fileout) != NULL)\n+                    setbuf(fileout, NULL); // unbuffered\n+            }\n+\n             // Debug print useful for profiling\n             if (fLogTimestamps && fStartedNewLine)\n                 fprintf(fileout, \"%s \", DateTimeStrFormat(\"%x %H:%M:%S\", GetTime()).c_str());"
      },
      {
        "sha": "edef354443b94e9457096fd596b29c0372e70496",
        "filename": "src/util.h",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9af080c351c40a4f56d37174253d33a9f4ffdb69/src/util.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9af080c351c40a4f56d37174253d33a9f4ffdb69/src/util.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/util.h?ref=9af080c351c40a4f56d37174253d33a9f4ffdb69",
        "patch": "@@ -121,6 +121,7 @@ extern std::string strMiscWarning;\n extern bool fTestNet;\n extern bool fNoListen;\n extern bool fLogTimestamps;\n+extern bool fReopenDebugLog;\n \n void RandAddSeed();\n void RandAddSeedPerfmon();"
      }
    ]
  }
]