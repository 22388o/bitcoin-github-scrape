[
  {
    "sha": "91fc5084a3a9e0ab382e46774dda2c6bf8dc910e",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5MWZjNTA4NGEzYTllMGFiMzgyZTQ2Nzc0ZGRhMmM2YmY4ZGM5MTBl",
    "commit": {
      "author": {
        "name": "Pedro Branco",
        "email": "pedro.branco@uphold.com",
        "date": "2019-01-26T15:05:54Z"
      },
      "committer": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2019-05-20T13:26:40Z"
      },
      "message": "rpc: Control if rescan updates existing transactions on importmulti",
      "tree": {
        "sha": "1b838859c685312b01a8e54ad9b681ca4ca4afb6",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1b838859c685312b01a8e54ad9b681ca4ca4afb6"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/91fc5084a3a9e0ab382e46774dda2c6bf8dc910e",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/91fc5084a3a9e0ab382e46774dda2c6bf8dc910e",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/91fc5084a3a9e0ab382e46774dda2c6bf8dc910e",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/91fc5084a3a9e0ab382e46774dda2c6bf8dc910e/comments",
    "author": {
      "login": "pedrobranco",
      "id": 4319748,
      "node_id": "MDQ6VXNlcjQzMTk3NDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4319748?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pedrobranco",
      "html_url": "https://github.com/pedrobranco",
      "followers_url": "https://api.github.com/users/pedrobranco/followers",
      "following_url": "https://api.github.com/users/pedrobranco/following{/other_user}",
      "gists_url": "https://api.github.com/users/pedrobranco/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pedrobranco/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pedrobranco/subscriptions",
      "organizations_url": "https://api.github.com/users/pedrobranco/orgs",
      "repos_url": "https://api.github.com/users/pedrobranco/repos",
      "events_url": "https://api.github.com/users/pedrobranco/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pedrobranco/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "dfc02dac0f96130ef4f439257ce334ca712ff1ff",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/dfc02dac0f96130ef4f439257ce334ca712ff1ff",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/dfc02dac0f96130ef4f439257ce334ca712ff1ff"
      }
    ],
    "stats": {
      "total": 8,
      "additions": 7,
      "deletions": 1
    },
    "files": [
      {
        "sha": "6def19db2e362fd8db8453f7e1ee608d82ec0539",
        "filename": "src/wallet/rpcdump.cpp",
        "status": "modified",
        "additions": 7,
        "deletions": 1,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/91fc5084a3a9e0ab382e46774dda2c6bf8dc910e/src/wallet/rpcdump.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/91fc5084a3a9e0ab382e46774dda2c6bf8dc910e/src/wallet/rpcdump.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcdump.cpp?ref=91fc5084a3a9e0ab382e46774dda2c6bf8dc910e",
        "patch": "@@ -1401,6 +1401,7 @@ UniValue importmulti(const JSONRPCRequest& mainRequest)\n                     {\"options\", RPCArg::Type::OBJ, RPCArg::Optional::OMITTED_NAMED_ARG, \"\",\n                         {\n                             {\"rescan\", RPCArg::Type::BOOL, /* default */ \"true\", \"Stating if should rescan the blockchain after all imports\"},\n+                            {\"update_existing\", RPCArg::Type::BOOL, /* default */ \"true\", \"Stating if rescan should update and notify existing transactions\"},\n                         },\n                         \"\\\"options\\\"\"},\n                 },\n@@ -1423,13 +1424,18 @@ UniValue importmulti(const JSONRPCRequest& mainRequest)\n \n     //Default options\n     bool fRescan = true;\n+    bool update_existing = true;\n \n     if (!mainRequest.params[1].isNull()) {\n         const UniValue& options = mainRequest.params[1];\n \n         if (options.exists(\"rescan\")) {\n             fRescan = options[\"rescan\"].get_bool();\n         }\n+\n+        if (options.exists(\"update_existing\")) {\n+            update_existing = options[\"update_existing\"].get_bool();\n+        }\n     }\n \n     WalletRescanReserver reserver(pwallet);\n@@ -1482,7 +1488,7 @@ UniValue importmulti(const JSONRPCRequest& mainRequest)\n         }\n     }\n     if (fRescan && fRunScan && requests.size()) {\n-        int64_t scannedTime = pwallet->RescanFromTime(nLowestTimestamp, reserver, true /* update */);\n+        int64_t scannedTime = pwallet->RescanFromTime(nLowestTimestamp, reserver, update_existing);\n         {\n             auto locked_chain = pwallet->chain().lock();\n             LOCK(pwallet->cs_wallet);"
      }
    ]
  },
  {
    "sha": "8ddd05c15c36bf6de89db6a746870d499302aa4f",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4ZGRkMDVjMTVjMzZiZjZkZTg5ZGI2YTc0Njg3MGQ0OTkzMDJhYTRm",
    "commit": {
      "author": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2019-05-19T17:57:31Z"
      },
      "committer": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2019-05-20T13:26:40Z"
      },
      "message": "qa: Test wallet notifications with importmulti",
      "tree": {
        "sha": "de92b45b129d304cd8d885f561ec5c7e46fbcbbd",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/de92b45b129d304cd8d885f561ec5c7e46fbcbbd"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8ddd05c15c36bf6de89db6a746870d499302aa4f",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8ddd05c15c36bf6de89db6a746870d499302aa4f",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/8ddd05c15c36bf6de89db6a746870d499302aa4f",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8ddd05c15c36bf6de89db6a746870d499302aa4f/comments",
    "author": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "91fc5084a3a9e0ab382e46774dda2c6bf8dc910e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/91fc5084a3a9e0ab382e46774dda2c6bf8dc910e",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/91fc5084a3a9e0ab382e46774dda2c6bf8dc910e"
      }
    ],
    "stats": {
      "total": 15,
      "additions": 15,
      "deletions": 0
    },
    "files": [
      {
        "sha": "37bbbbf3f69a64ad1e32225ec85de0bff88f21dc",
        "filename": "test/functional/feature_notifications.py",
        "status": "modified",
        "additions": 15,
        "deletions": 0,
        "changes": 15,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/8ddd05c15c36bf6de89db6a746870d499302aa4f/test/functional/feature_notifications.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/8ddd05c15c36bf6de89db6a746870d499302aa4f/test/functional/feature_notifications.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/feature_notifications.py?ref=8ddd05c15c36bf6de89db6a746870d499302aa4f",
        "patch": "@@ -4,6 +4,7 @@\n # file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \"\"\"Test the -alertnotify, -blocknotify and -walletnotify options.\"\"\"\n import os\n+import shutil\n \n from test_framework.address import ADDRESS_BCRT1_UNSPENDABLE\n from test_framework.test_framework import BitcoinTestFramework\n@@ -32,6 +33,16 @@ def setup_network(self):\n                             \"-walletnotify=echo > {}\".format(os.path.join(self.walletnotify_dir, '%s'))]]\n         super().setup_network()\n \n+    def test_importmulti(self, update_existing, expected_notifications):\n+        shutil.rmtree(self.walletnotify_dir)\n+        os.mkdir(self.walletnotify_dir)\n+\n+        addr = self.nodes[0].getnewaddress()\n+        self.nodes[0].generatetoaddress(1, addr)\n+\n+        self.nodes[1].importmulti([{\"scriptPubKey\": {\"address\": addr}, \"timestamp\": \"now\"}], {\"update_existing\": update_existing})\n+        wait_until(lambda: len(os.listdir(self.walletnotify_dir)) == expected_notifications, timeout=10)\n+\n     def run_test(self):\n         self.log.info(\"test -blocknotify\")\n         block_count = 10\n@@ -66,6 +77,10 @@ def run_test(self):\n             txids_rpc = list(map(lambda t: t['txid'], self.nodes[1].listtransactions(\"*\", block_count)))\n             assert_equal(sorted(txids_rpc), sorted(os.listdir(self.walletnotify_dir)))\n \n+            self.log.info(\"test -walletnotify with importmulti\")\n+            self.test_importmulti(update_existing=True, expected_notifications=block_count+1)\n+            self.test_importmulti(update_existing=False, expected_notifications=1)\n+\n         # TODO: add test for `-alertnotify` large fork notifications\n \n if __name__ == '__main__':"
      }
    ]
  },
  {
    "sha": "f91d18ab40c8bf918f1387d4cfd721fe8d0a001f",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmOTFkMThhYjQwYzhiZjkxOGYxMzg3ZDRjZmQ3MjFmZThkMGEwMDFm",
    "commit": {
      "author": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2019-05-19T20:24:08Z"
      },
      "committer": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2019-05-20T13:26:40Z"
      },
      "message": "doc: Add relase note for updateexisting option on importmulti",
      "tree": {
        "sha": "f1d0d34bba8c55f137e00d1a618575f0075e9e12",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f1d0d34bba8c55f137e00d1a618575f0075e9e12"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f91d18ab40c8bf918f1387d4cfd721fe8d0a001f",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f91d18ab40c8bf918f1387d4cfd721fe8d0a001f",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/f91d18ab40c8bf918f1387d4cfd721fe8d0a001f",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f91d18ab40c8bf918f1387d4cfd721fe8d0a001f/comments",
    "author": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "8ddd05c15c36bf6de89db6a746870d499302aa4f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8ddd05c15c36bf6de89db6a746870d499302aa4f",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/8ddd05c15c36bf6de89db6a746870d499302aa4f"
      }
    ],
    "stats": {
      "total": 5,
      "additions": 5,
      "deletions": 0
    },
    "files": [
      {
        "sha": "65129cce6a99f16e9b3d2befc5b76249f33f8db7",
        "filename": "doc/release-notes-16050.md",
        "status": "added",
        "additions": 5,
        "deletions": 0,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f91d18ab40c8bf918f1387d4cfd721fe8d0a001f/doc/release-notes-16050.md",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f91d18ab40c8bf918f1387d4cfd721fe8d0a001f/doc/release-notes-16050.md",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/doc/release-notes-16050.md?ref=f91d18ab40c8bf918f1387d4cfd721fe8d0a001f",
        "patch": "@@ -0,0 +1,5 @@\n+RPC changes\n+-----------\n+The RPC `importmulti` has a new option `update_existing` to control whether\n+rescan updates existing transactions. When `false`, only new wallet transactions\n+are notified to the `-walletnotify` script."
      }
    ]
  }
]