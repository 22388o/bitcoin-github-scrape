petertodd,2015-11-20T21:45:20Z,"As this is a safety thing, I'm weakly inclined to NACK this based on the likelyhood that AcceptToMempool() will be called with an inappropriate max fee. Basically, you're taking the code that does that and splitting it in half, with one half duplicated.\n\nA better design might be to make a single function in the wallet that does the task of accepting a transaction: verifying sanity checks, then s",https://github.com/bitcoin/bitcoin/pull/7070#issuecomment-158533310,158533310,
jtimon,2015-11-27T16:47:21Z,"utACK modulo nits and unifying with #7084.\n\nMy preferred solution would be to take the absurd fees check to a new function that gets called just before AcceptToMemoryPool (unless they used to call with fRejectAbsurdFee=false). But that duplicates the calculation of the fees and hurts performance, so maybe not everybody likes it.\n",https://github.com/bitcoin/bitcoin/pull/7070#issuecomment-160173553,160173553,
sipa,2015-11-27T16:58:44Z,"@jtimon The reason it's done inside AcceptToMemoryPool in the first place is because elsewhere we don't have access to the input amounts (which are necessary to compute the fee), at least not without significantly duplicating logic.\n",https://github.com/bitcoin/bitcoin/pull/7070#issuecomment-160175385,160175385,
sipa,2015-11-27T16:59:40Z,"Hmm.... what about making ATMP just return the fee, so the caller can check if it's insane?\n",https://github.com/bitcoin/bitcoin/pull/7070#issuecomment-160175577,160175577,
jtimon,2015-11-27T17:22:38Z,"Yeah, well duplicating logic is not strictly necessary, but I pointed out the performance hit (from duplicated calculations).\nI like the solution of passing a ref CAmount& nTxFee to AcceptToMemoryPool like in #6445.\nBy the way, that PR is closed because ""was going to interfere with mempool work"" as well...\n",https://github.com/bitcoin/bitcoin/pull/7070#issuecomment-160179168,160179168,
MarcoFalke,2015-11-29T21:41:44Z,I can't see how returning the fee helps here. When ATMP returns the fee it's already too late to abort ATMP adding the tx.\n,https://github.com/bitcoin/bitcoin/pull/7070#issuecomment-160474138,160474138,
MarcoFalke,2015-11-29T21:41:51Z,Closing for now...\n,https://github.com/bitcoin/bitcoin/pull/7070#issuecomment-160474148,160474148,
jtimon,2015-11-29T22:10:10Z,"@MarcoFalke You are right, returning the fee doesn't help at this point because AcceptToMemoryPool() does more than just checking.\nFor what is worth, I like this approach to at least remove one more use of the global ::minRelayTxFee (modulo nits, specially unifying with the other PR).\n",https://github.com/bitcoin/bitcoin/pull/7070#issuecomment-160475601,160475601,
MarcoFalke,2015-11-30T09:56:53Z,@jtimon rebased on #7084.\n\n<sub>Old PR: 73d275f</sub>\n,https://github.com/bitcoin/bitcoin/pull/7070#issuecomment-160581107,160581107,
jtimon,2015-11-30T11:56:59Z,utACK (modulo nits). \n,https://github.com/bitcoin/bitcoin/pull/7070#issuecomment-160609781,160609781,
dcousens,2016-02-02T21:29:50Z,utACK fa79db2\n,https://github.com/bitcoin/bitcoin/pull/7070#issuecomment-178831831,178831831,
dcousens,2015-11-20T16:45:26Z,What does the `10000` represent here OOI?\n,https://github.com/bitcoin/bitcoin/pull/7070#discussion_r45489492,45489492,src/rpcrawtransaction.cpp
petertodd,2015-11-20T21:35:54Z,"This should be a separate constant I think - the min relay tx fee changing doesn't necessarily change what constitutes an ""absurd"" fee. For instance, when we recently upped the min relay fee it was for reasons that shouldn't have impacted the upper bound.\n\nBetter would be for this to be a config file setting, shared across the RPC interface and wallet, with some sane default value that gets adju",https://github.com/bitcoin/bitcoin/pull/7070#discussion_r45521501,45521501,src/rpcrawtransaction.cpp
MarcoFalke,2015-11-21T23:50:11Z,Something like `-maxtxfeerate` ?\n,https://github.com/bitcoin/bitcoin/pull/7070#discussion_r45552647,45552647,src/rpcrawtransaction.cpp
petertodd,2015-11-22T21:21:28Z,"Exactly! Or probably actually a -maxtxfee rather than feerate - if for some reason you need a very large transaction to send some funds, that's equally likely to constitute a bug that should be investigated manually by a human and fixed.\n",https://github.com/bitcoin/bitcoin/pull/7070#discussion_r45564704,45564704,src/rpcrawtransaction.cpp
jtimon,2015-11-27T16:37:46Z,Can't we just get rid of the default value and require the caller to always pass it?\n,https://github.com/bitcoin/bitcoin/pull/7070#discussion_r46060409,46060409,src/wallet/wallet.h
jtimon,2015-11-27T16:39:56Z,"What about DEFAULT_TRANSACTION_MAXFEE from #7084 ?\nIn fact, why not unify both PRs and make both things at once?\n",https://github.com/bitcoin/bitcoin/pull/7070#discussion_r46060512,46060512,src/rpcrawtransaction.cpp
jtimon,2015-11-27T16:50:15Z,"Actually, this is where I dislike the default value the most, I got confused with CWallet's method declaration. In that method I don't even care if fRejectAbsurdFee=true is preserved.\n",https://github.com/bitcoin/bitcoin/pull/7070#discussion_r46061186,46061186,src/main.h
jtimon,2015-11-30T11:52:16Z,Why not default to the constant DEFAULT_TRANSACTION_MAXFEE instead of the global maxTxFee ?\n,https://github.com/bitcoin/bitcoin/pull/7070#discussion_r46134413,46134413,src/wallet/wallet.h
jtimon,2015-11-30T11:52:34Z,Why not default to the constant DEFAULT_TRANSACTION_MAXFEE instead of the global maxTxFee ?\n,https://github.com/bitcoin/bitcoin/pull/7070#discussion_r46134436,46134436,src/rpcrawtransaction.cpp
jtimon,2015-11-30T11:56:27Z,"I wouldn't oppose to just make nAbsurdFee mandatory (instead of defaulting to zero). In any case, we can `const CAmount nAbsurdFee` or `const CAmount& nAbsurdFee`.\n",https://github.com/bitcoin/bitcoin/pull/7070#discussion_r46134714,46134714,src/main.h
MarcoFalke,2015-11-30T12:00:23Z,"A user could set it through `-maxtxfee`, which is preferred?\n",https://github.com/bitcoin/bitcoin/pull/7070#discussion_r46135035,46135035,src/rpcrawtransaction.cpp
MarcoFalke,2015-11-30T12:02:00Z,This would mitigate the effort of #7084 trying to fix the inconsistencies between wallet-high-fee and mempool-absurd-fee.\n,https://github.com/bitcoin/bitcoin/pull/7070#discussion_r46135158,46135158,src/wallet/wallet.h
jtimon,2015-11-30T12:03:36Z,"Well that's something related to the wallet, which this RPC used to be independent from. That's my reasoning, but let's see what others think...\n",https://github.com/bitcoin/bitcoin/pull/7070#discussion_r46135260,46135260,src/rpcrawtransaction.cpp
MarcoFalke,2015-11-30T12:06:31Z,Maybe we could get a third arg to the rpc and make `nMaxRawTxFee = params[2]` and default to `DEFAULT_TRANSACTION_MAXFEE`?\n,https://github.com/bitcoin/bitcoin/pull/7070#discussion_r46135493,46135493,src/rpcrawtransaction.cpp
jtimon,2015-11-30T12:12:09Z,"Yes, maybe even replacing the boolean (although it breaks the old API). instead of override=true, people could use maxfee=0.\n",https://github.com/bitcoin/bitcoin/pull/7070#discussion_r46135958,46135958,src/rpcrawtransaction.cpp
jtimon,2015-11-30T21:21:31Z,"I would prefer not to default to the value of a global, either the constant as default or just making the parameter mandatory do it. Anyway, it's just a nit.\n",https://github.com/bitcoin/bitcoin/pull/7070#discussion_r46205446,46205446,src/wallet/wallet.h
MarcoFalke,2016-02-02T19:14:35Z,@jtimon made it `const` (pass by reference does not make sense for ints).\n\nNot sure about making it mandatory.\n,https://github.com/bitcoin/bitcoin/pull/7070#discussion_r51618865,51618865,src/main.h
laanwj,2016-02-03T11:17:30Z,Any specific reason for making this pass-by-value argument `const`? (also below in AcceptToMemoryPool)\nor did you mean `const CAmount& nAbsurdFee`?\n,https://github.com/bitcoin/bitcoin/pull/7070#discussion_r51708153,51708153,src/main.cpp
laanwj,2016-02-03T11:18:26Z,"Does this header now need the header main?\n(I don't see why, from the changes)\n",https://github.com/bitcoin/bitcoin/pull/7070#discussion_r51708226,51708226,src/wallet/wallet.h
MarcoFalke,2016-02-03T11:35:24Z,I don't think so. `wallet.cpp` already has it. (I think I added it when `AcceptToMemoryPool()` used `maxTxFee` as a default value)\n,https://github.com/bitcoin/bitcoin/pull/7070#discussion_r51709867,51709867,src/wallet/wallet.h
jtimon,2016-02-03T11:39:46Z,Great! Could you try to remove it then? ~~I rmember not being able to do it in the past due to the many functions/methods defined in the .h instead of the .cpp but hopefully that has already changed.~~ I remember removing it and if it's in the .h other files depending on wallet will start to forget about depending on main if they do.\n,https://github.com/bitcoin/bitcoin/pull/7070#discussion_r51710244,51710244,src/wallet/wallet.h
MarcoFalke,2016-02-03T12:05:36Z,I don't have background in cpp but isn't this considered best practice? (Fiddling with `nAbsurdFee` here would give `error: assignment of read-only parameter ‘nAbsurdFee’`).\n\nPass by reference is not mentioned in [/doc/developer-notes.md](/bitcoin/bitcoin/blob/master/doc/developer-notes.md) and I [don't like](http://stackoverflow.com/a/7701247) doing this for basic types but I am happy to change,https://github.com/bitcoin/bitcoin/pull/7070#discussion_r51712342,51712342,src/main.cpp
laanwj,2016-02-03T12:22:55Z,"Having pass-by-value args const is something we don't do anywhere, whereas there are many places where CAmount is passed by reference (as a `git grep` shows me). The idea is that CAmount is not a basic type in some derived code.\n",https://github.com/bitcoin/bitcoin/pull/7070#discussion_r51713733,51713733,src/main.cpp
dcousens,2016-02-03T22:32:32Z,"IMHO extra `const` is never a bad thing.\nIn this case,  if `CAmount` is not considered a basic enough type,  then sure,  `const CAmount&`.\n",https://github.com/bitcoin/bitcoin/pull/7070#discussion_r51798939,51798939,src/main.cpp
jtimon,2016-02-04T00:44:05Z,"FWIW, I didn't know that const-by-value could be ever considered worse than regular by-value either.\n@laanwj can you extend on this or were you just pointing at the fact that you can always turn a const-by-value into a const-by-ref unless you want to avoid the warning you'll get with basic types?\n",https://github.com/bitcoin/bitcoin/pull/7070#discussion_r51813576,51813576,src/main.cpp
laanwj,2016-02-04T08:16:32Z,"@jtimon I never said it was worse, it is just a convention we use nowhere else, whereas `const CAmount& someAmount` is a common convention (according to `git grep`).\n\nThere's no deep reason not to make pass-by-value arguments to a function const. On the other hand, it is _only_ a programmer convention for marking a value as ""Do not change this!"". The compiler will still happily push a copy on th",https://github.com/bitcoin/bitcoin/pull/7070#discussion_r51840827,51840827,src/main.cpp
