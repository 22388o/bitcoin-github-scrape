DrahtBot,2019-07-06 21:19:06,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#10102](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/10102.html) ([experimental] Multiprocess bitcoin by ryan",https://github.com/bitcoin/bitcoin/pull/16349#issuecomment-508954326,508954326,
promag,2019-07-07 22:35:04,Can you explain why it fixes?,https://github.com/bitcoin/bitcoin/pull/16349#issuecomment-509036092,509036092,
fanquake,2019-07-08 01:01:40,"Concept ACK. I've tested that this PR fixes #15453 (running with `-nowallet` on Debian with Qt `5.7.1`). However I haven't yet checked for any regressions.\n\nI agree with promag that more of an explanation (also added to the PR body) would be good. Can you also try improve the commit title.",https://github.com/bitcoin/bitcoin/pull/16349#issuecomment-509046067,509046067,
hebasto,2019-07-08 06:08:37,"@promag \n> Can you explain why it fixes?\n\n@fanquake \n> I agree with **promag** that more of an explanation (also added to the PR body) would be good.\n\nTrying to investigate the #15453 bug I've [downloaded Qt 5.7.1](https://download.qt.io/archive/qt/5.7/5.7.1/), but [failed to build](https://github.com/bitcoin/bitcoin/issues/15453#issuecomment-508939324) the Bitcoin Core. I even failed ",https://github.com/bitcoin/bitcoin/pull/16349#issuecomment-509091639,509091639,
hebasto,2019-07-08 06:09:48,"@fanquake \n>  Can you also try improve the commit title.\n\nWith my pleasure. What title could you suggest?",https://github.com/bitcoin/bitcoin/pull/16349#issuecomment-509091909,509091909,
fanquake,2019-07-08 12:05:22,"> What title could you suggest?\n\nMaybe: `qt: refactor WalletController to fix loading wallets when running with -nowallet`.\n\nThen you could extend the body text to be:\n\n> This establishes a parent-child relation between WalletController and WalletModel objects immediately. This fixes wallet loading on Debian when building against Qt 5.7.x and running with -nowallet.\n",https://github.com/bitcoin/bitcoin/pull/16349#issuecomment-509198025,509198025,
MarcoFalke,2019-07-08 12:37:29,"So this is only an issue with qt5.7.x?\n\nIf so, it could be tested by reverting depends to 2fca6568f27c9a1714b7a415cde947b79c10ed45 locally.",https://github.com/bitcoin/bitcoin/pull/16349#issuecomment-509207832,509207832,
hebasto,2019-07-08 16:49:27,"@promag regarding the [IRC discussion](http://www.erisian.com.au/bitcoin-core-dev/log-2019-07-08.html#l-149):\n\n1. you are definitely right: a `WalletController` instance thread affinity and the current running thread could (and mostly are) different;\n\n2. the _only_ reason of these lines\nhttps://github.com/bitcoin/bitcoin/blob/2679bb8919b5089f8067ccfd94f766747b8df671/src/qt/walletcontroll",https://github.com/bitcoin/bitcoin/pull/16349#issuecomment-509304198,509304198,
hebasto,2019-07-08 17:18:52,"As #15453 is fixed in https://github.com/bitcoin/bitcoin/pull/16348#issuecomment-509308347 I have updated the OP and the commit message.\n\nPlease, label this PR as refactoring.",https://github.com/bitcoin/bitcoin/pull/16349#issuecomment-509315321,509315321,
promag,2019-07-09 08:18:37,This is useful for reviewers: https://code.woboq.org/qt5/qtbase/src/corelib/kernel/qobject.cpp.html#_ZN7QObject12moveToThreadEP7QThread,https://github.com/bitcoin/bitcoin/pull/16349#issuecomment-509541347,509541347,
hebasto,2019-07-09 12:55:12,Rebased on top of #16348.,https://github.com/bitcoin/bitcoin/pull/16349#issuecomment-509630446,509630446,
hebasto,2019-07-09 12:58:21,@ryanofsky Would you mind reviewing this PR?,https://github.com/bitcoin/bitcoin/pull/16349#issuecomment-509631505,509631505,
promag,2019-07-09 13:29:33,s/signal/slot in PR title and commit message?,https://github.com/bitcoin/bitcoin/pull/16349#issuecomment-509642578,509642578,
hebasto,2019-07-09 13:33:05,"@promag \n> s/signal/slot in PR title and commit message?\n\nSure ;) Thank you.\nDone.\n",https://github.com/bitcoin/bitcoin/pull/16349#issuecomment-509643930,509643930,
promag,2019-07-09 13:57:13,ACK 6285a318d77dbfdf50f893963ebfb2973746f757.,https://github.com/bitcoin/bitcoin/pull/16349#issuecomment-509653291,509653291,
promag,2019-07-09 16:36:17,"> It would be better if wallet notifications just emitted signals that got handled asynchronously in the GUI. \n\n@ryanofsky IIRC I had some problems with this because of `std::unique_ptr<interfaces::Wallet>`, it was easier to instantiate the `WalletModel` and then send to the GUI thread by invoking `addWallet`.\n\nFrom https://github.com/bitcoin/bitcoin/pull/16349#discussion_r301654534\n\n>",https://github.com/bitcoin/bitcoin/pull/16349#issuecomment-509715981,509715981,
jonasschnelli,2019-08-12 12:15:26,utACK 6285a318d77dbfdf50f893963ebfb2973746f757,https://github.com/bitcoin/bitcoin/pull/16349#issuecomment-520400456,520400456,
promag,2019-07-09 13:05:58,Could keep this comment.,https://github.com/bitcoin/bitcoin/pull/16349#discussion_r301574549,301574549,src/qt/walletcontroller.cpp
promag,2019-07-09 13:08:45,"Just to be clear, this would work even without `qRegisterMetaType<WalletModel*>()` added in #16348?",https://github.com/bitcoin/bitcoin/pull/16349#discussion_r301575906,301575906,src/qt/walletcontroller.cpp
hebasto,2019-07-09 13:19:28,Yes.,https://github.com/bitcoin/bitcoin/pull/16349#discussion_r301580912,301580912,src/qt/walletcontroller.cpp
hebasto,2019-07-09 13:27:37,Done.,https://github.com/bitcoin/bitcoin/pull/16349#discussion_r301585287,301585287,src/qt/walletcontroller.cpp
ryanofsky,2019-07-09 14:55:21,"This comment is very vague. In particular it's not clear what ""handler callback runs in a different thread"" is referring to. If I'm understanding this correctly, I think a comment that specifically says which threads the object is being moved to and from would be more helpful:\n\n```c++\n// Move WalletModel object to the thread that created the WalletController\n// object (GUI main thread), in",https://github.com/bitcoin/bitcoin/pull/16349#discussion_r301632632,301632632,src/qt/walletcontroller.cpp
ryanofsky,2019-07-09 15:16:47,"Curious: Is this `setParent` call actually necessary for anything? Maybe consider dropping it or adding a comment that says why it's useful.\n\nIf you will keep this line, it'd also be helpful to have a comment explaining why we are passing `parent=nullptr` to the constructor above, and then changing the parent later. I am guessing from https://doc.qt.io/qt-5/qobject.html#thread-affinity, that i",https://github.com/bitcoin/bitcoin/pull/16349#discussion_r301644943,301644943,src/qt/walletcontroller.cpp
ryanofsky,2019-07-09 15:32:26,It seems like this comment is obsolete and should be dropped.,https://github.com/bitcoin/bitcoin/pull/16349#discussion_r301653309,301653309,src/qt/walletcontroller.cpp
ryanofsky,2019-07-09 15:34:41,"It seems good to get rid of this, but I can't figure out why it was ever necessary to call addWallet here with invokeMethod instead of directly.",https://github.com/bitcoin/bitcoin/pull/16349#discussion_r301654534,301654534,src/qt/walletcontroller.cpp
promag,2019-07-09 16:25:40,"Exactly, can't set parent on constructor because parent thread can be different.\n\n`setParent` is not necessary at the moment because (afaict) the wallet is always unloaded here:\nhttps://github.com/bitcoin/bitcoin/blob/8046a3e0befeea641b6309bc0c742b7481e681d9/src/qt/walletcontroller.cpp#L104\n\nHowever I think it's good habit to set ownership, so at least the following would release all mod",https://github.com/bitcoin/bitcoin/pull/16349#discussion_r301679192,301679192,src/qt/walletcontroller.cpp
hebasto,2019-07-13 17:33:40,PR description has been updated.,https://github.com/bitcoin/bitcoin/pull/16349#discussion_r303212806,303212806,src/qt/walletcontroller.cpp
hebasto,2019-07-13 17:36:39,"Agree, but I'd leave it to preserve ACKs.",https://github.com/bitcoin/bitcoin/pull/16349#discussion_r303212903,303212903,src/qt/walletcontroller.cpp
hebasto,2019-07-13 17:40:15,"> This comment is very vague.\n\nAgree, but I'd leave it to preserve ACKs.",https://github.com/bitcoin/bitcoin/pull/16349#discussion_r303213007,303213007,src/qt/walletcontroller.cpp
