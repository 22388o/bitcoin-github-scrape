dooglus,2018-02-21T16:52:01Z,"It's 1000 bytes.\n\nBut I don't think there's any logic about ""transactions larger than 1 kilobyte"". It's a simple BTC-per-1000-bytes calculation, as follows:\n\nThe value in the field is used to construct a CFeeRate object:\n\n    ctrl.m_feerate = CFeeRate(ui->customFee->value());\n\nThe constructor sets nSatoshisPerK:\n\n    CFeeRate(const I _nSatoshisPerK): nSatoshisPerK(_nSatoshisPer",https://github.com/bitcoin/bitcoin/pull/12501#issuecomment-367392680,367392680,
dooglus,2018-02-21T16:57:35Z,"Although, it might make sense to also mention that it's not really per 1000 bytes, but per 4000 weight units. Or in other words per 1000 bytes of virtual transaction size.",https://github.com/bitcoin/bitcoin/pull/12501#issuecomment-367394534,367394534,
randolf,2018-02-21T17:20:18Z,"@dooglus Thanks for the clarification.  I think it's important to mention 1 kilobyte in the tooltip since the field's label mentions ""per kilobyte"" specifically.\n\nMy feeling on ``weight units`` is that since they're not mentioned in the field's label that inclusion in the tooltip would be more likely to introduce confusion for those less-knowledgeable users, and so I'm inclined to think that t",https://github.com/bitcoin/bitcoin/pull/12501#issuecomment-367402219,367402219,
dooglus,2018-02-21T17:39:25Z,"Fair enough, but mention that it's per 1000 bytes of virtual transaction size, not actual transaction size.\n\n    int64_t GetVirtualTransactionSize(int64_t nWeight, int64_t nSigOpCost)\n    {\n        return (std::max(nWeight, nSigOpCost * nBytesPerSigOp) + WITNESS_SCALE_FACTOR - 1) / WITNESS_SCALE_FACTOR;\n    }\n",https://github.com/bitcoin/bitcoin/pull/12501#issuecomment-367408184,367408184,
randolf,2018-02-21T21:35:13Z,"@dooglus Thanks, I like the more condensed sentence you suggested and so I added a new commit to reflect that.  (For a tooltip, simpler is usually better too.)\n\nNote:  It appears that @dooglus' suggestion disappeared since I added the new commit.",https://github.com/bitcoin/bitcoin/pull/12501#issuecomment-367480852,367480852,
MarcoFalke,2018-02-21T22:25:25Z,"utACK, seems like an improvement.\n\nPlease squash your commits according to https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#squashing-commits",https://github.com/bitcoin/bitcoin/pull/12501#issuecomment-367497363,367497363,
randolf,2018-02-22T07:13:52Z,@MarcoFalke The squash/rebase is complete.  Thanks.,https://github.com/bitcoin/bitcoin/pull/12501#issuecomment-367588437,367588437,
Willtech,2018-02-22T10:09:03Z,"The tooltip is not clear. It can be understood that the fee is per every 1000 bytes virtual transaction size to mean a transaction of 1001 bytes virtual transaction size will pay 2x the entered fee, the same as 2000 bytes virtual transaction size.\n\nIt would be better IMHO to say something like `Specify a custom fee per 1,000 bytes of the virtual transaction's size. If the custom fee is set to ",https://github.com/bitcoin/bitcoin/pull/12501#issuecomment-367631812,367631812,
randolf,2018-02-22T15:06:40Z,"@Willtech We did have some wording describing the apportioned amount, but @MarcoFalke explained that this isn't how it works anymore so I removed it (I don't know where his comments disappeared to though as it seems that GitHub is losing parts of the conversation here a few times now).\n\nSo, I'd be happy to put the wording back in, but I would like consensus first on whether there is support fo",https://github.com/bitcoin/bitcoin/pull/12501#issuecomment-367709520,367709520,
dooglus,2018-02-23T02:46:27Z,"It might also be worth noting that if you specify a value that is less than either of the `-mintxfee` or `-minrelaytxfee` values, then the greater of those two values will silently be used instead:\n\n    CAmount GetRequiredFee(unsigned int nTxBytes)\n    {\n        return std::max(CWallet::minTxFee.GetFee(nTxBytes), ::minRelayTxFee.GetFee(nTxBytes));\n    }\n\nI only found this out acciden",https://github.com/bitcoin/bitcoin/pull/12501#issuecomment-367893359,367893359,
dooglus,2018-02-23T02:52:35Z,"> So, I'd be happy to put the wording back in\n\nWe don't need that wording back in - it was talking about how things behave differently if the tx size is less than 1000 bytes, and that's no longer the case.\n\nThe point that maybe needs clarifying is that the feerate of x per 1000 bytes applies on a pro rata basis. If the fee is `x` per 1000 bytes, and the tx is `y` bytes, then the fee is `x*",https://github.com/bitcoin/bitcoin/pull/12501#issuecomment-367894318,367894318,
randolf,2018-02-27T02:16:08Z,"@dooglus I discussed this a few days ago in irc.freenode.net#bitcoin-core-dev and based on that conversation I added some ""Notes"" to this tooltip.  Now the full text reads as follows, and I would like to know if this looks reasonable (this is my current attempt at trying to make it easier to understand):\n\n``Specify a custom fee per kB (1,000 bytes) of the virtual transaction's size.``\n\n``N",https://github.com/bitcoin/bitcoin/pull/12501#issuecomment-368722937,368722937,
Empact,2018-02-27T06:52:42Z,"Nit that ""virtual transaction"" is not currently a concept in the UI, and I don't think it has value for the user. I think in the source code ""virtual transaction"" refers to a transaction that has not been broadcast, which is potentially meaningful if you're distinguishing between transaction states in-flight but adds unnecessary complexity for the user. To be clear, I would drop ""virtual"".",https://github.com/bitcoin/bitcoin/pull/12501#issuecomment-368765938,368765938,
Empact,2018-02-27T06:57:31Z,Also how are translations dealt with? There are ~30 translations of this string that would need to be updated. Maybe it's better to go with a simple removal so that the translation work would be negligible? Note I'm a noob so not knowledgeable on this point.,https://github.com/bitcoin/bitcoin/pull/12501#issuecomment-368766793,368766793,
dooglus,2018-02-27T07:25:06Z,"As said [here](https://github.com/bitcoin/bitcoin/pull/12501#discussion_r170462820) (click 'show outdated'), it should be ""transaction's virtual size"", not ""virtual transaction's size"".",https://github.com/bitcoin/bitcoin/pull/12501#issuecomment-368771961,368771961,
Empact,2018-02-27T10:19:17Z,"Should ""virtual size"" be revealed to the end user? It shows up in the transaction unival but IMO the end-user interface should be higher-level, where distinctions between ""serialized size"" and ""virtual size"" are not relevant.",https://github.com/bitcoin/bitcoin/pull/12501#issuecomment-368820735,368820735,
dooglus,2018-02-27T14:37:32Z,"@Empact How is the user meant to decide how much to pay per virtual byte if they don't know what a virtual byte is? If I ask to pay 1000 satoshis ""per 1000 bytes"", then later see that the transaction's size is reported to be 216 bytes, but I only paid 134 satoshis aren't I going to think that the GUI got it wrong and paid less than I asked it to?\n\nWe should report the serialized and the virtua",https://github.com/bitcoin/bitcoin/pull/12501#issuecomment-368898538,368898538,
randolf,2018-02-27T16:16:09Z,"@dooglus I'm glad that @Empact raised the point about the transaction's virtual size possibly being confusing to end-users.  Your point that it needs to be mentioned seems to make sense, which leads me to ask this question:  Is the GUI showing the transaction's total (non-virtual?) size while instead the code is calculating the ""transaction's virtual size"" behind-the-scenes?",https://github.com/bitcoin/bitcoin/pull/12501#issuecomment-368933616,368933616,
Empact,2018-02-27T21:13:09Z,"IMO the difference between virtual and serialized size is an implementation detail irrelevant to users. Here are a few blockchain explorer transaction views - they include ""size"" and sometimes ""weight"" but never a separate ""virtual size"".\nhttps://blockchain.info/tx/ee72a85ab4ced151bf26d3317c3ec41ace4e523cd2f8764dc089ac94383eae74\nhttps://blockexplorer.com/tx/ee72a85ab4ced151bf26d3317c3ec41ace4e",https://github.com/bitcoin/bitcoin/pull/12501#issuecomment-369027903,369027903,
dooglus,2018-02-27T22:04:12Z,"> Where is virtual size exposed in your experience? The important thing in my experience is having a value that can be compared with mempool viewers for informed fee selection:\nhttps://jochen-hoenicke.de/queue/#1,24h\n\nThat's a good example. All the sizes and rates shown there are virtual sizes, and fee per virtual byte. He doesn't use the word ""virtual"", but talks about how ""sizes include th",https://github.com/bitcoin/bitcoin/pull/12501#issuecomment-369042974,369042974,
Empact,2018-02-27T22:44:16Z,"Great, so if the virtual size is the meaningful value, shared everywhere as the size, why not just refer to it as the size as it's the only relevant size to the user?",https://github.com/bitcoin/bitcoin/pull/12501#issuecomment-369053942,369053942,
dooglus,2018-02-28T03:43:31Z,"@Empact Because the GUI itself already refers to the serialization size as the size.\n\nDouble-click on any transaction and it reports only the serialization size, not the virtual size.\n\nFor example, this is a transaction where I asked to pay 1000 satoshis per 1000 bytes:\n\n> Transaction fee: -0.00000134 BTC\n> [...]\n> Transaction total size: 216 bytes\n\nThe virtual size was 134 byt",https://github.com/bitcoin/bitcoin/pull/12501#issuecomment-369111819,369111819,
randolf,2018-02-28T17:46:18Z,"@dooglus It seems that perhaps you've discovered a bug.  Although this clearly is not a detrimental bug given that the resulting transaction fee is lower than what you expected it to be (which I suspect is unlikely to yield negative complaints), it still should probably be addressed at the very least.\n\nUpdating the tooltip may _not_ the ideal way of going about remedying this discrepancy thoug",https://github.com/bitcoin/bitcoin/pull/12501#issuecomment-369322118,369322118,
randolf,2018-03-01T19:52:38Z,"@dooglus Thanks again for raising this issue.  I just rebased all the commits after reviewing the ""virtual size"" wording in today's Bitcoin Core Developer meeting...\n\nThe consensus seems to be that we're going to ""bite the bullet"" so-to-speak and simply use the wording in the current commit which refers to the ""virtual size"" of transactions.  It was also noted that this is a term that people c",https://github.com/bitcoin/bitcoin/pull/12501#issuecomment-369710399,369710399,
dooglus,2018-03-01T22:08:33Z,"Thanks for letting me know.\n\nI just made a pull request (#12580) to add the virtual size to the details modal.",https://github.com/bitcoin/bitcoin/pull/12501#issuecomment-369748100,369748100,
dooglus,2018-03-05T15:55:37Z,"@MarcoFalke just merged my PR, so the transaction details dialog shows both total size and virtual size.\n\nExample tx spending a SegWit utxo:\n\n![screenshot_2018-03-05_07-51-38](https://user-images.githubusercontent.com/573356/36984689-51d5131c-204a-11e8-9411-d6f80a8a71c5.png)\n\nExample tx spending legacy utxos:\n\n![screenshot_2018-03-05_07-51-12](https://user-images.githubusercontent.",https://github.com/bitcoin/bitcoin/pull/12501#issuecomment-370465273,370465273,
laanwj,2018-03-05T19:03:13Z,"utACK 0bc095efd8dd25770af398cb2b73cd65b3bc9f89, this is a clear improvement, I think it's been bikeshedded enough.",https://github.com/bitcoin/bitcoin/pull/12501#issuecomment-370526729,370526729,
MarcoFalke,2018-02-21T20:45:18Z,There is no longer a distinction between less-than-1kB and other txes. You might as well remove that distinction altogether.,https://github.com/bitcoin/bitcoin/pull/12501#discussion_r169771960,169771960,src/qt/forms/sendcoinsdialog.ui
randolf,2018-02-21T20:54:43Z,"@MarcoFalke Oh, so to clarify, that means that for transactions of 1 kilobyte or less that the fee would still be calculated on a per-kilobyte basis too then, and I should squash it down to the following only?\n\n``For the transaction fee, you can specify the exact number of ""satoshis per kilobyte (1,000 bytes).""``",https://github.com/bitcoin/bitcoin/pull/12501#discussion_r169774381,169774381,src/qt/forms/sendcoinsdialog.ui
MarcoFalke,2018-02-21T21:02:06Z,"Yeah, it is always a fee rate (it just happens to be denominated in BTC/kB, and not satoshis/Byte)",https://github.com/bitcoin/bitcoin/pull/12501#discussion_r169776254,169776254,src/qt/forms/sendcoinsdialog.ui
dooglus,2018-02-21T21:02:27Z,"That's correct. But we already know it's for the transaction fee, and that you're specifying it. You aren't specifying satoshis per kB, you can specify it in BTC, mBTC, or uBTC. So you could just squash it down to ""per kilobyte (1000 bytes)"" - but that's almost what the label itself already says.\n\nI prefer something like:\n\n> Specify a custom fee per 1000 bytes of virtual transaction size.""",https://github.com/bitcoin/bitcoin/pull/12501#discussion_r169776336,169776336,src/qt/forms/sendcoinsdialog.ui
MarcoFalke,2018-02-21T21:02:56Z,So all fee rates (set on the command line or the gui) are denominated in BTC/kB,https://github.com/bitcoin/bitcoin/pull/12501#discussion_r169776468,169776468,src/qt/forms/sendcoinsdialog.ui
dooglus,2018-02-21T21:06:54Z,"The gui allows me to specify the fee rate in BTC/kB, mBTC/kB, and uBTC/kB.\n\nIt's kind of unfortunate that we can't specify it in sat/B, since that seems to be emerging as a standard way to talk about fee rates.",https://github.com/bitcoin/bitcoin/pull/12501#discussion_r169777547,169777547,src/qt/forms/sendcoinsdialog.ui
MarcoFalke,2018-02-21T21:57:35Z,"This is just my opinion, but we shouldn't need to specify that the size is virtual. Either the user knows what virtual means, so they know that all sizes that involve transaction fees are virtual. Or they don't, in which case it just adds confusion.",https://github.com/bitcoin/bitcoin/pull/12501#discussion_r169791106,169791106,src/qt/forms/sendcoinsdialog.ui
dooglus,2018-02-21T22:05:58Z,"I know that there are two sizes: virtual and actual. I didn't know (until reading the source) which of the two this custom setting was specifying. It would have been useful for me if the tooltip had cleared up the ambiguity.\n\nWhen I double-click on a transaction in the transaction list it shows the actual size and not the virtual size. That's the only other place I've seen any mention of trans",https://github.com/bitcoin/bitcoin/pull/12501#discussion_r169793332,169793332,src/qt/forms/sendcoinsdialog.ui
dooglus,2018-02-21T22:07:12Z,"> It appears that @dooglus' suggestion disappeared since I added the new commit.\n\nI didn't remove anything. You may need to click ""view outdated"" since my comment was in response to an old commit.",https://github.com/bitcoin/bitcoin/pull/12501#discussion_r169793599,169793599,src/qt/forms/sendcoinsdialog.ui
MarcoFalke,2018-02-21T22:24:55Z,I think that should probably be changed to virtual size.,https://github.com/bitcoin/bitcoin/pull/12501#discussion_r169797935,169797935,src/qt/forms/sendcoinsdialog.ui
MarcoFalke,2018-02-25T18:54:58Z,"The transaction is not virtual. The size is...?\n\n```\ntransation's virtual size.",https://github.com/bitcoin/bitcoin/pull/12501#discussion_r170462820,170462820,src/qt/forms/sendcoinsdialog.ui
dooglus,2018-02-25T19:59:11Z,"Without the typo:\n\n    Specify a custom fee per 1,000 bytes of the transaction's virtual size.",https://github.com/bitcoin/bitcoin/pull/12501#discussion_r170464981,170464981,src/qt/forms/sendcoinsdialog.ui
luke-jr,2018-02-27T16:20:00Z,"The size is virtual, not the transaction.",https://github.com/bitcoin/bitcoin/pull/12501#discussion_r170979048,170979048,src/qt/forms/sendcoinsdialog.ui
