jnewbery,2019-08-06 18:40:28,"Reported by @kallewoof \n\nping @MarcoFalke and @ariard for review.",https://github.com/bitcoin/bitcoin/pull/16557#issuecomment-518793486,518793486,
promag,2019-08-07 00:40:57,"Related discussion in https://github.com/bitcoin/bitcoin/pull/15713/files#r308801356.\n\nACK 214c4ecb9ab306627a08abb35cf82c73f10ec627.",https://github.com/bitcoin/bitcoin/pull/16557#issuecomment-518894169,518894169,
ariard,2019-08-07 02:45:07,ACK 214c4ec,https://github.com/bitcoin/bitcoin/pull/16557#issuecomment-518917205,518917205,
kallewoof,2019-08-07 08:56:40,"I applied this patch to my node and restarted it.\n\n1. This does not only happen during reorgs, it seems to be happening regularly. I think the node has gotten in its head that it needs to rebroadcast *all* transactions.\n2. This is not only coinbase transactions. After applying the patch I see tons of txs. Picking two at random, both turned out to be regular txs. See e.g. https://explorer.bc-",https://github.com/bitcoin/bitcoin/pull/16557#issuecomment-519007572,519007572,
ariard,2019-08-07 15:21:41,"Did you try to run without #15713 but with `IsCoinBase` and `GetDepthInMainChain` checks turn off ? I guess you should see the same logs than right now. Wallet is always trying to rebroadcast, even with thousands of confirmations, removing checks just make it apparent ?",https://github.com/bitcoin/bitcoin/pull/16557#issuecomment-519145304,519145304,
kallewoof,2019-08-07 15:33:24,"@ariard No. If I am the only one seeing these messages, however, this may be a problem with signet. No clue why signet would cause this, though, tbh.",https://github.com/bitcoin/bitcoin/pull/16557#issuecomment-519150254,519150254,
MarcoFalke,2019-08-07 16:52:17," #15713 also changed the logging, IIRC. So the bug can be fixed by either (or both):\n\n* Fixed logging\n* Restored checks",https://github.com/bitcoin/bitcoin/pull/16557#issuecomment-519180666,519180666,
ariard,2019-08-08 02:56:52,"@kallewoof is not a problem with signet, it's a problem with my PR. I've played a bit with a regtest node on a commit before it. If I generate thousands of coinbase txn, every time we hit `nNextResend` (once in a 30min period), and 5min older than last block we are going to call `RelayWalletTransaction` for every one of them. You can see them in this method if you add a printer before `IsCoinBase`",https://github.com/bitcoin/bitcoin/pull/16557#issuecomment-519343272,519343272,
jnewbery,2019-08-09 15:11:16,"I've restored the `GetDepthInMainChain()` check in `SubmitMemoryPoolAndRelay()`. That meant passing the `locked_chain` through to `SubmitMemoryPoolAndRelay()` (at least until #15931 is merged).\n\nAlso clarified comment in `ResendWalletTransactions()`.",https://github.com/bitcoin/bitcoin/pull/16557#issuecomment-519956222,519956222,
DrahtBot,2019-08-09 15:23:51,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#9381](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/9381.html) (Remove CWalletTx merging logic from AddToWall",https://github.com/bitcoin/bitcoin/pull/16557#issuecomment-519960599,519960599,
MarcoFalke,2019-08-09 16:51:11,"ACK c8b53c3beafa289dcdbd8c2ee9f957bdeca79cbc (non-doc changes are mostly a git revert 8753f5652b4710e66b50ce87788bf6f33619b75a)\n\n<details><summary>Show signature and timestamp</summary>\n\nSignature:\n\n```\n-----BEGIN PGP SIGNED MESSAGE-----\nHash: SHA512\n\nACK c8b53c3beafa289dcdbd8c2ee9f957bdeca79cbc (non-doc changes are mostly a git revert 8753f5652b4710e66b50ce87788bf6f33619b75a)",https://github.com/bitcoin/bitcoin/pull/16557#issuecomment-519988682,519988682,
ariard,2019-08-09 16:57:39,utACK c8b53c3,https://github.com/bitcoin/bitcoin/pull/16557#issuecomment-519990789,519990789,
kallewoof,2019-08-09 23:59:03,"ACK\n\nApplied this to my node.\n\nRan for awhile. No spam. Tried sending a tx. Message appeared as appropriately in log. I don't think I am able to test the `CWallet::ResendWalletTransactions` part easily as it depends on a new block without tx being mined. Did try restarting the node though, and the log message appeared as expected.\n",https://github.com/bitcoin/bitcoin/pull/16557#issuecomment-520098596,520098596,
ariard,2019-08-06 19:39:57,"Sorry for that. You may need also to restore the `GetDepthInMainChain`, if you follow what @kallewoof was saying non-coinbase confirmed txn were also in log spams.",https://github.com/bitcoin/bitcoin/pull/16557#discussion_r311240349,311240349,src/wallet/wallet.cpp
kallewoof,2019-08-07 00:06:55,"~~No, I don't believe non-coinbase confirmed txn were in log spams but there were thousands so I can't easily verify.~~\n\nEdit: With patch it was easily verifiable that non-coinbase txs also appear.",https://github.com/bitcoin/bitcoin/pull/16557#discussion_r311323444,311323444,src/wallet/wallet.cpp
Sjors,2019-08-10 16:53:27,Why not move the coinbase check here then?,https://github.com/bitcoin/bitcoin/pull/16557#discussion_r312709266,312709266,src/wallet/wallet.cpp
jnewbery,2019-08-12 14:42:57,"I agree that would make sense - the other callers of `SubmitMemoryPoolAndRelay()` do checks before calling into `SubmitMemoryPoolAndRelay()`. However, this PR is just to restore previous behaviour. There are a few other PRs in progress on the node/wallet interface, so let's keep the existing behaviour and look for ways to tidy it up later.",https://github.com/bitcoin/bitcoin/pull/16557#discussion_r312961381,312961381,src/wallet/wallet.cpp
