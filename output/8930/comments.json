[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/258247466",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8930#issuecomment-258247466",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8930",
    "id": 258247466,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI1ODI0NzQ2Ng==",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-11-03T19:22:16Z",
    "updated_at": "2016-11-03T19:22:16Z",
    "author_association": "CONTRIBUTOR",
    "body": "Closing for now. Will rebase on #9075 when its merged.\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/258247466/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/261440177",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8930#issuecomment-261440177",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8930",
    "id": 261440177,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2MTQ0MDE3Nw==",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-11-18T03:29:14Z",
    "updated_at": "2016-11-18T03:29:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "Rebased on #9075...this now forms the last pull before main.cpp is split clean in two :).\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/261440177/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/261554103",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8930#issuecomment-261554103",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8930",
    "id": 261554103,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2MTU1NDEwMw==",
    "user": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-11-18T15:08:51Z",
    "updated_at": "2016-11-18T15:08:51Z",
    "author_association": "MEMBER",
    "body": "utACK https://github.com/bitcoin/bitcoin/pull/8930/commits/2dd652afe577a09d6f70db0e79b8f6c0706dd1b4\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/261554103/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/261888265",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8930#issuecomment-261888265",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8930",
    "id": 261888265,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2MTg4ODI2NQ==",
    "user": {
      "login": "rebroad",
      "id": 1530283,
      "node_id": "MDQ6VXNlcjE1MzAyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1530283?u=6a4a31aaddbc438e053c52d084a698a5f622f1ea&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rebroad",
      "html_url": "https://github.com/rebroad",
      "followers_url": "https://api.github.com/users/rebroad/followers",
      "following_url": "https://api.github.com/users/rebroad/following{/other_user}",
      "gists_url": "https://api.github.com/users/rebroad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
      "organizations_url": "https://api.github.com/users/rebroad/orgs",
      "repos_url": "https://api.github.com/users/rebroad/repos",
      "events_url": "https://api.github.com/users/rebroad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rebroad/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-11-21T09:33:50Z",
    "updated_at": "2016-11-21T09:33:50Z",
    "author_association": "CONTRIBUTOR",
    "body": "What is the rationale behind this refactoring please? What future changes is it enabling? Or what is it fixing?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/261888265/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/261927435",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8930#issuecomment-261927435",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8930",
    "id": 261927435,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2MTkyNzQzNQ==",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-11-21T12:45:40Z",
    "updated_at": "2016-11-21T12:45:40Z",
    "author_association": "MEMBER",
    "body": "@rebroad \r\n\r\n> This further decouples \"main\" and \"net\" processing logic by moving\r\n> orphan processing out of the chain-connecting cs_main lock and\r\n> into its own cs_main lock, beside all of the other chain callbacks.\r\n\r\nDecoupling unrelated logic to be able to split up main into validation and network handling parts.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/261927435/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/262253884",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8930#issuecomment-262253884",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8930",
    "id": 262253884,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2MjI1Mzg4NA==",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-11-22T14:26:12Z",
    "updated_at": "2016-11-22T14:26:12Z",
    "author_association": "MEMBER",
    "body": "@TheBlueMatt  One thing we don't currently do, but probably should, is try to reaccept orphan transactions to the mempool if their missing inputs appear in a block.  After this PR, would you suggest we just do that inside `PeerLogicValidation::SyncTransaction()`, or would that be problematic?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/262253884/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/262390333",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8930#issuecomment-262390333",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8930",
    "id": 262390333,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2MjM5MDMzMw==",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?u=7999a16349f0df0fb273fffa18e5a955c9d3f11c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-11-22T22:53:37Z",
    "updated_at": "2016-11-22T22:53:37Z",
    "author_association": "MEMBER",
    "body": "utACK. You could get rid of the BOOST_FOREACH along the way, if you wish.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/262390333/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/262406615",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8930#issuecomment-262406615",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8930",
    "id": 262406615,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2MjQwNjYxNQ==",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-11-23T00:28:00Z",
    "updated_at": "2016-11-23T00:28:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "@sdaftuar that seems reasonable, yea. Not for this PR, though, indeed.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/262406615/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/262408500",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8930#issuecomment-262408500",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8930",
    "id": 262408500,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2MjQwODUwMA==",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-11-23T00:41:26Z",
    "updated_at": "2016-11-23T00:41:26Z",
    "author_association": "MEMBER",
    "body": "utACK",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/262408500/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/262649070",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8930#issuecomment-262649070",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8930",
    "id": 262649070,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2MjY0OTA3MA==",
    "user": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-11-23T22:50:08Z",
    "updated_at": "2016-11-23T22:50:08Z",
    "author_association": "MEMBER",
    "body": "utACK d2b88f97a1235057290f9e8ca0bf11437ba919f8",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/262649070/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85693873",
    "pull_request_review_id": 6394273,
    "id": 85693873,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDg1NjkzODcz",
    "diff_hunk": "@@ -3068,10 +3048,38 @@ bool ActivateBestChain(CValidationState &state, const CChainParams& chainparams,\n         }\n         // When we reach this point, we switched to a new tip (stored in pindexNewTip).\n \n+        // Remove orphan transactions with cs_main\n+        {\n+            LOCK(cs_main);\n+            std::vector<uint256> vOrphanErase;\n+            for(unsigned int i = 0; i < txChanged.size(); i++) {\n+                const CTransaction& tx = std::get<0>(txChanged[i]);\n+                // Which orphan pool entries must we evict?\n+                for (size_t j = 0; j < tx.vin.size(); j++) {\n+                    auto itByPrev = mapOrphanTransactionsByPrev.find(tx.vin[j].prevout);\n+                    if (itByPrev == mapOrphanTransactionsByPrev.end()) continue;\n+                    for (auto mi = itByPrev->second.begin(); mi != itByPrev->second.end(); ++mi) {\n+                        const CTransaction& orphanTx = (*mi)->second.tx;\n+                        const uint256& orphanHash = orphanTx.GetHash();\n+                        vOrphanErase.push_back(orphanHash);\n+                    }\n+                }\n+            }\n+            // Erase orphan transactions include or precluded by this block\n+            if (vOrphanErase.size()) {\n+                int nErased = 0;\n+                BOOST_FOREACH(uint256 &orphanHash, vOrphanErase) {\n+                    nErased += EraseOrphanTx(orphanHash);\n+                }\n+                LogPrint(\"mempool\", \"Erased %d orphan tx included or conflicted by block\\n\", nErased);\n+            }\n+        }\n+\n         // Notifications/callbacks that can run without cs_main\n         if(connman)\n             connman->SetBestHeight(nNewHeight);\n \n+",
    "path": "src/main.cpp",
    "position": null,
    "original_position": 76,
    "commit_id": "d2b88f97a1235057290f9e8ca0bf11437ba919f8",
    "original_commit_id": "b4c3c3bd8984a38718f315803382c924ed8ce987",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Useful.\n",
    "created_at": "2016-10-31T07:29:32Z",
    "updated_at": "2016-11-23T20:29:36Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r85693873",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85693873"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r85693873"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85693873/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 3082,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85693912",
    "pull_request_review_id": 6394312,
    "id": 85693912,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDg1NjkzOTEy",
    "diff_hunk": "@@ -3068,10 +3048,38 @@ bool ActivateBestChain(CValidationState &state, const CChainParams& chainparams,\n         }\n         // When we reach this point, we switched to a new tip (stored in pindexNewTip).\n \n+        // Remove orphan transactions with cs_main\n+        {\n+            LOCK(cs_main);",
    "path": "src/main.cpp",
    "position": null,
    "original_position": 47,
    "commit_id": "d2b88f97a1235057290f9e8ca0bf11437ba919f8",
    "original_commit_id": "b4c3c3bd8984a38718f315803382c924ed8ce987",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I hope we can separate nodestate and other message-processing related variables from cs_main...\n",
    "created_at": "2016-10-31T07:30:12Z",
    "updated_at": "2016-11-23T20:29:36Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r85693912",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85693912"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r85693912"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85693912/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 3053,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85830368",
    "pull_request_review_id": 6523007,
    "id": 85830368,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDg1ODMwMzY4",
    "diff_hunk": "@@ -3068,10 +3048,38 @@ bool ActivateBestChain(CValidationState &state, const CChainParams& chainparams,\n         }\n         // When we reach this point, we switched to a new tip (stored in pindexNewTip).\n \n+        // Remove orphan transactions with cs_main\n+        {\n+            LOCK(cs_main);",
    "path": "src/main.cpp",
    "position": null,
    "original_position": 47,
    "commit_id": "d2b88f97a1235057290f9e8ca0bf11437ba919f8",
    "original_commit_id": "b4c3c3bd8984a38718f315803382c924ed8ce987",
    "user": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "@sipa Absolutely, I'm planning on doing that after the dust settles here, unless @TheBlueMatt already has it queued up. I'm planning on moving lots of what's currently in CNode to CNodeState, so breaking out the locks is a prerequisite for that.\n",
    "created_at": "2016-10-31T20:52:34Z",
    "updated_at": "2016-11-23T20:29:36Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r85830368",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85830368"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r85830368"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85830368/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 3053,
    "side": "RIGHT",
    "in_reply_to_id": 85693912
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85848973",
    "pull_request_review_id": 6540194,
    "id": 85848973,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDg1ODQ4OTcz",
    "diff_hunk": "@@ -3068,10 +3048,38 @@ bool ActivateBestChain(CValidationState &state, const CChainParams& chainparams,\n         }\n         // When we reach this point, we switched to a new tip (stored in pindexNewTip).\n \n+        // Remove orphan transactions with cs_main\n+        {\n+            LOCK(cs_main);",
    "path": "src/main.cpp",
    "position": null,
    "original_position": 47,
    "commit_id": "d2b88f97a1235057290f9e8ca0bf11437ba919f8",
    "original_commit_id": "b4c3c3bd8984a38718f315803382c924ed8ce987",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Dont have it queued up, but, indeed, thats an obvious change after we split main.cpp.\n",
    "created_at": "2016-10-31T22:47:28Z",
    "updated_at": "2016-11-23T20:29:36Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r85848973",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85848973"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r85848973"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85848973/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 3053,
    "side": "RIGHT",
    "in_reply_to_id": 85693912
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89385868",
    "pull_request_review_id": 9931937,
    "id": 89385868,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDg5Mzg1ODY4",
    "diff_hunk": "@@ -4744,6 +4724,30 @@ PeerLogicValidation::PeerLogicValidation(CConnman* connmanIn) : connman(connmanI\n     recentRejects.reset(new CRollingBloomFilter(120000, 0.000001));\n }\n \n+void PeerLogicValidation::SyncTransaction(const CTransaction& tx, const CBlockIndex* pindex, int nPosInBlock) {\n+    LOCK(cs_main);",
    "path": "src/main.cpp",
    "position": null,
    "original_position": 46,
    "commit_id": "d2b88f97a1235057290f9e8ca0bf11437ba919f8",
    "original_commit_id": "2dd652afe577a09d6f70db0e79b8f6c0706dd1b4",
    "user": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Shouldn't this check against CMainSignals::SYNC_TRANSACTION_NOT_IN_BLOCK?",
    "created_at": "2016-11-23T19:35:24Z",
    "updated_at": "2016-11-23T20:29:36Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r89385868",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89385868"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r89385868"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89385868/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4728,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89390068",
    "pull_request_review_id": 9936096,
    "id": 89390068,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDg5MzkwMDY4",
    "diff_hunk": "@@ -4744,6 +4724,30 @@ PeerLogicValidation::PeerLogicValidation(CConnman* connmanIn) : connman(connmanI\n     recentRejects.reset(new CRollingBloomFilter(120000, 0.000001));\n }\n \n+void PeerLogicValidation::SyncTransaction(const CTransaction& tx, const CBlockIndex* pindex, int nPosInBlock) {\n+    LOCK(cs_main);",
    "path": "src/main.cpp",
    "position": null,
    "original_position": 46,
    "commit_id": "d2b88f97a1235057290f9e8ca0bf11437ba919f8",
    "original_commit_id": "2dd652afe577a09d6f70db0e79b8f6c0706dd1b4",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Hmmmmm...good point...for corectness I'll add that check to this PR, but I think we probably actually want to remove it in a future one since I believe it would allow us to clean up orphan cleanup logic in the ::TX message handling logic.",
    "created_at": "2016-11-23T20:01:00Z",
    "updated_at": "2016-11-23T20:29:36Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r89390068",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89390068"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r89390068"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89390068/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4728,
    "side": "RIGHT",
    "in_reply_to_id": 89385868
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89391701",
    "pull_request_review_id": 9937673,
    "id": 89391701,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDg5MzkxNzAx",
    "diff_hunk": "@@ -4744,6 +4724,30 @@ PeerLogicValidation::PeerLogicValidation(CConnman* connmanIn) : connman(connmanI\n     recentRejects.reset(new CRollingBloomFilter(120000, 0.000001));\n }\n \n+void PeerLogicValidation::SyncTransaction(const CTransaction& tx, const CBlockIndex* pindex, int nPosInBlock) {\n+    LOCK(cs_main);",
    "path": "src/main.cpp",
    "position": null,
    "original_position": 46,
    "commit_id": "d2b88f97a1235057290f9e8ca0bf11437ba919f8",
    "original_commit_id": "2dd652afe577a09d6f70db0e79b8f6c0706dd1b4",
    "user": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yep, makes sense. But for now, it can at least be a short-circuit for returning without locking cs_main (not sure if there's any unlocked caller who would benefit, though).",
    "created_at": "2016-11-23T20:11:30Z",
    "updated_at": "2016-11-23T20:29:36Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r89391701",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89391701"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r89391701"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89391701/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4728,
    "side": "RIGHT",
    "in_reply_to_id": 89385868
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89394235",
    "pull_request_review_id": 9940068,
    "id": 89394235,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDg5Mzk0MjM1",
    "diff_hunk": "@@ -4744,6 +4724,30 @@ PeerLogicValidation::PeerLogicValidation(CConnman* connmanIn) : connman(connmanI\n     recentRejects.reset(new CRollingBloomFilter(120000, 0.000001));\n }\n \n+void PeerLogicValidation::SyncTransaction(const CTransaction& tx, const CBlockIndex* pindex, int nPosInBlock) {\n+    LOCK(cs_main);",
    "path": "src/main.cpp",
    "position": null,
    "original_position": 46,
    "commit_id": "d2b88f97a1235057290f9e8ca0bf11437ba919f8",
    "original_commit_id": "2dd652afe577a09d6f70db0e79b8f6c0706dd1b4",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done",
    "created_at": "2016-11-23T20:29:53Z",
    "updated_at": "2016-11-23T20:29:53Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r89394235",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89394235"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r89394235"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89394235/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4728,
    "side": "RIGHT",
    "in_reply_to_id": 89385868
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89827185",
    "pull_request_review_id": 10360626,
    "id": 89827185,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDg5ODI3MTg1",
    "diff_hunk": "@@ -4744,6 +4724,30 @@ PeerLogicValidation::PeerLogicValidation(CConnman* connmanIn) : connman(connmanI\n     recentRejects.reset(new CRollingBloomFilter(120000, 0.000001));\n }\n \n+void PeerLogicValidation::SyncTransaction(const CTransaction& tx, const CBlockIndex* pindex, int nPosInBlock) {\n+    LOCK(cs_main);",
    "path": "src/main.cpp",
    "position": null,
    "original_position": 46,
    "commit_id": "d2b88f97a1235057290f9e8ca0bf11437ba919f8",
    "original_commit_id": "2dd652afe577a09d6f70db0e79b8f6c0706dd1b4",
    "user": {
      "login": "morcos",
      "id": 4360349,
      "node_id": "MDQ6VXNlcjQzNjAzNDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/morcos",
      "html_url": "https://github.com/morcos",
      "followers_url": "https://api.github.com/users/morcos/followers",
      "following_url": "https://api.github.com/users/morcos/following{/other_user}",
      "gists_url": "https://api.github.com/users/morcos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/morcos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
      "organizations_url": "https://api.github.com/users/morcos/orgs",
      "repos_url": "https://api.github.com/users/morcos/repos",
      "events_url": "https://api.github.com/users/morcos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/morcos/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "@TheBlueMatt Your comment confuses me a bit.  Wouldn't this be broken without that check?",
    "created_at": "2016-11-28T16:55:51Z",
    "updated_at": "2016-11-28T16:55:51Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r89827185",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89827185"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r89827185"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89827185/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4728,
    "side": "RIGHT",
    "in_reply_to_id": 89385868
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89854552",
    "pull_request_review_id": 10386347,
    "id": 89854552,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDg5ODU0NTUy",
    "diff_hunk": "@@ -4744,6 +4724,30 @@ PeerLogicValidation::PeerLogicValidation(CConnman* connmanIn) : connman(connmanI\n     recentRejects.reset(new CRollingBloomFilter(120000, 0.000001));\n }\n \n+void PeerLogicValidation::SyncTransaction(const CTransaction& tx, const CBlockIndex* pindex, int nPosInBlock) {\n+    LOCK(cs_main);",
    "path": "src/main.cpp",
    "position": null,
    "original_position": 46,
    "commit_id": "d2b88f97a1235057290f9e8ca0bf11437ba919f8",
    "original_commit_id": "2dd652afe577a09d6f70db0e79b8f6c0706dd1b4",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "@morcos it was a reference to the fact that we might want to remove orphan transactions which conflict with txn which were added to mempool, instead of doing that work in the ::TX message handling. I believe without the check they would step all over each other, but this could be fixed in the future.",
    "created_at": "2016-11-28T19:04:52Z",
    "updated_at": "2016-11-28T19:04:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r89854552",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89854552"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r89854552"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89854552/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4728,
    "side": "RIGHT",
    "in_reply_to_id": 89385868
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89856523",
    "pull_request_review_id": 10388218,
    "id": 89856523,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDg5ODU2NTIz",
    "diff_hunk": "@@ -4744,6 +4724,30 @@ PeerLogicValidation::PeerLogicValidation(CConnman* connmanIn) : connman(connmanI\n     recentRejects.reset(new CRollingBloomFilter(120000, 0.000001));\n }\n \n+void PeerLogicValidation::SyncTransaction(const CTransaction& tx, const CBlockIndex* pindex, int nPosInBlock) {\n+    LOCK(cs_main);",
    "path": "src/main.cpp",
    "position": null,
    "original_position": 46,
    "commit_id": "d2b88f97a1235057290f9e8ca0bf11437ba919f8",
    "original_commit_id": "2dd652afe577a09d6f70db0e79b8f6c0706dd1b4",
    "user": {
      "login": "morcos",
      "id": 4360349,
      "node_id": "MDQ6VXNlcjQzNjAzNDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/morcos",
      "html_url": "https://github.com/morcos",
      "followers_url": "https://api.github.com/users/morcos/followers",
      "following_url": "https://api.github.com/users/morcos/following{/other_user}",
      "gists_url": "https://api.github.com/users/morcos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/morcos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
      "organizations_url": "https://api.github.com/users/morcos/orgs",
      "repos_url": "https://api.github.com/users/morcos/repos",
      "events_url": "https://api.github.com/users/morcos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/morcos/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I agree, nice to move all logic to this function. \r\nBut for now, we don't actually remove orphan txs which conflict with things accepted to mempool.  We could, however, move recursive processing of orphan txs that depended on mempool accepted txs here, I agree.\r\nAlso there are other places SyncTransaction is called, such as for disconnected block txs, where it would be incorrect to remove orphan txs which conflict with txs from disconnected blocks.\r\nIn any case, the code is correct now, I just want to be sure we think about all the ways SyncTransaction is called when we change it in the future.",
    "created_at": "2016-11-28T19:12:22Z",
    "updated_at": "2016-11-28T19:12:22Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r89856523",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89856523"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r89856523"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89856523/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4728,
    "side": "RIGHT",
    "in_reply_to_id": 89385868
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93639603",
    "pull_request_review_id": 14171502,
    "id": 93639603,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDkzNjM5NjAz",
    "diff_hunk": "@@ -4744,6 +4724,34 @@ PeerLogicValidation::PeerLogicValidation(CConnman* connmanIn) : connman(connmanI\n     recentRejects.reset(new CRollingBloomFilter(120000, 0.000001));\n }\n \n+void PeerLogicValidation::SyncTransaction(const CTransaction& tx, const CBlockIndex* pindex, int nPosInBlock) {\n+    if (nPosInBlock == CMainSignals::SYNC_TRANSACTION_NOT_IN_BLOCK)\n+        return;\n+\n+    LOCK(cs_main);\n+\n+    std::vector<uint256> vOrphanErase;\n+    // Which orphan pool entries must we evict?\n+    for (size_t j = 0; j < tx.vin.size(); j++) {\n+        auto itByPrev = mapOrphanTransactionsByPrev.find(tx.vin[j].prevout);\n+        if (itByPrev == mapOrphanTransactionsByPrev.end()) continue;\n+        for (auto mi = itByPrev->second.begin(); mi != itByPrev->second.end(); ++mi) {\n+            const CTransaction& orphanTx = (*mi)->second.tx;\n+            const uint256& orphanHash = orphanTx.GetHash();\n+            vOrphanErase.push_back(orphanHash);",
    "path": "src/main.cpp",
    "position": 59,
    "original_position": 59,
    "commit_id": "d2b88f97a1235057290f9e8ca0bf11437ba919f8",
    "original_commit_id": "d2b88f97a1235057290f9e8ca0bf11437ba919f8",
    "user": {
      "login": "rebroad",
      "id": 1530283,
      "node_id": "MDQ6VXNlcjE1MzAyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rebroad",
      "html_url": "https://github.com/rebroad",
      "followers_url": "https://api.github.com/users/rebroad/followers",
      "following_url": "https://api.github.com/users/rebroad/following{/other_user}",
      "gists_url": "https://api.github.com/users/rebroad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
      "organizations_url": "https://api.github.com/users/rebroad/orgs",
      "repos_url": "https://api.github.com/users/rebroad/repos",
      "events_url": "https://api.github.com/users/rebroad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rebroad/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Why create vOrphanErase at all? Why not simply run the EraseOrphanTx() here instead?",
    "created_at": "2016-12-22T15:13:31Z",
    "updated_at": "2016-12-22T15:13:31Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r93639603",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93639603"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r93639603"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93639603/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 4741,
    "original_line": 4741,
    "side": "RIGHT"
  }
]