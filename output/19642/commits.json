[
  {
    "sha": "7432b1a288da51be8a60ed334eba2c8c2e08f95b",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo3NDMyYjFhMjg4ZGE1MWJlOGE2MGVkMzM0ZWJhMmM4YzJlMDhmOTVi",
    "commit": {
      "author": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2020-08-02T14:25:21Z"
      },
      "committer": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2020-08-02T14:25:21Z"
      },
      "message": "Fix deadlock detection for RecursiveMutex",
      "tree": {
        "sha": "b3717d1447b0c113063cb7e430c1d663d5ae8010",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b3717d1447b0c113063cb7e430c1d663d5ae8010"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7432b1a288da51be8a60ed334eba2c8c2e08f95b",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE0dvyxLlvLev0wWZUQQEIES5+qB8FAl8mzNEACgkQQQEIES5+\nqB89ug//TsBA5S1bBTOZlvsISajYd4e5j83lRRRB/hJXLze97e0xHa3Fdx96+3t9\nFcMWaqlxcwRZtW8kPW5toENVPRJ9iRbuVJMU3gIzPqA0R+6oRekIzjSlUpfp1ysz\nTBxINYnL4Wg9EsDD7Q8ryZQzu8hsYZ10u14rDdKjkBFmYQRfsy9MdScwxBB2vKZj\nsSakuh8q9GEG8L0SwSFrIM9ziBWyimqg6946CP/kjOVZg80Mqxa8Mh4kT/+PZ/6W\nAZnJEkP3MXd36nWrE2EggQMR8U68308OzSyx6Xth/ONd2ApoUv0jrrncFwvsvYgX\nQ690mKRE/Z2l51SsxPNkP4695vtljPRCL7ZQ2UAY0/ZT87qo+334Lq36glOe0ZRN\nqqI3HsMH1DMdMaX51GApUR+otPfc/IEVnAo7Ce8R1RJAhIY+C798mMdHbOjDrNSi\n1aPomAGrn0liSU4VoqvOEMvkTShNVAKKqYYW/DCp+iYDMdn/QnQI25CKJEM4skku\nYOaZV4iGq0cZmO8NMTjTB9MdKAw1svEmFamtCRvCu4Kb1juoJKDc7soilBWiTd5a\nr0GmXsXwFUP5HcQGN0dDbQlohfhqwtzqBQQx8duhcpYqY8BP9o6hVjfV32zhH2kY\nj1kOYupwG0vLG/u9TnujwZoAS6IvmoRmWLXZG+yTnFRalJV1GLA=\n=BLyO\n-----END PGP SIGNATURE-----",
        "payload": "tree b3717d1447b0c113063cb7e430c1d663d5ae8010\nparent a78742830aa35bf57bcb0a4730977a1e5a1876bc\nauthor Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1596378321 +0300\ncommitter Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1596378321 +0300\n\nFix deadlock detection for RecursiveMutex\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7432b1a288da51be8a60ed334eba2c8c2e08f95b",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/7432b1a288da51be8a60ed334eba2c8c2e08f95b",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7432b1a288da51be8a60ed334eba2c8c2e08f95b/comments",
    "author": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "a78742830aa35bf57bcb0a4730977a1e5a1876bc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a78742830aa35bf57bcb0a4730977a1e5a1876bc",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/a78742830aa35bf57bcb0a4730977a1e5a1876bc"
      }
    ],
    "stats": {
      "total": 3,
      "additions": 1,
      "deletions": 2
    },
    "files": [
      {
        "sha": "961e5414ded0343aade0fe65ccaaa918ddb0555f",
        "filename": "src/sync.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 2,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7432b1a288da51be8a60ed334eba2c8c2e08f95b/src/sync.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7432b1a288da51be8a60ed334eba2c8c2e08f95b/src/sync.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/sync.cpp?ref=7432b1a288da51be8a60ed334eba2c8c2e08f95b",
        "patch": "@@ -143,8 +143,7 @@ static void push_lock(void* c, const CLockLocation& locklocation)\n     LockStack& lock_stack = lockdata.m_lock_stacks[std::this_thread::get_id()];\n     lock_stack.emplace_back(c, locklocation);\n     for (const LockStackItem& i : lock_stack) {\n-        if (i.first == c)\n-            break;\n+        if (i.first == c) continue;\n \n         const LockPair p1 = std::make_pair(i.first, c);\n         if (lockdata.lockorders.count(p1))"
      }
    ]
  },
  {
    "sha": "c0d376c474cb13dad9ce4688c917679650b519b6",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpjMGQzNzZjNDc0Y2IxM2RhZDljZTQ2ODhjOTE3Njc5NjUwYjUxOWI2",
    "commit": {
      "author": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2020-08-02T14:26:59Z"
      },
      "committer": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2020-08-02T14:26:59Z"
      },
      "message": "test: Add TestPotentialDeadLockDetectedRecursiveMutex()",
      "tree": {
        "sha": "eb4768b452a7f37172b4d899ada684c691ecedf0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/eb4768b452a7f37172b4d899ada684c691ecedf0"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c0d376c474cb13dad9ce4688c917679650b519b6",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE0dvyxLlvLev0wWZUQQEIES5+qB8FAl8mzTMACgkQQQEIES5+\nqB9CgQ//SAXlTLTSHIGyAZv6hgh3p7os5GlXVZHTmksfSp3T1tCsp2r7klT/q2VX\ni1sVYbIwr5TW2iQZoH0HmkBlG3KfIAEf0CO8V7BHHUHSIOh3RdG6gdwx/yIZuWcU\ncqVGMb5yYckW8qqKqfzY1gPaYEVsfoEBSsoptHUj2O5PLoRGzDyqJpGxTD/uM0FL\n6gBVweLSFvZnx2Q7jZj8O66EFd0HNoKF+FzA2aCxqqQvYUL6zteH+/o0M8ahoiXg\n13zZpP4ICDqeTzuSFqRbm1xmqVPzRjMMF/xie87p073UKIgJ3v0RaAwWdPBgA5kT\nzh54id16UiD8wf3FRZ9qpxF525iKPu+RiNGDsuMtlCfQaZreirzMWdaAOkZiq3C/\n1A94V7GgfDawUdRx6Y85zsc5D1SfAxJOA6Ff5olQz/zjD7gsov1mlzlnZH3Bq1ig\nV3imyAVX2Hs4wDPIpPgV9UoQGiyI4eWKR0O3ZdT+B7/s1Lwgv10I9PUbSupeY0tQ\nIjatCXrS39wi48XhC29dtED5F95W/a9cfsVAo6WhnEBrvrCAjaVH3i4vpnYDDRAn\nZzHNPidUIxAaTA7e0P/BtxZOpa9/ZP60icOo9VF/gvczrg+hQxdJuajal/aXOaOS\n3Fzit1T7CrYqB990r28dELVT9Obp8u4SoI+oPJDieFSEYahupFo=\n=Brru\n-----END PGP SIGNATURE-----",
        "payload": "tree eb4768b452a7f37172b4d899ada684c691ecedf0\nparent 7432b1a288da51be8a60ed334eba2c8c2e08f95b\nauthor Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1596378419 +0300\ncommitter Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1596378419 +0300\n\ntest: Add TestPotentialDeadLockDetectedRecursiveMutex()\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c0d376c474cb13dad9ce4688c917679650b519b6",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/c0d376c474cb13dad9ce4688c917679650b519b6",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c0d376c474cb13dad9ce4688c917679650b519b6/comments",
    "author": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "7432b1a288da51be8a60ed334eba2c8c2e08f95b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7432b1a288da51be8a60ed334eba2c8c2e08f95b",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/7432b1a288da51be8a60ed334eba2c8c2e08f95b"
      }
    ],
    "stats": {
      "total": 27,
      "additions": 27,
      "deletions": 0
    },
    "files": [
      {
        "sha": "891bcb7aaf77ebcf63ed973e710de3613cff2ccd",
        "filename": "src/test/sync_tests.cpp",
        "status": "modified",
        "additions": 27,
        "deletions": 0,
        "changes": 27,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c0d376c474cb13dad9ce4688c917679650b519b6/src/test/sync_tests.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c0d376c474cb13dad9ce4688c917679650b519b6/src/test/sync_tests.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/sync_tests.cpp?ref=c0d376c474cb13dad9ce4688c917679650b519b6",
        "patch": "@@ -27,6 +27,31 @@ void TestPotentialDeadLockDetected(MutexType& mutex1, MutexType& mutex2)\n     BOOST_CHECK(!error_thrown);\n     #endif\n }\n+\n+void TestPotentialDeadLockDetectedRecursiveMutex() NO_THREAD_SAFETY_ANALYSIS\n+{\n+    RecursiveMutex a, b, r;\n+    bool error_thrown{false};\n+\n+    {\n+        LOCK2(r, b);\n+    }\n+    LOCK(a);\n+    LOCK(r);\n+    LOCK(b);\n+    try {\n+        LOCK(r);\n+    } catch (const std::logic_error& e) {\n+        BOOST_CHECK_EQUAL(e.what(), \"potential deadlock detected: r -> b -> r\");\n+        error_thrown = true;\n+    }\n+\n+    #ifdef DEBUG_LOCKORDER\n+    BOOST_CHECK(error_thrown);\n+    #else\n+    BOOST_CHECK(!error_thrown);\n+    #endif // DEBUG_LOCKORDER\n+}\n } // namespace\n \n BOOST_FIXTURE_TEST_SUITE(sync_tests, BasicTestingSetup)\n@@ -44,6 +69,8 @@ BOOST_AUTO_TEST_CASE(potential_deadlock_detected)\n     Mutex mutex1, mutex2;\n     TestPotentialDeadLockDetected(mutex1, mutex2);\n \n+    TestPotentialDeadLockDetectedRecursiveMutex();\n+\n     #ifdef DEBUG_LOCKORDER\n     g_debug_lockorder_abort = prev;\n     #endif"
      }
    ]
  }
]