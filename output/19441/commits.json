[
  {
    "sha": "a66a7a1a7060bb422eba3b8c214852416c4280d1",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzphNjZhN2ExYTcwNjBiYjQyMmViYTNiOGMyMTQ4NTI0MTZjNDI4MGQx",
    "commit": {
      "author": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2020-07-04T01:15:09Z"
      },
      "committer": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2020-07-04T01:15:09Z"
      },
      "message": "walletdb: don't reinitialize desc cache with multiple cache entries\n\nWhen loading descriptor caches, we would accidentally reinitialize the\ndescriptor cache when seeing that one already exists. This should have\nonly been initializing the cache when one does not exist. However this\ncode itself is unnecessary as the act of looking up the cache to add to\nit will initialize it if it didn't already exist.\n\nThis issue could be hit by trying to load a wallet that had imported a\nmultisig descriptor. The wallet would fail to load.\n\nA test has been added to wallet_importdescriptors.py to catch this case.\nAnother test case has also been added to check that loading a wallet\nwith only single key descriptors works.",
      "tree": {
        "sha": "58d1c0fb7f9b7b063fd3cf30b321da4895f329ef",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/58d1c0fb7f9b7b063fd3cf30b321da4895f329ef"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a66a7a1a7060bb422eba3b8c214852416c4280d1",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a66a7a1a7060bb422eba3b8c214852416c4280d1",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/a66a7a1a7060bb422eba3b8c214852416c4280d1",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a66a7a1a7060bb422eba3b8c214852416c4280d1/comments",
    "author": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "3276c148c4cac7b7c9adbaab5997b26488612085",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3276c148c4cac7b7c9adbaab5997b26488612085",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/3276c148c4cac7b7c9adbaab5997b26488612085"
      }
    ],
    "stats": {
      "total": 15,
      "additions": 12,
      "deletions": 3
    },
    "files": [
      {
        "sha": "8685127e1ce6e70e8dc19165fd46c13c57e45f29",
        "filename": "src/wallet/walletdb.cpp",
        "status": "modified",
        "additions": 0,
        "deletions": 3,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/a66a7a1a7060bb422eba3b8c214852416c4280d1/src/wallet/walletdb.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/a66a7a1a7060bb422eba3b8c214852416c4280d1/src/wallet/walletdb.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/walletdb.cpp?ref=a66a7a1a7060bb422eba3b8c214852416c4280d1",
        "patch": "@@ -592,9 +592,6 @@ ReadKeyValue(CWallet* pwallet, CDataStream& ssKey, CDataStream& ssValue,\n             ssValue >> ser_xpub;\n             CExtPubKey xpub;\n             xpub.Decode(ser_xpub.data());\n-            if (wss.m_descriptor_caches.count(desc_id)) {\n-                wss.m_descriptor_caches[desc_id] = DescriptorCache();\n-            }\n             if (parent) {\n                 wss.m_descriptor_caches[desc_id].CacheParentExtPubKey(key_exp_index, xpub);\n             } else {"
      },
      {
        "sha": "2d982edef8d6616b681a9dd4e667ac9c49e98f8c",
        "filename": "test/functional/wallet_importdescriptors.py",
        "status": "modified",
        "additions": 12,
        "deletions": 0,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/a66a7a1a7060bb422eba3b8c214852416c4280d1/test/functional/wallet_importdescriptors.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/a66a7a1a7060bb422eba3b8c214852416c4280d1/test/functional/wallet_importdescriptors.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/wallet_importdescriptors.py?ref=a66a7a1a7060bb422eba3b8c214852416c4280d1",
        "patch": "@@ -141,6 +141,14 @@ def run_test(self):\n                               success=True)\n         assert_equal(w1.getwalletinfo()['keypoolsize'], 0)\n \n+        test_address(w1,\n+                     key.p2sh_p2wpkh_addr,\n+                     ismine=True,\n+                     solvable=True)\n+\n+        # Check persistence of data and that loading works correctly\n+        w1.unloadwallet()\n+        self.nodes[1].loadwallet('w1')\n         test_address(w1,\n                      key.p2sh_p2wpkh_addr,\n                      ismine=True,\n@@ -370,6 +378,10 @@ def run_test(self):\n         self.sync_all()\n         assert_equal(wmulti_pub.getbalance(), wmulti_priv.getbalance())\n \n+        # Make sure that descriptor wallets containing multiple xpubs in a single descriptor load correctly\n+        wmulti_pub.unloadwallet()\n+        self.nodes[1].loadwallet('wmulti_pub')\n+\n         self.log.info(\"Multisig with distributed keys\")\n         self.nodes[1].createwallet(wallet_name=\"wmulti_priv1\", descriptors=True)\n         wmulti_priv1 = self.nodes[1].get_wallet_rpc(\"wmulti_priv1\")"
      }
    ]
  }
]