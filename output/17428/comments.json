[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/552147683",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-552147683",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 552147683,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1MjE0NzY4Mw==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-09T23:42:26Z",
    "updated_at": "2020-10-09T22:35:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19869 (Better intervals between feelers by naumenkogs)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/552147683/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/552184378",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-552184378",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 552184378,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1MjE4NDM3OA==",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-10T11:03:57Z",
    "updated_at": "2019-11-10T11:05:30Z",
    "author_association": "MEMBER",
    "body": "Don't think this should get in the way of implementing something like this, but have to note here, as it's a significant change of behavior from before: reconnecting to peers \"aggressively\", was, up to now, the reserve of spy nodes and mass-connectors and such. For normal nodes the chance of making the same outgoing connection twice was pretty low. Historically this has been one of the ways used to detect these.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/552184378/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/553531390",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-553531390",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 553531390,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1MzUzMTM5MA==",
    "user": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?u=63e5c438c242094837a9deeda775d77988b508bf&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-13T18:11:05Z",
    "updated_at": "2019-11-13T18:11:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "It would be really good to limit it so that an honest node won't attempt to connect twice to the same peer through this mechanism for some prudent amount of time... like two minutes.\r\n\r\nI don't think it would cause any harm to the intent of this mechanism to not bring them up as fast as possible, and it would avoid  tripping up detection of aggressive mass connectors.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/553531390/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554073351",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-554073351",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 554073351,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NDA3MzM1MQ==",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-14T20:49:50Z",
    "updated_at": "2019-11-14T20:49:50Z",
    "author_association": "MEMBER",
    "body": "Not sure if I\u2019m misreading this code (I haven\u2019t tested it), but it looks like on restart we would only  attempt to connect once to each anchor, and then it gets removed from consideration.  Does that satisfy the concern about rapid reconnects?  I guess if a user rapidly restarted their node, we could see rapid connections to the same peers, but that seems pretty weird.\r\n\r\nAnyway I just skimmed the discussion in #17326.  I think Greg or Matt commented that we shouldn\u2019t do this with all our block-relay-only connections, but since we only have 2 at the moment, perhaps it\u2019s fine for now.  And then in the future if we expand to say 8 block-relay peers we might still cap the anchors at 2.  Does that reflect the thinking of others as well?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554073351/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557008273",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-557008273",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 557008273,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NzAwODI3Mw==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-21T09:56:23Z",
    "updated_at": "2019-11-21T09:56:23Z",
    "author_association": "MEMBER",
    "body": "@sdaftuar \r\n\r\nThank you for your review. Your comment has been addressed.\r\n\r\nAlso, an additional safety check added to \"p2p: Integrate ReadAnchors() into CConnman()\" commit in the latest push.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557008273/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/576415049",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-576415049",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 576415049,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3NjQxNTA0OQ==",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-20T20:09:17Z",
    "updated_at": "2020-01-20T20:09:17Z",
    "author_association": "MEMBER",
    "body": "Added 0.20 milestone as this mitigates a security issue so it would be good to have.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/576415049/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/578500393",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-578500393",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 578500393,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3ODUwMDM5Mw==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-26T13:09:55Z",
    "updated_at": "2020-01-26T13:09:55Z",
    "author_association": "MEMBER",
    "body": "@ariard \r\n\r\nThe only idea of this PR is to make a node to try restore outbound block-relay-only connections as they were just before node restart. It is expected that this change in node behavior mitigates restart-based eclipse attacks without significant other tradeoffs.\r\n\r\n> IMO before to go forward we need to agree on a) the scope of anchors: full-relay, block-relay, both...\r\n\r\nAnchoring as a new procedure, or anchors as \"seemingly safe\" nodes are out of the scope of this PR.\r\n\r\n>  b) anchors selection & lifecyle, i.e after how much time do we select them or based on any metrics, do we prune them from anchors.dat, do we keep a bigger file and select randomly from it\r\n\r\nWith an idea _to make a node to try restore outbound block-relay-only connections as they were just before node restart_, anchors are the last known outbound block-relay-only connections only.\r\n\r\nhttps://github.com/bitcoin/bitcoin/pull/17428#discussion_r367081001\r\n> What do you think about waiting some time like 24hours or one block announcement before to qualify node as anchor? That would require at least some good behavior from it, that said and may favor too much well-reliable nodes and decay network-wide connectivity..\r\n\r\nIn this PR anchors are considered as the last known outbound block-relay-only connections, not as \"presumable safe\" ones.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/578500393/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/578535216",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-578535216",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 578535216,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3ODUzNTIxNg==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-26T19:37:10Z",
    "updated_at": "2020-01-26T19:37:10Z",
    "author_association": "MEMBER",
    "body": "Updated d405145e8f935b454ba77e23cf7327515b85151e -> f2b4cfdc75952e61ba98eeffe26b2f86a78a45c9 ([pr17428.02](https://github.com/hebasto/bitcoin/commits/pr17428.02) -> [pr17428.03](https://github.com/hebasto/bitcoin/commits/pr17428.03), [compare](https://github.com/hebasto/bitcoin/compare/pr17428.02..pr17428.03)).\r\n\r\n@ariard @jamesob \r\n\r\nThank you for your reviews. Your comments have been addressed.\r\n\r\n\r\n@jamesob\r\n> ... seeing some strange behavior locally.\r\n\r\nAdded additional logging when connecting to an anchor fails.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/578535216/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/578540792",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-578540792",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 578540792,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3ODU0MDc5Mg==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-26T20:38:50Z",
    "updated_at": "2020-01-26T20:38:50Z",
    "author_association": "MEMBER",
    "body": "Pushed a fixup. Ready for testing and (re)reviewing now.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/578540792/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/579580035",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-579580035",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 579580035,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3OTU4MDAzNQ==",
    "user": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-29T03:53:55Z",
    "updated_at": "2020-01-29T03:53:55Z",
    "author_association": "MEMBER",
    "body": "Couldn't there be a risk here, that if one of the anchor peers is malicious and knows a DoS vulnerability, this ensures they can keep repeatedly crashing your node, even if you setup a watchdog to restart it?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/579580035/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/579938535",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-579938535",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 579938535,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3OTkzODUzNQ==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-29T20:13:06Z",
    "updated_at": "2020-01-29T20:13:06Z",
    "author_association": "MEMBER",
    "body": "Rebased after #16702 has been merged.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/579938535/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/579939131",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-579939131",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 579939131,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3OTkzOTEzMQ==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-29T20:14:43Z",
    "updated_at": "2020-02-06T12:49:41Z",
    "author_association": "MEMBER",
    "body": "@luke-jr \r\n> Couldn't there be a risk here, that if one of the anchor peers is malicious and knows a DoS vulnerability, this ensures they can keep repeatedly crashing your node, even if you setup a watchdog to restart it?\r\n\r\n~Could manual deletion of the `anchors.dat` file be a remedy?~ See: https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-582890916",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/579939131/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/580047275",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-580047275",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 580047275,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4MDA0NzI3NQ==",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-30T01:50:18Z",
    "updated_at": "2020-01-30T01:50:18Z",
    "author_association": "MEMBER",
    "body": "@hebasto \r\n\r\nConcept ACK, reading your comment I do understand that this PR is really-scoped, so don't mind https://github.com/bitcoin/bitcoin/issues/17326#issuecomment-580033087 and https://github.com/bitcoin/bitcoin/pull/17428#discussion_r372715777 but would happily review future work to make anchors better (sorry for the noise)\r\n\r\nA note explaining the exact attack scenario mitigated near to m_anchors or somewhere else would be cool to avoid future reviewers relying on wrong-scoped security assumptions.\r\n\r\nGoign to test PR soon.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/580047275/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/580134777",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-580134777",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 580134777,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4MDEzNDc3Nw==",
    "user": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?u=63e5c438c242094837a9deeda775d77988b508bf&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-30T08:15:41Z",
    "updated_at": "2020-01-30T08:15:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "@luke-jr oy. uh. forget them if you uncleanly exit?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/580134777/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/582624214",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-582624214",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 582624214,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4MjYyNDIxNA==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-02-05T21:36:11Z",
    "updated_at": "2020-02-05T21:36:11Z",
    "author_association": "MEMBER",
    "body": "Rebased after #18023 has been merged.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/582624214/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/582890916",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-582890916",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 582890916,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4Mjg5MDkxNg==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-02-06T12:49:06Z",
    "updated_at": "2020-02-06T12:49:06Z",
    "author_association": "MEMBER",
    "body": "@luke-jr \r\n> Couldn't there be a risk here, that if one of the anchor peers is malicious and knows a DoS vulnerability, this ensures they can keep repeatedly crashing your node, even if you setup a watchdog to restart it?\r\n\r\nIf an exploitable DoS vulnerability would exist, this risk would come true, unfortunately.\r\nAs a DoS attack timing is unpredictable, it seems infeasible to prevent such a risk in the scope of this PR. This might be prevented by means of detecting a particular DoS attack, no?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/582890916/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/582907316",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-582907316",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 582907316,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4MjkwNzMxNg==",
    "user": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following{/other_user}",
      "gists_url": "https://api.github.com/users/luke-jr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-02-06T13:33:05Z",
    "updated_at": "2020-02-06T13:33:59Z",
    "author_association": "MEMBER",
    "body": ">If an exploitable DoS vulnerability would exist, this risk would come true, unfortunately.\r\n\r\nThis is probably among the more common vulnerability types.\r\n\r\n(Let's go with @gmaxwell's suggestion to address it.)",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/582907316/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/583737058",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-583737058",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 583737058,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4MzczNzA1OA==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-02-08T13:34:08Z",
    "updated_at": "2020-02-08T13:34:08Z",
    "author_association": "MEMBER",
    "body": "After a consideration of @luke-jr's concerns and @gmaxwell's suggestion, I'm going to close this PR.\r\n\r\nThe initial idea to mitigate eclipse attacks based on node restarts, included ones initiated by adversary, introduces a [new risk](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-579580035).\r\n\r\n@gmaxwell's [suggestion](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-580134777) nullifies the initial idea by making anchoring usable only for clean (user initiated) restarts. The long-term impact of such changes on the entire p2p network is unclear, and requires further study.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/583737058/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/583742368",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-583742368",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 583742368,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4Mzc0MjM2OA==",
    "user": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?u=63e5c438c242094837a9deeda775d77988b508bf&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-02-08T14:42:02Z",
    "updated_at": "2020-02-08T14:42:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "I think closing this is a mistake.  Not saving state across crashes in no way nullifies the advantage of preserving connections, and it's also a natural implementation-- e.g. the software will fail to write out the latest peers.dat across a crash.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/583742368/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/583743029",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-583743029",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 583743029,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4Mzc0MzAyOQ==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-02-08T14:49:44Z",
    "updated_at": "2020-02-08T14:49:44Z",
    "author_association": "MEMBER",
    "body": "@gmaxwell \r\n> I think closing this is a mistake. Not saving state across crashes in no way nullifies the advantage of preserving connections, and it's also a natural implementation-- e.g. the software will fail to write out the latest peers.dat across a crash.\r\n\r\nReopened. Going to implement your suggestion soon.\r\n\r\nDefinitely, the OP requires an update.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/583743029/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/590535864",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-590535864",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 590535864,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5MDUzNTg2NA==",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?u=06eb9ae4f9b3f954056098860decccbf1340e40f&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-02-24T20:35:07Z",
    "updated_at": "2020-02-24T20:35:07Z",
    "author_association": "MEMBER",
    "body": "Concept ACK. Looking forward to an update to this PR :)",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/590535864/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/590939755",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-590939755",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 590939755,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5MDkzOTc1NQ==",
    "user": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-02-25T15:58:11Z",
    "updated_at": "2020-02-25T15:58:11Z",
    "author_association": "MEMBER",
    "body": "to be clear, the scope of this PR is to attempt to persist connections across *clean* restarts triggered for whatever reason?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/590939755/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/590960921",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-590960921",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 590960921,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5MDk2MDkyMQ==",
    "user": {
      "login": "amitiuttarwar",
      "id": 1500952,
      "node_id": "MDQ6VXNlcjE1MDA5NTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1500952?u=f0ef8142342bcda68fe46c952d3c653456811ed4&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/amitiuttarwar",
      "html_url": "https://github.com/amitiuttarwar",
      "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
      "following_url": "https://api.github.com/users/amitiuttarwar/following{/other_user}",
      "gists_url": "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
      "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
      "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
      "events_url": "https://api.github.com/users/amitiuttarwar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-02-25T16:55:55Z",
    "updated_at": "2020-02-25T16:55:55Z",
    "author_association": "MEMBER",
    "body": "@gmaxwell \r\n> Not saving state across crashes in no way nullifies the advantage of preserving connections\r\n\r\nmy understanding is this PR was intended to mitigate a restart-based eclipse attack. so, if an attacker crashes a victim node, the anchors help reduce the chance of victim being eclipsed. if we change to only persisting connections on clean restarts, we lose the benefit of that scenario. ( I understand the risk of implementing that solution )\r\n\r\nI'm still thinking it through & reading relevant material, but wondering.. what are the advantages you see of having anchors for clean restarts? (vs not having anchors). Is it to mitigate a smaller subset of eclipse attacks that occur with users intentionally restarting their nodes?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/590960921/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/591073367",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-591073367",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 591073367,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5MTA3MzM2Nw==",
    "user": {
      "login": "mzumsande",
      "id": 48763452,
      "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
      "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mzumsande",
      "html_url": "https://github.com/mzumsande",
      "followers_url": "https://api.github.com/users/mzumsande/followers",
      "following_url": "https://api.github.com/users/mzumsande/following{/other_user}",
      "gists_url": "https://api.github.com/users/mzumsande/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
      "organizations_url": "https://api.github.com/users/mzumsande/orgs",
      "repos_url": "https://api.github.com/users/mzumsande/repos",
      "events_url": "https://api.github.com/users/mzumsande/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mzumsande/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-02-25T21:16:43Z",
    "updated_at": "2020-02-25T21:16:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "I was thinking along the same lines as Amiti and would like to understand if the DoS attack possibility mentioned above is serious enough to give up the anchors in a unclean restart, because it seems to be especially desirable to have them in this scenario:\u00a0\r\n1. I think that the suggestion to delete anchor.dat on crashes would just change the big picture in case of a subset of DoS attacks working only on the victim's outbound connections - for more general DoS attacks, the attacker could just as well connect to us after we have restarted (if we allow incoming connections) and attack again.\r\n2. Such a repeated DoS attack would be tough to apply in a targeted way, because the connection is outgoing from the victim, reducing the incentives.\r\n3. If an eclipse attacker somehow manages to control our addrman for an extended time (long enough to wait for our clean restart) it seems to me that we are pretty much screwed anyway: Even if anchors protect us from our restart, the attacker could also choose to wait until one by one, our anchors disconnect from us via clean restarts and are replaced by attacker nodes.\r\n4. On the other hand, an attack on our addrman that would only be effective for a short while and recoverable long-time, combined with a DoS attack that forces us to restart *now* uncleanly, would be a scenario in which having anchors would seem really great.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/591073367/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/591179774",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-591179774",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 591179774,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5MTE3OTc3NA==",
    "user": {
      "login": "ajtowns",
      "id": 127186,
      "node_id": "MDQ6VXNlcjEyNzE4Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajtowns",
      "html_url": "https://github.com/ajtowns",
      "followers_url": "https://api.github.com/users/ajtowns/followers",
      "following_url": "https://api.github.com/users/ajtowns/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajtowns/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
      "organizations_url": "https://api.github.com/users/ajtowns/orgs",
      "repos_url": "https://api.github.com/users/ajtowns/repos",
      "events_url": "https://api.github.com/users/ajtowns/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajtowns/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-02-26T01:03:50Z",
    "updated_at": "2020-02-26T01:03:50Z",
    "author_association": "CONTRIBUTOR",
    "body": "> > Couldn't there be a risk here, that if one of the anchor peers is malicious and knows a DoS vulnerability, this ensures they can keep repeatedly crashing your node, even if you setup a watchdog to restart it?\r\n> \r\n> If an exploitable DoS vulnerability would exist, this risk would come true, unfortunately.\r\n> As a DoS attack timing is unpredictable, it seems infeasible to prevent such a risk in the scope of this PR. This might be prevented by means of detecting a particular DoS attack, no?\r\n\r\nIf there was a known remote crash vulnerability and the behaviour was \"okay, in case of a crash, we don't try anchors\" wouldn't an attacker trying to eclipse a node use that exploit to ensure they can completely eclipse the node?\r\n\r\nIf your node is remote crashable, you want to fix it pretty quickly anyway because that often means you're vulnerable to remote code execution as well; so not sure the fix here is actually better?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/591179774/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/591449881",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-591449881",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 591449881,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5MTQ0OTg4MQ==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-02-26T14:20:56Z",
    "updated_at": "2020-02-26T14:20:56Z",
    "author_association": "MEMBER",
    "body": "An adversary has two distinct ways to force a victim node to restart:\r\n1) online activity that exploits a DoS vulnerability (i.e., a remote-crashable node)\r\n2) _offline_ activity: e.g., power failures, node operator's delusion via social engineering etc.\r\n\r\nThe current PR implementation works well against the latter adversary activity.\r\n\r\nRegarding the former case, I agree with @ajtowns:\r\n> If your node is remote crashable, you want to fix it pretty quickly anyway...\r\n\r\n---\r\n\r\nAlso an adversary could just wait for a user-initiated (clean) restart of a victim node, which includes restart after a node upgrade. In such cases the current PR implementation works well too.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/591449881/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/592138078",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-592138078",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 592138078,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5MjEzODA3OA==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-02-27T19:33:11Z",
    "updated_at": "2020-02-27T19:33:11Z",
    "author_association": "MEMBER",
    "body": "Updated 78b2f950350688f11b544d24ec44816554c67631 -> 780107e41fe86e31392b3ef76b917e623483259f ([pr17428.06](https://github.com/hebasto/bitcoin/commits/pr17428.06) -> [pr17428.07](https://github.com/hebasto/bitcoin/commits/pr17428.07), [compare](https://github.com/hebasto/bitcoin/compare/pr17428.06..pr17428.07)):\r\n\r\n- a new \"anchors.dat\" file is created only during clean shutdown now\r\n\r\nAlso see:\r\n- https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-580134777\r\n- https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-583742368\r\n- https://bitcoincore.reviews/17428.html",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/592138078/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/592144553",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-592144553",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 592144553,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5MjE0NDU1Mw==",
    "user": {
      "login": "amitiuttarwar",
      "id": 1500952,
      "node_id": "MDQ6VXNlcjE1MDA5NTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1500952?u=f0ef8142342bcda68fe46c952d3c653456811ed4&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/amitiuttarwar",
      "html_url": "https://github.com/amitiuttarwar",
      "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
      "following_url": "https://api.github.com/users/amitiuttarwar/following{/other_user}",
      "gists_url": "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
      "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
      "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
      "events_url": "https://api.github.com/users/amitiuttarwar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-02-27T19:47:14Z",
    "updated_at": "2020-02-27T19:47:14Z",
    "author_association": "MEMBER",
    "body": "hm, if my understanding of the code is correct, I think we also need to wipe the `anchors.dat` file on startup to prevent the malicious-anchor-connection-keeps-crashing-your-node issue. \r\n\r\nmy understanding is that currently you only (potentially) remove connections from `anchors.dat` when you next invoke `DumpAnchors()` and replace them. But I might be missing something?\r\n\r\nscenario: one of your outbound blocks-relay-only peers is malicious, but patient. eventually you restart your node for whatever reason. they are persisted to your anchors. when you startup you reconnect to them & they crash your node. and then you're caught in the same loop? ",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/592144553/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/592156578",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-592156578",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 592156578,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5MjE1NjU3OA==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-02-27T20:16:02Z",
    "updated_at": "2020-02-27T20:16:02Z",
    "author_association": "MEMBER",
    "body": "@amitiuttarwar \r\n> hm, if my understanding of the code is correct, I think we also need to wipe the `anchors.dat` file on startup to prevent the malicious-anchor-connection-keeps-crashing-your-node issue.\r\n> \r\n> my understanding is that currently you only (potentially) remove connections from `anchors.dat` when you next invoke `DumpAnchors()` and replace them. But I might be missing something?\r\n> \r\n> scenario: one of your outbound blocks-relay-only peers is malicious, but patient. eventually you restart your node for whatever reason. they are persisted to your anchors. when you startup you reconnect to them & they crash your node. and then you're caught in the same loop?\r\n\r\nIt seems we need to re-write the `anchors.dat` file every time when another anchor is dropped in `m_anchors.pop_back();`, no?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/592156578/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/592596746",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-592596746",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 592596746,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5MjU5Njc0Ng==",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?u=06eb9ae4f9b3f954056098860decccbf1340e40f&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-02-28T16:43:53Z",
    "updated_at": "2020-03-02T18:39:22Z",
    "author_association": "MEMBER",
    "body": ">I am still unconvinced that we shouldn\u2019t persist anchors on crashes. I understand the risk is that a malicious anchor could exploit a DoS vulnerability (which is possibly more likely than executing an eclipse attack) and prevent the victim from being able to sync their node. I feel that if the node is DoS-attackable, it should be fixed immediately regardless. \r\n\r\nI agree with @amitiuttarwar right now. Additionally, it's very difficult to imagine a DoS vulnerability, which is opened only to *outbound blocks-only* connections.\r\nSo, if it is broad DoS issue an attacker will be able to shut down all the reachable nodes, because connecting to them in-bound is free. Much bigger trouble than persistent-anchor attack.\r\nOkay, if it applies to *only outbound* connections, then it's also very easy: an attacker spawns another 2,000 of reachable sybil nodes, and thus has a very high chance of a random node to connect to an attacker as a regular connection (not block-relay-only), and then restarts it. Also bigger trouble than persistent-anchor attack.\r\n\r\nConsidering these observations, I think such a specific risk (specifically block-relay-only outbound links are able to crush a node, and none other can) should not prevent us from getting benefits of anchor-persistence after crashing. (If we are *really worried*, one can try counting restarts ). And those benefits (anti-eclipse) are quite important I think, as this scenario (restart-to-attempt-eclipse) seems much more feasible and dangerous then just restart-node-repetitively.\r\n\r\n>But scoping this PR to focus only on persisting anchors on clean restarts seems reasonable for getting an improvement merged since it is less controversial.\r\n\r\nI would prefer to keep the discussion going. I think we may miss an important improvement here, if we just merge clean-restarts, because the conversation will die.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/592596746/reactions",
      "total_count": 3,
      "+1": 3,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/636335317",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-636335317",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 636335317,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzNjMzNTMxNw==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-30T14:02:57Z",
    "updated_at": "2020-05-30T14:02:57Z",
    "author_association": "MEMBER",
    "body": "From the discussions (#17326, this PR, https://bitcoincore.reviews/17428.html, https://diyhpl.us/wiki/transcripts/la-bitdevs/2020-04-16-amiti-uttarwar-attacking-bitcoin-core/) it follows that the worst case could happen in the following setup:\r\n1. a remote crash vulnerability is known to an adversary\r\n2. that adversary is a block-relay-only anchor peer of the victim node\r\n3. there is a watch-dog script that restarts the victim node in case of its crash\r\n\r\nPlease note that the message set accepted by a node from a block-relay-only peer is a strict subset of messages accepted from a full-relay outgoing connection. Therefore, the mentioned in (1) vulnerability could affect _any_ node, regardless of anchoring. Having a such vulnerability makes other attack vectors, including all types of eclipsing, much less dangerous in comparison.\r\n\r\nThe mentioned in (3) script could be optimized to prevent continuous restarts, e.g. from @naumenkogs' comment:\r\n> If we are _really worried_, one can try counting restarts\r\n\r\nTherefore, I believe the described worst case is out of scope of this PR.\r\n\r\nGoing to update this pull soon.  ",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/636335317/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/636453433",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-636453433",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 636453433,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzNjQ1MzQzMw==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-31T10:42:28Z",
    "updated_at": "2020-05-31T10:42:28Z",
    "author_association": "MEMBER",
    "body": "Updated 780107e41fe86e31392b3ef76b917e623483259f -> dacb155eaaa1775385bc4a2d82a3e0307f68ce7d ([pr17428.07](https://github.com/hebasto/bitcoin/commits/pr17428.07) -> [pr17428.09](https://github.com/hebasto/bitcoin/commits/pr17428.09), [diff](https://github.com/hebasto/bitcoin/compare/pr17428.07..pr17428.09)):\r\n\r\n- addressed @amitiuttarwar's [comment](https://github.com/bitcoin/bitcoin/pull/17428#discussion_r385394617):\r\n> consider introducing a new constant (eg. `m_max_anchors`) that currently matches the value of `m_max_outbound_block_relay`, so if we change the number of block-relay-only connections in the future we have to explicitly decide if we want to increase our anchor connections as well\r\n\r\n- addressed @naumenkogs's [comment](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-592596746):\r\n> So, if it is broad DoS issue an attacker will be able to shut down all the reachable nodes, because connecting to them in-bound is free. Much bigger trouble than persistent-anchor attack.\r\n\r\n- addressed @fjahr's [comment](https://github.com/bitcoin/bitcoin/pull/17428#discussion_r386686000):\r\n> nit: would have been nice to add a little more context information on the purpose of these anchors\r\n\r\n- addressed @luke-jr's [comment](https://bitcoincore.reviews/17428.html):\r\n> wonders if anchors should be reduced/skipped entirely if the user has manually configured addnode peers\r\n\r\n---\r\n\r\nCurrently, the `anchors.dat` contains IP addresses of the block-relay-only peers to which the node is connected, _and_ IP addresses that were loaded from `anchors.dat` into memory at startup and that have not been tried to re-connect to yet.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/636453433/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/636455389",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-636455389",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 636455389,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzNjQ1NTM4OQ==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-31T11:01:44Z",
    "updated_at": "2020-05-31T11:01:44Z",
    "author_association": "MEMBER",
    "body": "Rebased dacb155eaaa1775385bc4a2d82a3e0307f68ce7d -> 293065610dd1822c9f8585526031b5a38996f695 ([pr17428.09](https://github.com/hebasto/bitcoin/commits/pr17428.09) -> [pr17428.10](https://github.com/hebasto/bitcoin/commits/pr17428.10)) due to the conflicts with #18088 and #18910.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/636455389/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/639289724",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-639289724",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 639289724,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzOTI4OTcyNA==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-05T06:40:16Z",
    "updated_at": "2020-06-05T06:40:16Z",
    "author_association": "MEMBER",
    "body": "Rebased 293065610dd1822c9f8585526031b5a38996f695 -> 1d9264e296f1a03abbfa6c30363628a85cf33ce4 ([pr17428.10](https://github.com/hebasto/bitcoin/commits/pr17428.10) -> [pr17428.11](https://github.com/hebasto/bitcoin/commits/pr17428.11)) due to the conflict with #19053.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/639289724/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/652366404",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-652366404",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 652366404,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1MjM2NjQwNA==",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?u=06eb9ae4f9b3f954056098860decccbf1340e40f&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-01T11:36:16Z",
    "updated_at": "2020-07-01T11:36:51Z",
    "author_association": "MEMBER",
    "body": "The implementation is very simple and fairly straightforward, which is good.\r\n\r\nAfter all discussions I also see that this version of the PR falls into the broader idea of anti-eclipse measures (many more to come).\r\n\r\nIt's true that fresh connections are often a good idea, but in this case we should achieve them by peer rotation and proactive feeler tip sync, not by relying on random restarts. Maybe this can be delayed by then, but I don't see why. This PR currently doesn't bring any concerns (in my opinion): spying, restart attack and whatnot.\r\n\r\nutACK 1d9264e296f1a03abbfa6c30363628a85cf33ce4 modulo those minor things I commented.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/652366404/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/653533271",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-653533271",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 653533271,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1MzUzMzI3MQ==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-03T12:50:43Z",
    "updated_at": "2020-07-03T12:50:43Z",
    "author_association": "MEMBER",
    "body": "Updated 1d9264e296f1a03abbfa6c30363628a85cf33ce4 -> 0a74c7c3686d4b03a27815c6107b3300954641cc ([pr17428.11](https://github.com/hebasto/bitcoin/commits/pr17428.11) -> [pr17428.13](https://github.com/hebasto/bitcoin/commits/pr17428.13), [diff](https://github.com/hebasto/bitcoin/compare/pr17428.11..pr17428.13)):\r\n\r\n- addressed the recent @naumenkogs' comments\r\n- small style improvements\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/653533271/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/653627885",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-653627885",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 653627885,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1MzYyNzg4NQ==",
    "user": {
      "login": "pinheadmz",
      "id": 2084648,
      "node_id": "MDQ6VXNlcjIwODQ2NDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2084648?u=8b3acfaf5f6b5d51d1a3ee1a427e4489e9874bb1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pinheadmz",
      "html_url": "https://github.com/pinheadmz",
      "followers_url": "https://api.github.com/users/pinheadmz/followers",
      "following_url": "https://api.github.com/users/pinheadmz/following{/other_user}",
      "gists_url": "https://api.github.com/users/pinheadmz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
      "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
      "repos_url": "https://api.github.com/users/pinheadmz/repos",
      "events_url": "https://api.github.com/users/pinheadmz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-03T17:17:18Z",
    "updated_at": "2020-07-03T17:17:18Z",
    "author_association": "CONTRIBUTOR",
    "body": "Concept ACK, just a few questions above about execution.\r\n\r\nThis was tricky to test because on regtest all nodes have the same IP and my development environment doesn't have  a synced chain. I don't think the extra 2 blocks-only nodes are connected during IBD (?)\r\n\r\nBut I hot wired bitcoind with\r\n\r\n`static const int MAX_OUTBOUND_FULL_RELAY_CONNECTIONS = 0;`\r\n\r\n...forcing my only connections to be the two anchors. Verified the `anchors.dat` file, tried corrupting it and tested for that error (check!) and restarted bitcoind to check that the anchor connections were loaded and connected correctly (check!).\r\n\r\n`debug.log | grep anchor`:\r\n\r\n```\r\n2020-07-03T16:54:59Z DumpAnchors: Flush 1 outbound block-relay-only peer addresses to anchors.dat started\r\n2020-07-03T16:54:59Z DumpAnchors: Flush 1 outbound block-relay-only peer addresses to anchors.dat completed (0.01s)\r\n2020-07-03T16:55:16Z DumpAnchors: Flush 2 outbound block-relay-only peer addresses to anchors.dat started\r\n2020-07-03T16:55:16Z DumpAnchors: Flush 2 outbound block-relay-only peer addresses to anchors.dat completed (0.06s)\r\n2020-07-03T16:55:32Z DumpAnchors: Flush 2 outbound block-relay-only peer addresses to anchors.dat started\r\n2020-07-03T16:55:32Z DumpAnchors: Flush 2 outbound block-relay-only peer addresses to anchors.dat completed (0.05s)\r\n2020-07-03T16:57:42Z Loaded 2 addresses from \"anchors.dat\"\r\n2020-07-03T16:57:42Z 2 block-relay-only anchors will be tried to connect to.\r\n2020-07-03T16:57:43Z Trying to make an anchor connection to 120.150.206.137:8333\r\n2020-07-03T16:57:43Z DumpAnchors: Flush 2 outbound block-relay-only peer addresses to anchors.dat started\r\n2020-07-03T16:57:43Z DumpAnchors: Flush 2 outbound block-relay-only peer addresses to anchors.dat completed (0.00s)\r\n2020-07-03T16:57:48Z Trying to make an anchor connection to 174.138.35.229:8333\r\n2020-07-03T16:57:48Z DumpAnchors: Flush 2 outbound block-relay-only peer addresses to anchors.dat started\r\n2020-07-03T16:57:48Z DumpAnchors: Flush 2 outbound block-relay-only peer addresses to anchors.dat completed (0.01s)\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/653627885/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/653631684",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-653631684",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 653631684,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1MzYzMTY4NA==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-03T17:34:09Z",
    "updated_at": "2020-07-03T17:34:09Z",
    "author_association": "MEMBER",
    "body": "Updated 0a74c7c3686d4b03a27815c6107b3300954641cc -> ceb9d212716fe1134f9ac179d46e14e4847dd8b1 ([pr17428.13](https://github.com/hebasto/bitcoin/commits/pr17428.13) -> [pr17428.14](https://github.com/hebasto/bitcoin/commits/pr17428.14), [diff](https://github.com/hebasto/bitcoin/compare/pr17428.13..pr17428.14)):\r\n\r\n- addressed @pinheadmz' [comment](https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449650363)\r\n> nit: a bit awkward, maybe `\"%i block-relay-only anchors will be tried for connections.\\n\"` ?\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/653631684/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/656534753",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-656534753",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 656534753,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1NjUzNDc1Mw==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-10T07:42:22Z",
    "updated_at": "2020-07-10T07:42:22Z",
    "author_association": "MEMBER",
    "body": "Rebased ceb9d212716fe1134f9ac179d46e14e4847dd8b1 -> 005a46dc3a4b84b045d3877ee757a162acf1f5ca ([pr17428.14](https://github.com/hebasto/bitcoin/commits/pr17428.14) -> [pr17428.15](https://github.com/hebasto/bitcoin/commits/pr17428.15)) due to the conflict with #19314.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/656534753/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/658233093",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-658233093",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 658233093,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1ODIzMzA5Mw==",
    "user": {
      "login": "pinheadmz",
      "id": 2084648,
      "node_id": "MDQ6VXNlcjIwODQ2NDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2084648?u=8b3acfaf5f6b5d51d1a3ee1a427e4489e9874bb1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pinheadmz",
      "html_url": "https://github.com/pinheadmz",
      "followers_url": "https://api.github.com/users/pinheadmz/followers",
      "following_url": "https://api.github.com/users/pinheadmz/following{/other_user}",
      "gists_url": "https://api.github.com/users/pinheadmz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
      "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
      "repos_url": "https://api.github.com/users/pinheadmz/repos",
      "events_url": "https://api.github.com/users/pinheadmz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-14T15:03:49Z",
    "updated_at": "2020-07-14T15:03:49Z",
    "author_association": "CONTRIBUTOR",
    "body": "ACK 005a46dc3a4b84b045d3877ee757a162acf1f5ca\r\n<details><summary>Show Signature</summary>\r\n\r\n```\r\n-----BEGIN PGP SIGNED MESSAGE-----\r\nHash: SHA256\r\n\r\nACK 005a46dc3a4b84b045d3877ee757a162acf1f5ca\r\n-----BEGIN PGP SIGNATURE-----\r\n\r\niQIzBAEBCAAdFiEE5hdzzW4BBA4vG9eM5+KYS2KJyToFAl8NyM8ACgkQ5+KYS2KJ\r\nyToIBhAAgVTXUzjuIrkugUhWiSYy5daBqBCvWtc1CC9P9h6vY+MfdLdvA/KuBlF4\r\ndU8oQ7Dzz0sdTRCFvXSHDrYQSjF8hKd1JY3KrYVWgdMGIwITK7VMDpMWk5SCuWBo\r\nVQsaFPZmEn8x4HV2+OkCOMM+f02fKrERJ4l5QKEX76CehIt/eJN6NaSOGo2Y7JcQ\r\n0bxoK8iWFIvKkqQV6fatraxwig40bw6Jxuj7OhlN25xnWgI2TwSGL54d+r/9viHV\r\n2OORkqF3frgqQNP6DODQw6ROcQhhyJdfAoUWefrD2qbbaBQ4nV6sovTs91HQq5lr\r\noyIX9UMSVPewMdiVsS9YO6tcL5WKq2CVu63KmGOt+jZ6WZl8Y9Xb5oehJdc9BwiL\r\nwkJL2LbB40Me3eA8pszIAknFrLiyDTl1zMkuooGMQ61jtHJi9ILT+uLYTdNIdEH6\r\niQZkX+HujAW0RUWln3ZMeummxgd/VBF/xnxZ35QMSg8ktIzsqrKNgkshmDfNzWOF\r\nglh99AFuBMTUmM11ShG5icEd07h4Jh3SQ3eOwzXVXcDfGXo5DYpbs7GXGo5o109E\r\n5jeJyw0gIpWMeJoU/26VhD5VyUmRFLUaVDiWCJlvD4GyzY2FOSf30YvAxospjCTu\r\nuI8+thlo+0GSrKuRwTRXoRKXpp2tlA3UC1CKkv/Sy8iZdS7PzZY=\r\n=mG97\r\n-----END PGP SIGNATURE-----\r\n```\r\n\r\npinheadmz's public key is [on keybase](https://keybase.io/pinheadmz/pgp_keys.asc?fingerprint=e61773cd6e01040e2f1bd78ce7e2984b6289c93a)\r\n</details>\r\n\r\n\r\nConfirmed rebase is minimal\r\n\r\n<details><summary>git range-diff  7101f91f2..ceb9d2127 96b22cbea..005a46dc3</summary>\r\n\r\n```diff\r\n\r\n1:  529827588 = 1:  3370328ac p2p: Integrate ReadAnchors() into CConnman()\r\n2:  e3b817832 = 2:  64d1887fd p2p: Add CConnman::GetCurrentAnchors()\r\n3:  4f0a4c93e ! 3:  27864da6a p2p: Add DumpAnchors()\r\n    @@ Commit message\r\n\r\n      ## src/addrdb.cpp ##\r\n     @@\r\n    - #include <chainparams.h>\r\n      #include <clientversion.h>\r\n    + #include <cstdint>\r\n      #include <hash.h>\r\n     +#include <logging/timer.h>\r\n      #include <random.h>\r\n4:  a4292fdd0 ! 4:  8e6eff7e4 p2p: Integrate DumpAnchors() into ProcessMessage()\r\n    @@ Commit message\r\n         p2p: Integrate DumpAnchors() into ProcessMessage()\r\n\r\n      ## src/net_processing.cpp ##\r\n    -@@ src/net_processing.cpp: bool ProcessMessage(CNode& pfrom, const std::string& msg_type, CDataStream& vRec\r\n    +@@ src/net_processing.cpp: void ProcessMessage(\r\n                            pfrom.nVersion.load(), pfrom.nStartingHeight,\r\n                            pfrom.GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom.addr.ToString()) : \"\"),\r\n                            pfrom.m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\r\n5:  e69c4d048 = 5:  9c17f92db p2p: Fix off-by-one error in fetching address loop\r\n6:  ceb9d2127 ! 6:  005a46dc3 p2p: Try to connect to anchors once\r\n    @@ src/net.cpp\r\n\r\n     +#include <algorithm>\r\n     +#include <cmath>\r\n    + #include <cstdint>\r\n      #include <unordered_map>\r\n     -\r\n     -#include <math.h>\r\n    @@ src/net.cpp: void CConnman::ThreadOpenConnections(const std::vector<std::string>\r\n      }\r\n\r\n      ## src/net_processing.cpp ##\r\n    -@@ src/net_processing.cpp: bool ProcessMessage(CNode& pfrom, const std::string& msg_type, CDataStream& vRec\r\n    +@@ src/net_processing.cpp: void ProcessMessage(\r\n                            pfrom.GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom.addr.ToString()) : \"\"),\r\n                            pfrom.m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\r\n                  if (!pfrom.m_tx_relay) {\r\n```\r\n</details>",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/658233093/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/658680276",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-658680276",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 658680276,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1ODY4MDI3Ng==",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?u=06eb9ae4f9b3f954056098860decccbf1340e40f&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-15T10:11:40Z",
    "updated_at": "2020-07-15T10:12:40Z",
    "author_association": "MEMBER",
    "body": "The implementation looks correct, but I think the high-level idea requires more conceptual discussion. It's not about me, I expressed my general support above.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/658680276/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/662052433",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-662052433",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 662052433,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2MjA1MjQzMw==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-21T19:09:20Z",
    "updated_at": "2020-07-21T19:09:20Z",
    "author_association": "MEMBER",
    "body": "Rebased 005a46dc3a4b84b045d3877ee757a162acf1f5ca -> 9445a3411ed589d38cd4eee6714015d065f2b180 ([pr17428.15](https://github.com/hebasto/bitcoin/commits/pr17428.15) -> [pr17428.16](https://github.com/hebasto/bitcoin/commits/pr17428.16)) due to the conflicts with #19174 and #19217.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/662052433/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/669641451",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-669641451",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 669641451,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2OTY0MTQ1MQ==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-06T02:13:04Z",
    "updated_at": "2020-08-06T02:13:04Z",
    "author_association": "MEMBER",
    "body": "Rebased 9445a3411ed589d38cd4eee6714015d065f2b180 -> d1ef06a1ac45e103eae1bfa5b9162e5cae64e73b ([pr17428.16](https://github.com/hebasto/bitcoin/commits/pr17428.16) -> [pr17428.17](https://github.com/hebasto/bitcoin/commits/pr17428.17)) due to the conflict with #18991.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/669641451/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/673515908",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-673515908",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 673515908,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3MzUxNTkwOA==",
    "user": {
      "login": "adamjonas",
      "id": 755825,
      "node_id": "MDQ6VXNlcjc1NTgyNQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/755825?u=fc2e6f106f98731d49e9787f9cbfe86a17447c23&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/adamjonas",
      "html_url": "https://github.com/adamjonas",
      "followers_url": "https://api.github.com/users/adamjonas/followers",
      "following_url": "https://api.github.com/users/adamjonas/following{/other_user}",
      "gists_url": "https://api.github.com/users/adamjonas/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/adamjonas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adamjonas/subscriptions",
      "organizations_url": "https://api.github.com/users/adamjonas/orgs",
      "repos_url": "https://api.github.com/users/adamjonas/repos",
      "events_url": "https://api.github.com/users/adamjonas/events{/privacy}",
      "received_events_url": "https://api.github.com/users/adamjonas/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-13T14:35:24Z",
    "updated_at": "2020-08-13T14:35:24Z",
    "author_association": "MEMBER",
    "body": "**Summary:**\r\n\r\nThis PR is an anti-eclipse attack measure for the scenario when an attacker exploits a victim node restart to force it to connect to new, probably adversarial, peers. Other discussion surrounding this issue can be found on [#17326](https://github.com/bitcoin/bitcoin/issues/17326). This patch helps a node attempt to restore pre-restart outbound block-relay-only connections by dumping the (currently 2) outbound block-relay-only connections to an anchors.dat file and connecting to those addresses on start-up.\r\n\r\n[laanwj noted](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-552184378):\r\n> ...reconnecting to peers 'aggressively', was, up to now, the reserve of spy nodes and mass-connectors and such... Historically this has been one of the ways used to detect these.\r\n\r\n[gmaxwell responded](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-553531390):\r\n> It would be really good to limit it so that an honest node won't attempt to connect twice to the same peer through this mechanism for some prudent amount of time... like two minutes.\" But that \"I don't think it would cause any harm to the intent of this mechanism to not bring them up as fast as possible, and it would avoid tripping up detection of aggressive mass connectors.\r\n\r\ngmaxwell and theBlueMatt commented (on [#17326](https://github.com/bitcoin/bitcoin/issues/17326)) that we shouldn\u2019t do this with all our block-relay-only connections because it would [guarantee capture persistence](https://github.com/bitcoin/bitcoin/issues/17326#issuecomment-550521262). [sdaftuar noted](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-554073351) that since we only have two of those connections at the moment, perhaps it\u2019s fine for now.\r\n\r\n[luke-jr wondered](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-579580035):  \r\n> Couldn't there be a risk here, that if one of the anchor peers is malicious and knows a DoS vulnerability, this ensures they can keep repeatedly crashing your node, even if you setup a watchdog to restart it?\r\n\r\nTo that, [gmaxwell suggested](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-580134777) that one might forget the anchors if you uncleanly exit, which luke-jr [supported](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-582907316).\r\n\r\nAt that point (Feb 2020), the author [closed the PR](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-583737058) because:\r\n> ...forgetting the peers nullifies the initial idea by making anchoring usable only for clean (user initiated) restarts.\r\n\r\ngmaxwell however [encouraged the PR to be re-opened](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-583742368):\r\n> not saving state across crashes in no way nullifies the advantage of preserving connections, and it's also a natural implementation-- e.g. the software will fail to write out the latest peers.dat across a crash.\r\n\r\nSince then others made arguments for reconnecting to anchor connections after unclean restarts:\r\n\r\nThe risk is that a malicious anchor could exploit a DoS vulnerability (which is possibly more likely than executing an eclipse attack) and prevent the victim from being able to sync their node. However, if the node is DoS-attackable, it should be fixed immediately regardless. Something that prevents using it as a normal node doesn\u2019t seem like a huge downside. However, the upside of persisting anchors across crashes is the extra protection against certain types of eclipse attacks. ([adapted from amitiuttarwar](https://github.com/bitcoin/bitcoin/pull/17428#pullrequestreview-366050954))\r\n\r\nAdditionally, it's very difficult to imagine a DoS vulnerability opened only to outbound blocks-only connections. If there is a broad DoS issue, an attacker will be able to shut down all the reachable nodes with ease because in-bound connections are free. If a vulnerability only applies to outbound connections, then it's also easy: an attacker spawns 2,000 reachable sybil nodes, and thus has a high chance of becoming a regular outbound connection (not just a block-relay-only). The specific risk of block-relay-only outbound links being able to crash a node while no other connection can, should not prevent us from getting benefits of anchor-persistence after crashing. (If we are worried, we can try counting restarts). The anti-eclipse benefits of reconnecting after an unclean exit are quite valuable since the restart-to-attempt-eclipse scenario seems much more feasible and dangerous then just restart-node-repetitively scenario. ([adapted from naumenkogs](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-592596746))\r\n\r\nIn its current state, the anchors are persisted and reconnected to on unclean shutdowns. (h/t amitiuttarwar and hebasto for clarifying)\r\n\r\nIn sum, there appears to be broad support for the concept of outbound block-relay-only anchor connections. However, opinions differ on the approach around whether connections are persisted and connected to after unclean restarts. ajtowns, amitiuttarwar, naumenkogs, mzumsande support keeping the connections while luke-jr and gmaxwell are in favor of forgetting them.\r\n\r\nAdditionally, there were (now invalided) ACKs from fjahr, jamesob, pinheadmz and an utACK from naumenkogs.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/673515908/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 1,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/678109126",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-678109126",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 678109126,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3ODEwOTEyNg==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-21T08:14:42Z",
    "updated_at": "2020-08-21T08:14:42Z",
    "author_association": "MEMBER",
    "body": "Rebased d1ef06a1ac45e103eae1bfa5b9162e5cae64e73b -> d7482556c98b76e73f64d04400a703fdbb9c189f ([pr17428.17](https://github.com/hebasto/bitcoin/commits/pr17428.17) -> [pr17428.18](https://github.com/hebasto/bitcoin/commits/pr17428.18)) due to the conflicts with #19658 and #19316.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/678109126/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/678809189",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-678809189",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 678809189,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3ODgwOTE4OQ==",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-23T18:38:32Z",
    "updated_at": "2020-08-23T18:38:32Z",
    "author_association": "MEMBER",
    "body": "On the eclipses scenario mitigated, as a first step, it assumes the attacker to perform a\r\n_addrman takover_ thus controlling the set of futures peers that the victim node will be able to\r\nconnect to. This takeover may be either short-lived/long-lived or even persistent at whim of attacker,\r\ndepending on the theoritical addr-relay vulnerability leveraged. To effectively activate the eclipse,\r\nan attacker needs to benefit from a favorable event, a) a restart or b) a full rotation of your outbounds (stale tip,\r\nlagging chain, eviction logic of connected peers, ...). In case of a), independently of the restart\r\nsource (spontaneous or attacker triggered), anchors connections will prevent your attacker to win\r\ncontrol of your network view, and so are worthy on this ground.\r\n\r\nOn the peer rotation cases, especially leverage of the eviction logic, I think it would bypass this new counter-measure. The connection starvation tactic could be used to hijack your inbound slots towards your selected anchors peers and thus forcing you to initiate new connections to malicious peers. But a) it's likely to be harder\r\nafter https://github.com/bitcoin/bitcoin/pull/17428, as those anchors are going to be protected\r\nas block-relay peers and b) whereas lower bound of restart-eclipse presume for an attacker only \r\ninjecting p2p messages and leveraging a natural event, starvation requires from it to actively \r\noccupy network slots and game on eviction criterias. Really when we analyze eclipse attacks, we should\r\nhave a hierarchy of them classified with regards to resources they require from the attacker to\r\nsuccessfully perform them. The fact that a stronger attack A can easily bypass counter-measure for\r\nattack B doesn't invalidate worthiness of counter-measure B. At the end of the day, any of our actual\r\neclipse counter-measure is likely to perfom poorly with regards to active infrastructure attacks.\r\n\r\nOn the DoS issue, I don't think that granting an anchor privilege to our outbound-block-relay-only\r\ngive any new _DoS privilege_ to them. The set of messages we talk with them is restrained, thus \r\ntheorically reducing the attack surface we expose to them. At the limit, we may favor them to\r\nupgrade them as compact blocks peers, and they may opportunity to exploit compact code. But that's\r\nonly exception I can see ? Not persisting anchors through unclear restart will actually reduce\r\neffectiveness of counter-measure, and I think that silent eclipsing might be more worrying than\r\nnoisy DoS. A crash is likely to be notified more or less quickly by the operator and should halt\r\nany higher application logic whereas keeping operating on a attacker-controlled view of the network\r\ncan be even more harmful funds-loss wise.\r\n\r\nOn the network staticness increase, I think gmaxwell made the point in the other thread that persitence\r\nmay favor physically-near peers on the long term as the far from us one as more likely to be dropped\r\nfrom they anchor privilege due to network/link layer aleas. That way slightly degrading network\r\nrobustness with regards to network-partition geographically based. It should be balanced with the\r\nfact this anchor, physically-near peers will also known natural restart or other event, likely\r\nreshuflling the cards to anyone. This should be something interesting to monitor by coupling anchor \r\nrotations with ASN infos provided by ASMAP. And if there is any meaningful geographical bias\r\nintroduced.\r\n\r\nThat said a concern I may still have with proposed implementation is with regards to hindering\r\nnon-observability of block-relay-only. By persisting connections across restarts, given we already\r\nprotect this connections type from stale tip/lagging logic and the fact block-relay connections\r\nare going to be even more stable after #17428, you might improve a potential oracle to guess their \r\npresence. An attacker with connection-starvation/tx-relay capabilities could a) map your full-relay \r\noutbound with some conflicts b) evict those outbound from your connected peers by leveraging eviction\r\nc) observe you never pick new outbounds in some netgroup because this one is already occupied by \r\nyour anchors. \r\n\r\nI would be more confident if we either a) restrain anchors to one of our outbound-block-relay peers\r\nor b) add 2 news anchors peers outbound-block-relay-only. We should try to keep the non-observability\r\nof our block-relay-only peers as good we can, at least for a subset of them.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/678809189/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/678983360",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-678983360",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 678983360,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3ODk4MzM2MA==",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?u=06eb9ae4f9b3f954056098860decccbf1340e40f&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-24T08:22:28Z",
    "updated_at": "2020-08-24T08:22:40Z",
    "author_association": "MEMBER",
    "body": ">An attacker with connection-starvation/tx-relay capabilities could a) map your full-relay\r\noutbound with some conflicts b) evict those outbound from your connected peers by leveraging eviction\r\nc) observe you never pick new outbounds in some netgroup because this one is already occupied by\r\nyour anchors.\r\n\r\nIt feels to be a way too advanced threat model (especially since (c) should be really hard) to deal with it right now. We can address it later once we're done with more basic issues like those discussed above :)\r\n\r\nBtw, another solution to (c)-like issues might be to choose the tx-relay connections (semi-?)independently from block-relay-only connections (in terms of netgroups/asmap).",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/678983360/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/688252761",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-688252761",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 688252761,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4ODI1Mjc2MQ==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-07T11:06:15Z",
    "updated_at": "2020-09-07T11:06:15Z",
    "author_association": "MEMBER",
    "body": "Updated d7482556c98b76e73f64d04400a703fdbb9c189f -> 4eff692eeb861018f1f44b6284891a1d0599dd88 ([pr17428.18](https://github.com/hebasto/bitcoin/commits/pr17428.18) -> [pr17428.20](https://github.com/hebasto/bitcoin/commits/pr17428.20)):\r\n- rebased due to the conflicts with #19704 and #19724\r\n- addressed @jnewbery's [comment](https://github.com/bitcoin/bitcoin/pull/17428#discussion_r482875198):\r\n> I don't think we should copy bad patterns just because they already exist in the codebase. `Options` is used to pass parameters into `CConnman`'s initialize function, but `CConnman` already has everything it needs to calculate the max block relay anchor connections (the `MAX_BLOCK_RELAY_ONLY_ANCHORS` constant is defined in net, and `m_max_outbound_block_relay` is already passed in).\r\n> \r\n> Adding this here is essentially placing logic for how to construct `CConnman` inside init.\r\n\r\n- addressed @jnewbery's [comment](https://github.com/bitcoin/bitcoin/pull/17428#discussion_r482877813):\r\n> This logic shouldn't be in net_processing. It's all bound up in connection-layer logic rather than application-layer logic. There's nothing here that's specific to the `pnode` that we're in the context of in this `ProcessMessages()` call. I think it makes sense for this to be in `CConnman` rather than here.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/688252761/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/689127833",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-689127833",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 689127833,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4OTEyNzgzMw==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-08T20:48:18Z",
    "updated_at": "2020-09-08T20:49:58Z",
    "author_association": "MEMBER",
    "body": "Updated 4eff692eeb861018f1f44b6284891a1d0599dd88 -> 922c65cfd9ea31b00fdc76514dbdd68129169467 ([pr17428.20](https://github.com/hebasto/bitcoin/commits/pr17428.20) -> [pr17428.21](https://github.com/hebasto/bitcoin/commits/pr17428.21), [diff](https://github.com/hebasto/bitcoin/compare/pr17428.20..pr17428.21)):\r\n- addressed @jnewbery's comments",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/689127833/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/690307345",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-690307345",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 690307345,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MDMwNzM0NQ==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-10T13:57:48Z",
    "updated_at": "2020-09-10T14:00:26Z",
    "author_association": "MEMBER",
    "body": "Updated 922c65cfd9ea31b00fdc76514dbdd68129169467 -> 06c96f27e70a7d397b5980497dfe615a1f57aeb4 ([pr17428.21](https://github.com/hebasto/bitcoin/commits/pr17428.21) -> [pr17428.22](https://github.com/hebasto/bitcoin/commits/pr17428.22), [diff](https://github.com/hebasto/bitcoin/compare/pr17428.21..pr17428.22?w=1)).\r\n\r\nAddressed more @jnewbery's comments:\r\n- https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485504053:\r\n> I think we have to assume that our data directory is not compromised. Otherwise anything could happen.\r\n\r\n- https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485545150:\r\n> oh, I didn't realise that these are unconditional logs. I definitely think they should be in the NET category.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/690307345/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/691487385",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-691487385",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 691487385,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MTQ4NzM4NQ==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-12T13:24:48Z",
    "updated_at": "2020-09-12T16:58:48Z",
    "author_association": "MEMBER",
    "body": "@sdaftuar \r\n\r\nThank you for reviewing.\r\n\r\n>  But if you're a node operator, being able to reset state in the event of the unforeseen in order to mitigate a problem while you implement a better fix (like upgrading your code, if a fix is available) just seems like a common sense behavior to have.\r\n\r\nA node operator could just remove `anchors.dat` file to mitigate a problem. If such behavior could not be considered as a remedy, please consider the following.\r\n\r\nAnother approach is to introduce a configure option, say `-keepanchors`, with the default value `-keepanchors=clean_shutdown_only`, and a node operator could opt in `-keepanchors=always`.\r\n\r\nUPDATE: This suggestion could be leaved for follow ups.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/691487385/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/691508148",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-691508148",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 691508148,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MTUwODE0OA==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-12T15:45:44Z",
    "updated_at": "2020-09-12T15:45:44Z",
    "author_association": "MEMBER",
    "body": "Updated 06c96f27e70a7d397b5980497dfe615a1f57aeb4 -> 21d9d4e29ac09cb74afa24bed0509a928210d974 ([pr17428.22](https://github.com/hebasto/bitcoin/commits/pr17428.22) -> [pr17428.23](https://github.com/hebasto/bitcoin/commits/pr17428.23), [diff](https://github.com/hebasto/bitcoin/compare/pr17428.21..pr17428.22)).\r\n\r\nAddressed @sdaftuar's [comments](https://github.com/bitcoin/bitcoin/pull/17428#pullrequestreview-486006930):\r\n\r\n> I disagree with the decision to call `DumpAnchors` on every block-relay-only connection. I largely agree with the reasoning given by @luke-jr and @gmaxwell; if the software is not working correctly and we have an unclean shutdown, it's better to reset the state by throwing away old connections than it is to just resume our old connections.\r\n\r\n> I also disagree with having an interaction between `-addnode` and anchors, which I commented on separately.\r\n\r\nAlso other @sdaftuar's and @jnewbery's comments are addressed.\r\n\r\n---\r\n\r\nWhen feature freeze for 0.21.0 is [around the coner](https://github.com/bitcoin/bitcoin/issues/18947) the non-controversial and the safest approach seems the most reasonable.\r\nMy [suggestion](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-691487385) could be considered later.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/691508148/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/691516166",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-691516166",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 691516166,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MTUxNjE2Ng==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-12T16:52:38Z",
    "updated_at": "2020-09-12T16:52:38Z",
    "author_association": "MEMBER",
    "body": "Updated 21d9d4e29ac09cb74afa24bed0509a928210d974 -> be82629cc00961325182f03493d84f704b709020 ([pr17428.23](https://github.com/hebasto/bitcoin/commits/pr17428.23) -> [pr17428.24](https://github.com/hebasto/bitcoin/commits/pr17428.24), [diff](https://github.com/hebasto/bitcoin/compare/pr17428.23..pr17428.24)):\r\n- added `anchors.dat` to `files.md`",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/691516166/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/693330527",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-693330527",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 693330527,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MzMzMDUyNw==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-16T10:56:45Z",
    "updated_at": "2020-09-16T15:03:53Z",
    "author_association": "MEMBER",
    "body": "Updated be82629cc00961325182f03493d84f704b709020 -> 24129a6b1966d71c7bd77ea029f17fb7796e2bc2 ([pr17428.24](https://github.com/hebasto/bitcoin/commits/pr17428.24) -> [pr17428.25](https://github.com/hebasto/bitcoin/commits/pr17428.25), [diff](https://github.com/hebasto/bitcoin/compare/pr17428.24..pr17428.25)):\r\n\r\n- addressed all recent @jnewbery's comments",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/693330527/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/693556607",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-693556607",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 693556607,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MzU1NjYwNw==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-16T17:39:50Z",
    "updated_at": "2020-09-16T17:39:50Z",
    "author_association": "MEMBER",
    "body": "Updated 24129a6b1966d71c7bd77ea029f17fb7796e2bc2 -> 68870383c35922d3a5aad1cedd9df002568995a0 ([pr17428.25](https://github.com/hebasto/bitcoin/commits/pr17428.25) -> [pr17428.27](https://github.com/hebasto/bitcoin/commits/pr17428.27), [diff](https://github.com/hebasto/bitcoin/compare/pr17428.25..pr17428.27)):\r\n\r\n- improved the comment as [suggested](https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489594626) by @jnewbery:\r\n> I'd suggest \"Addresses that were saved during the previous shutdown. We'll attempt to make block-relay-only connections to them.\"\r\n\r\n- addressed @jnewbery's [comment](https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489605389):\r\n> I wonder if the call to `ReadAnchors()` should be within this if block. If `ReadAnchors()` is outside the block, then when the node is started with `-noconnect`, not only will the node not connect to the anchors, it'll also throw away the file, so that when it's restarted without `-noconnect`, it won't try to reconnect to the old anchors. Is that what we want?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/693556607/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/694127259",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-694127259",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 694127259,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5NDEyNzI1OQ==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-17T09:55:16Z",
    "updated_at": "2020-09-17T09:55:16Z",
    "author_association": "MEMBER",
    "body": "I've tested the following manually:\r\n\r\n- start bitcoind, leave it long enough to make block-relay-only connections, stop, manually inspect anchors.dat, restart and observe that bitcoind connects to the same block-relay-only connections :heavy_check_mark: \r\n- corrupt anchors.dat file and make sure that it's ignored, and other addresses are chosen for block-relay-only connections :heavy_check_mark: \r\n- start bitcoind with `-noconnect` -> anchors.dat file doesn't get read, but gets overwritten with a new file containing no connections on shutdown. I think we might want to change this behaviour to ensure anchors aren't thrown away unnecessarily (although this scenario seems quite unlikely)\r\n\r\nI think this is ready for merge now, and smaller improvements can be added later. It'll also be great to add regression tests once #19315 has been merged.\r\n\r\nTested ACK 68870383c3",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/694127259/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/696304329",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-696304329",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 696304329,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5NjMwNDMyOQ==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-21T18:53:13Z",
    "updated_at": "2020-09-21T18:53:13Z",
    "author_association": "MEMBER",
    "body": "Updated 68870383c35922d3a5aad1cedd9df002568995a0 -> 27113fc53d0537393fc6c61a8a3dea0eced7f588 ([pr17428.27](https://github.com/hebasto/bitcoin/commits/pr17428.27) -> [pr17428.28](https://github.com/hebasto/bitcoin/commits/pr17428.28), [diff](https://github.com/hebasto/bitcoin/compare/pr17428.27..pr17428.28)):\r\n\r\n- rebased due to the conflict with #19697\r\n\r\n- addressed @jnewbery's [comment](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-694127259):\r\n> start bitcoind with `-noconnect` -> anchors.dat file doesn't get read, but gets overwritten with a new file containing no connections on shutdown. I think we might want to change this behaviour to ensure anchors aren't thrown away unnecessarily (although this scenario seems quite unlikely)",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/696304329/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/700159056",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-700159056",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 700159056,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMDE1OTA1Ng==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-28T16:58:15Z",
    "updated_at": "2020-09-28T16:58:15Z",
    "author_association": "MEMBER",
    "body": "Updated 27113fc53d0537393fc6c61a8a3dea0eced7f588 -> b397e49b0c390970713b4387e6dd254b926c70d0 ([pr17428.28](https://github.com/hebasto/bitcoin/commits/pr17428.28) -> [pr17428.30](https://github.com/hebasto/bitcoin/commits/pr17428.30), [diff](https://github.com/hebasto/bitcoin/compare/pr17428.28..pr17428.30)):\r\n\r\n- fixed bug when an anchor does not pass all checks\r\n\r\n- addressed @ariard's comments",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/700159056/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/700234854",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-700234854",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 700234854,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMDIzNDg1NA==",
    "user": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?u=5ff13e375b40ea55ecd3c108337dd6a23f68eddf&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-28T19:27:42Z",
    "updated_at": "2020-09-28T19:27:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "Concept ACK",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/700234854/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/706081630",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-706081630",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 706081630,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNjA4MTYzMA==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-09T09:42:49Z",
    "updated_at": "2020-10-09T09:42:49Z",
    "author_association": "MEMBER",
    "body": "Updated b397e49b0c390970713b4387e6dd254b926c70d0 -> d77ae88b5e7f8d6ea817675b7e4a28f80ed5081f ([pr17428.30](https://github.com/hebasto/bitcoin/commits/pr17428.30) -> [pr17428.31](https://github.com/hebasto/bitcoin/commits/pr17428.31), [diff](https://github.com/hebasto/bitcoin/compare/pr17428.30..pr17428.31)):\r\n\r\n- addressed all of the recent @jnewbery's comments",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/706081630/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/706088223",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-706088223",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 706088223,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNjA4ODIyMw==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-09T09:56:46Z",
    "updated_at": "2020-10-09T09:56:46Z",
    "author_association": "MEMBER",
    "body": "Code review ACK d77ae88b5e",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/706088223/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/706128366",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-706128366",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 706128366,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNjEyODM2Ng==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-09T11:32:07Z",
    "updated_at": "2020-10-09T11:32:07Z",
    "author_association": "MEMBER",
    "body": "Rebased d77ae88b5e7f8d6ea817675b7e4a28f80ed5081f -> a490d074b3491427afbd677f5fa635b910f8bb34 ([pr17428.31](https://github.com/hebasto/bitcoin/commits/pr17428.31) -> [pr17428.32](https://github.com/hebasto/bitcoin/commits/pr17428.32)) due to the conflict with #20076.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/706128366/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/706148894",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-706148894",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 706148894,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNjE0ODg5NA==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-09T12:21:22Z",
    "updated_at": "2020-10-09T12:21:22Z",
    "author_association": "MEMBER",
    "body": "code review ACK a490d074b3",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/706148894/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/709505656",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-709505656",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 709505656,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwOTUwNTY1Ng==",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-15T18:19:41Z",
    "updated_at": "2020-10-15T18:19:41Z",
    "author_association": "MEMBER",
    "body": "Code review ACK a490d074b3491427afbd677f5fa635b910f8bb34",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/709505656/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/756641378",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-756641378",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 756641378,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1NjY0MTM3OA==",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-08T09:10:41Z",
    "updated_at": "2021-01-08T09:10:41Z",
    "author_association": "MEMBER",
    "body": "There is a TODO to write release notes for this: https://github.com/bitcoin-core/bitcoin-devwiki/wiki/0.21.0-Release-Notes-Draft#p2p-and-network-changes ",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/756641378/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/756646627",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-756646627",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
    "id": 756646627,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1NjY0NjYyNw==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-08T09:21:45Z",
    "updated_at": "2021-01-08T09:21:45Z",
    "author_association": "MEMBER",
    "body": "@MarcoFalke \r\n> There is a TODO to write release notes for this: https://github.com/bitcoin-core/bitcoin-devwiki/wiki/0.21.0-Release-Notes-Draft#p2p-and-network-changes\r\n\r\nDone.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/756646627/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346539871",
    "pull_request_review_id": 317252129,
    "id": 346539871,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NjUzOTg3MQ==",
    "diff_hunk": "@@ -1863,11 +1863,28 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             // well for sanity.)\n             bool block_relay_only = nOutboundBlockRelay < m_max_outbound_block_relay && !fFeeler && nOutboundFullRelay >= m_max_outbound_full_relay;\n \n+            if (block_relay_only && !m_anchors.empty()) {\n+                addrConnect = m_anchors.back();",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "99d6f6fc6c11c7797dcf232be75d1803d7cacfa1",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think by putting this logic down here, you\u2019re bypassing some important filtering that happens in the loop above, where we skip over some entries that addrMan gives us (for instance, the `IsReachable()\u2018 check).  I think the best thing would be to move this logic up to that loop (similar to the tried table collision selector) so that all those other criteria are still enforced.",
    "created_at": "2019-11-14T20:52:30Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r346539871",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346539871"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r346539871"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346539871/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1867,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348988284",
    "pull_request_review_id": 320757443,
    "id": 348988284,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODk4ODI4NA==",
    "diff_hunk": "@@ -1863,11 +1863,28 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             // well for sanity.)\n             bool block_relay_only = nOutboundBlockRelay < m_max_outbound_block_relay && !fFeeler && nOutboundFullRelay >= m_max_outbound_full_relay;\n \n+            if (block_relay_only && !m_anchors.empty()) {\n+                addrConnect = m_anchors.back();",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "99d6f6fc6c11c7797dcf232be75d1803d7cacfa1",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done.",
    "created_at": "2019-11-21T09:53:23Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r348988284",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348988284"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r348988284"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348988284/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1867,
    "side": "RIGHT",
    "in_reply_to_id": 346539871
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/367057240",
    "pull_request_review_id": 343456401,
    "id": 367057240,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzA1NzI0MA==",
    "diff_hunk": "@@ -2176,12 +2176,19 @@ void CConnman::SetNetworkActive(bool active)\n     uiInterface.NotifyNetworkActiveChanged(fNetworkActive);\n }\n \n-CConnman::CConnman(uint64_t nSeed0In, uint64_t nSeed1In) : nSeed0(nSeed0In), nSeed1(nSeed1In)\n+CConnman::CConnman(uint64_t nSeed0In, uint64_t nSeed1In)\n+    : m_anchors_db_path{GetDataDir() / \"anchors.dat\"}, nSeed0(nSeed0In), nSeed1(nSeed1In)\n {\n     SetTryNewOutboundPeer(false);\n \n     Options connOptions;\n     Init(connOptions);\n+\n+    m_anchors = ReadAnchors(m_anchors_db_path);\n+    if (m_anchors.size() > m_max_outbound_block_relay) {\n+        // Keep our policy safe.\n+        m_anchors.clear();",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 16,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "ea5a307eaf1a2325b33df6a2a35ea6df783f4e6b",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Why clear the whole instead of picking randomly `m_max_outbound_block_relay` among the anchors set? If one of our most recent anchors isn't reliable we should be allowed to pick up among older anchors to still of the counter-measure. ",
    "created_at": "2020-01-15T19:14:13Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r367057240",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/367057240"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r367057240"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/367057240/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2190,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/367058564",
    "pull_request_review_id": 343456401,
    "id": 367058564,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzA1ODU2NA==",
    "diff_hunk": "@@ -2176,12 +2176,19 @@ void CConnman::SetNetworkActive(bool active)\n     uiInterface.NotifyNetworkActiveChanged(fNetworkActive);\n }\n \n-CConnman::CConnman(uint64_t nSeed0In, uint64_t nSeed1In) : nSeed0(nSeed0In), nSeed1(nSeed1In)\n+CConnman::CConnman(uint64_t nSeed0In, uint64_t nSeed1In)\n+    : m_anchors_db_path{GetDataDir() / \"anchors.dat\"}, nSeed0(nSeed0In), nSeed1(nSeed1In)\n {\n     SetTryNewOutboundPeer(false);\n \n     Options connOptions;\n     Init(connOptions);\n+\n+    m_anchors = ReadAnchors(m_anchors_db_path);",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 13,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "ea5a307eaf1a2325b33df6a2a35ea6df783f4e6b",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: isn't cleaner to avoid read() in CConnman constructor and instead do it in CConnman::Start like we do for peers.dat?",
    "created_at": "2020-01-15T19:17:03Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r367058564",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/367058564"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r367058564"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/367058564/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2187,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/367073224",
    "pull_request_review_id": 343456401,
    "id": 367073224,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzA3MzIyNA==",
    "diff_hunk": "@@ -1805,11 +1807,24 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             if (nTries > 100)\n                 break;\n \n-            CAddrInfo addr = addrman.SelectTriedCollision();\n+            CAddress addr;\n+            if (!m_anchors.empty() && (nOutboundBlockRelay < m_max_outbound_block_relay) && !fFeeler) {",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 15,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "d405145e8f935b454ba77e23cf7327515b85151e",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "May we check here also `nOutboundFullRelay`, and so keep same connection order, i.e full-relay then block-only or is there any advantage to invert order ?",
    "created_at": "2020-01-15T19:48:43Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r367073224",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/367073224"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r367073224"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/367073224/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1898,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/367081001",
    "pull_request_review_id": 343456401,
    "id": 367081001,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzA4MTAwMQ==",
    "diff_hunk": "@@ -2088,6 +2088,9 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n                       pfrom->nVersion.load(), pfrom->nStartingHeight,\n                       pfrom->GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom->addr.ToString()) : \"\"),\n                       pfrom->m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\n+            if (!pfrom->m_tx_relay) {\n+                DumpAnchors(connman->m_anchors_db_path, connman->GetBlockRelayNodeAddresses());",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "a41cf3dedb70f418d3003b182ce1d925576161eb",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "What do you think about waiting some time like 24hours or one block announcement before to qualify node as anchor? That would require at least some good behavior from it, that said and may favor too much well-reliable nodes and decay network-wide connectivity..\r\n\r\nnit: you may use scheduler for DumpAnchors like we do for DumpAddresses, that would avoid file syscalls while holding cs_main",
    "created_at": "2020-01-15T20:05:50Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r367081001",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/367081001"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r367081001"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/367081001/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2092,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/369783170",
    "pull_request_review_id": 346876682,
    "id": 369783170,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTc4MzE3MA==",
    "diff_hunk": "@@ -165,3 +165,10 @@ std::vector<CAddress> ReadAnchors(const fs::path& anchors_db_path)\n \n     return ret;\n }\n+\n+void DumpAnchors(const fs::path& anchors_db_path, const std::vector<CAddress>& anchors)\n+{\n+    int64_t start = GetTimeMillis();\n+    SerializeFileDB(\"anchors\", anchors_db_path, anchors);\n+    LogPrintf(\"Flushed %d anchor outbound peer addresses to anchors.dat in %d ms\\n\", anchors.size(), GetTimeMillis() - start);",
    "path": "src/addrdb.cpp",
    "position": null,
    "original_position": 9,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "161dfb8aa4c534c2faea403bd515a26d10c952fe",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Can use [`logging/timer.h`](https://github.com/bitcoin/bitcoin/blob/master/src/logging/timer.h#L96-L101) if you care to. [(example)](https://github.com/bitcoin/bitcoin/blob/master/src/validation.cpp#L2296)",
    "created_at": "2020-01-22T20:21:48Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r369783170",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/369783170"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r369783170"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/369783170/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 173,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/369789242",
    "pull_request_review_id": 346876682,
    "id": 369789242,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTc4OTI0Mg==",
    "diff_hunk": "@@ -2088,6 +2088,9 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n                       pfrom->nVersion.load(), pfrom->nStartingHeight,\n                       pfrom->GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom->addr.ToString()) : \"\"),\n                       pfrom->m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\n+            if (!pfrom->m_tx_relay) {\n+                DumpAnchors(connman->m_anchors_db_path, connman->GetBlockRelayNodeAddresses());",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "a41cf3dedb70f418d3003b182ce1d925576161eb",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I like the idea of moving this onto the scheduler thread, but not a huge deal given this only happens once per blocks-only connection.",
    "created_at": "2020-01-22T20:36:26Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r369789242",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/369789242"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r369789242"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/369789242/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2092,
    "side": "RIGHT",
    "in_reply_to_id": 367081001
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/371009058",
    "pull_request_review_id": 348387692,
    "id": 371009058,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTAwOTA1OA==",
    "diff_hunk": "@@ -2176,12 +2176,19 @@ void CConnman::SetNetworkActive(bool active)\n     uiInterface.NotifyNetworkActiveChanged(fNetworkActive);\n }\n \n-CConnman::CConnman(uint64_t nSeed0In, uint64_t nSeed1In) : nSeed0(nSeed0In), nSeed1(nSeed1In)\n+CConnman::CConnman(uint64_t nSeed0In, uint64_t nSeed1In)\n+    : m_anchors_db_path{GetDataDir() / \"anchors.dat\"}, nSeed0(nSeed0In), nSeed1(nSeed1In)\n {\n     SetTryNewOutboundPeer(false);\n \n     Options connOptions;\n     Init(connOptions);\n+\n+    m_anchors = ReadAnchors(m_anchors_db_path);",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 13,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "ea5a307eaf1a2325b33df6a2a35ea6df783f4e6b",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "~I'd prefer to initialize `m_anchors` member in constructor.~",
    "created_at": "2020-01-26T15:46:26Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r371009058",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/371009058"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r371009058"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/371009058/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2187,
    "side": "RIGHT",
    "in_reply_to_id": 367058564
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/371009626",
    "pull_request_review_id": 348388178,
    "id": 371009626,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTAwOTYyNg==",
    "diff_hunk": "@@ -2176,12 +2176,19 @@ void CConnman::SetNetworkActive(bool active)\n     uiInterface.NotifyNetworkActiveChanged(fNetworkActive);\n }\n \n-CConnman::CConnman(uint64_t nSeed0In, uint64_t nSeed1In) : nSeed0(nSeed0In), nSeed1(nSeed1In)\n+CConnman::CConnman(uint64_t nSeed0In, uint64_t nSeed1In)\n+    : m_anchors_db_path{GetDataDir() / \"anchors.dat\"}, nSeed0(nSeed0In), nSeed1(nSeed1In)\n {\n     SetTryNewOutboundPeer(false);\n \n     Options connOptions;\n     Init(connOptions);\n+\n+    m_anchors = ReadAnchors(m_anchors_db_path);\n+    if (m_anchors.size() > m_max_outbound_block_relay) {\n+        // Keep our policy safe.\n+        m_anchors.clear();",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 16,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "ea5a307eaf1a2325b33df6a2a35ea6df783f4e6b",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "The worst case is assumed. If condition `m_anchors.size() > m_max_outbound_block_relay` is satisfied, we could suppose that the `anchors.dat` file is wrong or corrupted.",
    "created_at": "2020-01-26T15:53:38Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r371009626",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/371009626"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r371009626"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/371009626/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2190,
    "side": "RIGHT",
    "in_reply_to_id": 367057240
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/371020152",
    "pull_request_review_id": 348396951,
    "id": 371020152,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTAyMDE1Mg==",
    "diff_hunk": "@@ -1805,11 +1807,24 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             if (nTries > 100)\n                 break;\n \n-            CAddrInfo addr = addrman.SelectTriedCollision();\n+            CAddress addr;\n+            if (!m_anchors.empty() && (nOutboundBlockRelay < m_max_outbound_block_relay) && !fFeeler) {",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 15,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "d405145e8f935b454ba77e23cf7327515b85151e",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "The order is not inverted. The first target \"anchors\" is added, and was not present before, i.e., the new order is \"anchors\" then \"full-relay\" then \"block-relay-only\".\r\nIf anchors would not the first, they could be connected as other type nodes, and anchoring could not happen.",
    "created_at": "2020-01-26T18:31:04Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r371020152",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/371020152"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r371020152"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/371020152/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1898,
    "side": "RIGHT",
    "in_reply_to_id": 367073224
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/371021403",
    "pull_request_review_id": 348397982,
    "id": 371021403,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTAyMTQwMw==",
    "diff_hunk": "@@ -2088,6 +2088,9 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n                       pfrom->nVersion.load(), pfrom->nStartingHeight,\n                       pfrom->GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom->addr.ToString()) : \"\"),\n                       pfrom->m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\n+            if (!pfrom->m_tx_relay) {\n+                DumpAnchors(connman->m_anchors_db_path, connman->GetBlockRelayNodeAddresses());",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "a41cf3dedb70f418d3003b182ce1d925576161eb",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> nit: you may use scheduler for DumpAnchors like we do for DumpAddresses, that would avoid file syscalls while holding cs_main\r\n\r\n> I like the idea of moving this onto the scheduler thread, but not a huge deal given this only happens once per blocks-only connection.\r\n\r\nAgree that using `CScheduler.scheduleFromNow()` for `DumpAnchors` is an improvement. Let's leave it for follow ups.",
    "created_at": "2020-01-26T18:52:21Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r371021403",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/371021403"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r371021403"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/371021403/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2092,
    "side": "RIGHT",
    "in_reply_to_id": 367081001
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/371023351",
    "pull_request_review_id": 348399659,
    "id": 371023351,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTAyMzM1MQ==",
    "diff_hunk": "@@ -2176,12 +2176,19 @@ void CConnman::SetNetworkActive(bool active)\n     uiInterface.NotifyNetworkActiveChanged(fNetworkActive);\n }\n \n-CConnman::CConnman(uint64_t nSeed0In, uint64_t nSeed1In) : nSeed0(nSeed0In), nSeed1(nSeed1In)\n+CConnman::CConnman(uint64_t nSeed0In, uint64_t nSeed1In)\n+    : m_anchors_db_path{GetDataDir() / \"anchors.dat\"}, nSeed0(nSeed0In), nSeed1(nSeed1In)\n {\n     SetTryNewOutboundPeer(false);\n \n     Options connOptions;\n     Init(connOptions);\n+\n+    m_anchors = ReadAnchors(m_anchors_db_path);",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 13,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "ea5a307eaf1a2325b33df6a2a35ea6df783f4e6b",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done in the latest push.",
    "created_at": "2020-01-26T19:24:53Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r371023351",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/371023351"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r371023351"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/371023351/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2187,
    "side": "RIGHT",
    "in_reply_to_id": 367058564
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/371023391",
    "pull_request_review_id": 348399689,
    "id": 371023391,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTAyMzM5MQ==",
    "diff_hunk": "@@ -165,3 +165,10 @@ std::vector<CAddress> ReadAnchors(const fs::path& anchors_db_path)\n \n     return ret;\n }\n+\n+void DumpAnchors(const fs::path& anchors_db_path, const std::vector<CAddress>& anchors)\n+{\n+    int64_t start = GetTimeMillis();\n+    SerializeFileDB(\"anchors\", anchors_db_path, anchors);\n+    LogPrintf(\"Flushed %d anchor outbound peer addresses to anchors.dat in %d ms\\n\", anchors.size(), GetTimeMillis() - start);",
    "path": "src/addrdb.cpp",
    "position": null,
    "original_position": 9,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "161dfb8aa4c534c2faea403bd515a26d10c952fe",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks. Done in the latest push.",
    "created_at": "2020-01-26T19:25:36Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r371023391",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/371023391"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r371023391"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/371023391/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 173,
    "side": "RIGHT",
    "in_reply_to_id": 369783170
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/372715777",
    "pull_request_review_id": 350530344,
    "id": 372715777,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjcxNTc3Nw==",
    "diff_hunk": "@@ -2176,12 +2176,19 @@ void CConnman::SetNetworkActive(bool active)\n     uiInterface.NotifyNetworkActiveChanged(fNetworkActive);\n }\n \n-CConnman::CConnman(uint64_t nSeed0In, uint64_t nSeed1In) : nSeed0(nSeed0In), nSeed1(nSeed1In)\n+CConnman::CConnman(uint64_t nSeed0In, uint64_t nSeed1In)\n+    : m_anchors_db_path{GetDataDir() / \"anchors.dat\"}, nSeed0(nSeed0In), nSeed1(nSeed1In)\n {\n     SetTryNewOutboundPeer(false);\n \n     Options connOptions;\n     Init(connOptions);\n+\n+    m_anchors = ReadAnchors(m_anchors_db_path);\n+    if (m_anchors.size() > m_max_outbound_block_relay) {\n+        // Keep our policy safe.\n+        m_anchors.clear();",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 16,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "ea5a307eaf1a2325b33df6a2a35ea6df783f4e6b",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "No you're melting 2 different problems, tracking the anchors set and connecting to peers among this one. I don't understand why reaching the `m_max_outbound_block_relay` means we have to delete our whole repository of maybe-good anchors peers. \r\n\r\nIn the scenario you're aiming, if victim restarts and the 2 anchors peers are honest but unreliable, you're going to drop them and pick maybe new outbound peers from attacker-provided ones. You can avoid this if you have a bigger set of _potential_ anchor peers.\r\n",
    "created_at": "2020-01-30T01:12:22Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r372715777",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/372715777"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r372715777"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/372715777/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2190,
    "side": "RIGHT",
    "in_reply_to_id": 367057240
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/372718282",
    "pull_request_review_id": 350533306,
    "id": 372718282,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjcxODI4Mg==",
    "diff_hunk": "@@ -1805,11 +1807,24 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             if (nTries > 100)\n                 break;\n \n-            CAddrInfo addr = addrman.SelectTriedCollision();\n+            CAddress addr;\n+            if (!m_anchors.empty() && (nOutboundBlockRelay < m_max_outbound_block_relay) && !fFeeler) {",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 15,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "d405145e8f935b454ba77e23cf7327515b85151e",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "But anchors nodes are block-only, so now you have block-only-as-anchors, full-relay, block-only-classics. You can still test addresses returned from `addrman` against `m_anchors` andon continue in case of equality to avoid the problem you're describing, but don't think that changes something, do we favor first-connected nodes in anyway ?",
    "created_at": "2020-01-30T01:22:56Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r372718282",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/372718282"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r372718282"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/372718282/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1898,
    "side": "RIGHT",
    "in_reply_to_id": 367073224
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385394617",
    "pull_request_review_id": 366028047,
    "id": 385394617,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM5NDYxNw==",
    "diff_hunk": "@@ -2278,6 +2315,14 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    m_anchors_db_path = GetDataDir() / \"anchors.dat\";\n+    m_anchors = ReadAnchors(m_anchors_db_path);\n+    LogPrintf(\"Loaded %i addresses from %s\\n\", m_anchors.size(), m_anchors_db_path.filename());\n+    if (m_anchors.size() > (size_t)m_max_outbound_block_relay) {",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 122,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "780107e41fe86e31392b3ef76b917e623483259f",
    "user": {
      "login": "amitiuttarwar",
      "id": 1500952,
      "node_id": "MDQ6VXNlcjE1MDA5NTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/amitiuttarwar",
      "html_url": "https://github.com/amitiuttarwar",
      "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
      "following_url": "https://api.github.com/users/amitiuttarwar/following{/other_user}",
      "gists_url": "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
      "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
      "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
      "events_url": "https://api.github.com/users/amitiuttarwar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "consider introducing a new constant (eg. `m_max_anchors`) that currently matches the value of `m_max_outbound_block_relay`, so if we change the number of block-relay-only connections in the future we have to explicitly decide if we want to increase our anchor connections as well\r\n\r\n-> limiting max anchors mentioned [here](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-554073351), potential downside of anchoring all blocks-only connections mentioned [here](https://github.com/bitcoin/bitcoin/issues/17326#issuecomment-550521262) \r\n",
    "created_at": "2020-02-27T21:56:23Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r385394617",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385394617"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r385394617"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385394617/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2321,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385395410",
    "pull_request_review_id": 366028047,
    "id": 385395410,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM5NTQxMA==",
    "diff_hunk": "@@ -2390,6 +2435,7 @@ void CConnman::Stop()\n     if (fAddressesInitialized)\n     {\n         DumpAddresses();\n+        DumpAnchors(m_anchors_db_path, GetBlockRelayNodeAddresses());",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 134,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "780107e41fe86e31392b3ef76b917e623483259f",
    "user": {
      "login": "amitiuttarwar",
      "id": 1500952,
      "node_id": "MDQ6VXNlcjE1MDA5NTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/amitiuttarwar",
      "html_url": "https://github.com/amitiuttarwar",
      "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
      "following_url": "https://api.github.com/users/amitiuttarwar/following{/other_user}",
      "gists_url": "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
      "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
      "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
      "events_url": "https://api.github.com/users/amitiuttarwar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "and pass the first `m_max_anchors` elements of `GetBlockRelayNodeAddresses` here.",
    "created_at": "2020-02-27T21:58:07Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r385395410",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385395410"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r385395410"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385395410/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2438,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385396664",
    "pull_request_review_id": 366028047,
    "id": 385396664,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM5NjY2NA==",
    "diff_hunk": "@@ -2278,6 +2315,14 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    m_anchors_db_path = GetDataDir() / \"anchors.dat\";\n+    m_anchors = ReadAnchors(m_anchors_db_path);",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 120,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "780107e41fe86e31392b3ef76b917e623483259f",
    "user": {
      "login": "amitiuttarwar",
      "id": 1500952,
      "node_id": "MDQ6VXNlcjE1MDA5NTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/amitiuttarwar",
      "html_url": "https://github.com/amitiuttarwar",
      "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
      "following_url": "https://api.github.com/users/amitiuttarwar/following{/other_user}",
      "gists_url": "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
      "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
      "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
      "events_url": "https://api.github.com/users/amitiuttarwar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> It seems we need to re-write the anchors.dat file every time when another anchor is dropped in m_anchors.pop_back();, no?\r\n\r\nI think it would be simpler to delete the contents of the whole file once you have loaded the anchors into memory. Eg. After you read anchors here, invoke a method that wipes `anchors.dat`. \r\n\r\nThis way you can avoid adding per-anchor logic. ",
    "created_at": "2020-02-27T22:00:58Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r385396664",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385396664"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r385396664"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385396664/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2415,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385404543",
    "pull_request_review_id": 366040484,
    "id": 385404543,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQwNDU0Mw==",
    "diff_hunk": "@@ -2176,12 +2176,19 @@ void CConnman::SetNetworkActive(bool active)\n     uiInterface.NotifyNetworkActiveChanged(fNetworkActive);\n }\n \n-CConnman::CConnman(uint64_t nSeed0In, uint64_t nSeed1In) : nSeed0(nSeed0In), nSeed1(nSeed1In)\n+CConnman::CConnman(uint64_t nSeed0In, uint64_t nSeed1In)\n+    : m_anchors_db_path{GetDataDir() / \"anchors.dat\"}, nSeed0(nSeed0In), nSeed1(nSeed1In)\n {\n     SetTryNewOutboundPeer(false);\n \n     Options connOptions;\n     Init(connOptions);\n+\n+    m_anchors = ReadAnchors(m_anchors_db_path);\n+    if (m_anchors.size() > m_max_outbound_block_relay) {\n+        // Keep our policy safe.\n+        m_anchors.clear();",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 16,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "ea5a307eaf1a2325b33df6a2a35ea6df783f4e6b",
    "user": {
      "login": "amitiuttarwar",
      "id": 1500952,
      "node_id": "MDQ6VXNlcjE1MDA5NTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/amitiuttarwar",
      "html_url": "https://github.com/amitiuttarwar",
      "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
      "following_url": "https://api.github.com/users/amitiuttarwar/following{/other_user}",
      "gists_url": "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
      "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
      "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
      "events_url": "https://api.github.com/users/amitiuttarwar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "the logic implemented in this PR is minimal, and I think that makes sense for keeping it simple to reason about. \r\n\r\nwith this implementation, its possible for an attacker to poison the anchors and execute an eclipse attack, its just increases the cost of doing so. \r\n\r\nuntil we develop more robust logic around ensuring our anchors are not malicious, I don't think it makes sense to give priority to all historic anchors. I think it could sometimes be beneficial but other times degrade security, eg. if you historically were connected to a malicious peer but now your addrman is clear. ",
    "created_at": "2020-02-27T22:19:07Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r385404543",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385404543"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r385404543"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385404543/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2190,
    "side": "RIGHT",
    "in_reply_to_id": 367057240
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386686000",
    "pull_request_review_id": 367571934,
    "id": 386686000,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY4NjAwMA==",
    "diff_hunk": "@@ -95,4 +95,10 @@ class CBanDB\n     bool Read(banmap_t& banSet);\n };\n \n+/** Read the anchor IP address database (anchors.dat) */",
    "path": "src/addrdb.h",
    "position": null,
    "original_position": 16,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "780107e41fe86e31392b3ef76b917e623483259f",
    "user": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjahr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: would have been nice to add a little more context information on the purpose of these anchors",
    "created_at": "2020-03-02T22:20:11Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r386686000",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386686000"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r386686000"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386686000/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 98,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432917391",
    "pull_request_review_id": 421467710,
    "id": 432917391,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkxNzM5MQ==",
    "diff_hunk": "@@ -2278,6 +2315,14 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    m_anchors_db_path = GetDataDir() / \"anchors.dat\";\n+    m_anchors = ReadAnchors(m_anchors_db_path);",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 120,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "780107e41fe86e31392b3ef76b917e623483259f",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "If a node crash happens between wiping `anchors.dat` and creating a new one, the anchors data would be lost.",
    "created_at": "2020-05-31T07:08:55Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r432917391",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432917391"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r432917391"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432917391/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2415,
    "side": "RIGHT",
    "in_reply_to_id": 385396664
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432935166",
    "pull_request_review_id": 421483521,
    "id": 432935166,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkzNTE2Ng==",
    "diff_hunk": "@@ -95,4 +95,10 @@ class CBanDB\n     bool Read(banmap_t& banSet);\n };\n \n+/** Read the anchor IP address database (anchors.dat) */",
    "path": "src/addrdb.h",
    "position": null,
    "original_position": 16,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "780107e41fe86e31392b3ef76b917e623483259f",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "[Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-636453433).",
    "created_at": "2020-05-31T11:03:15Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r432935166",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432935166"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r432935166"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432935166/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 98,
    "side": "RIGHT",
    "in_reply_to_id": 386686000
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432935189",
    "pull_request_review_id": 421483546,
    "id": 432935189,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkzNTE4OQ==",
    "diff_hunk": "@@ -2278,6 +2315,14 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    m_anchors_db_path = GetDataDir() / \"anchors.dat\";\n+    m_anchors = ReadAnchors(m_anchors_db_path);\n+    LogPrintf(\"Loaded %i addresses from %s\\n\", m_anchors.size(), m_anchors_db_path.filename());\n+    if (m_anchors.size() > (size_t)m_max_outbound_block_relay) {",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 122,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "780107e41fe86e31392b3ef76b917e623483259f",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "[Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-636453433).",
    "created_at": "2020-05-31T11:03:35Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r432935189",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432935189"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r432935189"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432935189/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2321,
    "side": "RIGHT",
    "in_reply_to_id": 385394617
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448267907",
    "pull_request_review_id": 440743009,
    "id": 448267907,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODI2NzkwNw==",
    "diff_hunk": "@@ -1951,6 +1951,19 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n     }\n }\n \n+std::vector<CAddress> CConnman::GetBlockRelayNodeAddresses() const",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "cfe30185df561da9afb1258dc84ccd9618614617",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This function name doesn't reflect that it's inbound-only",
    "created_at": "2020-07-01T10:24:54Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r448267907",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448267907"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r448267907"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448267907/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1954,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448268314",
    "pull_request_review_id": 440743510,
    "id": 448268314,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODI2ODMxNA==",
    "diff_hunk": "@@ -1951,6 +1951,19 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n     }\n }\n \n+std::vector<CAddress> CConnman::GetBlockRelayNodeAddresses() const",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "cfe30185df561da9afb1258dc84ccd9618614617",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Maybe it actually should be named \"GetCurrentAnchors\"",
    "created_at": "2020-07-01T10:25:39Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r448268314",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448268314"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r448268314"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448268314/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1954,
    "side": "RIGHT",
    "in_reply_to_id": 448267907
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448269036",
    "pull_request_review_id": 440744544,
    "id": 448269036,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODI2OTAzNg==",
    "diff_hunk": "@@ -2411,6 +2411,10 @@ bool ProcessMessage(CNode& pfrom, const std::string& msg_type, CDataStream& vRec\n                       pfrom.nVersion.load(), pfrom.nStartingHeight,\n                       pfrom.GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom.addr.ToString()) : \"\"),\n                       pfrom.m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\n+            if (!pfrom.m_tx_relay) {\n+                std::vector<CAddress> anchors_to_save = connman->GetBlockRelayNodeAddresses();\n+                DumpAnchors(connman->GetAnchorsDbPath(), anchors_to_save);",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 6,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "bd39249ea359e5349b93438e79ffa6a81a10ee51",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Wait, why is this done on VERACK? Even if this was discussed in the PR, a comment would help.",
    "created_at": "2020-07-01T10:27:04Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r448269036",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448269036"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r448269036"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448269036/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2416,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448302491",
    "pull_request_review_id": 440788275,
    "id": 448302491,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMwMjQ5MQ==",
    "diff_hunk": "@@ -2411,6 +2411,12 @@ bool ProcessMessage(CNode& pfrom, const std::string& msg_type, CDataStream& vRec\n                       pfrom.nVersion.load(), pfrom.nStartingHeight,\n                       pfrom.GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom.addr.ToString()) : \"\"),\n                       pfrom.m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\n+            if (!pfrom.m_tx_relay) {\n+                std::vector<CAddress> anchors_to_save = connman->GetBlockRelayNodeAddresses();\n+                const std::vector<CAddress> anchors_not_tried = connman->GetAnchors();",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 6,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "1d9264e296f1a03abbfa6c30363628a85cf33ce4",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following{/other_user}",
      "gists_url": "https://api.github.com/users/naumenkogs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I'm a bit confused of what's going on here. I guess this is supposed to address the issue of reconnecting to the same anchor on many restarts, but it would really use some extra comments.",
    "created_at": "2020-07-01T11:36:07Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r448302491",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448302491"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r448302491"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448302491/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2416,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449549043",
    "pull_request_review_id": 442368051,
    "id": 449549043,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTU0OTA0Mw==",
    "diff_hunk": "@@ -2411,6 +2411,10 @@ bool ProcessMessage(CNode& pfrom, const std::string& msg_type, CDataStream& vRec\n                       pfrom.nVersion.load(), pfrom.nStartingHeight,\n                       pfrom.GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom.addr.ToString()) : \"\"),\n                       pfrom.m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\n+            if (!pfrom.m_tx_relay) {\n+                std::vector<CAddress> anchors_to_save = connman->GetBlockRelayNodeAddresses();\n+                DumpAnchors(connman->GetAnchorsDbPath(), anchors_to_save);",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 6,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "bd39249ea359e5349b93438e79ffa6a81a10ee51",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> Wait, why is this done on VERACK?\r\n\r\nIt is a point where we get know that an outbound connection to a block-relay-only peer has been established.\r\n\r\n> Even if this was discussed in the PR, a comment would help.\r\n\r\nWhat kind of comment do you expect to see here?",
    "created_at": "2020-07-03T12:06:34Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449549043",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449549043"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449549043"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449549043/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2416,
    "side": "RIGHT",
    "in_reply_to_id": 448269036
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449553429",
    "pull_request_review_id": 442373706,
    "id": 449553429,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTU1MzQyOQ==",
    "diff_hunk": "@@ -2411,6 +2411,12 @@ bool ProcessMessage(CNode& pfrom, const std::string& msg_type, CDataStream& vRec\n                       pfrom.nVersion.load(), pfrom.nStartingHeight,\n                       pfrom.GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom.addr.ToString()) : \"\"),\n                       pfrom.m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\n+            if (!pfrom.m_tx_relay) {\n+                std::vector<CAddress> anchors_to_save = connman->GetBlockRelayNodeAddresses();\n+                const std::vector<CAddress> anchors_not_tried = connman->GetAnchors();",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 6,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "1d9264e296f1a03abbfa6c30363628a85cf33ce4",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I've tried to avoid any confusion by meaningful naming variables, but failed :)\r\nThe node dumps:\r\n- anchors that are connected right now\r\n- anchors that were known at startup but have not tried to connect to yet\r\n\r\nThe latter set quickly gets empty after startup.",
    "created_at": "2020-07-03T12:17:32Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449553429",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449553429"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449553429"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449553429/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2416,
    "side": "RIGHT",
    "in_reply_to_id": 448302491
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449556623",
    "pull_request_review_id": 442377885,
    "id": 449556623,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTU1NjYyMw==",
    "diff_hunk": "@@ -1951,6 +1951,19 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n     }\n }\n \n+std::vector<CAddress> CConnman::GetBlockRelayNodeAddresses() const",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "cfe30185df561da9afb1258dc84ccd9618614617",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> This function name doesn't reflect that it's inbound-only\r\n\r\nYou mean \"outbound\"?",
    "created_at": "2020-07-03T12:25:38Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449556623",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449556623"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449556623"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449556623/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1954,
    "side": "RIGHT",
    "in_reply_to_id": 448267907
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449568124",
    "pull_request_review_id": 442392872,
    "id": 449568124,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTU2ODEyNA==",
    "diff_hunk": "@@ -1951,6 +1951,19 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n     }\n }\n \n+std::vector<CAddress> CConnman::GetBlockRelayNodeAddresses() const",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "cfe30185df561da9afb1258dc84ccd9618614617",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> Maybe it actually should be named \"GetCurrentAnchors\"\r\n\r\n[Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-653533271).",
    "created_at": "2020-07-03T12:52:44Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449568124",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449568124"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449568124"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449568124/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1954,
    "side": "RIGHT",
    "in_reply_to_id": 448267907
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449568334",
    "pull_request_review_id": 442393112,
    "id": 449568334,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTU2ODMzNA==",
    "diff_hunk": "@@ -2411,6 +2411,12 @@ bool ProcessMessage(CNode& pfrom, const std::string& msg_type, CDataStream& vRec\n                       pfrom.nVersion.load(), pfrom.nStartingHeight,\n                       pfrom.GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom.addr.ToString()) : \"\"),\n                       pfrom.m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\n+            if (!pfrom.m_tx_relay) {\n+                std::vector<CAddress> anchors_to_save = connman->GetBlockRelayNodeAddresses();\n+                const std::vector<CAddress> anchors_not_tried = connman->GetAnchors();",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 6,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "1d9264e296f1a03abbfa6c30363628a85cf33ce4",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "[Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-653533271).",
    "created_at": "2020-07-03T12:53:10Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449568334",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449568334"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449568334"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449568334/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2416,
    "side": "RIGHT",
    "in_reply_to_id": 448302491
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449647325",
    "pull_request_review_id": 442494304,
    "id": 449647325,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY0NzMyNQ==",
    "diff_hunk": "@@ -1946,9 +1958,34 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             // well for sanity.)\n             bool block_relay_only = nOutboundBlockRelay < m_max_outbound_block_relay && !fFeeler && nOutboundFullRelay >= m_max_outbound_full_relay;\n \n+            if (anchor) {\n+                block_relay_only = true;\n+                LogPrintf(\"Trying to make an anchor connection to %s\\n\", addrConnect.ToString());\n+            }\n+\n             OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant, nullptr, false, fFeeler, false, block_relay_only);\n+\n+            if (anchor) {\n+                const auto v = GetCurrentAnchors();\n+                if (std::find(v.begin(), v.end(), addrConnect) == v.end()) {\n+                    LogPrintf(\"The anchor connection to %s FAILED\\n\", addrConnect.ToString());\n+                }\n+            }\n+        }\n+    }\n+}\n+\n+std::vector<CAddress> CConnman::GetCurrentAnchors() const\n+{\n+    std::vector<CAddress> ret;\n+    LOCK(cs_vNodes);\n+    for (const CNode* pnode : vNodes) {\n+        if (!pnode->fInbound && !pnode->m_manual_connection && !pnode->m_tx_relay) {\n+            ret.push_back(pnode->addr);\n         }\n     }\n+\n+    return ret;",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 109,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "0a74c7c3686d4b03a27815c6107b3300954641cc",
    "user": {
      "login": "pinheadmz",
      "id": 2084648,
      "node_id": "MDQ6VXNlcjIwODQ2NDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pinheadmz",
      "html_url": "https://github.com/pinheadmz",
      "followers_url": "https://api.github.com/users/pinheadmz/followers",
      "following_url": "https://api.github.com/users/pinheadmz/following{/other_user}",
      "gists_url": "https://api.github.com/users/pinheadmz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
      "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
      "repos_url": "https://api.github.com/users/pinheadmz/repos",
      "events_url": "https://api.github.com/users/pinheadmz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "2 questions about this:\r\n\r\n1. Is there a possible race condition where `GetCurrentAnchors()` is called before the connection to the anchor node is complete? Or before the handshake is complete? Like is it possible that the test succeeds, no message is printed to the log, but then the connection still fails due to the peer not responding, etc.?\r\n\r\n2. (and maybe this answers my first question) is there a better way of determining connection success than locking `cs_vNodes` and searching for the addr? Like, is there any sense in modifying `OpenNetworkConnection()` to return a success value?",
    "created_at": "2020-07-03T16:07:18Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449647325",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449647325"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449647325"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449647325/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 1978,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 2054,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449650363",
    "pull_request_review_id": 442497942,
    "id": 449650363,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY1MDM2Mw==",
    "diff_hunk": "@@ -2348,6 +2385,22 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    m_anchors_db_path = GetDataDir() / \"anchors.dat\";\n+    m_anchors = ReadAnchors(m_anchors_db_path);\n+    LogPrintf(\"Loaded %i addresses from %s\\n\", m_anchors.size(), m_anchors_db_path.filename());\n+    if (m_anchors.size() > static_cast<size_t>(MAX_BLOCKS_ONLY_ANCHORS)) {\n+        // Keep our policy safe.\n+        m_anchors.clear();\n+    }\n+    // Peers added via -addnode are permanent connections too, therefore we could skip the same number of anchors.\n+    if (static_cast<size_t>(connOptions.m_max_block_relay_anchor) < connOptions.m_added_nodes.size()) {\n+        m_anchors.clear();\n+    } else {\n+        const size_t anchor_num_allowed = static_cast<size_t>(connOptions.m_max_block_relay_anchor) - connOptions.m_added_nodes.size();\n+        if (anchor_num_allowed < m_anchors.size()) m_anchors.resize(anchor_num_allowed);\n+    }\n+    LogPrintf(\"%i block-relay-only anchors will be tried to connect to.\\n\", m_anchors.size());",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 131,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "0a74c7c3686d4b03a27815c6107b3300954641cc",
    "user": {
      "login": "pinheadmz",
      "id": 2084648,
      "node_id": "MDQ6VXNlcjIwODQ2NDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pinheadmz",
      "html_url": "https://github.com/pinheadmz",
      "followers_url": "https://api.github.com/users/pinheadmz/followers",
      "following_url": "https://api.github.com/users/pinheadmz/following{/other_user}",
      "gists_url": "https://api.github.com/users/pinheadmz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
      "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
      "repos_url": "https://api.github.com/users/pinheadmz/repos",
      "events_url": "https://api.github.com/users/pinheadmz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: a bit awkward, maybe `\"%i block-relay-only anchors will be tried for connections.\\n\"` ?",
    "created_at": "2020-07-03T16:17:58Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449650363",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449650363"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449650363"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449650363/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2402,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449665450",
    "pull_request_review_id": 442516073,
    "id": 449665450,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY2NTQ1MA==",
    "diff_hunk": "@@ -1946,9 +1958,34 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             // well for sanity.)\n             bool block_relay_only = nOutboundBlockRelay < m_max_outbound_block_relay && !fFeeler && nOutboundFullRelay >= m_max_outbound_full_relay;\n \n+            if (anchor) {\n+                block_relay_only = true;\n+                LogPrintf(\"Trying to make an anchor connection to %s\\n\", addrConnect.ToString());\n+            }\n+\n             OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant, nullptr, false, fFeeler, false, block_relay_only);\n+\n+            if (anchor) {\n+                const auto v = GetCurrentAnchors();\n+                if (std::find(v.begin(), v.end(), addrConnect) == v.end()) {\n+                    LogPrintf(\"The anchor connection to %s FAILED\\n\", addrConnect.ToString());\n+                }\n+            }\n+        }\n+    }\n+}\n+\n+std::vector<CAddress> CConnman::GetCurrentAnchors() const\n+{\n+    std::vector<CAddress> ret;\n+    LOCK(cs_vNodes);\n+    for (const CNode* pnode : vNodes) {\n+        if (!pnode->fInbound && !pnode->m_manual_connection && !pnode->m_tx_relay) {\n+            ret.push_back(pnode->addr);\n         }\n     }\n+\n+    return ret;",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 109,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "0a74c7c3686d4b03a27815c6107b3300954641cc",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "The `CConnman::OpenNetworkConnection()` call is synchronous, therefore there is no race with the following `CConnman::GetCurrentAnchors()` call, and I couldn't see a reason to modify it.",
    "created_at": "2020-07-03T17:23:23Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449665450",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449665450"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449665450"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449665450/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 1978,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 2054,
    "side": "RIGHT",
    "in_reply_to_id": 449647325
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449667822",
    "pull_request_review_id": 442518858,
    "id": 449667822,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY2NzgyMg==",
    "diff_hunk": "@@ -2348,6 +2385,22 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    m_anchors_db_path = GetDataDir() / \"anchors.dat\";\n+    m_anchors = ReadAnchors(m_anchors_db_path);\n+    LogPrintf(\"Loaded %i addresses from %s\\n\", m_anchors.size(), m_anchors_db_path.filename());\n+    if (m_anchors.size() > static_cast<size_t>(MAX_BLOCKS_ONLY_ANCHORS)) {\n+        // Keep our policy safe.\n+        m_anchors.clear();\n+    }\n+    // Peers added via -addnode are permanent connections too, therefore we could skip the same number of anchors.\n+    if (static_cast<size_t>(connOptions.m_max_block_relay_anchor) < connOptions.m_added_nodes.size()) {\n+        m_anchors.clear();\n+    } else {\n+        const size_t anchor_num_allowed = static_cast<size_t>(connOptions.m_max_block_relay_anchor) - connOptions.m_added_nodes.size();\n+        if (anchor_num_allowed < m_anchors.size()) m_anchors.resize(anchor_num_allowed);\n+    }\n+    LogPrintf(\"%i block-relay-only anchors will be tried to connect to.\\n\", m_anchors.size());",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 131,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "0a74c7c3686d4b03a27815c6107b3300954641cc",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "@pinheadmz Thanks for improving my English :)\r\n\r\n[Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-653631684).",
    "created_at": "2020-07-03T17:35:15Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449667822",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449667822"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449667822"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449667822/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2402,
    "side": "RIGHT",
    "in_reply_to_id": 449650363
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449673605",
    "pull_request_review_id": 442525604,
    "id": 449673605,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY3MzYwNQ==",
    "diff_hunk": "@@ -1946,9 +1958,34 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             // well for sanity.)\n             bool block_relay_only = nOutboundBlockRelay < m_max_outbound_block_relay && !fFeeler && nOutboundFullRelay >= m_max_outbound_full_relay;\n \n+            if (anchor) {\n+                block_relay_only = true;\n+                LogPrintf(\"Trying to make an anchor connection to %s\\n\", addrConnect.ToString());\n+            }\n+\n             OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant, nullptr, false, fFeeler, false, block_relay_only);\n+\n+            if (anchor) {\n+                const auto v = GetCurrentAnchors();\n+                if (std::find(v.begin(), v.end(), addrConnect) == v.end()) {\n+                    LogPrintf(\"The anchor connection to %s FAILED\\n\", addrConnect.ToString());\n+                }\n+            }\n+        }\n+    }\n+}\n+\n+std::vector<CAddress> CConnman::GetCurrentAnchors() const\n+{\n+    std::vector<CAddress> ret;\n+    LOCK(cs_vNodes);\n+    for (const CNode* pnode : vNodes) {\n+        if (!pnode->fInbound && !pnode->m_manual_connection && !pnode->m_tx_relay) {\n+            ret.push_back(pnode->addr);\n         }\n     }\n+\n+    return ret;",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 109,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "0a74c7c3686d4b03a27815c6107b3300954641cc",
    "user": {
      "login": "pinheadmz",
      "id": 2084648,
      "node_id": "MDQ6VXNlcjIwODQ2NDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pinheadmz",
      "html_url": "https://github.com/pinheadmz",
      "followers_url": "https://api.github.com/users/pinheadmz/followers",
      "following_url": "https://api.github.com/users/pinheadmz/following{/other_user}",
      "gists_url": "https://api.github.com/users/pinheadmz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
      "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
      "repos_url": "https://api.github.com/users/pinheadmz/repos",
      "events_url": "https://api.github.com/users/pinheadmz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "What do you think about (2)? Could you get what you need if `OpenNetworkConnection()` returned `true` on success? ",
    "created_at": "2020-07-03T18:05:15Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449673605",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449673605"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449673605"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449673605/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 1978,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 2054,
    "side": "RIGHT",
    "in_reply_to_id": 449647325
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449678070",
    "pull_request_review_id": 442530665,
    "id": 449678070,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY3ODA3MA==",
    "diff_hunk": "@@ -1946,9 +1958,34 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             // well for sanity.)\n             bool block_relay_only = nOutboundBlockRelay < m_max_outbound_block_relay && !fFeeler && nOutboundFullRelay >= m_max_outbound_full_relay;\n \n+            if (anchor) {\n+                block_relay_only = true;\n+                LogPrintf(\"Trying to make an anchor connection to %s\\n\", addrConnect.ToString());\n+            }\n+\n             OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant, nullptr, false, fFeeler, false, block_relay_only);\n+\n+            if (anchor) {\n+                const auto v = GetCurrentAnchors();\n+                if (std::find(v.begin(), v.end(), addrConnect) == v.end()) {\n+                    LogPrintf(\"The anchor connection to %s FAILED\\n\", addrConnect.ToString());\n+                }\n+            }\n+        }\n+    }\n+}\n+\n+std::vector<CAddress> CConnman::GetCurrentAnchors() const\n+{\n+    std::vector<CAddress> ret;\n+    LOCK(cs_vNodes);\n+    for (const CNode* pnode : vNodes) {\n+        if (!pnode->fInbound && !pnode->m_manual_connection && !pnode->m_tx_relay) {\n+            ret.push_back(pnode->addr);\n         }\n     }\n+\n+    return ret;",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 109,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "0a74c7c3686d4b03a27815c6107b3300954641cc",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "`CConnman::OpenNetworkConnection()` has 5 call sites. What benefits of the `bool` return type for all callers? Unsuccessful connection is not an error.\r\n\r\nAnd it seems orthogonal to this PR :)\r\n",
    "created_at": "2020-07-03T18:29:15Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449678070",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449678070"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449678070"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449678070/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 1978,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 2054,
    "side": "RIGHT",
    "in_reply_to_id": 449647325
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449678783",
    "pull_request_review_id": 442531491,
    "id": 449678783,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY3ODc4Mw==",
    "diff_hunk": "@@ -1946,9 +1958,34 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             // well for sanity.)\n             bool block_relay_only = nOutboundBlockRelay < m_max_outbound_block_relay && !fFeeler && nOutboundFullRelay >= m_max_outbound_full_relay;\n \n+            if (anchor) {\n+                block_relay_only = true;\n+                LogPrintf(\"Trying to make an anchor connection to %s\\n\", addrConnect.ToString());\n+            }\n+\n             OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant, nullptr, false, fFeeler, false, block_relay_only);\n+\n+            if (anchor) {\n+                const auto v = GetCurrentAnchors();\n+                if (std::find(v.begin(), v.end(), addrConnect) == v.end()) {\n+                    LogPrintf(\"The anchor connection to %s FAILED\\n\", addrConnect.ToString());\n+                }\n+            }\n+        }\n+    }\n+}\n+\n+std::vector<CAddress> CConnman::GetCurrentAnchors() const\n+{\n+    std::vector<CAddress> ret;\n+    LOCK(cs_vNodes);\n+    for (const CNode* pnode : vNodes) {\n+        if (!pnode->fInbound && !pnode->m_manual_connection && !pnode->m_tx_relay) {\n+            ret.push_back(pnode->addr);\n         }\n     }\n+\n+    return ret;",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 109,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "0a74c7c3686d4b03a27815c6107b3300954641cc",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> ... is there a better way of determining connection success than locking `cs_vNodes` and searching for the addr?\r\n\r\nThe vector being searching in is very small :)\r\n\r\n",
    "created_at": "2020-07-03T18:32:54Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449678783",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449678783"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449678783"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449678783/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 1978,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 2054,
    "side": "RIGHT",
    "in_reply_to_id": 449647325
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449683838",
    "pull_request_review_id": 442537474,
    "id": 449683838,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY4MzgzOA==",
    "diff_hunk": "@@ -1946,9 +1958,34 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             // well for sanity.)\n             bool block_relay_only = nOutboundBlockRelay < m_max_outbound_block_relay && !fFeeler && nOutboundFullRelay >= m_max_outbound_full_relay;\n \n+            if (anchor) {\n+                block_relay_only = true;\n+                LogPrintf(\"Trying to make an anchor connection to %s\\n\", addrConnect.ToString());\n+            }\n+\n             OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant, nullptr, false, fFeeler, false, block_relay_only);\n+\n+            if (anchor) {\n+                const auto v = GetCurrentAnchors();\n+                if (std::find(v.begin(), v.end(), addrConnect) == v.end()) {\n+                    LogPrintf(\"The anchor connection to %s FAILED\\n\", addrConnect.ToString());\n+                }\n+            }\n+        }\n+    }\n+}\n+\n+std::vector<CAddress> CConnman::GetCurrentAnchors() const\n+{\n+    std::vector<CAddress> ret;\n+    LOCK(cs_vNodes);\n+    for (const CNode* pnode : vNodes) {\n+        if (!pnode->fInbound && !pnode->m_manual_connection && !pnode->m_tx_relay) {\n+            ret.push_back(pnode->addr);\n         }\n     }\n+\n+    return ret;",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 109,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "0a74c7c3686d4b03a27815c6107b3300954641cc",
    "user": {
      "login": "pinheadmz",
      "id": 2084648,
      "node_id": "MDQ6VXNlcjIwODQ2NDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pinheadmz",
      "html_url": "https://github.com/pinheadmz",
      "followers_url": "https://api.github.com/users/pinheadmz/followers",
      "following_url": "https://api.github.com/users/pinheadmz/following{/other_user}",
      "gists_url": "https://api.github.com/users/pinheadmz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
      "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
      "repos_url": "https://api.github.com/users/pinheadmz/repos",
      "events_url": "https://api.github.com/users/pinheadmz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "gotcha, thanks!",
    "created_at": "2020-07-03T19:01:53Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449683838",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449683838"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449683838"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449683838/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 1978,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 2054,
    "side": "RIGHT",
    "in_reply_to_id": 449647325
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/465105274",
    "pull_request_review_id": 460884162,
    "id": 465105274,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTEwNTI3NA==",
    "diff_hunk": "@@ -1889,6 +1889,7 @@ bool AppInitMain(const util::Ref& context, NodeContext& node)\n     connOptions.nMaxConnections = nMaxConnections;\n     connOptions.m_max_outbound_full_relay = std::min(MAX_OUTBOUND_FULL_RELAY_CONNECTIONS, connOptions.nMaxConnections);\n     connOptions.m_max_outbound_block_relay = std::min(MAX_BLOCK_RELAY_ONLY_CONNECTIONS, connOptions.nMaxConnections-connOptions.m_max_outbound_full_relay);\n+    connOptions.m_max_block_relay_anchor = std::min(MAX_BLOCK_RELAY_ONLY_ANCHORS, connOptions.m_max_outbound_block_relay);",
    "path": "src/init.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "9445a3411ed589d38cd4eee6714015d065f2b180",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Is there a reason this needs to be a `CConnMan::Options` option? Can this logic exist entirely within CConnMan?",
    "created_at": "2020-08-04T14:44:40Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r465105274",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/465105274"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r465105274"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/465105274/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1910,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/469514016",
    "pull_request_review_id": 466239713,
    "id": 469514016,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTUxNDAxNg==",
    "diff_hunk": "@@ -2482,6 +2482,15 @@ void ProcessMessage(\n                       pfrom.nVersion.load(), pfrom.nStartingHeight,\n                       pfrom.GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom.addr.ToString()) : \"\"),\n                       pfrom.m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\n+            if (!pfrom.m_tx_relay) {",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "d1ef06a1ac45e103eae1bfa5b9162e5cae64e73b",
    "user": {
      "login": "amitiuttarwar",
      "id": 1500952,
      "node_id": "MDQ6VXNlcjE1MDA5NTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/amitiuttarwar",
      "html_url": "https://github.com/amitiuttarwar",
      "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
      "following_url": "https://api.github.com/users/amitiuttarwar/following{/other_user}",
      "gists_url": "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
      "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
      "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
      "events_url": "https://api.github.com/users/amitiuttarwar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think after #19316 we should be able to check directly for the block-relay connection type? ",
    "created_at": "2020-08-12T20:15:18Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r469514016",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/469514016"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r469514016"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/469514016/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2485,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/474508171",
    "pull_request_review_id": 472293669,
    "id": 474508171,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDUwODE3MQ==",
    "diff_hunk": "@@ -2482,6 +2482,15 @@ void ProcessMessage(\n                       pfrom.nVersion.load(), pfrom.nStartingHeight,\n                       pfrom.GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom.addr.ToString()) : \"\"),\n                       pfrom.m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\n+            if (!pfrom.m_tx_relay) {",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "d1ef06a1ac45e103eae1bfa5b9162e5cae64e73b",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "[Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-678109126).",
    "created_at": "2020-08-21T08:15:11Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r474508171",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/474508171"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r474508171"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/474508171/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2485,
    "side": "RIGHT",
    "in_reply_to_id": 469514016
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/474510233",
    "pull_request_review_id": 472295229,
    "id": 474510233,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDUxMDIzMw==",
    "diff_hunk": "@@ -1889,6 +1889,7 @@ bool AppInitMain(const util::Ref& context, NodeContext& node)\n     connOptions.nMaxConnections = nMaxConnections;\n     connOptions.m_max_outbound_full_relay = std::min(MAX_OUTBOUND_FULL_RELAY_CONNECTIONS, connOptions.nMaxConnections);\n     connOptions.m_max_outbound_block_relay = std::min(MAX_BLOCK_RELAY_ONLY_CONNECTIONS, connOptions.nMaxConnections-connOptions.m_max_outbound_full_relay);\n+    connOptions.m_max_block_relay_anchor = std::min(MAX_BLOCK_RELAY_ONLY_ANCHORS, connOptions.m_max_outbound_block_relay);",
    "path": "src/init.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "9445a3411ed589d38cd4eee6714015d065f2b180",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> Is there a reason this needs to be a `CConnMan::Options` option?\r\n\r\nTo be consistent with logic related to other connection limits, i.e., `MAX_OUTBOUND_FULL_RELAY_CONNECTIONS` and `MAX_BLOCK_RELAY_ONLY_CONNECTIONS`.",
    "created_at": "2020-08-21T08:17:29Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r474510233",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/474510233"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r474510233"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/474510233/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1910,
    "side": "RIGHT",
    "in_reply_to_id": 465105274
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/482875198",
    "pull_request_review_id": 481706123,
    "id": 482875198,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjg3NTE5OA==",
    "diff_hunk": "@@ -1889,6 +1889,7 @@ bool AppInitMain(const util::Ref& context, NodeContext& node)\n     connOptions.nMaxConnections = nMaxConnections;\n     connOptions.m_max_outbound_full_relay = std::min(MAX_OUTBOUND_FULL_RELAY_CONNECTIONS, connOptions.nMaxConnections);\n     connOptions.m_max_outbound_block_relay = std::min(MAX_BLOCK_RELAY_ONLY_CONNECTIONS, connOptions.nMaxConnections-connOptions.m_max_outbound_full_relay);\n+    connOptions.m_max_block_relay_anchor = std::min(MAX_BLOCK_RELAY_ONLY_ANCHORS, connOptions.m_max_outbound_block_relay);",
    "path": "src/init.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "9445a3411ed589d38cd4eee6714015d065f2b180",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I don't think we should copy bad patterns just because they already exist in the codebase. `Options` is used to pass parameters into `CConnman`'s initialize function, but `CConnman` already has everything it needs to calculate the max block relay anchor connections (the `MAX_BLOCK_RELAY_ONLY_ANCHORS` constant is defined in net, and `m_max_outbound_block_relay` is already passed in).\r\n\r\nAdding this here is essentially placing logic for how to construct `CConnman` inside init.",
    "created_at": "2020-09-03T10:28:35Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r482875198",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/482875198"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r482875198"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/482875198/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1910,
    "side": "RIGHT",
    "in_reply_to_id": 465105274
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/482877813",
    "pull_request_review_id": 481709523,
    "id": 482877813,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjg3NzgxMw==",
    "diff_hunk": "@@ -2506,6 +2506,15 @@ void ProcessMessage(\n                       pfrom.nVersion.load(), pfrom.nStartingHeight,\n                       pfrom.GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom.addr.ToString()) : \"\"),\n                       pfrom.m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\n+            if (pfrom.IsBlockOnlyConn()) {\n+                // The node dumps:\n+                // - current anchors; and\n+                // - anchors that were known at startup but have not tried for connections yet\n+                auto anchors_to_save = connman.GetCurrentAnchors();",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 8,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "d7482556c98b76e73f64d04400a703fdbb9c189f",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This logic shouldn't be in net_processing. It's all bound up in connection-layer logic rather than application-layer logic. There's nothing here that's specific to the `pnode` that we're in the context of in this `ProcessMessages()` call. I think it makes sense for this to be in `CConnman` rather than here.",
    "created_at": "2020-09-03T10:33:57Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r482877813",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/482877813"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r482877813"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/482877813/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2513,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484362401",
    "pull_request_review_id": 483469285,
    "id": 484362401,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDM2MjQwMQ==",
    "diff_hunk": "@@ -1889,6 +1889,7 @@ bool AppInitMain(const util::Ref& context, NodeContext& node)\n     connOptions.nMaxConnections = nMaxConnections;\n     connOptions.m_max_outbound_full_relay = std::min(MAX_OUTBOUND_FULL_RELAY_CONNECTIONS, connOptions.nMaxConnections);\n     connOptions.m_max_outbound_block_relay = std::min(MAX_BLOCK_RELAY_ONLY_CONNECTIONS, connOptions.nMaxConnections-connOptions.m_max_outbound_full_relay);\n+    connOptions.m_max_block_relay_anchor = std::min(MAX_BLOCK_RELAY_ONLY_ANCHORS, connOptions.m_max_outbound_block_relay);",
    "path": "src/init.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "9445a3411ed589d38cd4eee6714015d065f2b180",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "[Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-688252761).",
    "created_at": "2020-09-07T11:06:39Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r484362401",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484362401"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r484362401"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484362401/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1910,
    "side": "RIGHT",
    "in_reply_to_id": 465105274
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484362525",
    "pull_request_review_id": 483469429,
    "id": 484362525,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDM2MjUyNQ==",
    "diff_hunk": "@@ -2506,6 +2506,15 @@ void ProcessMessage(\n                       pfrom.nVersion.load(), pfrom.nStartingHeight,\n                       pfrom.GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom.addr.ToString()) : \"\"),\n                       pfrom.m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\n+            if (pfrom.IsBlockOnlyConn()) {\n+                // The node dumps:\n+                // - current anchors; and\n+                // - anchors that were known at startup but have not tried for connections yet\n+                auto anchors_to_save = connman.GetCurrentAnchors();",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 8,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "d7482556c98b76e73f64d04400a703fdbb9c189f",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-688252761).",
    "created_at": "2020-09-07T11:06:54Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r484362525",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484362525"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r484362525"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484362525/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2513,
    "side": "RIGHT",
    "in_reply_to_id": 482877813
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485053828",
    "pull_request_review_id": 484313427,
    "id": 485053828,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA1MzgyOA==",
    "diff_hunk": "@@ -533,6 +538,8 @@ class CConnman\n     NetEventsInterface* m_msgproc;\n     /** Pointer to this node's banman. May be nullptr - check existence before dereferencing. */\n     BanMan* m_banman;\n+    fs::path m_anchors_db_path;",
    "path": "src/net.h",
    "position": null,
    "original_position": 30,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Do we need to store this? Seems straightforward enough to call `GetDataDir() / \"anchors.dat\"` in the two places we need it (and add a constant for `\"anchors.dat\"`)",
    "created_at": "2020-09-08T16:36:06Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485053828",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485053828"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485053828"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485053828/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 541,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485054314",
    "pull_request_review_id": 484313427,
    "id": 485054314,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA1NDMxNA==",
    "diff_hunk": "@@ -2377,6 +2411,25 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    m_anchors_db_path = GetDataDir() / \"anchors.dat\";\n+    m_anchors = ReadAnchors(m_anchors_db_path);\n+    LogPrintf(\"Loaded %i addresses from %s\\n\", m_anchors.size(), m_anchors_db_path.filename());\n+    if (m_anchors.size() > static_cast<size_t>(MAX_BLOCK_RELAY_ONLY_ANCHORS)) {\n+        // Keep our policy safe.",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 139,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Why not just limit the anchors in this case rather than throwing them all away (ie `m_anchors.resize(static_cast<size_t>(MAX_BLOCK_RELAY_ONLY_ANCHORS))`",
    "created_at": "2020-09-08T16:36:56Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485054314",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485054314"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485054314"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485054314/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2420,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485055446",
    "pull_request_review_id": 484313427,
    "id": 485055446,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA1NTQ0Ng==",
    "diff_hunk": "@@ -2377,6 +2411,25 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    m_anchors_db_path = GetDataDir() / \"anchors.dat\";\n+    m_anchors = ReadAnchors(m_anchors_db_path);\n+    LogPrintf(\"Loaded %i addresses from %s\\n\", m_anchors.size(), m_anchors_db_path.filename());\n+    if (m_anchors.size() > static_cast<size_t>(MAX_BLOCK_RELAY_ONLY_ANCHORS)) {\n+        // Keep our policy safe.\n+        LogPrintf(\"%s is too large for this node policy. Skipped anchoring.\\n\", m_anchors_db_path.filename());\n+        m_anchors.clear();\n+    } else {\n+        // Peers added via -addnode are permanent connections too, therefore we could skip the same number of anchors.\n+        const size_t max_anchor_num = std::min(MAX_BLOCK_RELAY_ONLY_ANCHORS, connOptions.m_max_outbound_block_relay);\n+        if (max_anchor_num >= connOptions.m_added_nodes.size()) {",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 145,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I don't understand this logic. If `max_anchor_num` is 2 and added nodes is 1, then we'll add 1 anchor, but if `max_anchor_num` is 2 and added nodes is 3, we'll add both anchors. Is that intentional?",
    "created_at": "2020-09-08T16:38:55Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485055446",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485055446"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485055446"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485055446/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2424,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485061161",
    "pull_request_review_id": 484313427,
    "id": 485061161,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA2MTE2MQ==",
    "diff_hunk": "@@ -2542,13 +2542,18 @@ void PeerLogicValidation::ProcessMessage(CNode& pfrom, const std::string& msg_ty\n         pfrom.SetRecvVersion(std::min(pfrom.nVersion.load(), PROTOCOL_VERSION));\n \n         if (!pfrom.IsInboundConn()) {\n+            {",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "If this block scope should be indented. Even better, just use the `WITH_LOCK` macro to limit the locking to a single statement:\r\n\r\n`WITH_LOCK(cs_main, State(pfrom.GetId())->fCurrentlyConnected = true);`",
    "created_at": "2020-09-08T16:48:47Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485061161",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485061161"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485061161"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485061161/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2545,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485061712",
    "pull_request_review_id": 484313427,
    "id": 485061712,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA2MTcxMg==",
    "diff_hunk": "@@ -2542,13 +2542,18 @@ void PeerLogicValidation::ProcessMessage(CNode& pfrom, const std::string& msg_ty\n         pfrom.SetRecvVersion(std::min(pfrom.nVersion.load(), PROTOCOL_VERSION));\n \n         if (!pfrom.IsInboundConn()) {\n+            {\n             // Mark this node as currently connected, so we update its timestamp later.\n             LOCK(cs_main);\n             State(pfrom.GetId())->fCurrentlyConnected = true;\n             LogPrintf(\"New outbound peer connected: version: %d, blocks=%d, peer=%d%s (%s)\\n\",\n                       pfrom.nVersion.load(), pfrom.nStartingHeight,\n                       pfrom.GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom.addr.ToString()) : \"\"),\n                       pfrom.m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\n+            }\n+            if (pfrom.IsBlockOnlyConn()) {",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 13,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "style: could do this on one line if you prefer:\r\n\r\n`if (pfrom.IsBlockOnlyConn()) m_connman.DumpAnchors();`\r\n\r\nI think calling through to connman to dump the anchors is a much cleaner design. Thanks for doing that!",
    "created_at": "2020-09-08T16:49:41Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485061712",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485061712"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485061712"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485061712/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2551,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485063471",
    "pull_request_review_id": 484313427,
    "id": 485063471,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA2MzQ3MQ==",
    "diff_hunk": "@@ -1983,8 +1997,28 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             }\n \n             OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant, nullptr, conn_type);\n+\n+            if (anchor) {\n+                const auto v = GetCurrentAnchors();\n+                if (std::find(v.begin(), v.end(), addrConnect) == v.end()) {\n+                    LogPrintf(\"The anchor connection to %s FAILED\\n\", addrConnect.ToString());\n+                }\n+            }\n+        }\n+    }\n+}\n+\n+std::vector<CAddress> CConnman::GetCurrentAnchors() const",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 117,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Would `GetCurrentBlockRelayOnlyConns()` be a more accurate name here?",
    "created_at": "2020-09-08T16:52:50Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485063471",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485063471"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485063471"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485063471/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2011,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485064613",
    "pull_request_review_id": 484313427,
    "id": 485064613,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA2NDYxMw==",
    "diff_hunk": "@@ -1924,11 +1929,30 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         int nTries = 0;\n         while (!interruptNet)\n         {\n-            CAddrInfo addr = addrman.SelectTriedCollision();\n+            // If we didn't find an appropriate destination after trying 100 addresses fetched from addrman,\n+            // stop this loop, and let the outer loop run again (which sleeps, adds seed nodes, recalculates\n+            // already-connected network ranges, ...) before trying new addrman addresses.\n+            nTries++;",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 42,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Would it be better just to put the loop counting into a for statement? (perhaps in a different PR)",
    "created_at": "2020-09-08T16:54:58Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485064613",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485064613"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485064613"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485064613/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1941,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485066012",
    "pull_request_review_id": 484313427,
    "id": 485066012,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA2NjAxMg==",
    "diff_hunk": "@@ -1973,8 +1986,9 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         }\n \n         if (addrConnect.IsValid()) {\n-\n-            if (fFeeler) {\n+            if (anchor) {",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 96,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Why are these specialized logs required? Wouldn't it be better to do generic logging for all connection types?",
    "created_at": "2020-09-08T16:57:17Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485066012",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485066012"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485066012"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485066012/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1991,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485067137",
    "pull_request_review_id": 484313427,
    "id": 485067137,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA2NzEzNw==",
    "diff_hunk": "@@ -1924,11 +1929,30 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         int nTries = 0;\n         while (!interruptNet)\n         {\n-            CAddrInfo addr = addrman.SelectTriedCollision();\n+            // If we didn't find an appropriate destination after trying 100 addresses fetched from addrman,\n+            // stop this loop, and let the outer loop run again (which sleeps, adds seed nodes, recalculates\n+            // already-connected network ranges, ...) before trying new addrman addresses.\n+            nTries++;\n+            if (nTries > 100)\n+                break;\n+\n+            CAddress addr;\n+            if (anchor) {\n+                addr = m_anchors.back();",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 48,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "What happens in the logic below if we pick an anchor connection that isn't in our addrman? (ie what happens at the `if (!fFeeler && !HasAllDesirableServiceFlags(addr.nServices))` line below)?",
    "created_at": "2020-09-08T16:59:17Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485067137",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485067137"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485067137"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485067137/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1941,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485107997",
    "pull_request_review_id": 484313427,
    "id": 485107997,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTEwNzk5Nw==",
    "diff_hunk": "@@ -2908,3 +2961,13 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void CConnman::DumpAnchors() const\n+{\n+    // The node dumps:\n+    // - current anchors; and\n+    // - anchors that were known at startup but have not tried for connections yet",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 166,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "slight wording clarification: s/have not tried for connections yet/we have not yet tried to connect to/",
    "created_at": "2020-09-08T18:13:55Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485107997",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485107997"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485107997"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485107997/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2969,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485109968",
    "pull_request_review_id": 484385202,
    "id": 485109968,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTEwOTk2OA==",
    "diff_hunk": "@@ -2377,6 +2411,25 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    m_anchors_db_path = GetDataDir() / \"anchors.dat\";\n+    m_anchors = ReadAnchors(m_anchors_db_path);\n+    LogPrintf(\"Loaded %i addresses from %s\\n\", m_anchors.size(), m_anchors_db_path.filename());\n+    if (m_anchors.size() > static_cast<size_t>(MAX_BLOCK_RELAY_ONLY_ANCHORS)) {\n+        // Keep our policy safe.",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 139,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I do not trust `anchors.dat` that appears greater than it should be.\r\n\r\nAlso: https://github.com/bitcoin/bitcoin/pull/17428#discussion_r367057240",
    "created_at": "2020-09-08T18:17:35Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485109968",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485109968"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485109968"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485109968/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2420,
    "side": "RIGHT",
    "in_reply_to_id": 485054314
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485111515",
    "pull_request_review_id": 484387152,
    "id": 485111515,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTExMTUxNQ==",
    "diff_hunk": "@@ -2542,13 +2542,18 @@ void PeerLogicValidation::ProcessMessage(CNode& pfrom, const std::string& msg_ty\n         pfrom.SetRecvVersion(std::min(pfrom.nVersion.load(), PROTOCOL_VERSION));\n \n         if (!pfrom.IsInboundConn()) {\n+            {\n             // Mark this node as currently connected, so we update its timestamp later.\n             LOCK(cs_main);\n             State(pfrom.GetId())->fCurrentlyConnected = true;\n             LogPrintf(\"New outbound peer connected: version: %d, blocks=%d, peer=%d%s (%s)\\n\",\n                       pfrom.nVersion.load(), pfrom.nStartingHeight,\n                       pfrom.GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom.addr.ToString()) : \"\"),\n                       pfrom.m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\n+            }\n+            if (pfrom.IsBlockOnlyConn()) {",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 13,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "`m_connman.DumpAnchors();` is not a trivial expression, insofar I'd prefer to place it on its own line for better debugging.",
    "created_at": "2020-09-08T18:20:26Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485111515",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485111515"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485111515"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485111515/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2551,
    "side": "RIGHT",
    "in_reply_to_id": 485061712
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485112555",
    "pull_request_review_id": 484388482,
    "id": 485112555,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTExMjU1NQ==",
    "diff_hunk": "@@ -1983,8 +1997,28 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             }\n \n             OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant, nullptr, conn_type);\n+\n+            if (anchor) {\n+                const auto v = GetCurrentAnchors();\n+                if (std::find(v.begin(), v.end(), addrConnect) == v.end()) {\n+                    LogPrintf(\"The anchor connection to %s FAILED\\n\", addrConnect.ToString());\n+                }\n+            }\n+        }\n+    }\n+}\n+\n+std::vector<CAddress> CConnman::GetCurrentAnchors() const",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 117,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Sure! Going to rename it.",
    "created_at": "2020-09-08T18:22:26Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485112555",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485112555"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485112555"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485112555/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2011,
    "side": "RIGHT",
    "in_reply_to_id": 485063471
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485114791",
    "pull_request_review_id": 484391369,
    "id": 485114791,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTExNDc5MQ==",
    "diff_hunk": "@@ -1973,8 +1986,9 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         }\n \n         if (addrConnect.IsValid()) {\n-\n-            if (fFeeler) {\n+            if (anchor) {",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 96,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> Why are these specialized logs required?\r\n\r\nBecause anchors are specialized connections by their nature. As a secure feature I'd keep logs as they are.",
    "created_at": "2020-09-08T18:26:43Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485114791",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485114791"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485114791"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485114791/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1991,
    "side": "RIGHT",
    "in_reply_to_id": 485066012
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485115840",
    "pull_request_review_id": 484392698,
    "id": 485115840,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTExNTg0MA==",
    "diff_hunk": "@@ -2908,3 +2961,13 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void CConnman::DumpAnchors() const\n+{\n+    // The node dumps:\n+    // - current anchors; and\n+    // - anchors that were known at startup but have not tried for connections yet",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 166,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks! You know English is not my strong point :)\r\nGoing to fix it.",
    "created_at": "2020-09-08T18:28:42Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485115840",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485115840"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485115840"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485115840/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2969,
    "side": "RIGHT",
    "in_reply_to_id": 485107997
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485116992",
    "pull_request_review_id": 484394146,
    "id": 485116992,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTExNjk5Mg==",
    "diff_hunk": "@@ -2542,13 +2542,18 @@ void PeerLogicValidation::ProcessMessage(CNode& pfrom, const std::string& msg_ty\n         pfrom.SetRecvVersion(std::min(pfrom.nVersion.load(), PROTOCOL_VERSION));\n \n         if (!pfrom.IsInboundConn()) {\n+            {",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Don't calls within `LogPrintf()` require `::cs_main` lock?",
    "created_at": "2020-09-08T18:30:43Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485116992",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485116992"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485116992"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485116992/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2545,
    "side": "RIGHT",
    "in_reply_to_id": 485061161
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485117572",
    "pull_request_review_id": 484394924,
    "id": 485117572,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTExNzU3Mg==",
    "diff_hunk": "@@ -2542,13 +2542,18 @@ void PeerLogicValidation::ProcessMessage(CNode& pfrom, const std::string& msg_ty\n         pfrom.SetRecvVersion(std::min(pfrom.nVersion.load(), PROTOCOL_VERSION));\n \n         if (!pfrom.IsInboundConn()) {\n+            {",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Oh, I see. They don't.",
    "created_at": "2020-09-08T18:31:56Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485117572",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485117572"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485117572"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485117572/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2545,
    "side": "RIGHT",
    "in_reply_to_id": 485061161
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485119274",
    "pull_request_review_id": 484397000,
    "id": 485119274,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTExOTI3NA==",
    "diff_hunk": "@@ -2377,6 +2411,25 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    m_anchors_db_path = GetDataDir() / \"anchors.dat\";\n+    m_anchors = ReadAnchors(m_anchors_db_path);\n+    LogPrintf(\"Loaded %i addresses from %s\\n\", m_anchors.size(), m_anchors_db_path.filename());\n+    if (m_anchors.size() > static_cast<size_t>(MAX_BLOCK_RELAY_ONLY_ANCHORS)) {\n+        // Keep our policy safe.\n+        LogPrintf(\"%s is too large for this node policy. Skipped anchoring.\\n\", m_anchors_db_path.filename());\n+        m_anchors.clear();\n+    } else {\n+        // Peers added via -addnode are permanent connections too, therefore we could skip the same number of anchors.\n+        const size_t max_anchor_num = std::min(MAX_BLOCK_RELAY_ONLY_ANCHORS, connOptions.m_max_outbound_block_relay);\n+        if (max_anchor_num >= connOptions.m_added_nodes.size()) {",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 145,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This is unintentional change during the recent rebasing.\r\nMany thanks!",
    "created_at": "2020-09-08T18:35:00Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485119274",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485119274"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485119274"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485119274/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2424,
    "side": "RIGHT",
    "in_reply_to_id": 485055446
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485183507",
    "pull_request_review_id": 484477078,
    "id": 485183507,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE4MzUwNw==",
    "diff_hunk": "@@ -1983,8 +1997,28 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             }\n \n             OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant, nullptr, conn_type);\n+\n+            if (anchor) {\n+                const auto v = GetCurrentAnchors();\n+                if (std::find(v.begin(), v.end(), addrConnect) == v.end()) {\n+                    LogPrintf(\"The anchor connection to %s FAILED\\n\", addrConnect.ToString());\n+                }\n+            }\n+        }\n+    }\n+}\n+\n+std::vector<CAddress> CConnman::GetCurrentAnchors() const",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 117,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Btw, https://github.com/bitcoin/bitcoin/pull/17428#discussion_r448268314",
    "created_at": "2020-09-08T20:40:19Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485183507",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485183507"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485183507"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485183507/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2011,
    "side": "RIGHT",
    "in_reply_to_id": 485063471
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485184173",
    "pull_request_review_id": 484477948,
    "id": 485184173,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE4NDE3Mw==",
    "diff_hunk": "@@ -2908,3 +2961,13 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void CConnman::DumpAnchors() const\n+{\n+    // The node dumps:\n+    // - current anchors; and\n+    // - anchors that were known at startup but have not tried for connections yet",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 166,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Btw, https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449650363",
    "created_at": "2020-09-08T20:41:44Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485184173",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485184173"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485184173"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485184173/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2969,
    "side": "RIGHT",
    "in_reply_to_id": 485107997
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485188596",
    "pull_request_review_id": 484483496,
    "id": 485188596,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE4ODU5Ng==",
    "diff_hunk": "@@ -533,6 +538,8 @@ class CConnman\n     NetEventsInterface* m_msgproc;\n     /** Pointer to this node's banman. May be nullptr - check existence before dereferencing. */\n     BanMan* m_banman;\n+    fs::path m_anchors_db_path;",
    "path": "src/net.h",
    "position": null,
    "original_position": 30,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-689127833).",
    "created_at": "2020-09-08T20:50:37Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485188596",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485188596"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485188596"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485188596/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 541,
    "side": "RIGHT",
    "in_reply_to_id": 485053828
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485188900",
    "pull_request_review_id": 484483885,
    "id": 485188900,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE4ODkwMA==",
    "diff_hunk": "@@ -2377,6 +2411,25 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    m_anchors_db_path = GetDataDir() / \"anchors.dat\";\n+    m_anchors = ReadAnchors(m_anchors_db_path);\n+    LogPrintf(\"Loaded %i addresses from %s\\n\", m_anchors.size(), m_anchors_db_path.filename());\n+    if (m_anchors.size() > static_cast<size_t>(MAX_BLOCK_RELAY_ONLY_ANCHORS)) {\n+        // Keep our policy safe.\n+        LogPrintf(\"%s is too large for this node policy. Skipped anchoring.\\n\", m_anchors_db_path.filename());\n+        m_anchors.clear();\n+    } else {\n+        // Peers added via -addnode are permanent connections too, therefore we could skip the same number of anchors.\n+        const size_t max_anchor_num = std::min(MAX_BLOCK_RELAY_ONLY_ANCHORS, connOptions.m_max_outbound_block_relay);\n+        if (max_anchor_num >= connOptions.m_added_nodes.size()) {",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 145,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "[Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-689127833).",
    "created_at": "2020-09-08T20:51:15Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485188900",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485188900"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485188900"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485188900/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2424,
    "side": "RIGHT",
    "in_reply_to_id": 485055446
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485189149",
    "pull_request_review_id": 484484217,
    "id": 485189149,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE4OTE0OQ==",
    "diff_hunk": "@@ -2542,13 +2542,18 @@ void PeerLogicValidation::ProcessMessage(CNode& pfrom, const std::string& msg_ty\n         pfrom.SetRecvVersion(std::min(pfrom.nVersion.load(), PROTOCOL_VERSION));\n \n         if (!pfrom.IsInboundConn()) {\n+            {",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "[Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-689127833).",
    "created_at": "2020-09-08T20:51:47Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485189149",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485189149"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485189149"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485189149/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2545,
    "side": "RIGHT",
    "in_reply_to_id": 485061161
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485189355",
    "pull_request_review_id": 484484497,
    "id": 485189355,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE4OTM1NQ==",
    "diff_hunk": "@@ -1983,8 +1997,28 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             }\n \n             OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant, nullptr, conn_type);\n+\n+            if (anchor) {\n+                const auto v = GetCurrentAnchors();\n+                if (std::find(v.begin(), v.end(), addrConnect) == v.end()) {\n+                    LogPrintf(\"The anchor connection to %s FAILED\\n\", addrConnect.ToString());\n+                }\n+            }\n+        }\n+    }\n+}\n+\n+std::vector<CAddress> CConnman::GetCurrentAnchors() const",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 117,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "[Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-689127833).",
    "created_at": "2020-09-08T20:52:14Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485189355",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485189355"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485189355"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485189355/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2011,
    "side": "RIGHT",
    "in_reply_to_id": 485063471
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485189668",
    "pull_request_review_id": 484484880,
    "id": 485189668,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE4OTY2OA==",
    "diff_hunk": "@@ -1924,11 +1929,30 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         int nTries = 0;\n         while (!interruptNet)\n         {\n-            CAddrInfo addr = addrman.SelectTriedCollision();\n+            // If we didn't find an appropriate destination after trying 100 addresses fetched from addrman,\n+            // stop this loop, and let the outer loop run again (which sleeps, adds seed nodes, recalculates\n+            // already-connected network ranges, ...) before trying new addrman addresses.\n+            nTries++;",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 42,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> (perhaps in a different PR)\r\n\r\nYes :)\r\n\r\n",
    "created_at": "2020-09-08T20:52:55Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485189668",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485189668"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485189668"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485189668/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1941,
    "side": "RIGHT",
    "in_reply_to_id": 485064613
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485190161",
    "pull_request_review_id": 484485465,
    "id": 485190161,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE5MDE2MQ==",
    "diff_hunk": "@@ -1924,11 +1929,30 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         int nTries = 0;\n         while (!interruptNet)\n         {\n-            CAddrInfo addr = addrman.SelectTriedCollision();\n+            // If we didn't find an appropriate destination after trying 100 addresses fetched from addrman,\n+            // stop this loop, and let the outer loop run again (which sleeps, adds seed nodes, recalculates\n+            // already-connected network ranges, ...) before trying new addrman addresses.\n+            nTries++;\n+            if (nTries > 100)\n+                break;\n+\n+            CAddress addr;\n+            if (anchor) {\n+                addr = m_anchors.back();",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 48,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks! [Reworked](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-689127833) with a smaller diff.",
    "created_at": "2020-09-08T20:53:54Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485190161",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485190161"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485190161"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485190161/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1941,
    "side": "RIGHT",
    "in_reply_to_id": 485067137
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485190286",
    "pull_request_review_id": 484485643,
    "id": 485190286,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE5MDI4Ng==",
    "diff_hunk": "@@ -2908,3 +2961,13 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void CConnman::DumpAnchors() const\n+{\n+    // The node dumps:\n+    // - current anchors; and\n+    // - anchors that were known at startup but have not tried for connections yet",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 166,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "[Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-689127833).",
    "created_at": "2020-09-08T20:54:11Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485190286",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485190286"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485190286"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485190286/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2969,
    "side": "RIGHT",
    "in_reply_to_id": 485107997
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485499155",
    "pull_request_review_id": 484862072,
    "id": 485499155,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ5OTE1NQ==",
    "diff_hunk": "@@ -2542,13 +2542,18 @@ void PeerLogicValidation::ProcessMessage(CNode& pfrom, const std::string& msg_ty\n         pfrom.SetRecvVersion(std::min(pfrom.nVersion.load(), PROTOCOL_VERSION));\n \n         if (!pfrom.IsInboundConn()) {\n+            {\n             // Mark this node as currently connected, so we update its timestamp later.\n             LOCK(cs_main);\n             State(pfrom.GetId())->fCurrentlyConnected = true;\n             LogPrintf(\"New outbound peer connected: version: %d, blocks=%d, peer=%d%s (%s)\\n\",\n                       pfrom.nVersion.load(), pfrom.nStartingHeight,\n                       pfrom.GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom.addr.ToString()) : \"\"),\n                       pfrom.m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\n+            }\n+            if (pfrom.IsBlockOnlyConn()) {",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 13,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "ok",
    "created_at": "2020-09-09T10:13:24Z",
    "updated_at": "2020-10-09T11:30:54Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485499155",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485499155"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485499155"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485499155/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2551,
    "side": "RIGHT",
    "in_reply_to_id": 485061712
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485499755",
    "pull_request_review_id": 484862844,
    "id": 485499755,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ5OTc1NQ==",
    "diff_hunk": "@@ -1924,11 +1929,30 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         int nTries = 0;\n         while (!interruptNet)\n         {\n-            CAddrInfo addr = addrman.SelectTriedCollision();\n+            // If we didn't find an appropriate destination after trying 100 addresses fetched from addrman,\n+            // stop this loop, and let the outer loop run again (which sleeps, adds seed nodes, recalculates\n+            // already-connected network ranges, ...) before trying new addrman addresses.\n+            nTries++;",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 42,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "ok, I think this whole function could be cleaned up, but this change doesn't make things too much worse, so lets save it for a different PR.",
    "created_at": "2020-09-09T10:14:24Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485499755",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485499755"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485499755"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485499755/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1941,
    "side": "RIGHT",
    "in_reply_to_id": 485064613
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485504053",
    "pull_request_review_id": 484868375,
    "id": 485504053,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTUwNDA1Mw==",
    "diff_hunk": "@@ -2377,6 +2411,25 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    m_anchors_db_path = GetDataDir() / \"anchors.dat\";\n+    m_anchors = ReadAnchors(m_anchors_db_path);\n+    LogPrintf(\"Loaded %i addresses from %s\\n\", m_anchors.size(), m_anchors_db_path.filename());\n+    if (m_anchors.size() > static_cast<size_t>(MAX_BLOCK_RELAY_ONLY_ANCHORS)) {\n+        // Keep our policy safe.",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 139,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think we have to assume that our data directory is not compromised. Otherwise anything could happen.",
    "created_at": "2020-09-09T10:22:38Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485504053",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485504053"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485504053"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485504053/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2420,
    "side": "RIGHT",
    "in_reply_to_id": 485054314
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485506307",
    "pull_request_review_id": 484871242,
    "id": 485506307,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTUwNjMwNw==",
    "diff_hunk": "@@ -1973,8 +1986,9 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         }\n \n         if (addrConnect.IsValid()) {\n-\n-            if (fFeeler) {\n+            if (anchor) {",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 96,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I really don't like this specialized logging for anchor connections (or the feeler connections below). All connection types are specialized in some way? Why not just log unconditionally for all connection types?",
    "created_at": "2020-09-09T10:26:58Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485506307",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485506307"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485506307"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485506307/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1991,
    "side": "RIGHT",
    "in_reply_to_id": 485066012
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485511823",
    "pull_request_review_id": 484878417,
    "id": 485511823,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTUxMTgyMw==",
    "diff_hunk": "@@ -1973,8 +1986,9 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         }\n \n         if (addrConnect.IsValid()) {\n-\n-            if (fFeeler) {\n+            if (anchor) {",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 96,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> Why not just log unconditionally for all connection types?\r\n\r\nIt could be very noisy in logs. Anyway, touching logging for all connections seems out of this PR scope.",
    "created_at": "2020-09-09T10:37:39Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485511823",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485511823"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485511823"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485511823/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1991,
    "side": "RIGHT",
    "in_reply_to_id": 485066012
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485545150",
    "pull_request_review_id": 484921590,
    "id": 485545150,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU0NTE1MA==",
    "diff_hunk": "@@ -1973,8 +1986,9 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         }\n \n         if (addrConnect.IsValid()) {\n-\n-            if (fFeeler) {\n+            if (anchor) {",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 96,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "oh, I didn't realise that these are unconditional logs. I definitely think they should be in the NET category.",
    "created_at": "2020-09-09T11:42:46Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485545150",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485545150"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485545150"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485545150/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1991,
    "side": "RIGHT",
    "in_reply_to_id": 485066012
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486365697",
    "pull_request_review_id": 485964520,
    "id": 486365697,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjM2NTY5Nw==",
    "diff_hunk": "@@ -2377,6 +2411,25 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    m_anchors_db_path = GetDataDir() / \"anchors.dat\";\n+    m_anchors = ReadAnchors(m_anchors_db_path);\n+    LogPrintf(\"Loaded %i addresses from %s\\n\", m_anchors.size(), m_anchors_db_path.filename());\n+    if (m_anchors.size() > static_cast<size_t>(MAX_BLOCK_RELAY_ONLY_ANCHORS)) {\n+        // Keep our policy safe.",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 139,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-690307345).",
    "created_at": "2020-09-10T13:58:19Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r486365697",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486365697"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r486365697"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486365697/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2420,
    "side": "RIGHT",
    "in_reply_to_id": 485054314
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486365816",
    "pull_request_review_id": 485964673,
    "id": 486365816,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjM2NTgxNg==",
    "diff_hunk": "@@ -1973,8 +1986,9 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         }\n \n         if (addrConnect.IsValid()) {\n-\n-            if (fFeeler) {\n+            if (anchor) {",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 96,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-690307345).",
    "created_at": "2020-09-10T13:58:29Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r486365816",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486365816"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r486365816"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486365816/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1991,
    "side": "RIGHT",
    "in_reply_to_id": 485066012
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486383918",
    "pull_request_review_id": 485988639,
    "id": 486383918,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjM4MzkxOA==",
    "diff_hunk": "@@ -73,4 +73,15 @@ class CBanDB\n     bool Read(banmap_t& banSet);\n };\n \n+/**\n+ * Reads the anchor IP address database (anchors.dat)\n+ *\n+ * Anchors are last known outgoing block-relay-only peers that are\n+ * tried to re-connect to on startup.\n+ */\n+std::vector<CAddress> ReadAnchors(const fs::path& anchors_db_path);\n+\n+/** Dump the anchor IP address database (anchors.dat) */\n+void DumpAnchors(const fs::path& anchors_db_path, const std::vector<CAddress> anchors);",
    "path": "src/addrdb.h",
    "position": null,
    "original_position": 25,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "06c96f27e70a7d397b5980497dfe615a1f57aeb4",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "How about passing `anchors` by const ref to save a copy?",
    "created_at": "2020-09-10T14:21:49Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r486383918",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486383918"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r486383918"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486383918/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 85,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486385166",
    "pull_request_review_id": 485988639,
    "id": 486385166,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjM4NTE2Ng==",
    "diff_hunk": "@@ -2377,6 +2413,22 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    const fs::path& anchors_db_path = GetDataDir() / ANCHORS_DATABASE_FILENAME;\n+    m_anchors = ReadAnchors(anchors_db_path);\n+    LogPrintf(\"Loaded %i addresses from %s\\n\", m_anchors.size(), ANCHORS_DATABASE_FILENAME);",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 120,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "06c96f27e70a7d397b5980497dfe615a1f57aeb4",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "What do you think about moving this logging into the `ReadAnchors()` function (to be consistent with the `DumpAnchors()` logging)?",
    "created_at": "2020-09-10T14:23:27Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r486385166",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486385166"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r486385166"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486385166/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2418,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486398022",
    "pull_request_review_id": 485988639,
    "id": 486398022,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjM5ODAyMg==",
    "diff_hunk": "@@ -1983,10 +1999,30 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             }\n \n             OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant, nullptr, conn_type);\n+\n+            if (anchor) {\n+                const auto v = GetCurrentBlockRelayOnlyConns();\n+                if (std::find(v.begin(), v.end(), addrConnect) == v.end()) {\n+                    LogPrintf(\"The anchor connection to %s FAILED\\n\", addrConnect.ToString());",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 91,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "06c96f27e70a7d397b5980497dfe615a1f57aeb4",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Make NET category?",
    "created_at": "2020-09-10T14:39:37Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r486398022",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486398022"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r486398022"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486398022/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2006,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486398148",
    "pull_request_review_id": 486006930,
    "id": 486398148,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjM5ODE0OA==",
    "diff_hunk": "@@ -2377,6 +2379,22 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    const fs::path& anchors_db_path = GetDataDir() / ANCHORS_DATABASE_FILENAME;\n+    m_anchors = ReadAnchors(anchors_db_path);\n+    LogPrintf(\"Loaded %i addresses from %s\\n\", m_anchors.size(), ANCHORS_DATABASE_FILENAME);\n+    // Peers added via -addnode are permanent connections too, therefore we could skip the same number of anchors.\n+    const size_t max_anchor_num = std::min(MAX_BLOCK_RELAY_ONLY_ANCHORS, connOptions.m_max_outbound_block_relay);\n+    if (max_anchor_num <= connOptions.m_added_nodes.size()) {\n+        m_anchors.clear();\n+    } else {\n+        const size_t anchor_num_allowed = max_anchor_num - connOptions.m_added_nodes.size();\n+        if (anchor_num_allowed < m_anchors.size()) {\n+            m_anchors.resize(anchor_num_allowed);\n+        }\n+    }\n+\n+    LogPrintf(\"%i block-relay-only anchors will be tried for connections.\\n\", m_anchors.size());",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 27,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "a756f5fc1852f5cf9782820d5d22dd06af8baf8e",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Perhaps we should not print this message if `-connect=0` is set?",
    "created_at": "2020-09-10T14:39:48Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r486398148",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486398148"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r486398148"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486398148/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2396,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486404620",
    "pull_request_review_id": 486006930,
    "id": 486404620,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQwNDYyMA==",
    "diff_hunk": "@@ -2377,6 +2379,22 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    const fs::path& anchors_db_path = GetDataDir() / ANCHORS_DATABASE_FILENAME;\n+    m_anchors = ReadAnchors(anchors_db_path);\n+    LogPrintf(\"Loaded %i addresses from %s\\n\", m_anchors.size(), ANCHORS_DATABASE_FILENAME);\n+    // Peers added via -addnode are permanent connections too, therefore we could skip the same number of anchors.",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 16,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "a756f5fc1852f5cf9782820d5d22dd06af8baf8e",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I'm skeptical of this interaction between `-addnode` peers and the anchor peers we're introducing. Basically this gives users a way to footgun the protection we're trying to give with these anchors, by starting up bitcoind once with `-addnode` on the command line.\r\n\r\nGiven that using `-addnode` doesn't reduce our outbound or block-relay-only connections today, I don't think it should have any interaction with these anchor peers either.",
    "created_at": "2020-09-10T14:48:06Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r486404620",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486404620"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r486404620"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486404620/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2385,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486432017",
    "pull_request_review_id": 486006930,
    "id": 486432017,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQzMjAxNw==",
    "diff_hunk": "@@ -1989,6 +1989,19 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n     }\n }\n \n+std::vector<CAddress> CConnman::GetCurrentBlockRelayOnlyConns() const",
    "path": "src/net.cpp",
    "position": 82,
    "original_position": 4,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "1509132268ee96eca8755845b3d2304e6f54dbf3",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This will have an interaction with #19858, so just wanted to flag it -- if this PR is merged before #19858, then I'd change this logic to only return the oldest N block-relay-only peers (so that if we shutdown while connected to an extra one, the extra one is ignored).",
    "created_at": "2020-09-10T15:24:21Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r486432017",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486432017"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r486432017"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486432017/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2044,
    "original_line": 2044,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486441321",
    "pull_request_review_id": 486006930,
    "id": 486441321,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ0MTMyMQ==",
    "diff_hunk": "@@ -1973,8 +1986,9 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         }\n \n         if (addrConnect.IsValid()) {\n-\n-            if (fFeeler) {\n+            if (anchor) {",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 96,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "We could move this whole LogPrint() up to where the anchor is selected, and get rid of the `anchor` boolean, IMO.",
    "created_at": "2020-09-10T15:37:08Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r486441321",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486441321"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r486441321"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486441321/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1991,
    "side": "RIGHT",
    "in_reply_to_id": 485066012
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486443236",
    "pull_request_review_id": 486006930,
    "id": 486443236,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ0MzIzNg==",
    "diff_hunk": "@@ -1985,6 +1999,13 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             }\n \n             OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant, nullptr, conn_type);\n+\n+            if (anchor) {\n+                const auto v = GetCurrentBlockRelayOnlyConns();\n+                if (std::find(v.begin(), v.end(), addrConnect) == v.end()) {\n+                    LogPrintf(\"The anchor connection to %s FAILED\\n\", addrConnect.ToString());",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 69,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "06c96f27e70a7d397b5980497dfe615a1f57aeb4",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think we should just delete this whole `if (anchor)` block.  This kind of logging is perhaps helpful while debugging the PR, but I think an unconditional log message here is not very helpful to most users -- we should expect that it is completely normal that this might happen, and having a log message that looks concerning for normal behavior trains users to learn to ignore seemingly scary log messages.\r\n\r\nFor debugging/analysis/research purposes, I would not object to adding a bool to CNode() so that we can track when anchor connections are initiated and when they get disconnected.  No need to do that in this PR, but something like that would be much more helpful than this log message, I think.",
    "created_at": "2020-09-10T15:39:45Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r486443236",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486443236"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r486443236"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486443236/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2006,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487421977",
    "pull_request_review_id": 487237800,
    "id": 487421977,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQyMTk3Nw==",
    "diff_hunk": "@@ -2377,6 +2379,22 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    const fs::path& anchors_db_path = GetDataDir() / ANCHORS_DATABASE_FILENAME;\n+    m_anchors = ReadAnchors(anchors_db_path);\n+    LogPrintf(\"Loaded %i addresses from %s\\n\", m_anchors.size(), ANCHORS_DATABASE_FILENAME);\n+    // Peers added via -addnode are permanent connections too, therefore we could skip the same number of anchors.\n+    const size_t max_anchor_num = std::min(MAX_BLOCK_RELAY_ONLY_ANCHORS, connOptions.m_max_outbound_block_relay);\n+    if (max_anchor_num <= connOptions.m_added_nodes.size()) {\n+        m_anchors.clear();\n+    } else {\n+        const size_t anchor_num_allowed = max_anchor_num - connOptions.m_added_nodes.size();\n+        if (anchor_num_allowed < m_anchors.size()) {\n+            m_anchors.resize(anchor_num_allowed);\n+        }\n+    }\n+\n+    LogPrintf(\"%i block-relay-only anchors will be tried for connections.\\n\", m_anchors.size());",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 27,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "a756f5fc1852f5cf9782820d5d22dd06af8baf8e",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-691508148).",
    "created_at": "2020-09-12T15:46:32Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r487421977",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487421977"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r487421977"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487421977/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2396,
    "side": "RIGHT",
    "in_reply_to_id": 486398148
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487421985",
    "pull_request_review_id": 487237807,
    "id": 487421985,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQyMTk4NQ==",
    "diff_hunk": "@@ -2377,6 +2379,22 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    const fs::path& anchors_db_path = GetDataDir() / ANCHORS_DATABASE_FILENAME;\n+    m_anchors = ReadAnchors(anchors_db_path);\n+    LogPrintf(\"Loaded %i addresses from %s\\n\", m_anchors.size(), ANCHORS_DATABASE_FILENAME);\n+    // Peers added via -addnode are permanent connections too, therefore we could skip the same number of anchors.",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 16,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "a756f5fc1852f5cf9782820d5d22dd06af8baf8e",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-691508148).",
    "created_at": "2020-09-12T15:46:44Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r487421985",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487421985"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r487421985"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487421985/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2385,
    "side": "RIGHT",
    "in_reply_to_id": 486404620
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487422031",
    "pull_request_review_id": 487237833,
    "id": 487422031,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQyMjAzMQ==",
    "diff_hunk": "@@ -1985,6 +1999,13 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             }\n \n             OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant, nullptr, conn_type);\n+\n+            if (anchor) {\n+                const auto v = GetCurrentBlockRelayOnlyConns();\n+                if (std::find(v.begin(), v.end(), addrConnect) == v.end()) {\n+                    LogPrintf(\"The anchor connection to %s FAILED\\n\", addrConnect.ToString());",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 69,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "06c96f27e70a7d397b5980497dfe615a1f57aeb4",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "[Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-691508148).",
    "created_at": "2020-09-12T15:47:17Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r487422031",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487422031"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r487422031"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487422031/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2006,
    "side": "RIGHT",
    "in_reply_to_id": 486443236
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487422044",
    "pull_request_review_id": 487237845,
    "id": 487422044,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQyMjA0NA==",
    "diff_hunk": "@@ -73,4 +73,15 @@ class CBanDB\n     bool Read(banmap_t& banSet);\n };\n \n+/**\n+ * Reads the anchor IP address database (anchors.dat)\n+ *\n+ * Anchors are last known outgoing block-relay-only peers that are\n+ * tried to re-connect to on startup.\n+ */\n+std::vector<CAddress> ReadAnchors(const fs::path& anchors_db_path);\n+\n+/** Dump the anchor IP address database (anchors.dat) */\n+void DumpAnchors(const fs::path& anchors_db_path, const std::vector<CAddress> anchors);",
    "path": "src/addrdb.h",
    "position": null,
    "original_position": 25,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "06c96f27e70a7d397b5980497dfe615a1f57aeb4",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-691508148).",
    "created_at": "2020-09-12T15:47:31Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r487422044",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487422044"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r487422044"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487422044/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 85,
    "side": "RIGHT",
    "in_reply_to_id": 486383918
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487422063",
    "pull_request_review_id": 487237865,
    "id": 487422063,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQyMjA2Mw==",
    "diff_hunk": "@@ -2377,6 +2413,22 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    const fs::path& anchors_db_path = GetDataDir() / ANCHORS_DATABASE_FILENAME;\n+    m_anchors = ReadAnchors(anchors_db_path);\n+    LogPrintf(\"Loaded %i addresses from %s\\n\", m_anchors.size(), ANCHORS_DATABASE_FILENAME);",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 120,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "06c96f27e70a7d397b5980497dfe615a1f57aeb4",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-691508148).",
    "created_at": "2020-09-12T15:47:48Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r487422063",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487422063"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r487422063"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487422063/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2418,
    "side": "RIGHT",
    "in_reply_to_id": 486385166
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487422119",
    "pull_request_review_id": 487237901,
    "id": 487422119,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQyMjExOQ==",
    "diff_hunk": "@@ -1973,8 +1986,9 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         }\n \n         if (addrConnect.IsValid()) {\n-\n-            if (fFeeler) {\n+            if (anchor) {",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 96,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "4eff692eeb861018f1f44b6284891a1d0599dd88",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "[Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-691508148).",
    "created_at": "2020-09-12T15:48:38Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r487422119",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487422119"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r487422119"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487422119/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1991,
    "side": "RIGHT",
    "in_reply_to_id": 485066012
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487422360",
    "pull_request_review_id": 487238030,
    "id": 487422360,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQyMjM2MA==",
    "diff_hunk": "@@ -1983,10 +1999,30 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             }\n \n             OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant, nullptr, conn_type);\n+\n+            if (anchor) {\n+                const auto v = GetCurrentBlockRelayOnlyConns();\n+                if (std::find(v.begin(), v.end(), addrConnect) == v.end()) {\n+                    LogPrintf(\"The anchor connection to %s FAILED\\n\", addrConnect.ToString());",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 91,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "06c96f27e70a7d397b5980497dfe615a1f57aeb4",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "After addressing https://github.com/bitcoin/bitcoin/pull/17428#discussion_r486443236, it's irrelevant now.",
    "created_at": "2020-09-12T15:51:38Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r487422360",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487422360"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r487422360"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487422360/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2006,
    "side": "RIGHT",
    "in_reply_to_id": 486398022
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489283478",
    "pull_request_review_id": 489425329,
    "id": 489283478,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI4MzQ3OA==",
    "diff_hunk": "@@ -2377,6 +2406,17 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    m_anchors = ReadAnchors(GetDataDir() / ANCHORS_DATABASE_FILENAME);\n+    Assert(MAX_BLOCK_RELAY_ONLY_ANCHORS >= 0);",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 99,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "be82629cc00961325182f03493d84f704b709020",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Why add a runtime assert on the value of a `constexpr` which is known at compilation time? Just add a static_assert if you need to do this (but I don't think this is required at all).",
    "created_at": "2020-09-16T09:07:30Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489283478",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489283478"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489283478"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489283478/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2410,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489284019",
    "pull_request_review_id": 489425329,
    "id": 489284019,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI4NDAxOQ==",
    "diff_hunk": "@@ -63,6 +63,9 @@ static const int MAX_OUTBOUND_FULL_RELAY_CONNECTIONS = 8;\n static const int MAX_ADDNODE_CONNECTIONS = 8;\n /** Maximum number of block-relay-only outgoing connections */\n static const int MAX_BLOCK_RELAY_ONLY_CONNECTIONS = 2;\n+/** Maximum number of block-relay-only anchor connections */\n+static constexpr int MAX_BLOCK_RELAY_ONLY_ANCHORS = 2;",
    "path": "src/net.h",
    "position": null,
    "original_position": 5,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "be82629cc00961325182f03493d84f704b709020",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This constant is only used internally within net.cpp, so I think it should be moved there, rather than be part of net's interface to other components.",
    "created_at": "2020-09-16T09:08:22Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489284019",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489284019"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489284019"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489284019/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 67,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489285516",
    "pull_request_review_id": 489425329,
    "id": 489285516,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI4NTUxNg==",
    "diff_hunk": "@@ -73,4 +73,15 @@ class CBanDB\n     bool Read(banmap_t& banSet);\n };\n \n+/** Dump the anchor IP address database (anchors.dat) */\n+void DumpAnchors(const fs::path& anchors_db_path, const std::vector<CAddress>& anchors);\n+\n+/**\n+ * Reads the anchor IP address database (anchors.dat)\n+ *\n+ * Anchors are last known outgoing block-relay-only peers that are\n+ * tried to re-connect to on startup.\n+ */\n+std::vector<CAddress> ReadAnchors(const fs::path& anchors_db_path, bool remove_after_read = true);",
    "path": "src/addrdb.h",
    "position": null,
    "original_position": 25,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "be82629cc00961325182f03493d84f704b709020",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "What is the `remove_after_read` param for? It's not used in the one place this is called, so should be removed.",
    "created_at": "2020-09-16T09:10:42Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489285516",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489285516"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489285516"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489285516/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 85,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489286613",
    "pull_request_review_id": 489425329,
    "id": 489286613,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI4NjYxMw==",
    "diff_hunk": "@@ -533,6 +537,7 @@ class CConnman\n     NetEventsInterface* m_msgproc;\n     /** Pointer to this node's banman. May be nullptr - check existence before dereferencing. */\n     BanMan* m_banman;\n+    std::vector<CAddress> m_anchors;",
    "path": "src/net.h",
    "position": 31,
    "original_position": 22,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "be82629cc00961325182f03493d84f704b709020",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think it'd be good to add a doxygen comment to this new member variable. This vector stores addresses that we should attempt to make block-relay-only connections to, not connections that we'll necessarily store as anchor connections next time we shut down.",
    "created_at": "2020-09-16T09:12:29Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489286613",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489286613"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489286613"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489286613/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 575,
    "original_line": 575,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489287610",
    "pull_request_review_id": 489425329,
    "id": 489287610,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI4NzYxMA==",
    "diff_hunk": "@@ -2377,6 +2406,17 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    m_anchors = ReadAnchors(GetDataDir() / ANCHORS_DATABASE_FILENAME);\n+    Assert(MAX_BLOCK_RELAY_ONLY_ANCHORS >= 0);\n+    constexpr size_t max_anchor_num = static_cast<size_t>(MAX_BLOCK_RELAY_ONLY_ANCHORS);",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 100,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "be82629cc00961325182f03493d84f704b709020",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Why not just make the constexpr `MAX_BLOCK_RELAY_ONLY_ANCHORS` a `size_t` rather than use this cast?",
    "created_at": "2020-09-16T09:14:03Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489287610",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489287610"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489287610"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489287610/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2411,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489290793",
    "pull_request_review_id": 489425329,
    "id": 489290793,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI5MDc5Mw==",
    "diff_hunk": "@@ -2492,6 +2532,14 @@ void CConnman::StopNodes()\n     if (fAddressesInitialized) {\n         DumpAddresses();\n         fAddressesInitialized = false;\n+\n+        auto anchors_to_dump = GetCurrentBlockRelayOnlyConns();",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 117,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "be82629cc00961325182f03493d84f704b709020",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I suggest you add a brief comment here to say that anchor connections are only dumped during clean shutdown.",
    "created_at": "2020-09-16T09:18:41Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489290793",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489290793"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489290793"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489290793/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2537,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489348580",
    "pull_request_review_id": 489508802,
    "id": 489348580,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM0ODU4MA==",
    "diff_hunk": "@@ -2377,6 +2406,17 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    m_anchors = ReadAnchors(GetDataDir() / ANCHORS_DATABASE_FILENAME);\n+    Assert(MAX_BLOCK_RELAY_ONLY_ANCHORS >= 0);",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 99,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "be82629cc00961325182f03493d84f704b709020",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks. [Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-693330527).",
    "created_at": "2020-09-16T10:57:23Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489348580",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489348580"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489348580"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489348580/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2410,
    "side": "RIGHT",
    "in_reply_to_id": 489283478
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489348695",
    "pull_request_review_id": 489508960,
    "id": 489348695,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM0ODY5NQ==",
    "diff_hunk": "@@ -63,6 +63,9 @@ static const int MAX_OUTBOUND_FULL_RELAY_CONNECTIONS = 8;\n static const int MAX_ADDNODE_CONNECTIONS = 8;\n /** Maximum number of block-relay-only outgoing connections */\n static const int MAX_BLOCK_RELAY_ONLY_CONNECTIONS = 2;\n+/** Maximum number of block-relay-only anchor connections */\n+static constexpr int MAX_BLOCK_RELAY_ONLY_ANCHORS = 2;",
    "path": "src/net.h",
    "position": null,
    "original_position": 5,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "be82629cc00961325182f03493d84f704b709020",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks. [Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-693330527).",
    "created_at": "2020-09-16T10:57:37Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489348695",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489348695"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489348695"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489348695/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 67,
    "side": "RIGHT",
    "in_reply_to_id": 489284019
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489348880",
    "pull_request_review_id": 489509209,
    "id": 489348880,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM0ODg4MA==",
    "diff_hunk": "@@ -73,4 +73,15 @@ class CBanDB\n     bool Read(banmap_t& banSet);\n };\n \n+/** Dump the anchor IP address database (anchors.dat) */\n+void DumpAnchors(const fs::path& anchors_db_path, const std::vector<CAddress>& anchors);\n+\n+/**\n+ * Reads the anchor IP address database (anchors.dat)\n+ *\n+ * Anchors are last known outgoing block-relay-only peers that are\n+ * tried to re-connect to on startup.\n+ */\n+std::vector<CAddress> ReadAnchors(const fs::path& anchors_db_path, bool remove_after_read = true);",
    "path": "src/addrdb.h",
    "position": null,
    "original_position": 25,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "be82629cc00961325182f03493d84f704b709020",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "[Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-693330527).",
    "created_at": "2020-09-16T10:57:58Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489348880",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489348880"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489348880"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489348880/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 85,
    "side": "RIGHT",
    "in_reply_to_id": 489285516
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489349072",
    "pull_request_review_id": 489509486,
    "id": 489349072,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM0OTA3Mg==",
    "diff_hunk": "@@ -533,6 +537,7 @@ class CConnman\n     NetEventsInterface* m_msgproc;\n     /** Pointer to this node's banman. May be nullptr - check existence before dereferencing. */\n     BanMan* m_banman;\n+    std::vector<CAddress> m_anchors;",
    "path": "src/net.h",
    "position": 31,
    "original_position": 22,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "be82629cc00961325182f03493d84f704b709020",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-693330527).",
    "created_at": "2020-09-16T10:58:23Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489349072",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489349072"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489349072"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489349072/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 575,
    "original_line": 575,
    "side": "RIGHT",
    "in_reply_to_id": 489286613
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489349181",
    "pull_request_review_id": 489509620,
    "id": 489349181,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM0OTE4MQ==",
    "diff_hunk": "@@ -2377,6 +2406,17 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    m_anchors = ReadAnchors(GetDataDir() / ANCHORS_DATABASE_FILENAME);\n+    Assert(MAX_BLOCK_RELAY_ONLY_ANCHORS >= 0);\n+    constexpr size_t max_anchor_num = static_cast<size_t>(MAX_BLOCK_RELAY_ONLY_ANCHORS);",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 100,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "be82629cc00961325182f03493d84f704b709020",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "[Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-693330527).",
    "created_at": "2020-09-16T10:58:35Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489349181",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489349181"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489349181"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489349181/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2411,
    "side": "RIGHT",
    "in_reply_to_id": 489287610
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489349273",
    "pull_request_review_id": 489509754,
    "id": 489349273,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM0OTI3Mw==",
    "diff_hunk": "@@ -2492,6 +2532,14 @@ void CConnman::StopNodes()\n     if (fAddressesInitialized) {\n         DumpAddresses();\n         fAddressesInitialized = false;\n+\n+        auto anchors_to_dump = GetCurrentBlockRelayOnlyConns();",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 117,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "be82629cc00961325182f03493d84f704b709020",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-693330527).",
    "created_at": "2020-09-16T10:58:46Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489349273",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489349273"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489349273"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489349273/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2537,
    "side": "RIGHT",
    "in_reply_to_id": 489290793
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489594626",
    "pull_request_review_id": 489832267,
    "id": 489594626,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTU5NDYyNg==",
    "diff_hunk": "@@ -533,6 +537,7 @@ class CConnman\n     NetEventsInterface* m_msgproc;\n     /** Pointer to this node's banman. May be nullptr - check existence before dereferencing. */\n     BanMan* m_banman;\n+    std::vector<CAddress> m_anchors;",
    "path": "src/net.h",
    "position": 31,
    "original_position": 22,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "be82629cc00961325182f03493d84f704b709020",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks for adding this. Sorry I wasn't clearer, but I didn't mean you should add \"not connections that we'll necessarily store as anchor connections next time we shut down\" as a comment. That was me explaining to you _why_ a comment might be helpful. In general, I don't think comments should explain what the code_isn't_ doing.\r\n\r\nIf you have to touch this PR again, I'd suggest \"Addresses that were saved during the previous shutdown. We'll attempt to make block-relay-only connections to them.\"",
    "created_at": "2020-09-16T17:12:09Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489594626",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489594626"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489594626"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489594626/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 575,
    "original_line": 575,
    "side": "RIGHT",
    "in_reply_to_id": 489286613
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489605389",
    "pull_request_review_id": 489845338,
    "id": 489605389,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYwNTM4OQ==",
    "diff_hunk": "@@ -2377,6 +2409,15 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    m_anchors = ReadAnchors(GetDataDir() / ANCHORS_DATABASE_FILENAME);\n+    if (m_anchors.size() > MAX_BLOCK_RELAY_ONLY_ANCHORS) {\n+        m_anchors.resize(MAX_BLOCK_RELAY_ONLY_ANCHORS);\n+    }\n+\n+    if (m_use_addrman_outgoing) {",
    "path": "src/net.cpp",
    "position": 102,
    "original_position": 99,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "ee6a5002e718016b63fda2bb4ea42803e79302c9",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I wonder if the call to `ReadAnchors()` should be within this if block. If `ReadAnchors()` is outside the block, then when the node is started with `-noconnect`, not only will the node not connect to the anchors, it'll also throw away the file, so that when it's restarted without `-noconnect`, it won't try to reconnect to the old anchors. Is that what we want?",
    "created_at": "2020-09-16T17:31:02Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489605389",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489605389"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489605389"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489605389/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2456,
    "original_line": 2456,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489606943",
    "pull_request_review_id": 489847941,
    "id": 489606943,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYwNjk0Mw==",
    "diff_hunk": "@@ -2377,6 +2409,15 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    m_anchors = ReadAnchors(GetDataDir() / ANCHORS_DATABASE_FILENAME);\n+    if (m_anchors.size() > MAX_BLOCK_RELAY_ONLY_ANCHORS) {\n+        m_anchors.resize(MAX_BLOCK_RELAY_ONLY_ANCHORS);\n+    }\n+\n+    if (m_use_addrman_outgoing) {",
    "path": "src/net.cpp",
    "position": 102,
    "original_position": 99,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "ee6a5002e718016b63fda2bb4ea42803e79302c9",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> Is that what we want?\r\n\r\nI guess not.",
    "created_at": "2020-09-16T17:33:59Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489606943",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489606943"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489606943"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489606943/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2456,
    "original_line": 2456,
    "side": "RIGHT",
    "in_reply_to_id": 489605389
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489610595",
    "pull_request_review_id": 489852541,
    "id": 489610595,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYxMDU5NQ==",
    "diff_hunk": "@@ -2377,6 +2409,15 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    m_anchors = ReadAnchors(GetDataDir() / ANCHORS_DATABASE_FILENAME);\n+    if (m_anchors.size() > MAX_BLOCK_RELAY_ONLY_ANCHORS) {\n+        m_anchors.resize(MAX_BLOCK_RELAY_ONLY_ANCHORS);\n+    }\n+\n+    if (m_use_addrman_outgoing) {",
    "path": "src/net.cpp",
    "position": 102,
    "original_position": 99,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "ee6a5002e718016b63fda2bb4ea42803e79302c9",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-693556607).",
    "created_at": "2020-09-16T17:40:29Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489610595",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489610595"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489610595"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489610595/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2456,
    "original_line": 2456,
    "side": "RIGHT",
    "in_reply_to_id": 489605389
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489610881",
    "pull_request_review_id": 489852880,
    "id": 489610881,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYxMDg4MQ==",
    "diff_hunk": "@@ -533,6 +537,7 @@ class CConnman\n     NetEventsInterface* m_msgproc;\n     /** Pointer to this node's banman. May be nullptr - check existence before dereferencing. */\n     BanMan* m_banman;\n+    std::vector<CAddress> m_anchors;",
    "path": "src/net.h",
    "position": 31,
    "original_position": 22,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "be82629cc00961325182f03493d84f704b709020",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "[Improved](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-693556607).",
    "created_at": "2020-09-16T17:40:57Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489610881",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489610881"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r489610881"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489610881/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 575,
    "original_line": 575,
    "side": "RIGHT",
    "in_reply_to_id": 489286613
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/490107971",
    "pull_request_review_id": 490416036,
    "id": 490107971,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDEwNzk3MQ==",
    "diff_hunk": "@@ -2377,6 +2409,15 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    m_anchors = ReadAnchors(GetDataDir() / ANCHORS_DATABASE_FILENAME);\n+    if (m_anchors.size() > MAX_BLOCK_RELAY_ONLY_ANCHORS) {\n+        m_anchors.resize(MAX_BLOCK_RELAY_ONLY_ANCHORS);\n+    }\n+\n+    if (m_use_addrman_outgoing) {",
    "path": "src/net.cpp",
    "position": 102,
    "original_position": 99,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "ee6a5002e718016b63fda2bb4ea42803e79302c9",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "hmm, actually this still won't work, since if we start with `-noconnect`, then on shutdown we'll still write a new `anchors.dat` file without any peer addresses.",
    "created_at": "2020-09-17T09:36:09Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r490107971",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/490107971"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r490107971"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/490107971/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2456,
    "original_line": 2456,
    "side": "RIGHT",
    "in_reply_to_id": 489605389
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495040920",
    "pull_request_review_id": 496493779,
    "id": 495040920,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA0MDkyMA==",
    "diff_hunk": "@@ -49,6 +49,7 @@ Subdirectory       | File(s)               | Description\n `indexes/blockfilter/basic/db/` | LevelDB database      | Blockfilter index LevelDB database for the basic filtertype; *optional*, used if `-blockfilterindex=basic`\n `indexes/blockfilter/basic/`    | `fltrNNNNN.dat`<sup>[\\[2\\]](#note2)</sup> | Blockfilter index filters for the basic filtertype; *optional*, used if `-blockfilterindex=basic`\n `wallets/`         |                       | [Contains wallets](#multi-wallet-environment); can be specified by `-walletdir` option; if `wallets/` subdirectory does not exist, a wallet resides in the data directory\n+`./`               | `anchors.dat`         | Anchor IP address database. Anchors are last known outgoing block-relay-only peers that are tried to re-connect to on startup",
    "path": "doc/files.md",
    "position": null,
    "original_position": 4,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "27113fc53d0537393fc6c61a8a3dea0eced7f588",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "You can precise that this file is deleted after init to avoid user searching indefinitely for it while the node is operating.",
    "created_at": "2020-09-25T14:49:43Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r495040920",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495040920"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r495040920"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495040920/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 52,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495043232",
    "pull_request_review_id": 496493779,
    "id": 495043232,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA0MzIzMg==",
    "diff_hunk": "@@ -73,4 +73,15 @@ class CBanDB\n     bool Read(banmap_t& banSet);\n };\n \n+/** Dump the anchor IP address database (anchors.dat) */\n+void DumpAnchors(const fs::path& anchors_db_path, const std::vector<CAddress>& anchors);\n+\n+/**\n+ * Reads the anchor IP address database (anchors.dat)\n+ *\n+ * Anchors are last known outgoing block-relay-only peers that are\n+ * tried to re-connect to on startup.",
    "path": "src/addrdb.h",
    "position": 20,
    "original_position": 23,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "27113fc53d0537393fc6c61a8a3dea0eced7f588",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "You can precise that deleting of anchors.dat isn't accidental but intentional as it avoids renewed peering to anchors after a gross shutdown and thus potential exploitation of the anchor peer policy. ",
    "created_at": "2020-09-25T14:53:15Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r495043232",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495043232"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r495043232"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495043232/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 80,
    "original_line": 80,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495043537",
    "pull_request_review_id": 496493779,
    "id": 495043537,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA0MzUzNw==",
    "diff_hunk": "@@ -1893,6 +1899,7 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n \n         ConnectionType conn_type = ConnectionType::OUTBOUND_FULL_RELAY;\n         int64_t nTime = GetTimeMicros();\n+        bool anchor = false;",
    "path": "src/net.cpp",
    "position": 17,
    "original_position": 17,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "27113fc53d0537393fc6c61a8a3dea0eced7f588",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Don't we have a coding style convention to prefix flag by `f` ? What about `fAnchorAddr` ?",
    "created_at": "2020-09-25T14:53:47Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r495043537",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495043537"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r495043537"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495043537/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1933,
    "original_line": 1933,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495044526",
    "pull_request_review_id": 496493779,
    "id": 495044526,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA0NDUyNg==",
    "diff_hunk": "@@ -2378,6 +2410,14 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    if (m_use_addrman_outgoing) {",
    "path": "src/net.cpp",
    "position": 102,
    "original_position": 94,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "27113fc53d0537393fc6c61a8a3dea0eced7f588",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: \"Load addresses from anchors.dat\"",
    "created_at": "2020-09-25T14:55:12Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r495044526",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495044526"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r495044526"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495044526/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2456,
    "original_line": 2456,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495045898",
    "pull_request_review_id": 496493779,
    "id": 495045898,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA0NTg5OA==",
    "diff_hunk": "@@ -538,6 +539,12 @@ class CConnman\n     /** Pointer to this node's banman. May be nullptr - check existence before dereferencing. */\n     BanMan* m_banman;\n \n+    /**\n+     * Addresses that were saved during the previous clean shutdown. We'll\n+     * attempt to make block-relay-only connections to them.",
    "path": "src/net.h",
    "position": 29,
    "original_position": 14,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "27113fc53d0537393fc6c61a8a3dea0eced7f588",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think comment above ConnectionType::BLOCK_RELAY (`src/net.h L160) should be updated towards something like \r\n\r\n```\r\n/*\r\n * \"We automatically attempt to open MAX_BLOCK_RELAY_ONLY_ANCHORS using addresses from  \r\n * our anchors.dat. Then addresses from our AddrMan if MAX_BLOCK_RELAY_ONLY_CONNECTIONS \r\n * isn't reached yet\r\n*/\r\n```",
    "created_at": "2020-09-25T14:57:25Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r495045898",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495045898"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r495045898"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495045898/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 573,
    "original_line": 573,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495068537",
    "pull_request_review_id": 496493779,
    "id": 495068537,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA2ODUzNw==",
    "diff_hunk": "@@ -1925,6 +1935,22 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         int nTries = 0;\n         while (!interruptNet)\n         {\n+            // If we didn't find an appropriate destination after trying 100 addresses fetched from addrman,\n+            // stop this loop, and let the outer loop run again (which sleeps, adds seed nodes, recalculates\n+            // already-connected network ranges, ...) before trying new addrman addresses.\n+            nTries++;\n+            if (nTries > 100)\n+                break;\n+\n+            if (anchor) {\n+                const CAddress addr = m_anchors.back();\n+                m_anchors.pop_back();\n+                if (!addr.IsValid() || IsLocal(addr) || !IsReachable(addr)) continue;\n+                addrConnect = addr;\n+                LogPrint(BCLog::NET, \"Trying to make an anchor connection to %s\\n\", addrConnect.ToString());\n+                break;",
    "path": "src/net.cpp",
    "position": 51,
    "original_position": 50,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "27113fc53d0537393fc6c61a8a3dea0eced7f588",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think the relation between connections opening order (anchors -> regular outbounds) and the enforcement of peer diversity should be underscored better. With this patchset, I believe outbound peer diversity is enforced by the fact that OUTBOUND_FULL_RELAY/BLOCK_RELAY are opened after anchors and thus those regular outbound addresses will be checked against the anchor ones. \r\n\r\nIt could be better to exist this loop normally to let other checks happening while avoiding to call AddrMan::Select thanks to  the new`anchor` flag ? And add a comment above the connection type selection loop underscoring the order importance to avoid future work modifying it. E.g opening an OUTBOUND_FULL_RELAY may evict inadvertently an anchor in the same netgroup, thus diminishing effectiveness of anchors.\r\n\r\nIt would also enforce `HasDesirableServiceFlags()` on anchors. It's unlikely we learn change of their services before we connect to them but our desirability may have changed between a restart. Further, in case of a buggy/malicious `anchors.dat` we should check network groups distinctness of anchors among themselves.",
    "created_at": "2020-09-25T15:33:26Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r495068537",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495068537"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r495068537"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495068537/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1978,
    "original_line": 1978,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495071405",
    "pull_request_review_id": 496493779,
    "id": 495071405,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA3MTQwNQ==",
    "diff_hunk": "@@ -1904,7 +1911,10 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         // these conditions are met, check the nNextFeeler timer to decide if\n         // we should open a FEELER.\n \n-        if (nOutboundFullRelay < m_max_outbound_full_relay) {\n+        if (!m_anchors.empty() && (nOutboundBlockRelay < m_max_outbound_block_relay)) {",
    "path": "src/net.cpp",
    "position": 32,
    "original_position": 26,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "27113fc53d0537393fc6c61a8a3dea0eced7f588",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think comment above isn't accurate anymore as it clearly mentions OUTBOUND_FULL_RELAY has the highest priority which isn't true after this patchset.",
    "created_at": "2020-09-25T15:38:15Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r495071405",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495071405"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r495071405"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495071405/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1946,
    "original_line": 1946,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495078246",
    "pull_request_review_id": 496493779,
    "id": 495078246,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA3ODI0Ng==",
    "diff_hunk": "@@ -538,6 +539,12 @@ class CConnman\n     /** Pointer to this node's banman. May be nullptr - check existence before dereferencing. */\n     BanMan* m_banman;\n \n+    /**\n+     * Addresses that were saved during the previous clean shutdown. We'll\n+     * attempt to make block-relay-only connections to them.",
    "path": "src/net.h",
    "position": 29,
    "original_position": 14,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "27113fc53d0537393fc6c61a8a3dea0eced7f588",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I also wonder if saving anchor don't introduce a slight fingerprint if a node is started on IPV4 then moved to Tor and connect to the same anchors. A spying anchor, by coupling with other infos such as best advertised tip could guess the networks mapping.\r\n\r\nI think we should stamp the anchor.dat with last network type connected on and remove then if it has changed compared to actual one.\r\n\r\nWhat's your opinion ?",
    "created_at": "2020-09-25T15:49:20Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r495078246",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495078246"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r495078246"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495078246/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 573,
    "original_line": 573,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495086453",
    "pull_request_review_id": 496553860,
    "id": 495086453,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA4NjQ1Mw==",
    "diff_hunk": "@@ -1893,6 +1899,7 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n \n         ConnectionType conn_type = ConnectionType::OUTBOUND_FULL_RELAY;\n         int64_t nTime = GetTimeMicros();\n+        bool anchor = false;",
    "path": "src/net.cpp",
    "position": 17,
    "original_position": 17,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "27113fc53d0537393fc6c61a8a3dea0eced7f588",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "The project has long ceased to use Hungarian notation in new code :)",
    "created_at": "2020-09-25T16:02:38Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r495086453",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495086453"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r495086453"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495086453/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1933,
    "original_line": 1933,
    "side": "RIGHT",
    "in_reply_to_id": 495043537
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496035396",
    "pull_request_review_id": 497641692,
    "id": 496035396,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjAzNTM5Ng==",
    "diff_hunk": "@@ -538,6 +539,12 @@ class CConnman\n     /** Pointer to this node's banman. May be nullptr - check existence before dereferencing. */\n     BanMan* m_banman;\n \n+    /**\n+     * Addresses that were saved during the previous clean shutdown. We'll\n+     * attempt to make block-relay-only connections to them.",
    "path": "src/net.h",
    "position": 29,
    "original_position": 14,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "27113fc53d0537393fc6c61a8a3dea0eced7f588",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think it is a right way to only allow connection to an anchor of the network type, which is allowed to connect to by the current policy of the node. Good topic for a follow up.",
    "created_at": "2020-09-28T15:22:21Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r496035396",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496035396"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r496035396"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496035396/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 573,
    "original_line": 573,
    "side": "RIGHT",
    "in_reply_to_id": 495078246
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496099440",
    "pull_request_review_id": 497726949,
    "id": 496099440,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA5OTQ0MA==",
    "diff_hunk": "@@ -49,6 +49,7 @@ Subdirectory       | File(s)               | Description\n `indexes/blockfilter/basic/db/` | LevelDB database      | Blockfilter index LevelDB database for the basic filtertype; *optional*, used if `-blockfilterindex=basic`\n `indexes/blockfilter/basic/`    | `fltrNNNNN.dat`<sup>[\\[2\\]](#note2)</sup> | Blockfilter index filters for the basic filtertype; *optional*, used if `-blockfilterindex=basic`\n `wallets/`         |                       | [Contains wallets](#multi-wallet-environment); can be specified by `-walletdir` option; if `wallets/` subdirectory does not exist, a wallet resides in the data directory\n+`./`               | `anchors.dat`         | Anchor IP address database. Anchors are last known outgoing block-relay-only peers that are tried to re-connect to on startup",
    "path": "doc/files.md",
    "position": null,
    "original_position": 4,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "27113fc53d0537393fc6c61a8a3dea0eced7f588",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-700159056).",
    "created_at": "2020-09-28T16:58:59Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r496099440",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496099440"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r496099440"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496099440/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 52,
    "side": "RIGHT",
    "in_reply_to_id": 495040920
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496099778",
    "pull_request_review_id": 497727192,
    "id": 496099778,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA5OTc3OA==",
    "diff_hunk": "@@ -73,4 +73,15 @@ class CBanDB\n     bool Read(banmap_t& banSet);\n };\n \n+/** Dump the anchor IP address database (anchors.dat) */\n+void DumpAnchors(const fs::path& anchors_db_path, const std::vector<CAddress>& anchors);\n+\n+/**\n+ * Reads the anchor IP address database (anchors.dat)\n+ *\n+ * Anchors are last known outgoing block-relay-only peers that are\n+ * tried to re-connect to on startup.",
    "path": "src/addrdb.h",
    "position": 20,
    "original_position": 23,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "27113fc53d0537393fc6c61a8a3dea0eced7f588",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "[Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-700159056).",
    "created_at": "2020-09-28T16:59:18Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r496099778",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496099778"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r496099778"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496099778/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 80,
    "original_line": 80,
    "side": "RIGHT",
    "in_reply_to_id": 495043232
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496100618",
    "pull_request_review_id": 497727788,
    "id": 496100618,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjEwMDYxOA==",
    "diff_hunk": "@@ -2378,6 +2410,14 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    if (m_use_addrman_outgoing) {",
    "path": "src/net.cpp",
    "position": 102,
    "original_position": 94,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "27113fc53d0537393fc6c61a8a3dea0eced7f588",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "[Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-700159056).",
    "created_at": "2020-09-28T17:00:05Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r496100618",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496100618"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r496100618"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496100618/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2456,
    "original_line": 2456,
    "side": "RIGHT",
    "in_reply_to_id": 495044526
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496101123",
    "pull_request_review_id": 497728155,
    "id": 496101123,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjEwMTEyMw==",
    "diff_hunk": "@@ -538,6 +539,12 @@ class CConnman\n     /** Pointer to this node's banman. May be nullptr - check existence before dereferencing. */\n     BanMan* m_banman;\n \n+    /**\n+     * Addresses that were saved during the previous clean shutdown. We'll\n+     * attempt to make block-relay-only connections to them.",
    "path": "src/net.h",
    "position": 29,
    "original_position": 14,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "27113fc53d0537393fc6c61a8a3dea0eced7f588",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-700159056).",
    "created_at": "2020-09-28T17:00:34Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r496101123",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496101123"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r496101123"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496101123/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 573,
    "original_line": 573,
    "side": "RIGHT",
    "in_reply_to_id": 495045898
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496104062",
    "pull_request_review_id": 497731179,
    "id": 496104062,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjEwNDA2Mg==",
    "diff_hunk": "@@ -1925,6 +1935,22 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         int nTries = 0;\n         while (!interruptNet)\n         {\n+            // If we didn't find an appropriate destination after trying 100 addresses fetched from addrman,\n+            // stop this loop, and let the outer loop run again (which sleeps, adds seed nodes, recalculates\n+            // already-connected network ranges, ...) before trying new addrman addresses.\n+            nTries++;\n+            if (nTries > 100)\n+                break;\n+\n+            if (anchor) {\n+                const CAddress addr = m_anchors.back();\n+                m_anchors.pop_back();\n+                if (!addr.IsValid() || IsLocal(addr) || !IsReachable(addr)) continue;\n+                addrConnect = addr;\n+                LogPrint(BCLog::NET, \"Trying to make an anchor connection to %s\\n\", addrConnect.ToString());\n+                break;",
    "path": "src/net.cpp",
    "position": 51,
    "original_position": 50,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "27113fc53d0537393fc6c61a8a3dea0eced7f588",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-700159056).\r\n\r\nKeeping the added code in its own block for the following reasons:\r\n- some checks in the loop require `CAddrInfo` type but `m_anchors` contains only `CAddress` instances\r\n- smaller diff",
    "created_at": "2020-09-28T17:04:45Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r496104062",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496104062"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r496104062"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496104062/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1978,
    "original_line": 1978,
    "side": "RIGHT",
    "in_reply_to_id": 495068537
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496104277",
    "pull_request_review_id": 497731472,
    "id": 496104277,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjEwNDI3Nw==",
    "diff_hunk": "@@ -1904,7 +1911,10 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         // these conditions are met, check the nNextFeeler timer to decide if\n         // we should open a FEELER.\n \n-        if (nOutboundFullRelay < m_max_outbound_full_relay) {\n+        if (!m_anchors.empty() && (nOutboundBlockRelay < m_max_outbound_block_relay)) {",
    "path": "src/net.cpp",
    "position": 32,
    "original_position": 26,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "27113fc53d0537393fc6c61a8a3dea0eced7f588",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-700159056).",
    "created_at": "2020-09-28T17:05:07Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r496104277",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496104277"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r496104277"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496104277/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1946,
    "original_line": 1946,
    "side": "RIGHT",
    "in_reply_to_id": 495071405
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502283524",
    "pull_request_review_id": 505482704,
    "id": 502283524,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjI4MzUyNA==",
    "diff_hunk": "@@ -73,4 +73,20 @@ class CBanDB\n     bool Read(banmap_t& banSet);\n };\n \n+/**\n+ * Dump the anchor IP address database (anchors.dat)\n+ *\n+ * Anchors are last known outgoing block-relay-only peers that are\n+ * tried to re-connect to on startup.\n+ */\n+void DumpAnchors(const fs::path& anchors_db_path, const std::vector<CAddress>& anchors);\n+\n+/**\n+ * Read the anchor IP address database (anchors.dat)\n+ *\n+ * Deleting of anchors.dat is intentional as it avoids renewed peering to anchors after\n+ * a gross shutdown and thus potential exploitation of the anchor peer policy.",
    "path": "src/addrdb.h",
    "position": null,
    "original_position": 28,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "b397e49b0c390970713b4387e6dd254b926c70d0",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "s/a gross/an unclean/",
    "created_at": "2020-10-09T08:51:13Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r502283524",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502283524"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r502283524"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502283524/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 88,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502283891",
    "pull_request_review_id": 505482704,
    "id": 502283891,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjI4Mzg5MQ==",
    "diff_hunk": "@@ -73,4 +73,20 @@ class CBanDB\n     bool Read(banmap_t& banSet);\n };\n \n+/**\n+ * Dump the anchor IP address database (anchors.dat)\n+ *\n+ * Anchors are last known outgoing block-relay-only peers that are\n+ * tried to re-connect to on startup.\n+ */\n+void DumpAnchors(const fs::path& anchors_db_path, const std::vector<CAddress>& anchors);\n+\n+/**\n+ * Read the anchor IP address database (anchors.dat)\n+ *\n+ * Deleting of anchors.dat is intentional as it avoids renewed peering to anchors after",
    "path": "src/addrdb.h",
    "position": null,
    "original_position": 27,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "b397e49b0c390970713b4387e6dd254b926c70d0",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "/Deleting of anchors.dat/Deleting anchors.dat/",
    "created_at": "2020-10-09T08:51:53Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r502283891",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502283891"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r502283891"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502283891/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 87,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502293045",
    "pull_request_review_id": 505482704,
    "id": 502293045,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjI5MzA0NQ==",
    "diff_hunk": "@@ -2493,6 +2537,15 @@ void CConnman::StopNodes()\n     if (fAddressesInitialized) {\n         DumpAddresses();\n         fAddressesInitialized = false;\n+\n+        if (m_use_addrman_outgoing) {\n+            // Anchor connections are only dumped during clean shutdown.\n+            auto anchors_to_dump = GetCurrentBlockRelayOnlyConns();",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 121,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "b397e49b0c390970713b4387e6dd254b926c70d0",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think explicitly writing the type here (`std::vector<CAddress>`) is clearer here.",
    "created_at": "2020-10-09T09:07:52Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r502293045",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502293045"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r502293045"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502293045/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2543,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502293205",
    "pull_request_review_id": 505482704,
    "id": 502293205,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjI5MzIwNQ==",
    "diff_hunk": "@@ -49,6 +49,7 @@ Subdirectory       | File(s)               | Description\n `indexes/blockfilter/basic/db/` | LevelDB database      | Blockfilter index LevelDB database for the basic filtertype; *optional*, used if `-blockfilterindex=basic`\n `indexes/blockfilter/basic/`    | `fltrNNNNN.dat`<sup>[\\[2\\]](#note2)</sup> | Blockfilter index filters for the basic filtertype; *optional*, used if `-blockfilterindex=basic`\n `wallets/`         |                       | [Contains wallets](#multi-wallet-environment); can be specified by `-walletdir` option; if `wallets/` subdirectory does not exist, a wallet resides in the data directory\n+`./`               | `anchors.dat`         | Anchor IP address database, created on shutdown and deleted at start. Anchors are last known outgoing block-relay-only peers that are tried to re-connect to on startup",
    "path": "doc/files.md",
    "position": null,
    "original_position": 4,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "b397e49b0c390970713b4387e6dd254b926c70d0",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "s/deleted at start/deleted at startup/",
    "created_at": "2020-10-09T09:08:09Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r502293205",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502293205"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r502293205"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502293205/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 52,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502298262",
    "pull_request_review_id": 505482704,
    "id": 502298262,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjI5ODI2Mg==",
    "diff_hunk": "@@ -312,6 +314,7 @@ class CConnman\n      * call the function without a parameter to avoid using the cache.\n      */\n     std::vector<CAddress> GetAddresses(CNode& requestor, size_t max_addresses, size_t max_pct);\n+    std::vector<CAddress> GetCurrentBlockRelayOnlyConns() const;",
    "path": "src/net.h",
    "position": null,
    "original_position": 15,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "b397e49b0c390970713b4387e6dd254b926c70d0",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This can be private. Can you also add a short doxygen comment eg \"Return vector of current BLOCK_RELAY peers\"",
    "created_at": "2020-10-09T09:17:03Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r502298262",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502298262"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r502298262"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502298262/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 317,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502312789",
    "pull_request_review_id": 505520462,
    "id": 502312789,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjMxMjc4OQ==",
    "diff_hunk": "@@ -73,4 +73,20 @@ class CBanDB\n     bool Read(banmap_t& banSet);\n };\n \n+/**\n+ * Dump the anchor IP address database (anchors.dat)\n+ *\n+ * Anchors are last known outgoing block-relay-only peers that are\n+ * tried to re-connect to on startup.\n+ */\n+void DumpAnchors(const fs::path& anchors_db_path, const std::vector<CAddress>& anchors);\n+\n+/**\n+ * Read the anchor IP address database (anchors.dat)\n+ *\n+ * Deleting of anchors.dat is intentional as it avoids renewed peering to anchors after\n+ * a gross shutdown and thus potential exploitation of the anchor peer policy.",
    "path": "src/addrdb.h",
    "position": null,
    "original_position": 28,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "b397e49b0c390970713b4387e6dd254b926c70d0",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks. [Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-706081630).",
    "created_at": "2020-10-09T09:43:18Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r502312789",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502312789"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r502312789"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502312789/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 88,
    "side": "RIGHT",
    "in_reply_to_id": 502283524
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502312919",
    "pull_request_review_id": 505520640,
    "id": 502312919,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjMxMjkxOQ==",
    "diff_hunk": "@@ -73,4 +73,20 @@ class CBanDB\n     bool Read(banmap_t& banSet);\n };\n \n+/**\n+ * Dump the anchor IP address database (anchors.dat)\n+ *\n+ * Anchors are last known outgoing block-relay-only peers that are\n+ * tried to re-connect to on startup.\n+ */\n+void DumpAnchors(const fs::path& anchors_db_path, const std::vector<CAddress>& anchors);\n+\n+/**\n+ * Read the anchor IP address database (anchors.dat)\n+ *\n+ * Deleting of anchors.dat is intentional as it avoids renewed peering to anchors after",
    "path": "src/addrdb.h",
    "position": null,
    "original_position": 27,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "b397e49b0c390970713b4387e6dd254b926c70d0",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks. [Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-706081630).",
    "created_at": "2020-10-09T09:43:32Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r502312919",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502312919"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r502312919"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502312919/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 87,
    "side": "RIGHT",
    "in_reply_to_id": 502283891
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502313057",
    "pull_request_review_id": 505520841,
    "id": 502313057,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjMxMzA1Nw==",
    "diff_hunk": "@@ -2493,6 +2537,15 @@ void CConnman::StopNodes()\n     if (fAddressesInitialized) {\n         DumpAddresses();\n         fAddressesInitialized = false;\n+\n+        if (m_use_addrman_outgoing) {\n+            // Anchor connections are only dumped during clean shutdown.\n+            auto anchors_to_dump = GetCurrentBlockRelayOnlyConns();",
    "path": "src/net.cpp",
    "position": null,
    "original_position": 121,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "b397e49b0c390970713b4387e6dd254b926c70d0",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "[Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-706081630).",
    "created_at": "2020-10-09T09:43:50Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r502313057",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502313057"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r502313057"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502313057/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2543,
    "side": "RIGHT",
    "in_reply_to_id": 502293045
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502313130",
    "pull_request_review_id": 505520946,
    "id": 502313130,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjMxMzEzMA==",
    "diff_hunk": "@@ -49,6 +49,7 @@ Subdirectory       | File(s)               | Description\n `indexes/blockfilter/basic/db/` | LevelDB database      | Blockfilter index LevelDB database for the basic filtertype; *optional*, used if `-blockfilterindex=basic`\n `indexes/blockfilter/basic/`    | `fltrNNNNN.dat`<sup>[\\[2\\]](#note2)</sup> | Blockfilter index filters for the basic filtertype; *optional*, used if `-blockfilterindex=basic`\n `wallets/`         |                       | [Contains wallets](#multi-wallet-environment); can be specified by `-walletdir` option; if `wallets/` subdirectory does not exist, a wallet resides in the data directory\n+`./`               | `anchors.dat`         | Anchor IP address database, created on shutdown and deleted at start. Anchors are last known outgoing block-relay-only peers that are tried to re-connect to on startup",
    "path": "doc/files.md",
    "position": null,
    "original_position": 4,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "b397e49b0c390970713b4387e6dd254b926c70d0",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks. [Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-706081630).",
    "created_at": "2020-10-09T09:43:59Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r502313130",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502313130"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r502313130"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502313130/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 52,
    "side": "RIGHT",
    "in_reply_to_id": 502293205
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502313198",
    "pull_request_review_id": 505521042,
    "id": 502313198,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjMxMzE5OA==",
    "diff_hunk": "@@ -312,6 +314,7 @@ class CConnman\n      * call the function without a parameter to avoid using the cache.\n      */\n     std::vector<CAddress> GetAddresses(CNode& requestor, size_t max_addresses, size_t max_pct);\n+    std::vector<CAddress> GetCurrentBlockRelayOnlyConns() const;",
    "path": "src/net.h",
    "position": null,
    "original_position": 15,
    "commit_id": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "original_commit_id": "b397e49b0c390970713b4387e6dd254b926c70d0",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks. [Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-706081630).",
    "created_at": "2020-10-09T09:44:08Z",
    "updated_at": "2020-10-09T11:30:55Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r502313198",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502313198"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r502313198"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502313198/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 317,
    "side": "RIGHT",
    "in_reply_to_id": 502298262
  }
]