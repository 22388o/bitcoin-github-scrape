[
  {
    "sha": "567008d2a0c95bd972f4031f31647c493d1bc2e8",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1NjcwMDhkMmEwYzk1YmQ5NzJmNDAzMWYzMTY0N2M0OTNkMWJjMmU4",
    "commit": {
      "author": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2020-09-12T14:59:09Z"
      },
      "committer": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2020-10-09T11:28:58Z"
      },
      "message": "p2p: Add DumpAnchors()",
      "tree": {
        "sha": "8edcb1f8123c9bd70f736f15258be22316d148db",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8edcb1f8123c9bd70f736f15258be22316d148db"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/567008d2a0c95bd972f4031f31647c493d1bc2e8",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE0dvyxLlvLev0wWZUQQEIES5+qB8FAl+ASXoACgkQQQEIES5+\nqB8a6hAAia3aoyiU922cf29jIjLDLLNPYS5YFXiek+5iOz83OeQ/fuHuRRFM2U99\nnvwJaMnwACas3diUlnROxYcxFbDIrdCu0AHmQPofbTZmuIne+gqIOG855zbsACsu\n81kTOg8gXpt1mg1rNDSS6H19gliyq396vP7WWMT24+yND6BBFk9UlVGwu0Nh2AP5\nUgo1ww4sQ8g9jTn/LV7SlQy1X7Tk1G00tuU3VCp8P0K0kIGJYoIrSeXf7JsBPZAb\nKiO3eKQbBiS2KZUvQSThifbfAhK6xYFmO2+jL5gNvmhb+0LstNZLOwycqVnCjEaF\n5C8shKNWDE7AkRko2nKjQZ08t9Zw4JKMrQTbkCaTbU3SOkNDZLh5EPOHdbmsilcJ\nK7E5k70cXCobdr6yDk8zi3Esjv5Br/ukRRvsFqj1E+G+6e/lQf0ZPjxIWP2iHmBm\n5+ALeAOqH3V1n1pNIcvVzCoR8Vdgfpj8fu8ANR/JkY2dOfJwixWKWo6QB0Pvcqi5\ntoCPKxVABvzXjXeVhZ1qSSTFcOXyVf1P0FqXhbsMf96T0EypRPTmSeVNx8p6cPiR\nUSlBgdZ2pHNyao8f5C6gqQv/SCG8zQKWEs7dLN9WfOzU3urk6BIOym4DBdEGDPXl\nPhJDFVArVgOflodRq9q6e6rk7lN7R2wqtOEQ4WuPm1VeIOK4LT0=\n=M0a5\n-----END PGP SIGNATURE-----",
        "payload": "tree 8edcb1f8123c9bd70f736f15258be22316d148db\nparent 12a1c3ad1a43634d2a98717e49e3f02c4acea2fe\nauthor Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1599922749 +0300\ncommitter Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1602242938 +0300\n\np2p: Add DumpAnchors()\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/567008d2a0c95bd972f4031f31647c493d1bc2e8",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/567008d2a0c95bd972f4031f31647c493d1bc2e8",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/567008d2a0c95bd972f4031f31647c493d1bc2e8/comments",
    "author": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "12a1c3ad1a43634d2a98717e49e3f02c4acea2fe",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/12a1c3ad1a43634d2a98717e49e3f02c4acea2fe",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/12a1c3ad1a43634d2a98717e49e3f02c4acea2fe"
      }
    ],
    "stats": {
      "total": 19,
      "additions": 17,
      "deletions": 2
    },
    "files": [
      {
        "sha": "ca2d66570bfa952c82c8eece236de9b7d50c042e",
        "filename": "src/addrdb.cpp",
        "status": "modified",
        "additions": 7,
        "deletions": 0,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/567008d2a0c95bd972f4031f31647c493d1bc2e8/src/addrdb.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/567008d2a0c95bd972f4031f31647c493d1bc2e8/src/addrdb.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrdb.cpp?ref=567008d2a0c95bd972f4031f31647c493d1bc2e8",
        "patch": "@@ -10,6 +10,7 @@\n #include <clientversion.h>\n #include <cstdint>\n #include <hash.h>\n+#include <logging/timer.h>\n #include <random.h>\n #include <streams.h>\n #include <tinyformat.h>\n@@ -156,3 +157,9 @@ bool CAddrDB::Read(CAddrMan& addr, CDataStream& ssPeers)\n     }\n     return ret;\n }\n+\n+void DumpAnchors(const fs::path& anchors_db_path, const std::vector<CAddress>& anchors)\n+{\n+    LOG_TIME_SECONDS(strprintf(\"Flush %d outbound block-relay-only peer addresses to anchors.dat\", anchors.size()));\n+    SerializeFileDB(\"anchors\", anchors_db_path, anchors);\n+}"
      },
      {
        "sha": "614a0c20e30f633bb81469ec0b4eb6972c456583",
        "filename": "src/addrdb.h",
        "status": "modified",
        "additions": 10,
        "deletions": 2,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/567008d2a0c95bd972f4031f31647c493d1bc2e8/src/addrdb.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/567008d2a0c95bd972f4031f31647c493d1bc2e8/src/addrdb.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrdb.h?ref=567008d2a0c95bd972f4031f31647c493d1bc2e8",
        "patch": "@@ -11,9 +11,9 @@\n #include <serialize.h>\n \n #include <string>\n-#include <map>\n+#include <vector>\n \n-class CSubNet;\n+class CAddress;\n class CAddrMan;\n class CDataStream;\n \n@@ -73,4 +73,12 @@ class CBanDB\n     bool Read(banmap_t& banSet);\n };\n \n+/**\n+ * Dump the anchor IP address database (anchors.dat)\n+ *\n+ * Anchors are last known outgoing block-relay-only peers that are\n+ * tried to re-connect to on startup.\n+ */\n+void DumpAnchors(const fs::path& anchors_db_path, const std::vector<CAddress>& anchors);\n+\n #endif // BITCOIN_ADDRDB_H"
      }
    ]
  },
  {
    "sha": "c29272a157d09a8125788c1b860e89b63b4cb36c",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpjMjkyNzJhMTU3ZDA5YTgxMjU3ODhjMWI4NjBlODliNjNiNGNiMzZj",
    "commit": {
      "author": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2020-09-12T15:01:19Z"
      },
      "committer": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2020-10-09T11:29:04Z"
      },
      "message": "p2p: Add ReadAnchors()",
      "tree": {
        "sha": "378a03059381306e7e5ca2cbfafea1790ca9583c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/378a03059381306e7e5ca2cbfafea1790ca9583c"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c29272a157d09a8125788c1b860e89b63b4cb36c",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE0dvyxLlvLev0wWZUQQEIES5+qB8FAl+ASYAACgkQQQEIES5+\nqB/FOBAAvAYfDgbTjpyEKqCEJ40wVQx18g0YCAPlZVchnC7Ju72EkWHO/ZJNRUU4\nULeMPX8R62sW2mZFCCHXh4E0BbPK1XUXnbpr1JqRvhOk4h07vxT8uRF4DIENg0Od\npXs0Fh/7kWGDrujEqF3I7HhLtHIyDG+FHaz0ifsUGJZ+45ehQH5VTZ36aS1tFd8F\nLH2wBN6foHagYQCHUIbVNYvHiMkKAWub0e9bPFzZQQMqf3moLfmE9fnHjpxzN0Ah\nmbIuSkerE0oLk9FeI7HJD/wgBENk76YzuZbhMmkr0P+V1sK6gZ6BrBhxmE1/B5oE\n56Oy6yU84Je3R7/dA7eF3JrfabIh1Ua96rbvKxX+UJjZYN1Lht7KA1kXSnLs9k/m\ngUhZz7UxMDpel0zKlWQvamnttOL4uIuOtIp8Ub7DCYjQKN/JHzqvbNvWGadmxg4q\nnDSwx/7Ql0u4XT6grPZWpNVoe2mKSKbbfe444Avy2I6BDZ+0q6SwjZhVIXeEfSL2\nONnKXBsGyI9FsbfTSA8YH4YJXaOF0COTn8GKPkmb3Y516OZCfmuXUi7eMalKBH1Q\ndr37tDBh7RHS3iKgyOqUOn2+KUlfDea+eA5zNebaTfLibMJCEiQo9KkYsd+QaYls\nJV3ZTRGTU/zxNxnGn3uuBBsXlqZgkfT710j2TBjPIj1OVdtCpN0=\n=4Lz0\n-----END PGP SIGNATURE-----",
        "payload": "tree 378a03059381306e7e5ca2cbfafea1790ca9583c\nparent 567008d2a0c95bd972f4031f31647c493d1bc2e8\nauthor Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1599922879 +0300\ncommitter Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1602242944 +0300\n\np2p: Add ReadAnchors()\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c29272a157d09a8125788c1b860e89b63b4cb36c",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/c29272a157d09a8125788c1b860e89b63b4cb36c",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c29272a157d09a8125788c1b860e89b63b4cb36c/comments",
    "author": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "567008d2a0c95bd972f4031f31647c493d1bc2e8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/567008d2a0c95bd972f4031f31647c493d1bc2e8",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/567008d2a0c95bd972f4031f31647c493d1bc2e8"
      }
    ],
    "stats": {
      "total": 21,
      "additions": 21,
      "deletions": 0
    },
    "files": [
      {
        "sha": "27f22826a9e7d6c7d7ed52c11251ca6ee2092be9",
        "filename": "src/addrdb.cpp",
        "status": "modified",
        "additions": 13,
        "deletions": 0,
        "changes": 13,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c29272a157d09a8125788c1b860e89b63b4cb36c/src/addrdb.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c29272a157d09a8125788c1b860e89b63b4cb36c/src/addrdb.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrdb.cpp?ref=c29272a157d09a8125788c1b860e89b63b4cb36c",
        "patch": "@@ -163,3 +163,16 @@ void DumpAnchors(const fs::path& anchors_db_path, const std::vector<CAddress>& a\n     LOG_TIME_SECONDS(strprintf(\"Flush %d outbound block-relay-only peer addresses to anchors.dat\", anchors.size()));\n     SerializeFileDB(\"anchors\", anchors_db_path, anchors);\n }\n+\n+std::vector<CAddress> ReadAnchors(const fs::path& anchors_db_path)\n+{\n+    std::vector<CAddress> anchors;\n+    if (DeserializeFileDB(anchors_db_path, anchors)) {\n+        LogPrintf(\"Loaded %i addresses from %s\\n\", anchors.size(), anchors_db_path.filename());\n+    } else {\n+        anchors.clear();\n+    }\n+\n+    fs::remove(anchors_db_path);\n+    return anchors;\n+}"
      },
      {
        "sha": "4ac0e3e1b57929295844b0f4609737fff69af7df",
        "filename": "src/addrdb.h",
        "status": "modified",
        "additions": 8,
        "deletions": 0,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c29272a157d09a8125788c1b860e89b63b4cb36c/src/addrdb.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c29272a157d09a8125788c1b860e89b63b4cb36c/src/addrdb.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrdb.h?ref=c29272a157d09a8125788c1b860e89b63b4cb36c",
        "patch": "@@ -81,4 +81,12 @@ class CBanDB\n  */\n void DumpAnchors(const fs::path& anchors_db_path, const std::vector<CAddress>& anchors);\n \n+/**\n+ * Read the anchor IP address database (anchors.dat)\n+ *\n+ * Deleting anchors.dat is intentional as it avoids renewed peering to anchors after\n+ * an unclean shutdown and thus potential exploitation of the anchor peer policy.\n+ */\n+std::vector<CAddress> ReadAnchors(const fs::path& anchors_db_path);\n+\n #endif // BITCOIN_ADDRDB_H"
      }
    ]
  },
  {
    "sha": "bad16aff490dcf87722fbfe202a869fb24c734e1",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiYWQxNmFmZjQ5MGRjZjg3NzIyZmJmZTIwMmE4NjlmYjI0YzczNGUx",
    "commit": {
      "author": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2020-09-12T15:03:06Z"
      },
      "committer": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2020-10-09T11:29:04Z"
      },
      "message": "p2p: Add CConnman::GetCurrentBlockRelayOnlyConns()",
      "tree": {
        "sha": "3da2d65f68fb2151282ac219dbfd7965a13fd0bf",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3da2d65f68fb2151282ac219dbfd7965a13fd0bf"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/bad16aff490dcf87722fbfe202a869fb24c734e1",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE0dvyxLlvLev0wWZUQQEIES5+qB8FAl+ASYAACgkQQQEIES5+\nqB8yqg/+LqCFL8LCUNukAJhbGWzGO2lCEwPkSk5wGT+FBnfCuWHHFbjBwSe0ks3P\nWwBbYiY4UxmRsLqP1z5hWg02T4MobUrEPf0tffQ7P9P1efFlFLuE1RB/mbDFvM9L\nKbBedSg9SJc5eeI8R6N/K66URrElh+VCswDaTv3CBN/cYxjyJY719wLuKjZIpNyK\nNK95FD2BSlgwtDlB0GkEZok6l+FJ21EugPRzyvZ9LGj6zAKPxMYhPlX1xs3iQHZB\nCxanX4Yp3DQ90V7o3FQQJOHaIyRKnK8/7kaVrtUX+iqiL453zxRtP8VCBtpDTLKL\n2cwtNQ1Y2I7s7Od6xxBRM9R0RGX2T8V9QDv+VxjpzYoQk3wibGcCBP67/4nqMMA3\njiFtjxK5h/W45jVtWs8Tm7bUpLVLBNNzVj64y3+TI/95ojGN3jDztdFs5owbKq8U\n7fGJHq/xYEeQxktiq7HWd/PkKoArzBKg/J/xlKD5mpO/3OeQK86cLs/qNFTlVYCi\nhl7CQRShH6JX1wk9nMVYysefFsZjL6CB731NpjpSBpRZtAqWhpWCviDlKNO/H26O\nxAttXg6QvTJ+5Sk3rBXCjxa+rfUxi+yxFFPjPna+C7Momc/plw+rYUM7jIErllL9\nEO6MgkYsO4GdSx+0GssPBAnBFp6pn/ymzHR9plY4jCqwABlIQG4=\n=sUyy\n-----END PGP SIGNATURE-----",
        "payload": "tree 3da2d65f68fb2151282ac219dbfd7965a13fd0bf\nparent c29272a157d09a8125788c1b860e89b63b4cb36c\nauthor Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1599922986 +0300\ncommitter Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1602242944 +0300\n\np2p: Add CConnman::GetCurrentBlockRelayOnlyConns()\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bad16aff490dcf87722fbfe202a869fb24c734e1",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/bad16aff490dcf87722fbfe202a869fb24c734e1",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bad16aff490dcf87722fbfe202a869fb24c734e1/comments",
    "author": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "c29272a157d09a8125788c1b860e89b63b4cb36c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c29272a157d09a8125788c1b860e89b63b4cb36c",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/c29272a157d09a8125788c1b860e89b63b4cb36c"
      }
    ],
    "stats": {
      "total": 18,
      "additions": 18,
      "deletions": 0
    },
    "files": [
      {
        "sha": "53cf4ca01702973a931c231b1bebb9b3e805a4f7",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 13,
        "deletions": 0,
        "changes": 13,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/bad16aff490dcf87722fbfe202a869fb24c734e1/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/bad16aff490dcf87722fbfe202a869fb24c734e1/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=bad16aff490dcf87722fbfe202a869fb24c734e1",
        "patch": "@@ -2019,6 +2019,19 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n     }\n }\n \n+std::vector<CAddress> CConnman::GetCurrentBlockRelayOnlyConns() const\n+{\n+    std::vector<CAddress> ret;\n+    LOCK(cs_vNodes);\n+    for (const CNode* pnode : vNodes) {\n+        if (pnode->IsBlockOnlyConn()) {\n+            ret.push_back(pnode->addr);\n+        }\n+    }\n+\n+    return ret;\n+}\n+\n std::vector<AddedNodeInfo> CConnman::GetAddedNodeInfo()\n {\n     std::vector<AddedNodeInfo> ret;"
      },
      {
        "sha": "adeee1579aafd2116c8b78478f2fe3e22238fad4",
        "filename": "src/net.h",
        "status": "modified",
        "additions": 5,
        "deletions": 0,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/bad16aff490dcf87722fbfe202a869fb24c734e1/src/net.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/bad16aff490dcf87722fbfe202a869fb24c734e1/src/net.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.h?ref=bad16aff490dcf87722fbfe202a869fb24c734e1",
        "patch": "@@ -460,6 +460,11 @@ class CConnman\n     void RecordBytesRecv(uint64_t bytes);\n     void RecordBytesSent(uint64_t bytes);\n \n+    /**\n+     * Return vector of current BLOCK_RELAY peers.\n+     */\n+    std::vector<CAddress> GetCurrentBlockRelayOnlyConns() const;\n+\n     // Whether the node should be passed out in ForEach* callbacks\n     static bool NodeFullyConnected(const CNode* pnode);\n "
      }
    ]
  },
  {
    "sha": "4170b46544231e7cf1d64ac3baa314083be37502",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0MTcwYjQ2NTQ0MjMxZTdjZjFkNjRhYzNiYWEzMTQwODNiZTM3NTAy",
    "commit": {
      "author": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2020-09-12T15:05:54Z"
      },
      "committer": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2020-10-09T11:29:05Z"
      },
      "message": "p2p: Integrate DumpAnchors() and ReadAnchors() into CConnman",
      "tree": {
        "sha": "5d4324f5db9a1984224b581cdfa2bf908d9776c6",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/5d4324f5db9a1984224b581cdfa2bf908d9776c6"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4170b46544231e7cf1d64ac3baa314083be37502",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE0dvyxLlvLev0wWZUQQEIES5+qB8FAl+ASYEACgkQQQEIES5+\nqB9taQ/8DzK5vWfWvRQ+CDoldBKtMl26CGbKKnEPKWPayKRw7wfpzzelb+dELtOZ\nvLgiT92ZXLasE+sFDfkdKoxfMBQ6tV0ASOfnTlxsuJiynaHVt6m6oQLHij00Bv7l\n8X/lsSKHv+LPg8Kl5dGB0gJ19MYJeIU+FINqqfOL4pnq8J9zZmICYeqRlPG2pXDV\nLd7FfdrccctVqN7OfI/nAvbUsFJMXE9HXgYzxGLL9hzzDvNoMcvWQovv3XYFki/1\nlD3q4VCMoYjHysH6iPoyc+cYCbFFKEK30ZB6kvpmOPug0pRhX7RHY4iYqJtVmbzg\n1Hqghn0Lac+A4tMcv9bUETbSHKOwdXTDfMsGVcvom6dAFvDzIbsk/opTnvdGS8k/\nFyDK933qA76jYy4QYsHzI79+QiWcTIjZypFbsKaGNnYeBBrE2SdX/ysXm1eb5esc\n0ss2L1JlkwgjC2N4+obLvEOz9lRBDM8uR/4sqegUQtvDhpyPt3nw/CFP6bF+SoT8\nqkmoJVP0zxSj5xFi3UApyFUo8zf/UAQ+fqKiHjbWR0vWXI2xV5PGoSTic9/135Nw\nDAPishIdKeg4wGj3bz0FyGZVVhI6p5pKr8dwbk89tXkYmlwxEcgZ8RcVBs4uvu4O\njgjRAZ3AKkyfcm5ZANkrjBayT1jjJscLVMkLm4LzM68+ROzG2V0=\n=bFaf\n-----END PGP SIGNATURE-----",
        "payload": "tree 5d4324f5db9a1984224b581cdfa2bf908d9776c6\nparent bad16aff490dcf87722fbfe202a869fb24c734e1\nauthor Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1599923154 +0300\ncommitter Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1602242945 +0300\n\np2p: Integrate DumpAnchors() and ReadAnchors() into CConnman\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4170b46544231e7cf1d64ac3baa314083be37502",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/4170b46544231e7cf1d64ac3baa314083be37502",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4170b46544231e7cf1d64ac3baa314083be37502/comments",
    "author": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "bad16aff490dcf87722fbfe202a869fb24c734e1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bad16aff490dcf87722fbfe202a869fb24c734e1",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/bad16aff490dcf87722fbfe202a869fb24c734e1"
      }
    ],
    "stats": {
      "total": 30,
      "additions": 30,
      "deletions": 0
    },
    "files": [
      {
        "sha": "0fb4bf9bde5be1d49a47c657b21a5553dce23900",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 24,
        "deletions": 0,
        "changes": 24,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4170b46544231e7cf1d64ac3baa314083be37502/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4170b46544231e7cf1d64ac3baa314083be37502/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=4170b46544231e7cf1d64ac3baa314083be37502",
        "patch": "@@ -46,6 +46,12 @@ static_assert(MINIUPNPC_API_VERSION >= 10, \"miniUPnPc API version >= 10 assumed\"\n \n #include <math.h>\n \n+/** Maximum number of block-relay-only anchor connections */\n+static constexpr size_t MAX_BLOCK_RELAY_ONLY_ANCHORS = 2;\n+static_assert (MAX_BLOCK_RELAY_ONLY_ANCHORS <= static_cast<size_t>(MAX_BLOCK_RELAY_ONLY_CONNECTIONS), \"MAX_BLOCK_RELAY_ONLY_ANCHORS must not exceed MAX_BLOCK_RELAY_ONLY_CONNECTIONS.\");\n+/** Anchor IP address database file name */\n+const char* const ANCHORS_DATABASE_FILENAME = \"anchors.dat\";\n+\n // How often to dump addresses to peers.dat\n static constexpr std::chrono::minutes DUMP_PEERS_INTERVAL{15};\n \n@@ -2431,6 +2437,15 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    if (m_use_addrman_outgoing) {\n+        // Load addresses from anchors.dat\n+        m_anchors = ReadAnchors(GetDataDir() / ANCHORS_DATABASE_FILENAME);\n+        if (m_anchors.size() > MAX_BLOCK_RELAY_ONLY_ANCHORS) {\n+            m_anchors.resize(MAX_BLOCK_RELAY_ONLY_ANCHORS);\n+        }\n+        LogPrintf(\"%i block-relay-only anchors will be tried for connections.\\n\", m_anchors.size());\n+    }\n+\n     uiInterface.InitMessage(_(\"Starting network threads...\").translated);\n \n     fAddressesInitialized = true;\n@@ -2546,6 +2561,15 @@ void CConnman::StopNodes()\n     if (fAddressesInitialized) {\n         DumpAddresses();\n         fAddressesInitialized = false;\n+\n+        if (m_use_addrman_outgoing) {\n+            // Anchor connections are only dumped during clean shutdown.\n+            std::vector<CAddress> anchors_to_dump = GetCurrentBlockRelayOnlyConns();\n+            if (anchors_to_dump.size() > MAX_BLOCK_RELAY_ONLY_ANCHORS) {\n+                anchors_to_dump.resize(MAX_BLOCK_RELAY_ONLY_ANCHORS);\n+            }\n+            DumpAnchors(GetDataDir() / ANCHORS_DATABASE_FILENAME, anchors_to_dump);\n+        }\n     }\n \n     // Close sockets"
      },
      {
        "sha": "7b7885f839d825c12b881d8b9c0d6d4b198bd4df",
        "filename": "src/net.h",
        "status": "modified",
        "additions": 6,
        "deletions": 0,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4170b46544231e7cf1d64ac3baa314083be37502/src/net.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4170b46544231e7cf1d64ac3baa314083be37502/src/net.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.h?ref=4170b46544231e7cf1d64ac3baa314083be37502",
        "patch": "@@ -566,6 +566,12 @@ class CConnman\n     /** Pointer to this node's banman. May be nullptr - check existence before dereferencing. */\n     BanMan* m_banman;\n \n+    /**\n+     * Addresses that were saved during the previous clean shutdown. We'll\n+     * attempt to make block-relay-only connections to them.\n+     */\n+    std::vector<CAddress> m_anchors;\n+\n     /** SipHasher seeds for deterministic randomness */\n     const uint64_t nSeed0, nSeed1;\n "
      }
    ]
  },
  {
    "sha": "5543c7ab285e90256cbbf9858249e028c9611cda",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1NTQzYzdhYjI4NWU5MDI1NmNiYmY5ODU4MjQ5ZTAyOGM5NjExY2Rh",
    "commit": {
      "author": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2020-09-12T15:17:49Z"
      },
      "committer": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2020-10-09T11:29:05Z"
      },
      "message": "p2p: Fix off-by-one error in fetching address loop\n\nThis is a move-only commit.",
      "tree": {
        "sha": "b935d00fb33e4e483ff406d9bc6617c7351974f9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b935d00fb33e4e483ff406d9bc6617c7351974f9"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5543c7ab285e90256cbbf9858249e028c9611cda",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE0dvyxLlvLev0wWZUQQEIES5+qB8FAl+ASYEACgkQQQEIES5+\nqB9wCQ//ceMVquruix0/PFycn4XrNbAwLFvnVgE2MCYeKUKNpRKeEjmlwwyOJLyK\nfIcZzBs9jM1lma/SdbnRQuwi7hXtcVw6ni3v7B/3jwEQCmpafAzjkvpoppCLNVaZ\n1TdykWjv7UjVwZJDzXgpM3X1MmSpzA784WTIQIm0uQSveKJmT6uAuJtJU/Thihvp\nCn4vVEVuKykSUjceCGaLv5fJTRoqoyUpiCTJNAfHsselYJKweau0ilSltbA0cSUy\ni1bOUhAuU/FSEBMzRox929jKjVxGpwIRRvSGMtXZmZhw6HLhe6mEQ8Yj5r6lO/HO\ngD+VjcoEQEgLY1WKNUTwwP+9CJIMH5HHsX7ZpyV6+9QGBF8g6Jmz8pMdJMyzXU/9\nOhFDMNlQ6QoHcdnDZOlxJC73xZSjIrWguNqT5ABmTL/aPUJs8KnyI5VvrqUH08Po\nli2eRLYYSnbtcz+Th5RR1MsYFNsuSodFww7nmXSOBol6TJ6h+Bx7n1sFzvHSxQrt\nU3ad81VMhcI9oVhMG3bF95OWhzQ5jLYVKN9QuOOj5VmM/avOglu+esnqOBbaMaxQ\nAmH32tZPGJ+/wEHouHdM/sS3Vhak3FrPMmd/g5wf2YTA83Ya08EB03QYRRPdtc5g\nx6+1bJveoCRJWIjQzzuNzedjswYqKqsANgNUX+MHNUU2S1BWsrc=\n=/g+1\n-----END PGP SIGNATURE-----",
        "payload": "tree b935d00fb33e4e483ff406d9bc6617c7351974f9\nparent 4170b46544231e7cf1d64ac3baa314083be37502\nauthor Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1599923869 +0300\ncommitter Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1602242945 +0300\n\np2p: Fix off-by-one error in fetching address loop\n\nThis is a move-only commit.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5543c7ab285e90256cbbf9858249e028c9611cda",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/5543c7ab285e90256cbbf9858249e028c9611cda",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5543c7ab285e90256cbbf9858249e028c9611cda/comments",
    "author": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "4170b46544231e7cf1d64ac3baa314083be37502",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4170b46544231e7cf1d64ac3baa314083be37502",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/4170b46544231e7cf1d64ac3baa314083be37502"
      }
    ],
    "stats": {
      "total": 14,
      "additions": 7,
      "deletions": 7
    },
    "files": [
      {
        "sha": "0fe06641e18c33517bbbbd105f05d48bbade48f3",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 7,
        "deletions": 7,
        "changes": 14,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5543c7ab285e90256cbbf9858249e028c9611cda/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5543c7ab285e90256cbbf9858249e028c9611cda/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=5543c7ab285e90256cbbf9858249e028c9611cda",
        "patch": "@@ -1962,6 +1962,13 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         int nTries = 0;\n         while (!interruptNet)\n         {\n+            // If we didn't find an appropriate destination after trying 100 addresses fetched from addrman,\n+            // stop this loop, and let the outer loop run again (which sleeps, adds seed nodes, recalculates\n+            // already-connected network ranges, ...) before trying new addrman addresses.\n+            nTries++;\n+            if (nTries > 100)\n+                break;\n+\n             CAddrInfo addr = addrman.SelectTriedCollision();\n \n             // SelectTriedCollision returns an invalid address if it is empty.\n@@ -1979,13 +1986,6 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n                 break;\n             }\n \n-            // If we didn't find an appropriate destination after trying 100 addresses fetched from addrman,\n-            // stop this loop, and let the outer loop run again (which sleeps, adds seed nodes, recalculates\n-            // already-connected network ranges, ...) before trying new addrman addresses.\n-            nTries++;\n-            if (nTries > 100)\n-                break;\n-\n             if (!IsReachable(addr))\n                 continue;\n "
      }
    ]
  },
  {
    "sha": "0a85e5a7bc8dc6587963e2e37ac1b087a1fc97fe",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzowYTg1ZTVhN2JjOGRjNjU4Nzk2M2UyZTM3YWMxYjA4N2ExZmM5N2Zl",
    "commit": {
      "author": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2020-06-05T06:38:09Z"
      },
      "committer": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2020-10-09T11:29:05Z"
      },
      "message": "p2p: Try to connect to anchors once",
      "tree": {
        "sha": "f6b4f13e5b5ed23973b55a917c08bfd3ada49380",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f6b4f13e5b5ed23973b55a917c08bfd3ada49380"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0a85e5a7bc8dc6587963e2e37ac1b087a1fc97fe",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE0dvyxLlvLev0wWZUQQEIES5+qB8FAl+ASYEACgkQQQEIES5+\nqB/PHhAAlMORBDruGtupbv/YsIdlHm6/d4iveQJ3TVaGzGwUkHUpzJoQbiFRXFkp\nOtsypQGhz8n8p1WqPM2wZrzsRn6eRlXXm8m8V6PZtMeAIFz1V3Y5HDTUXxs8aetT\n+hrLLVj+2Fsj6xgpRjNn3r8Nndo5x2ORtcMtWctaBv7Ybj1+7Eokg+d5Red7rx3D\nGg7IXz6fLFyv6XWh5cyflJbDgbOWnP+Coe3lgTcCbNLQfQ+3yjkLVjz9BO/kd8KK\nyuwgfwyTA6TsfAYUFhnhD6wklivcrAJkB4Pf4/M7NMEM+L/1xxKst0XjOCt5R8Iq\nHoK+VDzOahOZUzqYXVeLmtcy6X6lMBMpWsrHchyGUoH6pKNSiEpfgQ5Y/Ja8A4dR\nQp163njgHSJj3JtivyviHhKeOjPC20TbBctWKlJo+802zBIOkdct0aiWV1zYKreY\nkt5BPbMhuxXUqHzR6YWYD6reWA5HjZPYGlaDoqargC9g+bgOPKXcG4QXvPQiOCnA\niGBczeEwRg8uxa0Np+PToxu4jVG4rKacgJ5v5B9r4HmRRhoMK8EI2Av59itRvHsW\n47APlfC4Ivu/KZ1UbAn165vSrG7FoeoEl1DogojL0Z9+eElrBgPUjV92BZRX0/y0\nNo8ZOdrl7GrS4oPDWtgvLjpgSUaMlys/oawa+guuD+pOVnboh7o=\n=NOwd\n-----END PGP SIGNATURE-----",
        "payload": "tree f6b4f13e5b5ed23973b55a917c08bfd3ada49380\nparent 5543c7ab285e90256cbbf9858249e028c9611cda\nauthor Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1591339089 +0300\ncommitter Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1602242945 +0300\n\np2p: Try to connect to anchors once\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0a85e5a7bc8dc6587963e2e37ac1b087a1fc97fe",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/0a85e5a7bc8dc6587963e2e37ac1b087a1fc97fe",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0a85e5a7bc8dc6587963e2e37ac1b087a1fc97fe/comments",
    "author": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "5543c7ab285e90256cbbf9858249e028c9611cda",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5543c7ab285e90256cbbf9858249e028c9611cda",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/5543c7ab285e90256cbbf9858249e028c9611cda"
      }
    ],
    "stats": {
      "total": 24,
      "additions": 21,
      "deletions": 3
    },
    "files": [
      {
        "sha": "95cd9b8d1674d7dd7aacfd3669934832da6378a4",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 18,
        "deletions": 2,
        "changes": 20,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/0a85e5a7bc8dc6587963e2e37ac1b087a1fc97fe/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/0a85e5a7bc8dc6587963e2e37ac1b087a1fc97fe/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=0a85e5a7bc8dc6587963e2e37ac1b087a1fc97fe",
        "patch": "@@ -1930,18 +1930,23 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n \n         ConnectionType conn_type = ConnectionType::OUTBOUND_FULL_RELAY;\n         int64_t nTime = GetTimeMicros();\n+        bool anchor = false;\n         bool fFeeler = false;\n \n         // Determine what type of connection to open. Opening\n-        // OUTBOUND_FULL_RELAY connections gets the highest priority until we\n+        // BLOCK_RELAY connections to addresses from anchors.dat gets the highest\n+        // priority. Then we open OUTBOUND_FULL_RELAY priority until we\n         // meet our full-relay capacity. Then we open BLOCK_RELAY connection\n         // until we hit our block-relay-only peer limit.\n         // GetTryNewOutboundPeer() gets set when a stale tip is detected, so we\n         // try opening an additional OUTBOUND_FULL_RELAY connection. If none of\n         // these conditions are met, check the nNextFeeler timer to decide if\n         // we should open a FEELER.\n \n-        if (nOutboundFullRelay < m_max_outbound_full_relay) {\n+        if (!m_anchors.empty() && (nOutboundBlockRelay < m_max_outbound_block_relay)) {\n+            conn_type = ConnectionType::BLOCK_RELAY;\n+            anchor = true;\n+        } else if (nOutboundFullRelay < m_max_outbound_full_relay) {\n             // OUTBOUND_FULL_RELAY\n         } else if (nOutboundBlockRelay < m_max_outbound_block_relay) {\n             conn_type = ConnectionType::BLOCK_RELAY;\n@@ -1962,6 +1967,17 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         int nTries = 0;\n         while (!interruptNet)\n         {\n+            if (anchor && !m_anchors.empty()) {\n+                const CAddress addr = m_anchors.back();\n+                m_anchors.pop_back();\n+                if (!addr.IsValid() || IsLocal(addr) || !IsReachable(addr) ||\n+                    !HasAllDesirableServiceFlags(addr.nServices) ||\n+                    setConnected.count(addr.GetGroup(addrman.m_asmap))) continue;\n+                addrConnect = addr;\n+                LogPrint(BCLog::NET, \"Trying to make an anchor connection to %s\\n\", addrConnect.ToString());\n+                break;\n+            }\n+\n             // If we didn't find an appropriate destination after trying 100 addresses fetched from addrman,\n             // stop this loop, and let the outer loop run again (which sleeps, adds seed nodes, recalculates\n             // already-connected network ranges, ...) before trying new addrman addresses."
      },
      {
        "sha": "616b986e4ac5f0e0c35d83f55dca5a342ec5fe3f",
        "filename": "src/net.h",
        "status": "modified",
        "additions": 3,
        "deletions": 1,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/0a85e5a7bc8dc6587963e2e37ac1b087a1fc97fe/src/net.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/0a85e5a7bc8dc6587963e2e37ac1b087a1fc97fe/src/net.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.h?ref=0a85e5a7bc8dc6587963e2e37ac1b087a1fc97fe",
        "patch": "@@ -174,7 +174,9 @@ enum class ConnectionType {\n      * attacks. By not relaying transactions or addresses, these connections\n      * are harder to detect by a third party, thus helping obfuscate the\n      * network topology. We automatically attempt to open\n-     * MAX_BLOCK_RELAY_ONLY_CONNECTIONS using addresses from our AddrMan.\n+     * MAX_BLOCK_RELAY_ONLY_ANCHORS using addresses from our anchors.dat. Then\n+     * addresses from our AddrMan if MAX_BLOCK_RELAY_ONLY_CONNECTIONS\n+     * isn't reached yet.\n      */\n     BLOCK_RELAY,\n "
      }
    ]
  },
  {
    "sha": "a490d074b3491427afbd677f5fa635b910f8bb34",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzphNDkwZDA3NGIzNDkxNDI3YWZiZDY3N2Y1ZmE2MzViOTEwZjhiYjM0",
    "commit": {
      "author": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2020-09-12T16:47:53Z"
      },
      "committer": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2020-10-09T11:30:09Z"
      },
      "message": "doc: Add anchors.dat to files.md",
      "tree": {
        "sha": "463f3985d4c4e7ef1f67a6dcd8dc52f8ca8489b8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/463f3985d4c4e7ef1f67a6dcd8dc52f8ca8489b8"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a490d074b3491427afbd677f5fa635b910f8bb34",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE0dvyxLlvLev0wWZUQQEIES5+qB8FAl+AScEACgkQQQEIES5+\nqB/zAw/+N+kPDqRK+JGz0edaPmgTrYEsPsuVBe+skl2cQC0BTmU1XYztjxsaQ+9A\niaMcrZS+mAj8nppqGmNJGKZHGQniAwNj7DaNVfOs7PPCfBmL5t9/DPW6cVQ5ls6k\nvqbM3X3nfLUZK5h6YEteLqZZxCKhy235Oecmj4BRTRNINdlO+bxobdQXgO97H6VS\nRQnhCqaEKNnxXrp8oSd8iF3jzAYp8SKnxEXBTOmx4KlVa5t5wVuhJcDSu5/AzAbR\ncv+h4Nb8jtRf8/8SsOQWAHv7/PTBy0Zk3UuWM0XF9/pYexAsUzDosqELjBvedQ1d\n6IuZRf14KirOolZMX3+vK7fAUMgencos1C7Qk+sDODMdK8Mb/pA7ls5V9fsIWknF\nMM0rX2enSt16L+aqsTLj4WWx5iYUZS+jATso9NXS0UjcCfhyTf6EI014zDtyZaRA\nQrGUjz4dfdfxhSboxZwSWi2G37HVX/d/Ng1UXMD33DkBS//1SM6NF01rCB8IHfiD\nCKur19e8jUtc+mslP30mJQlBX+8V7umJGFL/P8xqsPTM0fC8ozkhWlSqNefey8eZ\nowgJXnFnor5JdkWO3BgkzH7EYvq9PzFkCEs8LwTq+H94btu6i4n7zVTpj6qH+mlw\nMBRtonixyTAbq6Nm7m7FPrWFrgedqAEBWadanGGQe2V70kQCgHs=\n=SISc\n-----END PGP SIGNATURE-----",
        "payload": "tree 463f3985d4c4e7ef1f67a6dcd8dc52f8ca8489b8\nparent 0a85e5a7bc8dc6587963e2e37ac1b087a1fc97fe\nauthor Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1599929273 +0300\ncommitter Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1602243009 +0300\n\ndoc: Add anchors.dat to files.md\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a490d074b3491427afbd677f5fa635b910f8bb34",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/a490d074b3491427afbd677f5fa635b910f8bb34",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a490d074b3491427afbd677f5fa635b910f8bb34/comments",
    "author": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "0a85e5a7bc8dc6587963e2e37ac1b087a1fc97fe",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0a85e5a7bc8dc6587963e2e37ac1b087a1fc97fe",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/0a85e5a7bc8dc6587963e2e37ac1b087a1fc97fe"
      }
    ],
    "stats": {
      "total": 1,
      "additions": 1,
      "deletions": 0
    },
    "files": [
      {
        "sha": "df252b5f49bd53ebb51be6941bf3187932370a95",
        "filename": "doc/files.md",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/a490d074b3491427afbd677f5fa635b910f8bb34/doc/files.md",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/a490d074b3491427afbd677f5fa635b910f8bb34/doc/files.md",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/doc/files.md?ref=a490d074b3491427afbd677f5fa635b910f8bb34",
        "patch": "@@ -50,6 +50,7 @@ Subdirectory       | File(s)               | Description\n `indexes/blockfilter/basic/db/` | LevelDB database      | Blockfilter index LevelDB database for the basic filtertype; *optional*, used if `-blockfilterindex=basic`\n `indexes/blockfilter/basic/`    | `fltrNNNNN.dat`<sup>[\\[2\\]](#note2)</sup> | Blockfilter index filters for the basic filtertype; *optional*, used if `-blockfilterindex=basic`\n `wallets/`         |                       | [Contains wallets](#multi-wallet-environment); can be specified by `-walletdir` option; if `wallets/` subdirectory does not exist, wallets reside in the [data directory](#data-directory-location)\n+`./`               | `anchors.dat`         | Anchor IP address database, created on shutdown and deleted at startup. Anchors are last known outgoing block-relay-only peers that are tried to re-connect to on startup\n `./`               | `banlist.dat`         | Stores the IPs/subnets of banned nodes\n `./`               | `bitcoin.conf`        | User-defined [configuration settings](bitcoin-conf.md) for `bitcoind` or `bitcoin-qt`. File is not written to by the software and must be created manually. Path can be specified by `-conf` option\n `./`               | `bitcoind.pid`        | Stores the process ID (PID) of `bitcoind` or `bitcoin-qt` while running; created at start and deleted on shutdown; can be specified by `-pid` option"
      }
    ]
  }
]