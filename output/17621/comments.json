[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/559152851",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17621#issuecomment-559152851",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17621",
    "id": 559152851,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1OTE1Mjg1MQ==",
    "user": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-27T16:11:26Z",
    "updated_at": "2019-11-27T16:11:26Z",
    "author_association": "MEMBER",
    "body": "cc @kallewoof since you designed the first iteration",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/559152851/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/562752173",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17621#issuecomment-562752173",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17621",
    "id": 562752173,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2Mjc1MjE3Mw==",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?u=9791e96cd4268d48e3517bac41eaf2b1d09759fd&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-06T21:58:48Z",
    "updated_at": "2019-12-06T21:59:15Z",
    "author_association": "MEMBER",
    "body": "Concept ACK\r\n\r\nTests please  :)",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/562752173/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/562776453",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17621#issuecomment-562776453",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17621",
    "id": 562776453,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2Mjc3NjQ1Mw==",
    "user": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?u=8aa4d0fd79dff5cf64a98205c78bc1c96b0bf4b6&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-06T23:13:40Z",
    "updated_at": "2019-12-06T23:13:40Z",
    "author_association": "MEMBER",
    "body": "Concept ACK",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/562776453/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/563296236",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17621#issuecomment-563296236",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17621",
    "id": 563296236,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2MzI5NjIzNg==",
    "user": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-09T15:38:04Z",
    "updated_at": "2019-12-09T15:38:04Z",
    "author_association": "MEMBER",
    "body": "Pushed test, updated logic to fix test failure.\r\n\r\nRemoved a function that resulted in a used footgun.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/563296236/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/568745824",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17621#issuecomment-568745824",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17621",
    "id": 568745824,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2ODc0NTgyNA==",
    "user": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?u=348c27f90b6fff8fd72fa27232272651436a2ff0&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjahr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-24T13:11:18Z",
    "updated_at": "2019-12-24T13:11:18Z",
    "author_association": "CONTRIBUTOR",
    "body": "ACK 9f7eea56f2b0fbc128b83fccab344190b1e6ce54\r\n\r\nReviewed code and tested locally.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/568745824/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/569477484",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17621#issuecomment-569477484",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17621",
    "id": 569477484,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2OTQ3NzQ4NA==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-29T05:52:01Z",
    "updated_at": "2020-01-07T19:14:50Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#17889](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/17889.html) (wallet: Improve CWallet:MarkDestinationsDirty by promag)\n* [#17843](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/17843.html) (wallet: Reset reused transactions cache by fjahr)\n* [#17838](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/17838.html) (test: test the >10 UTXO case for output groups by kallewoof)\n* [#17824](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/17824.html) (wallet: Improve coin selection for destination groups >10 by fjahr)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/569477484/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/574088397",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17621#issuecomment-574088397",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17621",
    "id": 574088397,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3NDA4ODM5Nw==",
    "user": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?u=a0e0040aacd7d4f0787481e8ac30b494fa429e11&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-14T09:40:38Z",
    "updated_at": "2020-01-14T09:40:38Z",
    "author_association": "MEMBER",
    "body": "Being backported in 17792.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/574088397/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/358539866",
    "pull_request_review_id": 332959521,
    "id": 358539866,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1ODUzOTg2Ng==",
    "diff_hunk": "@@ -719,17 +719,31 @@ void CWallet::SetUsedDestinationState(WalletBatch& batch, const uint256& hash, u\n     }\n }\n \n-bool CWallet::IsUsedDestination(const CTxDestination& dst) const\n-{\n-    LOCK(cs_wallet);\n-    return IsMine(dst) && GetDestData(dst, \"used\", nullptr);\n-}\n-\n bool CWallet::IsUsedDestination(const uint256& hash, unsigned int n) const\n {\n+    AssertLockHeld(cs_wallet);",
    "path": "src/wallet/wallet.cpp",
    "position": 12,
    "original_position": 12,
    "commit_id": "09502452bbbe21bb974f1de8cf53196373921ab9",
    "original_commit_id": "ef4a1a4941be5a4a018aedc5f4dc41cea3cb816e",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit, also add the EXCLUSIVE_LOCKS_REQUIRED annotation.",
    "created_at": "2019-12-17T00:42:35Z",
    "updated_at": "2020-01-03T22:21:02Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17621#discussion_r358539866",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17621",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/358539866"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17621#discussion_r358539866"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17621"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/358539866/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 724,
    "original_line": 724,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/358540779",
    "pull_request_review_id": 332960641,
    "id": 358540779,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1ODU0MDc3OQ==",
    "diff_hunk": "@@ -719,17 +719,31 @@ void CWallet::SetUsedDestinationState(WalletBatch& batch, const uint256& hash, u\n     }\n }\n \n-bool CWallet::IsUsedDestination(const CTxDestination& dst) const\n-{\n-    LOCK(cs_wallet);\n-    return IsMine(dst) && GetDestData(dst, \"used\", nullptr);\n-}\n-\n bool CWallet::IsUsedDestination(const uint256& hash, unsigned int n) const\n {\n+    AssertLockHeld(cs_wallet);\n     CTxDestination dst;\n     const CWalletTx* srctx = GetWalletTx(hash);\n-    return srctx && ExtractDestination(srctx->tx->vout[n].scriptPubKey, dst) && IsUsedDestination(dst);\n+    if (srctx) {\n+        assert(srctx->tx->vout.size() >= n);",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 17,
    "commit_id": "09502452bbbe21bb974f1de8cf53196373921ab9",
    "original_commit_id": "ef4a1a4941be5a4a018aedc5f4dc41cea3cb816e",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Should be `>`?",
    "created_at": "2019-12-17T00:46:26Z",
    "updated_at": "2020-01-03T22:21:02Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17621#discussion_r358540779",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17621",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/358540779"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17621#discussion_r358540779"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17621"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/358540779/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 728,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/358541499",
    "pull_request_review_id": 332961450,
    "id": 358541499,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1ODU0MTQ5OQ==",
    "diff_hunk": "@@ -719,17 +719,31 @@ void CWallet::SetUsedDestinationState(WalletBatch& batch, const uint256& hash, u\n     }\n }\n \n-bool CWallet::IsUsedDestination(const CTxDestination& dst) const\n-{\n-    LOCK(cs_wallet);\n-    return IsMine(dst) && GetDestData(dst, \"used\", nullptr);\n-}\n-\n bool CWallet::IsUsedDestination(const uint256& hash, unsigned int n) const\n {\n+    AssertLockHeld(cs_wallet);\n     CTxDestination dst;\n     const CWalletTx* srctx = GetWalletTx(hash);\n-    return srctx && ExtractDestination(srctx->tx->vout[n].scriptPubKey, dst) && IsUsedDestination(dst);\n+    if (srctx) {\n+        assert(srctx->tx->vout.size() >= n);\n+        LegacyScriptPubKeyMan* spk_man = GetLegacyScriptPubKeyMan();\n+        assert(spk_man != nullptr);\n+        for (const auto& keyid : GetAffectedKeys(srctx->tx->vout[n].scriptPubKey, *spk_man)) {\n+            WitnessV0KeyHash wpkh_dest(keyid);\n+            if (IsMine(wpkh_dest) && GetDestData(wpkh_dest, \"used\", nullptr)) {",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 22,
    "commit_id": "09502452bbbe21bb974f1de8cf53196373921ab9",
    "original_commit_id": "ef4a1a4941be5a4a018aedc5f4dc41cea3cb816e",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Haven't profiled but looks like `GetDestData && IsMine` should be faster? ",
    "created_at": "2019-12-17T00:49:17Z",
    "updated_at": "2020-01-03T22:21:02Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17621#discussion_r358541499",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17621",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/358541499"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17621#discussion_r358541499"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17621"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/358541499/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 733,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/358804704",
    "pull_request_review_id": 333291810,
    "id": 358804704,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1ODgwNDcwNA==",
    "diff_hunk": "@@ -719,17 +719,31 @@ void CWallet::SetUsedDestinationState(WalletBatch& batch, const uint256& hash, u\n     }\n }\n \n-bool CWallet::IsUsedDestination(const CTxDestination& dst) const\n-{\n-    LOCK(cs_wallet);\n-    return IsMine(dst) && GetDestData(dst, \"used\", nullptr);\n-}\n-\n bool CWallet::IsUsedDestination(const uint256& hash, unsigned int n) const\n {\n+    AssertLockHeld(cs_wallet);\n     CTxDestination dst;\n     const CWalletTx* srctx = GetWalletTx(hash);\n-    return srctx && ExtractDestination(srctx->tx->vout[n].scriptPubKey, dst) && IsUsedDestination(dst);\n+    if (srctx) {\n+        assert(srctx->tx->vout.size() >= n);",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 17,
    "commit_id": "09502452bbbe21bb974f1de8cf53196373921ab9",
    "original_commit_id": "ef4a1a4941be5a4a018aedc5f4dc41cea3cb816e",
    "user": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "d'oh, I always have to sit there and reason with myself on this :)",
    "created_at": "2019-12-17T13:59:23Z",
    "updated_at": "2020-01-03T22:21:02Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17621#discussion_r358804704",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17621",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/358804704"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17621#discussion_r358804704"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17621"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/358804704/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 728,
    "side": "RIGHT",
    "in_reply_to_id": 358540779
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/358816438",
    "pull_request_review_id": 333307166,
    "id": 358816438,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1ODgxNjQzOA==",
    "diff_hunk": "@@ -719,17 +719,31 @@ void CWallet::SetUsedDestinationState(WalletBatch& batch, const uint256& hash, u\n     }\n }\n \n-bool CWallet::IsUsedDestination(const CTxDestination& dst) const\n-{\n-    LOCK(cs_wallet);\n-    return IsMine(dst) && GetDestData(dst, \"used\", nullptr);\n-}\n-\n bool CWallet::IsUsedDestination(const uint256& hash, unsigned int n) const\n {\n+    AssertLockHeld(cs_wallet);\n     CTxDestination dst;\n     const CWalletTx* srctx = GetWalletTx(hash);\n-    return srctx && ExtractDestination(srctx->tx->vout[n].scriptPubKey, dst) && IsUsedDestination(dst);\n+    if (srctx) {\n+        assert(srctx->tx->vout.size() >= n);\n+        LegacyScriptPubKeyMan* spk_man = GetLegacyScriptPubKeyMan();\n+        assert(spk_man != nullptr);\n+        for (const auto& keyid : GetAffectedKeys(srctx->tx->vout[n].scriptPubKey, *spk_man)) {\n+            WitnessV0KeyHash wpkh_dest(keyid);\n+            if (IsMine(wpkh_dest) && GetDestData(wpkh_dest, \"used\", nullptr)) {",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 22,
    "commit_id": "09502452bbbe21bb974f1de8cf53196373921ab9",
    "original_commit_id": "ef4a1a4941be5a4a018aedc5f4dc41cea3cb816e",
    "user": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I just got rid of the `IsMine` check. If a record for `used` exists in the wallet we should trust it.",
    "created_at": "2019-12-17T14:20:37Z",
    "updated_at": "2020-01-03T22:21:02Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17621#discussion_r358816438",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17621",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/358816438"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17621#discussion_r358816438"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17621"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/358816438/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 733,
    "side": "RIGHT",
    "in_reply_to_id": 358541499
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/358816869",
    "pull_request_review_id": 333307771,
    "id": 358816869,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1ODgxNjg2OQ==",
    "diff_hunk": "@@ -719,17 +719,31 @@ void CWallet::SetUsedDestinationState(WalletBatch& batch, const uint256& hash, u\n     }\n }\n \n-bool CWallet::IsUsedDestination(const CTxDestination& dst) const\n-{\n-    LOCK(cs_wallet);\n-    return IsMine(dst) && GetDestData(dst, \"used\", nullptr);\n-}\n-\n bool CWallet::IsUsedDestination(const uint256& hash, unsigned int n) const\n {\n+    AssertLockHeld(cs_wallet);",
    "path": "src/wallet/wallet.cpp",
    "position": 12,
    "original_position": 12,
    "commit_id": "09502452bbbe21bb974f1de8cf53196373921ab9",
    "original_commit_id": "ef4a1a4941be5a4a018aedc5f4dc41cea3cb816e",
    "user": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "done",
    "created_at": "2019-12-17T14:21:24Z",
    "updated_at": "2020-01-03T22:21:02Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17621#discussion_r358816869",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17621",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/358816869"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17621#discussion_r358816869"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17621"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/358816869/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 724,
    "original_line": 724,
    "side": "RIGHT",
    "in_reply_to_id": 358539866
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/362976593",
    "pull_request_review_id": 338294926,
    "id": 362976593,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk3NjU5Mw==",
    "diff_hunk": "@@ -719,17 +719,31 @@ void CWallet::SetUsedDestinationState(WalletBatch& batch, const uint256& hash, u\n     }\n }\n \n-bool CWallet::IsUsedDestination(const CTxDestination& dst) const\n-{\n-    LOCK(cs_wallet);\n-    return IsMine(dst) && GetDestData(dst, \"used\", nullptr);\n-}\n-\n bool CWallet::IsUsedDestination(const uint256& hash, unsigned int n) const\n {\n+    AssertLockHeld(cs_wallet);",
    "path": "src/wallet/wallet.cpp",
    "position": 12,
    "original_position": 12,
    "commit_id": "09502452bbbe21bb974f1de8cf53196373921ab9",
    "original_commit_id": "ef4a1a4941be5a4a018aedc5f4dc41cea3cb816e",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "The annotation is supposed to go in the header file.",
    "created_at": "2020-01-03T22:05:01Z",
    "updated_at": "2020-01-03T22:21:02Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17621#discussion_r362976593",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17621",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/362976593"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17621#discussion_r362976593"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17621"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/362976593/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 724,
    "original_line": 724,
    "side": "RIGHT",
    "in_reply_to_id": 358539866
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/362978185",
    "pull_request_review_id": 338296879,
    "id": 362978185,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk3ODE4NQ==",
    "diff_hunk": "@@ -719,17 +719,31 @@ void CWallet::SetUsedDestinationState(WalletBatch& batch, const uint256& hash, u\n     }\n }\n \n-bool CWallet::IsUsedDestination(const CTxDestination& dst) const\n-{\n-    LOCK(cs_wallet);\n-    return IsMine(dst) && GetDestData(dst, \"used\", nullptr);\n-}\n-\n bool CWallet::IsUsedDestination(const uint256& hash, unsigned int n) const\n {\n+    AssertLockHeld(cs_wallet);",
    "path": "src/wallet/wallet.cpp",
    "position": 12,
    "original_position": 12,
    "commit_id": "09502452bbbe21bb974f1de8cf53196373921ab9",
    "original_commit_id": "ef4a1a4941be5a4a018aedc5f4dc41cea3cb816e",
    "user": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "is it just a no-op here? I am not a clang wizard.",
    "created_at": "2020-01-03T22:11:18Z",
    "updated_at": "2020-01-03T22:21:02Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17621#discussion_r362978185",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17621",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/362978185"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17621#discussion_r362978185"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17621"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/362978185/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 724,
    "original_line": 724,
    "side": "RIGHT",
    "in_reply_to_id": 358539866
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/362979357",
    "pull_request_review_id": 338298287,
    "id": 362979357,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk3OTM1Nw==",
    "diff_hunk": "@@ -193,7 +198,7 @@ def test_fund_send_fund_send(self):\n         '''\n         self.log.info(\"Test fund send fund send\")\n \n-        fundaddr = self.nodes[1].getnewaddress()\n+        fundaddr = self.nodes[1].getnewaddress(label=\"\", address_type=\"legacy\")",
    "path": "test/functional/wallet_avoidreuse.py",
    "position": 28,
    "original_position": 28,
    "commit_id": "09502452bbbe21bb974f1de8cf53196373921ab9",
    "original_commit_id": "9f7eea56f2b0fbc128b83fccab344190b1e6ce54",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: `label` isn't needed",
    "created_at": "2020-01-03T22:16:02Z",
    "updated_at": "2020-01-03T22:23:06Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17621#discussion_r362979357",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17621",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/362979357"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17621#discussion_r362979357"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17621"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/362979357/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 201,
    "original_line": 201,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/362980530",
    "pull_request_review_id": 338299614,
    "id": 362980530,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk4MDUzMA==",
    "diff_hunk": "@@ -719,17 +719,31 @@ void CWallet::SetUsedDestinationState(WalletBatch& batch, const uint256& hash, u\n     }\n }\n \n-bool CWallet::IsUsedDestination(const CTxDestination& dst) const\n-{\n-    LOCK(cs_wallet);\n-    return IsMine(dst) && GetDestData(dst, \"used\", nullptr);\n-}\n-\n bool CWallet::IsUsedDestination(const uint256& hash, unsigned int n) const\n {\n+    AssertLockHeld(cs_wallet);",
    "path": "src/wallet/wallet.cpp",
    "position": 12,
    "original_position": 12,
    "commit_id": "09502452bbbe21bb974f1de8cf53196373921ab9",
    "original_commit_id": "ef4a1a4941be5a4a018aedc5f4dc41cea3cb816e",
    "user": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "`Attributes must be attached to named declarations` oooohkay fixed",
    "created_at": "2020-01-03T22:20:56Z",
    "updated_at": "2020-01-03T22:21:02Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17621#discussion_r362980530",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17621",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/362980530"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17621#discussion_r362980530"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17621"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/362980530/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 724,
    "original_line": 724,
    "side": "RIGHT",
    "in_reply_to_id": 358539866
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/362980998",
    "pull_request_review_id": 338298287,
    "id": 362980998,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk4MDk5OA==",
    "diff_hunk": "@@ -719,17 +719,31 @@ void CWallet::SetUsedDestinationState(WalletBatch& batch, const uint256& hash, u\n     }\n }\n \n-bool CWallet::IsUsedDestination(const CTxDestination& dst) const\n-{\n-    LOCK(cs_wallet);\n-    return IsMine(dst) && GetDestData(dst, \"used\", nullptr);\n-}\n-\n bool CWallet::IsUsedDestination(const uint256& hash, unsigned int n) const\n {\n+    AssertLockHeld(cs_wallet);",
    "path": "src/wallet/wallet.cpp",
    "position": 12,
    "original_position": 12,
    "commit_id": "09502452bbbe21bb974f1de8cf53196373921ab9",
    "original_commit_id": "ef4a1a4941be5a4a018aedc5f4dc41cea3cb816e",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "From [clang docs](https://clang.llvm.org/docs/ThreadSafetyAnalysis.html#frequently-asked-questions):\r\n\r\n> Attributes are part of the formal interface of a function, and should always go in the header, where they are visible to anything that includes the header. Attributes in the .cpp file are not visible outside of the immediate translation unit, which leads to false negatives and false positives.",
    "created_at": "2020-01-03T22:22:50Z",
    "updated_at": "2020-01-03T22:23:06Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17621#discussion_r362980998",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17621",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/362980998"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17621#discussion_r362980998"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17621"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/362980998/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 724,
    "original_line": 724,
    "side": "RIGHT",
    "in_reply_to_id": 358539866
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/363006765",
    "pull_request_review_id": 338329349,
    "id": 363006765,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzAwNjc2NQ==",
    "diff_hunk": "@@ -193,7 +198,7 @@ def test_fund_send_fund_send(self):\n         '''\n         self.log.info(\"Test fund send fund send\")\n \n-        fundaddr = self.nodes[1].getnewaddress()\n+        fundaddr = self.nodes[1].getnewaddress(label=\"\", address_type=\"legacy\")",
    "path": "test/functional/wallet_avoidreuse.py",
    "position": 28,
    "original_position": 28,
    "commit_id": "09502452bbbe21bb974f1de8cf53196373921ab9",
    "original_commit_id": "9f7eea56f2b0fbc128b83fccab344190b1e6ce54",
    "user": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "It would be, once address type default is changed, no?",
    "created_at": "2020-01-04T01:20:15Z",
    "updated_at": "2020-01-04T01:20:15Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17621#discussion_r363006765",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17621",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/363006765"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17621#discussion_r363006765"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17621"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/363006765/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 201,
    "original_line": 201,
    "side": "RIGHT",
    "in_reply_to_id": 362979357
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/363124918",
    "pull_request_review_id": 338428516,
    "id": 363124918,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEyNDkxOA==",
    "diff_hunk": "@@ -2927,7 +2927,7 @@ static UniValue listunspent(const JSONRPCRequest& request)\n         CTxDestination address;\n         const CScript& scriptPubKey = out.tx->tx->vout[out.i].scriptPubKey;\n         bool fValidAddress = ExtractDestination(scriptPubKey, address);\n-        bool reused = avoid_reuse && pwallet->IsUsedDestination(address);\n+        bool reused = avoid_reuse && pwallet->IsUsedDestination(out.tx->GetHash(), out.i);",
    "path": "src/wallet/rpcwallet.cpp",
    "position": 5,
    "original_position": 5,
    "commit_id": "09502452bbbe21bb974f1de8cf53196373921ab9",
    "original_commit_id": "09502452bbbe21bb974f1de8cf53196373921ab9",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit, you could move this line after L2932 - no point in calling `IsUsedDestination` if this address doesn't matter.",
    "created_at": "2020-01-05T23:26:00Z",
    "updated_at": "2020-01-05T23:45:46Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17621#discussion_r363124918",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17621",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/363124918"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17621#discussion_r363124918"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17621"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/363124918/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2930,
    "original_line": 2930,
    "side": "RIGHT"
  }
]