[
  {
    "sha": "56a42f10f452f0ac0e3e333646a8effcbebf6b30",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1NmE0MmYxMGY0NTJmMGFjMGUzZTMzMzY0NmE4ZWZmY2JlYmY2YjMw",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2021-08-30T16:02:04Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2021-08-30T16:02:04Z"
      },
      "message": "Stricter BIP32 decoding and test vector 5",
      "tree": {
        "sha": "bf3c870669316ba912102115585f0c22c004a932",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/bf3c870669316ba912102115585f0c22c004a932"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/56a42f10f452f0ac0e3e333646a8effcbebf6b30",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/56a42f10f452f0ac0e3e333646a8effcbebf6b30",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/56a42f10f452f0ac0e3e333646a8effcbebf6b30",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/56a42f10f452f0ac0e3e333646a8effcbebf6b30/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "7be143a960e2bb9ac81144f55c45731c1bb209c5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7be143a960e2bb9ac81144f55c45731c1bb209c5",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/7be143a960e2bb9ac81144f55c45731c1bb209c5"
      }
    ],
    "stats": {
      "total": 36,
      "additions": 35,
      "deletions": 1
    },
    "files": [
      {
        "sha": "40df248e0217274f384b1363080d097b26af6b15",
        "filename": "src/key.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/56a42f10f452f0ac0e3e333646a8effcbebf6b30/src/key.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/56a42f10f452f0ac0e3e333646a8effcbebf6b30/src/key.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/key.cpp?ref=56a42f10f452f0ac0e3e333646a8effcbebf6b30",
        "patch": "@@ -357,6 +357,7 @@ void CExtKey::Decode(const unsigned char code[BIP32_EXTKEY_SIZE]) {\n     nChild = (code[5] << 24) | (code[6] << 16) | (code[7] << 8) | code[8];\n     memcpy(chaincode.begin(), code+9, 32);\n     key.Set(code+42, code+BIP32_EXTKEY_SIZE, true);\n+    if ((nDepth == 0 && (nChild != 0 || ReadLE32(vchFingerprint) != 0)) || code[41] != 0) key = CKey();\n }\n \n bool ECC_InitSanityCheck() {"
      },
      {
        "sha": "a393153ff8c357fb3b6af5c65f038f517e0bf6c9",
        "filename": "src/pubkey.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/56a42f10f452f0ac0e3e333646a8effcbebf6b30/src/pubkey.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/56a42f10f452f0ac0e3e333646a8effcbebf6b30/src/pubkey.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/pubkey.cpp?ref=56a42f10f452f0ac0e3e333646a8effcbebf6b30",
        "patch": "@@ -333,6 +333,7 @@ void CExtPubKey::Decode(const unsigned char code[BIP32_EXTKEY_SIZE]) {\n     nChild = (code[5] << 24) | (code[6] << 16) | (code[7] << 8) | code[8];\n     memcpy(chaincode.begin(), code+9, 32);\n     pubkey.Set(code+41, code+BIP32_EXTKEY_SIZE);\n+    if ((nDepth == 0 && (nChild != 0 || ReadLE32(vchFingerprint) != 0)) || !pubkey.IsFullyValid()) pubkey = CPubKey();\n }\n \n bool CExtPubKey::Derive(CExtPubKey &out, unsigned int _nChild) const {"
      },
      {
        "sha": "a89868e1ef5f69522f193114f8d5c99853cc8c69",
        "filename": "src/test/bip32_tests.cpp",
        "status": "modified",
        "additions": 33,
        "deletions": 1,
        "changes": 34,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/56a42f10f452f0ac0e3e333646a8effcbebf6b30/src/test/bip32_tests.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/56a42f10f452f0ac0e3e333646a8effcbebf6b30/src/test/bip32_tests.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/bip32_tests.cpp?ref=56a42f10f452f0ac0e3e333646a8effcbebf6b30",
        "patch": "@@ -14,6 +14,8 @@\n #include <string>\n #include <vector>\n \n+namespace {\n+\n struct TestDerivation {\n     std::string pub;\n     std::string prv;\n@@ -99,7 +101,26 @@ TestVector test4 =\n      \"xprv9xJocDuwtYCMNAo3Zw76WENQeAS6WGXQ55RCy7tDJ8oALr4FWkuVoHJeHVAcAqiZLE7Je3vZJHxspZdFHfnBEjHqU5hG1Jaj32dVoS6XLT1\",\n      0);\n \n-static void RunTest(const TestVector &test) {\n+const std::vector<std::string> TEST5 = {\n+    \"xpub661MyMwAqRbcEYS8w7XLSVeEsBXy79zSzH1J8vCdxAZningWLdN3zgtU6LBpB85b3D2yc8sfvZU521AAwdZafEz7mnzBBsz4wKY5fTtTQBm\",\n+    \"xprv9s21ZrQH143K24Mfq5zL5MhWK9hUhhGbd45hLXo2Pq2oqzMMo63oStZzFGTQQD3dC4H2D5GBj7vWvSQaaBv5cxi9gafk7NF3pnBju6dwKvH\",\n+    \"xpub661MyMwAqRbcEYS8w7XLSVeEsBXy79zSzH1J8vCdxAZningWLdN3zgtU6Txnt3siSujt9RCVYsx4qHZGc62TG4McvMGcAUjeuwZdduYEvFn\",\n+    \"xprv9s21ZrQH143K24Mfq5zL5MhWK9hUhhGbd45hLXo2Pq2oqzMMo63oStZzFGpWnsj83BHtEy5Zt8CcDr1UiRXuWCmTQLxEK9vbz5gPstX92JQ\",\n+    \"xpub661MyMwAqRbcEYS8w7XLSVeEsBXy79zSzH1J8vCdxAZningWLdN3zgtU6N8ZMMXctdiCjxTNq964yKkwrkBJJwpzZS4HS2fxvyYUA4q2Xe4\",\n+    \"xprv9s21ZrQH143K24Mfq5zL5MhWK9hUhhGbd45hLXo2Pq2oqzMMo63oStZzFAzHGBP2UuGCqWLTAPLcMtD9y5gkZ6Eq3Rjuahrv17fEQ3Qen6J\",\n+    \"xprv9s2SPatNQ9Vc6GTbVMFPFo7jsaZySyzk7L8n2uqKXJen3KUmvQNTuLh3fhZMBoG3G4ZW1N2kZuHEPY53qmbZzCHshoQnNf4GvELZfqTUrcv\",\n+    \"xpub661no6RGEX3uJkY4bNnPcw4URcQTrSibUZ4NqJEw5eBkv7ovTwgiT91XX27VbEXGENhYRCf7hyEbWrR3FewATdCEebj6znwMfQkhRYHRLpJ\",\n+    \"xprv9s21ZrQH4r4TsiLvyLXqM9P7k1K3EYhA1kkD6xuquB5i39AU8KF42acDyL3qsDbU9NmZn6MsGSUYZEsuoePmjzsB3eFKSUEh3Gu1N3cqVUN\",\n+    \"xpub661MyMwAuDcm6CRQ5N4qiHKrJ39Xe1R1NyfouMKTTWcguwVcfrZJaNvhpebzGerh7gucBvzEQWRugZDuDXjNDRmXzSZe4c7mnTK97pTvGS8\",\n+    \"DMwo58pR1QLEFihHiXPVykYB6fJmsTeHvyTp7hRThAtCX8CvYzgPcn8XnmdfHGMQzT7ayAmfo4z3gY5KfbrZWZ6St24UVf2Qgo6oujFktLHdHY4\",\n+    \"DMwo58pR1QLEFihHiXPVykYB6fJmsTeHvyTp7hRThAtCX8CvYzgPcn8XnmdfHPmHJiEDXkTiJTVV9rHEBUem2mwVbbNfvT2MTcAqj3nesx8uBf9\",\n+    \"xprv9s21ZrQH143K24Mfq5zL5MhWK9hUhhGbd45hLXo2Pq2oqzMMo63oStZzF93Y5wvzdUayhgkkFoicQZcP3y52uPPxFnfoLZB21Teqt1VvEHx\",\n+    \"xprv9s21ZrQH143K24Mfq5zL5MhWK9hUhhGbd45hLXo2Pq2oqzMMo63oStZzFAzHGBP2UuGCqWLTAPLcMtD5SDKr24z3aiUvKr9bJpdrcLg1y3G\",\n+    \"xpub661MyMwAqRbcEYS8w7XLSVeEsBXy79zSzH1J8vCdxAZningWLdN3zgtU6Q5JXayek4PRsn35jii4veMimro1xefsM58PgBMrvdYre8QyULY\",\n+    \"xprv9s21ZrQH143K3QTDL4LXw2F7HEK3wJUD2nW2nRk4stbPy6cq3jPPqjiChkVvvNKmPGJxWUtg6LnF5kejMRNNU3TGtRBeJgk33yuGBxrMPHL\"\n+};\n+\n+void RunTest(const TestVector &test) {\n     std::vector<unsigned char> seed = ParseHex(test.strHexMaster);\n     CExtKey key;\n     CExtPubKey pubkey;\n@@ -133,6 +154,8 @@ static void RunTest(const TestVector &test) {\n     }\n }\n \n+}  // namespace\n+\n BOOST_FIXTURE_TEST_SUITE(bip32_tests, BasicTestingSetup)\n \n BOOST_AUTO_TEST_CASE(bip32_test1) {\n@@ -151,4 +174,13 @@ BOOST_AUTO_TEST_CASE(bip32_test4) {\n     RunTest(test4);\n }\n \n+BOOST_AUTO_TEST_CASE(bip32_test5) {\n+    for (const auto& str : TEST5) {\n+        auto dec_extkey = DecodeExtKey(str);\n+        auto dec_extpubkey = DecodeExtPubKey(str);\n+        BOOST_CHECK_MESSAGE(!dec_extkey.key.IsValid(), \"Decoding '\" + str + \"' as xprv should fail\");\n+        BOOST_CHECK_MESSAGE(!dec_extpubkey.pubkey.IsValid(), \"Decoding '\" + str + \"' as xpub should fail\");\n+    }\n+}\n+\n BOOST_AUTO_TEST_SUITE_END()"
      }
    ]
  }
]