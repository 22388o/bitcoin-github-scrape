practicalswift,2020-09-20 15:36:25,"Concept ACK\n\nGreat to see `deadlock:UpdateTip` go :)",https://github.com/bitcoin/bitcoin/pull/19983#issuecomment-695800751,695800751,
hebasto,2020-09-20 16:15:43,"@practicalswift \n> Great to see `deadlock:UpdateTip` go :)\n\nI must confess that, unlike #19982, I'm not as mush confident in this PR removals as all of them are found empirically.\n",https://github.com/bitcoin/bitcoin/pull/19983#issuecomment-695805312,695805312,
hebasto,2020-09-20 17:28:23,"Some more CI TSan builds:\n- https://cirrus-ci.com/task/4866563041918976\n- https://cirrus-ci.com/task/5574751877857280",https://github.com/bitcoin/bitcoin/pull/19983#issuecomment-695813378,695813378,
DrahtBot,2020-09-20 18:45:11,<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.,https://github.com/bitcoin/bitcoin/pull/19983#issuecomment-695821336,695821336,
hebasto,2020-11-14 18:36:15,Rebased 49c3a5287d74d3739724d9f7f6c7cff3ec398330 -> 730e5ffc2e9f86fded9283543c0e8dc0759d6c6f ([pr19983.02](https://github.com/hebasto/bitcoin/commits/pr19983.02) -> [pr19983.03](https://github.com/hebasto/bitcoin/commits/pr19983.03)) due to the conflict with #20285.,https://github.com/bitcoin/bitcoin/pull/19983#issuecomment-727248116,727248116,
hebasto,2020-11-28 20:10:34,Rebased 71518e39d8da6b55e0ad04acc0b6781290573425 -> 27752af19a701702e94fbf721a4ba2d2c0a7d0ea ([pr19983.04](https://github.com/hebasto/bitcoin/commits/pr19983.04) -> [pr19983.06](https://github.com/hebasto/bitcoin/commits/pr19983.06)) due to the conflict with #19337.,https://github.com/bitcoin/bitcoin/pull/19983#issuecomment-735284803,735284803,
hebasto,2020-12-10 18:51:27,Rebased 3c2e969172cbb2796441eb218e5102a19a1bfd5d -> 89952ae75cc1f0c2e7ec225bbef074f411e3e327 ([pr19983.07](https://github.com/hebasto/bitcoin/commits/pr19983.07) -> [pr19983.08](https://github.com/hebasto/bitcoin/commits/pr19983.08)) due to the conflict with #19425.,https://github.com/bitcoin/bitcoin/pull/19983#issuecomment-742722192,742722192,
hebasto,2020-12-11 07:39:08,Rebased 89952ae75cc1f0c2e7ec225bbef074f411e3e327 -> b0b6092874f717f3156c043e803600938c7ff571 ([pr19983.08](https://github.com/hebasto/bitcoin/commits/pr19983.08) -> [pr19983.09](https://github.com/hebasto/bitcoin/commits/pr19983.09)) due to the conflict with #19982.,https://github.com/bitcoin/bitcoin/pull/19983#issuecomment-743029860,743029860,
practicalswift,2020-12-11 14:56:07,cr ACK b0b6092874f717f3156c043e803600938c7ff571: patch looks correct and doesn't touch any non-test code,https://github.com/bitcoin/bitcoin/pull/19983#issuecomment-743239416,743239416,
hebasto,2020-12-22 08:32:47,Rebased b0b6092874f717f3156c043e803600938c7ff571 -> a17f69f57e42e08ca95469a9997ec1f49fe2bcf9 ([pr19983.09](https://github.com/hebasto/bitcoin/commits/pr19983.09) -> [pr19983.10](https://github.com/hebasto/bitcoin/commits/pr19983.10)) due to the conflict with #20683.,https://github.com/bitcoin/bitcoin/pull/19983#issuecomment-749417989,749417989,
hebasto,2020-12-22 10:45:05,"Updated a17f69f57e42e08ca95469a9997ec1f49fe2bcf9 -> 354d2cba44747ca34b6833e0f58901394a03ae49 ([pr19983.10](https://github.com/hebasto/bitcoin/commits/pr19983.10) -> [pr19983.11](https://github.com/hebasto/bitcoin/commits/pr19983.11), [diff](https://github.com/hebasto/bitcoin/compare/pr19983.10..pr19983.11)):\n\n- addressed @MarcoFalke's [comment](https://github.com/bitcoin/bitcoin/pull/19983#dis",https://github.com/bitcoin/bitcoin/pull/19983#issuecomment-749477119,749477119,
practicalswift,2020-12-22 10:52:11,cr ACK 354d2cba44747ca34b6833e0f58901394a03ae49: patch looks correct and doesn't touch any non-test code,https://github.com/bitcoin/bitcoin/pull/19983#issuecomment-749479762,749479762,
hebasto,2020-12-22 18:28:37,"Updated 354d2cba44747ca34b6833e0f58901394a03ae49 -> 3e1571285f4a0edf59d51bbdeee028be3038b6dc ([pr19983.11](https://github.com/hebasto/bitcoin/commits/pr19983.11) -> [pr19983.12](https://github.com/hebasto/bitcoin/commits/pr19983.12)):\n\n- addressed @MarcoFalke's [comment](https://github.com/bitcoin/bitcoin/pull/19983#discussion_r547291853)\n- rebased on top of the #20745",https://github.com/bitcoin/bitcoin/pull/19983#issuecomment-749707004,749707004,
MarcoFalke,2020-12-22 20:55:04,">  If this patch appears wrong in the next year, it could be reverted :)\n\nOk, fair enough. Let's give it a try.",https://github.com/bitcoin/bitcoin/pull/19983#issuecomment-749771511,749771511,
MarcoFalke,2020-12-22 09:58:15,"```suggestion\n    def stop_node(self, expected_stderr='', *, ignored_stderr='', wait=0, wait_until_stopped=True):\n```",https://github.com/bitcoin/bitcoin/pull/19983#discussion_r547181351,547181351,test/functional/test_framework/test_node.py
hebasto,2020-12-22 10:45:23,Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/19983#issuecomment-749477119).,https://github.com/bitcoin/bitcoin/pull/19983#discussion_r547204851,547204851,test/functional/test_framework/test_node.py
MarcoFalke,2020-12-22 13:57:36,"I can't reproduce this locally. How often did you have to run this test?\n\nI am running with:\n\n```diff\ndiff --git a/test/sanitizer_suppressions/tsan b/test/sanitizer_suppressions/tsan\nindex 986e09605..020f3da9b 100644\n--- a/test/sanitizer_suppressions/tsan\n+++ b/test/sanitizer_suppressions/tsan\n@@ -29,12 +29,7 @@ race:zmq::*\n race:bitcoin-qt\n # deadlock (TODO fix)\n deadlock:",https://github.com/bitcoin/bitcoin/pull/19983#discussion_r547291853,547291853,test/functional/feature_maxuploadtarget.py
hebasto,2020-12-22 14:06:04,"> I can't reproduce this locally.\n\nWhat is `-stdlib` compiled against?",https://github.com/bitcoin/bitcoin/pull/19983#discussion_r547296232,547296232,test/functional/feature_maxuploadtarget.py
MarcoFalke,2020-12-22 14:15:50,I used `./ci/test/00_setup_env_native_tsan.sh` to compile,https://github.com/bitcoin/bitcoin/pull/19983#discussion_r547301145,547301145,test/functional/feature_maxuploadtarget.py
hebasto,2020-12-22 15:19:05,"Indeed. On master (df127ecede804ecb0a70bf45cbca73af3c3e7761) with [your](https://github.com/bitcoin/bitcoin/pull/19983#discussion_r547291853) patch I have no ""WARNING: too long mutex cycle found"" from the thread sanitizer when running `test/functional/feature_maxuploadtarget.py `. Maybe the reason is the updated clang?\n\nInstead, the skipping `-DDEBUG_LOCKORDER` from `CPPFLAGS` causes another w",https://github.com/bitcoin/bitcoin/pull/19983#discussion_r547336086,547336086,test/functional/feature_maxuploadtarget.py
hebasto,2020-12-22 15:19:38,Going to update this PR after more tests.,https://github.com/bitcoin/bitcoin/pull/19983#discussion_r547336397,547336397,test/functional/feature_maxuploadtarget.py
hebasto,2020-12-22 18:30:35,[Updated](https://github.com/bitcoin/bitcoin/pull/19983#issuecomment-749707004l).,https://github.com/bitcoin/bitcoin/pull/19983#discussion_r547437747,547437747,test/functional/feature_maxuploadtarget.py
MarcoFalke,2020-12-22 18:45:36,"What are the steps to verify this patch? Note that the deadlocks are intermittent, so there is no way to run the tests and reproduce them or not reproduce them reliably.",https://github.com/bitcoin/bitcoin/pull/19983#discussion_r547444276,547444276,test/sanitizer_suppressions/tsan
hebasto,2020-12-22 18:48:51,"TSan searches for _potential_ deadlocks, i.e., it verifies consistency of lock ordering in the code, right?",https://github.com/bitcoin/bitcoin/pull/19983#discussion_r547445824,547445824,test/sanitizer_suppressions/tsan
hebasto,2020-12-22 18:50:36,https://github.com/google/sanitizers/wiki/ThreadSanitizerDeadlockDetector,https://github.com/bitcoin/bitcoin/pull/19983#discussion_r547446663,547446663,test/sanitizer_suppressions/tsan
MarcoFalke,2020-12-22 19:02:09,"The lock order graph is generated at runtime and is not deterministic. It depends on the code paths that are executed, and our tests exercise different code paths in each run.",https://github.com/bitcoin/bitcoin/pull/19983#discussion_r547451815,547451815,test/sanitizer_suppressions/tsan
hebasto,2020-12-22 19:13:30,"> What are the steps to verify this patch?\n\nI don't know (besides tracking code changes since these suppressions were introduced).\n\nHaving a smaller set of suppressions is better, though. If this patch appears wrong in the next year, it could be reverted :)",https://github.com/bitcoin/bitcoin/pull/19983#discussion_r547456841,547456841,test/sanitizer_suppressions/tsan
