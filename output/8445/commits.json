[
  {
    "sha": "e86eb71604e73ad35b8b1f59d73af22e353a156e",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzplODZlYjcxNjA0ZTczYWQzNWI4YjFmNTlkNzNhZjIyZTM1M2ExNTZl",
    "commit": {
      "author": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2016-08-02T00:14:40Z"
      },
      "committer": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2016-08-17T22:24:57Z"
      },
      "message": "Move CWallet::setKeyPool to private section of CWallet",
      "tree": {
        "sha": "1e2c5327c62ef7ab427e46aa2a307f2ce6d77b58",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1e2c5327c62ef7ab427e46aa2a307f2ce6d77b58"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e86eb71604e73ad35b8b1f59d73af22e353a156e",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e86eb71604e73ad35b8b1f59d73af22e353a156e",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/e86eb71604e73ad35b8b1f59d73af22e353a156e",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e86eb71604e73ad35b8b1f59d73af22e353a156e/comments",
    "author": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "ea268747b6d417a406977e9b4931badce29b9d7a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ea268747b6d417a406977e9b4931badce29b9d7a",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/ea268747b6d417a406977e9b4931badce29b9d7a"
      }
    ],
    "stats": {
      "total": 34,
      "additions": 22,
      "deletions": 12
    },
    "files": [
      {
        "sha": "a15fe2e13b94f9c47ff4e70883a0b8be413242be",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 6,
        "deletions": 3,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e86eb71604e73ad35b8b1f59d73af22e353a156e/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e86eb71604e73ad35b8b1f59d73af22e353a156e/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=e86eb71604e73ad35b8b1f59d73af22e353a156e",
        "patch": "@@ -1439,9 +1439,12 @@ bool AppInit2(boost::thread_group& threadGroup, CScheduler& scheduler)\n     LogPrintf(\"mapBlockIndex.size() = %u\\n\",   mapBlockIndex.size());\n     LogPrintf(\"nBestHeight = %d\\n\",                   chainActive.Height());\n #ifdef ENABLE_WALLET\n-    LogPrintf(\"setKeyPool.size() = %u\\n\",      pwalletMain ? pwalletMain->setKeyPool.size() : 0);\n-    LogPrintf(\"mapWallet.size() = %u\\n\",       pwalletMain ? pwalletMain->mapWallet.size() : 0);\n-    LogPrintf(\"mapAddressBook.size() = %u\\n\",  pwalletMain ? pwalletMain->mapAddressBook.size() : 0);\n+    if (pwalletMain) {\n+        LOCK(pwalletMain->cs_wallet);\n+        LogPrintf(\"setKeyPool.size() = %u\\n\",      pwalletMain->GetKeyPoolSize());\n+        LogPrintf(\"mapWallet.size() = %u\\n\",       pwalletMain->mapWallet.size());\n+        LogPrintf(\"mapAddressBook.size() = %u\\n\",  pwalletMain->mapAddressBook.size());\n+    }\n #endif\n \n     if (GetBoolArg(\"-listenonion\", DEFAULT_LISTEN_ONION))"
      },
      {
        "sha": "d2e3e2c6e3ee9e920fb7cfe008ae2a42f90b47f7",
        "filename": "src/wallet/wallet.h",
        "status": "modified",
        "additions": 14,
        "deletions": 1,
        "changes": 15,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e86eb71604e73ad35b8b1f59d73af22e353a156e/src/wallet/wallet.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e86eb71604e73ad35b8b1f59d73af22e353a156e/src/wallet/wallet.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.h?ref=e86eb71604e73ad35b8b1f59d73af22e353a156e",
        "patch": "@@ -582,6 +582,8 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n     CHDChain hdChain;\n \n     bool fFileBacked;\n+\n+    std::set<int64_t> setKeyPool;\n public:\n     /*\n      * Main wallet lock.\n@@ -594,7 +596,18 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n \n     std::string strWalletFile;\n \n-    std::set<int64_t> setKeyPool;\n+    void LoadKeyPool(int nIndex, const CKeyPool &keypool)\n+    {\n+        setKeyPool.insert(nIndex);\n+\n+        // If no metadata exists yet, create a default with the pool key's\n+        // creation time. Note that this may be overwritten by actually\n+        // stored metadata for that key later, which is fine.\n+        CKeyID keyid = keypool.vchPubKey.GetID();\n+        if (mapKeyMetadata.count(keyid) == 0)\n+            mapKeyMetadata[keyid] = CKeyMetadata(keypool.nTime);\n+    }\n+\n     std::map<CKeyID, CKeyMetadata> mapKeyMetadata;\n \n     typedef std::map<unsigned int, CMasterKey> MasterKeyMap;"
      },
      {
        "sha": "025d3606d9d20090ab0feb68976f26b1f6757382",
        "filename": "src/wallet/walletdb.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 8,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e86eb71604e73ad35b8b1f59d73af22e353a156e/src/wallet/walletdb.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e86eb71604e73ad35b8b1f59d73af22e353a156e/src/wallet/walletdb.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/walletdb.cpp?ref=e86eb71604e73ad35b8b1f59d73af22e353a156e",
        "patch": "@@ -556,14 +556,8 @@ ReadKeyValue(CWallet* pwallet, CDataStream& ssKey, CDataStream& ssValue,\n             ssKey >> nIndex;\n             CKeyPool keypool;\n             ssValue >> keypool;\n-            pwallet->setKeyPool.insert(nIndex);\n-\n-            // If no metadata exists yet, create a default with the pool key's\n-            // creation time. Note that this may be overwritten by actually\n-            // stored metadata for that key later, which is fine.\n-            CKeyID keyid = keypool.vchPubKey.GetID();\n-            if (pwallet->mapKeyMetadata.count(keyid) == 0)\n-                pwallet->mapKeyMetadata[keyid] = CKeyMetadata(keypool.nTime);\n+\n+            pwallet->LoadKeyPool(nIndex, keypool);\n         }\n         else if (strType == \"version\")\n         {"
      }
    ]
  },
  {
    "sha": "8680d3aa800aa4fab8c321b92cc7f3fa97a8a0a3",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4NjgwZDNhYTgwMGFhNGZhYjhjMzIxYjkyY2M3ZjNmYTk3YThhMGEz",
    "commit": {
      "author": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2016-08-19T22:50:48Z"
      },
      "committer": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2016-08-20T21:03:47Z"
      },
      "message": "Move wallet initialization logic from AppInit2 to CWallet::InitLoadWallet",
      "tree": {
        "sha": "84cd028dd0f80ba73c8abb5d37317392a224ab8a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/84cd028dd0f80ba73c8abb5d37317392a224ab8a"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8680d3aa800aa4fab8c321b92cc7f3fa97a8a0a3",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8680d3aa800aa4fab8c321b92cc7f3fa97a8a0a3",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/8680d3aa800aa4fab8c321b92cc7f3fa97a8a0a3",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8680d3aa800aa4fab8c321b92cc7f3fa97a8a0a3/comments",
    "author": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "e86eb71604e73ad35b8b1f59d73af22e353a156e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e86eb71604e73ad35b8b1f59d73af22e353a156e",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/e86eb71604e73ad35b8b1f59d73af22e353a156e"
      }
    ],
    "stats": {
      "total": 22,
      "additions": 10,
      "deletions": 12
    },
    "files": [
      {
        "sha": "1547afe6cfd953cb59cfdd8299a741674b6a5996",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 0,
        "deletions": 12,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/8680d3aa800aa4fab8c321b92cc7f3fa97a8a0a3/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/8680d3aa800aa4fab8c321b92cc7f3fa97a8a0a3/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=8680d3aa800aa4fab8c321b92cc7f3fa97a8a0a3",
        "patch": "@@ -1438,15 +1438,6 @@ bool AppInit2(boost::thread_group& threadGroup, CScheduler& scheduler)\n     //// debug print\n     LogPrintf(\"mapBlockIndex.size() = %u\\n\",   mapBlockIndex.size());\n     LogPrintf(\"nBestHeight = %d\\n\",                   chainActive.Height());\n-#ifdef ENABLE_WALLET\n-    if (pwalletMain) {\n-        LOCK(pwalletMain->cs_wallet);\n-        LogPrintf(\"setKeyPool.size() = %u\\n\",      pwalletMain->GetKeyPoolSize());\n-        LogPrintf(\"mapWallet.size() = %u\\n\",       pwalletMain->mapWallet.size());\n-        LogPrintf(\"mapAddressBook.size() = %u\\n\",  pwalletMain->mapAddressBook.size());\n-    }\n-#endif\n-\n     if (GetBoolArg(\"-listenonion\", DEFAULT_LISTEN_ONION))\n         StartTorControl(threadGroup, scheduler);\n \n@@ -1459,9 +1450,6 @@ bool AppInit2(boost::thread_group& threadGroup, CScheduler& scheduler)\n \n #ifdef ENABLE_WALLET\n     if (pwalletMain) {\n-        // Add wallet transactions that aren't already in a block to mapTransactions\n-        pwalletMain->ReacceptWalletTransactions();\n-\n         // Run a thread to flush wallet periodically\n         threadGroup.create_thread(boost::bind(&ThreadFlushWalletDB, boost::ref(pwalletMain->strWalletFile)));\n     }"
      },
      {
        "sha": "04f08e38c3e69cb2b29505f94c246670be421d92",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 10,
        "deletions": 0,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/8680d3aa800aa4fab8c321b92cc7f3fa97a8a0a3/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/8680d3aa800aa4fab8c321b92cc7f3fa97a8a0a3/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=8680d3aa800aa4fab8c321b92cc7f3fa97a8a0a3",
        "patch": "@@ -3411,7 +3411,17 @@ bool CWallet::InitLoadWallet()\n     }\n     walletInstance->SetBroadcastTransactions(GetBoolArg(\"-walletbroadcast\", DEFAULT_WALLETBROADCAST));\n \n+    {\n+        LOCK(walletInstance->cs_wallet);\n+        LogPrintf(\"setKeyPool.size() = %u\\n\",      walletInstance->GetKeyPoolSize());\n+        LogPrintf(\"mapWallet.size() = %u\\n\",       walletInstance->mapWallet.size());\n+        LogPrintf(\"mapAddressBook.size() = %u\\n\",  walletInstance->mapAddressBook.size());\n+    }\n+    // Add wallet transactions that aren't already in a block to mapTransactions\n+    walletInstance->ReacceptWalletTransactions();\n+\n     pwalletMain = walletInstance;\n+\n     return true;\n }\n "
      }
    ]
  }
]