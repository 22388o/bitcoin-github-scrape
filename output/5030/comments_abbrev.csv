laanwj,2014-10-02T11:45:23Z,"This has to do with the order in which tests are executed.\n\n`blockv2_tests.cpp` leaves the block chain in a unspecified state, which causes the miner tests to fail.\n\nI'm going to split this up into two commits: one that introduces the UNITTEST framework and modifyiable parameters, and one that adds the block v2 test.\n",https://github.com/bitcoin/bitcoin/pull/5030#issuecomment-57616174,57616174,
laanwj,2014-10-02T11:55:09Z,This should pass now.\n,https://github.com/bitcoin/bitcoin/pull/5030#issuecomment-57616999,57616999,
laanwj,2014-10-02T11:57:47Z,"@SergioDemianLerner  I've split off this part that adds the blockv2 tests: https://github.com/laanwj/bitcoin/commit/782f6c8758ea25dcc93989e8631ba4f34b5ae09e\nIt needs some more work to leave the block chain in a usable state for the next test, or to create a new block chain for each test. This already hinted in the comments\n\n``` c++\n// We don't know the state of the block-chain here: it depends",https://github.com/bitcoin/bitcoin/pull/5030#issuecomment-57618825,57618825,
SergioDemianLerner,2014-10-02T14:08:55Z,"The problem is not that the blockv2_test leaves the blockchain in a bad state. The problem is the the miner_test MUST be executed before blockv2_test because miner_tests tests v1 blocks and blockv2_test tests v2 blocks.\nIf the Boost test framework does not allow to specify a unique order for the tests, one way to force this is to include blockv2_test into miner_test via #include, and let both of ",https://github.com/bitcoin/bitcoin/pull/5030#issuecomment-57634789,57634789,
SergioDemianLerner,2014-10-02T14:14:40Z,"Definitively, the easiest way would be that each new test that mines blocks adds an #include line into miner_test.cpp\n@laanwj : I suppose I don't have write access to the rebased repo. Could you add the #include ""blockv2_test.cpp"" into the last line of miner_test.cpp and create a new pull request for that?\n",https://github.com/bitcoin/bitcoin/pull/5030#issuecomment-57635597,57635597,
laanwj,2014-10-02T14:59:57Z,"I don't really like tests that are dependent on order, or hacking around that; let's try to do it properly. What we really need is #4688.\n\nI can't give you write access to my branch, but if you want to edit the branch you could pull my branch and start from there.\n",https://github.com/bitcoin/bitcoin/pull/5030#issuecomment-57642598,57642598,
SergioDemianLerner,2014-10-02T15:35:48Z,"Yes I agree, but I'm also more pragmatic and not so purist: why not allowing both? \nSome future tests could be dependent on the order and some not. The overhead of recreating the block-chain is low, but we could avoid it in some cases. Other reason to let people add block test cases to a single file is that test cases involving transactions require pre-mined coinbases. If each test must recreate ",https://github.com/bitcoin/bitcoin/pull/5030#issuecomment-57648721,57648721,
SergioDemianLerner,2014-10-02T15:39:39Z,"If somebody were to re-write each test case of FullBlockTestGenerator.java as an independent .cpp file, the block-chain would need to be re-created 40 times in each test_bitcoin execution.\n",https://github.com/bitcoin/bitcoin/pull/5030#issuecomment-57649341,57649341,
laanwj,2014-10-02T19:07:22Z,"If some starting point is convenient to be used by multiple tests (like ""100 blocks in order to have 50 BTC mature"") it makes sense to compute that once and cache it. \n\nI still don't see a good reason to make tests use each other's output. Then it becomes impossible to disable tests without affecting others. I think we've all worked with hairballs like that, so I'd prefer to avoid it. They are c",https://github.com/bitcoin/bitcoin/pull/5030#issuecomment-57689126,57689126,
sipa,2014-10-02T19:30:28Z,@SergioDemianLerner Please don't confuse the unit tests (in .cpp code) and the network interaction tests (in comparison tool). The purpose of the first is to test whether the code behaves as the implementer intends it to work. The purpose of the second is to detect consensus and other cross-implementation compatibility.\n\nI would be strongly opposed to converting comparison tool into a unit test.,https://github.com/bitcoin/bitcoin/pull/5030#issuecomment-57692209,57692209,
SergioDemianLerner,2014-10-03T13:36:45Z,"I don't say we should replace the comparison tool, since it has been very useful. It was an example of how the number of tests could grow. But some unit test can test things that are hidden from the remote nodes. I made bitcoind stress unit tests that check RAM and CPU usage, and I'm waiting to merge them when we resolve how.\n",https://github.com/bitcoin/bitcoin/pull/5030#issuecomment-57796914,57796914,
sipa,2014-10-03T15:23:22Z,"Ok, good. I misinterpreted your comment it seems.\n",https://github.com/bitcoin/bitcoin/pull/5030#issuecomment-57811010,57811010,
SergioDemianLerner,2014-10-06T12:19:13Z,This has been merged! I hadn't notice. Great! Thanks!\n,https://github.com/bitcoin/bitcoin/pull/5030#issuecomment-58008884,58008884,
mikehearn,2014-10-08T10:34:21Z,"In bitcoinj we have a large number of unit tests that create block chains and throw them away. Actually a full test run of bitcoinj runs ~5000 unit tests, although not all of those require block chains. So there's no reason to be scared of creating and throwing away chains - they are after all just in memory data structures and a UNITTEST params chain can have blocks mined more or less instantly.\",https://github.com/bitcoin/bitcoin/pull/5030#issuecomment-58339029,58339029,
