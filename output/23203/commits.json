[
  {
    "sha": "168d8f1c5fdd806ff2324958d736e2650dceff1a",
    "node_id": "C_kwDOABII59oAKDE2OGQ4ZjFjNWZkZDgwNmZmMjMyNDk1OGQ3MzZlMjY1MGRjZWZmMWE",
    "commit": {
      "author": {
        "name": "fanquake",
        "email": "fanquake@gmail.com",
        "date": "2021-05-25T01:22:35Z"
      },
      "committer": {
        "name": "fanquake",
        "email": "fanquake@gmail.com",
        "date": "2021-11-25T13:46:11Z"
      },
      "message": "[POC] build: static, musl based bitcoind",
      "tree": {
        "sha": "db7c2091889bcdd961deba7e60ca7f71a99224cf",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/db7c2091889bcdd961deba7e60ca7f71a99224cf"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/168d8f1c5fdd806ff2324958d736e2650dceff1a",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEz7FuIclQ9n+pXlWPLuufXMCVJsEFAmGfk6QACgkQLuufXMCV\nJsGDRxAAgGBFc8TkvtuPlro6nU0JrftpFAUAubAVB9TEp6egZaxB0rVoLzPYsTyY\nkizKoyoiJJBS+tUknubvvCTrtT7XiMjiTJaksyABW1FuOzzcr+tBu0jw5D19YX3X\nTvpDog5mBNJlj2UpQ1cqqnxI0+Cy5rw8SUnuksZoK0pNSeXvDwVpL4M1LTsstRmO\nu3Rt9A5TpwterDza0Ukn5rAkCMVW6cZGpJeBfzdVV4vIe70m3HRswNsIiP9yJtAv\nfwK8GRR6qajQUD4ZX099EwW+oYJJJzzMCEICdj7AGsl5uW3yW2moK4BuOUJRXrro\n2UOROQpMeHJ3IYSZ2fArJ63p/B/BR8O3W/ewkAvq7Fg4ExNnjkl0QGO0MQHFB2Pq\nNJtXwkBDUicnGTeAvwr8RQFFnxjU/IbHdVOEFxJ8hgyd+VLyFROwonLcIaceNY1q\nOgxVbcsXiz/rkDmV6QesiVuwoX9oSHZUQcwZNGeRS3pYS9Pf+g2hUFQfrA6j14Pb\nEjuv0bomOXnJcKoDjUT13Zrp6kY4mIEWT++3WSq8xqYQ7s3u6IrObyd1A+hqxJrV\nErbRup+xOUCa7HN6nbBwGoGbLYzUw/HCYAZ4IxzY70eFEY9XzKi+wkHaeI3t/lM0\n9k9JHSq9dxrGFS4jbsuSpeylLUcsWThNSgcaBlwLatzSOPCDcRU=\n=xlg3\n-----END PGP SIGNATURE-----",
        "payload": "tree db7c2091889bcdd961deba7e60ca7f71a99224cf\nparent 681b25e3cd7d084f642693152322ed9a40f33ba0\nauthor fanquake <fanquake@gmail.com> 1621905755 +0800\ncommitter fanquake <fanquake@gmail.com> 1637847971 +0800\n\n[POC] build: static, musl based bitcoind\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/168d8f1c5fdd806ff2324958d736e2650dceff1a",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/168d8f1c5fdd806ff2324958d736e2650dceff1a",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/168d8f1c5fdd806ff2324958d736e2650dceff1a/comments",
    "author": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "681b25e3cd7d084f642693152322ed9a40f33ba0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/681b25e3cd7d084f642693152322ed9a40f33ba0",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/681b25e3cd7d084f642693152322ed9a40f33ba0"
      }
    ],
    "stats": {
      "total": 69,
      "additions": 69,
      "deletions": 0
    },
    "files": [
      {
        "sha": "ed009c8b86d9f2fa3b3bbb01b7ed200ac599b342",
        "filename": "depends/hosts/linux.mk",
        "status": "modified",
        "additions": 21,
        "deletions": 0,
        "changes": 21,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/168d8f1c5fdd806ff2324958d736e2650dceff1a/depends/hosts/linux.mk",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/168d8f1c5fdd806ff2324958d736e2650dceff1a/depends/hosts/linux.mk",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/depends/hosts/linux.mk?ref=168d8f1c5fdd806ff2324958d736e2650dceff1a",
        "patch": "@@ -9,6 +9,8 @@ linux_debug_CXXFLAGS=$(linux_debug_CFLAGS)\n \n linux_debug_CPPFLAGS=-D_GLIBCXX_DEBUG -D_GLIBCXX_DEBUG_PEDANTIC -D_LIBCPP_DEBUG=1\n \n+ifeq ($(strip $(USE_MUSL_LIB)),)\n+\n ifeq (86,$(findstring 86,$(build_arch)))\n i686_linux_CC=gcc -m32\n i686_linux_CXX=g++ -m32\n@@ -29,4 +31,23 @@ i686_linux_CXX=$(default_host_CXX) -m32\n x86_64_linux_CC=$(default_host_CC) -m64\n x86_64_linux_CXX=$(default_host_CXX) -m64\n endif\n+\n+# musl build..\n+else\n+\n+linux_native_toolchain = native_musl_cross_make\n+\n+x86_64_linux_AR=$(build_prefix)/bin/x86_64-linux-musl-gcc-ar\n+x86_64_linux_CC=$(build_prefix)/bin/x86_64-linux-musl-gcc -m64\n+x86_64_linux_CXX=$(build_prefix)/bin/x86_64-linux-musl-g++ -m64\n+x86_64_linux_LD=$(build_prefix)/bin/x86_64-linux-musl-ld\n+x86_64_linux_NM=$(build_prefix)/bin/x86_64-linux-musl-gcc-nm\n+x86_64_linux_OBJDUMP=$(build_prefix)/bin/x86_64-linux-musl-objdump\n+x86_64_linux_RANLIB=$(build_prefix)/bin/x86_64-linux-musl-gcc-ranlib\n+x86_64_linux_STRIP=$(build_prefix)/bin/x86_64-linux-musl-strip\n+\n+linux_CFLAGS+=-static\n+linux_CXXFLAGS+=-static\n+endif\n+\n linux_cmake_system=Linux"
      },
      {
        "sha": "e4bba4d9c2733da476a385820808b445c1bf871b",
        "filename": "depends/packages/native_musl_cross_make.mk",
        "status": "added",
        "additions": 22,
        "deletions": 0,
        "changes": 22,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/168d8f1c5fdd806ff2324958d736e2650dceff1a/depends/packages/native_musl_cross_make.mk",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/168d8f1c5fdd806ff2324958d736e2650dceff1a/depends/packages/native_musl_cross_make.mk",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/depends/packages/native_musl_cross_make.mk?ref=168d8f1c5fdd806ff2324958d736e2650dceff1a",
        "patch": "@@ -0,0 +1,22 @@\n+package=native_musl_cross_make\n+$(package)_version=b23b206755b1f71fe6743685091fe96df154bae7\n+$(package)_download_path=https://github.com/fanquake/musl-cross-make/archive\n+$(package)_download_file=$($(package)_version).tar.gz\n+$(package)_file_name=musl-cross-make-$($(package)_version).tar.gz\n+$(package)_sha256_hash=54df938af0ecddf327d784217d5b5d374319b0b4fc54751204e3354098863bb8\n+$(package)_patches=config.mak\n+\n+define $(package)_preprocess_cmds\n+  cp -f $($(package)_patch_dir)/config.mak config.mak\n+endef\n+\n+define $(package)_build_cmds\n+  $(MAKE)\n+endef\n+\n+define $(package)_stage_cmds\n+  $(MAKE) install && \\\n+  mkdir -p \"$($(package)_staging_prefix_dir)\"/ && \\\n+  rm -rf output/share && \\\n+  cp -rf output/* \"$($(package)_staging_prefix_dir)\"/\n+endef"
      },
      {
        "sha": "2623d66e93f13231c1dc34e811ac2f4a9538b7a4",
        "filename": "depends/packages/packages.mk",
        "status": "modified",
        "additions": 4,
        "deletions": 0,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/168d8f1c5fdd806ff2324958d736e2650dceff1a/depends/packages/packages.mk",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/168d8f1c5fdd806ff2324958d736e2650dceff1a/depends/packages/packages.mk",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/depends/packages/packages.mk?ref=168d8f1c5fdd806ff2324958d736e2650dceff1a",
        "patch": "@@ -23,6 +23,10 @@ darwin_native_packages = native_ds_store native_mac_alias\n \n $(host_arch)_$(host_os)_native_packages += native_b2\n \n+ifneq ($(strip $(USE_MUSL_LIB)),)\n+linux_native_packages = native_musl_cross_make\n+endif\n+\n ifneq ($(build_os),darwin)\n darwin_native_packages += native_cctools native_libtapi native_libdmg-hfsplus\n "
      },
      {
        "sha": "a299a0f6d07acc8be545c6c91c06356c55cdd4fa",
        "filename": "depends/patches/native_musl_cross_make/config.mak",
        "status": "added",
        "additions": 22,
        "deletions": 0,
        "changes": 22,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/168d8f1c5fdd806ff2324958d736e2650dceff1a/depends/patches/native_musl_cross_make/config.mak",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/168d8f1c5fdd806ff2324958d736e2650dceff1a/depends/patches/native_musl_cross_make/config.mak",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/depends/patches/native_musl_cross_make/config.mak?ref=168d8f1c5fdd806ff2324958d736e2650dceff1a",
        "patch": "@@ -0,0 +1,22 @@\n+TARGET = x86_64-linux-musl\n+\n+BINUTILS_VER = 2.37\n+GCC_VER = 11.2.0\n+MUSL_VER = 1.2.2\n+\n+COMMON_CONFIG += --with-debug-prefix-map=$(CURDIR)=\n+\n+COMMON_CONFIG += CFLAGS=\"-fPIC -g0 -O2\"\n+COMMON_CONFIG += CXXFLAGS=\"-fPIC -g0 -O2\"\n+COMMON_CONFIG += LDFLAGS=\"-s\"\n+\n+COMMON_CONFIG += --disable-shared\n+COMMON_CONFIG += --enable-static\n+\n+DL_CMD = curl -C - -L -o\n+\n+GCC_CONFIG += --disable-libquadmath\n+GCC_CONFIG += --disable-multilib\n+GCC_CONFIG += --disable-nls\n+GCC_CONFIG += --enable-default-pie\n+GCC_CONFIG += --enable-default-ssp"
      }
    ]
  }
]