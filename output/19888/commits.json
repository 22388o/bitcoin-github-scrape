[
  {
    "sha": "098a474e9fe671d870888925f2273c7947d6e3b5",
    "node_id": "C_kwDOABII59oAKDA5OGE0NzRlOWZlNjcxZDg3MDg4ODkyNWYyMjczYzc5NDdkNmUzYjU",
    "commit": {
      "author": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2020-12-23T23:11:40Z"
      },
      "committer": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2021-09-23T23:15:00Z"
      },
      "message": "validation, refactor: Add unspendable coinbase helper functions\n\nMaking the checks to identify BIP30 available outside of validation.cpp is needed for reporting and tracking statistics on specific blocks and the UTXO set correctly.",
      "tree": {
        "sha": "7973c2527495c89231ee10e2f0f773ca645be799",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7973c2527495c89231ee10e2f0f773ca645be799"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/098a474e9fe671d870888925f2273c7947d6e3b5",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\nComment: GPGTools - https://gpgtools.org\n\niQJJBAABCgAzFiEEtFq20ghhrCHSdrgm8T0enYkHmM0FAmFNCnQVHGZqYWhyQHBy\nb3Rvbm1haWwuY29tAAoJEPE9Hp2JB5jNC2AP/0eyWlIveApMOoU3SnBR+TQxI//g\n9J/SARsBpjX3HgLfBqyAXQU3SaAjBMUtvwGSQW4mP7zHbSS10nhR/+GV+tLHwOoh\nlv5i16HymJph9n4DEW2FIJ1Y5dYqMZKy6faX1rVErjRfq3qIExYvRz8yGZPY/jez\nTA+20w2uAxqi7Pa4ghjvY2Fe1y0BN4EPYoew6S+ea+pPGSwY8kn5qYIB8A9BxWWx\nUcbQpiswyNLAT6qDibwdtLTbxrt8w6oVrHI2NSEmJz4SSOYtPVcdEW425h/sWaUz\nyds0+8+gznT+14g7WSBjSJ1swWb/2lhtaGhPohuHHeYtOmApad8Tu5t46XJ3Rdm4\nqc74Ep1ms21xghKiKTkQ4zTl59IjfIaz4rZ3UUpTjJdulBm7TstpsBBRs3JgQWs1\nbKn8I7zZ2It/RU7jilqNYRLubTbI2JOlH2qd2hOw+amyZ73CTP4H37p4CWkMeBPu\n2VBFIJrB1gx3pSLjIBoAhSbdURp2/4GRBEm/2Unsbc4fwQBOQpCMb1lZh9UlAErV\nUkgGuVN8o0v7MvuhXRLqk64gqW0mAkYWWjMh0Xh7fiNuIj9hIU3Gp/RtHGRVSs9/\nprWl2gXTqMuEicO+EvI5VSfO89ZpFCJL+mAF/+//cL+gki4sjZfzJhpthIWL3NIm\nevCmyJh0oqYU/15D\n=0BSC\n-----END PGP SIGNATURE-----",
        "payload": "tree 7973c2527495c89231ee10e2f0f773ca645be799\nparent b7e360081506cc646dd86f131df2d01f3c544f0e\nauthor Fabian Jahr <fjahr@protonmail.com> 1608765100 +0100\ncommitter Fabian Jahr <fjahr@protonmail.com> 1632438900 +0200\n\nvalidation, refactor: Add unspendable coinbase helper functions\n\nMaking the checks to identify BIP30 available outside of validation.cpp is needed for reporting and tracking statistics on specific blocks and the UTXO set correctly.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/098a474e9fe671d870888925f2273c7947d6e3b5",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/098a474e9fe671d870888925f2273c7947d6e3b5",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/098a474e9fe671d870888925f2273c7947d6e3b5/comments",
    "author": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjahr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjahr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "b7e360081506cc646dd86f131df2d01f3c544f0e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b7e360081506cc646dd86f131df2d01f3c544f0e",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/b7e360081506cc646dd86f131df2d01f3c544f0e"
      }
    ],
    "stats": {
      "total": 21,
      "additions": 19,
      "deletions": 2
    },
    "files": [
      {
        "sha": "5fc15c057998703394a1a84ccc469328c393a9b9",
        "filename": "src/validation.cpp",
        "status": "modified",
        "additions": 13,
        "deletions": 2,
        "changes": 15,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/098a474e9fe671d870888925f2273c7947d6e3b5/src/validation.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/098a474e9fe671d870888925f2273c7947d6e3b5/src/validation.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/validation.cpp?ref=098a474e9fe671d870888925f2273c7947d6e3b5",
        "patch": "@@ -1674,8 +1674,7 @@ bool CChainState::ConnectBlock(const CBlock& block, BlockValidationState& state,\n     // Now that the whole chain is irreversibly beyond that time it is applied to all blocks except the\n     // two in the chain that violate it. This prevents exploiting the issue against nodes during their\n     // initial block download.\n-    bool fEnforceBIP30 = !((pindex->nHeight==91842 && pindex->GetBlockHash() == uint256S(\"0x00000000000a4d0a398161ffc163c503763b1f4360639393e0e4c8e300e0caec\")) ||\n-                           (pindex->nHeight==91880 && pindex->GetBlockHash() == uint256S(\"0x00000000000743f190a18c5577a3c2d2a1f610ae9601ac046a38084ccb7cd721\")));\n+    bool fEnforceBIP30 = !IsBIP30Repeat(*pindex);\n \n     // Once BIP34 activated it was not possible to create new duplicate coinbases and thus other than starting\n     // with the 2 existing duplicate coinbase pairs, not possible to create overwriting txs.  But by the\n@@ -5020,3 +5019,15 @@ void ChainstateManager::MaybeRebalanceCaches()\n         }\n     }\n }\n+\n+bool IsBIP30Repeat(const CBlockIndex& block_index)\n+{\n+    return (block_index.nHeight==91842 && block_index.GetBlockHash() == uint256S(\"0x00000000000a4d0a398161ffc163c503763b1f4360639393e0e4c8e300e0caec\")) ||\n+           (block_index.nHeight==91880 && block_index.GetBlockHash() == uint256S(\"0x00000000000743f190a18c5577a3c2d2a1f610ae9601ac046a38084ccb7cd721\"));\n+}\n+\n+bool IsBIP30Unspendable(const CBlockIndex& block_index)\n+{\n+    return (block_index.nHeight==91722 && block_index.GetBlockHash() == uint256S(\"0x00000000000271a2dc26e7667f8419f2e15416dc6955e5a6c6cdf3f2574dd08e\")) ||\n+           (block_index.nHeight==91812 && block_index.GetBlockHash() == uint256S(\"0x00000000000af0aed4792b1acee3d966af36cf5def14935db8de83d6f9306f2f\"));\n+}"
      },
      {
        "sha": "e3d0cfe992414544a26b84db2877003d4bba24b9",
        "filename": "src/validation.h",
        "status": "modified",
        "additions": 6,
        "deletions": 0,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/098a474e9fe671d870888925f2273c7947d6e3b5/src/validation.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/098a474e9fe671d870888925f2273c7947d6e3b5/src/validation.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/validation.h?ref=098a474e9fe671d870888925f2273c7947d6e3b5",
        "patch": "@@ -1034,4 +1034,10 @@ bool LoadMempool(CTxMemPool& pool, CChainState& active_chainstate, FopenFn mocka\n  */\n const AssumeutxoData* ExpectedAssumeutxo(const int height, const CChainParams& params);\n \n+/** Identifies blocks that overwrote an existing coinbase output in the UTXO set (see BIP30) */\n+bool IsBIP30Repeat(const CBlockIndex& block_index);\n+\n+/** Identifies blocks which coinbase output was subsequently overwritten in the UTXO set (see BIP30) */\n+bool IsBIP30Unspendable(const CBlockIndex& block_index);\n+\n #endif // BITCOIN_VALIDATION_H"
      }
    ]
  },
  {
    "sha": "787f977afbbd2480a48664db6ef89d14bc5c4485",
    "node_id": "C_kwDOABII59oAKDc4N2Y5NzdhZmJiZDI0ODBhNDg2NjRkYjZlZjg5ZDE0YmM1YzQ0ODU",
    "commit": {
      "author": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2020-09-05T22:22:19Z"
      },
      "committer": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2021-09-23T23:19:07Z"
      },
      "message": "rpc: Improve getblockstats\n\n- Fix getblockstats for block height 0 which previously returned an error.\n- Introduce alternative utxo_*_actual statistics which exclude unspendables: Genesis block, BIP30, unspendable outputs\n- Update test data\n- Explicitly test Genesis block results",
      "tree": {
        "sha": "06f9a45ecb0edabde3e3db5ee616edc42c527dec",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/06f9a45ecb0edabde3e3db5ee616edc42c527dec"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/787f977afbbd2480a48664db6ef89d14bc5c4485",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\nComment: GPGTools - https://gpgtools.org\n\niQJJBAABCgAzFiEEtFq20ghhrCHSdrgm8T0enYkHmM0FAmFNC24VHGZqYWhyQHBy\nb3Rvbm1haWwuY29tAAoJEPE9Hp2JB5jNzZoP/Ax38JjnWgu8s58dZNKzFRPW4hUe\nO7zLevFFcxcaH6OsTuHTRnNwry5zdn5DHL5rN4MzuC6G6kC8B/TGN8oUsuR5hYa/\n4vHzHhOtigWNBLNXWl/5xOUigTgVAl0UJnqXXaMILAjL9M9u9BcRpl2WO0L9R6Vu\nipaqAlJREdEDVAJfw1xHEb6dw8KZDS5Vv3vNAjxGDeoVljUzWT6j0cnxsBmZ+Onk\nYn26J1HUawzIdAKgXZzOQK+rhCSrHnE2TkLEx505dW3Krilep9PUmoBBgYwBg8t3\ncOM2qGqR0mC28b+a/J37k/7aZ6VwSZLj1vl5ONmgy5BpiaauPRN3rItXKP+DxqUK\nzQBbhIOfogX/AOb5MnhJgbr2XQ//DyO1wenD9AW9GOHdLlKflPiunoKLmpR9Ygkt\nlgQhaJ3zCBdGoF9H1yTUHni9n6OiDGAlODrCrmcyygY9nsaIFCLzBASAaT6QOO2j\nohCZHFFy9OukMtOS2Y8FpQyxWoXDJk+uDmJnWP+EfH6noqJNY5Mkk5RXTeFaPcWm\npCepAO4k7qfxaUQEzCmUfylCcWfL3z0bHuaMKu9QZ/r5ABgj63T819C5YAyeCFz9\nr/7+M1lvaGjmRRpP1YzBUVNlJexEjkvtoDXTYE+t5Hb01QEtbg8HefvogHEtfo2l\nYL67jIdxxakbYiUd\n=E12V\n-----END PGP SIGNATURE-----",
        "payload": "tree 06f9a45ecb0edabde3e3db5ee616edc42c527dec\nparent 098a474e9fe671d870888925f2273c7947d6e3b5\nauthor Fabian Jahr <fjahr@protonmail.com> 1599344539 +0200\ncommitter Fabian Jahr <fjahr@protonmail.com> 1632439147 +0200\n\nrpc: Improve getblockstats\n\n- Fix getblockstats for block height 0 which previously returned an error.\n- Introduce alternative utxo_*_actual statistics which exclude unspendables: Genesis block, BIP30, unspendable outputs\n- Update test data\n- Explicitly test Genesis block results\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/787f977afbbd2480a48664db6ef89d14bc5c4485",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/787f977afbbd2480a48664db6ef89d14bc5c4485",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/787f977afbbd2480a48664db6ef89d14bc5c4485/comments",
    "author": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjahr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjahr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "098a474e9fe671d870888925f2273c7947d6e3b5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/098a474e9fe671d870888925f2273c7947d6e3b5",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/098a474e9fe671d870888925f2273c7947d6e3b5"
      }
    ],
    "stats": {
      "total": 53,
      "additions": 45,
      "deletions": 8
    },
    "files": [
      {
        "sha": "87c807c58a474cf60e5d42d9eba125cb10f9c1bf",
        "filename": "src/rpc/blockchain.cpp",
        "status": "modified",
        "additions": 27,
        "deletions": 4,
        "changes": 31,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/787f977afbbd2480a48664db6ef89d14bc5c4485/src/rpc/blockchain.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/787f977afbbd2480a48664db6ef89d14bc5c4485/src/rpc/blockchain.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpc/blockchain.cpp?ref=787f977afbbd2480a48664db6ef89d14bc5c4485",
        "patch": "@@ -915,6 +915,10 @@ static CBlock GetBlockChecked(const CBlockIndex* pblockindex)\n static CBlockUndo GetUndoChecked(const CBlockIndex* pblockindex)\n {\n     CBlockUndo blockUndo;\n+\n+    // The Genesis block does not have undo data\n+    if (pblockindex->nHeight == 0) return blockUndo;\n+\n     if (IsBlockPruned(pblockindex)) {\n         throw JSONRPCError(RPC_MISC_ERROR, \"Undo data not available (pruned data)\");\n     }\n@@ -2005,8 +2009,10 @@ static RPCHelpMan getblockstats()\n                 {RPCResult::Type::NUM, \"total_weight\", /* optional */ true, \"Total weight of all non-coinbase transactions\"},\n                 {RPCResult::Type::NUM, \"totalfee\", /* optional */ true, \"The fee total\"},\n                 {RPCResult::Type::NUM, \"txs\", /* optional */ true, \"The number of transactions (including coinbase)\"},\n-                {RPCResult::Type::NUM, \"utxo_increase\", /* optional */ true, \"The increase/decrease in the number of unspent outputs\"},\n+                {RPCResult::Type::NUM, \"utxo_increase\", /* optional */ true, \"The increase/decrease in the number of unspent outputs (not discounting op_return and similar)\"},\n                 {RPCResult::Type::NUM, \"utxo_size_inc\", /* optional */ true, \"The increase/decrease in size for the utxo index (not discounting op_return and similar)\"},\n+                {RPCResult::Type::NUM, \"utxo_increase_actual\", /* optional */ true, \"The increase/decrease in the number of unspent outputs, not counting unspendables\"},\n+                {RPCResult::Type::NUM, \"utxo_size_inc_actual\", /* optional */ true, \"The increase/decrease in size for the utxo index, not counting unspendables\"},\n             }},\n                 RPCExamples{\n                     HelpExampleCli(\"getblockstats\", R\"('\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\"' '[\"minfeerate\",\"avgfeerate\"]')\") +\n@@ -2038,7 +2044,7 @@ static RPCHelpMan getblockstats()\n     const bool do_medianfee = do_all || stats.count(\"medianfee\") != 0;\n     const bool do_feerate_percentiles = do_all || stats.count(\"feerate_percentiles\") != 0;\n     const bool loop_inputs = do_all || do_medianfee || do_feerate_percentiles ||\n-        SetHasKeys(stats, \"utxo_size_inc\", \"totalfee\", \"avgfee\", \"avgfeerate\", \"minfee\", \"maxfee\", \"minfeerate\", \"maxfeerate\");\n+        SetHasKeys(stats, \"utxo_increase\", \"utxo_increase_actual\", \"utxo_size_inc\", \"utxo_size_inc_actual\", \"totalfee\", \"avgfee\", \"avgfeerate\", \"minfee\", \"maxfee\", \"minfeerate\", \"maxfeerate\");\n     const bool loop_outputs = do_all || loop_inputs || stats.count(\"total_out\");\n     const bool do_calculate_size = do_mediantxsize ||\n         SetHasKeys(stats, \"total_size\", \"avgtxsize\", \"mintxsize\", \"maxtxsize\", \"swtotal_size\");\n@@ -2060,7 +2066,9 @@ static RPCHelpMan getblockstats()\n     int64_t swtxs = 0;\n     int64_t total_size = 0;\n     int64_t total_weight = 0;\n+    int64_t utxos = 0;\n     int64_t utxo_size_inc = 0;\n+    int64_t utxo_size_inc_actual = 0;\n     std::vector<CAmount> fee_array;\n     std::vector<std::pair<CAmount, int64_t>> feerate_array;\n     std::vector<int64_t> txsize_array;\n@@ -2073,7 +2081,18 @@ static RPCHelpMan getblockstats()\n         if (loop_outputs) {\n             for (const CTxOut& out : tx->vout) {\n                 tx_total_out += out.nValue;\n-                utxo_size_inc += GetSerializeSize(out, PROTOCOL_VERSION) + PER_UTXO_OVERHEAD;\n+\n+                size_t out_size = GetSerializeSize(out, PROTOCOL_VERSION) + PER_UTXO_OVERHEAD;\n+                utxo_size_inc += out_size;\n+\n+                // The Genesis block and the repeated BIP30 block coinbases don't change the UTXO\n+                // set counts, so they have to be excluded from the statistics\n+                if (pindex->nHeight == 0 || (IsBIP30Repeat(*pindex) && tx->IsCoinBase())) continue;\n+                // Skip unspendable outputs since they are not included in the UTXO set\n+                if (out.scriptPubKey.IsUnspendable()) continue;\n+\n+                ++utxos;\n+                utxo_size_inc_actual += out_size;\n             }\n         }\n \n@@ -2115,7 +2134,9 @@ static RPCHelpMan getblockstats()\n                 const CTxOut& prevoutput = coin.out;\n \n                 tx_total_in += prevoutput.nValue;\n-                utxo_size_inc -= GetSerializeSize(prevoutput, PROTOCOL_VERSION) + PER_UTXO_OVERHEAD;\n+                size_t prevout_size = GetSerializeSize(prevoutput, PROTOCOL_VERSION) + PER_UTXO_OVERHEAD;\n+                utxo_size_inc -= prevout_size;\n+                utxo_size_inc_actual -= prevout_size;\n             }\n \n             CAmount txfee = tx_total_in - tx_total_out;\n@@ -2175,6 +2196,8 @@ static RPCHelpMan getblockstats()\n     ret_all.pushKV(\"txs\", (int64_t)block.vtx.size());\n     ret_all.pushKV(\"utxo_increase\", outputs - inputs);\n     ret_all.pushKV(\"utxo_size_inc\", utxo_size_inc);\n+    ret_all.pushKV(\"utxo_increase_actual\", utxos - inputs);\n+    ret_all.pushKV(\"utxo_size_inc_actual\", utxo_size_inc_actual);\n \n     if (do_all) {\n         return ret_all;"
      },
      {
        "sha": "487945dd9fa1a775a8668e0eea219caeba905477",
        "filename": "test/functional/data/rpc_getblockstats.json",
        "status": "modified",
        "additions": 10,
        "deletions": 4,
        "changes": 14,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/787f977afbbd2480a48664db6ef89d14bc5c4485/test/functional/data/rpc_getblockstats.json",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/787f977afbbd2480a48664db6ef89d14bc5c4485/test/functional/data/rpc_getblockstats.json",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/data/rpc_getblockstats.json?ref=787f977afbbd2480a48664db6ef89d14bc5c4485",
        "patch": "@@ -142,7 +142,9 @@\n       \"totalfee\": 0,\n       \"txs\": 1,\n       \"utxo_increase\": 2,\n-      \"utxo_size_inc\": 163\n+      \"utxo_increase_actual\": 1,\n+      \"utxo_size_inc\": 163,\n+      \"utxo_size_inc_actual\": 75\n     },\n     {\n       \"avgfee\": 4460,\n@@ -179,7 +181,9 @@\n       \"totalfee\": 4460,\n       \"txs\": 2,\n       \"utxo_increase\": 3,\n-      \"utxo_size_inc\": 236\n+      \"utxo_increase_actual\": 2,\n+      \"utxo_size_inc\": 236,\n+      \"utxo_size_inc_actual\": 148\n     },\n     {\n       \"avgfee\": 24906,\n@@ -216,7 +220,9 @@\n       \"totalfee\": 74720,\n       \"txs\": 4,\n       \"utxo_increase\": 5,\n-      \"utxo_size_inc\": 384\n+      \"utxo_size_inc\": 384,\n+      \"utxo_increase_actual\": 4,\n+      \"utxo_size_inc_actual\": 296\n     }\n   ]\n-}\n\\ No newline at end of file\n+}"
      },
      {
        "sha": "bad2c492a41ff5fa72c9ed50a9659c4438aaae2d",
        "filename": "test/functional/rpc_getblockstats.py",
        "status": "modified",
        "additions": 8,
        "deletions": 0,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/787f977afbbd2480a48664db6ef89d14bc5c4485/test/functional/rpc_getblockstats.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/787f977afbbd2480a48664db6ef89d14bc5c4485/test/functional/rpc_getblockstats.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/rpc_getblockstats.py?ref=787f977afbbd2480a48664db6ef89d14bc5c4485",
        "patch": "@@ -162,6 +162,14 @@ def run_test(self):\n         assert_raises_rpc_error(-1, 'getblockstats hash_or_height ( stats )', self.nodes[0].getblockstats, '00', 1, 2)\n         assert_raises_rpc_error(-1, 'getblockstats hash_or_height ( stats )', self.nodes[0].getblockstats)\n \n+        self.log.info('Test block height 0')\n+        genesis_stats = self.nodes[0].getblockstats(0)\n+        assert_equal(genesis_stats[\"blockhash\"], \"0f9188f13cb7b2c71f2a335e3a4fc328bf5beb436012afca590b1a11466e2206\")\n+        assert_equal(genesis_stats[\"utxo_increase\"], 1)\n+        assert_equal(genesis_stats[\"utxo_size_inc\"], 117)\n+        assert_equal(genesis_stats[\"utxo_increase_actual\"], 0)\n+        assert_equal(genesis_stats[\"utxo_size_inc_actual\"], 0)\n+\n \n if __name__ == '__main__':\n     GetblockstatsTest().main()"
      }
    ]
  },
  {
    "sha": "eacc8b8121db16313ec1b3457aa6bfba7efa85c0",
    "node_id": "C_kwDOABII59oAKGVhY2M4YjgxMjFkYjE2MzEzZWMxYjM0NTdhYTZiZmJhN2VmYTg1YzA",
    "commit": {
      "author": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2021-04-11T17:52:10Z"
      },
      "committer": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2021-09-23T23:19:10Z"
      },
      "message": "test: Fix getblockstats test data generator",
      "tree": {
        "sha": "8d41f151ae5cce2a92fbf5f90f5a9d3ea60c0189",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8d41f151ae5cce2a92fbf5f90f5a9d3ea60c0189"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/eacc8b8121db16313ec1b3457aa6bfba7efa85c0",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\nComment: GPGTools - https://gpgtools.org\n\niQJJBAABCgAzFiEEtFq20ghhrCHSdrgm8T0enYkHmM0FAmFNC24VHGZqYWhyQHBy\nb3Rvbm1haWwuY29tAAoJEPE9Hp2JB5jNQpYP/ieos1RNKUaS2zsfgO+HuHwhlWLL\nKhx+PH4LBydbLNDSUs7lz8isX/sRfqTR+SpCziQjAsEIL3O7Rnn0+aQq8A15RP4E\nP5M1AlTkX0/tXxBUc5pfX00pLEQ+vrlngVx3B97ETQ9ZF1mqBHcrkjYyCiE6b9FS\nzl8iK3YTksBlyEuFNfIP0z4y28seNgOQC8pY3kpEYYt5jnOO+j4oouS1+6oUCUf+\n4XprPP70EqF8BsuMbEc5EJ18YGbHWQkeY2eWy5qxZzO3gJmCkXv4xe6BsU8IRfgo\n6vg+i2TJuw9oxzKdbuZ4aovxLYtirixasHnhEKUO8koJ2hLV38Sot2Rvzwqsttde\n91bKJRydHDPH1HhAUV1j5xZApAXnuYH2rH5/JpXJnaZRGg1ZL9ceMKp3rh6y1FCj\nN4ocvRLoX+4cv3oLRszVjJ7lZ5gxsXW9gSz2XMnHP+xtf60681ID/+pFmu3epvHE\nT+ZG+av0OaQVAGFf9c7eB0pvaBGz+ZXeIYptMHqMU1c4Fd3oTCTAywPbketaKFsP\nFF+Th4/4Ug5wmkS9cU+g07RaLhpesAFwacUcnFAML4C3Ow/weeJwBx1DD2FK0Fza\n5MS41q+feGrxlm46rdHAWVRaJwHaB/PnipHbGBcwDelMURCQKiwwIOuRgcJxTg5r\nrZHUicU9VMxwb5dH\n=4gqV\n-----END PGP SIGNATURE-----",
        "payload": "tree 8d41f151ae5cce2a92fbf5f90f5a9d3ea60c0189\nparent 787f977afbbd2480a48664db6ef89d14bc5c4485\nauthor Fabian Jahr <fjahr@protonmail.com> 1618163530 +0200\ncommitter Fabian Jahr <fjahr@protonmail.com> 1632439150 +0200\n\ntest: Fix getblockstats test data generator\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/eacc8b8121db16313ec1b3457aa6bfba7efa85c0",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/eacc8b8121db16313ec1b3457aa6bfba7efa85c0",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/eacc8b8121db16313ec1b3457aa6bfba7efa85c0/comments",
    "author": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjahr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjahr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "787f977afbbd2480a48664db6ef89d14bc5c4485",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/787f977afbbd2480a48664db6ef89d14bc5c4485",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/787f977afbbd2480a48664db6ef89d14bc5c4485"
      }
    ],
    "stats": {
      "total": 4,
      "additions": 4,
      "deletions": 0
    },
    "files": [
      {
        "sha": "f99d3c484706a41b242ab47d1360183c607d136e",
        "filename": "test/functional/rpc_getblockstats.py",
        "status": "modified",
        "additions": 4,
        "deletions": 0,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/eacc8b8121db16313ec1b3457aa6bfba7efa85c0/test/functional/rpc_getblockstats.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/eacc8b8121db16313ec1b3457aa6bfba7efa85c0/test/functional/rpc_getblockstats.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/rpc_getblockstats.py?ref=eacc8b8121db16313ec1b3457aa6bfba7efa85c0",
        "patch": "@@ -43,6 +43,10 @@ def get_stats(self):\n     def generate_test_data(self, filename):\n         mocktime = 1525107225\n         self.nodes[0].setmocktime(mocktime)\n+        self.nodes[0].createwallet(wallet_name='test')\n+        privkey = self.nodes[0].get_deterministic_priv_key().key\n+        self.nodes[0].importprivkey(privkey)\n+\n         self.generate(self.nodes[0], COINBASE_MATURITY + 1)\n \n         address = self.nodes[0].get_deterministic_priv_key().address"
      }
    ]
  },
  {
    "sha": "ca2c2d6a824f08ce46fc5347df025c1393d4781c",
    "node_id": "C_kwDOABII59oAKGNhMmMyZDZhODI0ZjA4Y2U0NmZjNTM0N2RmMDI1YzEzOTNkNDc4MWM",
    "commit": {
      "author": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2021-04-11T18:46:25Z"
      },
      "committer": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2021-09-23T23:19:10Z"
      },
      "message": "test: Test exclusion of OP_RETURN from getblockstats",
      "tree": {
        "sha": "4479b667fae8448cc407311aa16d1397bd3001c8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4479b667fae8448cc407311aa16d1397bd3001c8"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ca2c2d6a824f08ce46fc5347df025c1393d4781c",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\nComment: GPGTools - https://gpgtools.org\n\niQJJBAABCgAzFiEEtFq20ghhrCHSdrgm8T0enYkHmM0FAmFNC24VHGZqYWhyQHBy\nb3Rvbm1haWwuY29tAAoJEPE9Hp2JB5jNG00QAIc5Fe/aUJ1ZUsxZ6kBa/UoyVqr9\n2MpoDjie4ZaJHvLmIvA7+/DpGyImtRF/eM4vutNIYXPmPWIse/2Thze2lig1Gf7k\nCB7fBaF9OM8w7vsa+98HwA8DMuuYzmc7YW2cXyALOo6M79DNOkDjsFFM8lUBHQpC\nV/q3lkBvvx6UjL3Smd0tdQPTvjCt4guqXD52lkYWTIrvSESauLGNbayVazzi2xyv\nZgQ7hFs891ZlLWmcwFErr60nXU7LhMIgc8XWrPfHJ2zhPoJPwM3zkBoYVujmcqFJ\nS3p2P1h9ZXolvuRY32ELncnOn0SkdJExLE1AQRe4bgmr13E4jgXjXXN3+zTiDhl0\nxUVvSu+ZMzlwWuCVK8Tr+g7mNY8EIWSj/7ghT89QubdTe97bFtVkzNWSDSg9Pcin\nzmJXcM9mOZ2Qx9wOotrRnowRNMM2bwB3lz3YkhEJNawlYr1BPgFx1XVvKRrYYAgu\nQAqAKRTB8Ku2lHxre/vhrRLABZIGse3496MoJfuzSyZcUO+wuRZxRcpjuUwHqXei\n7KnmVGXGcvxqGC2bzxqtAlq9yMJOlYab3JxKh5WAP5fiKDmeNxTlOuompITG08AG\nlJ2ei0D3N2DwCXRV8FFXME5lnP/yllmCozep0ugnvLxHecjnt3+8VHOjt//wyMxi\nIH3e3ArK+auWMCcI\n=HuMb\n-----END PGP SIGNATURE-----",
        "payload": "tree 4479b667fae8448cc407311aa16d1397bd3001c8\nparent eacc8b8121db16313ec1b3457aa6bfba7efa85c0\nauthor Fabian Jahr <fjahr@protonmail.com> 1618166785 +0200\ncommitter Fabian Jahr <fjahr@protonmail.com> 1632439150 +0200\n\ntest: Test exclusion of OP_RETURN from getblockstats\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ca2c2d6a824f08ce46fc5347df025c1393d4781c",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/ca2c2d6a824f08ce46fc5347df025c1393d4781c",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ca2c2d6a824f08ce46fc5347df025c1393d4781c/comments",
    "author": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjahr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjahr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "eacc8b8121db16313ec1b3457aa6bfba7efa85c0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/eacc8b8121db16313ec1b3457aa6bfba7efa85c0",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/eacc8b8121db16313ec1b3457aa6bfba7efa85c0"
      }
    ],
    "stats": {
      "total": 96,
      "additions": 52,
      "deletions": 44
    },
    "files": [
      {
        "sha": "7d7460aacc8ce181f9c71f935d3f85ea4c8746ba",
        "filename": "test/functional/data/rpc_getblockstats.json",
        "status": "modified",
        "additions": 44,
        "deletions": 44,
        "changes": 88,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/ca2c2d6a824f08ce46fc5347df025c1393d4781c/test/functional/data/rpc_getblockstats.json",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/ca2c2d6a824f08ce46fc5347df025c1393d4781c/test/functional/data/rpc_getblockstats.json",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/data/rpc_getblockstats.json?ref=ca2c2d6a824f08ce46fc5347df025c1393d4781c",
        "patch": "@@ -102,8 +102,8 @@\n     \"00000020f44e7a48b9f221af95f3295c8dcefc5358934a68dc79e2933dc0794b350cad0a90fad2cd50b41d4ef45e76c2a456b98c180632bb4b44e0cd18ce90679fe54e552b4ae75affff7f200000000001020000000001010000000000000000000000000000000000000000000000000000000000000000ffffffff0401630101ffffffff0200f2052a010000001976a9142b4569203694fc997e13f2c0a1383b9e16c77a0d88ac0000000000000000266a24aa21a9ede2f61c3f71d1defd3fa999dfa36953755c690689799962b48bebd836974e8cf90120000000000000000000000000000000000000000000000000000000000000000000000000\",\n     \"0000002087454276cce83f4d19e0120f6e9728ac5905f7adaf6b27e3f5bbe43ab823f85db7d1f44666531483df3d67c15f2c231718ad93b63b851dce5ff4c4a67f524ffa2b4ae75affff7f200100000001020000000001010000000000000000000000000000000000000000000000000000000000000000ffffffff0401640101ffffffff0200f2052a010000001976a9142b4569203694fc997e13f2c0a1383b9e16c77a0d88ac0000000000000000266a24aa21a9ede2f61c3f71d1defd3fa999dfa36953755c690689799962b48bebd836974e8cf90120000000000000000000000000000000000000000000000000000000000000000000000000\",\n     \"000000202cdc3e99f07a80252dd6097faa0eddf3f2dde5ae390610e0bca94ecc25931551d31fceb8fe0a682f6017ca3dbb582f3a2f06e5d99ec99c42c8a744dd4c9216b82b4ae75affff7f200300000001020000000001010000000000000000000000000000000000000000000000000000000000000000ffffffff0401650101ffffffff0200f2052a010000001976a9142b4569203694fc997e13f2c0a1383b9e16c77a0d88ac0000000000000000266a24aa21a9ede2f61c3f71d1defd3fa999dfa36953755c690689799962b48bebd836974e8cf90120000000000000000000000000000000000000000000000000000000000000000000000000\",\n-    \"000000209b3ace9bd510918d20e87518c0cf5976cab3e28cc7af41259a89c6dd7668a32922808b8a082be71bcd6152cb8fd223650b5579a41344ba749e4d17b9bf211a9e2b4ae75affff7f200000000002020000000001010000000000000000000000000000000000000000000000000000000000000000ffffffff0401660101ffffffff026c03062a010000001976a9142b4569203694fc997e13f2c0a1383b9e16c77a0d88ac0000000000000000266a24aa21a9edb85d8f3c122c43a72f1e0dd122c8f7af040aa0b0a46001621110fb37818021510120000000000000000000000000000000000000000000000000000000000000000000000000020000000128394022bf44bff30d7399cb5a16e3b94fed67dc174c2e1d77df91bad5a51cb3000000006a47304402201c16d06a5c4353168b3881071aea7d1eb4d88eedfea53a9d6af9abb56da9060002205abf3ae535f1f1b5cfe8ba955535c2b20ac003e7d7720c5b7d2640ac2a04d19001210227d85ba011276cf25b51df6a188b75e604b38770a462b2d0e9fb2fc839ef5d3ffeffffff0294b89a3b000000001976a9142b4569203694fc997e13f2c0a1383b9e16c77a0d88ac00286bee0000000017a91452bab4f229415d0dc5c6d30b162f93a1a0cac5958765000000\",\n-    \"000000200fa168b50a79ad24378a6b0f96e4c9f4ccb657a2663320d5fc1efd8ee7caa10ab42a31c444f2153387530a0979d4dc3dcc134b394c821227b8abff930c03c8412b4ae75affff7f200200000004020000000001010000000000000000000000000000000000000000000000000000000000000000ffffffff0401670101ffffffff02e015072a010000001976a9142b4569203694fc997e13f2c0a1383b9e16c77a0d88ac0000000000000000266a24aa21a9ed20376d4bc90f9c689850eec3603cda658ba6295241730473ceb0e970b8d594150120000000000000000000000000000000000000000000000000000000000000000000000000020000000191e549a6cc852bbf1d3f11144b1a34079f64305e6971d2e685d2b40cd386e8a6000000006a47304402200bf62021c0a9a47ced8eba1e0998f5c71b2950763198d83ad284bd791241dbb00220446a05b7c35e7458924de88a8dcccab1ec6a106aa005345e55b482d8eb66337301210227d85ba011276cf25b51df6a188b75e604b38770a462b2d0e9fb2fc839ef5d3ffeffffff02acdbf405000000001976a9142b4569203694fc997e13f2c0a1383b9e16c77a0d88ac94d7a4350000000017a914dfa6f0b17d2c64962c94203e744a9d4179ed22c18766000000020000000112d2f07672102dc6f099c4be308f598e4c4da1a7e0cb462ae14f0444525a1332000000006a47304402200a6a2f544f3f9d299608a7c745e2326de176fb1cac03ae3e74943f4250b8896e02205023a5b4faff99865bf91f1263605a502c723628be9240c0b7bec81d2ed106f101210227d85ba011276cf25b51df6a188b75e604b38770a462b2d0e9fb2fc839ef5d3ffeffffff0200ca9a3b000000001976a9142b4569203694fc997e13f2c0a1383b9e16c77a0d88ac94166bee0000000017a914152cc82f7944f5c416de7dbffb052f7081765d7987660000000200000000010191e549a6cc852bbf1d3f11144b1a34079f64305e6971d2e685d2b40cd386e8a601000000171600147cc872ad7350c37fecab9c4c6d9f08aceb53bdb8feffffff02005ed0b20000000017a914aab1c8c53fe62e283a53efa28097709f4f2ed37b87e0bc9a3b000000001976a9142b4569203694fc997e13f2c0a1383b9e16c77a0d88ac0247304402201b4476f238ed5d515bfcd6927d0d008a4993770763eca73e3ee66f69971831d902200f5215a6dfd90391dd63462cfdf69804fe31224c309ec9c38d33a04dce71c0ee0121028c9d2955a95301b699db62e97d54bf0a91feb44e5cd94bbf5b62f1df57fb643966000000\"\n+    \"000000209b3ace9bd510918d20e87518c0cf5976cab3e28cc7af41259a89c6dd7668a329f03ef4716ad5d88bccfd71088bf2ec3eb5b32e0ff60f35f9becd73052bfa8af12b4ae75affff7f200000000002020000000001010000000000000000000000000000000000000000000000000000000000000000ffffffff0401660101ffffffff025803062a010000001976a9142b4569203694fc997e13f2c0a1383b9e16c77a0d88ac0000000000000000266a24aa21a9edb11910e4e0ee6ee6d6bad42736999d1eba649243dc781438e5ef845c7227aaad0120000000000000000000000000000000000000000000000000000000000000000000000000020000000128394022bf44bff30d7399cb5a16e3b94fed67dc174c2e1d77df91bad5a51cb3000000006a47304402200650c6c50bd4952ca13b7aa37d458a36628434bbb968701063cdd36d0725e36c02202e059ccf7a4a049de028c4f140e543baa7e69ea3663e3d1fdfbc8ba7247e82f901210227d85ba011276cf25b51df6a188b75e604b38770a462b2d0e9fb2fc839ef5d3ffeffffff02a8b89a3b000000001976a9142b4569203694fc997e13f2c0a1383b9e16c77a0d88ac00286bee0000000016001423838e991caedd69289d9dac88ca423cca683a2265000000\",\n+    \"0000002061597bf3305ee2334b5d7fec136c2064b69d14955b50cd0b81f49ac33d88e506d80731ce60c2f275d29539a4d04c7e8c72aa4ade3c9baec24881a581fc524c6a2b4ae75affff7f200000000005020000000001010000000000000000000000000000000000000000000000000000000000000000ffffffff0401670101ffffffff023840072a010000001976a9142b4569203694fc997e13f2c0a1383b9e16c77a0d88ac0000000000000000266a24aa21a9ed89a3c65f40921b14168368cf4775a710ad17b613cedcff001f1f1ca3c863cc11012000000000000000000000000000000000000000000000000000000000000000000000000002000000000101bb475ac72ba1a45a96be584a689d6d0ace820d9587b0db53dc40a15555b9be770100000000feffffff02c0be9a3b000000001976a9142b4569203694fc997e13f2c0a1383b9e16c77a0d88ac005ed0b200000000160014a57f6871c70569e0543322614c5c85438b796a900247304402207893b5466cdbf9cdedcc73fb8e10e01c4dd9aac4345031ef0c35d91e82ff5fd602207f0e1d7e4270a532060fd1e6ad7881d18acb173fd4fd1d61f3c8ff6707bdb972012103bb4c79ca594b19bbec7ee6302af0ef4191345fa7f03a30ed4e042aeed680924b6600000002000000000101e6a996cbac10b2d6b2bb2796a4ebf639ee21b136e06c7d8c6bc62b7cb4a311870100000000feffffff0200ca9a3b000000001976a9142b4569203694fc997e13f2c0a1383b9e16c77a0d88acc088357700000000160014c48ea35298422796eb75ee9a04ebada66780083902473044022062963ff9f1f0d2c885060c083b97ddd67bd6e8a7daaed6578a62c1f905fd31a6022001836efe75bbce64d29700f5568aed78ce68f098ef0b8efdad0679e2f6c0ceb5012102228c4d459ce647b63b2681597a6e8391e4b5afab147f90747184a0893e4934c26600000002000000000101c654a35d86b4c3112ae9ec75e3bc271e0b8f928620386fdaf9517e8a9b511d850100000000feffffff024038f505000000001976a9142b4569203694fc997e13f2c0a1383b9e16c77a0d88acc0a73f7100000000160014cb1049e20cebfe756d657af0d47a3357c1db3c9702473044022024728eb27e884d08b2b95e670fd58c0e10106a18bc9e01f753f9ae474aa2c95e02201d5abe91302b373507dce1fd2f4b95ddc36e21d23eda6c476cc9efea80338ef90121036be02fd68622ce6740f0d028059af96a310c23c675f044732171df6f64f0fcb2660000000200000000010135c4ee1a780d8279ea7c79d3ad6fbb39315a13e6b51dd51f49db6e2f4796bada0100000000feffffff020000000000000000036a0121c8183f71000000001600147ea4d830ca77c20a23155a176a1472613dc4e7840247304402202db3527431e09ca8034d207134d79fc063939bd402286dd8b3872de3b2a746b402207faae5fb8838e6877822a9209fe2e81d4be4a69ce8164215e03f9b92d75e94f90121024d456d37df6f3436ee1685b78d90d2d24c4dd8c602d5f41405fe7f449b43415f00000000\"\n   ],\n   \"mocktime\": 1525107225,\n   \"stats\": [\n@@ -147,10 +147,10 @@\n       \"utxo_size_inc_actual\": 75\n     },\n     {\n-      \"avgfee\": 4460,\n+      \"avgfee\": 4440,\n       \"avgfeerate\": 20,\n-      \"avgtxsize\": 223,\n-      \"blockhash\": \"0aa1cae78efd1efcd5203366a257b6ccf4c9e4960f6b8a3724ad790ab568a10f\",\n+      \"avgtxsize\": 222,\n+      \"blockhash\": \"06e5883dc39af4810bcd505b95149db664206c13ec7f5d4b33e25e30f37b5961\",\n       \"feerate_percentiles\": [\n         20,\n         20,\n@@ -160,69 +160,69 @@\n       ],\n       \"height\": 102,\n       \"ins\": 1,\n-      \"maxfee\": 4460,\n+      \"maxfee\": 4440,\n       \"maxfeerate\": 20,\n-      \"maxtxsize\": 223,\n-      \"medianfee\": 4460,\n+      \"maxtxsize\": 222,\n+      \"medianfee\": 4440,\n       \"mediantime\": 1525107242,\n-      \"mediantxsize\": 223,\n-      \"minfee\": 4460,\n+      \"mediantxsize\": 222,\n+      \"minfee\": 4440,\n       \"minfeerate\": 20,\n-      \"mintxsize\": 223,\n+      \"mintxsize\": 222,\n       \"outs\": 4,\n       \"subsidy\": 5000000000,\n       \"swtotal_size\": 0,\n       \"swtotal_weight\": 0,\n       \"swtxs\": 0,\n       \"time\": 1525107243,\n-      \"total_out\": 4999995540,\n-      \"total_size\": 223,\n-      \"total_weight\": 892,\n-      \"totalfee\": 4460,\n+      \"total_out\": 4999995560,\n+      \"total_size\": 222,\n+      \"total_weight\": 888,\n+      \"totalfee\": 4440,\n       \"txs\": 2,\n       \"utxo_increase\": 3,\n       \"utxo_increase_actual\": 2,\n-      \"utxo_size_inc\": 236,\n-      \"utxo_size_inc_actual\": 148\n+      \"utxo_size_inc\": 235,\n+      \"utxo_size_inc_actual\": 147\n     },\n     {\n-      \"avgfee\": 24906,\n-      \"avgfeerate\": 121,\n-      \"avgtxsize\": 231,\n-      \"blockhash\": \"53e416e2538bc783c42a7aea566e884321afed893e9e58cf356d6429759dfa46\",\n+      \"avgfee\": 21390,\n+      \"avgfeerate\": 155,\n+      \"avgtxsize\": 219,\n+      \"blockhash\": \"7474991c2ae3c94c4813d75b4c752028304b773dd4dce8d460dfa2d1e7b542a3\",\n       \"feerate_percentiles\": [\n         20,\n         20,\n         20,\n-        300,\n-        300\n+        301,\n+        301\n       ],\n       \"height\": 103,\n-      \"ins\": 3,\n-      \"maxfee\": 66900,\n-      \"maxfeerate\": 300,\n-      \"maxtxsize\": 249,\n-      \"medianfee\": 4460,\n+      \"ins\": 4,\n+      \"maxfee\": 43200,\n+      \"maxfeerate\": 301,\n+      \"maxtxsize\": 225,\n+      \"medianfee\": 19740,\n       \"mediantime\": 1525107243,\n-      \"mediantxsize\": 223,\n-      \"minfee\": 3360,\n+      \"mediantxsize\": 225,\n+      \"minfee\": 2880,\n       \"minfeerate\": 20,\n-      \"mintxsize\": 223,\n-      \"outs\": 8,\n+      \"mintxsize\": 203,\n+      \"outs\": 10,\n       \"subsidy\": 5000000000,\n-      \"swtotal_size\": 249,\n-      \"swtotal_weight\": 669,\n-      \"swtxs\": 1,\n+      \"swtotal_size\": 878,\n+      \"swtotal_weight\": 2204,\n+      \"swtxs\": 4,\n       \"time\": 1525107243,\n-      \"total_out\": 9999920820,\n-      \"total_size\": 695,\n-      \"total_weight\": 2453,\n-      \"totalfee\": 74720,\n-      \"txs\": 4,\n-      \"utxo_increase\": 5,\n-      \"utxo_size_inc\": 384,\n+      \"total_out\": 10899908680,\n+      \"total_size\": 878,\n+      \"total_weight\": 2204,\n+      \"totalfee\": 85560,\n+      \"txs\": 5,\n+      \"utxo_increase\": 6,\n       \"utxo_increase_actual\": 4,\n-      \"utxo_size_inc_actual\": 296\n+      \"utxo_size_inc\": 441,\n+      \"utxo_size_inc_actual\": 300\n     }\n   ]\n-}\n+}\n\\ No newline at end of file"
      },
      {
        "sha": "0479281bb0297da84c1f0c562ebfd4ae9d913340",
        "filename": "test/functional/rpc_getblockstats.py",
        "status": "modified",
        "additions": 8,
        "deletions": 0,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/ca2c2d6a824f08ce46fc5347df025c1393d4781c/test/functional/rpc_getblockstats.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/ca2c2d6a824f08ce46fc5347df025c1393d4781c/test/functional/rpc_getblockstats.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/rpc_getblockstats.py?ref=ca2c2d6a824f08ce46fc5347df025c1393d4781c",
        "patch": "@@ -58,6 +58,8 @@ def generate_test_data(self, filename):\n         self.nodes[0].sendtoaddress(address=address, amount=10, subtractfeefromamount=False)\n         self.nodes[0].settxfee(amount=0.003)\n         self.nodes[0].sendtoaddress(address=address, amount=1, subtractfeefromamount=True)\n+        # Send to OP_RETURN output to test its exclusion from statistics\n+        self.nodes[0].send(outputs={\"data\": \"21\"})\n         self.sync_all()\n         self.generate(self.nodes[0], 1)\n \n@@ -174,6 +176,12 @@ def run_test(self):\n         assert_equal(genesis_stats[\"utxo_increase_actual\"], 0)\n         assert_equal(genesis_stats[\"utxo_size_inc_actual\"], 0)\n \n+        self.log.info('Test tip including OP_RETURN')\n+        tip_stats = self.nodes[0].getblockstats(tip)\n+        assert_equal(tip_stats[\"utxo_increase\"], 6)\n+        assert_equal(tip_stats[\"utxo_size_inc\"], 441)\n+        assert_equal(tip_stats[\"utxo_increase_actual\"], 4)\n+        assert_equal(tip_stats[\"utxo_size_inc_actual\"], 300)\n \n if __name__ == '__main__':\n     GetblockstatsTest().main()"
      }
    ]
  },
  {
    "sha": "6cd78060c8ea46ed118f568b508fb77fdc3be45b",
    "node_id": "C_kwDOABII59oAKDZjZDc4MDYwYzhlYTQ2ZWQxMThmNTY4YjUwOGZiNzdmZGMzYmU0NWI",
    "commit": {
      "author": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2021-08-24T20:34:43Z"
      },
      "committer": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2021-09-23T23:19:11Z"
      },
      "message": "index: Deduplicate BIP30 block identification in coinstatsindex",
      "tree": {
        "sha": "2f4c8da09e3a9314f76f393d23721580fb01cf2d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2f4c8da09e3a9314f76f393d23721580fb01cf2d"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6cd78060c8ea46ed118f568b508fb77fdc3be45b",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\nComment: GPGTools - https://gpgtools.org\n\niQJJBAABCgAzFiEEtFq20ghhrCHSdrgm8T0enYkHmM0FAmFNC28VHGZqYWhyQHBy\nb3Rvbm1haWwuY29tAAoJEPE9Hp2JB5jN9pMQAIle8adPOccyhcidMdrkZ4tYZE/Q\ngturLgx7vc/nyaUAQhnpuG5MgAVjj3Dt14z5pWBAOWnUWG8bN2yhCB4ZPcfTK14g\nH3KK9NahPBndM6CVzdTPifldkM4RKdL6S/Et8e/hHWCg88qZqF1pY0jLmkdLRhwX\nBCqyjsyUdyddhI5YL/szdYDNJ9OnaQJ+dtLH5tYxxrmtEjeLxi3HeFiFtHdLuvWj\nf0oQ8St0B7t5NzdkFD4KV2VQnaK4i9MDjZKbPzCvVSxn1HAQvDM89+eqNoMxJ71o\n0chHGTpPeSpoD7GZVixdR9NtSFrdTNtzdj5rpF+yKUHqI8dSlIFQ4QtfD1fzQG+6\nVq8n50BsBQJ+trMu8+arGYoeiG50eFlWDRluPVqwPkIy2SUDJhjqgbADmIyZOGyk\nmuTjI32bKCYzHnO36h7Sfs0VWw0YmyAb60Tg3bHxh7Wq+LVUXV3OmtngE5p2IHdm\nWVPJ3H5FhD/HVywDjzwTY/vhkueh0Ook/gGXK2/rRttIaYmXED4/lK1HXAHiTu2r\njKhp+fi5ZEacA8YNP1ifHO5KWnW3VkOcq24EpzgPX4QfO1L5skynD8ZJoO5bsbwe\nyvEOl6SSu53obKt7Fk8ZkNBQohm8pNmfV4h8l1+FwOkMe7Rnk8DBEyXkeXoPkRc9\npjY1wUgFa8G0oyW/\n=geNc\n-----END PGP SIGNATURE-----",
        "payload": "tree 2f4c8da09e3a9314f76f393d23721580fb01cf2d\nparent ca2c2d6a824f08ce46fc5347df025c1393d4781c\nauthor Fabian Jahr <fjahr@protonmail.com> 1629837283 +0200\ncommitter Fabian Jahr <fjahr@protonmail.com> 1632439151 +0200\n\nindex: Deduplicate BIP30 block identification in coinstatsindex\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6cd78060c8ea46ed118f568b508fb77fdc3be45b",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/6cd78060c8ea46ed118f568b508fb77fdc3be45b",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6cd78060c8ea46ed118f568b508fb77fdc3be45b/comments",
    "author": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjahr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjahr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "ca2c2d6a824f08ce46fc5347df025c1393d4781c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ca2c2d6a824f08ce46fc5347df025c1393d4781c",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/ca2c2d6a824f08ce46fc5347df025c1393d4781c"
      }
    ],
    "stats": {
      "total": 6,
      "additions": 1,
      "deletions": 5
    },
    "files": [
      {
        "sha": "1f0db0a9a89a0b2bc5a7e0aa0b3774ce266add96",
        "filename": "src/index/coinstatsindex.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 5,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6cd78060c8ea46ed118f568b508fb77fdc3be45b/src/index/coinstatsindex.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6cd78060c8ea46ed118f568b508fb77fdc3be45b/src/index/coinstatsindex.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/index/coinstatsindex.cpp?ref=6cd78060c8ea46ed118f568b508fb77fdc3be45b",
        "patch": "@@ -131,16 +131,12 @@ bool CoinStatsIndex::WriteBlock(const CBlock& block, const CBlockIndex* pindex)\n             }\n         }\n \n-        // TODO: Deduplicate BIP30 related code\n-        bool is_bip30_block{(pindex->nHeight == 91722 && pindex->GetBlockHash() == uint256S(\"0x00000000000271a2dc26e7667f8419f2e15416dc6955e5a6c6cdf3f2574dd08e\")) ||\n-                            (pindex->nHeight == 91812 && pindex->GetBlockHash() == uint256S(\"0x00000000000af0aed4792b1acee3d966af36cf5def14935db8de83d6f9306f2f\"))};\n-\n         // Add the new utxos created from the block\n         for (size_t i = 0; i < block.vtx.size(); ++i) {\n             const auto& tx{block.vtx.at(i)};\n \n             // Skip duplicate txid coinbase transactions (BIP30).\n-            if (is_bip30_block && tx->IsCoinBase()) {\n+            if (IsBIP30Unspendable(*pindex) && tx->IsCoinBase()) {\n                 m_total_unspendable_amount += block_subsidy;\n                 m_total_unspendables_bip30 += block_subsidy;\n                 continue;"
      }
    ]
  }
]