[
  {
    "sha": "9d933ef9191417b4b7d29eaa3c3a571f814acc8e",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5ZDkzM2VmOTE5MTQxN2I0YjdkMjllYWEzYzNhNTcxZjgxNGFjYzhl",
    "commit": {
      "author": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2019-12-10T07:05:21Z"
      },
      "committer": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2019-12-10T08:11:40Z"
      },
      "message": "prevector: avoid misaligned member accesses\n\n`#pragma pack(1)` prevents aligning the struct and its members to their\nrequired alignment. This can result in code that performs non-aligned\nreads and writes to integers and pointers, which is problematic on some\narchitectures.\n\nIt also triggers UBsan \u2014 see\n  https://github.com/bitcoin/bitcoin/pull/17156#issuecomment-543123631\nand #17510.",
      "tree": {
        "sha": "fb291f4f400f52ba1107a345e015188d184d8e1b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/fb291f4f400f52ba1107a345e015188d184d8e1b"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9d933ef9191417b4b7d29eaa3c3a571f814acc8e",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9d933ef9191417b4b7d29eaa3c3a571f814acc8e",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/9d933ef9191417b4b7d29eaa3c3a571f814acc8e",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9d933ef9191417b4b7d29eaa3c3a571f814acc8e/comments",
    "author": {
      "login": "ajtowns",
      "id": 127186,
      "node_id": "MDQ6VXNlcjEyNzE4Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajtowns",
      "html_url": "https://github.com/ajtowns",
      "followers_url": "https://api.github.com/users/ajtowns/followers",
      "following_url": "https://api.github.com/users/ajtowns/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajtowns/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
      "organizations_url": "https://api.github.com/users/ajtowns/orgs",
      "repos_url": "https://api.github.com/users/ajtowns/repos",
      "events_url": "https://api.github.com/users/ajtowns/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajtowns/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "ajtowns",
      "id": 127186,
      "node_id": "MDQ6VXNlcjEyNzE4Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajtowns",
      "html_url": "https://github.com/ajtowns",
      "followers_url": "https://api.github.com/users/ajtowns/followers",
      "following_url": "https://api.github.com/users/ajtowns/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajtowns/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
      "organizations_url": "https://api.github.com/users/ajtowns/orgs",
      "repos_url": "https://api.github.com/users/ajtowns/repos",
      "events_url": "https://api.github.com/users/ajtowns/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajtowns/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "1189b6acab115a7fe7bd67f8b4c6e3f55e53274e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1189b6acab115a7fe7bd67f8b4c6e3f55e53274e",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/1189b6acab115a7fe7bd67f8b4c6e3f55e53274e"
      }
    ],
    "stats": {
      "total": 14,
      "additions": 9,
      "deletions": 5
    },
    "files": [
      {
        "sha": "f2a0c3e05b5a1e4ff9d89b2ff07e7b3b577d88c0",
        "filename": "src/prevector.h",
        "status": "modified",
        "additions": 9,
        "deletions": 5,
        "changes": 14,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9d933ef9191417b4b7d29eaa3c3a571f814acc8e/src/prevector.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9d933ef9191417b4b7d29eaa3c3a571f814acc8e/src/prevector.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/prevector.h?ref=9d933ef9191417b4b7d29eaa3c3a571f814acc8e",
        "patch": "@@ -15,7 +15,6 @@\n #include <type_traits>\n #include <utility>\n \n-#pragma pack(push, 1)\n /** Implements a drop-in replacement for std::vector<T> which stores up to N\n  *  elements directly (without heap allocation). The types Size and Diff are\n  *  used to store element counts, and can be any unsigned + signed type.\n@@ -147,14 +146,20 @@ class prevector {\n     };\n \n private:\n-    size_type _size = 0;\n+#pragma pack(push, 1)\n     union direct_or_indirect {\n         char direct[sizeof(T) * N];\n         struct {\n-            size_type capacity;\n             char* indirect;\n+            size_type capacity;\n         };\n-    } _union = {};\n+    };\n+#pragma pack(pop)\n+    alignas(char*) direct_or_indirect _union = {};\n+    size_type _size = 0;\n+\n+    static_assert(alignof(char*) % alignof(size_type) == 0 && sizeof(char*) % alignof(size_type) == 0, \"size_type cannot have more restrictive alignment requirement than pointer\");\n+    static_assert(alignof(char*) % alignof(T) == 0, \"value_type T cannot have more restrictive alignment requirement than pointer\");\n \n     T* direct_ptr(difference_type pos) { return reinterpret_cast<T*>(_union.direct) + pos; }\n     const T* direct_ptr(difference_type pos) const { return reinterpret_cast<const T*>(_union.direct) + pos; }\n@@ -523,6 +528,5 @@ class prevector {\n         return item_ptr(0);\n     }\n };\n-#pragma pack(pop)\n \n #endif // BITCOIN_PREVECTOR_H"
      }
    ]
  },
  {
    "sha": "5f26855f109af53a336d5f98ed0ae584e7a31f84",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1ZjI2ODU1ZjEwOWFmNTNhMzM2ZDVmOThlZDBhZTU4NGU3YTMxZjg0",
    "commit": {
      "author": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@protonmail.com",
        "date": "2019-11-20T09:20:39Z"
      },
      "committer": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2019-12-10T11:00:15Z"
      },
      "message": "test: Remove ubsan alignment suppressions\n\nThis can be done now that prevector is properly aligned.",
      "tree": {
        "sha": "309975a7efa5f715b9cd12bd047ecf0c4883953f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/309975a7efa5f715b9cd12bd047ecf0c4883953f"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5f26855f109af53a336d5f98ed0ae584e7a31f84",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5f26855f109af53a336d5f98ed0ae584e7a31f84",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/5f26855f109af53a336d5f98ed0ae584e7a31f84",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5f26855f109af53a336d5f98ed0ae584e7a31f84/comments",
    "author": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "ajtowns",
      "id": 127186,
      "node_id": "MDQ6VXNlcjEyNzE4Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajtowns",
      "html_url": "https://github.com/ajtowns",
      "followers_url": "https://api.github.com/users/ajtowns/followers",
      "following_url": "https://api.github.com/users/ajtowns/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajtowns/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
      "organizations_url": "https://api.github.com/users/ajtowns/orgs",
      "repos_url": "https://api.github.com/users/ajtowns/repos",
      "events_url": "https://api.github.com/users/ajtowns/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajtowns/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "9d933ef9191417b4b7d29eaa3c3a571f814acc8e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9d933ef9191417b4b7d29eaa3c3a571f814acc8e",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/9d933ef9191417b4b7d29eaa3c3a571f814acc8e"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 0,
      "deletions": 2
    },
    "files": [
      {
        "sha": "8284a6916d6ed8f285420dc836662f328f6226d4",
        "filename": "test/sanitizer_suppressions/ubsan",
        "status": "modified",
        "additions": 0,
        "deletions": 2,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5f26855f109af53a336d5f98ed0ae584e7a31f84/test/sanitizer_suppressions/ubsan",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5f26855f109af53a336d5f98ed0ae584e7a31f84/test/sanitizer_suppressions/ubsan",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/sanitizer_suppressions/ubsan?ref=5f26855f109af53a336d5f98ed0ae584e7a31f84",
        "patch": "@@ -1,7 +1,5 @@\n # -fsanitize=undefined suppressions\n # =================================\n-alignment:move.h\n-alignment:prevector.h\n float-divide-by-zero:policy/fees.cpp\n float-divide-by-zero:validation.cpp\n float-divide-by-zero:wallet/wallet.cpp"
      }
    ]
  }
]