[
  {
    "sha": "7e591c19e70a151390eb2c0f83c3836178b76ee6",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo3ZTU5MWMxOWU3MGExNTEzOTBlYjJjMGY4M2MzODM2MTc4Yjc2ZWU2",
    "commit": {
      "author": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@gmail.com",
        "date": "2014-03-22T09:22:42Z"
      },
      "committer": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@gmail.com",
        "date": "2014-03-25T08:20:10Z"
      },
      "message": "qt: Do proper boost::path conversion\n\nConvert from QString unicode from/to the OS-dependent locale\nas used by boost::filesystem::path as needed.\n\nSolves #3916.",
      "tree": {
        "sha": "b87e0b157f77e829de24d90b6461381f7cf67581",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b87e0b157f77e829de24d90b6461381f7cf67581"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7e591c19e70a151390eb2c0f83c3836178b76ee6",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7e591c19e70a151390eb2c0f83c3836178b76ee6",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/7e591c19e70a151390eb2c0f83c3836178b76ee6",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7e591c19e70a151390eb2c0f83c3836178b76ee6/comments",
    "author": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "e3f5d4338d0305a398817279e36ef2d0cfd2fd2b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e3f5d4338d0305a398817279e36ef2d0cfd2fd2b",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/e3f5d4338d0305a398817279e36ef2d0cfd2fd2b"
      }
    ],
    "stats": {
      "total": 53,
      "additions": 47,
      "deletions": 6
    },
    "files": [
      {
        "sha": "26c56c5be898605521dd31ec23068643f71e1800",
        "filename": "src/qt/guiutil.cpp",
        "status": "modified",
        "additions": 31,
        "deletions": 1,
        "changes": 32,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7e591c19e70a151390eb2c0f83c3836178b76ee6/src/qt/guiutil.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7e591c19e70a151390eb2c0f83c3836178b76ee6/src/qt/guiutil.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/guiutil.cpp?ref=7e591c19e70a151390eb2c0f83c3836178b76ee6",
        "patch": "@@ -33,6 +33,9 @@\n \n #include <boost/filesystem.hpp>\n #include <boost/filesystem/fstream.hpp>\n+#if BOOST_FILESYSTEM_VERSION >= 3\n+#include <boost/filesystem/detail/utf8_codecvt_facet.hpp>\n+#endif\n \n #include <QAbstractItemView>\n #include <QApplication>\n@@ -54,6 +57,10 @@\n #include <QUrlQuery>\n #endif\n \n+#if BOOST_FILESYSTEM_VERSION >= 3\n+static boost::filesystem::detail::utf8_codecvt_facet utf8;\n+#endif\n+\n namespace GUIUtil {\n \n QString dateTimeStr(const QDateTime &date)\n@@ -352,7 +359,7 @@ void openDebugLogfile()\n \n     /* Open debug.log with the associated application */\n     if (boost::filesystem::exists(pathDebug))\n-        QDesktopServices::openUrl(QUrl::fromLocalFile(QString::fromStdString(pathDebug.string())));\n+        QDesktopServices::openUrl(QUrl::fromLocalFile(boostPathToQString(pathDebug)));\n }\n \n ToolTipToRichTextFilter::ToolTipToRichTextFilter(int size_threshold, QObject *parent) :\n@@ -718,4 +725,27 @@ void setClipboard(const QString& str)\n     QApplication::clipboard()->setText(str, QClipboard::Selection);\n }\n \n+#if BOOST_FILESYSTEM_VERSION >= 3\n+boost::filesystem::path qstringToBoostPath(const QString &path)\n+{\n+    return boost::filesystem::path(path.toStdString(), utf8);\n+}\n+\n+QString boostPathToQString(const boost::filesystem::path &path)\n+{\n+    return QString::fromStdString(path.string(utf8));\n+}\n+#else\n+#warning Conversion between boost path and QString can use invalid character encoding with boost_filesystem v2 and older\n+boost::filesystem::path qstringToBoostPath(const QString &path)\n+{\n+    return boost::filesystem::path(path.toStdString());\n+}\n+\n+QString boostPathToQString(const boost::filesystem::path &path)\n+{\n+    return QString::fromStdString(path.string());\n+}\n+#endif\n+\n } // namespace GUIUtil"
      },
      {
        "sha": "d1d18bb5f393198e2fdea4f012af676b96dcd994",
        "filename": "src/qt/guiutil.h",
        "status": "modified",
        "additions": 8,
        "deletions": 0,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7e591c19e70a151390eb2c0f83c3836178b76ee6/src/qt/guiutil.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7e591c19e70a151390eb2c0f83c3836178b76ee6/src/qt/guiutil.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/guiutil.h?ref=7e591c19e70a151390eb2c0f83c3836178b76ee6",
        "patch": "@@ -11,6 +11,8 @@\n #include <QTableView>\n #include <QHeaderView>\n \n+#include <boost/filesystem.hpp>\n+\n class QValidatedLineEdit;\n class SendCoinsRecipient;\n \n@@ -164,6 +166,12 @@ namespace GUIUtil\n     /** Restore window size and position */\n     void restoreWindowGeometry(const QString& strSetting, const QSize &defaultSizeIn, QWidget *parent);\n \n+    /* Convert QString to OS specific boost path through UTF-8 */\n+    boost::filesystem::path qstringToBoostPath(const QString &path);\n+\n+    /* Convert OS specific boost path to QString through UTF-8 */\n+    QString boostPathToQString(const boost::filesystem::path &path);\n+\n } // namespace GUIUtil\n \n #endif // GUIUTIL_H"
      },
      {
        "sha": "26efc4a78801c347c80e3d77aa5589c55b77b98a",
        "filename": "src/qt/intro.cpp",
        "status": "modified",
        "additions": 8,
        "deletions": 5,
        "changes": 13,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7e591c19e70a151390eb2c0f83c3836178b76ee6/src/qt/intro.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7e591c19e70a151390eb2c0f83c3836178b76ee6/src/qt/intro.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/intro.cpp?ref=7e591c19e70a151390eb2c0f83c3836178b76ee6",
        "patch": "@@ -5,9 +5,12 @@\n #include \"intro.h\"\n #include \"ui_intro.h\"\n \n+#include \"guiutil.h\"\n+\n #include \"util.h\"\n \n #include <boost/filesystem.hpp>\n+\n #include <QFileDialog>\n #include <QSettings>\n #include <QMessageBox>\n@@ -59,7 +62,7 @@ void FreespaceChecker::check()\n {\n     namespace fs = boost::filesystem;\n     QString dataDirStr = intro->getPathToCheck();\n-    fs::path dataDir = fs::path(dataDirStr.toStdString());\n+    fs::path dataDir = GUIUtil::qstringToBoostPath(dataDirStr);\n     uint64_t freeBytesAvailable = 0;\n     int replyStatus = ST_OK;\n     QString replyMessage = tr(\"A new data directory will be created.\");\n@@ -143,7 +146,7 @@ void Intro::setDataDirectory(const QString &dataDir)\n \n QString Intro::getDefaultDataDirectory()\n {\n-    return QString::fromStdString(GetDefaultDataDir().string());\n+    return GUIUtil::boostPathToQString(GetDefaultDataDir());\n }\n \n void Intro::pickDataDirectory()\n@@ -159,7 +162,7 @@ void Intro::pickDataDirectory()\n     /* 2) Allow QSettings to override default dir */\n     dataDir = settings.value(\"strDataDir\", dataDir).toString();\n \n-    if(!fs::exists(dataDir.toStdString()) || GetBoolArg(\"-choosedatadir\", false))\n+    if(!fs::exists(GUIUtil::qstringToBoostPath(dataDir)) || GetBoolArg(\"-choosedatadir\", false))\n     {\n         /* If current default data directory does not exist, let the user choose one */\n         Intro intro;\n@@ -175,7 +178,7 @@ void Intro::pickDataDirectory()\n             }\n             dataDir = intro.getDataDirectory();\n             try {\n-                fs::create_directory(dataDir.toStdString());\n+                fs::create_directory(GUIUtil::qstringToBoostPath(dataDir));\n                 break;\n             } catch(fs::filesystem_error &e) {\n                 QMessageBox::critical(0, tr(\"Bitcoin\"),\n@@ -186,7 +189,7 @@ void Intro::pickDataDirectory()\n \n         settings.setValue(\"strDataDir\", dataDir);\n     }\n-    SoftSetArg(\"-datadir\", dataDir.toStdString());\n+    SoftSetArg(\"-datadir\", GUIUtil::qstringToBoostPath(dataDir).string()); // use OS locale for path setting\n }\n \n void Intro::setStatus(int status, const QString &message, quint64 bytesAvailable)"
      }
    ]
  },
  {
    "sha": "c61fe44194ea6d549adfe9ae944ce6fa3a467e0f",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpjNjFmZTQ0MTk0ZWE2ZDU0OWFkZmU5YWU5NDRjZTZmYTNhNDY3ZTBm",
    "commit": {
      "author": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@gmail.com",
        "date": "2014-03-25T08:26:11Z"
      },
      "committer": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@gmail.com",
        "date": "2014-03-25T08:26:11Z"
      },
      "message": "qt: Only override -datadir if different from the default\n\nFixes #3905.",
      "tree": {
        "sha": "771e6d98297d33e7250c8c8a4d208d5d36b76cee",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/771e6d98297d33e7250c8c8a4d208d5d36b76cee"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c61fe44194ea6d549adfe9ae944ce6fa3a467e0f",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c61fe44194ea6d549adfe9ae944ce6fa3a467e0f",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/c61fe44194ea6d549adfe9ae944ce6fa3a467e0f",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c61fe44194ea6d549adfe9ae944ce6fa3a467e0f/comments",
    "author": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "7e591c19e70a151390eb2c0f83c3836178b76ee6",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7e591c19e70a151390eb2c0f83c3836178b76ee6",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/7e591c19e70a151390eb2c0f83c3836178b76ee6"
      }
    ],
    "stats": {
      "total": 7,
      "additions": 6,
      "deletions": 1
    },
    "files": [
      {
        "sha": "f34260649541bd2d549afff2581cb26e0d3741e3",
        "filename": "src/qt/intro.cpp",
        "status": "modified",
        "additions": 6,
        "deletions": 1,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c61fe44194ea6d549adfe9ae944ce6fa3a467e0f/src/qt/intro.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c61fe44194ea6d549adfe9ae944ce6fa3a467e0f/src/qt/intro.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/intro.cpp?ref=c61fe44194ea6d549adfe9ae944ce6fa3a467e0f",
        "patch": "@@ -189,7 +189,12 @@ void Intro::pickDataDirectory()\n \n         settings.setValue(\"strDataDir\", dataDir);\n     }\n-    SoftSetArg(\"-datadir\", GUIUtil::qstringToBoostPath(dataDir).string()); // use OS locale for path setting\n+    /* Only override -datadir if different from the default, to make it possible to\n+     * override -datadir in the bitcoin.conf file in the default data directory\n+     * (to be consistent with bitcoind behavior)\n+     */\n+    if(dataDir != getDefaultDataDirectory())\n+        SoftSetArg(\"-datadir\", GUIUtil::qstringToBoostPath(dataDir).string()); // use OS locale for path setting\n }\n \n void Intro::setStatus(int status, const QString &message, quint64 bytesAvailable)"
      }
    ]
  }
]