[
  {
    "sha": "d98bf10f23e0e633ff2ff33075a353d30bf862b4",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpkOThiZjEwZjIzZTBlNjMzZmYyZmYzMzA3NWEzNTNkMzBiZjg2MmI0",
    "commit": {
      "author": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@gmail.com",
        "date": "2013-05-30T13:51:41Z"
      },
      "committer": {
        "name": "Wladimir J. van der Laan",
        "email": "laanwj@gmail.com",
        "date": "2013-05-30T14:41:35Z"
      },
      "message": "Move pMiningKey init out of StartRPCThreads\n\nThis commit decouples the pMiningKey initialization and shutdown from the RPC\nthreads.\n\n`getwork` and `getblocktemplate` rely on pMiningKey, and can also be ran\nfrom the debug window in the UI even when the RPC server is not running.\n\nSolves issue #2706.",
      "tree": {
        "sha": "0bc8873a2c74894989dcf9dfe3b8f69696d5814b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0bc8873a2c74894989dcf9dfe3b8f69696d5814b"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d98bf10f23e0e633ff2ff33075a353d30bf862b4",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d98bf10f23e0e633ff2ff33075a353d30bf862b4",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/d98bf10f23e0e633ff2ff33075a353d30bf862b4",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d98bf10f23e0e633ff2ff33075a353d30bf862b4/comments",
    "author": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "ba35ecc003d148527f30b4df84285add072fae90",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ba35ecc003d148527f30b4df84285add072fae90",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/ba35ecc003d148527f30b4df84285add072fae90"
      }
    ],
    "stats": {
      "total": 31,
      "additions": 21,
      "deletions": 10
    },
    "files": [
      {
        "sha": "a9b73fd5a6a033aa58566923a1bc4aaebf129fb6",
        "filename": "src/bitcoinrpc.cpp",
        "status": "modified",
        "additions": 0,
        "deletions": 9,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d98bf10f23e0e633ff2ff33075a353d30bf862b4/src/bitcoinrpc.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d98bf10f23e0e633ff2ff33075a353d30bf862b4/src/bitcoinrpc.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bitcoinrpc.cpp?ref=d98bf10f23e0e633ff2ff33075a353d30bf862b4",
        "patch": "@@ -30,10 +30,6 @@ using namespace boost;\n using namespace boost::asio;\n using namespace json_spirit;\n \n-// Key used by getwork/getblocktemplate miners.\n-// Allocated in StartRPCThreads, free'd in StopRPCThreads\n-CReserveKey* pMiningKey = NULL;\n-\n static std::string strRPCUserColonPass;\n \n // These are created by StartRPCThreads, destroyed in StopRPCThreads\n@@ -726,9 +722,6 @@ static void RPCAcceptHandler(boost::shared_ptr< basic_socket_acceptor<Protocol,\n \n void StartRPCThreads()\n {\n-    // getwork/getblocktemplate mining rewards paid here:\n-    pMiningKey = new CReserveKey(pwalletMain);\n-\n     strRPCUserColonPass = mapArgs[\"-rpcuser\"] + \":\" + mapArgs[\"-rpcpassword\"];\n     if ((mapArgs[\"-rpcpassword\"] == \"\") ||\n         (mapArgs[\"-rpcuser\"] == mapArgs[\"-rpcpassword\"]))\n@@ -848,8 +841,6 @@ void StartRPCThreads()\n \n void StopRPCThreads()\n {\n-    delete pMiningKey; pMiningKey = NULL;\n-\n     if (rpc_io_service == NULL) return;\n \n     rpc_io_service->stop();"
      },
      {
        "sha": "547cccf44b4c8212fe4151e4eb0f596ce37d9533",
        "filename": "src/bitcoinrpc.h",
        "status": "modified",
        "additions": 3,
        "deletions": 1,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d98bf10f23e0e633ff2ff33075a353d30bf862b4/src/bitcoinrpc.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d98bf10f23e0e633ff2ff33075a353d30bf862b4/src/bitcoinrpc.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bitcoinrpc.h?ref=d98bf10f23e0e633ff2ff33075a353d30bf862b4",
        "patch": "@@ -123,7 +123,9 @@ class CRPCTable\n };\n \n extern const CRPCTable tableRPC;\n-extern CReserveKey* pMiningKey;\n+\n+extern void InitRPCMining();\n+extern void ShutdownRPCMining();\n \n extern int64 nWalletUnlockTime;\n extern int64 AmountFromValue(const json_spirit::Value& value);"
      },
      {
        "sha": "9c807b288e0c190248deda439732c839637beb78",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d98bf10f23e0e633ff2ff33075a353d30bf862b4/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d98bf10f23e0e633ff2ff33075a353d30bf862b4/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=d98bf10f23e0e633ff2ff33075a353d30bf862b4",
        "patch": "@@ -96,6 +96,7 @@ void Shutdown()\n     RenameThread(\"bitcoin-shutoff\");\n     nTransactionsUpdated++;\n     StopRPCThreads();\n+    ShutdownRPCMining();\n     bitdb.Flush(false);\n     StopNode();\n     {\n@@ -1081,6 +1082,8 @@ bool AppInit2(boost::thread_group& threadGroup)\n \n     StartNode(threadGroup);\n \n+    // InitRPCMining is needed here so getwork/getblocktemplate in the GUI debug console works properly.\n+    InitRPCMining();\n     if (fServer)\n         StartRPCThreads();\n "
      },
      {
        "sha": "845e7f1f9c4995b58e074cefe0f98a99b0c67114",
        "filename": "src/rpcmining.cpp",
        "status": "modified",
        "additions": 15,
        "deletions": 0,
        "changes": 15,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d98bf10f23e0e633ff2ff33075a353d30bf862b4/src/rpcmining.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d98bf10f23e0e633ff2ff33075a353d30bf862b4/src/rpcmining.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpcmining.cpp?ref=d98bf10f23e0e633ff2ff33075a353d30bf862b4",
        "patch": "@@ -11,6 +11,21 @@\n using namespace json_spirit;\n using namespace std;\n \n+// Key used by getwork/getblocktemplate miners.\n+// Allocated in InitRPCMining, free'd in ShutdownRPCMining\n+static CReserveKey* pMiningKey = NULL;\n+\n+void InitRPCMining()\n+{\n+    // getwork/getblocktemplate mining rewards paid here:\n+    pMiningKey = new CReserveKey(pwalletMain);\n+}\n+\n+void ShutdownRPCMining()\n+{\n+    delete pMiningKey; pMiningKey = NULL;\n+}\n+\n Value getgenerate(const Array& params, bool fHelp)\n {\n     if (fHelp || params.size() != 0)"
      }
    ]
  }
]