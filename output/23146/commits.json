[
  {
    "sha": "502f50da12694dd0193744427f0f89238e612f54",
    "node_id": "C_kwDOABII59oAKDUwMmY1MGRhMTI2OTRkZDAxOTM3NDQ0MjdmMGY4OTIzOGU2MTJmNTQ",
    "commit": {
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-09-30T13:09:08Z"
      },
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-10-02T13:27:40Z"
      },
      "message": "Test transactions conflicted by double spend in listtransactions\n\nTest the properties of transactions conflicted by a double\nspend as returned by RPC listtransactions in the \"abandoned\",\n\"confirmations\", \"trusted\" and \"walletconflicts\" fields.\n\nThese fields are also returned by RPCs listsinceblock and\ngettransactions.",
      "tree": {
        "sha": "901a64952d65d8b77c762a5698f7a1af15c4d5d8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/901a64952d65d8b77c762a5698f7a1af15c4d5d8"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/502f50da12694dd0193744427f0f89238e612f54",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEd6u7+MhX7zEv6RP5T1chs9Djkh0FAmFYXlYACgkQT1chs9Dj\nkh0BqQ/+LJqxA2vkFGoOVVTLW+xUnpdivi5v5mnuywLniACUJdziIRwznJX0bux0\nnA9X+fBfg3i0B/vE9dthVLf8fhVThoUzo8hw6i33uDI4diau8wjkuZMspzMZQOq7\nzVoBjbC099U7bTIj3m6AA28VoA6EB33iJHYLN4NMt5qJY9k/xKJCz8EnRKuxhTSg\nJprErwcO3nf+l43P2LGHMPRFK7evfxSOrbvIdNjhtDGCJN+k4poz1h2+KU6hHYZx\nqgT6XFu5EKfmtef5QTo6i6W6dVnY/y+Ld2pikVf6zv1+Eym8VurFm9nV5w0VY2ys\n1u8gYg98aCA8sjsaB8ms39ZdH+iWvBDan8Ycj+wLXiIGG5EE0kF1vmMoHnhzC2gg\ny2QgYohdpwE74MdlPkEH3PyAvt7AOvJE7dbp1sBaZuSfej29KzXgLHbXMRa0AwVa\nOA7tSBjTMy7pBmnVBw4yoB+GnUH6xDE9b43MS0bWI/dgOWz/CxBOToGTpX/2o9Wb\nG6OgmriHR8f3v/F4M7lD2fVzY7HIhMNpGnWtEOZJIbF8vK4Kmk0qKWEjrHhzgNTq\nLdwh+xZRrdmoZH93Le/WQbknT6wNSJMxE4mnMUYMtPCirMkwgxOVxsum+VTcTEXq\ngyETaFahWpm5HhI1P3NPTCUPwNLzfDDwN5TovJR7l8idlANKrB8=\n=pbAy\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwILlwy0iq6EKEMnGZqeyT8SGfhPHFqJW+eSU+MjrpciULCP/wEDTT2JKfvk+M\ns5UDNp+ycEUI8CDYvKs1Zg2SOHQT/BQ/JQ6fN/KIszCj8kZIUzPOyBkSogjxBGFY\nXljwCAj7ByLN+gX6AIPf4w0u+QyOLi1odHRwczovL2FsaWNlLmJ0Yy5jYWxlbmRh\nci5vcGVudGltZXN0YW1wcy5vcmf/8BA9Xk0FFQ83XYpSKXI4fisuCPEEYVheWPAI\nqY8u5TeQoPwAg9/jDS75DI4jImh0dHBzOi8vYnRjLmNhbGVuZGFyLmNhdGFsbGF4\neS5jb23/8BBSBahwSVgN8JJMqRdBTKX1CPEgSfkGxR0Nw8d1d1UE2dXTppwi7AYt\n69bDEQ0doWslylYI8QRhWF5Y8Ah2PXTLh+rqEACD3+MNLvkMjikoaHR0cHM6Ly9m\naW5uZXkuY2FsZW5kYXIuZXRlcm5pdHl3YWxsLmNvbfAQrePPHh0AgrqazKOrO7v7\nYAjxIFER2tbfw8R3MLU435S5CmKFsySVPMLoT/OLFBmgawnfCPEEYVheWPAIUaDd\nTy8UNFEAg9/jDS75DI4sK2h0dHBzOi8vYm9iLmJ0Yy5jYWxlbmRhci5vcGVudGlt\nZXN0YW1wcy5vcmc=\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----",
        "payload": "tree 901a64952d65d8b77c762a5698f7a1af15c4d5d8\nparent 1cf7fb9fd65820b298a0eb28f6e2c4c7409c78d1\nauthor Jon Atack <jon@atack.com> 1633007348 +0200\ncommitter Jon Atack <jon@atack.com> 1633181260 +0200\n\nTest transactions conflicted by double spend in listtransactions\n\nTest the properties of transactions conflicted by a double\nspend as returned by RPC listtransactions in the \"abandoned\",\n\"confirmations\", \"trusted\" and \"walletconflicts\" fields.\n\nThese fields are also returned by RPCs listsinceblock and\ngettransactions.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/502f50da12694dd0193744427f0f89238e612f54",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/502f50da12694dd0193744427f0f89238e612f54",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/502f50da12694dd0193744427f0f89238e612f54/comments",
    "author": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "1cf7fb9fd65820b298a0eb28f6e2c4c7409c78d1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1cf7fb9fd65820b298a0eb28f6e2c4c7409c78d1",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/1cf7fb9fd65820b298a0eb28f6e2c4c7409c78d1"
      }
    ],
    "stats": {
      "total": 29,
      "additions": 29,
      "deletions": 0
    },
    "files": [
      {
        "sha": "70ca5a2fe4a9a7c3052d8a87104e376065bf37a1",
        "filename": "test/functional/wallet_abandonconflict.py",
        "status": "modified",
        "additions": 29,
        "deletions": 0,
        "changes": 29,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/502f50da12694dd0193744427f0f89238e612f54/test/functional/wallet_abandonconflict.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/502f50da12694dd0193744427f0f89238e612f54/test/functional/wallet_abandonconflict.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/wallet_abandonconflict.py?ref=502f50da12694dd0193744427f0f89238e612f54",
        "patch": "@@ -149,6 +149,7 @@ def run_test(self):\n         assert_equal(newbalance, balance - Decimal(\"24.9996\"))\n         balance = newbalance\n \n+        self.log.info(\"Test transactions conflicted by a double spend\")\n         # Create a double spend of AB1 by spending again from only A's 10 output\n         # Mine double spend from node 1\n         inputs = []\n@@ -163,6 +164,34 @@ def run_test(self):\n         self.connect_nodes(0, 1)\n         self.sync_blocks()\n \n+        tx_list = self.nodes[0].listtransactions()\n+\n+        conflicted = [tx for tx in tx_list if tx[\"confirmations\"] < 0]\n+        assert_equal(4, len(conflicted))\n+\n+        wallet_conflicts = [tx for tx in conflicted if tx[\"walletconflicts\"]]\n+        assert_equal(2, len(wallet_conflicts))\n+\n+        double_spends = [tx for tx in tx_list if tx[\"walletconflicts\"] and tx[\"confirmations\"] > 0]\n+        assert_equal(1, len(double_spends))\n+        double_spend = double_spends[0]\n+\n+        # Test the properties of the conflicted transactions, i.e. with confirmations < 0.\n+        for tx in conflicted:\n+            assert_equal(tx[\"abandoned\"], False)\n+            assert_equal(tx[\"confirmations\"], -1)\n+            assert_equal(tx[\"trusted\"], False)\n+\n+        # Test the properties of the double-spend transaction, i.e. having wallet conflicts and confirmations > 0.\n+        assert_equal(double_spend[\"abandoned\"], False)\n+        assert_equal(double_spend[\"confirmations\"], 1)\n+        assert \"trusted\" not in double_spend.keys()  # \"trusted\" only returned if tx has 0 or negative confirmations.\n+\n+        # Test the walletconflicts field of each.\n+        for tx in wallet_conflicts:\n+            assert_equal(double_spend[\"walletconflicts\"], [tx[\"txid\"]])\n+            assert_equal(tx[\"walletconflicts\"], [double_spend[\"txid\"]])\n+\n         # Verify that B and C's 10 BTC outputs are available for spending again because AB1 is now conflicted\n         newbalance = self.nodes[0].getbalance()\n         assert_equal(newbalance, balance + Decimal(\"20\"))"
      }
    ]
  }
]