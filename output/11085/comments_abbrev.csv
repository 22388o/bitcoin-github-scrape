dooglus,2017-08-18T09:28:55Z,"> IMO multiwallet would provide a more sane path to run HD and nonHD side a side\n\nI wasn't aware of 'multiwallet' until I merged my changes to the master branch, and still haven't looked into it in any detail. If it allows me to see my pre-HD and post-HD transactions in a single unified list then I agree.",https://github.com/bitcoin/bitcoin/pull/11085#issuecomment-323306235,323306235,
achow101,2017-08-19T00:03:49Z,This RPC should probably also bump the version number to at 139900 so that HD chain split is supported as well.,https://github.com/bitcoin/bitcoin/pull/11085#issuecomment-323485619,323485619,
TheBlueMatt,2017-08-21T01:17:56Z,"@jonasschnelli hmm, multiwallet has a rather significant usability burden (eg not being able to spend from both sides) vs just allowing people to add an HD master key to their wallet. I'm not sure why we wouldn't allow people to upgrade their wallet using the same -upgradewallet path.\n\nIndependantly, I do think we need the option to allow someone to rotate their HD master key if they desire (w",https://github.com/bitcoin/bitcoin/pull/11085#issuecomment-323625446,323625446,
dooglus,2017-08-21T20:19:52Z,"@TheBlueMatt > I'm not sure why we wouldn't allow people to upgrade their wallet using the same -upgradewallet path.\n\nI don't think -upgradewallet should invalidate old backups, whereas setting the HD wallet seed *does* invalidate old backups if it flushes the keypool, which it does do by default. Perhaps that's an argument for keeping the seed-setting code separate from -upgradewallet, especi",https://github.com/bitcoin/bitcoin/pull/11085#issuecomment-323842576,323842576,
TheBlueMatt,2017-08-21T20:52:05Z,"@dooglus hmm, well if we dont want to use the same system (we could, of course, call the argument something different for this upgrade), then we've horribly fucked up (we used a wallet version number for HD support, so if we dont allow upgrade using the same version number stuff then we're left without any good options to add any other future features, eg segwit support).\n\nI'm fine with, eg, r",https://github.com/bitcoin/bitcoin/pull/11085#issuecomment-323849809,323849809,
TheBlueMatt,2017-09-05T22:26:13Z,"@dooglus any plans on addressing @promag's comments? The ability to rotate the HD master key is a very, very nice change which I'd like to see much sooner rather than later to resolve some outstanding HD stuff by upgrading people to HD aggressively.",https://github.com/bitcoin/bitcoin/pull/11085#issuecomment-327321146,327321146,
dooglus,2017-09-06T15:52:10Z,"@TheBlueMatt Sure, I'll get right on that. Hopefully today.\n\nI wasn't previously aware of [the developer notes](https://github.com/bitcoin/bitcoin/blob/master/doc/developer-notes.md) but now I am.",https://github.com/bitcoin/bitcoin/pull/11085#issuecomment-327528419,327528419,
promag,2017-09-06T16:12:50Z,Needs rebase too.,https://github.com/bitcoin/bitcoin/pull/11085#issuecomment-327534859,327534859,
dooglus,2017-09-07T16:44:10Z,"Addressed @promag's formatting nits. Removed trailing period from commit message. Rebased. Squashed.\n\nDidn't add tests or backup warnings yet.",https://github.com/bitcoin/bitcoin/pull/11085#issuecomment-327856901,327856901,
dooglus,2017-09-07T16:56:31Z,"@achow101 \n\n> I'm not sure if it is necessary or useful to be able to set your own seed.\n\nI want to be able to make a backup of my wallet on paper, by writing down nothing but my seed.\n\nIn order to restore from the paper backup I need to be able to set my own seed.\n\nFor this use case we would also need a 'dumpprivkey' for the master seed.\n\n> Or if it is necessary or useful to h",https://github.com/bitcoin/bitcoin/pull/11085#issuecomment-327860203,327860203,
dooglus,2017-09-07T16:59:10Z,"TODO:\n\n* add tests\n* add backup warnings\n* use WIF keys, not hex ones",https://github.com/bitcoin/bitcoin/pull/11085#issuecomment-327860915,327860915,
dooglus,2017-09-07T20:54:58Z,"Now the code accepts WIF keys, not hex, and I added a warning to the doc string saying that the user needs to make a new backup.\n\nShould I add tests to the existing `test/functional/wallet-hd.py` script?",https://github.com/bitcoin/bitcoin/pull/11085#issuecomment-327924941,327924941,
meshcollider,2017-09-09T09:06:03Z,"utACK https://github.com/bitcoin/bitcoin/commit/ddad8fc0b6e4046ac1ad752f917f55abbe64199a, awaiting tests\n\n~This still wouldn't offer support for the 512-bit seeds generated with BIP 39 though, maybe that could be considered~\n\nTravis error is unrelated and was fixed in https://github.com/bitcoin/bitcoin/pull/11271\n\n> @dooglus Should I add tests to the existing `test/functional/wallet-hd",https://github.com/bitcoin/bitcoin/pull/11085#issuecomment-328264878,328264878,
sipa,2017-09-11T22:42:43Z,"@dooglus Can you rebase? There were some unrelated Travis that affected your PR, but have been fixed in master since.",https://github.com/bitcoin/bitcoin/pull/11085#issuecomment-328679540,328679540,
dooglus,2017-09-12T02:48:09Z,Rebased.,https://github.com/bitcoin/bitcoin/pull/11085#issuecomment-328717321,328717321,
dooglus,2017-09-12T20:49:42Z,"@TheBlueMatt > we need some thing to keep people from putting an HD key in their wallet without a walletupgrade here, probably making SetHDMasterKey fail unless wallet version supports HD\n\nI'm not familiar with walletupgrade. I made my wallet in 2011 and never (to my knowledge) ran walletupgrade. I was able to use this PR to add an HD key to my 2011 wallet and it seems to work. What am I missi",https://github.com/bitcoin/bitcoin/pull/11085#issuecomment-328980341,328980341,
TheBlueMatt,2017-09-14T15:23:47Z,"@dooglus I think it may work, but a) it wont use hd-split (which it should, if possible) and b) old versions opening the wallet which has had HD key added to it will (I believe) open normally and add non-HD keys instead of failing to open, which doing a -walletupgrade will ensure.",https://github.com/bitcoin/bitcoin/pull/11085#issuecomment-329517298,329517298,
achow101,2018-01-22T23:47:40Z,"Needs rebase\n\nWasn't the plan to have this (or something similar) in for 0.16 since creating non-HD wallets is now a thing?",https://github.com/bitcoin/bitcoin/pull/11085#issuecomment-359613725,359613725,
achow101,2018-02-27T02:10:15Z,@dooglus Are you still working on this?,https://github.com/bitcoin/bitcoin/pull/11085#issuecomment-368721830,368721830,
dooglus,2018-02-27T07:27:50Z,No I'm not. I don't think I have what it takes to get this merged.,https://github.com/bitcoin/bitcoin/pull/11085#issuecomment-368772494,368772494,
achow101,2018-02-27T17:46:29Z,I've picked this up in #12560 ,https://github.com/bitcoin/bitcoin/pull/11085#issuecomment-368964722,368964722,
dooglus,2018-02-27T18:08:53Z,Thank you.,https://github.com/bitcoin/bitcoin/pull/11085#issuecomment-368971831,368971831,
achow101,2018-03-14T18:11:34Z,This should be closed as it is replaced by #12560,https://github.com/bitcoin/bitcoin/pull/11085#issuecomment-373122250,373122250,
dooglus,2018-03-14T19:56:11Z,OK.,https://github.com/bitcoin/bitcoin/pull/11085#issuecomment-373154252,373154252,
jonasschnelli,2017-08-18T09:13:30Z,I think this should be called `DeriveNewMasterHDKey()`,https://github.com/bitcoin/bitcoin/pull/11085#discussion_r133914169,133914169,src/wallet/wallet.cpp
jonasschnelli,2017-08-18T09:16:02Z,"What does prevent from setting a new seed in an existing HD wallet? Or do we want to allow that? If so, we should at least warn in the help text or even add an additional boolean to make sure the user is aware of the implications (hopefully). ",https://github.com/bitcoin/bitcoin/pull/11085#discussion_r133914700,133914700,src/wallet/rpcwallet.cpp
jonasschnelli,2017-08-18T09:17:25Z,"Not flushing the pool may lead to unrecoverable funds. If one sets an HD seed without flushing, backup directly, he may miss `-keypoolsize` keys (maybe 100, maybe 1000).\nI'd say a flush is mandatory.",https://github.com/bitcoin/bitcoin/pull/11085#discussion_r133914953,133914953,src/wallet/rpcwallet.cpp
dooglus,2017-08-18T09:25:24Z,"It allows you to replace your existing HD seed with a new one, for example if you are worried that your old seed was exposed to a third party, you can switch to a new one without having to lose transaction history.",https://github.com/bitcoin/bitcoin/pull/11085#discussion_r133916455,133916455,src/wallet/rpcwallet.cpp
dooglus,2017-08-18T09:27:14Z,I don't understand. How do old un-flushed keys in the mempool cause loss of funds if the HD seed is changed but not if it isn't? They're either backed up or they're not.,https://github.com/bitcoin/bitcoin/pull/11085#discussion_r133916778,133916778,src/wallet/rpcwallet.cpp
dooglus,2017-08-18T09:27:25Z,Good point.,https://github.com/bitcoin/bitcoin/pull/11085#discussion_r133916814,133916814,src/wallet/wallet.cpp
jonasschnelli,2017-08-18T09:27:31Z,But shouldn't that worry (compromised seed key or compromised sub-key) lead to moving the funds to a new seed? It may hurts privacy is done in a single N-to-1.,https://github.com/bitcoin/bitcoin/pull/11085#discussion_r133916837,133916837,src/wallet/rpcwallet.cpp
jonasschnelli,2017-08-18T09:31:52Z,Your right. It would only be a problem if the user considers only backing up the seed (user may thinks I just need to backup the 64 char hex string) at this point.,https://github.com/bitcoin/bitcoin/pull/11085#discussion_r133917780,133917780,src/wallet/rpcwallet.cpp
dooglus,2017-08-18T17:03:55Z,"Yes, you would want to move funds from keys you suspect are compromised. The user is responsible for deciding how and when to move the funds. This pull request simply makes it possible to switch to a new uncompromised set of addresses.",https://github.com/bitcoin/bitcoin/pull/11085#discussion_r134007614,134007614,src/wallet/rpcwallet.cpp
dooglus,2017-08-18T17:06:51Z,"If he only backs up the seed, he loses all his funds in pre-HD addresses whether we flush the keypool or not.\n\nWe default to flushing the keypool. If a user chooses not to flush the pool I think he likely understands what he's doing.",https://github.com/bitcoin/bitcoin/pull/11085#discussion_r134008134,134008134,src/wallet/rpcwallet.cpp
TheBlueMatt,2017-08-21T01:21:08Z,"Needs way more documentation here (note it keeps old keys, you probably want to backup immediately after using this and before otherwise using your wallet, etc).",https://github.com/bitcoin/bitcoin/pull/11085#discussion_r134132858,134132858,src/wallet/rpcwallet.cpp
promag,2017-08-21T21:44:03Z,"```cpp\nif (!request.params[1].isNull()) {\n```",https://github.com/bitcoin/bitcoin/pull/11085#discussion_r134339046,134339046,src/wallet/rpcwallet.cpp
promag,2017-08-21T21:44:49Z,"```cpp\nif (!request.params[0].isNull()) {\n```",https://github.com/bitcoin/bitcoin/pull/11085#discussion_r134339166,134339166,src/wallet/rpcwallet.cpp
promag,2017-08-21T21:45:15Z,"```cpp\nbool flush_key_pool = true;\n```",https://github.com/bitcoin/bitcoin/pull/11085#discussion_r134339248,134339248,src/wallet/rpcwallet.cpp
promag,2017-08-21T21:45:55Z,Missing `{ }`.,https://github.com/bitcoin/bitcoin/pull/11085#discussion_r134339354,134339354,src/wallet/rpcwallet.cpp
promag,2017-08-21T21:46:18Z,Remove space before `<`.,https://github.com/bitcoin/bitcoin/pull/11085#discussion_r134339420,134339420,src/wallet/rpcwallet.cpp
promag,2017-08-21T21:46:32Z,Missing `{ }`.,https://github.com/bitcoin/bitcoin/pull/11085#discussion_r134339462,134339462,src/wallet/rpcwallet.cpp
promag,2017-08-21T21:47:48Z,Missing `{ }`.,https://github.com/bitcoin/bitcoin/pull/11085#discussion_r134339677,134339677,src/wallet/rpcwallet.cpp
promag,2017-08-21T21:47:55Z,Missing `{ }`.,https://github.com/bitcoin/bitcoin/pull/11085#discussion_r134339692,134339692,src/wallet/rpcwallet.cpp
promag,2017-08-21T21:48:04Z,Missing `{ }`.,https://github.com/bitcoin/bitcoin/pull/11085#discussion_r134339730,134339730,src/wallet/rpcwallet.cpp
promag,2017-08-21T21:49:10Z,`const CKey& key`?,https://github.com/bitcoin/bitcoin/pull/11085#discussion_r134339965,134339965,src/wallet/wallet.cpp
promag,2017-08-21T21:50:21Z,Remove space before `*`.,https://github.com/bitcoin/bitcoin/pull/11085#discussion_r134340183,134340183,src/wallet/rpcwallet.cpp
promag,2017-08-21T21:54:31Z,`master_pub_key`?,https://github.com/bitcoin/bitcoin/pull/11085#discussion_r134340913,134340913,src/wallet/rpcwallet.cpp
promag,2017-08-21T21:59:39Z,Similar error in https://github.com/bitcoin/bitcoin/blame/master/src/wallet/rpcdump.cpp#L825.,https://github.com/bitcoin/bitcoin/pull/11085#discussion_r134341868,134341868,src/wallet/rpcwallet.cpp
achow101,2017-09-06T18:37:15Z,Why are you doing `AccountFromValue`? There are no accounts here.,https://github.com/bitcoin/bitcoin/pull/11085#discussion_r137354472,137354472,src/wallet/rpcwallet.cpp
achow101,2017-09-06T18:55:14Z,Why not use a WIF key instead of a hex seed?,https://github.com/bitcoin/bitcoin/pull/11085#discussion_r137359313,137359313,src/wallet/rpcwallet.cpp
dooglus,2017-09-07T16:48:44Z,Fixed.,https://github.com/bitcoin/bitcoin/pull/11085#discussion_r137594336,137594336,src/wallet/rpcwallet.cpp
dooglus,2017-09-07T16:58:06Z,"Good question. I wanted to import the HD seed from the wallet in which I had been testing HD derivation into my main wallet, and happened to have it in hex format.\n\nI'll switch to requiring a WIF key.",https://github.com/bitcoin/bitcoin/pull/11085#discussion_r137596767,137596767,src/wallet/rpcwallet.cpp
TheBlueMatt,2017-09-11T15:16:06Z,"Maybe clarify a bit further what this implies? (eg ""ie the next address from getnewaddress will be from this new seed. If this is not set, the old seed's derived addresses will be used until the keypool has been depleted."").",https://github.com/bitcoin/bitcoin/pull/11085#discussion_r138102256,138102256,src/wallet/rpcwallet.cpp
TheBlueMatt,2017-09-11T15:30:43Z,"nit: maybe ""(either as an HD seed or as a loose private key)"" to note that you cant use an existing loose private key as an HD seed.",https://github.com/bitcoin/bitcoin/pull/11085#discussion_r138106592,138106592,src/wallet/rpcwallet.cpp
dooglus,2017-09-12T20:53:47Z,"So:\n\n            ""1. \""flushkeypool\""       (boolean, optional, default=true) Whether to flush old unused addresses from the keypool.\n""\n            ""                             If true, the next address from getnewaddress will be from this new seed.\n""\n            ""                             If false, addresses from the existing keypool will be used until it has been depleted.\n""\n\n",https://github.com/bitcoin/bitcoin/pull/11085#discussion_r138462800,138462800,src/wallet/rpcwallet.cpp
dooglus,2017-09-12T20:57:32Z,"In [this comment](https://github.com/bitcoin/bitcoin/pull/11085#discussion_r134341868), @promag said that there was a similar error elsewhere. I think he meant that I should use the same string so as not to unnecessarily increase the required translation effort. I'll switch to using your string.",https://github.com/bitcoin/bitcoin/pull/11085#discussion_r138463786,138463786,src/wallet/rpcwallet.cpp
