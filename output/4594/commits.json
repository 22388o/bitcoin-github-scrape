[
  {
    "sha": "3658e937e3a46798bb50c7983984ab01e97bab74",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozNjU4ZTkzN2UzYTQ2Nzk4YmI1MGM3OTgzOTg0YWIwMWU5N2JhYjc0",
    "commit": {
      "author": {
        "name": "Johnathan Corgan",
        "email": "johnathan@corganlabs.com",
        "date": "2014-07-28T22:28:07Z"
      },
      "committer": {
        "name": "Johnathan Corgan",
        "email": "johnathan@corganlabs.com",
        "date": "2014-08-18T13:42:44Z"
      },
      "message": "Adds publishing blocks and transactions over ZMQ\n\nZMQ-based features are encapsulated in zmqports.{cpp,h} and disabled\nif libzmq-dev is not found, or configure is invoked with\n--disable-zmq.\n\nUse -zmqpub=<endpoint> to use feature.\n\nSee contrib/zmq/README.md for details.",
      "tree": {
        "sha": "58b9302e686f0c969876b5f5d17062e56151bfdb",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/58b9302e686f0c969876b5f5d17062e56151bfdb"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3658e937e3a46798bb50c7983984ab01e97bab74",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3658e937e3a46798bb50c7983984ab01e97bab74",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/3658e937e3a46798bb50c7983984ab01e97bab74",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3658e937e3a46798bb50c7983984ab01e97bab74/comments",
    "author": {
      "login": "jmcorgan",
      "id": 1492956,
      "node_id": "MDQ6VXNlcjE0OTI5NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1492956?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jmcorgan",
      "html_url": "https://github.com/jmcorgan",
      "followers_url": "https://api.github.com/users/jmcorgan/followers",
      "following_url": "https://api.github.com/users/jmcorgan/following{/other_user}",
      "gists_url": "https://api.github.com/users/jmcorgan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jmcorgan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jmcorgan/subscriptions",
      "organizations_url": "https://api.github.com/users/jmcorgan/orgs",
      "repos_url": "https://api.github.com/users/jmcorgan/repos",
      "events_url": "https://api.github.com/users/jmcorgan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jmcorgan/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jmcorgan",
      "id": 1492956,
      "node_id": "MDQ6VXNlcjE0OTI5NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1492956?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jmcorgan",
      "html_url": "https://github.com/jmcorgan",
      "followers_url": "https://api.github.com/users/jmcorgan/followers",
      "following_url": "https://api.github.com/users/jmcorgan/following{/other_user}",
      "gists_url": "https://api.github.com/users/jmcorgan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jmcorgan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jmcorgan/subscriptions",
      "organizations_url": "https://api.github.com/users/jmcorgan/orgs",
      "repos_url": "https://api.github.com/users/jmcorgan/repos",
      "events_url": "https://api.github.com/users/jmcorgan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jmcorgan/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "04d6c7d10cf66e134ed7e112127c060f78ea620a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/04d6c7d10cf66e134ed7e112127c060f78ea620a",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/04d6c7d10cf66e134ed7e112127c060f78ea620a"
      }
    ],
    "stats": {
      "total": 440,
      "additions": 438,
      "deletions": 2
    },
    "files": [
      {
        "sha": "9847554de2232d7cee9971d7abc8f876059690ec",
        "filename": "configure.ac",
        "status": "modified",
        "additions": 22,
        "deletions": 0,
        "changes": 22,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3658e937e3a46798bb50c7983984ab01e97bab74/configure.ac",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3658e937e3a46798bb50c7983984ab01e97bab74/configure.ac",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/configure.ac?ref=3658e937e3a46798bb50c7983984ab01e97bab74",
        "patch": "@@ -114,6 +114,12 @@ AC_ARG_ENABLE([glibc-back-compat],\n   [use_glibc_compat=$enableval],\n   [use_glibc_compat=no])\n \n+AC_ARG_ENABLE([zmq],\n+  [AC_HELP_STRING([--disable-zmq],\n+  [Disable ZMQ notifications])],\n+  [use_zmq=no],\n+  [use_zmq=yes])\n+\n AC_ARG_WITH([protoc-bindir],[AS_HELP_STRING([--with-protoc-bindir=BIN_DIR],[specify protoc bin path])], [protoc_bin_path=$withval], [])\n \n \n@@ -733,6 +739,22 @@ if test x$bitcoin_enable_qt != xno; then\n   fi\n fi\n \n+# conditional search for and use libzmq\n+AC_MSG_CHECKING([whether to build ZMQ support])\n+if test \"x$use_zmq\" == \"xyes\"; then\n+  AC_MSG_RESULT([yes])\n+  PKG_CHECK_MODULES([ZMQ],[libzmq],\n+    [AC_DEFINE([ENABLE_ZMQ],[1],[Define to 1 to enable ZMQ functions])],\n+    [AC_DEFINE([ENABLE_ZMQ],[0],[Define to 1 to enable ZMQ functions])\n+     AC_MSG_WARN([libzmq not found, disabling])\n+     use_zmq=no])\n+else\n+  AC_MSG_RESULT([no, --disable-zmq used])\n+  AC_DEFINE_UNQUOTED([ENABLE_ZMQ],[0],[Define to 1 to enable ZMQ functions])\n+fi\n+\n+AM_CONDITIONAL([ENABLE_ZMQ], [test \"x$use_zmq\" = \"xyes\"])\n+\n AC_MSG_CHECKING([whether to build test_bitcoin])\n if test x$use_tests = xyes; then\n   AC_MSG_RESULT([yes])"
      },
      {
        "sha": "22527e476e9d2bd9e1f175b5e3dbff6d4a33b5f8",
        "filename": "contrib/zmq/zmq_sub.py",
        "status": "added",
        "additions": 40,
        "deletions": 0,
        "changes": 40,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3658e937e3a46798bb50c7983984ab01e97bab74/contrib/zmq/zmq_sub.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3658e937e3a46798bb50c7983984ab01e97bab74/contrib/zmq/zmq_sub.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/zmq/zmq_sub.py?ref=3658e937e3a46798bb50c7983984ab01e97bab74",
        "patch": "@@ -0,0 +1,40 @@\n+#!/usr/bin/env python2\n+\n+import zmq\n+import binascii\n+\n+port = 28332\n+topic1 = \"BLK\"\n+topic2 = \"TXN\"\n+topic_len = len(topic1)\n+\n+zmqContext = zmq.Context()\n+zmqSubSocket = zmqContext.socket(zmq.SUB)\n+zmqSubSocket.setsockopt(zmq.SUBSCRIBE, topic1)\n+zmqSubSocket.setsockopt(zmq.SUBSCRIBE, topic2)\n+zmqSubSocket.connect(\"tcp://127.0.0.1:%i\" % port)\n+\n+\n+def handleBLK(blk):\n+    print \"-BLKHDR-\"\n+    print binascii.hexlify(blk[:80])\n+\n+\n+def handleTX(tx):\n+    print \"-TX-\"\n+    print binascii.hexlify(tx)\n+\n+\n+try:\n+    while True:\n+        msg = zmqSubSocket.recv()\n+        msg_topic = msg[:topic_len]\n+        msg_data  = msg[topic_len:]\n+\n+        if msg_topic == \"TXN\":\n+            handleTX(msg_data)\n+        elif msg_topic == \"BLK\":\n+            handleBLK(msg_data)\n+\n+except KeyboardInterrupt:\n+    zmqContext.destroy()"
      },
      {
        "sha": "f90c47f71c0ebf0560547d7080aaeba8a326de66",
        "filename": "doc/zmq.md",
        "status": "added",
        "additions": 145,
        "deletions": 0,
        "changes": 145,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3658e937e3a46798bb50c7983984ab01e97bab74/doc/zmq.md",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3658e937e3a46798bb50c7983984ab01e97bab74/doc/zmq.md",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/doc/zmq.md?ref=3658e937e3a46798bb50c7983984ab01e97bab74",
        "patch": "@@ -0,0 +1,145 @@\n+# Block and Transaction Broadcasting With ZeroMQ\n+\n+[ZeroMQ](http://zeromq.org/) is a lightweight wrapper around TCP\n+connections, inter-process communications, and shared-memory,\n+providing various message-oriented semantics such as publish/subcribe,\n+request/reply, and push/pull.\n+\n+The Bitcoin Core daemon can be configured to act as a trusted \"border\n+router\", implementing the bitcoin wire protocol and relay, making\n+consensus decisions, maintaining the local blockchain database,\n+broadcasting locally generated transactions into the network, and\n+providing a queryable RPC interface to interact on a polled basis for\n+requesting blockchain related data.  However, there exists only a\n+limited service to notify external software of events like the arrival\n+of new blocks or transactions.\n+\n+The ZeroMQ facility binds a \"publish\" port that broadcasts all newly\n+arrived *and validated* blocks and transactions to one or more\n+connected subscribers.  This read-only facility requires only the\n+connection of a corresponding ZeroMQ subscriber port in receiving\n+software; it is not authenticated nor is there any two-way protocol\n+involvement.\n+\n+In this fashion, external software can use a trusted Bitcoin Core\n+daemon to do the heavy lifting of communicating with the P2P network,\n+while still receiving network information asynchronously in real\n+time. As transactions and blocks arrive via the P2P network, Bitcoin\n+Core will apply all the validation and standardization rules to this\n+data, only passing along through ZeroMQ those items that pass.\n+\n+ZeroMQ sockets are self-connecting and self-healing; that is, connects\n+made between two endpoints will be automatically restored after an\n+outage, and either end may be freely started or stopped in any order.\n+\n+Because ZeroMQ is message oriented, subscribers receive transactions\n+and blocks all-at-once and do not need to implement any sort of\n+buffering or reassembly.\n+\n+## Prerequisites\n+\n+The ZeroMQ feature in Bitcoin Core uses only a very small part of the\n+ZeroMQ C API, and is thus compatible with any version of ZeroMQ\n+from 2.1 onward, including all versions in the 3.x and 4.x release\n+series.  Typically, it is packaged by distributions as something like\n+*libzmq-dev*.\n+\n+The C++ wrapper for ZeroMQ is *not* needed.\n+\n+## Enabling\n+\n+By default, the ZeroMQ port functionality is disabled.  Two steps are\n+required to enable--compiling in the ZeroMQ code, and configuring\n+runtime operation on the command-line or configuration file.\n+\n+    $ ./configure --enable-zmq (other options)\n+\n+This will produce a binary that is capable of providing the ZeroMQ\n+facility, but will not do so until also configured properly.\n+\n+## Configuration\n+\n+Currently, the ZeroMQ facility only needs to have the ZeroMQ endpoint\n+specified:\n+\n+    $ bitcoind -zmqpub=tcp://127.0.0.1/28332\n+\n+This will cause bitcoind to establish a PUB listening socket at the\n+specified host address and port number.  The endpoint specifier may\n+also be provided as the equivalent line item in bitcoin.conf.\n+\n+ZeroMQ endpoint specifiers for TCP (and others) are documented in the\n+[ZeroMQ API](http://api.zeromq.org).\n+\n+## Operation\n+\n+ZeroMQ publish sockets prepend each data item with an arbitrary topic\n+prefix that allows subscriber clients to request only those items with\n+a matching prefix.  When publishing, bitcoind will prepend the topic\n+\"TXN\" (no quotes, no null terminator) to the binary, serialized form\n+of a published transaction, and \"BLK\" to the binary, serialized form\n+of a published block.\n+\n+Client side, then, the ZeroMQ subscriber socket must have the\n+ZMQ_SUBSCRIBE option set to one or either of these prefixes; without\n+doing so will result in no messages arriving.\n+\n+Here is a small example, in the Python language, using the\n+*python-zmq* wrapper:\n+\n+    import zmq\n+    import binascii\n+\n+    port = 28332\n+    topic1 = \"BLK\"\n+    topic2 = \"TXN\"\n+    topic_len = len(topic1)\n+\n+    zmqContext = zmq.Context()\n+    zmqSubSocket = zmqContext.socket(zmq.SUB)\n+    zmqSubSocket.setsockopt(zmq.SUBSCRIBE, topic1)\n+    zmqSubSocket.setsockopt(zmq.SUBSCRIBE, topic2)\n+    zmqSubSocket.connect(\"tcp://127.0.0.1:%i\" % port)\n+\n+    def handleBLK(blk):\n+        print \"-BLKHDR-\"\n+        print binascii.hexlify(blk[:80])\n+\n+    def handleTX(tx):\n+        print \"-TX-\"\n+        print binascii.hexlify(tx)\n+\n+    try:\n+        while True:\n+            msg = zmqSubSocket.recv()\n+            msg_topic = msg[:topic_len]\n+            msg_data  = msg[topic_len:]\n+\n+            if msg_topic == \"TXN\":\n+                handleTX(msg_data)\n+            elif msg_topic == \"BLK\":\n+                handleBLK(msg_data)\n+\n+    except KeyboardInterrupt:\n+        zmqContext.destroy()\n+\n+\n+This example is provided in the contrib/zmq directory of the source\n+code.\n+\n+## Security Considerations\n+\n+From the perspective of bitcoind, the ZeroMQ socket is write-only; PUB\n+sockets don't even have a read function.  Thus, there is no state\n+introduced into bitcoind directly.  Furthermore, no information is\n+broadcast that wasn't already received from the public P2P network.\n+\n+No authentication or authorization is done on connecting clients; it\n+is assumed that the ZeroMQ port is exposed only to trusted entities,\n+using other means such as firewalling.\n+\n+Transactions and blocks are broadcast in their serialized form\n+directly as received and validated by bitcoind.  External software may\n+assume that these have passed all validity/consensus/standard checks,\n+but of course is free to perform these functions again in part or in\n+whole."
      },
      {
        "sha": "8e5bd0d87e70fcf85a45c90986fe7e37985f679d",
        "filename": "src/Makefile.am",
        "status": "modified",
        "additions": 6,
        "deletions": 0,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3658e937e3a46798bb50c7983984ab01e97bab74/src/Makefile.am",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3658e937e3a46798bb50c7983984ab01e97bab74/src/Makefile.am",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/Makefile.am?ref=3658e937e3a46798bb50c7983984ab01e97bab74",
        "patch": "@@ -112,6 +112,7 @@ BITCOIN_CORE_H = \\\n   version.h \\\n   walletdb.h \\\n   wallet.h \\\n+  zmqports.h \\\n   compat/sanity.h\n \n JSON_H = \\\n@@ -154,6 +155,7 @@ libbitcoin_server_a_SOURCES = \\\n   timedata.cpp \\\n   txdb.cpp \\\n   txmempool.cpp \\\n+  zmqports.cpp \\\n   $(JSON_H) \\\n   $(BITCOIN_CORE_H)\n \n@@ -255,6 +257,10 @@ endif\n bitcoind_SOURCES = bitcoind.cpp\n #\n \n+if ENABLE_ZMQ\n+bitcoind_LDADD += $(ZMQ_LIBS)\n+endif\n+\n if TARGET_WINDOWS\n bitcoind_SOURCES += bitcoind-res.rc\n endif"
      },
      {
        "sha": "737306316aa4ff71b487a2ddcf98d51556884067",
        "filename": "src/Makefile.qt.include",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3658e937e3a46798bb50c7983984ab01e97bab74/src/Makefile.qt.include",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3658e937e3a46798bb50c7983984ab01e97bab74/src/Makefile.qt.include",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/Makefile.qt.include?ref=3658e937e3a46798bb50c7983984ab01e97bab74",
        "patch": "@@ -357,6 +357,9 @@ qt_bitcoin_qt_LDADD = qt/libbitcoinqt.a $(LIBBITCOIN_SERVER)\n if ENABLE_WALLET\n qt_bitcoin_qt_LDADD += $(LIBBITCOIN_WALLET)\n endif\n+if ENABLE_ZMQ\n+qt_bitcoin_qt_LDADD += $(ZMQ_LIBS)\n+endif\n qt_bitcoin_qt_LDADD += $(LIBBITCOIN_CLI) $(LIBBITCOIN_COMMON) $(LIBBITCOIN_UTIL) $(LIBBITCOIN_CRYPTO) $(LIBBITCOIN_UNIVALUE) $(LIBLEVELDB) $(LIBMEMENV) \\\n   $(BOOST_LIBS) $(QT_LIBS) $(QT_DBUS_LIBS) $(QR_LIBS) $(PROTOBUF_LIBS) $(BDB_LIBS) $(SSL_LIBS) $(CRYPTO_LIBS)\n if USE_LIBSECP256K1"
      },
      {
        "sha": "6aacdf0872d9ae5b2681574eaa580b281813d490",
        "filename": "src/Makefile.qttest.include",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3658e937e3a46798bb50c7983984ab01e97bab74/src/Makefile.qttest.include",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3658e937e3a46798bb50c7983984ab01e97bab74/src/Makefile.qttest.include",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/Makefile.qttest.include?ref=3658e937e3a46798bb50c7983984ab01e97bab74",
        "patch": "@@ -30,6 +30,9 @@ qt_test_test_bitcoin_qt_LDADD = $(LIBBITCOINQT) $(LIBBITCOIN_SERVER)\n if ENABLE_WALLET\n qt_test_test_bitcoin_qt_LDADD += $(LIBBITCOIN_WALLET)\n endif\n+if ENABLE_ZMQ\n+qt_test_test_bitcoin_qt_LDADD += $(ZMQ_LIBS)\n+endif\n qt_test_test_bitcoin_qt_LDADD += $(LIBBITCOIN_CLI) $(LIBBITCOIN_COMMON) $(LIBBITCOIN_UTIL) $(LIBBITCOIN_CRYPTO) $(LIBBITCOIN_UNIVALUE) $(LIBLEVELDB) \\\n   $(LIBMEMENV) $(BOOST_LIBS) $(QT_DBUS_LIBS) $(QT_TEST_LIBS) $(QT_LIBS) \\\n   $(QR_LIBS) $(PROTOBUF_LIBS) $(BDB_LIBS) $(SSL_LIBS) $(CRYPTO_LIBS)"
      },
      {
        "sha": "331a860d6afc6e166c18f83c789f45fb8227bc47",
        "filename": "src/Makefile.test.include",
        "status": "modified",
        "additions": 4,
        "deletions": 0,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3658e937e3a46798bb50c7983984ab01e97bab74/src/Makefile.test.include",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3658e937e3a46798bb50c7983984ab01e97bab74/src/Makefile.test.include",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/Makefile.test.include?ref=3658e937e3a46798bb50c7983984ab01e97bab74",
        "patch": "@@ -70,6 +70,10 @@ if ENABLE_WALLET\n test_test_bitcoin_LDADD += $(LIBBITCOIN_WALLET)\n endif\n \n+if ENABLE_ZMQ\n+test_test_bitcoin_LDADD += $(ZMQ_LIBS)\n+endif\n+\n if USE_LIBSECP256K1\n   test_test_bitcoin_LDADD += secp256k1/libsecp256k1.la\n endif"
      },
      {
        "sha": "5e1660a1e84d2fd94c93279bd716f980abacc211",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 9,
        "deletions": 1,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3658e937e3a46798bb50c7983984ab01e97bab74/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3658e937e3a46798bb50c7983984ab01e97bab74/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=3658e937e3a46798bb50c7983984ab01e97bab74",
        "patch": "@@ -24,6 +24,7 @@\n #include \"wallet.h\"\n #include \"walletdb.h\"\n #endif\n+#include \"zmqports.h\"\n \n #include <stdint.h>\n #include <stdio.h>\n@@ -157,6 +158,8 @@ void Shutdown()\n     if (pwalletMain)\n         bitdb.Flush(true);\n #endif\n+    if (fZMQPub)\n+      ZMQShutdown();\n     boost::filesystem::remove(GetPidFile());\n     UnregisterAllWallets();\n #ifdef ENABLE_WALLET\n@@ -282,7 +285,7 @@ std::string HelpMessage(HelpMessageMode mode)\n     strUsage += \"  -zapwallettxes=<mode>  \" + _(\"Delete all wallet transactions and only recover those parts of the blockchain through -rescan on startup\") + \"\\n\";\n     strUsage += \"                         \" + _(\"(default: 1, 1 = keep tx meta data e.g. account owner and payment request information, 2 = drop tx meta data)\") + \"\\n\";\n #endif\n-\n+    strUsage += \"  -zmqpub=<endpoint>     \" + _(\"Publish blocks and transactions on ZMQ port 'endpoint'\") + \"\\n\";\n     strUsage += \"\\n\" + _(\"Debugging/Testing options:\") + \"\\n\";\n     if (GetBoolArg(\"-help-debug\", false))\n     {\n@@ -877,6 +880,11 @@ bool AppInit2(boost::thread_group& threadGroup)\n     BOOST_FOREACH(string strDest, mapMultiArgs[\"-seednode\"])\n         AddOneShot(strDest);\n \n+    if (mapArgs.count(\"-zmqpub\")) {\n+      ZMQInitialize(mapArgs[\"-zmqpub\"]);\n+    }\n+\n+\n     // ********************************************************* Step 7: load block chain\n \n     fReindex = GetBoolArg(\"-reindex\", false);"
      },
      {
        "sha": "9cf724a00ac8d258ce7f3bbfcd8f6a8e4793c956",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 0,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3658e937e3a46798bb50c7983984ab01e97bab74/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3658e937e3a46798bb50c7983984ab01e97bab74/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=3658e937e3a46798bb50c7983984ab01e97bab74",
        "patch": "@@ -17,6 +17,7 @@\n #include \"txmempool.h\"\n #include \"ui_interface.h\"\n #include \"util.h\"\n+#include \"zmqports.h\"\n \n #include <sstream>\n \n@@ -2545,6 +2546,9 @@ bool AcceptBlock(CBlock& block, CValidationState& state, CBlockIndex** ppindex,\n         return state.Abort(_(\"System error: \") + e.what());\n     }\n \n+    if (fZMQPub)\n+      ZMQPublishBlock(block);\n+\n     return true;\n }\n "
      },
      {
        "sha": "66047fac6a95d9a0fe7ab38665b9fa1d71ed38d1",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 0,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3658e937e3a46798bb50c7983984ab01e97bab74/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3658e937e3a46798bb50c7983984ab01e97bab74/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=3658e937e3a46798bb50c7983984ab01e97bab74",
        "patch": "@@ -13,6 +13,7 @@\n #include \"chainparams.h\"\n #include \"core.h\"\n #include \"ui_interface.h\"\n+#include \"zmqports.h\"\n \n #ifdef WIN32\n #include <string.h>\n@@ -1876,6 +1877,9 @@ void RelayTransaction(const CTransaction& tx, const CDataStream& ss)\n         } else\n             pnode->PushInventory(inv);\n     }\n+\n+    if (fZMQPub)\n+      ZMQPublishTransaction(tx);\n }\n \n void CNode::RecordBytesRecv(uint64_t bytes)"
      },
      {
        "sha": "c9117e9a1c288f1a3849bd8a2d0a9453a223d0eb",
        "filename": "src/rpcserver.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3658e937e3a46798bb50c7983984ab01e97bab74/src/rpcserver.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3658e937e3a46798bb50c7983984ab01e97bab74/src/rpcserver.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpcserver.cpp?ref=3658e937e3a46798bb50c7983984ab01e97bab74",
        "patch": "@@ -248,6 +248,9 @@ static const CRPCCommand vRPCCommands[] =\n     { \"network\",            \"getpeerinfo\",            &getpeerinfo,            true,      false,      false },\n     { \"network\",            \"ping\",                   &ping,                   true,      false,      false },\n \n+    /* ZMQ notification */\n+    { \"zmq\",                \"getzmqurl\",              &getzmqurl,              true,      true,       false },\n+\n     /* Block chain and UTXO */\n     { \"blockchain\",         \"getblockchaininfo\",      &getblockchaininfo,      true,      false,      false },\n     { \"blockchain\",         \"getbestblockhash\",       &getbestblockhash,       true,      false,      false },"
      },
      {
        "sha": "7d7d6966d9c8141d8fac324cf99799ec3d7b1642",
        "filename": "src/rpcserver.h",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3658e937e3a46798bb50c7983984ab01e97bab74/src/rpcserver.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3658e937e3a46798bb50c7983984ab01e97bab74/src/rpcserver.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpcserver.h?ref=3658e937e3a46798bb50c7983984ab01e97bab74",
        "patch": "@@ -185,7 +185,7 @@ extern json_spirit::Value getinfo(const json_spirit::Array& params, bool fHelp);\n extern json_spirit::Value getwalletinfo(const json_spirit::Array& params, bool fHelp);\n extern json_spirit::Value getblockchaininfo(const json_spirit::Array& params, bool fHelp);\n extern json_spirit::Value getnetworkinfo(const json_spirit::Array& params, bool fHelp);\n-\n+extern json_spirit::Value getzmqurl(const json_spirit::Array &params, bool fHelp);\n extern json_spirit::Value getrawtransaction(const json_spirit::Array& params, bool fHelp); // in rcprawtransaction.cpp\n extern json_spirit::Value listunspent(const json_spirit::Array& params, bool fHelp);\n extern json_spirit::Value lockunspent(const json_spirit::Array& params, bool fHelp);"
      },
      {
        "sha": "0e68b965f3892d1a167e3d8f5e8f47f25c1068a8",
        "filename": "src/zmqports.cpp",
        "status": "added",
        "additions": 173,
        "deletions": 0,
        "changes": 173,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3658e937e3a46798bb50c7983984ab01e97bab74/src/zmqports.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3658e937e3a46798bb50c7983984ab01e97bab74/src/zmqports.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/zmqports.cpp?ref=3658e937e3a46798bb50c7983984ab01e97bab74",
        "patch": "@@ -0,0 +1,173 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2014 The Bitcoin developers\n+// Distributed under the MIT/X11 software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#if defined(HAVE_CONFIG_H)\n+#include \"config/bitcoin-config.h\"\n+#endif\n+\n+#include \"zmqports.h\"\n+\n+#if ENABLE_ZMQ\n+#include <zmq.h>\n+#endif\n+\n+#include \"core.h\"\n+#include \"netbase.h\"\n+#include \"json/json_spirit_value.h\"\n+\n+using namespace json_spirit;\n+using namespace std;\n+\n+// Global state\n+bool fZMQPub = false;\n+\n+#if ENABLE_ZMQ\n+// ZMQ related file scope variables\n+static void *zmqContext;\n+static void *zmqPubSocket;\n+\n+// Internal utility functions\n+static void zmqError(const char *str)\n+{\n+  LogPrint(\"ZMQ error: %s, errno=%s\\n\", str, zmq_strerror(errno));\n+}\n+#endif\n+\n+// Called at startup to conditionally set up ZMQ socket(s)\n+void ZMQInitialize(const std::string &endp)\n+{\n+#if ENABLE_ZMQ\n+  zmqContext = zmq_init(1);\n+  if (!zmqContext) {\n+    zmqError(\"Unable to initialize ZMQ context\");\n+    return;\n+  }\n+\n+  zmqPubSocket = zmq_socket(zmqContext, ZMQ_PUB);\n+  if (!zmqPubSocket) {\n+    zmqError(\"Unable to open ZMQ pub socket\");\n+    return;\n+  }\n+\n+  int rc = zmq_bind(zmqPubSocket, endp.c_str());\n+  if (rc != 0) {\n+    zmqError(\"Unable to bind ZMQ socket\");\n+    zmq_close(zmqPubSocket);\n+    zmqPubSocket = 0;\n+    return;\n+  }\n+\n+  fZMQPub = true;\n+  LogPrint(\"zmq\", \"PUB socket listening at %s\\n\", endp);\n+#endif\n+}\n+\n+#if ENABLE_ZMQ\n+// Internal function to publish a serialized data stream on a given\n+// topic\n+//\n+// Note: assumes topic is a valid null terminated C string\n+static void zmqPublish(const char *topic, const CDataStream &ss)\n+{\n+  zmq_msg_t msg;\n+  const unsigned int topiclen = strlen(topic);\n+  const unsigned int msglen = ss.size() + topiclen;\n+\n+  // Initialize a new zmq_msg_t to hold serialized content\n+  int rc = zmq_msg_init_size(&msg, msglen);\n+  if (rc) {\n+    zmqError(\"Unable to initialize ZMQ msg\");\n+    return;\n+  }\n+\n+  // Copy topic and serialized TX into message buffer\n+  unsigned char *buf = (unsigned char *)zmq_msg_data(&msg);\n+  memcpy(&buf[0], topic, topiclen); // omits null trailer\n+  memcpy(&buf[topiclen], &ss[0], ss.size());\n+\n+  // Fire-and-forget\n+  rc = zmq_msg_send(&msg, zmqPubSocket, 0);\n+  if (rc == -1) {\n+    zmqError(\"Unable to send ZMQ message\");\n+    return;\n+  }\n+\n+  LogPrint(\"zmq\", \"Published to topic %s\\n\", topic);\n+}\n+#endif\n+\n+// Called after all transaction relay checks are completed\n+void ZMQPublishTransaction(const CTransaction &tx)\n+{\n+#if ENABLE_ZMQ\n+  if (!zmqPubSocket)\n+    return;\n+\n+  // Serialize transaction\n+  CDataStream ss(SER_NETWORK, PROTOCOL_VERSION);\n+  ss.reserve(10000); // FIXME used defined constant\n+  ss << tx;\n+\n+  zmqPublish(\"TXN\", ss);\n+#endif\n+}\n+\n+// Called after all block checks completed and successfully added to\n+// disk index\n+void ZMQPublishBlock(const CBlock &blk)\n+{\n+#if ENABLE_ZMQ\n+  if (!zmqPubSocket)\n+    return;\n+\n+  // Serialize block\n+  CDataStream ss(SER_NETWORK, PROTOCOL_VERSION);\n+  ss.reserve(1000000); // FIXME use defined constant\n+  ss << blk;\n+\n+  zmqPublish(\"BLK\", ss);\n+#endif\n+}\n+\n+// Called during shutdown sequence\n+void ZMQShutdown()\n+{\n+#if ENABLE_ZMQ\n+  if (zmqContext) {\n+    if (zmqPubSocket) {\n+      // Discard any unread messages and close socket\n+      int linger = 0;\n+      zmq_setsockopt(zmqPubSocket, ZMQ_LINGER, &linger, sizeof(linger));\n+      zmq_close(zmqPubSocket);\n+      zmqPubSocket = 0;\n+    }\n+\n+    zmq_ctx_destroy(zmqContext);\n+    zmqContext = 0;\n+  }\n+#endif\n+\n+  fZMQPub = false;\n+}\n+\n+Value getzmqurl(const Array& params, bool fHelp)\n+{\n+    if (fHelp || params.size() != 0)\n+        throw runtime_error(\n+            \"getzmqurl\\n\"\n+            \"Returns an object containing ZMQ notification endpoint.\\n\"\n+            \"\\nResult:\\n\"\n+            \"{\\n\"\n+            \"  \\\"zmqurl\\\": \\\"tcp//xxx:xx\\\",   (string) the ZMQ endpoint specifier\\n\"\n+            \"}\\n\"\n+        );\n+\n+    proxyType proxy;\n+    GetProxy(NET_IPV4, proxy);\n+\n+    Object obj;\n+    obj.push_back(Pair(\"zmqurl\", mapArgs[\"-zmqpub\"]));\n+    return obj;\n+}"
      },
      {
        "sha": "b2182cca533e498b1e9e111a07be23878af31802",
        "filename": "src/zmqports.h",
        "status": "added",
        "additions": 21,
        "deletions": 0,
        "changes": 21,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3658e937e3a46798bb50c7983984ab01e97bab74/src/zmqports.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3658e937e3a46798bb50c7983984ab01e97bab74/src/zmqports.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/zmqports.h?ref=3658e937e3a46798bb50c7983984ab01e97bab74",
        "patch": "@@ -0,0 +1,21 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2014 The Bitcoin developers\n+// Distributed under the MIT/X11 software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+#ifndef ZMQPORTS_H\n+#define ZMQPORTS_H\n+\n+#include <string>\n+\n+class CBlock;\n+class CTransaction;\n+\n+// Global state\n+extern bool fZMQPub;\n+\n+void ZMQInitialize(const std::string &endp);\n+void ZMQPublishBlock(const CBlock &blk);\n+void ZMQPublishTransaction(const CTransaction &tx);\n+void ZMQShutdown();\n+\n+#endif"
      }
    ]
  },
  {
    "sha": "3c9d0c12ac2476fc8fb5de9293edbf27081b1d4e",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozYzlkMGMxMmFjMjQ3NmZjOGZiNWRlOTI5M2VkYmYyNzA4MWIxZDRl",
    "commit": {
      "author": {
        "name": "Johnathan Corgan",
        "email": "johnathan@corganlabs.com",
        "date": "2014-08-18T13:46:42Z"
      },
      "committer": {
        "name": "Johnathan Corgan",
        "email": "johnathan@corganlabs.com",
        "date": "2014-08-18T13:46:42Z"
      },
      "message": "zmq: require version >= 2.1",
      "tree": {
        "sha": "bfdde97055ca1c6bf571d5114045e6bfb6520aee",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/bfdde97055ca1c6bf571d5114045e6bfb6520aee"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3c9d0c12ac2476fc8fb5de9293edbf27081b1d4e",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3c9d0c12ac2476fc8fb5de9293edbf27081b1d4e",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/3c9d0c12ac2476fc8fb5de9293edbf27081b1d4e",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3c9d0c12ac2476fc8fb5de9293edbf27081b1d4e/comments",
    "author": {
      "login": "jmcorgan",
      "id": 1492956,
      "node_id": "MDQ6VXNlcjE0OTI5NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1492956?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jmcorgan",
      "html_url": "https://github.com/jmcorgan",
      "followers_url": "https://api.github.com/users/jmcorgan/followers",
      "following_url": "https://api.github.com/users/jmcorgan/following{/other_user}",
      "gists_url": "https://api.github.com/users/jmcorgan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jmcorgan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jmcorgan/subscriptions",
      "organizations_url": "https://api.github.com/users/jmcorgan/orgs",
      "repos_url": "https://api.github.com/users/jmcorgan/repos",
      "events_url": "https://api.github.com/users/jmcorgan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jmcorgan/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jmcorgan",
      "id": 1492956,
      "node_id": "MDQ6VXNlcjE0OTI5NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1492956?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jmcorgan",
      "html_url": "https://github.com/jmcorgan",
      "followers_url": "https://api.github.com/users/jmcorgan/followers",
      "following_url": "https://api.github.com/users/jmcorgan/following{/other_user}",
      "gists_url": "https://api.github.com/users/jmcorgan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jmcorgan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jmcorgan/subscriptions",
      "organizations_url": "https://api.github.com/users/jmcorgan/orgs",
      "repos_url": "https://api.github.com/users/jmcorgan/repos",
      "events_url": "https://api.github.com/users/jmcorgan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jmcorgan/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "3658e937e3a46798bb50c7983984ab01e97bab74",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3658e937e3a46798bb50c7983984ab01e97bab74",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/3658e937e3a46798bb50c7983984ab01e97bab74"
      }
    ],
    "stats": {
      "total": 10,
      "additions": 5,
      "deletions": 5
    },
    "files": [
      {
        "sha": "4cb0ea6ac51c961e8fb50373a8a6ce1b8d2e0fb0",
        "filename": "configure.ac",
        "status": "modified",
        "additions": 5,
        "deletions": 5,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3c9d0c12ac2476fc8fb5de9293edbf27081b1d4e/configure.ac",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3c9d0c12ac2476fc8fb5de9293edbf27081b1d4e/configure.ac",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/configure.ac?ref=3c9d0c12ac2476fc8fb5de9293edbf27081b1d4e",
        "patch": "@@ -150,7 +150,7 @@ AC_PATH_PROG(XGETTEXT,xgettext)\n AC_PATH_PROG(HEXDUMP,hexdump)\n PKG_PROG_PKG_CONFIG\n \n-# Enable debug \n+# Enable debug\n AC_ARG_ENABLE([debug],\n     [AS_HELP_STRING([--enable-debug],\n                     [use debug compiler flags and macros (default is no)])],\n@@ -161,11 +161,11 @@ if test \"x$enable_debug\" = xyes; then\n     if test \"x$GCC\" = xyes; then\n         CFLAGS=\"-g3 -O0 -DDEBUG\"\n     fi\n-    \n+\n     if test \"x$GXX\" = xyes; then\n         CXXFLAGS=\"-g3 -O0 -DDEBUG\"\n     fi\n-fi \n+fi\n \n ## TODO: Remove these hard-coded paths and flags. They are here for the sake of\n ##       compatibility with the legacy buildsystem.\n@@ -743,10 +743,10 @@ fi\n AC_MSG_CHECKING([whether to build ZMQ support])\n if test \"x$use_zmq\" == \"xyes\"; then\n   AC_MSG_RESULT([yes])\n-  PKG_CHECK_MODULES([ZMQ],[libzmq],\n+  PKG_CHECK_MODULES([ZMQ],[libzmq >= 2.1],\n     [AC_DEFINE([ENABLE_ZMQ],[1],[Define to 1 to enable ZMQ functions])],\n     [AC_DEFINE([ENABLE_ZMQ],[0],[Define to 1 to enable ZMQ functions])\n-     AC_MSG_WARN([libzmq not found, disabling])\n+     AC_MSG_WARN([libzmq >= 2.1 not found, disabling])\n      use_zmq=no])\n else\n   AC_MSG_RESULT([no, --disable-zmq used])"
      }
    ]
  }
]