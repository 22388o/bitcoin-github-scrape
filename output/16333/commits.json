[
  {
    "sha": "fac90c55be478f0323eafa1d560ea2c56f04fb23",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYWM5MGM1NWJlNDc4ZjAzMjNlYWZhMWQ1NjBlYTJjNTZmMDRmYjIz",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2019-07-03T14:14:55Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2021-06-18T15:53:53Z"
      },
      "message": "test: Create all blocks with version 4 or higher",
      "tree": {
        "sha": "50c5ae560f4672f2e094a4e00a690e002655682c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/50c5ae560f4672f2e094a4e00a690e002655682c"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fac90c55be478f0323eafa1d560ea2c56f04fb23",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\npUg++wwAqijuM1FVO+pBvkUq/NCKGhgZhWze7UQKw78r2qCGcaXtyEmyqvuR1qYc\nRqvEfA/v3N1Fflyv5+3esJZKuAvYn/KXjNEObjnqXsf9kY64tzoq0rLraOt1c9fY\nvuMHRLzfp2ZAtLjXDqlq5ojI0qaY3qtuPDHIuFQMVscGF6m8NIg09fshRdzzf3fA\njM0f0RNKKmHCe4P6tXStMtuHbyYkbOWu87HeEDQSCYFFjasBs58orvqfX0jMm6uB\nmxeaHUQvLb78dHXpp3j+kkv84XHPR4wyufmXvvvPYUGKjRnf3JOEoi8Q77K7udvf\n3LKToMrov1aAynIRjWkq/FUf2ms594wiLHTlHaDvilkc6GXDP1gWwQo5pxGITFox\nc8kWok9gCd8/AnovL2UG5chXkuTCZT6dSuRyJeZBpPhVTDbqDU0gg/Ylt3LwSH8w\nH9K7+VFOUvZktR6Yqymen24Z0p3KIO93GSZvb+u3vNqoWeqIe+IAe50pUjAux4kd\npmjRucTC\n=cNRX\n-----END PGP SIGNATURE-----",
        "payload": "tree 50c5ae560f4672f2e094a4e00a690e002655682c\nparent 8cb43077b3705ca7b34f9e7d981d19d600213e98\nauthor MarcoFalke <falke.marco@gmail.com> 1562163295 +0200\ncommitter MarcoFalke <falke.marco@gmail.com> 1624031633 +0200\n\ntest: Create all blocks with version 4 or higher\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fac90c55be478f0323eafa1d560ea2c56f04fb23",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fac90c55be478f0323eafa1d560ea2c56f04fb23",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fac90c55be478f0323eafa1d560ea2c56f04fb23/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "8cb43077b3705ca7b34f9e7d981d19d600213e98",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8cb43077b3705ca7b34f9e7d981d19d600213e98",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/8cb43077b3705ca7b34f9e7d981d19d600213e98"
      }
    ],
    "stats": {
      "total": 5,
      "additions": 3,
      "deletions": 2
    },
    "files": [
      {
        "sha": "fe441a093e2543265e0c0ddbf9e5010c279c5c27",
        "filename": "test/functional/test_framework/blocktools.py",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fac90c55be478f0323eafa1d560ea2c56f04fb23/test/functional/test_framework/blocktools.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fac90c55be478f0323eafa1d560ea2c56f04fb23/test/functional/test_framework/blocktools.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/test_framework/blocktools.py?ref=fac90c55be478f0323eafa1d560ea2c56f04fb23",
        "patch": "@@ -59,14 +59,15 @@\n WITNESS_COMMITMENT_HEADER = b\"\\xaa\\x21\\xa9\\xed\"\n \n NORMAL_GBT_REQUEST_PARAMS = {\"rules\": [\"segwit\"]}\n+VERSIONBITS_LAST_OLD_BLOCK_VERSION = 4\n \n \n def create_block(hashprev=None, coinbase=None, ntime=None, *, version=None, tmpl=None, txlist=None):\n     \"\"\"Create a block (with regtest difficulty).\"\"\"\n     block = CBlock()\n     if tmpl is None:\n         tmpl = {}\n-    block.nVersion = version or tmpl.get('version') or 1\n+    block.nVersion = version or tmpl.get('version') or VERSIONBITS_LAST_OLD_BLOCK_VERSION\n     block.nTime = ntime or tmpl.get('curtime') or int(time.time() + 600)\n     block.hashPrevBlock = hashprev or int(tmpl['previousblockhash'], 0x10)\n     if tmpl and not tmpl.get('bits') is None:"
      },
      {
        "sha": "f3be9c4e5f27fe177ee4560b33b0c92ae284c667",
        "filename": "test/functional/test_framework/messages.py",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fac90c55be478f0323eafa1d560ea2c56f04fb23/test/functional/test_framework/messages.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fac90c55be478f0323eafa1d560ea2c56f04fb23/test/functional/test_framework/messages.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/test_framework/messages.py?ref=fac90c55be478f0323eafa1d560ea2c56f04fb23",
        "patch": "@@ -615,7 +615,7 @@ def __init__(self, header=None):\n             self.calc_sha256()\n \n     def set_null(self):\n-        self.nVersion = 1\n+        self.nVersion = 4\n         self.hashPrevBlock = 0\n         self.hashMerkleRoot = 0\n         self.nTime = 0"
      }
    ]
  },
  {
    "sha": "222290f54388270937cb6c174195717e2214ec0d",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyMjIyOTBmNTQzODgyNzA5MzdjYjZjMTc0MTk1NzE3ZTIyMTRlYzBk",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2019-07-03T14:37:00Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2021-06-18T18:58:03Z"
      },
      "message": "test: Set BIP34Height = 2 for regtest",
      "tree": {
        "sha": "cedf5bf567380c242fcf2d3eea18dd67a5b08d90",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/cedf5bf567380c242fcf2d3eea18dd67a5b08d90"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/222290f54388270937cb6c174195717e2214ec0d",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\npUgBkAv9FHV/YDgc8W1FoYo69T6+XC8N/7japr7kpjSvCzMQOL3Gvrm0hZsTjYi1\nrsJir2mAWZKGTLqe7HW9jiwdSGjpcfO7lg8Y0+rjafIxoz+ioSJksIeWFZO0hETd\n/DfUEdeYxyo1U3X/RQf/JponDpqTFgkfLDRo1r8oZXe74PeMTMvmbLTFIro8nLjD\nJQ1QFD6eDbYFFNSgvUq3mC/WQQFAremTrDM4phbMGJPHneYlkc6hWqIklAbjtbp7\naCjfJ2B1lNdyxOWhSLwxSF3SPB5TCqbeDtSNseCHmtUDeBmfHEVVJC83ierPAUY1\nenteiGYs0KdDyRL2GHXSIOOeuPBrtNmvOL0pecE6T6iwzZV7JVqluA6MQNkca6z/\nQO+A9WgMQFhayh0voIfQv4QBEgqHVlAQUdGVlvN+hZlekPwZwyiq+4dslKhhHxg8\ngtpnQazcCrTuw3uAqq8up4StWsPreRoIHVCVFRq9k4kmoTHfPGAkfo90D4n2GIi2\nqJiKgqYH\n=Y4UV\n-----END PGP SIGNATURE-----",
        "payload": "tree cedf5bf567380c242fcf2d3eea18dd67a5b08d90\nparent fac90c55be478f0323eafa1d560ea2c56f04fb23\nauthor MarcoFalke <falke.marco@gmail.com> 1562164620 +0200\ncommitter MarcoFalke <falke.marco@gmail.com> 1624042683 +0200\n\ntest: Set BIP34Height = 2 for regtest\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/222290f54388270937cb6c174195717e2214ec0d",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/222290f54388270937cb6c174195717e2214ec0d",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/222290f54388270937cb6c174195717e2214ec0d/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "fac90c55be478f0323eafa1d560ea2c56f04fb23",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fac90c55be478f0323eafa1d560ea2c56f04fb23",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/fac90c55be478f0323eafa1d560ea2c56f04fb23"
      }
    ],
    "stats": {
      "total": 27,
      "additions": 15,
      "deletions": 12
    },
    "files": [
      {
        "sha": "1a0af6ffeaaebb95ab628ddf7b300b8c63f1a997",
        "filename": "src/chainparams.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/222290f54388270937cb6c174195717e2214ec0d/src/chainparams.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/222290f54388270937cb6c174195717e2214ec0d/src/chainparams.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/chainparams.cpp?ref=222290f54388270937cb6c174195717e2214ec0d",
        "patch": "@@ -390,7 +390,7 @@ class CRegTestParams : public CChainParams {\n         consensus.signet_challenge.clear();\n         consensus.nSubsidyHalvingInterval = 150;\n         consensus.BIP16Exception = uint256();\n-        consensus.BIP34Height = 500; // BIP34 activated on regtest (Used in functional tests)\n+        consensus.BIP34Height = 2; // BIP34 activated on regtest (Block at height 1 not enforced for testing purposes)\n         consensus.BIP34Hash = uint256();\n         consensus.BIP65Height = 1351; // BIP65 activated on regtest (Used in functional tests)\n         consensus.BIP66Height = 1251; // BIP66 activated on regtest (Used in functional tests)"
      },
      {
        "sha": "8f4ff6815bdd63e33e36fac1d5cff99bf9ffb2a1",
        "filename": "src/test/validation_block_tests.cpp",
        "status": "modified",
        "additions": 9,
        "deletions": 9,
        "changes": 18,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/222290f54388270937cb6c174195717e2214ec0d/src/test/validation_block_tests.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/222290f54388270937cb6c174195717e2214ec0d/src/test/validation_block_tests.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/validation_block_tests.cpp?ref=222290f54388270937cb6c174195717e2214ec0d",
        "patch": "@@ -77,22 +77,29 @@ std::shared_ptr<CBlock> MinerTestingSetup::Block(const uint256& prev_hash)\n     txCoinbase.vout[1].nValue = txCoinbase.vout[0].nValue;\n     txCoinbase.vout[0].nValue = 0;\n     txCoinbase.vin[0].scriptWitness.SetNull();\n+    // Always pad with OP_0 at the end to avoid bad-cb-length error\n+    txCoinbase.vin[0].scriptSig = CScript{} << WITH_LOCK(::cs_main, return m_node.chainman->m_blockman.LookupBlockIndex(prev_hash)->nHeight + 1) << OP_0;\n     pblock->vtx[0] = MakeTransactionRef(std::move(txCoinbase));\n \n     return pblock;\n }\n \n std::shared_ptr<CBlock> MinerTestingSetup::FinalizeBlock(std::shared_ptr<CBlock> pblock)\n {\n-    LOCK(cs_main); // For m_node.chainman->m_blockman.LookupBlockIndex\n-    GenerateCoinbaseCommitment(*pblock, m_node.chainman->m_blockman.LookupBlockIndex(pblock->hashPrevBlock), Params().GetConsensus());\n+    const CBlockIndex* prev_block{WITH_LOCK(::cs_main, return m_node.chainman->m_blockman.LookupBlockIndex(pblock->hashPrevBlock))};\n+    GenerateCoinbaseCommitment(*pblock, prev_block, Params().GetConsensus());\n \n     pblock->hashMerkleRoot = BlockMerkleRoot(*pblock);\n \n     while (!CheckProofOfWork(pblock->GetHash(), pblock->nBits, Params().GetConsensus())) {\n         ++(pblock->nNonce);\n     }\n \n+    // submit block header, so that miner can get the block height from the\n+    // global state and the node has the topology of the chain\n+    BlockValidationState ignored;\n+    BOOST_CHECK(Assert(m_node.chainman)->ProcessNewBlockHeaders({pblock->GetBlockHeader()}, ignored, Params()));\n+\n     return pblock;\n }\n \n@@ -147,13 +154,6 @@ BOOST_AUTO_TEST_CASE(processnewblock_signals_ordering)\n     }\n \n     bool ignored;\n-    BlockValidationState state;\n-    std::vector<CBlockHeader> headers;\n-    std::transform(blocks.begin(), blocks.end(), std::back_inserter(headers), [](std::shared_ptr<const CBlock> b) { return b->GetBlockHeader(); });\n-\n-    // Process all the headers so we understand the toplogy of the chain\n-    BOOST_CHECK(Assert(m_node.chainman)->ProcessNewBlockHeaders(headers, state, Params()));\n-\n     // Connect the genesis block and drain any outstanding events\n     BOOST_CHECK(Assert(m_node.chainman)->ProcessNewBlock(Params(), std::make_shared<CBlock>(Params().GenesisBlock()), true, &ignored));\n     SyncWithValidationInterfaceQueue();"
      },
      {
        "sha": "d06f030022283c98ad6bf633dcbcaf6e91697ff0",
        "filename": "test/functional/feature_block.py",
        "status": "modified",
        "additions": 4,
        "deletions": 1,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/222290f54388270937cb6c174195717e2214ec0d/test/functional/feature_block.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/222290f54388270937cb6c174195717e2214ec0d/test/functional/feature_block.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/feature_block.py?ref=222290f54388270937cb6c174195717e2214ec0d",
        "patch": "@@ -373,7 +373,9 @@ def run_test(self):\n         # b30 has a max-sized coinbase scriptSig.\n         self.move_tip(23)\n         b30 = self.next_block(30)\n-        b30.vtx[0].vin[0].scriptSig = b'\\x00' * 100\n+        b30.vtx[0].vin[0].scriptSig = bytes(b30.vtx[0].vin[0].scriptSig)  # Convert CScript to raw bytes\n+        b30.vtx[0].vin[0].scriptSig += b'\\x00' * (100 - len(b30.vtx[0].vin[0].scriptSig))  # Fill with 0s\n+        assert_equal(len(b30.vtx[0].vin[0].scriptSig), 100)\n         b30.vtx[0].rehash()\n         b30 = self.update_block(30, [])\n         self.send_blocks([b30], True)\n@@ -817,6 +819,7 @@ def run_test(self):\n         b61.vtx[0].rehash()\n         b61 = self.update_block(61, [])\n         assert_equal(duplicate_tx.serialize(), b61.vtx[0].serialize())\n+        # BIP30 is always checked on regtest, regardless of the BIP34 activation height\n         self.send_blocks([b61], success=False, reject_reason='bad-txns-BIP30', reconnect=True)\n \n         # Test BIP30 (allow duplicate if spent)"
      },
      {
        "sha": "b3f0fc6e2e050f70b66d8f566c6103ca4bdf6884",
        "filename": "test/functional/rpc_blockchain.py",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/222290f54388270937cb6c174195717e2214ec0d/test/functional/rpc_blockchain.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/222290f54388270937cb6c174195717e2214ec0d/test/functional/rpc_blockchain.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/rpc_blockchain.py?ref=222290f54388270937cb6c174195717e2214ec0d",
        "patch": "@@ -129,7 +129,7 @@ def _test_getblockchaininfo(self):\n         assert_greater_than(res['size_on_disk'], 0)\n \n         assert_equal(res['softforks'], {\n-            'bip34': {'type': 'buried', 'active': False, 'height': 500},\n+            'bip34': {'type': 'buried', 'active': True, 'height': 2},\n             'bip66': {'type': 'buried', 'active': False, 'height': 1251},\n             'bip65': {'type': 'buried', 'active': False, 'height': 1351},\n             'csv': {'type': 'buried', 'active': False, 'height': 432},"
      }
    ]
  }
]