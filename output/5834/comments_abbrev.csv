dfletcher,2015-02-27T17:58:09Z,"Laanwj thanks for the feedback. Not quite sure why I did that &strCommand[0], I'll fix and reroll today. Regarding the second item, I believe system() handles more types of files, e.g. .bat files and document opening. I could be wrong about this. I will do some experimenting with both calls under MinGW and also possibly reroll that today.\n",https://github.com/bitcoin/bitcoin/pull/5834#issuecomment-76440859,76440859,
sipa,2015-03-01T10:58:48Z,"Perhaps you can call ShellExecute, instead of CreateProcess?\n",https://github.com/bitcoin/bitcoin/pull/5834#issuecomment-76592012,76592012,
laanwj,2015-03-09T12:04:35Z,"Yes, at least bat files would need to be supported. Document opening isn't that terribly important here, if one really wants to do that they could provide the program to launch it with in the command line.\n",https://github.com/bitcoin/bitcoin/pull/5834#issuecomment-77841651,77841651,
jgarzik,2015-03-11T13:58:58Z,Looks like a good start.  Needs more testing.\n,https://github.com/bitcoin/bitcoin/pull/5834#issuecomment-78267442,78267442,
dfletcher,2015-03-12T21:24:07Z,"Okay finally had some time to research this a little better. Thanks everyone here for the suggestions.\n\nI am not quite sure how to proceed, so here is what I have discovered, perhaps everyone here can make suggestions about the best route forward.\n\n[Here's the gist of the program I used for testing](https://gist.github.com/dfletcher/e7ee74166ce9bd6bdd58). Edit: oh, right. don't forget to build",https://github.com/bitcoin/bitcoin/pull/5834#issuecomment-78624721,78624721,
laanwj,2015-03-13T09:15:03Z,"Seems to me that CreateProcess comes out best. Especially if it can work without fallback to ::system.\n\n> Why this affects the non ""W"" version I have no idea. Is the fix to copy the string? Or to just cast c_str() to (char*)? Unsure.\n\nJust make a copy. Strings are not allowed to be mutated in-place in C++, but you could pass a begin_ptr(x) of a std::vector instead.\n",https://github.com/bitcoin/bitcoin/pull/5834#issuecomment-78881170,78881170,
dfletcher,2015-03-13T17:58:18Z,"Ok updated. Nice call on begin_ptr() laanwj that makes it nice and clean. Since we removed the fallback wasn't quite sure what to do with nErr in that case, so just set it to -1 if CreateProcess() failed.\n",https://github.com/bitcoin/bitcoin/pull/5834#issuecomment-79192055,79192055,
kanzure,2015-03-13T18:03:13Z,Does the walletnotify hook need to be stress tested here? Sometimes there are quite a few created simultaneously.\n,https://github.com/bitcoin/bitcoin/pull/5834#issuecomment-79197127,79197127,
dfletcher,2015-03-13T18:17:37Z,"@kanzure well it's anecdotal but I did just test 10 days of blocknotify with that last commit. Worked great, barely a blip on the CPU radar (admittedly fast 4 core modern machine). My test script this time is just a .bat piping the block hash to a file. It added 145 blocks to the output file really quickly and was not noticeably different from running it without the script. Would walletnotify be a",https://github.com/bitcoin/bitcoin/pull/5834#issuecomment-79211125,79211125,
dfletcher,2015-03-13T19:41:37Z,I'm confused why Travis failed here. Is that something in my fork? Did I screw up the merge from bitcoin/master?\n,https://github.com/bitcoin/bitcoin/pull/5834#issuecomment-79295907,79295907,
dfletcher,2015-03-13T20:27:15Z,Thanks a lot to jonasschnelli who helped me a ton in IRC figuring out how to work with github (this is my first pull request!)\n,https://github.com/bitcoin/bitcoin/pull/5834#issuecomment-79349890,79349890,
dfletcher,2015-03-13T23:34:37Z,"@laanwj It seems that the fallback was necessary for the case of calling a terminal command like the ""echo"" in [this test case](https://github.com/bitcoin/bitcoin/blob/master/src/test/alert_tests.cpp#L159) (which is what fails w commit  01087f7 above).\n\nI can imagine one other solution to this which I just tested with my gist ([updated](https://gist.github.com/dfletcher/e7ee74166ce9bd6bdd58)) lo",https://github.com/bitcoin/bitcoin/pull/5834#issuecomment-79531640,79531640,
dfletcher,2015-03-16T18:28:12Z,"Still no opinions? Well it's easy for me to change this code to go either route, fallback or call cmd.exe. I would really like to have some solution for this even if it still pops up the window in some cases (the fallback solution).\n",https://github.com/bitcoin/bitcoin/pull/5834#issuecomment-81855436,81855436,
laanwj,2015-03-19T12:25:49Z,"@dfletcher It's IMO not necessary to support providing a terminal command directly. As I said, what needs to be supported are .exe's and .bat's. The rest can be done from there.\n\nAs said, if remotely possible there should only be one path and no chain of fallbacks. If it fails, it fails. And simple code is preferable to complex code.\n",https://github.com/bitcoin/bitcoin/pull/5834#issuecomment-83536158,83536158,
dfletcher,2015-03-19T17:31:49Z,"@laanwj there is a test in the system which is testing using `echo`. This fails if we do not provide a fallback or use the cmd.exe interpreter directly. See the Travis failure above + two successes afterwards, failure uses no fallback or interpreter, first success is just putting the fallback back, second success is with an interpreter.\n\nSo that leaves (1) Use fallback. (2) Use an interpreter. (",https://github.com/bitcoin/bitcoin/pull/5834#issuecomment-83687057,83687057,
gavinandresen,2015-03-19T17:38:30Z,"-alertnotify is a bitcoind, not Bitcoin-Qt, feature-- I wouldn't expect people running Bitcoin-Qt to run with -alertnotify, they're notified of alerts through the GUI.\n\nSo I think I'm NACK on this pull request in general for solving a problem that I don't think needs solving (command window popping up if you -alertnotify with Bitcoin-Qt).\n",https://github.com/bitcoin/bitcoin/pull/5834#issuecomment-83690019,83690019,
dfletcher,2015-03-19T17:40:49Z,@gavinandresen It solves -blocknotify and -walletnotify popping up a window also. -alertnotify is incidental.\n\nEdit hum maybe I'm not being super clear about this. All three of those functions use the same utility function runCommand(). The fact that that test is checking -alertnotify is not exactly important. What is important is that I believe whoever wrote that test wants to make sure that th,https://github.com/bitcoin/bitcoin/pull/5834#issuecomment-83690522,83690522,
laanwj,2015-04-15T11:21:47Z,I do tend to agree with @gavinandresen that it'not s terribly useful to use `-*notify` with the GUI. For the daemon `bitcoind.exe` this is not an issue as it has its own shell window so should never pop up a new one?\n,https://github.com/bitcoin/bitcoin/pull/5834#issuecomment-93333729,93333729,
laanwj,2015-06-10T08:19:34Z,"Closing due to inactivity. There are still some comments open. Let me know when you start working on this again, and I'll reopen.\n",https://github.com/bitcoin/bitcoin/pull/5834#issuecomment-110647305,110647305,
laanwj,2015-02-27T16:43:44Z,please use `strCommand.c_str()` (if you need zero-terminated) or `strCommand.data()` (if no zero terminator is necessary) i.s.o `&strCommand[0]`\n,https://github.com/bitcoin/bitcoin/pull/5834#discussion_r25519267,25519267,src/util.cpp
laanwj,2015-02-27T16:50:12Z,"Are you sure that this fallback is needed? I'm not sure what the implementation of mingw's system() does internally, but I'd assume it also makes use of CreateProcess or another win32 call.\n",https://github.com/bitcoin/bitcoin/pull/5834#discussion_r25519762,25519762,src/util.cpp
laanwj,2015-04-15T11:15:05Z,"It is not allowed to use end()+1: end() is the end of the data. There is guarantee that there is anything after it, let alone a \0 byte. Only `c_str` guarantees a zero-terminated string.\n\nThis is becoming quite ugly, but I guess what you could do is (this gets rid of the stringstream too)\n\n```\nstd::string strTempCmd = std::string(system32) + ""\\cmd.exe /C "" + strCommand;\nconst char *sTempCmd",https://github.com/bitcoin/bitcoin/pull/5834#discussion_r28410976,28410976,src/util.cpp
laanwj,2015-04-15T11:15:47Z,Code style: we have `{` on the same line as the if/else.\n,https://github.com/bitcoin/bitcoin/pull/5834#discussion_r28411002,28411002,src/util.cpp
laanwj,2015-04-15T11:19:23Z,"OTOH I don't see anywhere in the [CreateProcess](https://msdn.microsoft.com/en-us/library/windows/desktop/ms682425%28v=vs.85%29.aspx) documentation that it will actually try to change the passed-in string. So this should suffice:\n\n```\nstd::string strTempCmd = std::string(system32) + ""\\cmd.exe /C "" + strCommand;\nif (CreateProcess(NULL, const_cast<char*>(strTempCmd.c_str()), NULL, NULL, false, ",https://github.com/bitcoin/bitcoin/pull/5834#discussion_r28411140,28411140,src/util.cpp
