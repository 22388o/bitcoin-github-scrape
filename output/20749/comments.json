[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/749765464",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-749765464",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
    "id": 749765464,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0OTc2NTQ2NA==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-22T20:41:01Z",
    "updated_at": "2021-02-01T04:22:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #21025 (validation: Guard the active_chainstate with cs_main by dongcarl)\n* #20758 (net-processing refactoring -- lose globals, move implementation details from .h to .cpp by ajtowns)\n* #20750 ([Bundle 2/n] Prune g_chainman usage in mempool-related validation functions by dongcarl)\n* #20331 (allow -loadblock blocks to be unsorted by LarryRuane)\n* #20158 (tree-wide: De-globalize ChainstateManager by dongcarl)\n* #19806 (validation: UTXO snapshot activation by jamesob)\n* #19594 (refactor: Make mapBlocksUnknownParent local, and rename it by hebasto)\n* #19438 (Introduce deploymentstatus by ajtowns)\n* #16981 (Improve runtime performance of --reindex by LarryRuane)\n* #16333 (test: Set BIP34Height = 2 for regtest by MarcoFalke)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/749765464/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/752639564",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-752639564",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
    "id": 752639564,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1MjYzOTU2NA==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-30T14:25:35Z",
    "updated_at": "2020-12-30T14:25:35Z",
    "author_association": "MEMBER",
    "body": "Concept ACK!",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/752639564/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/756998410",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-756998410",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
    "id": 756998410,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1Njk5ODQxMA==",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-08T21:07:30Z",
    "updated_at": "2021-01-08T21:07:30Z",
    "author_association": "MEMBER",
    "body": "Concept ACK",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/756998410/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/758225714",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-758225714",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
    "id": 758225714,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1ODIyNTcxNA==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-11T21:08:14Z",
    "updated_at": "2021-01-11T21:08:14Z",
    "author_association": "MEMBER",
    "body": "I've reviewed everything up to 94bbdd7134 _validation: Remove global LookupBlockIndex_ and it looks good so far.\r\n\r\nDoes it make sense to remove the `assert(std::addressof(thing) == std::addressof(thing));` lines as the last commit of this PR? Is there value in keeping those in place until the series of PRs is finished?\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/758225714/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/758916993",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-758916993",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
    "id": 758916993,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1ODkxNjk5Mw==",
    "user": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?u=62e3204f6586795420395a7059ec7dc7c4a40c7d&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-12T20:19:11Z",
    "updated_at": "2021-01-12T20:19:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "> I've reviewed everything up to [94bbdd7](https://github.com/bitcoin/bitcoin/commit/94bbdd7134588961a63a23a5ac93e6503bee47ec) _validation: Remove global LookupBlockIndex_ and it looks good so far.\r\n\r\nYay! \u263a\ufe0f \r\n\r\n> Does it make sense to remove the `assert(std::addressof(thing) == std::addressof(thing));` lines as the last commit of this PR? Is there value in keeping those in place until the series of PRs is finished?\r\n\r\nI did that in a previous version of this PR, but I changed my mind in this version.\r\n\r\nThe main reason for this is that as we make further changes in the future (e.g. call `LoadExternalBlockFile` on the local chainman in `ThreadImport` in [this commit](https://github.com/bitcoin/bitcoin/pull/20158/commits/9711fac132695c303918f6b6a4df494126b99854)) we still want to make sure that these assertions hold up for correctness.\r\n\r\nAnother advantage is that leaving these assertions in prevents new PRs from making the class of mistakes fixed in #20323 from passing tests while the de-globalize chainman bundles are being reviewed and merged.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/758916993/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/759396506",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-759396506",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
    "id": 759396506,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1OTM5NjUwNg==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-13T11:46:15Z",
    "updated_at": "2021-01-13T11:46:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--4a62be1de6b64f3ed646cdc7932c8cf5-->\n\ud83d\udd75\ufe0f @sipa @fjahr have been requested to review this pull request as specified in the REVIEWERS file.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/759396506/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/759715558",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-759715558",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
    "id": 759715558,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1OTcxNTU1OA==",
    "user": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?u=62e3204f6586795420395a7059ec7dc7c4a40c7d&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-13T20:19:05Z",
    "updated_at": "2021-01-13T20:19:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "Push e8dedbb064e90aaa8b2540c7524af54bbdd49d0a -> c948ff186b34693e762fa595ddc174cd88bfd89c\r\n- Addressed https://github.com/bitcoin/bitcoin/pull/20749#discussion_r550179512 and https://github.com/bitcoin/bitcoin/pull/20749#discussion_r556051990\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/759715558/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/760870364",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-760870364",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
    "id": 760870364,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2MDg3MDM2NA==",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-15T11:00:41Z",
    "updated_at": "2021-01-15T11:00:41Z",
    "author_association": "MEMBER",
    "body": "Concept ACK",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/760870364/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/761197346",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-761197346",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
    "id": 761197346,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2MTE5NzM0Ng==",
    "user": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?u=62e3204f6586795420395a7059ec7dc7c4a40c7d&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-15T21:06:05Z",
    "updated_at": "2021-01-15T21:06:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "Note: If #20946 gets in before this, we won't need this last commit I just pushed.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/761197346/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/763824082",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-763824082",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
    "id": 763824082,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2MzgyNDA4Mg==",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-20T17:53:47Z",
    "updated_at": "2021-01-20T17:53:47Z",
    "author_association": "MEMBER",
    "body": "Code review ACK 364fa81a2b014bd6257e011e6a201a48c1b8853e\r\nChecked that this only moves methods around and doesn't change any validation logic.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/763824082/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/764741125",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-764741125",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
    "id": 764741125,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2NDc0MTEyNQ==",
    "user": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?u=62e3204f6586795420395a7059ec7dc7c4a40c7d&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-21T15:54:16Z",
    "updated_at": "2021-01-21T15:54:16Z",
    "author_association": "CONTRIBUTOR",
    "body": "Pushed d0454bad30253e735254cf7be359212293d952af -> 6ea8e92fc1105cf827acf6a72572d16696e2051c\r\n- Rebased over master to include #20946, dropped last commit accordingly",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/764741125/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/767799339",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-767799339",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
    "id": 767799339,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2Nzc5OTMzOQ==",
    "user": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?u=62e3204f6586795420395a7059ec7dc7c4a40c7d&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-26T20:13:07Z",
    "updated_at": "2021-01-26T20:13:07Z",
    "author_association": "CONTRIBUTOR",
    "body": "Pushed 6ea8e92fc1105cf827acf6a72572d16696e2051c -> 2bda16f4e46bf361bcfa600a4e751e6303a63d0d\r\n- Rebased over master to include #20972, dropped cs_main locking according to https://github.com/bitcoin/bitcoin/pull/20749#discussion_r564711195",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/767799339/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/768275550",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-768275550",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
    "id": 768275550,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2ODI3NTU1MA==",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?u=3e27bc6589085f3450be1b0e969d04008cc77565&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-27T13:11:33Z",
    "updated_at": "2021-01-27T13:11:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "reACK https://github.com/bitcoin/bitcoin/commit/2bda16f4e46bf361bcfa600a4e751e6303a63d0d, only change is dropping repeat-lock of cs_main",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/768275550/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/768303293",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-768303293",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
    "id": 768303293,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2ODMwMzI5Mw==",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-27T13:58:51Z",
    "updated_at": "2021-01-27T13:58:51Z",
    "author_association": "MEMBER",
    "body": "re-ACK 2bda16f4e46bf361bcfa600a4e751e6303a63d0d",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/768303293/reactions",
      "total_count": 2,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 2,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/768677337",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-768677337",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
    "id": 768677337,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2ODY3NzMzNw==",
    "user": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?u=62e3204f6586795420395a7059ec7dc7c4a40c7d&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-28T00:50:35Z",
    "updated_at": "2021-01-28T00:53:56Z",
    "author_association": "CONTRIBUTOR",
    "body": "If anyone was wondering about resolving the AssumeUTXO changes in #19806 with the deglobalizing-chainman changes, here's an update: https://github.com/bitcoin/bitcoin/pull/19806#issuecomment-768673523.\r\n\r\nThe conclusion was that the PRs are mergeable in any order without much pain if the last commit of the AssumeUTXO changes in #19806 is slightly modified.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/768677337/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/769305311",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-769305311",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
    "id": 769305311,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2OTMwNTMxMQ==",
    "user": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?u=62e3204f6586795420395a7059ec7dc7c4a40c7d&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-28T19:03:46Z",
    "updated_at": "2021-01-28T19:03:46Z",
    "author_association": "CONTRIBUTOR",
    "body": "Pushed 2bda16f4e46bf361bcfa600a4e751e6303a63d0d -> 246cb0f29b01e9b24cd13388dfd38c4b0729783c\r\n- Rebased on top of #21025 to fix locking\r\n- Addressed jnewbery's review comments (thanks!)",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/769305311/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/769312396",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-769312396",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
    "id": 769312396,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2OTMxMjM5Ng==",
    "user": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?u=62e3204f6586795420395a7059ec7dc7c4a40c7d&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-28T19:16:18Z",
    "updated_at": "2021-01-28T19:16:18Z",
    "author_association": "CONTRIBUTOR",
    "body": "Pushed 246cb0f29b01e9b24cd13388dfd38c4b0729783c -> 67c9a83df19c6e2a2edb32336879204e7770b4a7\r\n- Rebased over new changes in #21025",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/769312396/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/769318849",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-769318849",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
    "id": 769318849,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2OTMxODg0OQ==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-28T19:27:18Z",
    "updated_at": "2021-01-28T19:27:18Z",
    "author_association": "MEMBER",
    "body": "utACK 67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/769318849/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/770716244",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-770716244",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
    "id": 770716244,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3MDcxNjI0NA==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-01T09:34:26Z",
    "updated_at": "2021-02-01T09:34:26Z",
    "author_association": "MEMBER",
    "body": "If @laanwj reACKs this, then I think it'll be ready for merge",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/770716244/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/770807215",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-770807215",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
    "id": 770807215,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3MDgwNzIxNQ==",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-01T12:04:15Z",
    "updated_at": "2021-02-01T12:04:15Z",
    "author_association": "MEMBER",
    "body": "re-ACK 67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/770807215/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/770829188",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-770829188",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
    "id": 770829188,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3MDgyOTE4OA==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-01T12:43:34Z",
    "updated_at": "2021-02-01T12:43:34Z",
    "author_association": "MEMBER",
    "body": "Warnings are fixed in #21051.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/770829188/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/547447969",
    "pull_request_review_id": 557295697,
    "id": 547447969,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzQ0Nzk2OQ==",
    "diff_hunk": "@@ -699,7 +699,7 @@ static void ThreadImport(ChainstateManager& chainman, std::vector<fs::path> vImp\n             if (!file)\n                 break; // This error is logged in OpenBlockFile\n             LogPrintf(\"Reindexing block file blk%05u.dat...\\n\", (unsigned int)nFile);\n-            LoadExternalBlockFile(chainparams, file, &pos);\n+            ::ChainstateActive().LoadExternalBlockFile(chainparams, file, &pos);",
    "path": "src/init.cpp",
    "position": 5,
    "original_position": 5,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "e8dedbb064e90aaa8b2540c7524af54bbdd49d0a",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I know I've asked the same question already, but I didn't get why this can't use `chainman.ActiveChainstate().Load...`.\r\n\r\nThis should simplify review because it will touch the same lines of code less often.\r\n\r\nAlso, it shouldn't make review harder, because everyone knows that there is only one chainman (whether it is called `g_chainman` or `chainman` shouldn't matter). On top you added a runtime assertion, which validates this for all executed code paths in our tests:\r\n\r\n```cpp\r\n     assert(std::addressof(::ChainstateActive()) == std::addressof(ActiveChainstate()));",
    "created_at": "2020-12-22T18:53:33Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r547447969",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/547447969"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r547447969"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/547447969/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 708,
    "original_line": 708,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/547450444",
    "pull_request_review_id": 557298663,
    "id": 547450444,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzQ1MDQ0NA==",
    "diff_hunk": "@@ -699,7 +699,7 @@ static void ThreadImport(ChainstateManager& chainman, std::vector<fs::path> vImp\n             if (!file)\n                 break; // This error is logged in OpenBlockFile\n             LogPrintf(\"Reindexing block file blk%05u.dat...\\n\", (unsigned int)nFile);\n-            LoadExternalBlockFile(chainparams, file, &pos);\n+            ::ChainstateActive().LoadExternalBlockFile(chainparams, file, &pos);",
    "path": "src/init.cpp",
    "position": 5,
    "original_position": 5,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "e8dedbb064e90aaa8b2540c7524af54bbdd49d0a",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Anyway, no big deal if you want to keep it that way. Will review regardless.",
    "created_at": "2020-12-22T18:58:50Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r547450444",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/547450444"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r547450444"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/547450444/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 708,
    "original_line": 708,
    "side": "RIGHT",
    "in_reply_to_id": 547447969
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550179512",
    "pull_request_review_id": 560030209,
    "id": 550179512,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDE3OTUxMg==",
    "diff_hunk": "@@ -3392,14 +3391,15 @@ std::vector<unsigned char> GenerateCoinbaseCommitment(CBlock& block, const CBloc\n }\n \n //! Returns last CBlockIndex* that is a checkpoint\n-static CBlockIndex* GetLastCheckpoint(const CCheckpointData& data) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+CBlockIndex* BlockManager::GetLastCheckpoint(const CCheckpointData& data)",
    "path": "src/validation.cpp",
    "position": 93,
    "original_position": 13,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "626b709edfe1bd71e6d485c096ff9a52f698a94c",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "626b709edfe1bd71e6d485c096ff9a52f698a94c nit: move help text to header file",
    "created_at": "2020-12-30T12:33:38Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r550179512",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550179512"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r550179512"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550179512/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 3401,
    "original_line": 3401,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550182154",
    "pull_request_review_id": 560030209,
    "id": 550182154,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDE4MjE1NA==",
    "diff_hunk": "@@ -4671,7 +4667,7 @@ void LoadExternalBlockFile(const CChainParams& chainparams, FILE* fileIn, FlatFi\n                 // Activate the genesis block so normal node progress can continue\n                 if (hash == chainparams.GetConsensus().hashGenesisBlock) {\n                     BlockValidationState state;\n-                    if (!ActivateBestChain(state, chainparams, nullptr)) {\n+                    if (!::ChainstateActive().ActivateBestChain(state, chainparams, nullptr)) {",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 16,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "a375714f24b85b6f9ce7e1765a1137e3b85af009",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "a375714f24b85b6f9ce7e1765a1137e3b85af009 nit: drop `, nullptr`?",
    "created_at": "2020-12-30T12:43:32Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r550182154",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550182154"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r550182154"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550182154/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4670,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550182687",
    "pull_request_review_id": 560030209,
    "id": 550182687,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDE4MjY4Nw==",
    "diff_hunk": "@@ -654,6 +647,8 @@ class CChainState\n     void PruneAndFlush();\n \n     /**\n+     * Find the best known block, and make it the tip of the block chain\n+     *",
    "path": "src/validation.h",
    "position": null,
    "original_position": 19,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "a375714f24b85b6f9ce7e1765a1137e3b85af009",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "a375714f24b85b6f9ce7e1765a1137e3b85af009  Should this comment be preserved?\r\n```\r\n* May not be called with cs_main held. May not be called in a\t\t\r\n* validationinterface callback.\r\n ```",
    "created_at": "2020-12-30T12:45:17Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r550182687",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550182687"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r550182687"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550182687/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 653,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/551995246",
    "pull_request_review_id": 561873479,
    "id": 551995246,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTk5NTI0Ng==",
    "diff_hunk": "@@ -654,6 +647,8 @@ class CChainState\n     void PruneAndFlush();\n \n     /**\n+     * Find the best known block, and make it the tip of the block chain\n+     *",
    "path": "src/validation.h",
    "position": null,
    "original_position": 19,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "a375714f24b85b6f9ce7e1765a1137e3b85af009",
    "user": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Unsure, perhaps @jamesob can help expound on this point a little?",
    "created_at": "2021-01-05T15:15:41Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r551995246",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/551995246"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r551995246"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/551995246/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 653,
    "side": "RIGHT",
    "in_reply_to_id": 550182687
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/551995825",
    "pull_request_review_id": 561874263,
    "id": 551995825,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTk5NTgyNQ==",
    "diff_hunk": "@@ -3392,14 +3391,15 @@ std::vector<unsigned char> GenerateCoinbaseCommitment(CBlock& block, const CBloc\n }\n \n //! Returns last CBlockIndex* that is a checkpoint\n-static CBlockIndex* GetLastCheckpoint(const CCheckpointData& data) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+CBlockIndex* BlockManager::GetLastCheckpoint(const CCheckpointData& data)",
    "path": "src/validation.cpp",
    "position": 93,
    "original_position": 13,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "626b709edfe1bd71e6d485c096ff9a52f698a94c",
    "user": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Will do on next push!",
    "created_at": "2021-01-05T15:16:35Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r551995825",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/551995825"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r551995825"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/551995825/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 3401,
    "original_line": 3401,
    "side": "RIGHT",
    "in_reply_to_id": 550179512
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/555338921",
    "pull_request_review_id": 565737562,
    "id": 555338921,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTMzODkyMQ==",
    "diff_hunk": "@@ -654,6 +647,8 @@ class CChainState\n     void PruneAndFlush();\n \n     /**\n+     * Find the best known block, and make it the tip of the block chain\n+     *",
    "path": "src/validation.h",
    "position": null,
    "original_position": 19,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "a375714f24b85b6f9ce7e1765a1137e3b85af009",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "It is preserved, at the bottom of this comment. It was just duplicated before.\r\n\r\nAlthough I think it's fine to remove \"May not be called with cs_main held.\" We have lock annotations to document/enforce that now, so the comment is redundant.",
    "created_at": "2021-01-11T21:04:45Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r555338921",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/555338921"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r555338921"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/555338921/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 653,
    "side": "RIGHT",
    "in_reply_to_id": 550182687
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/556051990",
    "pull_request_review_id": 566654472,
    "id": 556051990,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjA1MTk5MA==",
    "diff_hunk": "@@ -541,18 +541,18 @@ class CChainState\n      */\n     mutable std::atomic<bool> m_cached_finished_ibd{false};\n \n-    //! Reference to a BlockManager instance which itself is shared across all\n-    //! CChainState instances. Keeping a local reference allows us to test more\n-    //! easily as opposed to referencing a global.\n-    BlockManager& m_blockman;\n-\n     //! mempool that is kept in sync with the chain\n     CTxMemPool& m_mempool;\n \n     //! Manages the UTXO set, which is a reflection of the contents of `m_chain`.\n     std::unique_ptr<CoinsViews> m_coins_views;\n \n public:\n+    //! Reference to a BlockManager instance which itself is shared across all\n+    //! CChainState instances. Keeping a local reference allows us to test more\n+    //! easily as opposed to referencing a global.\n+    BlockManager& m_blockman GUARDED_BY(::cs_main);",
    "path": "src/validation.h",
    "position": null,
    "original_position": 19,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "f28f8e3da5a48be3cdc0207112d9aa8ec8f6e820",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"validation: Make CChainState.m_blockman public\" (f28f8e3da5a48be3cdc0207112d9aa8ec8f6e820)\r\n\r\nIs it intentional to add GUARDED_BY here? Maybe add a comment saying what semantics are. I wouldn't think it should be necessary to lock cs_main just to get a reference to the BlockManager instance. It does seem like cs_main is needed to use some BlockManager members, but these are already annotated. ",
    "created_at": "2021-01-12T20:08:03Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r556051990",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/556051990"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r556051990"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/556051990/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 554,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/556802926",
    "pull_request_review_id": 567585013,
    "id": 556802926,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjgwMjkyNg==",
    "diff_hunk": "@@ -541,18 +541,18 @@ class CChainState\n      */\n     mutable std::atomic<bool> m_cached_finished_ibd{false};\n \n-    //! Reference to a BlockManager instance which itself is shared across all\n-    //! CChainState instances. Keeping a local reference allows us to test more\n-    //! easily as opposed to referencing a global.\n-    BlockManager& m_blockman;\n-\n     //! mempool that is kept in sync with the chain\n     CTxMemPool& m_mempool;\n \n     //! Manages the UTXO set, which is a reflection of the contents of `m_chain`.\n     std::unique_ptr<CoinsViews> m_coins_views;\n \n public:\n+    //! Reference to a BlockManager instance which itself is shared across all\n+    //! CChainState instances. Keeping a local reference allows us to test more\n+    //! easily as opposed to referencing a global.\n+    BlockManager& m_blockman GUARDED_BY(::cs_main);",
    "path": "src/validation.h",
    "position": null,
    "original_position": 19,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "f28f8e3da5a48be3cdc0207112d9aa8ec8f6e820",
    "user": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "True, that doesn't seem necessary!",
    "created_at": "2021-01-13T20:17:27Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r556802926",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/556802926"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r556802926"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/556802926/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 554,
    "side": "RIGHT",
    "in_reply_to_id": 556051990
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557816128",
    "pull_request_review_id": 568766234,
    "id": 557816128,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzgxNjEyOA==",
    "diff_hunk": "@@ -167,17 +166,19 @@ namespace {\n     std::set<int> setDirtyFileInfo;\n } // anon namespace\n \n-CBlockIndex* LookupBlockIndex(const uint256& hash)\n+CBlockIndex* BlockManager::LookupBlockIndex(const uint256& hash)\n {\n     AssertLockHeld(cs_main);\n-    BlockMap::const_iterator it = g_chainman.BlockIndex().find(hash);\n-    return it == g_chainman.BlockIndex().end() ? nullptr : it->second;\n+    assert(std::addressof(g_chainman.BlockIndex()) == std::addressof(m_block_index));\n+    BlockMap::const_iterator it = m_block_index.find(hash);\n+    return it == m_block_index.end() ? nullptr : it->second;\n }\n \n-CBlockIndex* FindForkInGlobalIndex(const CChain& chain, const CBlockLocator& locator)\n+CBlockIndex* BlockManager::FindForkInGlobalIndex(const CChain& chain, const CBlockLocator& locator)\n {\n     AssertLockHeld(cs_main);\n \n+    assert(std::addressof(g_chainman.m_blockman) == std::addressof(*this));",
    "path": "src/validation.cpp",
    "position": 20,
    "original_position": 28,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "c948ff186b34693e762fa595ddc174cd88bfd89c",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think this `assert` can be removed after 98f2375, as `FindForkInGlobalIndex` is moved to `BlockManager` and thus you can now directly access the new local method `BlockManager::LookupBlockIndex`. Asserting `g_chainmain.m_blockman` equivalence is lapsed ? \r\n\r\nSame for `assert`s in `GetSpendHeight` after d34c069 and in `GetLastCheckpoint` after 866834a",
    "created_at": "2021-01-15T02:02:56Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r557816128",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557816128"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r557816128"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557816128/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 182,
    "original_line": 182,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/558249589",
    "pull_request_review_id": 569183285,
    "id": 558249589,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODI0OTU4OQ==",
    "diff_hunk": "@@ -438,6 +426,21 @@ class BlockManager\n         const CChainParams& chainparams,\n         CBlockIndex** ppindex) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    CBlockIndex* LookupBlockIndex(const uint256& hash) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+\n+    /** Find the last common block between the parameter chain and a locator. */\n+    CBlockIndex* FindForkInGlobalIndex(const CChain& chain, const CBlockLocator& locator) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+\n+    //! Returns last CBlockIndex* that is a checkpoint\n+    CBlockIndex* GetLastCheckpoint(const CCheckpointData& data) EXCLUSIVE_LOCKS_REQUIRED(cs_main);",
    "path": "src/validation.h",
    "position": 68,
    "original_position": 70,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "c948ff186b34693e762fa595ddc174cd88bfd89c",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "64d27fb0b950bcbd87bc7cd0b4d62f47f305ef88 naming and placement suggestions, feel free to ignore\r\n\r\n- as the verb is \"look up\" (not \"lookup\", which is a noun or adjective), suggest naming the function `LookUpBlockIndex`\r\n\r\n- it may be nice to place the function next to its similar twins, per the following diff\r\n\r\n<details><summary>suggested diff</summary><p>\r\n\r\n```diff\r\n+++ b/src/validation.h\r\n@@ -417,6 +417,7 @@ public:\r\n     CBlockIndex* AddToBlockIndex(const CBlockHeader& block) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\r\n     /** Create a new block index entry for a given block hash */\r\n     CBlockIndex* InsertBlockIndex(const uint256& hash) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\r\n+    CBlockIndex* LookUpBlockIndex(const uint256& hash) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\r\n \r\n     //! Mark one block file as pruned (modify associated database entries)\r\n     void PruneOneBlockFile(const int fileNumber) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\r\n@@ -431,8 +432,6 @@ public:\r\n         const CChainParams& chainparams,\r\n         CBlockIndex** ppindex) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\r\n \r\n-    CBlockIndex* LookupBlockIndex(const uint256& hash) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\r\n-\r\n     ~BlockManager() {\r\n         Unload();\r\n     }\r\n```\r\n</p></details>\r\n",
    "created_at": "2021-01-15T11:34:55Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r558249589",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/558249589"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r558249589"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/558249589/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 435,
    "original_line": 435,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/558488887",
    "pull_request_review_id": 569497138,
    "id": 558488887,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODQ4ODg4Nw==",
    "diff_hunk": "@@ -167,17 +166,19 @@ namespace {\n     std::set<int> setDirtyFileInfo;\n } // anon namespace\n \n-CBlockIndex* LookupBlockIndex(const uint256& hash)\n+CBlockIndex* BlockManager::LookupBlockIndex(const uint256& hash)\n {\n     AssertLockHeld(cs_main);\n-    BlockMap::const_iterator it = g_chainman.BlockIndex().find(hash);\n-    return it == g_chainman.BlockIndex().end() ? nullptr : it->second;\n+    assert(std::addressof(g_chainman.BlockIndex()) == std::addressof(m_block_index));\n+    BlockMap::const_iterator it = m_block_index.find(hash);\n+    return it == m_block_index.end() ? nullptr : it->second;\n }\n \n-CBlockIndex* FindForkInGlobalIndex(const CChain& chain, const CBlockLocator& locator)\n+CBlockIndex* BlockManager::FindForkInGlobalIndex(const CChain& chain, const CBlockLocator& locator)\n {\n     AssertLockHeld(cs_main);\n \n+    assert(std::addressof(g_chainman.m_blockman) == std::addressof(*this));",
    "path": "src/validation.cpp",
    "position": 20,
    "original_position": 28,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "c948ff186b34693e762fa595ddc174cd88bfd89c",
    "user": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I see your point, but I don't think it hurts anything \ud83d\ude01\r\nAll of these will be removed in the end with a scripted-diff anyway",
    "created_at": "2021-01-15T18:21:35Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r558488887",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/558488887"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r558488887"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/558488887/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 182,
    "original_line": 182,
    "side": "RIGHT",
    "in_reply_to_id": 557816128
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559425521",
    "pull_request_review_id": 570308900,
    "id": 559425521,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTQyNTUyMQ==",
    "diff_hunk": "@@ -625,7 +625,7 @@ void CTxMemPool::check(const CCoinsViewCache *pcoins) const\n     uint64_t innerUsage = 0;\n \n     CCoinsViewCache mempoolDuplicate(const_cast<CCoinsViewCache*>(pcoins));\n-    const int64_t spendheight = GetSpendHeight(mempoolDuplicate);\n+    const int64_t spendheight = WITH_LOCK(::cs_main, return g_chainman.m_blockman.GetSpendHeight(mempoolDuplicate));",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "364fa81a2b014bd6257e011e6a201a48c1b8853e",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "The lock ordering is to take `cs_main` then take `mempool.cs` so at first glance, this looks like a lock inversion since it's locking `cs_main` while already holding `mempool.cs`. In fact, whenever `mempool.check()` is called, we're already holding `cs_main` (see the two call sites in net_processing).\r\n\r\nI think it'd be better to add an `EXCLUSIVE_LOCKS_REQUIRED(cs_main)` annotation to `check()` and remove the re-entrant lock-taking here.",
    "created_at": "2021-01-18T09:30:30Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r559425521",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559425521"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r559425521"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559425521/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 629,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559429565",
    "pull_request_review_id": 570308900,
    "id": 559429565,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTQyOTU2NQ==",
    "diff_hunk": "@@ -50,6 +51,7 @@ struct ChainTxData;\n struct DisconnectedBlockTransactions;\n struct PrecomputedTransactionData;\n struct LockPoints;\n+struct CCheckpointData;",
    "path": "src/validation.h",
    "position": null,
    "original_position": 12,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "364fa81a2b014bd6257e011e6a201a48c1b8853e",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "No need for this forward declaration. You're including chainparams.h, which is where this is declared.",
    "created_at": "2021-01-18T09:36:10Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r559429565",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559429565"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r559429565"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559429565/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 54,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559437992",
    "pull_request_review_id": 570308900,
    "id": 559437992,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTQzNzk5Mg==",
    "diff_hunk": "@@ -296,7 +289,7 @@ bool UndoReadFromDisk(CBlockUndo& blockundo, const CBlockIndex* pindex);\n bool CheckBlock(const CBlock& block, BlockValidationState& state, const Consensus::Params& consensusParams, bool fCheckPOW = true, bool fCheckMerkleRoot = true);\n \n /** Check a block is completely valid from start to finish (only works on top of our current best block) */\n-bool TestBlockValidity(BlockValidationState& state, const CChainParams& chainparams, const CBlock& block, CBlockIndex* pindexPrev, bool fCheckPOW = true, bool fCheckMerkleRoot = true) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+bool TestBlockValidity(BlockValidationState& state, const CChainParams& chainparams, CChainState& chainstate, const CBlock& block, CBlockIndex* pindexPrev, bool fCheckPOW = true, bool fCheckMerkleRoot = true) EXCLUSIVE_LOCKS_REQUIRED(cs_main);",
    "path": "src/validation.h",
    "position": null,
    "original_position": 44,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "364fa81a2b014bd6257e011e6a201a48c1b8853e",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I find these very long lines almost impossible to read. If you touch this branch again, could you be convinced to split it up. Something like:\r\n\r\n```suggestion\r\nbool TestBlockValidity(BlockValidationState& state, const CChainParams& chainparams,\r\n                       CChainState& chainstate, const CBlock& block, CBlockIndex* pindexPrev,\r\n                       bool fCheckPOW = true, bool fCheckMerkleRoot = true)\r\n    EXCLUSIVE_LOCKS_REQUIRED(cs_main);\r\n```",
    "created_at": "2021-01-18T09:48:53Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r559437992",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559437992"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r559437992"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559437992/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 292,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559438289",
    "pull_request_review_id": 570308900,
    "id": 559438289,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTQzODI4OQ==",
    "diff_hunk": "@@ -3778,42 +3780,44 @@ bool ChainstateManager::ProcessNewBlock(const CChainParams& chainparams, const s\n         bool ret = CheckBlock(*pblock, state, chainparams.GetConsensus());\n         if (ret) {\n             // Store to disk\n-            ret = ::ChainstateActive().AcceptBlock(pblock, state, chainparams, &pindex, fForceProcessing, nullptr, fNewBlock);\n+            ret = ActiveChainstate().AcceptBlock(pblock, state, chainparams, &pindex, fForceProcessing, nullptr, fNewBlock);\n         }\n         if (!ret) {\n             GetMainSignals().BlockChecked(*pblock, state);\n             return error(\"%s: AcceptBlock FAILED (%s)\", __func__, state.ToString());\n         }\n     }\n \n-    NotifyHeaderTip();\n+    NotifyHeaderTip(ActiveChainstate());\n \n     BlockValidationState state; // Only used to report errors, not invalidity - ignore it\n-    if (!::ChainstateActive().ActivateBestChain(state, chainparams, pblock))\n+    if (!ActiveChainstate().ActivateBestChain(state, chainparams, pblock))\n         return error(\"%s: ActivateBestChain failed (%s)\", __func__, state.ToString());\n \n     return true;\n }\n \n-bool TestBlockValidity(BlockValidationState& state, const CChainParams& chainparams, const CBlock& block, CBlockIndex* pindexPrev, bool fCheckPOW, bool fCheckMerkleRoot)\n+bool TestBlockValidity(BlockValidationState& state, const CChainParams& chainparams, CChainState& chainstate, const CBlock& block, CBlockIndex* pindexPrev, bool fCheckPOW, bool fCheckMerkleRoot)",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 201,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "364fa81a2b014bd6257e011e6a201a48c1b8853e",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Same comment as for the declaration. Consider splitting this line.",
    "created_at": "2021-01-18T09:49:23Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r559438289",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559438289"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r559438289"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559438289/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 3800,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559441927",
    "pull_request_review_id": 570308900,
    "id": 559441927,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTQ0MTkyNw==",
    "diff_hunk": "@@ -375,7 +375,7 @@ static RPCHelpMan generateblock()\n         LOCK(cs_main);\n \n         BlockValidationState state;\n-        if (!TestBlockValidity(state, chainparams, block, LookupBlockIndex(block.hashPrevBlock), false, false)) {\n+        if (!TestBlockValidity(state, chainparams, ::ChainstateActive(), block, g_chainman.m_blockman.LookupBlockIndex(block.hashPrevBlock), false, false)) {",
    "path": "src/rpc/mining.cpp",
    "position": 5,
    "original_position": 5,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "364fa81a2b014bd6257e011e6a201a48c1b8853e",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Any reason not to just jump straight to using `EnsureChainman(request.context)` in all the rpc methods that you're touching here?",
    "created_at": "2021-01-18T09:55:09Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r559441927",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559441927"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r559441927"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559441927/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 378,
    "original_line": 378,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559524032",
    "pull_request_review_id": 570434073,
    "id": 559524032,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTUyNDAzMg==",
    "diff_hunk": "@@ -643,6 +649,8 @@ class CChainState\n     void PruneAndFlush();\n \n     /**\n+     * Find the best known block, and make it the tip of the block chain",
    "path": "src/validation.h",
    "position": null,
    "original_position": 120,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "364fa81a2b014bd6257e011e6a201a48c1b8853e",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "There's still some redundant text in here. Consider:\r\n\r\n```diff\r\ndiff --git a/src/validation.h b/src/validation.h\r\nindex 10943b6c24..2e1c441ba5 100644\r\n--- a/src/validation.h\r\n+++ b/src/validation.h\r\n@@ -649,18 +649,16 @@ public:\r\n     void PruneAndFlush();\r\n \r\n     /**\r\n-     * Find the best known block, and make it the tip of the block chain\r\n-     *\r\n-     * Make the best chain active, in multiple steps. The result is either failure\r\n-     * or an activated best chain. pblock is either nullptr or a pointer to a block\r\n-     * that is already loaded (to avoid loading it again from disk).\r\n+     * Find the best known block, and make it the tip of the block chain. The\r\n+     * result is either failure or an activated best chain. pblock is either\r\n+     * nullptr or a pointer to a block that is already loaded (to avoid loading\r\n+     * it again from disk).\r\n      *\r\n      * ActivateBestChain is split into steps (see ActivateBestChainStep) so that\r\n      * we avoid holding cs_main for an extended period of time; the length of this\r\n      * call may be quite long during reindexing or a substantial reorg.\r\n      *\r\n-     * May not be called with cs_main held. May not be called in a\r\n-     * validationinterface callback.\r\n+     * May not be called in a validationinterface callback.\r\n      *\r\n      * @returns true unless a system error occurred\r\n      */\r\n```\r\n\r\n",
    "created_at": "2021-01-18T12:12:44Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r559524032",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559524032"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r559524032"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559524032/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 652,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559544027",
    "pull_request_review_id": 570434073,
    "id": 559544027,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTU0NDAyNw==",
    "diff_hunk": "@@ -3650,8 +3651,8 @@ bool ChainstateManager::ProcessNewBlockHeaders(const std::vector<CBlockHeader>&\n             }\n         }\n     }\n-    if (NotifyHeaderTip()) {\n-        if (::ChainstateActive().IsInitialBlockDownload() && ppindex && *ppindex) {\n+    if (NotifyHeaderTip(ActiveChainstate())) {",
    "path": "src/validation.cpp",
    "position": 155,
    "original_position": 163,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "364fa81a2b014bd6257e011e6a201a48c1b8853e",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "`ActiveChainstate()` doesn't take `cs_main`, whereas `::ChainstateActive()` does. Is that a problem? I imagine we shouldn't be reading `m_active_chainstate` without `cs_main`. The comment says:\r\n\r\n```\r\n    //! Once this pointer is set to a corresponding chainstate, it will not\r\n    //! be reset until init.cpp:Shutdown(). This means it is safe to acquire\r\n    //! the contents of this pointer with ::cs_main held, release the lock,\r\n    //! and then use the reference without concern of it being deconstructed.\r\n```\r\n\r\nShould `m_active_chainstate` be GUARDED_BY cs_main and `ActiveChainstate()` have EXCLUSIVE_LOCKS_REQUIRED(::cs_main)?",
    "created_at": "2021-01-18T12:49:11Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r559544027",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559544027"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r559544027"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559544027/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 3665,
    "original_line": 3665,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560977964",
    "pull_request_review_id": 572243158,
    "id": 560977964,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDk3Nzk2NA==",
    "diff_hunk": "@@ -625,7 +625,7 @@ void CTxMemPool::check(const CCoinsViewCache *pcoins) const\n     uint64_t innerUsage = 0;\n \n     CCoinsViewCache mempoolDuplicate(const_cast<CCoinsViewCache*>(pcoins));\n-    const int64_t spendheight = GetSpendHeight(mempoolDuplicate);\n+    const int64_t spendheight = WITH_LOCK(::cs_main, return g_chainman.m_blockman.GetSpendHeight(mempoolDuplicate));",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "364fa81a2b014bd6257e011e6a201a48c1b8853e",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"validation: Move GetSpendHeight to BlockManager\" (d34c0698ec34b45b3ce153dd7ef0b79650e6deb9)\r\n\r\nre: https://github.com/bitcoin/bitcoin/pull/20749#discussion_r559425521\r\n\r\n> The lock ordering is to take `cs_main` then take `mempool.cs` so at first glance, this looks like a lock inversion since it's locking `cs_main` while already holding `mempool.cs`. In fact, whenever `mempool.check()` is called, we're already holding `cs_main` (see the two call sites in net_processing).\r\n> \r\n> I think it'd be better to add an `EXCLUSIVE_LOCKS_REQUIRED(cs_main)` annotation to `check()` and remove the re-entrant lock-taking here.\r\n\r\nThis is true and I commented on it previously https://github.com/bitcoin/bitcoin/pull/20158#discussion_r510481852, but since this commit is just a plain refactoring, I suspect it could complicate the PR in a bad way to try to tackle the lock ordering issue here. I would be happy to see a code comment pointing out the inconsistent lock ordering, or even to see it fixed here if your fix is not that complicated to review and implement. But I suspect this could be better to fix separately since it's not directly related to changes in this PR",
    "created_at": "2021-01-20T13:57:12Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r560977964",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560977964"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r560977964"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560977964/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 629,
    "side": "RIGHT",
    "in_reply_to_id": 559425521
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560979259",
    "pull_request_review_id": 572243158,
    "id": 560979259,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDk3OTI1OQ==",
    "diff_hunk": "@@ -3650,8 +3651,8 @@ bool ChainstateManager::ProcessNewBlockHeaders(const std::vector<CBlockHeader>&\n             }\n         }\n     }\n-    if (NotifyHeaderTip()) {\n-        if (::ChainstateActive().IsInitialBlockDownload() && ppindex && *ppindex) {\n+    if (NotifyHeaderTip(ActiveChainstate())) {",
    "path": "src/validation.cpp",
    "position": 155,
    "original_position": 163,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "364fa81a2b014bd6257e011e6a201a48c1b8853e",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"validation: Use existing chainstate in ChainstateManager::ProcessNewBlockHeaders\" (e0ab7ee8ded2eb44fe2791a081703452012228e8)\r\n\r\nre: https://github.com/bitcoin/bitcoin/pull/20749#discussion_r559544027\r\n\r\n> `ActiveChainstate()` doesn't take `cs_main`, whereas `::ChainstateActive()` does. Is that a problem? I imagine we shouldn't be reading `m_active_chainstate` without `cs_main`. The comment says:\r\n> \r\n> ```\r\n>     //! Once this pointer is set to a corresponding chainstate, it will not\r\n>     //! be reset until init.cpp:Shutdown(). This means it is safe to acquire\r\n>     //! the contents of this pointer with ::cs_main held, release the lock,\r\n>     //! and then use the reference without concern of it being deconstructed.\r\n> ```\r\n> \r\n> Should `m_active_chainstate` be GUARDED_BY cs_main and `ActiveChainstate()` have EXCLUSIVE_LOCKS_REQUIRED(::cs_main)?\r\n\r\nWow, good catch! I assumed ActiveChainstate() either acquired cs_main or required it, and didn't know it was accessing the m_active_chainstate pointer with no protection. This is probably safe for now because the pointer never changes after initialization, but it will not be safe after #19806 which adds an ActivateSnapshot method updating the pointer.\r\n\r\nIn this particular place (this line and next line), I think it would be best not to call either ActiveChainstate or ChainstateActive because both could have a race condition after #19806 if the active chain state changes after cs_main is released in the code immediately above. Best would be to have a `CChainState* chain_state` local variable that is initialized while cs_main is held above, and then used here.\r\n\r\nIf we can add a EXCLUSIVE_LOCKS_REQUIRED annotation to `ActiveChainstate` and GUARDED_BY annotation to `m_active_chainstate` that would be gravy too, but this could also happen in #19806. Suggested it https://github.com/bitcoin/bitcoin/pull/19806#discussion_r561023961",
    "created_at": "2021-01-20T13:58:57Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r560979259",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560979259"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r560979259"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560979259/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 3665,
    "original_line": 3665,
    "side": "RIGHT",
    "in_reply_to_id": 559544027
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561009408",
    "pull_request_review_id": 572243158,
    "id": 561009408,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTAwOTQwOA==",
    "diff_hunk": "@@ -15,7 +15,7 @@\n \n void initialize_load_external_block_file()\n {\n-    InitializeFuzzingContext();\n+    static TestingSetup setup{CBaseChainParams::REGTEST, {\"-nodebuglogfile\"}};",
    "path": "src/test/fuzz/load_external_block_file.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "364fa81a2b014bd6257e011e6a201a48c1b8853e",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"fuzz: Initialize a full TestingSetup instead of BasicTestingSetup\" (364fa81a2b014bd6257e011e6a201a48c1b8853e)\r\n\r\nThis seems safe and fine, but I'm only casually familiar with the fuzzing code and can't say I understand what the goal of the change and new code actually is. It might be good to have a code comment saying what the purpose of TestingSetup/REGTEST/nodebuglogfile is here, or a commit description saying what was bad about the previous InitializeFuzzingContext call",
    "created_at": "2021-01-20T14:38:29Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561009408",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561009408"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561009408"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561009408/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 18,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561293393",
    "pull_request_review_id": 572633494,
    "id": 561293393,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTI5MzM5Mw==",
    "diff_hunk": "@@ -625,7 +625,7 @@ void CTxMemPool::check(const CCoinsViewCache *pcoins) const\n     uint64_t innerUsage = 0;\n \n     CCoinsViewCache mempoolDuplicate(const_cast<CCoinsViewCache*>(pcoins));\n-    const int64_t spendheight = GetSpendHeight(mempoolDuplicate);\n+    const int64_t spendheight = WITH_LOCK(::cs_main, return g_chainman.m_blockman.GetSpendHeight(mempoolDuplicate));",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "364fa81a2b014bd6257e011e6a201a48c1b8853e",
    "user": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I agree with all the points made, I wanted to keep it this way as it doesn't change the existing (fragile) behaviour, but just makes it more obvious. However, I do think it'd be good to add the annotation.\r\n\r\nI opened a new PR for this: https://github.com/bitcoin/bitcoin/pull/20972",
    "created_at": "2021-01-20T20:48:32Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561293393",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561293393"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561293393"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561293393/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 629,
    "side": "RIGHT",
    "in_reply_to_id": 559425521
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561293786",
    "pull_request_review_id": 572633984,
    "id": 561293786,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTI5Mzc4Ng==",
    "diff_hunk": "@@ -50,6 +51,7 @@ struct ChainTxData;\n struct DisconnectedBlockTransactions;\n struct PrecomputedTransactionData;\n struct LockPoints;\n+struct CCheckpointData;",
    "path": "src/validation.h",
    "position": null,
    "original_position": 12,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "364fa81a2b014bd6257e011e6a201a48c1b8853e",
    "user": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Good catch, fixed!",
    "created_at": "2021-01-20T20:49:10Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561293786",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561293786"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561293786"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561293786/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 54,
    "side": "RIGHT",
    "in_reply_to_id": 559429565
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561294017",
    "pull_request_review_id": 572634224,
    "id": 561294017,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTI5NDAxNw==",
    "diff_hunk": "@@ -296,7 +289,7 @@ bool UndoReadFromDisk(CBlockUndo& blockundo, const CBlockIndex* pindex);\n bool CheckBlock(const CBlock& block, BlockValidationState& state, const Consensus::Params& consensusParams, bool fCheckPOW = true, bool fCheckMerkleRoot = true);\n \n /** Check a block is completely valid from start to finish (only works on top of our current best block) */\n-bool TestBlockValidity(BlockValidationState& state, const CChainParams& chainparams, const CBlock& block, CBlockIndex* pindexPrev, bool fCheckPOW = true, bool fCheckMerkleRoot = true) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+bool TestBlockValidity(BlockValidationState& state, const CChainParams& chainparams, CChainState& chainstate, const CBlock& block, CBlockIndex* pindexPrev, bool fCheckPOW = true, bool fCheckMerkleRoot = true) EXCLUSIVE_LOCKS_REQUIRED(cs_main);",
    "path": "src/validation.h",
    "position": null,
    "original_position": 44,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "364fa81a2b014bd6257e011e6a201a48c1b8853e",
    "user": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Fixed in: d8a5fe24af84c34492e2b23ed341bae70a3c8983",
    "created_at": "2021-01-20T20:49:33Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561294017",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561294017"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561294017"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561294017/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 292,
    "side": "RIGHT",
    "in_reply_to_id": 559437992
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561294078",
    "pull_request_review_id": 572634298,
    "id": 561294078,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTI5NDA3OA==",
    "diff_hunk": "@@ -3778,42 +3780,44 @@ bool ChainstateManager::ProcessNewBlock(const CChainParams& chainparams, const s\n         bool ret = CheckBlock(*pblock, state, chainparams.GetConsensus());\n         if (ret) {\n             // Store to disk\n-            ret = ::ChainstateActive().AcceptBlock(pblock, state, chainparams, &pindex, fForceProcessing, nullptr, fNewBlock);\n+            ret = ActiveChainstate().AcceptBlock(pblock, state, chainparams, &pindex, fForceProcessing, nullptr, fNewBlock);\n         }\n         if (!ret) {\n             GetMainSignals().BlockChecked(*pblock, state);\n             return error(\"%s: AcceptBlock FAILED (%s)\", __func__, state.ToString());\n         }\n     }\n \n-    NotifyHeaderTip();\n+    NotifyHeaderTip(ActiveChainstate());\n \n     BlockValidationState state; // Only used to report errors, not invalidity - ignore it\n-    if (!::ChainstateActive().ActivateBestChain(state, chainparams, pblock))\n+    if (!ActiveChainstate().ActivateBestChain(state, chainparams, pblock))\n         return error(\"%s: ActivateBestChain failed (%s)\", __func__, state.ToString());\n \n     return true;\n }\n \n-bool TestBlockValidity(BlockValidationState& state, const CChainParams& chainparams, const CBlock& block, CBlockIndex* pindexPrev, bool fCheckPOW, bool fCheckMerkleRoot)\n+bool TestBlockValidity(BlockValidationState& state, const CChainParams& chainparams, CChainState& chainstate, const CBlock& block, CBlockIndex* pindexPrev, bool fCheckPOW, bool fCheckMerkleRoot)",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 201,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "364fa81a2b014bd6257e011e6a201a48c1b8853e",
    "user": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Fixed in: d8a5fe24af84c34492e2b23ed341bae70a3c8983",
    "created_at": "2021-01-20T20:49:41Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561294078",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561294078"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561294078"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561294078/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 3800,
    "side": "RIGHT",
    "in_reply_to_id": 559438289
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561294694",
    "pull_request_review_id": 572635102,
    "id": 561294694,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTI5NDY5NA==",
    "diff_hunk": "@@ -643,6 +649,8 @@ class CChainState\n     void PruneAndFlush();\n \n     /**\n+     * Find the best known block, and make it the tip of the block chain",
    "path": "src/validation.h",
    "position": null,
    "original_position": 120,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "364fa81a2b014bd6257e011e6a201a48c1b8853e",
    "user": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Fixed in: d0454bad30253e735254cf7be359212293d952af",
    "created_at": "2021-01-20T20:50:50Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561294694",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561294694"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561294694"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561294694/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 652,
    "side": "RIGHT",
    "in_reply_to_id": 559524032
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561295549",
    "pull_request_review_id": 572636047,
    "id": 561295549,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTI5NTU0OQ==",
    "diff_hunk": "@@ -15,7 +15,7 @@\n \n void initialize_load_external_block_file()\n {\n-    InitializeFuzzingContext();\n+    static TestingSetup setup{CBaseChainParams::REGTEST, {\"-nodebuglogfile\"}};",
    "path": "src/test/fuzz/load_external_block_file.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "364fa81a2b014bd6257e011e6a201a48c1b8853e",
    "user": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Added some context in the commit message here: 4c4eb967016d80247cbf38e6811c8640761ada42\r\nLmk if that needs additional explanation!",
    "created_at": "2021-01-20T20:52:00Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561295549",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561295549"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561295549"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561295549/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 18,
    "side": "RIGHT",
    "in_reply_to_id": 561009408
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561320325",
    "pull_request_review_id": 572667148,
    "id": 561320325,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTMyMDMyNQ==",
    "diff_hunk": "@@ -375,7 +375,7 @@ static RPCHelpMan generateblock()\n         LOCK(cs_main);\n \n         BlockValidationState state;\n-        if (!TestBlockValidity(state, chainparams, block, LookupBlockIndex(block.hashPrevBlock), false, false)) {\n+        if (!TestBlockValidity(state, chainparams, ::ChainstateActive(), block, g_chainman.m_blockman.LookupBlockIndex(block.hashPrevBlock), false, false)) {",
    "path": "src/rpc/mining.cpp",
    "position": 5,
    "original_position": 5,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "364fa81a2b014bd6257e011e6a201a48c1b8853e",
    "user": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I don't think it makes too much of a difference, and I found it clearer to push that decision to a later commit when we've resolved everything under RPC and can see everything that depends on chainman. See: 02e3831e9cd10f78bfde2d67a99c47f08564f07b",
    "created_at": "2021-01-20T21:31:46Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561320325",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561320325"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561320325"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561320325/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 378,
    "original_line": 378,
    "side": "RIGHT",
    "in_reply_to_id": 559441927
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561352940",
    "pull_request_review_id": 572708264,
    "id": 561352940,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTM1Mjk0MA==",
    "diff_hunk": "@@ -3650,8 +3651,8 @@ bool ChainstateManager::ProcessNewBlockHeaders(const std::vector<CBlockHeader>&\n             }\n         }\n     }\n-    if (NotifyHeaderTip()) {\n-        if (::ChainstateActive().IsInitialBlockDownload() && ppindex && *ppindex) {\n+    if (NotifyHeaderTip(ActiveChainstate())) {",
    "path": "src/validation.cpp",
    "position": 155,
    "original_position": 163,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "364fa81a2b014bd6257e011e6a201a48c1b8853e",
    "user": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Question: if the concern is that after #19806 the active chainstate may change after \u201ccs_main is released in the code immediately above\u201d, then that concern would still exist even if we did not switch from ::ChainstateActive to ActiveChainstate, no? In other words, this is not a new problem that my PR introduced?\r\n\r\nAs far as I can tell, the behaviour change that switching from ::ChainstateActive to ActiveChainstate introduces is just a possible race condition in ActiveChainstate() whereby a race condition can occur if m_active_chainstate is modified between its assert and its return, which I\u2019d be happy to fix if we think it\u2019s necessary.",
    "created_at": "2021-01-20T22:36:24Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561352940",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561352940"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561352940"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561352940/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 3665,
    "original_line": 3665,
    "side": "RIGHT",
    "in_reply_to_id": 559544027
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564577629",
    "pull_request_review_id": 576435123,
    "id": 564577629,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDU3NzYyOQ==",
    "diff_hunk": "@@ -3650,8 +3651,8 @@ bool ChainstateManager::ProcessNewBlockHeaders(const std::vector<CBlockHeader>&\n             }\n         }\n     }\n-    if (NotifyHeaderTip()) {\n-        if (::ChainstateActive().IsInitialBlockDownload() && ppindex && *ppindex) {\n+    if (NotifyHeaderTip(ActiveChainstate())) {",
    "path": "src/validation.cpp",
    "position": 155,
    "original_position": 163,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "364fa81a2b014bd6257e011e6a201a48c1b8853e",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "For what it's worth, I'd figured that the [`GUARDED_BY` on `g_chainman`](https://github.com/bitcoin/bitcoin/blob/master/src/validation.h#L937) would've cascaded through to many of the usages in question, but maybe I misunderstood.",
    "created_at": "2021-01-26T14:59:59Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r564577629",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564577629"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r564577629"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564577629/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 3665,
    "original_line": 3665,
    "side": "RIGHT",
    "in_reply_to_id": 559544027
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564711195",
    "pull_request_review_id": 576608102,
    "id": 564711195,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDcxMTE5NQ==",
    "diff_hunk": "@@ -625,7 +625,7 @@ void CTxMemPool::check(const CCoinsViewCache *pcoins) const\n     uint64_t innerUsage = 0;\n \n     CCoinsViewCache mempoolDuplicate(const_cast<CCoinsViewCache*>(pcoins));\n-    const int64_t spendheight = GetSpendHeight(mempoolDuplicate);\n+    const int64_t spendheight = WITH_LOCK(::cs_main, return g_chainman.m_blockman.GetSpendHeight(mempoolDuplicate));",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "364fa81a2b014bd6257e011e6a201a48c1b8853e",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Er, why is `WITH_LOCK(cs_main)` needed if `check()` has already asserted that it's held?",
    "created_at": "2021-01-26T17:51:06Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r564711195",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564711195"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r564711195"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564711195/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 629,
    "side": "RIGHT",
    "in_reply_to_id": 559425521
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564802417",
    "pull_request_review_id": 576723024,
    "id": 564802417,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDgwMjQxNw==",
    "diff_hunk": "@@ -625,7 +625,7 @@ void CTxMemPool::check(const CCoinsViewCache *pcoins) const\n     uint64_t innerUsage = 0;\n \n     CCoinsViewCache mempoolDuplicate(const_cast<CCoinsViewCache*>(pcoins));\n-    const int64_t spendheight = GetSpendHeight(mempoolDuplicate);\n+    const int64_t spendheight = WITH_LOCK(::cs_main, return g_chainman.m_blockman.GetSpendHeight(mempoolDuplicate));",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "364fa81a2b014bd6257e011e6a201a48c1b8853e",
    "user": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Fixed!",
    "created_at": "2021-01-26T20:13:18Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r564802417",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564802417"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r564802417"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564802417/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 629,
    "side": "RIGHT",
    "in_reply_to_id": 559425521
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565985090",
    "pull_request_review_id": 578192234,
    "id": 565985090,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTk4NTA5MA==",
    "diff_hunk": "@@ -12,6 +12,7 @@\n \n #include <amount.h>\n #include <coins.h>\n+#include <chainparams.h>",
    "path": "src/validation.h",
    "position": null,
    "original_position": 4,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "2bda16f4e46bf361bcfa600a4e751e6303a63d0d",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This isn't required. You can just forward declare `CCheckpointData` and then include chainparams.h in validation.cpp (if a type is only used as a reference argument for a function declaration, you don't need the full definition for that type).",
    "created_at": "2021-01-28T10:32:54Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r565985090",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565985090"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r565985090"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565985090/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 15,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565987283",
    "pull_request_review_id": 578192234,
    "id": 565987283,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTk4NzI4Mw==",
    "diff_hunk": "@@ -525,18 +533,18 @@ class CChainState\n      */\n     mutable std::atomic<bool> m_cached_finished_ibd{false};\n \n-    //! Reference to a BlockManager instance which itself is shared across all\n-    //! CChainState instances. Keeping a local reference allows us to test more\n-    //! easily as opposed to referencing a global.\n-    BlockManager& m_blockman;\n-\n     //! mempool that is kept in sync with the chain\n     CTxMemPool& m_mempool;\n \n     //! Manages the UTXO set, which is a reflection of the contents of `m_chain`.\n     std::unique_ptr<CoinsViews> m_coins_views;\n \n public:\n+    //! Reference to a BlockManager instance which itself is shared across all\n+    //! CChainState instances. Keeping a local reference allows us to test more\n+    //! easily as opposed to referencing a global.",
    "path": "src/validation.h",
    "position": null,
    "original_position": 98,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "2bda16f4e46bf361bcfa600a4e751e6303a63d0d",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "\"Keeping a local reference allows us to test more easily as opposed to referencing a global.\" is outdated, since this reference is no longer used just for testing and is part of the public interface.",
    "created_at": "2021-01-28T10:36:06Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r565987283",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565987283"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r565987283"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565987283/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 544,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 545,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565989760",
    "pull_request_review_id": 578192234,
    "id": 565989760,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTk4OTc2MA==",
    "diff_hunk": "@@ -291,7 +283,13 @@ bool UndoReadFromDisk(CBlockUndo& blockundo, const CBlockIndex* pindex);\n bool CheckBlock(const CBlock& block, BlockValidationState& state, const Consensus::Params& consensusParams, bool fCheckPOW = true, bool fCheckMerkleRoot = true);\n \n /** Check a block is completely valid from start to finish (only works on top of our current best block) */\n-bool TestBlockValidity(BlockValidationState& state, const CChainParams& chainparams, const CBlock& block, CBlockIndex* pindexPrev, bool fCheckPOW = true, bool fCheckMerkleRoot = true) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+bool TestBlockValidity(BlockValidationState& state,\n+                       const CChainParams& chainparams,\n+                       CChainState& chainstate,",
    "path": "src/validation.h",
    "position": 38,
    "original_position": 38,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "2bda16f4e46bf361bcfa600a4e751e6303a63d0d",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I was going to ask if you could `const CChainState&` to indicate that you're not mutating the chainstate...\r\n\r\n... but in fact `TestBlockValidity()` connects the passed-in block to the chain tip. What a terrible name for this function!",
    "created_at": "2021-01-28T10:39:47Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r565989760",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565989760"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r565989760"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565989760/reactions",
      "total_count": 2,
      "+1": 0,
      "-1": 0,
      "laugh": 2,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 288,
    "original_line": 288,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566009682",
    "pull_request_review_id": 578192234,
    "id": 566009682,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjAwOTY4Mg==",
    "diff_hunk": "@@ -375,7 +375,7 @@ static RPCHelpMan generateblock()\n         LOCK(cs_main);\n \n         BlockValidationState state;\n-        if (!TestBlockValidity(state, chainparams, block, LookupBlockIndex(block.hashPrevBlock), false, false)) {\n+        if (!TestBlockValidity(state, chainparams, ::ChainstateActive(), block, g_chainman.m_blockman.LookupBlockIndex(block.hashPrevBlock), false, false)) {",
    "path": "src/rpc/mining.cpp",
    "position": 5,
    "original_position": 5,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "364fa81a2b014bd6257e011e6a201a48c1b8853e",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "ok!",
    "created_at": "2021-01-28T11:10:24Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r566009682",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566009682"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r566009682"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566009682/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 378,
    "original_line": 378,
    "side": "RIGHT",
    "in_reply_to_id": 559441927
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566019524",
    "pull_request_review_id": 578192234,
    "id": 566019524,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjAxOTUyNA==",
    "diff_hunk": "@@ -3650,8 +3651,8 @@ bool ChainstateManager::ProcessNewBlockHeaders(const std::vector<CBlockHeader>&\n             }\n         }\n     }\n-    if (NotifyHeaderTip()) {\n-        if (::ChainstateActive().IsInitialBlockDownload() && ppindex && *ppindex) {\n+    if (NotifyHeaderTip(ActiveChainstate())) {",
    "path": "src/validation.cpp",
    "position": 155,
    "original_position": 163,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "364fa81a2b014bd6257e011e6a201a48c1b8853e",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": ">  if the concern is that after #19806 the active chainstate may change after \u201ccs_main is released in the code immediately above\u201d, then that concern would still exist even if we did not switch from ::ChainstateActive to ActiveChainstate, no? In other words, this is not a new problem that my PR introduced?\r\n\r\nThe concern is that reading/writing `m_active_chainstate` is not guaranteed to be atomic. If this thread reads the variable while another thread is writing to it, then it could read the old value, the new value, or anything else. We have no guarantees at all about what is read if the value is not atomic (or guarded by a mutex to prevent multiple threads accessing it at the same time).\r\n\r\nThis seems fairly simple to solve - just make `m_active_chainstate` atomic.",
    "created_at": "2021-01-28T11:26:56Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r566019524",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566019524"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r566019524"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566019524/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 3665,
    "original_line": 3665,
    "side": "RIGHT",
    "in_reply_to_id": 559544027
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566020865",
    "pull_request_review_id": 578192234,
    "id": 566020865,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjAyMDg2NQ==",
    "diff_hunk": "@@ -3788,42 +3790,50 @@ bool ChainstateManager::ProcessNewBlock(const CChainParams& chainparams, const s\n         bool ret = CheckBlock(*pblock, state, chainparams.GetConsensus());\n         if (ret) {\n             // Store to disk\n-            ret = ::ChainstateActive().AcceptBlock(pblock, state, chainparams, &pindex, fForceProcessing, nullptr, fNewBlock);\n+            ret = ActiveChainstate().AcceptBlock(pblock, state, chainparams, &pindex, fForceProcessing, nullptr, fNewBlock);\n         }\n         if (!ret) {\n             GetMainSignals().BlockChecked(*pblock, state);\n             return error(\"%s: AcceptBlock FAILED (%s)\", __func__, state.ToString());\n         }\n     }\n \n-    NotifyHeaderTip();\n+    NotifyHeaderTip(ActiveChainstate());",
    "path": "src/validation.cpp",
    "position": 182,
    "original_position": 190,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "2bda16f4e46bf361bcfa600a4e751e6303a63d0d",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Same problem as above: you're grabbing `m_active_chainstate` without locking cs_main first. I think it'd be easiest to make a local `CChainstate*` variable and set it while holding cs_main.",
    "created_at": "2021-01-28T11:29:14Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r566020865",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566020865"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r566020865"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566020865/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 3802,
    "original_line": 3802,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566338288",
    "pull_request_review_id": 578651849,
    "id": 566338288,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjMzODI4OA==",
    "diff_hunk": "@@ -12,6 +12,7 @@\n \n #include <amount.h>\n #include <coins.h>\n+#include <chainparams.h>",
    "path": "src/validation.h",
    "position": null,
    "original_position": 4,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "2bda16f4e46bf361bcfa600a4e751e6303a63d0d",
    "user": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Fixed!",
    "created_at": "2021-01-28T19:04:41Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r566338288",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566338288"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r566338288"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566338288/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 15,
    "side": "RIGHT",
    "in_reply_to_id": 565985090
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566339904",
    "pull_request_review_id": 578653891,
    "id": 566339904,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjMzOTkwNA==",
    "diff_hunk": "@@ -3788,42 +3790,50 @@ bool ChainstateManager::ProcessNewBlock(const CChainParams& chainparams, const s\n         bool ret = CheckBlock(*pblock, state, chainparams.GetConsensus());\n         if (ret) {\n             // Store to disk\n-            ret = ::ChainstateActive().AcceptBlock(pblock, state, chainparams, &pindex, fForceProcessing, nullptr, fNewBlock);\n+            ret = ActiveChainstate().AcceptBlock(pblock, state, chainparams, &pindex, fForceProcessing, nullptr, fNewBlock);\n         }\n         if (!ret) {\n             GetMainSignals().BlockChecked(*pblock, state);\n             return error(\"%s: AcceptBlock FAILED (%s)\", __func__, state.ToString());\n         }\n     }\n \n-    NotifyHeaderTip();\n+    NotifyHeaderTip(ActiveChainstate());",
    "path": "src/validation.cpp",
    "position": 182,
    "original_position": 190,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "2bda16f4e46bf361bcfa600a4e751e6303a63d0d",
    "user": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Fixed by rebasing over #21025",
    "created_at": "2021-01-28T19:07:26Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r566339904",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566339904"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r566339904"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566339904/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 3802,
    "original_line": 3802,
    "side": "RIGHT",
    "in_reply_to_id": 566020865
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566340540",
    "pull_request_review_id": 578654620,
    "id": 566340540,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjM0MDU0MA==",
    "diff_hunk": "@@ -3650,8 +3651,8 @@ bool ChainstateManager::ProcessNewBlockHeaders(const std::vector<CBlockHeader>&\n             }\n         }\n     }\n-    if (NotifyHeaderTip()) {\n-        if (::ChainstateActive().IsInitialBlockDownload() && ppindex && *ppindex) {\n+    if (NotifyHeaderTip(ActiveChainstate())) {",
    "path": "src/validation.cpp",
    "position": 155,
    "original_position": 163,
    "commit_id": "67c9a83df19c6e2a2edb32336879204e7770b4a7",
    "original_commit_id": "364fa81a2b014bd6257e011e6a201a48c1b8853e",
    "user": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Fixed by rebasing over #21025, thanks all for the patience and guidance!",
    "created_at": "2021-01-28T19:08:19Z",
    "updated_at": "2021-01-28T19:15:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r566340540",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566340540"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r566340540"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566340540/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 3665,
    "original_line": 3665,
    "side": "RIGHT",
    "in_reply_to_id": 559544027
  }
]