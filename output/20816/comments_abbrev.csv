MarcoFalke,2020-12-31 11:26:40,Concept ACK. Will review next year.,https://github.com/bitcoin/bitcoin/pull/20816#issuecomment-752930886,752930886,
DrahtBot,2020-12-31 15:44:39,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19673 (Move cs_vSend into SocketSendData and resolve RecordBytesSent lock inconsistency by troygiorshev)\n\nIf you consid",https://github.com/bitcoin/bitcoin/pull/20816#issuecomment-752991317,752991317,
practicalswift,2020-12-31 16:08:46,"Concept ACK\n\nThanks for improving locking!",https://github.com/bitcoin/bitcoin/pull/20816#issuecomment-752995929,752995929,
MarcoFalke,2021-01-05 10:47:01,let me know if you want this merged or address the style nits,https://github.com/bitcoin/bitcoin/pull/20816#issuecomment-754559230,754559230,
jnewbery,2021-01-05 11:25:42,"> let me know if you want this merged or address the style nits\n\nI'll address your review comments. Might as well fix those things up while I'm touching this code.",https://github.com/bitcoin/bitcoin/pull/20816#issuecomment-754578097,754578097,
jnewbery,2021-01-05 12:02:14,Thanks for the review @MarcoFalke. I've addressed your comments.,https://github.com/bitcoin/bitcoin/pull/20816#issuecomment-754594160,754594160,
theStack,2021-01-05 12:38:22,"CI is failing now:\n```\nIn file included from net.cpp:10:\n./net.h:451:77: error: member access into incomplete type 'CNode'\n    size_t SocketSendData(CNode& pnode) const EXCLUSIVE_LOCKS_REQUIRED(pnode.cs_vSend);\n                                                                            ^\n./net.h:39:7: note: forward declaration of 'CNode'\nclass CNode;\n      ^\n1 error generated.\n",https://github.com/bitcoin/bitcoin/pull/20816#issuecomment-754610166,754610166,
jnewbery,2021-01-05 13:38:47,"ok, reverting to commit 378aedc which has two ACKs already. Any style issues can be fixed up in future PRs.",https://github.com/bitcoin/bitcoin/pull/20816#issuecomment-754641755,754641755,
troygiorshev,2021-01-06 06:03:28,"ACK 378aedc45248cea82d9a3e6dc1038d6828008a76\n\nThis is definitely the right way to fix this.",https://github.com/bitcoin/bitcoin/pull/20816#issuecomment-755101347,755101347,
theStack,2021-01-02 14:35:34,"stylistic yocto-nit: could drop the curly braces for the lambda argument here -- according to `git grep WITH_LOCK.*return` on all other places the code is directly passed, w/o putting in a block.\n\n```suggestion\n            size_t bytes_sent = WITH_LOCK(pnode->cs_vSend, return SocketSendData(pnode));\n```\n\nOTOH maybe the way in this PR is preferred and the others should be adapted (thoug",https://github.com/bitcoin/bitcoin/pull/20816#discussion_r550887371,550887371,src/net.cpp
jnewbery,2021-01-02 17:21:20,"Fixed. Much nicer, thanks!",https://github.com/bitcoin/bitcoin/pull/20816#discussion_r550901857,550901857,src/net.cpp
MarcoFalke,2021-01-05 10:22:43,in the first commit: I think the code is already self-documenting. No need for this,https://github.com/bitcoin/bitcoin/pull/20816#discussion_r551841676,551841676,src/net.cpp
MarcoFalke,2021-01-05 10:24:24,"same commit: The lock annotation for this member function `SocketSendData` is in the wrong place. Should be in the h file not the cpp file because otherwise moving code can disable the annotation.\n\nWould be nice to fix in this pull and maybe also update the `SocketSendData` pointer arg to a reference?",https://github.com/bitcoin/bitcoin/pull/20816#discussion_r551842508,551842508,src/net.cpp
jnewbery,2021-01-05 11:27:02,I only kept this because there was a comment before but you're right - it's useless. Removing.,https://github.com/bitcoin/bitcoin/pull/20816#discussion_r551874043,551874043,src/net.cpp
jnewbery,2021-01-05 12:01:54,Done.,https://github.com/bitcoin/bitcoin/pull/20816#discussion_r551889862,551889862,src/net.cpp
