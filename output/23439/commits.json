[
  {
    "sha": "a04350b86c14a8038117aa013952b4e2b5f91cb0",
    "node_id": "C_kwDOABII59oAKGEwNDM1MGI4NmMxNGE4MDM4MTE3YWEwMTM5NTJiNGUyYjVmOTFjYjA",
    "commit": {
      "author": {
        "name": "Martin Leitner-Ankerl",
        "email": "martin.ankerl@gmail.com",
        "date": "2021-11-04T17:46:57Z"
      },
      "committer": {
        "name": "Martin Leitner-Ankerl",
        "email": "martin.ankerl@gmail.com",
        "date": "2021-11-04T17:47:14Z"
      },
      "message": "Open streams_test_tmp file in temporary folder\n\nThe tests `streams_tests/streams_buffered_file` and `streams_tests/streams_buffered_file_rand`\ndid not use a the temporary directory provided by  `BasicTestingSetup`, so it was not possible\nto execute multiple of them in parallel. This fixes that.\n\nTo reproduce, run\n\n```sh\nparallel --halt now,fail=1 './src/test/test_bitcoin --run_test=streams_tests/streams_buffered_file_rand' -- ::: {1..1000}\n```\n\nThis executes the test 1000 times, one job per CPU. It works on that commit but mergebase fails quickly.",
      "tree": {
        "sha": "4769a594918cdd18073ad58280f0cacfd1de0fec",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4769a594918cdd18073ad58280f0cacfd1de0fec"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a04350b86c14a8038117aa013952b4e2b5f91cb0",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCAAdFiEEqyQrdqB7R6j2Hv2k++qtf8b//oEFAmGEHPIACgkQ++qtf8b/\n/oGM+QwAnf+uWV7XTvGuUgMVc4LsQPO8q9GI7kPSvBCLbSXvJkrNFlv6eJIHqi4H\n8PJRjyd/hZLuPAu2a03P9vuU7uGF6GX79UowcaqmhOJmCfuPGBvZMbObz2BmLcfC\neoDgmycX0E0N80PekHO/ee3Po5D+AR+ynVS/Hh6IIfcFRTNKK9oqWDBg8CIPTP4C\nZtkTN2aZyO48uPA4K7B5AAIKf1t5JjTH1zDKxh8EdCjnK8Wz0g3WxwwpFk/LZ8E7\n0JzqCQ9Vw5bPnmYT9LJwnQbmcxaIhoxGDyvwIwglDbmqE5cfoqmrFDQ2Pshiii2f\n6PPx3++4kb1XpE61zGGIuVWXbJ3iLsfG0vIvM2WJy0AAuepeW0Ox04Fbx7d1U0jg\neEVNrLOdgoqaOBpeLK5J9fz/Gwjepi6YTeQKZRcFRukb2WBQrg2AJoQzRKlQX4rZ\nlj4sjpW33xUEHst3VeebvZRSnLKZWsrhSokUqFYpl5S//f8j59HBEwLiq+qwgr4m\nki1M0Xn/\n=/MH6\n-----END PGP SIGNATURE-----",
        "payload": "tree 4769a594918cdd18073ad58280f0cacfd1de0fec\nparent 24abd8312ec1caa04f9b3bd92cd960e28ca91e17\nauthor Martin Leitner-Ankerl <martin.ankerl@gmail.com> 1636048017 +0100\ncommitter Martin Leitner-Ankerl <martin.ankerl@gmail.com> 1636048034 +0100\n\nOpen streams_test_tmp file in temporary folder\n\nThe tests `streams_tests/streams_buffered_file` and `streams_tests/streams_buffered_file_rand`\ndid not use a the temporary directory provided by  `BasicTestingSetup`, so it was not possible\nto execute multiple of them in parallel. This fixes that.\n\nTo reproduce, run\n\n```sh\nparallel --halt now,fail=1 './src/test/test_bitcoin --run_test=streams_tests/streams_buffered_file_rand' -- ::: {1..1000}\n```\n\nThis executes the test 1000 times, one job per CPU. It works on that commit but mergebase fails quickly.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a04350b86c14a8038117aa013952b4e2b5f91cb0",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/a04350b86c14a8038117aa013952b4e2b5f91cb0",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a04350b86c14a8038117aa013952b4e2b5f91cb0/comments",
    "author": {
      "login": "martinus",
      "id": 14386,
      "node_id": "MDQ6VXNlcjE0Mzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/14386?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/martinus",
      "html_url": "https://github.com/martinus",
      "followers_url": "https://api.github.com/users/martinus/followers",
      "following_url": "https://api.github.com/users/martinus/following{/other_user}",
      "gists_url": "https://api.github.com/users/martinus/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/martinus/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/martinus/subscriptions",
      "organizations_url": "https://api.github.com/users/martinus/orgs",
      "repos_url": "https://api.github.com/users/martinus/repos",
      "events_url": "https://api.github.com/users/martinus/events{/privacy}",
      "received_events_url": "https://api.github.com/users/martinus/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "martinus",
      "id": 14386,
      "node_id": "MDQ6VXNlcjE0Mzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/14386?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/martinus",
      "html_url": "https://github.com/martinus",
      "followers_url": "https://api.github.com/users/martinus/followers",
      "following_url": "https://api.github.com/users/martinus/following{/other_user}",
      "gists_url": "https://api.github.com/users/martinus/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/martinus/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/martinus/subscriptions",
      "organizations_url": "https://api.github.com/users/martinus/orgs",
      "repos_url": "https://api.github.com/users/martinus/repos",
      "events_url": "https://api.github.com/users/martinus/events{/privacy}",
      "received_events_url": "https://api.github.com/users/martinus/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "24abd8312ec1caa04f9b3bd92cd960e28ca91e17",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/24abd8312ec1caa04f9b3bd92cd960e28ca91e17",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/24abd8312ec1caa04f9b3bd92cd960e28ca91e17"
      }
    ],
    "stats": {
      "total": 11,
      "additions": 7,
      "deletions": 4
    },
    "files": [
      {
        "sha": "54f04d2e67ee8c0ec38c2a0a8875f3d4eb4ddc8d",
        "filename": "src/test/streams_tests.cpp",
        "status": "modified",
        "additions": 7,
        "deletions": 4,
        "changes": 11,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/a04350b86c14a8038117aa013952b4e2b5f91cb0/src/test/streams_tests.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/a04350b86c14a8038117aa013952b4e2b5f91cb0/src/test/streams_tests.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/streams_tests.cpp?ref=a04350b86c14a8038117aa013952b4e2b5f91cb0",
        "patch": "@@ -215,7 +215,9 @@ BOOST_AUTO_TEST_CASE(streams_serializedata_xor)\n \n BOOST_AUTO_TEST_CASE(streams_buffered_file)\n {\n-    FILE* file = fsbridge::fopen(\"streams_test_tmp\", \"w+b\");\n+    fs::path streams_test_filename = m_args.GetDataDirBase() / \"streams_test_tmp\";\n+    FILE* file = fsbridge::fopen(streams_test_filename, \"w+b\");\n+\n     // The value at each offset is the offset.\n     for (uint8_t j = 0; j < 40; ++j) {\n         fwrite(&j, 1, 1, file);\n@@ -343,16 +345,17 @@ BOOST_AUTO_TEST_CASE(streams_buffered_file)\n     // We can explicitly close the file, or the destructor will do it.\n     bf.fclose();\n \n-    fs::remove(\"streams_test_tmp\");\n+    fs::remove(streams_test_filename);\n }\n \n BOOST_AUTO_TEST_CASE(streams_buffered_file_rand)\n {\n     // Make this test deterministic.\n     SeedInsecureRand(SeedRand::ZEROS);\n \n+    fs::path streams_test_filename = m_args.GetDataDirBase() / \"streams_test_tmp\";\n     for (int rep = 0; rep < 50; ++rep) {\n-        FILE* file = fsbridge::fopen(\"streams_test_tmp\", \"w+b\");\n+        FILE* file = fsbridge::fopen(streams_test_filename, \"w+b\");\n         size_t fileSize = InsecureRandRange(256);\n         for (uint8_t i = 0; i < fileSize; ++i) {\n             fwrite(&i, 1, 1, file);\n@@ -453,7 +456,7 @@ BOOST_AUTO_TEST_CASE(streams_buffered_file_rand)\n                 maxPos = currentPos;\n         }\n     }\n-    fs::remove(\"streams_test_tmp\");\n+    fs::remove(streams_test_filename);\n }\n \n BOOST_AUTO_TEST_SUITE_END()"
      }
    ]
  }
]