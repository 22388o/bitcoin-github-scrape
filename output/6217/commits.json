[
  {
    "sha": "51fc672f59f390ce4ddf05448b63bdf11e80563b",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1MWZjNjcyZjU5ZjM5MGNlNGRkZjA1NDQ4YjYzYmRmMTFlODA1NjNi",
    "commit": {
      "author": {
        "name": "Philip Kaufmann",
        "email": "phil.kaufmann@t-online.de",
        "date": "2015-06-01T13:32:25Z"
      },
      "committer": {
        "name": "Philip Kaufmann",
        "email": "phil.kaufmann@t-online.de",
        "date": "2015-06-02T07:34:35Z"
      },
      "message": "[Qt] disconnect peers from peers tab via context menu\n\n- It is now allowed to disconnect peers from peers tab via\n  right-click context menu. Peers are not permanently banned!",
      "tree": {
        "sha": "3fda7483dbac74aa403a123e4f13124e7947048d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3fda7483dbac74aa403a123e4f13124e7947048d"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/51fc672f59f390ce4ddf05448b63bdf11e80563b",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/51fc672f59f390ce4ddf05448b63bdf11e80563b",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/51fc672f59f390ce4ddf05448b63bdf11e80563b",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/51fc672f59f390ce4ddf05448b63bdf11e80563b/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "f00b62391b9317bf4c83676520fede1fb4027c43",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f00b62391b9317bf4c83676520fede1fb4027c43",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/f00b62391b9317bf4c83676520fede1fb4027c43"
      }
    ],
    "stats": {
      "total": 63,
      "additions": 61,
      "deletions": 2
    },
    "files": [
      {
        "sha": "581d2321bcbb8f0bf6a8f46fd8f15b433c8271b7",
        "filename": "src/qt/guiutil.cpp",
        "status": "modified",
        "additions": 13,
        "deletions": 0,
        "changes": 13,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/51fc672f59f390ce4ddf05448b63bdf11e80563b/src/qt/guiutil.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/51fc672f59f390ce4ddf05448b63bdf11e80563b/src/qt/guiutil.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/guiutil.cpp?ref=51fc672f59f390ce4ddf05448b63bdf11e80563b",
        "patch": "@@ -265,6 +265,19 @@ void copyEntryData(QAbstractItemView *view, int column, int role)\n     }\n }\n \n+QString getEntryData(QAbstractItemView *view, int column, int role)\n+{\n+    if(!view || !view->selectionModel())\n+        return QString();\n+    QModelIndexList selection = view->selectionModel()->selectedRows(column);\n+\n+    if(!selection.isEmpty()) {\n+        // Return first item\n+        return (selection.at(0).data(role).toString());\n+    }\n+    return QString();\n+}\n+\n QString getSaveFileName(QWidget *parent, const QString &caption, const QString &dir,\n     const QString &filter,\n     QString *selectedSuffixOut)"
      },
      {
        "sha": "55df64a25667072d4a2addd6118f4fa9b4630928",
        "filename": "src/qt/guiutil.h",
        "status": "modified",
        "additions": 9,
        "deletions": 1,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/51fc672f59f390ce4ddf05448b63bdf11e80563b/src/qt/guiutil.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/51fc672f59f390ce4ddf05448b63bdf11e80563b/src/qt/guiutil.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/guiutil.h?ref=51fc672f59f390ce4ddf05448b63bdf11e80563b",
        "patch": "@@ -64,6 +64,14 @@ namespace GUIUtil\n      */\n     void copyEntryData(QAbstractItemView *view, int column, int role=Qt::EditRole);\n \n+    /** Return a field of the currently selected entry as a QString. Does nothing if nothing\n+        is selected.\n+       @param[in] column  Data column to extract from the model\n+       @param[in] role    Data role to extract from the model\n+       @see  TransactionView::copyLabel, TransactionView::copyAmount, TransactionView::copyAddress\n+     */\n+    QString getEntryData(QAbstractItemView *view, int column, int role);\n+\n     void setClipboard(const QString& str);\n \n     /** Get save filename, mimics QFileDialog::getSaveFileName, except that it appends a default suffix\n@@ -205,7 +213,7 @@ namespace GUIUtil\n #else\n     typedef QProgressBar ProgressBar;\n #endif\n-    \n+\n } // namespace GUIUtil\n \n #endif // BITCOIN_QT_GUIUTIL_H"
      },
      {
        "sha": "055824c19362a17b9c804b53fd50886d55373282",
        "filename": "src/qt/rpcconsole.cpp",
        "status": "modified",
        "additions": 33,
        "deletions": 1,
        "changes": 34,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/51fc672f59f390ce4ddf05448b63bdf11e80563b/src/qt/rpcconsole.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/51fc672f59f390ce4ddf05448b63bdf11e80563b/src/qt/rpcconsole.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/rpcconsole.cpp?ref=51fc672f59f390ce4ddf05448b63bdf11e80563b",
        "patch": "@@ -25,6 +25,7 @@\n #endif\n \n #include <QKeyEvent>\n+#include <QMenu>\n #include <QScrollBar>\n #include <QThread>\n #include <QTime>\n@@ -205,7 +206,8 @@ RPCConsole::RPCConsole(QWidget *parent) :\n     ui(new Ui::RPCConsole),\n     clientModel(0),\n     historyPtr(0),\n-    cachedNodeid(-1)\n+    cachedNodeid(-1),\n+    contextMenu(0)\n {\n     ui->setupUi(this);\n     GUIUtil::restoreWindowGeometry(\"nRPCConsoleWindow\", this->size(), this);\n@@ -305,10 +307,22 @@ void RPCConsole::setClientModel(ClientModel *model)\n         ui->peerWidget->setEditTriggers(QAbstractItemView::NoEditTriggers);\n         ui->peerWidget->setSelectionBehavior(QAbstractItemView::SelectRows);\n         ui->peerWidget->setSelectionMode(QAbstractItemView::SingleSelection);\n+        ui->peerWidget->setContextMenuPolicy(Qt::CustomContextMenu);\n         ui->peerWidget->setColumnWidth(PeerTableModel::Address, ADDRESS_COLUMN_WIDTH);\n         ui->peerWidget->setColumnWidth(PeerTableModel::Subversion, SUBVERSION_COLUMN_WIDTH);\n         ui->peerWidget->setColumnWidth(PeerTableModel::Ping, PING_COLUMN_WIDTH);\n \n+        // create context menu actions\n+        QAction* disconnectAction = new QAction(tr(\"&Disconnect Node\"), this);\n+\n+        // create context menu\n+        contextMenu = new QMenu();\n+        contextMenu->addAction(disconnectAction);\n+\n+        // context menu signals\n+        connect(ui->peerWidget, SIGNAL(customContextMenuRequested(const QPoint&)), this, SLOT(showMenu(const QPoint&)));\n+        connect(disconnectAction, SIGNAL(triggered()), this, SLOT(disconnectSelectedNode()));\n+\n         // connect the peerWidget selection model to our peerSelected() handler\n         connect(ui->peerWidget->selectionModel(), SIGNAL(selectionChanged(const QItemSelection &, const QItemSelection &)),\n              this, SLOT(peerSelected(const QItemSelection &, const QItemSelection &)));\n@@ -659,3 +673,21 @@ void RPCConsole::hideEvent(QHideEvent *event)\n     // stop PeerTableModel auto refresh\n     clientModel->getPeerTableModel()->stopAutoRefresh();\n }\n+\n+void RPCConsole::showMenu(const QPoint& point)\n+{\n+    QModelIndex index = ui->peerWidget->indexAt(point);\n+    if (index.isValid())\n+        contextMenu->exec(QCursor::pos());\n+}\n+\n+void RPCConsole::disconnectSelectedNode()\n+{\n+    // Get currently selected peer address\n+    QString strNode = GUIUtil::getEntryData(ui->peerWidget, 0, PeerTableModel::Address);\n+    // Find the node, disconnect it and clear the selected node\n+    if (CNode *bannedNode = FindNode(strNode.toStdString())) {\n+        bannedNode->CloseSocketDisconnect();\n+        ui->peerWidget->selectionModel()->clearSelection();\n+    }\n+}"
      },
      {
        "sha": "767e9aaeea931270dc6ec6c2b5a3ca24d22425e6",
        "filename": "src/qt/rpcconsole.h",
        "status": "modified",
        "additions": 6,
        "deletions": 0,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/51fc672f59f390ce4ddf05448b63bdf11e80563b/src/qt/rpcconsole.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/51fc672f59f390ce4ddf05448b63bdf11e80563b/src/qt/rpcconsole.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/rpcconsole.h?ref=51fc672f59f390ce4ddf05448b63bdf11e80563b",
        "patch": "@@ -19,6 +19,7 @@ namespace Ui {\n }\n \n QT_BEGIN_NAMESPACE\n+class QMenu;\n class QItemSelection;\n QT_END_NAMESPACE\n \n@@ -57,6 +58,8 @@ private slots:\n     void resizeEvent(QResizeEvent *event);\n     void showEvent(QShowEvent *event);\n     void hideEvent(QHideEvent *event);\n+    /** Show custom context menu on Peers tab */\n+    void showMenu(const QPoint& point);\n \n public slots:\n     void clear();\n@@ -73,6 +76,8 @@ public slots:\n     void peerSelected(const QItemSelection &selected, const QItemSelection &deselected);\n     /** Handle updated peer information */\n     void peerLayoutChanged();\n+\t/** Disconnect a selected node on the Peers tab */\n+    void disconnectSelectedNode();\n \n signals:\n     // For RPC command executor\n@@ -98,6 +103,7 @@ public slots:\n     QStringList history;\n     int historyPtr;\n     NodeId cachedNodeid;\n+    QMenu *contextMenu;\n };\n \n #endif // BITCOIN_QT_RPCCONSOLE_H"
      }
    ]
  }
]