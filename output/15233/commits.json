[
  {
    "sha": "b09dab0f2de37be3c96f5087ee7bd61d7262aa76",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiMDlkYWIwZjJkZTM3YmUzYzk2ZjUwODdlZTdiZDYxZDcyNjJhYTc2",
    "commit": {
      "author": {
        "name": "Akio Nakamura",
        "email": "nakamura@dgtechnologies.co.jp",
        "date": "2019-01-23T01:57:16Z"
      },
      "committer": {
        "name": "Akio Nakamura",
        "email": "nakamura@dgtechnologies.co.jp",
        "date": "2019-01-25T04:21:59Z"
      },
      "message": "Prevent mutex lock fail even if --enable-debug\n\nThis PR intends to resolve #15227.\n\n\"configure --debug-enabled\" enables \"#ifdef DEBUG_LOCKORDER\".\nThen \"lockdata\" (in sync.cpp) will be initialized same as other\nstatic objects.\n\nBut unfortunately, lockdata.push_lock() was called before its\ninitialization (via initializing signatureCache which is declared\nin script/sigcache.cpp) on macOS.\n\nThis PR apply the \"Construct On First Use Idiom\" to \"lockdata\"\nto prevent it.",
      "tree": {
        "sha": "4e72f703b4527288b2ae6ec8707c0a24f4346650",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4e72f703b4527288b2ae6ec8707c0a24f4346650"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b09dab0f2de37be3c96f5087ee7bd61d7262aa76",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b09dab0f2de37be3c96f5087ee7bd61d7262aa76",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/b09dab0f2de37be3c96f5087ee7bd61d7262aa76",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b09dab0f2de37be3c96f5087ee7bd61d7262aa76/comments",
    "author": {
      "login": "AkioNak",
      "id": 24285095,
      "node_id": "MDQ6VXNlcjI0Mjg1MDk1",
      "avatar_url": "https://avatars.githubusercontent.com/u/24285095?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AkioNak",
      "html_url": "https://github.com/AkioNak",
      "followers_url": "https://api.github.com/users/AkioNak/followers",
      "following_url": "https://api.github.com/users/AkioNak/following{/other_user}",
      "gists_url": "https://api.github.com/users/AkioNak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AkioNak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AkioNak/subscriptions",
      "organizations_url": "https://api.github.com/users/AkioNak/orgs",
      "repos_url": "https://api.github.com/users/AkioNak/repos",
      "events_url": "https://api.github.com/users/AkioNak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AkioNak/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "AkioNak",
      "id": 24285095,
      "node_id": "MDQ6VXNlcjI0Mjg1MDk1",
      "avatar_url": "https://avatars.githubusercontent.com/u/24285095?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AkioNak",
      "html_url": "https://github.com/AkioNak",
      "followers_url": "https://api.github.com/users/AkioNak/followers",
      "following_url": "https://api.github.com/users/AkioNak/following{/other_user}",
      "gists_url": "https://api.github.com/users/AkioNak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AkioNak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AkioNak/subscriptions",
      "organizations_url": "https://api.github.com/users/AkioNak/orgs",
      "repos_url": "https://api.github.com/users/AkioNak/repos",
      "events_url": "https://api.github.com/users/AkioNak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AkioNak/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "94167e2b5b7b6cb3cb1465ee67dd50676c5c8a14",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/94167e2b5b7b6cb3cb1465ee67dd50676c5c8a14",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/94167e2b5b7b6cb3cb1465ee67dd50676c5c8a14"
      }
    ],
    "stats": {
      "total": 8,
      "additions": 7,
      "deletions": 1
    },
    "files": [
      {
        "sha": "23ca866e5305ddc5b1c4bdd962240f3e3a0494b5",
        "filename": "src/sync.cpp",
        "status": "modified",
        "additions": 7,
        "deletions": 1,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/b09dab0f2de37be3c96f5087ee7bd61d7262aa76/src/sync.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/b09dab0f2de37be3c96f5087ee7bd61d7262aa76/src/sync.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/sync.cpp?ref=b09dab0f2de37be3c96f5087ee7bd61d7262aa76",
        "patch": "@@ -73,7 +73,11 @@ struct LockData {\n     LockOrders lockorders;\n     InvLockOrders invlockorders;\n     std::mutex dd_mutex;\n-} static lockdata;\n+};\n+LockData& GetLockData() {\n+    static LockData lockdata;\n+    return lockdata;\n+}\n \n static thread_local LockStack g_lockstack;\n \n@@ -109,6 +113,7 @@ static void potential_deadlock_detected(const std::pair<void*, void*>& mismatch,\n \n static void push_lock(void* c, const CLockLocation& locklocation)\n {\n+    LockData& lockdata = GetLockData();\n     std::lock_guard<std::mutex> lock(lockdata.dd_mutex);\n \n     g_lockstack.push_back(std::make_pair(c, locklocation));\n@@ -173,6 +178,7 @@ void AssertLockNotHeldInternal(const char* pszName, const char* pszFile, int nLi\n \n void DeleteLock(void* cs)\n {\n+    LockData& lockdata = GetLockData();\n     if (!lockdata.available) {\n         // We're already shutting down.\n         return;"
      }
    ]
  }
]