DrahtBot,2020-09-29 12:58:31,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19502 (Bugfix: Wallet: Soft-fail exceptions within ListWalletDir file checks by luke-jr)\n* #19297 ([test] WIP: rewrite g",https://github.com/bitcoin/bitcoin/pull/20034#issuecomment-700685003,700685003,
MarcoFalke,2020-09-29 13:10:14,"Do all of the changes need to happen in one commit? Also, the build without wallet doesn't pass the tests",https://github.com/bitcoin/bitcoin/pull/20034#issuecomment-700691520,700691520,
ryanofsky,2020-09-29 14:30:07,"Thanks, I'll check the no wallet build. I don't think this is PR hard to review. It was very difficult to write, because every one change I made broke other things and required more changes. But in the end, the main change was just dropping -wallet="""" arguments and tweaking things to work around the dropped arguments.\n\nI would also expect if you're looking at one test and want to see how this ",https://github.com/bitcoin/bitcoin/pull/20034#issuecomment-700744365,700744365,
ryanofsky,2020-09-29 15:03:56,"Updated 9fbba7ca8712be85a72b8499c437c6259b171d03 -> c072c8585dde004db0aadbf4309fb97a952a6f29 ([`pr/defw.1`](https://github.com/ryanofsky/bitcoin/commits/pr/defw.1) -> [`pr/defw.2`](https://github.com/ryanofsky/bitcoin/commits/pr/defw.2), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/defw.1..pr/defw.2)) with suggestions from Marco (thanks!) splitting up commits and adding missing is_wal",https://github.com/bitcoin/bitcoin/pull/20034#issuecomment-700768006,700768006,
achow101,2020-09-29 16:16:14,I don't really like removing the `createwallet` override as it makes it more difficult to enable additional tests for descriptor wallets and lets us enable a test for descriptor wallets without having to modify every `createwallet` call in a test.,https://github.com/bitcoin/bitcoin/pull/20034#issuecomment-700814066,700814066,
ryanofsky,2020-09-29 17:08:01,"re: @achow101 https://github.com/bitcoin/bitcoin/pull/20034#issuecomment-700814066\n\n> I don't really like removing the `createwallet` override as it makes it more difficult to enable additional tests for descriptor wallets and lets us enable a test for descriptor wallets without having to modify every `createwallet` call in a test.\n\nThanks! Dropped commit be968c406944a74550799d28200255436c",https://github.com/bitcoin/bitcoin/pull/20034#issuecomment-700852887,700852887,
achow101,2020-09-29 19:12:47,ACK 5338dfaef077b5c38e3a87d76f12068147a5db2d,https://github.com/bitcoin/bitcoin/pull/20034#issuecomment-700925004,700925004,
MarcoFalke,2020-10-02 15:07:08,"ACK c1585bca8dae01dee6a1dd8eadae2f8b100503df, only effective change is adding documentation ðŸŽµ\n\n<details><summary>Show signature and timestamp</summary>\n\nSignature:\n\n```\n-----BEGIN PGP SIGNED MESSAGE-----\nHash: SHA512\n\nACK c1585bca8dae01dee6a1dd8eadae2f8b100503df, only effective change is adding documentation ðŸŽµ\n-----BEGIN PGP SIGNATURE-----\n\niQGzBAEBCgAdFiEE+rVPoUahrI9sLGY",https://github.com/bitcoin/bitcoin/pull/20034#issuecomment-702788342,702788342,
MarcoFalke,2020-10-02 15:36:52,"Tested with \n\n```diff\ndiff --git a/src/wallet/db.cpp b/src/wallet/db.cpp\nindex bd1d114730..89d7325e1c 100644\n--- a/src/wallet/db.cpp\n+++ b/src/wallet/db.cpp\n@@ -20,6 +20,6 @@ void SplitWalletPath(const fs::path& wallet_path, fs::path& env_directory, std::\n         // Normal case: Interpret wallet path as a directory path containing\n         // data and log files.\n         env_d",https://github.com/bitcoin/bitcoin/pull/20034#issuecomment-702804390,702804390,
ryanofsky,2020-09-29 11:55:15,"Note: This change isn't strictly necessary, but using `w8` instead of `wallet.dat` here makes the test more robust so `default_wallet_filename` can be changed in the future. The top level wallet directory will always contain a `w8` file, but may or may not contain a `wallet.dat` file, depending on the `default_wallet_filename` value.",https://github.com/bitcoin/bitcoin/pull/20034#discussion_r496656286,496656286,test/functional/wallet_multiwallet.py
achow101,2020-09-29 17:27:41,Should the `-wallet=wallet.dat` throughout this test use `self.wallet_data_filename` too then?,https://github.com/bitcoin/bitcoin/pull/20034#discussion_r496914396,496914396,test/functional/tool_wallet.py
achow101,2020-09-29 17:30:30,Why?,https://github.com/bitcoin/bitcoin/pull/20034#discussion_r496916277,496916277,test/functional/wallet_multiwallet.py
ryanofsky,2020-09-29 18:44:35,"re: https://github.com/bitcoin/bitcoin/pull/20034#discussion_r496914396\n\n> Should the `-wallet=wallet.dat` throughout this test use `self.wallet_data_filename` too then?\n\nIt effectively is. I think you are maybe only looking at the first commit, not the overall diff? The wallet.dat references are removed in the second commit, since more robust way to refer to wallets is by directory name n",https://github.com/bitcoin/bitcoin/pull/20034#discussion_r496960050,496960050,test/functional/tool_wallet.py
ryanofsky,2020-09-29 18:49:12,"re: https://github.com/bitcoin/bitcoin/pull/20034#discussion_r496916277\n\n> Why?\n\nSpecifying `-nowallet` keeps test behavior unchanged now that the load on startup option is used. Probably if you were writing this test from scratch, you would drop `-nowallet` and instead change the checks below. But this is the most minimal update for the existing test, it is also nice because it keeps the ",https://github.com/bitcoin/bitcoin/pull/20034#discussion_r496962672,496962672,test/functional/wallet_multiwallet.py
MarcoFalke,2020-10-01 09:18:05,"in the first commit:\n\nThe test passes without this change, so I am still wondering why this is needed.\n\nAlso, the commit doesn't seem to be exhaustive. The `wallet.dat/bad` should be replaced as well. Also, the usages in `tool_wallet.py`. See the diff I used for testing:\n\n```diff\ndiff --git a/src/wallet/db.cpp b/src/wallet/db.cpp\nindex bd1d114730..89d7325e1c 100644\n--- a/src/wall",https://github.com/bitcoin/bitcoin/pull/20034#discussion_r498101079,498101079,test/functional/wallet_multiwallet.py
MarcoFalke,2020-10-01 09:33:07,"in commit 5338dfaef077b5c38e3a87d76f12068147a5db2d:\n\nWould be good to add a short comment here to say:\n\n* Will be used to create wallets on setup\n* Defaults to create a default wallet for each node\n* List can be shorter than the number of nodes, or include None entries to skip wallet creation",https://github.com/bitcoin/bitcoin/pull/20034#discussion_r498110303,498110303,test/functional/test_framework/test_framework.py
MarcoFalke,2020-10-01 09:34:00,Could add an assert to check self.num_nodes >= len(wallet_names)?,https://github.com/bitcoin/bitcoin/pull/20034#discussion_r498110826,498110826,test/functional/test_framework/test_framework.py
ryanofsky,2020-10-01 10:09:55,"re: https://github.com/bitcoin/bitcoin/pull/20034#discussion_r498101079\n\n> in the first commit:\n> \n> The test passes without this change, so I am still wondering why this is needed.\n\nOh, good catch. That was supposed to be in the second commit not the first. `-nowallet` makes the list of wallets which are loaded explicit, and the tradeoffs around using it here are described in https://",https://github.com/bitcoin/bitcoin/pull/20034#discussion_r498132110,498132110,test/functional/wallet_multiwallet.py
ryanofsky,2020-10-01 10:12:07,"re: https://github.com/bitcoin/bitcoin/pull/20034#discussion_r498110303\n\n\n> in commit [5338dfa](https://github.com/bitcoin/bitcoin/commit/5338dfaef077b5c38e3a87d76f12068147a5db2d):\n> \n> Would be good to add a short comment here to say:\n\nThanks! Added",https://github.com/bitcoin/bitcoin/pull/20034#discussion_r498133352,498133352,test/functional/test_framework/test_framework.py
ryanofsky,2020-10-01 10:12:20,"re: https://github.com/bitcoin/bitcoin/pull/20034#discussion_r498110826\n\n> Could add an assert to check self.num_nodes >= len(wallet_names)?\n\nThanks! Added",https://github.com/bitcoin/bitcoin/pull/20034#discussion_r498133484,498133484,test/functional/test_framework/test_framework.py
