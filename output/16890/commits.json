[
  {
    "sha": "f53a81583ecd5cbc2c9edac7e5ecd9c2d578fa40",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmNTNhODE1ODNlY2Q1Y2JjMmM5ZWRhYzdlNWVjZDljMmQ1NzhmYTQw",
    "commit": {
      "author": {
        "name": "darosior",
        "email": "darosior@protonmail.com",
        "date": "2019-09-16T22:23:13Z"
      },
      "committer": {
        "name": "darosior",
        "email": "darosior@protonmail.com",
        "date": "2019-09-17T16:28:29Z"
      },
      "message": "RPC: restrict access to 'estimatesmartfee' in blocksonly mode",
      "tree": {
        "sha": "0ac11cc5ad76aca50ef014f3910119fbb94252b3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0ac11cc5ad76aca50ef014f3910119fbb94252b3"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f53a81583ecd5cbc2c9edac7e5ecd9c2d578fa40",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEEWQtykmla/6W2csuy4T/BRc0/QwQFAl2BCa0ACgkQ4T/BRc0/\nQwQuCQwAg6x5CF8Z8Qf5MGodGDb0fGrrAIrEuJG6J0pu2LlmsvMg6XmtwMwFlr3d\nwhpecd7DjqRz/qsVGtepJHq4MdeFHpfu0HBciabbk62mOfDvSInR4if5IwBtgPfu\nUcJe/L6Q+ZyiBVWMlieejjqXFwIKn7HarhAMsLycrLamGoR/QcykxiqoizQMY+LC\nHqHqWAbyLC2ZtHh7bjxT+QTV5PRF4M+YGPgieOjLzK10e02ugOPmkHY5Orv8Xg+v\naRsbEWd6XnDOd8CImsUQ7KgxEOiSXI+o/LUJFpYd1bzlvw0Rnq7SOavo4ha1uz3d\nxkrxoyzWgRL/tSFCkIpCgX33R8Qat4sXZXCY6wimP0CA7yimwOT9D8pU/neiaXz+\nStwrDL4SVYsX4MlKQcJjRDYQKww3mnUXtOlt3f/A9tj9xrq9z3npW705Eohjq9BJ\n451hIfHXZE5lHKW5jrDp8FMPTsN1vXgDzHyE+aPLLBD/XlQed6mZQULXr7zzAR6i\n+Lm212Ne\n=5nb0\n-----END PGP SIGNATURE-----",
        "payload": "tree 0ac11cc5ad76aca50ef014f3910119fbb94252b3\nparent 796b71363396e2ac99d241f5975c0978cdae3d67\nauthor darosior <darosior@protonmail.com> 1568672593 +0200\ncommitter darosior <darosior@protonmail.com> 1568737709 +0200\n\nRPC: restrict access to 'estimatesmartfee' in blocksonly mode\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f53a81583ecd5cbc2c9edac7e5ecd9c2d578fa40",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/f53a81583ecd5cbc2c9edac7e5ecd9c2d578fa40",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f53a81583ecd5cbc2c9edac7e5ecd9c2d578fa40/comments",
    "author": {
      "login": "darosior",
      "id": 22457751,
      "node_id": "MDQ6VXNlcjIyNDU3NzUx",
      "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/darosior",
      "html_url": "https://github.com/darosior",
      "followers_url": "https://api.github.com/users/darosior/followers",
      "following_url": "https://api.github.com/users/darosior/following{/other_user}",
      "gists_url": "https://api.github.com/users/darosior/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/darosior/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
      "organizations_url": "https://api.github.com/users/darosior/orgs",
      "repos_url": "https://api.github.com/users/darosior/repos",
      "events_url": "https://api.github.com/users/darosior/events{/privacy}",
      "received_events_url": "https://api.github.com/users/darosior/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "darosior",
      "id": 22457751,
      "node_id": "MDQ6VXNlcjIyNDU3NzUx",
      "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/darosior",
      "html_url": "https://github.com/darosior",
      "followers_url": "https://api.github.com/users/darosior/followers",
      "following_url": "https://api.github.com/users/darosior/following{/other_user}",
      "gists_url": "https://api.github.com/users/darosior/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/darosior/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
      "organizations_url": "https://api.github.com/users/darosior/orgs",
      "repos_url": "https://api.github.com/users/darosior/repos",
      "events_url": "https://api.github.com/users/darosior/events{/privacy}",
      "received_events_url": "https://api.github.com/users/darosior/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "796b71363396e2ac99d241f5975c0978cdae3d67",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/796b71363396e2ac99d241f5975c0978cdae3d67",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/796b71363396e2ac99d241f5975c0978cdae3d67"
      }
    ],
    "stats": {
      "total": 13,
      "additions": 12,
      "deletions": 1
    },
    "files": [
      {
        "sha": "02b0117b8f7f1e2bb6b2afb9f9ceb329abb5d484",
        "filename": "doc/release-notes-16890.md",
        "status": "added",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f53a81583ecd5cbc2c9edac7e5ecd9c2d578fa40/doc/release-notes-16890.md",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f53a81583ecd5cbc2c9edac7e5ecd9c2d578fa40/doc/release-notes-16890.md",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/doc/release-notes-16890.md?ref=f53a81583ecd5cbc2c9edac7e5ecd9c2d578fa40",
        "patch": "@@ -0,0 +1,3 @@\n+RPC changes\n+-----------\n+The `estimatesmartfee` command does not return an estimation anymore if don't relay transactions."
      },
      {
        "sha": "0796ba4578f3cebd012ef05f66dbc0db60d77e9b",
        "filename": "src/rpc/mining.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f53a81583ecd5cbc2c9edac7e5ecd9c2d578fa40/src/rpc/mining.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f53a81583ecd5cbc2c9edac7e5ecd9c2d578fa40/src/rpc/mining.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpc/mining.cpp?ref=f53a81583ecd5cbc2c9edac7e5ecd9c2d578fa40",
        "patch": "@@ -830,6 +830,9 @@ static UniValue estimatesmartfee(const JSONRPCRequest& request)\n         if (fee_mode == FeeEstimateMode::ECONOMICAL) conservative = false;\n     }\n \n+    if (!g_relay_txes)\n+        throw JSONRPCError(RPC_MISC_ERROR, \"Can not estimate fees if not relaying transactions.\");\n+\n     UniValue result(UniValue::VOBJ);\n     UniValue errors(UniValue::VARR);\n     FeeCalculation feeCalc;"
      },
      {
        "sha": "5969940ffdfccb8b1aa3ad9e3d290f117e26e916",
        "filename": "test/functional/p2p_blocksonly.py",
        "status": "modified",
        "additions": 6,
        "deletions": 1,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f53a81583ecd5cbc2c9edac7e5ecd9c2d578fa40/test/functional/p2p_blocksonly.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f53a81583ecd5cbc2c9edac7e5ecd9c2d578fa40/test/functional/p2p_blocksonly.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/p2p_blocksonly.py?ref=f53a81583ecd5cbc2c9edac7e5ecd9c2d578fa40",
        "patch": "@@ -7,7 +7,7 @@\n from test_framework.messages import msg_tx, CTransaction, FromHex\n from test_framework.mininode import P2PInterface\n from test_framework.test_framework import BitcoinTestFramework\n-from test_framework.util import assert_equal\n+from test_framework.util import assert_equal, assert_raises_rpc_error\n \n \n class P2PBlocksOnly(BitcoinTestFramework):\n@@ -57,6 +57,11 @@ def run_test(self):\n             self.nodes[0].p2p.wait_for_tx(txid)\n             assert_equal(self.nodes[0].getmempoolinfo()['size'], 1)\n \n+        # Test that we cant `estimatesmartfee` in blocksonly mode.\n+        assert_raises_rpc_error(-1, \"Can not estimate fees if not relaying \"\n+                                \"transactions.\",\n+                                self.nodes[0].estimatesmartfee, 6)\n+\n \n if __name__ == '__main__':\n     P2PBlocksOnly().main()"
      }
    ]
  }
]