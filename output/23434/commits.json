[
  {
    "sha": "cb8959af716a8f38b63698971e52bdda2c3e21e8",
    "node_id": "C_kwDOABII59oAKGNiODk1OWFmNzE2YThmMzhiNjM2OTg5NzFlNTJiZGRhMmMzZTIxZTg",
    "commit": {
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-11-03T19:17:45Z"
      },
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-11-03T19:37:41Z"
      },
      "message": "p2p: fix regression in AddrManImpl::AddSingle()\n\nHopefully fixes new addrman unit test failures that\nappear to have been introduced in commit 2095df7b\n\"Add Add_() inner function, fix Add() return semantics\"\nof PR #23380, which was merged in 994aaaa8.\n\nThat commit removed the bool fNew logic from AddSingle()\nand replaced it with returning fInsert. This patch brings back\nthe fNew logic and combines it with fInsert, so AddSingle()\nreturns whether or not fNew and fInsert are both true.",
      "tree": {
        "sha": "0c4b319458f921423032ad85a5c0361d7fc56ea4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0c4b319458f921423032ad85a5c0361d7fc56ea4"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/cb8959af716a8f38b63698971e52bdda2c3e21e8",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEd6u7+MhX7zEv6RP5T1chs9Djkh0FAmGC5TEACgkQT1chs9Dj\nkh1evQ/+L6xb/LyN0TRf30EycY2/0YY07Qn230wYG/rbyJGlN55TUMX8JC4gnHgO\nSjqubZozGbFT64OZH+nt3Vp6OG96NYh5TWethwZ9DNGn6SuoczSaTqV2N7eAJRcD\nn4W4uIR3PH2Clu2wFDZ7DjUSn31rRmtuGOy2EjDA7OvHwW94IpoXOXObIVU1c468\nN1gkcfJ3dOly/iFB0yqeoBl8W8MPJl3HYKvD2jnu2g9/Px+lD5tuPgDKU+ULiQ9c\nOFjTNWkHuHssV672Ky4Qwos1De4A0aSRU7tGlBXNPOS8k4ijswWNq6jOzCRpvZTZ\noP+gTCGk6vVL3UlPQLatqp6r1NND3XW55URi4UCU9f1QNsexONeONqq9eVqX66bL\ncYgc7BvjheZ4XOTivcyZ/IkeVKQC6TM7lsEkCzk7yQQGtsuybPG0YT3t0HQDIe6f\nFyK+gvuWcUbjYLwimNkt1nIOW7yY70UpZDhvgPWO8tlC0Zhs67JseYhg3ZkzHrYJ\noqxr3QsEzoKuRb2Tz/dmR5lrklOj8mzw9WUcUnjt+rwjTMlB3ggH9Kfl3Y+IIjXD\nlSZwh/WGMVDNBoR/LrgABKi4yLVaBq5HylpETb4WypBZyQUNlP9om6JSfWNcrhdU\n4yKORK++BMZntsI6I82UTdFx+2o8x1NVrdCD4hgrteK4p5bpbZw=\n=xVLq\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwIKXbsHTEizpuhZd80W7kbLCUGlJofsLJ8p1Knw9CoH32CP/wED+MkeXwtpNF\niNO54H7/HdEI8QRhguUz8AgYRKwUqXL6ywCD3+MNLvkMji4taHR0cHM6Ly9hbGlj\nZS5idGMuY2FsZW5kYXIub3BlbnRpbWVzdGFtcHMub3Jn//AQS4mpmlVWvT0PAw8z\nm4Q7FgjxBGGC5TPwCKCGqhg9c9KfAIPf4w0u+QyOLCtodHRwczovL2JvYi5idGMu\nY2FsZW5kYXIub3BlbnRpbWVzdGFtcHMub3Jn//AQsb3cPlkVp/NYcGorhrEzFwjx\nBGGC5TPwCGFCmPW1BRboAIPf4w0u+QyOKShodHRwczovL2Zpbm5leS5jYWxlbmRh\nci5ldGVybml0eXdhbGwuY29t8BDQLnBWIReD2ypxiailOj9TCPEEYYLlMvAIp8Hc\ngMGXDKMAg9/jDS75DI4jImh0dHBzOi8vYnRjLmNhbGVuZGFyLmNhdGFsbGF4eS5j\nb20=\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----",
        "payload": "tree 0c4b319458f921423032ad85a5c0361d7fc56ea4\nparent 23ae7931be50376fa6bda692c641a3d2538556ee\nauthor Jon Atack <jon@atack.com> 1635967065 +0100\ncommitter Jon Atack <jon@atack.com> 1635968261 +0100\n\np2p: fix regression in AddrManImpl::AddSingle()\n\nHopefully fixes new addrman unit test failures that\nappear to have been introduced in commit 2095df7b\n\"Add Add_() inner function, fix Add() return semantics\"\nof PR #23380, which was merged in 994aaaa8.\n\nThat commit removed the bool fNew logic from AddSingle()\nand replaced it with returning fInsert. This patch brings back\nthe fNew logic and combines it with fInsert, so AddSingle()\nreturns whether or not fNew and fInsert are both true.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/cb8959af716a8f38b63698971e52bdda2c3e21e8",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/cb8959af716a8f38b63698971e52bdda2c3e21e8",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/cb8959af716a8f38b63698971e52bdda2c3e21e8/comments",
    "author": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "23ae7931be50376fa6bda692c641a3d2538556ee",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/23ae7931be50376fa6bda692c641a3d2538556ee",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/23ae7931be50376fa6bda692c641a3d2538556ee"
      }
    ],
    "stats": {
      "total": 4,
      "additions": 3,
      "deletions": 1
    },
    "files": [
      {
        "sha": "10a1e15fc84b1b4bd7c3879217aa12ee1dfb769b",
        "filename": "src/addrman.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 1,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/cb8959af716a8f38b63698971e52bdda2c3e21e8/src/addrman.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/cb8959af716a8f38b63698971e52bdda2c3e21e8/src/addrman.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrman.cpp?ref=cb8959af716a8f38b63698971e52bdda2c3e21e8",
        "patch": "@@ -544,6 +544,7 @@ bool AddrManImpl::AddSingle(const CAddress& addr, const CNetAddr& source, int64_\n     if (!addr.IsRoutable())\n         return false;\n \n+    bool fNew{false};\n     int nId;\n     AddrInfo* pinfo = Find(addr, &nId);\n \n@@ -584,6 +585,7 @@ bool AddrManImpl::AddSingle(const CAddress& addr, const CNetAddr& source, int64_\n         pinfo = Create(addr, source, &nId);\n         pinfo->nTime = std::max((int64_t)0, (int64_t)pinfo->nTime - nTimePenalty);\n         nNew++;\n+        fNew = true;\n     }\n \n     int nUBucket = pinfo->GetNewBucket(nKey, source, m_asmap);\n@@ -609,7 +611,7 @@ bool AddrManImpl::AddSingle(const CAddress& addr, const CNetAddr& source, int64_\n             }\n         }\n     }\n-    return fInsert;\n+    return fNew && fInsert;\n }\n \n void AddrManImpl::Good_(const CService& addr, bool test_before_evict, int64_t nTime)"
      }
    ]
  }
]