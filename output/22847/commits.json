[
  {
    "sha": "96cc6bb04f7e173e1f7637b780ac00fc75486671",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5NmNjNmJiMDRmN2UxNzNlMWY3NjM3Yjc4MGFjMDBmYzc1NDg2Njcx",
    "commit": {
      "author": {
        "name": "Carl Dong",
        "email": "contact@carldong.me",
        "date": "2021-08-30T22:38:06Z"
      },
      "committer": {
        "name": "Carl Dong",
        "email": "contact@carldong.me",
        "date": "2021-08-31T14:57:04Z"
      },
      "message": "guix/prelude: Override VERSION with FORCE_VERSION\n\nPreviously, if the builder exported $VERSION in their environment (as\npast Gitian-building docs told them to), but their HEAD does not\nactually point to v$VERSION, their build outputs will differ from those\nof other builders.\n\nThis is because the contrib/guix/guix-* scripts only ever act on the\ncurrent git worktree, and does not try to check out $VERSION if $VERSION\nis set in the environment.\n\nSetting $VERSION only makes the scripts pretend like the current\nworktree is $VERSION.\n\nThis problem was seen in jonatack's attestation for all.SHA256SUMS,\nwhere only his bitcoin-22.0rc3-osx-signed.dmg differed from everyone\nelse's.\n\nHere is my deduced sequence of events:\n\n1. Aug 27th: He guix-builds 22.0rc3 and uploads his attestations up to\n   guix.sigs\n\n2. Aug 30th, sometime after POSIX time 1630310848: he pulls the latest\n   changes from master in the same worktree where he guix-built 22.0rc3\n   and ends up at 7be143a960e2\n\n3. Aug 30th, sometime before POSIX time 1630315907: With his worktree\n   still on 7be143a960e2, he guix-codesigns. Normally, this would result\n   in outputs going in guix-build-7be143a960e2, but he had\n   VERSION=22.0rc3 in his environment, so the guix-* scripts pretended\n   like he was building 22.0rc3, and used 22.0rc3's guix-build directory\n   to locate un-codesigned outputs and dump codesigned ones.\n\n   However, our SOURCE_DATE_EPOCH defaults to the POSIX time of HEAD\n   (7be143a960e2), which made all timestamps in the resulting codesigned\n   DMG 1630310848, 7be143a960e2's POSIX timestamp. This differs from the\n   POSIX timestamp of 22.0rc3, which is 1630348517. Note that the\n   windows codesigning procedure does not consider SOURCE_DATE_EPOCH.\n\nWe resolve this by only allowing VERSION overrides via the FORCE_VERSION\nenvironment variable.",
      "tree": {
        "sha": "2371408dc3d902e1ec6f8b1211f77ec3d8eb18b1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2371408dc3d902e1ec6f8b1211f77ec3d8eb18b1"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/96cc6bb04f7e173e1f7637b780ac00fc75486671",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/96cc6bb04f7e173e1f7637b780ac00fc75486671",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/96cc6bb04f7e173e1f7637b780ac00fc75486671",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/96cc6bb04f7e173e1f7637b780ac00fc75486671/comments",
    "author": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "7be143a960e2bb9ac81144f55c45731c1bb209c5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7be143a960e2bb9ac81144f55c45731c1bb209c5",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/7be143a960e2bb9ac81144f55c45731c1bb209c5"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 1,
      "deletions": 1
    },
    "files": [
      {
        "sha": "40ae4b52084ef2235f12318b7ce1b2090a52bf1b",
        "filename": "contrib/guix/libexec/prelude.bash",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/96cc6bb04f7e173e1f7637b780ac00fc75486671/contrib/guix/libexec/prelude.bash",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/96cc6bb04f7e173e1f7637b780ac00fc75486671/contrib/guix/libexec/prelude.bash",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/guix/libexec/prelude.bash?ref=96cc6bb04f7e173e1f7637b780ac00fc75486671",
        "patch": "@@ -49,7 +49,7 @@ fi\n # Set common variables\n ################\n \n-VERSION=\"${VERSION:-$(git_head_version)}\"\n+VERSION=\"${FORCE_VERSION:-$(git_head_version)}\"\n DISTNAME=\"${DISTNAME:-bitcoin-${VERSION}}\"\n \n version_base_prefix=\"${PWD}/guix-build-\""
      }
    ]
  }
]