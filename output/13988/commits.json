[
  {
    "sha": "48618daf262b84c2e2f7322b5ca14375d7d68b64",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0ODYxOGRhZjI2MmI4NGMyZTJmNzMyMmI1Y2ExNDM3NWQ3ZDY4YjY0",
    "commit": {
      "author": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2018-08-08T15:52:42Z"
      },
      "committer": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2018-08-16T02:47:31Z"
      },
      "message": "Add checks for settxfee reasonableness",
      "tree": {
        "sha": "81c9457376ab2c579e9f3d0b8d20d6d0b16abe0d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/81c9457376ab2c579e9f3d0b8d20d6d0b16abe0d"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/48618daf262b84c2e2f7322b5ca14375d7d68b64",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/48618daf262b84c2e2f7322b5ca14375d7d68b64",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/48618daf262b84c2e2f7322b5ca14375d7d68b64",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/48618daf262b84c2e2f7322b5ca14375d7d68b64/comments",
    "author": {
      "login": "ajtowns",
      "id": 127186,
      "node_id": "MDQ6VXNlcjEyNzE4Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajtowns",
      "html_url": "https://github.com/ajtowns",
      "followers_url": "https://api.github.com/users/ajtowns/followers",
      "following_url": "https://api.github.com/users/ajtowns/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajtowns/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
      "organizations_url": "https://api.github.com/users/ajtowns/orgs",
      "repos_url": "https://api.github.com/users/ajtowns/repos",
      "events_url": "https://api.github.com/users/ajtowns/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajtowns/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "ajtowns",
      "id": 127186,
      "node_id": "MDQ6VXNlcjEyNzE4Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajtowns",
      "html_url": "https://github.com/ajtowns",
      "followers_url": "https://api.github.com/users/ajtowns/followers",
      "following_url": "https://api.github.com/users/ajtowns/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajtowns/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
      "organizations_url": "https://api.github.com/users/ajtowns/orgs",
      "repos_url": "https://api.github.com/users/ajtowns/repos",
      "events_url": "https://api.github.com/users/ajtowns/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajtowns/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "b5591ca0b053623f0d96423b05ad809115a0bdef",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b5591ca0b053623f0d96423b05ad809115a0bdef",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/b5591ca0b053623f0d96423b05ad809115a0bdef"
      }
    ],
    "stats": {
      "total": 10,
      "additions": 9,
      "deletions": 1
    },
    "files": [
      {
        "sha": "46162556ebf2f8a1319f608a939e1e702759d5b3",
        "filename": "src/wallet/rpcwallet.cpp",
        "status": "modified",
        "additions": 9,
        "deletions": 1,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/48618daf262b84c2e2f7322b5ca14375d7d68b64/src/wallet/rpcwallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/48618daf262b84c2e2f7322b5ca14375d7d68b64/src/wallet/rpcwallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcwallet.cpp?ref=48618daf262b84c2e2f7322b5ca14375d7d68b64",
        "patch": "@@ -2982,8 +2982,16 @@ static UniValue settxfee(const JSONRPCRequest& request)\n     LOCK2(cs_main, pwallet->cs_wallet);\n \n     CAmount nAmount = AmountFromValue(request.params[0]);\n+    CFeeRate tx_fee_rate(nAmount, 1000);\n+    if (tx_fee_rate == 0) {\n+        // automatic selection\n+    } else if (tx_fee_rate < ::minRelayTxFee) {\n+        throw JSONRPCError(RPC_INVALID_PARAMETER, strprintf(\"txfee cannot be less than min relay tx fee (%s)\", ::minRelayTxFee.ToString()));\n+    } else if (tx_fee_rate < pwallet->m_min_fee) {\n+        throw JSONRPCError(RPC_INVALID_PARAMETER, strprintf(\"txfee cannot be less than wallet min fee (%s)\", pwallet->m_min_fee.ToString()));\n+    }\n \n-    pwallet->m_pay_tx_fee = CFeeRate(nAmount, 1000);\n+    pwallet->m_pay_tx_fee = tx_fee_rate;\n     return true;\n }\n "
      }
    ]
  },
  {
    "sha": "317f2cb3f4499afbaa63e3cac80567744f12c95b",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozMTdmMmNiM2Y0NDk5YWZiYWE2M2UzY2FjODA1Njc3NDRmMTJjOTVi",
    "commit": {
      "author": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2018-08-20T17:34:39Z"
      },
      "committer": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2018-08-21T00:52:40Z"
      },
      "message": "test: Check RPC settxfee errors",
      "tree": {
        "sha": "9d56902fe897e00ca11bd344a7d67c3db77efe42",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9d56902fe897e00ca11bd344a7d67c3db77efe42"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/317f2cb3f4499afbaa63e3cac80567744f12c95b",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/317f2cb3f4499afbaa63e3cac80567744f12c95b",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/317f2cb3f4499afbaa63e3cac80567744f12c95b",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/317f2cb3f4499afbaa63e3cac80567744f12c95b/comments",
    "author": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "ajtowns",
      "id": 127186,
      "node_id": "MDQ6VXNlcjEyNzE4Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajtowns",
      "html_url": "https://github.com/ajtowns",
      "followers_url": "https://api.github.com/users/ajtowns/followers",
      "following_url": "https://api.github.com/users/ajtowns/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajtowns/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
      "organizations_url": "https://api.github.com/users/ajtowns/orgs",
      "repos_url": "https://api.github.com/users/ajtowns/repos",
      "events_url": "https://api.github.com/users/ajtowns/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajtowns/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "48618daf262b84c2e2f7322b5ca14375d7d68b64",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/48618daf262b84c2e2f7322b5ca14375d7d68b64",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/48618daf262b84c2e2f7322b5ca14375d7d68b64"
      }
    ],
    "stats": {
      "total": 4,
      "additions": 3,
      "deletions": 1
    },
    "files": [
      {
        "sha": "a49590df19cd8d6b0fc8f0c2ed9afebd5fc1cd5b",
        "filename": "test/functional/wallet_bumpfee.py",
        "status": "modified",
        "additions": 3,
        "deletions": 1,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/317f2cb3f4499afbaa63e3cac80567744f12c95b/test/functional/wallet_bumpfee.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/317f2cb3f4499afbaa63e3cac80567744f12c95b/test/functional/wallet_bumpfee.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/wallet_bumpfee.py?ref=317f2cb3f4499afbaa63e3cac80567744f12c95b",
        "patch": "@@ -31,7 +31,7 @@ class BumpFeeTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.num_nodes = 2\n         self.setup_clean_chain = True\n-        self.extra_args = [[\"-deprecatedrpc=addwitnessaddress\", \"-walletrbf={}\".format(i)]\n+        self.extra_args = [[\"-deprecatedrpc=addwitnessaddress\", \"-walletrbf={}\".format(i), \"-mintxfee=0.00002\"]\n                            for i in range(self.num_nodes)]\n \n     def run_test(self):\n@@ -190,6 +190,8 @@ def test_dust_to_fee(rbf_node, dest_address):\n \n \n def test_settxfee(rbf_node, dest_address):\n+    assert_raises_rpc_error(-8, \"txfee cannot be less than min relay tx fee\", rbf_node.settxfee, Decimal('0.000005'))\n+    assert_raises_rpc_error(-8, \"txfee cannot be less than wallet min fee\", rbf_node.settxfee, Decimal('0.000015'))\n     # check that bumpfee reacts correctly to the use of settxfee (paytxfee)\n     rbfid = spend_one_input(rbf_node, dest_address)\n     requested_feerate = Decimal(\"0.00025000\")"
      }
    ]
  }
]