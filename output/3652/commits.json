[
  {
    "sha": "079503c6ac69c29fcc960511edfd4e3fd0b9daec",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzowNzk1MDNjNmFjNjljMjlmY2M5NjA1MTFlZGZkNGUzZmQwYjlkYWVj",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2014-02-11T19:58:29Z"
      },
      "committer": {
        "name": "Johnathan Corgan",
        "email": "johnathan@corganlabs.com",
        "date": "2014-08-18T13:37:21Z"
      },
      "message": "Squashed commit of the following, plus fixups\nto carry through the development to current master:\n\ncommit 4790f3c823a33fae44b82ef7962372e38b1b0131\nAuthor: Pieter Wuille <pieter.wuille@gmail.com>\nDate:   Fri Jan 11 23:34:08 2013 +0100\n\n    Add address-based index\n\n    1) Maintain a salt to perturbate the address index (protection against\n       collisions).\n    2) Add support for address index entries in the block index, and\n       maintain those if -addrindex is specified. It indexes the use of\n       every >8-byte data push in output script or consumed script - or in\n       case of no such push, the entire script.\n    3) Add a searchrawtransactions RPC call, which can look up raw\n       transactions by address.\n\ncommit fd867c7dbc1b5ad971dd308069257e7db5e11ac1\nAuthor: Pieter Wuille <pieter.wuille@gmail.com>\nDate:   Sat Jan 12 00:48:29 2013 +0100\n\n    Encapsulate CLevelDB iterators cleanly",
      "tree": {
        "sha": "f047327118e08b81fdef177cf30aecea1c0a1b80",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f047327118e08b81fdef177cf30aecea1c0a1b80"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/079503c6ac69c29fcc960511edfd4e3fd0b9daec",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/079503c6ac69c29fcc960511edfd4e3fd0b9daec",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/079503c6ac69c29fcc960511edfd4e3fd0b9daec",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/079503c6ac69c29fcc960511edfd4e3fd0b9daec/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jmcorgan",
      "id": 1492956,
      "node_id": "MDQ6VXNlcjE0OTI5NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1492956?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jmcorgan",
      "html_url": "https://github.com/jmcorgan",
      "followers_url": "https://api.github.com/users/jmcorgan/followers",
      "following_url": "https://api.github.com/users/jmcorgan/following{/other_user}",
      "gists_url": "https://api.github.com/users/jmcorgan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jmcorgan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jmcorgan/subscriptions",
      "organizations_url": "https://api.github.com/users/jmcorgan/orgs",
      "repos_url": "https://api.github.com/users/jmcorgan/repos",
      "events_url": "https://api.github.com/users/jmcorgan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jmcorgan/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "04d6c7d10cf66e134ed7e112127c060f78ea620a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/04d6c7d10cf66e134ed7e112127c060f78ea620a",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/04d6c7d10cf66e134ed7e112127c060f78ea620a"
      }
    ],
    "stats": {
      "total": 467,
      "additions": 389,
      "deletions": 78
    },
    "files": [
      {
        "sha": "0f233df10dcfe576a51c24c9ba38f2b6b8a04325",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 7,
        "deletions": 1,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/079503c6ac69c29fcc960511edfd4e3fd0b9daec/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/079503c6ac69c29fcc960511edfd4e3fd0b9daec/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=079503c6ac69c29fcc960511edfd4e3fd0b9daec",
        "patch": "@@ -915,7 +915,7 @@ bool AppInit2(boost::thread_group& threadGroup)\n     else if (nTotalCache > (nMaxDbCache << 20))\n         nTotalCache = (nMaxDbCache << 20); // total cache cannot be greater than nMaxDbCache\n     size_t nBlockTreeDBCache = nTotalCache / 8;\n-    if (nBlockTreeDBCache > (1 << 21) && !GetBoolArg(\"-txindex\", false))\n+    if (nBlockTreeDBCache > (1 << 21) && !GetBoolArg(\"-txindex\", false) && !GetBoolArg(\"-addrindex\", false))\n         nBlockTreeDBCache = (1 << 21); // block tree db cache shouldn't be larger than 2 MiB\n     nTotalCache -= nBlockTreeDBCache;\n     size_t nCoinDBCache = nTotalCache / 2; // use half of the remaining cache for coindb cache\n@@ -966,6 +966,12 @@ bool AppInit2(boost::thread_group& threadGroup)\n                     break;\n                 }\n \n+                // Check for changed -addrindex state\n+                if (fAddrIndex != GetBoolArg(\"-addrindex\", false)) {\n+                    strLoadError = _(\"You need to rebuild the database using -reindex to change -addrindex\");\n+                    break;\n+                }\n+\n                 uiInterface.InitMessage(_(\"Verifying blocks...\"));\n                 if (!CVerifyDB().VerifyDB(GetArg(\"-checklevel\", 3),\n                               GetArg(\"-checkblocks\", 288))) {"
      },
      {
        "sha": "d0ab8e95f43460c1157deaf63bc9884ff9d72c56",
        "filename": "src/leveldbwrapper.cpp",
        "status": "modified",
        "additions": 7,
        "deletions": 0,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/079503c6ac69c29fcc960511edfd4e3fd0b9daec/src/leveldbwrapper.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/079503c6ac69c29fcc960511edfd4e3fd0b9daec/src/leveldbwrapper.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/leveldbwrapper.cpp?ref=079503c6ac69c29fcc960511edfd4e3fd0b9daec",
        "patch": "@@ -40,6 +40,13 @@ static leveldb::Options GetOptions(size_t nCacheSize) {\n     return options;\n }\n \n+CLevelDBIterator::~CLevelDBIterator() { delete piter; }\n+bool CLevelDBIterator::Valid() { return piter->Valid(); }\n+void CLevelDBIterator::SeekToFirst() { piter->SeekToFirst(); }\n+void CLevelDBIterator::SeekToLast() { piter->SeekToLast(); }\n+void CLevelDBIterator::Next() { piter->Next(); }\n+void CLevelDBIterator::Prev() { piter->Prev(); }\n+\n CLevelDBWrapper::CLevelDBWrapper(const boost::filesystem::path &path, size_t nCacheSize, bool fMemory, bool fWipe) {\n     penv = NULL;\n     readoptions.verify_checksums = true;"
      },
      {
        "sha": "c655d82561e0c36912f39b900100c82aebe7caf9",
        "filename": "src/leveldbwrapper.h",
        "status": "modified",
        "additions": 59,
        "deletions": 3,
        "changes": 62,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/079503c6ac69c29fcc960511edfd4e3fd0b9daec/src/leveldbwrapper.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/079503c6ac69c29fcc960511edfd4e3fd0b9daec/src/leveldbwrapper.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/leveldbwrapper.h?ref=079503c6ac69c29fcc960511edfd4e3fd0b9daec",
        "patch": "@@ -54,6 +54,63 @@ class CLevelDBBatch\n     }\n };\n \n+class CLevelDBIterator\n+{\n+private:\n+    leveldb::Iterator *piter;\n+\n+public:\n+    CLevelDBIterator(leveldb::Iterator *piterIn) : piter(piterIn) {}\n+    ~CLevelDBIterator();\n+\n+    bool Valid();\n+\n+    void SeekToFirst();\n+    void SeekToLast();\n+\n+    template<typename K> void Seek(const K& key) {\n+        CDataStream ssKey(SER_DISK, CLIENT_VERSION);\n+        ssKey.reserve(ssKey.GetSerializeSize(key));\n+        ssKey << key;\n+        leveldb::Slice slKey(&ssKey[0], ssKey.size());\n+        piter->Seek(slKey);\n+    }\n+\n+    void Next();\n+    void Prev();\n+\n+    template<typename K> bool GetKey(K& key) {\n+        leveldb::Slice slKey = piter->key();\n+        try {\n+            CDataStream ssKey(slKey.data(), slKey.data() + slKey.size(), SER_DISK, CLIENT_VERSION);\n+            ssKey >> key;\n+        } catch(std::exception &e) {\n+            return false;\n+        }\n+        return true;\n+    }\n+\n+    unsigned int GetKeySize() {\n+        return piter->key().size();\n+    }\n+\n+    template<typename V> bool GetValue(V& value) {\n+        leveldb::Slice slValue = piter->value();\n+        try {\n+            CDataStream ssValue(slValue.data(), slValue.data() + slValue.size(), SER_DISK, CLIENT_VERSION);\n+            ssValue >> value;\n+        } catch(std::exception &e) {\n+            return false;\n+        }\n+        return true;\n+    }\n+\n+    unsigned int GetValueSize() {\n+        return piter->value().size();\n+    }\n+\n+};\n+\n class CLevelDBWrapper\n {\n private:\n@@ -146,9 +203,8 @@ class CLevelDBWrapper\n         return WriteBatch(batch, true);\n     }\n \n-    // not exactly clean encapsulation, but it's easiest for now\n-    leveldb::Iterator *NewIterator() {\n-        return pdb->NewIterator(iteroptions);\n+    CLevelDBIterator *NewIterator() {\n+        return new CLevelDBIterator(pdb->NewIterator(iteroptions));\n     }\n };\n "
      },
      {
        "sha": "5e193a1c25ceb0f74896f607b3bd882f1aad97d4",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 99,
        "deletions": 8,
        "changes": 107,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/079503c6ac69c29fcc960511edfd4e3fd0b9daec/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/079503c6ac69c29fcc960511edfd4e3fd0b9daec/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=079503c6ac69c29fcc960511edfd4e3fd0b9daec",
        "patch": "@@ -46,6 +46,7 @@ int nScriptCheckThreads = 0;\n bool fImporting = false;\n bool fReindex = false;\n bool fTxIndex = false;\n+bool fAddrIndex = false;\n bool fIsBareMultisigStd = true;\n unsigned int nCoinCacheSize = 5000;\n \n@@ -1079,6 +1080,42 @@ bool CMerkleTx::AcceptToMemoryPool(bool fLimitFree, bool fRejectInsaneFee)\n }\n \n \n+bool ReadTransaction(CTransaction& tx, const CDiskTxPos &pos, uint256 &hashBlock) {\n+    CAutoFile file(OpenBlockFile(pos, true), SER_DISK, CLIENT_VERSION);\n+    CBlockHeader header;\n+    try {\n+        file >> header;\n+        fseek(file, pos.nTxOffset, SEEK_CUR);\n+        file >> tx;\n+    } catch (std::exception &e) {\n+        return error(\"%s() : deserialize or I/O error\", __PRETTY_FUNCTION__);\n+    }\n+    hashBlock = header.GetHash();\n+    return true;\n+}\n+\n+bool FindTransactionsByDestination(const CTxDestination &dest, std::set<CExtDiskTxPos> &setpos) {\n+    uint160 addrid = 0;\n+    const CKeyID *pkeyid = boost::get<CKeyID>(&dest);\n+    if (pkeyid)\n+        addrid = static_cast<uint160>(*pkeyid);\n+    if (!addrid) {\n+        const CScriptID *pscriptid = boost::get<CScriptID>(&dest);\n+        if (pscriptid)\n+            addrid = static_cast<uint160>(*pscriptid);\n+    }\n+    if (!addrid)\n+        return false;\n+\n+    LOCK(cs_main);\n+    if (!fAddrIndex)\n+        return false;\n+    std::vector<CExtDiskTxPos> vPos;\n+    if (!pblocktree->ReadAddrIndex(addrid, vPos))\n+        return false;\n+    setpos.insert(vPos.begin(), vPos.end());\n+    return true;\n+}\n // Return transaction in tx, and if it was found inside a block, its hash is placed in hashBlock\n bool GetTransaction(const uint256 &hash, CTransaction &txOut, uint256 &hashBlock, bool fAllowSlow)\n {\n@@ -1095,6 +1132,9 @@ bool GetTransaction(const uint256 &hash, CTransaction &txOut, uint256 &hashBlock\n         if (fTxIndex) {\n             CDiskTxPos postx;\n             if (pblocktree->ReadTxIndex(hash, postx)) {\n+                if (!ReadTransaction(txOut, postx, hashBlock))\n+                    return false;\n+\n                 CAutoFile file(OpenBlockFile(postx, true), SER_DISK, CLIENT_VERSION);\n                 CBlockHeader header;\n                 try {\n@@ -1105,6 +1145,7 @@ bool GetTransaction(const uint256 &hash, CTransaction &txOut, uint256 &hashBlock\n                     return error(\"%s : Deserialize or I/O error - %s\", __func__, e.what());\n                 }\n                 hashBlock = header.GetHash();\n+\n                 if (txOut.GetHash() != hash)\n                     return error(\"%s : txid mismatch\", __func__);\n                 return true;\n@@ -1696,6 +1737,32 @@ static int64_t nTimeIndex = 0;\n static int64_t nTimeCallbacks = 0;\n static int64_t nTimeTotal = 0;\n \n+// Index either: a) every data push >=8 bytes,  b) if no such pushes, the entire script\n+void static BuildAddrIndex(const CScript &script, const CExtDiskTxPos &pos, std::vector<std::pair<uint160, CExtDiskTxPos> > &out) {\n+    CScript::const_iterator pc = script.begin();\n+    CScript::const_iterator pend = script.end();\n+    std::vector<unsigned char> data;\n+    opcodetype opcode;\n+    bool fHaveData = false;\n+    while (pc < pend) {\n+        script.GetOp(pc, opcode, data);\n+        if (0 <= opcode && opcode <= OP_PUSHDATA4 && data.size() >= 8) { // data element\n+            uint160 addrid = 0;\n+            if (data.size() <= 20) {\n+                memcpy(&addrid, &data[0], data.size());\n+            } else {\n+                addrid = Hash160(data);\n+            }\n+            out.push_back(std::make_pair(addrid, pos));\n+            fHaveData = true;\n+        }\n+    }\n+    if (!fHaveData) {\n+        uint160 addrid = Hash160(script);\n+        out.push_back(std::make_pair(addrid, pos));\n+    }\n+}\n+\n bool ConnectBlock(CBlock& block, CValidationState& state, CBlockIndex* pindex, CCoinsViewCache& view, bool fJustCheck)\n {\n     AssertLockHeld(cs_main);\n@@ -1755,10 +1822,14 @@ bool ConnectBlock(CBlock& block, CValidationState& state, CBlockIndex* pindex, C\n     int64_t nFees = 0;\n     int nInputs = 0;\n     unsigned int nSigOps = 0;\n-    CDiskTxPos pos(pindex->GetBlockPos(), GetSizeOfCompactSize(block.vtx.size()));\n-    std::vector<std::pair<uint256, CDiskTxPos> > vPos;\n-    vPos.reserve(block.vtx.size());\n-    for (unsigned int i = 0; i < block.vtx.size(); i++)\n+    CExtDiskTxPos pos(CDiskTxPos(pindex->GetBlockPos(), GetSizeOfCompactSize(block.vtx.size())), pindex->nHeight);\n+    std::vector<std::pair<uint256, CDiskTxPos> > vPosTxid;\n+    std::vector<std::pair<uint160, CExtDiskTxPos> > vPosAddrid;\n+    if (fTxIndex)\n+        vPosTxid.reserve(block.vtx.size());\n+    if (fAddrIndex)\n+        vPosAddrid.reserve(4*block.vtx.size());\n+    for (unsigned int i=0; i<block.vtx.size(); i++)\n     {\n         const CTransaction &tx = block.vtx[i];\n \n@@ -1793,12 +1864,24 @@ bool ConnectBlock(CBlock& block, CValidationState& state, CBlockIndex* pindex, C\n             control.Add(vChecks);\n         }\n \n+        if (fTxIndex)\n+          vPosTxid.push_back(std::make_pair(tx.GetHash(), pos));\n+        if (fAddrIndex) {\n+            if (!tx.IsCoinBase()) {\n+                BOOST_FOREACH(const CTxIn &txin, tx.vin) {\n+                    const CCoins &coins = view.GetCoins(txin.prevout.hash);\n+                    BuildAddrIndex(coins.vout[txin.prevout.n].scriptPubKey, pos, vPosAddrid);\n+                }\n+            }\n+            BOOST_FOREACH(const CTxOut &txout, tx.vout)\n+                BuildAddrIndex(txout.scriptPubKey, pos, vPosAddrid);\n+        }\n+\n         CTxUndo txundo;\n         UpdateCoins(tx, state, view, txundo, pindex->nHeight);\n         if (!tx.IsCoinBase())\n             blockundo.vtxundo.push_back(txundo);\n \n-        vPos.push_back(std::make_pair(tx.GetHash(), pos));\n         pos.nTxOffset += ::GetSerializeSize(tx, SER_DISK, CLIENT_VERSION);\n     }\n     int64_t nTime1 = GetTimeMicros(); nTimeConnect += nTime1 - nTimeStart;\n@@ -1846,8 +1929,11 @@ bool ConnectBlock(CBlock& block, CValidationState& state, CBlockIndex* pindex, C\n     }\n \n     if (fTxIndex)\n-        if (!pblocktree->WriteTxIndex(vPos))\n+        if (!pblocktree->WriteTxIndex(vPosTxid))\n             return state.Abort(_(\"Failed to write transaction index\"));\n+    if (fAddrIndex)\n+        if (!pblocktree->AddAddrIndex(vPosAddrid))\n+            return state.Abort(_(\"Failed to write address index\"));\n \n     // add this block to the view's block chain\n     bool ret;\n@@ -2472,7 +2558,7 @@ bool AcceptBlockHeader(CBlockHeader& block, CValidationState& state, CBlockIndex\n             return state.DoS(100, error(\"AcceptBlock() : forked chain older than last checkpoint (height %d)\", nHeight));\n \n         // Reject block.nVersion=1 blocks when 95% (75% on testnet) of the network has upgraded:\n-        if (block.nVersion < 2 && \n+        if (block.nVersion < 2 &&\n             CBlockIndex::IsSuperMajority(2, pindexPrev, Params().RejectBlockOutdatedMajority()))\n         {\n             return state.Invalid(error(\"AcceptBlock() : rejected nVersion=1 block\"),\n@@ -2517,7 +2603,7 @@ bool AcceptBlock(CBlock& block, CValidationState& state, CBlockIndex** ppindex,\n \n     // Enforce block.nVersion=2 rule that the coinbase starts with serialized block height\n     // if 750 of the last 1,000 blocks are version 2 or greater (51/100 if testnet):\n-    if (block.nVersion >= 2 && \n+    if (block.nVersion >= 2 &&\n         CBlockIndex::IsSuperMajority(2, pindex->pprev, Params().EnforceBlockUpgradeMajority()))\n     {\n         CScript expect = CScript() << nHeight;\n@@ -2997,6 +3083,9 @@ bool static LoadBlockIndexDB()\n     pblocktree->ReadFlag(\"txindex\", fTxIndex);\n     LogPrintf(\"LoadBlockIndexDB(): transaction index %s\\n\", fTxIndex ? \"enabled\" : \"disabled\");\n \n+    pblocktree->ReadFlag(\"addrindex\", fAddrIndex);\n+    LogPrintf(\"LoadBlockIndexDB(): address index %s\\n\", fAddrIndex ? \"enabled\" : \"disabled\");\n+\n     // Load pointer to end of best chain\n     std::map<uint256, CBlockIndex*>::iterator it = mapBlockIndex.find(pcoinsTip->GetBestBlock());\n     if (it == mapBlockIndex.end())\n@@ -3122,6 +3211,8 @@ bool InitBlockIndex() {\n     // Use the provided setting for -txindex in the new database\n     fTxIndex = GetBoolArg(\"-txindex\", false);\n     pblocktree->WriteFlag(\"txindex\", fTxIndex);\n+    fAddrIndex = GetBoolArg(\"-addrindex\", false);\n+    pblocktree->WriteFlag(\"addrindex\", fAddrIndex);\n     LogPrintf(\"Initializing databases...\\n\");\n \n     // Only add the genesis block if not reindexing (in which case we reuse the one already on disk)"
      },
      {
        "sha": "500816e2ebe5682df6ea3a0fd1992bdaa0a11783",
        "filename": "src/main.h",
        "status": "modified",
        "additions": 60,
        "deletions": 1,
        "changes": 61,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/079503c6ac69c29fcc960511edfd4e3fd0b9daec/src/main.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/079503c6ac69c29fcc960511edfd4e3fd0b9daec/src/main.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.h?ref=079503c6ac69c29fcc960511edfd4e3fd0b9daec",
        "patch": "@@ -95,6 +95,7 @@ extern bool fImporting;\n extern bool fReindex;\n extern int nScriptCheckThreads;\n extern bool fTxIndex;\n+extern bool fAddrIndex;\n extern bool fIsBareMultisigStd;\n extern unsigned int nCoinCacheSize;\n extern CFeeRate minRelayTxFee;\n@@ -244,8 +245,64 @@ struct CDiskTxPos : public CDiskBlockPos\n         CDiskBlockPos::SetNull();\n         nTxOffset = 0;\n     }\n+\n+    friend bool operator==(const CDiskTxPos &a, const CDiskTxPos &b) {\n+        return (a.nFile == b.nFile && a.nPos == b.nPos && a.nTxOffset == b.nTxOffset);\n+    }\n+\n+    friend bool operator!=(const CDiskTxPos &a, const CDiskTxPos &b) {\n+        return !(a == b);\n+    }\n+\n+    friend bool operator<(const CDiskTxPos &a, const CDiskTxPos &b) {\n+        return  (a.nFile < b.nFile || (\n+                (a.nFile == b.nFile) && (a.nPos < b.nPos || (\n+                                        (a.nPos == b.nPos) && (a.nTxOffset < b.nTxOffset)))));\n+    }\n };\n \n+struct CExtDiskTxPos : public CDiskTxPos\n+{\n+    unsigned int nHeight;\n+\n+    IMPLEMENT_SERIALIZE(\n+        READWRITE(*(CDiskTxPos*)this);\n+        READWRITE(VARINT(nHeight));\n+    )\n+\n+    CExtDiskTxPos(const CDiskTxPos &pos, int nHeightIn) : CDiskTxPos(pos), nHeight(nHeightIn) {\n+    }\n+\n+    CExtDiskTxPos() {\n+        SetNull();\n+    }\n+\n+    void SetNull() {\n+        CDiskTxPos::SetNull();\n+        nHeight = 0;\n+    }\n+\n+    friend bool operator==(const CExtDiskTxPos &a, const CExtDiskTxPos &b) {\n+        return (a.nHeight == b.nHeight && a.nFile == b.nFile && a.nPos == b.nPos && a.nTxOffset == b.nTxOffset);\n+    }\n+\n+    friend bool operator!=(const CExtDiskTxPos &a, const CExtDiskTxPos &b) {\n+        return !(a == b);\n+    }\n+\n+    friend bool operator<(const CExtDiskTxPos &a, const CExtDiskTxPos &b) {\n+        if (a.nHeight < b.nHeight) return true;\n+        if (a.nHeight > b.nHeight) return false;\n+        return ((const CDiskTxPos)a < (const CDiskTxPos)b);\n+    }\n+};\n+\n+\n+enum GetMinFee_mode\n+{\n+    GMF_RELAY,\n+    GMF_SEND,\n+};\n \n int64_t GetMinRelayFee(const CTransaction& tx, unsigned int nBytes, bool fAllowFree);\n \n@@ -561,8 +618,10 @@ class CPartialMerkleTree\n \n /** Functions for disk access for blocks */\n bool WriteBlockToDisk(CBlock& block, CDiskBlockPos& pos);\n+bool ReadTransaction(CTransaction& tx, const CDiskTxPos &pos, uint256 &hashBlock);\n bool ReadBlockFromDisk(CBlock& block, const CDiskBlockPos& pos);\n bool ReadBlockFromDisk(CBlock& block, const CBlockIndex* pindex);\n+bool FindTransactionsByDestination(const CTxDestination &dest, std::set<CExtDiskTxPos> &setpos);\n \n \n /** Functions for validating blocks and updating the block tree */\n@@ -825,7 +884,7 @@ class CBlockIndex\n \n     /**\n      * Returns true if there are nRequired or more blocks of minVersion or above\n-     * in the last Params().ToCheckBlockUpgradeMajority() blocks, starting at pstart \n+     * in the last Params().ToCheckBlockUpgradeMajority() blocks, starting at pstart\n      * and going backwards.\n      */\n     static bool IsSuperMajority(int minVersion, const CBlockIndex* pstart,"
      },
      {
        "sha": "d491bbe609a7b731dbbb8597eaf143ceeefc70c1",
        "filename": "src/rpcclient.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/079503c6ac69c29fcc960511edfd4e3fd0b9daec/src/rpcclient.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/079503c6ac69c29fcc960511edfd4e3fd0b9daec/src/rpcclient.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpcclient.cpp?ref=079503c6ac69c29fcc960511edfd4e3fd0b9daec",
        "patch": "@@ -72,6 +72,7 @@ static const CRPCConvertParam vRPCConvertParams[] =\n     { \"createrawtransaction\", 1 },\n     { \"signrawtransaction\", 1 },\n     { \"signrawtransaction\", 2 },\n+    { \"searchrawtransaction\", 2 },\n     { \"sendrawtransaction\", 1 },\n     { \"gettxout\", 1 },\n     { \"gettxout\", 2 },"
      },
      {
        "sha": "afdc0f95dbf4a18310f04e5e64fad4f27836f667",
        "filename": "src/rpcrawtransaction.cpp",
        "status": "modified",
        "additions": 60,
        "deletions": 0,
        "changes": 60,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/079503c6ac69c29fcc960511edfd4e3fd0b9daec/src/rpcrawtransaction.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/079503c6ac69c29fcc960511edfd4e3fd0b9daec/src/rpcrawtransaction.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpcrawtransaction.cpp?ref=079503c6ac69c29fcc960511edfd4e3fd0b9daec",
        "patch": "@@ -102,6 +102,66 @@ void TxToJSON(const CTransaction& tx, const uint256 hashBlock, Object& entry)\n     }\n }\n \n+Value searchrawtransactions(const Array &params, bool fHelp)\n+{\n+    if (fHelp || params.size() < 1 || params.size() > 4)\n+        throw runtime_error(\n+            \"searchrawtransactions <address> [verbose=1] [skip=0] [count=100]\\n\");\n+\n+    if (!fAddrIndex)\n+        throw JSONRPCError(RPC_MISC_ERROR, \"Address index not enabled\");\n+\n+    CBitcoinAddress address(params[0].get_str());\n+    if (!address.IsValid())\n+        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Invalid Bitcoin address\");\n+    CTxDestination dest = address.Get();\n+\n+    std::set<CExtDiskTxPos> setpos;\n+    if (!FindTransactionsByDestination(dest, setpos))\n+        throw JSONRPCError(RPC_DATABASE_ERROR, \"Cannot search for address\");\n+\n+    int nSkip = 0;\n+    int nCount = 100;\n+    bool fVerbose = true;\n+    if (params.size() > 1)\n+        fVerbose = (params[1].get_int() != 0);\n+    if (params.size() > 2)\n+        nSkip = params[2].get_int();\n+    if (params.size() > 3)\n+        nCount = params[3].get_int();\n+\n+    if (nSkip < 0)\n+        nSkip += setpos.size();\n+    if (nSkip < 0)\n+        nSkip = 0;\n+    if (nCount < 0)\n+        nCount = 0;\n+\n+    std::set<CExtDiskTxPos>::const_iterator it = setpos.begin();\n+    while (it != setpos.end() && nSkip--) it++;\n+\n+    Array result;\n+    while (it != setpos.end() && nCount--) {\n+        CTransaction tx;\n+        uint256 hashBlock;\n+        if (!ReadTransaction(tx, *it, hashBlock))\n+            throw JSONRPCError(RPC_DESERIALIZATION_ERROR, \"Cannot read transaction from disk\");\n+        CDataStream ssTx(SER_NETWORK, PROTOCOL_VERSION);\n+        ssTx << tx;\n+        string strHex = HexStr(ssTx.begin(), ssTx.end());\n+        if (fVerbose) {\n+            Object object;\n+            TxToJSON(tx, hashBlock, object);\n+            object.push_back(Pair(\"hex\", strHex));\n+            result.push_back(object);\n+        } else {\n+            result.push_back(strHex);\n+        }\n+        it++;\n+    }\n+    return result;\n+}\n+\n Value getrawtransaction(const Array& params, bool fHelp)\n {\n     if (fHelp || params.size() < 1 || params.size() > 2)"
      },
      {
        "sha": "f8496bf9fd8e892b35ef3e83048e8362d81e3753",
        "filename": "src/rpcserver.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/079503c6ac69c29fcc960511edfd4e3fd0b9daec/src/rpcserver.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/079503c6ac69c29fcc960511edfd4e3fd0b9daec/src/rpcserver.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpcserver.cpp?ref=079503c6ac69c29fcc960511edfd4e3fd0b9daec",
        "patch": "@@ -281,6 +281,7 @@ static const CRPCCommand vRPCCommands[] =\n     { \"rawtransactions\",    \"decoderawtransaction\",   &decoderawtransaction,   true,      false,      false },\n     { \"rawtransactions\",    \"decodescript\",           &decodescript,           true,      false,      false },\n     { \"rawtransactions\",    \"getrawtransaction\",      &getrawtransaction,      true,      false,      false },\n+    { \"rawtransactions\",    \"searchrawtransactions\",  &searchrawtransactions,  true,      false,      false },\n     { \"rawtransactions\",    \"sendrawtransaction\",     &sendrawtransaction,     false,     false,      false },\n     { \"rawtransactions\",    \"signrawtransaction\",     &signrawtransaction,     false,     false,      false }, /* uses wallet if enabled */\n "
      },
      {
        "sha": "4bc18d3f20b8791a0a0b18002d23c0a617ec0db8",
        "filename": "src/rpcserver.h",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/079503c6ac69c29fcc960511edfd4e3fd0b9daec/src/rpcserver.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/079503c6ac69c29fcc960511edfd4e3fd0b9daec/src/rpcserver.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpcserver.h?ref=079503c6ac69c29fcc960511edfd4e3fd0b9daec",
        "patch": "@@ -187,6 +187,7 @@ extern json_spirit::Value getblockchaininfo(const json_spirit::Array& params, bo\n extern json_spirit::Value getnetworkinfo(const json_spirit::Array& params, bool fHelp);\n \n extern json_spirit::Value getrawtransaction(const json_spirit::Array& params, bool fHelp); // in rcprawtransaction.cpp\n+extern json_spirit::Value searchrawtransactions(const json_spirit::Array& params, bool fHelp);\n extern json_spirit::Value listunspent(const json_spirit::Array& params, bool fHelp);\n extern json_spirit::Value lockunspent(const json_spirit::Array& params, bool fHelp);\n extern json_spirit::Value listlockunspent(const json_spirit::Array& params, bool fHelp);"
      },
      {
        "sha": "02908434d8e92bd7fb2223ec251a00175461aade",
        "filename": "src/txdb.cpp",
        "status": "modified",
        "additions": 91,
        "deletions": 65,
        "changes": 156,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/079503c6ac69c29fcc960511edfd4e3fd0b9daec/src/txdb.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/079503c6ac69c29fcc960511edfd4e3fd0b9daec/src/txdb.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/txdb.cpp?ref=079503c6ac69c29fcc960511edfd4e3fd0b9daec",
        "patch": "@@ -67,6 +67,10 @@ bool CCoinsViewDB::BatchWrite(const CCoinsMap &mapCoins, const uint256 &hashBloc\n }\n \n CBlockTreeDB::CBlockTreeDB(size_t nCacheSize, bool fMemory, bool fWipe) : CLevelDBWrapper(GetDataDir() / \"blocks\" / \"index\", nCacheSize, fMemory, fWipe) {\n+    if (!Read('S', salt)) {\n+        salt = GetRandHash();\n+        Write('S', salt);\n+    }\n }\n \n bool CBlockTreeDB::WriteBlockIndex(const CDiskBlockIndex& blockindex)\n@@ -103,46 +107,38 @@ bool CBlockTreeDB::ReadLastBlockFile(int &nFile) {\n }\n \n bool CCoinsViewDB::GetStats(CCoinsStats &stats) {\n-    boost::scoped_ptr<leveldb::Iterator> pcursor(db.NewIterator());\n-    pcursor->SeekToFirst();\n+    CLevelDBIterator *pcursor = db.NewIterator();\n+    pcursor->Seek('c');\n \n     CHashWriter ss(SER_GETHASH, PROTOCOL_VERSION);\n     stats.hashBlock = GetBestBlock();\n     ss << stats.hashBlock;\n     int64_t nTotalAmount = 0;\n     while (pcursor->Valid()) {\n         boost::this_thread::interruption_point();\n+        std::pair<char, uint256> key;\n+        CCoins coins;\n+\n         try {\n-            leveldb::Slice slKey = pcursor->key();\n-            CDataStream ssKey(slKey.data(), slKey.data()+slKey.size(), SER_DISK, CLIENT_VERSION);\n-            char chType;\n-            ssKey >> chType;\n-            if (chType == 'c') {\n-                leveldb::Slice slValue = pcursor->value();\n-                CDataStream ssValue(slValue.data(), slValue.data()+slValue.size(), SER_DISK, CLIENT_VERSION);\n-                CCoins coins;\n-                ssValue >> coins;\n-                uint256 txhash;\n-                ssKey >> txhash;\n-                ss << txhash;\n-                ss << VARINT(coins.nVersion);\n-                ss << (coins.fCoinBase ? 'c' : 'n');\n-                ss << VARINT(coins.nHeight);\n-                stats.nTransactions++;\n-                for (unsigned int i=0; i<coins.vout.size(); i++) {\n-                    const CTxOut &out = coins.vout[i];\n-                    if (!out.IsNull()) {\n-                        stats.nTransactionOutputs++;\n-                        ss << VARINT(i+1);\n-                        ss << out;\n-                        nTotalAmount += out.nValue;\n+            if (pcursor->GetKey(key) && key.first == 'c') {\n+                if (pcursor->GetValue(coins)) {\n+                    stats.nTransactions++;\n+                    for (unsigned int i=0; i<coins.vout.size(); i++) {\n+                        const CTxOut &out = coins.vout[i];\n+                        if (!out.IsNull()) {\n+                            stats.nTransactionOutputs++;\n+                            ss << VARINT(i+1);\n+                            ss << out;\n+                            nTotalAmount += out.nValue;\n+                        }\n                     }\n+                    stats.nSerializedSize += 32 + pcursor->GetKeySize();\n+                    ss << VARINT(0);\n                 }\n-                stats.nSerializedSize += 32 + slValue.size();\n-                ss << VARINT(0);\n             }\n             pcursor->Next();\n-        } catch (std::exception &e) {\n+        }\n+        catch (std::exception &e) {\n             return error(\"%s : Deserialize or I/O error - %s\", __func__, e.what());\n         }\n     }\n@@ -163,6 +159,40 @@ bool CBlockTreeDB::WriteTxIndex(const std::vector<std::pair<uint256, CDiskTxPos>\n     return WriteBatch(batch);\n }\n \n+bool CBlockTreeDB::ReadAddrIndex(uint160 addrid, std::vector<CExtDiskTxPos> &list) {\n+    CLevelDBIterator *iter = NewIterator();\n+    uint64_t lookupid;\n+    {\n+        CHashWriter ss(SER_GETHASH, 0);\n+        ss << salt;\n+        ss << addrid;\n+        lookupid = ss.GetHash().GetLow64();\n+    }\n+    iter->Seek(make_pair('a', lookupid));\n+    while (iter->Valid()) {\n+        std::pair<std::pair<char, uint64_t>, CExtDiskTxPos> key;\n+        if (iter->GetKey(key) && key.first.first == 'a' && key.first.second == lookupid) {\n+            list.push_back(key.second);\n+        } else {\n+            break;\n+        }\n+        iter->Next();\n+    }\n+    return true;\n+}\n+\n+bool CBlockTreeDB::AddAddrIndex(const std::vector<std::pair<uint160, CExtDiskTxPos> > &list) {\n+    unsigned char foo[0];\n+    CLevelDBBatch batch;\n+    for (std::vector<std::pair<uint160, CExtDiskTxPos> >::const_iterator it=list.begin(); it!=list.end(); it++) {\n+        CHashWriter ss(SER_GETHASH, 0);\n+        ss << salt;\n+        ss << it->first;\n+        batch.Write(make_pair(make_pair('a', ss.GetHash().GetLow64()), it->second), FLATDATA(foo));\n+    }\n+    return WriteBatch(batch);\n+}\n+\n bool CBlockTreeDB::WriteFlag(const std::string &name, bool fValue) {\n     return Write(std::make_pair('F', name), fValue ? '1' : '0');\n }\n@@ -177,50 +207,46 @@ bool CBlockTreeDB::ReadFlag(const std::string &name, bool &fValue) {\n \n bool CBlockTreeDB::LoadBlockIndexGuts()\n {\n-    boost::scoped_ptr<leveldb::Iterator> pcursor(NewIterator());\n+    CLevelDBIterator *pcursor = NewIterator();\n \n-    CDataStream ssKeySet(SER_DISK, CLIENT_VERSION);\n-    ssKeySet << make_pair('b', uint256(0));\n-    pcursor->Seek(ssKeySet.str());\n+    pcursor->Seek(make_pair('b', uint256(0)));\n \n     // Load mapBlockIndex\n     while (pcursor->Valid()) {\n         boost::this_thread::interruption_point();\n+        std::pair<char, uint256> key;\n+\n         try {\n-            leveldb::Slice slKey = pcursor->key();\n-            CDataStream ssKey(slKey.data(), slKey.data()+slKey.size(), SER_DISK, CLIENT_VERSION);\n-            char chType;\n-            ssKey >> chType;\n-            if (chType == 'b') {\n-                leveldb::Slice slValue = pcursor->value();\n-                CDataStream ssValue(slValue.data(), slValue.data()+slValue.size(), SER_DISK, CLIENT_VERSION);\n+          if (pcursor->GetKey(key) && key.first == 'b') {\n                 CDiskBlockIndex diskindex;\n-                ssValue >> diskindex;\n-\n-                // Construct block index object\n-                CBlockIndex* pindexNew = InsertBlockIndex(diskindex.GetBlockHash());\n-                pindexNew->pprev          = InsertBlockIndex(diskindex.hashPrev);\n-                pindexNew->nHeight        = diskindex.nHeight;\n-                pindexNew->nFile          = diskindex.nFile;\n-                pindexNew->nDataPos       = diskindex.nDataPos;\n-                pindexNew->nUndoPos       = diskindex.nUndoPos;\n-                pindexNew->nVersion       = diskindex.nVersion;\n-                pindexNew->hashMerkleRoot = diskindex.hashMerkleRoot;\n-                pindexNew->nTime          = diskindex.nTime;\n-                pindexNew->nBits          = diskindex.nBits;\n-                pindexNew->nNonce         = diskindex.nNonce;\n-                pindexNew->nStatus        = diskindex.nStatus;\n-                pindexNew->nTx            = diskindex.nTx;\n-\n-                if (!CheckProofOfWork(pindexNew->GetBlockHash(), pindexNew->nBits))\n-                    return error(\"LoadBlockIndex() : CheckProofOfWork failed: %s\", pindexNew->ToString());\n-\n-                pcursor->Next();\n-            } else {\n-                break; // if shutdown requested or finished loading block index\n-            }\n-        } catch (std::exception &e) {\n-            return error(\"%s : Deserialize or I/O error - %s\", __func__, e.what());\n+                if (pcursor->GetValue(diskindex)) {\n+                    // Construct block index object\n+                    CBlockIndex* pindexNew = InsertBlockIndex(diskindex.GetBlockHash());\n+                    pindexNew->pprev          = InsertBlockIndex(diskindex.hashPrev);\n+                    pindexNew->nHeight        = diskindex.nHeight;\n+                    pindexNew->nFile          = diskindex.nFile;\n+                    pindexNew->nDataPos       = diskindex.nDataPos;\n+                    pindexNew->nUndoPos       = diskindex.nUndoPos;\n+                    pindexNew->nVersion       = diskindex.nVersion;\n+                    pindexNew->hashMerkleRoot = diskindex.hashMerkleRoot;\n+                    pindexNew->nTime          = diskindex.nTime;\n+                    pindexNew->nBits          = diskindex.nBits;\n+                    pindexNew->nNonce         = diskindex.nNonce;\n+                    pindexNew->nStatus        = diskindex.nStatus;\n+                    pindexNew->nTx            = diskindex.nTx;\n+\n+                    if (!CheckProofOfWork(pindexNew->GetBlockHash(), pindexNew->nBits))\n+                        return error(\"LoadBlockIndex() : CheckProofOfWork failed: %s\", pindexNew->ToString());\n+\n+                    pcursor->Next();\n+                }\n+\n+          } else {\n+              break;\n+          }\n+        }\n+        catch (std::exception &e) {\n+            return error(\"%s : Deserialize or I/O error -%s\", __func__, e.what());\n         }\n     }\n "
      },
      {
        "sha": "d7dc826f04d774c044efe2b8d00e7be3b203ac65",
        "filename": "src/txdb.h",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/079503c6ac69c29fcc960511edfd4e3fd0b9daec/src/txdb.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/079503c6ac69c29fcc960511edfd4e3fd0b9daec/src/txdb.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/txdb.h?ref=079503c6ac69c29fcc960511edfd4e3fd0b9daec",
        "patch": "@@ -47,6 +47,7 @@ class CBlockTreeDB : public CLevelDBWrapper\n public:\n     CBlockTreeDB(size_t nCacheSize, bool fMemory = false, bool fWipe = false);\n private:\n+    uint256 salt;\n     CBlockTreeDB(const CBlockTreeDB&);\n     void operator=(const CBlockTreeDB&);\n public:\n@@ -59,6 +60,8 @@ class CBlockTreeDB : public CLevelDBWrapper\n     bool ReadReindexing(bool &fReindex);\n     bool ReadTxIndex(const uint256 &txid, CDiskTxPos &pos);\n     bool WriteTxIndex(const std::vector<std::pair<uint256, CDiskTxPos> > &list);\n+    bool ReadAddrIndex(uint160 addrid, std::vector<CExtDiskTxPos> &list);\n+    bool AddAddrIndex(const std::vector<std::pair<uint160, CExtDiskTxPos> > &list);\n     bool WriteFlag(const std::string &name, bool fValue);\n     bool ReadFlag(const std::string &name, bool &fValue);\n     bool LoadBlockIndexGuts();"
      }
    ]
  },
  {
    "sha": "609a0a7831e2dea70f32ddb1603593a3a9437701",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo2MDlhMGE3ODMxZTJkZWE3MGYzMmRkYjE2MDM1OTNhM2E5NDM3NzAx",
    "commit": {
      "author": {
        "name": "Johnathan Corgan",
        "email": "johnathan@corganlabs.com",
        "date": "2014-06-17T14:05:46Z"
      },
      "committer": {
        "name": "Johnathan Corgan",
        "email": "johnathan@corganlabs.com",
        "date": "2014-08-18T13:37:22Z"
      },
      "message": "Fix file descriptor leak\n\nOriginally reported by dexX7",
      "tree": {
        "sha": "829ccfa80e29445cc6322506f5b47b644d1728af",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/829ccfa80e29445cc6322506f5b47b644d1728af"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/609a0a7831e2dea70f32ddb1603593a3a9437701",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/609a0a7831e2dea70f32ddb1603593a3a9437701",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/609a0a7831e2dea70f32ddb1603593a3a9437701",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/609a0a7831e2dea70f32ddb1603593a3a9437701/comments",
    "author": {
      "login": "jmcorgan",
      "id": 1492956,
      "node_id": "MDQ6VXNlcjE0OTI5NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1492956?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jmcorgan",
      "html_url": "https://github.com/jmcorgan",
      "followers_url": "https://api.github.com/users/jmcorgan/followers",
      "following_url": "https://api.github.com/users/jmcorgan/following{/other_user}",
      "gists_url": "https://api.github.com/users/jmcorgan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jmcorgan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jmcorgan/subscriptions",
      "organizations_url": "https://api.github.com/users/jmcorgan/orgs",
      "repos_url": "https://api.github.com/users/jmcorgan/repos",
      "events_url": "https://api.github.com/users/jmcorgan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jmcorgan/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jmcorgan",
      "id": 1492956,
      "node_id": "MDQ6VXNlcjE0OTI5NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1492956?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jmcorgan",
      "html_url": "https://github.com/jmcorgan",
      "followers_url": "https://api.github.com/users/jmcorgan/followers",
      "following_url": "https://api.github.com/users/jmcorgan/following{/other_user}",
      "gists_url": "https://api.github.com/users/jmcorgan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jmcorgan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jmcorgan/subscriptions",
      "organizations_url": "https://api.github.com/users/jmcorgan/orgs",
      "repos_url": "https://api.github.com/users/jmcorgan/repos",
      "events_url": "https://api.github.com/users/jmcorgan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jmcorgan/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "079503c6ac69c29fcc960511edfd4e3fd0b9daec",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/079503c6ac69c29fcc960511edfd4e3fd0b9daec",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/079503c6ac69c29fcc960511edfd4e3fd0b9daec"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 2,
      "deletions": 0
    },
    "files": [
      {
        "sha": "3b08475c8cb57a1f6420f00adc69ada10e5af368",
        "filename": "src/txdb.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/609a0a7831e2dea70f32ddb1603593a3a9437701/src/txdb.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/609a0a7831e2dea70f32ddb1603593a3a9437701/src/txdb.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/txdb.cpp?ref=609a0a7831e2dea70f32ddb1603593a3a9437701",
        "patch": "@@ -178,6 +178,8 @@ bool CBlockTreeDB::ReadAddrIndex(uint160 addrid, std::vector<CExtDiskTxPos> &lis\n         }\n         iter->Next();\n     }\n+\n+    delete iter;\n     return true;\n }\n "
      }
    ]
  }
]