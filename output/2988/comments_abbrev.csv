BitcoinPullTester,2013-09-11T22:04:02Z,"Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/e00d03efc3cea1aa92da6287ffb167ef8a51af4f for binaries and test log.\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.log is moving at http://jenkins.bluematt.me/pull-tester/cu",https://github.com/bitcoin/bitcoin/pull/2988#issuecomment-24280270,24280270,
theuni,2013-09-11T23:37:25Z,ACK\n,https://github.com/bitcoin/bitcoin/pull/2988#issuecomment-24284858,24284858,
gavinandresen,2013-09-11T23:42:21Z,Why do we need a stopgap?\n,https://github.com/bitcoin/bitcoin/pull/2988#issuecomment-24285059,24285059,
theuni,2013-09-11T23:56:09Z,"@gavinandresen this was a bug that slipped in, -O2 was supposed to be in the original autotools PR. Apparently some of the hardening options create strange warning/errors when combined with no optims.\n\nI proposed that now was a good time to evaluate how debug/release usage should work (or if the distinction even needs to be available via configure options) now that we're beginning to deviate fro",https://github.com/bitcoin/bitcoin/pull/2988#issuecomment-24285619,24285619,
gavinandresen,2013-09-12T01:16:31Z,"""some of the hardening options create strange warnings/errors with no -O""  :  that makes me nervous. Is that documented behavior?  A bug in some version of gcc?  Are we using that gcc for pull-tester or gitian?\n\nSorry for being grumpy, but that's why I don't like stopgap solutions; they tend to become ""Oh, we fixed that"" when really it is ""Oh, we swept that problem under the rug so we didn't hav",https://github.com/bitcoin/bitcoin/pull/2988#issuecomment-24288755,24288755,
sipa,2013-09-12T01:27:12Z,https://isisblogs.poly.edu/2011/04/11/fortify_source-semantics/ ->\nYOU MUST TURN ON OPTIMIZATION -01 OR GREATER FOR FORTIFY_SOURCE TO WORK.\n,https://github.com/bitcoin/bitcoin/pull/2988#issuecomment-24289108,24289108,
theuni,2013-09-12T01:29:50Z,"stopgap is really not the right description here. This returns us to the previous working behavior. It's only stopgap in that I have a desire to change that previous behavior.\n\nFrom gcc man pages:\n\nNOTE: In Ubuntu 8.10 and later versions, -D_FORTIFY_SOURCE=2 is set by default, and is activated when -O is set to 2 or higher.  This enables additional compile-time and run-time checks for several ",https://github.com/bitcoin/bitcoin/pull/2988#issuecomment-24289195,24289195,
gavinandresen,2013-09-12T01:54:33Z,"Seems wrong to add -O2 to ./configure --enable-debug.  I know I've had issues in the past trying to step through -g -O2 compiled code in the debugger.\n\nIs the real issue that --enable-debug and --enable-hardening are incompatible? It'd be fine with me if the default was release builds, and if you want a debug build you must --enable-debug --disable-hardening.\n",https://github.com/bitcoin/bitcoin/pull/2988#issuecomment-24290035,24290035,
theuni,2013-09-12T02:15:51Z,"@gavinandresen I would agree with that, yes. Hardening and debugging pretty much conflict as concepts.\n\nBut if we go that route, I would go further as to say that there's no longer any need for the hardening option, it's simply always on in release mode and never in debug.\n",https://github.com/bitcoin/bitcoin/pull/2988#issuecomment-24290746,24290746,
gavinandresen,2013-09-12T02:38:10Z,ACK from me on always-harden-release and removing the --enable-hardening option.  Good Idea.\n,https://github.com/bitcoin/bitcoin/pull/2988#issuecomment-24291518,24291518,
theuni,2013-09-12T02:51:40Z,"@gavinandresen ok, then the last hurdle is figuring out what to do with OSX, since debug/release vary so much. I was hoping to bite this off in different chunks, but I suppose it's better worth doing as a whole.\n\nOSX is currently back-compat to 10.5. As you've mentioned, this should change to 10.6. Unfortunately, 10.6 still supports 32bit cpus, so release builds will need to remain 32bit. And in",https://github.com/bitcoin/bitcoin/pull/2988#issuecomment-24291914,24291914,
gavinandresen,2013-09-12T03:41:22Z,"I think it would be better to drop -arch and -mmacosx-version-min entirely from the mac builds.\n\nI'll still build releases on my 32-bit OSX 10.6 machine. Eventually maybe we'll cross-compile releases in a gitian VM. (both of those cases will likely need their own wacky flags).\n\nIn any case, I don't want to make it difficult for OSX developers by having them either constantly overriding the def",https://github.com/bitcoin/bitcoin/pull/2988#issuecomment-24293293,24293293,
theuni,2013-09-12T04:42:04Z,"I disagree very strongly with that. That means that every dev is targeting different architectures and sdks with their builds, meaning that the release binary will be completely different (read: different compiler, min sdk, target sdk, and architecture) than what devs have tested. That is a huge amount of trust to be putting into toolchains and compliant code, doubly so given Apple's whimsical rep",https://github.com/bitcoin/bitcoin/pull/2988#issuecomment-24294869,24294869,
gmaxwell,2013-09-12T07:00:32Z,"I don't think this is the best place to discuss alternative toolchains on OSX.\n\nPlease just make the default release builds. Hardening enabled by default, I don't even care if there is a disable hardening but since there has to be detection to make sure the options don't break the build it's probably easy to keep a disable flag.\n\nA make debug should build a binary the same as release but with ",https://github.com/bitcoin/bitcoin/pull/2988#issuecomment-24298739,24298739,
sipa,2013-09-13T10:32:48Z,"@gmaxwell: So your suggestion is:\n- Debug is ""-O0 -g2 -ggdb""\n- Release is ""-O2 -g0 + hardening""\n- Default is release\n  Or do I miss something?\n\nI think I'd prefer -O1 for debug builds, and having hardening enabled there too, as it doesn't interfere that much with debugging, but has a large performance impact (which matters in particular when running under valgrind).\n",https://github.com/bitcoin/bitcoin/pull/2988#issuecomment-24386016,24386016,
gavinandresen,2013-09-13T12:02:00Z,"NACK from me on -O1 debug builds.  Just today I ran into odd issues with lldb I suspect are caused by -O1 debug builds... (might not be, but ""principle of least surprise"" would be no optimizations at all for debug builds).\n",https://github.com/bitcoin/bitcoin/pull/2988#issuecomment-24389836,24389836,
laanwj,2013-09-13T12:10:09Z,"Many programs have a ""release with debug symbols"" mode for building, maybe that's a useful compromise for the people that want to debug/valgrind a hardened and optimized build.\n",https://github.com/bitcoin/bitcoin/pull/2988#issuecomment-24390180,24390180,
jgarzik,2013-09-13T13:14:08Z,"A **lot** of work has gone into making ""-O2 -g"" a sane and workable default, in the upstream compiler and packaging world.  Obviously it is not _perfect_ for debugging, as the compiler may transform a statement you wish to debug, but literal man-years have gone into making it as usable as possible.  Fedora builds debug info for all packages, and uses special tools to gather the debug info into a s",https://github.com/bitcoin/bitcoin/pull/2988#issuecomment-24393393,24393393,
jgarzik,2013-09-13T13:16:36Z,"Further, I really see no point in separate ""debug build"" and ""release build"" concepts.  We should always build with a default, -O2 -g + hardening.  If the default is not suitable -- I often disable -O for serious debugging too -- then we can add ""--disable-opt"" or ""--enable-debug"" if the developer really cannot be bothered to override on the configure command line.\n",https://github.com/bitcoin/bitcoin/pull/2988#issuecomment-24393514,24393514,
luke-jr,2013-09-13T13:47:25Z,"IMO overridding CXXFLAGS on configure is easy enough. I also find -O2 makes debugging impractical, but not a huge deal if it can be overridden.\n",https://github.com/bitcoin/bitcoin/pull/2988#issuecomment-24395382,24395382,
gmaxwell,2013-09-13T16:13:18Z,"@sipa I have never seen hardening interfere with debugging, so I think it should always be on. (though perhaps we turn off the couple things that cause warnings at O0 just to remove the noise.\n\nJeff is right that a lot of work has gone into making debugging work at O2 -g.  make debug is for when that fails.\n\nI too would prefer O1 for make debug, but since I consider make debug for the case whe",https://github.com/bitcoin/bitcoin/pull/2988#issuecomment-24405711,24405711,
jgarzik,2013-09-13T17:02:32Z,"Some numbers, on x86-64/Linux:\n\nCXXFLAGS=""-O2 -Wall -g"" ./configure --without-qt --with-incompatible-bdb\n\n```\njgarzik@hum:~/repo/bitcoin/src$ ls -l bitcoind\n-rwxrwxr-x 1 jgarzik jgarzik 63680406 Sep 13 12:52 bitcoind\njgarzik@hum:~/repo/bitcoin/src$ strip bitcoind\njgarzik@hum:~/repo/bitcoin/src$ ls -l bitcoind\n-rwxrwxr-x 1 jgarzik jgarzik 3777696 Sep 13 12:54 bitcoind\n```\n\nCXXFLAGS=""-O2",https://github.com/bitcoin/bitcoin/pull/2988#issuecomment-24409007,24409007,
jgarzik,2013-09-13T17:06:34Z,"@gmaxwell Starter links,\nhttps://fedoraproject.org/wiki/Packaging:Debuginfo?rd=Packaging/Debuginfo\nhttps://fedorahosted.org/elfutils/wiki/DebugInfo\n\nThough I think that the size of our executables is a low priority [unless it's a fun project you just want to obsess over ;p]   Shipping debug info in production executables should be just fine.  The compiler puts the debug info in separate sectio",https://github.com/bitcoin/bitcoin/pull/2988#issuecomment-24409280,24409280,
luke-jr,2013-09-13T17:13:47Z,"FWIW, if we ship with debug symbols, I also have a backtrace.dll (mostly written be other people) that can be used with a simple LoadLibrary call and dumps a backtrace to stderr (which we could reopen to debug.log if desired) on crash. The only downside (although my users thing it's a good thing) is that Windows no longer displays a crash dialog (ie, the program ""silently"" exits).\n",https://github.com/bitcoin/bitcoin/pull/2988#issuecomment-24409766,24409766,
jgarzik,2013-09-13T17:26:55Z,"Another note too, let's examine the problem a bit at a higher level:  work _with_ autotools not against it.  Remember that many platforms will go ahead and override CFLAGS / CXXFLAGS with the platform standard during the Red Hat / SuSE / Debian package build process.\n\nAll this work trying to find the perfect build flags for various releases will be scrapped, ignored or worked around by many, reg",https://github.com/bitcoin/bitcoin/pull/2988#issuecomment-24410646,24410646,
theuni,2013-09-13T17:55:16Z,"@gmaxwell Split debug stuff is no problem, I can create a target for those once the dust settles here.\n",https://github.com/bitcoin/bitcoin/pull/2988#issuecomment-24412569,24412569,
theuni,2013-09-13T20:12:41Z,"@jgarzik fwiw, ""-g -O2"" is the autoconf default. That's what most would expect to see as a result of a vanilla ""./configure"".\n",https://github.com/bitcoin/bitcoin/pull/2988#issuecomment-24421255,24421255,
wtogami,2013-09-15T08:39:47Z,"Could we please restore the default behavior of pre-autotools (-O2) then proceed with the bikeshedding?  I don't care how -O2 is restored, just do it and decide how to do do it ""proper"" later?\n",https://github.com/bitcoin/bitcoin/pull/2988#issuecomment-24466663,24466663,
sipa,2013-09-15T13:50:57Z,ACK - this or just reverting to autotools' default. We can bikeshed later.\n,https://github.com/bitcoin/bitcoin/pull/2988#issuecomment-24471805,24471805,
jgarzik,2013-09-18T12:18:45Z,"Upstream now does -O2, superceded, closing.\n",https://github.com/bitcoin/bitcoin/pull/2988#issuecomment-24659869,24659869,
