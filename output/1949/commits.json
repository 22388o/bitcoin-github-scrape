[
  {
    "sha": "56424040a469f775f14be0c81d7d62ebcfd8a0d7",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1NjQyNDA0MGE0NjlmNzc1ZjE0YmUwYzgxZDdkNjJlYmNmZDhhMGQ3",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-10-22T07:22:15Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-10-22T22:23:39Z"
      },
      "message": "Bugfix: off-by-one error in coinbase maturity check",
      "tree": {
        "sha": "788cb414e4d0b3170b2ce336941ed69b63877a83",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/788cb414e4d0b3170b2ce336941ed69b63877a83"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/56424040a469f775f14be0c81d7d62ebcfd8a0d7",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/56424040a469f775f14be0c81d7d62ebcfd8a0d7",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/56424040a469f775f14be0c81d7d62ebcfd8a0d7",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/56424040a469f775f14be0c81d7d62ebcfd8a0d7/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "2ef15697f84208e05764046dd86bcf067029a9b8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2ef15697f84208e05764046dd86bcf067029a9b8",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/2ef15697f84208e05764046dd86bcf067029a9b8"
      }
    ],
    "stats": {
      "total": 8,
      "additions": 5,
      "deletions": 3
    },
    "files": [
      {
        "sha": "723b8d75ea98c1313ca6cdfaa2a1cf1822464afb",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 3,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/56424040a469f775f14be0c81d7d62ebcfd8a0d7/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/56424040a469f775f14be0c81d7d62ebcfd8a0d7/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=56424040a469f775f14be0c81d7d62ebcfd8a0d7",
        "patch": "@@ -1319,7 +1319,9 @@ bool CTransaction::CheckInputs(CCoinsViewCache &inputs, enum CheckSig_mode csmod\n         if (!HaveInputs(inputs))\n             return error(\"CheckInputs() : %s inputs unavailable\", GetHash().ToString().substr(0,10).c_str());\n \n-        CBlockIndex *pindexBlock = inputs.GetBestBlock();\n+        // While checking, GetBestBlock() refers to the parent block.\n+        // This is also true for mempool checks.\n+        int nSpendHeight = inputs.GetBestBlock()->nHeight + 1; \n         int64 nValueIn = 0;\n         int64 nFees = 0;\n         for (unsigned int i = 0; i < vin.size(); i++)\n@@ -1329,8 +1331,8 @@ bool CTransaction::CheckInputs(CCoinsViewCache &inputs, enum CheckSig_mode csmod\n \n             // If prev is coinbase, check that it's matured\n             if (coins.IsCoinBase()) {\n-                if (pindexBlock->nHeight - coins.nHeight < COINBASE_MATURITY)\n-                    return error(\"CheckInputs() : tried to spend coinbase at depth %d\", pindexBlock->nHeight - coins.nHeight);\n+                if (nSpendHeight - coins.nHeight < COINBASE_MATURITY)\n+                    return error(\"CheckInputs() : tried to spend coinbase at depth %d\", nSpendHeight - coins.nHeight);\n             }\n \n             // Check for negative or overflow input values"
      }
    ]
  },
  {
    "sha": "9e957fb3b17e93a37db80544550a6689a3647295",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5ZTk1N2ZiM2IxN2U5M2EzN2RiODA1NDQ1NTBhNjY4OWEzNjQ3Mjk1",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-10-22T19:46:00Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-10-22T22:23:39Z"
      },
      "message": "Bugfix: add missing fee check",
      "tree": {
        "sha": "00553995ac525e50cd82e582cf795d13ee537b3d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/00553995ac525e50cd82e582cf795d13ee537b3d"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9e957fb3b17e93a37db80544550a6689a3647295",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9e957fb3b17e93a37db80544550a6689a3647295",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/9e957fb3b17e93a37db80544550a6689a3647295",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9e957fb3b17e93a37db80544550a6689a3647295/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "56424040a469f775f14be0c81d7d62ebcfd8a0d7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/56424040a469f775f14be0c81d7d62ebcfd8a0d7",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/56424040a469f775f14be0c81d7d62ebcfd8a0d7"
      }
    ],
    "stats": {
      "total": 3,
      "additions": 3,
      "deletions": 0
    },
    "files": [
      {
        "sha": "dd2f491aeda7eebf1088a8e5e606124a0d16cd50",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9e957fb3b17e93a37db80544550a6689a3647295/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9e957fb3b17e93a37db80544550a6689a3647295/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=9e957fb3b17e93a37db80544550a6689a3647295",
        "patch": "@@ -1597,6 +1597,9 @@ bool CBlock::ConnectBlock(CBlockIndex* pindex, CCoinsViewCache &view, bool fJust\n             blockundo.vtxundo.push_back(txundo);\n     }\n \n+    if (vtx[0].GetValueOut() > GetBlockValue(pindex->nHeight, nFees))\n+        return false;\n+\n     if (fJustCheck)\n         return true;\n "
      }
    ]
  },
  {
    "sha": "1e64c2d585eeb6217d08a49c4cc7a89e0afd0421",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxZTY0YzJkNTg1ZWViNjIxN2QwOGE0OWM0Y2M3YTg5ZTBhZmQwNDIx",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-10-22T22:10:12Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-10-22T22:23:39Z"
      },
      "message": "Bugfix: off-by-one in priority calculation",
      "tree": {
        "sha": "0caef3dfd32f0c7e8fa3aa04670fc09067e6e224",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0caef3dfd32f0c7e8fa3aa04670fc09067e6e224"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1e64c2d585eeb6217d08a49c4cc7a89e0afd0421",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1e64c2d585eeb6217d08a49c4cc7a89e0afd0421",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/1e64c2d585eeb6217d08a49c4cc7a89e0afd0421",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1e64c2d585eeb6217d08a49c4cc7a89e0afd0421/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "9e957fb3b17e93a37db80544550a6689a3647295",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9e957fb3b17e93a37db80544550a6689a3647295",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/9e957fb3b17e93a37db80544550a6689a3647295"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 1,
      "deletions": 1
    },
    "files": [
      {
        "sha": "4386893ee149a1e85898221bd5b08d3759bdaa34",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1e64c2d585eeb6217d08a49c4cc7a89e0afd0421/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1e64c2d585eeb6217d08a49c4cc7a89e0afd0421/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=1e64c2d585eeb6217d08a49c4cc7a89e0afd0421",
        "patch": "@@ -3830,7 +3830,7 @@ CBlock* CreateNewBlock(CReserveKey& reservekey)\n                 int64 nValueIn = coins.vout[txin.prevout.n].nValue;\n                 nTotalIn += nValueIn;\n \n-                int nConf = pindexPrev->nHeight - coins.nHeight;\n+                int nConf = pindexPrev->nHeight - coins.nHeight + 1;\n \n                 dPriority += (double)nValueIn * nConf;\n             }"
      }
    ]
  },
  {
    "sha": "c2ed184f987fbb157880fce2f91ebc8514fd6e76",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpjMmVkMTg0Zjk4N2ZiYjE1Nzg4MGZjZTJmOTFlYmM4NTE0ZmQ2ZTc2",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-10-22T22:21:16Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-10-22T22:27:17Z"
      },
      "message": "Added some comments\n\nSome clarifications after a code review by Mike Hearn.",
      "tree": {
        "sha": "446f1d6b1dbe7ab527da1598a3b258028894b06a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/446f1d6b1dbe7ab527da1598a3b258028894b06a"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c2ed184f987fbb157880fce2f91ebc8514fd6e76",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c2ed184f987fbb157880fce2f91ebc8514fd6e76",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/c2ed184f987fbb157880fce2f91ebc8514fd6e76",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c2ed184f987fbb157880fce2f91ebc8514fd6e76/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "1e64c2d585eeb6217d08a49c4cc7a89e0afd0421",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1e64c2d585eeb6217d08a49c4cc7a89e0afd0421",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/1e64c2d585eeb6217d08a49c4cc7a89e0afd0421"
      }
    ],
    "stats": {
      "total": 26,
      "additions": 24,
      "deletions": 2
    },
    "files": [
      {
        "sha": "26cbab84831d9cc2b0f8fbeed1469c77aed23ff6",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 8,
        "deletions": 1,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c2ed184f987fbb157880fce2f91ebc8514fd6e76/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c2ed184f987fbb157880fce2f91ebc8514fd6e76/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=c2ed184f987fbb157880fce2f91ebc8514fd6e76",
        "patch": "@@ -698,6 +698,8 @@ bool CTxMemPool::accept(CTransaction &tx, bool fCheckInputs,\n             return false;\n \n         // do all inputs exist?\n+        // Note that this does not check for the presence of actual outputs (see the next check for that),\n+        // only helps filling in pfMissingInputs (to determine missing vs spent).\n         BOOST_FOREACH(const CTxIn txin, tx.vin) {\n             if (!view.HaveCoins(txin.prevout.hash)) {\n                 if (pfMissingInputs)\n@@ -706,6 +708,7 @@ bool CTxMemPool::accept(CTransaction &tx, bool fCheckInputs,\n             }\n         }\n \n+        // are the actual inputs available?\n         if (!tx.HaveInputs(view))\n             return error(\"CTxMemPool::accept() : inputs already spent\");\n \n@@ -1956,9 +1959,13 @@ bool CBlock::CheckBlock(bool fCheckPOW, bool fCheckMerkleRoot) const\n         if (!tx.CheckTransaction())\n             return DoS(tx.nDoS, error(\"CheckBlock() : CheckTransaction failed\"));\n \n+    // Build the merkle tree already. We need it anyway later, and it makes the\n+    // block cache the transaction hashes, which means they don't need to be\n+    // recalculated many times during this block's validation.\n+    BuildMerkleTree();\n+\n     // Check for duplicate txids. This is caught by ConnectInputs(),\n     // but catching it earlier avoids a potential DoS attack:\n-    BuildMerkleTree();\n     set<uint256> uniqueTx;\n     for (unsigned int i=0; i<vtx.size(); i++) {\n         uniqueTx.insert(GetTxHash(i));"
      },
      {
        "sha": "36869efe631c573b2fa3cbe20c6cff9ba5a5fe50",
        "filename": "src/main.h",
        "status": "modified",
        "additions": 16,
        "deletions": 1,
        "changes": 17,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c2ed184f987fbb157880fce2f91ebc8514fd6e76/src/main.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c2ed184f987fbb157880fce2f91ebc8514fd6e76/src/main.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.h?ref=c2ed184f987fbb157880fce2f91ebc8514fd6e76",
        "patch": "@@ -1820,7 +1820,11 @@ class CCoinsView\n \n     // Modify the currently active block index\n     virtual bool SetBestBlock(CBlockIndex *pindex);\n+\n+    // Do a bulk modification (multiple SetCoins + one SetBestBlock)\n     virtual bool BatchWrite(const std::map<uint256, CCoins> &mapCoins, CBlockIndex *pindex);\n+\n+    // Calculate statistics about the unspent transaction output set\n     virtual bool GetStats(CCoinsStats &stats);\n };\n \n@@ -1851,14 +1855,25 @@ class CCoinsViewCache : public CCoinsViewBacked\n \n public:\n     CCoinsViewCache(CCoinsView &baseIn, bool fDummy = false);\n+\n+    // Standard CCoinsView methods\n     bool GetCoins(uint256 txid, CCoins &coins);\n     bool SetCoins(uint256 txid, const CCoins &coins);\n     bool HaveCoins(uint256 txid);\n-    CCoins &GetCoins(uint256 txid);\n     CBlockIndex *GetBestBlock();\n     bool SetBestBlock(CBlockIndex *pindex);\n     bool BatchWrite(const std::map<uint256, CCoins> &mapCoins, CBlockIndex *pindex);\n+\n+    // Return a modifiable reference to a CCoins. Check HaveCoins first.\n+    // Many methods explicitly require a CCoinsViewCache because of this method, to reduce\n+    // copying.\n+    CCoins &GetCoins(uint256 txid);\n+\n+    // Push the modifications applied to this cache to its base.\n+    // Failure to call this method before destruction will cause the changes to be forgotten.\n     bool Flush();\n+\n+    // Calculate the size of the cache (in number of transactions)\n     unsigned int GetCacheSize();\n \n private:"
      }
    ]
  },
  {
    "sha": "4afc0b54112bd990217a4a6fea145574e5947f09",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0YWZjMGI1NDExMmJkOTkwMjE3YTRhNmZlYTE0NTU3NGU1OTQ3ZjA5",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-10-22T23:16:26Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-10-22T23:43:33Z"
      },
      "message": "Bugfix: actually use CCoinsViewMemPool",
      "tree": {
        "sha": "00d3e4a096c933e6a24219fc936f86db94fffc29",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/00d3e4a096c933e6a24219fc936f86db94fffc29"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4afc0b54112bd990217a4a6fea145574e5947f09",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4afc0b54112bd990217a4a6fea145574e5947f09",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/4afc0b54112bd990217a4a6fea145574e5947f09",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4afc0b54112bd990217a4a6fea145574e5947f09/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "c2ed184f987fbb157880fce2f91ebc8514fd6e76",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c2ed184f987fbb157880fce2f91ebc8514fd6e76",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/c2ed184f987fbb157880fce2f91ebc8514fd6e76"
      }
    ],
    "stats": {
      "total": 16,
      "additions": 14,
      "deletions": 2
    },
    "files": [
      {
        "sha": "be1e947ad3c9a2139cb55918c187e000445b2452",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 14,
        "deletions": 2,
        "changes": 16,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4afc0b54112bd990217a4a6fea145574e5947f09/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4afc0b54112bd990217a4a6fea145574e5947f09/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=4afc0b54112bd990217a4a6fea145574e5947f09",
        "patch": "@@ -691,7 +691,13 @@ bool CTxMemPool::accept(CTransaction &tx, bool fCheckInputs,\n \n     if (fCheckInputs)\n     {\n-        CCoinsViewCache &view = *pcoinsTip;\n+        CCoinsView dummy;\n+        CCoinsViewCache view(dummy);\n+\n+        {\n+        LOCK(cs);\n+        CCoinsViewMemPool viewMemPool(*pcoinsTip, *this);\n+        view.SetBackend(viewMemPool);\n \n         // do we already have it?\n         if (view.HaveCoins(hash))\n@@ -711,6 +717,13 @@ bool CTxMemPool::accept(CTransaction &tx, bool fCheckInputs,\n         // are the actual inputs available?\n         if (!tx.HaveInputs(view))\n             return error(\"CTxMemPool::accept() : inputs already spent\");\n+ \n+        // Bring the best block into scope\n+        view.GetBestBlock();\n+\n+        // we have all inputs cached now, so switch back to dummy, so we don't need to keep lock on mempool\n+        view.SetBackend(dummy);\n+        }\n \n         // Check for non-standard pay-to-script-hash in inputs\n         if (!tx.AreInputsStandard(view) && !fTestNet)\n@@ -741,7 +754,6 @@ bool CTxMemPool::accept(CTransaction &tx, bool fCheckInputs,\n             int64 nNow = GetTime();\n \n             {\n-                LOCK(cs);\n                 // Use an exponentially decaying ~10-minute window:\n                 dFreeCount *= pow(1.0 - 1.0/600.0, (double)(nNow - nLastTime));\n                 nLastTime = nNow;"
      }
    ]
  }
]