mikehearn,2014-09-05T09:57:53Z,Looking good! Most of my comments are minor style points. :+1: \n,https://github.com/bitcoin/bitcoin/pull/4845#issuecomment-54606011,54606011,
BitcoinPullTester,2014-09-09T16:40:52Z,"Automatic sanity-testing: FAILED BUILD/TEST, see http://jenkins.bluematt.me/pull-tester/p4845_eda4aa19d3cafc1644f5c28c687741a6c255b9a6/ for binaries and test log.\n\nThis could happen for one of several reasons:\n1. It chanages paths in makefile.linux-mingw or otherwise changes build scripts in a way that made them incompatible with the automated testing scripts (please tweak those patches in qa/p",https://github.com/bitcoin/bitcoin/pull/4845#issuecomment-54999007,54999007,
mikehearn,2014-09-09T18:31:32Z,"Great, thanks! I didn't try running the tests myself but the code looks good to me.\n",https://github.com/bitcoin/bitcoin/pull/4845#issuecomment-55013118,55013118,
SergioDemianLerner,2014-09-10T21:54:42Z,I would like to know if there is a plan to add this patch to master or a reason not to. I have another patch waiting with more test cases that requires this patch to work! Thanks.\n,https://github.com/bitcoin/bitcoin/pull/4845#issuecomment-55189148,55189148,
sipa,2014-09-10T23:20:56Z,"I haven't reviewed all code, but the changes to the existing core code and tests do seem safe to me.\n",https://github.com/bitcoin/bitcoin/pull/4845#issuecomment-55199096,55199096,
laanwj,2014-09-29T11:05:17Z,"Had to be rebased for the clang code formatting change, as well as some other (base)chainparams changes.\nRebased version here: https://github.com/laanwj/bitcoin/tree/2014_09_unittest_master\n",https://github.com/bitcoin/bitcoin/pull/4845#issuecomment-57145753,57145753,
laanwj,2014-09-29T11:08:11Z,"I'm not too happy about a virtual being introduced into CChainParams. Can we avoid this?\n\n```\nvirtual bool SkipProofOfWorkCheck() const { return false; }\n```\n\nEdit: yes we can, see 4705902\n",https://github.com/bitcoin/bitcoin/pull/4845#issuecomment-57146007,57146007,
laanwj,2014-09-29T11:20:06Z,ACK - will merge after you've sanity-checked my rebased version.\n,https://github.com/bitcoin/bitcoin/pull/4845#issuecomment-57146969,57146969,
laanwj,2014-10-02T08:33:32Z,"Oops - this was marked by Travis as ok, but is failing the windows tests now after I tried to merge.\n\nSee\n- https://travis-ci.org/bitcoin/bitcoin/jobs/36845581\n- https://travis-ci.org/bitcoin/bitcoin/jobs/36845582\n\nLots of:\n\n```\ntest/miner_tests.cpp(82): error in ""CreateNewBlock_validity"": check ProcessBlock(state, __null, pblock) failed\ntest/miner_tests.cpp(83): error in ""CreateNewBlock",https://github.com/bitcoin/bitcoin/pull/4845#issuecomment-57598338,57598338,
SergioDemianLerner,2014-10-02T14:06:14Z,"@laanwj I asked TheBlueMatt before about this problem. I could not replicate the problem, but It think that in some platforms the order in which the test cases are executed is different. Ohh, you already discovered this in  #5030\n",https://github.com/bitcoin/bitcoin/pull/4845#issuecomment-57634438,57634438,
laanwj,2014-10-08T07:11:23Z,"Closing this. The modifiable parameters part has been merged (see #5030). The blocksv2 test case that relies on being executed in a specific order w/ miner_tests has not, as that's not acceptable (as it makes the test framework non-deterministic, and makes it impossible to run testcases separately). Please find a different solution for that.\n",https://github.com/bitcoin/bitcoin/pull/4845#issuecomment-58318987,58318987,
Diapolo,2014-09-05T08:06:29Z,"This looks weird, is it missing an indentation below or some brackets?\n",https://github.com/bitcoin/bitcoin/pull/4845#discussion_r17160881,17160881,src/main.cpp
mikehearn,2014-09-05T09:47:23Z,"Would be good to s/Reg/Unit/ here to keep things distinct. Regtest is for programs that drive the app externally over the wire, unit tests is for, well, unit tests.\n",https://github.com/bitcoin/bitcoin/pull/4845#discussion_r17164307,17164307,src/chainparams.cpp
mikehearn,2014-09-05T09:48:16Z,Or just fold it into the expression with &&\n,https://github.com/bitcoin/bitcoin/pull/4845#discussion_r17164341,17164341,src/main.cpp
mikehearn,2014-09-05T09:50:05Z,"Indentation. Also watch for whitespace around function parameter lists and so on. You might want to call the variable ""diffValue"" as ""dif"" is not a common way to abbreviate a word like difficulty.\n",https://github.com/bitcoin/bitcoin/pull/4845#discussion_r17164396,17164396,src/test/blockv2_tests.cpp
mikehearn,2014-09-05T09:51:02Z,s/RegTest/Unittest/\n\nIndentation is wrong.\n,https://github.com/bitcoin/bitcoin/pull/4845#discussion_r17164424,17164424,src/test/blockv2_tests.cpp
mikehearn,2014-09-05T09:52:14Z,I'd feel better when things like this are scoped_ptr<>. Raw pointers in C++ are too easy to mess up.\n,https://github.com/bitcoin/bitcoin/pull/4845#discussion_r17164473,17164473,src/test/blockv2_tests.cpp
mikehearn,2014-09-05T09:53:41Z,"This line confuses me. You're setting hashPrevBlock to the hash of the containing block, no? Or that's what it looks like. I don't see where the blocks parent is being modified.\n",https://github.com/bitcoin/bitcoin/pull/4845#discussion_r17164535,17164535,src/test/blockv2_tests.cpp
mikehearn,2014-09-05T09:54:39Z,"It might make sense to refactor this ""add a block, did it work"" logic into a function.\n",https://github.com/bitcoin/bitcoin/pull/4845#discussion_r17164582,17164582,src/test/blockv2_tests.cpp
mikehearn,2014-09-05T09:55:09Z,"This ""reason got lost"" thing sounds like a bug. Is it? No worries about fixing it in this patch if so, I'm just interested.\n",https://github.com/bitcoin/bitcoin/pull/4845#discussion_r17164596,17164596,src/test/blockv2_tests.cpp
mikehearn,2014-09-05T09:56:13Z,s/were/where/\n,https://github.com/bitcoin/bitcoin/pull/4845#discussion_r17164636,17164636,src/test/blockv2_tests.cpp
mikehearn,2014-09-05T09:56:43Z,"Also looks like this comment should be attached to the block above, I think. You're not adding 200 blocks at this point, that was just done.\n",https://github.com/bitcoin/bitcoin/pull/4845#discussion_r17164653,17164653,src/test/blockv2_tests.cpp
mikehearn,2014-09-05T09:57:18Z,Could these be in separate unit tests?\n,https://github.com/bitcoin/bitcoin/pull/4845#discussion_r17164670,17164670,src/test/blockv2_tests.cpp
sipa,2014-09-05T09:59:59Z,"This is weird and surprising, but it's just copied from miner_tests.cpp.\n",https://github.com/bitcoin/bitcoin/pull/4845#discussion_r17164774,17164774,src/test/blockv2_tests.cpp
sipa,2014-09-05T10:02:52Z,"No, it's not a bug. Receiving a single block can cause zero or multiple blocks to be connected, and ActivateBestChain's responsibility is just switching the best block whatsoever.\n\nFeedback about failures causes a reject message to be sent to the peer from which we received the actual block (not necessarily the same as from whom we got the block that caused the reorg), for which we remember the ",https://github.com/bitcoin/bitcoin/pull/4845#discussion_r17164883,17164883,src/test/blockv2_tests.cpp
SergioDemianLerner,2014-09-05T12:50:38Z,It's missing indentation below.\nBut this is on purpose: I want critical consensus code not even look as modified so everyone can evaluate security at eyesight.\n,https://github.com/bitcoin/bitcoin/pull/4845#discussion_r17170397,17170397,src/main.cpp
SergioDemianLerner,2014-09-05T12:53:08Z,"difValue is a difference from the current block height, not for difficulty. I can rename it to heightDifference.\n",https://github.com/bitcoin/bitcoin/pull/4845#discussion_r17170489,17170489,src/test/blockv2_tests.cpp
SergioDemianLerner,2014-09-05T13:02:30Z,"Yes, but since they create v2 blocks, they can only be run after the previous v2 majority tests. So there is a hidden dependence.\n",https://github.com/bitcoin/bitcoin/pull/4845#discussion_r17170842,17170842,src/test/blockv2_tests.cpp
sipa,2014-09-10T23:19:09Z,+1\n,https://github.com/bitcoin/bitcoin/pull/4845#discussion_r17395663,17395663,src/test/blockv2_tests.cpp
