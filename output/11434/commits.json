[
  {
    "sha": "3a4712c2517d2f707bfd972706cc0802e78b2db7",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozYTQ3MTJjMjUxN2QyZjcwN2JmZDk3MjcwNmNjMDgwMmU3OGIyZGI3",
    "commit": {
      "author": {
        "name": "Marko Bencun",
        "email": "marko.bencun@monetas.net",
        "date": "2017-10-02T07:23:31Z"
      },
      "committer": {
        "name": "Marko Bencun",
        "email": "marko.bencun@monetas.net",
        "date": "2017-10-02T07:23:31Z"
      },
      "message": "formatting improvements related to rpc ban",
      "tree": {
        "sha": "767722d30e516355dc75784c124f48ce13ee6fc9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/767722d30e516355dc75784c124f48ce13ee6fc9"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3a4712c2517d2f707bfd972706cc0802e78b2db7",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3a4712c2517d2f707bfd972706cc0802e78b2db7",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/3a4712c2517d2f707bfd972706cc0802e78b2db7",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3a4712c2517d2f707bfd972706cc0802e78b2db7/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "e542728cde676f218c552d841d0af29b92f9800b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e542728cde676f218c552d841d0af29b92f9800b",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/e542728cde676f218c552d841d0af29b92f9800b"
      }
    ],
    "stats": {
      "total": 16,
      "additions": 10,
      "deletions": 6
    },
    "files": [
      {
        "sha": "304f2a73b132818e2cef2306907d6878f52b50bb",
        "filename": "src/rpc/net.cpp",
        "status": "modified",
        "additions": 10,
        "deletions": 6,
        "changes": 16,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3a4712c2517d2f707bfd972706cc0802e78b2db7/src/rpc/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3a4712c2517d2f707bfd972706cc0802e78b2db7/src/rpc/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpc/net.cpp?ref=3a4712c2517d2f707bfd972706cc0802e78b2db7",
        "patch": "@@ -530,18 +530,22 @@ UniValue setban(const JSONRPCRequest& request)\n \n     if (strCommand == \"add\")\n     {\n-        if (isSubnet ? g_connman->IsBanned(subNet) : g_connman->IsBanned(netAddr))\n+        if (isSubnet ? g_connman->IsBanned(subNet) : g_connman->IsBanned(netAddr)) {\n             throw JSONRPCError(RPC_CLIENT_NODE_ALREADY_ADDED, \"Error: IP/Subnet already banned\");\n+        }\n \n         int64_t banTime = 0; //use standard bantime if not specified\n-        if (!request.params[2].isNull())\n+        if (!request.params[2].isNull()) {\n             banTime = request.params[2].get_int64();\n+        }\n \n-        bool absolute = false;\n-        if (request.params[3].isTrue())\n-            absolute = true;\n+        bool absolute = request.params[3].isTrue();\n \n-        isSubnet ? g_connman->Ban(subNet, BanReasonManuallyAdded, banTime, absolute) : g_connman->Ban(netAddr, BanReasonManuallyAdded, banTime, absolute);\n+        if (isSubnet) {\n+            g_connman->Ban(subNet, BanReasonManuallyAdded, banTime, absolute);\n+        } else {\n+            g_connman->Ban(netAddr, BanReasonManuallyAdded, banTime, absolute);\n+        }\n     }\n     else if(strCommand == \"remove\")\n     {"
      }
    ]
  },
  {
    "sha": "d7d35b3d4c6c5a1ccba25dacc64e4454c2f6ce35",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpkN2QzNWIzZDRjNmM1YTFjY2JhMjVkYWNjNjRlNDQ1NGMyZjZjZTM1",
    "commit": {
      "author": {
        "name": "Marko Bencun",
        "email": "marko.bencun@monetas.net",
        "date": "2017-10-02T07:24:04Z"
      },
      "committer": {
        "name": "Marko Bencun",
        "email": "marko.bencun@monetas.net",
        "date": "2017-10-02T07:24:15Z"
      },
      "message": "Add m_bantime to Connman options\n\nMore work towards a CConnman with no globals, so that we can test\ninstances against themselves.",
      "tree": {
        "sha": "4fdc1e9ca2ddcd561496b262b48a8b6d2b1a5de7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4fdc1e9ca2ddcd561496b262b48a8b6d2b1a5de7"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d7d35b3d4c6c5a1ccba25dacc64e4454c2f6ce35",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d7d35b3d4c6c5a1ccba25dacc64e4454c2f6ce35",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/d7d35b3d4c6c5a1ccba25dacc64e4454c2f6ce35",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d7d35b3d4c6c5a1ccba25dacc64e4454c2f6ce35/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "3a4712c2517d2f707bfd972706cc0802e78b2db7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3a4712c2517d2f707bfd972706cc0802e78b2db7",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/3a4712c2517d2f707bfd972706cc0802e78b2db7"
      }
    ],
    "stats": {
      "total": 10,
      "additions": 8,
      "deletions": 2
    },
    "files": [
      {
        "sha": "1c1bb5a7f9b2d698779cea334f13a55f32c22a08",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 1,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d7d35b3d4c6c5a1ccba25dacc64e4454c2f6ce35/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d7d35b3d4c6c5a1ccba25dacc64e4454c2f6ce35/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=d7d35b3d4c6c5a1ccba25dacc64e4454c2f6ce35",
        "patch": "@@ -1666,7 +1666,10 @@ bool AppInitMain(boost::thread_group& threadGroup, CScheduler& scheduler)\n     connOptions.nSendBufferMaxSize = 1000*gArgs.GetArg(\"-maxsendbuffer\", DEFAULT_MAXSENDBUFFER);\n     connOptions.nReceiveFloodSize = 1000*gArgs.GetArg(\"-maxreceivebuffer\", DEFAULT_MAXRECEIVEBUFFER);\n     connOptions.m_added_nodes = gArgs.GetArgs(\"-addnode\");\n-\n+    connOptions.m_bantime = gArgs.GetArg(\"-bantime\", DEFAULT_MISBEHAVING_BANTIME);\n+    if (connOptions.m_bantime <= 0) {\n+        return InitError(strprintf(_(\"%s cannot be configured with a negative value.\"), \"-bantime\"));\n+    }\n     connOptions.nMaxOutboundTimeframe = nMaxOutboundTimeframe;\n     connOptions.nMaxOutboundLimit = nMaxOutboundLimit;\n "
      },
      {
        "sha": "17d9a561d2c0f93c23ef4a3d1a02fd21e4f14499",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d7d35b3d4c6c5a1ccba25dacc64e4454c2f6ce35/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d7d35b3d4c6c5a1ccba25dacc64e4454c2f6ce35/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=d7d35b3d4c6c5a1ccba25dacc64e4454c2f6ce35",
        "patch": "@@ -534,7 +534,7 @@ void CConnman::Ban(const CSubNet& subNet, const BanReason &banReason, int64_t ba\n     banEntry.banReason = banReason;\n     if (bantimeoffset <= 0)\n     {\n-        bantimeoffset = gArgs.GetArg(\"-bantime\", DEFAULT_MISBEHAVING_BANTIME);\n+        bantimeoffset = m_bantime;\n         sinceUnixEpoch = false;\n     }\n     banEntry.nBanUntil = (sinceUnixEpoch ? 0 : GetTime() )+bantimeoffset;"
      },
      {
        "sha": "a4c30551a59d2b8e6eff7a2cb10c665d9831b7f0",
        "filename": "src/net.h",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d7d35b3d4c6c5a1ccba25dacc64e4454c2f6ce35/src/net.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d7d35b3d4c6c5a1ccba25dacc64e4454c2f6ce35/src/net.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.h?ref=d7d35b3d4c6c5a1ccba25dacc64e4454c2f6ce35",
        "patch": "@@ -148,6 +148,7 @@ class CConnman\n         bool m_use_addrman_outgoing = true;\n         std::vector<std::string> m_specified_outgoing;\n         std::vector<std::string> m_added_nodes;\n+        int64_t m_bantime = DEFAULT_MISBEHAVING_BANTIME;\n     };\n \n     void Init(const Options& connOptions) {\n@@ -166,6 +167,7 @@ class CConnman\n         nMaxOutboundLimit = connOptions.nMaxOutboundLimit;\n         vWhitelistedRange = connOptions.vWhitelistedRange;\n         vAddedNodes = connOptions.m_added_nodes;\n+        m_bantime = connOptions.m_bantime;\n     }\n \n     CConnman(uint64_t seed0, uint64_t seed1);\n@@ -386,6 +388,7 @@ class CConnman\n     std::list<CNode*> vNodesDisconnected;\n     mutable CCriticalSection cs_vNodes;\n     std::atomic<NodeId> nLastNodeId;\n+    int64_t m_bantime;\n \n     /** Services this instance offers */\n     ServiceFlags nLocalServices;"
      }
    ]
  }
]