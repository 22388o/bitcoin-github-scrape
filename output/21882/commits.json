[
  {
    "sha": "e4c8bb62e4a6873c45f42d0d2a24927cb241a0ea",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzplNGM4YmI2MmU0YTY4NzNjNDVmNDJkMGQyYTI0OTI3Y2IyNDFhMGVh",
    "commit": {
      "author": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2021-05-07T16:25:31Z"
      },
      "committer": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2021-07-27T11:53:24Z"
      },
      "message": "build: Fix undefined reference to __mulodi4\n\nWhen compiling with clang on 32-bit systems the __mulodi4 symbol is\ndefined in compiler-rt only.",
      "tree": {
        "sha": "f6bfb6c2aee9a2c527e4207f720f6f372ecaf936",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f6bfb6c2aee9a2c527e4207f720f6f372ecaf936"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e4c8bb62e4a6873c45f42d0d2a24927cb241a0ea",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE0dvyxLlvLev0wWZUQQEIES5+qB8FAmD/87QACgkQQQEIES5+\nqB8Hbw//TtH/cf81qcVykYjuBpiuFZrpbadSfLpYBgHqw5FwpjOWeNFr0IDyno4X\n9btSdBVits8fqxxDcxDZ1xr9DGnrpOP/Zh8W/fUTiuhSvtrE/tSvhruQNgGjR+LV\nceywZauYNQfkWUa4UsJ7PBycz9/VR8FJfQsBAD0V52yKCRO57CIBrqzBs7SDulcr\nrma4UmM4VZBA/a9kiLnrYjWmm7v99shiU2KRNJGQqeoVXqd5xmJsjRz76J3XCKyu\naGJlP/uRopaEr3WHur42/m3BUvsFG3/OWo4dkKtGV1sqiy7XFo6isez1vA2CEi0e\n9uVc1pyDi+Z8qDdU6xOKyfmTNCDS/zrdNEqpjwEpqI7r3oOizl0dr7NL1kgoFiSb\nJbce/d+q7IGScD1pBfHDQv83X7mayizr9kakkS3uUXKsrcC7jfz6xDiMmskBJUwN\nnLsafF/Qo4kAc5a92SDrepHhFHcq4Jk0EJvbZNj/7US2KwtYX77pEQOZmXqWpVw6\n3ErWQIfaXFdApHzQ7a8j3glQEG/BXLG49hkcw6gPfQ6JjvkYtj6a/GcmRJEX7b2e\nlBzqE+A6uDgKjd1Xi/fGeHmoozx8a8DRvVojXhIloUpWhAln3MwOQANgSTkFYLiK\nQaHWMsv54dfRIAN6Ci25G9/IIo6nr+F7EDKega7X9t7/GrOevdU=\n=EhEg\n-----END PGP SIGNATURE-----",
        "payload": "tree f6bfb6c2aee9a2c527e4207f720f6f372ecaf936\nparent 741749a6159eb68dd8a3c5ef0d1701337931e6df\nauthor Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1620404731 +0300\ncommitter Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1627386804 +0300\n\nbuild: Fix undefined reference to __mulodi4\n\nWhen compiling with clang on 32-bit systems the __mulodi4 symbol is\ndefined in compiler-rt only.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e4c8bb62e4a6873c45f42d0d2a24927cb241a0ea",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/e4c8bb62e4a6873c45f42d0d2a24927cb241a0ea",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e4c8bb62e4a6873c45f42d0d2a24927cb241a0ea/comments",
    "author": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "741749a6159eb68dd8a3c5ef0d1701337931e6df",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/741749a6159eb68dd8a3c5ef0d1701337931e6df",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/741749a6159eb68dd8a3c5ef0d1701337931e6df"
      }
    ],
    "stats": {
      "total": 60,
      "additions": 51,
      "deletions": 9
    },
    "files": [
      {
        "sha": "1a6922deca485d466bc042f26bc351c960f12d8d",
        "filename": "build-aux/m4/bitcoin_runtime_lib.m4",
        "status": "added",
        "additions": 42,
        "deletions": 0,
        "changes": 42,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e4c8bb62e4a6873c45f42d0d2a24927cb241a0ea/build-aux/m4/bitcoin_runtime_lib.m4",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e4c8bb62e4a6873c45f42d0d2a24927cb241a0ea/build-aux/m4/bitcoin_runtime_lib.m4",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/build-aux/m4/bitcoin_runtime_lib.m4?ref=e4c8bb62e4a6873c45f42d0d2a24927cb241a0ea",
        "patch": "@@ -0,0 +1,42 @@\n+# On some platforms clang builtin implementations\n+# require compiler-rt as a runtime library to use.\n+#\n+# See:\n+# - https://bugs.llvm.org/show_bug.cgi?id=28629\n+\n+m4_define([_CHECK_RUNTIME_testbody], [[\n+  bool f(long long x, long long y, long long* p)\n+  {\n+    return __builtin_mul_overflow(x, y, p);\n+  }\n+  int main() { return 0; }\n+]])\n+\n+AC_DEFUN([CHECK_RUNTIME_LIB], [\n+\n+  AC_LANG_PUSH([C++])\n+\n+  AC_MSG_CHECKING([for __builtin_mul_overflow])\n+  AC_LINK_IFELSE(\n+    [AC_LANG_SOURCE([_CHECK_RUNTIME_testbody])],\n+    [\n+      AC_MSG_RESULT([yes])\n+      AC_DEFINE([HAVE_BUILTIN_MUL_OVERFLOW], [1], [Define if you have a working __builtin_mul_overflow])\n+    ],\n+    [\n+      ax_check_save_flags=\"$LDFLAGS\"\n+      LDFLAGS=\"$LDFLAGS --rtlib=compiler-rt -lgcc_s\"\n+      AC_LINK_IFELSE(\n+        [AC_LANG_SOURCE([_CHECK_RUNTIME_testbody])],\n+        [\n+          AC_MSG_RESULT([yes, with additional linker flags])\n+          RUNTIME_LDFLAGS=\"--rtlib=compiler-rt -lgcc_s\"\n+          AC_DEFINE([HAVE_BUILTIN_MUL_OVERFLOW], [1], [Define if you have a working __builtin_mul_overflow])\n+        ],\n+        [AC_MSG_RESULT([no])])\n+      LDFLAGS=\"$ax_check_save_flags\"\n+    ])\n+\n+  AC_LANG_POP\n+  AC_SUBST([RUNTIME_LDFLAGS])\n+])"
      },
      {
        "sha": "0a5456acffa17ba92a925947fc068be040acaed8",
        "filename": "configure.ac",
        "status": "modified",
        "additions": 4,
        "deletions": 0,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e4c8bb62e4a6873c45f42d0d2a24927cb241a0ea/configure.ac",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e4c8bb62e4a6873c45f42d0d2a24927cb241a0ea/configure.ac",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/configure.ac?ref=e4c8bb62e4a6873c45f42d0d2a24927cb241a0ea",
        "patch": "@@ -1773,6 +1773,10 @@ if test x$build_bitcoin_wallet$build_bitcoin_cli$build_bitcoin_tx$build_bitcoin_\n   AC_MSG_ERROR([No targets! Please specify at least one of: --with-utils --with-libs --with-daemon --with-gui --enable-bench or --enable-tests])\n fi\n \n+if test x$enable_fuzz_binary = xyes; then\n+  CHECK_RUNTIME_LIB\n+fi\n+\n AM_CONDITIONAL([TARGET_DARWIN], [test x$TARGET_OS = xdarwin])\n AM_CONDITIONAL([BUILD_DARWIN], [test x$BUILD_OS = xdarwin])\n AM_CONDITIONAL([TARGET_LINUX], [test x$TARGET_OS = xlinux])"
      },
      {
        "sha": "15929e7352ecbbabf5d954f2697e03bf5a065d0a",
        "filename": "src/Makefile.test.include",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e4c8bb62e4a6873c45f42d0d2a24927cb241a0ea/src/Makefile.test.include",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e4c8bb62e4a6873c45f42d0d2a24927cb241a0ea/src/Makefile.test.include",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/Makefile.test.include?ref=e4c8bb62e4a6873c45f42d0d2a24927cb241a0ea",
        "patch": "@@ -200,7 +200,7 @@ if ENABLE_FUZZ_BINARY\n test_fuzz_fuzz_CPPFLAGS = $(AM_CPPFLAGS) $(BITCOIN_INCLUDES)\n test_fuzz_fuzz_CXXFLAGS = $(AM_CXXFLAGS) $(PIE_FLAGS)\n test_fuzz_fuzz_LDADD = $(FUZZ_SUITE_LD_COMMON)\n-test_fuzz_fuzz_LDFLAGS = $(FUZZ_SUITE_LDFLAGS_COMMON)\n+test_fuzz_fuzz_LDFLAGS = $(FUZZ_SUITE_LDFLAGS_COMMON) $(RUNTIME_LDFLAGS)\n test_fuzz_fuzz_SOURCES = \\\n  test/fuzz/addition_overflow.cpp \\\n  test/fuzz/addrdb.cpp \\"
      },
      {
        "sha": "c7251650c258031391722f2121e428f5c539fd20",
        "filename": "src/test/fuzz/multiplication_overflow.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 8,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e4c8bb62e4a6873c45f42d0d2a24927cb241a0ea/src/test/fuzz/multiplication_overflow.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e4c8bb62e4a6873c45f42d0d2a24927cb241a0ea/src/test/fuzz/multiplication_overflow.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/fuzz/multiplication_overflow.cpp?ref=e4c8bb62e4a6873c45f42d0d2a24927cb241a0ea",
        "patch": "@@ -2,6 +2,10 @@\n // Distributed under the MIT software license, see the accompanying\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n #include <test/fuzz/FuzzedDataProvider.h>\n #include <test/fuzz/fuzz.h>\n #include <test/fuzz/util.h>\n@@ -10,14 +14,6 @@\n #include <string>\n #include <vector>\n \n-#if defined(__has_builtin)\n-#if __has_builtin(__builtin_mul_overflow)\n-#define HAVE_BUILTIN_MUL_OVERFLOW\n-#endif\n-#elif defined(__GNUC__)\n-#define HAVE_BUILTIN_MUL_OVERFLOW\n-#endif\n-\n namespace {\n template <typename T>\n void TestMultiplicationOverflow(FuzzedDataProvider& fuzzed_data_provider)"
      }
    ]
  }
]