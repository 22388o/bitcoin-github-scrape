[
  {
    "sha": "6293a9f87f8883fecb18042681407d1de6c20485",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo2MjkzYTlmODdmODg4M2ZlY2IxODA0MjY4MTQwN2QxZGU2YzIwNDg1",
    "commit": {
      "author": {
        "name": "Gavin Andresen",
        "email": "gavinandresen@gmail.com",
        "date": "2012-03-29T17:34:07Z"
      },
      "committer": {
        "name": "Gavin Andresen",
        "email": "gavinandresen@gmail.com",
        "date": "2012-03-29T17:34:07Z"
      },
      "message": "Workaround hangs when upgrading old addr.dat files",
      "tree": {
        "sha": "7f83267abe52c5b3f50ebc3cfc61c11c0da37c45",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7f83267abe52c5b3f50ebc3cfc61c11c0da37c45"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6293a9f87f8883fecb18042681407d1de6c20485",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6293a9f87f8883fecb18042681407d1de6c20485",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/6293a9f87f8883fecb18042681407d1de6c20485",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6293a9f87f8883fecb18042681407d1de6c20485/comments",
    "author": {
      "login": "gavinandresen",
      "id": 331997,
      "node_id": "MDQ6VXNlcjMzMTk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/331997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gavinandresen",
      "html_url": "https://github.com/gavinandresen",
      "followers_url": "https://api.github.com/users/gavinandresen/followers",
      "following_url": "https://api.github.com/users/gavinandresen/following{/other_user}",
      "gists_url": "https://api.github.com/users/gavinandresen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gavinandresen/subscriptions",
      "organizations_url": "https://api.github.com/users/gavinandresen/orgs",
      "repos_url": "https://api.github.com/users/gavinandresen/repos",
      "events_url": "https://api.github.com/users/gavinandresen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gavinandresen/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "gavinandresen",
      "id": 331997,
      "node_id": "MDQ6VXNlcjMzMTk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/331997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gavinandresen",
      "html_url": "https://github.com/gavinandresen",
      "followers_url": "https://api.github.com/users/gavinandresen/followers",
      "following_url": "https://api.github.com/users/gavinandresen/following{/other_user}",
      "gists_url": "https://api.github.com/users/gavinandresen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gavinandresen/subscriptions",
      "organizations_url": "https://api.github.com/users/gavinandresen/orgs",
      "repos_url": "https://api.github.com/users/gavinandresen/repos",
      "events_url": "https://api.github.com/users/gavinandresen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gavinandresen/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "83e914c1d5a0d46461bbc04ad0224ff7151fb323",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/83e914c1d5a0d46461bbc04ad0224ff7151fb323",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/83e914c1d5a0d46461bbc04ad0224ff7151fb323"
      }
    ],
    "stats": {
      "total": 33,
      "additions": 11,
      "deletions": 22
    },
    "files": [
      {
        "sha": "79c4e4778fb9b9ef188891e6e96b4b6cd8ae1e9f",
        "filename": "src/db.cpp",
        "status": "modified",
        "additions": 11,
        "deletions": 22,
        "changes": 33,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6293a9f87f8883fecb18042681407d1de6c20485/src/db.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6293a9f87f8883fecb18042681407d1de6c20485/src/db.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/db.cpp?ref=6293a9f87f8883fecb18042681407d1de6c20485",
        "patch": "@@ -722,12 +722,13 @@ bool CAddrDB::WriteAddrman(const CAddrMan& addrman)\n \n bool CAddrDB::LoadAddresses()\n {\n-    bool fAddrMan = false;\n     if (Read(string(\"addrman\"), addrman))\n     {\n         printf(\"Loaded %i addresses\\n\", addrman.size());\n-        fAddrMan = true;\n+        return true;\n     }\n+    \n+    // Read pre-0.6 addr records\n \n     vector<CAddress> vAddr;\n     vector<vector<unsigned char> > vDelete;\n@@ -753,31 +754,19 @@ bool CAddrDB::LoadAddresses()\n         ssKey >> strType;\n         if (strType == \"addr\")\n         {\n-            if (fAddrMan)\n-            {\n-                vector<unsigned char> vchKey;\n-                ssKey >> vchKey;\n-                vDelete.push_back(vchKey);\n-            }\n-            else\n-            {\n-                CAddress addr;\n-                ssValue >> addr;\n-                vAddr.push_back(addr);\n-            }\n-\n+            CAddress addr;\n+            ssValue >> addr;\n+            vAddr.push_back(addr);\n         }\n     }\n     pcursor->close();\n \n-    BOOST_FOREACH(const vector<unsigned char> &vchKey, vDelete)\n-        Erase(make_pair(string(\"addr\"), vchKey));\n+    addrman.Add(vAddr, CNetAddr(\"0.0.0.0\"));\n+    printf(\"Loaded %i addresses\\n\", addrman.size());\n \n-    if (!fAddrMan)\n-    {\n-        addrman.Add(vAddr, CNetAddr(\"0.0.0.0\"));\n-        printf(\"Loaded %i addresses\\n\", addrman.size());\n-    }\n+    // Note: old records left; we ran into hangs-on-startup\n+    // bugs for some users who (we think) were running after\n+    // an unclean shutdown.\n \n     return true;\n }"
      }
    ]
  }
]