[
  {
    "sha": "90ba2df11b5bc943ac48b49b5da8023864dc842d",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5MGJhMmRmMTFiNWJjOTQzYWM0OGI0OWI1ZGE4MDIzODY0ZGM4NDJk",
    "commit": {
      "author": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2018-01-28T19:15:18Z"
      },
      "committer": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2018-01-31T03:49:22Z"
      },
      "message": "Fix missing cs_main lock for GuessVerificationProgress()",
      "tree": {
        "sha": "b5d52238deaabf843c6ee404fe7a632db3f20395",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b5d52238deaabf843c6ee404fe7a632db3f20395"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/90ba2df11b5bc943ac48b49b5da8023864dc842d",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEyhopCNzi8TB0xizeHrd2uwPHki0FAlpxPMMACgkQHrd2uwPH\nki2Hew/9GX5jWnaWrFJnKpbnIp1YJHpPDsv5WuWNCurLB3muLdpQeK1t6UOJS+gM\n2BOuQ1Wdy3TwH5AJJI8D5dCa+icdXKPqio2VEZhzcNbIyV+nVY3l7dTU8XjaKzpX\nxvxTYS5iPtECQvkj9vmWdBQxEQPhilb77kiYXEsIp1o4QIfWYCGQ/7uSIY5mZWdz\nCkRP82c9m6+RAqVQUYCUR3/HVmFr/Ryp8goBjuFDxtpunt7nxCgBsSP1oKtY+GPg\n5/D28hB0o3Mu+4LdIyhiINUQKqtEAp865XlZC3kgKfE5DV+gJxI0yOpzMw/d2oA3\nC2YRYW0J9GJ3/hrdGTl2ob4lq2I7siJwhcvmLptFKzKz8Axgi6e8/PNgSPuutEzb\nfETqfl2ChSS82OVSflbEA+TRX2ARERMtMfPqYzGHkFZd5XUwNuazrZ+ciVyqOCws\n9twY//u9Wp/gByKshF9vKVuipaGET4LNFuIzxjLiLH7YAwLTkM6g7rzM5te4KmCa\n7YvWiDlIrkpnjfEIdrZYvqp9n8T1NYrIZdMxAVQPZ1G0g/mwdT31w6vI9KOPDPWE\nWI0mDfDOWFC253JDSOaGKlVWH5H5gTVbsEZEWXK7/d2p/4TlnX6aKd819dyHBSH4\npjYy+mjvNdNte3PEl9qb8PfDnRr7B75IavZ3fVK1F6PD3qNt2fs=\n=RDTg\n-----END PGP SIGNATURE-----",
        "payload": "tree b5d52238deaabf843c6ee404fe7a632db3f20395\nparent 6970b30c6f1d2be7947295fe18f2390649b17a4b\nauthor Jonas Schnelli <dev@jonasschnelli.ch> 1517166918 -1000\ncommitter Jonas Schnelli <dev@jonasschnelli.ch> 1517370562 -1000\n\nFix missing cs_main lock for GuessVerificationProgress()\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/90ba2df11b5bc943ac48b49b5da8023864dc842d",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/90ba2df11b5bc943ac48b49b5da8023864dc842d",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/90ba2df11b5bc943ac48b49b5da8023864dc842d/comments",
    "author": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "6970b30c6f1d2be7947295fe18f2390649b17a4b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6970b30c6f1d2be7947295fe18f2390649b17a4b",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/6970b30c6f1d2be7947295fe18f2390649b17a4b"
      }
    ],
    "stats": {
      "total": 15,
      "additions": 6,
      "deletions": 9
    },
    "files": [
      {
        "sha": "eaf2896bc38b3ef2cd4307375d31af80aa203043",
        "filename": "src/qt/clientmodel.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/90ba2df11b5bc943ac48b49b5da8023864dc842d/src/qt/clientmodel.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/90ba2df11b5bc943ac48b49b5da8023864dc842d/src/qt/clientmodel.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/clientmodel.cpp?ref=90ba2df11b5bc943ac48b49b5da8023864dc842d",
        "patch": "@@ -138,9 +138,9 @@ size_t ClientModel::getMempoolDynamicUsage() const\n double ClientModel::getVerificationProgress(const CBlockIndex *tipIn) const\n {\n     CBlockIndex *tip = const_cast<CBlockIndex *>(tipIn);\n+    LOCK(cs_main);\n     if (!tip)\n     {\n-        LOCK(cs_main);\n         tip = chainActive.Tip();\n     }\n     return GuessVerificationProgress(Params().TxData(), tip);"
      },
      {
        "sha": "289313b55ce626b59579f393e36f2452be7a55ae",
        "filename": "src/validation.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/90ba2df11b5bc943ac48b49b5da8023864dc842d/src/validation.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/90ba2df11b5bc943ac48b49b5da8023864dc842d/src/validation.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/validation.cpp?ref=90ba2df11b5bc943ac48b49b5da8023864dc842d",
        "patch": "@@ -4659,6 +4659,7 @@ bool DumpMempool(void)\n }\n \n //! Guess how far we are in the verification process at the given block index\n+//! require cs_main if pindex has not been validated yet (because nChainTx might be unset)\n double GuessVerificationProgress(const ChainTxData& data, const CBlockIndex *pindex) {\n     if (pindex == nullptr)\n         return 0.0;"
      },
      {
        "sha": "31894dff14340cf02a259edc20d81adbea29b1ba",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 8,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/90ba2df11b5bc943ac48b49b5da8023864dc842d/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/90ba2df11b5bc943ac48b49b5da8023864dc842d/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=90ba2df11b5bc943ac48b49b5da8023864dc842d",
        "patch": "@@ -1673,20 +1673,15 @@ CBlockIndex* CWallet::ScanForWalletTransactions(CBlockIndex* pindexStart, CBlock\n             dProgressStart = GuessVerificationProgress(chainParams.TxData(), pindex);\n             dProgressTip = GuessVerificationProgress(chainParams.TxData(), tip);\n         }\n+        double gvp = dProgressStart;\n         while (pindex && !fAbortRescan)\n         {\n             if (pindex->nHeight % 100 == 0 && dProgressTip - dProgressStart > 0.0) {\n-                double gvp = 0;\n-                {\n-                    LOCK(cs_main);\n-                    gvp = GuessVerificationProgress(chainParams.TxData(), pindex);\n-                }\n                 ShowProgress(_(\"Rescanning...\"), std::max(1, std::min(99, (int)((gvp - dProgressStart) / (dProgressTip - dProgressStart) * 100))));\n             }\n             if (GetTime() >= nNow + 60) {\n                 nNow = GetTime();\n-                LOCK(cs_main);\n-                LogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", pindex->nHeight, GuessVerificationProgress(chainParams.TxData(), pindex));\n+                LogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", pindex->nHeight, gvp);\n             }\n \n             CBlock block;\n@@ -1710,6 +1705,7 @@ CBlockIndex* CWallet::ScanForWalletTransactions(CBlockIndex* pindexStart, CBlock\n             {\n                 LOCK(cs_main);\n                 pindex = chainActive.Next(pindex);\n+                gvp = GuessVerificationProgress(chainParams.TxData(), pindex);\n                 if (tip != chainActive.Tip()) {\n                     tip = chainActive.Tip();\n                     // in case the tip has changed, update progress max\n@@ -1718,7 +1714,7 @@ CBlockIndex* CWallet::ScanForWalletTransactions(CBlockIndex* pindexStart, CBlock\n             }\n         }\n         if (pindex && fAbortRescan) {\n-            LogPrintf(\"Rescan aborted at block %d. Progress=%f\\n\", pindex->nHeight, GuessVerificationProgress(chainParams.TxData(), pindex));\n+            LogPrintf(\"Rescan aborted at block %d. Progress=%f\\n\", pindex->nHeight, gvp);\n         }\n         ShowProgress(_(\"Rescanning...\"), 100); // hide progress dialog in GUI\n     }"
      }
    ]
  }
]