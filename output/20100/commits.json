[
  {
    "sha": "39987fdb5129dd9c2c44c2282d88008125f455c5",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozOTk4N2ZkYjUxMjlkZDljMmM0NGMyMjgyZDg4MDA4MTI1ZjQ1NWM1",
    "commit": {
      "author": {
        "name": "sanket1729",
        "email": "sanket1729@gmail.com",
        "date": "2020-10-07T10:53:52Z"
      },
      "committer": {
        "name": "sanket1729",
        "email": "sanket1729@gmail.com",
        "date": "2021-01-26T03:22:06Z"
      },
      "message": "Separate error code for Segwit CleanStack\n\nCleanStack rule is consensus enforced in Segwitv0.\nSee discussion in #20006 for motivation",
      "tree": {
        "sha": "2c199736febed3fb7ab7c2547f443a3b9ea75c5f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2c199736febed3fb7ab7c2547f443a3b9ea75c5f"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/39987fdb5129dd9c2c44c2282d88008125f455c5",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/39987fdb5129dd9c2c44c2282d88008125f455c5",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/39987fdb5129dd9c2c44c2282d88008125f455c5",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/39987fdb5129dd9c2c44c2282d88008125f455c5/comments",
    "author": {
      "login": "sanket1729",
      "id": 6881849,
      "node_id": "MDQ6VXNlcjY4ODE4NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6881849?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sanket1729",
      "html_url": "https://github.com/sanket1729",
      "followers_url": "https://api.github.com/users/sanket1729/followers",
      "following_url": "https://api.github.com/users/sanket1729/following{/other_user}",
      "gists_url": "https://api.github.com/users/sanket1729/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sanket1729/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sanket1729/subscriptions",
      "organizations_url": "https://api.github.com/users/sanket1729/orgs",
      "repos_url": "https://api.github.com/users/sanket1729/repos",
      "events_url": "https://api.github.com/users/sanket1729/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sanket1729/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sanket1729",
      "id": 6881849,
      "node_id": "MDQ6VXNlcjY4ODE4NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6881849?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sanket1729",
      "html_url": "https://github.com/sanket1729",
      "followers_url": "https://api.github.com/users/sanket1729/followers",
      "following_url": "https://api.github.com/users/sanket1729/following{/other_user}",
      "gists_url": "https://api.github.com/users/sanket1729/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sanket1729/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sanket1729/subscriptions",
      "organizations_url": "https://api.github.com/users/sanket1729/orgs",
      "repos_url": "https://api.github.com/users/sanket1729/repos",
      "events_url": "https://api.github.com/users/sanket1729/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sanket1729/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "16ae3368f2a20cffa312b6ee9b724c1e302ca5fb",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/16ae3368f2a20cffa312b6ee9b724c1e302ca5fb",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/16ae3368f2a20cffa312b6ee9b724c1e302ca5fb"
      }
    ],
    "stats": {
      "total": 70,
      "additions": 55,
      "deletions": 15
    },
    "files": [
      {
        "sha": "ac2548d1f5e0ddd1cac4d0d0ce955b6287cb424c",
        "filename": "src/script/interpreter.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/39987fdb5129dd9c2c44c2282d88008125f455c5/src/script/interpreter.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/39987fdb5129dd9c2c44c2282d88008125f455c5/src/script/interpreter.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/script/interpreter.cpp?ref=39987fdb5129dd9c2c44c2282d88008125f455c5",
        "patch": "@@ -1826,7 +1826,7 @@ static bool ExecuteWitnessScript(const Span<const valtype>& stack_span, const CS\n     if (!EvalScript(stack, scriptPubKey, flags, checker, sigversion, execdata, serror)) return false;\n \n     // Scripts inside witness implicitly require cleanstack behaviour\n-    if (stack.size() != 1) return set_error(serror, SCRIPT_ERR_CLEANSTACK);\n+    if (stack.size() != 1) return set_error(serror, SCRIPT_ERR_WITNESS_CLEANSTACK);\n     if (!CastToBool(stack.back())) return set_error(serror, SCRIPT_ERR_EVAL_FALSE);\n     return true;\n }"
      },
      {
        "sha": "4cf0ab25630f9bbe0daf4db96a9af4df995589b3",
        "filename": "src/script/script_error.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/39987fdb5129dd9c2c44c2282d88008125f455c5/src/script/script_error.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/39987fdb5129dd9c2c44c2282d88008125f455c5/src/script/script_error.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/script/script_error.cpp?ref=39987fdb5129dd9c2c44c2282d88008125f455c5",
        "patch": "@@ -111,6 +111,8 @@ std::string ScriptErrorString(const ScriptError serror)\n             return \"OP_CHECKMULTISIG(VERIFY) is not available in tapscript\";\n         case SCRIPT_ERR_TAPSCRIPT_MINIMALIF:\n             return \"OP_IF/NOTIF argument must be minimal in tapscript\";\n+        case SCRIPT_ERR_WITNESS_CLEANSTACK:\n+            return \"Stack size must be exactly one after execution in segwit scripts\";\n         case SCRIPT_ERR_OP_CODESEPARATOR:\n             return \"Using OP_CODESEPARATOR in non-witness script\";\n         case SCRIPT_ERR_SIG_FINDANDDELETE:"
      },
      {
        "sha": "0a7dc45a8b3c6f773bf15af56c716a0b2ed76762",
        "filename": "src/script/script_error.h",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/39987fdb5129dd9c2c44c2282d88008125f455c5/src/script/script_error.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/39987fdb5129dd9c2c44c2282d88008125f455c5/src/script/script_error.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/script/script_error.h?ref=39987fdb5129dd9c2c44c2282d88008125f455c5",
        "patch": "@@ -68,6 +68,7 @@ typedef enum ScriptError_t\n     SCRIPT_ERR_WITNESS_MALLEATED_P2SH,\n     SCRIPT_ERR_WITNESS_UNEXPECTED,\n     SCRIPT_ERR_WITNESS_PUBKEYTYPE,\n+    SCRIPT_ERR_WITNESS_CLEANSTACK,\n \n     /* Taproot */\n     SCRIPT_ERR_SCHNORR_SIG_SIZE,"
      },
      {
        "sha": "3bd48c814ec4436d6e233d62b5c38bd8b1ccde7b",
        "filename": "src/test/data/script_tests.json",
        "status": "modified",
        "additions": 42,
        "deletions": 14,
        "changes": 56,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/39987fdb5129dd9c2c44c2282d88008125f455c5/src/test/data/script_tests.json",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/39987fdb5129dd9c2c44c2282d88008125f455c5/src/test/data/script_tests.json",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/data/script_tests.json?ref=39987fdb5129dd9c2c44c2282d88008125f455c5",
        "patch": "@@ -2252,6 +2252,34 @@\n     \"Basic P2SH(P2WPKH)\"\n ],\n \n+[\"Testing Clean stack for witness scripts\"],\n+[\n+    [\n+        \"11\",\n+        \"304402204256146fcf8e73b0fd817ffa2a4e408ff0418ff987dd08a4f485b62546f6c43c02203f3c8c3e2febc051e1222867f5f9d0eaf039d6792911c10940aa3cc74123378e01\",\n+        \"210279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798ac\",\n+        0.00000001\n+    ],\n+    \"\",\n+    \"0 0x20 0x1863143c14c5166804bd19203356da136c985678cd4d27a1b8c6329604903262\",\n+    \"P2SH,WITNESS\",\n+    \"WITNESS_CLEANSTACK\",\n+    \"Basic P2WSH with unnecessary input\"\n+],\n+[\n+    [\n+        \"11\",\n+        \"304402203a549090cc46bce1e5e95c4922ea2c12747988e0207b04c42f81cdbe87bb1539022050f57a245b875fd5119c419aaf050bcdf41384f0765f04b809e5bced1fe7093d01\",\n+        \"210279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798ac\",\n+        0.00000001\n+    ],\n+    \"0x22 0x00201863143c14c5166804bd19203356da136c985678cd4d27a1b8c6329604903262\",\n+    \"HASH160 0x14 0xe4300531190587e3880d4c3004f5355d88ff928d EQUAL\",\n+    \"P2SH,WITNESS\",\n+    \"WITNESS_CLEANSTACK\",\n+    \"Basic P2SH(P2WSH) with unnecessary input\"\n+],\n+\n [\"Testing P2WSH multisig with compressed keys\"],\n [\n     [\n@@ -2554,24 +2582,24 @@\n [[\"01\", \"635168\", 0.00000001], \"\", \"0 0x20 0xc7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"P2SH,WITNESS\", \"OK\"],\n [[\"02\", \"635168\", 0.00000001], \"\", \"0 0x20 0xc7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"P2SH,WITNESS\", \"OK\"],\n [[\"0100\", \"635168\", 0.00000001], \"\", \"0 0x20 0xc7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"P2SH,WITNESS\", \"OK\"],\n-[[\"\", \"635168\", 0.00000001], \"\", \"0 0x20 0xc7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"P2SH,WITNESS\", \"CLEANSTACK\"],\n-[[\"00\", \"635168\", 0.00000001], \"\", \"0 0x20 0xc7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"P2SH,WITNESS\", \"CLEANSTACK\"],\n+[[\"\", \"635168\", 0.00000001], \"\", \"0 0x20 0xc7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"P2SH,WITNESS\", \"WITNESS_CLEANSTACK\"],\n+[[\"00\", \"635168\", 0.00000001], \"\", \"0 0x20 0xc7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"P2SH,WITNESS\", \"WITNESS_CLEANSTACK\"],\n [[\"01\", \"635168\", 0.00000001], \"\", \"0 0x20 0xc7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"P2SH,WITNESS,MINIMALIF\", \"OK\"],\n [[\"02\", \"635168\", 0.00000001], \"\", \"0 0x20 0xc7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"P2SH,WITNESS,MINIMALIF\", \"MINIMALIF\"],\n [[\"0100\", \"635168\", 0.00000001], \"\", \"0 0x20 0xc7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"P2SH,WITNESS,MINIMALIF\", \"MINIMALIF\"],\n-[[\"\", \"635168\", 0.00000001], \"\", \"0 0x20 0xc7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"P2SH,WITNESS,MINIMALIF\", \"CLEANSTACK\"],\n [[\"00\", \"635168\", 0.00000001], \"\", \"0 0x20 0xc7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"P2SH,WITNESS,MINIMALIF\", \"MINIMALIF\"],\n+[[\"\", \"635168\", 0.00000001], \"\", \"0 0x20 0xc7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"P2SH,WITNESS,MINIMALIF\", \"WITNESS_CLEANSTACK\"],\n [[\"635168\", 0.00000001], \"\", \"0 0x20 0xc7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"P2SH,WITNESS\", \"UNBALANCED_CONDITIONAL\"],\n [[\"635168\", 0.00000001], \"\", \"0 0x20 0xc7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"P2SH,WITNESS,MINIMALIF\", \"UNBALANCED_CONDITIONAL\"],\n [\"P2WSH NOTIF 1 ENDIF\"],\n-[[\"01\", \"645168\", 0.00000001], \"\", \"0 0x20 0xf913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"P2SH,WITNESS\", \"CLEANSTACK\"],\n-[[\"02\", \"645168\", 0.00000001], \"\", \"0 0x20 0xf913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"P2SH,WITNESS\", \"CLEANSTACK\"],\n-[[\"0100\", \"645168\", 0.00000001], \"\", \"0 0x20 0xf913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"P2SH,WITNESS\", \"CLEANSTACK\"],\n+[[\"01\", \"645168\", 0.00000001], \"\", \"0 0x20 0xf913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"P2SH,WITNESS\", \"WITNESS_CLEANSTACK\"],\n+[[\"02\", \"645168\", 0.00000001], \"\", \"0 0x20 0xf913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"P2SH,WITNESS\", \"WITNESS_CLEANSTACK\"],\n+[[\"0100\", \"645168\", 0.00000001], \"\", \"0 0x20 0xf913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"P2SH,WITNESS\", \"WITNESS_CLEANSTACK\"],\n [[\"\", \"645168\", 0.00000001], \"\", \"0 0x20 0xf913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"P2SH,WITNESS\", \"OK\"],\n [[\"00\", \"645168\", 0.00000001], \"\", \"0 0x20 0xf913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"P2SH,WITNESS\", \"OK\"],\n-[[\"01\", \"645168\", 0.00000001], \"\", \"0 0x20 0xf913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"P2SH,WITNESS,MINIMALIF\", \"CLEANSTACK\"],\n [[\"02\", \"645168\", 0.00000001], \"\", \"0 0x20 0xf913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"P2SH,WITNESS,MINIMALIF\", \"MINIMALIF\"],\n [[\"0100\", \"645168\", 0.00000001], \"\", \"0 0x20 0xf913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"P2SH,WITNESS,MINIMALIF\", \"MINIMALIF\"],\n+[[\"01\", \"645168\", 0.00000001], \"\", \"0 0x20 0xf913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"P2SH,WITNESS,MINIMALIF\", \"WITNESS_CLEANSTACK\"],\n [[\"\", \"645168\", 0.00000001], \"\", \"0 0x20 0xf913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"P2SH,WITNESS,MINIMALIF\", \"OK\"],\n [[\"00\", \"645168\", 0.00000001], \"\", \"0 0x20 0xf913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"P2SH,WITNESS,MINIMALIF\", \"MINIMALIF\"],\n [[\"645168\", 0.00000001], \"\", \"0 0x20 0xf913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"P2SH,WITNESS\", \"UNBALANCED_CONDITIONAL\"],\n@@ -2583,24 +2611,24 @@\n [[\"01\", \"635168\", 0.00000001], \"0x22 0x0020c7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"HASH160 0x14 0x9b27ee6d9010c21bf837b334d043be5d150e7ba7 EQUAL\", \"P2SH,WITNESS\", \"OK\"],\n [[\"02\", \"635168\", 0.00000001], \"0x22 0x0020c7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"HASH160 0x14 0x9b27ee6d9010c21bf837b334d043be5d150e7ba7 EQUAL\", \"P2SH,WITNESS\", \"OK\"],\n [[\"0100\", \"635168\", 0.00000001], \"0x22 0x0020c7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"HASH160 0x14 0x9b27ee6d9010c21bf837b334d043be5d150e7ba7 EQUAL\", \"P2SH,WITNESS\", \"OK\"],\n-[[\"\", \"635168\", 0.00000001], \"0x22 0x0020c7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"HASH160 0x14 0x9b27ee6d9010c21bf837b334d043be5d150e7ba7 EQUAL\", \"P2SH,WITNESS\", \"CLEANSTACK\"],\n-[[\"00\", \"635168\", 0.00000001], \"0x22 0x0020c7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"HASH160 0x14 0x9b27ee6d9010c21bf837b334d043be5d150e7ba7 EQUAL\", \"P2SH,WITNESS\", \"CLEANSTACK\"],\n+[[\"\", \"635168\", 0.00000001], \"0x22 0x0020c7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"HASH160 0x14 0x9b27ee6d9010c21bf837b334d043be5d150e7ba7 EQUAL\", \"P2SH,WITNESS\", \"WITNESS_CLEANSTACK\"],\n+[[\"00\", \"635168\", 0.00000001], \"0x22 0x0020c7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"HASH160 0x14 0x9b27ee6d9010c21bf837b334d043be5d150e7ba7 EQUAL\", \"P2SH,WITNESS\", \"WITNESS_CLEANSTACK\"],\n [[\"01\", \"635168\", 0.00000001], \"0x22 0x0020c7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"HASH160 0x14 0x9b27ee6d9010c21bf837b334d043be5d150e7ba7 EQUAL\", \"P2SH,WITNESS,MINIMALIF\", \"OK\"],\n [[\"02\", \"635168\", 0.00000001], \"0x22 0x0020c7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"HASH160 0x14 0x9b27ee6d9010c21bf837b334d043be5d150e7ba7 EQUAL\", \"P2SH,WITNESS,MINIMALIF\", \"MINIMALIF\"],\n [[\"0100\", \"635168\", 0.00000001], \"0x22 0x0020c7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"HASH160 0x14 0x9b27ee6d9010c21bf837b334d043be5d150e7ba7 EQUAL\", \"P2SH,WITNESS,MINIMALIF\", \"MINIMALIF\"],\n-[[\"\", \"635168\", 0.00000001], \"0x22 0x0020c7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"HASH160 0x14 0x9b27ee6d9010c21bf837b334d043be5d150e7ba7 EQUAL\", \"P2SH,WITNESS,MINIMALIF\", \"CLEANSTACK\"],\n [[\"00\", \"635168\", 0.00000001], \"0x22 0x0020c7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"HASH160 0x14 0x9b27ee6d9010c21bf837b334d043be5d150e7ba7 EQUAL\", \"P2SH,WITNESS,MINIMALIF\", \"MINIMALIF\"],\n+[[\"\", \"635168\", 0.00000001], \"0x22 0x0020c7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"HASH160 0x14 0x9b27ee6d9010c21bf837b334d043be5d150e7ba7 EQUAL\", \"P2SH,WITNESS,MINIMALIF\", \"WITNESS_CLEANSTACK\"],\n [[\"635168\", 0.00000001], \"0x22 0x0020c7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"HASH160 0x14 0x9b27ee6d9010c21bf837b334d043be5d150e7ba7 EQUAL\", \"P2SH,WITNESS\", \"UNBALANCED_CONDITIONAL\"],\n [[\"635168\", 0.00000001], \"0x22 0x0020c7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"HASH160 0x14 0x9b27ee6d9010c21bf837b334d043be5d150e7ba7 EQUAL\", \"P2SH,WITNESS,MINIMALIF\", \"UNBALANCED_CONDITIONAL\"],\n [\"P2SH-P2WSH NOTIF 1 ENDIF\"],\n-[[\"01\", \"645168\", 0.00000001], \"0x22 0x0020f913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"HASH160 0x14 0xdbb7d1c0a56b7a9c423300c8cca6e6e065baf1dc EQUAL\", \"P2SH,WITNESS\", \"CLEANSTACK\"],\n-[[\"02\", \"645168\", 0.00000001], \"0x22 0x0020f913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"HASH160 0x14 0xdbb7d1c0a56b7a9c423300c8cca6e6e065baf1dc EQUAL\", \"P2SH,WITNESS\", \"CLEANSTACK\"],\n-[[\"0100\", \"645168\", 0.00000001], \"0x22 0x0020f913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"HASH160 0x14 0xdbb7d1c0a56b7a9c423300c8cca6e6e065baf1dc EQUAL\", \"P2SH,WITNESS\", \"CLEANSTACK\"],\n+[[\"01\", \"645168\", 0.00000001], \"0x22 0x0020f913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"HASH160 0x14 0xdbb7d1c0a56b7a9c423300c8cca6e6e065baf1dc EQUAL\", \"P2SH,WITNESS\", \"WITNESS_CLEANSTACK\"],\n+[[\"02\", \"645168\", 0.00000001], \"0x22 0x0020f913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"HASH160 0x14 0xdbb7d1c0a56b7a9c423300c8cca6e6e065baf1dc EQUAL\", \"P2SH,WITNESS\", \"WITNESS_CLEANSTACK\"],\n+[[\"0100\", \"645168\", 0.00000001], \"0x22 0x0020f913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"HASH160 0x14 0xdbb7d1c0a56b7a9c423300c8cca6e6e065baf1dc EQUAL\", \"P2SH,WITNESS\", \"WITNESS_CLEANSTACK\"],\n [[\"\", \"645168\", 0.00000001], \"0x22 0x0020f913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"HASH160 0x14 0xdbb7d1c0a56b7a9c423300c8cca6e6e065baf1dc EQUAL\", \"P2SH,WITNESS\", \"OK\"],\n [[\"00\", \"645168\", 0.00000001], \"0x22 0x0020f913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"HASH160 0x14 0xdbb7d1c0a56b7a9c423300c8cca6e6e065baf1dc EQUAL\", \"P2SH,WITNESS\", \"OK\"],\n-[[\"01\", \"645168\", 0.00000001], \"0x22 0x0020f913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"HASH160 0x14 0xdbb7d1c0a56b7a9c423300c8cca6e6e065baf1dc EQUAL\", \"P2SH,WITNESS,MINIMALIF\", \"CLEANSTACK\"],\n [[\"02\", \"645168\", 0.00000001], \"0x22 0x0020f913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"HASH160 0x14 0xdbb7d1c0a56b7a9c423300c8cca6e6e065baf1dc EQUAL\", \"P2SH,WITNESS,MINIMALIF\", \"MINIMALIF\"],\n [[\"0100\", \"645168\", 0.00000001], \"0x22 0x0020f913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"HASH160 0x14 0xdbb7d1c0a56b7a9c423300c8cca6e6e065baf1dc EQUAL\", \"P2SH,WITNESS,MINIMALIF\", \"MINIMALIF\"],\n+[[\"01\", \"645168\", 0.00000001], \"0x22 0x0020f913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"HASH160 0x14 0xdbb7d1c0a56b7a9c423300c8cca6e6e065baf1dc EQUAL\", \"P2SH,WITNESS,MINIMALIF\", \"WITNESS_CLEANSTACK\"],\n [[\"\", \"645168\", 0.00000001], \"0x22 0x0020f913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"HASH160 0x14 0xdbb7d1c0a56b7a9c423300c8cca6e6e065baf1dc EQUAL\", \"P2SH,WITNESS,MINIMALIF\", \"OK\"],\n [[\"00\", \"645168\", 0.00000001], \"0x22 0x0020f913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"HASH160 0x14 0xdbb7d1c0a56b7a9c423300c8cca6e6e065baf1dc EQUAL\", \"P2SH,WITNESS,MINIMALIF\", \"MINIMALIF\"],\n [[\"645168\", 0.00000001], \"0x22 0x0020f913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"HASH160 0x14 0xdbb7d1c0a56b7a9c423300c8cca6e6e065baf1dc EQUAL\", \"P2SH,WITNESS\", \"UNBALANCED_CONDITIONAL\"],"
      },
      {
        "sha": "977ae6424c031bacb1f734f93a1a4704f85bf45c",
        "filename": "src/test/script_tests.cpp",
        "status": "modified",
        "additions": 9,
        "deletions": 0,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/39987fdb5129dd9c2c44c2282d88008125f455c5/src/test/script_tests.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/39987fdb5129dd9c2c44c2282d88008125f455c5/src/test/script_tests.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/script_tests.cpp?ref=39987fdb5129dd9c2c44c2282d88008125f455c5",
        "patch": "@@ -100,6 +100,7 @@ static ScriptErrorDesc script_errors[]={\n     {SCRIPT_ERR_WITNESS_MALLEATED_P2SH, \"WITNESS_MALLEATED_P2SH\"},\n     {SCRIPT_ERR_WITNESS_UNEXPECTED, \"WITNESS_UNEXPECTED\"},\n     {SCRIPT_ERR_WITNESS_PUBKEYTYPE, \"WITNESS_PUBKEYTYPE\"},\n+    {SCRIPT_ERR_WITNESS_CLEANSTACK, \"WITNESS_CLEANSTACK\"},\n     {SCRIPT_ERR_OP_CODESEPARATOR, \"OP_CODESEPARATOR\"},\n     {SCRIPT_ERR_SIG_FINDANDDELETE, \"SIG_FINDANDDELETE\"},\n };\n@@ -831,6 +832,14 @@ BOOST_AUTO_TEST_CASE(script_build)\n                                 \"Basic P2SH(P2WPKH)\", SCRIPT_VERIFY_WITNESS | SCRIPT_VERIFY_P2SH | SCRIPT_VERIFY_WITNESS_PUBKEYTYPE, true, WitnessMode::PKH,\n                                 0, 1).PushWitSig(keys.key0).Push(keys.pubkey0).AsWit().PushRedeem().ScriptError(SCRIPT_ERR_WITNESS_PUBKEYTYPE));\n \n+    // Testing witness scripts for SCRIPT_ERR_WITNESS_CLEANSTACK\n+    tests.push_back(TestBuilder(CScript() << ToByteVector(keys.pubkey0C) << OP_CHECKSIG,\n+                                \"Basic P2WSH with unnecessary input\", SCRIPT_VERIFY_WITNESS | SCRIPT_VERIFY_P2SH, false, WitnessMode::SH,\n+                                0, 1).Push(\"11\").AsWit().PushWitSig(keys.key0C).PushWitRedeem().ScriptError(SCRIPT_ERR_WITNESS_CLEANSTACK));\n+    tests.push_back(TestBuilder(CScript() << ToByteVector(keys.pubkey0C) << OP_CHECKSIG,\n+                                \"Basic P2SH(P2WSH) with unnecessary input\", SCRIPT_VERIFY_WITNESS | SCRIPT_VERIFY_P2SH, true, WitnessMode::SH,\n+                                0, 1).Push(\"11\").AsWit().PushWitSig(keys.key0C).PushWitRedeem().PushRedeem().ScriptError(SCRIPT_ERR_WITNESS_CLEANSTACK));\n+\n     // P2WSH 1-of-2 multisig with compressed keys\n     tests.push_back(TestBuilder(CScript() << OP_1 << ToByteVector(keys.pubkey1C) << ToByteVector(keys.pubkey0C) << OP_2 << OP_CHECKMULTISIG,\n                                 \"P2WSH CHECKMULTISIG with compressed keys\", SCRIPT_VERIFY_WITNESS | SCRIPT_VERIFY_P2SH | SCRIPT_VERIFY_WITNESS_PUBKEYTYPE, false, WitnessMode::SH,"
      }
    ]
  },
  {
    "sha": "a52957f5f3fcb38d54bebb60b243044cfefcd68d",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzphNTI5NTdmNWYzZmNiMzhkNTRiZWJiNjBiMjQzMDQ0Y2ZlZmNkNjhk",
    "commit": {
      "author": {
        "name": "sanket1729",
        "email": "sanket1729@gmail.com",
        "date": "2020-10-07T23:23:08Z"
      },
      "committer": {
        "name": "sanket1729",
        "email": "sanket1729@gmail.com",
        "date": "2021-01-26T03:22:06Z"
      },
      "message": "MinimalIf-> Witness_MinimalIf for witness programs\n\nChange error code for MINIMALIF to WITNESS_MINIMALIF\nto make it explicit that minimal if is only applicable\nfor witness programs",
      "tree": {
        "sha": "99468aa2bc5a2f5564acd602c5a1b34535391f8f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/99468aa2bc5a2f5564acd602c5a1b34535391f8f"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a52957f5f3fcb38d54bebb60b243044cfefcd68d",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a52957f5f3fcb38d54bebb60b243044cfefcd68d",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/a52957f5f3fcb38d54bebb60b243044cfefcd68d",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a52957f5f3fcb38d54bebb60b243044cfefcd68d/comments",
    "author": {
      "login": "sanket1729",
      "id": 6881849,
      "node_id": "MDQ6VXNlcjY4ODE4NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6881849?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sanket1729",
      "html_url": "https://github.com/sanket1729",
      "followers_url": "https://api.github.com/users/sanket1729/followers",
      "following_url": "https://api.github.com/users/sanket1729/following{/other_user}",
      "gists_url": "https://api.github.com/users/sanket1729/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sanket1729/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sanket1729/subscriptions",
      "organizations_url": "https://api.github.com/users/sanket1729/orgs",
      "repos_url": "https://api.github.com/users/sanket1729/repos",
      "events_url": "https://api.github.com/users/sanket1729/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sanket1729/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sanket1729",
      "id": 6881849,
      "node_id": "MDQ6VXNlcjY4ODE4NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6881849?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sanket1729",
      "html_url": "https://github.com/sanket1729",
      "followers_url": "https://api.github.com/users/sanket1729/followers",
      "following_url": "https://api.github.com/users/sanket1729/following{/other_user}",
      "gists_url": "https://api.github.com/users/sanket1729/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sanket1729/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sanket1729/subscriptions",
      "organizations_url": "https://api.github.com/users/sanket1729/orgs",
      "repos_url": "https://api.github.com/users/sanket1729/repos",
      "events_url": "https://api.github.com/users/sanket1729/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sanket1729/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "39987fdb5129dd9c2c44c2282d88008125f455c5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/39987fdb5129dd9c2c44c2282d88008125f455c5",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/39987fdb5129dd9c2c44c2282d88008125f455c5"
      }
    ],
    "stats": {
      "total": 36,
      "additions": 18,
      "deletions": 18
    },
    "files": [
      {
        "sha": "e01e9217bd461e37af73152d3c1ae1c114ef0077",
        "filename": "src/script/interpreter.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/a52957f5f3fcb38d54bebb60b243044cfefcd68d/src/script/interpreter.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/a52957f5f3fcb38d54bebb60b243044cfefcd68d/src/script/interpreter.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/script/interpreter.cpp?ref=a52957f5f3fcb38d54bebb60b243044cfefcd68d",
        "patch": "@@ -645,9 +645,9 @@ bool EvalScript(std::vector<std::vector<unsigned char> >& stack, const CScript&\n                         // Under witness v0 rules it is only a policy rule, enabled through SCRIPT_VERIFY_MINIMALIF.\n                         if (sigversion == SigVersion::WITNESS_V0 && (flags & SCRIPT_VERIFY_MINIMALIF)) {\n                             if (vch.size() > 1)\n-                                return set_error(serror, SCRIPT_ERR_MINIMALIF);\n+                                return set_error(serror, SCRIPT_ERR_WITNESS_MINIMALIF);\n                             if (vch.size() == 1 && vch[0] != 1)\n-                                return set_error(serror, SCRIPT_ERR_MINIMALIF);\n+                                return set_error(serror, SCRIPT_ERR_WITNESS_MINIMALIF);\n                         }\n                         fValue = CastToBool(vch);\n                         if (opcode == OP_NOTIF)"
      },
      {
        "sha": "0a248719ed989e6adab87f08fb10084737929441",
        "filename": "src/script/script_error.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/a52957f5f3fcb38d54bebb60b243044cfefcd68d/src/script/script_error.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/a52957f5f3fcb38d54bebb60b243044cfefcd68d/src/script/script_error.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/script/script_error.cpp?ref=a52957f5f3fcb38d54bebb60b243044cfefcd68d",
        "patch": "@@ -65,8 +65,6 @@ std::string ScriptErrorString(const ScriptError serror)\n             return \"Non-canonical signature: S value is unnecessarily high\";\n         case SCRIPT_ERR_SIG_NULLDUMMY:\n             return \"Dummy CHECKMULTISIG argument must be zero\";\n-        case SCRIPT_ERR_MINIMALIF:\n-            return \"OP_IF/NOTIF argument must be minimal\";\n         case SCRIPT_ERR_SIG_NULLFAIL:\n             return \"Signature must be zero for failed CHECK(MULTI)SIG operation\";\n         case SCRIPT_ERR_DISCOURAGE_UPGRADABLE_NOPS:\n@@ -117,6 +115,8 @@ std::string ScriptErrorString(const ScriptError serror)\n             return \"Using OP_CODESEPARATOR in non-witness script\";\n         case SCRIPT_ERR_SIG_FINDANDDELETE:\n             return \"Signature is found in scriptCode\";\n+        case SCRIPT_ERR_WITNESS_MINIMALIF:\n+            return \"Witness programs must have minimal OP_IF/NOTIF argument\";\n         case SCRIPT_ERR_UNKNOWN_ERROR:\n         case SCRIPT_ERR_ERROR_COUNT:\n         default: break;"
      },
      {
        "sha": "3937e1822727f7d3590ffd2af98e0f3024f2e184",
        "filename": "src/script/script_error.h",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/a52957f5f3fcb38d54bebb60b243044cfefcd68d/src/script/script_error.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/a52957f5f3fcb38d54bebb60b243044cfefcd68d/src/script/script_error.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/script/script_error.h?ref=a52957f5f3fcb38d54bebb60b243044cfefcd68d",
        "patch": "@@ -50,7 +50,6 @@ typedef enum ScriptError_t\n     SCRIPT_ERR_SIG_NULLDUMMY,\n     SCRIPT_ERR_PUBKEYTYPE,\n     SCRIPT_ERR_CLEANSTACK,\n-    SCRIPT_ERR_MINIMALIF,\n     SCRIPT_ERR_SIG_NULLFAIL,\n \n     /* softfork safeness */\n@@ -69,6 +68,7 @@ typedef enum ScriptError_t\n     SCRIPT_ERR_WITNESS_UNEXPECTED,\n     SCRIPT_ERR_WITNESS_PUBKEYTYPE,\n     SCRIPT_ERR_WITNESS_CLEANSTACK,\n+    SCRIPT_ERR_WITNESS_MINIMALIF,\n \n     /* Taproot */\n     SCRIPT_ERR_SCHNORR_SIG_SIZE,"
      },
      {
        "sha": "852899b6b91cf84f9751bcdcbe03643c20e97bae",
        "filename": "src/test/data/script_tests.json",
        "status": "modified",
        "additions": 12,
        "deletions": 12,
        "changes": 24,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/a52957f5f3fcb38d54bebb60b243044cfefcd68d/src/test/data/script_tests.json",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/a52957f5f3fcb38d54bebb60b243044cfefcd68d/src/test/data/script_tests.json",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/data/script_tests.json?ref=a52957f5f3fcb38d54bebb60b243044cfefcd68d",
        "patch": "@@ -2585,10 +2585,10 @@\n [[\"\", \"635168\", 0.00000001], \"\", \"0 0x20 0xc7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"P2SH,WITNESS\", \"WITNESS_CLEANSTACK\"],\n [[\"00\", \"635168\", 0.00000001], \"\", \"0 0x20 0xc7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"P2SH,WITNESS\", \"WITNESS_CLEANSTACK\"],\n [[\"01\", \"635168\", 0.00000001], \"\", \"0 0x20 0xc7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"P2SH,WITNESS,MINIMALIF\", \"OK\"],\n-[[\"02\", \"635168\", 0.00000001], \"\", \"0 0x20 0xc7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"P2SH,WITNESS,MINIMALIF\", \"MINIMALIF\"],\n-[[\"0100\", \"635168\", 0.00000001], \"\", \"0 0x20 0xc7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"P2SH,WITNESS,MINIMALIF\", \"MINIMALIF\"],\n-[[\"00\", \"635168\", 0.00000001], \"\", \"0 0x20 0xc7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"P2SH,WITNESS,MINIMALIF\", \"MINIMALIF\"],\n+[[\"02\", \"635168\", 0.00000001], \"\", \"0 0x20 0xc7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"P2SH,WITNESS,MINIMALIF\", \"WITNESS_MINIMALIF\"],\n+[[\"0100\", \"635168\", 0.00000001], \"\", \"0 0x20 0xc7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"P2SH,WITNESS,MINIMALIF\", \"WITNESS_MINIMALIF\"],\n [[\"\", \"635168\", 0.00000001], \"\", \"0 0x20 0xc7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"P2SH,WITNESS,MINIMALIF\", \"WITNESS_CLEANSTACK\"],\n+[[\"00\", \"635168\", 0.00000001], \"\", \"0 0x20 0xc7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"P2SH,WITNESS,MINIMALIF\", \"WITNESS_MINIMALIF\"],\n [[\"635168\", 0.00000001], \"\", \"0 0x20 0xc7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"P2SH,WITNESS\", \"UNBALANCED_CONDITIONAL\"],\n [[\"635168\", 0.00000001], \"\", \"0 0x20 0xc7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"P2SH,WITNESS,MINIMALIF\", \"UNBALANCED_CONDITIONAL\"],\n [\"P2WSH NOTIF 1 ENDIF\"],\n@@ -2597,11 +2597,11 @@\n [[\"0100\", \"645168\", 0.00000001], \"\", \"0 0x20 0xf913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"P2SH,WITNESS\", \"WITNESS_CLEANSTACK\"],\n [[\"\", \"645168\", 0.00000001], \"\", \"0 0x20 0xf913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"P2SH,WITNESS\", \"OK\"],\n [[\"00\", \"645168\", 0.00000001], \"\", \"0 0x20 0xf913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"P2SH,WITNESS\", \"OK\"],\n-[[\"02\", \"645168\", 0.00000001], \"\", \"0 0x20 0xf913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"P2SH,WITNESS,MINIMALIF\", \"MINIMALIF\"],\n-[[\"0100\", \"645168\", 0.00000001], \"\", \"0 0x20 0xf913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"P2SH,WITNESS,MINIMALIF\", \"MINIMALIF\"],\n [[\"01\", \"645168\", 0.00000001], \"\", \"0 0x20 0xf913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"P2SH,WITNESS,MINIMALIF\", \"WITNESS_CLEANSTACK\"],\n+[[\"02\", \"645168\", 0.00000001], \"\", \"0 0x20 0xf913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"P2SH,WITNESS,MINIMALIF\", \"WITNESS_MINIMALIF\"],\n+[[\"0100\", \"645168\", 0.00000001], \"\", \"0 0x20 0xf913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"P2SH,WITNESS,MINIMALIF\", \"WITNESS_MINIMALIF\"],\n [[\"\", \"645168\", 0.00000001], \"\", \"0 0x20 0xf913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"P2SH,WITNESS,MINIMALIF\", \"OK\"],\n-[[\"00\", \"645168\", 0.00000001], \"\", \"0 0x20 0xf913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"P2SH,WITNESS,MINIMALIF\", \"MINIMALIF\"],\n+[[\"00\", \"645168\", 0.00000001], \"\", \"0 0x20 0xf913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"P2SH,WITNESS,MINIMALIF\", \"WITNESS_MINIMALIF\"],\n [[\"645168\", 0.00000001], \"\", \"0 0x20 0xf913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"P2SH,WITNESS\", \"UNBALANCED_CONDITIONAL\"],\n [[\"645168\", 0.00000001], \"\", \"0 0x20 0xf913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"P2SH,WITNESS,MINIMALIF\", \"UNBALANCED_CONDITIONAL\"],\n \n@@ -2614,10 +2614,10 @@\n [[\"\", \"635168\", 0.00000001], \"0x22 0x0020c7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"HASH160 0x14 0x9b27ee6d9010c21bf837b334d043be5d150e7ba7 EQUAL\", \"P2SH,WITNESS\", \"WITNESS_CLEANSTACK\"],\n [[\"00\", \"635168\", 0.00000001], \"0x22 0x0020c7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"HASH160 0x14 0x9b27ee6d9010c21bf837b334d043be5d150e7ba7 EQUAL\", \"P2SH,WITNESS\", \"WITNESS_CLEANSTACK\"],\n [[\"01\", \"635168\", 0.00000001], \"0x22 0x0020c7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"HASH160 0x14 0x9b27ee6d9010c21bf837b334d043be5d150e7ba7 EQUAL\", \"P2SH,WITNESS,MINIMALIF\", \"OK\"],\n-[[\"02\", \"635168\", 0.00000001], \"0x22 0x0020c7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"HASH160 0x14 0x9b27ee6d9010c21bf837b334d043be5d150e7ba7 EQUAL\", \"P2SH,WITNESS,MINIMALIF\", \"MINIMALIF\"],\n-[[\"0100\", \"635168\", 0.00000001], \"0x22 0x0020c7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"HASH160 0x14 0x9b27ee6d9010c21bf837b334d043be5d150e7ba7 EQUAL\", \"P2SH,WITNESS,MINIMALIF\", \"MINIMALIF\"],\n-[[\"00\", \"635168\", 0.00000001], \"0x22 0x0020c7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"HASH160 0x14 0x9b27ee6d9010c21bf837b334d043be5d150e7ba7 EQUAL\", \"P2SH,WITNESS,MINIMALIF\", \"MINIMALIF\"],\n+[[\"02\", \"635168\", 0.00000001], \"0x22 0x0020c7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"HASH160 0x14 0x9b27ee6d9010c21bf837b334d043be5d150e7ba7 EQUAL\", \"P2SH,WITNESS,MINIMALIF\", \"WITNESS_MINIMALIF\"],\n+[[\"0100\", \"635168\", 0.00000001], \"0x22 0x0020c7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"HASH160 0x14 0x9b27ee6d9010c21bf837b334d043be5d150e7ba7 EQUAL\", \"P2SH,WITNESS,MINIMALIF\", \"WITNESS_MINIMALIF\"],\n [[\"\", \"635168\", 0.00000001], \"0x22 0x0020c7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"HASH160 0x14 0x9b27ee6d9010c21bf837b334d043be5d150e7ba7 EQUAL\", \"P2SH,WITNESS,MINIMALIF\", \"WITNESS_CLEANSTACK\"],\n+[[\"00\", \"635168\", 0.00000001], \"0x22 0x0020c7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"HASH160 0x14 0x9b27ee6d9010c21bf837b334d043be5d150e7ba7 EQUAL\", \"P2SH,WITNESS,MINIMALIF\", \"WITNESS_MINIMALIF\"],\n [[\"635168\", 0.00000001], \"0x22 0x0020c7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"HASH160 0x14 0x9b27ee6d9010c21bf837b334d043be5d150e7ba7 EQUAL\", \"P2SH,WITNESS\", \"UNBALANCED_CONDITIONAL\"],\n [[\"635168\", 0.00000001], \"0x22 0x0020c7eaf06d5ae01a58e376e126eb1e6fab2036076922b96b2711ffbec1e590665d\", \"HASH160 0x14 0x9b27ee6d9010c21bf837b334d043be5d150e7ba7 EQUAL\", \"P2SH,WITNESS,MINIMALIF\", \"UNBALANCED_CONDITIONAL\"],\n [\"P2SH-P2WSH NOTIF 1 ENDIF\"],\n@@ -2626,11 +2626,11 @@\n [[\"0100\", \"645168\", 0.00000001], \"0x22 0x0020f913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"HASH160 0x14 0xdbb7d1c0a56b7a9c423300c8cca6e6e065baf1dc EQUAL\", \"P2SH,WITNESS\", \"WITNESS_CLEANSTACK\"],\n [[\"\", \"645168\", 0.00000001], \"0x22 0x0020f913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"HASH160 0x14 0xdbb7d1c0a56b7a9c423300c8cca6e6e065baf1dc EQUAL\", \"P2SH,WITNESS\", \"OK\"],\n [[\"00\", \"645168\", 0.00000001], \"0x22 0x0020f913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"HASH160 0x14 0xdbb7d1c0a56b7a9c423300c8cca6e6e065baf1dc EQUAL\", \"P2SH,WITNESS\", \"OK\"],\n-[[\"02\", \"645168\", 0.00000001], \"0x22 0x0020f913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"HASH160 0x14 0xdbb7d1c0a56b7a9c423300c8cca6e6e065baf1dc EQUAL\", \"P2SH,WITNESS,MINIMALIF\", \"MINIMALIF\"],\n-[[\"0100\", \"645168\", 0.00000001], \"0x22 0x0020f913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"HASH160 0x14 0xdbb7d1c0a56b7a9c423300c8cca6e6e065baf1dc EQUAL\", \"P2SH,WITNESS,MINIMALIF\", \"MINIMALIF\"],\n [[\"01\", \"645168\", 0.00000001], \"0x22 0x0020f913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"HASH160 0x14 0xdbb7d1c0a56b7a9c423300c8cca6e6e065baf1dc EQUAL\", \"P2SH,WITNESS,MINIMALIF\", \"WITNESS_CLEANSTACK\"],\n+[[\"02\", \"645168\", 0.00000001], \"0x22 0x0020f913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"HASH160 0x14 0xdbb7d1c0a56b7a9c423300c8cca6e6e065baf1dc EQUAL\", \"P2SH,WITNESS,MINIMALIF\", \"WITNESS_MINIMALIF\"],\n+[[\"0100\", \"645168\", 0.00000001], \"0x22 0x0020f913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"HASH160 0x14 0xdbb7d1c0a56b7a9c423300c8cca6e6e065baf1dc EQUAL\", \"P2SH,WITNESS,MINIMALIF\", \"WITNESS_MINIMALIF\"],\n [[\"\", \"645168\", 0.00000001], \"0x22 0x0020f913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"HASH160 0x14 0xdbb7d1c0a56b7a9c423300c8cca6e6e065baf1dc EQUAL\", \"P2SH,WITNESS,MINIMALIF\", \"OK\"],\n-[[\"00\", \"645168\", 0.00000001], \"0x22 0x0020f913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"HASH160 0x14 0xdbb7d1c0a56b7a9c423300c8cca6e6e065baf1dc EQUAL\", \"P2SH,WITNESS,MINIMALIF\", \"MINIMALIF\"],\n+[[\"00\", \"645168\", 0.00000001], \"0x22 0x0020f913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"HASH160 0x14 0xdbb7d1c0a56b7a9c423300c8cca6e6e065baf1dc EQUAL\", \"P2SH,WITNESS,MINIMALIF\", \"WITNESS_MINIMALIF\"],\n [[\"645168\", 0.00000001], \"0x22 0x0020f913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"HASH160 0x14 0xdbb7d1c0a56b7a9c423300c8cca6e6e065baf1dc EQUAL\", \"P2SH,WITNESS\", \"UNBALANCED_CONDITIONAL\"],\n [[\"645168\", 0.00000001], \"0x22 0x0020f913eacf2e38a5d6fc3a8311d72ae704cb83866350a984dd3e5eb76d2a8c28e8\", \"HASH160 0x14 0xdbb7d1c0a56b7a9c423300c8cca6e6e065baf1dc EQUAL\", \"P2SH,WITNESS,MINIMALIF\", \"UNBALANCED_CONDITIONAL\"],\n "
      },
      {
        "sha": "352464e32b83d5dbef7addbbb878098e1e44f35d",
        "filename": "src/test/script_tests.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/a52957f5f3fcb38d54bebb60b243044cfefcd68d/src/test/script_tests.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/a52957f5f3fcb38d54bebb60b243044cfefcd68d/src/test/script_tests.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/script_tests.cpp?ref=a52957f5f3fcb38d54bebb60b243044cfefcd68d",
        "patch": "@@ -89,7 +89,6 @@ static ScriptErrorDesc script_errors[]={\n     {SCRIPT_ERR_SIG_NULLDUMMY, \"SIG_NULLDUMMY\"},\n     {SCRIPT_ERR_PUBKEYTYPE, \"PUBKEYTYPE\"},\n     {SCRIPT_ERR_CLEANSTACK, \"CLEANSTACK\"},\n-    {SCRIPT_ERR_MINIMALIF, \"MINIMALIF\"},\n     {SCRIPT_ERR_SIG_NULLFAIL, \"NULLFAIL\"},\n     {SCRIPT_ERR_DISCOURAGE_UPGRADABLE_NOPS, \"DISCOURAGE_UPGRADABLE_NOPS\"},\n     {SCRIPT_ERR_DISCOURAGE_UPGRADABLE_WITNESS_PROGRAM, \"DISCOURAGE_UPGRADABLE_WITNESS_PROGRAM\"},\n@@ -101,6 +100,7 @@ static ScriptErrorDesc script_errors[]={\n     {SCRIPT_ERR_WITNESS_UNEXPECTED, \"WITNESS_UNEXPECTED\"},\n     {SCRIPT_ERR_WITNESS_PUBKEYTYPE, \"WITNESS_PUBKEYTYPE\"},\n     {SCRIPT_ERR_WITNESS_CLEANSTACK, \"WITNESS_CLEANSTACK\"},\n+    {SCRIPT_ERR_WITNESS_MINIMALIF, \"WITNESS_MINIMALIF\"},\n     {SCRIPT_ERR_OP_CODESEPARATOR, \"OP_CODESEPARATOR\"},\n     {SCRIPT_ERR_SIG_FINDANDDELETE, \"SIG_FINDANDDELETE\"},\n };"
      }
    ]
  },
  {
    "sha": "03db7ce1971009788ca7099130c79e663b6335d9",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzowM2RiN2NlMTk3MTAwOTc4OGNhNzA5OTEzMGM3OWU2NjNiNjMzNWQ5",
    "commit": {
      "author": {
        "name": "sanket1729",
        "email": "sanket1729@gmail.com",
        "date": "2020-10-07T10:57:40Z"
      },
      "committer": {
        "name": "sanket1729",
        "email": "sanket1729@gmail.com",
        "date": "2021-01-26T03:23:08Z"
      },
      "message": "Avoid double cleanstk checks for witness programs\n\n-The consensus rules for Segwit ensure that CleanStack\nis followed. There is no need to set stack to size 1 and check\nit again\n- Replaced `cond == false` with a more idiomatic !cond",
      "tree": {
        "sha": "559d46969fa52b02ea9944078d6e0796ebfa2ae8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/559d46969fa52b02ea9944078d6e0796ebfa2ae8"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/03db7ce1971009788ca7099130c79e663b6335d9",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/03db7ce1971009788ca7099130c79e663b6335d9",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/03db7ce1971009788ca7099130c79e663b6335d9",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/03db7ce1971009788ca7099130c79e663b6335d9/comments",
    "author": {
      "login": "sanket1729",
      "id": 6881849,
      "node_id": "MDQ6VXNlcjY4ODE4NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6881849?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sanket1729",
      "html_url": "https://github.com/sanket1729",
      "followers_url": "https://api.github.com/users/sanket1729/followers",
      "following_url": "https://api.github.com/users/sanket1729/following{/other_user}",
      "gists_url": "https://api.github.com/users/sanket1729/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sanket1729/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sanket1729/subscriptions",
      "organizations_url": "https://api.github.com/users/sanket1729/orgs",
      "repos_url": "https://api.github.com/users/sanket1729/repos",
      "events_url": "https://api.github.com/users/sanket1729/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sanket1729/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sanket1729",
      "id": 6881849,
      "node_id": "MDQ6VXNlcjY4ODE4NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6881849?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sanket1729",
      "html_url": "https://github.com/sanket1729",
      "followers_url": "https://api.github.com/users/sanket1729/followers",
      "following_url": "https://api.github.com/users/sanket1729/following{/other_user}",
      "gists_url": "https://api.github.com/users/sanket1729/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sanket1729/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sanket1729/subscriptions",
      "organizations_url": "https://api.github.com/users/sanket1729/orgs",
      "repos_url": "https://api.github.com/users/sanket1729/repos",
      "events_url": "https://api.github.com/users/sanket1729/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sanket1729/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "a52957f5f3fcb38d54bebb60b243044cfefcd68d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a52957f5f3fcb38d54bebb60b243044cfefcd68d",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/a52957f5f3fcb38d54bebb60b243044cfefcd68d"
      }
    ],
    "stats": {
      "total": 11,
      "additions": 3,
      "deletions": 8
    },
    "files": [
      {
        "sha": "dfca844f0225b6c09d63782e757c88a1830a2471",
        "filename": "src/script/interpreter.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 8,
        "changes": 11,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/03db7ce1971009788ca7099130c79e663b6335d9/src/script/interpreter.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/03db7ce1971009788ca7099130c79e663b6335d9/src/script/interpreter.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/script/interpreter.cpp?ref=03db7ce1971009788ca7099130c79e663b6335d9",
        "patch": "@@ -1967,7 +1967,7 @@ bool VerifyScript(const CScript& scriptSig, const CScript& scriptPubKey, const C\n         return false;\n     if (stack.empty())\n         return set_error(serror, SCRIPT_ERR_EVAL_FALSE);\n-    if (CastToBool(stack.back()) == false)\n+    if (!CastToBool(stack.back()))\n         return set_error(serror, SCRIPT_ERR_EVAL_FALSE);\n \n     // Bare witness programs\n@@ -1983,9 +1983,6 @@ bool VerifyScript(const CScript& scriptSig, const CScript& scriptPubKey, const C\n             if (!VerifyWitnessProgram(*witness, witnessversion, witnessprogram, flags, checker, serror, /* is_p2sh */ false)) {\n                 return false;\n             }\n-            // Bypass the cleanstack check at the end. The actual stack is obviously not clean\n-            // for witness programs.\n-            stack.resize(1);\n         }\n     }\n \n@@ -2028,9 +2025,6 @@ bool VerifyScript(const CScript& scriptSig, const CScript& scriptPubKey, const C\n                 if (!VerifyWitnessProgram(*witness, witnessversion, witnessprogram, flags, checker, serror, /* is_p2sh */ true)) {\n                     return false;\n                 }\n-                // Bypass the cleanstack check at the end. The actual stack is obviously not clean\n-                // for witness programs.\n-                stack.resize(1);\n             }\n         }\n     }\n@@ -2043,7 +2037,8 @@ bool VerifyScript(const CScript& scriptSig, const CScript& scriptPubKey, const C\n         // would be possible, which is not a softfork (and P2SH should be one).\n         assert((flags & SCRIPT_VERIFY_P2SH) != 0);\n         assert((flags & SCRIPT_VERIFY_WITNESS) != 0);\n-        if (stack.size() != 1) {\n+        // Bypass the cleanstack check at the end for witness programs\n+        if (!hadWitness && stack.size() != 1) {\n             return set_error(serror, SCRIPT_ERR_CLEANSTACK);\n         }\n     }"
      }
    ]
  }
]