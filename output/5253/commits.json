[
  {
    "sha": "7c041b3b91aa08a8f5863382b865a5174281ad03",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo3YzA0MWIzYjkxYWEwOGE4ZjU4NjMzODJiODY1YTUxNzQyODFhZDAz",
    "commit": {
      "author": {
        "name": "Peter Todd",
        "email": "pete@petertodd.org",
        "date": "2014-11-10T07:52:28Z"
      },
      "committer": {
        "name": "Peter Todd",
        "email": "pete@petertodd.org",
        "date": "2014-11-10T07:52:28Z"
      },
      "message": "Check against MANDATORY flags prior to accepting to mempool\n\nPreviously transactions were only tested again the\nSTANDARD_SCRIPT_VERIFY_FLAGS prior to mempool acceptance, so any bugs in\nthose flags that allowed actually-invalid transactions to pass would\nresult in allowing invalid transactions into the mempool. Fortunately\nthere is a second check in CreateNewBlock() that would prevent those\ntransactions from being mined, resulting in an invalid block, however\nthis could still be exploited as a DoS attack.",
      "tree": {
        "sha": "a52e259e044d7c6b15c5724cc1279f27ecfcd2f2",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a52e259e044d7c6b15c5724cc1279f27ecfcd2f2"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7c041b3b91aa08a8f5863382b865a5174281ad03",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGrBAABCACVBQJUYG+JXhSAAAAAABUAQGJsb2NraGFzaEBiaXRjb2luLm9yZzAw\nMDAwMDAwMDAwMDAwMDAxMmFlNmNiNTBkYTgwNjU5NWZiNjdkZjhiMmVlNmY4ZWEw\nMjMxOWI3ZDVhYWEzNDYvFIAAAAAAFQARcGthLWFkZHJlc3NAZ251cGcub3JncGV0\nZUBwZXRlcnRvZC5vcmcACgkQJIFAPaXwkftbNQf/fIwl7LbfCdlvtaQrK3QTVJRo\n5XslN+oAvrza6y7esGiWwZEjn/7ZpFot/eBkHrbL5yEjcv6BE7XZe0o2l+50RRL5\nzY6xpDp+K6pYX31+6KAks6vuT7MmPEXHZIbRFVkSWxlAFmJDZ6KRKkTiBSoB7gf9\ncms/MMf+y9jz0lQH+soMQ1uTXZGlrG1f/3Y+7UwuGzUQ2y4+2XK+B1sp1e0wy3JI\nATkhbEt263dDNcZ4o6EyJvo7K8ukTstT9ZwWT+Ehc5ZUiOEcxywznCe/zXbzyIk1\nlJY5iE4csPToxS6lUZuxfFDZJ6h0IBqWEZAJPuNp3huRVfVq8iV3bHI/NSD0Jg==\n=8zYp\n-----END PGP SIGNATURE-----",
        "payload": "tree a52e259e044d7c6b15c5724cc1279f27ecfcd2f2\nparent 7b7c86616006a5047ae07085e26c40e3606f60c5\nauthor Peter Todd <pete@petertodd.org> 1415605948 -0500\ncommitter Peter Todd <pete@petertodd.org> 1415605948 -0500\n\nCheck against MANDATORY flags prior to accepting to mempool\n\nPreviously transactions were only tested again the\nSTANDARD_SCRIPT_VERIFY_FLAGS prior to mempool acceptance, so any bugs in\nthose flags that allowed actually-invalid transactions to pass would\nresult in allowing invalid transactions into the mempool. Fortunately\nthere is a second check in CreateNewBlock() that would prevent those\ntransactions from being mined, resulting in an invalid block, however\nthis could still be exploited as a DoS attack.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7c041b3b91aa08a8f5863382b865a5174281ad03",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/7c041b3b91aa08a8f5863382b865a5174281ad03",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7c041b3b91aa08a8f5863382b865a5174281ad03/comments",
    "author": {
      "login": "petertodd",
      "id": 7042,
      "node_id": "MDQ6VXNlcjcwNDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7042?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/petertodd",
      "html_url": "https://github.com/petertodd",
      "followers_url": "https://api.github.com/users/petertodd/followers",
      "following_url": "https://api.github.com/users/petertodd/following{/other_user}",
      "gists_url": "https://api.github.com/users/petertodd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/petertodd/subscriptions",
      "organizations_url": "https://api.github.com/users/petertodd/orgs",
      "repos_url": "https://api.github.com/users/petertodd/repos",
      "events_url": "https://api.github.com/users/petertodd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/petertodd/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "petertodd",
      "id": 7042,
      "node_id": "MDQ6VXNlcjcwNDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7042?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/petertodd",
      "html_url": "https://github.com/petertodd",
      "followers_url": "https://api.github.com/users/petertodd/followers",
      "following_url": "https://api.github.com/users/petertodd/following{/other_user}",
      "gists_url": "https://api.github.com/users/petertodd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/petertodd/subscriptions",
      "organizations_url": "https://api.github.com/users/petertodd/orgs",
      "repos_url": "https://api.github.com/users/petertodd/repos",
      "events_url": "https://api.github.com/users/petertodd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/petertodd/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "7b7c86616006a5047ae07085e26c40e3606f60c5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7b7c86616006a5047ae07085e26c40e3606f60c5",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/7b7c86616006a5047ae07085e26c40e3606f60c5"
      }
    ],
    "stats": {
      "total": 15,
      "additions": 15,
      "deletions": 0
    },
    "files": [
      {
        "sha": "8d4a9e59f15a85c6a15f30e0f7f52cefaca42692",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 15,
        "deletions": 0,
        "changes": 15,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7c041b3b91aa08a8f5863382b865a5174281ad03/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7c041b3b91aa08a8f5863382b865a5174281ad03/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=7c041b3b91aa08a8f5863382b865a5174281ad03",
        "patch": "@@ -1039,6 +1039,21 @@ bool AcceptToMemoryPool(CTxMemPool& pool, CValidationState &state, const CTransa\n         {\n             return error(\"AcceptToMemoryPool: : ConnectInputs failed %s\", hash.ToString());\n         }\n+\n+        // Check again against just the consensus-critical mandatory script\n+        // verification flags, in case of bugs in the standard flags that cause\n+        // transactions to pass as valid when they're actually invalid. For\n+        // instance the STRICTENC flag was incorrectly allowing certain\n+        // CHECKSIG NOT scripts to pass, even though they were invalid.\n+        //\n+        // There is a similar check in CreateNewBlock() to prevent creating\n+        // invalid blocks, however allowing such transactions into the mempool\n+        // can be exploited as a DoS attack.\n+        if (!CheckInputs(tx, state, view, true, MANDATORY_SCRIPT_VERIFY_FLAGS, true))\n+        {\n+            return error(\"AcceptToMemoryPool: : BUG! PLEASE REPORT THIS! ConnectInputs failed against MANDATORY but not STANDARD flags %s\", hash.ToString());\n+        }\n+\n         // Store transaction in memory\n         pool.addUnchecked(hash, entry);\n     }"
      }
    ]
  }
]